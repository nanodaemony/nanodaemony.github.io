(window.webpackJsonp=window.webpackJsonp||[]).push([[211],{540:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_1-zookeeper基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-zookeeper基础"}},[s._v("#")]),s._v(" 1.Zookeeper基础")]),s._v(" "),a("p",[s._v("项目从单体到"),a("strong",[s._v("分布式")]),s._v("转变之后, 会产生"),a("strong",[s._v("多个节点之间协同")]),s._v("的问题. 如: 每天的定时任务由谁哪个节点来执行? RPC 调用时的"),a("strong",[s._v("服务发现")]),s._v("? 如何保证并发请求的"),a("strong",[s._v("幂等")]),s._v("? 这些可以统一归纳为"),a("strong",[s._v("多节点协调问题")]),s._v(", 如果靠节点自身进行协调是不可靠的, 性能上也不可取. 应该由一个"),a("strong",[s._v("独立的服务做协调工作")]),s._v(", 它必须可靠, 而且保证性能.")]),s._v(" "),a("p",[s._v("ZK 是用于分布式应用的协调服务. "),a("strong",[s._v("分布式应用程序可以使用 ZK 的 API 用于同步, 节点状态, 配置等信息, 服务注册等信息")]),s._v(". 其设计目标是将复杂且容易出错的分布式一致性服务封装起来, 构成一个高效可靠的原语集, 并以一系列简单易用的接口提供给用户使用.")]),s._v(" "),a("p",[s._v("ZK 虽然是个大管家, 但是它不会直接发号施令, 而是"),a("strong",[s._v("只是对各个客户的行为做记录")]),s._v(", 不然 ZK 就成了一个中心化的结点, 其可靠性依然有问题.")]),s._v(" "),a("p",[a("strong",[s._v("ZK 是一个典型的分布式")]),s._v("​**==数据一致性=="),a("strong",[s._v("​")]),s._v("解决方案, 分布式应用程序可以基于 ZK 实现诸如数据发布/订阅, 负载均衡, 命名服务, 分布式协调/通知, 集群管理, Master 选举, 分布式锁和分布式队列等功能. ​**其一致性是通过基于 "),a("strong",[s._v("Paxos")]),s._v(" 算法的 "),a("strong",[s._v("ZAB 协议")]),s._v("完成的.")]),s._v(" "),a("p",[s._v("ZK 作为分布式系统也满足 CAP 定理, 其实现保证了 "),a("strong",[s._v("==CP==")]),s._v("(数据一致性与分区容错性).")]),s._v(" "),a("h4",{attrs:{id:"部署与常规配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署与常规配置"}},[s._v("#")]),s._v(" 部署与常规配置")]),s._v(" "),a("h5",{attrs:{id:"_1-安装与运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装与运行"}},[s._v("#")]),s._v(" 1.安装与运行")]),s._v(" "),a("p",[s._v("ZooKeeper 基于 Java 开发, 运行依赖 JVM 环境. "),a("strong",[s._v("默认端口号是 2181")]),s._v(".")]),s._v(" "),a("p",[s._v("下载地址: "),a("a",{attrs:{href:"https://zookeeper.apache.org/releases.html#download",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://zookeeper.apache.org/releases.html#download"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("具体部署流程:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/current/apache-zookeeper-3.5.5-bin.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" apache-zookeeper-3.5.5-bin.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝默认配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("zookeeper_home"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/conf \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" zoo_sample.cfg zoo.cfg\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("zookeeper_home"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/bin/zkServer.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("Zookeeper 有"),a("strong",[s._v("集群模式")]),s._v("和"),a("strong",[s._v("单机模式")]),s._v("等两种运行模式, 单机模式不过多介绍.")]),s._v(" "),a("h5",{attrs:{id:"_2-集群模式与配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-集群模式与配置文件"}},[s._v("#")]),s._v(" 2.集群模式与配置文件")]),s._v(" "),a("p",[s._v("集群模式下一个简单的 zoo.cfg "),a("strong",[s._v("配置文件")]),s._v(".")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ZK中的时间配置最小单位(基本单位), 其他时间配置以整数倍tickTime计算, 这里是2秒")]),s._v("\ntickTime=2000\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Leader允许Follower启动时在initLimit时间内完成数据同步, 它表示tickTime时间倍数 即:initLimit*tickTime, 这里是20秒")]),s._v("\ninitLimit=10\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Leader发送心跳包给集群中所有Follower, 若Follower在syncLimit时间内没有响应, 那么Leader就认为该Follower已经挂掉了, 即: syncLimit*tickTime, 这里为10秒")]),s._v("\nsyncLimit=5\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据存储目录")]),s._v("\ndataDir=/usr/local/zookeeper/data\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对客户端提供的端口号")]),s._v("\nclientPort=2181\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置ZK的日志目录")]),s._v("\ndataLogDir=/usr/local/zookeeper/logs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单个客户端与Zookeeper最大并发连接数")]),s._v("\nmaxClientCnxns=60\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存的数据快照数量, 之外的将会被清除")]),s._v("\nautopurge.snapRetainCount=3\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动触发清除任务时间间隔, 小时为单位. 默认为0, 表示不自动清除. ")]),s._v("\nautopurge.purgeInterval=1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ZK集群节点配置, 端口号2888用于集群节点之间数据通信, 端口号3888用于集群中Leader选举")]),s._v("\nserver.1=192.168.123.100"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3888")]),s._v("\nserver.2=192.168.123.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3888")]),s._v("\nserver.3=192.168.123.102"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("2888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3888")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("集群模式下的多个服务器配置为:")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("server.id=host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("port\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注意: 其中 id 称为 "),a("strong",[s._v("Server ID")]),s._v(", 标识该机器在集群中的"),a("strong",[s._v("机器序号")]),s._v("; 同时需要在数据目录(即 dataDir 参数指定的目录)下创建一个 "),a("strong",[s._v("==myid==")]),s._v(" 文件, 该文件仅有"),a("strong",[s._v("一行内容, 并且是一个数字")]),s._v(", 即对应于每台机器的 "),a("strong",[s._v("Server ID 数字")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("每个服务器")]),s._v("都需要上述配置文件和 myid 文件.")]),s._v(" "),a("h5",{attrs:{id:"_3-集群部署实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-集群部署实例"}},[s._v("#")]),s._v(" 3.集群部署实例")]),s._v(" "),a("p",[s._v("配置语法:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server.<节点ID>=<ip>:<数据同步端口>:<选举端口>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("节点 ID: ​")]),s._v("服务 id 手动指定 1 至 125 之间的数字, 并写到对应服务节点的 "),a("strong",[s._v("{dataDir}/myid")]),s._v(" 文件中.")]),s._v(" "),a("li",[a("strong",[s._v("IP 地址: ​")]),s._v("​"),a("strong",[a("strong",[s._v("节点的远程 IP 地址. 各结点的 IP 地址可以相同, 但这种是")])]),s._v("​"),a("strong",[s._v("伪集群")]),s._v(", 注意生产环境不能这么做, 因为一台机器无法实现容错.")]),s._v(" "),a("li",[a("strong",[s._v("数据同步端口: ​")]),s._v("​"),a("strong",[a("strong",[s._v("主从")])]),s._v("​"),a("strong",[s._v("同步数据复制端口")]),s._v(", 注意伪集群时端口号不能重复.")]),s._v(" "),a("li",[a("strong",[s._v("选举端口: ​")]),s._v("​"),a("strong",[a("strong",[s._v("主从节点")])]),s._v("​"),a("strong",[s._v("选举端口")]),s._v(", 注意伪集群时端口号不能重复.")])]),s._v(" "),a("p",[a("strong",[s._v("集群配置流程:")])]),s._v(" "),a("ul",[a("li",[s._v("分别创建 3 个 data 目录用于存储各节点数据.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" data/1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" data/3\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" data/3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("创建 myid 文件, 并分别写入 id 号 1,2,3.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" data/1/myid\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" data/3/myid\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" data/2/myid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("编写配置文件.")])]),s._v(" "),a("p",[a("strong",[s._v("conf/zoo1.cfg")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tickTime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("initLimit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("syncLimit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataDir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("data/1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("clientPort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2181")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2887:3887\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2888:3888\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2889:3889\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("strong",[s._v("conf/zoo2.cfg")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tickTime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("initLimit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("syncLimit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataDir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("data/2\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("clientPort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2182")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2887:3887\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2888:3888\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2889:3889\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("strong",[s._v("conf/zoo3.cfg")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tickTime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("initLimit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("syncLimit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataDir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("data/3\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("clientPort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2183")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2887:3887\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2888:3888\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server.3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2889:3889\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[s._v("分别启动结点, 启动时分别选择配置文件启动. 如果当前只有一个启动, 整个集群是不可用的, 只有启动超过一半才行.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./bin/zkServer.sh start conf/zoo1.cfg\n./bin/zkServer.sh start conf/zoo2.cfg\n./bin/zkServer.sh start conf/zoo3.cfg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("分别查看状态.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./bin/zkServer.sh status conf/zoo1.cfg\nMode: follower\n./bin/zkServer.sh status conf/zoo2.cfg\nMode: leader\n./bin/zkServer.sh status conf/zoo3.cfg\nMode: follower\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("分别连接指定节点: zkCli.sh 后加参数 "),a("strong",[s._v("-server")]),s._v(" 表示连接指定 IP 与端口.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./bin/zkCli.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2181\n./bin/zkCli.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2182\n./bin/zkCli.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2183\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("任意节点中"),a("strong",[s._v("创建数据")]),s._v(", 查看其它节点已经同步成功.")])]),s._v(" "),a("p",[s._v("注意: -server 参数后"),a("strong",[s._v("同时连接多个服务节点")]),s._v(", 并用逗号隔开 127.0.0.1:2181, 127.0.0.1:2182.")]),s._v(" "),a("p",[s._v("通过 "),a("strong",[s._v("./bin/zkServer.sh status <zoo配置文件>")]),s._v(" 命令可以查看到"),a("strong",[s._v("节点状态")]),s._v(".")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./bin/zkServer.sh status conf/zoo1.cfg\nMode: follower\n./bin/zkServer.sh status conf/zoo2.cfg\nMode: leader\n./bin/zkServer.sh status conf/zoo3.cfg\nMode: follower\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("可以发现中间的 "),a("strong",[s._v("2182")]),s._v(" 是 "),a("strong",[s._v("leader")]),s._v(" 状态.")])])}),[],!1,null,null,null);a.default=e.exports}}]);