(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{622:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_400-mysqlå®žæˆ˜45è®²-æžå®¢æ—¶é—´-ðŸŒŸ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_400-mysqlå®žæˆ˜45è®²-æžå®¢æ—¶é—´-ðŸŒŸ"}},[s._v("#")]),s._v(" 400.MySQLå®žæˆ˜45è®²(æžå®¢æ—¶é—´)ðŸŒŸ")]),s._v(" "),t("h4",{attrs:{id:"å¼€ç¯‡è¯-ä¸€èµ·æ¥æžæ‡‚mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼€ç¯‡è¯-ä¸€èµ·æ¥æžæ‡‚mysql"}},[s._v("#")]),s._v(" å¼€ç¯‡è¯-ä¸€èµ·æ¥æžæ‡‚MySQL")]),s._v(" "),t("p",[s._v('ä½ å¥½, æˆ‘æ˜¯æž—æ™“æ–Œ, ç½‘å "ä¸å¥‡", æ¬¢è¿ŽåŠ å…¥æˆ‘çš„ä¸“æ , å’Œæˆ‘ä¸€èµ·å¼€å§‹ MySQL å­¦ä¹ ä¹‹æ—…. æˆ‘æ›¾å…ˆåŽåœ¨ç™¾åº¦å’Œé˜¿é‡Œä»»èŒ, ä»Žäº‹ MySQL æ•°æ®åº“æ–¹é¢çš„å·¥ä½œ, ä¸€æ­¥æ­¥åœ°ä»Žä¸€ä¸ªæ•°æ®åº“å°ç™½æˆä¸º MySQL å†…æ ¸å¼€å‘äººå‘˜. å›žæƒ³èµ·æ¥, ä»Žæˆ‘ç¬¬ä¸€æ¬¡å¸¦ç€ç–‘é—®ç¿» MySQL çš„æºç æŸ¥åˆ°ç­”æ¡ˆè‡³ä»Š, å·²ç»æœ‰åä¸ªå¹´å¤´äº†. åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, èµ°äº†ä¸å°‘å¼¯è·¯, ä½†åŒæ—¶ä¹Ÿæ”¶èŽ·äº†å¾ˆå¤šçš„çŸ¥è¯†å’Œæ€è€ƒ, å¸Œæœ›èƒ½åœ¨è¿™ä¸ªä¸“æ é‡Œåˆ†äº«ç»™ä½ .')]),s._v(" "),t("p",[s._v("è®°å¾—åˆšå¼€å§‹æŽ¥è§¦ MySQL, æ˜¯æˆ‘åœ¨ç™¾åº¦è´´å§åšæƒé™ç³»ç»Ÿçš„æ—¶å€™. æˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜, ä¸€ä¸ªæ­£å¸¸ 10 æ¯«ç§’å°±èƒ½å®Œæˆçš„ SQL æŸ¥è¯¢è¯·æ±‚å¶å°”è¦æ‰§è¡Œ 100 å¤šæ¯«ç§’æ‰ç»“æŸ. å½“æ—¶ä¸»ç®¡é—®æˆ‘æ˜¯ä»€ä¹ˆåŽŸå› , æˆ‘å…¶å®žä¹Ÿæžä¸æ¸…æ¥š, å°±ä¸Šç½‘æŸ¥ç­”æ¡ˆ, ä½†æ€Žä¹ˆæ‰¾éƒ½æ‰¾ä¸åˆ°, åˆè„¸çš®è–„ä¸æƒ³è¯´è‡ªå·±ä¸çŸ¥é“, åªå¥½ç¡¬ç€å¤´çš®ç¿»æºç . åŽæ¥é‡åˆ°äº†è¶Šæ¥è¶Šå¤šçš„é—®é¢˜, ä¹Ÿæ˜¯ç±»ä¼¼çš„æƒ…æ™¯, æ‰€ä»¥æˆ‘é€æ­¥å…»æˆäº†é€šè¿‡"),t("strong",[s._v("åˆ†æžæºç ç†è§£åŽŸç†")]),s._v("çš„ä¹ æƒ¯.")]),s._v(" "),t("p",[s._v("å½“æ—¶, æˆ‘è‡ªå·±çš„æ„Ÿè§‰æ˜¯, å³ä½¿æˆ‘åªæ˜¯ä¸€ä¸ªå¼€å‘å·¥ç¨‹å¸ˆ, åªæ˜¯ MySQL çš„ç”¨æˆ·, åœ¨äº†è§£äº†ä¸€ä¸ªä¸ªç³»ç»Ÿæ¨¡å—çš„åŽŸç†åŽ, å†æ¥ä½¿ç”¨å®ƒ, æ„Ÿè§‰æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„. å½“åœ¨ä»£ç é‡Œå†™ä¸‹ä¸€è¡Œæ•°æ®åº“å‘½ä»¤çš„æ—¶å€™, æˆ‘å°±èƒ½æƒ³åˆ°å®ƒåœ¨æ•°æ®åº“ç«¯å°†æ€Žä¹ˆæ‰§è¡Œ, å®ƒçš„æ€§èƒ½æ˜¯æ€Žä¹ˆæ ·çš„, æ€Žæ ·å†™èƒ½è®©æˆ‘çš„åº”ç”¨ç¨‹åºè®¿é—®æ•°æ®åº“çš„æ€§èƒ½æœ€é«˜. è¿›ä¸€æ­¥, å“ªäº›æ•°æ®å¤„ç†è®©æ•°æ®åº“ç³»ç»Ÿæ¥åšæ€§èƒ½ä¼šæ›´å¥½, å“ªäº›æ•°æ®å¤„ç†åœ¨ç¼“å­˜é‡Œåšæ€§èƒ½ä¼šæ›´å¥½, æˆ‘å¿ƒé‡Œä¹Ÿä¼šæ›´æ¸…æ¥š. åœ¨å»ºè¡¨å’Œå»ºç´¢å¼•çš„æ—¶å€™, æˆ‘ä¹Ÿä¼šæ›´æœ‰æ„è¯†åœ°ä¸ºå°†æ¥çš„æŸ¥è¯¢ä¼˜åŒ–åšç»¼åˆè€ƒè™‘, æ¯”å¦‚ç¡®å®šæ˜¯å¦ä½¿ç”¨é€’å¢žä¸»é”®, ä¸»é”®çš„åˆ—æ€Žæ ·é€‰æ‹©, ç­‰ç­‰.")]),s._v(" "),t("p",[s._v("ä½†éšåŽæˆ‘åˆæœ‰äº†ä¸€ä¸ªæ–°çš„å›°æƒ‘, æˆ‘è§‰å¾—è‡ªå·±äº†è§£çš„ MySQL çŸ¥è¯†ç‚¹æ˜¯é›¶æ•£çš„, æ²¡æœ‰å½¢æˆç½‘ç»œ. äºŽæ˜¯è§£å†³å®Œä¸€ä¸ªé—®é¢˜åŽ, å¾ˆå®¹æ˜“å¿˜è®°. å†ç¢°åˆ°ç±»ä¼¼çš„é—®é¢˜, æˆ‘åˆå¾—å†ç¿»ä¸€æ¬¡ä»£ç .")]),s._v(" "),t("p",[s._v("æ‰€å¹¸åœ¨é˜¿é‡Œå·¥ä½œçš„æ—¶å€™, æˆ‘å‚ä¸Žäº†é˜¿é‡Œäº‘å…³ç³»åž‹æ•°æ®åº“æœåŠ¡å†…æ ¸çš„å¼€å‘, å¹¶ä¸”è´Ÿè´£å¼€å‘å¼€æºåˆ†æ”¯ AliSQL, è®©æˆ‘å¯¹ MySQL å†…æ ¸å’Œæºç æœ‰äº†æ›´æ·±å±‚æ¬¡çš„ç ”ç©¶å’Œç†è§£. åœ¨æœåŠ¡å†…éƒ¨å®¢æˆ·å’Œå…¬æœ‰äº‘å®¢æˆ·çš„è¿‡ç¨‹ä¸­, æˆ‘æœ‰æœºä¼šé¢å¯¹å’Œè§£å†³è¶³å¤Ÿå¤šçš„é—®é¢˜, å†é€šè¿‡æ‰‹å†Œè¿›è¡Œç³»ç»Ÿçš„å­¦ä¹ , ç®—æ˜¯æ¯”è¾ƒåŽå·åœ°å°† MySQL çš„çŸ¥è¯†ç½‘ç»œè¡¥äº†èµ·æ¥.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, åœ¨å›žé¡¾è¿™ä¸ªè¿‡ç¨‹çš„æ—¶å€™, æˆ‘çš„ç¬¬ä¸€ä¸ªæ„Ÿå—æ˜¯, "),t("strong",[s._v("å¦‚æžœä¸€å¼€å§‹å°±æœ‰ä¸€äº›ä»Žç†è®ºåˆ°å®žæˆ˜çš„ç³»ç»Ÿæ€§æŒ‡å¯¼")]),s._v(", é‚£è¯¥å¤šå¥½å•Š, ä¹Ÿè®¸æˆ‘å¯ä»¥å­¦ä¹ å¾—æ›´å¿«äº›.")]),s._v(" "),t("p",[s._v("äºŽæ˜¯, æˆ‘å¸Œæœ›è¿™ä¸ªä¸“æ èƒ½å¤Ÿå¸®åŠ©è¿™æ ·çš„ä¸€äº›å¼€å‘è€…: ä»–ä»¬æ­£åœ¨ä½¿ç”¨ MySQL, çŸ¥é“å¦‚ä½•å†™å‡ºé€»è¾‘æ­£ç¡®çš„ SQL è¯­å¥æ¥å®žçŽ°ä¸šåŠ¡ç›®æ ‡, å´ä¸ç¡®å®šè¿™ä¸ªè¯­å¥æ˜¯ä¸æ˜¯æœ€ä¼˜çš„; ä»–ä»¬å¬è¯´äº†ä¸€äº›ä½¿ç”¨æ•°æ®åº“çš„æœ€ä½³å®žè·µ, ä½†æ˜¯æ›´æƒ³äº†è§£ä¸ºä»€ä¹ˆè¿™ä¹ˆåš; ä»–ä»¬ä½¿ç”¨çš„æ•°æ®åº“å¶å°”ä¼šå‡ºé—®é¢˜, äºŸéœ€äº†è§£å¦‚ä½•æ›´å¿«é€Ÿ, æ›´å‡†ç¡®åœ°å®šä½é—®é¢˜, ç”šè‡³è‡ªå·±è§£å†³é—®é¢˜...")]),s._v(" "),t("p",[s._v("å› æ­¤, æˆ‘å¸Œæœ›è¿™ä¸ªä¸“æ èƒ½å¤Ÿæ¿€å‘å¼€å‘è€…å¯¹æ•°æ®åº“åŽŸç†çš„æŽ¢ç´¢æ¬², ä»Žè€Œæ›´å¥½åœ°ç†è§£å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜, æ›´èƒ½çŸ¥é“èƒŒåŽçš„ä¸ºä»€ä¹ˆ. æ‰€ä»¥"),t("strong",[s._v("æˆ‘ä¼šé€‰é‚£äº›å¹³æ—¶ä½¿ç”¨æ•°æ®åº“æ—¶é«˜é¢‘å‡ºçŽ°çš„çŸ¥è¯†, å¦‚äº‹åŠ¡, ç´¢å¼•, é”ç­‰å†…å®¹æž„æˆä¸“æ çš„ä¸»çº¿")]),s._v(". è¿™äº›ä¸»çº¿ä¸Šæ˜¯ä¸€ä¸ªä¸ªçš„çŸ¥è¯†ç‚¹. æ¯ä¸ªç‚¹å°±æ˜¯ä¸€ä¸ªæ¦‚å¿µ, ä¸€ä¸ªæœºåˆ¶æˆ–è€…ä¸€ä¸ªåŽŸç†è¯´æ˜Ž. åœ¨æ¯ä¸ªè¯´æ˜Žä¹‹åŽ, æˆ‘ä¼šå’Œä½ è®¨è®ºä¸€ä¸ªå®žè·µç›¸å…³çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("å¸Œæœ›èƒ½ä»¥è¿™æ ·çš„æ–¹å¼, è®©ä½ å¯¹ MySQL çš„å‡ æ¡ä¸»çº¿æœ‰ä¸€ä¸ªæ•´ä½“çš„è®¤è¯†, å¹¶ä¸”äº†è§£åŸºæœ¬æ¦‚å¿µ. åœ¨ä¹‹åŽçš„å®žè·µç¯‡ä¸­, æˆ‘ä¼šå¼•ç”¨åˆ°è¿™äº›ä¸»çº¿çš„çŸ¥è¯†èƒŒæ™¯, å¹¶ç€åŠ›è¯´æ˜Žå®ƒä»¬æ˜¯æ€Žæ ·æŒ‡å¯¼å®žè·µçš„. è¿™æ ·, **ä½ å¯ä»¥ä»Žç‚¹åˆ°çº¿, å†åˆ°é¢, å½¢æˆè‡ªå·±çš„ MySQL çŸ¥è¯†ç½‘ç»œ. ** â€‹â€‹")]),s._v(" "),t("h4",{attrs:{id:"_01-åŸºç¡€æž¶æž„-ä¸€æ¡sqlæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-åŸºç¡€æž¶æž„-ä¸€æ¡sqlæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„"}},[s._v("#")]),s._v(" 01-åŸºç¡€æž¶æž„:ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„?")]),s._v(" "),t("p",[s._v("è¿™æ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« , æˆ‘æƒ³æ¥èŠèŠ "),t("strong",[s._v("MySQL çš„åŸºç¡€æž¶æž„")]),s._v(". æˆ‘ä»¬ç»å¸¸è¯´, çœ‹ä¸€ä¸ªäº‹å„¿åƒä¸‡ä¸è¦ç›´æŽ¥é™·å…¥ç»†èŠ‚é‡Œ, ä½ åº”è¯¥å…ˆé¸Ÿçž°å…¶å…¨è²Œ, è¿™æ ·èƒ½å¤Ÿå¸®åŠ©ä½ ä»Žé«˜ç»´åº¦ç†è§£é—®é¢˜. å¯¹äºŽ MySQL çš„å­¦ä¹ ä¹Ÿæ˜¯è¿™æ ·. å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“, çœ‹åˆ°çš„é€šå¸¸éƒ½æ˜¯ä¸€ä¸ªæ•´ä½“. æ¯”å¦‚, ä½ æœ‰ä¸ªæœ€ç®€å•çš„è¡¨, è¡¨é‡Œåªæœ‰ä¸€ä¸ª ID å­—æ®µ, åœ¨æ‰§è¡Œä¸‹é¢è¿™ä¸ªæŸ¥è¯¢è¯­å¥æ—¶:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æˆ‘ä»¬çœ‹åˆ°çš„åªæ˜¯è¾“å…¥ä¸€æ¡è¯­å¥, è¿”å›žä¸€ä¸ªç»“æžœ, "),t("strong",[s._v("å´ä¸çŸ¥é“è¿™æ¡è¯­å¥åœ¨ MySQL å†…éƒ¨çš„æ‰§è¡Œè¿‡ç¨‹")]),s._v(".")]),s._v(" "),t("p",[s._v('æ‰€ä»¥ä»Šå¤©æŠŠ MySQL æ‹†è§£ä¸€ä¸‹, çœ‹çœ‹é‡Œé¢éƒ½æœ‰å“ªäº›"é›¶ä»¶", å¸Œæœ›å€Ÿç”±è¿™ä¸ªæ‹†è§£è¿‡ç¨‹, è®©ä½ å¯¹ MySQL æœ‰æ›´æ·±å…¥çš„ç†è§£. è¿™æ ·å½“ç¢°åˆ° MySQL çš„ä¸€äº›å¼‚å¸¸æˆ–è€…é—®é¢˜æ—¶, å°±èƒ½å¤Ÿç›´æˆ³æœ¬è´¨, æ›´ä¸ºå¿«é€Ÿåœ°å®šä½å¹¶è§£å†³é—®é¢˜.')]),s._v(" "),t("p",[s._v("ä¸‹é¢æˆ‘ç»™å‡ºçš„æ˜¯ "),t("strong",[s._v("MySQL çš„åŸºæœ¬æž¶æž„ç¤ºæ„å›¾")]),s._v(", ä»Žä¸­å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° SQL è¯­å¥åœ¨ MySQL çš„å„ä¸ªåŠŸèƒ½æ¨¡å—ä¸­çš„æ‰§è¡Œè¿‡ç¨‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f067d8bb1ea07fda3947dbd09b0d8f48-20230731161914-zq2pkqe.png",alt:"",title:"MySQLçš„é€»è¾‘æž¶æž„å›¾"}})]),s._v(" "),t("p",[s._v("å¤§ä½“æ¥è¯´, "),t("mark",[t("strong",[s._v("MySQL å¯ä»¥åˆ†ä¸º Server å±‚å’Œå­˜å‚¨å¼•æ“Žå±‚ä¸¤éƒ¨åˆ†")])]),s._v(".")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("Server å±‚åŒ…æ‹¬è¿žæŽ¥å™¨, æŸ¥è¯¢ç¼“å­˜, åˆ†æžå™¨, ä¼˜åŒ–å™¨, æ‰§è¡Œå™¨ç­‰, æ¶µç›– MySQL çš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½, ä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°(å¦‚æ—¥æœŸ, æ—¶é—´, æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰), æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“Žçš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®žçŽ°, æ¯”å¦‚å­˜å‚¨è¿‡ç¨‹, è§¦å‘å™¨, è§†å›¾ç­‰.")])])]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("è€Œå­˜å‚¨å¼•æ“Žå±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–")])]),s._v(". å…¶æž¶æž„æ¨¡å¼æ˜¯"),t("strong",[s._v("æ’ä»¶å¼")]),s._v("çš„, æ”¯æŒ InnoDB, MyISAM, Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“Ž.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“Žæ˜¯ InnoDB, å®ƒä»Ž MySQL 5.5.5 ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“Ž. æ‰§è¡Œ create table å»ºè¡¨çš„æ—¶å€™, å¦‚æžœä¸æŒ‡å®šå¼•æ“Žç±»åž‹, é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ InnoDB. ä¸è¿‡ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå­˜å‚¨å¼•æ“Žçš„ç±»åž‹æ¥é€‰æ‹©åˆ«çš„å¼•æ“Ž, æ¯”å¦‚åœ¨ create table è¯­å¥ä¸­ä½¿ç”¨ engine=memory, æ¥æŒ‡å®šä½¿ç”¨å†…å­˜å¼•æ“Žåˆ›å»ºè¡¨. ä¸åŒå­˜å‚¨å¼•æ“Žçš„è¡¨æ•°æ®å­˜å–æ–¹å¼ä¸åŒ, æ”¯æŒçš„åŠŸèƒ½ä¹Ÿä¸åŒ.")]),s._v(" "),t("p",[s._v("ä»Žå›¾ä¸­ä¸éš¾çœ‹å‡º, "),t("mark",[t("strong",[s._v("ä¸åŒçš„å­˜å‚¨å¼•æ“Žå…±ç”¨ä¸€ä¸ª Server å±‚, ä¹Ÿå°±æ˜¯ä»Žè¿žæŽ¥å™¨åˆ°æ‰§è¡Œå™¨çš„éƒ¨åˆ†")])]),s._v(". å¯ä»¥å…ˆå¯¹æ¯ä¸ªç»„ä»¶çš„åå­—æœ‰ä¸ªå°è±¡, æŽ¥ä¸‹æ¥ä¼šç»“åˆå¼€å¤´æåˆ°çš„é‚£æ¡ SQL è¯­å¥, å¸¦ä½ èµ°ä¸€éæ•´ä¸ªæ‰§è¡Œæµç¨‹, ä¾æ¬¡çœ‹ä¸‹æ¯ä¸ªç»„ä»¶çš„ä½œç”¨.")]),s._v(" "),t("h5",{attrs:{id:"è¿žæŽ¥å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿žæŽ¥å™¨"}},[s._v("#")]),s._v(" è¿žæŽ¥å™¨")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€æ­¥, "),t("strong",[s._v("ä¼šå…ˆè¿žæŽ¥åˆ°è¿™ä¸ªæ•°æ®åº“ä¸Š")]),s._v(", è¿™æ—¶å€™æŽ¥å¾…ä½ çš„å°±æ˜¯è¿žæŽ¥å™¨. "),t("mark",[t("strong",[s._v("è¿žæŽ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿žæŽ¥, èŽ·å–æƒé™, ç»´æŒå’Œç®¡ç†è¿žæŽ¥")])]),s._v(". è¿žæŽ¥å‘½ä»¤ä¸€èˆ¬æ˜¯è¿™ä¹ˆå†™çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h$ip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P$port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¾“å®Œå‘½ä»¤ä¹‹åŽ, å°±éœ€è¦åœ¨äº¤äº’å¯¹è¯é‡Œé¢è¾“å…¥å¯†ç . è™½ç„¶å¯†ç ä¹Ÿå¯ä»¥ç›´æŽ¥è·Ÿåœ¨ -p åŽé¢å†™åœ¨å‘½ä»¤è¡Œä¸­, ä½†è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´å¯†ç æ³„éœ². å¦‚æžœè¿žçš„æ˜¯ç”Ÿäº§æœåŠ¡å™¨, å¼ºçƒˆå»ºè®®ä¸è¦è¿™ä¹ˆåš.")]),s._v(" "),t("p",[s._v("è¿žæŽ¥å‘½ä»¤ä¸­çš„ mysql æ˜¯å®¢æˆ·ç«¯å·¥å…·, ç”¨æ¥è·ŸæœåŠ¡ç«¯å»ºç«‹è¿žæŽ¥. åœ¨å®Œæˆç»å…¸çš„ "),t("strong",[s._v("TCP æ¡æ‰‹")]),s._v("åŽ, "),t("strong",[s._v("è¿žæŽ¥å™¨å°±è¦å¼€å§‹è®¤è¯ä½ çš„èº«ä»½")]),s._v(", è¿™ä¸ªæ—¶å€™ç”¨çš„å°±æ˜¯è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç .")]),s._v(" "),t("ul",[t("li",[s._v('å¦‚æžœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹, ä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ª "Access denied for user" çš„é”™è¯¯, ç„¶åŽå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œ.')]),s._v(" "),t("li",[t("strong",[s._v("å¦‚æžœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡, è¿žæŽ¥å™¨ä¼šåˆ°æƒé™è¡¨é‡Œé¢æŸ¥å‡ºä½ æ‹¥æœ‰çš„æƒé™")]),s._v(". ä¹‹åŽè¿™ä¸ªè¿žæŽ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘, éƒ½å°†ä¾èµ–äºŽæ­¤æ—¶è¯»åˆ°çš„æƒé™.")])]),s._v(" "),t("p",[s._v("å› æ­¤, "),t("strong",[s._v("ä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿žæŽ¥åŽ, å³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹, ä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿žæŽ¥çš„æƒé™. ä¿®æ”¹å®ŒæˆåŽ, åªæœ‰å†æ–°å»ºçš„è¿žæŽ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿žæŽ¥å®ŒæˆåŽ, å¦‚æžœä½ æ²¡æœ‰åŽç»­çš„åŠ¨ä½œ, è¿™ä¸ªè¿žæŽ¥å°±å¤„äºŽ"),t("strong",[s._v("ç©ºé—²çŠ¶æ€")]),s._v(', ä½ å¯ä»¥åœ¨ show processlist å‘½ä»¤ä¸­çœ‹åˆ°å®ƒ. æ–‡æœ¬ä¸­è¿™ä¸ªå›¾æ˜¯ show processlist çš„ç»“æžœ, å…¶ä¸­çš„ Command åˆ—æ˜¾ç¤ºä¸º "Sleep" çš„è¿™ä¸€è¡Œ, å°±è¡¨ç¤ºçŽ°åœ¨ç³»ç»Ÿé‡Œé¢æœ‰ä¸€ä¸ªç©ºé—²è¿žæŽ¥.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/88d30b171fb3cd5fd9ac89c8d1001fb5-20230731161914-homvcqp.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("å®¢æˆ·ç«¯å¦‚æžœå¤ªé•¿æ—¶é—´æ²¡åŠ¨é™, è¿žæŽ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€. è¿™ä¸ªæ—¶é—´æ˜¯ç”±å‚æ•° wait_timeout æŽ§åˆ¶çš„, é»˜è®¤å€¼æ˜¯ 8 å°æ—¶")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æžœåœ¨è¿žæŽ¥è¢«æ–­å¼€ä¹‹åŽ, å®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚çš„è¯, å°±ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯æé†’: Lost connection to MySQL server during query. è¿™æ—¶å€™å¦‚æžœè¦ç»§ç»­, å°±éœ€è¦"),t("strong",[s._v("é‡è¿ž")]),s._v(", ç„¶åŽå†æ‰§è¡Œè¯·æ±‚äº†.")]),s._v(" "),t("p",[s._v("æ•°æ®åº“é‡Œé¢, "),t("strong",[s._v("é•¿è¿žæŽ¥æ˜¯æŒ‡è¿žæŽ¥æˆåŠŸåŽ, å¦‚æžœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚, åˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿žæŽ¥")]),s._v(". çŸ­è¿žæŽ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿žæŽ¥, ä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ª. "),t("mark",[t("strong",[s._v("å»ºç«‹è¿žæŽ¥çš„è¿‡ç¨‹é€šå¸¸æ˜¯æ¯”è¾ƒå¤æ‚çš„, æ‰€ä»¥å»ºè®®åœ¨ä½¿ç”¨ä¸­è¦å°½é‡å‡å°‘å»ºç«‹è¿žæŽ¥çš„åŠ¨ä½œ, ä¹Ÿå°±æ˜¯å°½é‡ä½¿ç”¨é•¿è¿žæŽ¥")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æ˜¯å…¨éƒ¨ä½¿ç”¨é•¿è¿žæŽ¥åŽ, ä½ å¯èƒ½ä¼šå‘çŽ°, æœ‰äº›æ—¶å€™ MySQL å ç”¨å†…å­˜æ¶¨å¾—ç‰¹åˆ«å¿«, è¿™æ˜¯å› ä¸º MySQL åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿žæŽ¥å¯¹è±¡é‡Œé¢çš„. è¿™äº›èµ„æºä¼šåœ¨è¿žæŽ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾. æ‰€ä»¥å¦‚æžœé•¿è¿žæŽ¥ç´¯ç§¯ä¸‹æ¥, å¯èƒ½å¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§, è¢«ç³»ç»Ÿå¼ºè¡Œæ€æŽ‰(OOM), ä»ŽçŽ°è±¡çœ‹å°±æ˜¯ MySQL å¼‚å¸¸é‡å¯äº†.")]),s._v(" "),t("p",[s._v("æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢? å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆ.")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å®šæœŸæ–­å¼€é•¿è¿žæŽ¥")]),s._v(". ä½¿ç”¨ä¸€æ®µæ—¶é—´, æˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åŽ, æ–­å¼€è¿žæŽ¥, ä¹‹åŽè¦æŸ¥è¯¢å†é‡è¿ž.")]),s._v(" "),t("li",[s._v("å¦‚æžœç”¨çš„æ˜¯ MySQL 5.7 æˆ–æ›´æ–°ç‰ˆæœ¬, å¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåŽ, é€šè¿‡æ‰§è¡Œ "),t("strong",[s._v("mysql_reset_connection")]),s._v(" æ¥é‡æ–°åˆå§‹åŒ–è¿žæŽ¥èµ„æº. è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿žå’Œé‡æ–°åšæƒé™éªŒè¯, ä½†æ˜¯ä¼šå°†è¿žæŽ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€.")])]),s._v(" "),t("h5",{attrs:{id:"æŸ¥è¯¢ç¼“å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥è¯¢ç¼“å­˜"}},[s._v("#")]),s._v(" æŸ¥è¯¢ç¼“å­˜")]),s._v(" "),t("p",[s._v("è¿žæŽ¥å»ºç«‹å®ŒæˆåŽ, å°±å¯ä»¥æ‰§è¡Œ select è¯­å¥äº†. æ‰§è¡Œé€»è¾‘å°±ä¼šæ¥åˆ°ç¬¬äºŒæ­¥: "),t("strong",[s._v("æŸ¥è¯¢ç¼“å­˜")]),s._v(".")]),s._v(" "),t("p",[s._v("MySQL æ‹¿åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚åŽ, ä¼šå…ˆåˆ°æŸ¥è¯¢ç¼“å­˜çœ‹çœ‹, ä¹‹å‰æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡è¿™æ¡è¯­å¥. ä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æžœå¯èƒ½ä¼šä»¥ "),t("strong",[s._v("key-value")]),s._v(" å¯¹çš„å½¢å¼, è¢«"),t("strong",[s._v("ç›´æŽ¥ç¼“å­˜åœ¨å†…å­˜")]),s._v("ä¸­. "),t("strong",[s._v("key æ˜¯æŸ¥è¯¢çš„è¯­å¥, value æ˜¯æŸ¥è¯¢çš„ç»“æžœ")]),s._v(". å¦‚æžœæŸ¥è¯¢èƒ½å¤Ÿç›´æŽ¥åœ¨è¿™ä¸ªç¼“å­˜ä¸­æ‰¾åˆ° key, é‚£ä¹ˆè¿™ä¸ª value å°±ä¼šè¢«ç›´æŽ¥è¿”å›žç»™å®¢æˆ·ç«¯. å¦‚æžœè¯­å¥ä¸åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­, å°±ä¼šç»§ç»­åŽé¢çš„æ‰§è¡Œé˜¶æ®µ. "),t("strong",[s._v("æ‰§è¡Œå®ŒæˆåŽ, æ‰§è¡Œç»“æžœä¼šè¢«å­˜å…¥æŸ¥è¯¢ç¼“å­˜ä¸­")]),s._v(". å¯ä»¥çœ‹åˆ°, å¦‚æžœæŸ¥è¯¢å‘½ä¸­ç¼“å­˜, MySQL ä¸éœ€è¦æ‰§è¡ŒåŽé¢çš„å¤æ‚æ“ä½œ, å°±å¯ä»¥ç›´æŽ¥è¿”å›žç»“æžœ, è¿™ä¸ªæ•ˆçŽ‡ä¼šå¾ˆé«˜.")]),s._v(" "),t("p",[s._v("**ä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä¼šå»ºè®®ä¸è¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜, ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºŽåˆ©. **")]),s._v(" "),t("p",[t("strong",[s._v("æŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéžå¸¸é¢‘ç¹, åªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°, è¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©º")]),s._v(". å› æ­¤å¾ˆå¯èƒ½ä½ è´¹åŠ²åœ°æŠŠç»“æžœå­˜èµ·æ¥, è¿˜æ²¡ä½¿ç”¨, å°±è¢«ä¸€ä¸ªæ›´æ–°å…¨æ¸…ç©ºäº†. "),t("strong",[s._v("å¯¹äºŽæ›´æ–°åŽ‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´, æŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­çŽ‡ä¼šéžå¸¸ä½Ž")]),s._v(". é™¤éžä½ çš„ä¸šåŠ¡å°±æ˜¯æœ‰ä¸€å¼ é™æ€è¡¨, å¾ˆé•¿æ—¶é—´æ‰ä¼šæ›´æ–°ä¸€æ¬¡. æ¯”å¦‚ä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨, é‚£è¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜.")]),s._v(" "),t("p",[s._v('å¥½åœ¨ MySQL ä¹Ÿæä¾›äº†è¿™ç§ "æŒ‰éœ€ä½¿ç”¨" çš„æ–¹å¼. ä½ å¯ä»¥å°†å‚æ•° '),t("strong",[s._v("query_cache_type")]),s._v(" è®¾ç½®æˆ DEMAND, è¿™æ ·å¯¹äºŽé»˜è®¤çš„ SQL è¯­å¥éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜. è€Œå¯¹äºŽä½ ç¡®å®šè¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„è¯­å¥, å¯ä»¥ç”¨ SQL_CACHE æ˜¾å¼æŒ‡å®š, åƒä¸‹é¢è¿™ä¸ªè¯­å¥ä¸€æ ·:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" SQL_CACHE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, "),t("strong",[s._v("MySQL 8.0 ç‰ˆæœ¬ç›´æŽ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æŽ‰")]),s._v("äº†, ä¹Ÿå°±æ˜¯è¯´ 8.0 å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†.")]),s._v(" "),t("h5",{attrs:{id:"åˆ†æžå™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†æžå™¨"}},[s._v("#")]),s._v(" åˆ†æžå™¨")]),s._v(" "),t("p",[s._v("å¦‚æžœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜, å°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†. é¦–å…ˆ MySQL éœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆ, å› æ­¤"),t("strong",[s._v("éœ€è¦å¯¹ SQL è¯­å¥åšè§£æž")]),s._v(".")]),s._v(" "),t("p",[s._v('åˆ†æžå™¨å…ˆä¼šåš "'),t("mark",[t("strong",[s._v("è¯æ³•åˆ†æž")])]),s._v('". ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡ SQL è¯­å¥, '),t("strong",[s._v("MySQL éœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆ, ä»£è¡¨ä»€ä¹ˆ")]),s._v('. MySQL ä»Žè¾“å…¥çš„ "select" è¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥, è¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥. å®ƒä¹Ÿè¦æŠŠå­—ç¬¦ä¸² "T" è¯†åˆ«æˆ "è¡¨å T", æŠŠå­—ç¬¦ä¸² "ID" è¯†åˆ«æˆ "åˆ— ID".')]),s._v(" "),t("p",[s._v('åšå®Œäº†è¿™äº›è¯†åˆ«ä»¥åŽ, å°±è¦åš "'),t("mark",[t("strong",[s._v("è¯­æ³•åˆ†æž")])]),s._v('". æ ¹æ®è¯æ³•åˆ†æžçš„ç»“æžœ, è¯­æ³•åˆ†æžå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™, åˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ª SQL è¯­å¥'),t("strong",[s._v("æ˜¯å¦æ»¡è¶³ MySQL è¯­æ³•")]),s._v('. å¦‚æžœä½ çš„è¯­å¥ä¸å¯¹, å°±ä¼šæ”¶åˆ° "You have an error in your SQL syntax" çš„é”™è¯¯æé†’, æ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥ select å°‘æ‰“äº†å¼€å¤´çš„å­—æ¯ "s".')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" elect "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ERROR "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1064")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": You have an error "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" your "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SQL")]),s._v(" syntax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("check")]),s._v(" the manual that corresponds "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" your MySQL server version "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("right")]),s._v(" syntax "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" near "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'elect * from t where ID=1'")]),s._v(" at line "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v('ä¸€èˆ¬è¯­æ³•é”™è¯¯ä¼šæç¤ºç¬¬ä¸€ä¸ªå‡ºçŽ°é”™è¯¯çš„ä½ç½®, æ‰€ä»¥è¦å…³æ³¨çš„æ˜¯ç´§æŽ¥ "use near" çš„å†…å®¹.')]),s._v(" "),t("h5",{attrs:{id:"ä¼˜åŒ–å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŒ–å™¨"}},[s._v("#")]),s._v(" ä¼˜åŒ–å™¨")]),s._v(" "),t("p",[s._v("ç»è¿‡äº†åˆ†æžå™¨, MySQL å°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†. "),t("strong",[s._v("åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰, è¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("ä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™, å†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•; æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è”(join)çš„æ—¶å€™, å†³å®šå„ä¸ªè¡¨çš„è¿žæŽ¥é¡ºåº")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚æ‰§è¡Œä¸‹é¢è¿™æ ·çš„è¯­å¥, è¿™ä¸ªè¯­å¥æ˜¯æ‰§è¡Œä¸¤ä¸ªè¡¨çš„ join:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("æ—¢å¯ä»¥å…ˆä»Žè¡¨ t1 é‡Œé¢å–å‡º c=10 çš„è®°å½•çš„ ID å€¼, å†æ ¹æ® ID å€¼å…³è”åˆ°è¡¨ t2, å†åˆ¤æ–­ t2 é‡Œé¢ d çš„å€¼æ˜¯å¦ç­‰äºŽ 20.")]),s._v(" "),t("li",[s._v("ä¹Ÿå¯ä»¥å…ˆä»Žè¡¨ t2 é‡Œé¢å–å‡º d=20 çš„è®°å½•çš„ ID å€¼, å†æ ¹æ® ID å€¼å…³è”åˆ° t1, å†åˆ¤æ–­ t1 é‡Œé¢ c çš„å€¼æ˜¯å¦ç­‰äºŽ 10.")])]),s._v(" "),t("p",[t("strong",[s._v("è¿™ä¸¤ç§æ‰§è¡Œæ–¹æ³•çš„é€»è¾‘ç»“æžœæ˜¯ä¸€æ ·çš„, ä½†æ˜¯æ‰§è¡Œçš„æ•ˆçŽ‡ä¼šæœ‰ä¸åŒ, è€Œä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªæ–¹æ¡ˆ.")])]),s._v(" "),t("p",[s._v("ä¼˜åŒ–å™¨é˜¶æ®µå®ŒæˆåŽ, è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆå°±ç¡®å®šä¸‹æ¥äº†, ç„¶åŽ"),t("strong",[s._v("è¿›å…¥æ‰§è¡Œå™¨é˜¶æ®µ")]),s._v(". å¦‚æžœä½ è¿˜æœ‰ä¸€äº›ç–‘é—®, æ¯”å¦‚ä¼˜åŒ–å™¨æ˜¯æ€Žä¹ˆé€‰æ‹©ç´¢å¼•çš„, æœ‰æ²¡æœ‰å¯èƒ½é€‰æ‹©é”™ç­‰ç­‰, åŽé¢ä¼šå•ç‹¬å±•å¼€è¯´æ˜Žä¼˜åŒ–å™¨çš„å†…å®¹.")]),s._v(" "),t("h5",{attrs:{id:"æ‰§è¡Œå™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ‰§è¡Œå™¨"}},[s._v("#")]),s._v(" æ‰§è¡Œå™¨")]),s._v(" "),t("p",[s._v("MySQL é€šè¿‡åˆ†æžå™¨çŸ¥é“äº†ä½ è¦åšä»€ä¹ˆ, é€šè¿‡ä¼˜åŒ–å™¨çŸ¥é“äº†è¯¥æ€Žä¹ˆåš, äºŽæ˜¯å°±"),t("strong",[s._v("è¿›å…¥äº†æ‰§è¡Œå™¨é˜¶æ®µ, å¼€å§‹æ‰§è¡Œè¯­å¥")]),s._v(".")]),s._v(" "),t("p",[s._v("å¼€å§‹æ‰§è¡Œçš„æ—¶å€™, è¦å…ˆåˆ¤æ–­ä¸€ä¸‹å¯¹è¿™ä¸ªè¡¨ T æœ‰æ²¡æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™, å¦‚æžœæ²¡æœ‰, å°±ä¼šè¿”å›žæ²¡æœ‰æƒé™çš„é”™è¯¯, å¦‚ä¸‹æ‰€ç¤º (åœ¨å·¥ç¨‹å®žçŽ°ä¸Š, å¦‚æžœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜, ä¼šåœ¨æŸ¥è¯¢ç¼“å­˜è¿”å›žç»“æžœçš„æ—¶å€™, åšæƒé™éªŒè¯. æŸ¥è¯¢ä¹Ÿä¼šåœ¨ä¼˜åŒ–å™¨ä¹‹å‰è°ƒç”¨ precheck éªŒè¯æƒé™).")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ERROR "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1142")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" command denied "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'T'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("mark",[t("strong",[s._v("å¦‚æžœæœ‰æƒé™, å°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œ. æ‰“å¼€è¡¨çš„æ—¶å€™, æ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“Žå®šä¹‰, åŽ»ä½¿ç”¨è¿™ä¸ªå¼•æ“Žæä¾›çš„æŽ¥å£")])]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­çš„è¡¨ T ä¸­, ID å­—æ®µæ²¡æœ‰ç´¢å¼•, é‚£ä¹ˆæ‰§è¡Œå™¨çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("è°ƒç”¨ InnoDB å¼•æ“ŽæŽ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œ, åˆ¤æ–­ ID å€¼æ˜¯ä¸æ˜¯ 10, å¦‚æžœä¸æ˜¯åˆ™è·³è¿‡, å¦‚æžœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æžœé›†ä¸­;")]),s._v(" "),t("li",[s._v('è°ƒç”¨å¼•æ“ŽæŽ¥å£å– "ä¸‹ä¸€è¡Œ", é‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘, ç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åŽä¸€è¡Œ.')]),s._v(" "),t("li",[s._v("æ‰§è¡Œå™¨å°†ä¸Šè¿°éåŽ†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æžœé›†è¿”å›žç»™å®¢æˆ·ç«¯.")])]),s._v(" "),t("p",[s._v("è‡³æ­¤, è¿™ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†.")]),s._v(" "),t("p",[t("strong",[s._v('å¯¹äºŽæœ‰ç´¢å¼•çš„è¡¨, æ‰§è¡Œçš„é€»è¾‘ä¹Ÿå·®ä¸å¤š. ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ˜¯"å–æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€è¡Œ"è¿™ä¸ªæŽ¥å£, ä¹‹åŽå¾ªçŽ¯å–"æ»¡è¶³æ¡ä»¶çš„ä¸‹ä¸€è¡Œ"è¿™ä¸ªæŽ¥å£, è¿™äº›æŽ¥å£éƒ½æ˜¯å¼•æ“Žä¸­å·²ç»å®šä¹‰å¥½çš„.')])]),s._v(" "),t("p",[s._v("ä½ ä¼šåœ¨æ•°æ®åº“çš„"),t("strong",[s._v("æ…¢æŸ¥è¯¢æ—¥å¿—")]),s._v("ä¸­çœ‹åˆ°ä¸€ä¸ª "),t("strong",[s._v("rows_examined")]),s._v(" çš„å­—æ®µ, è¡¨ç¤ºè¿™ä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰«æäº†å¤šå°‘è¡Œ. è¿™ä¸ªå€¼å°±æ˜¯åœ¨æ‰§è¡Œå™¨æ¯æ¬¡è°ƒç”¨å¼•æ“ŽèŽ·å–æ•°æ®è¡Œçš„æ—¶å€™ç´¯åŠ çš„.")]),s._v(" "),t("p",[s._v("åœ¨æœ‰äº›åœºæ™¯ä¸‹, æ‰§è¡Œå™¨è°ƒç”¨ä¸€æ¬¡, åœ¨å¼•æ“Žå†…éƒ¨åˆ™æ‰«æäº†å¤šè¡Œ, å› æ­¤**å¼•æ“Žæ‰«æè¡Œæ•°è·Ÿ rows_examined å¹¶ä¸æ˜¯å®Œå…¨ç›¸åŒçš„. ** åŽé¢ä¼šä¸“é—¨æ¥è®²å­˜å‚¨å¼•æ“Žçš„å†…éƒ¨æœºåˆ¶, é‡Œé¢ä¼šæœ‰è¯¦ç»†çš„è¯´æ˜Ž.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL çš„é€»è¾‘æž¶æž„, å¸Œæœ›ä½ å¯¹ä¸€ä¸ª SQL è¯­å¥å®Œæ•´æ‰§è¡Œæµç¨‹çš„å„ä¸ªé˜¶æ®µæœ‰äº†ä¸€ä¸ªåˆæ­¥çš„å°è±¡. ç”±äºŽç¯‡å¹…çš„é™åˆ¶, è¿™é‡Œåªæ˜¯ç”¨ä¸€ä¸ªæŸ¥è¯¢çš„ä¾‹å­å°†å„ä¸ªçŽ¯èŠ‚è¿‡äº†ä¸€é.")]),s._v(" "),t("h4",{attrs:{id:"_02-æ—¥å¿—ç³»ç»Ÿ-ä¸€æ¡sqlæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_02-æ—¥å¿—ç³»ç»Ÿ-ä¸€æ¡sqlæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„"}},[s._v("#")]),s._v(" 02-æ—¥å¿—ç³»ç»Ÿ:ä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„?")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº†ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹, å¹¶ä»‹ç»äº†æ‰§è¡Œè¿‡ç¨‹ä¸­æ¶‰åŠçš„å¤„ç†æ¨¡å—. "),t("mark",[t("strong",[s._v("ä¸€æ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸€èˆ¬æ˜¯ç»è¿‡è¿žæŽ¥å™¨, åˆ†æžå™¨, ä¼˜åŒ–å™¨, æ‰§è¡Œå™¨ç­‰åŠŸèƒ½æ¨¡å—, æœ€åŽåˆ°è¾¾å­˜å‚¨å¼•æ“Ž")])]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, "),t("strong",[s._v("ä¸€æ¡æ›´æ–°è¯­å¥çš„æ‰§è¡Œæµç¨‹åˆæ˜¯æ€Žæ ·")]),s._v("çš„å‘¢? ä½ å¯èƒ½ç»å¸¸å¬ DBA åŒäº‹è¯´, MySQL å¯ä»¥æ¢å¤åˆ°åŠä¸ªæœˆå†…ä»»æ„ä¸€ç§’çš„çŠ¶æ€, æƒŠå¹çš„åŒæ—¶, ä½ æ˜¯ä¸æ˜¯å¿ƒä¸­ä¹Ÿä¼šä¸å…ä¼šå¥½å¥‡, è¿™æ˜¯æ€Žæ ·åšåˆ°çš„å‘¢?")]),s._v(" "),t("p",[s._v("è¿˜æ˜¯ä»Žä¸€ä¸ªè¡¨çš„ä¸€æ¡æ›´æ–°è¯­å¥è¯´èµ·, ä¸‹é¢æ˜¯è¿™ä¸ªè¡¨çš„åˆ›å»ºè¯­å¥, è¿™ä¸ªè¡¨æœ‰ä¸€ä¸ªä¸»é”® ID å’Œä¸€ä¸ªæ•´åž‹å­—æ®µ c:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æžœè¦å°† ID=2 è¿™ä¸€è¡Œçš„å€¼åŠ  1, SQL è¯­å¥å°±ä¼šè¿™ä¹ˆå†™:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å‰é¢ä»‹ç»è¿‡ SQL è¯­å¥åŸºæœ¬çš„æ‰§è¡Œé“¾è·¯, è¿™é‡Œå†æŠŠé‚£å¼ å›¾æ‹¿è¿‡æ¥, å…ˆç®€å•çœ‹çœ‹è¿™ä¸ªå›¾å›žé¡¾ä¸‹. é¦–å…ˆå¯ä»¥ç¡®å®šçš„è¯´, æŸ¥è¯¢è¯­å¥çš„é‚£ä¸€å¥—æµç¨‹, "),t("strong",[s._v("æ›´æ–°è¯­å¥ä¹Ÿæ˜¯åŒæ ·ä¼šèµ°ä¸€é")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f067d8bb1ea07fda3947dbd09b0d8f48-20230731161914-1xcgs6b.png",alt:"",title:"MySQLçš„é€»è¾‘æž¶æž„å›¾"}})]),s._v(" "),t("p",[s._v("ä½ æ‰§è¡Œè¯­å¥å‰è¦å…ˆè¿žæŽ¥æ•°æ®åº“, è¿™æ˜¯è¿žæŽ¥å™¨çš„å·¥ä½œ.")]),s._v(" "),t("p",[s._v("å‰é¢è¯´è¿‡, åœ¨ä¸€ä¸ªè¡¨ä¸Šæœ‰æ›´æ–°çš„æ—¶å€™, è·Ÿè¿™ä¸ªè¡¨æœ‰å…³çš„æŸ¥è¯¢ç¼“å­˜ä¼šå¤±æ•ˆ, æ‰€ä»¥"),t("strong",[s._v("è¿™æ¡è¯­å¥å°±ä¼šæŠŠè¡¨ T ä¸Šæ‰€æœ‰ç¼“å­˜ç»“æžœéƒ½æ¸…ç©º")]),s._v(". è¿™ä¹Ÿå°±æ˜¯ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„åŽŸå› .")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, åˆ†æžå™¨ä¼šé€šè¿‡è¯æ³•å’Œè¯­æ³•è§£æžçŸ¥é“è¿™æ˜¯ä¸€æ¡æ›´æ–°è¯­å¥. ä¼˜åŒ–å™¨å†³å®šè¦ä½¿ç”¨ ID è¿™ä¸ªç´¢å¼•. ç„¶åŽæ‰§è¡Œå™¨è´Ÿè´£å…·ä½“æ‰§è¡Œ, æ‰¾åˆ°è¿™ä¸€è¡Œ, ç„¶åŽæ›´æ–°.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("ä¸ŽæŸ¥è¯¢æµç¨‹ä¸ä¸€æ ·çš„æ˜¯, æ›´æ–°æµç¨‹è¿˜æ¶‰åŠä¸¤ä¸ªé‡è¦çš„æ—¥å¿—æ¨¡å—, å®ƒä»¬æ­£æ˜¯æœ¬èŠ‚çš„ä¸»è§’: redo log(é‡åšæ—¥å¿—)å’Œ binlog(å½’æ¡£æ—¥å¿—)")])]),s._v(" . å¦‚æžœæŽ¥è§¦ MySQL, é‚£è¿™ä¸¤ä¸ªè¯è‚¯å®šæ˜¯ç»•ä¸è¿‡çš„, åŽé¢çš„å†…å®¹é‡Œä¹Ÿä¼šä¸æ–­åœ°å¼ºè°ƒ. ä¸è¿‡è¯è¯´å›žæ¥, redo log å’Œ binlog åœ¨è®¾è®¡ä¸Šæœ‰å¾ˆå¤šæœ‰æ„æ€çš„åœ°æ–¹, è¿™äº›è®¾è®¡æ€è·¯ä¹Ÿå¯ä»¥ç”¨åˆ°ä½ è‡ªå·±çš„ç¨‹åºé‡Œ.")]),s._v(" "),t("h5",{attrs:{id:"é‡è¦çš„æ—¥å¿—æ¨¡å—-redo-log"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡è¦çš„æ—¥å¿—æ¨¡å—-redo-log"}},[s._v("#")]),s._v(" é‡è¦çš„æ—¥å¿—æ¨¡å—:redo log")]),s._v(" "),t("p",[s._v("åœ¨ã€Šå­”ä¹™å·±ã€‹ä¸­, é…’åº—æŽŒæŸœæœ‰ä¸€ä¸ªç²‰æ¿, ä¸“é—¨ç”¨æ¥è®°å½•å®¢äººçš„èµŠè´¦è®°å½•. å¦‚æžœèµŠè´¦çš„äººä¸å¤š, é‚£ä¹ˆä»–å¯ä»¥æŠŠé¡¾å®¢åå’Œè´¦ç›®å†™åœ¨æ¿ä¸Š. ä½†å¦‚æžœèµŠè´¦çš„äººå¤šäº†, ç²‰æ¿æ€»ä¼šæœ‰è®°ä¸ä¸‹çš„æ—¶å€™, è¿™ä¸ªæ—¶å€™æŽŒæŸœä¸€å®šè¿˜æœ‰ä¸€ä¸ªä¸“é—¨è®°å½•èµŠè´¦çš„è´¦æœ¬.")]),s._v(" "),t("p",[s._v("å¦‚æžœæœ‰äººè¦èµŠè´¦æˆ–è€…è¿˜è´¦çš„è¯, æŽŒæŸœä¸€èˆ¬æœ‰ä¸¤ç§åšæ³•:")]),s._v(" "),t("ul",[t("li",[s._v("ä¸€ç§åšæ³•æ˜¯ç›´æŽ¥æŠŠè´¦æœ¬ç¿»å‡ºæ¥, æŠŠè¿™æ¬¡èµŠçš„è´¦åŠ ä¸ŠåŽ»æˆ–è€…æ‰£é™¤æŽ‰;")]),s._v(" "),t("li",[s._v("å¦ä¸€ç§åšæ³•æ˜¯å…ˆåœ¨ç²‰æ¿ä¸Šè®°ä¸‹è¿™æ¬¡çš„è´¦, ç­‰æ‰“çƒŠä»¥åŽå†æŠŠè´¦æœ¬ç¿»å‡ºæ¥æ ¸ç®—.")])]),s._v(" "),t("p",[s._v("åœ¨ç”Ÿæ„çº¢ç«æŸœå°å¾ˆå¿™æ—¶, æŽŒæŸœä¸€å®šä¼šé€‰æ‹©åŽè€…, å› ä¸ºå‰è€…æ“ä½œå®žåœ¨æ˜¯å¤ªéº»çƒ¦äº†. é¦–å…ˆå¾—æ‰¾åˆ°è¿™ä¸ªäººçš„èµŠè´¦æ€»é¢é‚£æ¡è®°å½•. ä½ æƒ³æƒ³, å¯†å¯†éº»éº»å‡ åé¡µ, æŽŒæŸœè¦æ‰¾åˆ°é‚£ä¸ªåå­—, å¯èƒ½è¿˜å¾—å¸¦ä¸Šè€èŠ±é•œæ…¢æ…¢æ‰¾, æ‰¾åˆ°ä¹‹åŽå†æ‹¿å‡ºç®—ç›˜è®¡ç®—, æœ€åŽå†å°†ç»“æžœå†™å›žåˆ°è´¦æœ¬ä¸Š. è¿™æ•´ä¸ªè¿‡ç¨‹æƒ³æƒ³éƒ½éº»çƒ¦. ç›¸æ¯”ä¹‹ä¸‹, è¿˜æ˜¯å…ˆåœ¨ç²‰æ¿ä¸Šè®°ä¸€ä¸‹æ–¹ä¾¿. å¦‚æžœæŽŒæŸœæ²¡æœ‰ç²‰æ¿çš„å¸®åŠ©, æ¯æ¬¡è®°è´¦éƒ½å¾—ç¿»è´¦æœ¬, æ•ˆçŽ‡æ˜¯ä¸æ˜¯ä½Žå¾—è®©äººéš¾ä»¥å¿å—?")]),s._v(" "),t("p",[s._v("åŒæ ·, åœ¨ MySQL é‡Œä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜, "),t("strong",[s._v("å¦‚æžœæ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜, ç„¶åŽç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•, ç„¶åŽå†æ›´æ–°, æ•´ä¸ªè¿‡ç¨‹ IO æˆæœ¬, æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜. ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, MySQL çš„è®¾è®¡è€…å°±ç”¨äº†ç±»ä¼¼é…’åº—æŽŒæŸœç²‰æ¿çš„æ€è·¯æ¥æå‡æ›´æ–°æ•ˆçŽ‡")]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œç²‰æ¿å’Œè´¦æœ¬é…åˆçš„æ•´ä¸ªè¿‡ç¨‹, å…¶å®ž"),t("mark",[t("strong",[s._v("å°±æ˜¯ MySQL é‡Œç»å¸¸è¯´åˆ°çš„ WAL æŠ€æœ¯, WAL çš„å…¨ç§°æ˜¯ Write-Ahead Logging, å®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—, å†å†™ç£ç›˜, ä¹Ÿå°±æ˜¯å…ˆå†™ç²‰æ¿, ç­‰ä¸å¿™çš„æ—¶å€™å†å†™è´¦æœ¬")])]),s._v(".")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("å…·ä½“æ¥è¯´, å½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™, InnoDB å¼•æ“Žå°±ä¼šå…ˆæŠŠè®°å½•å†™åˆ° redo log(ç²‰æ¿)é‡Œé¢, å¹¶æ›´æ–°å†…å­˜, è¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†. åŒæ—¶ InnoDB å¼•æ“Žä¼šåœ¨é€‚å½“çš„æ—¶å€™, å°†è¿™ä¸ªæ“ä½œè®°å½•æ›´æ–°åˆ°ç£ç›˜é‡Œé¢, è€Œè¿™ä¸ªæ›´æ–°å¾€å¾€æ˜¯åœ¨ç³»ç»Ÿæ¯”è¾ƒç©ºé—²çš„æ—¶å€™åš, è¿™å°±åƒæ‰“çƒŠä»¥åŽæŽŒæŸœåšçš„äº‹.")])])]),s._v(" "),t("p",[s._v("å¦‚æžœä»Šå¤©èµŠè´¦çš„ä¸å¤š, æŽŒæŸœå¯ä»¥ç­‰æ‰“çƒŠåŽå†æ•´ç†. ä½†å¦‚æžœæŸå¤©èµŠè´¦çš„ç‰¹åˆ«å¤š, ç²‰æ¿å†™æ»¡äº†, åˆæ€Žä¹ˆåŠžå‘¢? è¿™ä¸ªæ—¶å€™æŽŒæŸœåªå¥½æ”¾ä¸‹æ‰‹ä¸­çš„æ´»å„¿, æŠŠç²‰æ¿ä¸­çš„ä¸€éƒ¨åˆ†èµŠè´¦è®°å½•æ›´æ–°åˆ°è´¦æœ¬ä¸­, ç„¶åŽæŠŠè¿™äº›è®°å½•ä»Žç²‰æ¿ä¸Šæ“¦æŽ‰, ä¸ºè®°æ–°è´¦è…¾å‡ºç©ºé—´.")]),s._v(" "),t("p",[s._v("ä¸Žæ­¤ç±»ä¼¼, "),t("strong",[s._v("InnoDB çš„ redo log æ˜¯å›ºå®šå¤§å°çš„")]),s._v(', æ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„ 4 ä¸ªæ–‡ä»¶, æ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯ 1GB, é‚£ä¹ˆè¿™å— "ç²‰æ¿" æ€»å…±å°±å¯ä»¥è®°å½• 4GB çš„æ“ä½œ. ä»Žå¤´å¼€å§‹å†™, '),t("strong",[s._v("å†™åˆ°æœ«å°¾å°±åˆå›žåˆ°å¼€å¤´å¾ªçŽ¯å†™")]),s._v(", å¦‚ä¸‹é¢è¿™ä¸ªå›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6d00c78cfb258dbb6583020e88d3c720-20230731161914-gfwmshp.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("write pos æ˜¯å½“å‰è®°å½•çš„ä½ç½®, ä¸€è¾¹å†™ä¸€è¾¹åŽç§»")]),s._v(", å†™åˆ°ç¬¬ 3 å·æ–‡ä»¶æœ«å°¾åŽå°±å›žåˆ° 0 å·æ–‡ä»¶å¼€å¤´. "),t("strong",[s._v("checkpoint æ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®, ä¹Ÿæ˜¯å¾€åŽæŽ¨ç§»å¹¶ä¸”å¾ªçŽ¯çš„, æ“¦é™¤è®°å½•å‰è¦æŠŠè®°å½•æ›´æ–°åˆ°æ•°æ®æ–‡ä»¶")]),s._v(".")]),s._v(" "),t("p",[s._v('write pos å’Œ checkpoint ä¹‹é—´çš„æ˜¯ "ç²‰æ¿" ä¸Šè¿˜ç©ºç€çš„éƒ¨åˆ†, å¯ä»¥ç”¨æ¥è®°å½•æ–°çš„æ“ä½œ. å¦‚æžœ write pos è¿½ä¸Š checkpoint, è¡¨ç¤º "ç²‰æ¿" æ»¡äº†, è¿™æ—¶å€™ä¸èƒ½å†æ‰§è¡Œæ–°çš„æ›´æ–°, '),t("strong",[s._v("å¾—åœä¸‹æ¥å…ˆæ“¦æŽ‰ä¸€äº›è®°å½•")]),s._v(", æŠŠ checkpoint æŽ¨è¿›ä¸€ä¸‹.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("æœ‰äº† redo log, InnoDB å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯, ä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±, è¿™ä¸ªèƒ½åŠ›ç§°ä¸º crash-safe.")])])]),s._v(" "),t("p",[s._v("è¦ç†è§£ crash-safe è¿™ä¸ªæ¦‚å¿µ, å¯ä»¥æƒ³æƒ³å‰é¢èµŠè´¦è®°å½•çš„ä¾‹å­. åªè¦èµŠè´¦è®°å½•è®°åœ¨äº†ç²‰æ¿ä¸Šæˆ–å†™åœ¨äº†è´¦æœ¬ä¸Š, ä¹‹åŽå³ä½¿æŽŒæŸœå¿˜è®°äº†, æ¯”å¦‚çªç„¶åœä¸šå‡ å¤©, æ¢å¤ç”Ÿæ„åŽä¾ç„¶å¯ä»¥é€šè¿‡è´¦æœ¬å’Œç²‰æ¿ä¸Šçš„æ•°æ®æ˜Žç¡®èµŠè´¦è´¦ç›®.")]),s._v(" "),t("h5",{attrs:{id:"é‡è¦çš„æ—¥å¿—æ¨¡å—-binlog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡è¦çš„æ—¥å¿—æ¨¡å—-binlog"}},[s._v("#")]),s._v(" é‡è¦çš„æ—¥å¿—æ¨¡å—:binlog")]),s._v(" "),t("p",[s._v("å‰é¢è®²è¿‡, MySQL æ•´ä½“æ¥çœ‹, å…¶å®žå°±æœ‰ä¸¤å—: "),t("strong",[s._v("ä¸€å—æ˜¯ Server å±‚, å®ƒä¸»è¦åšçš„æ˜¯ MySQL åŠŸèƒ½å±‚é¢çš„äº‹æƒ…; è¿˜æœ‰ä¸€å—æ˜¯å¼•æ“Žå±‚, è´Ÿè´£å­˜å‚¨ç›¸å…³çš„å…·ä½“äº‹å®œ")]),s._v(". ä¸Šé¢èŠåˆ°çš„ç²‰æ¿ "),t("mark",[t("strong",[s._v("redo log æ˜¯ InnoDB å¼•æ“Žç‰¹æœ‰çš„æ—¥å¿—, è€Œ Server å±‚ä¹Ÿæœ‰è‡ªå·±çš„æ—¥å¿—, ç§°ä¸º binlog(å½’æ¡£æ—¥å¿—)")])]),s._v(" .")]),s._v(" "),t("p",[s._v("ä½ è‚¯å®šä¼šé—®, ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä»½æ—¥å¿—å‘¢?")]),s._v(" "),t("p",[s._v("å› ä¸º"),t("strong",[s._v("æœ€å¼€å§‹ MySQL é‡Œå¹¶æ²¡æœ‰ InnoDB å¼•æ“Ž")]),s._v(". MySQL è‡ªå¸¦çš„å¼•æ“Žæ˜¯ MyISAM, ä½†æ˜¯ MyISAM æ²¡æœ‰ crash-safe çš„èƒ½åŠ›, "),t("strong",[s._v("binlog æ—¥å¿—åªèƒ½ç”¨äºŽå½’æ¡£")]),s._v(". è€Œ InnoDB æ˜¯å¦ä¸€ä¸ªå…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥ MySQL çš„, æ—¢ç„¶åªä¾é  binlog æ˜¯æ²¡æœ‰ crash-safe èƒ½åŠ›çš„, "),t("strong",[s._v("æ‰€ä»¥ InnoDB ä½¿ç”¨å¦å¤–ä¸€å¥—æ—¥å¿—ç³»ç»Ÿ--ä¹Ÿå°±æ˜¯ redo log æ¥å®žçŽ° crash-safe èƒ½åŠ›")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸¤ç§æ—¥å¿—æœ‰ä»¥ä¸‹ä¸‰ç‚¹ä¸åŒ.")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("redo log æ˜¯ InnoDB å¼•æ“Žç‰¹æœ‰çš„; binlog æ˜¯ MySQL çš„ Server å±‚å®žçŽ°çš„, æ‰€æœ‰å¼•æ“Žéƒ½å¯ä»¥ä½¿ç”¨.")])]),s._v(" "),t("li",[t("strong",[s._v('redo log æ˜¯ç‰©ç†æ—¥å¿—, è®°å½•çš„æ˜¯ "åœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹"; binlog æ˜¯é€»è¾‘æ—¥å¿—, è®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŽŸå§‹é€»è¾‘, æ¯”å¦‚ "ç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1".')])]),s._v(" "),t("li",[t("strong",[s._v('redo log æ˜¯å¾ªçŽ¯å†™çš„, ç©ºé—´å›ºå®šä¼šç”¨å®Œ; binlog æ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„. "è¿½åŠ å†™" æ˜¯æŒ‡ binlog æ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åŽä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª, å¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—.')])])]),s._v(" "),t("p",[s._v("æœ‰äº†å¯¹è¿™ä¸¤ä¸ªæ—¥å¿—çš„æ¦‚å¿µæ€§ç†è§£, "),t("strong",[s._v("å†æ¥çœ‹æ‰§è¡Œå™¨å’Œ InnoDB å¼•æ“Žåœ¨æ‰§è¡Œè¿™ä¸ªç®€å•çš„ update è¯­å¥æ—¶çš„å†…éƒ¨æµç¨‹")]),s._v(".")]),s._v(" "),t("ol",[t("li",[s._v("æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“Žå– ID=2 è¿™ä¸€è¡Œ. ID æ˜¯ä¸»é”®, å¼•æ“Žç›´æŽ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œ. å¦‚æžœ ID=2 è¿™ä¸€è¡Œæ‰€åœ¨çš„"),t("strong",[s._v("æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­, å°±ç›´æŽ¥è¿”å›žç»™æ‰§è¡Œå™¨; å¦åˆ™éœ€è¦å…ˆä»Žç£ç›˜è¯»å…¥å†…å­˜, ç„¶åŽå†è¿”å›ž")]),s._v(".")]),s._v(" "),t("li",[s._v("æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“Žç»™çš„è¡Œæ•°æ®, æŠŠè¿™ä¸ªå€¼åŠ ä¸Š 1, æ¯”å¦‚åŽŸæ¥æ˜¯ N, çŽ°åœ¨å°±æ˜¯ N+1, å¾—åˆ°"),t("strong",[s._v("æ–°çš„ä¸€è¡Œæ•°æ®, å†è°ƒç”¨å¼•æ“ŽæŽ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("å¼•æ“Žå°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­, åŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ° redo log é‡Œé¢, æ­¤æ—¶ redo log å¤„äºŽ prepare çŠ¶æ€. ç„¶åŽå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†, éšæ—¶å¯ä»¥æäº¤äº‹åŠ¡")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„ binlog, å¹¶æŠŠ binlog å†™å…¥ç£ç›˜")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“Žçš„æäº¤äº‹åŠ¡æŽ¥å£, å¼•æ“ŽæŠŠåˆšåˆšå†™å…¥çš„ redo log æ”¹æˆæäº¤(commit)çŠ¶æ€, æ›´æ–°å®Œæˆ.")])])]),s._v(" "),t("p",[s._v("è¿™é‡Œç»™å‡ºè¿™ä¸ª update è¯­å¥çš„æ‰§è¡Œæµç¨‹å›¾, å›¾ä¸­æµ…è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨ "),t("strong",[s._v("InnoDB")]),s._v(" å†…éƒ¨æ‰§è¡Œçš„, æ·±è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œçš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8bddb008c032b1714cacefdf9686d09b-20230731161914-yauxhbm.png",alt:"",title:"updateè¯­å¥æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v('ä½ å¯èƒ½æ³¨æ„åˆ°äº†, æœ€åŽä¸‰æ­¥çœ‹ä¸ŠåŽ»æœ‰ç‚¹"ç»•", å°† redo log çš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤: '),t("strong",[s._v("prepare å’Œ commit")]),s._v(', è¿™å°±æ˜¯ "'),t("strong",[s._v("ä¸¤é˜¶æ®µæäº¤")]),s._v('".')]),s._v(" "),t("h5",{attrs:{id:"ä¸¤é˜¶æ®µæäº¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸¤é˜¶æ®µæäº¤"}},[s._v("#")]),s._v(" ä¸¤é˜¶æ®µæäº¤")]),s._v(" "),t("p",[s._v('ä¸ºä»€ä¹ˆå¿…é¡»æœ‰"ä¸¤é˜¶æ®µæäº¤"å‘¢? è¿™æ˜¯ä¸ºäº†'),t("mark",[t("strong",[s._v("è®©ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´")])]),s._v(". è¦è¯´æ˜Žè¿™ä¸ªé—®é¢˜, å¾—ä»Žæ–‡ç« å¼€å¤´çš„é‚£ä¸ªé—®é¢˜è¯´èµ·: **æ€Žæ ·è®©æ•°æ®åº“æ¢å¤åˆ°åŠä¸ªæœˆå†…ä»»æ„ä¸€ç§’çš„çŠ¶æ€? **")]),s._v(" "),t("p",[s._v('å‰é¢è¯´è¿‡, binlog ä¼šè®°å½•æ‰€æœ‰çš„é€»è¾‘æ“ä½œ, å¹¶ä¸”æ˜¯é‡‡ç”¨ "è¿½åŠ å†™" çš„å½¢å¼. å¦‚æžœä½ çš„ DBA æ‰¿è¯ºè¯´åŠä¸ªæœˆå†…å¯ä»¥æ¢å¤, '),t("strong",[s._v("é‚£ä¹ˆå¤‡ä»½ç³»ç»Ÿä¸­ä¸€å®šä¼šä¿å­˜æœ€è¿‘åŠä¸ªæœˆçš„æ‰€æœ‰ binlog, åŒæ—¶ç³»ç»Ÿä¼šå®šæœŸåšæ•´åº“å¤‡ä»½")]),s._v('. è¿™é‡Œçš„ "å®šæœŸ" å–å†³äºŽç³»ç»Ÿçš„é‡è¦æ€§, å¯ä»¥æ˜¯ä¸€å¤©ä¸€å¤‡, ä¹Ÿå¯ä»¥æ˜¯ä¸€å‘¨ä¸€å¤‡.')]),s._v(" "),t("p",[s._v("å½“éœ€è¦æ¢å¤åˆ°æŒ‡å®šçš„æŸä¸€ç§’æ—¶, æ¯”å¦‚æŸå¤©ä¸‹åˆä¸¤ç‚¹å‘çŽ°ä¸­åˆåäºŒç‚¹æœ‰ä¸€æ¬¡è¯¯åˆ è¡¨, éœ€è¦æ‰¾å›žæ•°æ®, é‚£å¯ä»¥è¿™ä¹ˆåš:")]),s._v(" "),t("ul",[t("li",[s._v("é¦–å…ˆ, æ‰¾åˆ°æœ€è¿‘çš„ä¸€æ¬¡å…¨é‡å¤‡ä»½, å¦‚æžœè¿æ°”å¥½, å¯èƒ½å°±æ˜¯æ˜¨å¤©æ™šä¸Šçš„ä¸€ä¸ªå¤‡ä»½, ä»Žè¿™ä¸ªå¤‡ä»½æ¢å¤åˆ°ä¸´æ—¶åº“;")]),s._v(" "),t("li",[s._v("ç„¶åŽ, "),t("strong",[s._v("ä»Žå¤‡ä»½çš„æ—¶é—´ç‚¹å¼€å§‹, å°†å¤‡ä»½çš„ binlog ä¾æ¬¡å–å‡ºæ¥, é‡æ”¾åˆ°ä¸­åˆè¯¯åˆ è¡¨ä¹‹å‰çš„é‚£ä¸ªæ—¶åˆ»")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™æ ·ä¸´æ—¶åº“å°±è·Ÿè¯¯åˆ ä¹‹å‰çš„çº¿ä¸Šåº“ä¸€æ ·äº†, ç„¶åŽå¯ä»¥æŠŠè¡¨æ•°æ®ä»Žä¸´æ—¶åº“å–å‡ºæ¥, æŒ‰éœ€è¦æ¢å¤åˆ°çº¿ä¸Šåº“åŽ».")]),s._v(" "),t("p",[s._v("è¯´å®Œäº†æ•°æ®æ¢å¤è¿‡ç¨‹, å†å›žæ¥è¯´è¯´, "),t("mark",[t("strong",[s._v('ä¸ºä»€ä¹ˆæ—¥å¿—éœ€è¦ "ä¸¤é˜¶æ®µæäº¤"')])]),s._v(" . è¿™é‡Œä¸å¦¨ç”¨åè¯æ³•æ¥è¿›è¡Œè§£é‡Š. "),t("strong",[s._v("ç”±äºŽ redo log å’Œ binlog æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„é€»è¾‘, å¦‚æžœä¸ç”¨ä¸¤é˜¶æ®µæäº¤, è¦ä¹ˆå°±æ˜¯å…ˆå†™å®Œ redo log å†å†™ binlog, æˆ–è€…é‡‡ç”¨åè¿‡æ¥çš„é¡ºåº")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¥çœ‹çœ‹è¿™ä¸¤ç§æ–¹å¼ä¼šæœ‰ä»€ä¹ˆé—®é¢˜.")]),s._v(" "),t("p",[s._v("ä»ç„¶ç”¨å‰é¢çš„ update è¯­å¥æ¥åšä¾‹å­. å‡è®¾å½“å‰ ID=2 çš„è¡Œ, å­—æ®µ c çš„å€¼æ˜¯ 0, "),t("strong",[s._v("å†å‡è®¾æ‰§è¡Œ update è¯­å¥è¿‡ç¨‹ä¸­åœ¨å†™å®Œç¬¬ä¸€ä¸ªæ—¥å¿—åŽ, ç¬¬äºŒä¸ªæ—¥å¿—è¿˜æ²¡æœ‰å†™å®ŒæœŸé—´å‘ç”Ÿäº† crash")]),s._v(", ä¼šå‡ºçŽ°ä»€ä¹ˆæƒ…å†µå‘¢?")]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v("å…ˆå†™ redo log åŽå†™ binlog")])]),s._v(". å‡è®¾åœ¨ redo log å†™å®Œ, binlog è¿˜æ²¡æœ‰å†™å®Œçš„æ—¶å€™, MySQL è¿›ç¨‹å¼‚å¸¸é‡å¯. ç”±äºŽå‰é¢è¯´è¿‡çš„, redo log å†™å®Œä¹‹åŽ, ç³»ç»Ÿå³ä½¿å´©æºƒ, ä»ç„¶èƒ½å¤ŸæŠŠæ•°æ®æ¢å¤å›žæ¥, æ‰€ä»¥æ¢å¤åŽè¿™ä¸€è¡Œ c çš„å€¼æ˜¯ 1. ä½†æ˜¯ç”±äºŽ binlog æ²¡å†™å®Œå°± crash äº†, "),t("strong",[s._v("è¿™æ—¶å€™ binlog é‡Œé¢å°±æ²¡æœ‰è®°å½•è¿™ä¸ªè¯­å¥")]),s._v(". å› æ­¤ä¹‹åŽå¤‡ä»½æ—¥å¿—çš„æ—¶å€™, å­˜èµ·æ¥çš„ binlog é‡Œé¢å°±æ²¡æœ‰è¿™æ¡è¯­å¥. ç„¶åŽå¦‚æžœéœ€è¦ç”¨è¿™ä¸ª binlog æ¥æ¢å¤ä¸´æ—¶åº“çš„è¯, ç”±äºŽè¿™ä¸ªè¯­å¥çš„ binlog ä¸¢å¤±, è¿™ä¸ª"),t("strong",[s._v("ä¸´æ—¶åº“å°±ä¼šå°‘äº†è¿™ä¸€æ¬¡æ›´æ–°")]),s._v(", æ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œ c çš„å€¼å°±æ˜¯ 0, ä¸ŽåŽŸåº“çš„å€¼ä¸åŒ.")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("å…ˆå†™ binlog åŽå†™ redo log")])]),s._v(". å¦‚æžœåœ¨ binlog å†™å®Œä¹‹åŽ crash, "),t("strong",[s._v("ç”±äºŽ redo log è¿˜æ²¡å†™")]),s._v(", å´©æºƒæ¢å¤ä»¥åŽè¿™ä¸ª"),t("strong",[s._v("äº‹åŠ¡æ— æ•ˆçš„")]),s._v(', æ‰€ä»¥è¿™ä¸€è¡Œ c çš„å€¼æ˜¯ 0. ä½†æ˜¯ binlog é‡Œé¢å·²ç»è®°å½•äº† "æŠŠ c ä»Ž 0 æ”¹æˆ 1" è¿™ä¸ªæ—¥å¿—. æ‰€ä»¥, åœ¨ä¹‹åŽ'),t("strong",[s._v("ç”¨ binlog æ¥æ¢å¤çš„æ—¶å€™å°±å¤šäº†ä¸€ä¸ªäº‹åŠ¡å‡ºæ¥")]),s._v(", æ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œ c çš„å€¼å°±æ˜¯ 1, ä¸ŽåŽŸåº“çš„å€¼ä¸åŒ.")])]),s._v(" "),t("p",[t("strong",[s._v('å¯ä»¥çœ‹åˆ°, å¦‚æžœä¸ä½¿ç”¨ "ä¸¤é˜¶æ®µæäº¤", é‚£ä¹ˆæ•°æ®åº“çš„çŠ¶æ€å°±æœ‰å¯èƒ½å’Œç”¨å®ƒçš„æ—¥å¿—æ¢å¤å‡ºæ¥çš„åº“çš„çŠ¶æ€ä¸ä¸€è‡´.')])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè¯´, è¿™ä¸ªæ¦‚çŽ‡æ˜¯ä¸æ˜¯å¾ˆä½Ž, å¹³æ—¶ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåŠ¨ä¸åŠ¨å°±éœ€è¦æ¢å¤ä¸´æ—¶åº“çš„åœºæ™¯å‘€? å…¶å®žä¸æ˜¯çš„, ä¸åªæ˜¯è¯¯æ“ä½œåŽéœ€è¦ç”¨è¿™ä¸ªè¿‡ç¨‹æ¥æ¢å¤æ•°æ®. "),t("mark",[t("strong",[s._v('å½“éœ€è¦æ‰©å®¹çš„æ—¶å€™, ä¹Ÿå°±æ˜¯éœ€è¦å†å¤šæ­å»ºä¸€äº›å¤‡åº“æ¥å¢žåŠ ç³»ç»Ÿçš„è¯»èƒ½åŠ›çš„æ—¶å€™, çŽ°åœ¨å¸¸è§çš„åšæ³•ä¹Ÿæ˜¯ç”¨å…¨é‡å¤‡ä»½åŠ ä¸Šåº”ç”¨ binlog æ¥å®žçŽ°çš„, è¿™ä¸ª "ä¸ä¸€è‡´" å°±ä¼šå¯¼è‡´ä½ çš„çº¿ä¸Šå‡ºçŽ°ä¸»ä»Žæ•°æ®åº“ä¸ä¸€è‡´çš„æƒ…å†µ. ç®€å•è¯´, redo log å’Œ binlog éƒ½å¯ä»¥ç”¨äºŽè¡¨ç¤ºäº‹åŠ¡çš„æäº¤çŠ¶æ€, è€Œä¸¤é˜¶æ®µæäº¤å°±æ˜¯è®©è¿™ä¸¤ä¸ªçŠ¶æ€ä¿æŒé€»è¾‘ä¸Šçš„ä¸€è‡´')])]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-2"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL é‡Œé¢æœ€é‡è¦çš„ä¸¤ä¸ªæ—¥å¿—, å³"),t("strong",[s._v("ç‰©ç†æ—¥å¿— redo log å’Œé€»è¾‘æ—¥å¿— binlog")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("redo log ç”¨äºŽä¿è¯ crash-safe èƒ½åŠ›")]),s._v(". "),t("strong",[s._v("innodb_flush_log_at_trx_commit")]),s._v(" è¿™ä¸ªå‚æ•°è®¾ç½®æˆ 1 çš„æ—¶å€™, è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„ redo log éƒ½ç›´æŽ¥æŒä¹…åŒ–åˆ°ç£ç›˜. è¿™ä¸ªå‚æ•°å»ºè®®"),t("strong",[s._v("è®¾ç½®æˆ 1")]),s._v(", è¿™æ ·å¯ä»¥ä¿è¯ MySQL å¼‚å¸¸é‡å¯ä¹‹åŽæ•°æ®ä¸ä¸¢å¤±.")]),s._v(" "),t("p",[t("strong",[s._v("sync_binlog è¿™ä¸ªå‚æ•°è®¾ç½®æˆ 1 çš„æ—¶å€™, è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„ binlog éƒ½æŒä¹…åŒ–åˆ°ç£ç›˜")]),s._v(". è¿™ä¸ªå‚æ•°ä¹Ÿå»ºè®®è®¾ç½®æˆ 1, è¿™æ ·å¯ä»¥ä¿è¯ MySQL å¼‚å¸¸é‡å¯ä¹‹åŽ binlog ä¸ä¸¢å¤±.")]),s._v(" "),t("p",[s._v('æ­¤å¤–è¿˜ä»‹ç»äº†ä¸Ž MySQL æ—¥å¿—ç³»ç»Ÿå¯†åˆ‡ç›¸å…³çš„ "ä¸¤é˜¶æ®µæäº¤". '),t("strong",[s._v("ä¸¤é˜¶æ®µæäº¤æ˜¯è·¨ç³»ç»Ÿç»´æŒæ•°æ®é€»è¾‘ä¸€è‡´æ€§æ—¶å¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ¡ˆ")]),s._v(", å³ä½¿ä½ ä¸åšæ•°æ®åº“å†…æ ¸å¼€å‘, æ—¥å¸¸å¼€å‘ä¸­ä¹Ÿæœ‰å¯èƒ½ä¼šç”¨åˆ°.")]),s._v(" "),t("h4",{attrs:{id:"_03-äº‹åŠ¡éš”ç¦»-ä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_03-äº‹åŠ¡éš”ç¦»-ä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§"}},[s._v("#")]),s._v(" 03-äº‹åŠ¡éš”ç¦»:ä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§?")]),s._v(" "),t("p",[s._v("æåˆ°äº‹åŠ¡, ä½ è‚¯å®šä¸é™Œç”Ÿ, å’Œæ•°æ®åº“æ‰“äº¤é“çš„æ—¶å€™, æ€»æ˜¯ä¼šç”¨åˆ°äº‹åŠ¡. æœ€ç»å…¸çš„ä¾‹å­å°±æ˜¯è½¬è´¦, ä½ è¦ç»™æœ‹å‹å°çŽ‹è½¬ 100 å—é’±, è€Œæ­¤æ—¶ä½ çš„é“¶è¡Œå¡åªæœ‰ 100 å—é’±.")]),s._v(" "),t("p",[s._v("è½¬è´¦è¿‡ç¨‹å…·ä½“åˆ°ç¨‹åºé‡Œä¼šæœ‰ä¸€ç³»åˆ—çš„æ“ä½œ, æ¯”å¦‚æŸ¥è¯¢ä½™é¢, åšåŠ å‡æ³•, æ›´æ–°ä½™é¢ç­‰, è¿™äº›æ“ä½œå¿…é¡»"),t("strong",[s._v("ä¿è¯æ˜¯ä¸€ä½“")]),s._v('çš„, ä¸ç„¶ç­‰ç¨‹åºæŸ¥å®Œä¹‹åŽ, è¿˜æ²¡åšå‡æ³•ä¹‹å‰, ä½ è¿™ 100 å—é’±, å®Œå…¨å¯ä»¥å€Ÿç€è¿™ä¸ªæ—¶é—´å·®å†æŸ¥ä¸€æ¬¡, ç„¶åŽå†ç»™å¦å¤–ä¸€ä¸ªæœ‹å‹è½¬è´¦, å¦‚æžœé“¶è¡Œè¿™ä¹ˆæ•´, ä¸å°±ä¹±äº†ä¹ˆ? è¿™æ—¶å°±è¦ç”¨åˆ° "äº‹åŠ¡" è¿™ä¸ªæ¦‚å¿µäº†.')]),s._v(" "),t("p",[s._v("ç®€å•æ¥è¯´, "),t("mark",[t("strong",[s._v("äº‹åŠ¡å°±æ˜¯è¦ä¿è¯ä¸€ç»„æ•°æ®åº“æ“ä½œ, è¦ä¹ˆå…¨éƒ¨æˆåŠŸ, è¦ä¹ˆå…¨éƒ¨å¤±è´¥")])]),s._v(". åœ¨ MySQL ä¸­, "),t("mark",[t("strong",[s._v("äº‹åŠ¡æ”¯æŒæ˜¯åœ¨å¼•æ“Žå±‚å®žçŽ°çš„")])]),s._v(". å› ä¸º MySQL æ˜¯ä¸€ä¸ªæ”¯æŒå¤šå¼•æ“Žçš„ç³»ç»Ÿ, ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“Žéƒ½æ”¯æŒäº‹åŠ¡. æ¯”å¦‚ MySQL åŽŸç”Ÿçš„ MyISAM å¼•æ“Žå°±ä¸æ”¯æŒäº‹åŠ¡, è¿™ä¹Ÿæ˜¯ MyISAM è¢« InnoDB å–ä»£çš„é‡è¦åŽŸå› ä¹‹ä¸€.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä¼šä»¥ InnoDB ä¸ºä¾‹, å‰–æž MySQL åœ¨äº‹åŠ¡æ”¯æŒæ–¹é¢çš„ç‰¹å®šå®žçŽ°, å¹¶åŸºäºŽåŽŸç†ç»™å‡ºç›¸åº”çš„å®žè·µå»ºè®®, å¸Œæœ›è¿™äº›æ¡ˆä¾‹èƒ½åŠ æ·±ä½ å¯¹ MySQL äº‹åŠ¡åŽŸç†çš„ç†è§£.")]),s._v(" "),t("h5",{attrs:{id:"éš”ç¦»æ€§ä¸Žéš”ç¦»çº§åˆ«"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#éš”ç¦»æ€§ä¸Žéš”ç¦»çº§åˆ«"}},[s._v("#")]),s._v(" éš”ç¦»æ€§ä¸Žéš”ç¦»çº§åˆ«")]),s._v(" "),t("p",[s._v("æåˆ°äº‹åŠ¡, ä½ è‚¯å®šä¼šæƒ³åˆ° "),t("strong",[s._v("ACID")]),s._v('(Atomicity, Consistency, Isolation, Durability, å³åŽŸå­æ€§, ä¸€è‡´æ€§, éš”ç¦»æ€§, æŒä¹…æ€§), ä»Šå¤©å°±æ¥è¯´è¯´å…¶ä¸­ I, ä¹Ÿå°±æ˜¯ "'),t("strong",[s._v("éš”ç¦»æ€§")]),s._v('".')]),s._v(" "),t("p",[s._v("å½“æ•°æ®åº“ä¸Šæœ‰"),t("strong",[s._v("å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œ")]),s._v('çš„æ—¶å€™, å°±å¯èƒ½å‡ºçŽ°è„è¯»(dirty read), ä¸å¯é‡å¤è¯»(non-repeatable read), å¹»è¯»(phantom read)çš„é—®é¢˜, ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜, å°±æœ‰äº† "éš”ç¦»çº§åˆ«" çš„æ¦‚å¿µ.')]),s._v(" "),t("p",[s._v("åœ¨è°ˆéš”ç¦»çº§åˆ«ä¹‹å‰, é¦–å…ˆè¦çŸ¥é“, "),t("strong",[s._v("éš”ç¦»å¾—è¶Šä¸¥å®ž, æ•ˆçŽ‡å°±ä¼šè¶Šä½Ž")]),s._v(". å› æ­¤å¾ˆå¤šæ—¶å€™, éƒ½è¦åœ¨äºŒè€…ä¹‹é—´å¯»æ‰¾ä¸€ä¸ªå¹³è¡¡ç‚¹. "),t("strong",[s._v("SQL æ ‡å‡†çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒ…æ‹¬: è¯»æœªæäº¤(read uncommitted), è¯»æäº¤(read committed), å¯é‡å¤è¯»(repeatable read)å’Œä¸²è¡ŒåŒ–(serializable)")]),s._v(" . ä¸‹é¢æˆ‘é€ä¸€ä¸ºä½ è§£é‡Š:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("è¯»æœªæäº¤")]),s._v("æ˜¯æŒ‡, ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶, å®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°.")]),s._v(" "),t("li",[t("strong",[s._v("è¯»æäº¤")]),s._v("æ˜¯æŒ‡, ä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åŽ, å®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°.")]),s._v(" "),t("li",[t("strong",[s._v("å¯é‡å¤è¯»")]),s._v("æ˜¯æŒ‡, ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®, æ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„. å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹, æœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„.")]),s._v(" "),t("li",[t("strong",[s._v("ä¸²è¡ŒåŒ–")]),s._v(', é¡¾åæ€ä¹‰æ˜¯å¯¹äºŽåŒä¸€è¡Œè®°å½•, "å†™" ä¼šåŠ  "å†™é”", "è¯»" ä¼šåŠ  "è¯»é”". å½“å‡ºçŽ°è¯»å†™é”å†²çªçš„æ—¶å€™, åŽè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆ, æ‰èƒ½ç»§ç»­æ‰§è¡Œ.')])]),s._v(" "),t("p",[s._v('å…¶ä¸­ "è¯»æäº¤" å’Œ "å¯é‡å¤è¯»" æ¯”è¾ƒéš¾ç†è§£, æ‰€ä»¥ç”¨ä¸€ä¸ªä¾‹å­è¯´æ˜Žè¿™å‡ ç§éš”ç¦»çº§åˆ«. å‡è®¾æ•°æ®è¡¨ T ä¸­åªæœ‰ä¸€åˆ—, å…¶ä¸­ä¸€è¡Œçš„å€¼ä¸º 1, ä¸‹é¢æ˜¯'),t("strong",[s._v("æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œä¸¤ä¸ªäº‹åŠ¡çš„è¡Œä¸º")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/69cbef91e9a6f9f797e24e712891849f-20230731161914-ztlln99.png",alt:""}})]),s._v(" "),t("p",[s._v("æ¥çœ‹çœ‹åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹, äº‹åŠ¡ A ä¼šæœ‰å“ªäº›ä¸åŒçš„è¿”å›žç»“æžœ, ä¹Ÿå°±æ˜¯å›¾é‡Œé¢ "),t("strong",[s._v("V1, V2, V3 çš„è¿”å›žå€¼")]),s._v("åˆ†åˆ«æ˜¯ä»€ä¹ˆ.")]),s._v(" "),t("ul",[t("li",[s._v('è‹¥éš”ç¦»çº§åˆ«æ˜¯ "è¯»æœªæäº¤", åˆ™ V1 çš„å€¼å°±æ˜¯ 2. è¿™æ—¶å€™äº‹åŠ¡ B è™½ç„¶è¿˜æ²¡æœ‰æäº¤, ä½†æ˜¯ç»“æžœå·²ç»è¢« A çœ‹åˆ°äº†. å› æ­¤ V2, V3 ä¹Ÿéƒ½æ˜¯ 2.')]),s._v(" "),t("li",[s._v('è‹¥éš”ç¦»çº§åˆ«æ˜¯ "è¯»æäº¤", åˆ™ V1 æ˜¯ 1, '),t("strong",[s._v("V2 çš„å€¼æ˜¯ 2")]),s._v(". äº‹åŠ¡ B çš„æ›´æ–°åœ¨æäº¤åŽæ‰èƒ½è¢« A çœ‹åˆ°. æ‰€ä»¥ V3 çš„å€¼ä¹Ÿæ˜¯ 2.")]),s._v(" "),t("li",[s._v('è‹¥éš”ç¦»çº§åˆ«æ˜¯ "'),t("strong",[s._v("å¯é‡å¤è¯»")]),s._v('", åˆ™ '),t("strong",[s._v("V1, V2 æ˜¯ 1, V3 æ˜¯ 2")]),s._v(". ä¹‹æ‰€ä»¥ V2 è¿˜æ˜¯ 1, éµå¾ªçš„å°±æ˜¯è¿™ä¸ªè¦æ±‚: "),t("strong",[s._v("äº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´çœ‹åˆ°çš„æ•°æ®å‰åŽå¿…é¡»æ˜¯ä¸€è‡´çš„")]),s._v(".")]),s._v(" "),t("li",[s._v('è‹¥éš”ç¦»çº§åˆ«æ˜¯ "ä¸²è¡ŒåŒ–", åˆ™åœ¨äº‹åŠ¡ B æ‰§è¡Œ "å°† 1 æ”¹æˆ 2" çš„æ—¶å€™, ä¼šè¢«'),t("strong",[s._v("é”ä½")]),s._v(". ç›´åˆ°äº‹åŠ¡ A æäº¤åŽ, äº‹åŠ¡ B æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œ. æ‰€ä»¥ä»Ž A çš„è§’åº¦çœ‹,  V1, V2 å€¼æ˜¯ 1, V3 çš„å€¼æ˜¯ 2.")])]),s._v(" "),t("p",[s._v("åœ¨å®žçŽ°ä¸Š, æ•°æ®åº“é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ª"),t("strong",[s._v("è§†å›¾")]),s._v(", è®¿é—®çš„æ—¶å€™ä»¥è§†å›¾çš„é€»è¾‘ç»“æžœä¸ºå‡†. "),t("strong",[s._v('åœ¨"å¯é‡å¤è¯»"éš”ç¦»çº§åˆ«ä¸‹, è¿™ä¸ªè§†å›¾æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºçš„, æ•´ä¸ªäº‹åŠ¡å­˜åœ¨æœŸé—´éƒ½ç”¨è¿™ä¸ªè§†å›¾')]),s._v('. åœ¨ "è¯»æäº¤" éš”ç¦»çº§åˆ«ä¸‹, è¿™ä¸ªè§†å›¾æ˜¯åœ¨æ¯ä¸ª SQL è¯­å¥å¼€å§‹æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºçš„. è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, "è¯»æœªæäº¤" éš”ç¦»çº§åˆ«ä¸‹ç›´æŽ¥è¿”å›žè®°å½•ä¸Šçš„æœ€æ–°å€¼, æ²¡æœ‰è§†å›¾æ¦‚å¿µ; è€Œ "ä¸²è¡ŒåŒ–" éš”ç¦»çº§åˆ«ä¸‹ç›´æŽ¥ç”¨åŠ é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®.')]),s._v(" "),t("p",[s._v('å¯ä»¥çœ‹åˆ°åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹, æ•°æ®åº“è¡Œä¸ºæ˜¯æœ‰æ‰€ä¸åŒçš„. Oracle æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«å…¶å®žå°±æ˜¯ "è¯»æäº¤", å› æ­¤å¯¹äºŽä¸€äº›ä»Ž Oracle è¿ç§»åˆ° MySQL çš„åº”ç”¨, ä¸ºä¿è¯æ•°æ®åº“éš”ç¦»çº§åˆ«çš„ä¸€è‡´, ä¸€å®šè¦è®°å¾—å°† MySQL çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸º "è¯»æäº¤". é…ç½®çš„æ–¹å¼æ˜¯, å°†å¯åŠ¨å‚æ•° transaction-isolation çš„å€¼è®¾ç½®æˆ READ-COMMITTED. å¯ä»¥ç”¨ show variables æ¥æŸ¥çœ‹å½“å‰çš„å€¼.')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'transaction_isolation'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------------+----------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------------+----------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" transaction_isolation "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("READ")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMITTED")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------------+----------------+")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("æ€»ç»“æ¥è¯´, å­˜åœ¨å³åˆç†, å“ªä¸ªéš”ç¦»çº§åˆ«éƒ½æœ‰å®ƒè‡ªå·±çš„ä½¿ç”¨åœºæ™¯, è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µæ¥å®š. æˆ‘æƒ³"),t("strong",[s._v('ä½ å¯èƒ½ä¼šé—®é‚£ä»€ä¹ˆæ—¶å€™éœ€è¦ "å¯é‡å¤è¯»" çš„åœºæ™¯å‘¢')]),s._v("? æ¥çœ‹ä¸€ä¸ªæ•°æ®æ ¡å¯¹é€»è¾‘çš„æ¡ˆä¾‹.")]),s._v(" "),t("p",[s._v("å‡è®¾ä½ åœ¨ç®¡ç†ä¸€ä¸ªä¸ªäººé“¶è¡Œè´¦æˆ·è¡¨. ä¸€ä¸ªè¡¨å­˜äº†æ¯ä¸ªæœˆæœˆåº•çš„ä½™é¢, ä¸€ä¸ªè¡¨å­˜äº†è´¦å•æ˜Žç»†. è¿™æ—¶å€™ä½ è¦åšæ•°æ®æ ¡å¯¹, ä¹Ÿå°±æ˜¯åˆ¤æ–­ä¸Šä¸ªæœˆçš„ä½™é¢å’Œå½“å‰ä½™é¢çš„å·®é¢, æ˜¯å¦ä¸Žæœ¬æœˆçš„è´¦å•æ˜Žç»†ä¸€è‡´. "),t("strong",[s._v("ä¸€å®šå¸Œæœ›åœ¨æ ¡å¯¹è¿‡ç¨‹ä¸­, å³ä½¿æœ‰ç”¨æˆ·å‘ç”Ÿäº†ä¸€ç¬”æ–°çš„äº¤æ˜“, ä¹Ÿä¸å½±å“ä½ çš„æ ¡å¯¹ç»“æžœ")]),s._v('. è¿™æ—¶å€™ä½¿ç”¨"å¯é‡å¤è¯»"éš”ç¦»çº§åˆ«å°±å¾ˆæ–¹ä¾¿. äº‹åŠ¡å¯åŠ¨æ—¶çš„è§†å›¾å¯ä»¥è®¤ä¸ºæ˜¯é™æ€çš„, ä¸å—å…¶ä»–äº‹åŠ¡æ›´æ–°çš„å½±å“.')]),s._v(" "),t("h5",{attrs:{id:"äº‹åŠ¡éš”ç¦»çš„å®žçŽ°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡éš”ç¦»çš„å®žçŽ°"}},[s._v("#")]),s._v(" äº‹åŠ¡éš”ç¦»çš„å®žçŽ°")]),s._v(" "),t("p",[s._v("ç†è§£äº†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«, å†æ¥"),t("strong",[s._v("çœ‹çœ‹äº‹åŠ¡éš”ç¦»å…·ä½“æ˜¯æ€Žä¹ˆå®žçŽ°")]),s._v('çš„. è¿™é‡Œå±•å¼€è¯´æ˜Ž "'),t("strong",[s._v("å¯é‡å¤è¯»")]),s._v('".')]),s._v(" "),t("p",[s._v("åœ¨ MySQL ä¸­, å®žé™…ä¸Š"),t("strong",[s._v("æ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›žæ»šæ“ä½œ")]),s._v(". è®°å½•ä¸Šçš„æœ€æ–°å€¼, é€šè¿‡å›žæ»šæ“ä½œ, éƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼.")]),s._v(" "),t("p",[s._v("å‡è®¾ä¸€ä¸ªå€¼ä»Ž 1 è¢«æŒ‰é¡ºåºæ”¹æˆäº† 2, 3, 4, åœ¨"),t("strong",[s._v("å›žæ»šæ—¥å¿—")]),s._v("é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/26543c1a8c3ca0db9bdea5854cf13862-20230731161914-txf6mue.png",alt:""}})]),s._v(" "),t("p",[s._v("å½“å‰å€¼æ˜¯ 4, ä½†æ˜¯"),t("strong",[s._v("åœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™, ä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„ read-view")]),s._v(". å¦‚å›¾ä¸­çœ‹åˆ°çš„, åœ¨è§†å›¾ A, B, C é‡Œé¢, è¿™ä¸€ä¸ªè®°å½•çš„å€¼åˆ†åˆ«æ˜¯ 1, 2, 4, "),t("mark",[t("strong",[s._v("åŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬, å°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶(MVCC)")])]),s._v(" . å¯¹äºŽ read-view A, è¦å¾—åˆ° 1, å°±å¿…é¡»å°†å½“å‰å€¼ä¾æ¬¡æ‰§è¡Œå›¾ä¸­æ‰€æœ‰çš„å›žæ»šæ“ä½œå¾—åˆ°.")]),s._v(" "),t("p",[s._v("åŒæ—¶ä½ ä¼šå‘çŽ°, å³ä½¿çŽ°åœ¨æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å°† 4 æ”¹æˆ 5, "),t("strong",[s._v("è¿™ä¸ªäº‹åŠ¡è·Ÿ read-view A, B, C å¯¹åº”çš„äº‹åŠ¡æ˜¯ä¸ä¼šå†²çªçš„")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šä¼šé—®, å›žæ»šæ—¥å¿—æ€»ä¸èƒ½ä¸€ç›´ä¿ç•™å§, ä»€ä¹ˆæ—¶å€™åˆ é™¤å‘¢? ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("åœ¨ä¸éœ€è¦çš„æ—¶å€™æ‰åˆ é™¤")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, ç³»ç»Ÿä¼šåˆ¤æ–­, "),t("strong",[s._v("å½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›žæ»šæ—¥å¿—æ—¶, å›žæ»šæ—¥å¿—ä¼šè¢«åˆ é™¤")]),s._v(". ä»€ä¹ˆæ—¶å€™æ‰ä¸éœ€è¦äº†å‘¢? å°±æ˜¯"),t("strong",[s._v("å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›žæ»šæ—¥å¿—æ›´æ—©çš„ read-view çš„æ—¶å€™")]),s._v(".")]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢çš„è¯´æ˜Ž, æ¥è®¨è®ºä¸€ä¸‹ä¸ºä»€ä¹ˆå»ºè®®"),t("strong",[s._v("å°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾")]),s._v(". ç”±äºŽè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®, æ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰, æ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›žæ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™, è¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´.")]),s._v(" "),t("p",[s._v("åœ¨ MySQL 5.5 åŠä»¥å‰çš„ç‰ˆæœ¬, å›žæ»šæ—¥å¿—æ˜¯è·Ÿæ•°æ®å­—å…¸ä¸€èµ·æ”¾åœ¨ ibdata æ–‡ä»¶é‡Œçš„, å³ä½¿é•¿äº‹åŠ¡æœ€ç»ˆæäº¤, å›žæ»šæ®µè¢«æ¸…ç†, æ–‡ä»¶ä¹Ÿä¸ä¼šå˜å°. æˆ‘è§è¿‡æ•°æ®åªæœ‰ 20GB, è€Œå›žæ»šæ®µæœ‰ 200GB çš„åº“. æœ€ç»ˆåªå¥½ä¸ºäº†æ¸…ç†å›žæ»šæ®µ, é‡å»ºæ•´ä¸ªåº“. é™¤äº†å¯¹å›žæ»šæ®µçš„å½±å“, é•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æº, ä¹Ÿå¯èƒ½æ‹–åž®æ•´ä¸ªåº“, è¿™ä¸ªä¼šåœ¨åŽé¢è®²é”çš„æ—¶å€™å±•å¼€.")]),s._v(" "),t("h5",{attrs:{id:"äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼"}},[s._v("#")]),s._v(" äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼")]),s._v(" "),t("p",[s._v("å¦‚å‰é¢æ‰€è¿°, é•¿äº‹åŠ¡æœ‰è¿™äº›æ½œåœ¨é£Žé™©, å½“ç„¶æ˜¯å»ºè®®å°½é‡é¿å…. å…¶å®žå¾ˆå¤šæ—¶å€™ä¸šåŠ¡å¼€å‘åŒå­¦å¹¶ä¸æ˜¯æœ‰æ„ä½¿ç”¨é•¿äº‹åŠ¡, é€šå¸¸æ˜¯ç”±äºŽè¯¯ç”¨æ‰€è‡´. MySQL çš„äº‹åŠ¡å¯åŠ¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("æ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥, begin æˆ– start transaction. é…å¥—çš„æäº¤è¯­å¥æ˜¯ commit, å›žæ»šè¯­å¥æ˜¯ rollback.")])]),s._v(" "),t("li",[s._v("set autocommit=0, è¿™ä¸ªå‘½ä»¤ä¼šå°†è¿™ä¸ªçº¿ç¨‹çš„è‡ªåŠ¨æäº¤å…³æŽ‰. æ„å‘³ç€å¦‚æžœåªæ‰§è¡Œä¸€ä¸ª select è¯­å¥, è¿™ä¸ªäº‹åŠ¡å°±å¯åŠ¨äº†, è€Œä¸”å¹¶ä¸ä¼šè‡ªåŠ¨æäº¤. è¿™ä¸ªäº‹åŠ¡æŒç»­å­˜åœ¨ç›´åˆ°ä½ ä¸»åŠ¨æ‰§è¡Œ commit æˆ– rollback è¯­å¥, æˆ–è€…æ–­å¼€è¿žæŽ¥.")])]),s._v(" "),t("p",[s._v("æœ‰äº›å®¢æˆ·ç«¯è¿žæŽ¥æ¡†æž¶ä¼šé»˜è®¤è¿žæŽ¥æˆåŠŸåŽå…ˆæ‰§è¡Œä¸€ä¸ª set autocommit=0 çš„å‘½ä»¤. "),t("strong",[s._v("è¿™å°±å¯¼è‡´æŽ¥ä¸‹æ¥çš„æŸ¥è¯¢éƒ½åœ¨äº‹åŠ¡ä¸­, å¦‚æžœæ˜¯é•¿è¿žæŽ¥, å°±å¯¼è‡´äº†æ„å¤–çš„é•¿äº‹åŠ¡")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å› æ­¤, å»ºè®®ä½¿ç”¨ set autocommit=1, é€šè¿‡æ˜¾å¼è¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡.")])]),s._v(" "),t("p",[s._v('ä½†æ˜¯æœ‰çš„åŒå­¦ä¼šçº ç»“ "å¤šä¸€æ¬¡äº¤äº’" çš„é—®é¢˜. å¯¹äºŽä¸€ä¸ªéœ€è¦é¢‘ç¹ä½¿ç”¨äº‹åŠ¡çš„ä¸šåŠ¡, ç¬¬äºŒç§æ–¹å¼æ¯ä¸ªäº‹åŠ¡åœ¨å¼€å§‹æ—¶éƒ½ä¸éœ€è¦ä¸»åŠ¨æ‰§è¡Œä¸€æ¬¡ "begin", å‡å°‘äº†è¯­å¥çš„äº¤äº’æ¬¡æ•°. å¦‚æžœä½ ä¹Ÿæœ‰è¿™ä¸ªé¡¾è™‘, æˆ‘å»ºè®®ä½ ä½¿ç”¨ commit work and chain è¯­æ³•.')]),s._v(" "),t("p",[s._v("åœ¨ autocommit ä¸º 1 çš„æƒ…å†µä¸‹, ç”¨ begin æ˜¾å¼å¯åŠ¨çš„äº‹åŠ¡, å¦‚æžœæ‰§è¡Œ commit åˆ™æäº¤äº‹åŠ¡. å¦‚æžœæ‰§è¡Œ commit work and chain, åˆ™æ˜¯"),t("strong",[s._v("æäº¤äº‹åŠ¡å¹¶è‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªäº‹åŠ¡")]),s._v(", è¿™æ ·ä¹ŸçœåŽ»äº†å†æ¬¡æ‰§è¡Œ begin è¯­å¥çš„å¼€é”€. åŒæ—¶å¸¦æ¥çš„å¥½å¤„æ˜¯ä»Žç¨‹åºå¼€å‘çš„è§’åº¦æ˜Žç¡®åœ°çŸ¥é“æ¯ä¸ªè¯­å¥æ˜¯å¦å¤„äºŽäº‹åŠ¡ä¸­.")]),s._v(" "),t("p",[s._v("å¯ä»¥åœ¨ information_schema åº“çš„ "),t("strong",[s._v("innodb_trx")]),s._v(" è¿™ä¸ªè¡¨ä¸­æŸ¥è¯¢é•¿äº‹åŠ¡, æ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥, ç”¨äºŽæŸ¥æ‰¾æŒç»­æ—¶é—´è¶…è¿‡ 60s çš„äº‹åŠ¡.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_trx "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" TIME_TO_SEC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timediff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("trx_started"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"å°ç»“-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-3"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL çš„äº‹åŠ¡éš”ç¦»çº§åˆ«çš„çŽ°è±¡å’Œå®žçŽ°, æ ¹æ®å®žçŽ°åŽŸç†åˆ†æžäº†é•¿äº‹åŠ¡å­˜åœ¨çš„é£Žé™©, ä»¥åŠå¦‚ä½•ç”¨æ­£ç¡®çš„æ–¹å¼é¿å…é•¿äº‹åŠ¡.")]),s._v(" "),t("p",[s._v("ä½ çŽ°åœ¨çŸ¥é“äº†ç³»ç»Ÿé‡Œé¢åº”è¯¥é¿å…é•¿äº‹åŠ¡, å¦‚æžœä½ æ˜¯ä¸šåŠ¡å¼€å‘è´Ÿè´£äººåŒæ—¶ä¹Ÿæ˜¯æ•°æ®åº“è´Ÿè´£äºº, ä½ ä¼šæœ‰ä»€ä¹ˆæ–¹æ¡ˆæ¥é¿å…å‡ºçŽ°æˆ–è€…å¤„ç†è¿™ç§æƒ…å†µå‘¢? è¿™ä¸ªé—®é¢˜, å¯ä»¥ä»Žåº”ç”¨å¼€å‘ç«¯å’Œæ•°æ®åº“ç«¯æ¥çœ‹.")]),s._v(" "),t("p",[s._v("**é¦–å…ˆ, ä»Žåº”ç”¨å¼€å‘ç«¯æ¥çœ‹: **")]),s._v(" "),t("ol",[t("li",[s._v("ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº† set autocommit=0. è¿™ä¸ªç¡®è®¤å·¥ä½œå¯ä»¥åœ¨æµ‹è¯•çŽ¯å¢ƒä¸­å¼€å±•, æŠŠ MySQL çš„ general_log å¼€èµ·æ¥, ç„¶åŽéšä¾¿è·‘ä¸€ä¸ªä¸šåŠ¡é€»è¾‘, é€šè¿‡ general_log çš„æ—¥å¿—æ¥ç¡®è®¤. ä¸€èˆ¬æ¡†æž¶å¦‚æžœä¼šè®¾ç½®è¿™ä¸ªå€¼, ä¹Ÿå°±ä¼šæä¾›å‚æ•°æ¥æŽ§åˆ¶è¡Œä¸º, ä½ çš„ç›®æ ‡å°±æ˜¯æŠŠå®ƒæ”¹æˆ 1.")]),s._v(" "),t("li",[t("strong",[s._v("ç¡®è®¤æ˜¯å¦æœ‰ä¸å¿…è¦çš„åªè¯»äº‹åŠ¡")]),s._v(". æœ‰äº›æ¡†æž¶ä¼šä¹ æƒ¯ä¸ç®¡ä»€ä¹ˆè¯­å¥å…ˆç”¨ begin/commit æ¡†èµ·æ¥. æˆ‘è§è¿‡æœ‰äº›æ˜¯ä¸šåŠ¡å¹¶æ²¡æœ‰è¿™ä¸ªéœ€è¦, ä½†æ˜¯ä¹ŸæŠŠå¥½å‡ ä¸ª select è¯­å¥æ”¾åˆ°äº†äº‹åŠ¡ä¸­. "),t("strong",[s._v("è¿™ç§åªè¯»äº‹åŠ¡å¯ä»¥åŽ»æŽ‰")]),s._v(".")]),s._v(" "),t("li",[s._v("ä¸šåŠ¡è¿žæŽ¥æ•°æ®åº“çš„æ—¶å€™, æ ¹æ®ä¸šåŠ¡æœ¬èº«çš„é¢„ä¼°, é€šè¿‡ SET MAX_EXECUTION_TIME å‘½ä»¤, æ¥æŽ§åˆ¶æ¯ä¸ªè¯­å¥æ‰§è¡Œçš„æœ€é•¿æ—¶é—´, é¿å…å•ä¸ªè¯­å¥æ„å¤–æ‰§è¡Œå¤ªé•¿æ—¶é—´.")])]),s._v(" "),t("p",[s._v("**å…¶æ¬¡, ä»Žæ•°æ®åº“ç«¯æ¥çœ‹: **")]),s._v(" "),t("ol",[t("li",[s._v("ç›‘æŽ§ "),t("strong",[s._v("information_schema.Innodb_trx")]),s._v(" è¡¨, è®¾ç½®é•¿äº‹åŠ¡é˜ˆå€¼, è¶…è¿‡å°±æŠ¥è­¦æˆ–è€… kill;")]),s._v(" "),t("li",[s._v("Percona çš„ pt-kill è¿™ä¸ªå·¥å…·ä¸é”™, æŽ¨èä½¿ç”¨;")]),s._v(" "),t("li",[s._v("åœ¨ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•é˜¶æ®µè¦æ±‚"),t("strong",[s._v("è¾“å‡ºæ‰€æœ‰çš„ general_log")]),s._v(", åˆ†æžæ—¥å¿—è¡Œä¸ºæå‰å‘çŽ°é—®é¢˜;")]),s._v(" "),t("li",[s._v("å¦‚æžœä½¿ç”¨çš„æ˜¯ MySQL 5.6 æˆ–è€…æ›´æ–°ç‰ˆæœ¬, æŠŠ innodb_undo_tablespaces è®¾ç½®æˆ 2(æˆ–æ›´å¤§çš„å€¼). å¦‚æžœçœŸçš„å‡ºçŽ°å¤§äº‹åŠ¡å¯¼è‡´å›žæ»šæ®µè¿‡å¤§, è¿™æ ·è®¾ç½®åŽæ¸…ç†èµ·æ¥æ›´æ–¹ä¾¿.")])]),s._v(" "),t("h4",{attrs:{id:"_04-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸Š"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_04-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸Š"}},[s._v("#")]),s._v(" 04-æ·±å…¥æµ…å‡ºç´¢å¼•(ä¸Š)")]),s._v(" "),t("p",[s._v('æåˆ°æ•°æ®åº“ç´¢å¼•, æˆ‘æƒ³ä½ å¹¶ä¸é™Œç”Ÿ. æ¯”å¦‚æŸä¸€ä¸ª SQL æŸ¥è¯¢æ¯”è¾ƒæ…¢, åˆ†æžå®ŒåŽŸå› ä¹‹åŽ, ä½ å¯èƒ½å°±ä¼šè¯´ "ç»™æŸä¸ªå­—æ®µåŠ ä¸ªç´¢å¼•" ä¹‹ç±»çš„è§£å†³æ–¹æ¡ˆ. ä½†åˆ°åº•ä»€ä¹ˆæ˜¯ç´¢å¼•, ç´¢å¼•åˆæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢?')]),s._v(" "),t("p",[s._v("ç´¢å¼•æ˜¯æ•°æ®åº“ç³»ç»Ÿé‡Œé¢æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€. åœ¨åŽé¢çš„æ–‡ç« ä¸­ä¹Ÿä¼šç»å¸¸å¼•ç”¨è¿™ä¸¤ç¯‡æ–‡ç« ä¸­æåˆ°çš„çŸ¥è¯†ç‚¹, åŠ æ·±ä½ å¯¹æ•°æ®åº“ç´¢å¼•çš„ç†è§£.")]),s._v(" "),t("p",[s._v("ä¸€å¥è¯ç®€å•æ¥è¯´, "),t("mark",[t("strong",[s._v("ç´¢å¼•çš„å‡ºçŽ°å…¶å®žå°±æ˜¯ä¸ºäº†æé«˜æ•°æ®æŸ¥è¯¢çš„æ•ˆçŽ‡, å°±åƒä¹¦çš„ç›®å½•ä¸€æ ·")])]),s._v(". ä¸€æœ¬ 500 é¡µçš„ä¹¦, å¦‚æžœä½ æƒ³å¿«é€Ÿæ‰¾åˆ°å…¶ä¸­çš„æŸä¸€ä¸ªçŸ¥è¯†ç‚¹, åœ¨ä¸å€ŸåŠ©ç›®å½•çš„æƒ…å†µä¸‹, é‚£æˆ‘ä¼°è®¡ä½ å¯å¾—æ‰¾ä¸€ä¼šå„¿. åŒæ ·"),t("mark",[t("strong",[s._v('å¯¹äºŽæ•°æ®åº“çš„è¡¨è€Œè¨€, ç´¢å¼•å…¶å®žå°±æ˜¯å®ƒçš„"ç›®å½•"')])]),s._v(" .")]),s._v(" "),t("h5",{attrs:{id:"ç´¢å¼•çš„å¸¸è§æ¨¡åž‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç´¢å¼•çš„å¸¸è§æ¨¡åž‹"}},[s._v("#")]),s._v(" ç´¢å¼•çš„å¸¸è§æ¨¡åž‹")]),s._v(" "),t("p",[s._v("ç´¢å¼•çš„å‡ºçŽ°æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆçŽ‡, ä½†æ˜¯"),t("strong",[s._v("å®žçŽ°ç´¢å¼•çš„æ–¹å¼å´æœ‰å¾ˆå¤šç§")]),s._v(", æ‰€ä»¥è¿™é‡Œä¹Ÿå°±å¼•å…¥äº†ç´¢å¼•æ¨¡åž‹çš„æ¦‚å¿µ. å¯ä»¥ç”¨äºŽæé«˜è¯»å†™æ•ˆçŽ‡çš„æ•°æ®ç»“æž„å¾ˆå¤š, è¿™é‡Œä»‹ç»ä¸‰ç§å¸¸è§çš„æ•°æ®ç»“æž„, å®ƒä»¬åˆ†åˆ«æ˜¯"),t("strong",[s._v("å“ˆå¸Œè¡¨, æœ‰åºæ•°ç»„å’Œæœç´¢æ ‘")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹é¢ä¸»è¦ä»Žä½¿ç”¨çš„è§’åº¦, ç®€å•åˆ†æžä¸€ä¸‹è¿™ä¸‰ç§æ¨¡åž‹çš„åŒºåˆ«.")]),s._v(" "),t("p",[s._v("å“ˆå¸Œè¡¨æ˜¯ä¸€ç§ä»¥"),t("strong",[s._v("é”®-å€¼")]),s._v("(key-value)å­˜å‚¨æ•°æ®çš„ç»“æž„, åªè¦è¾“å…¥å¾…æŸ¥æ‰¾çš„å€¼å³ key, å°±å¯ä»¥æ‰¾åˆ°å…¶å¯¹åº”çš„å€¼å³ Value. å“ˆå¸Œçš„æ€è·¯å¾ˆç®€å•, æŠŠå€¼æ”¾åœ¨æ•°ç»„é‡Œ, ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°æŠŠ key æ¢ç®—æˆä¸€ä¸ªç¡®å®šçš„ä½ç½®, ç„¶åŽæŠŠ value æ”¾åœ¨æ•°ç»„çš„è¿™ä¸ªä½ç½®. ä¸å¯é¿å…åœ°, å¤šä¸ª key å€¼ç»è¿‡å“ˆå¸Œå‡½æ•°çš„æ¢ç®—, ä¼šå‡ºçŽ°åŒä¸€ä¸ªå€¼çš„æƒ…å†µ. å¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯, "),t("strong",[s._v("æ‹‰å‡ºä¸€ä¸ªé“¾è¡¨")]),s._v(".")]),s._v(" "),t("p",[s._v("å‡è®¾ä½ çŽ°åœ¨ç»´æŠ¤ç€ä¸€ä¸ªèº«ä»½è¯ä¿¡æ¯å’Œå§“åçš„è¡¨, éœ€è¦æ ¹æ®èº«ä»½è¯å·æŸ¥æ‰¾å¯¹åº”çš„åå­—, è¿™æ—¶å¯¹åº”çš„å“ˆå¸Œç´¢å¼•çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8a48e04d8d0bfe7939682c15b62543c4-20230731161914-6sobqfu.png",alt:"",title:"å“ˆå¸Œè¡¨ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å›¾ä¸­, User2 å’Œ User4 æ ¹æ®èº«ä»½è¯å·ç®—å‡ºæ¥çš„å€¼éƒ½æ˜¯ N, ä½†æ²¡å…³ç³», åŽé¢è¿˜è·Ÿäº†ä¸€ä¸ª"),t("strong",[s._v("é“¾è¡¨")]),s._v(". å‡è®¾è¿™æ—¶å€™ä½ è¦æŸ¥ ID_card_n2 å¯¹åº”çš„åå­—æ˜¯ä»€ä¹ˆ, å¤„ç†æ­¥éª¤å°±æ˜¯: é¦–å…ˆå°† ID_card_n2 é€šè¿‡å“ˆå¸Œå‡½æ•°ç®—å‡º N; ç„¶åŽæŒ‰é¡ºåºéåŽ†, æ‰¾åˆ° User2.")]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, å›¾ä¸­å››ä¸ª ID_card_n çš„å€¼å¹¶ä¸æ˜¯é€’å¢žçš„, è¿™æ ·åšçš„å¥½å¤„æ˜¯å¢žåŠ æ–°çš„ User æ—¶é€Ÿåº¦ä¼šå¾ˆå¿«, åªéœ€è¦å¾€åŽè¿½åŠ . ä½†ç¼ºç‚¹æ˜¯, å› ä¸º"),t("strong",[s._v("ä¸æ˜¯æœ‰åºçš„, æ‰€ä»¥å“ˆå¸Œç´¢å¼•åšåŒºé—´æŸ¥è¯¢çš„é€Ÿåº¦æ˜¯å¾ˆæ…¢")]),s._v("çš„. å¯ä»¥è®¾æƒ³ä¸‹, å¦‚æžœè¦æ‰¾èº«ä»½è¯å·åœ¨ [ID_card_X, ID_card_Y] è¿™ä¸ªåŒºé—´çš„æ‰€æœ‰ç”¨æˆ·, å°±å¿…é¡»"),t("strong",[s._v("å…¨éƒ¨æ‰«æä¸€é")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥"),t("strong",[s._v("å“ˆå¸Œè¡¨è¿™ç§ç»“æž„é€‚ç”¨äºŽåªæœ‰ç­‰å€¼æŸ¥è¯¢çš„åœºæ™¯")]),s._v(", æ¯”å¦‚ Memcached åŠå…¶ä»–ä¸€äº› NoSQL å¼•æ“Ž.")]),s._v(" "),t("p",[s._v("è€Œ"),t("strong",[s._v("æœ‰åºæ•°ç»„åœ¨ç­‰å€¼æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢åœºæ™¯ä¸­çš„æ€§èƒ½å°±éƒ½éžå¸¸ä¼˜ç§€")]),s._v(". è¿˜æ˜¯ä¸Šé¢è¿™ä¸ªæ ¹æ®èº«ä»½è¯å·æŸ¥åå­—çš„ä¾‹å­, å¦‚æžœä½¿ç”¨æœ‰åºæ•°ç»„æ¥å®žçŽ°çš„è¯, ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/24082934b6f6a361bdf582bf91267f89-20230731161914-gm82gie.png",alt:"",title:"æœ‰åºæ•°ç»„ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("è¿™é‡Œå‡è®¾èº«ä»½è¯å·æ²¡æœ‰é‡å¤, è¿™ä¸ªæ•°ç»„å°±æ˜¯æŒ‰ç…§èº«ä»½è¯å·"),t("strong",[s._v("é€’å¢žçš„é¡ºåºä¿å­˜")]),s._v("çš„. è¿™æ—¶å€™å¦‚æžœè¦æŸ¥ ID_card_n2 å¯¹åº”çš„åå­—, ç”¨äºŒåˆ†æ³•å°±å¯ä»¥å¿«é€Ÿå¾—åˆ°, è¿™ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯ O(log(N)).")]),s._v(" "),t("p",[s._v("åŒæ—¶å¾ˆæ˜¾ç„¶, è¿™ä¸ªç´¢å¼•ç»“æž„æ”¯æŒèŒƒå›´æŸ¥è¯¢. è¦æŸ¥èº«ä»½è¯å·åœ¨ [ID_card_X, ID_card_Y] åŒºé—´çš„ User, å¯ä»¥å…ˆç”¨äºŒåˆ†æ³•æ‰¾åˆ° ID_card_X(å¦‚æžœä¸å­˜åœ¨ ID_card_X, å°±æ‰¾åˆ°å¤§äºŽ ID_card_X çš„ç¬¬ä¸€ä¸ª User), ç„¶åŽå‘å³éåŽ†, ç›´åˆ°æŸ¥åˆ°ç¬¬ä¸€ä¸ªå¤§äºŽ ID_card_Y çš„èº«ä»½è¯å·, é€€å‡ºå¾ªçŽ¯.")]),s._v(" "),t("p",[s._v("å¦‚æžœä»…ä»…çœ‹æŸ¥è¯¢æ•ˆçŽ‡, æœ‰åºæ•°ç»„å°±æ˜¯æœ€å¥½çš„æ•°æ®ç»“æž„äº†. ä½†æ˜¯åœ¨éœ€è¦æ›´æ–°æ•°æ®çš„æ—¶å€™å°±éº»çƒ¦äº†, å¾€ä¸­é—´æ’å…¥ä¸€ä¸ªè®°å½•å°±å¿…é¡»å¾—"),t("strong",[s._v("æŒªåŠ¨åŽé¢æ‰€æœ‰çš„è®°å½•, æˆæœ¬å¤ªé«˜")]),s._v(". æ‰€ä»¥"),t("strong",[s._v("æœ‰åºæ•°ç»„ç´¢å¼•åªé€‚ç”¨äºŽé™æ€å­˜å‚¨å¼•æ“Ž")]),s._v(", æ¯”å¦‚è¦ä¿å­˜çš„æ˜¯ 2017 å¹´æŸä¸ªåŸŽå¸‚çš„æ‰€æœ‰äººå£ä¿¡æ¯, è¿™ç±»ä¸ä¼šå†ä¿®æ”¹çš„æ•°æ®.")]),s._v(" "),t("p",[t("strong",[s._v("äºŒå‰æœç´¢æ ‘")]),s._v("ä¹Ÿæ˜¯è¯¾æœ¬é‡Œçš„ç»å…¸æ•°æ®ç»“æž„äº†. è¿˜æ˜¯ä¸Šé¢æ ¹æ®èº«ä»½è¯å·æŸ¥åå­—çš„ä¾‹å­, å¦‚æžœç”¨äºŒå‰æœç´¢æ ‘æ¥å®žçŽ°çš„è¯, ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4f77c26025987d21a2b59bf1aadbbc00-20230731161914-e2cg7nr.png",alt:"",title:"äºŒå‰æœç´¢æ ‘ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("äºŒå‰æœç´¢æ ‘çš„ç‰¹ç‚¹æ˜¯: æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å„¿å­å°äºŽçˆ¶èŠ‚ç‚¹, çˆ¶èŠ‚ç‚¹åˆå°äºŽå³å„¿å­. è¿™æ ·å¦‚æžœè¦æŸ¥ ID_card_n2 çš„è¯, æŒ‰ç…§å›¾ä¸­çš„æœç´¢é¡ºåºå°±æ˜¯æŒ‰ç…§ UserA -> UserC -> UserF -> User2 è¿™ä¸ªè·¯å¾„å¾—åˆ°. è¿™ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯ O(log(N)).")]),s._v(" "),t("p",[s._v("å½“ç„¶ä¸ºäº†ç»´æŒ O(log(N)) çš„æŸ¥è¯¢å¤æ‚åº¦, å°±éœ€è¦ä¿æŒè¿™æ£µæ ‘æ˜¯"),t("strong",[s._v("å¹³è¡¡äºŒå‰æ ‘")]),s._v(". ä¸ºäº†åšè¿™ä¸ªä¿è¯, "),t("strong",[s._v("æ›´æ–°çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(log(N))")]),s._v(" .")]),s._v(" "),t("p",[s._v("æ ‘å¯ä»¥æœ‰äºŒå‰, ä¹Ÿå¯ä»¥æœ‰å¤šå‰. å¤šå‰æ ‘å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ªå„¿å­, å„¿å­ä¹‹é—´çš„å¤§å°ä¿è¯ä»Žå·¦åˆ°å³é€’å¢ž. äºŒå‰æ ‘æ˜¯æœç´¢æ•ˆçŽ‡æœ€é«˜çš„, ä½†æ˜¯å®žé™…ä¸Šå¤§å¤šæ•°çš„æ•°æ®åº“å­˜å‚¨å´å¹¶ä¸ä½¿ç”¨äºŒå‰æ ‘. "),t("strong",[s._v("å…¶åŽŸå› æ˜¯, ç´¢å¼•ä¸æ­¢å­˜åœ¨å†…å­˜ä¸­, è¿˜è¦å†™åˆ°ç£ç›˜ä¸Š")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯ä»¥æƒ³è±¡ä¸€ä¸‹ä¸€æ£µ 100 ä¸‡èŠ‚ç‚¹çš„å¹³è¡¡äºŒå‰æ ‘, æ ‘é«˜ 20. ä¸€æ¬¡æŸ¥è¯¢å¯èƒ½éœ€è¦è®¿é—® 20 ä¸ªæ•°æ®å—. åœ¨æœºæ¢°ç¡¬ç›˜æ—¶ä»£, ä»Žç£ç›˜éšæœºè¯»ä¸€ä¸ªæ•°æ®å—éœ€è¦ 10 ms å·¦å³çš„å¯»å€æ—¶é—´. ä¹Ÿå°±æ˜¯è¯´, å¯¹äºŽä¸€ä¸ª 100 ä¸‡è¡Œçš„è¡¨, å¦‚æžœä½¿ç”¨äºŒå‰æ ‘æ¥å­˜å‚¨, å•ç‹¬è®¿é—®ä¸€ä¸ªè¡Œå¯èƒ½éœ€è¦ 20 ä¸ª 10 ms çš„æ—¶é—´, è¿™ä¸ªæŸ¥è¯¢å¯çœŸå¤Ÿæ…¢çš„.")]),s._v(" "),t("p",[t("strong",[s._v("ä¸ºäº†è®©ä¸€ä¸ªæŸ¥è¯¢å°½é‡å°‘åœ°è¯»ç£ç›˜, å°±å¿…é¡»è®©æŸ¥è¯¢è¿‡ç¨‹è®¿é—®å°½é‡å°‘çš„æ•°æ®å—")]),s._v('. é‚£ä¹ˆå°±ä¸åº”è¯¥ä½¿ç”¨äºŒå‰æ ‘, è€Œæ˜¯è¦ä½¿ç”¨ "N å‰" æ ‘. è¿™é‡Œ, "N å‰" æ ‘ä¸­çš„ "N" å–å†³äºŽæ•°æ®å—çš„å¤§å°.')]),s._v(" "),t("p",[s._v("ä»¥ InnoDB çš„ä¸€ä¸ªæ•´æ•°å­—æ®µç´¢å¼•ä¸ºä¾‹, "),t("strong",[s._v("è¿™ä¸ª N å·®ä¸å¤šæ˜¯ 1200")]),s._v(". è¿™æ£µæ ‘é«˜æ˜¯ 4 çš„æ—¶å€™, å°±å¯ä»¥å­˜ 1200 çš„ 3 æ¬¡æ–¹ä¸ªå€¼, è¿™å·²ç» 17 äº¿äº†. è€ƒè™‘åˆ°æ ‘æ ¹çš„æ•°æ®å—æ€»æ˜¯åœ¨å†…å­˜ä¸­çš„, ä¸€ä¸ª 10 äº¿è¡Œçš„è¡¨ä¸Šä¸€ä¸ªæ•´æ•°å­—æ®µçš„ç´¢å¼•, æŸ¥æ‰¾ä¸€ä¸ªå€¼æœ€å¤šåªéœ€è¦"),t("strong",[s._v("è®¿é—® 3 æ¬¡ç£ç›˜")]),s._v(". å…¶å®žæ ‘çš„ç¬¬äºŒå±‚ä¹Ÿæœ‰å¾ˆå¤§æ¦‚çŽ‡åœ¨å†…å­˜ä¸­, é‚£ä¹ˆè®¿é—®ç£ç›˜çš„å¹³å‡æ¬¡æ•°å°±æ›´å°‘äº†.")]),s._v(" "),t("p",[t("strong",[s._v("N å‰æ ‘ç”±äºŽåœ¨è¯»å†™ä¸Šçš„æ€§èƒ½ä¼˜ç‚¹, ä»¥åŠé€‚é…ç£ç›˜çš„è®¿é—®æ¨¡å¼, å·²ç»è¢«å¹¿æ³›åº”ç”¨åœ¨æ•°æ®åº“å¼•æ“Žä¸­äº†.")])]),s._v(" "),t("p",[s._v("ä¸ç®¡æ˜¯å“ˆå¸Œè¿˜æ˜¯æœ‰åºæ•°ç»„, æˆ–è€… N å‰æ ‘, å®ƒä»¬éƒ½æ˜¯ä¸æ–­è¿­ä»£, ä¸æ–­ä¼˜åŒ–çš„äº§ç‰©æˆ–è€…è§£å†³æ–¹æ¡ˆ. æ•°æ®åº“æŠ€æœ¯å‘å±•åˆ°ä»Šå¤©, è·³è¡¨, LSM æ ‘ç­‰æ•°æ®ç»“æž„ä¹Ÿè¢«ç”¨äºŽå¼•æ“Žè®¾è®¡ä¸­, è¿™é‡Œå°±ä¸å†ä¸€ä¸€å±•å¼€äº†.")]),s._v(" "),t("p",[t("strong",[s._v("æ•°æ®åº“åº•å±‚å­˜å‚¨çš„æ ¸å¿ƒå°±æ˜¯åŸºäºŽè¿™äº›æ•°æ®æ¨¡åž‹çš„. æ¯ç¢°åˆ°ä¸€ä¸ªæ–°æ•°æ®åº“, éœ€è¦å…ˆå…³æ³¨å®ƒçš„æ•°æ®æ¨¡åž‹, è¿™æ ·æ‰èƒ½ä»Žç†è®ºä¸Šåˆ†æžå‡ºè¿™ä¸ªæ•°æ®åº“çš„é€‚ç”¨åœºæ™¯")]),s._v(".")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº†ä¸åŒçš„æ•°æ®ç»“æž„, ä»¥åŠå®ƒä»¬çš„é€‚ç”¨åœºæ™¯, ä½ å¯èƒ½ä¼šè§‰å¾—æœ‰äº›æž¯ç‡¥. ä½†æ˜¯å»ºè®®å¤šèŠ±ä¸€äº›æ—¶é—´æ¥ç†è§£è¿™éƒ¨åˆ†å†…å®¹, æ¯•ç«Ÿè¿™æ˜¯æ•°æ®åº“å¤„ç†æ•°æ®çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€, åœ¨åˆ†æžé—®é¢˜çš„æ—¶å€™ä¼šç»å¸¸ç”¨åˆ°. å½“ä½ ç†è§£äº†ç´¢å¼•çš„æ¨¡åž‹åŽ, å°±ä¼šå‘çŽ°åœ¨åˆ†æžé—®é¢˜çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªæ›´æ¸…æ™°çš„è§†è§’, ä½“ä¼šåˆ°å¼•æ“Žè®¾è®¡çš„ç²¾å¦™ä¹‹å¤„.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä¸€èµ·è¿›å…¥ç›¸å¯¹åå®žæˆ˜çš„å†…å®¹å§.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("åœ¨ MySQL ä¸­, ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“Žå±‚å®žçŽ°çš„, æ‰€ä»¥å¹¶æ²¡æœ‰ç»Ÿä¸€çš„ç´¢å¼•æ ‡å‡†, å³ä¸åŒå­˜å‚¨å¼•æ“Žçš„ç´¢å¼•çš„å·¥ä½œæ–¹å¼å¹¶ä¸ä¸€æ ·")])]),s._v(". è€Œå³ä½¿å¤šä¸ªå­˜å‚¨å¼•æ“Žæ”¯æŒåŒä¸€ç§ç±»åž‹çš„ç´¢å¼•, å…¶åº•å±‚çš„å®žçŽ°ä¹Ÿå¯èƒ½ä¸åŒ. ç”±äºŽ InnoDB å­˜å‚¨å¼•æ“Žåœ¨ MySQL æ•°æ®åº“ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›, æ‰€ä»¥ä¸‹é¢å°±ä»¥ InnoDB ä¸ºä¾‹æ¥åˆ†æžä¸€ä¸‹å…¶ä¸­çš„ç´¢å¼•æ¨¡åž‹.")]),s._v(" "),t("h5",{attrs:{id:"innodbçš„ç´¢å¼•æ¨¡åž‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#innodbçš„ç´¢å¼•æ¨¡åž‹"}},[s._v("#")]),s._v(" InnoDBçš„ç´¢å¼•æ¨¡åž‹")]),s._v(" "),t("p",[s._v("åœ¨ InnoDB ä¸­, è¡¨éƒ½æ˜¯æ ¹æ®"),t("strong",[s._v("ä¸»é”®é¡ºåºä»¥ç´¢å¼•çš„å½¢å¼å­˜æ”¾")]),s._v("çš„, è¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸º"),t("strong",[s._v("ç´¢å¼•ç»„ç»‡è¡¨")]),s._v(". åˆå› ä¸ºå‰é¢æåˆ°çš„, InnoDB "),t("strong",[s._v("ä½¿ç”¨äº† B+ æ ‘ç´¢å¼•æ¨¡åž‹, æ‰€ä»¥æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨ B+ æ ‘")]),s._v("ä¸­çš„.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("æ¯ä¸€ä¸ªç´¢å¼•åœ¨ InnoDB é‡Œé¢å¯¹åº”ä¸€æ£µ B+ æ ‘.")])])]),s._v(" "),t("p",[s._v("å‡è®¾æœ‰ä¸€ä¸ªä¸»é”®åˆ—ä¸º ID çš„è¡¨, è¡¨ä¸­æœ‰å­—æ®µ k, å¹¶ä¸”åœ¨ k ä¸Šæœ‰ç´¢å¼•.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¡¨çš„å»ºè¡¨è¯­å¥æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" k "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¡¨ä¸­ R1~R5 çš„ (ID,k) å€¼åˆ†åˆ«ä¸º (100,1), (200,2), (300,3), (500,5) å’Œ (600,6), "),t("strong",[s._v("ä¸¤æ£µæ ‘")]),s._v("çš„ç¤ºä¾‹ç¤ºæ„å›¾å¦‚ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ad47e7792a51bb80fe5afed452a4c125-20230731161914-7phwdta.png",alt:"",title:"InnoDB çš„ç´¢å¼•ç»„ç»‡ç»“æž„"}})]),s._v(" "),t("p",[s._v("ä»Žå›¾ä¸­ä¸éš¾çœ‹å‡º, æ ¹"),t("mark",[t("strong",[s._v("æ®å¶å­èŠ‚ç‚¹çš„å†…å®¹, ç´¢å¼•ç±»åž‹åˆ†ä¸ºä¸»é”®ç´¢å¼•å’Œéžä¸»é”®ç´¢å¼•")])]),s._v(".")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®. åœ¨ InnoDB é‡Œ, ä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸º")]),s._v("â€‹"),t("mark",[t("strong",[s._v("èšç°‡ç´¢å¼•")])]),s._v("â€‹ "),t("strong",[s._v("(clustered index).")])]),s._v(" "),t("li",[t("strong",[s._v("éžä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼. åœ¨ InnoDB é‡Œ, éžä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸º")]),s._v("â€‹"),t("mark",[t("strong",[s._v("äºŒçº§ç´¢å¼•")])]),s._v("â€‹ **(secondary index). **")])]),s._v(" "),t("p",[s._v("æ ¹æ®ä¸Šé¢çš„ç´¢å¼•ç»“æž„è¯´æ˜Ž, æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜: **åŸºäºŽä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„æŸ¥è¯¢æœ‰ä»€ä¹ˆåŒºåˆ«? **")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æžœè¯­å¥æ˜¯ select * from T where ID=500, å³"),t("strong",[s._v("ä¸»é”®æŸ¥è¯¢")]),s._v("æ–¹å¼, åˆ™"),t("strong",[s._v("åªéœ€è¦æœç´¢ ID è¿™æ£µ B+ æ ‘")]),s._v(";")]),s._v(" "),t("li",[s._v("å¦‚æžœè¯­å¥æ˜¯ select * from T where k=5, å³"),t("strong",[s._v("æ™®é€šç´¢å¼•æŸ¥è¯¢")]),s._v("æ–¹å¼, åˆ™éœ€è¦"),t("strong",[s._v("å…ˆæœç´¢ k ç´¢å¼•æ ‘, å¾—åˆ° ID çš„å€¼ä¸º 500, å†åˆ° ID ç´¢å¼•æ ‘æœç´¢ä¸€æ¬¡. è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º")]),s._v("â€‹"),t("mark",[t("strong",[s._v("å›žè¡¨")])]),s._v(".")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("åŸºäºŽéžä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢éœ€è¦å¤šæ‰«æä¸€æ£µç´¢å¼•æ ‘")]),s._v(". å› æ­¤åœ¨åº”ç”¨ä¸­åº”è¯¥å°½é‡"),t("strong",[s._v("ä½¿ç”¨ä¸»é”®æŸ¥è¯¢")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ç´¢å¼•ç»´æŠ¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç´¢å¼•ç»´æŠ¤"}},[s._v("#")]),s._v(" ç´¢å¼•ç»´æŠ¤")]),s._v(" "),t("p",[s._v("B+ æ ‘ä¸ºäº†ç»´æŠ¤ç´¢å¼•æœ‰åºæ€§, åœ¨"),t("strong",[s._v("æ’å…¥æ–°å€¼")]),s._v("çš„æ—¶å€™éœ€è¦åšå¿…è¦çš„ç»´æŠ¤. ä»¥ä¸Šé¢è¿™ä¸ªå›¾ä¸ºä¾‹, å¦‚æžœæ’å…¥æ–°çš„è¡Œ ID å€¼ä¸º 700, åˆ™åªéœ€è¦åœ¨ R5 çš„è®°å½•åŽé¢æ’å…¥ä¸€ä¸ªæ–°è®°å½•. å¦‚æžœæ–°æ’å…¥çš„ ID å€¼ä¸º 400, å°±ç›¸å¯¹éº»çƒ¦äº†, éœ€è¦é€»è¾‘ä¸ŠæŒªåŠ¨åŽé¢çš„æ•°æ®, ç©ºå‡ºä½ç½®.")]),s._v(" "),t("p",[s._v("è€Œæ›´ç³Ÿçš„æƒ…å†µæ˜¯, å¦‚æžœ R5 æ‰€åœ¨çš„æ•°æ®é¡µå·²ç»æ»¡äº†, æ ¹æ® B+ æ ‘çš„ç®—æ³•, è¿™æ—¶å€™éœ€è¦"),t("strong",[s._v("ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°æ®é¡µ")]),s._v(", ç„¶åŽæŒªåŠ¨éƒ¨åˆ†æ•°æ®è¿‡åŽ». è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º"),t("strong",[s._v("é¡µåˆ†è£‚")]),s._v(". åœ¨è¿™ç§æƒ…å†µä¸‹, æ€§èƒ½è‡ªç„¶ä¼šå—å½±å“. é™¤äº†æ€§èƒ½å¤–, é¡µåˆ†è£‚æ“ä½œè¿˜å½±å“æ•°æ®é¡µçš„åˆ©ç”¨çŽ‡. åŽŸæœ¬æ”¾åœ¨ä¸€ä¸ªé¡µçš„æ•°æ®, çŽ°åœ¨åˆ†åˆ°ä¸¤ä¸ªé¡µä¸­, æ•´ä½“ç©ºé—´åˆ©ç”¨çŽ‡é™ä½Žå¤§çº¦ 50%. å½“ç„¶æœ‰åˆ†è£‚å°±æœ‰"),t("strong",[s._v("åˆå¹¶")]),s._v(". å½“ç›¸é‚»ä¸¤ä¸ªé¡µç”±äºŽåˆ é™¤äº†æ•°æ®, åˆ©ç”¨çŽ‡å¾ˆä½Žä¹‹åŽ, ä¼šå°†æ•°æ®é¡µåšåˆå¹¶. åˆå¹¶çš„è¿‡ç¨‹, å¯ä»¥è®¤ä¸ºæ˜¯åˆ†è£‚è¿‡ç¨‹çš„é€†è¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢çš„ç´¢å¼•ç»´æŠ¤è¿‡ç¨‹è¯´æ˜Ž, æ¥è®¨è®ºä¸€ä¸ªæ¡ˆä¾‹: ä½ å¯èƒ½åœ¨ä¸€äº›å»ºè¡¨è§„èŒƒé‡Œé¢è§åˆ°è¿‡ç±»ä¼¼çš„æè¿°, è¦æ±‚å»ºè¡¨è¯­å¥é‡Œä¸€å®šè¦æœ‰è‡ªå¢žä¸»é”®. å½“ç„¶äº‹æ— ç»å¯¹, è¿™é‡Œæ¥åˆ†æžä¸€ä¸‹å“ªäº›åœºæ™¯ä¸‹åº”è¯¥ä½¿ç”¨è‡ªå¢žä¸»é”®, è€Œå“ªäº›åœºæ™¯ä¸‹ä¸åº”è¯¥.")]),s._v(" "),t("p",[t("strong",[s._v("è‡ªå¢žä¸»é”®æ˜¯æŒ‡è‡ªå¢žåˆ—ä¸Šå®šä¹‰çš„ä¸»é”®, åœ¨å»ºè¡¨è¯­å¥ä¸­ä¸€èˆ¬æ˜¯è¿™ä¹ˆå®šä¹‰çš„")]),s._v(": NOT NULL PRIMARY KEY AUTO_INCREMENT. æ’å…¥æ–°è®°å½•çš„æ—¶å€™å¯ä»¥ä¸æŒ‡å®š ID çš„å€¼, ç³»ç»Ÿä¼šèŽ·å–å½“å‰ ID æœ€å¤§å€¼åŠ  1 ä½œä¸ºä¸‹ä¸€æ¡è®°å½•çš„ ID å€¼.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, è‡ªå¢žä¸»é”®çš„æ’å…¥æ•°æ®æ¨¡å¼, æ­£ç¬¦åˆäº†å‰é¢æåˆ°çš„"),t("strong",[s._v("é€’å¢žæ’å…¥")]),s._v("çš„åœºæ™¯. "),t("strong",[s._v("æ¯æ¬¡æ’å…¥ä¸€æ¡æ–°è®°å½•, éƒ½æ˜¯è¿½åŠ æ“ä½œ, éƒ½ä¸æ¶‰åŠåˆ°æŒªåŠ¨å…¶ä»–è®°å½•, ä¹Ÿä¸ä¼šè§¦å‘å¶å­èŠ‚ç‚¹çš„åˆ†è£‚")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("è€Œæœ‰ä¸šåŠ¡é€»è¾‘çš„å­—æ®µåšä¸»é”®, åˆ™å¾€å¾€ä¸å®¹æ˜“ä¿è¯æœ‰åºæ’å…¥, è¿™æ ·å†™æ•°æ®æˆæœ¬ç›¸å¯¹è¾ƒé«˜.")])]),s._v(" "),t("p",[s._v("é™¤äº†è€ƒè™‘æ€§èƒ½å¤–, è¿˜å¯ä»¥ä»Žå­˜å‚¨ç©ºé—´çš„è§’åº¦æ¥çœ‹. å‡è®¾è¡¨ä¸­ç¡®å®žæœ‰ä¸€ä¸ªå”¯ä¸€å­—æ®µ, æ¯”å¦‚å­—ç¬¦ä¸²ç±»åž‹çš„èº«ä»½è¯å·, é‚£åº”è¯¥ç”¨èº«ä»½è¯å·åšä¸»é”®, è¿˜æ˜¯ç”¨è‡ªå¢žå­—æ®µåšä¸»é”®å‘¢? ç”±äºŽæ¯ä¸ªéžä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šéƒ½æ˜¯ä¸»é”®çš„å€¼. å¦‚æžœç”¨èº«ä»½è¯å·åšä¸»é”®, é‚£ä¹ˆæ¯ä¸ªäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å ç”¨çº¦ 20 ä¸ªå­—èŠ‚, "),t("strong",[s._v("è€Œå¦‚æžœç”¨æ•´åž‹åšä¸»é”®, åˆ™åªè¦ 4 ä¸ªå­—èŠ‚, å¦‚æžœæ˜¯é•¿æ•´åž‹(bigint)åˆ™æ˜¯ 8 ä¸ªå­—èŠ‚")]),s._v(".")]),s._v(" "),t("p",[t("mark",[s._v("**æ˜¾ç„¶, ä¸»é”®é•¿åº¦è¶Šå°, æ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±è¶Šå°, æ™®é€šç´¢å¼•å ç”¨çš„ç©ºé—´ä¹Ÿå°±è¶Šå°. æ‰€ä»¥, ä»Žæ€§èƒ½å’Œå­˜å‚¨ç©ºé—´æ–¹é¢è€ƒé‡, è‡ªå¢žä¸»é”®å¾€å¾€æ˜¯æ›´åˆç†çš„é€‰æ‹©. **")])]),s._v(" "),t("p",[s._v("æœ‰æ²¡æœ‰ä»€ä¹ˆåœºæ™¯é€‚åˆç”¨ä¸šåŠ¡å­—æ®µç›´æŽ¥åšä¸»é”®çš„å‘¢? è¿˜æ˜¯æœ‰çš„. æ¯”å¦‚æœ‰äº›ä¸šåŠ¡çš„åœºæ™¯éœ€æ±‚æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("åªæœ‰ä¸€ä¸ªç´¢å¼•;")]),s._v(" "),t("li",[s._v("è¯¥ç´¢å¼•å¿…é¡»æ˜¯å”¯ä¸€ç´¢å¼•.")])]),s._v(" "),t("p",[s._v("ä¸€å®šçœ‹å‡ºæ¥äº†, è¿™å°±æ˜¯å…¸åž‹çš„ KV åœºæ™¯. ç”±äºŽæ²¡æœ‰å…¶ä»–ç´¢å¼•, æ‰€ä»¥ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å…¶ä»–ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å¤§å°çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v('è¿™æ—¶å€™å°±è¦ä¼˜å…ˆè€ƒè™‘å‰é¢æåˆ°çš„ "å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢" åŽŸåˆ™, '),t("strong",[s._v("ç›´æŽ¥å°†è¿™ä¸ªç´¢å¼•è®¾ç½®ä¸ºä¸»é”®, å¯ä»¥é¿å…æ¯æ¬¡æŸ¥è¯¢éœ€è¦æœç´¢ä¸¤æ£µæ ‘")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-4"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚åˆ†æžäº†æ•°æ®åº“å¼•æ“Žå¯ç”¨çš„æ•°æ®ç»“æž„, ä»‹ç»äº† InnoDB é‡‡ç”¨çš„ B+ æ ‘ç»“æž„, ä»¥åŠä¸ºä»€ä¹ˆ InnoDB è¦è¿™ä¹ˆé€‰æ‹©. "),t("strong",[s._v("B+ æ ‘èƒ½å¤Ÿå¾ˆå¥½åœ°é…åˆç£ç›˜çš„è¯»å†™ç‰¹æ€§, å‡å°‘å•æ¬¡æŸ¥è¯¢çš„ç£ç›˜è®¿é—®æ¬¡æ•°")]),s._v(".")]),s._v(" "),t("p",[s._v("ç”±äºŽ InnoDB æ˜¯ç´¢å¼•ç»„ç»‡è¡¨, ä¸€èˆ¬æƒ…å†µä¸‹ä¼šå»ºè®®"),t("strong",[s._v("åˆ›å»ºä¸€ä¸ªè‡ªå¢žä¸»é”®, è¿™æ ·éžä¸»é”®ç´¢å¼•å ç”¨çš„ç©ºé—´æœ€å°")]),s._v(". ä½†äº‹æ— ç»å¯¹, æˆ‘ä¹Ÿè·Ÿä½ è®¨è®ºäº†ä½¿ç”¨ä¸šåŠ¡é€»è¾‘å­—æ®µåšä¸»é”®çš„åº”ç”¨åœºæ™¯.")]),s._v(" "),t("p",[s._v("æœ€åŽæä¸€ä¸ªé—®é¢˜. å¯¹äºŽä¸Šé¢ä¾‹å­ä¸­çš„ InnoDB è¡¨ T, å¦‚æžœè¦é‡å»ºç´¢å¼• k, ä½ çš„ä¸¤ä¸ª SQL è¯­å¥å¯ä»¥è¿™ä¹ˆå†™:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å¦‚æžœä½ è¦é‡å»ºä¸»é”®ç´¢å¼•, ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("æˆ‘çš„é—®é¢˜æ˜¯, å¯¹äºŽä¸Šé¢è¿™ä¸¤ä¸ªé‡å»ºç´¢å¼•çš„ä½œæ³•, è¯´å‡ºä½ çš„ç†è§£. å¦‚æžœæœ‰ä¸åˆé€‚çš„, ä¸ºä»€ä¹ˆ, æ›´å¥½çš„æ–¹æ³•æ˜¯ä»€ä¹ˆ?")]),s._v(" "),t("p",[s._v("æœ‰äººé—®åˆ°ä¸ºä»€ä¹ˆè¦é‡å»ºç´¢å¼•. å‰é¢æœ‰æåˆ°, ç´¢å¼•å¯èƒ½å› ä¸ºåˆ é™¤, æˆ–è€…é¡µåˆ†è£‚ç­‰åŽŸå› , "),t("strong",[s._v("å¯¼è‡´æ•°æ®é¡µæœ‰ç©ºæ´ž, é‡å»ºç´¢å¼•çš„è¿‡ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•, æŠŠæ•°æ®æŒ‰é¡ºåºæ’å…¥, è¿™æ ·é¡µé¢çš„åˆ©ç”¨çŽ‡æœ€é«˜, ä¹Ÿå°±æ˜¯ç´¢å¼•æ›´ç´§å‡‘, æ›´çœç©ºé—´")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯¹äºŽè¿™ä¸ªé—®é¢˜, é‡å»ºç´¢å¼• k çš„åšæ³•æ˜¯åˆç†çš„, å¯ä»¥è¾¾åˆ°çœç©ºé—´çš„ç›®çš„. ä½†æ˜¯é‡å»ºä¸»é”®çš„è¿‡ç¨‹ä¸åˆç†. "),t("strong",[s._v("ä¸è®ºæ˜¯åˆ é™¤ä¸»é”®è¿˜æ˜¯åˆ›å»ºä¸»é”®, éƒ½ä¼šå°†æ•´ä¸ªè¡¨é‡å»º")]),s._v(". æ‰€ä»¥è¿žç€æ‰§è¡Œè¿™ä¸¤ä¸ªè¯­å¥çš„è¯, ç¬¬ä¸€ä¸ªè¯­å¥å°±ç™½åšäº†. è¿™ä¸¤ä¸ªè¯­å¥, å¯ä»¥ç”¨è¿™ä¸ªè¯­å¥ä»£æ›¿: alter table T engine=InnoDB.")]),s._v(" "),t("h4",{attrs:{id:"_05-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_05-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸‹"}},[s._v("#")]),s._v(" 05-æ·±å…¥æµ…å‡ºç´¢å¼•(ä¸‹)")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šä¸€èŠ‚ä»‹ç»äº† InnoDB ç´¢å¼•çš„æ•°æ®ç»“æž„æ¨¡åž‹, ä»Šå¤©å†ç»§ç»­èŠèŠè·Ÿ MySQL ç´¢å¼•æœ‰å…³çš„æ¦‚å¿µ.")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªé—®é¢˜:")]),s._v(" "),t("p",[s._v("åœ¨ä¸‹é¢è¿™ä¸ªè¡¨ T ä¸­, å¦‚æžœæ‰§è¡Œ "),t("code",[s._v("select * from T where k between 3 and 5")]),s._v("â€‹, éœ€è¦æ‰§è¡Œå‡ æ¬¡æ ‘çš„æœç´¢æ“ä½œ, ä¼šæ‰«æå¤šå°‘è¡Œ?")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ˜¯è¿™ä¸ªè¡¨çš„åˆå§‹åŒ–è¯­å¥.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nID "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nk "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \ns "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" T "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aa'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bb'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cc'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ee'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ff'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gg'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/ad47e7792a51bb80fe5afed452a4c125-20230731161914-z7doeu6.png",alt:"",title:"InnoDBçš„ç´¢å¼•ç»„ç»‡ç»“æž„"}})]),s._v(" "),t("p",[s._v("ä¸€èµ·æ¥çœ‹çœ‹è¿™æ¡ SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹:")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨ k ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ° k=3 çš„è®°å½•, å–å¾— ID = 300;")]),s._v(" "),t("li",[s._v("å†åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID=300 å¯¹åº”çš„ R3;")]),s._v(" "),t("li",[s._v("åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k=5, å–å¾— ID=500;")]),s._v(" "),t("li",[s._v("å†å›žåˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID=500 å¯¹åº”çš„ R4;")]),s._v(" "),t("li",[s._v("åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k=6, ä¸æ»¡è¶³æ¡ä»¶, å¾ªçŽ¯ç»“æŸ.")])]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, "),t("strong",[s._v("å›žåˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢çš„è¿‡ç¨‹, ç§°ä¸º")]),s._v("â€‹"),t("mark",[t("strong",[s._v("å›žè¡¨")])]),s._v(". å¯ä»¥çœ‹åˆ°, è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹è¯»äº† k ç´¢å¼•æ ‘çš„ 3 æ¡è®°å½•(æ­¥éª¤ 1, 3 å’Œ 5), å›žè¡¨äº†ä¸¤æ¬¡(æ­¥éª¤ 2 å’Œ 4).")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªä¾‹å­ä¸­, "),t("strong",[s._v("ç”±äºŽæŸ¥è¯¢ç»“æžœæ‰€éœ€è¦çš„æ•°æ®åªåœ¨ä¸»é”®ç´¢å¼•ä¸Šæœ‰, æ‰€ä»¥ä¸å¾—ä¸å›žè¡¨")]),s._v(". é‚£æœ‰æ²¡æœ‰"),t("strong",[s._v("å¯èƒ½ç»è¿‡ç´¢å¼•ä¼˜åŒ–, é¿å…å›žè¡¨è¿‡ç¨‹")]),s._v("å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"è¦†ç›–ç´¢å¼•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¦†ç›–ç´¢å¼•"}},[s._v("#")]),s._v(" è¦†ç›–ç´¢å¼•")]),s._v(" "),t("p",[s._v("å¦‚æžœæ‰§è¡Œçš„è¯­å¥æ˜¯ "),t("code",[s._v("select ID from T where k between 3 and 5")]),s._v("â€‹, è¿™æ—¶åªéœ€è¦æŸ¥ ID çš„å€¼, "),t("strong",[s._v("è€Œ ID çš„å€¼å·²ç»åœ¨ k ç´¢å¼•æ ‘ä¸Šäº†, å› æ­¤å¯ä»¥ç›´æŽ¥æä¾›æŸ¥è¯¢ç»“æžœ, ä¸éœ€è¦å›žè¡¨")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, åœ¨è¿™ä¸ªæŸ¥è¯¢é‡Œé¢, "),t("mark",[t("strong",[s._v('ç´¢å¼• k åŒ…å«çš„æ•°æ®å·²ç» "è¦†ç›–äº†" æœ¬æ¬¡æŸ¥è¯¢éœ€æ±‚, æˆ‘ä»¬ç§°ä¸ºè¦†ç›–ç´¢å¼•')])]),s._v(".")]),s._v(" "),t("p",[s._v("**ç”±äºŽè¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°, æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½, æ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ. **")]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨å¼•æ“Žå†…éƒ¨ä½¿ç”¨è¦†ç›–ç´¢å¼•åœ¨ç´¢å¼• k ä¸Šå…¶å®žè¯»äº†ä¸‰ä¸ªè®°å½•, R3~R5(å¯¹åº”çš„ç´¢å¼• k ä¸Šçš„è®°å½•é¡¹), ä½†æ˜¯å¯¹äºŽ MySQL çš„ Server å±‚æ¥è¯´, å®ƒå°±æ˜¯æ‰¾å¼•æ“Ž"),t("strong",[s._v("æ‹¿åˆ°äº†ä¸¤æ¡è®°å½•")]),s._v(", å› æ­¤ MySQL è®¤ä¸ºæ‰«æè¡Œæ•°æ˜¯ 2.")]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢è¦†ç›–ç´¢å¼•çš„è¯´æ˜Ž, æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜: **åœ¨ä¸€ä¸ªå¸‚æ°‘ä¿¡æ¯è¡¨ä¸Š, æ˜¯å¦æœ‰å¿…è¦å°†èº«ä»½è¯å·å’Œåå­—å»ºç«‹è”åˆç´¢å¼•? **")]),s._v(" "),t("p",[s._v("å‡è®¾è¿™ä¸ªå¸‚æ°‘è¡¨çš„å®šä¹‰æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("tuser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id_card"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ismale"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tinyint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id_card"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id_card"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name_age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("èº«ä»½è¯å·æ˜¯å¸‚æ°‘çš„å”¯ä¸€æ ‡è¯†. ä¹Ÿå°±æ˜¯è¯´, å¦‚æžœæœ‰æ ¹æ®èº«ä»½è¯å·æŸ¥è¯¢å¸‚æ°‘ä¿¡æ¯çš„éœ€æ±‚, åªè¦åœ¨èº«ä»½è¯å·å­—æ®µä¸Šå»ºç«‹ç´¢å¼•å°±å¤Ÿäº†. è€Œå†å»ºç«‹ä¸€ä¸ª(èº«ä»½è¯å·, å§“å)çš„"),t("strong",[s._v("è”åˆç´¢å¼•")]),s._v(", æ˜¯ä¸æ˜¯æµªè´¹ç©ºé—´? å¦‚æžœçŽ°åœ¨æœ‰ä¸€ä¸ªé«˜é¢‘è¯·æ±‚, è¦æ ¹æ®å¸‚æ°‘çš„èº«ä»½è¯å·æŸ¥è¯¢ä»–çš„å§“å, è¿™ä¸ªè”åˆç´¢å¼•å°±æœ‰æ„ä¹‰äº†. å®ƒå¯ä»¥åœ¨è¿™ä¸ªé«˜é¢‘è¯·æ±‚ä¸Šç”¨åˆ°è¦†ç›–ç´¢å¼•, "),t("strong",[s._v("ä¸å†éœ€è¦å›žè¡¨æŸ¥æ•´è¡Œè®°å½•")]),s._v(", å‡å°‘è¯­å¥çš„æ‰§è¡Œæ—¶é—´.")]),s._v(" "),t("p",[s._v("å½“ç„¶ç´¢å¼•å­—æ®µçš„ç»´æŠ¤æ€»æ˜¯æœ‰ä»£ä»·çš„. å› æ­¤åœ¨å»ºç«‹"),t("strong",[s._v("å†—ä½™ç´¢å¼•æ¥æ”¯æŒè¦†ç›–ç´¢å¼•æ—¶å°±éœ€è¦æƒè¡¡è€ƒè™‘")]),s._v("äº†. è¿™æ­£æ˜¯ä¸šåŠ¡ DBA, æˆ–è€…ç§°ä¸ºä¸šåŠ¡æ•°æ®æž¶æž„å¸ˆçš„å·¥ä½œ.")]),s._v(" "),t("h5",{attrs:{id:"æœ€å·¦å‰ç¼€åŽŸåˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœ€å·¦å‰ç¼€åŽŸåˆ™"}},[s._v("#")]),s._v(" æœ€å·¦å‰ç¼€åŽŸåˆ™")]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™é‡Œä½ ä¸€å®šæœ‰ä¸€ä¸ªç–‘é—®, å¦‚æžœä¸ºæ¯ä¸€ç§æŸ¥è¯¢éƒ½è®¾è®¡ä¸€ä¸ªç´¢å¼•, ç´¢å¼•æ˜¯ä¸æ˜¯å¤ªå¤šäº†. å¦‚æžœçŽ°åœ¨è¦æŒ‰ç…§å¸‚æ°‘çš„èº«ä»½è¯å·åŽ»æŸ¥ä»–çš„å®¶åº­åœ°å€å‘¢? è™½ç„¶è¿™ä¸ªæŸ¥è¯¢éœ€æ±‚åœ¨ä¸šåŠ¡ä¸­å‡ºçŽ°çš„æ¦‚çŽ‡ä¸é«˜, ä½†æ€»ä¸èƒ½è®©å®ƒèµ°å…¨è¡¨æ‰«æå§? åè¿‡æ¥è¯´, å•ç‹¬ä¸ºä¸€ä¸ªä¸é¢‘ç¹çš„è¯·æ±‚åˆ›å»ºä¸€ä¸ª(èº«ä»½è¯å·, åœ°å€)çš„ç´¢å¼•åˆæ„Ÿè§‰æœ‰ç‚¹æµªè´¹. åº”è¯¥æ€Žä¹ˆåšå‘¢?")]),s._v(" "),t("p",[s._v('å…ˆè¯´ç»“è®ºå§. **B+ æ ‘è¿™ç§ç´¢å¼•ç»“æž„, å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„"æœ€å·¦å‰ç¼€", æ¥å®šä½è®°å½•. **')]),s._v(" "),t("p",[s._v("ä¸ºäº†ç›´è§‚åœ°è¯´æ˜Žè¿™ä¸ªæ¦‚å¿µ, ç”¨(name, age)è¿™ä¸ªè”åˆç´¢å¼•æ¥åˆ†æž.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/52da187d9f3a7198e801750af2b2df29-20230731161914-601ajf5.png",alt:"",title:"(name, age)ç´¢å¼•ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ç´¢å¼•é¡¹æ˜¯"),t("strong",[s._v("æŒ‰ç…§ç´¢å¼•å®šä¹‰é‡Œé¢å‡ºçŽ°çš„å­—æ®µé¡ºåºæŽ’åº")]),s._v('çš„. å½“é€»è¾‘éœ€æ±‚æ˜¯æŸ¥åˆ°æ‰€æœ‰åå­—æ˜¯ "å¼ ä¸‰" çš„äººæ—¶, å¯ä»¥å¿«é€Ÿå®šä½åˆ° ID4, ç„¶åŽå‘åŽéåŽ†å¾—åˆ°æ‰€æœ‰éœ€è¦çš„ç»“æžœ.')]),s._v(" "),t("p",[s._v('å¦‚æžœè¦æŸ¥çš„æ˜¯æ‰€æœ‰åå­—ç¬¬ä¸€ä¸ªå­—æ˜¯"å¼ "çš„äºº, ä½ çš„ SQL è¯­å¥çš„æ¡ä»¶æ˜¯ "where name like \'å¼ %\'". è¿™æ—¶ä½ ä¹Ÿèƒ½å¤Ÿç”¨ä¸Šè¿™ä¸ªç´¢å¼•, '),t("strong",[s._v("æŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„è®°å½•æ˜¯ ID3, ç„¶åŽå‘åŽéåŽ†, ç›´åˆ°ä¸æ»¡è¶³æ¡ä»¶ä¸ºæ­¢")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å¯ä»¥çœ‹åˆ°, ä¸åªæ˜¯ç´¢å¼•çš„å…¨éƒ¨å®šä¹‰, åªè¦æ»¡è¶³æœ€å·¦å‰ç¼€, å°±å¯ä»¥åˆ©ç”¨ç´¢å¼•æ¥åŠ é€Ÿæ£€ç´¢. è¿™ä¸ªæœ€å·¦å‰ç¼€å¯ä»¥æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦ N ä¸ªå­—æ®µ, ä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç´¢å¼•çš„æœ€å·¦ M ä¸ªå­—ç¬¦.")])]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢å¯¹æœ€å·¦å‰ç¼€ç´¢å¼•çš„è¯´æ˜Ž, æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜: **åœ¨å»ºç«‹è”åˆç´¢å¼•çš„æ—¶å€™, å¦‚ä½•å®‰æŽ’ç´¢å¼•å†…çš„å­—æ®µé¡ºåº. **")]),s._v(" "),t("p",[s._v("è¿™é‡Œè¯„ä¼°æ ‡å‡†æ˜¯, ç´¢å¼•çš„å¤ç”¨èƒ½åŠ›. å› ä¸ºå¯ä»¥æ”¯æŒæœ€å·¦å‰ç¼€, æ‰€ä»¥å½“å·²ç»æœ‰äº† (a,b) è¿™ä¸ªè”åˆç´¢å¼•åŽ, ä¸€èˆ¬å°±ä¸éœ€è¦å•ç‹¬åœ¨ a ä¸Šå»ºç«‹ç´¢å¼•äº†. å› æ­¤**ç¬¬ä¸€åŽŸåˆ™æ˜¯, å¦‚æžœé€šè¿‡è°ƒæ•´é¡ºåº, å¯ä»¥å°‘ç»´æŠ¤ä¸€ä¸ªç´¢å¼•, é‚£ä¹ˆè¿™ä¸ªé¡ºåºå¾€å¾€å°±æ˜¯éœ€è¦ä¼˜å…ˆè€ƒè™‘é‡‡ç”¨çš„. **")]),s._v(" "),t("p",[s._v('æ‰€ä»¥çŽ°åœ¨ä½ çŸ¥é“äº†, è¿™æ®µå¼€å¤´çš„é—®é¢˜é‡Œ, è¦ä¸ºé«˜é¢‘è¯·æ±‚åˆ›å»º (èº«ä»½è¯å·, å§“å)è¿™ä¸ªè”åˆç´¢å¼•, å¹¶ç”¨è¿™ä¸ªç´¢å¼•æ”¯æŒ "æ ¹æ®èº«ä»½è¯å·æŸ¥è¯¢åœ°å€" çš„éœ€æ±‚.')]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, å¦‚æžœæ—¢æœ‰è”åˆæŸ¥è¯¢, åˆæœ‰åŸºäºŽ a, b å„è‡ªçš„æŸ¥è¯¢å‘¢? æŸ¥è¯¢æ¡ä»¶é‡Œé¢åªæœ‰ b çš„è¯­å¥, æ˜¯æ— æ³•ä½¿ç”¨ (a,b) è¿™ä¸ªè”åˆç´¢å¼•çš„, è¿™æ—¶å€™å°±ä¸å¾—ä¸ç»´æŠ¤å¦å¤–ä¸€ä¸ªç´¢å¼•, ä¹Ÿå°±éœ€è¦åŒæ—¶ç»´æŠ¤ (a,b), (b) è¿™ä¸¤ä¸ªç´¢å¼•.")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™å°±è¦"),t("strong",[s._v("è€ƒè™‘çš„åŽŸåˆ™å°±æ˜¯ç©ºé—´")]),s._v("äº†. æ¯”å¦‚ä¸Šé¢è¿™ä¸ªå¸‚æ°‘è¡¨çš„æƒ…å†µ, name å­—æ®µæ˜¯æ¯” age å­—æ®µå¤§çš„ , é‚£å°±å»ºè®®åˆ›å»ºä¸€ä¸ª(name,age) çš„è”åˆç´¢å¼•å’Œä¸€ä¸ª (age) çš„å•å­—æ®µç´¢å¼•.")]),s._v(" "),t("h5",{attrs:{id:"ç´¢å¼•ä¸‹æŽ¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç´¢å¼•ä¸‹æŽ¨"}},[s._v("#")]),s._v(" ç´¢å¼•ä¸‹æŽ¨")]),s._v(" "),t("p",[s._v("ä¸Šä¸€æ®µè¯´åˆ°æ»¡è¶³æœ€å·¦å‰ç¼€åŽŸåˆ™çš„æ—¶å€™, æœ€å·¦å‰ç¼€å¯ä»¥ç”¨äºŽåœ¨ç´¢å¼•ä¸­å®šä½è®°å½•. é‚£äº›ä¸ç¬¦åˆæœ€å·¦å‰ç¼€çš„éƒ¨åˆ†, ä¼šæ€Žä¹ˆæ ·å‘¢?")]),s._v(" "),t("p",[s._v('è¿˜æ˜¯ä»¥å¸‚æ°‘è¡¨çš„è”åˆç´¢å¼•(name, age)ä¸ºä¾‹. å¦‚æžœçŽ°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚: æ£€ç´¢å‡ºè¡¨ä¸­ "åå­—ç¬¬ä¸€ä¸ªå­—æ˜¯å¼ , è€Œä¸”å¹´é¾„æ˜¯ 10 å²çš„æ‰€æœ‰ç”·å­©". é‚£ä¹ˆ SQL è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„:')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tuser "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'å¼ %'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" ismale"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v('æ ¹æ®å‰ç¼€ç´¢å¼•è§„åˆ™, æ‰€ä»¥è¿™ä¸ªè¯­å¥åœ¨æœç´¢ç´¢å¼•æ ‘çš„æ—¶å€™, åªèƒ½ç”¨ "å¼ ", æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½• ID3. è¿™è¿˜ä¸é”™, æ€»æ¯”å…¨è¡¨æ‰«æè¦å¥½.')]),s._v(" "),t("p",[s._v("ç„¶åŽå‘¢? å½“ç„¶æ˜¯åˆ¤æ–­å…¶ä»–æ¡ä»¶æ˜¯å¦æ»¡è¶³.")]),s._v(" "),t("p",[s._v("åœ¨ MySQL 5.6 ä¹‹å‰, "),t("strong",[s._v("åªèƒ½ä»Ž ID3 å¼€å§‹ä¸€ä¸ªä¸ªå›žè¡¨. åˆ°ä¸»é”®ç´¢å¼•ä¸Šæ‰¾å‡ºæ•°æ®è¡Œ, å†å¯¹æ¯”å­—æ®µå€¼")]),s._v('. è¿™é‡Œåœ¨ (name,age) ç´¢å¼•é‡Œé¢ç‰¹æ„åŽ»æŽ‰äº† age çš„å€¼, è¿™ä¸ªè¿‡ç¨‹ InnoDB å¹¶ä¸ä¼šåŽ»çœ‹ age çš„å€¼, åªæ˜¯æŒ‰é¡ºåºæŠŠ "name ç¬¬ä¸€ä¸ªå­—æ˜¯å¼ " çš„è®°å½•ä¸€æ¡æ¡å–å‡ºæ¥å›žè¡¨. å› æ­¤éœ€è¦å›žè¡¨ 4 æ¬¡.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/fae0913ec7899b226b8a9d3833d4ac82-20230731161914-qklqryj.png",alt:"",title:"æ— ç´¢å¼•ä¸‹æŽ¨æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[t("strong",[s._v("è€Œ MySQL 5.6 å¼•å…¥çš„")]),s._v("â€‹"),t("mark",[t("strong",[s._v("ç´¢å¼•ä¸‹æŽ¨ä¼˜åŒ–")])]),s._v("â€‹ **(index condition pushdown), å¯ä»¥åœ¨ç´¢å¼•éåŽ†è¿‡ç¨‹ä¸­, å¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­, ç›´æŽ¥è¿‡æ»¤æŽ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•, å‡å°‘å›žè¡¨æ¬¡æ•°. **")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/313ee5d01ef9d6a2526279d95638f7d2-20230731161914-dqxzzsv.png",alt:"",title:"ç´¢å¼•ä¸‹æŽ¨æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("è¿™ä¸¤ä¸ªå›¾é‡Œé¢, æ¯ä¸€ä¸ªè™šçº¿ç®­å¤´è¡¨ç¤ºå›žè¡¨ä¸€æ¬¡.")]),s._v(" "),t("p",[s._v("ç´¢å¼•ä¸‹æŽ¨æµç¨‹çš„åŒºåˆ«æ˜¯, InnoDB åœ¨ (name,age) "),t("strong",[s._v("ç´¢å¼•å†…éƒ¨å°±åˆ¤æ–­äº† age æ˜¯å¦ç­‰äºŽ 10, å¯¹äºŽä¸ç­‰äºŽ 10 çš„è®°å½•, ç›´æŽ¥åˆ¤æ–­å¹¶è·³è¿‡")]),s._v(". è¿™ä¸ªä¾‹å­ä¸­, åªéœ€è¦å¯¹ ID4, ID5 è¿™ä¸¤æ¡è®°å½•å›žè¡¨å–æ•°æ®åˆ¤æ–­, å°±åªéœ€è¦å›žè¡¨ 2 æ¬¡.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-5"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚è®¨è®ºäº†æ•°æ®åº“ç´¢å¼•çš„æ¦‚å¿µ, åŒ…æ‹¬äº†è¦†ç›–ç´¢å¼•, å‰ç¼€ç´¢å¼•, ç´¢å¼•ä¸‹æŽ¨. å¯ä»¥çœ‹åˆ°, "),t("mark",[t("strong",[s._v("åœ¨æ»¡è¶³è¯­å¥éœ€æ±‚çš„æƒ…å†µä¸‹, å°½é‡å°‘åœ°è®¿é—®èµ„æºæ˜¯æ•°æ®åº“è®¾è®¡çš„é‡è¦åŽŸåˆ™ä¹‹ä¸€")])]),s._v(". åœ¨ä½¿ç”¨æ•°æ®åº“çš„æ—¶å€™, å°¤å…¶æ˜¯åœ¨è®¾è®¡è¡¨ç»“æž„æ—¶, ä¹Ÿè¦ä»¥å‡å°‘èµ„æºæ¶ˆè€—ä½œä¸ºç›®æ ‡.")]),s._v(" "),t("h4",{attrs:{id:"_06-å…¨å±€é”å’Œè¡¨é”-ç»™è¡¨åŠ ä¸ªå­—æ®µæ€Žä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_06-å…¨å±€é”å’Œè¡¨é”-ç»™è¡¨åŠ ä¸ªå­—æ®µæ€Žä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢"}},[s._v("#")]),s._v(" 06-å…¨å±€é”å’Œè¡¨é”:ç»™è¡¨åŠ ä¸ªå­—æ®µæ€Žä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢?")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚èŠèŠ MySQL çš„é”. æ•°æ®åº“é”è®¾è®¡çš„"),t("strong",[s._v("åˆè¡·æ˜¯å¤„ç†å¹¶å‘é—®é¢˜")]),s._v(". ä½œä¸ºå¤šç”¨æˆ·å…±äº«çš„èµ„æº, å½“å‡ºçŽ°å¹¶å‘è®¿é—®çš„æ—¶å€™, æ•°æ®åº“éœ€è¦åˆç†åœ°æŽ§åˆ¶èµ„æºçš„è®¿é—®è§„åˆ™. è€Œé”å°±æ˜¯ç”¨æ¥å®žçŽ°è¿™äº›è®¿é—®è§„åˆ™çš„é‡è¦æ•°æ®ç»“æž„.")]),s._v(" "),t("p",[t("strong",[s._v("æ ¹æ®åŠ é”çš„èŒƒå›´, MySQL é‡Œé¢çš„é”å¤§è‡´å¯ä»¥åˆ†æˆ")]),s._v("â€‹"),t("mark",[t("strong",[s._v("å…¨å±€é”, è¡¨çº§é”å’Œè¡Œé”")])]),s._v("â€‹"),t("strong",[s._v("ä¸‰ç±»")]),s._v(". æœ¬èŠ‚å…¨å±€é”å’Œè¡¨çº§é”, è€Œå…³äºŽè¡Œé”çš„å†…å®¹åœ¨ä¸‹èŠ‚ä»‹ç». éœ€è¦è¯´æ˜Žçš„æ˜¯, é”çš„è®¾è®¡æ¯”è¾ƒå¤æ‚, è¿™é‡Œä¸ä¼šæ¶‰åŠé”çš„å…·ä½“å®žçŽ°ç»†èŠ‚, ä¸»è¦ä»‹ç»çš„æ˜¯ç¢°åˆ°é”æ—¶çš„çŽ°è±¡å’Œå…¶èƒŒåŽçš„åŽŸç†.")]),s._v(" "),t("h5",{attrs:{id:"å…¨å±€é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¨å±€é”"}},[s._v("#")]),s._v(" å…¨å±€é”")]),s._v(" "),t("p",[s._v("é¡¾åæ€ä¹‰, "),t("strong",[s._v("å…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®žä¾‹åŠ é”")]),s._v(". MySQL æä¾›äº†ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•, å‘½ä»¤æ˜¯ Flush tables with read lock (FTWRL). å½“éœ€è¦è®©æ•´ä¸ªåº“å¤„äºŽåªè¯»çŠ¶æ€çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤, ä¹‹åŽå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ž: "),t("strong",[s._v("æ•°æ®æ›´æ–°è¯­å¥(æ•°æ®çš„å¢žåˆ æ”¹), æ•°æ®å®šä¹‰è¯­å¥(åŒ…æ‹¬å»ºè¡¨, ä¿®æ”¹è¡¨ç»“æž„ç­‰)å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥")]),s._v(".")]),s._v(" "),t("p",[s._v("**å…¨å±€é”çš„å…¸åž‹ä½¿ç”¨åœºæ™¯æ˜¯, åšå…¨åº“é€»è¾‘å¤‡ä»½. **ä¹Ÿå°±æ˜¯æŠŠæ•´åº“æ¯ä¸ªè¡¨éƒ½ select å‡ºæ¥å­˜æˆæ–‡æœ¬.")]),s._v(" "),t("p",[s._v("ä»¥å‰æœ‰ä¸€ç§åšæ³•, æ˜¯é€šè¿‡ FTWRL ç¡®ä¿ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å¯¹æ•°æ®åº“åšæ›´æ–°, ç„¶åŽå¯¹æ•´ä¸ªåº“åšå¤‡ä»½. æ³¨æ„, åœ¨å¤‡ä»½è¿‡ç¨‹ä¸­"),t("strong",[s._v("æ•´ä¸ªåº“å®Œå…¨å¤„äºŽåªè¯»çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æ˜¯è®©æ•´åº“éƒ½åªè¯», å¬ä¸ŠåŽ»å°±å¾ˆå±é™©:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å¦‚æžœä½ åœ¨ä¸»åº“ä¸Šå¤‡ä»½, é‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°, ä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—åœæ‘†;")])]),s._v(" "),t("li",[t("strong",[s._v("å¦‚æžœä½ åœ¨ä»Žåº“ä¸Šå¤‡ä»½, é‚£ä¹ˆå¤‡ä»½æœŸé—´ä»Žåº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„ binlog, ä¼šå¯¼è‡´ä¸»ä»Žå»¶è¿Ÿ.")])])]),s._v(" "),t("p",[s._v("çœ‹æ¥åŠ å…¨å±€é”ä¸å¤ªå¥½. ä½†æ˜¯ç»†æƒ³ä¸€ä¸‹, å¤‡ä»½ä¸ºä»€ä¹ˆè¦åŠ é”å‘¢? æ¥çœ‹ä¸€ä¸‹ä¸åŠ é”ä¼šæœ‰ä»€ä¹ˆé—®é¢˜.")]),s._v(" "),t("p",[s._v('å‡è®¾ä½ çŽ°åœ¨è¦ç»´æŠ¤ "æžå®¢æ—¶é—´" çš„è´­ä¹°ç³»ç»Ÿ, å…³æ³¨çš„æ˜¯ç”¨æˆ·è´¦æˆ·ä½™é¢è¡¨å’Œç”¨æˆ·è¯¾ç¨‹è¡¨. çŽ°åœ¨å‘èµ·ä¸€ä¸ªé€»è¾‘å¤‡ä»½. å‡è®¾å¤‡ä»½æœŸé—´, æœ‰ä¸€ä¸ªç”¨æˆ·, ä»–è´­ä¹°äº†ä¸€é—¨è¯¾ç¨‹, ä¸šåŠ¡é€»è¾‘é‡Œå°±è¦æ‰£æŽ‰ä»–çš„ä½™é¢, ç„¶åŽå¾€å·²è´­è¯¾ç¨‹é‡Œé¢åŠ ä¸Šä¸€é—¨è¯¾.')]),s._v(" "),t("p",[s._v("å¦‚æžœæ—¶é—´é¡ºåºä¸Šæ˜¯å…ˆå¤‡ä»½è´¦æˆ·ä½™é¢è¡¨ (u_account), ç„¶åŽç”¨æˆ·è´­ä¹°, ç„¶åŽå¤‡ä»½ç”¨æˆ·è¯¾ç¨‹è¡¨ (u_course), ä¼šæ€Žä¹ˆæ ·å‘¢? å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªå›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b251bfd81c3d8c01fd56e34b0d7f6e24-20230731161914-eejc3qt.png",alt:"",title:"ä¸šåŠ¡å’Œå¤‡ä»½çŠ¶æ€å›¾"}})]),s._v(" "),t("p",[s._v('å¯ä»¥çœ‹åˆ°, è¿™ä¸ªå¤‡ä»½ç»“æžœé‡Œ, ç”¨æˆ· A çš„æ•°æ®çŠ¶æ€æ˜¯ "è´¦æˆ·ä½™é¢æ²¡æ‰£, ä½†æ˜¯ç”¨æˆ·è¯¾ç¨‹è¡¨é‡Œé¢å·²ç»å¤šäº†ä¸€é—¨è¯¾". å¦‚æžœåŽé¢ç”¨è¿™ä¸ªå¤‡ä»½æ¥æ¢å¤æ•°æ®çš„è¯, ç”¨æˆ· A å°±å‘çŽ°, è‡ªå·±èµšäº†.')]),s._v(" "),t("p",[s._v("ä½œä¸ºç”¨æˆ·å¯åˆ«è§‰å¾—è¿™æ ·å¯çœŸå¥½å•Š, ä½ å¯ä»¥è¯•æƒ³ä¸€ä¸‹: å¦‚æžœå¤‡ä»½è¡¨çš„é¡ºåºåè¿‡æ¥, å…ˆå¤‡ä»½ç”¨æˆ·è¯¾ç¨‹è¡¨å†å¤‡ä»½è´¦æˆ·ä½™é¢è¡¨, åˆå¯èƒ½ä¼šå‡ºçŽ°ä»€ä¹ˆç»“æžœ? ä¹Ÿå°±æ˜¯è¯´, ä¸åŠ é”çš„è¯, å¤‡ä»½ç³»ç»Ÿå¤‡ä»½çš„å¾—åˆ°çš„åº“ä¸æ˜¯ä¸€ä¸ªé€»è¾‘æ—¶é—´ç‚¹, è¿™ä¸ªè§†å›¾æ˜¯é€»è¾‘ä¸ä¸€è‡´çš„.")]),s._v(" "),t("p",[s._v("è¯´åˆ°è§†å›¾ä½ è‚¯å®šæƒ³èµ·æ¥äº†, åœ¨å‰é¢è®²äº‹åŠ¡éš”ç¦»çš„æ—¶å€™, å…¶å®žæ˜¯æœ‰ä¸€ä¸ªæ–¹æ³•èƒ½å¤Ÿæ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾çš„, å¯¹å§? æ˜¯çš„, å°±æ˜¯åœ¨"),t("strong",[s._v("å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¼€å¯ä¸€ä¸ªäº‹åŠ¡")]),s._v(".")]),s._v(" "),t("p",[s._v("å®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·æ˜¯ mysqldump. å½“ mysqldump ä½¿ç”¨å‚æ•° â€“single-transaction çš„æ—¶å€™, "),t("strong",[s._v("å¯¼æ•°æ®ä¹‹å‰å°±ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡, æ¥ç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾")]),s._v(". è€Œç”±äºŽ MVCC çš„æ”¯æŒ, è¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„.")]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šåœ¨ç–‘æƒ‘, æœ‰äº†è¿™ä¸ªåŠŸèƒ½, ä¸ºä»€ä¹ˆè¿˜éœ€è¦ FTWRL å‘¢? **ä¸€è‡´æ€§è¯»æ˜¯å¥½, ä½†å‰ææ˜¯å¼•æ“Žè¦æ”¯æŒè¿™ä¸ªéš”ç¦»çº§åˆ«. ** æ¯”å¦‚, å¯¹äºŽ MyISAM è¿™ç§ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“Ž, å¦‚æžœå¤‡ä»½è¿‡ç¨‹ä¸­æœ‰æ›´æ–°, æ€»æ˜¯åªèƒ½å–åˆ°æœ€æ–°çš„æ•°æ®, é‚£ä¹ˆå°±ç ´åäº†å¤‡ä»½çš„ä¸€è‡´æ€§. è¿™æ—¶å°±éœ€è¦ä½¿ç”¨ FTWRL å‘½ä»¤äº†.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ "),t("mark",[t("strong",[s._v("single-transaction æ–¹æ³•åªé€‚ç”¨äºŽæ‰€æœ‰çš„è¡¨ä½¿ç”¨äº‹åŠ¡å¼•æ“Žçš„åº“")])]),s._v("â€‹ **. ** å¦‚æžœæœ‰çš„è¡¨ä½¿ç”¨äº†ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“Ž, é‚£ä¹ˆå¤‡ä»½å°±åªèƒ½é€šè¿‡ FTWRL æ–¹æ³•. è¿™å¾€å¾€æ˜¯ DBA è¦æ±‚ä¸šåŠ¡å¼€å‘äººå‘˜ä½¿ç”¨ InnoDB æ›¿ä»£ MyISAM çš„åŽŸå› ä¹‹ä¸€.")]),s._v(" "),t("p",[s._v("ä½ ä¹Ÿè®¸ä¼šé—®, "),t("strong",[s._v("æ—¢ç„¶è¦å…¨åº“åªè¯», ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ set global readonly=true çš„æ–¹å¼å‘¢")]),s._v("? ç¡®å®ž readonly æ–¹å¼ä¹Ÿå¯ä»¥è®©å…¨åº“è¿›å…¥åªè¯»çŠ¶æ€, ä½†è¿˜æ˜¯å»ºè®® FTWRL æ–¹å¼, ä¸»è¦æœ‰ä¸¤ä¸ªåŽŸå› :")]),s._v(" "),t("ul",[t("li",[s._v("ä¸€æ˜¯, åœ¨æœ‰äº›ç³»ç»Ÿä¸­, readonly çš„å€¼ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘, æ¯”å¦‚ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªåº“æ˜¯ä¸»åº“è¿˜æ˜¯å¤‡åº“. å› æ­¤ä¿®æ”¹ global å˜é‡çš„æ–¹å¼å½±å“é¢æ›´å¤§, ä¸å»ºè®®ä½¿ç”¨.")]),s._v(" "),t("li",[s._v("äºŒæ˜¯, åœ¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸Šæœ‰å·®å¼‚. å¦‚æžœæ‰§è¡Œ FTWRL å‘½ä»¤ä¹‹åŽç”±äºŽå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€, é‚£ä¹ˆ MySQL ä¼š"),t("strong",[s._v("è‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”")]),s._v(", æ•´ä¸ªåº“å›žåˆ°å¯ä»¥æ­£å¸¸æ›´æ–°çš„çŠ¶æ€. è€Œå°†æ•´ä¸ªåº“è®¾ç½®ä¸º readonly ä¹‹åŽ, å¦‚æžœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸, åˆ™æ•°æ®åº“å°±ä¼šä¸€ç›´ä¿æŒ readonly çŠ¶æ€, è¿™æ ·ä¼šå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶é—´å¤„äºŽä¸å¯å†™çŠ¶æ€, é£Žé™©è¾ƒé«˜.")])]),s._v(" "),t("p",[s._v("ä¸šåŠ¡çš„æ›´æ–°ä¸åªæ˜¯å¢žåˆ æ”¹æ•°æ®(DML), è¿˜æœ‰å¯èƒ½æ˜¯åŠ å­—æ®µç­‰ä¿®æ”¹è¡¨ç»“æž„çš„æ“ä½œ(DDL). ä¸è®ºæ˜¯å“ªç§æ–¹æ³•, ä¸€ä¸ªåº“è¢«å…¨å±€é”ä¸Šä»¥åŽ, ä½ è¦å¯¹é‡Œé¢ä»»ä½•ä¸€ä¸ªè¡¨åšåŠ å­—æ®µæ“ä½œ, éƒ½æ˜¯ä¼šè¢«é”ä½çš„.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, å³ä½¿æ²¡æœ‰è¢«å…¨å±€é”ä½, åŠ å­—æ®µä¹Ÿä¸æ˜¯å°±èƒ½ä¸€å¸†é£Žé¡ºçš„, å› ä¸ºä½ è¿˜ä¼šç¢°åˆ°æŽ¥ä¸‹æ¥è¦ä»‹ç»çš„è¡¨çº§é”.")]),s._v(" "),t("h5",{attrs:{id:"è¡¨çº§é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¡¨çº§é”"}},[s._v("#")]),s._v(" è¡¨çº§é”")]),s._v(" "),t("p",[s._v("MySQL é‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§: "),t("strong",[s._v("ä¸€ç§æ˜¯è¡¨é”, ä¸€ç§æ˜¯å…ƒæ•°æ®é”(meta data lock, MDL)")]),s._v(" .")]),s._v(" "),t("p",[s._v("**è¡¨é”çš„è¯­æ³•æ˜¯ lock tables ... read/write. ** ä¸Ž FTWRL ç±»ä¼¼, å¯ä»¥ç”¨ unlock tables ä¸»åŠ¨é‡Šæ”¾é”, ä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾. éœ€è¦æ³¨æ„, lock tables è¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–, ä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æŽ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡.")]),s._v(" "),t("p",[s._v("ä¸¾ä¸ªä¾‹å­, å¦‚æžœåœ¨æŸä¸ªçº¿ç¨‹ A ä¸­æ‰§è¡Œ "),t("code",[s._v("lock tables t1 read, t2 write;")]),s._v("â€‹ è¿™ä¸ªè¯­å¥, åˆ™å…¶ä»–çº¿ç¨‹å†™ t1, è¯»å†™ t2 çš„è¯­å¥éƒ½ä¼šè¢«é˜»å¡ž. åŒæ—¶çº¿ç¨‹ A åœ¨æ‰§è¡Œ unlock tables ä¹‹å‰, ä¹Ÿ"),t("strong",[s._v("åªèƒ½æ‰§è¡Œè¯» t1, è¯»å†™ t2 çš„æ“ä½œ")]),s._v(". è¿žå†™ t1 éƒ½ä¸å…è®¸, è‡ªç„¶ä¹Ÿä¸èƒ½è®¿é—®å…¶ä»–è¡¨.")]),s._v(" "),t("p",[s._v("åœ¨è¿˜æ²¡æœ‰å‡ºçŽ°æ›´ç»†ç²’åº¦çš„é”çš„æ—¶å€™, è¡¨é”æ˜¯æœ€å¸¸ç”¨çš„å¤„ç†å¹¶å‘çš„æ–¹å¼. è€Œå¯¹äºŽ InnoDB è¿™ç§æ”¯æŒè¡Œé”çš„å¼•æ“Ž, "),t("strong",[s._v("ä¸€èˆ¬ä¸ä½¿ç”¨ lock tables å‘½ä»¤æ¥æŽ§åˆ¶å¹¶å‘")]),s._v(", æ¯•ç«Ÿé”ä½æ•´ä¸ªè¡¨çš„å½±å“é¢è¿˜æ˜¯å¤ªå¤§.")]),s._v(" "),t("p",[s._v("**å¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯ MDL(metadata lock). ** MDL ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨, "),t("strong",[s._v("åœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Š. MDL çš„ä½œç”¨æ˜¯, ä¿è¯è¯»å†™çš„æ­£ç¡®æ€§")]),s._v(". å¯ä»¥æƒ³è±¡ä¸€ä¸‹, å¦‚æžœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éåŽ†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®, è€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æž„åšå˜æ›´, åˆ äº†ä¸€åˆ—, é‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æžœè·Ÿè¡¨ç»“æž„å¯¹ä¸ä¸Š, è‚¯å®šæ˜¯ä¸è¡Œçš„.")]),s._v(" "),t("p",[s._v("å› æ­¤, åœ¨ MySQL 5.5 ç‰ˆæœ¬ä¸­å¼•å…¥äº† MDL, "),t("strong",[s._v("å½“å¯¹ä¸€ä¸ªè¡¨åšå¢žåˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™, åŠ  MDL è¯»é”; å½“è¦å¯¹è¡¨åšç»“æž„å˜æ›´æ“ä½œçš„æ—¶å€™, åŠ  MDL å†™é”")]),s._v(".")]),s._v(" "),t("ul",[t("li",[s._v("è¯»é”ä¹‹é—´ä¸äº’æ–¥, å› æ­¤å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢žåˆ æ”¹æŸ¥.")]),s._v(" "),t("li",[s._v("è¯»å†™é”ä¹‹é—´, å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„, ç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æž„æ“ä½œçš„å®‰å…¨æ€§. "),t("strong",[s._v("å› æ­¤å¦‚æžœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µ, å…¶ä¸­ä¸€ä¸ªè¦ç­‰å¦ä¸€ä¸ªæ‰§è¡Œå®Œæ‰èƒ½å¼€å§‹æ‰§è¡Œ")]),s._v(".")])]),s._v(" "),t("p",[s._v("è™½ç„¶ MDL é”æ˜¯ç³»ç»Ÿé»˜è®¤ä¼šåŠ çš„, ä½†å´æ˜¯ä¸èƒ½å¿½ç•¥çš„ä¸€ä¸ªæœºåˆ¶. æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­, æˆ‘ç»å¸¸çœ‹åˆ°æœ‰äººæŽ‰åˆ°è¿™ä¸ªå‘é‡Œ: "),t("strong",[s._v("ç»™ä¸€ä¸ªå°è¡¨åŠ ä¸ªå­—æ®µ, å¯¼è‡´æ•´ä¸ªåº“æŒ‚äº†")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ è‚¯å®šçŸ¥é“, ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µ, æˆ–è€…ä¿®æ”¹å­—æ®µ, æˆ–è€…åŠ ç´¢å¼•, éœ€è¦"),t("strong",[s._v("æ‰«æå…¨è¡¨çš„æ•°æ®")]),s._v(". åœ¨å¯¹å¤§è¡¨æ“ä½œçš„æ—¶å€™, ä½ è‚¯å®šä¼šç‰¹åˆ«å°å¿ƒ, ä»¥å…å¯¹çº¿ä¸ŠæœåŠ¡é€ æˆå½±å“. è€Œå®žé™…ä¸Š, å³ä½¿æ˜¯å°è¡¨, æ“ä½œä¸æ…Žä¹Ÿä¼šå‡ºé—®é¢˜. æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„æ“ä½œåºåˆ—, å‡è®¾è¡¨ t æ˜¯ä¸€ä¸ªå°è¡¨.")]),s._v(" "),t("blockquote",[t("p",[s._v("å¤‡æ³¨: è¿™é‡Œçš„å®žéªŒçŽ¯å¢ƒæ˜¯ MySQL 5.6.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/439ede702af5b9f3279ba82467a7b822-20230731161914-c3lwj9a.png",alt:""}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ° session A å…ˆå¯åŠ¨, è¿™æ—¶å€™ä¼š"),t("strong",[s._v("å¯¹è¡¨ t åŠ ä¸€ä¸ª MDL è¯»é”")]),s._v(". ç”±äºŽ session B éœ€è¦çš„ä¹Ÿæ˜¯ MDL è¯»é”, å› æ­¤å¯ä»¥æ­£å¸¸æ‰§è¡Œ.")]),s._v(" "),t("p",[s._v("ä¹‹åŽ session C ä¼š"),t("strong",[s._v("è¢« blocked")]),s._v(", æ˜¯å› ä¸º session A çš„ MDL "),t("strong",[s._v("è¯»é”è¿˜æ²¡æœ‰é‡Šæ”¾")]),s._v(", è€Œ session C éœ€è¦ MDL å†™é”, å› æ­¤åªèƒ½è¢«é˜»å¡ž.")]),s._v(" "),t("p",[s._v("å¦‚æžœåªæœ‰ session C è‡ªå·±è¢«é˜»å¡žè¿˜æ²¡ä»€ä¹ˆå…³ç³», ä½†æ˜¯ä¹‹åŽæ‰€æœ‰è¦åœ¨è¡¨ t ä¸Š"),t("strong",[s._v("æ–°ç”³è¯· MDL è¯»é”çš„è¯·æ±‚ä¹Ÿä¼šè¢« session C é˜»å¡ž")]),s._v(". å‰é¢è¯´äº†, æ‰€æœ‰å¯¹è¡¨çš„å¢žåˆ æ”¹æŸ¥æ“ä½œéƒ½éœ€è¦å…ˆç”³è¯· MDL è¯»é”, å°±éƒ½è¢«é”ä½, ç­‰äºŽè¿™ä¸ªè¡¨çŽ°åœ¨å®Œå…¨ä¸å¯è¯»å†™äº†.")]),s._v(" "),t("p",[s._v("å¦‚æžœæŸä¸ªè¡¨ä¸Šçš„æŸ¥è¯¢è¯­å¥é¢‘ç¹, è€Œä¸”å®¢æˆ·ç«¯æœ‰é‡è¯•æœºåˆ¶, ä¹Ÿå°±æ˜¯è¯´"),t("strong",[s._v("è¶…æ—¶åŽä¼šå†èµ·ä¸€ä¸ªæ–° session å†è¯·æ±‚çš„è¯, è¿™ä¸ªåº“çš„çº¿ç¨‹å¾ˆå¿«å°±ä¼šçˆ†æ»¡")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å› æ­¤, äº‹åŠ¡ä¸­çš„ MDL é”, åœ¨è¯­å¥æ‰§è¡Œå¼€å§‹æ—¶ç”³è¯·, ä½†æ˜¯è¯­å¥ç»“æŸåŽå¹¶ä¸ä¼šé©¬ä¸Šé‡Šæ”¾, è€Œä¼šç­‰åˆ°æ•´ä¸ªäº‹åŠ¡æäº¤åŽå†é‡Šæ”¾.")])]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢çš„åˆ†æž, æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜, **å¦‚ä½•å®‰å…¨åœ°ç»™å°è¡¨åŠ å­—æ®µ? **")]),s._v(" "),t("p",[s._v("é¦–å…ˆè¦"),t("strong",[s._v("è§£å†³é•¿äº‹åŠ¡, äº‹åŠ¡ä¸æäº¤, å°±ä¼šä¸€ç›´å ç€ MDL é”")]),s._v(". åœ¨ MySQL çš„ information_schema åº“çš„ innodb_trx è¡¨ä¸­, å¯ä»¥æŸ¥åˆ°å½“å‰æ‰§è¡Œä¸­çš„äº‹åŠ¡. å¦‚æžœè¦åš DDL å˜æ›´çš„è¡¨åˆšå¥½æœ‰é•¿äº‹åŠ¡åœ¨æ‰§è¡Œ, è¦è€ƒè™‘å…ˆæš‚åœ DDL, æˆ–è€… kill æŽ‰è¿™ä¸ªé•¿äº‹åŠ¡.")]),s._v(" "),t("p",[s._v("ä½†è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªåœºæ™¯. å¦‚æžœè¦å˜æ›´çš„è¡¨æ˜¯ä¸€ä¸ª"),t("strong",[s._v("çƒ­ç‚¹è¡¨")]),s._v(", è™½ç„¶æ•°æ®é‡ä¸å¤§, ä½†æ˜¯ä¸Šé¢çš„è¯·æ±‚å¾ˆé¢‘ç¹, è€Œä½ ä¸å¾—ä¸åŠ ä¸ªå­—æ®µ, ä½ è¯¥æ€Žä¹ˆåšå‘¢?")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™ kill å¯èƒ½æœªå¿…ç®¡ç”¨, å› ä¸ºæ–°çš„è¯·æ±‚é©¬ä¸Šå°±æ¥äº†. æ¯”è¾ƒç†æƒ³çš„æœºåˆ¶æ˜¯, "),t("strong",[s._v("åœ¨ alter table è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´, å¦‚æžœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ° MDL å†™é”æœ€å¥½, æ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡žåŽé¢çš„ä¸šåŠ¡è¯­å¥, å…ˆæ”¾å¼ƒ")]),s._v(". ä¹‹åŽå¼€å‘äººå‘˜æˆ–è€… DBA å†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("MariaDB å·²ç»åˆå¹¶äº† AliSQL çš„è¿™ä¸ªåŠŸèƒ½, æ‰€ä»¥è¿™ä¸¤ä¸ªå¼€æºåˆ†æ”¯ç›®å‰éƒ½æ”¯æŒ DDL NOWAIT/WAIT n è¿™ä¸ªè¯­æ³•.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl_name NOWAIT "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl_name WAIT N "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h5",{attrs:{id:"å°ç»“-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-6"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL çš„å…¨å±€é”å’Œè¡¨çº§é”. "),t("strong",[s._v("å…¨å±€é”ä¸»è¦ç”¨åœ¨é€»è¾‘å¤‡ä»½è¿‡ç¨‹ä¸­")]),s._v(". å¯¹äºŽå…¨éƒ¨æ˜¯ InnoDB å¼•æ“Žçš„åº“, å»ºè®®é€‰æ‹©ä½¿ç”¨  "),t("strong",[s._v("â€“single-transaction")]),s._v(" å‚æ•°, å¯¹åº”ç”¨ä¼šæ›´å‹å¥½.")]),s._v(" "),t("p",[s._v("è¡¨é”ä¸€èˆ¬æ˜¯åœ¨æ•°æ®åº“å¼•æ“Žä¸æ”¯æŒè¡Œé”çš„æ—¶å€™æ‰ä¼šè¢«ç”¨åˆ°çš„. å¦‚æžœä½ å‘çŽ°ä½ çš„åº”ç”¨ç¨‹åºé‡Œæœ‰ lock tables è¿™æ ·çš„è¯­å¥, ä½ éœ€è¦è¿½æŸ¥ä¸€ä¸‹, æ¯”è¾ƒå¯èƒ½çš„æƒ…å†µæ˜¯:")]),s._v(" "),t("ul",[t("li",[s._v("è¦ä¹ˆæ˜¯ç³»ç»ŸçŽ°åœ¨è¿˜åœ¨ç”¨ MyISAM è¿™ç±»ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“Ž, é‚£è¦å®‰æŽ’å‡çº§æ¢å¼•æ“Ž;")]),s._v(" "),t("li",[s._v("è¦ä¹ˆæ˜¯å¼•æ“Žå‡çº§äº†, ä½†æ˜¯ä»£ç è¿˜æ²¡å‡çº§. æˆ‘è§è¿‡è¿™æ ·çš„æƒ…å†µ, æœ€åŽä¸šåŠ¡å¼€å‘å°±æ˜¯æŠŠ lock tables å’Œ unlock tables æ”¹æˆ begin å’Œ commit, é—®é¢˜å°±è§£å†³äº†.")])]),s._v(" "),t("p",[t("strong",[s._v("MDL ä¼šç›´åˆ°äº‹åŠ¡æäº¤æ‰é‡Šæ”¾, åœ¨åšè¡¨ç»“æž„å˜æ›´çš„æ—¶å€™, ä¸€å®šè¦å°å¿ƒä¸è¦å¯¼è‡´é”ä½çº¿ä¸ŠæŸ¥è¯¢å’Œæ›´æ–°.")])]),s._v(" "),t("h4",{attrs:{id:"_07-è¡Œé”åŠŸè¿‡-æ€Žä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_07-è¡Œé”åŠŸè¿‡-æ€Žä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“"}},[s._v("#")]),s._v(" 07-è¡Œé”åŠŸè¿‡:æ€Žä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“?")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šä¸€èŠ‚ä»‹ç»äº† MySQL çš„å…¨å±€é”å’Œè¡¨çº§é”, ä»Šå¤©å°±æ¥è®²è®² "),t("strong",[s._v("MySQL çš„è¡Œé”")]),s._v(".")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("MySQL çš„è¡Œé”æ˜¯åœ¨å¼•æ“Žå±‚ç”±å„ä¸ªå¼•æ“Žè‡ªå·±å®žçŽ°çš„")])]),s._v(". ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“Žéƒ½æ”¯æŒè¡Œé”, æ¯”å¦‚ MyISAM å¼•æ“Žå°±ä¸æ”¯æŒè¡Œé”. ä¸æ”¯æŒè¡Œé”æ„å‘³ç€å¹¶å‘æŽ§åˆ¶åªèƒ½ä½¿ç”¨è¡¨é”, å¯¹äºŽè¿™ç§å¼•æ“Žçš„è¡¨, åŒä¸€å¼ è¡¨ä¸Šä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°åœ¨æ‰§è¡Œ, è¿™å°±ä¼šå½±å“åˆ°ä¸šåŠ¡å¹¶å‘åº¦. "),t("strong",[s._v("InnoDB æ˜¯æ”¯æŒè¡Œé”çš„")]),s._v(", è¿™ä¹Ÿæ˜¯ MyISAM è¢« InnoDB æ›¿ä»£çš„é‡è¦åŽŸå› ä¹‹ä¸€.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚èŠèŠ InnoDB çš„è¡Œé”, ä»¥åŠå¦‚ä½•"),t("strong",[s._v("é€šè¿‡å‡å°‘é”å†²çªæ¥æå‡ä¸šåŠ¡å¹¶å‘åº¦")]),s._v(".")]),s._v(" "),t("p",[s._v("é¡¾åæ€ä¹‰, "),t("mark",[t("strong",[s._v("è¡Œé”å°±æ˜¯é’ˆå¯¹æ•°æ®è¡¨ä¸­è¡Œè®°å½•çš„é”")])]),s._v(". è¿™å¾ˆå¥½ç†è§£, "),t("strong",[s._v("æ¯”å¦‚äº‹åŠ¡ A æ›´æ–°äº†ä¸€è¡Œ, è€Œè¿™æ—¶å€™äº‹åŠ¡ B ä¹Ÿè¦æ›´æ–°åŒä¸€è¡Œ, åˆ™å¿…é¡»ç­‰äº‹åŠ¡ A çš„æ“ä½œå®ŒæˆåŽæ‰èƒ½è¿›è¡Œæ›´æ–°")]),s._v(". å½“ç„¶, æ•°æ®åº“ä¸­è¿˜æœ‰ä¸€äº›æ²¡é‚£ä¹ˆä¸€ç›®äº†ç„¶çš„æ¦‚å¿µå’Œè®¾è®¡, è¿™äº›æ¦‚å¿µå¦‚æžœç†è§£å’Œä½¿ç”¨ä¸å½“, å®¹æ˜“å¯¼è‡´ç¨‹åºå‡ºçŽ°éžé¢„æœŸè¡Œä¸º, æ¯”å¦‚ä¸¤é˜¶æ®µé”.")]),s._v(" "),t("h5",{attrs:{id:"ä»Žä¸¤é˜¶æ®µé”è¯´èµ·"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»Žä¸¤é˜¶æ®µé”è¯´èµ·"}},[s._v("#")]),s._v(" ä»Žä¸¤é˜¶æ®µé”è¯´èµ·")]),s._v(" "),t("p",[s._v("å…ˆä¸¾ä¸ªä¾‹å­. åœ¨ä¸‹é¢çš„æ“ä½œåºåˆ—ä¸­, äº‹åŠ¡ B çš„ update è¯­å¥æ‰§è¡Œæ—¶ä¼šæ˜¯ä»€ä¹ˆçŽ°è±¡å‘¢? å‡è®¾å­—æ®µ id æ˜¯è¡¨ t çš„ä¸»é”®.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8b3c554cc6619376c102de08b8140c5b-20230731161914-bw2ro25.png",alt:""}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜çš„ç»“è®ºå–å†³äºŽ"),t("strong",[s._v("äº‹åŠ¡ A åœ¨æ‰§è¡Œå®Œä¸¤æ¡ update è¯­å¥åŽ, æŒæœ‰å“ªäº›é”, ä»¥åŠåœ¨ä»€ä¹ˆæ—¶å€™é‡Šæ”¾")]),s._v(". ä½ å¯ä»¥éªŒè¯ä¸€ä¸‹: å®žé™…ä¸Šäº‹åŠ¡ B çš„ update è¯­å¥ä¼šè¢«é˜»å¡ž, ç›´åˆ°äº‹åŠ¡ A æ‰§è¡Œ commit ä¹‹åŽ, äº‹åŠ¡ B æ‰èƒ½ç»§ç»­æ‰§è¡Œ.")]),s._v(" "),t("p",[s._v("çŸ¥é“äº†è¿™ä¸ªç­”æ¡ˆ, ä½ ä¸€å®šçŸ¥é“äº†äº‹åŠ¡ A æŒæœ‰çš„ä¸¤ä¸ªè®°å½•çš„è¡Œé”, éƒ½æ˜¯"),t("strong",[s._v("åœ¨ commit çš„æ—¶å€™æ‰é‡Šæ”¾")]),s._v("çš„. ä¹Ÿå°±æ˜¯è¯´, "),t("mark",[t("strong",[s._v("åœ¨ InnoDB äº‹åŠ¡ä¸­, è¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„, ä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾, è€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾. è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("çŸ¥é“äº†è¿™ä¸ªè®¾å®š, å¯¹ä½¿ç”¨äº‹åŠ¡æœ‰ä»€ä¹ˆå¸®åŠ©å‘¢? é‚£å°±æ˜¯, å¦‚æžœä½ çš„äº‹åŠ¡ä¸­"),t("strong",[s._v("éœ€è¦é”å¤šä¸ªè¡Œ, è¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çª, æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åŽæ”¾")]),s._v(". ä¸¾ä¸ªä¾‹å­.")]),s._v(" "),t("p",[s._v("å‡è®¾ä½ è´Ÿè´£å®žçŽ°ä¸€ä¸ªç”µå½±ç¥¨åœ¨çº¿äº¤æ˜“ä¸šåŠ¡, é¡¾å®¢ A è¦åœ¨å½±é™¢ B è´­ä¹°ç”µå½±ç¥¨. ç®€åŒ–ä¸€ç‚¹, è¿™ä¸ªä¸šåŠ¡éœ€è¦æ¶‰åŠåˆ°ä»¥ä¸‹æ“ä½œ:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Žé¡¾å®¢ A è´¦æˆ·ä½™é¢ä¸­æ‰£é™¤ç”µå½±ç¥¨ä»·;")]),s._v(" "),t("li",[s._v("ç»™å½±é™¢ B çš„è´¦æˆ·ä½™é¢å¢žåŠ è¿™å¼ ç”µå½±ç¥¨ä»·;")]),s._v(" "),t("li",[s._v("è®°å½•ä¸€æ¡äº¤æ˜“æ—¥å¿—.")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, è¦å®Œæˆè¿™ä¸ªäº¤æ˜“, éœ€è¦ update ä¸¤æ¡è®°å½•, å¹¶ insert ä¸€æ¡è®°å½•. ä¸ºäº†ä¿è¯äº¤æ˜“çš„åŽŸå­æ€§, éœ€è¦æŠŠè¿™ä¸‰ä¸ªæ“ä½œæ”¾åœ¨ä¸€ä¸ª"),t("strong",[s._v("äº‹åŠ¡")]),s._v("ä¸­. é‚£ä¹ˆ, ä½ ä¼šæ€Žæ ·å®‰æŽ’è¿™ä¸‰ä¸ªè¯­å¥åœ¨äº‹åŠ¡ä¸­çš„é¡ºåºå‘¢?")]),s._v(" "),t("p",[s._v("è¯•æƒ³å¦‚æžœåŒæ—¶æœ‰å¦å¤–ä¸€ä¸ªé¡¾å®¢ C è¦åœ¨å½±é™¢ B ä¹°ç¥¨, é‚£ä¹ˆè¿™"),t("strong",[s._v("ä¸¤ä¸ªäº‹åŠ¡å†²çªçš„éƒ¨åˆ†å°±æ˜¯è¯­å¥ 2 äº†")]),s._v(". å› ä¸ºå®ƒä»¬è¦æ›´æ–°åŒä¸€ä¸ªå½±é™¢è´¦æˆ·çš„ä½™é¢, éœ€è¦ä¿®æ”¹åŒä¸€è¡Œæ•°æ®.")]),s._v(" "),t("p",[t("strong",[s._v("æ ¹æ®ä¸¤é˜¶æ®µé”åè®®, ä¸è®ºæ€Žæ ·å®‰æŽ’è¯­å¥é¡ºåº, æ‰€æœ‰çš„æ“ä½œéœ€è¦çš„è¡Œé”éƒ½æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™æ‰é‡Šæ”¾çš„")]),s._v(". æ‰€ä»¥å¦‚æžœæŠŠè¯­å¥ 2 å®‰æŽ’åœ¨æœ€åŽ, æ¯”å¦‚æŒ‰ç…§ 3, 1, 2 è¿™æ ·çš„é¡ºåº, é‚£ä¹ˆå½±é™¢è´¦æˆ·ä½™é¢è¿™ä¸€è¡Œçš„é”æ—¶é—´å°±æœ€å°‘. è¿™å°±æœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº†äº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…, æå‡äº†å¹¶å‘åº¦.")]),s._v(" "),t("p",[s._v("å¥½äº†, çŽ°åœ¨ç”±äºŽä½ çš„æ­£ç¡®è®¾è®¡, å½±é™¢ä½™é¢è¿™ä¸€è¡Œçš„è¡Œé”åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ä¸ä¼šåœç•™å¾ˆé•¿æ—¶é—´. ä½†è¿™å¹¶æ²¡æœ‰å®Œå…¨è§£å†³ä½ çš„å›°æ‰°.")]),s._v(" "),t("p",[s._v("å¦‚æžœè¿™ä¸ªå½±é™¢åšæ´»åŠ¨, å¯ä»¥ä½Žä»·é¢„å”®ä¸€å¹´å†…æ‰€æœ‰çš„ç”µå½±ç¥¨, è€Œä¸”è¿™ä¸ªæ´»åŠ¨åªåšä¸€å¤©. äºŽæ˜¯åœ¨æ´»åŠ¨æ—¶é—´å¼€å§‹çš„æ—¶å€™, ä½ çš„ MySQL å°±æŒ‚äº†. ä½ ç™»ä¸ŠæœåŠ¡å™¨ä¸€çœ‹, CPU æ¶ˆè€—æŽ¥è¿‘ 100%, ä½†æ•´ä¸ªæ•°æ®åº“æ¯ç§’å°±æ‰§è¡Œä¸åˆ° 100 ä¸ªäº‹åŠ¡. è¿™æ˜¯ä»€ä¹ˆåŽŸå› å‘¢? è¿™é‡Œå°±è¦è¯´åˆ°æ­»é”å’Œæ­»é”æ£€æµ‹äº†.")]),s._v(" "),t("h5",{attrs:{id:"æ­»é”å’Œæ­»é”æ£€æµ‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ­»é”å’Œæ­»é”æ£€æµ‹"}},[s._v("#")]),s._v(" æ­»é”å’Œæ­»é”æ£€æµ‹")]),s._v(" "),t("p",[t("strong",[s._v("å½“å¹¶å‘ç³»ç»Ÿä¸­ä¸åŒçº¿ç¨‹å‡ºçŽ°å¾ªçŽ¯èµ„æºä¾èµ–, æ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶, å°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€, ç§°ä¸ºæ­»é”")]),s._v(". è¿™é‡Œç”¨æ•°æ®åº“ä¸­çš„è¡Œé”ä¸¾ä¸ªä¾‹å­.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c7070b4daa40bee574580d1d868a8213-20230731161914-t7d2jv4.png",alt:""}})]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™, äº‹åŠ¡ A åœ¨ç­‰å¾…äº‹åŠ¡ B é‡Šæ”¾ id=2 çš„è¡Œé”, è€Œäº‹åŠ¡ B åœ¨ç­‰å¾…äº‹åŠ¡ A é‡Šæ”¾ id=1 çš„è¡Œé”. "),t("strong",[s._v("äº‹åŠ¡ A å’Œäº‹åŠ¡ B åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„èµ„æºé‡Šæ”¾, å°±æ˜¯è¿›å…¥äº†æ­»é”çŠ¶æ€")]),s._v(". å½“å‡ºçŽ°æ­»é”ä»¥åŽ, æœ‰ä¸¤ç§ç­–ç•¥:")]),s._v(" "),t("ul",[t("li",[s._v("ä¸€ç§ç­–ç•¥æ˜¯, ç›´æŽ¥è¿›å…¥ç­‰å¾…, "),t("strong",[s._v("ç›´åˆ°è¶…æ—¶")]),s._v(". è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•° "),t("strong",[s._v("innodb_lock_wait_timeout")]),s._v(" æ¥è®¾ç½®.")]),s._v(" "),t("li",[s._v("å¦ä¸€ç§ç­–ç•¥æ˜¯, å‘èµ·æ­»é”æ£€æµ‹, å‘çŽ°æ­»é”åŽ, "),t("strong",[s._v("ä¸»åŠ¨å›žæ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡, è®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œ")]),s._v(". å°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º on, è¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘.")])]),s._v(" "),t("p",[s._v("åœ¨ InnoDB ä¸­, innodb_lock_wait_timeout çš„é»˜è®¤å€¼æ˜¯ 50s, æ„å‘³ç€å¦‚æžœé‡‡ç”¨ç¬¬ä¸€ä¸ªç­–ç•¥, å½“å‡ºçŽ°æ­»é”ä»¥åŽ, ç¬¬ä¸€ä¸ªè¢«é”ä½çš„çº¿ç¨‹è¦è¿‡ 50s æ‰ä¼šè¶…æ—¶é€€å‡º, ç„¶åŽå…¶ä»–çº¿ç¨‹æ‰æœ‰å¯èƒ½ç»§ç»­æ‰§è¡Œ. å¯¹äºŽåœ¨çº¿æœåŠ¡æ¥è¯´, è¿™ä¸ªç­‰å¾…æ—¶é—´å¾€å¾€æ˜¯æ— æ³•æŽ¥å—çš„.")]),s._v(" "),t("p",[s._v("ä½†åˆä¸å¯èƒ½ç›´æŽ¥æŠŠè¿™ä¸ªæ—¶é—´è®¾ç½®æˆä¸€ä¸ªå¾ˆå°çš„å€¼, æ¯”å¦‚ 1s. è¿™æ ·å½“å‡ºçŽ°æ­»é”çš„æ—¶å€™, ç¡®å®žå¾ˆå¿«å°±å¯ä»¥è§£å¼€, ä½†å¦‚æžœä¸æ˜¯æ­»é”, è€Œæ˜¯"),t("strong",[s._v("ç®€å•çš„é”ç­‰å¾…")]),s._v("å‘¢? æ‰€ä»¥è¶…æ—¶æ—¶é—´è®¾ç½®å¤ªçŸ­çš„è¯, ä¼š"),t("strong",[s._v("å‡ºçŽ°å¾ˆå¤šè¯¯ä¼¤")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, æ­£å¸¸æƒ…å†µä¸‹è¿˜æ˜¯è¦é‡‡ç”¨ç¬¬äºŒç§ç­–ç•¥, å³: "),t("strong",[s._v("ä¸»åŠ¨æ­»é”æ£€æµ‹")]),s._v(", è€Œä¸” innodb_deadlock_detect çš„é»˜è®¤å€¼æœ¬èº«å°±æ˜¯ on. "),t("strong",[s._v("ä¸»åŠ¨æ­»é”æ£€æµ‹åœ¨å‘ç”Ÿæ­»é”çš„æ—¶å€™, æ˜¯èƒ½å¤Ÿå¿«é€Ÿå‘çŽ°å¹¶è¿›è¡Œå¤„ç†çš„, ä½†æ˜¯å®ƒä¹Ÿæ˜¯æœ‰é¢å¤–è´Ÿæ‹…çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯ä»¥æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹: æ¯å½“ä¸€ä¸ªäº‹åŠ¡è¢«é”çš„æ—¶å€™, å°±è¦çœ‹çœ‹å®ƒæ‰€ä¾èµ–çš„çº¿ç¨‹æœ‰æ²¡æœ‰è¢«åˆ«äººé”ä½, å¦‚æ­¤å¾ªçŽ¯, æœ€åŽåˆ¤æ–­æ˜¯å¦å‡ºçŽ°äº†å¾ªçŽ¯ç­‰å¾…, ä¹Ÿå°±æ˜¯æ­»é”.")]),s._v(" "),t("p",[s._v("é‚£å¦‚æžœæ˜¯ä¸Šé¢è¯´åˆ°çš„"),t("strong",[s._v("æ‰€æœ‰äº‹åŠ¡éƒ½è¦æ›´æ–°åŒä¸€è¡Œ")]),s._v("çš„åœºæ™¯å‘¢?")]),s._v(" "),t("p",[s._v("æ¯ä¸ªæ–°æ¥çš„è¢«å µä½çš„çº¿ç¨‹, éƒ½è¦åˆ¤æ–­ä¼šä¸ä¼šç”±äºŽè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”, è¿™æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„æ“ä½œ. å‡è®¾æœ‰ 1000 ä¸ªå¹¶å‘çº¿ç¨‹è¦åŒæ—¶æ›´æ–°åŒä¸€è¡Œ, é‚£ä¹ˆæ­»é”æ£€æµ‹æ“ä½œå°±æ˜¯ 100 ä¸‡è¿™ä¸ªé‡çº§çš„. è™½ç„¶æœ€ç»ˆæ£€æµ‹çš„ç»“æžœæ˜¯æ²¡æœ‰æ­»é”, ä½†æ˜¯è¿™æœŸé—´è¦æ¶ˆè€—å¤§é‡çš„ CPU èµ„æº. å› æ­¤å°±ä¼šçœ‹åˆ° CPU åˆ©ç”¨çŽ‡å¾ˆé«˜, ä½†æ˜¯æ¯ç§’å´æ‰§è¡Œä¸äº†å‡ ä¸ªäº‹åŠ¡.")]),s._v(" "),t("p",[s._v("æ ¹æ®ä¸Šé¢çš„åˆ†æž, æ¥è®¨è®ºä¸€ä¸‹, æ€Žä¹ˆ"),t("strong",[s._v("è§£å†³ç”±è¿™ç§çƒ­ç‚¹è¡Œæ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜")]),s._v("å‘¢? é—®é¢˜çš„ç—‡ç»“åœ¨äºŽ, "),t("strong",[s._v("æ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„ CPU èµ„æº")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("ä¸€ç§å¤´ç—›åŒ»å¤´çš„æ–¹æ³•, å°±æ˜¯å¦‚æžœèƒ½ç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºçŽ°æ­»é”, å¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³æŽ‰. ** ä½†æ˜¯è¿™ç§æ“ä½œæœ¬èº«å¸¦æœ‰ä¸€å®šçš„é£Žé™©, å› ä¸ºä¸šåŠ¡è®¾è®¡çš„æ—¶å€™ä¸€èˆ¬ä¸ä¼šæŠŠæ­»é”å½“åšä¸€ä¸ªä¸¥é‡é”™è¯¯, æ¯•ç«Ÿå‡ºçŽ°æ­»é”äº†, å°±å›žæ»š, ç„¶åŽé€šè¿‡ä¸šåŠ¡é‡è¯•ä¸€èˆ¬å°±æ²¡é—®é¢˜äº†, è¿™æ˜¯ä¸šåŠ¡æ— æŸçš„. è€Œ")]),s._v("å…³æŽ‰æ­»é”æ£€æµ‹æ„å‘³ç€å¯èƒ½ä¼šå‡ºçŽ°å¤§é‡çš„è¶…æ—¶, è¿™æ˜¯ä¸šåŠ¡æœ‰æŸ**çš„.")]),s._v(" "),t("p",[t("strong",[s._v("å¦ä¸€ä¸ªæ€è·¯æ˜¯æŽ§åˆ¶å¹¶å‘åº¦. ** æ ¹æ®ä¸Šé¢çš„åˆ†æž, ä½ ä¼šå‘çŽ°å¦‚æžœå¹¶å‘èƒ½å¤ŸæŽ§åˆ¶ä½, æ¯”å¦‚åŒä¸€è¡ŒåŒæ—¶æœ€å¤šåªæœ‰ 10 ä¸ªçº¿ç¨‹åœ¨æ›´æ–°, é‚£ä¹ˆæ­»é”æ£€æµ‹çš„æˆæœ¬å¾ˆä½Ž, å°±ä¸ä¼šå‡ºçŽ°è¿™ä¸ªé—®é¢˜. ä¸€ä¸ªç›´æŽ¥çš„æƒ³æ³•å°±æ˜¯, åœ¨å®¢æˆ·ç«¯åšå¹¶å‘æŽ§åˆ¶. ä½†è¿™ä¸ªæ–¹æ³•ä¸å¤ªå¯è¡Œ, å› ä¸ºå®¢æˆ·ç«¯å¾ˆå¤š. æˆ‘è§è¿‡ä¸€ä¸ªåº”ç”¨, æœ‰ 600 ä¸ªå®¢æˆ·ç«¯, è¿™æ ·å³ä½¿æ¯ä¸ªå®¢æˆ·ç«¯æŽ§åˆ¶åˆ°åªæœ‰ 5 ä¸ªå¹¶å‘çº¿ç¨‹, æ±‡æ€»åˆ°æ•°æ®åº“æœåŠ¡ç«¯ä»¥åŽ, å³°å€¼å¹¶å‘æ•°ä¹Ÿå¯èƒ½è¦è¾¾åˆ° 3000. å› æ­¤è¿™ä¸ª")]),s._v("å¹¶å‘æŽ§åˆ¶è¦åšåœ¨æ•°æ®åº“æœåŠ¡ç«¯**. å¦‚æžœä½ æœ‰ä¸­é—´ä»¶, å¯ä»¥è€ƒè™‘åœ¨ä¸­é—´ä»¶å®žçŽ°; å¦‚æžœä½ çš„å›¢é˜Ÿæœ‰èƒ½ä¿®æ”¹ MySQL æºç çš„äºº, ä¹Ÿå¯ä»¥åšåœ¨ MySQL é‡Œé¢. åŸºæœ¬æ€è·¯å°±æ˜¯, "),t("mark",[t("strong",[s._v("å¯¹äºŽç›¸åŒè¡Œçš„æ›´æ–°, åœ¨è¿›å…¥å¼•æ“Žä¹‹å‰æŽ’é˜Ÿ. è¿™æ ·åœ¨ InnoDB å†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œ")])]),s._v("äº†.")]),s._v(" "),t("p",[s._v("å¯èƒ½ä½ ä¼šé—®, **å¦‚æžœå›¢é˜Ÿé‡Œæš‚æ—¶æ²¡æœ‰æ•°æ®åº“æ–¹é¢çš„ä¸“å®¶, ä¸èƒ½å®žçŽ°è¿™æ ·çš„æ–¹æ¡ˆ, èƒ½ä¸èƒ½ä»Žè®¾è®¡ä¸Šä¼˜åŒ–è¿™ä¸ªé—®é¢˜å‘¢? **")]),s._v(" "),t("p",[s._v("å¯ä»¥è€ƒè™‘é€šè¿‡"),t("strong",[s._v("å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çª")]),s._v(". è¿˜æ˜¯ä»¥å½±é™¢è´¦æˆ·ä¸ºä¾‹, å¯ä»¥è€ƒè™‘æ”¾åœ¨å¤šæ¡è®°å½•ä¸Š, æ¯”å¦‚ 10 ä¸ªè®°å½•, å½±é™¢çš„è´¦æˆ·æ€»é¢ç­‰äºŽè¿™ 10 ä¸ªè®°å½•çš„å€¼çš„æ€»å’Œ. è¿™æ ·æ¯æ¬¡è¦ç»™å½±é™¢è´¦æˆ·åŠ é‡‘é¢çš„æ—¶å€™, éšæœºé€‰å…¶ä¸­ä¸€æ¡è®°å½•æ¥åŠ . è¿™æ ·æ¯æ¬¡å†²çªæ¦‚çŽ‡å˜æˆåŽŸæ¥çš„ 1/10, å¯ä»¥å‡å°‘é”ç­‰å¾…ä¸ªæ•°, ä¹Ÿå°±å‡å°‘äº†æ­»é”æ£€æµ‹çš„ CPU æ¶ˆè€—. è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¸ŠåŽ»æ˜¯æ— æŸçš„, ä½†å…¶å®žè¿™ç±»æ–¹æ¡ˆéœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘åšè¯¦ç»†è®¾è®¡. å¦‚æžœè´¦æˆ·ä½™é¢å¯èƒ½ä¼šå‡å°‘, æ¯”å¦‚é€€ç¥¨é€»è¾‘, é‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦è€ƒè™‘å½“ä¸€éƒ¨åˆ†è¡Œè®°å½•å˜æˆ 0 çš„æ—¶å€™, ä»£ç è¦æœ‰ç‰¹æ®Šå¤„ç†.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-7"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL çš„è¡Œé”, æ¶‰åŠäº†"),t("strong",[s._v("ä¸¤é˜¶æ®µé”åè®®, æ­»é”å’Œæ­»é”æ£€æµ‹")]),s._v("è¿™ä¸¤å¤§éƒ¨åˆ†å†…å®¹.")]),s._v(" "),t("p",[s._v("å…¶ä¸­ä»¥ä¸¤é˜¶æ®µåè®®ä¸ºèµ·ç‚¹, è®¨è®ºäº†åœ¨å¼€å‘çš„æ—¶å€™å¦‚ä½•å®‰æŽ’æ­£ç¡®çš„äº‹åŠ¡è¯­å¥. è¿™é‡Œçš„åŽŸåˆ™ä¸Žå»ºè®®æ˜¯: "),t("mark",[t("strong",[s._v("å¦‚æžœäº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œ, è¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çª, æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”çš„ç”³è¯·æ—¶æœºå°½é‡å¾€åŽæ”¾")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, è°ƒæ•´è¯­å¥é¡ºåºå¹¶ä¸èƒ½å®Œå…¨é¿å…æ­»é”. æ‰€ä»¥å¼•å…¥äº†"),t("strong",[s._v("æ­»é”å’Œæ­»é”æ£€æµ‹")]),s._v("çš„æ¦‚å¿µ, ä»¥åŠæä¾›äº†ä¸‰ä¸ªæ–¹æ¡ˆ, æ¥å‡å°‘æ­»é”å¯¹æ•°æ®åº“çš„å½±å“. "),t("strong",[s._v("å‡å°‘æ­»é”çš„ä¸»è¦æ–¹å‘, å°±æ˜¯æŽ§åˆ¶è®¿é—®ç›¸åŒèµ„æºçš„å¹¶å‘äº‹åŠ¡é‡")]),s._v(".")]),s._v(" "),t("p",[s._v("æä¸ªé—®é¢˜. å¦‚æžœè¦åˆ é™¤ä¸€ä¸ªè¡¨é‡Œé¢çš„å‰ 10000 è¡Œæ•°æ®, æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°:")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€ç§, ç›´æŽ¥æ‰§è¡Œ delete from T limit 10000;")]),s._v(" "),t("li",[s._v("ç¬¬äºŒç§, åœ¨ä¸€ä¸ªè¿žæŽ¥ä¸­å¾ªçŽ¯æ‰§è¡Œ 20 æ¬¡ delete from T limit 500;")]),s._v(" "),t("li",[s._v("ç¬¬ä¸‰ç§, åœ¨ 20 ä¸ªè¿žæŽ¥ä¸­åŒæ—¶æ‰§è¡Œ delete from T limit 500.")])]),s._v(" "),t("p",[s._v("ä½ ä¼šé€‰æ‹©å“ªä¸€ç§æ–¹æ³•å‘¢? ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬äºŒç§æ–¹å¼æ˜¯ç›¸å¯¹è¾ƒå¥½çš„.")])]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ç§æ–¹å¼(å³: ç›´æŽ¥æ‰§è¡Œ delete from T limit 10000)é‡Œé¢, "),t("strong",[s._v("å•ä¸ªè¯­å¥å ç”¨æ—¶é—´é•¿, é”çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿; è€Œä¸”å¤§äº‹åŠ¡è¿˜ä¼šå¯¼è‡´ä¸»ä»Žå»¶è¿Ÿ")]),s._v(".")]),s._v(" "),t("p",[s._v("ç¬¬ä¸‰ç§æ–¹å¼(å³: åœ¨ 20 ä¸ªè¿žæŽ¥ä¸­åŒæ—¶æ‰§è¡Œ delete from T limit 500), ä¼šäººä¸ºé€ "),t("strong",[s._v("æˆé”å†²çª")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_08-äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_08-äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„"}},[s._v("#")]),s._v(" 08-äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„?")]),s._v(" "),t("p",[s._v("å‰é¢è®²äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ—¶å€™æåˆ°è¿‡, å¦‚æžœæ˜¯"),t("strong",[s._v("å¯é‡å¤è¯»éš”ç¦»çº§åˆ«, äº‹åŠ¡ T å¯åŠ¨çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ read-view, ä¹‹åŽäº‹åŠ¡ T æ‰§è¡ŒæœŸé—´, å³ä½¿æœ‰å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†æ•°æ®, äº‹åŠ¡ T çœ‹åˆ°çš„ä»ç„¶è·Ÿåœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„ä¸€æ ·")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, ä¸€ä¸ªåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œçš„äº‹åŠ¡, å¥½åƒä¸Žä¸–æ— äº‰, ä¸å—å¤–ç•Œå½±å“.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯ä¸Šä¸€èŠ‚ä»‹ç»è¡Œé”çš„æ—¶å€™åˆæåˆ°, "),t("strong",[s._v("ä¸€ä¸ªäº‹åŠ¡è¦æ›´æ–°ä¸€è¡Œ, å¦‚æžœåˆšå¥½æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ‹¥æœ‰è¿™ä¸€è¡Œçš„è¡Œé”, å®ƒåˆä¸èƒ½è¿™ä¹ˆè¶…ç„¶äº†, ä¼šè¢«é”ä½, è¿›å…¥ç­‰å¾…çŠ¶æ€. é—®é¢˜æ˜¯æ—¢ç„¶è¿›å…¥äº†ç­‰å¾…çŠ¶æ€, é‚£ä¹ˆç­‰åˆ°è¿™ä¸ªäº‹åŠ¡è‡ªå·±èŽ·å–åˆ°è¡Œé”è¦æ›´æ–°æ•°æ®çš„æ—¶å€™, å®ƒè¯»åˆ°çš„å€¼åˆæ˜¯ä»€ä¹ˆå‘¢?")])]),s._v(" "),t("p",[s._v("ä¸¾ä¸€ä¸ªä¾‹å­.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä¸Šé¢æ˜¯ä¸€ä¸ªåªæœ‰ä¸¤è¡Œçš„è¡¨çš„åˆå§‹åŒ–è¯­å¥.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c812a098f71c23a66b2409fd535c88b3-20230731161914-ni5q9fd.png",alt:"",title:"äº‹åŠ¡ A, B, C çš„æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯"),t("strong",[s._v("äº‹åŠ¡çš„å¯åŠ¨æ—¶æœº")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("begin/start transaction å‘½ä»¤å¹¶ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„èµ·ç‚¹, åœ¨æ‰§è¡Œåˆ°å®ƒä»¬ä¹‹åŽçš„ç¬¬ä¸€ä¸ªæ“ä½œ InnoDB è¡¨çš„è¯­å¥, äº‹åŠ¡æ‰çœŸæ­£å¯åŠ¨. å¦‚æžœæƒ³è¦é©¬ä¸Šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡, å¯ä»¥ä½¿ç”¨ start transaction with consistent snapshot è¿™ä¸ªå‘½ä»¤.")])]),s._v(" "),t("blockquote",[t("p",[s._v("ç¬¬ä¸€ç§å¯åŠ¨æ–¹å¼, ä¸€è‡´æ€§è§†å›¾æ˜¯åœ¨ç¬¬æ‰§è¡Œç¬¬ä¸€ä¸ªå¿«ç…§è¯»è¯­å¥æ—¶åˆ›å»ºçš„;\nç¬¬äºŒç§å¯åŠ¨æ–¹å¼, ä¸€è‡´æ€§è§†å›¾æ˜¯åœ¨æ‰§è¡Œ start transaction with consistent snapshot æ—¶åˆ›å»ºçš„.")])]),s._v(" "),t("p",[s._v("è¿˜éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨æ•´ä¸ªä¸“æ é‡Œé¢, å¦‚æžœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜Ž, éƒ½æ˜¯é»˜è®¤ autocommit=1.")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªä¾‹å­ä¸­, äº‹åŠ¡ C æ²¡æœ‰æ˜¾å¼åœ°ä½¿ç”¨ begin/commit, è¡¨ç¤ºè¿™ä¸ª update è¯­å¥æœ¬èº«å°±æ˜¯ä¸€ä¸ª"),t("strong",[s._v("äº‹åŠ¡")]),s._v(", è¯­å¥å®Œæˆçš„æ—¶å€™ä¼š"),t("strong",[s._v("è‡ªåŠ¨æäº¤")]),s._v(". äº‹åŠ¡ B åœ¨æ›´æ–°äº†è¡Œä¹‹åŽæŸ¥è¯¢; äº‹åŠ¡ A åœ¨ä¸€ä¸ª"),t("strong",[s._v("åªè¯»äº‹åŠ¡ä¸­æŸ¥è¯¢")]),s._v(", å¹¶ä¸”æ—¶é—´é¡ºåºä¸Šæ˜¯åœ¨äº‹åŠ¡ B çš„æŸ¥è¯¢ä¹‹åŽ.")]),s._v(" "),t("p",[s._v("è¿™æ—¶, å¦‚æžœæˆ‘å‘Šè¯‰ä½ äº‹åŠ¡ B æŸ¥åˆ°çš„ k çš„å€¼æ˜¯ 3, è€Œäº‹åŠ¡ A æŸ¥åˆ°çš„ k çš„å€¼æ˜¯ 1, ä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹æ™•å‘¢? æœ¬èŠ‚å…¶å®žå°±æ¥è¯´æ˜Žç™½è¿™ä¸ªé—®é¢˜, å¸Œæœ›å€Ÿç”±æŠŠè¿™ä¸ªç–‘æƒ‘è§£å¼€çš„è¿‡ç¨‹, èƒ½å¤Ÿå¸®åŠ©ä½ å¯¹ InnoDB çš„äº‹åŠ¡å’Œé”æœ‰æ›´è¿›ä¸€æ­¥çš„ç†è§£.")]),s._v(" "),t("p",[s._v('åœ¨ MySQL é‡Œ, æœ‰ä¸¤ä¸ª"è§†å›¾"çš„æ¦‚å¿µ:')]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ä¸€ä¸ªæ˜¯ view")]),s._v(". å®ƒæ˜¯ä¸€ä¸ªç”¨æŸ¥è¯¢è¯­å¥å®šä¹‰çš„è™šæ‹Ÿè¡¨, åœ¨è°ƒç”¨çš„æ—¶å€™æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å¹¶ç”Ÿæˆç»“æžœ. åˆ›å»ºè§†å›¾çš„è¯­æ³•æ˜¯ "),t("code",[s._v("create view ...")]),s._v("â€‹, è€Œå®ƒçš„æŸ¥è¯¢æ–¹æ³•ä¸Žè¡¨ä¸€æ ·.")]),s._v(" "),t("li",[t("strong",[s._v("å¦ä¸€ä¸ªæ˜¯ InnoDB åœ¨å®žçŽ° MVCC æ—¶ç”¨åˆ°çš„ä¸€è‡´æ€§è¯»è§†å›¾, å³ consistent read view, ç”¨äºŽæ”¯æŒ RC(Read Committed, è¯»æäº¤)å’Œ RR(Repeatable Read, å¯é‡å¤è¯»)éš”ç¦»çº§åˆ«çš„å®žçŽ°")]),s._v('. å®ƒæ²¡æœ‰ç‰©ç†ç»“æž„, ä½œç”¨æ˜¯äº‹åŠ¡æ‰§è¡ŒæœŸé—´ç”¨æ¥å®šä¹‰ "æˆ‘èƒ½çœ‹åˆ°ä»€ä¹ˆæ•°æ®".')])]),s._v(" "),t("p",[s._v("å‰é¢è§£é‡Šè¿‡ä¸€é MVCC çš„å®žçŽ°é€»è¾‘. ä¸ºäº†è¯´æ˜ŽæŸ¥è¯¢å’Œæ›´æ–°çš„åŒºåˆ«, å°±æ¢ä¸€ä¸ªæ–¹å¼æ¥è¯´æ˜Ž, æŠŠ read view æ‹†å¼€. å¯ä»¥ç»“åˆè¿™ä¸¤èŠ‚çš„è¯´æ˜Žæ¥æ›´æ·±ä¸€æ­¥åœ°ç†è§£ MVCC.")]),s._v(" "),t("h5",{attrs:{id:"å¿«ç…§-åœ¨-mvccé‡Œæ˜¯æ€Žä¹ˆå·¥ä½œçš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¿«ç…§-åœ¨-mvccé‡Œæ˜¯æ€Žä¹ˆå·¥ä½œçš„"}},[s._v("#")]),s._v(' "å¿«ç…§"åœ¨ MVCCé‡Œæ˜¯æ€Žä¹ˆå·¥ä½œçš„?')]),s._v(" "),t("p",[t("mark",[t("strong",[s._v('åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹, äº‹åŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™å°± "æ‹äº†ä¸ªå¿«ç…§"')])]),s._v(" . æ³¨æ„, è¿™ä¸ªå¿«ç…§æ˜¯"),t("strong",[s._v("åŸºäºŽæ•´åº“")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("è¿™æ—¶, ä½ ä¼šè¯´è¿™çœ‹ä¸ŠåŽ»ä¸å¤ªçŽ°å®žå•Š. å¦‚æžœä¸€ä¸ªåº“æœ‰ 100G, é‚£ä¹ˆå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡, MySQL å°±è¦æ‹·è´ 100G çš„æ•°æ®å‡ºæ¥, è¿™ä¸ªè¿‡ç¨‹å¾—å¤šæ…¢å•Š. å¯æˆ‘å¹³æ—¶çš„äº‹åŠ¡æ‰§è¡Œèµ·æ¥å¾ˆå¿«å•Š.")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Šå¹¶ä¸éœ€è¦æ‹·è´å‡ºè¿™ 100G çš„æ•°æ®. å…ˆæ¥çœ‹çœ‹è¿™ä¸ªå¿«ç…§æ˜¯æ€Žä¹ˆå®žçŽ°çš„.")]),s._v(" "),t("p",[t("strong",[s._v("InnoDB é‡Œé¢æ¯ä¸ªäº‹åŠ¡æœ‰ä¸€ä¸ªå”¯ä¸€çš„äº‹åŠ¡ ID, å«ä½œ transaction id. å®ƒæ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™å‘ InnoDB çš„äº‹åŠ¡ç³»ç»Ÿç”³è¯·çš„, æ˜¯æŒ‰ç”³è¯·é¡ºåºä¸¥æ ¼é€’å¢žçš„.")])]),s._v(" "),t("p",[t("strong",[s._v("è€Œæ¯è¡Œæ•°æ®ä¹Ÿéƒ½æ˜¯æœ‰å¤šä¸ªç‰ˆæœ¬çš„. æ¯æ¬¡äº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™, éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬, å¹¶ä¸”æŠŠ transaction id èµ‹å€¼ç»™è¿™ä¸ªæ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ ID, è®°ä¸º row trx_id")]),s._v(". åŒæ—¶, æ—§çš„æ•°æ®ç‰ˆæœ¬è¦ä¿ç•™, å¹¶ä¸”åœ¨æ–°çš„æ•°æ®ç‰ˆæœ¬ä¸­, èƒ½å¤Ÿæœ‰ä¿¡æ¯å¯ä»¥ç›´æŽ¥æ‹¿åˆ°å®ƒ.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("æ•°æ®è¡¨ä¸­çš„ä¸€è¡Œè®°å½•, å…¶å®žå¯èƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ (row), æ¯ä¸ªç‰ˆæœ¬æœ‰è‡ªå·±çš„ row trx_id")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚å›¾ 2 æ‰€ç¤º, å°±æ˜¯ä¸€ä¸ªè®°å½•è¢«å¤šä¸ªäº‹åŠ¡è¿žç»­æ›´æ–°åŽçš„çŠ¶æ€.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3a99c08a7c1412087b8f2243bbc0e7c2-20230731161914-2h1e0tf.png",alt:"",title:"è¡ŒçŠ¶æ€å˜æ›´å›¾"}})]),s._v(" "),t("p",[s._v("å›¾ä¸­è™šçº¿æ¡†é‡Œæ˜¯"),t("strong",[s._v("åŒä¸€è¡Œæ•°æ®çš„ 4 ä¸ªç‰ˆæœ¬")]),s._v(", å½“å‰æœ€æ–°ç‰ˆæœ¬æ˜¯ V4, k çš„å€¼æ˜¯ 22, å®ƒæ˜¯è¢« transaction id ä¸º 25 çš„äº‹åŠ¡æ›´æ–°çš„, å› æ­¤"),t("strong",[s._v("å®ƒçš„ row trx_id ä¹Ÿæ˜¯ 25")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, å‰é¢ä¸æ˜¯è¯´, è¯­å¥æ›´æ–°ä¼šç”Ÿæˆ undo log(å›žæ»šæ—¥å¿—)å—? é‚£ **undo log åœ¨å“ªå‘¢? **")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, å›¾ 2 ä¸­çš„ä¸‰ä¸ªè™šçº¿ç®­å¤´, å°±æ˜¯ undo log; "),t("strong",[s._v("è€Œ V1, V2, V3 å¹¶ä¸æ˜¯ç‰©ç†ä¸ŠçœŸå®žå­˜åœ¨çš„, è€Œæ˜¯æ¯æ¬¡éœ€è¦çš„æ—¶å€™æ ¹æ®å½“å‰ç‰ˆæœ¬å’Œ undo log è®¡ç®—å‡ºæ¥çš„")]),s._v(". æ¯”å¦‚éœ€è¦ V2 çš„æ—¶å€™, å°±æ˜¯é€šè¿‡ V4 ä¾æ¬¡æ‰§è¡Œ U3, U2 ç®—å‡ºæ¥.")]),s._v(" "),t("p",[s._v('æ˜Žç™½äº†å¤šç‰ˆæœ¬å’Œ row trx_id çš„æ¦‚å¿µåŽ, å†æ¥æƒ³ä¸€ä¸‹ InnoDB æ˜¯æ€Žä¹ˆå®šä¹‰é‚£ä¸ª "100G" çš„å¿«ç…§çš„.')]),s._v(" "),t("p",[s._v("æŒ‰ç…§å¯é‡å¤è¯»çš„å®šä¹‰, ä¸€ä¸ªäº‹åŠ¡å¯åŠ¨çš„æ—¶å€™, èƒ½å¤Ÿçœ‹åˆ°"),t("strong",[s._v("æ‰€æœ‰å·²ç»æäº¤çš„äº‹åŠ¡ç»“æžœ")]),s._v(". ä½†æ˜¯ä¹‹åŽè¿™ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´, å…¶ä»–äº‹åŠ¡çš„æ›´æ–°å¯¹å®ƒä¸å¯è§.")]),s._v(" "),t("p",[s._v("å› æ­¤, "),t("strong",[s._v('ä¸€ä¸ªäº‹åŠ¡åªéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™å£°æ˜Žè¯´, "ä»¥æˆ‘å¯åŠ¨çš„æ—¶åˆ»ä¸ºå‡†, å¦‚æžœä¸€ä¸ªæ•°æ®ç‰ˆæœ¬æ˜¯åœ¨æˆ‘å¯åŠ¨ä¹‹å‰ç”Ÿæˆçš„, å°±è®¤; å¦‚æžœæ˜¯æˆ‘å¯åŠ¨ä»¥åŽæ‰ç”Ÿæˆçš„, æˆ‘å°±ä¸è®¤, æˆ‘å¿…é¡»è¦æ‰¾åˆ°å®ƒçš„ä¸Šä¸€ä¸ªç‰ˆæœ¬"')]),s._v(" .")]),s._v(" "),t("p",[s._v('å½“ç„¶, å¦‚æžœ "ä¸Šä¸€ä¸ªç‰ˆæœ¬" ä¹Ÿä¸å¯è§, é‚£å°±å¾—ç»§ç»­å¾€å‰æ‰¾. è¿˜æœ‰å¦‚æžœ'),t("strong",[s._v("æ˜¯è¿™ä¸ªäº‹åŠ¡è‡ªå·±æ›´æ–°çš„æ•°æ®, å®ƒè‡ªå·±è¿˜æ˜¯è¦è®¤")]),s._v("çš„.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v('åœ¨å®žçŽ°ä¸Š, InnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡æž„é€ äº†ä¸€ä¸ªæ•°ç»„, ç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨çž¬é—´, å½“å‰æ­£åœ¨ "æ´»è·ƒ" çš„æ‰€æœ‰äº‹åŠ¡ ID. "æ´»è·ƒ" æŒ‡çš„å°±æ˜¯, å¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤')])]),s._v(". æ•°ç»„é‡Œé¢äº‹åŠ¡ ID çš„"),t("strong",[s._v("æœ€å°å€¼è®°ä¸ºä½Žæ°´ä½")]),s._v(", å½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡ ID çš„"),t("strong",[s._v("æœ€å¤§å€¼åŠ  1 è®°ä¸ºé«˜æ°´ä½")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªè§†å›¾æ•°ç»„å’Œé«˜æ°´ä½, å°±ç»„æˆäº†"),t("mark",[t("strong",[s._v("å½“å‰äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾(read-view)")])]),s._v(" . è€Œæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§è§„åˆ™, å°±æ˜¯"),t("strong",[s._v("åŸºäºŽæ•°æ®çš„ row trx_id å’Œè¿™ä¸ªä¸€è‡´æ€§è§†å›¾çš„å¯¹æ¯”ç»“æžœå¾—åˆ°")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªè§†å›¾æ•°ç»„æŠŠæ‰€æœ‰çš„ "),t("strong",[s._v("row trx_id")]),s._v(" åˆ†æˆäº†å‡ ç§ä¸åŒçš„æƒ…å†µ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5bc5669c5b2c0965822e0fcfcdcaad31-20230731161914-3286wbs.png",alt:"",title:"æ•°æ®ç‰ˆæœ¬å¯è§æ€§è§„åˆ™"}})]),s._v(" "),t("p",[s._v("è¿™æ ·å¯¹äºŽ"),t("strong",[s._v("å½“å‰äº‹åŠ¡çš„å¯åŠ¨çž¬é—´æ¥è¯´, ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬çš„ row trx_id")]),s._v(", æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœ"),t("strong",[s._v("è½åœ¨ç»¿è‰²éƒ¨åˆ†")]),s._v(", è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯"),t("strong",[s._v("å·²æäº¤çš„äº‹åŠ¡æˆ–è€…æ˜¯å½“å‰äº‹åŠ¡è‡ªå·±ç”Ÿæˆçš„, è¿™ä¸ªæ•°æ®æ˜¯å¯è§")]),s._v("çš„;")]),s._v(" "),t("li",[s._v("å¦‚æžœ"),t("strong",[s._v("è½åœ¨çº¢è‰²éƒ¨åˆ†")]),s._v(", è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±"),t("strong",[s._v("å°†æ¥å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„")]),s._v(", æ˜¯è‚¯å®šä¸å¯è§çš„;")]),s._v(" "),t("li",[s._v("å¦‚æžœ"),t("strong",[s._v("è½åœ¨é»„è‰²éƒ¨åˆ†")]),s._v(", é‚£å°±åŒ…æ‹¬ä¸¤ç§æƒ…å†µ:\na. "),t("strong",[s._v("è‹¥ row trx_id åœ¨æ•°ç»„ä¸­")]),s._v(", è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±"),t("strong",[s._v("è¿˜æ²¡æäº¤çš„äº‹åŠ¡ç”Ÿæˆ")]),s._v("çš„, "),t("strong",[s._v("ä¸å¯è§")]),s._v(";\nb. "),t("strong",[s._v("è‹¥ row trx_id ä¸åœ¨æ•°ç»„ä¸­")]),s._v(", è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯"),t("strong",[s._v("å·²ç»æäº¤äº†çš„äº‹åŠ¡ç”Ÿæˆ")]),s._v("çš„, "),t("strong",[s._v("å¯è§")]),s._v(".")])]),s._v(" "),t("p",[s._v("æ¯”å¦‚å¦‚æžœæœ‰ä¸€ä¸ªäº‹åŠ¡, å®ƒçš„ä½Žæ°´ä½æ˜¯ 18, é‚£ä¹ˆå½“å®ƒè®¿é—®è¿™ä¸€è¡Œæ•°æ®æ—¶, "),t("strong",[s._v("å°±ä¼šä»Ž V4 é€šè¿‡ U3 è®¡ç®—å‡º V3, æ‰€ä»¥åœ¨å®ƒçœ‹æ¥, è¿™ä¸€è¡Œçš„å€¼æ˜¯ 11")]),s._v(".")]),s._v(" "),t("p",[s._v("æœ‰äº†è¿™ä¸ªå£°æ˜ŽåŽ, ç³»ç»Ÿé‡Œé¢éšåŽå‘ç”Ÿçš„æ›´æ–°, æ˜¯ä¸æ˜¯å°±è·Ÿè¿™ä¸ªäº‹åŠ¡çœ‹åˆ°çš„å†…å®¹æ— å…³äº†å‘¢? "),t("strong",[s._v('å› ä¸ºä¹‹åŽçš„æ›´æ–°, ç”Ÿæˆçš„ç‰ˆæœ¬ä¸€å®šå±žäºŽä¸Šé¢çš„ 2 æˆ–è€… 3(a) çš„æƒ…å†µ, è€Œå¯¹å®ƒæ¥è¯´, è¿™äº›æ–°çš„æ•°æ®ç‰ˆæœ¬æ˜¯ä¸å­˜åœ¨çš„, æ‰€ä»¥è¿™ä¸ªäº‹åŠ¡çš„å¿«ç…§, å°±æ˜¯"é™æ€"çš„äº†')]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ä½ çŽ°åœ¨çŸ¥é“äº†, "),t("mark",[t("strong",[s._v('InnoDB åˆ©ç”¨äº† "æ‰€æœ‰æ•°æ®éƒ½æœ‰å¤šä¸ªç‰ˆæœ¬" çš„è¿™ä¸ªç‰¹æ€§, å®žçŽ°äº† "ç§’çº§åˆ›å»ºå¿«ç…§" çš„èƒ½åŠ›')])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥ç»§ç»­çœ‹ä¸€ä¸‹å›¾ 1 ä¸­çš„ä¸‰ä¸ªäº‹åŠ¡, åˆ†æžä¸‹äº‹åŠ¡ A çš„è¯­å¥è¿”å›žçš„ç»“æžœ, ä¸ºä»€ä¹ˆæ˜¯ k=1.")]),s._v(" "),t("p",[s._v("è¿™é‡Œä¸å¦¨åšå¦‚ä¸‹å‡è®¾:")]),s._v(" "),t("ol",[t("li",[s._v("äº‹åŠ¡ A å¼€å§‹å‰, ç³»ç»Ÿé‡Œé¢"),t("strong",[s._v("åªæœ‰ä¸€ä¸ªæ´»è·ƒäº‹åŠ¡ ID æ˜¯ 99")]),s._v(";")]),s._v(" "),t("li",[s._v("äº‹åŠ¡ A, B, C çš„ç‰ˆæœ¬å·åˆ†åˆ«æ˜¯ 100, 101, 102(æŒ‰ç…§åˆ›å»ºçš„é¡ºåº), ä¸”å½“å‰ç³»ç»Ÿé‡Œ"),t("strong",[s._v("åªæœ‰è¿™å››ä¸ªäº‹åŠ¡")]),s._v(";")]),s._v(" "),t("li",[s._v("ä¸‰ä¸ªäº‹åŠ¡å¼€å§‹å‰, (1,1) "),t("strong",[s._v("è¿™ä¸€è¡Œæ•°æ®çš„ row trx_id æ˜¯ 90")]),s._v(".")])]),s._v(" "),t("p",[t("strong",[s._v("è¿™æ ·äº‹åŠ¡ A çš„è§†å›¾æ•°ç»„å°±æ˜¯ [99,100], äº‹åŠ¡ B çš„è§†å›¾æ•°ç»„æ˜¯ [99,100,101], äº‹åŠ¡ C çš„è§†å›¾æ•°ç»„æ˜¯ [99,100,101,102].")])]),s._v(" "),t("p",[s._v("ä¸ºäº†ç®€åŒ–åˆ†æž, å…ˆæŠŠå…¶ä»–å¹²æ‰°è¯­å¥åŽ»æŽ‰, åªç”»å‡ºè·Ÿäº‹åŠ¡ A æŸ¥è¯¢é€»è¾‘æœ‰å…³çš„æ“ä½œ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/77bcde8a183c9fb41913ccb76f8845dc-20230731161914-vguwief.png",alt:"",title:"äº‹åŠ¡AæŸ¥è¯¢æ•°æ®é€»è¾‘å›¾"}})]),s._v(" "),t("p",[s._v("ä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("ç¬¬ä¸€ä¸ªæœ‰æ•ˆæ›´æ–°æ˜¯äº‹åŠ¡ C, æŠŠæ•°æ®ä»Ž (1,1) æ”¹æˆäº† (1,2)")]),s._v(" . è¿™æ—¶å€™, è¿™ä¸ª"),t("strong",[s._v("æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬çš„ row trx_id æ˜¯ 102, è€Œ 90 è¿™ä¸ªç‰ˆæœ¬å·²ç»æˆä¸ºäº†åŽ†å²ç‰ˆæœ¬")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬äºŒä¸ªæœ‰æ•ˆæ›´æ–°æ˜¯äº‹åŠ¡ B")]),s._v(", æŠŠæ•°æ®ä»Ž (1,2) æ”¹æˆäº† (1,3). è¿™æ—¶å€™, è¿™ä¸ªæ•°æ®çš„æœ€æ–°ç‰ˆæœ¬(å³ row trx_id)æ˜¯ 101, "),t("strong",[s._v("è€Œ 102 åˆæˆä¸ºäº†åŽ†å²ç‰ˆæœ¬")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½æ³¨æ„åˆ°äº†, åœ¨äº‹åŠ¡ A æŸ¥è¯¢çš„æ—¶å€™, å…¶å®žäº‹åŠ¡ B è¿˜"),t("strong",[s._v("æ²¡æœ‰æäº¤")]),s._v(", ä½†æ˜¯å®ƒç”Ÿæˆçš„ (1,3) è¿™ä¸ªç‰ˆæœ¬å·²ç»å˜æˆå½“å‰ç‰ˆæœ¬äº†. "),t("strong",[s._v("ä½†è¿™ä¸ªç‰ˆæœ¬å¯¹äº‹åŠ¡ A å¿…é¡»æ˜¯ä¸å¯è§çš„, å¦åˆ™å°±å˜æˆè„è¯»")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨äº‹åŠ¡ A è¦æ¥è¯»æ•°æ®äº†, å®ƒçš„è§†å›¾æ•°ç»„æ˜¯ [99,100]. å½“ç„¶"),t("mark",[t("strong",[s._v("è¯»æ•°æ®éƒ½æ˜¯ä»Žå½“å‰ç‰ˆæœ¬è¯»èµ·")])]),s._v("çš„. æ‰€ä»¥äº‹åŠ¡ A æŸ¥è¯¢è¯­å¥çš„è¯»æ•°æ®æµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ul",[t("li",[s._v("æ‰¾åˆ° (1,3) çš„æ—¶å€™, "),t("strong",[s._v("åˆ¤æ–­å‡º row trx_id=101, æ¯”é«˜æ°´ä½å¤§, å¤„äºŽçº¢è‰²åŒºåŸŸ, ä¸å¯è§")]),s._v(";")]),s._v(" "),t("li",[s._v("æŽ¥ç€æ‰¾åˆ°ä¸Šä¸€ä¸ªåŽ†å²ç‰ˆæœ¬, "),t("strong",[s._v("ä¸€çœ‹ row trx_id=102, æ¯”é«˜æ°´ä½å¤§, å¤„äºŽçº¢è‰²åŒºåŸŸ, ä¸å¯è§")]),s._v(";")]),s._v(" "),t("li",[s._v("å†å¾€å‰æ‰¾, "),t("strong",[s._v("ç»ˆäºŽæ‰¾åˆ°äº†(1,1), å®ƒçš„ row trx_id=90, æ¯”ä½Žæ°´ä½å°, å¤„äºŽç»¿è‰²åŒºåŸŸ, å¯è§")]),s._v(".")])]),s._v(" "),t("p",[t("strong",[s._v("è¿™æ ·æ‰§è¡Œä¸‹æ¥, è™½ç„¶æœŸé—´è¿™ä¸€è¡Œæ•°æ®è¢«ä¿®æ”¹è¿‡, ä½†æ˜¯äº‹åŠ¡ A ä¸è®ºåœ¨ä»€ä¹ˆæ—¶å€™æŸ¥è¯¢, çœ‹åˆ°è¿™è¡Œæ•°æ®çš„ç»“æžœéƒ½æ˜¯ä¸€è‡´çš„, æ‰€ä»¥ç§°ä¹‹ä¸ºä¸€è‡´æ€§è¯».")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªåˆ¤æ–­è§„åˆ™æ˜¯ä»Žä»£ç é€»è¾‘ç›´æŽ¥è½¬è¯‘è¿‡æ¥çš„, ä½†æ˜¯æ­£å¦‚ä½ æ‰€è§, ç”¨äºŽäººè‚‰åˆ†æžå¯è§æ€§å¾ˆéº»çƒ¦.")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ¥ç¿»è¯‘ä¸€ä¸‹. "),t("strong",[s._v("ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬, å¯¹äºŽä¸€ä¸ªäº‹åŠ¡è§†å›¾æ¥è¯´, é™¤äº†è‡ªå·±çš„æ›´æ–°æ€»æ˜¯å¯è§ä»¥å¤–, æœ‰ä¸‰ç§æƒ…å†µ")]),s._v(":")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ç‰ˆæœ¬æœªæäº¤, ä¸å¯è§;")])]),s._v(" "),t("li",[t("strong",[s._v("ç‰ˆæœ¬å·²æäº¤, ä½†æ˜¯æ˜¯åœ¨è§†å›¾åˆ›å»ºåŽæäº¤çš„, ä¸å¯è§;")])]),s._v(" "),t("li",[t("strong",[s._v("ç‰ˆæœ¬å·²æäº¤, è€Œä¸”æ˜¯åœ¨è§†å›¾åˆ›å»ºå‰æäº¤çš„, å¯è§.")])])]),s._v(" "),t("p",[s._v("çŽ°åœ¨ç”¨è¿™ä¸ªè§„åˆ™æ¥åˆ¤æ–­äº‹åŠ¡ A çš„æŸ¥è¯¢ç»“æžœ, "),t("strong",[s._v("äº‹åŠ¡ A çš„æŸ¥è¯¢è¯­å¥çš„è§†å›¾æ•°ç»„æ˜¯åœ¨äº‹åŠ¡ A å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆçš„")]),s._v(", è¿™æ—¶å€™:")]),s._v(" "),t("ul",[t("li",[s._v("(1,3) è¿˜æ²¡æäº¤, å±žäºŽæƒ…å†µ 1, ä¸å¯è§;")]),s._v(" "),t("li",[s._v("(1,2) è™½ç„¶æäº¤äº†, ä½†æ˜¯æ˜¯åœ¨è§†å›¾æ•°ç»„åˆ›å»ºä¹‹åŽæäº¤çš„, å±žäºŽæƒ…å†µ 2, ä¸å¯è§;")]),s._v(" "),t("li",[s._v("(1,1) æ˜¯åœ¨è§†å›¾æ•°ç»„åˆ›å»ºä¹‹å‰æäº¤çš„, å¯è§.")])]),s._v(" "),t("p",[s._v("ä½ çœ‹, åŽ»æŽ‰æ•°å­—å¯¹æ¯”åŽ, åªç”¨æ—¶é—´å…ˆåŽé¡ºåºæ¥åˆ¤æ–­, åˆ†æžèµ·æ¥æ˜¯ä¸æ˜¯è½»æ¾å¤šäº†. æ‰€ä»¥å°±éƒ½ç”¨è¿™ä¸ªè§„åˆ™æ¥åˆ†æž.")]),s._v(" "),t("h5",{attrs:{id:"æ›´æ–°é€»è¾‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ›´æ–°é€»è¾‘"}},[s._v("#")]),s._v(" æ›´æ–°é€»è¾‘")]),s._v(" "),t("p",[s._v("ç»†å¿ƒçš„åŒå­¦å¯èƒ½æœ‰ç–‘é—®äº†: **äº‹åŠ¡ B çš„ update è¯­å¥, å¦‚æžœæŒ‰ç…§ä¸€è‡´æ€§è¯», å¥½åƒç»“æžœä¸å¯¹å“¦? **")]),s._v(" "),t("p",[s._v("ä¸‹å›¾ä¸­"),t("strong",[s._v("äº‹åŠ¡ B çš„è§†å›¾æ•°ç»„æ˜¯å…ˆç”Ÿæˆ")]),s._v("çš„, ä¹‹åŽäº‹åŠ¡ C æ‰æäº¤, ä¸æ˜¯åº”è¯¥çœ‹ä¸è§ (1,2) å—, æ€Žä¹ˆèƒ½ç®—å‡º (1,3) æ¥?")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1e43438f80289e65443d42b4c57603e2-20230731161914-siomdty.png",alt:"",title:"äº‹åŠ¡Bæ›´æ–°é€»è¾‘å›¾"}})]),s._v(" "),t("p",[s._v("æ˜¯çš„, "),t("strong",[s._v("å¦‚æžœäº‹åŠ¡ B åœ¨æ›´æ–°ä¹‹å‰æŸ¥è¯¢ä¸€æ¬¡æ•°æ®, è¿™ä¸ªæŸ¥è¯¢è¿”å›žçš„ k çš„å€¼ç¡®å®žæ˜¯ 1")]),s._v(". ä½†æ˜¯, å½“å®ƒè¦åŽ»"),t("strong",[s._v("æ›´æ–°æ•°æ®")]),s._v("çš„æ—¶å€™, å°±ä¸èƒ½å†åœ¨åŽ†å²ç‰ˆæœ¬ä¸Šæ›´æ–°äº†, "),t("strong",[s._v("å¦åˆ™äº‹åŠ¡ C çš„æ›´æ–°å°±ä¸¢å¤±äº†")]),s._v(". å› æ­¤äº‹åŠ¡ B æ­¤æ—¶çš„ "),t("code",[s._v("set k=k+1")]),s._v("â€‹ æ˜¯åœ¨ (1,2) çš„åŸºç¡€ä¸Šè¿›è¡Œçš„æ“ä½œ.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¿™é‡Œå°±ç”¨åˆ°äº†è¿™æ ·ä¸€æ¡è§„åˆ™: "),t("mark",[t("strong",[s._v('æ›´æ–°æ•°æ®éƒ½æ˜¯å…ˆè¯»åŽå†™çš„, è€Œè¿™ä¸ªè¯», åªèƒ½è¯»å½“å‰çš„å€¼, ç§°ä¸º"å½“å‰è¯»"(current read)')])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("å› æ­¤åœ¨æ›´æ–°çš„æ—¶å€™, å½“å‰è¯»æ‹¿åˆ°çš„æ•°æ®æ˜¯ (1,2), æ›´æ–°åŽç”Ÿæˆäº†æ–°ç‰ˆæœ¬çš„æ•°æ® (1,3), è¿™ä¸ªæ–°ç‰ˆæœ¬çš„ row trx_id æ˜¯ 101.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥åœ¨"),t("strong",[s._v("æ‰§è¡Œäº‹åŠ¡ B æŸ¥è¯¢è¯­å¥çš„æ—¶å€™, ä¸€çœ‹è‡ªå·±çš„ç‰ˆæœ¬å·æ˜¯ 101, æœ€æ–°æ•°æ®çš„ç‰ˆæœ¬å·ä¹Ÿæ˜¯ 101, æ˜¯è‡ªå·±çš„æ›´æ–°, å¯ä»¥ç›´æŽ¥ä½¿ç”¨, æ‰€ä»¥æŸ¥è¯¢å¾—åˆ°çš„ k çš„å€¼æ˜¯ 3")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™é‡Œæåˆ°äº†ä¸€ä¸ªæ¦‚å¿µ, å«ä½œ"),t("strong",[s._v("å½“å‰è¯»")]),s._v(". å…¶å®žé™¤äº† update è¯­å¥å¤–, "),t("strong",[s._v("select è¯­å¥å¦‚æžœåŠ é”, ä¹Ÿæ˜¯å½“å‰è¯»")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, å¦‚æžœæŠŠäº‹åŠ¡ A çš„æŸ¥è¯¢è¯­å¥ "),t("code",[s._v("select * from t where id=1")]),s._v("â€‹ ä¿®æ”¹ä¸€ä¸‹, "),t("strong",[s._v("åŠ ä¸Š lock in share mode æˆ– for update")]),s._v(", ä¹Ÿéƒ½å¯ä»¥è¯»åˆ°ç‰ˆæœ¬å·æ˜¯ 101 çš„æ•°æ®, è¿”å›žçš„ k çš„å€¼æ˜¯ 3. ä¸‹é¢è¿™ä¸¤ä¸ª select è¯­å¥, å°±æ˜¯åˆ†åˆ«åŠ äº†"),t("strong",[s._v("è¯»é”")]),s._v("(S é”, å…±äº«é”)å’Œ"),t("strong",[s._v("å†™é”")]),s._v("(X é”, æŽ’ä»–é”).")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" k "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("share")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" k "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å†å¾€å‰ä¸€æ­¥, å‡è®¾"),t("strong",[s._v("äº‹åŠ¡ C ä¸æ˜¯é©¬ä¸Šæäº¤")]),s._v("çš„, è€Œæ˜¯å˜æˆäº†ä¸‹é¢çš„äº‹åŠ¡ Câ€™, ä¼šæ€Žä¹ˆæ ·å‘¢?")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b393e95fdd13ea20d18983b0edb68815-20230731161914-ouw3g2l.png",alt:"",title:"äº‹åŠ¡ A, B, C'çš„æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("äº‹åŠ¡ Câ€™ çš„ä¸åŒæ˜¯, "),t("strong",[s._v("æ›´æ–°åŽå¹¶æ²¡æœ‰é©¬ä¸Šæäº¤, åœ¨å®ƒæäº¤å‰, äº‹åŠ¡ B çš„æ›´æ–°è¯­å¥å…ˆå‘èµ·äº†")]),s._v(". å‰é¢è¯´è¿‡äº†, è™½ç„¶äº‹åŠ¡ Câ€™ è¿˜æ²¡æäº¤, ä½†æ˜¯ (1,2) è¿™ä¸ªç‰ˆæœ¬ä¹Ÿå·²ç»ç”Ÿæˆäº†, å¹¶ä¸”æ˜¯"),t("strong",[s._v("å½“å‰çš„æœ€æ–°ç‰ˆæœ¬")]),s._v(". é‚£ä¹ˆäº‹åŠ¡ B çš„æ›´æ–°è¯­å¥ä¼šæ€Žä¹ˆå¤„ç†å‘¢?")]),s._v(" "),t("p",[s._v('è¿™æ—¶å€™, åœ¨ä¸Šä¸€èŠ‚æåˆ°çš„ "'),t("strong",[s._v("ä¸¤é˜¶æ®µé”åè®®")]),s._v('" å°±è¦ä¸Šåœºäº†. äº‹åŠ¡ Câ€™ æ²¡æäº¤, ä¹Ÿå°±æ˜¯è¯´ (1,2) è¿™ä¸ªç‰ˆæœ¬ä¸Šçš„'),t("strong",[s._v("å†™é”è¿˜æ²¡é‡Šæ”¾")]),s._v(". è€Œ"),t("strong",[s._v("äº‹åŠ¡ B æ˜¯å½“å‰è¯», å¿…é¡»è¦è¯»æœ€æ–°ç‰ˆæœ¬, è€Œä¸”å¿…é¡»åŠ é”, å› æ­¤å°±è¢«é”ä½äº†, å¿…é¡»ç­‰åˆ°äº‹åŠ¡ Câ€™ é‡Šæ”¾è¿™ä¸ªé”, æ‰èƒ½ç»§ç»­å®ƒçš„å½“å‰è¯»")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b85b5f0139a968d4097fb9988838bbbe-20230731161914-winndi5.png",alt:"",title:"äº‹åŠ¡ B æ›´æ–°é€»è¾‘å›¾(é…åˆäº‹åŠ¡C')"}})]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œå°±æŠŠ"),t("strong",[s._v("ä¸€è‡´æ€§è¯», å½“å‰è¯»å’Œè¡Œé”")]),s._v("å°±ä¸²èµ·æ¥äº†.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨å†å›žåˆ°å¼€å¤´çš„é—®é¢˜: **äº‹åŠ¡çš„å¯é‡å¤è¯»çš„èƒ½åŠ›æ˜¯æ€Žä¹ˆå®žçŽ°çš„? **")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("å¯é‡å¤è¯»çš„æ ¸å¿ƒå°±æ˜¯ä¸€è‡´æ€§è¯»(consistent read); è€Œäº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™, åªèƒ½ç”¨å½“å‰è¯». å¦‚æžœå½“å‰çš„è®°å½•çš„è¡Œé”è¢«å…¶ä»–äº‹åŠ¡å ç”¨çš„è¯, å°±éœ€è¦è¿›å…¥é”ç­‰å¾…")])]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œè¯»æäº¤çš„é€»è¾‘å’Œå¯é‡å¤è¯»çš„é€»è¾‘ç±»ä¼¼, å®ƒä»¬æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯:")]),s._v(" "),t("ul",[t("li",[s._v("åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹, åªéœ€è¦åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™åˆ›å»ºä¸€è‡´æ€§è§†å›¾, ä¹‹åŽäº‹åŠ¡é‡Œçš„å…¶ä»–æŸ¥è¯¢éƒ½å…±ç”¨è¿™ä¸ªä¸€è‡´æ€§è§†å›¾;")]),s._v(" "),t("li",[s._v("åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹, "),t("strong",[s._v("æ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°ç®—å‡ºä¸€ä¸ªæ–°çš„è§†å›¾")]),s._v(".")])]),s._v(" "),t("p",[s._v("é‚£å†çœ‹ä¸€ä¸‹, åœ¨"),t("strong",[s._v("è¯»æäº¤éš”ç¦»çº§åˆ«")]),s._v("ä¸‹, äº‹åŠ¡ A å’Œäº‹åŠ¡ B çš„æŸ¥è¯¢è¯­å¥æŸ¥åˆ°çš„ k, åˆ†åˆ«åº”è¯¥æ˜¯å¤šå°‘?")]),s._v(" "),t("p",[s._v('è¿™é‡Œéœ€è¦è¯´æ˜Žä¸€ä¸‹, "'),t("code",[s._v("start transaction with consistent snapshot;")]),s._v('â€‹" çš„æ„æ€æ˜¯'),t("strong",[s._v("ä»Žè¿™ä¸ªè¯­å¥å¼€å§‹, å°±åˆ›å»ºä¸€ä¸ªæŒç»­æ•´ä¸ªäº‹åŠ¡çš„ä¸€è‡´æ€§å¿«ç…§")]),s._v(". æ‰€ä»¥åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹, "),t("strong",[s._v("è¿™ä¸ªç”¨æ³•å°±æ²¡æ„ä¹‰äº†")]),s._v(", ç­‰æ•ˆäºŽæ™®é€šçš„ start transaction.")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ˜¯è¯»æäº¤æ—¶çš„çŠ¶æ€å›¾, å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªæŸ¥è¯¢è¯­å¥çš„"),t("strong",[s._v("åˆ›å»ºè§†å›¾æ•°ç»„çš„æ—¶æœºå‘ç”Ÿäº†å˜åŒ–")]),s._v(", å°±æ˜¯å›¾ä¸­çš„ read view æ¡†. (æ³¨æ„: è¿™é‡Œç”¨çš„è¿˜æ˜¯äº‹åŠ¡ C çš„é€»è¾‘ç›´æŽ¥æäº¤, è€Œä¸æ˜¯äº‹åŠ¡ Câ€™).")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4992b1d7aa628333f26b76d8a89187a8-20230731161914-yft946w.png",alt:"",title:"è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹çš„äº‹åŠ¡çŠ¶æ€å›¾"}})]),s._v(" "),t("p",[t("strong",[s._v("è¿™æ—¶äº‹åŠ¡ A çš„æŸ¥è¯¢è¯­å¥çš„è§†å›¾æ•°ç»„æ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªè¯­å¥çš„æ—¶å€™åˆ›å»ºçš„, æ—¶åºä¸Š (1,2), (1,3) çš„ç”Ÿæˆæ—¶é—´éƒ½åœ¨åˆ›å»ºè¿™ä¸ªè§†å›¾æ•°ç»„çš„æ—¶åˆ»ä¹‹å‰")]),s._v(". ä½†æ˜¯åœ¨è¿™ä¸ªæ—¶åˆ»:")]),s._v(" "),t("ul",[t("li",[s._v("(1,3) è¿˜æ²¡æäº¤, å±žäºŽæƒ…å†µ 1, ä¸å¯è§;")]),s._v(" "),t("li",[s._v("(1,2) æäº¤äº†, å±žäºŽæƒ…å†µ 3, å¯è§.")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¿™æ—¶å€™äº‹åŠ¡ A æŸ¥è¯¢è¯­å¥è¿”å›žçš„æ˜¯ k=2. æ˜¾ç„¶åœ°, äº‹åŠ¡ B æŸ¥è¯¢ç»“æžœ k=3.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-8"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[t("strong",[s._v("InnoDB çš„è¡Œæ•°æ®æœ‰å¤šä¸ªç‰ˆæœ¬, æ¯ä¸ªæ•°æ®ç‰ˆæœ¬æœ‰è‡ªå·±çš„ row trx_id, æ¯ä¸ªäº‹åŠ¡æˆ–è€…è¯­å¥æœ‰è‡ªå·±çš„ä¸€è‡´æ€§è§†å›¾. æ™®é€šæŸ¥è¯¢è¯­å¥æ˜¯ä¸€è‡´æ€§è¯», ä¸€è‡´æ€§è¯»ä¼šæ ¹æ® row trx_id å’Œä¸€è‡´æ€§è§†å›¾ç¡®å®šæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§.")])]),s._v(" "),t("ul",[t("li",[t("mark",[t("strong",[s._v("å¯¹äºŽå¯é‡å¤è¯», æŸ¥è¯¢åªæ‰¿è®¤åœ¨äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®;")])])]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("å¯¹äºŽè¯»æäº¤, æŸ¥è¯¢åªæ‰¿è®¤åœ¨è¯­å¥å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®;")])])])]),s._v(" "),t("p",[t("strong",[s._v("è€Œå½“å‰è¯», æ€»æ˜¯è¯»å–å·²ç»æäº¤å®Œæˆçš„æœ€æ–°ç‰ˆæœ¬.")])]),s._v(" "),t("p",[s._v("ä½ ä¹Ÿå¯ä»¥æƒ³ä¸€ä¸‹, "),t("strong",[s._v('ä¸ºä»€ä¹ˆè¡¨ç»“æž„ä¸æ”¯æŒ "å¯é‡å¤è¯»"? è¿™æ˜¯å› ä¸ºè¡¨ç»“æž„æ²¡æœ‰å¯¹åº”çš„è¡Œæ•°æ®, ä¹Ÿæ²¡æœ‰ row trx_id, å› æ­¤åªèƒ½éµå¾ªå½“å‰è¯»çš„é€»è¾‘')]),s._v(". ä¸è¿‡ MySQL 8.0 å·²ç»å¯ä»¥æŠŠè¡¨ç»“æž„æ”¾åœ¨ InnoDB å­—å…¸é‡Œäº†, ä¹Ÿè®¸ä»¥åŽä¼šæ”¯æŒè¡¨ç»“æž„çš„å¯é‡å¤è¯».")]),s._v(" "),t("h4",{attrs:{id:"_09-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•-åº”è¯¥æ€Žä¹ˆé€‰æ‹©"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_09-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•-åº”è¯¥æ€Žä¹ˆé€‰æ‹©"}},[s._v("#")]),s._v(" 09-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•,åº”è¯¥æ€Žä¹ˆé€‰æ‹©?")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»è¿‡ç´¢å¼•çš„åŸºæœ¬æ¦‚å¿µ, ç›¸ä¿¡ä½ å·²ç»äº†è§£äº†å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„åŒºåˆ«. ä»Šå¤©å°±ç»§ç»­æ¥è°ˆè°ˆ, "),t("strong",[s._v("åœ¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹, åº”è¯¥é€‰æ‹©æ™®é€šç´¢å¼•, è¿˜æ˜¯å”¯ä¸€ç´¢å¼•")]),s._v("?")]),s._v(" "),t("p",[s._v("å‡è®¾ä½ åœ¨ç»´æŠ¤ä¸€ä¸ªå¸‚æ°‘ç³»ç»Ÿ, æ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„èº«ä»½è¯å·, è€Œä¸”ä¸šåŠ¡ä»£ç å·²ç»ä¿è¯äº†ä¸ä¼šå†™å…¥ä¸¤ä¸ªé‡å¤çš„èº«ä»½è¯å·. å¦‚æžœå¸‚æ°‘ç³»ç»Ÿéœ€è¦æŒ‰ç…§èº«ä»½è¯å·æŸ¥å§“å, å°±ä¼šæ‰§è¡Œç±»ä¼¼è¿™æ ·çš„ SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" CUser "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id_card "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxxxxxxyyyyyyzzzzz'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ‰€ä»¥ä½ ä¸€å®šä¼šè€ƒè™‘åœ¨ id_card å­—æ®µä¸Šå»ºç´¢å¼•.")]),s._v(" "),t("p",[s._v("ç”±äºŽèº«ä»½è¯å·å­—æ®µæ¯”è¾ƒå¤§, ä¸å»ºè®®æŠŠèº«ä»½è¯å·å½“åšä¸»é”®, é‚£ä¹ˆçŽ°åœ¨æœ‰ä¸¤ä¸ªé€‰æ‹©, è¦ä¹ˆç»™ id_card å­—æ®µ"),t("strong",[s._v("åˆ›å»ºå”¯ä¸€ç´¢å¼•")]),s._v(", è¦ä¹ˆåˆ›å»ºä¸€ä¸ª"),t("strong",[s._v("æ™®é€šç´¢å¼•")]),s._v(". å¦‚æžœä¸šåŠ¡ä»£ç å·²ç»ä¿è¯äº†ä¸ä¼šå†™å…¥é‡å¤çš„èº«ä»½è¯å·, é‚£ä¹ˆè¿™ä¸¤ä¸ªé€‰æ‹©é€»è¾‘ä¸Šéƒ½æ˜¯æ­£ç¡®çš„.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨æˆ‘è¦é—®ä½ çš„æ˜¯, "),t("strong",[s._v("ä»Žæ€§èƒ½çš„è§’åº¦è€ƒè™‘, æ˜¯é€‰æ‹©å”¯ä¸€ç´¢å¼•è¿˜æ˜¯æ™®é€šç´¢å¼•å‘¢? é€‰æ‹©çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢")]),s._v("?")]),s._v(" "),t("p",[s._v("ç®€å•èµ·è§, è¿™é‡Œè¿˜æ˜¯ä»¥ä¹‹å‰çš„ä¾‹å­æ¥è¯´æ˜Ž, å‡è®¾å­—æ®µ k ä¸Šçš„å€¼éƒ½ä¸é‡å¤.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/82754ea191fdd44b8a5f8f97d6cec69d-20230731161914-cjhatc0.png",alt:"",title:"InnoDB çš„ç´¢å¼•ç»„ç»‡ç»“æž„"}})]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å°±ä»Ž"),t("strong",[s._v("è¿™ä¸¤ç§ç´¢å¼•å¯¹æŸ¥è¯¢è¯­å¥å’Œæ›´æ–°è¯­å¥çš„æ€§èƒ½å½±å“")]),s._v("æ¥è¿›è¡Œåˆ†æž.")]),s._v(" "),t("h5",{attrs:{id:"æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹å¯¹æ¯”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹å¯¹æ¯”"}},[s._v("#")]),s._v(" æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹å¯¹æ¯”")]),s._v(" "),t("p",[s._v("å‡è®¾æ‰§è¡ŒæŸ¥è¯¢çš„è¯­å¥æ˜¯ "),t("code",[s._v("select id from T where k=5")]),s._v("â€‹. è¿™ä¸ªæŸ¥è¯¢è¯­å¥åœ¨ç´¢å¼•æ ‘ä¸ŠæŸ¥æ‰¾çš„è¿‡ç¨‹, å…ˆæ˜¯é€šè¿‡ B+ æ ‘ä»Žæ ‘æ ¹å¼€å§‹, æŒ‰å±‚æœç´¢åˆ°å¶å­èŠ‚ç‚¹, ä¹Ÿå°±æ˜¯å›¾ä¸­å³ä¸‹è§’çš„è¿™ä¸ªæ•°æ®é¡µ, ç„¶åŽå¯ä»¥è®¤ä¸ºæ•°æ®é¡µå†…éƒ¨é€šè¿‡äºŒåˆ†æ³•æ¥å®šä½è®°å½•.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å¯¹äºŽæ™®é€šç´¢å¼•æ¥è¯´, æŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½• (5,500) åŽ, éœ€è¦æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•, ç›´åˆ°ç¢°åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ k=5 æ¡ä»¶çš„è®°å½•.")])]),s._v(" "),t("li",[t("strong",[s._v("å¯¹äºŽå”¯ä¸€ç´¢å¼•æ¥è¯´, ç”±äºŽç´¢å¼•å®šä¹‰äº†å”¯ä¸€æ€§, æŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•åŽ, å°±ä¼šåœæ­¢ç»§ç»­æ£€ç´¢")]),s._v(".")])]),s._v(" "),t("p",[s._v("é‚£è¿™ä¸ªä¸åŒå¸¦æ¥çš„æ€§èƒ½å·®è·ä¼šæœ‰å¤šå°‘å‘¢? ç­”æ¡ˆæ˜¯"),t("mark",[t("strong",[s._v("å¾®ä¹Žå…¶å¾®")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ çŸ¥é“çš„, InnoDB çš„æ•°æ®æ˜¯æŒ‰"),t("strong",[s._v("æ•°æ®é¡µä¸ºå•ä½æ¥è¯»å†™")]),s._v("çš„. ä¹Ÿå°±æ˜¯"),t("strong",[s._v("å½“éœ€è¦è¯»ä¸€æ¡è®°å½•çš„æ—¶å€™, å¹¶ä¸æ˜¯å°†è¿™ä¸ªè®°å½•æœ¬èº«ä»Žç£ç›˜è¯»å‡ºæ¥, è€Œæ˜¯ä»¥é¡µä¸ºå•ä½, å°†å…¶æ•´ä½“è¯»å…¥å†…å­˜. åœ¨ InnoDB ä¸­, æ¯ä¸ªæ•°æ®é¡µçš„å¤§å°é»˜è®¤æ˜¯ 16KB")]),s._v(".")]),s._v(" "),t("p",[s._v("å› ä¸ºå¼•æ“Žæ˜¯æŒ‰é¡µè¯»å†™çš„, æ‰€ä»¥å½“æ‰¾åˆ° k=5 çš„è®°å½•çš„æ—¶å€™, å®ƒ"),t("strong",[s._v("æ‰€åœ¨çš„æ•°æ®é¡µå°±éƒ½åœ¨å†…å­˜é‡Œ")]),s._v('äº†. é‚£ä¹ˆå¯¹äºŽæ™®é€šç´¢å¼•æ¥è¯´, è¦å¤šåšçš„é‚£ä¸€æ¬¡ "æŸ¥æ‰¾å’Œåˆ¤æ–­ä¸‹ä¸€æ¡è®°å½•" çš„æ“ä½œ, å°±åªéœ€è¦ä¸€æ¬¡æŒ‡é’ˆå¯»æ‰¾å’Œä¸€æ¬¡è®¡ç®—. å½“ç„¶å¦‚æžœ k=5 è¿™ä¸ªè®°å½•åˆšå¥½æ˜¯è¿™ä¸ªæ•°æ®é¡µçš„æœ€åŽä¸€ä¸ªè®°å½•, é‚£ä¹ˆè¦å–ä¸‹ä¸€ä¸ªè®°å½•, å¿…é¡»è¯»å–ä¸‹ä¸€ä¸ªæ•°æ®é¡µ, è¿™ä¸ªæ“ä½œä¼šç¨å¾®å¤æ‚ä¸€äº›.')]),s._v(" "),t("p",[s._v("ä½†å¯¹äºŽæ•´åž‹å­—æ®µ, ä¸€ä¸ªæ•°æ®é¡µå¯ä»¥æ”¾è¿‘åƒä¸ª key, å› æ­¤å‡ºçŽ°è¿™ç§æƒ…å†µçš„æ¦‚çŽ‡ä¼šå¾ˆä½Ž. æ‰€ä»¥è®¡ç®—å¹³å‡æ€§èƒ½å·®å¼‚æ—¶, ä»å¯ä»¥è®¤ä¸ºè¿™ä¸ªæ“ä½œæˆæœ¬å¯¹äºŽçŽ°åœ¨çš„ CPU æ¥è¯´å¯ä»¥"),t("strong",[s._v("å¿½ç•¥ä¸è®¡")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æ›´æ–°è¿‡ç¨‹å¯¹æ¯”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æ›´æ–°è¿‡ç¨‹å¯¹æ¯”"}},[s._v("#")]),s._v(" æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æ›´æ–°è¿‡ç¨‹å¯¹æ¯”")]),s._v(" "),t("p",[s._v("ä¸ºäº†è¯´æ˜Žæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½çš„å½±å“è¿™ä¸ªé—®é¢˜, éœ€è¦å…ˆä»‹ç»ä¸€ä¸‹ "),t("strong",[s._v("change buffer")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶, å¦‚æžœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æŽ¥æ›´æ–°, è€Œå¦‚æžœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯, åœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹, InooDB ä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨ change buffer ä¸­, è¿™æ ·å°±ä¸éœ€è¦ä»Žç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†. åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™, å°†æ•°æ®é¡µè¯»å…¥å†…å­˜, ç„¶åŽæ‰§è¡Œ change buffer ä¸­ä¸Žè¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œ. é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§.")])]),s._v(" "),t("p",[s._v("éœ€è¦è¯´æ˜Žçš„æ˜¯, è™½ç„¶åå­—å«ä½œ change buffer, å®žé™…ä¸Šå®ƒæ˜¯"),t("strong",[s._v("å¯ä»¥æŒä¹…åŒ–")]),s._v("çš„æ•°æ®. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("change buffer åœ¨å†…å­˜ä¸­æœ‰æ‹·è´, ä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Š")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å°† change buffer ä¸­çš„æ“ä½œåº”ç”¨åˆ°åŽŸæ•°æ®é¡µ, å¾—åˆ°æœ€æ–°ç»“æžœçš„è¿‡ç¨‹ç§°ä¸º merge")]),s._v(". é™¤äº†è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘ merge å¤–, ç³»ç»Ÿæœ‰åŽå°çº¿ç¨‹ä¼š"),t("strong",[s._v("å®šæœŸ merge")]),s._v(". åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­(shutdown)çš„è¿‡ç¨‹ä¸­, ä¹Ÿä¼šæ‰§è¡Œ merge æ“ä½œ.")]),s._v(" "),t("p",[s._v("æ˜¾ç„¶, "),t("strong",[s._v("å¦‚æžœèƒ½å¤Ÿå°†æ›´æ–°æ“ä½œå…ˆè®°å½•åœ¨ change buffer, å‡å°‘è¯»ç£ç›˜, è¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ä¼šå¾—åˆ°æ˜Žæ˜¾çš„æå‡")]),s._v(". è€Œä¸”æ•°æ®è¯»å…¥å†…å­˜æ˜¯éœ€è¦å ç”¨ buffer pool çš„, æ‰€ä»¥è¿™ç§æ–¹å¼è¿˜èƒ½å¤Ÿé¿å…å ç”¨å†…å­˜, æé«˜å†…å­˜åˆ©ç”¨çŽ‡.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, **ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨ change buffer å‘¢? **")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("å¯¹äºŽå”¯ä¸€ç´¢å¼•æ¥è¯´, æ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½è¦å…ˆåˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯å¦è¿åå”¯ä¸€æ€§çº¦æŸ")])]),s._v(". æ¯”å¦‚è¦æ’å…¥ (4,400) è¿™ä¸ªè®°å½•, å°±è¦å…ˆåˆ¤æ–­çŽ°åœ¨è¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ k=4 çš„è®°å½•, è€Œè¿™"),t("strong",[s._v("å¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­")]),s._v(". å¦‚æžœéƒ½å·²ç»è¯»å…¥åˆ°å†…å­˜äº†, é‚£ç›´æŽ¥æ›´æ–°å†…å­˜ä¼šæ›´å¿«, å°±æ²¡å¿…è¦ä½¿ç”¨ change buffer äº†.")]),s._v(" "),t("p",[s._v("å› æ­¤, "),t("mark",[t("strong",[s._v("å”¯ä¸€ç´¢å¼•çš„æ›´æ–°å°±ä¸èƒ½ä½¿ç”¨ change buffer, å®žé™…ä¸Šä¹Ÿåªæœ‰æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨")])]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("change buffer ç”¨çš„æ˜¯ buffer pool é‡Œçš„å†…å­˜")]),s._v(", å› æ­¤ä¸èƒ½æ— é™å¢žå¤§. change buffer çš„å¤§å°, å¯ä»¥é€šè¿‡å‚æ•° innodb_change_buffer_max_size æ¥åŠ¨æ€è®¾ç½®. è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º 50 çš„æ—¶å€™, è¡¨ç¤º change buffer çš„å¤§å°æœ€å¤šåªèƒ½å ç”¨ buffer pool çš„ 50%.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨, ä½ å·²ç»ç†è§£äº† change buffer çš„æœºåˆ¶, é‚£å†ä¸€èµ·æ¥çœ‹çœ‹**å¦‚æžœè¦åœ¨è¿™å¼ è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°è®°å½• (4,400) çš„è¯, InnoDB çš„å¤„ç†æµç¨‹æ˜¯æ€Žæ ·çš„. **")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ç§æƒ…å†µæ˜¯, "),t("mark",[t("strong",[s._v("è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µåœ¨å†…å­˜ä¸­")])]),s._v(". è¿™æ—¶ InnoDB çš„å¤„ç†æµç¨‹å¦‚ä¸‹:")]),s._v(" "),t("ul",[t("li",[s._v("å¯¹äºŽ"),t("strong",[s._v("å”¯ä¸€ç´¢å¼•")]),s._v("æ¥è¯´, æ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®, "),t("strong",[s._v("åˆ¤æ–­åˆ°æ²¡æœ‰å†²çª")]),s._v(", æ’å…¥è¿™ä¸ªå€¼, è¯­å¥æ‰§è¡Œç»“æŸ;")]),s._v(" "),t("li",[s._v("å¯¹äºŽ"),t("strong",[s._v("æ™®é€šç´¢å¼•")]),s._v("æ¥è¯´, æ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®, æ’å…¥è¿™ä¸ªå€¼, è¯­å¥æ‰§è¡Œç»“æŸ.")])]),s._v(" "),t("p",[s._v("è¿™æ ·çœ‹æ¥, æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½å½±å“çš„å·®åˆ«, åªæ˜¯ä¸€ä¸ªåˆ¤æ–­, åªä¼šè€—è´¹å¾®å°çš„ CPU æ—¶é—´. ä½†è¿™ä¸æ˜¯å…³æ³¨çš„é‡ç‚¹.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒç§æƒ…å†µæ˜¯, "),t("mark",[t("strong",[s._v("è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µä¸åœ¨å†…å­˜ä¸­")])]),s._v(". è¿™æ—¶ InnoDB çš„å¤„ç†æµç¨‹å¦‚ä¸‹:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å¯¹äºŽå”¯ä¸€ç´¢å¼•æ¥è¯´, éœ€è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜, åˆ¤æ–­åˆ°æ²¡æœ‰å†²çª, æ’å…¥è¿™ä¸ªå€¼, è¯­å¥æ‰§è¡Œç»“æŸ;")])]),s._v(" "),t("li",[t("strong",[s._v("å¯¹äºŽæ™®é€šç´¢å¼•æ¥è¯´, åˆ™æ˜¯å°†æ›´æ–°è®°å½•åœ¨ change buffer, è¯­å¥æ‰§è¡Œå°±ç»“æŸäº†.")])])]),s._v(" "),t("p",[s._v("å°†æ•°æ®ä»Žç£ç›˜è¯»å…¥å†…å­˜æ¶‰åŠ"),t("strong",[s._v("éšæœº IO çš„è®¿é—®")]),s._v(", æ˜¯æ•°æ®åº“é‡Œé¢æˆæœ¬æœ€é«˜çš„æ“ä½œä¹‹ä¸€. "),t("strong",[s._v("change buffer å› ä¸ºå‡å°‘äº†éšæœºç£ç›˜è®¿é—®, æ‰€ä»¥å¯¹æ›´æ–°æ€§èƒ½çš„æå‡æ˜¯ä¼šå¾ˆæ˜Žæ˜¾çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¹‹å‰æˆ‘å°±ç¢°åˆ°è¿‡ä¸€ä»¶äº‹å„¿, æœ‰ä¸ª DBA çš„åŒå­¦è·Ÿæˆ‘åé¦ˆè¯´, ä»–è´Ÿè´£çš„æŸä¸ªä¸šåŠ¡çš„åº“å†…å­˜å‘½ä¸­çŽ‡çªç„¶ä»Ž 99% é™ä½Žåˆ°äº† 75%, æ•´ä¸ªç³»ç»Ÿå¤„äºŽé˜»å¡žçŠ¶æ€, æ›´æ–°è¯­å¥å…¨éƒ¨å µä½. è€ŒæŽ¢ç©¶å…¶åŽŸå› åŽ, æˆ‘å‘çŽ°è¿™ä¸ªä¸šåŠ¡æœ‰å¤§é‡æ’å…¥æ•°æ®çš„æ“ä½œ, è€Œä»–åœ¨å‰ä¸€å¤©æŠŠå…¶ä¸­çš„æŸä¸ªæ™®é€šç´¢å¼•æ”¹æˆäº†å”¯ä¸€ç´¢å¼•.")]),s._v(" "),t("h5",{attrs:{id:"change-bufferçš„ä½¿ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#change-bufferçš„ä½¿ç”¨åœºæ™¯"}},[s._v("#")]),s._v(" change bufferçš„ä½¿ç”¨åœºæ™¯")]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šé¢çš„åˆ†æž, ä½ å·²ç»æ¸…æ¥šäº†"),t("strong",[s._v("ä½¿ç”¨ change buffer å¯¹æ›´æ–°è¿‡ç¨‹çš„åŠ é€Ÿä½œç”¨, ä¹Ÿæ¸…æ¥šäº† change buffer åªé™äºŽç”¨åœ¨æ™®é€šç´¢å¼•çš„åœºæ™¯ä¸‹, è€Œä¸é€‚ç”¨äºŽå”¯ä¸€ç´¢å¼•")]),s._v(". é‚£ä¹ˆçŽ°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯: "),t("strong",[s._v("æ™®é€šç´¢å¼•çš„æ‰€æœ‰åœºæ™¯, ä½¿ç”¨ change buffer éƒ½å¯ä»¥èµ·åˆ°åŠ é€Ÿä½œç”¨å—")]),s._v("?")]),s._v(" "),t("p",[s._v("**å› ä¸º merge çš„æ—¶å€™æ˜¯çœŸæ­£è¿›è¡Œæ•°æ®æ›´æ–°çš„æ—¶åˆ», è€Œ change buffer çš„ä¸»è¦ç›®çš„å°±æ˜¯å°†è®°å½•çš„å˜æ›´åŠ¨ä½œç¼“å­˜ä¸‹æ¥, æ‰€ä»¥åœ¨ä¸€ä¸ªæ•°æ®é¡µåš merge ä¹‹å‰, change buffer è®°å½•çš„å˜æ›´è¶Šå¤š(ä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤š), æ”¶ç›Šå°±è¶Šå¤§. ** å› æ­¤, "),t("strong",[s._v("å¯¹äºŽå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´, é¡µé¢åœ¨å†™å®Œä»¥åŽé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚çŽ‡æ¯”è¾ƒå°, æ­¤æ—¶ change buffer çš„ä½¿ç”¨æ•ˆæžœæœ€å¥½")]),s._v(". è¿™ç§ä¸šåŠ¡æ¨¡åž‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±», æ—¥å¿—ç±»çš„ç³»ç»Ÿ.")]),s._v(" "),t("p",[s._v("åè¿‡æ¥, å‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„"),t("strong",[s._v("æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åŽé©¬ä¸Šä¼šåšæŸ¥è¯¢")]),s._v(", é‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶, å°†æ›´æ–°å…ˆè®°å½•åœ¨ change buffer, ä½†ä¹‹åŽç”±äºŽé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µ, "),t("strong",[s._v("ä¼šç«‹å³è§¦å‘ merge è¿‡ç¨‹")]),s._v(". è¿™æ ·éšæœºè®¿é—® IO çš„æ¬¡æ•°ä¸ä¼šå‡å°‘, åè€Œå¢žåŠ äº† change buffer çš„ç»´æŠ¤ä»£ä»·. æ‰€ä»¥å¯¹äºŽè¿™ç§ä¸šåŠ¡æ¨¡å¼æ¥è¯´, change buffer "),t("strong",[s._v("åè€Œèµ·åˆ°äº†å‰¯ä½œç”¨")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ç´¢å¼•é€‰æ‹©å’Œå®žè·µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç´¢å¼•é€‰æ‹©å’Œå®žè·µ"}},[s._v("#")]),s._v(" ç´¢å¼•é€‰æ‹©å’Œå®žè·µ")]),s._v(" "),t("p",[s._v("å›žåˆ°å¼€å¤´çš„é—®é¢˜, "),t("mark",[t("strong",[s._v("æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€Žä¹ˆé€‰æ‹©. å…¶å®žè¿™ä¸¤ç±»ç´¢å¼•åœ¨æŸ¥è¯¢èƒ½åŠ›ä¸Šæ˜¯æ²¡å·®åˆ«çš„, ä¸»è¦è€ƒè™‘çš„æ˜¯å¯¹æ›´æ–°æ€§èƒ½çš„å½±å“. æ‰€ä»¥å»ºè®®å°½é‡é€‰æ‹©æ™®é€šç´¢å¼•. å¦‚æžœæ‰€æœ‰çš„æ›´æ–°åŽé¢, éƒ½é©¬ä¸Šä¼´éšç€å¯¹è¿™ä¸ªè®°å½•çš„æŸ¥è¯¢, é‚£ä¹ˆåº”è¯¥å…³é—­ change buffer. è€Œåœ¨å…¶ä»–æƒ…å†µä¸‹, change buffer éƒ½èƒ½æå‡æ›´æ–°æ€§èƒ½.")])])]),s._v(" "),t("p",[s._v("åœ¨å®žé™…ä½¿ç”¨ä¸­, ä½ ä¼šå‘çŽ°, æ™®é€šç´¢å¼•å’Œ change buffer çš„é…åˆä½¿ç”¨, å¯¹äºŽæ•°æ®é‡å¤§çš„è¡¨çš„æ›´æ–°ä¼˜åŒ–è¿˜æ˜¯å¾ˆæ˜Žæ˜¾çš„.")]),s._v(" "),t("p",[s._v('ç‰¹åˆ«åœ°, åœ¨ä½¿ç”¨æœºæ¢°ç¡¬ç›˜æ—¶, change buffer è¿™ä¸ªæœºåˆ¶çš„æ”¶æ•ˆæ˜¯éžå¸¸æ˜¾è‘—çš„. æ‰€ä»¥å½“ä½ æœ‰ä¸€ä¸ªç±»ä¼¼ "åŽ†å²æ•°æ®" çš„åº“, å¹¶ä¸”å‡ºäºŽæˆæœ¬è€ƒè™‘ç”¨çš„æ˜¯æœºæ¢°ç¡¬ç›˜æ—¶, é‚£ä½ åº”è¯¥ç‰¹åˆ«å…³æ³¨è¿™äº›è¡¨é‡Œçš„ç´¢å¼•, å°½é‡ä½¿ç”¨æ™®é€šç´¢å¼•, ç„¶åŽæŠŠ change buffer å°½é‡å¼€å¤§, ä»¥ç¡®ä¿è¿™ä¸ª "åŽ†å²æ•°æ®" è¡¨çš„æ•°æ®å†™å…¥é€Ÿåº¦.')]),s._v(" "),t("h5",{attrs:{id:"change-bufferå’Œredo-log"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#change-bufferå’Œredo-log"}},[s._v("#")]),s._v(" change bufferå’Œredo log")]),s._v(" "),t("p",[s._v("ç†è§£äº† change buffer çš„åŽŸç†, ä½ å¯èƒ½ä¼šè”æƒ³åˆ°å‰é¢ä»‹ç»è¿‡çš„ redo log å’Œ WAL. æœ‰äººå¾ˆå®¹æ˜“æ··æ·† redo log å’Œ change buffer. WAL æå‡æ€§èƒ½çš„æ ¸å¿ƒæœºåˆ¶, ä¹Ÿçš„ç¡®æ˜¯å°½é‡å‡å°‘éšæœºè¯»å†™, è¿™ä¸¤ä¸ªæ¦‚å¿µç¡®å®žå®¹æ˜“æ··æ·†. æ‰€ä»¥è¿™é‡Œæˆ‘æŠŠå®ƒä»¬æ”¾åˆ°äº†åŒä¸€ä¸ªæµç¨‹é‡Œæ¥è¯´æ˜Ž, ä¾¿äºŽä½ åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µ.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨, è¦åœ¨è¡¨ä¸Šæ‰§è¡Œè¿™ä¸ªæ’å…¥è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("k2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™é‡Œå‡è®¾å½“å‰ k ç´¢å¼•æ ‘çš„çŠ¶æ€, æŸ¥æ‰¾åˆ°ä½ç½®åŽ, k1 æ‰€åœ¨çš„"),t("strong",[s._v("æ•°æ®é¡µåœ¨å†…å­˜")]),s._v(" (InnoDB buffer pool) ä¸­, k2 æ‰€åœ¨çš„"),t("strong",[s._v("æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­")]),s._v(". å¦‚å›¾ 2 æ‰€ç¤ºæ˜¯å¸¦ change buffer çš„æ›´æ–°çŠ¶æ€å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b3cfebc9062cf4933129f7c91496c47a-20230731161914-rtz08ms.png",alt:"",title:"å¸¦ change buffer çš„æ›´æ–°è¿‡ç¨‹"}})]),s._v(" "),t("p",[s._v("åˆ†æžè¿™æ¡æ›´æ–°è¯­å¥, ä½ ä¼šå‘çŽ°å®ƒæ¶‰åŠäº†å››ä¸ªéƒ¨åˆ†: "),t("strong",[s._v("å†…å­˜, redo log(ib_log_fileX), æ•°æ®è¡¨ç©ºé—´(t.ibd), ç³»ç»Ÿè¡¨ç©ºé—´(ibdata1)")]),s._v(" .")]),s._v(" "),t("p",[s._v("è¿™æ¡æ›´æ–°è¯­å¥åšäº†å¦‚ä¸‹çš„æ“ä½œ(æŒ‰ç…§å›¾ä¸­çš„æ•°å­—é¡ºåº):")]),s._v(" "),t("ol",[t("li",[s._v("Page 1 åœ¨å†…å­˜ä¸­, ç›´æŽ¥"),t("strong",[s._v("æ›´æ–°å†…å­˜")]),s._v(";")]),s._v(" "),t("li",[s._v('Page 2 æ²¡æœ‰åœ¨å†…å­˜ä¸­, å°±åœ¨å†…å­˜çš„ change buffer åŒºåŸŸ, è®°å½•ä¸‹ "æˆ‘è¦å¾€ Page 2 æ’å…¥ä¸€è¡Œ" è¿™ä¸ªä¿¡æ¯')]),s._v(" "),t("li",[t("strong",[s._v("å°†ä¸Šè¿°ä¸¤ä¸ªåŠ¨ä½œè®°å…¥ redo log ä¸­")]),s._v("(å›¾ä¸­ 3 å’Œ 4).")])]),s._v(" "),t("p",[t("strong",[s._v("åšå®Œä¸Šé¢è¿™äº›, äº‹åŠ¡å°±å¯ä»¥å®Œæˆäº†")]),s._v(". æ‰€ä»¥ä½ ä¼šçœ‹åˆ°, æ‰§è¡Œè¿™æ¡æ›´æ–°è¯­å¥çš„æˆæœ¬å¾ˆä½Ž, å°±æ˜¯"),t("strong",[s._v("å†™äº†ä¸¤å¤„å†…å­˜, ç„¶åŽå†™äº†ä¸€å¤„ç£ç›˜(ä¸¤æ¬¡æ“ä½œåˆåœ¨ä¸€èµ·å†™äº†ä¸€æ¬¡ç£ç›˜), è€Œä¸”è¿˜æ˜¯é¡ºåºå†™çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("åŒæ—¶å›¾ä¸­çš„ä¸¤ä¸ªè™šçº¿ç®­å¤´, "),t("strong",[s._v("æ˜¯åŽå°æ“ä½œ, ä¸å½±å“æ›´æ–°çš„å“åº”æ—¶é—´")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£åœ¨è¿™ä¹‹åŽçš„"),t("strong",[s._v("è¯»è¯·æ±‚")]),s._v(", è¦æ€Žä¹ˆå¤„ç†å‘¢?")]),s._v(" "),t("p",[s._v("æ¯”å¦‚çŽ°åœ¨è¦æ‰§è¡Œ "),t("code",[s._v("select * from t where k in (k1, k2)")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("è¿™é‡Œç”»äº†è¿™ä¸¤ä¸ªè¯»è¯·æ±‚çš„æµç¨‹å›¾. å¦‚æžœè¯»è¯­å¥å‘ç”Ÿåœ¨æ›´æ–°è¯­å¥åŽä¸ä¹…, "),t("strong",[s._v("å†…å­˜ä¸­çš„æ•°æ®éƒ½è¿˜åœ¨, é‚£ä¹ˆæ­¤æ—¶çš„è¿™ä¸¤ä¸ªè¯»æ“ä½œå°±ä¸Žç³»ç»Ÿè¡¨ç©ºé—´(ibdata1)å’Œ redo log(ib_log_fileX)æ— å…³äº†")]),s._v(". æ‰€ä»¥åœ¨å›¾ä¸­å°±æ²¡ç”»å‡ºè¿™ä¸¤éƒ¨åˆ†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7d967b002d7385628890f57e7129dec4-20230731161914-qppnymk.png",alt:"",title:"å¸¦ change buffer çš„è¯»è¿‡ç¨‹"}})]),s._v(" "),t("p",[s._v("ä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("è¯» Page 1 çš„æ—¶å€™, ç›´æŽ¥ä»Žå†…å­˜è¿”å›ž")]),s._v(". æœ‰äººé—®åˆ°, WAL ä¹‹åŽå¦‚æžœè¯»æ•°æ®, æ˜¯ä¸æ˜¯ä¸€å®šè¦è¯»ç›˜, æ˜¯ä¸æ˜¯ä¸€å®šè¦ä»Ž redo log é‡Œé¢æŠŠæ•°æ®æ›´æ–°ä»¥åŽæ‰å¯ä»¥è¿”å›ž? å…¶å®žæ˜¯ä¸ç”¨çš„. å¯ä»¥çœ‹ä¸€ä¸‹ä¸Šå›¾çš„è¿™ä¸ªçŠ¶æ€, è™½ç„¶ç£ç›˜ä¸Šè¿˜æ˜¯ä¹‹å‰çš„æ•°æ®, ä½†æ˜¯è¿™é‡Œç›´æŽ¥ä»Žå†…å­˜è¿”å›žç»“æžœ, ç»“æžœæ˜¯æ­£ç¡®çš„.")]),s._v(" "),t("li",[t("strong",[s._v("è¦è¯» Page 2 çš„æ—¶å€™, éœ€è¦æŠŠ Page 2 ä»Žç£ç›˜è¯»å…¥å†…å­˜ä¸­, ç„¶åŽåº”ç”¨ change buffer é‡Œé¢çš„æ“ä½œæ—¥å¿—, ç”Ÿæˆä¸€ä¸ªæ­£ç¡®çš„ç‰ˆæœ¬å¹¶è¿”å›žç»“æžœ")]),s._v(".")])]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ç›´åˆ°éœ€è¦è¯» Page 2 çš„æ—¶å€™, è¿™ä¸ªæ•°æ®é¡µæ‰ä¼šè¢«è¯»å…¥å†…å­˜.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, å¦‚æžœè¦ç®€å•åœ°å¯¹æ¯”è¿™ä¸¤ä¸ªæœºåˆ¶åœ¨æå‡æ›´æ–°æ€§èƒ½ä¸Šçš„æ”¶ç›Šçš„è¯, "),t("mark",[t("strong",[s._v("redo log ä¸»è¦èŠ‚çœçš„æ˜¯éšæœºå†™ç£ç›˜çš„ IO æ¶ˆè€—(è½¬æˆé¡ºåºå†™), è€Œ change buffer ä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„ IO æ¶ˆè€—")])]),s._v("â€‹ **. **")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-9"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚"),t("strong",[s._v("ä»Žæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„é€‰æ‹©å¼€å§‹, ä»‹ç»äº†æ•°æ®çš„æŸ¥è¯¢å’Œæ›´æ–°è¿‡ç¨‹")]),s._v(", ç„¶åŽè¯´æ˜Žäº† change buffer çš„æœºåˆ¶ä»¥åŠåº”ç”¨åœºæ™¯, æœ€åŽè®²åˆ°äº†ç´¢å¼•é€‰æ‹©çš„å®žè·µ. ç”±äºŽå”¯ä¸€ç´¢å¼•ç”¨ä¸ä¸Š change buffer çš„ä¼˜åŒ–æœºåˆ¶, å› æ­¤å¦‚æžœä¸šåŠ¡å¯ä»¥æŽ¥å—, ä»Žæ€§èƒ½è§’åº¦å‡ºå‘å»ºè®®ä¼˜å…ˆè€ƒè™‘éžå”¯ä¸€ç´¢å¼•.")]),s._v(" "),t("p",[s._v("æä¸ªé—®é¢˜. é€šè¿‡å›¾ 2 å¯ä»¥çœ‹åˆ°, change buffer ä¸€å¼€å§‹æ˜¯"),t("strong",[s._v("å†™å†…å­˜")]),s._v("çš„, é‚£ä¹ˆå¦‚æžœè¿™ä¸ªæ—¶å€™æœºå™¨æŽ‰ç”µé‡å¯, ä¼šä¸ä¼šå¯¼è‡´ change buffer ä¸¢å¤±å‘¢? change buffer ä¸¢å¤±å¯ä¸æ˜¯å°äº‹å„¿, å†ä»Žç£ç›˜è¯»å…¥æ•°æ®å¯å°±æ²¡æœ‰äº† merge è¿‡ç¨‹, å°±ç­‰äºŽæ˜¯æ•°æ®ä¸¢å¤±äº†. ä¼šä¸ä¼šå‡ºçŽ°è¿™ç§æƒ…å†µå‘¢?")]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯"),t("strong",[s._v("ä¸ä¼šä¸¢å¤±")]),s._v(". è™½ç„¶æ˜¯"),t("strong",[s._v("åªæ›´æ–°å†…å­˜, ä½†æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™, åŒæ—¶æŠŠ change buffer çš„æ“ä½œä¹Ÿè®°å½•åˆ° redo log é‡Œäº†, æ‰€ä»¥å´©æºƒæ¢å¤çš„æ—¶å€™, change buffer ä¹Ÿèƒ½æ‰¾å›žæ¥")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ merge çš„è¿‡ç¨‹æ˜¯å¦ä¼šæŠŠæ•°æ®ç›´æŽ¥å†™å›žç£ç›˜? è¿™æ˜¯ä¸ªå¥½é—®é¢˜. è¿™é‡Œå†åˆ†æžä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("merge çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Žç£ç›˜è¯»å…¥æ•°æ®é¡µåˆ°å†…å­˜(è€ç‰ˆæœ¬çš„æ•°æ®é¡µ);")]),s._v(" "),t("li",[s._v("ä»Ž change buffer é‡Œæ‰¾å‡ºè¿™ä¸ªæ•°æ®é¡µçš„ change buffer è®°å½• (å¯èƒ½æœ‰å¤šä¸ª), ä¾æ¬¡åº”ç”¨, å¾—åˆ°"),t("strong",[s._v("æ–°ç‰ˆæ•°æ®é¡µ")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("å†™ redo log. è¿™ä¸ª redo log åŒ…å«äº†æ•°æ®çš„å˜æ›´å’Œ change buffer çš„å˜æ›´.")])])]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œ merge è¿‡ç¨‹å°±ç»“æŸäº†. "),t("strong",[s._v("è¿™æ—¶å€™æ•°æ®é¡µå’Œå†…å­˜ä¸­ change buffer å¯¹åº”çš„ç£ç›˜ä½ç½®éƒ½è¿˜æ²¡æœ‰ä¿®æ”¹, å±žäºŽè„é¡µ, ä¹‹åŽå„è‡ªåˆ·å›žè‡ªå·±çš„ç‰©ç†æ•°æ®, å°±æ˜¯å¦å¤–ä¸€ä¸ªè¿‡ç¨‹äº†")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_10-mysqlä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-mysqlä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•"}},[s._v("#")]),s._v(" 10-MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•?")]),s._v(" "),t("p",[s._v("MySQL ä¸­ä¸€å¼ è¡¨å…¶å®žæ˜¯å¯ä»¥æ”¯æŒå¤šä¸ªç´¢å¼•çš„. ä½†æ˜¯å†™ SQL è¯­å¥çš„æ—¶å€™, å¹¶æ²¡æœ‰ä¸»åŠ¨æŒ‡å®šä½¿ç”¨å“ªä¸ªç´¢å¼•. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("ä½¿ç”¨å“ªä¸ªç´¢å¼•æ˜¯ç”± MySQL æ¥ç¡®å®š")]),s._v("çš„. ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ç¢°åˆ°è¿‡è¿™ç§æƒ…å†µ, ä¸€æ¡æœ¬æ¥å¯ä»¥æ‰§è¡Œå¾—å¾ˆå¿«çš„è¯­å¥, "),t("strong",[s._v("å´ç”±äºŽ MySQL é€‰é”™äº†ç´¢å¼•, è€Œå¯¼è‡´æ‰§è¡Œé€Ÿåº¦å˜å¾—å¾ˆæ…¢")]),s._v("?")]),s._v(" "),t("p",[s._v("ä¸€èµ·æ¥çœ‹ä¸€ä¸ªä¾‹å­. å…ˆå»ºä¸€ä¸ªç®€å•çš„è¡¨, è¡¨é‡Œæœ‰ a, b ä¸¤ä¸ªå­—æ®µ, å¹¶åˆ†åˆ«å»ºä¸Šç´¢å¼•:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("ç„¶åŽå¾€è¡¨ t ä¸­æ’å…¥ 10 ä¸‡è¡Œè®°å½•, å–å€¼æŒ‰æ•´æ•°é€’å¢ž, å³: (1,1,1), (2,2,2), (3,3,3) ç›´åˆ° (100000,100000,100000). è¿™é‡Œæ˜¯ç”¨å­˜å‚¨è¿‡ç¨‹æ¥æ’å…¥æ•°æ®çš„, å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("æŽ¥ä¸‹æ¥åˆ†æžä¸€æ¡ SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä½ ä¸€å®šä¼šè¯´, è¿™ä¸ªè¯­å¥è¿˜ç”¨åˆ†æžå—, å¾ˆç®€å•å‘€, a ä¸Šæœ‰ç´¢å¼•, è‚¯å®šæ˜¯è¦ä½¿ç”¨ç´¢å¼• a çš„.")]),s._v(" "),t("p",[s._v("æ²¡é”™, å›¾ 1 æ˜¾ç¤ºçš„å°±æ˜¯ä½¿ç”¨ explain å‘½ä»¤çœ‹åˆ°çš„è¿™æ¡è¯­å¥çš„æ‰§è¡Œæƒ…å†µ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0cd772826fd1d3111f65e0971ee3396e-20230731161914-ctp3544.png",alt:"",title:"ä½¿ç”¨ explain å‘½ä»¤æŸ¥çœ‹è¯­å¥æ‰§è¡Œæƒ…å†µ"}})]),s._v(" "),t("p",[s._v("ä»Žå›¾ 1 çœ‹ä¸ŠåŽ», è¿™æ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œä¹Ÿç¡®å®žç¬¦åˆé¢„æœŸ, key è¿™ä¸ªå­—æ®µå€¼æ˜¯ 'a', è¡¨ç¤ºä¼˜åŒ–å™¨"),t("strong",[s._v("é€‰æ‹©äº†ç´¢å¼• a")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸è¿‡åˆ«æ€¥, è¿™ä¸ªæ¡ˆä¾‹ä¸ä¼šè¿™ä¹ˆç®€å•. è¿™æ¬¡å†åšå¦‚ä¸‹æ“ä½œ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8158eae4ec2fcf92f7971f3032dd94b3-20230731161914-gp310dd.png",alt:"",title:"session A å’Œ session B çš„æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("è¿™é‡Œ, session A çš„æ“ä½œå°±æ˜¯"),t("strong",[s._v("å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡")]),s._v(". éšåŽ, session B æŠŠæ•°æ®éƒ½åˆ é™¤åŽ, åˆè°ƒç”¨äº† idata è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹, æ’å…¥äº† 10 ä¸‡è¡Œæ•°æ®.")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™ "),t("code",[s._v("session B çš„æŸ¥è¯¢è¯­å¥ select * from t where a between 10000 and 20000")]),s._v("â€‹ å°±"),t("strong",[s._v("ä¸ä¼šå†é€‰æ‹©ç´¢å¼• a äº†")]),s._v(". å¯ä»¥é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—(slow log)æ¥æŸ¥çœ‹ä¸€ä¸‹å…·ä½“çš„æ‰§è¡Œæƒ…å†µ. ä¸ºäº†è¯´æ˜Žä¼˜åŒ–å™¨é€‰æ‹©çš„ç»“æžœæ˜¯å¦æ­£ç¡®, æˆ‘å¢žåŠ äº†ä¸€ä¸ªå¯¹ç…§, å³: ä½¿ç”¨ "),t("code",[s._v("force index(a)")]),s._v("â€‹ æ¥è®©ä¼˜åŒ–å™¨å¼ºåˆ¶ä½¿ç”¨ç´¢å¼• a.")]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ä¸‰æ¡ SQL è¯­å¥, å°±æ˜¯è¿™ä¸ªå®žéªŒè¿‡ç¨‹.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" long_query_time"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*Q1*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("force")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*Q2*/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("ç¬¬ä¸€å¥, æ˜¯å°†æ…¢æŸ¥è¯¢æ—¥å¿—çš„é˜ˆå€¼è®¾ç½®ä¸º 0, è¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹æŽ¥ä¸‹æ¥çš„è¯­å¥"),t("strong",[s._v("éƒ½ä¼šè¢«è®°å½•å…¥æ…¢æŸ¥è¯¢æ—¥å¿—")]),s._v("ä¸­;")]),s._v(" "),t("li",[s._v("ç¬¬äºŒå¥, Q1 æ˜¯ session B åŽŸæ¥çš„æŸ¥è¯¢;")]),s._v(" "),t("li",[s._v("ç¬¬ä¸‰å¥, Q2 æ˜¯åŠ äº† force index(a) æ¥å’Œ session B åŽŸæ¥çš„æŸ¥è¯¢è¯­å¥æ‰§è¡Œæƒ…å†µå¯¹æ¯”.")])]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤ºæ˜¯è¿™ä¸‰æ¡ SQL è¯­å¥æ‰§è¡Œå®ŒæˆåŽçš„æ…¢æŸ¥è¯¢æ—¥å¿—.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4a66147c5e2e7d54050c7944b4ea2b3b-20230731161914-t0cpodg.png",alt:"",title:"slow log ç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, Q1 æ‰«æäº† 10 ä¸‡è¡Œ, æ˜¾ç„¶æ˜¯èµ°äº†"),t("strong",[s._v("å…¨è¡¨æ‰«æ")]),s._v(", æ‰§è¡Œæ—¶é—´æ˜¯ 40 æ¯«ç§’. Q2 æ‰«æäº† 10001 è¡Œ, æ‰§è¡Œäº† 21 æ¯«ç§’. ä¹Ÿå°±æ˜¯è¯´åœ¨æ²¡æœ‰ä½¿ç”¨ force index çš„æ—¶å€™, MySQL ç”¨é”™äº†ç´¢å¼•, å¯¼è‡´äº†æ›´é•¿çš„æ‰§è¡Œæ—¶é—´.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªä¾‹å­å¯¹åº”çš„æ˜¯"),t("strong",[s._v("å¹³å¸¸ä¸æ–­åœ°åˆ é™¤åŽ†å²æ•°æ®å’Œæ–°å¢žæ•°æ®çš„åœºæ™¯")]),s._v(". è¿™æ—¶ MySQL ç«Ÿç„¶ä¼šé€‰é”™ç´¢å¼•, æ˜¯ä¸æ˜¯æœ‰ç‚¹å¥‡æ€ªå‘¢? æœ¬èŠ‚å°±ä»Žè¿™ä¸ªå¥‡æ€ªçš„ç»“æžœè¯´èµ·.")]),s._v(" "),t("h5",{attrs:{id:"ä¼˜åŒ–å™¨çš„é€»è¾‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŒ–å™¨çš„é€»è¾‘"}},[s._v("#")]),s._v(" ä¼˜åŒ–å™¨çš„é€»è¾‘")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°è¿‡, "),t("strong",[s._v("é€‰æ‹©ç´¢å¼•æ˜¯ä¼˜åŒ–å™¨çš„å·¥ä½œ")]),s._v(". è€Œä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•çš„ç›®çš„, æ˜¯"),t("strong",[s._v("æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆ, å¹¶ç”¨æœ€å°çš„ä»£ä»·åŽ»æ‰§è¡Œè¯­å¥")]),s._v(". åœ¨æ•°æ®åº“é‡Œé¢, "),t("strong",[s._v("æ‰«æè¡Œæ•°æ˜¯å½±å“æ‰§è¡Œä»£ä»·çš„å› ç´ ä¹‹ä¸€")]),s._v(". æ‰«æçš„è¡Œæ•°è¶Šå°‘, æ„å‘³ç€è®¿é—®ç£ç›˜æ•°æ®çš„æ¬¡æ•°è¶Šå°‘, æ¶ˆè€—çš„ CPU èµ„æºè¶Šå°‘. å½“ç„¶, æ‰«æè¡Œæ•°å¹¶ä¸æ˜¯å”¯ä¸€çš„åˆ¤æ–­æ ‡å‡†, ä¼˜åŒ–å™¨è¿˜ä¼šç»“åˆ"),t("strong",[s._v("æ˜¯å¦ä½¿ç”¨ä¸´æ—¶è¡¨, æ˜¯å¦æŽ’åºç­‰å› ç´ ")]),s._v("è¿›è¡Œç»¼åˆåˆ¤æ–­.")]),s._v(" "),t("p",[s._v("å‰é¢è¿™ä¸ªç®€å•çš„æŸ¥è¯¢è¯­å¥å¹¶æ²¡æœ‰æ¶‰åŠåˆ°ä¸´æ—¶è¡¨å’ŒæŽ’åº, æ‰€ä»¥ MySQL é€‰é”™ç´¢å¼•è‚¯å®šæ˜¯åœ¨"),t("strong",[s._v("åˆ¤æ–­æ‰«æè¡Œæ•°")]),s._v("çš„æ—¶å€™å‡ºé—®é¢˜äº†. é‚£é—®é¢˜å°±æ˜¯: **æ‰«æè¡Œæ•°æ˜¯æ€Žä¹ˆåˆ¤æ–­çš„? **")]),s._v(" "),t("p",[s._v("MySQL åœ¨çœŸæ­£å¼€å§‹æ‰§è¡Œè¯­å¥ä¹‹å‰, å¹¶ä¸èƒ½ç²¾ç¡®åœ°çŸ¥é“æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„è®°å½•æœ‰å¤šå°‘æ¡, è€Œåªèƒ½"),t("strong",[s._v("æ ¹æ®ç»Ÿè®¡ä¿¡æ¯")]),s._v("æ¥ä¼°ç®—è®°å½•æ•°. "),t("strong",[s._v('è¿™ä¸ªç»Ÿè®¡ä¿¡æ¯å°±æ˜¯ç´¢å¼•çš„ "åŒºåˆ†åº¦". æ˜¾ç„¶ä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼è¶Šå¤š, è¿™ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦å°±è¶Šå¥½. è€Œä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼çš„ä¸ªæ•°, ç§°ä¹‹ä¸º"åŸºæ•°"(cardinality). ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªåŸºæ•°è¶Šå¤§, ç´¢å¼•çš„åŒºåˆ†åº¦è¶Šå¥½')]),s._v(".")]),s._v(" "),t("p",[s._v("å¯ä»¥ä½¿ç”¨ show index æ–¹æ³•, çœ‹åˆ°"),t("strong",[s._v("ä¸€ä¸ªç´¢å¼•çš„åŸºæ•°")]),s._v(". å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯è¡¨ t çš„ show index çš„ç»“æžœ. è™½ç„¶è¿™ä¸ªè¡¨çš„æ¯ä¸€è¡Œçš„ä¸‰ä¸ªå­—æ®µå€¼éƒ½æ˜¯ä¸€æ ·çš„, ä½†æ˜¯åœ¨ç»Ÿè®¡ä¿¡æ¯ä¸­, è¿™ä¸‰ä¸ªç´¢å¼•çš„åŸºæ•°å€¼å¹¶ä¸åŒ, è€Œä¸”å…¶å®žéƒ½ä¸å‡†ç¡®.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/95d34d543897ed8af71c2feb651644f7-20230731161914-xf9sibu.png",alt:"",title:"è¡¨ t çš„ show index ç»“æžœ"}})]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, "),t("strong",[s._v("MySQL æ˜¯æ€Žæ ·å¾—åˆ°ç´¢å¼•çš„åŸºæ•°çš„å‘¢? ** è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ MySQL é‡‡æ ·ç»Ÿè®¡çš„æ–¹æ³•. ä¸ºä»€ä¹ˆè¦")]),s._v('é‡‡æ ·ç»Ÿè®¡**å‘¢? å› ä¸ºæŠŠæ•´å¼ è¡¨å–å‡ºæ¥ä¸€è¡Œè¡Œç»Ÿè®¡, è™½ç„¶å¯ä»¥å¾—åˆ°ç²¾ç¡®çš„ç»“æžœ, ä½†æ˜¯ä»£ä»·å¤ªé«˜äº†, æ‰€ä»¥åªèƒ½é€‰æ‹© "é‡‡æ ·ç»Ÿè®¡".')]),s._v(" "),t("p",[t("strong",[s._v("é‡‡æ ·ç»Ÿè®¡çš„æ—¶å€™, InnoDB é»˜è®¤ä¼šé€‰æ‹© N ä¸ªæ•°æ®é¡µ, ç»Ÿè®¡è¿™äº›é¡µé¢ä¸Šçš„ä¸åŒå€¼, å¾—åˆ°ä¸€ä¸ªå¹³å‡å€¼, ç„¶åŽä¹˜ä»¥è¿™ä¸ªç´¢å¼•çš„é¡µé¢æ•°, å°±å¾—åˆ°äº†è¿™ä¸ªç´¢å¼•çš„åŸºæ•°. è€Œæ•°æ®è¡¨æ˜¯ä¼šæŒç»­æ›´æ–°çš„, ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¹Ÿä¸ä¼šå›ºå®šä¸å˜. æ‰€ä»¥å½“å˜æ›´çš„æ•°æ®è¡Œæ•°è¶…è¿‡ 1/M çš„æ—¶å€™, ä¼šè‡ªåŠ¨è§¦å‘é‡æ–°åšä¸€æ¬¡ç´¢å¼•ç»Ÿè®¡.")])]),s._v(" "),t("p",[s._v("åœ¨ MySQL ä¸­, æœ‰ä¸¤ç§å­˜å‚¨ç´¢å¼•ç»Ÿè®¡çš„æ–¹å¼, å¯ä»¥é€šè¿‡è®¾ç½®å‚æ•° "),t("strong",[s._v("innodb_stats_persistent")]),s._v(" çš„å€¼æ¥é€‰æ‹©:")]),s._v(" "),t("ul",[t("li",[s._v("è®¾ç½®ä¸º on çš„æ—¶å€™, è¡¨ç¤º"),t("strong",[s._v("ç»Ÿè®¡ä¿¡æ¯ä¼šæŒä¹…åŒ–å­˜å‚¨")]),s._v(". è¿™æ—¶, é»˜è®¤çš„ N æ˜¯ 20, M æ˜¯ 10.")]),s._v(" "),t("li",[s._v("è®¾ç½®ä¸º off çš„æ—¶å€™, è¡¨ç¤º"),t("strong",[s._v("ç»Ÿè®¡ä¿¡æ¯åªå­˜å‚¨åœ¨å†…å­˜ä¸­")]),s._v(". è¿™æ—¶, é»˜è®¤çš„ N æ˜¯ 8, M æ˜¯ 16.")])]),s._v(" "),t("p",[s._v("ç”±äºŽæ˜¯é‡‡æ ·ç»Ÿè®¡, æ‰€ä»¥ä¸ç®¡ N æ˜¯ 20 è¿˜æ˜¯ 8, è¿™ä¸ªåŸºæ•°éƒ½æ˜¯å¾ˆå®¹æ˜“ä¸å‡†çš„.")]),s._v(" "),t("p",[s._v("ä½†è¿™è¿˜ä¸æ˜¯å…¨éƒ¨. ä½ å¯ä»¥ä»Žå›¾ 4 ä¸­çœ‹åˆ°, è¿™æ¬¡çš„ç´¢å¼•ç»Ÿè®¡å€¼(cardinality åˆ—)è™½ç„¶ä¸å¤Ÿç²¾ç¡®, ä½†å¤§ä½“ä¸Šè¿˜æ˜¯å·®ä¸å¤šçš„, é€‰é”™ç´¢å¼•ä¸€å®šè¿˜æœ‰åˆ«çš„åŽŸå› .")]),s._v(" "),t("p",[t("strong",[s._v("å…¶å®žç´¢å¼•ç»Ÿè®¡åªæ˜¯ä¸€ä¸ªè¾“å…¥, å¯¹äºŽä¸€ä¸ªå…·ä½“çš„è¯­å¥æ¥è¯´, ä¼˜åŒ–å™¨è¿˜è¦åˆ¤æ–­, æ‰§è¡Œè¿™ä¸ªè¯­å¥æœ¬èº«è¦æ‰«æå¤šå°‘è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†ä¸€èµ·çœ‹çœ‹ä¼˜åŒ–å™¨"),t("strong",[s._v("é¢„ä¼°çš„, è¿™ä¸¤ä¸ªè¯­å¥çš„æ‰«æè¡Œæ•°")]),s._v("æ˜¯å¤šå°‘. ä¸‹å›¾ rows è¿™ä¸ªå­—æ®µè¡¨ç¤ºçš„æ˜¯"),t("strong",[s._v("é¢„è®¡æ‰«æè¡Œæ•°")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c2b2bb5178315f9f65d72c1901b2f190-20230731161914-qoavbtf.png",alt:"",title:"æ„å¤–çš„ explain ç»“æžœ"}})]),s._v(" "),t("p",[s._v("å…¶ä¸­, Q1 çš„ç»“æžœè¿˜æ˜¯ç¬¦åˆé¢„æœŸçš„, rows çš„å€¼æ˜¯ 104620; ä½†æ˜¯ Q2 çš„ rows å€¼æ˜¯ 37116, åå·®å°±å¤§äº†. è€Œå›¾ 1 ä¸­ç”¨ explain å‘½ä»¤çœ‹åˆ°çš„ rows æ˜¯åªæœ‰ 10001 è¡Œ, æ˜¯è¿™ä¸ªåå·®è¯¯å¯¼äº†ä¼˜åŒ–å™¨çš„åˆ¤æ–­.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œ, å¯èƒ½ä½ çš„ç¬¬ä¸€ä¸ªç–‘é—®ä¸æ˜¯ä¸ºä»€ä¹ˆä¸å‡†, è€Œæ˜¯ä¼˜åŒ–å™¨ä¸ºä»€ä¹ˆæ”¾ç€æ‰«æ 37000 è¡Œçš„æ‰§è¡Œè®¡åˆ’ä¸ç”¨, å´é€‰æ‹©äº†æ‰«æè¡Œæ•°æ˜¯ 100000 çš„æ‰§è¡Œè®¡åˆ’å‘¢?")]),s._v(" "),t("p",[s._v("è¿™æ˜¯å› ä¸º, "),t("strong",[s._v("å¦‚æžœä½¿ç”¨ç´¢å¼• a, æ¯æ¬¡ä»Žç´¢å¼• a ä¸Šæ‹¿åˆ°ä¸€ä¸ªå€¼, éƒ½è¦å›žåˆ°ä¸»é”®ç´¢å¼•ä¸ŠæŸ¥å‡ºæ•´è¡Œæ•°æ®, è¿™ä¸ªä»£ä»·ä¼˜åŒ–å™¨ä¹Ÿè¦ç®—è¿›åŽ»çš„")]),s._v(". è€Œå¦‚æžœé€‰æ‹©æ‰«æ 10 ä¸‡è¡Œ, æ˜¯ç›´æŽ¥åœ¨"),t("strong",[s._v("ä¸»é”®ç´¢å¼•")]),s._v("ä¸Šæ‰«æçš„, æ²¡æœ‰é¢å¤–çš„ä»£ä»·.")]),s._v(" "),t("p",[s._v("ä¼˜åŒ–å™¨ä¼šä¼°ç®—è¿™ä¸¤ä¸ªé€‰æ‹©çš„ä»£ä»·, ä»Žç»“æžœçœ‹æ¥, "),t("strong",[s._v("ä¼˜åŒ–å™¨è®¤ä¸ºç›´æŽ¥æ‰«æä¸»é”®ç´¢å¼•æ›´å¿«")]),s._v(". å½“ç„¶ä»Žæ‰§è¡Œæ—¶é—´çœ‹æ¥, è¿™ä¸ªé€‰æ‹©å¹¶ä¸æ˜¯æœ€ä¼˜çš„.")]),s._v(" "),t("p",[s._v("ä½¿ç”¨æ™®é€šç´¢å¼•éœ€è¦æŠŠå›žè¡¨çš„ä»£ä»·ç®—è¿›åŽ», åœ¨å›¾ 1 æ‰§è¡Œ explain çš„æ—¶å€™, ä¹Ÿè€ƒè™‘äº†è¿™ä¸ªç­–ç•¥çš„ä»£ä»·, ä½†å›¾ 1 çš„é€‰æ‹©æ˜¯å¯¹çš„. ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªç­–ç•¥å¹¶æ²¡æœ‰é—®é¢˜.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥å†¤æœ‰å¤´å€ºæœ‰ä¸», MySQL é€‰é”™ç´¢å¼•, è¿™ä»¶äº‹å„¿è¿˜å¾—å½’å’Žåˆ°"),t("strong",[s._v("æ²¡èƒ½å‡†ç¡®åœ°åˆ¤æ–­å‡ºæ‰«æè¡Œæ•°")]),s._v(". è‡³äºŽä¸ºä»€ä¹ˆä¼šå¾—åˆ°é”™è¯¯çš„æ‰«æè¡Œæ•°, è¿™ä¸ªåŽŸå› å°±ä½œä¸ºè¯¾åŽé—®é¢˜, ç•™ç»™ä½ åŽ»åˆ†æžäº†.")]),s._v(" "),t("p",[s._v("æ—¢ç„¶æ˜¯ç»Ÿè®¡ä¿¡æ¯ä¸å¯¹, é‚£å°±ä¿®æ­£. "),t("strong",[s._v("analyze tablet å‘½ä»¤, å¯ä»¥ç”¨æ¥é‡æ–°ç»Ÿè®¡ç´¢å¼•ä¿¡æ¯")]),s._v(". æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œæ•ˆæžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/adab8b3cfc983f5631943949c8a025d8-20230731161914-4jgxgbk.png",alt:"",title:"æ‰§è¡Œ analyze table t å‘½ä»¤æ¢å¤çš„ explain ç»“æžœ"}})]),s._v(" "),t("p",[s._v("è¿™å›žå¯¹äº†.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥åœ¨å®žè·µä¸­, å¦‚æžœ"),t("strong",[s._v("å‘çŽ° explain çš„ç»“æžœé¢„ä¼°çš„ rows å€¼è·Ÿå®žé™…æƒ…å†µå·®è·æ¯”è¾ƒå¤§, å¯ä»¥é‡‡ç”¨è¿™ä¸ªæ–¹æ³•æ¥å¤„ç†")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶å®ž, å¦‚æžœåªæ˜¯ç´¢å¼•ç»Ÿè®¡ä¸å‡†ç¡®, é€šè¿‡ analyze å‘½ä»¤å¯ä»¥è§£å†³å¾ˆå¤šé—®é¢˜, ä½†æ˜¯å‰é¢è¯´äº†, ä¼˜åŒ–å™¨å¯ä¸æ­¢æ˜¯çœ‹æ‰«æè¡Œæ•°.")]),s._v(" "),t("p",[s._v("ä¾ç„¶æ˜¯åŸºäºŽè¿™ä¸ªè¡¨ t, çœ‹å¦å¤–ä¸€ä¸ªè¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä»Žæ¡ä»¶ä¸Šçœ‹, è¿™ä¸ªæŸ¥è¯¢æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•, å› æ­¤ä¼šè¿”å›žç©ºé›†åˆ.")]),s._v(" "),t("p",[s._v("åœ¨å¼€å§‹æ‰§è¡Œè¿™æ¡è¯­å¥ä¹‹å‰, å¯ä»¥å…ˆè®¾æƒ³ä¸€ä¸‹, å¦‚æžœä½ æ¥é€‰æ‹©ç´¢å¼•, ä¼šé€‰æ‹©å“ªä¸€ä¸ªå‘¢? ä¸ºäº†ä¾¿äºŽåˆ†æž, å…ˆæ¥çœ‹ä¸€ä¸‹ a, b è¿™ä¸¤ä¸ªç´¢å¼•çš„ç»“æž„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/26c904b82f5f1b062a3d43dfb51e5a2f-20230731161914-kxaelzr.png",alt:"",title:"a, b ç´¢å¼•çš„ç»“æž„å›¾"}})]),s._v(" "),t("p",[s._v("å¦‚æžœä½¿ç”¨ç´¢å¼• a è¿›è¡ŒæŸ¥è¯¢, é‚£ä¹ˆå°±æ˜¯æ‰«æç´¢å¼• a çš„å‰ 1000 ä¸ªå€¼, ç„¶åŽå–åˆ°å¯¹åº”çš„ id, å†åˆ°ä¸»é”®ç´¢å¼•ä¸ŠåŽ»æŸ¥å‡ºæ¯ä¸€è¡Œ, ç„¶åŽæ ¹æ®å­—æ®µ b æ¥è¿‡æ»¤. æ˜¾ç„¶è¿™æ ·éœ€è¦"),t("strong",[s._v("æ‰«æ 1000 è¡Œ")]),s._v(". å¦‚æžœä½¿ç”¨ç´¢å¼• b è¿›è¡ŒæŸ¥è¯¢, é‚£ä¹ˆå°±æ˜¯æ‰«æç´¢å¼• b çš„æœ€åŽ 50001 ä¸ªå€¼, ä¸Žä¸Šé¢çš„æ‰§è¡Œè¿‡ç¨‹ç›¸åŒ, ä¹Ÿæ˜¯éœ€è¦å›žåˆ°ä¸»é”®ç´¢å¼•ä¸Šå–å€¼å†åˆ¤æ–­, æ‰€ä»¥éœ€è¦"),t("strong",[s._v("æ‰«æ 50001 è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ä½ ä¸€å®šä¼šæƒ³, å¦‚æžœä½¿ç”¨ç´¢å¼• a çš„è¯, æ‰§è¡Œé€Ÿåº¦æ˜Žæ˜¾ä¼šå¿«å¾ˆå¤š. é‚£ä¸‹é¢å°±æ¥çœ‹çœ‹åˆ°åº•æ˜¯ä¸æ˜¯è¿™ä¹ˆä¸€å›žäº‹å„¿.")]),s._v(" "),t("p",[s._v("ä¸‹å›¾æ˜¯æ‰§è¡Œ explain çš„ç»“æžœ.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/bb7c01c820b0125a7fea1077377816c5-20230731161914-abcb5ho.png",alt:"",title:"ä½¿ç”¨ explain æ–¹æ³•æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ 2"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿”å›žç»“æžœä¸­ key å­—æ®µæ˜¾ç¤º, è¿™æ¬¡ä¼˜åŒ–å™¨"),t("strong",[s._v("é€‰æ‹©äº†ç´¢å¼• b")]),s._v(", è€Œ rows å­—æ®µæ˜¾ç¤ºéœ€è¦æ‰«æçš„è¡Œæ•°æ˜¯ 50198.")]),s._v(" "),t("p",[s._v("ä»Žè¿™ä¸ªç»“æžœä¸­, å¯ä»¥å¾—åˆ°ä¸¤ä¸ªç»“è®º:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰«æè¡Œæ•°çš„ä¼°è®¡å€¼ä¾ç„¶ä¸å‡†ç¡®;")]),s._v(" "),t("li",[s._v("è¿™ä¸ªä¾‹å­é‡Œ MySQL åˆé€‰é”™äº†ç´¢å¼•.")])]),s._v(" "),t("h5",{attrs:{id:"ç´¢å¼•é€‰æ‹©å¼‚å¸¸å’Œå¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç´¢å¼•é€‰æ‹©å¼‚å¸¸å’Œå¤„ç†"}},[s._v("#")]),s._v(" ç´¢å¼•é€‰æ‹©å¼‚å¸¸å’Œå¤„ç†")]),s._v(" "),t("p",[s._v("å…¶å®žå¤§å¤šæ•°æ—¶å€™ä¼˜åŒ–å™¨éƒ½èƒ½æ‰¾åˆ°æ­£ç¡®çš„ç´¢å¼•, ä½†å¶å°”è¿˜æ˜¯ä¼šç¢°åˆ°ä¸Šé¢ä¸¾ä¾‹çš„è¿™ä¸¤ç§æƒ…å†µ: åŽŸæœ¬å¯ä»¥æ‰§è¡Œå¾—å¾ˆå¿«çš„ SQL è¯­å¥, æ‰§è¡Œé€Ÿåº¦å´æ¯”é¢„æœŸçš„æ…¢å¾ˆå¤š, ä½ åº”è¯¥æ€Žä¹ˆåŠžå‘¢?")]),s._v(" "),t("p",[s._v("**ä¸€ç§æ–¹æ³•æ˜¯, åƒç¬¬ä¸€ä¸ªä¾‹å­ä¸€æ ·, é‡‡ç”¨ force index å¼ºè¡Œé€‰æ‹©ä¸€ä¸ªç´¢å¼•. ** MySQL ä¼šæ ¹æ®è¯æ³•è§£æžçš„ç»“æžœåˆ†æžå‡ºå¯èƒ½å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•ä½œä¸ºå€™é€‰é¡¹, ç„¶åŽåœ¨å€™é€‰åˆ—è¡¨ä¸­ä¾æ¬¡åˆ¤æ–­æ¯ä¸ªç´¢å¼•éœ€è¦æ‰«æå¤šå°‘è¡Œ. "),t("strong",[s._v("å¦‚æžœ force index æŒ‡å®šçš„ç´¢å¼•åœ¨å€™é€‰ç´¢å¼•åˆ—è¡¨ä¸­, å°±ç›´æŽ¥é€‰æ‹©è¿™ä¸ªç´¢å¼•, ä¸å†è¯„ä¼°å…¶ä»–ç´¢å¼•çš„æ‰§è¡Œä»£ä»·")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¥çœ‹çœ‹ç¬¬äºŒä¸ªä¾‹å­. åˆšå¼€å§‹åˆ†æžæ—¶, æˆ‘ä»¬è®¤ä¸ºé€‰æ‹©ç´¢å¼• a ä¼šæ›´å¥½. çŽ°åœ¨å°±æ¥çœ‹çœ‹æ‰§è¡Œæ•ˆæžœ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/77157e311821e826bb2ca06332c239c0-20230731161914-ycqs58j.png",alt:"",title:"ä½¿ç”¨ä¸åŒç´¢å¼•çš„è¯­å¥æ‰§è¡Œè€—æ—¶"}})]),s._v(" "),t("p",[s._v('å¯ä»¥çœ‹åˆ°, åŽŸæœ¬è¯­å¥éœ€è¦æ‰§è¡Œ 2.23 ç§’, è€Œå½“ä½ ä½¿ç”¨ force index(a) çš„æ—¶å€™, åªç”¨äº† 0.05 ç§’, æ¯”ä¼˜åŒ–å™¨çš„é€‰æ‹©å¿«äº† 40 å¤šå€. ä¹Ÿå°±æ˜¯è¯´, ä¼˜åŒ–å™¨æ²¡æœ‰é€‰æ‹©æ­£ç¡®çš„ç´¢å¼•, force index èµ·åˆ°äº† "çŸ«æ­£" çš„ä½œç”¨.')]),s._v(" "),t("p",[s._v("ä¸è¿‡å¾ˆå¤šç¨‹åºå‘˜ä¸å–œæ¬¢ä½¿ç”¨ force index, ä¸€æ¥è¿™ä¹ˆå†™ä¸ä¼˜ç¾Ž, äºŒæ¥å¦‚æžœç´¢å¼•æ”¹äº†åå­—, è¿™ä¸ªè¯­å¥ä¹Ÿå¾—æ”¹, æ˜¾å¾—å¾ˆéº»çƒ¦. è€Œä¸”å¦‚æžœä»¥åŽè¿ç§»åˆ°åˆ«çš„æ•°æ®åº“çš„è¯, è¿™ä¸ªè¯­æ³•è¿˜å¯èƒ½ä¼šä¸å…¼å®¹.")]),s._v(" "),t("p",[s._v("ä½†å…¶å®ž"),t("strong",[s._v("ä½¿ç”¨ force index æœ€ä¸»è¦çš„é—®é¢˜è¿˜æ˜¯å˜æ›´çš„åŠæ—¶æ€§")]),s._v(". å› ä¸ºé€‰é”™ç´¢å¼•çš„æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒå°‘å‡ºçŽ°çš„, æ‰€ä»¥å¼€å‘çš„æ—¶å€™é€šå¸¸ä¸ä¼šå…ˆå†™ä¸Š force index. è€Œæ˜¯ç­‰åˆ°çº¿ä¸Šå‡ºçŽ°é—®é¢˜çš„æ—¶å€™, æ‰ä¼šå†åŽ»ä¿®æ”¹ SQL è¯­å¥, åŠ ä¸Š force index. ä½†æ˜¯ä¿®æ”¹ä¹‹åŽè¿˜è¦æµ‹è¯•å’Œå‘å¸ƒ, å¯¹äºŽç”Ÿäº§ç³»ç»Ÿæ¥è¯´, è¿™ä¸ªè¿‡ç¨‹ä¸å¤Ÿæ•æ·.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, "),t("strong",[s._v("æ•°æ®åº“çš„é—®é¢˜æœ€å¥½è¿˜æ˜¯åœ¨æ•°æ®åº“å†…éƒ¨æ¥è§£å†³")]),s._v(". é‚£ä¹ˆåœ¨æ•°æ®åº“é‡Œé¢è¯¥æ€Žæ ·è§£å†³å‘¢?")]),s._v(" "),t("p",[s._v('æ—¢ç„¶ä¼˜åŒ–å™¨æ”¾å¼ƒäº†ä½¿ç”¨ç´¢å¼• a, è¯´æ˜Ž a è¿˜ä¸å¤Ÿåˆé€‚, æ‰€ä»¥**ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯, å¯ä»¥è€ƒè™‘ä¿®æ”¹è¯­å¥, å¼•å¯¼ MySQL ä½¿ç”¨æœŸæœ›çš„ç´¢å¼•. ** æ¯”å¦‚åœ¨è¿™ä¸ªä¾‹å­é‡Œ, æ˜¾ç„¶æŠŠ "'),t("code",[s._v("order by b limit 1")]),s._v('â€‹" æ”¹æˆ "'),t("code",[s._v("order by b,a limit 1")]),s._v('â€‹", è¯­ä¹‰çš„é€»è¾‘æ˜¯ç›¸åŒçš„.')]),s._v(" "),t("p",[s._v("æ¥çœ‹çœ‹æ”¹ä¹‹åŽçš„æ•ˆæžœ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2f5760f50ae7d335abf7fb3fc2fa84d4-20230731161914-j51fq6v.png",alt:"",title:"order by b,a limit 1 æ‰§è¡Œç»“æžœ"}})]),s._v(" "),t("p",[t("strong",[s._v("ä¹‹å‰ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨ç´¢å¼• b, æ˜¯å› ä¸ºå®ƒè®¤ä¸ºä½¿ç”¨ç´¢å¼• b å¯ä»¥é¿å…æŽ’åº")]),s._v("(b æœ¬èº«æ˜¯ç´¢å¼•, å·²ç»æ˜¯æœ‰åºçš„äº†, å¦‚æžœé€‰æ‹©ç´¢å¼• b çš„è¯, ä¸éœ€è¦å†åšæŽ’åº, åªéœ€è¦éåŽ†), æ‰€ä»¥å³ä½¿æ‰«æè¡Œæ•°å¤š, ä¹Ÿåˆ¤å®šä¸ºä»£ä»·æ›´å°.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ "),t("code",[s._v("order by b,a")]),s._v("â€‹ è¿™ç§å†™æ³•, è¦æ±‚æŒ‰ç…§ b,a æŽ’åº, å°±æ„å‘³ç€"),t("strong",[s._v("ä½¿ç”¨è¿™ä¸¤ä¸ªç´¢å¼•éƒ½éœ€è¦æŽ’åº")]),s._v(". å› æ­¤æ‰«æè¡Œæ•°æˆäº†å½±å“å†³ç­–çš„ä¸»è¦æ¡ä»¶, äºŽæ˜¯æ­¤æ—¶ä¼˜åŒ–å™¨é€‰äº†åªéœ€è¦æ‰«æ 1000 è¡Œçš„ç´¢å¼• a.")]),s._v(" "),t("p",[s._v("å½“ç„¶, è¿™ç§ä¿®æ”¹å¹¶ä¸æ˜¯é€šç”¨çš„ä¼˜åŒ–æ‰‹æ®µ, åªæ˜¯åˆšå¥½åœ¨è¿™ä¸ªè¯­å¥é‡Œé¢æœ‰ limit 1, å› æ­¤å¦‚æžœæœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•,  "),t("code",[s._v("order by b limit 1")]),s._v("â€‹ å’Œ "),t("code",[s._v("order by b,a limit 1")]),s._v("â€‹ éƒ½ä¼šè¿”å›ž b æ˜¯æœ€å°çš„é‚£ä¸€è¡Œ, é€»è¾‘ä¸Šä¸€è‡´, æ‰å¯ä»¥è¿™ä¹ˆåš.")]),s._v(" "),t("p",[s._v("å¦‚æžœä½ è§‰å¾—ä¿®æ”¹è¯­ä¹‰è¿™ä»¶äº‹å„¿ä¸å¤ªå¥½, è¿™é‡Œè¿˜æœ‰ä¸€ç§æ”¹æ³•, ä¸‹å›¾æ˜¯æ‰§è¡Œæ•ˆæžœ.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("alias "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/5552fbfc237ffdc02899d50e53ad39f2-20230731161914-3ircdi6.png",alt:"",title:"æ”¹å†™ SQL çš„ explain"}})]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªä¾‹å­é‡Œ, ç”¨ limit 100 è®©ä¼˜åŒ–å™¨æ„è¯†åˆ°, ä½¿ç”¨ b ç´¢å¼•ä»£ä»·æ˜¯å¾ˆé«˜çš„. å…¶å®žæ˜¯æ ¹æ®æ•°æ®ç‰¹å¾è¯±å¯¼äº†ä¸€ä¸‹ä¼˜åŒ–å™¨, ä¹Ÿä¸å…·å¤‡é€šç”¨æ€§.")]),s._v(" "),t("p",[s._v("**ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯, åœ¨æœ‰äº›åœºæ™¯ä¸‹, å¯ä»¥æ–°å»ºä¸€ä¸ªæ›´åˆé€‚çš„ç´¢å¼•, æ¥æä¾›ç»™ä¼˜åŒ–å™¨åšé€‰æ‹©, æˆ–åˆ æŽ‰è¯¯ç”¨çš„ç´¢å¼•. **")]),s._v(" "),t("p",[s._v("ä¸è¿‡åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘æ²¡æœ‰æ‰¾åˆ°é€šè¿‡æ–°å¢žç´¢å¼•æ¥æ”¹å˜ä¼˜åŒ–å™¨è¡Œä¸ºçš„æ–¹æ³•. è¿™ç§æƒ…å†µå…¶å®žæ¯”è¾ƒå°‘, å°¤å…¶æ˜¯ç»è¿‡ DBA ç´¢å¼•ä¼˜åŒ–è¿‡çš„åº“, å†ç¢°åˆ°è¿™ä¸ª bug, æ‰¾åˆ°ä¸€ä¸ªæ›´åˆé€‚çš„ç´¢å¼•ä¸€èˆ¬æ¯”è¾ƒéš¾.")]),s._v(" "),t("p",[s._v("å¦‚æžœæˆ‘è¯´è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ æŽ‰ç´¢å¼• b, ä½ å¯èƒ½ä¼šè§‰å¾—å¥½ç¬‘. ä½†å®žé™…ä¸Šæˆ‘ç¢°åˆ°è¿‡ä¸¤æ¬¡è¿™æ ·çš„ä¾‹å­, æœ€ç»ˆæ˜¯ DBA è·Ÿä¸šåŠ¡å¼€å‘æ²Ÿé€šåŽ, å‘çŽ°è¿™ä¸ªä¼˜åŒ–å™¨é”™è¯¯é€‰æ‹©çš„ç´¢å¼•å…¶å®žæ ¹æœ¬æ²¡æœ‰å¿…è¦å­˜åœ¨, äºŽæ˜¯å°±åˆ æŽ‰äº†è¿™ä¸ªç´¢å¼•, ä¼˜åŒ–å™¨ä¹Ÿå°±é‡æ–°é€‰æ‹©åˆ°äº†æ­£ç¡®çš„ç´¢å¼•.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-10"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-10"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†ç´¢å¼•ç»Ÿè®¡çš„æ›´æ–°æœºåˆ¶, å¹¶æåˆ°äº†ä¼˜åŒ–å™¨å­˜åœ¨é€‰é”™ç´¢å¼•çš„å¯èƒ½æ€§. "),t("strong",[s._v("å¯¹äºŽç”±äºŽç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®å¯¼è‡´çš„é—®é¢˜, å¯ä»¥ç”¨ analyze table æ¥è§£å†³")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("è€Œå¯¹äºŽå…¶ä»–ä¼˜åŒ–å™¨è¯¯åˆ¤çš„æƒ…å†µ, å¯ä»¥åœ¨åº”ç”¨ç«¯ç”¨ force index æ¥å¼ºè¡ŒæŒ‡å®šç´¢å¼•, ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹è¯­å¥æ¥å¼•å¯¼ä¼˜åŒ–å™¨, è¿˜å¯ä»¥é€šè¿‡å¢žåŠ æˆ–è€…åˆ é™¤ç´¢å¼•æ¥ç»•è¿‡è¿™ä¸ªé—®é¢˜.")])]),s._v(" "),t("h4",{attrs:{id:"_11-æ€Žä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-æ€Žä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•"}},[s._v("#")]),s._v(" 11-æ€Žä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•?")]),s._v(" "),t("p",[s._v("å‡ ä¹Žæ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒé‚®ç®±ç™»å½•, å¦‚ä½•åœ¨é‚®ç®±è¿™æ ·çš„å­—æ®µä¸Šå»ºç«‹åˆç†çš„ç´¢å¼•, æ˜¯ä»Šå¤©è¦è®¨è®ºçš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("å‡è®¾ä½ çŽ°åœ¨ç»´æŠ¤ä¸€ä¸ªæ”¯æŒé‚®ç®±ç™»å½•çš„ç³»ç»Ÿ, ç”¨æˆ·è¡¨æ˜¯è¿™ä¹ˆå®šä¹‰çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" SUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nID "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nemail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("ç”±äºŽè¦ä½¿ç”¨é‚®ç®±ç™»å½•, æ‰€ä»¥ä¸šåŠ¡ä»£ç ä¸­ä¸€å®šä¼šå‡ºçŽ°ç±»ä¼¼äºŽè¿™æ ·çš„è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" f1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" f2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" SUser "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" email"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æžœ email è¿™ä¸ªå­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•, é‚£ä¹ˆè¿™ä¸ªè¯­å¥å°±åªèƒ½åšå…¨è¡¨æ‰«æ. åŒæ—¶, MySQL æ˜¯æ”¯æŒå‰ç¼€ç´¢å¼•çš„, ä¹Ÿå°±æ˜¯è¯´, å¯ä»¥å®šä¹‰å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ä½œä¸ºç´¢å¼•. é»˜è®¤åœ°, "),t("strong",[s._v("å¦‚æžœåˆ›å»ºç´¢å¼•çš„è¯­å¥ä¸æŒ‡å®šå‰ç¼€é•¿åº¦, é‚£ä¹ˆç´¢å¼•å°±ä¼šåŒ…å«æ•´ä¸ªå­—ç¬¦ä¸²")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚, è¿™ä¸¤ä¸ªåœ¨ email å­—æ®µä¸Šåˆ›å»ºç´¢å¼•çš„è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" SUser "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" SUser "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("ç¬¬ä¸€ä¸ªè¯­å¥åˆ›å»ºçš„ index1 ç´¢å¼•é‡Œé¢, åŒ…å«äº†æ¯ä¸ªè®°å½•çš„æ•´ä¸ªå­—ç¬¦ä¸²; è€Œç¬¬äºŒä¸ªè¯­å¥åˆ›å»ºçš„ index2 ç´¢å¼•é‡Œé¢, å¯¹äºŽæ¯ä¸ªè®°å½•éƒ½æ˜¯"),t("strong",[s._v("åªå–å‰ 6 ä¸ªå­—èŠ‚")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£è¿™ä¸¤ç§ä¸åŒçš„å®šä¹‰åœ¨æ•°æ®ç»“æž„å’Œå­˜å‚¨ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢? å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯è¿™ä¸¤ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d7a55fdd555b527e9945e1ab0e6c0ab3-20230731161914-539n3if.png",alt:"",title:"email ç´¢å¼•ç»“æž„"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8b1fd6940d765a99afa1078ee9690170-20230731161914-z5dhcq0.png",alt:"",title:"email(6) ç´¢å¼•ç»“æž„"}})]),s._v(" "),t("p",[s._v("ä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°, ç”±äºŽ email(6) è¿™ä¸ªç´¢å¼•ç»“æž„ä¸­æ¯ä¸ªé‚®ç®±å­—æ®µéƒ½åªå–å‰ 6 ä¸ªå­—èŠ‚(å³: zhangs), æ‰€ä»¥"),t("strong",[s._v("å ç”¨çš„ç©ºé—´ä¼šæ›´å°")]),s._v(", è¿™å°±æ˜¯ä½¿ç”¨å‰ç¼€ç´¢å¼•çš„ä¼˜åŠ¿. ä½†è¿™åŒæ—¶å¸¦æ¥çš„æŸå¤±æ˜¯, "),t("strong",[s._v("å¯èƒ½ä¼šå¢žåŠ é¢å¤–çš„è®°å½•æ‰«ææ¬¡æ•°")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹çœ‹ä¸‹é¢è¿™ä¸ªè¯­å¥, åœ¨è¿™ä¸¤ä¸ªç´¢å¼•å®šä¹‰ä¸‹åˆ†åˆ«æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("email "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" SUser "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" email"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangssxyz@xxx.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("å¦‚æžœä½¿ç”¨çš„æ˜¯ index1")]),s._v("(å³ email æ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æž„), æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Ž index1 ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯ 'zhangssxyz@xxx.com' çš„è¿™æ¡è®°å½•, å–å¾— ID2 çš„å€¼;")]),s._v(" "),t("li",[s._v("åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ ID2 çš„è¡Œ, åˆ¤æ–­ email çš„å€¼æ˜¯æ­£ç¡®çš„, å°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æžœé›†;")]),s._v(" "),t("li",[s._v("å– index1 ç´¢å¼•æ ‘ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•, å‘çŽ°å·²ç»ä¸æ»¡è¶³ email='zhangssxyz@xxx.com' çš„æ¡ä»¶äº†, å¾ªçŽ¯ç»“æŸ.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹ä¸­, åªéœ€è¦å›žä¸»é”®ç´¢å¼•å–ä¸€æ¬¡æ•°æ®, æ‰€ä»¥ç³»ç»Ÿè®¤ä¸º"),t("strong",[s._v("åªæ‰«æäº†ä¸€è¡Œ")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æžœä½¿ç”¨çš„æ˜¯ index2")]),s._v("(å³ email(6) ç´¢å¼•ç»“æž„), æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Ž index2 ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯ 'zhangs' çš„è®°å½•, æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ˜¯ ID1;")]),s._v(" "),t("li",[s._v("åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ ID1 çš„è¡Œ, åˆ¤æ–­å‡º email çš„å€¼ä¸æ˜¯ 'zhangssxyz@xxx.com', è¿™è¡Œè®°å½•ä¸¢å¼ƒ;")]),s._v(" "),t("li",[s._v("å– index2 ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•, å‘çŽ°ä»ç„¶æ˜¯ 'zhangs', å–å‡º ID2, å†åˆ° ID ç´¢å¼•ä¸Šå–æ•´è¡Œç„¶åŽåˆ¤æ–­, è¿™æ¬¡å€¼å¯¹äº†, å°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æžœé›†;")]),s._v(" "),t("li",[s._v("é‡å¤ä¸Šä¸€æ­¥, ç›´åˆ°åœ¨ idxe2 ä¸Šå–åˆ°çš„å€¼ä¸æ˜¯ 'zhangs' æ—¶, å¾ªçŽ¯ç»“æŸ.")])]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, è¦å›žä¸»é”®ç´¢å¼•å– 4 æ¬¡æ•°æ®, ä¹Ÿå°±æ˜¯æ‰«æäº† 4 è¡Œ.")]),s._v(" "),t("p",[s._v("é€šè¿‡è¿™ä¸ªå¯¹æ¯”, ä½ å¾ˆå®¹æ˜“å°±å¯ä»¥å‘çŽ°, ä½¿ç”¨å‰ç¼€ç´¢å¼•åŽ, å¯èƒ½ä¼šå¯¼è‡´æŸ¥è¯¢è¯­å¥è¯»æ•°æ®çš„æ¬¡æ•°å˜å¤š. ä½†æ˜¯å¯¹äºŽè¿™ä¸ªæŸ¥è¯¢è¯­å¥æ¥è¯´, å¦‚æžœä½ å®šä¹‰çš„ index2 ä¸æ˜¯ email(6) è€Œæ˜¯ email(7), ä¹Ÿå°±æ˜¯è¯´å– email å­—æ®µçš„å‰ 7 ä¸ªå­—èŠ‚æ¥æž„å»ºç´¢å¼•çš„è¯, å³æ»¡è¶³å‰ç¼€ 'zhangss' çš„è®°å½•åªæœ‰ä¸€ä¸ª, ä¹Ÿèƒ½å¤Ÿç›´æŽ¥æŸ¥åˆ° ID2, åªæ‰«æä¸€è¡Œå°±ç»“æŸäº†.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´"),t("mark",[t("strong",[s._v("ä½¿ç”¨å‰ç¼€ç´¢å¼•, å®šä¹‰å¥½é•¿åº¦, å°±å¯ä»¥åšåˆ°æ—¢èŠ‚çœç©ºé—´, åˆä¸ç”¨é¢å¤–å¢žåŠ å¤ªå¤šçš„æŸ¥è¯¢æˆæœ¬")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("å½“è¦ç»™å­—ç¬¦ä¸²åˆ›å»ºå‰ç¼€ç´¢å¼•æ—¶, æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½å¤Ÿç¡®å®šåº”è¯¥ä½¿ç”¨å¤šé•¿çš„å‰ç¼€å‘¢?")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("å®žé™…ä¸Š, åœ¨å»ºç«‹ç´¢å¼•æ—¶å…³æ³¨çš„æ˜¯åŒºåˆ†åº¦, åŒºåˆ†åº¦è¶Šé«˜è¶Šå¥½. å› ä¸ºåŒºåˆ†åº¦è¶Šé«˜, æ„å‘³ç€é‡å¤çš„é”®å€¼è¶Šå°‘. å› æ­¤, æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»Ÿè®¡ç´¢å¼•ä¸Šæœ‰å¤šå°‘ä¸ªä¸åŒçš„å€¼æ¥åˆ¤æ–­è¦ä½¿ç”¨å¤šé•¿çš„å‰ç¼€.")])])]),s._v(" "),t("p",[s._v("é¦–å…ˆå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªè¯­å¥, ç®—å‡ºè¿™ä¸ªåˆ—ä¸Šæœ‰å¤šå°‘ä¸ªä¸åŒçš„å€¼:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("distinct")]),s._v(" email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" L "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" SUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç„¶åŽä¾æ¬¡é€‰å–ä¸åŒé•¿åº¦çš„å‰ç¼€æ¥çœ‹è¿™ä¸ªå€¼, æ¯”å¦‚è¦çœ‹ä¸€ä¸‹ 4~7 ä¸ªå­—èŠ‚çš„å‰ç¼€ç´¢å¼•, å¯ä»¥ç”¨è¿™ä¸ªè¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("distinct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" L4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("distinct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" L5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("distinct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" L6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("distinct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" L7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" SUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("å½“ç„¶, ä½¿ç”¨å‰ç¼€ç´¢å¼•å¾ˆå¯èƒ½ä¼šæŸå¤±åŒºåˆ†åº¦, æ‰€ä»¥éœ€è¦é¢„å…ˆ"),t("strong",[s._v("è®¾å®šä¸€ä¸ªå¯ä»¥æŽ¥å—çš„æŸå¤±æ¯”ä¾‹")]),s._v(", æ¯”å¦‚ 5%. ç„¶åŽåœ¨è¿”å›žçš„ L4~L7 ä¸­, æ‰¾å‡ºä¸å°äºŽ L * 95% çš„å€¼, å‡è®¾è¿™é‡Œ L6, L7 éƒ½æ»¡è¶³, å°±å¯ä»¥é€‰æ‹©å‰ç¼€é•¿åº¦ä¸º 6.")]),s._v(" "),t("h5",{attrs:{id:"å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“"}},[s._v("#")]),s._v(" å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“")]),s._v(" "),t("p",[s._v("å‰é¢è¯´äº†ä½¿ç”¨å‰ç¼€ç´¢å¼•å¯èƒ½ä¼šå¢žåŠ æ‰«æè¡Œæ•°, è¿™ä¼šå½±å“åˆ°æ€§èƒ½. å…¶å®žå‰ç¼€ç´¢å¼•çš„å½±å“ä¸æ­¢å¦‚æ­¤, å†çœ‹ä¸€ä¸‹å¦å¤–ä¸€ä¸ªåœºæ™¯.")]),s._v(" "),t("p",[s._v("çœ‹çœ‹è¿™ä¸ª SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("email "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" SUser "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" email"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangssxyz@xxx.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¸Žå‰é¢ä¾‹å­ä¸­çš„ SQL è¯­å¥")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("email "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" SUser "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" email"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangssxyz@xxx.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç›¸æ¯”, è¿™ä¸ªè¯­å¥åªè¦æ±‚è¿”å›ž id å’Œ email å­—æ®µ.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥å¦‚æžœä½¿ç”¨ index1(å³ email æ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æž„)çš„è¯, å¯ä»¥åˆ©ç”¨"),t("strong",[s._v("è¦†ç›–ç´¢å¼•")]),s._v(", ä»Ž index1 æŸ¥åˆ°ç»“æžœåŽç›´æŽ¥å°±è¿”å›žäº†, ä¸éœ€è¦å›žåˆ° ID ç´¢å¼•å†åŽ»æŸ¥ä¸€æ¬¡. è€Œå¦‚æžœä½¿ç”¨ index2(å³ email(6) ç´¢å¼•ç»“æž„)çš„è¯, å°±"),t("strong",[s._v("ä¸å¾—ä¸å›žåˆ° ID ç´¢å¼•å†åŽ»åˆ¤æ–­ email å­—æ®µçš„å€¼")]),s._v(".")]),s._v(" "),t("p",[s._v("å³ä½¿ä½ å°† index2 çš„å®šä¹‰ä¿®æ”¹ä¸º email(18) çš„å‰ç¼€ç´¢å¼•, è¿™æ—¶å€™è™½ç„¶ index2 å·²ç»åŒ…å«äº†æ‰€æœ‰çš„ä¿¡æ¯, ä½† InnoDB è¿˜æ˜¯è¦å›žåˆ° id ç´¢å¼•å†æŸ¥ä¸€ä¸‹, å› ä¸ºç³»ç»Ÿå¹¶ä¸ç¡®å®šå‰ç¼€ç´¢å¼•çš„å®šä¹‰æ˜¯å¦æˆªæ–­äº†å®Œæ•´ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("ä½¿ç”¨å‰ç¼€ç´¢å¼•å°±ç”¨ä¸ä¸Šè¦†ç›–ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„ä¼˜åŒ–äº†, è¿™ä¹Ÿæ˜¯åœ¨é€‰æ‹©æ˜¯å¦ä½¿ç”¨å‰ç¼€ç´¢å¼•æ—¶éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªå› ç´ ")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å…¶ä»–æ–¹å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¶ä»–æ–¹å¼"}},[s._v("#")]),s._v(" å…¶ä»–æ–¹å¼")]),s._v(" "),t("p",[s._v("å¯¹äºŽç±»ä¼¼äºŽé‚®ç®±è¿™æ ·çš„å­—æ®µæ¥è¯´, ä½¿ç”¨å‰ç¼€ç´¢å¼•çš„æ•ˆæžœå¯èƒ½è¿˜ä¸é”™. ä½†æ˜¯é‡åˆ°å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿå¥½çš„æƒ…å†µæ—¶, è¦æ€Žä¹ˆåŠžå‘¢?")]),s._v(" "),t("p",[s._v("æ¯”å¦‚èº«ä»½è¯å·, ä¸€å…± 18 ä½, å…¶ä¸­å‰ 6 ä½æ˜¯åœ°å€ç , æ‰€ä»¥åŒä¸€ä¸ªåŽ¿çš„äººçš„èº«ä»½è¯å·å‰ 6 ä½ä¸€èˆ¬ä¼šæ˜¯ç›¸åŒçš„. å¦‚æžœå¯¹èº«ä»½è¯å·åšé•¿åº¦ä¸º 6 çš„å‰ç¼€ç´¢å¼•çš„è¯, è¿™ä¸ªç´¢å¼•çš„"),t("strong",[s._v("åŒºåˆ†åº¦å°±éžå¸¸ä½Ž")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("æŒ‰ç…§å‰é¢è¯´çš„æ–¹æ³•, å¯èƒ½ä½ éœ€è¦åˆ›å»ºé•¿åº¦ä¸º 12 ä»¥ä¸Šçš„å‰ç¼€ç´¢å¼•, æ‰èƒ½å¤Ÿæ»¡è¶³åŒºåˆ†åº¦è¦æ±‚. ä½†ç´¢å¼•é€‰å–çš„è¶Šé•¿, å ç”¨çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§, ç›¸åŒçš„æ•°æ®é¡µèƒ½æ”¾ä¸‹çš„ç´¢å¼•å€¼å°±è¶Šå°‘, æœç´¢çš„æ•ˆçŽ‡ä¹Ÿå°±ä¼šè¶Šä½Ž.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, å¦‚æžœèƒ½å¤Ÿç¡®å®šä¸šåŠ¡éœ€æ±‚é‡Œé¢åªæœ‰æŒ‰ç…§èº«ä»½è¯è¿›è¡Œç­‰å€¼æŸ¥è¯¢çš„éœ€æ±‚, è¿˜æœ‰æ²¡æœ‰åˆ«çš„å¤„ç†æ–¹æ³•å‘¢? è¿™ç§æ–¹æ³•, æ—¢å¯ä»¥å ç”¨æ›´å°çš„ç©ºé—´, ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„æŸ¥è¯¢æ•ˆçŽ‡.")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯æœ‰çš„.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨")]),s._v("â€‹"),t("mark",[t("strong",[s._v("å€’åºå­˜å‚¨")])]),s._v("â€‹ **. ** å¦‚æžœå­˜å‚¨èº«ä»½è¯å·çš„æ—¶å€™æŠŠå®ƒå€’è¿‡æ¥å­˜, æ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™, å¯ä»¥è¿™ä¹ˆå†™:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" field_list "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id_card "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" reverse"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'input_id_card_string'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç”±äºŽèº«ä»½è¯å·çš„æœ€åŽ 6 ä½æ²¡æœ‰åœ°å€ç è¿™æ ·çš„é‡å¤é€»è¾‘, æ‰€ä»¥æœ€åŽè¿™ 6 ä½å¾ˆå¯èƒ½å°±æä¾›äº†è¶³å¤Ÿçš„åŒºåˆ†åº¦. å½“ç„¶å®žè·µä¸­ä¸è¦å¿˜è®°ä½¿ç”¨ count(distinct) æ–¹æ³•åŽ»åšä¸ªéªŒè¯.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬äºŒç§æ–¹å¼æ˜¯")]),s._v("â€‹"),t("mark",[t("strong",[s._v("ä½¿ç”¨ hash å­—æ®µ")])]),s._v("â€‹ **. ** å¯ä»¥åœ¨è¡¨ä¸Šå†åˆ›å»ºä¸€ä¸ªæ•´æ•°å­—æ®µ, æ¥ä¿å­˜èº«ä»½è¯çš„æ ¡éªŒç , åŒæ—¶åœ¨è¿™ä¸ªå­—æ®µä¸Šåˆ›å»ºç´¢å¼•.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" id_card_crc "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id_card_crc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç„¶åŽæ¯æ¬¡æ’å…¥æ–°è®°å½•çš„æ—¶å€™, éƒ½åŒæ—¶ç”¨ crc32() è¿™ä¸ªå‡½æ•°å¾—åˆ°æ ¡éªŒç å¡«åˆ°è¿™ä¸ªæ–°å­—æ®µ. ç”±äºŽæ ¡éªŒç å¯èƒ½å­˜åœ¨å†²çª, ä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªä¸åŒçš„èº«ä»½è¯å·é€šè¿‡ crc32() å‡½æ•°å¾—åˆ°çš„ç»“æžœå¯èƒ½æ˜¯ç›¸åŒçš„, æ‰€ä»¥æŸ¥è¯¢è¯­å¥ where éƒ¨åˆ†è¦åˆ¤æ–­ id_card çš„å€¼æ˜¯å¦ç²¾ç¡®ç›¸åŒ.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" field_list "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id_card_crc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("crc32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'input_id_card_string'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" id_card"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'input_id_card_string'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ ·ç´¢å¼•çš„é•¿åº¦å˜æˆäº† 4 ä¸ªå­—èŠ‚, æ¯”åŽŸæ¥å°äº†å¾ˆå¤š.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†ä¸€èµ·çœ‹çœ‹**ä½¿ç”¨å€’åºå­˜å‚¨å’Œä½¿ç”¨ hash å­—æ®µè¿™ä¸¤ç§æ–¹æ³•çš„å¼‚åŒç‚¹. **")]),s._v(" "),t("p",[s._v("é¦–å…ˆ, å®ƒä»¬çš„ç›¸åŒç‚¹æ˜¯, "),t("strong",[s._v("éƒ½ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢")]),s._v(". å€’åºå­˜å‚¨çš„å­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•æ˜¯æŒ‰ç…§å€’åºå­—ç¬¦ä¸²çš„æ–¹å¼æŽ’åºçš„, å·²ç»æ²¡æœ‰åŠžæ³•åˆ©ç”¨ç´¢å¼•æ–¹å¼æŸ¥å‡ºèº«ä»½è¯å·ç åœ¨ [ID_X, ID_Y] çš„æ‰€æœ‰èº«ä»½è¯å·äº†. åŒæ · hash å­—æ®µçš„æ–¹å¼ä¹Ÿåªèƒ½æ”¯æŒç­‰å€¼æŸ¥è¯¢.")]),s._v(" "),t("p",[s._v("å®ƒä»¬çš„åŒºåˆ«, ä¸»è¦ä½“çŽ°åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Žå ç”¨çš„é¢å¤–ç©ºé—´æ¥çœ‹, å€’åºå­˜å‚¨æ–¹å¼åœ¨ä¸»é”®ç´¢å¼•ä¸Š, ä¸ä¼šæ¶ˆè€—é¢å¤–çš„å­˜å‚¨ç©ºé—´, è€Œ hash å­—æ®µæ–¹æ³•éœ€è¦å¢žåŠ ä¸€ä¸ªå­—æ®µ. å½“ç„¶, å€’åºå­˜å‚¨æ–¹å¼ä½¿ç”¨ 4 ä¸ªå­—èŠ‚çš„å‰ç¼€é•¿åº¦åº”è¯¥æ˜¯ä¸å¤Ÿçš„, å¦‚æžœå†é•¿ä¸€ç‚¹, è¿™ä¸ªæ¶ˆè€—è·Ÿé¢å¤–è¿™ä¸ª hash å­—æ®µä¹Ÿå·®ä¸å¤šæŠµæ¶ˆäº†.")]),s._v(" "),t("li",[s._v("åœ¨ CPU æ¶ˆè€—æ–¹é¢, å€’åºæ–¹å¼æ¯æ¬¡å†™å’Œè¯»çš„æ—¶å€™, éƒ½éœ€è¦é¢å¤–è°ƒç”¨ä¸€æ¬¡ "),t("strong",[s._v("reverse å‡½æ•°")]),s._v(", è€Œ hash å­—æ®µçš„æ–¹å¼éœ€è¦é¢å¤–è°ƒç”¨ä¸€æ¬¡ crc32() å‡½æ•°. å¦‚æžœåªä»Žè¿™ä¸¤ä¸ªå‡½æ•°çš„è®¡ç®—å¤æ‚åº¦æ¥çœ‹çš„è¯, reverse å‡½æ•°é¢å¤–æ¶ˆè€—çš„ CPU èµ„æºä¼šæ›´å°äº›.")]),s._v(" "),t("li",[s._v("ä»ŽæŸ¥è¯¢æ•ˆçŽ‡ä¸Šçœ‹, ä½¿ç”¨ hash å­—æ®µæ–¹å¼çš„æŸ¥è¯¢æ€§èƒ½ç›¸å¯¹æ›´ç¨³å®šä¸€äº›. å› ä¸º crc32 ç®—å‡ºæ¥çš„å€¼è™½ç„¶æœ‰å†²çªçš„æ¦‚çŽ‡, ä½†æ˜¯æ¦‚çŽ‡éžå¸¸å°, å¯ä»¥è®¤ä¸ºæ¯æ¬¡æŸ¥è¯¢çš„å¹³å‡æ‰«æè¡Œæ•°æŽ¥è¿‘ 1. è€Œå€’åºå­˜å‚¨æ–¹å¼æ¯•ç«Ÿè¿˜æ˜¯ç”¨çš„å‰ç¼€ç´¢å¼•çš„æ–¹å¼, ä¹Ÿå°±æ˜¯è¯´è¿˜æ˜¯ä¼šå¢žåŠ æ‰«æè¡Œæ•°.")])]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-11"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-11"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†å­—ç¬¦ä¸²å­—æ®µåˆ›å»ºç´¢å¼•çš„åœºæ™¯. å›žé¡¾ä¸€ä¸‹å¯ä»¥ä½¿ç”¨çš„æ–¹å¼æœ‰:")]),s._v(" "),t("ol",[t("li",[s._v("ç›´æŽ¥åˆ›å»ºå®Œæ•´ç´¢å¼•, è¿™æ ·å¯èƒ½æ¯”è¾ƒå ç”¨ç©ºé—´;")]),s._v(" "),t("li",[s._v("åˆ›å»º"),t("strong",[s._v("å‰ç¼€ç´¢å¼•")]),s._v(", èŠ‚çœç©ºé—´, ä½†ä¼šå¢žåŠ æŸ¥è¯¢æ‰«ææ¬¡æ•°, å¹¶ä¸”ä¸èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•;")]),s._v(" "),t("li",[t("strong",[s._v("å€’åºå­˜å‚¨, å†åˆ›å»ºå‰ç¼€ç´¢å¼•")]),s._v(", ç”¨äºŽç»•è¿‡å­—ç¬¦ä¸²æœ¬èº«å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿçš„é—®é¢˜;")]),s._v(" "),t("li",[s._v("åˆ›å»º hash å­—æ®µç´¢å¼•, æŸ¥è¯¢æ€§èƒ½ç¨³å®š, æœ‰é¢å¤–çš„å­˜å‚¨å’Œè®¡ç®—æ¶ˆè€—, è·Ÿç¬¬ä¸‰ç§æ–¹å¼ä¸€æ ·, "),t("strong",[s._v("éƒ½ä¸æ”¯æŒèŒƒå›´æ‰«æ")]),s._v(".")])]),s._v(" "),t("p",[s._v("åœ¨å®žé™…åº”ç”¨ä¸­, è¦æ ¹æ®ä¸šåŠ¡å­—æ®µçš„ç‰¹ç‚¹é€‰æ‹©ä½¿ç”¨å“ªç§æ–¹å¼.")]),s._v(" "),t("h4",{attrs:{id:"_12-ä¸ºä»€ä¹ˆæˆ‘çš„mysqlä¼š-æŠ–-ä¸€ä¸‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-ä¸ºä»€ä¹ˆæˆ‘çš„mysqlä¼š-æŠ–-ä¸€ä¸‹"}},[s._v("#")]),s._v(' 12-ä¸ºä»€ä¹ˆæˆ‘çš„MySQLä¼š"æŠ–"ä¸€ä¸‹?')]),s._v(" "),t("p",[s._v("å¹³æ—¶çš„å·¥ä½œä¸­, ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯, ä¸€æ¡ SQL è¯­å¥, æ­£å¸¸æ‰§è¡Œçš„æ—¶å€™ç‰¹åˆ«å¿«, ä½†æ˜¯"),t("strong",[s._v("æœ‰æ—¶ä¹Ÿä¸çŸ¥é“æ€Žä¹ˆå›žäº‹, å®ƒå°±ä¼šå˜å¾—ç‰¹åˆ«æ…¢, å¹¶ä¸”è¿™æ ·çš„åœºæ™¯å¾ˆéš¾å¤çŽ°, å®ƒä¸åªéšæœº, è€Œä¸”æŒç»­æ—¶é—´è¿˜å¾ˆçŸ­")]),s._v('. çœ‹ä¸ŠåŽ», è¿™å°±åƒæ˜¯æ•°æ®åº“"æŠ–"äº†ä¸€ä¸‹. æœ¬èŠ‚å°±ä¸€èµ·æ¥çœ‹ä¸€çœ‹è¿™æ˜¯ä»€ä¹ˆåŽŸå› .')]),s._v(" "),t("h5",{attrs:{id:"sqlè¯­å¥ä¸ºä»€ä¹ˆå˜-æ…¢-äº†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sqlè¯­å¥ä¸ºä»€ä¹ˆå˜-æ…¢-äº†"}},[s._v("#")]),s._v(' SQLè¯­å¥ä¸ºä»€ä¹ˆå˜"æ…¢"äº†')]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº† WAL æœºåˆ¶. InnoDB åœ¨å¤„ç†"),t("strong",[s._v("æ›´æ–°è¯­å¥çš„æ—¶å€™, åªåšäº†å†™æ—¥å¿—è¿™ä¸€ä¸ªç£ç›˜æ“ä½œ. è¿™ä¸ªæ—¥å¿—å«ä½œ redo log(é‡åšæ—¥å¿—)")]),s._v(" , ä¹Ÿå°±æ˜¯ã€Šå­”ä¹™å·±ã€‹é‡Œå’¸äº¨é…’åº—æŽŒæŸœç”¨æ¥è®°è´¦çš„ç²‰æ¿, "),t("strong",[s._v("åœ¨æ›´æ–°å†…å­˜å†™å®Œ redo log åŽ, å°±è¿”å›žç»™å®¢æˆ·ç«¯, æœ¬æ¬¡æ›´æ–°æˆåŠŸ")]),s._v(".")]),s._v(" "),t("p",[s._v("åšä¸‹ç±»æ¯”çš„è¯, "),t("strong",[s._v("æŽŒæŸœè®°è´¦çš„è´¦æœ¬æ˜¯æ•°æ®æ–‡ä»¶, è®°è´¦ç”¨çš„ç²‰æ¿æ˜¯æ—¥å¿—æ–‡ä»¶(redo log), æŽŒæŸœçš„è®°å¿†å°±æ˜¯å†…å­˜")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽŒæŸœæ€»è¦æ‰¾æ—¶é—´æŠŠè´¦æœ¬æ›´æ–°ä¸€ä¸‹, è¿™å¯¹åº”çš„å°±æ˜¯"),t("mark",[t("strong",[s._v("æŠŠå†…å­˜é‡Œçš„æ•°æ®å†™å…¥ç£ç›˜çš„è¿‡ç¨‹, æœ¯è¯­å°±æ˜¯ flush")])]),s._v(". åœ¨è¿™ä¸ª flush æ“ä½œæ‰§è¡Œä¹‹å‰, å­”ä¹™å·±çš„èµŠè´¦æ€»é¢, å…¶å®žè·ŸæŽŒæŸœæ‰‹ä¸­è´¦æœ¬é‡Œé¢çš„è®°å½•æ˜¯ä¸ä¸€è‡´çš„. å› ä¸ºå­”ä¹™å·±ä»Šå¤©çš„èµŠè´¦é‡‘é¢è¿˜åªåœ¨ç²‰æ¿ä¸Š, è€Œè´¦æœ¬é‡Œçš„è®°å½•æ˜¯è€çš„, è¿˜æ²¡æŠŠä»Šå¤©çš„èµŠè´¦ç®—è¿›åŽ».")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v('å½“å†…å­˜æ•°æ®é¡µè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´çš„æ—¶å€™, å°±ç§°è¿™ä¸ªå†…å­˜é¡µä¸º"è„é¡µ". å†…å­˜æ•°æ®å†™å…¥åˆ°ç£ç›˜åŽ, å†…å­˜å’Œç£ç›˜ä¸Šçš„æ•°æ®é¡µçš„å†…å®¹å°±ä¸€è‡´äº†, ç§°ä¸º"å¹²å‡€é¡µ".')])])]),s._v(" "),t("p",[t("strong",[s._v("ä¸è®ºæ˜¯è„é¡µè¿˜æ˜¯å¹²å‡€é¡µ, éƒ½åœ¨å†…å­˜ä¸­")]),s._v(". åœ¨è¿™ä¸ªä¾‹å­é‡Œ, å†…å­˜å¯¹åº”çš„å°±æ˜¯æŽŒæŸœçš„è®°å¿†.")]),s._v(" "),t("p",[s._v('æŽ¥ä¸‹æ¥, ç”¨ä¸€ä¸ªç¤ºæ„å›¾æ¥å±•ç¤ºä¸€ä¸‹"å­”ä¹™å·±èµŠè´¦"çš„æ•´ä¸ªæ“ä½œè¿‡ç¨‹. å‡è®¾åŽŸæ¥å­”ä¹™å·±æ¬ è´¦ 10 æ–‡, è¿™æ¬¡åˆè¦èµŠ 9 æ–‡.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c66fdada7e44ec9a5bddad0ffc61b933-20230731161914-gq1d67w.png",alt:"",title:'"å­”ä¹™å·±èµŠè´¦"æ›´æ–°å’Œ flush è¿‡ç¨‹'}})]),s._v(" "),t("p",[s._v("å›žåˆ°å¼€å¤´çš„é—®é¢˜, ä½ ä¸éš¾æƒ³è±¡, "),t("mark",[t("strong",[s._v('å¹³æ—¶æ‰§è¡Œå¾ˆå¿«çš„æ›´æ–°æ“ä½œ, å…¶å®žå°±æ˜¯åœ¨å†™å†…å­˜å’Œæ—¥å¿—, è€Œ MySQL å¶å°”"æŠ–"ä¸€ä¸‹çš„é‚£ä¸ªçž¬é—´, å¯èƒ½å°±æ˜¯åœ¨åˆ·è„é¡µ(flush)')])]),s._v(" .")]),s._v(" "),t("p",[s._v("é‚£"),t("strong",[s._v("ä»€ä¹ˆæƒ…å†µä¼šå¼•å‘æ•°æ®åº“çš„ flush è¿‡ç¨‹")]),s._v("å‘¢?")]),s._v(" "),t("p",[s._v("è¿˜æ˜¯ç»§ç»­ç”¨é…’åº—æŽŒæŸœçš„è¿™ä¸ªä¾‹å­, æƒ³ä¸€æƒ³: æŽŒæŸœåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæŠŠç²‰æ¿ä¸Šçš„èµŠè´¦è®°å½•æ”¹åˆ°è´¦æœ¬ä¸Š?")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬ä¸€ç§åœºæ™¯æ˜¯, ç²‰æ¿æ»¡äº†, è®°ä¸ä¸‹äº†")]),s._v(". è¿™æ—¶å€™å¦‚æžœå†æœ‰äººæ¥èµŠè´¦, æŽŒæŸœå°±åªå¾—æ”¾ä¸‹æ‰‹é‡Œçš„æ´»å„¿, å°†ç²‰æ¿ä¸Šçš„è®°å½•æ“¦æŽ‰ä¸€äº›, ç•™å‡ºç©ºä½ä»¥ä¾¿ç»§ç»­è®°è´¦. å½“ç„¶åœ¨æ“¦æŽ‰ä¹‹å‰, å°±å¿…é¡»å…ˆå°†æ­£ç¡®çš„è´¦ç›®è®°å½•åˆ°è´¦æœ¬ä¸­æ‰è¡Œ. è¿™ä¸ªåœºæ™¯, "),t("mark",[t("strong",[s._v("å¯¹åº”çš„å°±æ˜¯ InnoDB çš„ redo log å†™æ»¡äº†. è¿™æ—¶å€™ç³»ç»Ÿä¼šåœæ­¢æ‰€æœ‰æ›´æ–°æ“ä½œ, æŠŠ checkpoint å¾€å‰æŽ¨è¿›, redo log ç•™å‡ºç©ºé—´å¯ä»¥ç»§ç»­å†™")])]),s._v(". ç¬¬äºŒè®²ç”»äº†ä¸€ä¸ª redo log çš„ç¤ºæ„å›¾, è¿™é‡Œæ”¹æˆçŽ¯å½¢, ä¾¿äºŽç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a30dbcccf96359d6301a6110cb77768e-20230731161914-7iwvjv3.png",alt:"",title:"redo log çŠ¶æ€å›¾"}})]),s._v(" "),t("p",[s._v("checkpoint å¯ä¸æ˜¯éšä¾¿å¾€å‰ä¿®æ”¹ä¸€ä¸‹ä½ç½®å°±å¯ä»¥çš„. æ¯”å¦‚ä¸Šå›¾ä¸­, "),t("strong",[s._v("æŠŠ checkpoint ä½ç½®ä»Ž CP æŽ¨è¿›åˆ° CPâ€™, å°±éœ€è¦å°†ä¸¤ä¸ªç‚¹ä¹‹é—´çš„æ—¥å¿—(æµ…ç»¿è‰²éƒ¨åˆ†), å¯¹åº”çš„æ‰€æœ‰è„é¡µéƒ½ flush åˆ°ç£ç›˜ä¸Š")]),s._v(". ä¹‹åŽ, å›¾ä¸­ä»Ž write pos åˆ° CPâ€™ ä¹‹é—´å°±æ˜¯å¯ä»¥å†å†™å…¥çš„ redo log çš„åŒºåŸŸ.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬äºŒç§åœºæ™¯")]),s._v("æ˜¯, è¿™ä¸€å¤©ç”Ÿæ„å¤ªå¥½, è¦è®°ä½çš„äº‹æƒ…å¤ªå¤š, æŽŒæŸœå‘çŽ°è‡ªå·±å¿«è®°ä¸ä½äº†, èµ¶ç´§æ‰¾å‡ºè´¦æœ¬æŠŠå­”ä¹™å·±è¿™ç¬”è´¦å…ˆåŠ è¿›åŽ». è¿™ç§åœºæ™¯, "),t("mark",[t("strong",[s._v('å¯¹åº”çš„å°±æ˜¯ç³»ç»Ÿå†…å­˜ä¸è¶³. å½“éœ€è¦æ–°çš„å†…å­˜é¡µ, è€Œå†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™, å°±è¦æ·˜æ±°ä¸€äº›æ•°æ®é¡µ, ç©ºå‡ºå†…å­˜ç»™åˆ«çš„æ•°æ®é¡µä½¿ç”¨. å¦‚æžœæ·˜æ±°çš„æ˜¯"è„é¡µ", å°±è¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜')])]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šä¼šè¯´, è¿™æ—¶å€™éš¾é“ä¸èƒ½ç›´æŽ¥æŠŠå†…å­˜æ·˜æ±°æŽ‰, ä¸‹æ¬¡éœ€è¦è¯·æ±‚çš„æ—¶å€™, ä»Žç£ç›˜è¯»å…¥æ•°æ®é¡µ, ç„¶åŽæ‹¿ redo log å‡ºæ¥åº”ç”¨ä¸å°±è¡Œäº†? è¿™é‡Œå…¶å®žæ˜¯"),t("strong",[s._v("ä»Žæ€§èƒ½è€ƒè™‘")]),s._v("çš„. å¦‚æžœåˆ·è„é¡µä¸€å®šä¼šå†™ç›˜, å°±ä¿è¯äº†"),t("strong",[s._v("æ¯ä¸ªæ•°æ®é¡µæœ‰ä¸¤ç§çŠ¶æ€")]),s._v(":")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ä¸€ç§æ˜¯å†…å­˜é‡Œå­˜åœ¨, å†…å­˜é‡Œå°±è‚¯å®šæ˜¯æ­£ç¡®çš„ç»“æžœ, ç›´æŽ¥è¿”å›ž")]),s._v(";")]),s._v(" "),t("li",[s._v("å¦ä¸€ç§æ˜¯å†…å­˜é‡Œæ²¡æœ‰æ•°æ®, å°±å¯ä»¥è‚¯å®šæ•°æ®æ–‡ä»¶ä¸Šæ˜¯æ­£ç¡®çš„ç»“æžœ, è¯»å…¥å†…å­˜åŽè¿”å›ž. è¿™æ ·çš„æ•ˆçŽ‡æœ€é«˜.")])]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬ä¸‰ç§åœºæ™¯")]),s._v("æ˜¯, ç”Ÿæ„ä¸å¿™çš„æ—¶å€™, æˆ–è€…æ‰“çƒŠä¹‹åŽ. è¿™æ—¶å€™æŸœå°æ²¡äº‹, æŽŒæŸœé—²ç€ä¹Ÿæ˜¯é—²ç€, ä¸å¦‚æ›´æ–°è´¦æœ¬. è¿™ç§åœºæ™¯, "),t("mark",[t("strong",[s._v('å¯¹åº”çš„å°±æ˜¯ MySQL è®¤ä¸ºç³»ç»Ÿ"ç©ºé—²"çš„æ—¶å€™')])]),s._v('. å½“ç„¶, MySQL "è¿™å®¶é…’åº—" çš„ç”Ÿæ„å¥½èµ·æ¥å¯æ˜¯ä¼šå¾ˆå¿«å°±èƒ½æŠŠç²‰æ¿è®°æ»¡çš„, æ‰€ä»¥è¦åˆç†åœ°å®‰æŽ’æ—¶é—´, å³ä½¿æ˜¯"ç”Ÿæ„å¥½"çš„æ—¶å€™, ä¹Ÿè¦è§ç¼æ’é’ˆåœ°æ‰¾æ—¶é—´, åªè¦æœ‰æœºä¼šå°±åˆ·ä¸€ç‚¹ "è„é¡µ".')]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬å››ç§åœºæ™¯")]),s._v("æ˜¯, å¹´åº•äº†å’¸äº¨é…’åº—è¦å…³é—¨å‡ å¤©, éœ€è¦æŠŠè´¦ç»“æ¸…ä¸€ä¸‹. è¿™æ—¶å€™æŽŒæŸœè¦æŠŠæ‰€æœ‰è´¦éƒ½è®°åˆ°è´¦æœ¬ä¸Š, è¿™æ ·è¿‡å®Œå¹´é‡æ–°å¼€å¼ çš„æ—¶å€™, å°±èƒ½å°±ç€è´¦æœ¬æ˜Žç¡®è´¦ç›®æƒ…å†µäº†. è¿™ç§åœºæ™¯, "),t("mark",[t("strong",[s._v("å¯¹åº”çš„å°±æ˜¯ MySQL æ­£å¸¸å…³é—­çš„æƒ…å†µ")])]),s._v(". è¿™æ—¶å€™, MySQL ä¼šæŠŠå†…å­˜çš„è„é¡µéƒ½ flush åˆ°ç£ç›˜ä¸Š, è¿™æ ·ä¸‹æ¬¡ MySQL å¯åŠ¨çš„æ—¶å€™, å°±å¯ä»¥ç›´æŽ¥ä»Žç£ç›˜ä¸Šè¯»æ•°æ®, å¯åŠ¨é€Ÿåº¦ä¼šå¾ˆå¿«.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥"),t("strong",[s._v('åˆ†æžä¸€ä¸‹ä¸Šé¢å››ç§åœºæ™¯å¯¹æ€§èƒ½çš„å½±å“. ** å…¶ä¸­ç¬¬ä¸‰ç§æƒ…å†µæ˜¯å±žäºŽ MySQL ç©ºé—²æ—¶çš„æ“ä½œ, è¿™æ—¶ç³»ç»Ÿæ²¡ä»€ä¹ˆåŽ‹åŠ›, è€Œç¬¬å››ç§åœºæ™¯æ˜¯æ•°æ®åº“æœ¬æ¥å°±è¦å…³é—­äº†. è¿™ä¸¤ç§æƒ…å†µä¸‹, ä½ ä¸ä¼šå¤ªå…³æ³¨"æ€§èƒ½"é—®é¢˜. æ‰€ä»¥è¿™é‡Œä¸»è¦æ¥åˆ†')]),s._v("æžä¸€ä¸‹å‰ä¸¤ç§åœºæ™¯ä¸‹çš„æ€§èƒ½é—®é¢˜**.")]),s._v(" "),t("p",[s._v('ç¬¬ä¸€ç§æ˜¯ "redo log å†™æ»¡äº†, è¦ flush è„é¡µ", è¿™ç§æƒ…å†µæ˜¯ InnoDB '),t("strong",[s._v("è¦å°½é‡é¿å…")]),s._v("çš„. å› ä¸ºå‡ºçŽ°è¿™ç§æƒ…å†µçš„æ—¶å€™, "),t("strong",[s._v("æ•´ä¸ªç³»ç»Ÿå°±ä¸èƒ½å†æŽ¥å—æ›´æ–°äº†, æ‰€æœ‰çš„æ›´æ–°éƒ½å¿…é¡»å µä½")]),s._v(". å¦‚æžœä»Žç›‘æŽ§ä¸Šçœ‹, è¿™æ—¶å€™æ›´æ–°æ•°ä¼šè·Œä¸º 0.")]),s._v(" "),t("p",[s._v('ç¬¬äºŒç§æ˜¯ "å†…å­˜ä¸å¤Ÿç”¨äº†, è¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜", è¿™ç§æƒ…å†µå…¶å®žæ˜¯'),t("strong",[s._v("å¸¸æ€")]),s._v(". "),t("mark",[t("strong",[s._v("InnoDB ç”¨ç¼“å†²æ± (buffer pool)ç®¡ç†å†…å­˜, ç¼“å†²æ± ä¸­çš„å†…å­˜é¡µæœ‰ä¸‰ç§çŠ¶æ€")])]),s._v("â€‹ **: **")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€ç§æ˜¯, "),t("strong",[s._v("è¿˜æ²¡æœ‰ä½¿ç”¨çš„")]),s._v(";")]),s._v(" "),t("li",[s._v("ç¬¬äºŒç§æ˜¯, "),t("strong",[s._v("ä½¿ç”¨äº†å¹¶ä¸”æ˜¯å¹²å‡€é¡µ")]),s._v(";")]),s._v(" "),t("li",[s._v("ç¬¬ä¸‰ç§æ˜¯, "),t("strong",[s._v("ä½¿ç”¨äº†å¹¶ä¸”æ˜¯è„é¡µ")]),s._v(".")])]),s._v(" "),t("p",[s._v("InnoDB çš„"),t("strong",[s._v("ç­–ç•¥æ˜¯å°½é‡ä½¿ç”¨å†…å­˜")]),s._v(", å› æ­¤å¯¹äºŽä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„åº“æ¥è¯´, æœªè¢«ä½¿ç”¨çš„é¡µé¢å¾ˆå°‘. è€Œå½“è¦è¯»å…¥çš„æ•°æ®é¡µæ²¡æœ‰åœ¨å†…å­˜çš„æ—¶å€™, å°±"),t("strong",[s._v("å¿…é¡»åˆ°ç¼“å†²æ± ä¸­ç”³è¯·ä¸€ä¸ªæ•°æ®é¡µ")]),s._v(". è¿™æ—¶å€™åªèƒ½æŠŠæœ€ä¹…ä¸ä½¿ç”¨çš„æ•°æ®é¡µä»Žå†…å­˜ä¸­æ·˜æ±°æŽ‰: "),t("mark",[t("strong",[s._v("å¦‚æžœè¦æ·˜æ±°çš„æ˜¯ä¸€ä¸ªå¹²å‡€é¡µ, å°±ç›´æŽ¥é‡Šæ”¾å‡ºæ¥å¤ç”¨; ä½†å¦‚æžœæ˜¯è„é¡µå‘¢, å°±å¿…é¡»å°†è„é¡µå…ˆåˆ·åˆ°ç£ç›˜, å˜æˆå¹²å‡€é¡µåŽæ‰èƒ½å¤ç”¨")])]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥åˆ·è„é¡µè™½ç„¶æ˜¯å¸¸æ€, ä½†æ˜¯å‡ºçŽ°ä»¥ä¸‹è¿™ä¸¤ç§æƒ…å†µ, éƒ½æ˜¯ä¼šæ˜Žæ˜¾å½±å“æ€§èƒ½çš„:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä¸€ä¸ªæŸ¥è¯¢è¦æ·˜æ±°çš„è„é¡µä¸ªæ•°å¤ªå¤š, ä¼šå¯¼è‡´æŸ¥è¯¢çš„å“åº”æ—¶é—´æ˜Žæ˜¾å˜é•¿")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("æ—¥å¿—å†™æ»¡, æ›´æ–°å…¨éƒ¨å µä½, å†™æ€§èƒ½è·Œä¸º 0, è¿™ç§æƒ…å†µå¯¹æ•æ„Ÿä¸šåŠ¡æ¥è¯´, æ˜¯ä¸èƒ½æŽ¥å—çš„")]),s._v(".")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥ InnoDB éœ€è¦æœ‰"),t("strong",[s._v("æŽ§åˆ¶è„é¡µæ¯”ä¾‹")]),s._v("çš„æœºåˆ¶, æ¥å°½é‡é¿å…ä¸Šé¢çš„è¿™ä¸¤ç§æƒ…å†µ.")]),s._v(" "),t("h5",{attrs:{id:"innodbåˆ·è„é¡µçš„æŽ§åˆ¶ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#innodbåˆ·è„é¡µçš„æŽ§åˆ¶ç­–ç•¥"}},[s._v("#")]),s._v(" InnoDBåˆ·è„é¡µçš„æŽ§åˆ¶ç­–ç•¥")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å°±è¯´è¯´ InnoDB è„é¡µçš„æŽ§åˆ¶ç­–ç•¥, ä»¥åŠå’Œè¿™äº›ç­–ç•¥ç›¸å…³çš„å‚æ•°.")]),s._v(" "),t("p",[s._v("é¦–å…ˆè¦æ­£ç¡®åœ°å‘Šè¯‰ InnoDB æ‰€åœ¨ä¸»æœºçš„ "),t("strong",[s._v("IO èƒ½åŠ›")]),s._v(", è¿™æ · InnoDB æ‰èƒ½çŸ¥é“éœ€è¦å…¨åŠ›åˆ·è„é¡µçš„æ—¶å€™, å¯ä»¥åˆ·å¤šå¿«. è¿™å°±è¦ç”¨åˆ° "),t("strong",[s._v("innodb_io_capacity")]),s._v(" è¿™ä¸ªå‚æ•°äº†, å®ƒä¼šå‘Šè¯‰ InnoDB ä½ çš„ç£ç›˜èƒ½åŠ›. è¿™ä¸ªå€¼å»ºè®®"),t("strong",[s._v("è®¾ç½®æˆç£ç›˜çš„ IOPS")]),s._v(". ç£ç›˜çš„ IOPS å¯ä»¥é€šè¿‡ fio è¿™ä¸ªå·¥å…·æ¥æµ‹è¯•, ä¸‹é¢çš„è¯­å¥æ˜¯ç”¨æ¥æµ‹è¯•ç£ç›˜éšæœºè¯»å†™çš„å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("fio "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$filename "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("direct"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("iodepth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("randrw "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ioengine"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("psync "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("k "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("M "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("numjobs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("group_reporting "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mytest \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å…¶å®ž, "),t("strong",[s._v("å› ä¸ºæ²¡èƒ½æ­£ç¡®åœ°è®¾ç½® innodb_io_capacity å‚æ•°, è€Œå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ä¹Ÿæ¯”æ¯”çš†æ˜¯")]),s._v(". ä¹‹å‰å°±æ›¾æœ‰å…¶ä»–å…¬å¸çš„å¼€å‘è´Ÿè´£äººæ‰¾æˆ‘çœ‹ä¸€ä¸ªåº“çš„æ€§èƒ½é—®é¢˜, è¯´ MySQL çš„å†™å…¥é€Ÿåº¦å¾ˆæ…¢, TPS å¾ˆä½Ž, ä½†æ˜¯æ•°æ®åº“ä¸»æœºçš„ IO åŽ‹åŠ›å¹¶ä¸å¤§. ç»è¿‡ä¸€ç•ªæŽ’æŸ¥, å‘çŽ°ç½ªé­ç¥¸é¦–å°±æ˜¯è¿™ä¸ªå‚æ•°çš„è®¾ç½®å‡ºäº†é—®é¢˜. ä»–çš„ä¸»æœºç£ç›˜ç”¨çš„æ˜¯ SSD, ä½†æ˜¯ innodb_io_capacity çš„å€¼è®¾ç½®çš„æ˜¯ 300. äºŽæ˜¯ InnoDB è®¤ä¸ºè¿™ä¸ªç³»ç»Ÿçš„èƒ½åŠ›å°±è¿™ä¹ˆå·®, æ‰€ä»¥"),t("strong",[s._v("åˆ·è„é¡µåˆ·å¾—ç‰¹åˆ«æ…¢")]),s._v(", ç”šè‡³æ¯”è„é¡µç”Ÿæˆçš„é€Ÿåº¦è¿˜æ…¢, è¿™æ ·å°±é€ æˆäº†è„é¡µç´¯ç§¯, å½±å“äº†æŸ¥è¯¢å’Œæ›´æ–°æ€§èƒ½.")]),s._v(" "),t("p",[s._v('è™½ç„¶çŽ°åœ¨å·²ç»å®šä¹‰äº† "å…¨åŠ›åˆ·è„é¡µ" çš„è¡Œä¸º, ä½†å¹³æ—¶æ€»ä¸èƒ½ä¸€ç›´æ˜¯å…¨åŠ›åˆ·å§? æ¯•ç«Ÿç£ç›˜èƒ½åŠ›ä¸èƒ½åªç”¨æ¥åˆ·è„é¡µ, è¿˜éœ€è¦æœåŠ¡ç”¨æˆ·è¯·æ±‚. æ‰€ä»¥æŽ¥ä¸‹æ¥, å°±ä¸€èµ·çœ‹çœ‹ InnoDB æ€Žä¹ˆæŽ§åˆ¶å¼•æ“ŽæŒ‰ç…§ "å…¨åŠ›" çš„ç™¾åˆ†æ¯”æ¥åˆ·è„é¡µ.')]),s._v(" "),t("p",[s._v("æ ¹æ®å‰é¢æåˆ°çš„çŸ¥è¯†ç‚¹, è¯•æƒ³ä¸€ä¸‹, "),t("strong",[s._v("å¦‚æžœä½ æ¥è®¾è®¡ç­–ç•¥æŽ§åˆ¶åˆ·è„é¡µçš„é€Ÿåº¦, ä¼šå‚è€ƒå“ªäº›å› ç´ å‘¢? ** è¿™ä¸ªé—®é¢˜å¯ä»¥è¿™ä¹ˆæƒ³, å¦‚æžœåˆ·å¤ªæ…¢, ä¼šå‡ºçŽ°ä»€ä¹ˆæƒ…å†µ? é¦–å…ˆæ˜¯")]),s._v("å†…å­˜è„é¡µå¤ªå¤š, å…¶æ¬¡æ˜¯ redo log å†™æ»¡**. æ‰€ä»¥ InnoDB çš„åˆ·ç›˜é€Ÿåº¦å°±æ˜¯è¦å‚è€ƒè¿™ä¸¤ä¸ªå› ç´ : "),t("mark",[t("strong",[s._v("ä¸€ä¸ªæ˜¯è„é¡µæ¯”ä¾‹, ä¸€ä¸ªæ˜¯ redo log å†™ç›˜é€Ÿåº¦")])]),s._v(".")]),s._v(" "),t("p",[s._v("InnoDB ä¼šæ ¹æ®è¿™ä¸¤ä¸ªå› ç´ å…ˆå•ç‹¬ç®—å‡ºä¸¤ä¸ªæ•°å­—.")]),s._v(" "),t("p",[s._v("å‚æ•° "),t("strong",[s._v("innodb_max_dirty_pages_pct")]),s._v(" æ˜¯è„é¡µæ¯”ä¾‹ä¸Šé™, é»˜è®¤å€¼æ˜¯ 75%. InnoDB ä¼šæ ¹æ®å½“å‰çš„è„é¡µæ¯”ä¾‹(å‡è®¾ä¸º M), ç®—å‡ºä¸€ä¸ªèŒƒå›´åœ¨ 0 åˆ° 100 ä¹‹é—´çš„æ•°å­—, è®¡ç®—è¿™ä¸ªæ•°å­—çš„ä¼ªä»£ç ç±»ä¼¼è¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("F1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("M"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n{\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" M"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v("innodb_max_dirty_pages_pct "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("M"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("innodb_max_dirty_pages_pct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("InnoDB æ¯æ¬¡å†™å…¥çš„æ—¥å¿—éƒ½æœ‰ä¸€ä¸ªåºå·, å½“å‰å†™å…¥çš„åºå·è·Ÿ checkpoint å¯¹åº”çš„åºå·ä¹‹é—´çš„å·®å€¼, å‡è®¾ä¸º N. InnoDB ä¼šæ ¹æ®è¿™ä¸ª N ç®—å‡ºä¸€ä¸ªèŒƒå›´åœ¨ 0 åˆ° 100 ä¹‹é—´çš„æ•°å­—, è¿™ä¸ªè®¡ç®—å…¬å¼å¯ä»¥è®°ä¸º F2(N). F2(N) ç®—æ³•æ¯”è¾ƒå¤æ‚, åªè¦çŸ¥é“ N è¶Šå¤§, ç®—å‡ºæ¥çš„å€¼è¶Šå¤§å°±å¥½äº†.")]),s._v(" "),t("p",[s._v("ç„¶åŽ, **æ ¹æ®ä¸Šè¿°ç®—å¾—çš„ F1(M) å’Œ F2(N) ä¸¤ä¸ªå€¼, å–å…¶ä¸­è¾ƒå¤§çš„å€¼è®°ä¸º R, ä¹‹åŽå¼•æ“Žå°±å¯ä»¥æŒ‰ç…§ innodb_io_capacity å®šä¹‰çš„èƒ½åŠ›ä¹˜ä»¥ R% æ¥æŽ§åˆ¶åˆ·è„é¡µçš„é€Ÿåº¦. **")]),s._v(" "),t("p",[s._v("ä¸Šè¿°çš„è®¡ç®—æµç¨‹æ¯”è¾ƒæŠ½è±¡, ä¸å®¹æ˜“ç†è§£, æ‰€ä»¥ç”»äº†ä¸€ä¸ªç®€å•çš„æµç¨‹å›¾. å›¾ä¸­çš„ F1, F2 å°±æ˜¯ä¸Šé¢é€šè¿‡è„é¡µæ¯”ä¾‹å’Œ redo log å†™å…¥é€Ÿåº¦ç®—å‡ºæ¥çš„ä¸¤ä¸ªå€¼.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d6cfd5e14793b887f3184f6a1766dc0e-20230731161914-zsxpfu5.png",alt:"",title:"InnoDB åˆ·è„é¡µé€Ÿåº¦ç­–ç•¥"}})]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä½ çŸ¥é“äº†, "),t("strong",[s._v("InnoDB ä¼šåœ¨åŽå°åˆ·è„é¡µ, è€Œåˆ·è„é¡µçš„è¿‡ç¨‹æ˜¯è¦å°†å†…å­˜é¡µå†™å…¥ç£ç›˜")]),s._v('. æ‰€ä»¥æ— è®ºæ˜¯æŸ¥è¯¢è¯­å¥åœ¨éœ€è¦å†…å­˜çš„æ—¶å€™å¯èƒ½è¦æ±‚æ·˜æ±°ä¸€ä¸ªè„é¡µ, è¿˜æ˜¯ç”±äºŽåˆ·è„é¡µçš„é€»è¾‘ä¼šå ç”¨ IO èµ„æºå¹¶å¯èƒ½å½±å“åˆ°äº†ä½ çš„æ›´æ–°è¯­å¥, éƒ½å¯èƒ½æ˜¯é€ æˆä¸šåŠ¡ç«¯æ„ŸçŸ¥åˆ° MySQL"æŠ–"äº†ä¸€ä¸‹çš„åŽŸå› .')]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("è¦å°½é‡é¿å…è¿™ç§æƒ…å†µ, å°±è¦åˆç†åœ°è®¾ç½® innodb_io_capacity çš„å€¼, å¹¶ä¸”å¹³æ—¶è¦å¤šå…³æ³¨è„é¡µæ¯”ä¾‹, ä¸è¦è®©å®ƒç»å¸¸æŽ¥è¿‘ 75%")])]),s._v(" .")]),s._v(" "),t("p",[s._v("å…¶ä¸­, è„é¡µæ¯”ä¾‹æ˜¯é€šè¿‡ "),t("strong",[s._v("Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_total")]),s._v(" å¾—åˆ°çš„, å…·ä½“çš„å‘½ä»¤å‚è€ƒä¸‹é¢çš„ä»£ç :")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" VARIABLE_VALUE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" global_status "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" VARIABLE_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_buffer_pool_pages_dirty'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" VARIABLE_VALUE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@b")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" global_status "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" VARIABLE_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_buffer_pool_pages_total'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@b")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªæœ‰è¶£çš„ç­–ç•¥.")]),s._v(" "),t("p",[s._v("ä¸€æ—¦ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚éœ€è¦åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å…ˆ flush æŽ‰ä¸€ä¸ªè„é¡µæ—¶, è¿™ä¸ªæŸ¥è¯¢å°±å¯èƒ½è¦æ¯”å¹³æ—¶æ…¢äº†. è€Œ MySQL ä¸­çš„ä¸€ä¸ªæœºåˆ¶, å¯èƒ½è®©ä½ çš„æŸ¥è¯¢ä¼šæ›´æ…¢: "),t("strong",[s._v('åœ¨å‡†å¤‡åˆ·ä¸€ä¸ªè„é¡µçš„æ—¶å€™, å¦‚æžœè¿™ä¸ªæ•°æ®é¡µæ—è¾¹çš„æ•°æ®é¡µåˆšå¥½æ˜¯è„é¡µ, å°±ä¼šæŠŠè¿™ä¸ª"é‚»å±…"ä¹Ÿå¸¦ç€ä¸€èµ·åˆ·æŽ‰; è€Œä¸”è¿™ä¸ªæŠŠ"é‚»å±…"æ‹–ä¸‹æ°´çš„é€»è¾‘è¿˜å¯ä»¥ç»§ç»­è”“å»¶, ä¹Ÿå°±æ˜¯å¯¹äºŽæ¯ä¸ªé‚»å±…æ•°æ®é¡µ, å¦‚æžœè·Ÿå®ƒç›¸é‚»çš„æ•°æ®é¡µä¹Ÿè¿˜æ˜¯è„é¡µçš„è¯, ä¹Ÿä¼šè¢«æ”¾åˆ°ä¸€èµ·åˆ·')]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ InnoDB ä¸­, "),t("strong",[s._v("innodb_flush_neighbors")]),s._v(' å‚æ•°å°±æ˜¯ç”¨æ¥æŽ§åˆ¶è¿™ä¸ªè¡Œä¸ºçš„, å€¼ä¸º 1 çš„æ—¶å€™ä¼šæœ‰ä¸Šè¿°çš„ "è¿žå" æœºåˆ¶, å€¼ä¸º 0 æ—¶è¡¨ç¤ºä¸æ‰¾é‚»å±…, è‡ªå·±åˆ·è‡ªå·±çš„. æ‰¾ "é‚»å±…" è¿™ä¸ªä¼˜åŒ–'),t("strong",[s._v("åœ¨æœºæ¢°ç¡¬ç›˜æ—¶ä»£æ˜¯å¾ˆæœ‰æ„ä¹‰")]),s._v("çš„, å¯ä»¥å‡å°‘å¾ˆå¤šéšæœº IO. æœºæ¢°ç¡¬ç›˜çš„éšæœº IOPS ä¸€èˆ¬åªæœ‰å‡ ç™¾, ç›¸åŒçš„é€»è¾‘æ“ä½œå‡å°‘éšæœº IO å°±æ„å‘³ç€ç³»ç»Ÿæ€§èƒ½çš„å¤§å¹…åº¦æå‡. è€Œå¦‚æžœä½¿ç”¨çš„"),t("strong",[s._v("æ˜¯ SSD è¿™ç±» IOPS æ¯”è¾ƒé«˜çš„è®¾å¤‡çš„è¯, å°±å»ºè®®æŠŠ innodb_flush_neighbors çš„å€¼è®¾ç½®æˆ 0")]),s._v('. å› ä¸ºè¿™æ—¶å€™ IOPS å¾€å¾€ä¸æ˜¯ç“¶é¢ˆ, è€Œ "åªåˆ·è‡ªå·±", å°±èƒ½æ›´å¿«åœ°æ‰§è¡Œå®Œå¿…è¦çš„åˆ·è„é¡µæ“ä½œ, å‡å°‘ SQL è¯­å¥å“åº”æ—¶é—´.')]),s._v(" "),t("p",[s._v("åœ¨ MySQL 8.0 ä¸­, innodb_flush_neighbors å‚æ•°çš„"),t("strong",[s._v("é»˜è®¤å€¼å·²ç»æ˜¯ 0 äº†")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-12"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-12"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å»¶ç»­ä»‹ç»çš„ WAL çš„æ¦‚å¿µ, è§£é‡Šäº†è¿™ä¸ªæœºåˆ¶åŽç»­éœ€è¦çš„åˆ·è„é¡µæ“ä½œå’Œæ‰§è¡Œæ—¶æœº. åˆ©ç”¨ WAL æŠ€æœ¯, "),t("strong",[s._v("æ•°æ®åº“å°†éšæœºå†™è½¬æ¢æˆäº†é¡ºåºå†™, å¤§å¤§æå‡äº†æ•°æ®åº“çš„æ€§èƒ½")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æ˜¯ç”±æ­¤ä¹Ÿå¸¦æ¥äº†"),t("strong",[s._v("å†…å­˜è„é¡µ")]),s._v("çš„é—®é¢˜. "),t("strong",[s._v("è„é¡µä¼šè¢«åŽå°çº¿ç¨‹è‡ªåŠ¨ flush, ä¹Ÿä¼šç”±äºŽæ•°æ®é¡µæ·˜æ±°è€Œè§¦å‘ flush, è€Œåˆ·è„é¡µçš„è¿‡ç¨‹ç”±äºŽä¼šå ç”¨èµ„æº")]),s._v(", å¯èƒ½ä¼šè®©æ›´æ–°å’ŒæŸ¥è¯¢è¯­å¥çš„å“åº”æ—¶é—´é•¿ä¸€äº›.")]),s._v(" "),t("p",[s._v("æä¸ªé—®é¢˜. ä¸€ä¸ªå†…å­˜é…ç½®ä¸º 128GB, innodb_io_capacity è®¾ç½®ä¸º 20000 çš„å¤§è§„æ ¼å®žä¾‹, æ­£å¸¸ä¼šå»ºè®®å°† redo log è®¾ç½®æˆ 4 ä¸ª 1GB çš„æ–‡ä»¶. ä½†å¦‚æžœä½ åœ¨é…ç½®çš„æ—¶å€™ä¸æ…Žå°† redo log è®¾ç½®æˆäº† 1 ä¸ª 100M çš„æ–‡ä»¶, ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢? åˆä¸ºä»€ä¹ˆä¼šå‡ºçŽ°è¿™æ ·çš„æƒ…å†µå‘¢? å…¶å®žé—®é¢˜å°±æ˜¯å¦‚æžœä¸€ä¸ªé«˜é…çš„æœºå™¨, redo log è®¾ç½®å¤ªå°, ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µ.")]),s._v(" "),t("p",[s._v("æ¯æ¬¡äº‹åŠ¡æäº¤éƒ½è¦å†™ redo log, å¦‚æžœè®¾ç½®å¤ªå°, "),t("strong",[s._v("å¾ˆå¿«å°±ä¼šè¢«å†™æ»¡")]),s._v(', ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ªå›¾çš„çŠ¶æ€, è¿™ä¸ª"çŽ¯"å°†å¾ˆå¿«è¢«å†™æ»¡, write pos ä¸€ç›´è¿½ç€ CP.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a30dbcccf96359d6301a6110cb77768e-20230731161914-l4c9oib.png",alt:""}})]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™ç³»ç»Ÿ"),t("strong",[s._v("ä¸å¾—ä¸åœæ­¢æ‰€æœ‰æ›´æ–°")]),s._v(", åŽ»æŽ¨è¿› checkpoint. è¿™æ—¶çš„çŽ°è±¡å°±æ˜¯**ç£ç›˜åŽ‹åŠ›å¾ˆå°, ä½†æ˜¯æ•°æ®åº“å‡ºçŽ°é—´æ­‡æ€§çš„æ€§èƒ½ä¸‹è·Œ. **")]),s._v(" "),t("h4",{attrs:{id:"_13-ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æŽ‰ä¸€åŠ-è¡¨æ–‡ä»¶å¤§å°ä¸å˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13-ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æŽ‰ä¸€åŠ-è¡¨æ–‡ä»¶å¤§å°ä¸å˜"}},[s._v("#")]),s._v(" 13-ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æŽ‰ä¸€åŠ,è¡¨æ–‡ä»¶å¤§å°ä¸å˜?")]),s._v(" "),t("p",[s._v("ç»å¸¸ä¼šæœ‰åŒå­¦æ¥é—®æˆ‘, æ•°æ®åº“å ç”¨ç©ºé—´å¤ªå¤§, æˆ‘æŠŠä¸€ä¸ªæœ€å¤§çš„è¡¨åˆ æŽ‰äº†ä¸€åŠçš„æ•°æ®, æ€Žä¹ˆè¡¨æ–‡ä»¶çš„å¤§å°è¿˜æ˜¯æ²¡å˜? é‚£ä¹ˆæœ¬èŠ‚å°±èŠèŠ"),t("strong",[s._v("æ•°æ®åº“è¡¨çš„ç©ºé—´å›žæ”¶")]),s._v(", çœ‹çœ‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("è¿™é‡Œè¿˜æ˜¯é’ˆå¯¹ MySQL ä¸­åº”ç”¨æœ€å¹¿æ³›çš„ InnoDB å¼•æ“Žå±•å¼€è®¨è®º. ä¸€ä¸ª InnoDB è¡¨åŒ…å«ä¸¤éƒ¨åˆ†, å³: "),t("strong",[s._v("è¡¨ç»“æž„å®šä¹‰å’Œæ•°æ®")]),s._v(". åœ¨ MySQL 8.0 ç‰ˆæœ¬ä»¥å‰, è¡¨ç»“æž„æ˜¯å­˜åœ¨ä»¥ .frm ä¸ºåŽç¼€çš„æ–‡ä»¶é‡Œ. è€Œ MySQL 8.0 ç‰ˆæœ¬, åˆ™å·²ç»å…è®¸æŠŠè¡¨ç»“æž„å®šä¹‰æ”¾åœ¨ç³»ç»Ÿæ•°æ®è¡¨ä¸­äº†. å› ä¸ºè¡¨ç»“æž„å®šä¹‰å ç”¨çš„ç©ºé—´å¾ˆå°, æ‰€ä»¥ä»Šå¤©"),t("strong",[s._v("ä¸»è¦è®¨è®ºçš„æ˜¯è¡¨æ•°æ®")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥ä¼šå…ˆè¯´æ˜Ž"),t("strong",[s._v("ä¸ºä»€ä¹ˆç®€å•åœ°åˆ é™¤è¡¨æ•°æ®è¾¾ä¸åˆ°è¡¨ç©ºé—´å›žæ”¶çš„æ•ˆæžœ, ç„¶åŽå†ä»‹ç»æ­£ç¡®å›žæ”¶ç©ºé—´çš„æ–¹æ³•")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å‚æ•°innodb-file-per-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‚æ•°innodb-file-per-table"}},[s._v("#")]),s._v(" å‚æ•°innodb_file_per_table")]),s._v(" "),t("p",[t("strong",[s._v("è¡¨æ•°æ®æ—¢å¯ä»¥å­˜åœ¨å…±äº«è¡¨ç©ºé—´é‡Œ, ä¹Ÿå¯ä»¥æ˜¯å•ç‹¬çš„æ–‡ä»¶")]),s._v(". è¿™ä¸ªè¡Œä¸ºæ˜¯ç”±å‚æ•° "),t("strong",[s._v("innodb_file_per_table")]),s._v(" æŽ§åˆ¶çš„:")]),s._v(" "),t("ol",[t("li",[s._v("è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º OFF è¡¨ç¤ºçš„æ˜¯, è¡¨çš„æ•°æ®æ”¾åœ¨ç³»ç»Ÿå…±äº«è¡¨ç©ºé—´, ä¹Ÿå°±æ˜¯è·Ÿæ•°æ®å­—å…¸æ”¾åœ¨ä¸€èµ·;")]),s._v(" "),t("li",[s._v("è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º ON è¡¨ç¤ºçš„æ˜¯, æ¯ä¸ª InnoDB è¡¨æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªä»¥  "),t("strong",[s._v(".ibd")]),s._v(" ä¸ºåŽç¼€çš„æ–‡ä»¶ä¸­.")])]),s._v(" "),t("p",[s._v("ä»Ž MySQL 5.6.6 ç‰ˆæœ¬å¼€å§‹, å®ƒçš„é»˜è®¤å€¼å°±æ˜¯ ON äº†. å»ºè®®ä¸è®ºä½¿ç”¨ MySQL çš„å“ªä¸ªç‰ˆæœ¬, éƒ½å°†è¿™ä¸ªå€¼è®¾ç½®ä¸º ON. å› ä¸º"),t("strong",[s._v("ä¸€ä¸ªè¡¨å•ç‹¬å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡ä»¶æ›´å®¹æ˜“ç®¡ç†")]),s._v(", è€Œä¸”åœ¨ä¸éœ€è¦è¿™ä¸ªè¡¨çš„æ—¶å€™, é€šè¿‡ drop table å‘½ä»¤, "),t("strong",[s._v("ç³»ç»Ÿå°±ä¼šç›´æŽ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶")]),s._v(". è€Œ"),t("strong",[s._v("å¦‚æžœæ˜¯æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ä¸­, å³ä½¿è¡¨åˆ æŽ‰äº†, ç©ºé—´ä¹Ÿæ˜¯ä¸ä¼šå›žæ”¶çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥**å°† innodb_file_per_table è®¾ç½®ä¸º ON, æ˜¯æŽ¨èåšæ³•, æŽ¥ä¸‹æ¥çš„è®¨è®ºéƒ½æ˜¯åŸºäºŽè¿™ä¸ªè®¾ç½®å±•å¼€çš„. **")]),s._v(" "),t("p",[s._v("åœ¨åˆ é™¤æ•´ä¸ªè¡¨çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨ drop table å‘½ä»¤å›žæ”¶è¡¨ç©ºé—´. ä½†æ˜¯é‡åˆ°çš„æ›´å¤šçš„åˆ é™¤æ•°æ®çš„åœºæ™¯æ˜¯åˆ é™¤æŸäº›è¡Œ, è¿™æ—¶å°±é‡åˆ°äº†æ–‡ç« å¼€å¤´çš„é—®é¢˜: "),t("strong",[s._v("è¡¨ä¸­çš„æ•°æ®è¢«åˆ é™¤äº†, ä½†æ˜¯è¡¨ç©ºé—´å´æ²¡æœ‰è¢«å›žæ”¶.")])]),s._v(" "),t("p",[s._v("è¦å½»åº•æžæ˜Žç™½è¿™ä¸ªé—®é¢˜çš„è¯, å°±è¦ä»Ž"),t("strong",[s._v("æ•°æ®åˆ é™¤æµç¨‹")]),s._v("è¯´èµ·äº†.")]),s._v(" "),t("h5",{attrs:{id:"æ•°æ®åˆ é™¤æµç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®åˆ é™¤æµç¨‹"}},[s._v("#")]),s._v(" æ•°æ®åˆ é™¤æµç¨‹")]),s._v(" "),t("p",[s._v("å…ˆå†æ¥çœ‹ä¸€ä¸‹ InnoDB ä¸­ä¸€ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾. åœ¨å‰é¢ä»‹ç»ç´¢å¼•æ—¶æ›¾ç»æåˆ°è¿‡, InnoDB é‡Œçš„æ•°æ®éƒ½æ˜¯ç”¨ B+ æ ‘çš„ç»“æž„ç»„ç»‡çš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c1fa853d7761ec01eb6d03954105e790-20230731161914-2q13c54.png",alt:"",title:"B+ æ ‘ç´¢å¼•ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å‡è®¾è¦åˆ æŽ‰ R4 è¿™ä¸ªè®°å½•, InnoDB å¼•æ“Ž"),t("strong",[s._v("åªä¼šæŠŠ R4 è¿™ä¸ªè®°å½•æ ‡è®°ä¸ºåˆ é™¤")]),s._v(". å¦‚æžœä¹‹åŽè¦å†æ’å…¥ä¸€ä¸ª ID åœ¨ 300 å’Œ 600 ä¹‹é—´çš„è®°å½•æ—¶, å¯èƒ½ä¼š"),t("strong",[s._v("å¤ç”¨è¿™ä¸ªä½ç½®")]),s._v(". ä½†æ˜¯ç£ç›˜æ–‡ä»¶çš„å¤§å°å¹¶ä¸ä¼šç¼©å°.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨, ä½ å·²ç»çŸ¥é“äº† InnoDB çš„æ•°æ®æ˜¯"),t("strong",[s._v("æŒ‰é¡µå­˜å‚¨")]),s._v("çš„, é‚£ä¹ˆå¦‚æžœåˆ æŽ‰äº†ä¸€ä¸ªæ•°æ®é¡µä¸Šçš„æ‰€æœ‰è®°å½•, ä¼šæ€Žä¹ˆæ ·?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("æ•´ä¸ªæ•°æ®é¡µå°±å¯ä»¥è¢«å¤ç”¨äº†")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, **æ•°æ®é¡µçš„å¤ç”¨è·Ÿè®°å½•çš„å¤ç”¨æ˜¯ä¸åŒçš„. ** è®°å½•çš„å¤ç”¨, åªé™äºŽç¬¦åˆèŒƒå›´æ¡ä»¶çš„æ•°æ®. æ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ªä¾‹å­, R4 è¿™æ¡è®°å½•è¢«åˆ é™¤åŽ, å¦‚æžœæ’å…¥ä¸€ä¸ª ID æ˜¯ 400 çš„è¡Œ, å¯ä»¥ç›´æŽ¥å¤ç”¨è¿™ä¸ªç©ºé—´. ä½†å¦‚æžœæ’å…¥çš„æ˜¯ä¸€ä¸ª ID æ˜¯ 800 çš„è¡Œ, å°±ä¸èƒ½å¤ç”¨è¿™ä¸ªä½ç½®äº†.")]),s._v(" "),t("p",[s._v("è€Œå½“æ•´ä¸ªé¡µä»Ž B+ æ ‘é‡Œé¢æ‘˜æŽ‰ä»¥åŽ, å¯ä»¥å¤ç”¨åˆ°ä»»ä½•ä½ç½®. ä»¥ä¸Šå›¾ä¸ºä¾‹, å¦‚æžœå°†æ•°æ®é¡µ page A ä¸Šçš„æ‰€æœ‰è®°å½•åˆ é™¤ä»¥åŽ, "),t("strong",[s._v("page A ä¼šè¢«æ ‡è®°ä¸ºå¯å¤ç”¨")]),s._v(". è¿™æ—¶å€™å¦‚æžœè¦æ’å…¥ä¸€æ¡ ID=50 çš„è®°å½•éœ€è¦ä½¿ç”¨æ–°é¡µçš„æ—¶å€™, page A æ˜¯å¯ä»¥è¢«å¤ç”¨çš„.")]),s._v(" "),t("p",[s._v("å¦‚æžœç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®é¡µåˆ©ç”¨çŽ‡éƒ½å¾ˆå°, ç³»ç»Ÿå°±ä¼šæŠŠè¿™ä¸¤ä¸ªé¡µä¸Šçš„æ•°æ®åˆåˆ°å…¶ä¸­ä¸€ä¸ªé¡µä¸Š, å¦å¤–ä¸€ä¸ªæ•°æ®é¡µå°±è¢«æ ‡è®°ä¸ºå¯å¤ç”¨.")]),s._v(" "),t("p",[s._v("è¿›ä¸€æ­¥åœ°, å¦‚æžœç”¨ delete å‘½ä»¤æŠŠæ•´ä¸ªè¡¨çš„æ•°æ®åˆ é™¤å‘¢? ç»“æžœå°±æ˜¯"),t("strong",[s._v("æ‰€æœ‰çš„æ•°æ®é¡µéƒ½ä¼šè¢«æ ‡è®°ä¸ºå¯å¤ç”¨. ä½†æ˜¯ç£ç›˜ä¸Š, æ–‡ä»¶ä¸ä¼šå˜å°")]),s._v(". å› æ­¤ delete å‘½ä»¤å…¶å®ž"),t("strong",[s._v('åªæ˜¯æŠŠè®°å½•çš„ä½ç½®, æˆ–è€…æ•°æ®é¡µæ ‡è®°ä¸ºäº†"å¯å¤ç”¨", ä½†ç£ç›˜æ–‡ä»¶çš„å¤§å°æ˜¯ä¸ä¼šå˜çš„')]),s._v(". ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v('é€šè¿‡ delete å‘½ä»¤æ˜¯ä¸èƒ½å›žæ”¶è¡¨ç©ºé—´çš„. è¿™äº›å¯ä»¥å¤ç”¨, è€Œæ²¡æœ‰è¢«ä½¿ç”¨çš„ç©ºé—´, çœ‹èµ·æ¥å°±åƒæ˜¯"ç©ºæ´ž"')]),s._v(" .")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, "),t("strong",[s._v("ä¸æ­¢æ˜¯åˆ é™¤æ•°æ®ä¼šé€ æˆç©ºæ´ž, æ’å…¥æ•°æ®ä¹Ÿä¼š. ** å¦‚æžœæ•°æ®æ˜¯æŒ‰ç…§ç´¢å¼•é€’å¢žé¡ºåºæ’å…¥çš„, é‚£ä¹ˆç´¢å¼•æ˜¯ç´§å‡‘çš„. ä½†å¦‚æžœæ•°æ®æ˜¯")]),s._v("éšæœºæ’å…¥**çš„, å°±å¯èƒ½é€ æˆç´¢å¼•çš„æ•°æ®é¡µåˆ†è£‚.")]),s._v(" "),t("p",[s._v("å‡è®¾å›¾ 1 ä¸­ page A å·²ç»æ»¡äº†, è¿™æ—¶è¦å†æ’å…¥ä¸€è¡Œæ•°æ®, ä¼šæ€Žæ ·å‘¢?")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e8b0c758e42ed9e621f02c75af88b57d-20230731161914-hnsunov.png",alt:"",title:"æ’å…¥æ•°æ®å¯¼è‡´é¡µåˆ†è£‚"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ç”±äºŽ page A æ»¡äº†, å†æ’å…¥ä¸€ä¸ª ID æ˜¯ 550 çš„æ•°æ®æ—¶, å°±"),t("strong",[s._v("ä¸å¾—ä¸å†ç”³è¯·ä¸€ä¸ªæ–°çš„é¡µé¢ page B æ¥ä¿å­˜æ•°æ®äº†")]),s._v(". é¡µåˆ†è£‚å®ŒæˆåŽ, page A çš„æœ«å°¾å°±ç•™ä¸‹äº†ç©ºæ´ž(æ³¨æ„: å®žé™…ä¸Šå¯èƒ½ä¸æ­¢ 1 ä¸ªè®°å½•çš„ä½ç½®æ˜¯ç©ºæ´ž).")]),s._v(" "),t("p",[s._v("å¦å¤–, "),t("strong",[s._v("æ›´æ–°ç´¢å¼•ä¸Šçš„å€¼, å¯ä»¥ç†è§£ä¸ºåˆ é™¤ä¸€ä¸ªæ—§çš„å€¼, å†æ’å…¥ä¸€ä¸ªæ–°å€¼")]),s._v(". ä¸éš¾ç†è§£, è¿™ä¹Ÿæ˜¯ä¼šé€ æˆç©ºæ´žçš„.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, ç»è¿‡å¤§é‡å¢žåˆ æ”¹çš„è¡¨, éƒ½æ˜¯å¯èƒ½æ˜¯å­˜åœ¨ç©ºæ´žçš„. "),t("strong",[s._v("æ‰€ä»¥å¦‚æžœèƒ½å¤ŸæŠŠè¿™äº›ç©ºæ´žåŽ»æŽ‰, å°±èƒ½è¾¾åˆ°æ”¶ç¼©è¡¨ç©ºé—´çš„ç›®çš„")]),s._v(". è€Œ"),t("mark",[t("strong",[s._v("é‡å»ºè¡¨")])]),s._v(", å°±å¯ä»¥è¾¾åˆ°è¿™æ ·çš„ç›®çš„.")]),s._v(" "),t("h5",{attrs:{id:"é‡å»ºè¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡å»ºè¡¨"}},[s._v("#")]),s._v(" é‡å»ºè¡¨")]),s._v(" "),t("p",[s._v("è¯•æƒ³ä¸€ä¸‹, å¦‚æžœä½ çŽ°åœ¨æœ‰ä¸€ä¸ªè¡¨ A, éœ€è¦åšç©ºé—´æ”¶ç¼©, ä¸ºäº†æŠŠè¡¨ä¸­å­˜åœ¨çš„ç©ºæ´žåŽ»æŽ‰, åº”è¯¥æ€Žä¹ˆåšå‘¢? "),t("strong",[s._v("å¯ä»¥æ–°å»ºä¸€ä¸ªä¸Žè¡¨ A ç»“æž„ç›¸åŒçš„è¡¨ B, ç„¶åŽæŒ‰ç…§ä¸»é”® ID é€’å¢žçš„é¡ºåº, æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»Žè¡¨ A é‡Œè¯»å‡ºæ¥å†æ’å…¥åˆ°è¡¨ B ä¸­")]),s._v(".")]),s._v(" "),t("p",[s._v("ç”±äºŽè¡¨ B æ˜¯æ–°å»ºçš„è¡¨, æ‰€ä»¥è¡¨ A ä¸»é”®ç´¢å¼•ä¸Šçš„ç©ºæ´ž, åœ¨è¡¨ B ä¸­å°±éƒ½ä¸å­˜åœ¨äº†. æ˜¾ç„¶åœ°, è¡¨ B çš„ä¸»é”®ç´¢å¼•æ›´ç´§å‡‘, æ•°æ®é¡µçš„åˆ©ç”¨çŽ‡ä¹Ÿæ›´é«˜. å¦‚æžœæŠŠè¡¨ B ä½œä¸ºä¸´æ—¶è¡¨, æ•°æ®ä»Žè¡¨ A å¯¼å…¥è¡¨ B çš„æ“ä½œå®ŒæˆåŽ, ç”¨è¡¨ B æ›¿æ¢ A, ä»Žæ•ˆæžœä¸Šçœ‹, å°±èµ·åˆ°äº†æ”¶ç¼©è¡¨ A ç©ºé—´çš„ä½œç”¨.")]),s._v(" "),t("p",[s._v("è¿™é‡Œå¯ä»¥ä½¿ç”¨ "),t("code",[s._v("alter table A engine=InnoDB")]),s._v("â€‹ å‘½ä»¤æ¥"),t("strong",[s._v("é‡å»ºè¡¨")]),s._v(". åœ¨ MySQL 5.5 ç‰ˆæœ¬ä¹‹å‰, è¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œæµç¨‹è·Ÿå‰é¢æè¿°çš„å·®ä¸å¤š, åŒºåˆ«åªæ˜¯è¿™ä¸ªä¸´æ—¶è¡¨ B ä¸éœ€è¦è‡ªå·±åˆ›å»º, MySQL ä¼šè‡ªåŠ¨å®Œæˆè½¬å­˜æ•°æ®, äº¤æ¢è¡¨å, åˆ é™¤æ—§è¡¨çš„æ“ä½œ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/905bee29ec2994fa8ec63addffb4e330-20230731161914-4p1aigd.png",alt:"",title:"æ”¹é”è¡¨ DDL"}})]),s._v(" "),t("p",[s._v("æ˜¾ç„¶, èŠ±æ—¶é—´æœ€å¤šçš„æ­¥éª¤æ˜¯"),t("strong",[s._v("å¾€ä¸´æ—¶è¡¨æ’å…¥æ•°æ®çš„è¿‡ç¨‹")]),s._v(", å¦‚æžœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, æœ‰æ–°çš„æ•°æ®è¦å†™å…¥åˆ°è¡¨ A çš„è¯, å°±ä¼šé€ æˆæ•°æ®ä¸¢å¤±. å› æ­¤åœ¨æ•´ä¸ª DDL è¿‡ç¨‹ä¸­, è¡¨ A ä¸­ä¸èƒ½æœ‰æ›´æ–°. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("è¿™ä¸ª DDL ä¸æ˜¯ Online çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œåœ¨ **MySQL 5.6 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ Online DDL, å¯¹è¿™ä¸ªæ“ä½œæµç¨‹åšäº†ä¼˜åŒ–. ** ç®€å•æè¿°ä¸€ä¸‹å¼•å…¥äº† Online DDL ä¹‹åŽ, é‡å»ºè¡¨çš„æµç¨‹:")]),s._v(" "),t("ol",[t("li",[s._v("å»ºç«‹ä¸€ä¸ª"),t("strong",[s._v("ä¸´æ—¶æ–‡ä»¶")]),s._v(", æ‰«æè¡¨ A ä¸»é”®çš„æ‰€æœ‰æ•°æ®é¡µ;")]),s._v(" "),t("li",[s._v("ç”¨æ•°æ®é¡µä¸­è¡¨ A çš„è®°å½•ç”Ÿæˆ B+ æ ‘, "),t("strong",[s._v("å­˜å‚¨åˆ°ä¸´æ—¶æ–‡ä»¶")]),s._v("ä¸­;")]),s._v(" "),t("li",[s._v("ç”Ÿæˆä¸´æ—¶æ–‡ä»¶çš„è¿‡ç¨‹ä¸­, å°†æ‰€æœ‰å¯¹ A çš„"),t("strong",[s._v("æ“ä½œè®°å½•åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶(row log)ä¸­")]),s._v(", å¯¹åº”çš„æ˜¯å›¾ä¸­ state2 çš„çŠ¶æ€;")]),s._v(" "),t("li",[s._v("ä¸´æ—¶æ–‡ä»¶ç”ŸæˆåŽ, "),t("strong",[s._v("å°†æ—¥å¿—æ–‡ä»¶ä¸­çš„æ›´æ–°æ“ä½œåº”ç”¨åˆ°ä¸´æ—¶æ–‡ä»¶, å¾—åˆ°ä¸€ä¸ªé€»è¾‘æ•°æ®ä¸Šä¸Žè¡¨ A ç›¸åŒçš„æ•°æ®æ–‡ä»¶")]),s._v(", å¯¹åº”çš„å°±æ˜¯å›¾ä¸­ state3 çš„çŠ¶æ€;")]),s._v(" "),t("li",[s._v("ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢è¡¨ A çš„æ•°æ®æ–‡ä»¶.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/221b4457da204e2f1fffe182225c4b44-20230731161914-ug25wmv.png",alt:"",title:"Online DDL"}})]),s._v(" "),t("p",[t("strong",[s._v("å¯ä»¥çœ‹åˆ°, ç”±äºŽæ—¥å¿—æ–‡ä»¶è®°å½•å’Œé‡æ”¾æ“ä½œè¿™ä¸ªåŠŸèƒ½çš„å­˜åœ¨, è¿™ä¸ªæ–¹æ¡ˆåœ¨é‡å»ºè¡¨çš„è¿‡ç¨‹ä¸­, å…è®¸å¯¹è¡¨ A åšå¢žåˆ æ”¹æ“ä½œ. è¿™ä¹Ÿå°±æ˜¯ Online DDL åå­—çš„æ¥æº.")])]),s._v(" "),t("p",[s._v("DDL ä¹‹å‰æ˜¯è¦æ‹¿ MDL å†™é”çš„, è¿™æ ·è¿˜èƒ½å« Online DDL å—? ç¡®å®ž, ä¸Šå›¾çš„æµç¨‹ä¸­, alter è¯­å¥åœ¨å¯åŠ¨çš„æ—¶å€™éœ€è¦èŽ·å– MDL å†™é”, "),t("strong",[s._v("ä½†æ˜¯è¿™ä¸ªå†™é”åœ¨çœŸæ­£æ‹·è´æ•°æ®ä¹‹å‰å°±é€€åŒ–æˆè¯»é”")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆè¦é€€åŒ–å‘¢? ä¸ºäº†å®žçŽ° Online, MDL è¯»é”ä¸ä¼šé˜»å¡žå¢žåˆ æ”¹æ“ä½œ. é‚£ä¸ºä»€ä¹ˆä¸å¹²è„†ç›´æŽ¥è§£é”å‘¢? ä¸ºäº†ä¿æŠ¤è‡ªå·±, ç¦æ­¢å…¶ä»–çº¿ç¨‹å¯¹è¿™ä¸ªè¡¨åŒæ—¶åš DDL.")]),s._v(" "),t("p",[s._v("è€Œå¯¹äºŽä¸€ä¸ªå¤§è¡¨æ¥è¯´, Online DDL "),t("strong",[s._v("æœ€è€—æ—¶çš„è¿‡ç¨‹å°±æ˜¯æ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨çš„è¿‡ç¨‹")]),s._v(", è¿™ä¸ªæ­¥éª¤çš„æ‰§è¡ŒæœŸé—´å¯ä»¥æŽ¥å—å¢žåˆ æ”¹æ“ä½œ. æ‰€ä»¥ç›¸å¯¹äºŽæ•´ä¸ª DDL è¿‡ç¨‹æ¥è¯´, é”çš„æ—¶é—´éžå¸¸çŸ­. å¯¹ä¸šåŠ¡æ¥è¯´, å°±å¯ä»¥è®¤ä¸ºæ˜¯ Online çš„.")]),s._v(" "),t("p",[s._v("éœ€è¦è¡¥å……è¯´æ˜Žçš„æ˜¯, ä¸Šè¿°çš„è¿™äº›é‡å»ºæ–¹æ³•"),t("strong",[s._v("éƒ½ä¼šæ‰«æåŽŸè¡¨æ•°æ®å’Œæž„å»ºä¸´æ—¶æ–‡ä»¶")]),s._v(". å¯¹äºŽå¾ˆå¤§çš„è¡¨æ¥è¯´, è¿™ä¸ªæ“ä½œæ˜¯å¾ˆæ¶ˆè€— IO å’Œ CPU èµ„æºçš„. å› æ­¤å¦‚æžœæ˜¯çº¿ä¸ŠæœåŠ¡, è¦å¾ˆå°å¿ƒåœ°æŽ§åˆ¶æ“ä½œæ—¶é—´. å¦‚æžœæƒ³è¦æ¯”è¾ƒå®‰å…¨çš„æ“ä½œçš„è¯, æŽ¨èä½¿ç”¨ GitHub å¼€æºçš„ gh-ost æ¥åš.")]),s._v(" "),t("h5",{attrs:{id:"onlineå’Œinplace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#onlineå’Œinplace"}},[s._v("#")]),s._v(" Onlineå’Œinplace")]),s._v(" "),t("p",[s._v("è¯´åˆ° Online, è¿˜è¦å†æ¾„æ¸…ä¸€ä¸‹å®ƒå’Œå¦ä¸€ä¸ªè·Ÿ DDL æœ‰å…³çš„, å®¹æ˜“æ··æ·†çš„æ¦‚å¿µ "),t("strong",[s._v("inplace")]),s._v(" çš„åŒºåˆ«.")]),s._v(" "),t("p",[s._v('ä½ å¯èƒ½æ³¨æ„åˆ°äº†, åœ¨ "æ”¹é”è¡¨DDL" å›¾ä¸­æŠŠè¡¨ A ä¸­çš„æ•°æ®å¯¼å‡ºæ¥çš„å­˜æ”¾ä½ç½®å«ä½œ '),t("strong",[s._v("tmp_table")]),s._v(". è¿™æ˜¯ä¸€ä¸ª"),t("strong",[s._v("ä¸´æ—¶è¡¨")]),s._v(', æ˜¯åœ¨ server å±‚åˆ›å»ºçš„. åœ¨å›¾ "Online DDL" ä¸­, æ ¹æ®è¡¨ A é‡å»ºå‡ºæ¥çš„æ•°æ®æ˜¯æ”¾åœ¨ "'),t("strong",[s._v("tmp_file")]),s._v('" é‡Œçš„, è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ˜¯ InnoDB åœ¨å†…éƒ¨åˆ›å»ºå‡ºæ¥çš„. '),t("strong",[s._v("æ•´ä¸ª DDL è¿‡ç¨‹éƒ½åœ¨ InnoDB å†…éƒ¨å®Œæˆ")]),s._v('. å¯¹äºŽ server å±‚æ¥è¯´, æ²¡æœ‰æŠŠæ•°æ®æŒªåŠ¨åˆ°ä¸´æ—¶è¡¨, æ˜¯ä¸€ä¸ª"åŽŸåœ°"æ“ä½œ, è¿™å°±æ˜¯ "inplace" åç§°çš„æ¥æº.')]),s._v(" "),t("p",[s._v("æ‰€ä»¥, æˆ‘çŽ°åœ¨é—®ä½ , å¦‚æžœæœ‰ä¸€ä¸ª 1TB çš„è¡¨, çŽ°åœ¨ç£ç›˜é—´æ˜¯ 1.2TB, èƒ½ä¸èƒ½åšä¸€ä¸ª inplace çš„ DDL å‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("ç­”æ¡ˆæ˜¯ä¸èƒ½")]),s._v(". å› ä¸º tmp_file ä¹Ÿæ˜¯è¦å ç”¨ä¸´æ—¶ç©ºé—´çš„.")]),s._v(" "),t("p",[s._v("é‡å»ºè¡¨çš„è¿™ä¸ªè¯­å¥ "),t("code",[s._v("alter table t engine=InnoDB")]),s._v("â€‹, å…¶å®žéšå«çš„æ„æ€æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALGORITHM")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("inplace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è·Ÿ inplace å¯¹åº”çš„å°±æ˜¯æ‹·è´è¡¨çš„æ–¹å¼äº†, ç”¨æ³•æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALGORITHM")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å½“ä½¿ç”¨ ALGORITHM=copy çš„æ—¶å€™, è¡¨ç¤ºçš„æ˜¯"),t("strong",[s._v("å¼ºåˆ¶æ‹·è´è¡¨")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æˆ‘è¿™æ ·è¯´ä½ å¯èƒ½ä¼šè§‰å¾—, inplace è·Ÿ Online æ˜¯ä¸æ˜¯å°±æ˜¯ä¸€ä¸ªæ„æ€? å…¶å®žä¸æ˜¯çš„, åªæ˜¯åœ¨é‡å»ºè¡¨è¿™ä¸ªé€»è¾‘ä¸­åˆšå¥½æ˜¯è¿™æ ·è€Œå·².")]),s._v(" "),t("p",[s._v("æ¯”å¦‚, å¦‚æžœè¦ç»™ InnoDB è¡¨çš„"),t("strong",[s._v("ä¸€ä¸ªå­—æ®µåŠ å…¨æ–‡ç´¢å¼•")]),s._v(", å†™æ³•æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" FULLTEXT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("field_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("è¿™ä¸ªè¿‡ç¨‹æ˜¯ inplace çš„, ä½†ä¼šé˜»å¡žå¢žåˆ æ”¹æ“ä½œ, æ˜¯éž Online çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æžœè¯´è¿™ä¸¤ä¸ªé€»è¾‘ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆçš„è¯, å¯ä»¥æ¦‚æ‹¬ä¸º:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("DDL è¿‡ç¨‹å¦‚æžœæ˜¯ Online çš„, å°±ä¸€å®šæ˜¯ inplace çš„;")])]),s._v(" "),t("li",[s._v("åè¿‡æ¥æœªå¿…, ä¹Ÿå°±æ˜¯è¯´ inplace çš„ DDL, æœ‰å¯èƒ½ä¸æ˜¯ Online çš„. æˆªæ­¢åˆ° MySQL 8.0, æ·»åŠ å…¨æ–‡ç´¢å¼•(FULLTEXT index)å’Œç©ºé—´ç´¢å¼• (SPATIAL index) å°±å±žäºŽè¿™ç§æƒ…å†µ.")])]),s._v(" "),t("p",[s._v("æœ€åŽå†å»¶ä¼¸ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("æœ‰åŒå­¦é—®åˆ°ä½¿ç”¨ "),t("strong",[s._v("optimize table, analyze table å’Œ alter table è¿™ä¸‰ç§æ–¹å¼é‡å»ºè¡¨çš„åŒºåˆ«")]),s._v(". è¿™é‡Œé¡ºä¾¿å†ç®€å•è§£é‡Šä¸€ä¸‹.")]),s._v(" "),t("ul",[t("li",[s._v("ä»Ž MySQL 5.6 ç‰ˆæœ¬å¼€å§‹, "),t("code",[s._v("alter table t engine = InnoDB")]),s._v('â€‹(ä¹Ÿå°±æ˜¯ recreate)é»˜è®¤çš„å°±æ˜¯ä¸Šé¢å›¾ "Online DDL" çš„æµç¨‹äº†;')]),s._v(" "),t("li",[t("strong",[s._v("analyze table t å…¶å®žä¸æ˜¯é‡å»ºè¡¨, åªæ˜¯å¯¹è¡¨çš„ç´¢å¼•ä¿¡æ¯åšé‡æ–°ç»Ÿè®¡, æ²¡æœ‰ä¿®æ”¹æ•°æ®, è¿™ä¸ªè¿‡ç¨‹ä¸­åŠ äº† MDL è¯»é”;")])]),s._v(" "),t("li",[t("strong",[s._v("optimize table t ç­‰äºŽ recreate+analyze.")])])]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-13"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-13"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚è®¨è®ºäº†"),t("strong",[s._v("æ•°æ®åº“ä¸­æ”¶ç¼©è¡¨ç©ºé—´")]),s._v("çš„æ–¹æ³•. å¦‚æžœè¦æ”¶ç¼©ä¸€ä¸ªè¡¨, åªæ˜¯ delete æŽ‰è¡¨é‡Œé¢ä¸ç”¨çš„æ•°æ®çš„è¯, è¡¨æ–‡ä»¶çš„å¤§å°æ˜¯ä¸ä¼šå˜çš„, è¿˜è¦"),t("strong",[s._v("é€šè¿‡ alter table å‘½ä»¤é‡å»ºè¡¨, æ‰èƒ½è¾¾åˆ°è¡¨æ–‡ä»¶å˜å°çš„ç›®çš„")]),s._v(". æœ¬èŠ‚ä»‹ç»äº†é‡å»ºè¡¨çš„ä¸¤ç§å®žçŽ°æ–¹å¼, "),t("strong",[s._v("Online DDL çš„æ–¹å¼æ˜¯å¯ä»¥è€ƒè™‘åœ¨ä¸šåŠ¡ä½Žå³°æœŸä½¿ç”¨çš„")]),s._v(", è€Œ MySQL 5.5 åŠä¹‹å‰çš„ç‰ˆæœ¬, è¿™ä¸ªå‘½ä»¤æ˜¯ä¼šé˜»å¡ž DML çš„, è¿™ä¸ªéœ€è¦ç‰¹åˆ«å°å¿ƒ.")]),s._v(" "),t("h4",{attrs:{id:"_14-count-éžå¸¸æ…¢è¯¥æ€Žä¹ˆåŠž"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14-count-éžå¸¸æ…¢è¯¥æ€Žä¹ˆåŠž"}},[s._v("#")]),s._v(" 14-count(*)éžå¸¸æ…¢è¯¥æ€Žä¹ˆåŠž?")]),s._v(" "),t("p",[s._v("åœ¨å¼€å‘ç³»ç»Ÿçš„æ—¶å€™, å¯èƒ½ç»å¸¸éœ€è¦è®¡ç®—ä¸€ä¸ªè¡¨çš„è¡Œæ•°, æ¯”å¦‚ä¸€ä¸ªäº¤æ˜“ç³»ç»Ÿçš„æ‰€æœ‰å˜æ›´è®°å½•æ€»æ•°. è¿™æ—¶å€™ä½ å¯èƒ½ä¼šæƒ³, ä¸€æ¡ "),t("code",[s._v("select count(*) from t")]),s._v("â€‹ è¯­å¥ä¸å°±è§£å†³äº†å—?")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, ä½ ä¼šå‘çŽ°éšç€ç³»ç»Ÿä¸­è®°å½•æ•°è¶Šæ¥è¶Šå¤š, è¿™æ¡è¯­å¥æ‰§è¡Œå¾—ä¹Ÿä¼šè¶Šæ¥è¶Šæ…¢. ç„¶åŽä½ å¯èƒ½å°±æƒ³äº†, MySQL æ€Žä¹ˆè¿™ä¹ˆç¬¨å•Š, è®°ä¸ªæ€»æ•°, æ¯æ¬¡è¦æŸ¥çš„æ—¶å€™ç›´æŽ¥è¯»å‡ºæ¥, ä¸å°±å¥½äº†.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å°±æ¥èŠèŠ count(*) è¯­å¥åˆ°åº•æ˜¯æ€Žæ ·å®žçŽ°çš„, ä»¥åŠ MySQL ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆå®žçŽ°. ç„¶åŽå†è¯´è¯´, å¦‚æžœåº”ç”¨ä¸­æœ‰è¿™ç§é¢‘ç¹å˜æ›´å¹¶éœ€è¦ç»Ÿè®¡è¡¨è¡Œæ•°çš„éœ€æ±‚, ä¸šåŠ¡è®¾è®¡ä¸Šå¯ä»¥æ€Žä¹ˆåš.")]),s._v(" "),t("h5",{attrs:{id:"count-çš„å®žçŽ°æ–¹å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#count-çš„å®žçŽ°æ–¹å¼"}},[s._v("#")]),s._v(" count(*)çš„å®žçŽ°æ–¹å¼")]),s._v(" "),t("p",[s._v("é¦–å…ˆè¦æ˜Žç¡®çš„æ˜¯, "),t("strong",[s._v("åœ¨ä¸åŒçš„ MySQL å¼•æ“Žä¸­, count(*) æœ‰ä¸åŒçš„å®žçŽ°æ–¹å¼")]),s._v(".")]),s._v(" "),t("ul",[t("li",[s._v("MyISAM å¼•æ“ŽæŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Š, å› æ­¤æ‰§è¡Œ count(*) çš„æ—¶å€™ä¼šç›´æŽ¥è¿”å›žè¿™ä¸ªæ•°, æ•ˆçŽ‡å¾ˆé«˜;")]),s._v(" "),t("li",[t("strong",[s._v("è€Œ InnoDB å¼•æ“Žå°±éº»çƒ¦äº†, å®ƒæ‰§è¡Œ count(*) çš„æ—¶å€™, éœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»Žå¼•æ“Žé‡Œé¢è¯»å‡ºæ¥, ç„¶åŽç´¯ç§¯è®¡æ•°")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, æœ¬èŠ‚"),t("strong",[s._v("è®¨è®ºçš„æ˜¯æ²¡æœ‰è¿‡æ»¤æ¡ä»¶çš„ count(*)")]),s._v(" , å¦‚æžœåŠ äº† where æ¡ä»¶çš„è¯, MyISAM è¡¨ä¹Ÿæ˜¯ä¸èƒ½è¿”å›žå¾—è¿™ä¹ˆå¿«çš„.")]),s._v(" "),t("p",[s._v("åœ¨å‰é¢ä¸€èµ·åˆ†æžäº†ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ InnoDB, å› ä¸ºä¸è®ºæ˜¯åœ¨äº‹åŠ¡æ”¯æŒ, å¹¶å‘èƒ½åŠ›è¿˜æ˜¯åœ¨æ•°æ®å®‰å…¨æ–¹é¢, InnoDB éƒ½ä¼˜äºŽ MyISAM. æˆ‘çŒœä½ çš„è¡¨ä¹Ÿä¸€å®šæ˜¯ç”¨äº† InnoDB å¼•æ“Ž. è¿™å°±æ˜¯å½“ä½ çš„è®°å½•æ•°è¶Šæ¥è¶Šå¤šçš„æ—¶å€™, è®¡ç®—ä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°ä¼šè¶Šæ¥è¶Šæ…¢çš„åŽŸå› .")]),s._v(" "),t("p",[s._v("é‚£**ä¸ºä»€ä¹ˆ InnoDB ä¸è·Ÿ MyISAM ä¸€æ ·, ä¹ŸæŠŠæ•°å­—å­˜èµ·æ¥å‘¢? **")]),s._v(" "),t("p",[t("strong",[s._v('è¿™æ˜¯å› ä¸ºå³ä½¿æ˜¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»çš„å¤šä¸ªæŸ¥è¯¢, ç”±äºŽå¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶(MVCC)çš„åŽŸå› , InnoDB è¡¨"åº”è¯¥è¿”å›žå¤šå°‘è¡Œ"ä¹Ÿæ˜¯ä¸ç¡®å®šçš„')]),s._v(". è¿™é‡Œç”¨ä¸€ä¸ªç®— count(*) çš„ä¾‹å­æ¥è§£é‡Šä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("å‡è®¾è¡¨ t ä¸­çŽ°åœ¨æœ‰ 10000 æ¡è®°å½•, è¿™é‡Œè®¾è®¡äº†ä¸‰ä¸ªç”¨æˆ·å¹¶è¡Œçš„ä¼šè¯.")]),s._v(" "),t("ul",[t("li",[s._v("ä¼šè¯ A å…ˆå¯åŠ¨äº‹åŠ¡å¹¶æŸ¥è¯¢ä¸€æ¬¡è¡¨çš„æ€»è¡Œæ•°;")]),s._v(" "),t("li",[s._v("ä¼šè¯ B å¯åŠ¨äº‹åŠ¡, æ’å…¥ä¸€è¡ŒåŽè®°å½•åŽ, æŸ¥è¯¢è¡¨çš„æ€»è¡Œæ•°;")]),s._v(" "),t("li",[s._v("ä¼šè¯ C å…ˆå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„è¯­å¥, æ’å…¥ä¸€è¡Œè®°å½•åŽ, æŸ¥è¯¢è¡¨çš„æ€»è¡Œæ•°.")])]),s._v(" "),t("p",[s._v("å‡è®¾ä»Žä¸Šåˆ°ä¸‹æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œçš„, åŒä¸€è¡Œè¯­å¥æ˜¯åœ¨åŒä¸€æ—¶åˆ»æ‰§è¡Œçš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1d0eca49f8c5390c913662fc7a6d74a3-20230731161914-54dedyq.png",alt:"",title:"ä¼šè¯ A, B, C çš„æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("ä½ ä¼šçœ‹åˆ°, åœ¨æœ€åŽä¸€ä¸ªæ—¶åˆ», "),t("strong",[s._v("ä¸‰ä¸ªä¼šè¯ A, B, C ä¼šåŒæ—¶æŸ¥è¯¢è¡¨ t çš„æ€»è¡Œæ•°, ä½†æ‹¿åˆ°çš„ç»“æžœå´ä¸åŒ")]),s._v(".")]),s._v(" "),t("p",[s._v('è¿™å’Œ InnoDB çš„äº‹åŠ¡è®¾è®¡æœ‰å…³ç³», å¯é‡å¤è¯»æ˜¯å®ƒé»˜è®¤çš„éš”ç¦»çº§åˆ«, åœ¨ä»£ç ä¸Šå°±æ˜¯é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶, ä¹Ÿå°±æ˜¯ MVCC æ¥å®žçŽ°çš„. æ¯ä¸€è¡Œè®°å½•éƒ½è¦åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯¹è¿™ä¸ªä¼šè¯å¯è§, å› æ­¤å¯¹äºŽ count(*) è¯·æ±‚æ¥è¯´, InnoDB åªå¥½æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°è¯»å‡ºä¾æ¬¡åˆ¤æ–­, å¯è§çš„è¡Œæ‰èƒ½å¤Ÿç”¨äºŽè®¡ç®— "'),t("strong",[s._v("åŸºäºŽè¿™ä¸ªæŸ¥è¯¢")]),s._v('" çš„è¡¨çš„æ€»è¡Œæ•°.')]),s._v(" "),t("p",[s._v("å½“ç„¶, çŽ°åœ¨è¿™ä¸ªçœ‹ä¸ŠåŽ»ç¬¨ç¬¨çš„ MySQL, åœ¨æ‰§è¡Œ count(*) æ“ä½œçš„æ—¶å€™è¿˜æ˜¯åšäº†ä¼˜åŒ–çš„.")]),s._v(" "),t("p",[s._v("InnoDB æ˜¯ç´¢å¼•ç»„ç»‡è¡¨, ä¸»é”®ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯"),t("strong",[s._v("æ•°æ®")]),s._v(", è€Œæ™®é€šç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯"),t("strong",[s._v("ä¸»é”®å€¼")]),s._v(". æ‰€ä»¥æ™®é€šç´¢å¼•æ ‘æ¯”ä¸»é”®ç´¢å¼•æ ‘å°å¾ˆå¤š. å¯¹äºŽ count(*) è¿™æ ·çš„æ“ä½œ, éåŽ†å“ªä¸ªç´¢å¼•æ ‘å¾—åˆ°çš„ç»“æžœé€»è¾‘ä¸Šéƒ½æ˜¯ä¸€æ ·çš„. **å› æ­¤ MySQL ä¼˜åŒ–å™¨ä¼šæ‰¾åˆ°æœ€å°çš„é‚£æ£µæ ‘æ¥éåŽ†. åœ¨ä¿è¯é€»è¾‘æ­£ç¡®çš„å‰æä¸‹, å°½é‡å‡å°‘æ‰«æçš„æ•°æ®é‡, æ˜¯æ•°æ®åº“ç³»ç»Ÿè®¾è®¡çš„é€šç”¨æ³•åˆ™ä¹‹ä¸€. **")]),s._v(" "),t("p",[s._v("å¦‚æžœä½ ç”¨è¿‡ "),t("code",[s._v("show table status")]),s._v("â€‹ å‘½ä»¤çš„è¯, å°±ä¼šå‘çŽ°è¿™ä¸ªå‘½ä»¤çš„è¾“å‡ºç»“æžœé‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª TABLE_ROWS ç”¨äºŽæ˜¾ç¤ºè¿™ä¸ªè¡¨å½“å‰æœ‰å¤šå°‘è¡Œ, è¿™ä¸ªå‘½ä»¤æ‰§è¡ŒæŒºå¿«çš„, é‚£è¿™ä¸ª TABLE_ROWS èƒ½ä»£æ›¿ count(*) å—?")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°è¿‡, "),t("strong",[s._v("ç´¢å¼•ç»Ÿè®¡çš„å€¼æ˜¯é€šè¿‡é‡‡æ ·æ¥ä¼°ç®—")]),s._v("çš„. å®žé™…ä¸Š, TABLE_ROWS å°±æ˜¯ä»Žè¿™ä¸ªé‡‡æ ·ä¼°ç®—å¾—æ¥çš„, å› æ­¤å®ƒä¹Ÿå¾ˆä¸å‡†. æœ‰å¤šä¸å‡†å‘¢, å®˜æ–¹æ–‡æ¡£è¯´è¯¯å·®å¯èƒ½è¾¾åˆ° 40% åˆ° 50%. **æ‰€ä»¥ show table status å‘½ä»¤æ˜¾ç¤ºçš„è¡Œæ•°ä¹Ÿä¸èƒ½ç›´æŽ¥ä½¿ç”¨. **")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œå°ç»“ä¸€ä¸‹:")]),s._v(" "),t("ul",[t("li",[s._v("MyISAM è¡¨è™½ç„¶ count(*) å¾ˆå¿«, ä½†æ˜¯ä¸æ”¯æŒäº‹åŠ¡;")]),s._v(" "),t("li",[s._v("show table status å‘½ä»¤è™½ç„¶è¿”å›žå¾ˆå¿«, ä½†æ˜¯ä¸å‡†ç¡®;")]),s._v(" "),t("li",[t("strong",[s._v("InnoDB è¡¨ç›´æŽ¥ count(*) ä¼šéåŽ†å…¨è¡¨, è™½ç„¶ç»“æžœå‡†ç¡®, ä½†ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜.")])])]),s._v(" "),t("p",[s._v("å›žåˆ°å¼€å¤´çš„é—®é¢˜, å¦‚æžœçŽ°åœ¨æœ‰ä¸€ä¸ªé¡µé¢ç»å¸¸è¦æ˜¾ç¤ºäº¤æ˜“ç³»ç»Ÿçš„æ“ä½œè®°å½•æ€»æ•°, åˆ°åº•åº”è¯¥æ€Žä¹ˆåŠžå‘¢? ç­”æ¡ˆæ˜¯"),t("mark",[t("strong",[s._v("åªèƒ½è‡ªå·±è®¡æ•°")])]),s._v(". æŽ¥ä¸‹æ¥çœ‹çœ‹è‡ªå·±è®¡æ•°æœ‰å“ªäº›æ–¹æ³•, ä»¥åŠæ¯ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹æœ‰å“ªäº›. è¿™é‡Œè¯´ä¸€ä¸‹è¿™äº›æ–¹æ³•çš„åŸºæœ¬æ€è·¯: "),t("strong",[s._v("ä½ éœ€è¦è‡ªå·±æ‰¾ä¸€ä¸ªåœ°æ–¹, æŠŠæ“ä½œè®°å½•è¡¨çš„è¡Œæ•°å­˜èµ·æ¥")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ç”¨ç¼“å­˜ç³»ç»Ÿä¿å­˜è®¡æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨ç¼“å­˜ç³»ç»Ÿä¿å­˜è®¡æ•°"}},[s._v("#")]),s._v(" ç”¨ç¼“å­˜ç³»ç»Ÿä¿å­˜è®¡æ•°")]),s._v(" "),t("p",[s._v("å¯¹äºŽæ›´æ–°å¾ˆé¢‘ç¹çš„åº“æ¥è¯´, ä½ å¯èƒ½ä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°, ç”¨ç¼“å­˜ç³»ç»Ÿæ¥æ”¯æŒ.")]),s._v(" "),t("p",[s._v("å¯ä»¥ç”¨ä¸€ä¸ª Redis æœåŠ¡æ¥ä¿å­˜è¿™ä¸ªè¡¨çš„æ€»è¡Œæ•°. è¿™ä¸ªè¡¨æ¯è¢«æ’å…¥ä¸€è¡Œ Redis è®¡æ•°å°±åŠ  1, æ¯è¢«åˆ é™¤ä¸€è¡Œ Redis è®¡æ•°å°±å‡ 1. è¿™ç§æ–¹å¼ä¸‹, è¯»å’Œæ›´æ–°æ“ä½œéƒ½å¾ˆå¿«, ä½†ä½ å†æƒ³ä¸€ä¸‹è¿™ç§æ–¹å¼å­˜åœ¨ä»€ä¹ˆé—®é¢˜å—?")]),s._v(" "),t("p",[t("strong",[s._v("æ²¡é”™, ç¼“å­˜ç³»ç»Ÿå¯èƒ½ä¼šä¸¢å¤±æ›´æ–°")]),s._v(".")]),s._v(" "),t("p",[s._v("Redis çš„æ•°æ®ä¸èƒ½æ°¸ä¹…åœ°ç•™åœ¨å†…å­˜é‡Œ, æ‰€ä»¥ä½ ä¼šæ‰¾ä¸€ä¸ªåœ°æ–¹æŠŠè¿™ä¸ªå€¼å®šæœŸåœ°æŒä¹…åŒ–å­˜å‚¨èµ·æ¥. ä½†å³ä½¿è¿™æ ·, ä»ç„¶å¯èƒ½ä¸¢å¤±æ›´æ–°. è¯•æƒ³å¦‚æžœåˆšåˆšåœ¨æ•°æ®è¡¨ä¸­æ’å…¥äº†ä¸€è¡Œ, Redis ä¸­ä¿å­˜çš„å€¼ä¹ŸåŠ äº† 1, ç„¶åŽ Redis å¼‚å¸¸é‡å¯äº†, é‡å¯åŽä½ è¦ä»Žå­˜å‚¨ redis æ•°æ®çš„åœ°æ–¹æŠŠè¿™ä¸ªå€¼è¯»å›žæ¥, è€ŒåˆšåˆšåŠ  1 çš„è¿™ä¸ªè®¡æ•°æ“ä½œå´ä¸¢å¤±äº†. å½“ç„¶è¿™è¿˜æ˜¯æœ‰è§£çš„. æ¯”å¦‚, Redis å¼‚å¸¸é‡å¯ä»¥åŽ, åˆ°æ•°æ®åº“é‡Œé¢å•ç‹¬æ‰§è¡Œä¸€æ¬¡ count(*) èŽ·å–çœŸå®žçš„è¡Œæ•°, å†æŠŠè¿™ä¸ªå€¼å†™å›žåˆ° Redis é‡Œå°±å¯ä»¥äº†. å¼‚å¸¸é‡å¯æ¯•ç«Ÿä¸æ˜¯ç»å¸¸å‡ºçŽ°çš„æƒ…å†µ, è¿™ä¸€æ¬¡å…¨è¡¨æ‰«æçš„æˆæœ¬, è¿˜æ˜¯å¯ä»¥æŽ¥å—çš„.")]),s._v(" "),t("p",[s._v("ä½†å®žé™…ä¸Š, **å°†è®¡æ•°ä¿å­˜åœ¨ç¼“å­˜ç³»ç»Ÿä¸­çš„æ–¹å¼, è¿˜ä¸åªæ˜¯ä¸¢å¤±æ›´æ–°çš„é—®é¢˜. å³ä½¿ Redis æ­£å¸¸å·¥ä½œ, è¿™ä¸ªå€¼è¿˜æ˜¯é€»è¾‘ä¸Šä¸ç²¾ç¡®çš„. **")]),s._v(" "),t("p",[s._v("å¯ä»¥è®¾æƒ³ä¸€ä¸‹æœ‰è¿™ä¹ˆä¸€ä¸ªé¡µé¢, è¦æ˜¾ç¤ºæ“ä½œè®°å½•çš„æ€»æ•°, åŒæ—¶è¿˜è¦æ˜¾ç¤ºæœ€è¿‘æ“ä½œçš„ 100 æ¡è®°å½•. é‚£ä¹ˆè¿™ä¸ªé¡µé¢çš„é€»è¾‘å°±éœ€è¦å…ˆåˆ° Redis é‡Œé¢å–å‡ºè®¡æ•°, å†åˆ°æ•°æ®è¡¨é‡Œé¢å–æ•°æ®è®°å½•.")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬æ˜¯è¿™ä¹ˆå®šä¹‰ä¸ç²¾ç¡®çš„:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸€ç§æ˜¯, "),t("strong",[s._v("æŸ¥åˆ°çš„ 100 è¡Œç»“æžœé‡Œé¢æœ‰æœ€æ–°æ’å…¥è®°å½•, è€Œ Redis çš„è®¡æ•°é‡Œè¿˜æ²¡åŠ  1")]),s._v(";")]),s._v(" "),t("li",[s._v("å¦ä¸€ç§æ˜¯, "),t("strong",[s._v("æŸ¥åˆ°çš„ 100 è¡Œç»“æžœé‡Œæ²¡æœ‰æœ€æ–°æ’å…¥çš„è®°å½•, è€Œ Redis çš„è®¡æ•°é‡Œå·²ç»åŠ äº† 1")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™ä¸¤ç§æƒ…å†µ, éƒ½æ˜¯é€»è¾‘ä¸ä¸€è‡´çš„.")]),s._v(" "),t("p",[s._v("ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªæ—¶åºå›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a12dfc47777cd24099bbe6e6da30c873-20230731161914-mdr9xdx.png",alt:"",title:"ä¼šè¯ A, B æ‰§è¡Œæ—¶åºå›¾"}})]),s._v(" "),t("p",[s._v("ä¸Šå›¾ä¸­ä¼šè¯ A æ˜¯ä¸€ä¸ªæ’å…¥äº¤æ˜“è®°å½•çš„é€»è¾‘, å¾€æ•°æ®è¡¨é‡Œæ’å…¥ä¸€è¡Œ R, ç„¶åŽ Redis è®¡æ•°åŠ  1; ä¼šè¯ B å°±æ˜¯æŸ¥è¯¢é¡µé¢æ˜¾ç¤ºæ—¶éœ€è¦çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªæ—¶åºé‡Œ, åœ¨ T3 æ—¶åˆ»ä¼šè¯ B æ¥æŸ¥è¯¢çš„æ—¶å€™, ä¼šæ˜¾ç¤ºå‡ºæ–°æ’å…¥çš„ R è¿™ä¸ªè®°å½•, ä½†æ˜¯ Redis çš„è®¡æ•°è¿˜æ²¡åŠ  1. è¿™æ—¶å€™, å°±ä¼šå‡ºçŽ°æ•°æ®ä¸ä¸€è‡´.")]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šä¼šè¯´, è¿™æ˜¯å› ä¸ºæ‰§è¡Œæ–°å¢žè®°å½•é€»è¾‘æ—¶å€™, æ˜¯å…ˆå†™æ•°æ®è¡¨, å†æ”¹ Redis è®¡æ•°. è€Œè¯»çš„æ—¶å€™æ˜¯å…ˆè¯» Redis, å†è¯»æ•°æ®è¡¨, è¿™ä¸ªé¡ºåºæ˜¯ç›¸åçš„. é‚£å¦‚æžœä¿æŒé¡ºåºä¸€æ ·çš„è¯, æ˜¯ä¸æ˜¯å°±æ²¡é—®é¢˜äº†? çŽ°åœ¨æŠŠä¼šè¯ A çš„æ›´æ–°é¡ºåºæ¢ä¸€ä¸‹, å†çœ‹çœ‹æ‰§è¡Œç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/db42d294e7905d72521a9c186dca81be-20230731161914-ggjmut7.png",alt:"",title:"è°ƒæ•´é¡ºåºåŽ, ä¼šè¯ A, B çš„æ‰§è¡Œæ—¶åºå›¾"}})]),s._v(" "),t("p",[s._v("ä½ ä¼šå‘çŽ°, è¿™æ—¶å€™åè¿‡æ¥äº†, ä¼šè¯ B åœ¨ T3 æ—¶åˆ»æŸ¥è¯¢çš„æ—¶å€™, Redis è®¡æ•°åŠ äº† 1 äº†, "),t("strong",[s._v("ä½†è¿˜æŸ¥ä¸åˆ°æ–°æ’å…¥çš„ R è¿™ä¸€è¡Œ, ä¹Ÿæ˜¯æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("åœ¨å¹¶å‘ç³»ç»Ÿé‡Œé¢, æ˜¯æ— æ³•ç²¾ç¡®æŽ§åˆ¶ä¸åŒçº¿ç¨‹çš„æ‰§è¡Œæ—¶åˆ»çš„, å› ä¸ºå­˜åœ¨å›¾ä¸­çš„è¿™ç§æ“ä½œåºåˆ—, æ‰€ä»¥å³ä½¿ Redis æ­£å¸¸å·¥ä½œ, è¿™ä¸ªè®¡æ•°å€¼è¿˜æ˜¯é€»è¾‘ä¸Šä¸ç²¾ç¡®çš„.")])]),s._v(" "),t("h5",{attrs:{id:"åœ¨æ•°æ®åº“ä¿å­˜è®¡æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨æ•°æ®åº“ä¿å­˜è®¡æ•°"}},[s._v("#")]),s._v(" åœ¨æ•°æ®åº“ä¿å­˜è®¡æ•°")]),s._v(" "),t("p",[s._v("æ ¹æ®ä¸Šé¢çš„åˆ†æž, ç”¨ç¼“å­˜ç³»ç»Ÿä¿å­˜è®¡æ•°æœ‰ä¸¢å¤±æ•°æ®å’Œè®¡æ•°ä¸ç²¾ç¡®çš„é—®é¢˜. é‚£ä¹ˆ**å¦‚æžœæŠŠè¿™ä¸ªè®¡æ•°ç›´æŽ¥æ”¾åˆ°æ•°æ®åº“é‡Œå•ç‹¬çš„ä¸€å¼ è®¡æ•°è¡¨ C ä¸­, åˆä¼šæ€Žä¹ˆæ ·å‘¢? **")]),s._v(" "),t("p",[s._v("é¦–å…ˆ, è¿™è§£å†³äº†å´©æºƒä¸¢å¤±çš„é—®é¢˜, InnoDB æ˜¯"),t("strong",[s._v("æ”¯æŒå´©æºƒæ¢å¤ä¸ä¸¢æ•°æ®")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("ç„¶åŽå†çœ‹çœ‹èƒ½ä¸èƒ½è§£å†³è®¡æ•°ä¸ç²¾ç¡®çš„é—®é¢˜. ä½ ä¼šè¯´, è¿™ä¸ä¸€æ ·å—? æ— éžå°±æ˜¯æŠŠå›¾ 3 ä¸­å¯¹ Redis çš„æ“ä½œ, æ”¹æˆäº†å¯¹è®¡æ•°è¡¨ C çš„æ“ä½œ. åªè¦å‡ºçŽ°å›¾ 3 çš„è¿™ç§æ‰§è¡Œåºåˆ—, è¿™ä¸ªé—®é¢˜è¿˜æ˜¯æ— è§£çš„å§?")]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜è¿˜çœŸä¸æ˜¯æ— è§£çš„.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚è¦è§£å†³çš„é—®é¢˜, éƒ½æ˜¯ç”±äºŽ InnoDB è¦æ”¯æŒäº‹åŠ¡, ä»Žè€Œå¯¼è‡´ InnoDB è¡¨ä¸èƒ½æŠŠ count(*) ç›´æŽ¥å­˜èµ·æ¥, ç„¶åŽæŸ¥è¯¢çš„æ—¶å€™ç›´æŽ¥è¿”å›žå½¢æˆçš„. æ‰€è°“ä»¥å­ä¹‹çŸ›æ”»å­ä¹‹ç›¾, çŽ°åœ¨å°±"),t("strong",[s._v('åˆ©ç”¨ "äº‹åŠ¡" è¿™ä¸ªç‰¹æ€§')]),s._v(", æŠŠé—®é¢˜è§£å†³æŽ‰.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/9f4549a853ae787a6a08375446652aab-20230731161914-u2p1isk.png",alt:""}})]),s._v(" "),t("p",[s._v("æ¥çœ‹ä¸‹çŽ°åœ¨çš„æ‰§è¡Œç»“æžœ. "),t("strong",[s._v("è™½ç„¶ä¼šè¯ B çš„è¯»æ“ä½œä»ç„¶æ˜¯åœ¨ T3 æ‰§è¡Œçš„, ä½†æ˜¯å› ä¸ºè¿™æ—¶å€™æ›´æ–°äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤, æ‰€ä»¥è®¡æ•°å€¼åŠ  1 è¿™ä¸ªæ“ä½œå¯¹ä¼šè¯ B è¿˜ä¸å¯è§")]),s._v(".")]),s._v(" "),t("p",[s._v('å› æ­¤, ä¼šè¯ B çœ‹åˆ°çš„ç»“æžœé‡Œ, æŸ¥è®¡æ•°å€¼å’Œ"æœ€è¿‘ 100 æ¡è®°å½•"çœ‹åˆ°çš„ç»“æžœ, é€»è¾‘ä¸Šå°±æ˜¯ä¸€è‡´çš„.')]),s._v(" "),t("h5",{attrs:{id:"ä¸åŒçš„countç”¨æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸åŒçš„countç”¨æ³•"}},[s._v("#")]),s._v(" ä¸åŒçš„countç”¨æ³•")]),s._v(" "),t("p",[s._v("åœ¨ "),t("code",[s._v("select count(?) from t")]),s._v("â€‹ è¿™æ ·çš„æŸ¥è¯¢è¯­å¥é‡Œé¢, æœ‰count(*), count(ä¸»é”® id), count(å­—æ®µ) å’Œ count(1) ç­‰ä¸åŒç”¨æ³•. è¿™é‡Œè¯¦ç»†è¯´æ˜Žä¸€ä¸‹è¿™å‡ ç§ç”¨æ³•çš„æ€§èƒ½å·®åˆ«. éœ€è¦æ³¨æ„çš„æ˜¯, ä¸‹é¢çš„è®¨è®ºè¿˜æ˜¯"),t("strong",[s._v("åŸºäºŽ InnoDB å¼•æ“Ž")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("è¿™é‡Œ, é¦–å…ˆè¦å¼„æ¸…æ¥š count() çš„è¯­ä¹‰. count() æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°, å¯¹äºŽè¿”å›žçš„ç»“æžœé›†, ä¸€è¡Œè¡Œåœ°åˆ¤æ–­, å¦‚æžœ count å‡½æ•°çš„å‚æ•°ä¸æ˜¯ NULL, ç´¯è®¡å€¼å°±åŠ  1, å¦åˆ™ä¸åŠ . æœ€åŽè¿”å›žç´¯è®¡å€¼.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ count(*), count(ä¸»é”® id) å’Œ count(1) éƒ½è¡¨ç¤º"),t("strong",[s._v("è¿”å›žæ»¡è¶³æ¡ä»¶çš„ç»“æžœé›†çš„æ€»è¡Œæ•°")]),s._v("; è€Œ count(å­—æ®µ), åˆ™è¡¨ç¤ºè¿”å›žæ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œé‡Œé¢, å‚æ•°  "),t("strong",[s._v('"å­—æ®µ" ä¸ä¸º NULL çš„æ€»ä¸ªæ•°')]),s._v(".")]),s._v(" "),t("p",[s._v("è‡³äºŽåˆ†æžæ€§èƒ½å·®åˆ«çš„æ—¶å€™, å¯ä»¥è®°ä½è¿™ä¹ˆå‡ ä¸ªåŽŸåˆ™:")]),s._v(" "),t("ol",[t("li",[s._v("server å±‚è¦ä»€ä¹ˆå°±ç»™ä»€ä¹ˆ;")]),s._v(" "),t("li",[s._v("InnoDB åªç»™å¿…è¦çš„å€¼;")]),s._v(" "),t("li",[s._v("çŽ°åœ¨çš„"),t("strong",[s._v('ä¼˜åŒ–å™¨åªä¼˜åŒ–äº† count(*) çš„è¯­ä¹‰ä¸º"å–è¡Œæ•°"')]),s._v(' , å…¶ä»–"æ˜¾è€Œæ˜“è§"çš„ä¼˜åŒ–å¹¶æ²¡æœ‰åš.')])]),s._v(" "),t("p",[s._v("è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢? æŽ¥ä¸‹æ¥å°±ä¸€ä¸ªä¸ªåœ°æ¥çœ‹çœ‹.")]),s._v(" "),t("p",[t("strong",[s._v("å¯¹äºŽ count(ä¸»é”® id) æ¥è¯´")]),s._v(", InnoDB å¼•æ“Žä¼šéåŽ†æ•´å¼ è¡¨, æŠŠæ¯ä¸€è¡Œçš„ id å€¼éƒ½å–å‡ºæ¥, è¿”å›žç»™ server å±‚. server å±‚æ‹¿åˆ° id åŽ, åˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„, å°±æŒ‰è¡Œç´¯åŠ .")]),s._v(" "),t("p",[t("strong",[s._v("å¯¹äºŽ count(1) æ¥è¯´")]),s._v(", InnoDB å¼•æ“ŽéåŽ†æ•´å¼ è¡¨, ä½†"),t("strong",[s._v("ä¸å–å€¼")]),s._v('. server å±‚å¯¹äºŽè¿”å›žçš„æ¯ä¸€è¡Œ, æ”¾ä¸€ä¸ªæ•°å­— "1" è¿›åŽ», åˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„, æŒ‰è¡Œç´¯åŠ . å•çœ‹è¿™ä¸¤ä¸ªç”¨æ³•çš„å·®åˆ«çš„è¯, å°±èƒ½å¯¹æ¯”å‡ºæ¥, '),t("strong",[s._v("count(1) æ‰§è¡Œå¾—è¦æ¯” count(ä¸»é”® id) å¿«")]),s._v(". å› ä¸ºä»Žå¼•æ“Žè¿”å›ž id ä¼šæ¶‰åŠåˆ°è§£æžæ•°æ®è¡Œ, ä»¥åŠæ‹·è´å­—æ®µå€¼çš„æ“ä½œ.")]),s._v(" "),t("p",[t("strong",[s._v("å¯¹äºŽ count(å­—æ®µ) æ¥è¯´")]),s._v(":")]),s._v(" "),t("ol",[t("li",[s._v('å¦‚æžœè¿™ä¸ª"å­—æ®µ"æ˜¯å®šä¹‰ä¸º not null çš„è¯, ä¸€è¡Œè¡Œåœ°ä»Žè®°å½•é‡Œé¢è¯»å‡ºè¿™ä¸ªå­—æ®µ, åˆ¤æ–­ä¸èƒ½ä¸º null, æŒ‰è¡Œç´¯åŠ ;')]),s._v(" "),t("li",[s._v('å¦‚æžœè¿™ä¸ª"å­—æ®µ"å®šä¹‰å…è®¸ä¸º null, é‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™, åˆ¤æ–­åˆ°æœ‰å¯èƒ½æ˜¯ null, è¿˜è¦æŠŠå€¼å–å‡ºæ¥å†åˆ¤æ–­ä¸€ä¸‹, ä¸æ˜¯ null æ‰ç´¯åŠ .')])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯å‰é¢çš„ç¬¬ä¸€æ¡åŽŸåˆ™, server å±‚è¦ä»€ä¹ˆå­—æ®µ, InnoDB å°±è¿”å›žä»€ä¹ˆå­—æ®µ.")]),s._v(" "),t("p",[s._v("**ä½†æ˜¯ count(**â€‹ "),t("strong",[s._v(") æ˜¯ä¾‹å¤–")]),s._v(", å¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥, è€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–, ä¸å–å€¼. count(*) è‚¯å®šä¸æ˜¯ null, æŒ‰è¡Œç´¯åŠ .")]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™é‡Œ, ä½ ä¸€å®šä¼šè¯´, ä¼˜åŒ–å™¨å°±ä¸èƒ½è‡ªå·±åˆ¤æ–­ä¸€ä¸‹å—, ä¸»é”® id è‚¯å®šéžç©ºå•Š, ä¸ºä»€ä¹ˆä¸èƒ½æŒ‰ç…§ count(*) æ¥å¤„ç†, å¤šä¹ˆç®€å•çš„ä¼˜åŒ–å•Š.")]),s._v(" "),t("p",[s._v("å½“ç„¶, MySQL ä¸“é—¨é’ˆå¯¹è¿™ä¸ªè¯­å¥è¿›è¡Œä¼˜åŒ–, ä¹Ÿä¸æ˜¯ä¸å¯ä»¥. ä½†æ˜¯è¿™ç§éœ€è¦ä¸“é—¨ä¼˜åŒ–çš„æƒ…å†µå¤ªå¤šäº†, è€Œä¸” MySQL å·²ç»ä¼˜åŒ–è¿‡ count(*) äº†, ç›´æŽ¥ä½¿ç”¨è¿™ç§ç”¨æ³•å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ç»“è®ºæ˜¯: "),t("strong",[s._v("æŒ‰ç…§æ•ˆçŽ‡æŽ’åºçš„è¯, count(å­—æ®µ) < count(ä¸»é”® id) < count(1) â‰ˆ count("),t("em",[s._v("), æ‰€ä»¥å»ºè®®å°½é‡ä½¿ç”¨ count(")]),s._v(")")]),s._v(" .")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-14"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-14"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL ä¸­"),t("strong",[s._v("èŽ·å¾—è¡¨è¡Œæ•°")]),s._v("çš„ä¸¤ç§æ–¹æ³•. æåˆ°äº†åœ¨ä¸åŒå¼•æ“Žä¸­ count(*) çš„å®žçŽ°æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„, ä¹Ÿåˆ†æžäº†ç”¨ç¼“å­˜ç³»ç»Ÿæ¥å­˜å‚¨è®¡æ•°å€¼å­˜åœ¨çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("æŠŠè®¡æ•°æ”¾åœ¨ Redis é‡Œé¢, ä¸èƒ½å¤Ÿä¿è¯è®¡æ•°å’Œ MySQL è¡¨é‡Œçš„æ•°æ®ç²¾ç¡®ä¸€è‡´çš„åŽŸå› , æ˜¯**è¿™ä¸¤ä¸ªä¸åŒçš„å­˜å‚¨æž„æˆçš„ç³»ç»Ÿ, ä¸æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡, æ— æ³•æ‹¿åˆ°ç²¾ç¡®ä¸€è‡´çš„è§†å›¾. ** è€ŒæŠŠè®¡æ•°å€¼ä¹Ÿæ”¾åœ¨ MySQL ä¸­, å°±è§£å†³äº†ä¸€è‡´æ€§è§†å›¾çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("InnoDB å¼•æ“Žæ”¯æŒäº‹åŠ¡, å¯ä»¥åˆ©ç”¨å¥½äº‹åŠ¡çš„åŽŸå­æ€§å’Œéš”ç¦»æ€§, å°±å¯ä»¥ç®€åŒ–åœ¨ä¸šåŠ¡å¼€å‘æ—¶çš„é€»è¾‘. è¿™ä¹Ÿæ˜¯ InnoDB å¼•æ“Žå¤‡å—é’ççš„åŽŸå› ä¹‹ä¸€.")]),s._v(" "),t("p",[s._v("æä¸ªé—®é¢˜. åœ¨ä¸Šé¢è®¨è®ºçš„æ–¹æ¡ˆä¸­, ç”¨äº†äº‹åŠ¡æ¥ç¡®ä¿è®¡æ•°å‡†ç¡®. ç”±äºŽäº‹åŠ¡å¯ä»¥ä¿è¯ä¸­é—´ç»“æžœä¸è¢«åˆ«çš„äº‹åŠ¡è¯»åˆ°, å› æ­¤ä¿®æ”¹è®¡æ•°å€¼å’Œæ’å…¥æ–°è®°å½•çš„é¡ºåºæ˜¯ä¸å½±å“é€»è¾‘ç»“æžœçš„. ä½†ä»Žå¹¶å‘ç³»ç»Ÿæ€§èƒ½çš„è§’åº¦è€ƒè™‘, "),t("strong",[s._v("ä½ è§‰å¾—åœ¨è¿™ä¸ªäº‹åŠ¡åºåˆ—é‡Œ, åº”è¯¥å…ˆæ’å…¥æ“ä½œè®°å½•, è¿˜æ˜¯åº”è¯¥å…ˆæ›´æ–°è®¡æ•°è¡¨å‘¢")]),s._v("?")]),s._v(" "),t("h4",{attrs:{id:"_15-ç­”ç–‘æ–‡ç« -ä¸€-æ—¥å¿—ç›¸å…³é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15-ç­”ç–‘æ–‡ç« -ä¸€-æ—¥å¿—ç›¸å…³é—®é¢˜"}},[s._v("#")]),s._v(" 15-ç­”ç–‘æ–‡ç« (ä¸€):æ—¥å¿—ç›¸å…³é—®é¢˜")]),s._v(" "),t("p",[s._v("å‰é¢è®²åˆ° binlog(å½’æ¡£æ—¥å¿—)å’Œ redo log(é‡åšæ—¥å¿—)é…åˆå´©æºƒæ¢å¤çš„æ—¶å€™, ç”¨çš„æ˜¯"),t("strong",[s._v("åè¯æ³•")]),s._v(", è¯´æ˜Žäº†å¦‚æžœæ²¡æœ‰ä¸¤é˜¶æ®µæäº¤, ä¼šå¯¼è‡´ MySQL å‡ºçŽ°ä¸»å¤‡æ•°æ®ä¸ä¸€è‡´ç­‰é—®é¢˜.")]),s._v(" "),t("p",[s._v("å¾ˆå¤šäººæé—®"),t("strong",[s._v("åœ¨ä¸¤é˜¶æ®µæäº¤çš„ä¸åŒçž¬é—´, MySQL å¦‚æžœå‘ç”Ÿå¼‚å¸¸é‡å¯, æ˜¯æ€Žä¹ˆä¿è¯æ•°æ®å®Œæ•´æ€§çš„")]),s._v("?")]),s._v(" "),t("p",[s._v("çŽ°åœ¨å°±ä»Žè¿™ä¸ªé—®é¢˜å¼€å§‹å§.  å†æ”¾ä¸€æ¬¡ä¸¤é˜¶æ®µæäº¤çš„å›¾, æ–¹ä¾¿ä½ å­¦ä¹ ä¸‹é¢çš„å†…å®¹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20231202215222-a7uwzz5.png",alt:"image",title:"ä¸¤é˜¶æ®µæäº¤ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("è¿™é‡Œè¦å…ˆè§£é‡Šä¸€ä¸ªè¯¯ä¼šå¼çš„é—®é¢˜. æœ‰åŒå­¦åœ¨è¯„è®ºåŒºé—®åˆ°, è¿™ä¸ªå›¾ä¸æ˜¯ä¸€ä¸ª update è¯­å¥çš„æ‰§è¡Œæµç¨‹å—, æ€Žä¹ˆè¿˜ä¼šè°ƒç”¨ commit è¯­å¥?")]),s._v(" "),t("p",[s._v("ä»–äº§ç”Ÿè¿™ä¸ªç–‘é—®çš„åŽŸå› , æ˜¯æŠŠ"),t("strong",[s._v('ä¸¤ä¸ª "commit" çš„æ¦‚å¿µ')]),s._v("æ··æ·†äº†:")]),s._v(" "),t("ul",[t("li",[s._v('ä»–è¯´çš„ "commitè¯­å¥", æ˜¯æŒ‡ MySQL è¯­æ³•ä¸­, ç”¨äºŽæäº¤ä¸€ä¸ªäº‹åŠ¡çš„å‘½ä»¤. ä¸€èˆ¬è·Ÿ begin/start transaction é…å¯¹ä½¿ç”¨.')]),s._v(" "),t("li",[s._v('è€Œå›¾ä¸­ç”¨åˆ°çš„è¿™ä¸ª "commitæ­¥éª¤", æŒ‡çš„æ˜¯'),t("strong",[s._v("äº‹åŠ¡æäº¤è¿‡ç¨‹")]),s._v("ä¸­çš„ä¸€ä¸ªå°æ­¥éª¤, ä¹Ÿæ˜¯æœ€åŽä¸€æ­¥. å½“è¿™ä¸ªæ­¥éª¤æ‰§è¡Œå®ŒæˆåŽ, è¿™ä¸ªäº‹åŠ¡å°±æäº¤å®Œæˆäº†.")]),s._v(" "),t("li",[s._v('"commit è¯­å¥" æ‰§è¡Œçš„æ—¶å€™, ä¼šåŒ…å« "commit æ­¥éª¤".')])]),s._v(" "),t("p",[s._v('è€Œè¿™ä¸ªä¾‹å­é‡Œé¢, æ²¡æœ‰æ˜¾å¼åœ°å¼€å¯äº‹åŠ¡, å› æ­¤è¿™ä¸ª updateè¯­å¥è‡ªå·±å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡, åœ¨æ‰§è¡Œå®ŒæˆåŽæäº¤äº‹åŠ¡æ—¶, å°±ä¼šç”¨åˆ°è¿™ä¸ª "commitæ­¥éª¤".')]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å°±ä¸€èµ·åˆ†æžä¸€ä¸‹**åœ¨ä¸¤é˜¶æ®µæäº¤çš„ä¸åŒæ—¶åˆ», MySQL å¼‚å¸¸é‡å¯ä¼šå‡ºçŽ°ä»€ä¹ˆçŽ°è±¡. **")]),s._v(" "),t("p",[s._v("å¦‚æžœåœ¨å›¾ä¸­æ—¶åˆ» A çš„åœ°æ–¹, ä¹Ÿå°±æ˜¯å†™å…¥ redo log å¤„äºŽ prepare é˜¶æ®µä¹‹åŽ, å†™ binlog ä¹‹å‰, å‘ç”Ÿäº†å´©æºƒ(crash), ç”±äºŽæ­¤æ—¶ binlog è¿˜æ²¡å†™, redo log ä¹Ÿè¿˜æ²¡æäº¤, æ‰€ä»¥å´©æºƒæ¢å¤çš„æ—¶å€™, "),t("strong",[s._v("è¿™ä¸ªäº‹åŠ¡ä¼šå›žæ»š")]),s._v(". è¿™æ—¶å€™, binlog è¿˜æ²¡å†™, æ‰€ä»¥ä¹Ÿä¸ä¼šä¼ åˆ°å¤‡åº“. åˆ°è¿™é‡Œ, å¤§å®¶éƒ½å¯ä»¥ç†è§£.")]),s._v(" "),t("p",[s._v("å¤§å®¶å‡ºçŽ°é—®é¢˜çš„åœ°æ–¹, ä¸»è¦é›†ä¸­åœ¨æ—¶åˆ» B, ä¹Ÿå°±æ˜¯ binlog å†™å®Œ, redo log è¿˜æ²¡ commit å‰å‘ç”Ÿ crash, é‚£å´©æºƒæ¢å¤çš„æ—¶å€™ MySQL ä¼šæ€Žä¹ˆå¤„ç†?")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ä¸€ä¸‹å´©æºƒæ¢å¤æ—¶çš„åˆ¤æ–­è§„åˆ™.")]),s._v(" "),t("ol",[t("li",[s._v("**å¦‚æžœ redo log é‡Œé¢çš„äº‹åŠ¡æ˜¯å®Œæ•´çš„, ä¹Ÿå°±æ˜¯å·²ç»æœ‰äº† commit æ ‡è¯†, åˆ™ç›´æŽ¥æäº¤; **")]),s._v(" "),t("li",[s._v("**å¦‚æžœ redo log é‡Œé¢çš„äº‹åŠ¡åªæœ‰å®Œæ•´çš„ prepare, åˆ™åˆ¤æ–­å¯¹åº”çš„äº‹åŠ¡ binlog æ˜¯å¦å­˜åœ¨å¹¶å®Œæ•´: (1) å¦‚æžœæ˜¯, åˆ™æäº¤äº‹åŠ¡; (2)å¦åˆ™, å›žæ»šäº‹åŠ¡. **")])]),s._v(" "),t("p",[s._v("è¿™é‡Œ, æ—¶åˆ» B å‘ç”Ÿ crash å¯¹åº”çš„å°±æ˜¯ 2(a) çš„æƒ…å†µ, "),t("strong",[s._v("å´©æºƒæ¢å¤è¿‡ç¨‹ä¸­äº‹åŠ¡ä¼šè¢«æäº¤")]),s._v(".")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ç»§ç»­å»¶å±•ä¸€ä¸‹è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®1: MySQL æ€Žä¹ˆçŸ¥é“ binlog æ˜¯å®Œæ•´çš„?")])]),s._v(" "),t("p",[s._v("å›žç­”: ä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯æœ‰å®Œæ•´æ ¼å¼çš„:")]),s._v(" "),t("ul",[t("li",[s._v("statement æ ¼å¼çš„ binlog, æœ€åŽä¼šæœ‰ COMMIT;")]),s._v(" "),t("li",[s._v("row æ ¼å¼çš„ binlog, æœ€åŽä¼šæœ‰ä¸€ä¸ª XID event.")])]),s._v(" "),t("p",[s._v("å¦å¤–, åœ¨ MySQL 5.6.2 ç‰ˆæœ¬ä»¥åŽ, è¿˜å¼•å…¥äº† binlog-checksum å‚æ•°, ç”¨æ¥éªŒè¯ binlog å†…å®¹çš„æ­£ç¡®æ€§. å¯¹äºŽ binlog æ—¥å¿—ç”±äºŽç£ç›˜åŽŸå› , å¯èƒ½ä¼šåœ¨æ—¥å¿—ä¸­é—´å‡ºé”™çš„æƒ…å†µ, MySQL å¯ä»¥é€šè¿‡æ ¡éªŒ checksum çš„ç»“æžœæ¥å‘çŽ°. æ‰€ä»¥,  MySQL è¿˜æ˜¯æœ‰åŠžæ³•éªŒè¯äº‹åŠ¡ binlogçš„å®Œæ•´æ€§çš„.")]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®2: redo log å’Œ binlog æ˜¯æ€Žä¹ˆå…³è”èµ·æ¥çš„?")])]),s._v(" "),t("p",[s._v("å›žç­”: "),t("strong",[s._v("å®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„æ•°æ®å­—æ®µ, å« XID")]),s._v(". å´©æºƒæ¢å¤çš„æ—¶å€™, ä¼šæŒ‰é¡ºåºæ‰«æ redo log:")]),s._v(" "),t("ul",[t("li",[s._v("**å¦‚æžœç¢°åˆ°æ—¢æœ‰ prepare, åˆæœ‰ commit çš„ redo log, å°±ç›´æŽ¥æäº¤; **")]),s._v(" "),t("li",[s._v("**å¦‚æžœç¢°åˆ°åªæœ‰ parepare, è€Œæ²¡æœ‰ commit çš„ redo log, å°±æ‹¿ç€ XID åŽ» binlog æ‰¾å¯¹åº”çš„äº‹åŠ¡. **")])]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®3: å¤„äºŽ prepare é˜¶æ®µçš„ redo log åŠ ä¸Šå®Œæ•´ binlog, é‡å¯å°±èƒ½æ¢å¤, MySQL ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡?")])]),s._v(" "),t("p",[s._v("å›žç­”: å…¶è¿™ä¸ªé—®é¢˜è¿˜æ˜¯è·Ÿåœ¨åè¯æ³•ä¸­è¯´åˆ°çš„"),t("strong",[s._v("æ•°æ®ä¸Žå¤‡ä»½çš„ä¸€è‡´æ€§")]),s._v("æœ‰å…³. åœ¨æ—¶åˆ» B, ä¹Ÿå°±æ˜¯ binlog å†™å®Œä»¥åŽ MySQL å‘ç”Ÿå´©æºƒ, è¿™æ—¶å€™ binlog å·²ç»å†™å…¥äº†, ä¹‹åŽå°±ä¼šè¢«ä»Žåº“(æˆ–è€…ç”¨è¿™ä¸ª binlog æ¢å¤å‡ºæ¥çš„åº“)ä½¿ç”¨. æ‰€ä»¥åœ¨ä¸»åº“ä¸Šä¹Ÿè¦æäº¤è¿™ä¸ªäº‹åŠ¡. "),t("strong",[s._v("é‡‡ç”¨è¿™ä¸ªç­–ç•¥, ä¸»åº“å’Œå¤‡åº“çš„æ•°æ®å°±ä¿è¯äº†ä¸€è‡´æ€§")]),s._v(".")]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®4: å¦‚æžœè¿™æ ·çš„è¯, ä¸ºä»€ä¹ˆè¿˜è¦ä¸¤é˜¶æ®µæäº¤å‘¢? å¹²è„†å…ˆ redo log å†™å®Œ, å†å†™ binlog. å´©æºƒæ¢å¤çš„æ—¶å€™, å¿…é¡»å¾—ä¸¤ä¸ªæ—¥å¿—éƒ½å®Œæ•´æ‰å¯ä»¥. æ˜¯ä¸æ˜¯ä¸€æ ·çš„é€»è¾‘?")])]),s._v(" "),t("p",[s._v("å›žç­”: å…¶å®žä¸¤é˜¶æ®µæäº¤æ˜¯ç»å…¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿé—®é¢˜, å¹¶ä¸æ˜¯ MySQL ç‹¬æœ‰çš„.")]),s._v(" "),t("p",[s._v("å¦‚æžœå¿…é¡»è¦ä¸¾ä¸€ä¸ªåœºæ™¯, æ¥è¯´æ˜Žè¿™ä¹ˆåšçš„å¿…è¦æ€§çš„è¯, é‚£å°±æ˜¯"),t("strong",[s._v("äº‹åŠ¡çš„æŒä¹…æ€§é—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯¹äºŽ InnoDB å¼•æ“Žæ¥è¯´, "),t("strong",[s._v("å¦‚æžœ redo log æäº¤å®Œæˆäº†, äº‹åŠ¡å°±ä¸èƒ½å›žæ»š(å¦‚æžœè¿™è¿˜å…è®¸å›žæ»š, å°±å¯èƒ½è¦†ç›–æŽ‰åˆ«çš„äº‹åŠ¡çš„æ›´æ–°")]),s._v('). è€Œå¦‚æžœ redo log ç›´æŽ¥æäº¤, ç„¶åŽ binlog å†™å…¥çš„æ—¶å€™å¤±è´¥, InnoDBåˆå›žæ»šä¸äº†, æ•°æ®å’Œ binlog æ—¥å¿—åˆä¸ä¸€è‡´äº†. ä¸¤é˜¶æ®µæäº¤å°±æ˜¯ä¸ºäº†ç»™æ‰€æœ‰äººä¸€ä¸ªæœºä¼š, å½“æ¯ä¸ªäººéƒ½è¯´ "æˆ‘ok" çš„æ—¶å€™, å†ä¸€èµ·æäº¤.')]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®5: ä¸å¼•å…¥ä¸¤ä¸ªæ—¥å¿—, ä¹Ÿå°±æ²¡æœ‰ä¸¤é˜¶æ®µæäº¤çš„å¿…è¦äº†. åªç”¨ binlog æ¥æ”¯æŒå´©æºƒæ¢å¤, åˆèƒ½æ”¯æŒå½’æ¡£, ä¸å°±å¯ä»¥äº†?")])]),s._v(" "),t("p",[s._v('å›žç­”: è¿™ä½åŒå­¦çš„æ„æ€æ˜¯, åªä¿ç•™ binlog, ç„¶åŽå¯ä»¥æŠŠæäº¤æµç¨‹æ”¹æˆè¿™æ ·: ... -> "æ•°æ®æ›´æ–°åˆ°å†…å­˜" -> "å†™ binlog" -> "æäº¤äº‹åŠ¡", æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æä¾›å´©æºƒæ¢å¤çš„èƒ½åŠ›?')]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯ä¸å¯ä»¥.")]),s._v(" "),t("p",[s._v("å¦‚æžœè¯´"),t("strong",[s._v("åŽ†å²åŽŸå› ")]),s._v("çš„è¯, é‚£å°±æ˜¯ InnoDB å¹¶ä¸æ˜¯ MySQL çš„åŽŸç”Ÿå­˜å‚¨å¼•æ“Ž. MySQL çš„åŽŸç”Ÿå¼•æ“Žæ˜¯ MyISAM, è®¾è®¡ä¹‹åˆå°±æœ‰æ²¡æœ‰æ”¯æŒå´©æºƒæ¢å¤.")]),s._v(" "),t("p",[s._v("InnoDB åœ¨ä½œä¸º MySQL çš„æ’ä»¶åŠ å…¥ MySQL å¼•æ“Žå®¶æ—ä¹‹å‰, å°±å·²ç»æ˜¯ä¸€ä¸ªæä¾›äº†å´©æºƒæ¢å¤å’Œäº‹åŠ¡æ”¯æŒçš„å¼•æ“Žäº†. InnoDB æŽ¥å…¥äº† MySQL åŽ, å‘çŽ°æ—¢ç„¶ binlog æ²¡æœ‰å´©æºƒæ¢å¤çš„èƒ½åŠ›, é‚£å°±ç”¨ InnoDB åŽŸæœ‰çš„ redo log å¥½äº†.")]),s._v(" "),t("p",[s._v("è€Œå¦‚æžœè¯´"),t("strong",[s._v("å®žçŽ°ä¸Šçš„åŽŸå› ")]),s._v("çš„è¯, å°±æœ‰å¾ˆå¤šäº†. å°±æŒ‰ç…§é—®é¢˜ä¸­è¯´çš„, åªç”¨ binlog æ¥å®žçŽ°å´©æºƒæ¢å¤çš„æµç¨‹, æˆ‘ç”»äº†ä¸€å¼ ç¤ºæ„å›¾, è¿™é‡Œå°±æ²¡æœ‰ redo log äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20231202220003-jp2dzev.png",alt:"image",title:"åªç”¨binlogæ”¯æŒå´©æºƒæ¢å¤"}})]),s._v(" "),t("p",[s._v("è¿™æ ·çš„æµç¨‹ä¸‹, binlog è¿˜æ˜¯ä¸èƒ½æ”¯æŒå´©æºƒæ¢å¤çš„. è¯´ä¸€ä¸ªä¸æ”¯æŒçš„ç‚¹å§: "),t("strong",[s._v('binlog æ²¡æœ‰èƒ½åŠ›æ¢å¤ "æ•°æ®é¡µ"')]),s._v(" .")]),s._v(" "),t("p",[s._v("å¦‚æžœåœ¨å›¾ä¸­æ ‡çš„ä½ç½®, ä¹Ÿå°±æ˜¯ binlog2 å†™å®Œäº†, ä½†æ˜¯æ•´ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ commit çš„æ—¶å€™, MySQL å‘ç”Ÿäº† crash. é‡å¯åŽ, å¼•æ“Žå†…éƒ¨äº‹åŠ¡ 2 ä¼šå›žæ»š, ç„¶åŽåº”ç”¨ binlog2 å¯ä»¥è¡¥å›žæ¥; ä½†æ˜¯å¯¹äºŽäº‹åŠ¡ 1 æ¥è¯´, ç³»ç»Ÿå·²ç»è®¤ä¸ºæäº¤å®Œæˆäº†, ä¸ä¼šå†åº”ç”¨ä¸€æ¬¡ binlog1.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, InnoDB å¼•æ“Žä½¿ç”¨çš„æ˜¯ WAL æŠ€æœ¯, æ‰§è¡Œäº‹åŠ¡çš„æ—¶å€™, "),t("strong",[s._v("å†™å®Œå†…å­˜å’Œæ—¥å¿—, äº‹åŠ¡å°±ç®—å®Œæˆäº†")]),s._v(". å¦‚æžœä¹‹åŽå´©æºƒ, è¦ä¾èµ–äºŽæ—¥å¿—æ¥æ¢å¤æ•°æ®é¡µ. ä¹Ÿå°±æ˜¯è¯´åœ¨å›¾ä¸­è¿™ä¸ªä½ç½®å‘ç”Ÿå´©æºƒçš„è¯, äº‹åŠ¡ 1 ä¹Ÿæ˜¯å¯èƒ½ä¸¢å¤±äº†çš„, è€Œä¸”æ˜¯æ•°æ®é¡µçº§çš„ä¸¢å¤±. æ­¤æ—¶, binlog é‡Œé¢å¹¶æ²¡æœ‰è®°å½•æ•°æ®é¡µçš„æ›´æ–°ç»†èŠ‚, æ˜¯è¡¥ä¸å›žæ¥çš„.")]),s._v(" "),t("p",[s._v("ä½ å¦‚æžœè¦è¯´, é‚£æˆ‘ä¼˜åŒ–ä¸€ä¸‹ binlog çš„å†…å®¹, è®©å®ƒæ¥è®°å½•æ•°æ®é¡µçš„æ›´æ”¹å¯ä»¥å—? ä½†è¿™å…¶å®žå°±æ˜¯åˆåšäº†ä¸€ä¸ª redo log å‡ºæ¥. æ‰€ä»¥, è‡³å°‘çŽ°åœ¨çš„ binlog èƒ½åŠ›, è¿˜ä¸èƒ½æ”¯æŒå´©æºƒæ¢å¤.")]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®6: é‚£èƒ½ä¸èƒ½åè¿‡æ¥, åªç”¨ redo log, ä¸è¦ binlog?")])]),s._v(" "),t("p",[s._v("å›žç­”: å¦‚æžœåªä»Žå´©æºƒæ¢å¤çš„è§’åº¦æ¥è®²æ˜¯å¯ä»¥çš„. ä½ å¯ä»¥æŠŠ binlog å…³æŽ‰, è¿™æ ·å°±æ²¡æœ‰ä¸¤é˜¶æ®µæäº¤äº†, ä½†ç³»ç»Ÿä¾ç„¶æ˜¯ crash-safe çš„.")]),s._v(" "),t("p",[s._v("ä½†å¦‚æžœä½ äº†è§£ä¸€ä¸‹ä¸šç•Œå„ä¸ªå…¬å¸çš„ä½¿ç”¨åœºæ™¯çš„è¯, å°±ä¼šå‘çŽ°åœ¨æ­£å¼çš„ç”Ÿäº§åº“ä¸Š, binlog éƒ½æ˜¯å¼€ç€çš„. å› ä¸º binlog æœ‰ç€ redo log æ— æ³•æ›¿ä»£çš„åŠŸèƒ½.")]),s._v(" "),t("p",[t("strong",[s._v("ä¸€ä¸ªæ˜¯å½’æ¡£")]),s._v(". redo log æ˜¯å¾ªçŽ¯å†™, å†™åˆ°æœ«å°¾æ˜¯è¦å›žåˆ°å¼€å¤´ç»§ç»­å†™çš„. è¿™æ ·åŽ†å²æ—¥å¿—æ²¡æ³•ä¿ç•™, redo log ä¹Ÿå°±èµ·ä¸åˆ°å½’æ¡£çš„ä½œç”¨. "),t("strong",[s._v("ä¸€ä¸ªå°±æ˜¯ MySQL ç³»ç»Ÿä¾èµ–äºŽ binlog")]),s._v(". binlog ä½œä¸º MySQL ä¸€å¼€å§‹å°±æœ‰çš„åŠŸèƒ½, è¢«ç”¨åœ¨äº†å¾ˆå¤šåœ°æ–¹. å…¶ä¸­ "),t("strong",[s._v("MySQL ç³»ç»Ÿé«˜å¯ç”¨çš„åŸºç¡€, å°±æ˜¯ binlog å¤åˆ¶")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿˜æœ‰å¾ˆå¤šå…¬å¸æœ‰å¼‚æž„ç³»ç»Ÿ(æ¯”å¦‚ä¸€äº›æ•°æ®åˆ†æžç³»ç»Ÿ), è¿™äº›ç³»ç»Ÿå°±é æ¶ˆè´¹ MySQL çš„ binlog æ¥æ›´æ–°è‡ªå·±çš„æ•°æ®. å…³æŽ‰ binlog çš„è¯, è¿™äº›ä¸‹æ¸¸ç³»ç»Ÿå°±æ²¡æ³•è¾“å…¥äº†.")]),s._v(" "),t("p",[s._v("æ€»ä¹‹, ç”±äºŽçŽ°åœ¨åŒ…æ‹¬ MySQL é«˜å¯ç”¨åœ¨å†…çš„"),t("strong",[s._v("å¾ˆå¤šç³»ç»Ÿæœºåˆ¶éƒ½ä¾èµ–äºŽ binlog")]),s._v(', æ‰€ä»¥"é¸ å é¹Šå·¢" redo log è¿˜åšä¸åˆ°. ä½ çœ‹, å‘å±•ç”Ÿæ€æ˜¯å¤šä¹ˆé‡è¦.')]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®7: redo log ä¸€èˆ¬è®¾ç½®å¤šå¤§?")])]),s._v(" "),t("p",[s._v("å›žç­”: redo log å¤ªå°çš„è¯, ä¼šå¯¼è‡´å¾ˆå¿«å°±è¢«å†™æ»¡, ç„¶åŽä¸å¾—ä¸å¼ºè¡Œåˆ· redo log, è¿™æ · WAL æœºåˆ¶çš„èƒ½åŠ›å°±å‘æŒ¥ä¸å‡ºæ¥äº†.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥å¦‚æžœæ˜¯çŽ°åœ¨å¸¸è§çš„å‡ ä¸ª TB çš„ç£ç›˜çš„è¯, å°±ä¸è¦å¤ªå°æ°”äº†, ç›´æŽ¥å°† redo log è®¾ç½®ä¸º 4 ä¸ªæ–‡ä»¶, æ¯ä¸ªæ–‡ä»¶ 1GB å§.")]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®8: æ­£å¸¸è¿è¡Œä¸­çš„å®žä¾‹, æ•°æ®å†™å…¥åŽçš„æœ€ç»ˆè½ç›˜, æ˜¯ä»Ž redo log æ›´æ–°è¿‡æ¥çš„è¿˜æ˜¯ä»Ž buffer pool æ›´æ–°è¿‡æ¥çš„å‘¢?")])]),s._v(" "),t("p",[s._v('å›žç­”: è¿™ä¸ªé—®é¢˜å…¶å®žé—®å¾—éžå¸¸å¥½. è¿™é‡Œæ¶‰åŠåˆ°äº†, "redo log é‡Œé¢åˆ°åº•æ˜¯ä»€ä¹ˆ" çš„é—®é¢˜.')]),s._v(" "),t("p",[s._v('å®žé™…ä¸Š, redo log å¹¶æ²¡æœ‰è®°å½•æ•°æ®é¡µçš„å®Œæ•´æ•°æ®, æ‰€ä»¥å®ƒå¹¶æ²¡æœ‰èƒ½åŠ›è‡ªå·±åŽ»æ›´æ–°ç£ç›˜æ•°æ®é¡µ, ä¹Ÿå°±ä¸å­˜åœ¨ "æ•°æ®æœ€ç»ˆè½ç›˜, æ˜¯ç”± redo log æ›´æ–°è¿‡åŽ»" çš„æƒ…å†µ.')]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœæ˜¯æ­£å¸¸è¿è¡Œçš„å®žä¾‹çš„è¯, "),t("strong",[s._v("æ•°æ®é¡µè¢«ä¿®æ”¹ä»¥åŽ, è·Ÿç£ç›˜çš„æ•°æ®é¡µä¸ä¸€è‡´, ç§°ä¸ºè„é¡µ. æœ€ç»ˆæ•°æ®è½ç›˜, å°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ•°æ®é¡µå†™ç›˜. è¿™ä¸ªè¿‡ç¨‹, ç”šè‡³ä¸Ž redo log æ¯«æ— å…³ç³»")]),s._v(".")]),s._v(" "),t("li",[s._v("**åœ¨å´©æºƒæ¢å¤åœºæ™¯ä¸­, InnoDB å¦‚æžœåˆ¤æ–­åˆ°ä¸€ä¸ªæ•°æ®é¡µå¯èƒ½åœ¨å´©æºƒæ¢å¤çš„æ—¶å€™ä¸¢å¤±äº†æ›´æ–°, å°±ä¼šå°†å®ƒè¯»åˆ°å†…å­˜, ç„¶åŽè®© redo log æ›´æ–°å†…å­˜å†…å®¹. æ›´æ–°å®ŒæˆåŽ, å†…å­˜é¡µå˜æˆè„é¡µ, å°±å›žåˆ°äº†ç¬¬ä¸€ç§æƒ…å†µçš„çŠ¶æ€. **")])]),s._v(" "),t("blockquote",[t("p",[s._v("è¿½é—®9: redo log buffer æ˜¯ä»€ä¹ˆ? æ˜¯å…ˆä¿®æ”¹å†…å­˜, è¿˜æ˜¯å…ˆå†™ redo log æ–‡ä»¶?")])]),s._v(" "),t("p",[s._v("å›žç­”: è¿™ä¸¤ä¸ªé—®é¢˜å¯ä»¥ä¸€èµ·å›žç­”.")]),s._v(" "),t("p",[s._v("åœ¨"),t("strong",[s._v("ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°è¿‡ç¨‹ä¸­, æ—¥å¿—æ˜¯è¦å†™å¤šæ¬¡çš„")]),s._v(". æ¯”å¦‚ä¸‹é¢è¿™ä¸ªäº‹åŠ¡:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("è¿™ä¸ªäº‹åŠ¡è¦å¾€ä¸¤ä¸ªè¡¨ä¸­æ’å…¥è®°å½•, æ’å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­, "),t("strong",[s._v("ç”Ÿæˆçš„æ—¥å¿—éƒ½å¾—å…ˆä¿å­˜èµ·æ¥")]),s._v(", ä½†åˆä¸èƒ½åœ¨è¿˜æ²¡ commit çš„æ—¶å€™å°±ç›´æŽ¥å†™åˆ° redo log æ–‡ä»¶é‡Œ.")]),s._v(" "),t("p",[t("strong",[s._v("æ‰€ä»¥ redo log buffer å°±æ˜¯ä¸€å—å†…å­˜, ç”¨æ¥å…ˆå­˜ redo æ—¥å¿—çš„")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ª insert çš„æ—¶å€™, æ•°æ®çš„å†…å­˜è¢«ä¿®æ”¹äº†, redo log buffer ä¹Ÿå†™å…¥äº†æ—¥å¿—.")]),s._v(" "),t("p",[s._v('**ä½†çœŸæ­£æŠŠæ—¥å¿—å†™åˆ° redo log æ–‡ä»¶(æ–‡ä»¶åæ˜¯ ib_logfile+æ•°å­—), æ˜¯åœ¨æ‰§è¡Œ commit è¯­å¥çš„æ—¶å€™åšçš„. ** (è¿™é‡Œè¯´çš„æ˜¯äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼š "ä¸»åŠ¨åŽ»åˆ·ç›˜", ä»¥å‡å°‘ä¸å¿…è¦çš„ IO æ¶ˆè€—. ä½†æ˜¯å¯èƒ½ä¼šå‡ºçŽ° "è¢«åŠ¨å†™å…¥ç£ç›˜", æ¯”å¦‚å†…å­˜ä¸å¤Ÿ, å…¶ä»–äº‹åŠ¡æäº¤ç­‰æƒ…å†µ.')]),s._v(" "),t("p",[s._v('å•ç‹¬æ‰§è¡Œä¸€ä¸ªæ›´æ–°è¯­å¥çš„æ—¶å€™, InnoDB ä¼šè‡ªå·±å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡, åœ¨è¯­å¥æ‰§è¡Œå®Œæˆçš„æ—¶å€™æäº¤. è¿‡ç¨‹è·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„, åªä¸è¿‡æ˜¯"åŽ‹ç¼©"åˆ°äº†ä¸€ä¸ªè¯­å¥é‡Œé¢å®Œæˆ.')]),s._v(" "),t("h4",{attrs:{id:"_16-order-by-æ˜¯æ€Žä¹ˆå·¥ä½œçš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-order-by-æ˜¯æ€Žä¹ˆå·¥ä½œçš„"}},[s._v("#")]),s._v(' 16-"order by"æ˜¯æ€Žä¹ˆå·¥ä½œçš„?')]),s._v(" "),t("p",[s._v("åœ¨ä½ å¼€å‘åº”ç”¨çš„æ—¶å€™, ä¸€å®šä¼šç»å¸¸ç¢°åˆ°éœ€è¦"),t("strong",[s._v("æ ¹æ®æŒ‡å®šçš„å­—æ®µæŽ’åºæ¥æ˜¾ç¤ºç»“æžœ")]),s._v('çš„éœ€æ±‚. è¿˜æ˜¯ä»¥å‰é¢ä¸¾ä¾‹ç”¨è¿‡çš„å¸‚æ°‘è¡¨ä¸ºä¾‹, å‡è®¾è¦æŸ¥è¯¢åŸŽå¸‚æ˜¯"æ­å·ž"çš„æ‰€æœ‰äººåå­—, å¹¶ä¸”æŒ‰ç…§å§“åæŽ’åºè¿”å›žå‰ 1000 ä¸ªäººçš„å§“å, å¹´é¾„.')]),s._v(" "),t("p",[s._v("å‡è®¾è¿™ä¸ªè¡¨çš„éƒ¨åˆ†å®šä¹‰æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("è¿™æ—¶ä½ çš„ SQL è¯­å¥å¯ä»¥è¿™ä¹ˆå†™:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" city"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'æ­å·ž'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¯­å¥çœ‹ä¸ŠåŽ»é€»è¾‘å¾ˆæ¸…æ™°, ä½†æ˜¯ä½ äº†è§£å®ƒçš„æ‰§è¡Œæµç¨‹å—? æœ¬èŠ‚å°±èŠèŠ"),t("strong",[s._v("è¿™ä¸ªè¯­å¥æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„")]),s._v(", ä»¥åŠæœ‰ä»€ä¹ˆå‚æ•°ä¼šå½±å“æ‰§è¡Œçš„è¡Œä¸º.")]),s._v(" "),t("h5",{attrs:{id:"å…¨å­—æ®µæŽ’åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¨å­—æ®µæŽ’åº"}},[s._v("#")]),s._v(" å…¨å­—æ®µæŽ’åº")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»è¿‡ç´¢å¼•, ä¸ºé¿å…å…¨è¡¨æ‰«æ, æˆ‘ä»¬éœ€è¦åœ¨ city å­—æ®µåŠ ä¸Šç´¢å¼•. åœ¨ city å­—æ®µä¸Šåˆ›å»ºç´¢å¼•ä¹‹åŽ, ç”¨ explain å‘½ä»¤æ¥çœ‹çœ‹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæƒ…å†µ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/56df97340c17b75e988a5fb25a237e8b-20230731161914-6i826a0.png",alt:"",title:"ä½¿ç”¨ explain å‘½ä»¤æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œæƒ…å†µ"}})]),s._v(" "),t("p",[s._v('Extra è¿™ä¸ªå­—æ®µä¸­çš„ "'),t("strong",[s._v("Using filesort")]),s._v('" è¡¨ç¤ºçš„å°±æ˜¯'),t("strong",[s._v("éœ€è¦æŽ’åº")]),s._v(", MySQL ä¼š"),t("mark",[t("strong",[s._v("ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ç”¨äºŽæŽ’åº, ç§°ä¸º sort_buffer")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸ºäº†è¯´æ˜Žè¿™ä¸ª SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹, å…ˆæ¥çœ‹ä¸€ä¸‹ city è¿™ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a6877163d5386a82da7375e9f8c9ba5c-20230731161914-lejufm1.png",alt:"",title:"city å­—æ®µçš„ç´¢å¼•ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("ä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°, æ»¡è¶³ city='æ­å·ž' æ¡ä»¶çš„è¡Œ, æ˜¯ä»Ž ID_X åˆ° ID_(X+N) çš„è¿™äº›è®°å½•.")]),s._v(" "),t("p",[s._v("é€šå¸¸æƒ…å†µä¸‹, è¿™ä¸ªè¯­å¥æ‰§è¡Œæµç¨‹å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("ol",[t("li",[s._v("åˆå§‹åŒ– sort_buffer, ç¡®å®šæ”¾å…¥ name, city, age è¿™ä¸‰ä¸ªå­—æ®µ;")]),s._v(" "),t("li",[s._v("ä»Žç´¢å¼• city æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city='æ­å·ž' æ¡ä»¶çš„ä¸»é”® id, ä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_X;")]),s._v(" "),t("li",[s._v("åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œ, å– name, city, age ä¸‰ä¸ªå­—æ®µçš„å€¼, å­˜å…¥ sort_buffer ä¸­;")]),s._v(" "),t("li",[s._v("ä»Žç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”® id;")]),s._v(" "),t("li",[s._v("é‡å¤æ­¥éª¤ 3, 4 ç›´åˆ° city çš„å€¼ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ä¸ºæ­¢, å¯¹åº”çš„ä¸»é”® id ä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_Y;")]),s._v(" "),t("li",[t("strong",[s._v("å¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ name åšå¿«é€ŸæŽ’åº")]),s._v(";")]),s._v(" "),t("li",[s._v("æŒ‰ç…§æŽ’åºç»“æžœå–å‰ 1000 è¡Œè¿”å›žç»™å®¢æˆ·ç«¯.")])]),s._v(" "),t("p",[s._v("æš‚ä¸”æŠŠè¿™ä¸ªæŽ’åºè¿‡ç¨‹, ç§°ä¸º"),t("strong",[s._v("å…¨å­—æ®µæŽ’åº")]),s._v(", æ‰§è¡Œæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º, ä¸‹ä¸€èŠ‚è¿˜ä¼šç”¨åˆ°è¿™ä¸ªæŽ’åº.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/49b21b27c043d04722563d7b6f86722e-20230731161914-rxi4siv.png",alt:"",title:"å…¨å­—æ®µæŽ’åº"}})]),s._v(" "),t("p",[s._v('å›¾ä¸­ "æŒ‰ name æŽ’åº" è¿™ä¸ªåŠ¨ä½œ, '),t("mark",[t("strong",[s._v("å¯èƒ½åœ¨å†…å­˜ä¸­å®Œæˆ, ä¹Ÿå¯èƒ½éœ€è¦ä½¿ç”¨å¤–éƒ¨æŽ’åº")])]),s._v(", è¿™å–å†³äºŽæŽ’åºæ‰€éœ€çš„å†…å­˜å’Œå‚æ•° "),t("strong",[s._v("sort_buffer_size")]),s._v(".")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("sort_buffer_size, å°±æ˜¯ MySQL ä¸ºæŽ’åºå¼€è¾Ÿçš„å†…å­˜(sort_buffer)çš„å¤§å°. å¦‚æžœè¦æŽ’åºçš„æ•°æ®é‡å°äºŽ sort_buffer_size, æŽ’åºå°±åœ¨å†…å­˜ä¸­å®Œæˆ. ä½†å¦‚æžœæŽ’åºæ•°æ®é‡å¤ªå¤§, å†…å­˜æ”¾ä¸ä¸‹, åˆ™ä¸å¾—ä¸åˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æŽ’åº.")])])]),s._v(" "),t("p",[s._v("å¯ä»¥ç”¨ä¸‹é¢ä»‹ç»çš„æ–¹æ³•, æ¥ç¡®å®šä¸€ä¸ªæŽ’åºè¯­å¥æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æ‰“å¼€optimizer_trace, åªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" optimizer_trace"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'enabled=on'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* @aä¿å­˜Innodb_rows_readçš„åˆå§‹å€¼ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" VARIABLE_VALUE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  performance_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_status "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" variable_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_rows_read'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æ‰§è¡Œè¯­å¥ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" city"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'æ­å·ž'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("information_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("OPTIMIZER_TRACE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v("\\G\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* @bä¿å­˜Innodb_rows_readçš„å½“å‰å€¼ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" VARIABLE_VALUE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@b")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" performance_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_status "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" variable_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_rows_read'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* è®¡ç®—Innodb_rows_readå·®å€¼ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@b")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("è¿™ä¸ªæ–¹æ³•æ˜¯é€šè¿‡æŸ¥çœ‹ "),t("strong",[s._v("OPTIMIZER_TRACE")]),s._v(" çš„ç»“æžœæ¥ç¡®è®¤çš„, å¯ä»¥ä»Ž "),t("strong",[s._v("number_of_tmp_files")]),s._v(" ä¸­çœ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/36e154cdb3beb70e009fd60e7d3cdb39-20230731161914-3s868kg.png",alt:"",title:"å…¨æŽ’åºçš„ OPTIMIZER_TRACE éƒ¨åˆ†ç»“æžœ"}})]),s._v(" "),t("p",[s._v("number_of_tmp_files è¡¨ç¤ºçš„æ˜¯, æŽ’åºè¿‡ç¨‹ä¸­"),t("strong",[s._v("ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶æ•°")]),s._v(". ä½ ä¸€å®šå¥‡æ€ª, ä¸ºä»€ä¹ˆéœ€è¦ 12 ä¸ªæ–‡ä»¶? å†…å­˜æ”¾ä¸ä¸‹æ—¶, å°±éœ€è¦"),t("strong",[s._v("ä½¿ç”¨å¤–éƒ¨æŽ’åº, å¤–éƒ¨æŽ’åºä¸€èˆ¬ä½¿ç”¨å½’å¹¶æŽ’åºç®—æ³•")]),s._v(". å¯ä»¥è¿™ä¹ˆç®€å•ç†è§£, **MySQL å°†éœ€è¦æŽ’åºçš„æ•°æ®åˆ†æˆ 12 ä»½, æ¯ä¸€ä»½å•ç‹¬æŽ’åºåŽå­˜åœ¨è¿™äº›ä¸´æ—¶æ–‡ä»¶ä¸­. ç„¶åŽæŠŠè¿™ 12 ä¸ªæœ‰åºæ–‡ä»¶å†åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶. **")]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æžœ sort_buffer_size è¶…è¿‡äº†éœ€è¦æŽ’åºçš„æ•°æ®é‡çš„å¤§å°, number_of_tmp_files å°±æ˜¯ 0, è¡¨ç¤ºæŽ’åºå¯ä»¥ç›´æŽ¥åœ¨å†…å­˜ä¸­å®Œæˆ. å¦åˆ™å°±éœ€è¦æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­æŽ’åº. sort_buffer_size è¶Šå°, éœ€è¦åˆ†æˆçš„ä»½æ•°è¶Šå¤š, number_of_tmp_files çš„å€¼å°±è¶Šå¤§.")])]),s._v(" "),t("p",[s._v("å†è§£é‡Šä¸€ä¸‹å›¾ä¸­å…¶ä»–ä¸¤ä¸ªå€¼çš„æ„æ€.")]),s._v(" "),t("p",[s._v("ç¤ºä¾‹è¡¨ä¸­æœ‰ 4000 æ¡æ»¡è¶³ city='æ­å·ž' çš„è®°å½•, æ‰€ä»¥å¯ä»¥çœ‹åˆ° examined_rows=4000, è¡¨ç¤º"),t("strong",[s._v("å‚ä¸ŽæŽ’åºçš„è¡Œæ•°")]),s._v("æ˜¯ 4000 è¡Œ.")]),s._v(" "),t("p",[s._v("sort_mode é‡Œé¢çš„ "),t("strong",[s._v("packed_additional_fields")]),s._v(' çš„æ„æ€æ˜¯, æŽ’åºè¿‡ç¨‹å¯¹å­—ç¬¦ä¸²åšäº† "ç´§å‡‘" å¤„ç†. å³ä½¿ name å­—æ®µçš„å®šä¹‰æ˜¯ varchar(16), '),t("strong",[s._v("åœ¨æŽ’åºè¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æŒ‰ç…§å®žé™…é•¿åº¦æ¥åˆ†é…ç©ºé—´çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("åŒæ—¶, æœ€åŽä¸€ä¸ªæŸ¥è¯¢è¯­å¥ select @b-@a çš„è¿”å›žç»“æžœæ˜¯ 4000, è¡¨ç¤ºæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹åªæ‰«æäº† 4000 è¡Œ.")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, ä¸ºäº†é¿å…å¯¹ç»“è®ºé€ æˆå¹²æ‰°, æˆ‘æŠŠ internal_tmp_disk_storage_engine è®¾ç½®æˆ MyISAM. å¦åˆ™ select @b-@a çš„ç»“æžœä¼šæ˜¾ç¤ºä¸º 4001. è¿™æ˜¯å› ä¸ºæŸ¥è¯¢ OPTIMIZER_TRACE è¿™ä¸ªè¡¨æ—¶, éœ€è¦ç”¨åˆ°"),t("strong",[s._v("ä¸´æ—¶è¡¨")]),s._v(", è€Œ internal_tmp_disk_storage_engine çš„é»˜è®¤å€¼æ˜¯ InnoDB. å¦‚æžœä½¿ç”¨çš„æ˜¯ InnoDB å¼•æ“Žçš„è¯, æŠŠæ•°æ®ä»Žä¸´æ—¶è¡¨å–å‡ºæ¥çš„æ—¶å€™, ä¼šè®© Innodb_rows_read çš„å€¼åŠ  1.")]),s._v(" "),t("h5",{attrs:{id:"rowidæŽ’åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rowidæŽ’åº"}},[s._v("#")]),s._v(" rowidæŽ’åº")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šé¢è¿™ä¸ªç®—æ³•è¿‡ç¨‹é‡Œé¢, "),t("strong",[s._v("åªå¯¹åŽŸè¡¨çš„æ•°æ®è¯»äº†ä¸€é")]),s._v(", å‰©ä¸‹çš„æ“ä½œéƒ½æ˜¯"),t("strong",[s._v("åœ¨ sort_buffer å’Œä¸´æ—¶æ–‡ä»¶ä¸­æ‰§è¡Œ")]),s._v("çš„. ä½†è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜, å°±æ˜¯å¦‚æžœæŸ¥è¯¢"),t("strong",[s._v("è¦è¿”å›žçš„å­—æ®µå¾ˆå¤š")]),s._v("çš„è¯, é‚£ä¹ˆ sort_buffer é‡Œé¢è¦æ”¾çš„å­—æ®µæ•°å¤ªå¤š, è¿™æ ·å†…å­˜é‡Œèƒ½å¤ŸåŒæ—¶æ”¾ä¸‹çš„è¡Œæ•°å¾ˆå°‘, è¦åˆ†æˆå¾ˆå¤šä¸ªä¸´æ—¶æ–‡ä»¶, æŽ’åºçš„æ€§èƒ½ä¼šå¾ˆå·®.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥å¦‚æžœå•è¡Œå¾ˆå¤§, è¿™ä¸ªæ–¹æ³•æ•ˆçŽ‡ä¸å¤Ÿå¥½. é‚£ä¹ˆ**å¦‚æžœ MySQL è®¤ä¸ºæŽ’åºçš„å•è¡Œé•¿åº¦å¤ªå¤§ä¼šæ€Žä¹ˆåšå‘¢? **")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, æ¥ä¿®æ”¹ä¸€ä¸ªå‚æ•°, è®© MySQL é‡‡ç”¨å¦å¤–ä¸€ç§ç®—æ³•.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" max_length_for_sort_data "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("max_length_for_sort_data, æ˜¯ MySQL ä¸­ä¸“é—¨æŽ§åˆ¶ç”¨äºŽæŽ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦çš„ä¸€ä¸ªå‚æ•°. å®ƒçš„æ„æ€æ˜¯, å¦‚æžœå•è¡Œçš„é•¿åº¦è¶…è¿‡è¿™ä¸ªå€¼, MySQL å°±è®¤ä¸ºå•è¡Œå¤ªå¤§, è¦æ¢ä¸€ä¸ªç®—æ³•.")])]),s._v(" "),t("p",[s._v("city, name, age è¿™ä¸‰ä¸ªå­—æ®µçš„å®šä¹‰æ€»é•¿åº¦æ˜¯ 36, è¿™é‡ŒæŠŠ max_length_for_sort_data è®¾ç½®ä¸º 16, å†æ¥çœ‹çœ‹è®¡ç®—è¿‡ç¨‹æœ‰ä»€ä¹ˆæ”¹å˜.")]),s._v(" "),t("p",[s._v("æ–°çš„ç®—æ³•æ”¾å…¥ sort_buffer çš„å­—æ®µ, åªæœ‰è¦æŽ’åºçš„åˆ—(å³ name å­—æ®µ)å’Œä¸»é”® id.")]),s._v(" "),t("p",[s._v("ä½†è¿™æ—¶, æŽ’åºçš„ç»“æžœå°±å› ä¸ºå°‘äº† city å’Œ age å­—æ®µçš„å€¼, "),t("strong",[s._v("ä¸èƒ½ç›´æŽ¥è¿”å›ž")]),s._v("äº†, æ•´ä¸ªæ‰§è¡Œæµç¨‹å°±å˜æˆå¦‚ä¸‹æ‰€ç¤ºçš„æ ·å­:")]),s._v(" "),t("ol",[t("li",[s._v("åˆå§‹åŒ– sort_buffer, ç¡®å®šæ”¾å…¥ä¸¤ä¸ªå­—æ®µ, å³ name å’Œ id;")]),s._v(" "),t("li",[s._v("ä»Žç´¢å¼• city æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city='æ­å·ž' æ¡ä»¶çš„ä¸»é”® id, ä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_X;")]),s._v(" "),t("li",[s._v("åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œ, å– name, id è¿™ä¸¤ä¸ªå­—æ®µ, å­˜å…¥ sort_buffer ä¸­;")]),s._v(" "),t("li",[s._v("ä»Žç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”® id;")]),s._v(" "),t("li",[s._v("é‡å¤æ­¥éª¤ 3, 4 ç›´åˆ°ä¸æ»¡è¶³ city='æ­å·ž' æ¡ä»¶ä¸ºæ­¢, ä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_Y;")]),s._v(" "),t("li",[s._v("å¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ name è¿›è¡ŒæŽ’åº;")]),s._v(" "),t("li",[t("strong",[s._v("éåŽ†æŽ’åºç»“æžœ, å–å‰ 1000 è¡Œ, å¹¶æŒ‰ç…§ id çš„å€¼å›žåˆ°åŽŸè¡¨ä¸­å–å‡º city, name å’Œ age ä¸‰ä¸ªå­—æ®µè¿”å›žç»™å®¢æˆ·ç«¯.")])])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ‰§è¡Œæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹, æˆ‘æŠŠå®ƒç§°ä¸º "),t("strong",[s._v("rowid æŽ’åº")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/115a958bc5111c855d2cd013b178e706-20230731161914-w3ipott.png",alt:"",title:"rowid æŽ’åº"}})]),s._v(" "),t("p",[s._v("å¯¹æ¯”å…¨å­—æ®µæŽ’åºæµç¨‹å›¾ä½ ä¼šå‘çŽ°, "),t("strong",[s._v("rowid æŽ’åºå¤šè®¿é—®äº†ä¸€æ¬¡è¡¨ t çš„ä¸»é”®ç´¢å¼•, å°±æ˜¯æ­¥éª¤ 7")]),s._v(".")]),s._v(" "),t("p",[s._v('éœ€è¦è¯´æ˜Žçš„æ˜¯, æœ€åŽçš„"ç»“æžœé›†"æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µ, å®žé™…ä¸Š MySQL æœåŠ¡ç«¯ä»ŽæŽ’åºåŽçš„ sort_buffer ä¸­ä¾æ¬¡å–å‡º id, ç„¶åŽåˆ°åŽŸè¡¨æŸ¥åˆ° city, name å’Œ age è¿™ä¸‰ä¸ªå­—æ®µçš„ç»“æžœ, '),t("strong",[s._v("ä¸éœ€è¦åœ¨æœåŠ¡ç«¯å†è€—è´¹å†…å­˜å­˜å‚¨ç»“æžœ")]),s._v(", æ˜¯ç›´æŽ¥è¿”å›žç»™å®¢æˆ·ç«¯çš„.")]),s._v(" "),t("p",[s._v("æ ¹æ®è¿™ä¸ªè¯´æ˜Žè¿‡ç¨‹å’Œå›¾ç¤º, å¯ä»¥æƒ³ä¸€ä¸‹, è¿™ä¸ªæ—¶å€™æ‰§è¡Œ select @b-@a, ç»“æžœä¼šæ˜¯å¤šå°‘å‘¢?")]),s._v(" "),t("p",[s._v("çŽ°åœ¨å°±æ¥çœ‹çœ‹ç»“æžœæœ‰ä»€ä¹ˆä¸åŒ. é¦–å…ˆ, å›¾ä¸­çš„ examined_rows çš„å€¼è¿˜æ˜¯ 4000, è¡¨ç¤ºç”¨äºŽæŽ’åºçš„æ•°æ®æ˜¯ 4000 è¡Œ. ä½†æ˜¯ select @b-@a è¿™ä¸ªè¯­å¥çš„å€¼å˜æˆ 5000 äº†.")]),s._v(" "),t("p",[s._v("å› ä¸ºè¿™æ—¶å€™é™¤äº†æŽ’åºè¿‡ç¨‹å¤–, åœ¨æŽ’åºå®ŒæˆåŽ, è¿˜è¦æ ¹æ® id åŽ»åŽŸè¡¨å–å€¼. "),t("strong",[s._v("ç”±äºŽè¯­å¥æ˜¯ limit 1000, å› æ­¤ä¼šå¤šè¯» 1000 è¡Œ")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3b023f03d1cbb9e6c118ad0b915c22a2-20230731161914-udba6du.png",alt:"",title:"rowid æŽ’åºçš„ OPTIMIZER_TRACE éƒ¨åˆ†è¾“å‡º"}})]),s._v(" "),t("p",[s._v("ä»Ž OPTIMIZER_TRACE çš„ç»“æžœä¸­, è¿˜èƒ½çœ‹åˆ°å¦å¤–ä¸¤ä¸ªä¿¡æ¯ä¹Ÿå˜äº†.")]),s._v(" "),t("ul",[t("li",[s._v("sort_mode å˜æˆäº† "),t("code",[s._v("<sort_key, rowid>")]),s._v("â€‹, è¡¨ç¤º"),t("strong",[s._v("å‚ä¸ŽæŽ’åºçš„åªæœ‰ name å’Œ id è¿™ä¸¤ä¸ªå­—æ®µ")]),s._v(".")]),s._v(" "),t("li",[s._v("number_of_tmp_files å˜æˆ 10 äº†, æ˜¯å› ä¸ºè¿™æ—¶å€™å‚ä¸ŽæŽ’åºçš„è¡Œæ•°è™½ç„¶ä»ç„¶æ˜¯ 4000 è¡Œ, ä½†æ˜¯æ¯ä¸€è¡Œéƒ½å˜å°äº†, å› æ­¤éœ€è¦æŽ’åºçš„æ€»æ•°æ®é‡å°±å˜å°äº†, éœ€è¦çš„"),t("strong",[s._v("ä¸´æ—¶æ–‡ä»¶ä¹Ÿç›¸åº”åœ°å˜å°‘")]),s._v("äº†.")])]),s._v(" "),t("h5",{attrs:{id:"å…¨å­—æ®µæŽ’åºå¯¹æ¯”rowidæŽ’åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¨å­—æ®µæŽ’åºå¯¹æ¯”rowidæŽ’åº"}},[s._v("#")]),s._v(" å…¨å­—æ®µæŽ’åºå¯¹æ¯”rowidæŽ’åº")]),s._v(" "),t("p",[s._v("è¿™é‡Œæ¥åˆ†æžä¸€ä¸‹, ä»Žè¿™ä¸¤ä¸ªæ‰§è¡Œæµç¨‹é‡Œ, è¿˜èƒ½å¾—å‡ºä»€ä¹ˆç»“è®º.")]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æžœ MySQL å®žåœ¨æ˜¯æ‹…å¿ƒæŽ’åºå†…å­˜å¤ªå°, ä¼šå½±å“æŽ’åºæ•ˆçŽ‡, æ‰ä¼šé‡‡ç”¨ rowid æŽ’åºç®—æ³•, è¿™æ ·æŽ’åºè¿‡ç¨‹ä¸­ä¸€æ¬¡å¯ä»¥æŽ’åºæ›´å¤šè¡Œ, ä½†æ˜¯éœ€è¦å†å›žåˆ°åŽŸè¡¨åŽ»å–æ•°æ®.")])]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æžœ MySQL è®¤ä¸ºå†…å­˜è¶³å¤Ÿå¤§, ä¼šä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæŽ’åº, æŠŠéœ€è¦çš„å­—æ®µéƒ½æ”¾åˆ° sort_buffer ä¸­, è¿™æ ·æŽ’åºåŽå°±ä¼šç›´æŽ¥ä»Žå†…å­˜é‡Œé¢è¿”å›žæŸ¥è¯¢ç»“æžœäº†, ä¸ç”¨å†å›žåˆ°åŽŸè¡¨åŽ»å–æ•°æ®.")])]),s._v(" "),t("p",[s._v("è¿™ä¹Ÿå°±ä½“çŽ°äº† MySQL çš„ä¸€ä¸ªè®¾è®¡æ€æƒ³: "),t("mark",[t("strong",[s._v("å¦‚æžœå†…å­˜å¤Ÿ, å°±è¦å¤šåˆ©ç”¨å†…å­˜, å°½é‡å‡å°‘ç£ç›˜è®¿é—®")])]),s._v("â€‹ **. ** å¯¹äºŽ InnoDB è¡¨æ¥è¯´, rowid æŽ’åºä¼šè¦æ±‚å›žè¡¨å¤šé€ æˆç£ç›˜è¯», å› æ­¤ä¸ä¼šè¢«ä¼˜å…ˆé€‰æ‹©.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªç»“è®ºçœ‹ä¸ŠåŽ»æœ‰ç‚¹åºŸè¯çš„æ„Ÿè§‰, ä½†æ˜¯ä½ è¦è®°ä½å®ƒ, ä¸‹ä¸€èŠ‚å°±ä¼šç”¨åˆ°.")]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™é‡Œ, ä½ å°±äº†è§£äº†, MySQL åšæŽ’åºæ˜¯ä¸€ä¸ªæˆæœ¬æ¯”è¾ƒé«˜çš„æ“ä½œ. é‚£ä¹ˆä½ ä¼šé—®, æ˜¯ä¸æ˜¯æ‰€æœ‰çš„ order by éƒ½éœ€è¦æŽ’åºæ“ä½œå‘¢? "),t("strong",[s._v("å¦‚æžœä¸æŽ’åºå°±èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æžœ, é‚£å¯¹ç³»ç»Ÿçš„æ¶ˆè€—ä¼šå°å¾ˆå¤š, è¯­å¥çš„æ‰§è¡Œæ—¶é—´ä¹Ÿä¼šå˜å¾—æ›´çŸ­")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶å®ž, å¹¶ä¸æ˜¯æ‰€æœ‰çš„ order by è¯­å¥, éƒ½éœ€è¦æŽ’åºæ“ä½œçš„. ä»Žä¸Šé¢åˆ†æžçš„æ‰§è¡Œè¿‡ç¨‹, å¯ä»¥çœ‹åˆ°, MySQL ä¹‹æ‰€ä»¥éœ€è¦ç”Ÿæˆä¸´æ—¶è¡¨, å¹¶ä¸”åœ¨ä¸´æ—¶è¡¨ä¸ŠåšæŽ’åºæ“ä½œ, **å…¶åŽŸå› æ˜¯åŽŸæ¥çš„æ•°æ®éƒ½æ˜¯æ— åºçš„. ** å¯ä»¥è®¾æƒ³ä¸‹, å¦‚æžœèƒ½å¤Ÿä¿è¯ä»Ž city è¿™ä¸ªç´¢å¼•ä¸Šå–å‡ºæ¥çš„è¡Œ, å¤©ç„¶å°±æ˜¯æŒ‰ç…§ name é€’å¢žæŽ’åºçš„è¯, æ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨å†æŽ’åºäº†å‘¢?")]),s._v(" "),t("p",[s._v("ç¡®å®žæ˜¯è¿™æ ·çš„.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, å¯ä»¥åœ¨è¿™ä¸ªå¸‚æ°‘è¡¨ä¸Šåˆ›å»ºä¸€ä¸ª city å’Œ name çš„"),t("strong",[s._v("è”åˆç´¢å¼•")]),s._v(", å¯¹åº”çš„ SQL è¯­å¥æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" city_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä½œä¸ºä¸Ž city ç´¢å¼•çš„å¯¹æ¯”, æ¥çœ‹çœ‹è¿™ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/16ce2b017db519e669206c73ed4dda3e-20230731161914-r6l39gi.png",alt:"",title:"city å’Œ name è”åˆç´¢å¼•ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªç´¢å¼•é‡Œé¢, ä¾ç„¶å¯ä»¥ç”¨æ ‘æœç´¢çš„æ–¹å¼å®šä½åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city='æ­å·ž' çš„è®°å½•, å¹¶ä¸”"),t("strong",[s._v('é¢å¤–ç¡®ä¿äº†, æŽ¥ä¸‹æ¥æŒ‰é¡ºåºå–"ä¸‹ä¸€æ¡è®°å½•"çš„éåŽ†è¿‡ç¨‹ä¸­, åªè¦ city çš„å€¼æ˜¯æ­å·ž, name çš„å€¼å°±ä¸€å®šæ˜¯æœ‰åºçš„')]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ ·æ•´ä¸ªæŸ¥è¯¢è¿‡ç¨‹çš„æµç¨‹å°±å˜æˆäº†:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Žç´¢å¼• (city,name) æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city='æ­å·ž' æ¡ä»¶çš„ä¸»é”® id;")]),s._v(" "),t("li",[s._v("åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œ, å– name, city, age ä¸‰ä¸ªå­—æ®µçš„å€¼, ä½œä¸ºç»“æžœé›†çš„ä¸€éƒ¨åˆ†ç›´æŽ¥è¿”å›ž;")]),s._v(" "),t("li",[s._v("ä»Žç´¢å¼• (city,name) å–ä¸‹ä¸€ä¸ªè®°å½•ä¸»é”® id;")]),s._v(" "),t("li",[s._v("é‡å¤æ­¥éª¤ 2, 3, ç›´åˆ°æŸ¥åˆ°ç¬¬ 1000 æ¡è®°å½•, æˆ–è€…æ˜¯ä¸æ»¡è¶³ city='æ­å·ž' æ¡ä»¶æ—¶å¾ªçŽ¯ç»“æŸ.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/06d0ae33f2c9b15358551f0d73062519-20230731161914-5jugzzf.png",alt:"",title:"å¼•å…¥ (city,name) è”åˆç´¢å¼•åŽ, æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹"),t("strong",[s._v("ä¸éœ€è¦ä¸´æ—¶è¡¨, ä¹Ÿä¸éœ€è¦æŽ’åº")]),s._v(". æŽ¥ä¸‹æ¥ç”¨ explain çš„ç»“æžœæ¥å°è¯ä¸€ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/745808a3c9357b70af6b7a30052c953d-20230731161914-443krzd.png",alt:"",title:"å¼•å…¥ (city,name) è”åˆç´¢å¼•åŽ, æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, Extra å­—æ®µä¸­æ²¡æœ‰ Using filesort äº†, ä¹Ÿå°±æ˜¯ä¸éœ€è¦æŽ’åºäº†. è€Œä¸”ç”±äºŽ (city,name) è¿™ä¸ª"),t("strong",[s._v("è”åˆç´¢å¼•æœ¬èº«æœ‰åº")]),s._v(", æ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢ä¹Ÿä¸ç”¨æŠŠ 4000 è¡Œå…¨éƒ½è¯»ä¸€é, åªè¦æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å‰ 1000 æ¡è®°å½•å°±å¯ä»¥é€€å‡ºäº†. ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªä¾‹å­é‡Œ, åªéœ€è¦æ‰«æ 1000 æ¬¡.")]),s._v(" "),t("p",[s._v("æ—¢ç„¶è¯´åˆ°è¿™é‡Œäº†, å†å¾€å‰è®¨è®º, "),t("strong",[s._v("è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æœ‰æ²¡æœ‰å¯èƒ½è¿›ä¸€æ­¥ç®€åŒ–å‘¢? ** ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—å‰é¢ä»‹ç»çš„")]),s._v("è¦†ç›–ç´¢å¼•**. ç¨å¾®å¤ä¹ ä¸€ä¸‹. **è¦†ç›–ç´¢å¼•æ˜¯æŒ‡, ç´¢å¼•ä¸Šçš„ä¿¡æ¯è¶³å¤Ÿæ»¡è¶³æŸ¥è¯¢è¯·æ±‚, ä¸éœ€è¦å†å›žåˆ°ä¸»é”®ç´¢å¼•ä¸ŠåŽ»å–æ•°æ®. **")]),s._v(" "),t("p",[s._v("æŒ‰ç…§è¦†ç›–ç´¢å¼•çš„æ¦‚å¿µ, å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹.")]),s._v(" "),t("p",[s._v("é’ˆå¯¹è¿™ä¸ªæŸ¥è¯¢, å¯ä»¥åˆ›å»ºä¸€ä¸ª city, name å’Œ age çš„è”åˆç´¢å¼•, å¯¹åº”çš„ SQL è¯­å¥å°±æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" city_user_age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ—¶å¯¹äºŽ city å­—æ®µçš„å€¼ç›¸åŒçš„è¡Œæ¥è¯´, è¿˜æ˜¯æŒ‰ç…§ name å­—æ®µçš„å€¼é€’å¢žæŽ’åºçš„, æ­¤æ—¶çš„æŸ¥è¯¢è¯­å¥ä¹Ÿå°±ä¸å†éœ€è¦æŽ’åºäº†. è¿™æ ·æ•´ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹å°±å˜æˆäº†:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Žç´¢å¼• (city,name,age) æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city='æ­å·ž' æ¡ä»¶çš„è®°å½•, å–å‡ºå…¶ä¸­çš„ city, name å’Œ age è¿™ä¸‰ä¸ªå­—æ®µçš„å€¼, ä½œä¸ºç»“æžœé›†çš„ä¸€éƒ¨åˆ†"),t("strong",[s._v("ç›´æŽ¥è¿”å›ž")]),s._v(";")]),s._v(" "),t("li",[s._v("ä»Žç´¢å¼• (city,name,age) å–ä¸‹ä¸€ä¸ªè®°å½•, åŒæ ·å–å‡ºè¿™ä¸‰ä¸ªå­—æ®µçš„å€¼, ä½œä¸ºç»“æžœé›†çš„ä¸€éƒ¨åˆ†ç›´æŽ¥è¿”å›ž;")]),s._v(" "),t("li",[s._v("é‡å¤æ‰§è¡Œæ­¥éª¤ 2, ç›´åˆ°æŸ¥åˆ°ç¬¬ 1000 æ¡è®°å½•, æˆ–è€…æ˜¯ä¸æ»¡è¶³ city='æ­å·ž' æ¡ä»¶æ—¶å¾ªçŽ¯ç»“æŸ.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f701d2103cd4fa04b615609bf69cbba5-20230731161914-gep1mws.png",alt:"",title:"å¼•å…¥ (city,name,age) è”åˆç´¢å¼•åŽ, æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("ç„¶åŽå†æ¥çœ‹çœ‹ explain çš„ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2cffc9239088580deb2dba4c03204fd2-20230731161914-mxhiz2w.png",alt:"",title:"å¼•å…¥ (city,name,age) è”åˆç´¢å¼•åŽ, æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’"}})]),s._v(" "),t("p",[s._v('å¯ä»¥çœ‹åˆ°, Extra å­—æ®µé‡Œé¢å¤šäº† "'),t("strong",[s._v("Using index")]),s._v('", è¡¨ç¤ºçš„å°±æ˜¯ä½¿ç”¨äº†'),t("strong",[s._v("è¦†ç›–ç´¢å¼•")]),s._v(", æ€§èƒ½ä¸Šä¼šå¿«å¾ˆå¤š.")]),s._v(" "),t("p",[s._v("å½“ç„¶, è¿™é‡Œå¹¶ä¸æ˜¯è¯´è¦ä¸ºäº†æ¯ä¸ªæŸ¥è¯¢èƒ½ç”¨ä¸Šè¦†ç›–ç´¢å¼•, å°±è¦æŠŠè¯­å¥ä¸­æ¶‰åŠçš„å­—æ®µéƒ½å»ºä¸Šè”åˆç´¢å¼•, æ¯•ç«Ÿç´¢å¼•è¿˜æ˜¯æœ‰ç»´æŠ¤ä»£ä»·çš„. è¿™æ˜¯ä¸€ä¸ªéœ€è¦"),t("strong",[s._v("æƒè¡¡")]),s._v("çš„å†³å®š.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-15"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-15"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL é‡Œé¢ order by è¯­å¥çš„å‡ ç§ç®—æ³•æµç¨‹. åœ¨å¼€å‘ç³»ç»Ÿçš„æ—¶å€™, æ€»æ˜¯ä¸å¯é¿å…åœ°ä¼šä½¿ç”¨åˆ° order by è¯­å¥. å¿ƒé‡Œè¦æ¸…æ¥šæ¯ä¸ªè¯­å¥çš„æŽ’åºé€»è¾‘æ˜¯æ€Žä¹ˆå®žçŽ°çš„, è¿˜è¦èƒ½å¤Ÿåˆ†æžå‡ºåœ¨æœ€åæƒ…å†µä¸‹, æ¯ä¸ªè¯­å¥çš„æ‰§è¡Œå¯¹ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—, è¿™æ ·æ‰èƒ½åšåˆ°ä¸‹ç¬”å¦‚æœ‰ç¥ž, ä¸çŠ¯ä½Žçº§é”™è¯¯.")]),s._v(" "),t("h4",{attrs:{id:"_17-å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_17-å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯"}},[s._v("#")]),s._v(" 17-å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚ä»‹ç»å®Œ order by è¯­å¥çš„å‡ ç§æ‰§è¡Œæ¨¡å¼åŽ, å°±æƒ³åˆ°äº†ä¹‹å‰ä¸€ä¸ªåšè‹±è¯­å­¦ä¹  App çš„æœ‹å‹ç¢°åˆ°è¿‡çš„ä¸€ä¸ªæ€§èƒ½é—®é¢˜. æœ¬èŠ‚å°±ä»Žè¿™ä¸ªæ€§èƒ½é—®é¢˜è¯´èµ·, æ¥è¯´è¯´ MySQL ä¸­çš„å¦å¤–ä¸€ç§"),t("strong",[s._v("æŽ’åºéœ€æ±‚")]),s._v(", å¸Œæœ›èƒ½å¤ŸåŠ æ·±ä½ å¯¹ MySQL æŽ’åºé€»è¾‘çš„ç†è§£.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªè‹±è¯­å­¦ä¹  App é¦–é¡µæœ‰ä¸€ä¸ªéšæœºæ˜¾ç¤ºå•è¯çš„åŠŸèƒ½, ä¹Ÿå°±æ˜¯æ ¹æ®æ¯ä¸ªç”¨æˆ·çš„çº§åˆ«æœ‰ä¸€ä¸ªå•è¯è¡¨, ç„¶åŽè¿™ä¸ªç”¨æˆ·æ¯æ¬¡è®¿é—®é¦–é¡µçš„æ—¶å€™, éƒ½ä¼šéšæœºæ»šåŠ¨æ˜¾ç¤ºä¸‰ä¸ªå•è¯. ä»–ä»¬å‘çŽ°éšç€å•è¯è¡¨å˜å¤§, é€‰å•è¯è¿™ä¸ªé€»è¾‘å˜å¾—è¶Šæ¥è¶Šæ…¢, ç”šè‡³å½±å“åˆ°äº†é¦–é¡µçš„æ‰“å¼€é€Ÿåº¦.")]),s._v(" "),t("p",[s._v("å¦‚æžœè®©ä½ æ¥è®¾è®¡è¿™ä¸ª SQL è¯­å¥, ä½ ä¼šæ€Žä¹ˆå†™?")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽç†è§£, å¯¹è¿™ä¸ªä¾‹å­è¿›è¡Œç®€åŒ–: åŽ»æŽ‰æ¯ä¸ªçº§åˆ«çš„ç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å•è¯è¡¨è¿™ä¸ªé€»è¾‘, ç›´æŽ¥å°±æ˜¯ä»Žä¸€ä¸ªå•è¯è¡¨ä¸­éšæœºé€‰å‡ºä¸‰ä¸ªå•è¯. è¿™ä¸ªè¡¨çš„å»ºè¡¨è¯­å¥å’Œåˆå§‹æ•°æ®çš„å‘½ä»¤å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("words"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("word"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" words"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("word"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("concat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("97")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("div")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("97")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("div")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("97")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("div")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("97")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("ä¸ºäº†ä¾¿äºŽé‡åŒ–è¯´æ˜Ž, åœ¨è¿™ä¸ªè¡¨é‡Œé¢æ’å…¥äº† 10000 è¡Œè®°å½•. æŽ¥ä¸‹æ¥å°±ä¸€èµ·çœ‹çœ‹è¦éšæœºé€‰æ‹© 3 ä¸ªå•è¯, æœ‰ä»€ä¹ˆæ–¹æ³•å®žçŽ°, å­˜åœ¨ä»€ä¹ˆé—®é¢˜ä»¥åŠå¦‚ä½•æ”¹è¿›.")]),s._v(" "),t("h5",{attrs:{id:"å†…å­˜ä¸´æ—¶è¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜ä¸´æ—¶è¡¨"}},[s._v("#")]),s._v(" å†…å­˜ä¸´æ—¶è¡¨")]),s._v(" "),t("p",[s._v("é¦–å…ˆ, ä½ ä¼šæƒ³åˆ°ç”¨ order by rand() æ¥å®žçŽ°è¿™ä¸ªé€»è¾‘.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" word "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" words "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¯­å¥çš„æ„æ€å¾ˆç›´ç™½, éšæœºæŽ’åºå–å‰ 3 ä¸ª. è™½ç„¶è¿™ä¸ª SQL è¯­å¥å†™æ³•å¾ˆç®€å•, ä½†æ‰§è¡Œæµç¨‹å´æœ‰ç‚¹å¤æ‚. å…ˆç”¨ explain å‘½ä»¤æ¥çœ‹çœ‹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæƒ…å†µ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/02a0eb6b8ae0d35ddb44ec69af49ed6e-20230731161914-jfduyg0.png",alt:""}})]),s._v(" "),t("p",[s._v("Extra å­—æ®µæ˜¾ç¤º Using temporary, è¡¨ç¤ºçš„æ˜¯éœ€è¦ä½¿ç”¨"),t("strong",[s._v("ä¸´æ—¶è¡¨")]),s._v("; Using filesort, è¡¨ç¤ºçš„æ˜¯éœ€è¦æ‰§è¡Œ"),t("strong",[s._v("æŽ’åºæ“ä½œ")]),s._v(".  å› æ­¤è¿™ä¸ª Extra çš„æ„æ€å°±æ˜¯, éœ€è¦ä¸´æ—¶è¡¨, å¹¶ä¸”éœ€è¦åœ¨ä¸´æ—¶è¡¨ä¸ŠæŽ’åº.")]),s._v(" "),t("p",[s._v("è¿™é‡Œå¯ä»¥å…ˆå›žé¡¾ä¸€ä¸‹å‰é¢â€‹"),t("strong",[s._v("å…¨å­—æ®µæŽ’åºå’Œ rowid æŽ’åº")]),s._v("çš„å†…å®¹. ç„¶åŽ, æˆ‘å†é—®ä½ ä¸€ä¸ªé—®é¢˜, ä½ è§‰å¾—å¯¹äºŽä¸´æ—¶å†…å­˜è¡¨çš„æŽ’åºæ¥è¯´, å®ƒä¼šé€‰æ‹©å“ªä¸€ç§ç®—æ³•å‘¢?")]),s._v(" "),t("p",[s._v("å›žé¡¾ä¸€ä¸‹ä¸Šä¸€èŠ‚çš„ä¸€ä¸ªç»“è®º: "),t("strong",[s._v("å¯¹äºŽ InnoDB è¡¨æ¥è¯´")]),s._v(', æ‰§è¡Œå…¨å­—æ®µæŽ’åºä¼šå‡å°‘ç£ç›˜è®¿é—®, å› æ­¤ä¼šè¢«ä¼˜å…ˆé€‰æ‹©. è¿™é‡Œå¼ºè°ƒäº† "InnoDB è¡¨", ä½ è‚¯å®šæƒ³åˆ°äº†, '),t("strong",[s._v("å¯¹äºŽå†…å­˜è¡¨, å›žè¡¨è¿‡ç¨‹åªæ˜¯ç®€å•åœ°æ ¹æ®æ•°æ®è¡Œçš„ä½ç½®, ç›´æŽ¥è®¿é—®å†…å­˜å¾—åˆ°æ•°æ®, æ ¹æœ¬ä¸ä¼šå¯¼è‡´å¤šè®¿é—®ç£ç›˜")]),s._v(". ä¼˜åŒ–å™¨æ²¡æœ‰äº†è¿™ä¸€å±‚é¡¾è™‘, é‚£ä¹ˆå®ƒä¼šä¼˜å…ˆè€ƒè™‘çš„, å°±æ˜¯ç”¨äºŽæŽ’åºçš„è¡Œè¶Šå°è¶Šå¥½äº†, æ‰€ä»¥ MySQL è¿™æ—¶å°±ä¼šé€‰æ‹© rowid æŽ’åº.")]),s._v(" "),t("p",[s._v("ç†è§£äº†è¿™ä¸ªç®—æ³•é€‰æ‹©çš„é€»è¾‘, å†æ¥çœ‹çœ‹è¯­å¥çš„æ‰§è¡Œæµç¨‹. åŒæ—¶é€šè¿‡ä»Šå¤©çš„è¿™ä¸ªä¾‹å­, æ¥å°è¯•åˆ†æžä¸€ä¸‹è¯­å¥çš„æ‰«æè¡Œæ•°.")]),s._v(" "),t("p",[s._v("è¿™æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨")]),s._v(". è¿™ä¸ªä¸´æ—¶è¡¨ä½¿ç”¨çš„æ˜¯ memory å¼•æ“Ž, è¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µ, ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ double ç±»åž‹, ä¸ºäº†åŽé¢æè¿°æ–¹ä¾¿, è®°ä¸ºå­—æ®µ R, ç¬¬äºŒä¸ªå­—æ®µæ˜¯ varchar(64) ç±»åž‹, è®°ä¸ºå­—æ®µ W. å¹¶ä¸”è¿™ä¸ªè¡¨æ²¡æœ‰å»ºç´¢å¼•.")]),s._v(" "),t("li",[s._v("ä»Ž words è¡¨ä¸­, æŒ‰ä¸»é”®é¡ºåºå–å‡ºæ‰€æœ‰çš„ word å€¼. å¯¹äºŽæ¯ä¸€ä¸ª word å€¼, è°ƒç”¨ rand() å‡½æ•°ç”Ÿæˆä¸€ä¸ªå¤§äºŽ 0 å°äºŽ 1 çš„éšæœºå°æ•°, å¹¶æŠŠè¿™ä¸ªéšæœºå°æ•°å’Œ word åˆ†åˆ«å­˜å…¥ä¸´æ—¶è¡¨çš„ R å’Œ W å­—æ®µä¸­, åˆ°æ­¤æ‰«æè¡Œæ•°æ˜¯ 10000.")]),s._v(" "),t("li",[s._v("çŽ°åœ¨ä¸´æ—¶è¡¨æœ‰ 10000 è¡Œæ•°æ®äº†, æŽ¥ä¸‹æ¥è¦åœ¨è¿™ä¸ª"),t("strong",[s._v("æ²¡æœ‰ç´¢å¼•çš„å†…å­˜ä¸´æ—¶è¡¨ä¸Š, æŒ‰ç…§å­—æ®µ R æŽ’åº")]),s._v(".")]),s._v(" "),t("li",[s._v("åˆå§‹åŒ– sort_buffer. sort_buffer ä¸­æœ‰ä¸¤ä¸ªå­—æ®µ, ä¸€ä¸ªæ˜¯ double ç±»åž‹, å¦ä¸€ä¸ªæ˜¯æ•´åž‹.")]),s._v(" "),t("li",[s._v('ä»Žå†…å­˜ä¸´æ—¶è¡¨ä¸­ä¸€è¡Œä¸€è¡Œåœ°å–å‡º R å€¼å’Œä½ç½®ä¿¡æ¯(åŽé¢ä¼šè§£é‡Šè¿™é‡Œä¸ºä»€ä¹ˆæ˜¯"ä½ç½®ä¿¡æ¯"), åˆ†åˆ«å­˜å…¥ sort_buffer ä¸­çš„ä¸¤ä¸ªå­—æ®µé‡Œ. è¿™ä¸ªè¿‡ç¨‹è¦'),t("strong",[s._v("å¯¹å†…å­˜ä¸´æ—¶è¡¨åšå…¨è¡¨æ‰«æ")]),s._v(", æ­¤æ—¶æ‰«æè¡Œæ•°å¢žåŠ  10000, å˜æˆäº† 20000.")]),s._v(" "),t("li",[s._v("åœ¨ sort_buffer ä¸­æ ¹æ® R çš„å€¼è¿›è¡ŒæŽ’åº. æ³¨æ„è¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰æ¶‰åŠåˆ°è¡¨æ“ä½œ, æ‰€ä»¥ä¸ä¼šå¢žåŠ æ‰«æè¡Œæ•°.")]),s._v(" "),t("li",[t("strong",[s._v("æŽ’åºå®ŒæˆåŽ, å–å‡ºå‰ä¸‰ä¸ªç»“æžœçš„ä½ç½®ä¿¡æ¯, ä¾æ¬¡åˆ°å†…å­˜ä¸´æ—¶è¡¨ä¸­å–å‡º word å€¼, è¿”å›žç»™å®¢æˆ·ç«¯")]),s._v(". è¿™ä¸ªè¿‡ç¨‹ä¸­, è®¿é—®äº†è¡¨çš„ä¸‰è¡Œæ•°æ®, æ€»æ‰«æè¡Œæ•°å˜æˆäº† 20003.")])]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—(slow log)æ¥éªŒè¯ä¸€ä¸‹åˆ†æžå¾—åˆ°çš„æ‰«æè¡Œæ•°æ˜¯å¦æ­£ç¡®.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Query_time: 0.900376  Lock_time: 0.000347 Rows_sent: 3 Rows_examined: 20003")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1541402277")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" word "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" words "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å…¶ä¸­, Rows_examined: 20003 å°±è¡¨ç¤ºè¿™ä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰«æäº† 20003 è¡Œ, ä¹Ÿå°±éªŒè¯äº†åˆ†æžå¾—å‡ºçš„ç»“è®º.")]),s._v(" "),t("p",[s._v("è¿™é‡Œæ’ä¸€å¥é¢˜å¤–è¯, åœ¨å¹³æ—¶å­¦ä¹ æ¦‚å¿µçš„è¿‡ç¨‹ä¸­, ä½ å¯ä»¥ç»å¸¸è¿™æ ·åš, "),t("strong",[s._v("å…ˆé€šè¿‡åŽŸç†åˆ†æžç®—å‡ºæ‰«æè¡Œæ•°, ç„¶åŽå†é€šè¿‡æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—, æ¥éªŒè¯è‡ªå·±çš„ç»“è®º")]),s._v(". æˆ‘è‡ªå·±å°±æ˜¯ç»å¸¸è¿™ä¹ˆåš, è¿™ä¸ªè¿‡ç¨‹å¾ˆæœ‰è¶£, åˆ†æžå¯¹äº†å¼€å¿ƒ, åˆ†æžé”™äº†ä½†æ˜¯å¼„æ¸…æ¥šäº†ä¹Ÿå¾ˆå¼€å¿ƒ.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨æ¥æŠŠå®Œæ•´çš„æŽ’åºæ‰§è¡Œæµç¨‹å›¾ç”»å‡ºæ¥.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ed53b39890250247c88278bf711debb9-20230731161914-50cx73z.png",alt:"",title:"éšæœºæŽ’åºå®Œæ•´æµç¨‹å›¾ 1"}})]),s._v(" "),t("p",[s._v('å›¾ä¸­çš„ pos å°±æ˜¯ä½ç½®ä¿¡æ¯, ä½ å¯èƒ½ä¼šè§‰å¾—å¥‡æ€ª, è¿™é‡Œçš„"ä½ç½®ä¿¡æ¯"æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µ? åœ¨ä¸Šä¸€èŠ‚ä¸­å¯¹ InnoDB è¡¨æŽ’åºçš„æ—¶å€™, æ˜Žæ˜Žç”¨çš„è¿˜æ˜¯ ID å­—æ®µ.')]),s._v(" "),t("p",[s._v('è¿™æ—¶å€™å°±è¦å›žåˆ°ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µ: **MySQL çš„è¡¨æ˜¯ç”¨ä»€ä¹ˆæ–¹æ³•æ¥å®šä½"ä¸€è¡Œæ•°æ®"çš„. **')]),s._v(" "),t("p",[s._v("åœ¨å‰é¢ä»‹ç»ç´¢å¼•çš„æ–‡ç« ä¸­, æœ‰å‡ ä½åŒå­¦é—®åˆ°, å¦‚æžœæŠŠä¸€ä¸ª InnoDB è¡¨çš„ä¸»é”®åˆ æŽ‰, æ˜¯ä¸æ˜¯å°±æ²¡æœ‰ä¸»é”®, å°±æ²¡åŠžæ³•å›žè¡¨äº†? å…¶å®žä¸æ˜¯çš„. å¦‚æžœåˆ›å»ºçš„è¡¨æ²¡æœ‰ä¸»é”®, æˆ–è€…æŠŠä¸€ä¸ªè¡¨çš„ä¸»é”®åˆ æŽ‰äº†, "),t("strong",[s._v("é‚£ä¹ˆ InnoDB ä¼šè‡ªå·±ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º 6 å­—èŠ‚çš„ rowid æ¥ä½œä¸ºä¸»é”®")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¹Ÿå°±æ˜¯æŽ’åºæ¨¡å¼é‡Œé¢, rowid åå­—çš„æ¥åŽ†. å®žé™…ä¸Šå®ƒè¡¨ç¤ºçš„æ˜¯: "),t("strong",[s._v("æ¯ä¸ªå¼•æ“Žç”¨æ¥å”¯ä¸€æ ‡è¯†æ•°æ®è¡Œçš„ä¿¡æ¯")]),s._v(".")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å¯¹äºŽæœ‰ä¸»é”®çš„ InnoDB è¡¨æ¥è¯´, è¿™ä¸ª rowid å°±æ˜¯ä¸»é”® ID;")])]),s._v(" "),t("li",[t("strong",[s._v("å¯¹äºŽæ²¡æœ‰ä¸»é”®çš„ InnoDB è¡¨æ¥è¯´, è¿™ä¸ª rowid å°±æ˜¯ç”±ç³»ç»Ÿç”Ÿæˆçš„;")])]),s._v(" "),t("li",[s._v("MEMORY å¼•æ“Žä¸æ˜¯ç´¢å¼•ç»„ç»‡è¡¨. åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢, å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªæ•°ç»„. å› æ­¤è¿™ä¸ª rowid å…¶å®žå°±æ˜¯æ•°ç»„çš„ä¸‹æ ‡.")])]),s._v(" "),t("p",[s._v("ç¨å¾®å°ç»“ä¸€ä¸‹: **order by rand() ä½¿ç”¨äº†å†…å­˜ä¸´æ—¶è¡¨, å†…å­˜ä¸´æ—¶è¡¨æŽ’åºçš„æ—¶å€™ä½¿ç”¨äº† rowid æŽ’åºæ–¹æ³•. **")]),s._v(" "),t("h5",{attrs:{id:"ç£ç›˜ä¸´æ—¶è¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç£ç›˜ä¸´æ—¶è¡¨"}},[s._v("#")]),s._v(" ç£ç›˜ä¸´æ—¶è¡¨")]),s._v(" "),t("p",[s._v("é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰çš„ä¸´æ—¶è¡¨éƒ½æ˜¯å†…å­˜è¡¨å‘¢? å…¶å®žä¸æ˜¯çš„.")]),s._v(" "),t("p",[s._v("tmp_table_size è¿™ä¸ªé…ç½®é™åˆ¶äº†å†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°, é»˜è®¤å€¼æ˜¯ 16M. "),t("strong",[s._v("å¦‚æžœä¸´æ—¶è¡¨å¤§å°è¶…è¿‡äº† tmp_table_size, é‚£ä¹ˆå†…å­˜ä¸´æ—¶è¡¨å°±ä¼šè½¬æˆç£ç›˜ä¸´æ—¶è¡¨")]),s._v(". ç£ç›˜ä¸´æ—¶è¡¨ä½¿ç”¨çš„å¼•æ“Žé»˜è®¤æ˜¯ InnoDB, æ˜¯ç”±å‚æ•° "),t("strong",[s._v("internal_tmp_disk_storage_engine")]),s._v(" æŽ§åˆ¶çš„. å½“ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨çš„æ—¶å€™, å¯¹åº”çš„å°±æ˜¯ä¸€ä¸ª"),t("strong",[s._v("æ²¡æœ‰æ˜¾å¼ç´¢å¼•")]),s._v("çš„ InnoDB è¡¨çš„æŽ’åºè¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("ä¸ºäº†å¤çŽ°è¿™ä¸ªè¿‡ç¨‹, æŠŠ tmp_table_size è®¾ç½®æˆ 1024, æŠŠ sort_buffer_size è®¾ç½®æˆ 32768, æŠŠ max_length_for_sort_data è®¾ç½®æˆ 16.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" tmp_table_size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" sort_buffer_size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" max_length_for_sort_data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æ‰“å¼€ optimizer_trace, åªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" optimizer_trace"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'enabled=on'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æ‰§è¡Œè¯­å¥ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" word "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" words "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("information_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("OPTIMIZER_TRACE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v("\\G\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/548876594b582ad22bce5bf54289588b-20230731161914-rlf9nex.png",alt:"",title:"OPTIMIZER_TRACE éƒ¨åˆ†ç»“æžœ"}})]),s._v(" "),t("p",[s._v("ç„¶åŽæ¥çœ‹ä¸€ä¸‹è¿™æ¬¡ OPTIMIZER_TRACE çš„ç»“æžœ.")]),s._v(" "),t("p",[s._v("å› ä¸ºå°† max_length_for_sort_data è®¾ç½®æˆ 16, å°äºŽ word å­—æ®µçš„é•¿åº¦å®šä¹‰, æ‰€ä»¥çœ‹åˆ° sort_mode é‡Œé¢æ˜¾ç¤ºçš„æ˜¯ "),t("strong",[s._v("rowid æŽ’åº")]),s._v(", è¿™ä¸ªæ˜¯ç¬¦åˆé¢„æœŸçš„, å‚ä¸ŽæŽ’åºçš„æ˜¯éšæœºå€¼ R å­—æ®µå’Œ rowid å­—æ®µç»„æˆçš„è¡Œ.")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™ä½ å¯èƒ½å¿ƒç®—äº†ä¸€ä¸‹, å‘çŽ°ä¸å¯¹. R å­—æ®µå­˜æ”¾çš„éšæœºå€¼å°± 8 ä¸ªå­—èŠ‚, rowid æ˜¯ 6 ä¸ªå­—èŠ‚(è‡³äºŽä¸ºä»€ä¹ˆæ˜¯ 6 å­—èŠ‚, å°±ç•™ç»™ä½ è¯¾åŽæ€è€ƒå§), æ•°æ®æ€»è¡Œæ•°æ˜¯ 10000, è¿™æ ·ç®—å‡ºæ¥å°±æœ‰ 140000 å­—èŠ‚, è¶…è¿‡äº† sort_buffer_size å®šä¹‰çš„ 32768 å­—èŠ‚äº†. ä½†æ˜¯ number_of_tmp_files çš„å€¼å±…ç„¶æ˜¯ 0, éš¾é“ä¸éœ€è¦ç”¨ä¸´æ—¶æ–‡ä»¶å—?")]),s._v(" "),t("p",[t("strong",[s._v("è¿™ä¸ª SQL è¯­å¥çš„æŽ’åºç¡®å®žæ²¡æœ‰ç”¨åˆ°ä¸´æ—¶æ–‡ä»¶")]),s._v(", é‡‡ç”¨æ˜¯ MySQL 5.6 ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªæ–°çš„æŽ’åºç®—æ³•, å³: "),t("mark",[t("strong",[s._v("ä¼˜å…ˆé˜Ÿåˆ—æŽ’åºç®—æ³•")])]),s._v(". æŽ¥ä¸‹æ¥å°±çœ‹çœ‹ä¸ºä»€ä¹ˆæ²¡æœ‰ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶çš„ç®—æ³•, ä¹Ÿå°±æ˜¯å½’å¹¶æŽ’åºç®—æ³•, è€Œæ˜¯é‡‡ç”¨äº†ä¼˜å…ˆé˜Ÿåˆ—æŽ’åºç®—æ³•.")]),s._v(" "),t("p",[s._v("å…¶å®žçŽ°åœ¨çš„ SQL è¯­å¥, åªéœ€è¦å– R å€¼æœ€å°çš„ 3 ä¸ª rowid. ä½†æ˜¯, å¦‚æžœä½¿ç”¨å½’å¹¶æŽ’åºç®—æ³•çš„è¯, è™½ç„¶æœ€ç»ˆä¹Ÿèƒ½å¾—åˆ°å‰ 3 ä¸ªå€¼, ä½†æ˜¯è¿™ä¸ªç®—æ³•ç»“æŸåŽ, å·²ç»å°† 10000 è¡Œæ•°æ®éƒ½æŽ’å¥½åºäº†. ä¹Ÿå°±æ˜¯è¯´, åŽé¢çš„ 9997 è¡Œä¹Ÿæ˜¯æœ‰åºçš„äº†. ä½†æŸ¥è¯¢å¹¶ä¸éœ€è¦è¿™äº›æ•°æ®æ˜¯æœ‰åºçš„. æ‰€ä»¥è¿™"),t("strong",[s._v("æµªè´¹äº†éžå¸¸å¤šçš„è®¡ç®—é‡")]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œ"),t("strong",[s._v("ä¼˜å…ˆé˜Ÿåˆ—ç®—æ³•, å°±å¯ä»¥ç²¾ç¡®åœ°åªå¾—åˆ°ä¸‰ä¸ªæœ€å°å€¼")]),s._v(", æ‰§è¡Œæµç¨‹å¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("å¯¹äºŽè¿™ 10000 ä¸ªå‡†å¤‡æŽ’åºçš„ (R,rowid), å…ˆå–å‰ä¸‰è¡Œ, "),t("strong",[s._v("æž„é€ æˆä¸€ä¸ªå †")]),s._v(";")]),s._v(" "),t("li",[s._v("å–ä¸‹ä¸€ä¸ªè¡Œ (Râ€™,rowidâ€™), è·Ÿå½“å‰å †é‡Œé¢æœ€å¤§çš„ R æ¯”è¾ƒ, å¦‚æžœ Râ€™å°äºŽ R, æŠŠè¿™ä¸ª (R,rowid) ä»Žå †ä¸­åŽ»æŽ‰, æ¢æˆ (Râ€™,rowidâ€™);")]),s._v(" "),t("li",[s._v("é‡å¤ç¬¬ 2 æ­¥, ç›´åˆ°ç¬¬ 10000 ä¸ª (Râ€™,rowidâ€™) å®Œæˆæ¯”è¾ƒ.")])]),s._v(" "),t("p",[s._v("è¿™é‡Œç®€å•ç”»äº†ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—æŽ’åºè¿‡ç¨‹çš„ç¤ºæ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d979f181a42b066435d6a44c1c849317-20230731161914-d7t3ccc.png",alt:"",title:"ä¼˜å…ˆé˜Ÿåˆ—æŽ’åºç®—æ³•ç¤ºä¾‹"}})]),s._v(" "),t("p",[s._v("ä¸Šå›¾æ˜¯æ¨¡æ‹Ÿ 6 ä¸ª (R,rowid) è¡Œ, é€šè¿‡ä¼˜å…ˆé˜Ÿåˆ—æŽ’åºæ‰¾åˆ°æœ€å°çš„ä¸‰ä¸ª R å€¼çš„è¡Œçš„è¿‡ç¨‹. æ•´ä¸ªæŽ’åºè¿‡ç¨‹ä¸­, ä¸ºäº†æœ€å¿«åœ°æ‹¿åˆ°å½“å‰å †çš„æœ€å¤§å€¼, "),t("strong",[s._v("æ€»æ˜¯ä¿æŒæœ€å¤§å€¼åœ¨å †é¡¶, å› æ­¤è¿™æ˜¯ä¸€ä¸ªæœ€å¤§å †")]),s._v(".")]),s._v(" "),t("p",[s._v("å‰é¢ OPTIMIZER_TRACE ç»“æžœä¸­, "),t("strong",[s._v("filesort_priority_queue_optimization")]),s._v(" è¿™ä¸ªéƒ¨åˆ†çš„ chosen=true, å°±è¡¨ç¤ºä½¿ç”¨äº†ä¼˜å…ˆé˜Ÿåˆ—æŽ’åºç®—æ³•, è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦ä¸´æ—¶æ–‡ä»¶, å› æ­¤å¯¹åº”çš„ number_of_tmp_files æ˜¯ 0.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæµç¨‹ç»“æŸåŽ, æž„é€ çš„å †é‡Œé¢, å°±æ˜¯è¿™ä¸ª 10000 è¡Œé‡Œé¢ R å€¼æœ€å°çš„ä¸‰è¡Œ. ç„¶åŽä¾æ¬¡æŠŠå®ƒä»¬çš„ rowid å–å‡ºæ¥, åŽ»ä¸´æ—¶è¡¨é‡Œé¢æ‹¿åˆ° word å­—æ®µ, è¿™ä¸ªè¿‡ç¨‹å°±è·Ÿä¸Šä¸€èŠ‚çš„ rowid æŽ’åºçš„è¿‡ç¨‹ä¸€æ ·äº†.")]),s._v(" "),t("p",[s._v("å†çœ‹ä¸€ä¸‹ä¸Šä¸€èŠ‚çš„ SQL æŸ¥è¯¢è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" city"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'æ­å·ž'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, è¿™é‡Œä¹Ÿç”¨åˆ°äº† limit, ä¸ºä»€ä¹ˆæ²¡ç”¨ä¼˜å…ˆé˜Ÿåˆ—æŽ’åºç®—æ³•å‘¢? åŽŸå› æ˜¯è¿™æ¡ SQL è¯­å¥æ˜¯ limit 1000, å¦‚æžœä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ç®—æ³•çš„è¯, éœ€è¦ç»´æŠ¤çš„"),t("strong",[s._v("å †çš„å¤§å°å°±æ˜¯ 1000 è¡Œçš„ (name,rowid)")]),s._v(" , è¶…è¿‡äº†è®¾ç½®çš„ sort_buffer_size å¤§å°, æ‰€ä»¥åªèƒ½ä½¿ç”¨å½’å¹¶æŽ’åºç®—æ³•.")]),s._v(" "),t("p",[s._v("æ€»ä¹‹, ä¸è®ºæ˜¯ä½¿ç”¨å“ªç§ç±»åž‹çš„ä¸´æ—¶è¡¨, order by rand() è¿™ç§å†™æ³•éƒ½ä¼šè®©è®¡ç®—è¿‡ç¨‹éžå¸¸å¤æ‚, éœ€è¦å¤§é‡çš„æ‰«æè¡Œæ•°, å› æ­¤æŽ’åºè¿‡ç¨‹çš„èµ„æºæ¶ˆè€—ä¹Ÿä¼šå¾ˆå¤§.")]),s._v(" "),t("p",[s._v("å†å›žåˆ°å¼€å¤´çš„é—®é¢˜, æ€Žä¹ˆæ­£ç¡®åœ°éšæœºæŽ’åºå‘¢?")]),s._v(" "),t("h5",{attrs:{id:"éšæœºæŽ’åºæ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#éšæœºæŽ’åºæ–¹æ³•"}},[s._v("#")]),s._v(" éšæœºæŽ’åºæ–¹æ³•")]),s._v(" "),t("p",[s._v("å…ˆæŠŠé—®é¢˜ç®€åŒ–ä¸€ä¸‹, å¦‚æžœåªéšæœºé€‰æ‹© 1 ä¸ª word å€¼, å¯ä»¥æ€Žä¹ˆåšå‘¢? æ€è·¯ä¸Šæ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("å–å¾—è¿™ä¸ªè¡¨çš„ä¸»é”® id çš„æœ€å¤§å€¼ M å’Œæœ€å°å€¼ N;")]),s._v(" "),t("li",[s._v("ç”¨éšæœºå‡½æ•°ç”Ÿæˆä¸€ä¸ªæœ€å¤§å€¼åˆ°æœ€å°å€¼ä¹‹é—´çš„æ•° X = (M-N)*rand() + N;")]),s._v(" "),t("li",[s._v("å–ä¸å°äºŽ X çš„ç¬¬ä¸€ä¸ª ID çš„è¡Œ.")])]),s._v(" "),t("p",[s._v("æŠŠè¿™ä¸ªç®—æ³•, æš‚æ—¶ç§°ä½œéšæœºç®—æ³• 1. è¿™é‡Œç›´æŽ¥è´´ä¸€ä¸‹æ‰§è¡Œè¯­å¥çš„åºåˆ—:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("min")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@M")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@N")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@X")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" floor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@M")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@N")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@N")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@X")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™ä¸ªæ–¹æ³•æ•ˆçŽ‡å¾ˆé«˜, å› ä¸ºå– max(id) å’Œ min(id) éƒ½æ˜¯ä¸éœ€è¦æ‰«æç´¢å¼•çš„, è€Œç¬¬ä¸‰æ­¥çš„ select ä¹Ÿå¯ä»¥ç”¨ç´¢å¼•å¿«é€Ÿå®šä½, å¯ä»¥è®¤ä¸ºå°±åªæ‰«æäº† 3 è¡Œ. ä½†å®žé™…ä¸Š, è¿™ä¸ªç®—æ³•æœ¬èº«å¹¶ä¸ä¸¥æ ¼æ»¡è¶³é¢˜ç›®çš„éšæœºè¦æ±‚, å› ä¸º ID ä¸­é—´å¯èƒ½æœ‰ç©ºæ´ž, å› æ­¤é€‰æ‹©ä¸åŒè¡Œçš„æ¦‚çŽ‡ä¸ä¸€æ ·, ä¸æ˜¯çœŸæ­£çš„éšæœº.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚æœ‰ 4 ä¸ª id, åˆ†åˆ«æ˜¯ 1, 2, 4, 5, å¦‚æžœæŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•, é‚£ä¹ˆå–åˆ° id=4 çš„è¿™ä¸€è¡Œçš„æ¦‚çŽ‡æ˜¯å–å¾—å…¶ä»–è¡Œæ¦‚çŽ‡çš„ä¸¤å€. å¦‚æžœè¿™å››è¡Œçš„ id åˆ†åˆ«æ˜¯ 1, 2, 40000, 40001 å‘¢? è¿™ä¸ªç®—æ³•åŸºæœ¬å°±èƒ½å½“ bug æ¥çœ‹å¾…äº†.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, ä¸ºäº†å¾—åˆ°ä¸¥æ ¼éšæœºçš„ç»“æžœ, å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæµç¨‹:")]),s._v(" "),t("ol",[t("li",[s._v("å–å¾—æ•´ä¸ªè¡¨çš„è¡Œæ•°, å¹¶è®°ä¸º C.")]),s._v(" "),t("li",[s._v("å–å¾— Y = floor(C * rand()). floor å‡½æ•°åœ¨è¿™é‡Œçš„ä½œç”¨, å°±æ˜¯å–æ•´æ•°éƒ¨åˆ†.")]),s._v(" "),t("li",[s._v("å†ç”¨ limit Y,1 å–å¾—ä¸€è¡Œ.")])]),s._v(" "),t("p",[s._v("æŠŠè¿™ä¸ªç®—æ³•, ç§°ä¸ºéšæœºç®—æ³• 2. ä¸‹é¢è¿™æ®µä»£ç , å°±æ˜¯ä¸Šé¢æµç¨‹çš„æ‰§è¡Œè¯­å¥çš„åºåˆ—.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("min")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@M")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@N")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@X")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" floor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@M")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@N")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@N")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@X")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("ç”±äºŽ limit åŽé¢çš„å‚æ•°ä¸èƒ½ç›´æŽ¥è·Ÿå˜é‡, æ‰€ä»¥ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨äº† prepare+execute çš„æ–¹æ³•. ä¹Ÿå¯ä»¥æŠŠæ‹¼æŽ¥ SQL è¯­å¥çš„æ–¹æ³•å†™åœ¨åº”ç”¨ç¨‹åºä¸­, ä¼šæ›´ç®€å•äº›.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªéšæœºç®—æ³• 2, è§£å†³äº†ç®—æ³• 1 é‡Œé¢æ˜Žæ˜¾çš„æ¦‚çŽ‡ä¸å‡åŒ€é—®é¢˜.")]),s._v(" "),t("p",[s._v("MySQL å¤„ç† limit Y,1 çš„åšæ³•å°±æ˜¯æŒ‰é¡ºåºä¸€ä¸ªä¸€ä¸ªåœ°è¯»å‡ºæ¥, ä¸¢æŽ‰å‰ Y ä¸ª, ç„¶åŽæŠŠä¸‹ä¸€ä¸ªè®°å½•ä½œä¸ºè¿”å›žç»“æžœ, å› æ­¤è¿™ä¸€æ­¥éœ€è¦æ‰«æ Y+1 è¡Œ. å†åŠ ä¸Šç¬¬ä¸€æ­¥æ‰«æçš„ C è¡Œ, æ€»å…±éœ€è¦æ‰«æ C+Y+1 è¡Œ, æ‰§è¡Œä»£ä»·æ¯”éšæœºç®—æ³• 1 çš„ä»£ä»·è¦é«˜.")]),s._v(" "),t("p",[s._v("å½“ç„¶éšæœºç®—æ³• 2 è·Ÿç›´æŽ¥ order by rand() æ¯”èµ·æ¥, æ‰§è¡Œä»£ä»·è¿˜æ˜¯å°å¾ˆå¤šçš„.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨å†çœ‹çœ‹, å¦‚æžœæŒ‰ç…§éšæœºç®—æ³• 2 çš„æ€è·¯, è¦éšæœºå– 3 ä¸ª word å€¼å‘¢? å¯ä»¥è¿™ä¹ˆåš:")]),s._v(" "),t("ol",[t("li",[s._v("å–å¾—æ•´ä¸ªè¡¨çš„è¡Œæ•°, è®°ä¸º C;")]),s._v(" "),t("li",[s._v("æ ¹æ®ç›¸åŒçš„éšæœºæ–¹æ³•å¾—åˆ° Y1, Y2, Y3;")]),s._v(" "),t("li",[s._v("å†æ‰§è¡Œä¸‰ä¸ª limit Y, 1 è¯­å¥å¾—åˆ°ä¸‰è¡Œæ•°æ®.")])]),s._v(" "),t("p",[s._v("æŠŠè¿™ä¸ªç®—æ³•, ç§°ä½œéšæœºç®—æ³• 3. ä¸‹é¢è¿™æ®µä»£ç , å°±æ˜¯ä¸Šé¢æµç¨‹çš„æ‰§è¡Œè¯­å¥çš„åºåˆ—.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@C")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@Y1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" floor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@C")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@Y2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" floor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@C")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@Y3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" floor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@C")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@Y1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//åœ¨åº”ç”¨ä»£ç é‡Œé¢å–Y1, Y2, Y3å€¼, æ‹¼å‡ºSQLåŽæ‰§è¡Œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@Y2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@Y3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"å°ç»“-16"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-16"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å€Ÿç€éšæœºæŽ’åºçš„éœ€æ±‚, ä»‹ç»äº† MySQL å¯¹"),t("strong",[s._v("ä¸´æ—¶è¡¨æŽ’åº")]),s._v("çš„æ‰§è¡Œè¿‡ç¨‹. å¦‚æžœç›´æŽ¥ä½¿ç”¨ order by rand(), è¿™ä¸ªè¯­å¥éœ€è¦ Using temporary å’Œ Using filesort, æŸ¥è¯¢çš„æ‰§è¡Œä»£ä»·å¾€å¾€æ˜¯æ¯”è¾ƒå¤§çš„. æ‰€ä»¥åœ¨è®¾è®¡çš„æ—¶å€™ä½ è¦é‡é¿å¼€è¿™ç§å†™æ³•.")]),s._v(" "),t("p",[s._v("ä»Šå¤©çš„ä¾‹å­é‡Œé¢, ä¸æ˜¯ä»…ä»…åœ¨æ•°æ®åº“å†…éƒ¨è§£å†³é—®é¢˜, è¿˜ä¼šè®©åº”ç”¨ä»£ç é…åˆæ‹¼æŽ¥ SQL è¯­å¥. åœ¨å®žé™…åº”ç”¨çš„è¿‡ç¨‹ä¸­, æ¯”è¾ƒè§„èŒƒçš„ç”¨æ³•å°±æ˜¯: "),t("strong",[s._v('å°½é‡å°†ä¸šåŠ¡é€»è¾‘å†™åœ¨ä¸šåŠ¡ä»£ç ä¸­, è®©æ•°æ®åº“åªåš"è¯»å†™æ•°æ®"çš„äº‹æƒ…')]),s._v(". å› æ­¤è¿™ç±»æ–¹æ³•çš„åº”ç”¨è¿˜æ˜¯æ¯”è¾ƒå¹¿æ³›çš„.")]),s._v(" "),t("h4",{attrs:{id:"_18-ä¸ºä»€ä¹ˆè¿™äº›sqlè¯­å¥é€»è¾‘ç›¸åŒ-æ€§èƒ½å´å·®å¼‚å·¨å¤§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_18-ä¸ºä»€ä¹ˆè¿™äº›sqlè¯­å¥é€»è¾‘ç›¸åŒ-æ€§èƒ½å´å·®å¼‚å·¨å¤§"}},[s._v("#")]),s._v(" 18-ä¸ºä»€ä¹ˆè¿™äº›SQLè¯­å¥é€»è¾‘ç›¸åŒ,æ€§èƒ½å´å·®å¼‚å·¨å¤§?")]),s._v(" "),t("p",[s._v("åœ¨ MySQL ä¸­, æœ‰å¾ˆå¤šçœ‹ä¸ŠåŽ»é€»è¾‘ç›¸åŒ, ä½†æ€§èƒ½å´å·®å¼‚å·¨å¤§çš„ SQL è¯­å¥. å¯¹è¿™äº›è¯­å¥ä½¿ç”¨ä¸å½“çš„è¯, å°±ä¼šä¸ç»æ„é—´å¯¼è‡´æ•´ä¸ªæ•°æ®åº“çš„åŽ‹åŠ›å˜å¤§.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æŒ‘é€‰äº†ä¸‰ä¸ªè¿™æ ·çš„æ¡ˆä¾‹å’Œä½ åˆ†äº«. å¸Œæœ›å†é‡åˆ°ç›¸ä¼¼çš„é—®é¢˜æ—¶, ä½ å¯ä»¥åšåˆ°ä¸¾ä¸€åä¸‰, å¿«é€Ÿè§£å†³é—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹ä¸€-æ¡ä»¶å­—æ®µå‡½æ•°æ“ä½œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹ä¸€-æ¡ä»¶å­—æ®µå‡½æ•°æ“ä½œ"}},[s._v("#")]),s._v(" æ¡ˆä¾‹ä¸€:æ¡ä»¶å­—æ®µå‡½æ•°æ“ä½œ")]),s._v(" "),t("p",[s._v("å‡è®¾ä½ çŽ°åœ¨ç»´æŠ¤äº†ä¸€ä¸ªäº¤æ˜“ç³»ç»Ÿ, å…¶ä¸­äº¤æ˜“è®°å½•è¡¨ tradelog åŒ…å«äº¤æ˜“æµæ°´å·(tradeid), äº¤æ˜“å‘˜ id(operator), äº¤æ˜“æ—¶é—´(t_modified)ç­‰å­—æ®µ. ä¸ºäº†ä¾¿äºŽæè¿°, å…ˆå¿½ç•¥å…¶ä»–å­—æ®µ. è¿™ä¸ªè¡¨çš„å»ºè¡¨è¯­å¥å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("tradelog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("operator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("datetime")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("å‡è®¾, çŽ°åœ¨å·²ç»è®°å½•äº†ä»Ž 2016 å¹´åˆåˆ° 2018 å¹´åº•çš„æ‰€æœ‰æ•°æ®, è¿è¥éƒ¨é—¨æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯, è¦ç»Ÿè®¡å‘ç”Ÿåœ¨æ‰€æœ‰å¹´ä»½ä¸­ 7 æœˆä»½çš„äº¤æ˜“è®°å½•æ€»æ•°. è¿™ä¸ªé€»è¾‘çœ‹ä¸ŠåŽ»å¹¶ä¸å¤æ‚, ä½ çš„ SQL è¯­å¥å¯èƒ½ä¼šè¿™ä¹ˆå†™:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("month")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç”±äºŽ t_modified å­—æ®µä¸Šæœ‰ç´¢å¼•, äºŽæ˜¯ä½ å°±å¾ˆæ”¾å¿ƒåœ°åœ¨ç”Ÿäº§åº“ä¸­æ‰§è¡Œäº†è¿™æ¡è¯­å¥, ä½†å´å‘çŽ°æ‰§è¡Œäº†ç‰¹åˆ«ä¹…, æ‰è¿”å›žäº†ç»“æžœ. å¦‚æžœä½ é—® DBA åŒäº‹ä¸ºä»€ä¹ˆä¼šå‡ºçŽ°è¿™æ ·çš„æƒ…å†µ, ä»–å¤§æ¦‚ä¼šå‘Šè¯‰ä½ : "),t("strong",[s._v("å¦‚æžœå¯¹å­—æ®µåšäº†å‡½æ•°è®¡ç®—, å°±ç”¨ä¸ä¸Šç´¢å¼•")]),s._v("äº†, è¿™æ˜¯ MySQL çš„è§„å®š.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä½ å·²ç»å­¦è¿‡äº† InnoDB çš„ç´¢å¼•ç»“æž„äº†, å¯ä»¥å†è¿½é—®ä¸€å¥ä¸ºä»€ä¹ˆ? ä¸ºä»€ä¹ˆæ¡ä»¶æ˜¯ "),t("code",[s._v("where t_modified='2018-7-1'")]),s._v("â€‹ çš„æ—¶å€™å¯ä»¥ç”¨ä¸Šç´¢å¼•, è€Œæ”¹æˆ "),t("code",[s._v("where month(t_modified)=7")]),s._v("â€‹ çš„æ—¶å€™å°±ä¸è¡Œäº†?")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ˜¯è¿™ä¸ª t_modified ç´¢å¼•çš„ç¤ºæ„å›¾. æ–¹æ¡†ä¸Šé¢çš„æ•°å­—å°±æ˜¯ month() å‡½æ•°å¯¹åº”çš„å€¼.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/948c44c38d4349eab7a43df2ed4e1fb2-20230731161914-d08sv2f.png",alt:""}})]),s._v(" "),t("p",[s._v("å¦‚æžœ SQL è¯­å¥æ¡ä»¶ç”¨çš„æ˜¯ "),t("code",[s._v("where t_modified='2018-7-1'")]),s._v("â€‹ çš„è¯, å¼•æ“Žå°±ä¼šæŒ‰ç…§ä¸Šé¢ç»¿è‰²ç®­å¤´çš„è·¯çº¿, å¿«é€Ÿå®šä½åˆ° "),t("code",[s._v("t_modified='2018-7-1'")]),s._v("â€‹ éœ€è¦çš„ç»“æžœ.")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, B+ æ ‘æä¾›çš„"),t("strong",[s._v("è¿™ä¸ªå¿«é€Ÿå®šä½èƒ½åŠ›, æ¥æºäºŽåŒä¸€å±‚å…„å¼ŸèŠ‚ç‚¹çš„æœ‰åºæ€§")]),s._v(". ä½†å¦‚æžœè®¡ç®— month() å‡½æ•°çš„è¯, ä½ ä¼šçœ‹åˆ°ä¼ å…¥ 7 çš„æ—¶å€™, "),t("strong",[s._v("åœ¨æ ‘çš„ç¬¬ä¸€å±‚å°±ä¸çŸ¥é“è¯¥æ€Žä¹ˆåŠžäº†")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("mark",[t("strong",[s._v("å¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œ, å¯èƒ½ä¼šç ´åç´¢å¼•å€¼çš„æœ‰åºæ€§, å› æ­¤ä¼˜åŒ–å™¨å°±å†³å®šæ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½")])]),s._v("â€‹ **. ** éœ€è¦æ³¨æ„çš„æ˜¯, ä¼˜åŒ–å™¨å¹¶ä¸æ˜¯è¦æ”¾å¼ƒä½¿ç”¨è¿™ä¸ªç´¢å¼•.")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªä¾‹å­é‡Œ, æ”¾å¼ƒäº†æ ‘æœç´¢åŠŸèƒ½, ä¼˜åŒ–å™¨å¯ä»¥"),t("strong",[s._v("é€‰æ‹©éåŽ†ä¸»é”®ç´¢å¼•")]),s._v(", ä¹Ÿå¯ä»¥é€‰æ‹©éåŽ†ç´¢å¼• t_modified, ä¼˜åŒ–å™¨å¯¹æ¯”ç´¢å¼•å¤§å°åŽå‘çŽ°, ç´¢å¼• t_modified æ›´å°, éåŽ†è¿™ä¸ªç´¢å¼•æ¯”éåŽ†ä¸»é”®ç´¢å¼•æ¥å¾—æ›´å¿«. å› æ­¤æœ€ç»ˆè¿˜æ˜¯ä¼šé€‰æ‹©ç´¢å¼• t_modified.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥ä½¿ç”¨ explain å‘½ä»¤, æŸ¥çœ‹ä¸€ä¸‹è¿™æ¡ SQL è¯­å¥çš„æ‰§è¡Œç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e16bd9390c4b10683be79479903c344c-20230731161914-4s5d6b7.png",alt:""}})]),s._v(" "),t("p",[s._v("â€‹"),t("code",[s._v('key="t_modified"')]),s._v("â€‹ è¡¨ç¤ºçš„æ˜¯, ä½¿ç”¨äº† t_modified è¿™ä¸ªç´¢å¼•; è¿™é‡Œåœ¨æµ‹è¯•è¡¨æ•°æ®ä¸­æ’å…¥äº† 10 ä¸‡è¡Œæ•°æ®, rows=100335, è¯´æ˜Žè¿™æ¡è¯­å¥æ‰«æäº†æ•´ä¸ªç´¢å¼•çš„æ‰€æœ‰å€¼; Extra å­—æ®µçš„ Using index, è¡¨ç¤ºçš„æ˜¯ä½¿ç”¨äº†"),t("strong",[s._v("è¦†ç›–ç´¢å¼•")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, ç”±äºŽåœ¨ t_modified å­—æ®µåŠ äº† month() å‡½æ•°æ“ä½œ, å¯¼è‡´äº†"),t("strong",[s._v("å…¨ç´¢å¼•æ‰«æ")]),s._v(". ä¸ºäº†èƒ½å¤Ÿç”¨ä¸Šç´¢å¼•çš„å¿«é€Ÿå®šä½èƒ½åŠ›, å°±è¦æŠŠ SQL è¯­å¥æ”¹æˆåŸºäºŽå­—æ®µæœ¬èº«çš„èŒƒå›´æŸ¥è¯¢. æŒ‰ç…§ä¸‹é¢è¿™ä¸ªå†™æ³•, ä¼˜åŒ–å™¨å°±èƒ½æŒ‰ç…§é¢„æœŸçš„, ç”¨ä¸Š t_modified ç´¢å¼•çš„å¿«é€Ÿå®šä½èƒ½åŠ›äº†.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t_modified "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2016-7-1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t_modified"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2016-8-1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t_modified "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-7-1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t_modified"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-8-1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t_modified "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-7-1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t_modified"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-8-1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("åˆ°è¿™é‡Œå°±è¯´æ˜Žäº†, "),t("strong",[s._v("ç”±äºŽåŠ äº† month() å‡½æ•°æ“ä½œ, MySQL æ— æ³•å†ä½¿ç”¨ç´¢å¼•å¿«é€Ÿå®šä½åŠŸèƒ½, è€Œåªèƒ½ä½¿ç”¨å…¨ç´¢å¼•æ‰«æ")]),s._v(".")]),s._v(" "),t("p",[s._v('ä¸è¿‡ä¼˜åŒ–å™¨åœ¨ä¸ªé—®é¢˜ä¸Šç¡®å®žæœ‰"å·æ‡’"è¡Œä¸º, å³ä½¿æ˜¯å¯¹äºŽä¸æ”¹å˜æœ‰åºæ€§çš„å‡½æ•°, ä¹Ÿä¸ä¼šè€ƒè™‘ä½¿ç”¨ç´¢å¼•. æ¯”å¦‚å¯¹äºŽ '),t("code",[s._v("select * from tradelog where id + 1 = 10000")]),s._v("â€‹ è¿™ä¸ª SQL è¯­å¥, è¿™ä¸ªåŠ  1 æ“ä½œå¹¶ä¸ä¼šæ”¹å˜æœ‰åºæ€§, ä½†æ˜¯ MySQL ä¼˜åŒ–å™¨è¿˜æ˜¯ä¸èƒ½ç”¨ id ç´¢å¼•å¿«é€Ÿå®šä½åˆ° 9999 è¿™ä¸€è¡Œ. æ‰€ä»¥éœ€è¦åœ¨å†™ SQL è¯­å¥çš„æ—¶å€™, æ‰‹åŠ¨æ”¹å†™æˆ "),t("code",[s._v("where id = 10000 - 1")]),s._v("â€‹ æ‰å¯ä»¥.")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹äºŒ-éšå¼ç±»åž‹è½¬æ¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹äºŒ-éšå¼ç±»åž‹è½¬æ¢"}},[s._v("#")]),s._v(" æ¡ˆä¾‹äºŒ:éšå¼ç±»åž‹è½¬æ¢")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥è¯´ä¸€è¯´å¦ä¸€ä¸ªç»å¸¸è®©ç¨‹åºå‘˜æŽ‰å‘é‡Œçš„ä¾‹å­. ä¸€èµ·çœ‹ä¸€ä¸‹è¿™æ¡ SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" tradeid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110717")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("äº¤æ˜“ç¼–å· tradeid è¿™ä¸ªå­—æ®µä¸Š, æœ¬æ¥å°±æœ‰ç´¢å¼•, ä½†æ˜¯ explain çš„ç»“æžœå´æ˜¾ç¤º, è¿™æ¡è¯­å¥éœ€è¦èµ°"),t("strong",[s._v("å…¨è¡¨æ‰«æ")]),s._v(". ä½ å¯èƒ½ä¹Ÿå‘çŽ°äº†, tradeid çš„"),t("mark",[t("strong",[s._v("å­—æ®µç±»åž‹æ˜¯ varchar(32), è€Œè¾“å…¥çš„å‚æ•°å´æ˜¯æ•´åž‹, æ‰€ä»¥éœ€è¦åšç±»åž‹è½¬æ¢")])]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, çŽ°åœ¨è¿™é‡Œå°±æœ‰ä¸¤ä¸ªé—®é¢˜:")]),s._v(" "),t("ol",[t("li",[s._v("æ•°æ®ç±»åž‹è½¬æ¢çš„è§„åˆ™æ˜¯ä»€ä¹ˆ?")]),s._v(" "),t("li",[s._v("ä¸ºä»€ä¹ˆæœ‰æ•°æ®ç±»åž‹è½¬æ¢, å°±éœ€è¦èµ°å…¨ç´¢å¼•æ‰«æ?")])]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜, ä½ å¯èƒ½ä¼šè¯´, æ•°æ®åº“é‡Œé¢ç±»åž‹è¿™ä¹ˆå¤š, è¿™ç§æ•°æ®ç±»åž‹è½¬æ¢è§„åˆ™æ›´å¤š, æˆ‘è®°ä¸ä½, åº”è¯¥æ€Žä¹ˆåŠž?")]),s._v(" "),t("p",[s._v("è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•, çœ‹ "),t("code",[s._v('select "10" > 9')]),s._v("â€‹ çš„ç»“æžœ:")]),s._v(" "),t("ol",[t("li",[s._v('å¦‚æžœè§„åˆ™æ˜¯ "'),t("strong",[s._v("å°†å­—ç¬¦ä¸²è½¬æˆæ•°å­—")]),s._v('", é‚£ä¹ˆå°±æ˜¯åšæ•°å­—æ¯”è¾ƒ, ç»“æžœåº”è¯¥æ˜¯ 1;')]),s._v(" "),t("li",[s._v('å¦‚æžœè§„åˆ™æ˜¯ "'),t("strong",[s._v("å°†æ•°å­—è½¬æˆå­—ç¬¦ä¸²")]),s._v('", é‚£ä¹ˆå°±æ˜¯åšå­—ç¬¦ä¸²æ¯”è¾ƒ, ç»“æžœåº”è¯¥æ˜¯ 0.')])]),s._v(" "),t("p",[s._v("éªŒè¯ç»“æžœå¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/326fa3635ed7e8b373887ebf325717e2-20230731161914-5jcmwkh.png",alt:""}})]),s._v(" "),t("p",[s._v('ä»Žå›¾ä¸­å¯çŸ¥, select "10" > 9 è¿”å›žçš„æ˜¯ 1, æ‰€ä»¥å°±èƒ½ç¡®è®¤ MySQL é‡Œçš„è½¬æ¢è§„åˆ™äº†: ** åœ¨ MySQL ä¸­, å­—ç¬¦ä¸²å’Œæ•°å­—åšæ¯”è¾ƒçš„è¯, æ˜¯å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—**.')]),s._v(" "),t("p",[s._v("è¿™æ—¶å†çœ‹è¿™ä¸ªå…¨è¡¨æ‰«æçš„è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" tradeid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110717")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å°±çŸ¥é“å¯¹äºŽä¼˜åŒ–å™¨æ¥è¯´, è¿™ä¸ªè¯­å¥ç›¸å½“äºŽ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("  CAST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tradid "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" signed "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110717")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, è¿™æ¡è¯­å¥è§¦å‘äº†ä¸Šé¢è¯´åˆ°çš„è§„åˆ™: "),t("strong",[s._v("å¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œ, ä¼˜åŒ–å™¨ä¼šæ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹ä¸‰-éšå¼å­—ç¬¦ç¼–ç è½¬æ¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹ä¸‰-éšå¼å­—ç¬¦ç¼–ç è½¬æ¢"}},[s._v("#")]),s._v(" æ¡ˆä¾‹ä¸‰:éšå¼å­—ç¬¦ç¼–ç è½¬æ¢")]),s._v(" "),t("p",[s._v("å‡è®¾ç³»ç»Ÿé‡Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªè¡¨ trade_detail, ç”¨äºŽè®°å½•äº¤æ˜“çš„æ“ä½œç»†èŠ‚. ä¸ºäº†ä¾¿äºŽé‡åŒ–åˆ†æžå’Œå¤çŽ°, å¾€äº¤æ˜“æ—¥å¿—è¡¨ tradelog å’Œäº¤æ˜“è¯¦æƒ…è¡¨ trade_detail è¿™ä¸¤ä¸ªè¡¨é‡Œæ’å…¥ä¸€äº›æ•°æ®.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("trade_detail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("trade_step"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*æ“ä½œæ­¥éª¤*/")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("step_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*æ­¥éª¤ä¿¡æ¯*/")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tradelog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaaa'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tradelog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaab'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tradelog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaac'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaaa'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'add'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaaa'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaaa'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'commit'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaab'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'add'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaab'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaab'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update again'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaab'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'commit'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaac'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'add'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaac'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaac'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update again'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaac'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'commit'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("è¿™æ—¶å€™å¦‚æžœè¦æŸ¥è¯¢ id=2 çš„äº¤æ˜“çš„æ‰€æœ‰æ“ä½œæ­¥éª¤ä¿¡æ¯, SQL è¯­å¥å¯ä»¥è¿™ä¹ˆå†™:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" trade_detail d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* è¯­å¥ Q1*/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/766c7e8c50933e3a7bf4757f77836599-20230731161914-2n19crv.png",alt:""}})]),s._v(" "),t("p",[s._v("ä¸€èµ·æ¥çœ‹ä¸‹è¿™ä¸ªç»“æžœ:")]),s._v(" "),t("ol",[t("li",[s._v("ç¬¬ä¸€è¡Œæ˜¾ç¤ºä¼˜åŒ–å™¨ä¼šå…ˆåœ¨äº¤æ˜“è®°å½•è¡¨ tradelog ä¸ŠæŸ¥åˆ° id=2 çš„è¡Œ, è¿™ä¸ªæ­¥éª¤ç”¨ä¸Šäº†"),t("strong",[s._v("ä¸»é”®ç´¢å¼•")]),s._v(", rows=1 è¡¨ç¤ºåªæ‰«æä¸€è¡Œ;")]),s._v(" "),t("li",[s._v("ç¬¬äºŒè¡Œ key=NULL, è¡¨ç¤ºæ²¡æœ‰ç”¨ä¸Šäº¤æ˜“è¯¦æƒ…è¡¨ trade_detail ä¸Šçš„ tradeid ç´¢å¼•, è¿›è¡Œäº†"),t("strong",[s._v("å…¨è¡¨æ‰«æ")]),s._v(".")])]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªæ‰§è¡Œè®¡åˆ’é‡Œ, æ˜¯ä»Ž tradelog è¡¨ä¸­å– tradeid å­—æ®µ, å†åŽ» trade_detail è¡¨é‡ŒæŸ¥è¯¢åŒ¹é…å­—æ®µ. å› æ­¤æŠŠ tradelog ç§°ä¸ºé©±åŠ¨è¡¨, æŠŠ trade_detail ç§°ä¸ºè¢«é©±åŠ¨è¡¨, æŠŠ tradeid ç§°ä¸ºå…³è”å­—æ®µ.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥çœ‹ä¸‹è¿™ä¸ª explain ç»“æžœè¡¨ç¤ºçš„æ‰§è¡Œæµç¨‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c2a0f659967673cd5056c368d5011c27-20230731161914-v8jc56f.png",alt:""}})]),s._v(" "),t("p",[s._v("å›¾ä¸­:")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ 1 æ­¥, æ˜¯æ ¹æ® id åœ¨ tradelog è¡¨é‡Œæ‰¾åˆ° L2 è¿™ä¸€è¡Œ;")]),s._v(" "),t("li",[s._v("ç¬¬ 2 æ­¥, æ˜¯ä»Ž L2 ä¸­å–å‡º tradeid å­—æ®µçš„å€¼;")]),s._v(" "),t("li",[s._v("ç¬¬ 3 æ­¥, æ˜¯æ ¹æ® tradeid å€¼åˆ° trade_detail è¡¨ä¸­æŸ¥æ‰¾æ¡ä»¶åŒ¹é…çš„è¡Œ. explain çš„ç»“æžœé‡Œé¢ç¬¬äºŒè¡Œçš„ key=NULL è¡¨ç¤ºçš„å°±æ˜¯, è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡"),t("strong",[s._v("éåŽ†ä¸»é”®ç´¢å¼•çš„æ–¹å¼, ä¸€ä¸ªä¸€ä¸ªåœ°åˆ¤æ–­ tradeid çš„å€¼æ˜¯å¦åŒ¹é…")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿›è¡Œåˆ°è¿™é‡Œ, ä½ ä¼šå‘çŽ°ç¬¬ 3 æ­¥ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ. å› ä¸ºè¡¨ trade_detail é‡Œ tradeid å­—æ®µä¸Šæ˜¯"),t("strong",[s._v("æœ‰ç´¢å¼•")]),s._v("çš„, æˆ‘ä»¬æœ¬æ¥æ˜¯å¸Œæœ›é€šè¿‡ä½¿ç”¨ tradeid ç´¢å¼•èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°ç­‰å€¼çš„è¡Œ. ä½†è¿™é‡Œå¹¶æ²¡æœ‰.")]),s._v(" "),t("p",[s._v("å¦‚æžœä½ åŽ»é—® DBA åŒå­¦, ä»–ä»¬å¯èƒ½ä¼šå‘Šè¯‰ä½ , "),t("strong",[s._v("å› ä¸ºè¿™ä¸¤ä¸ªè¡¨çš„å­—ç¬¦é›†ä¸åŒ, ä¸€ä¸ªæ˜¯ utf8, ä¸€ä¸ªæ˜¯ utf8mb4, æ‰€ä»¥åšè¡¨è¿žæŽ¥æŸ¥è¯¢çš„æ—¶å€™ç”¨ä¸ä¸Šå…³è”å­—æ®µçš„ç´¢å¼•")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆå­—ç¬¦é›†ä¸åŒå°±ç”¨ä¸ä¸Šç´¢å¼•å‘¢? é—®é¢˜æ˜¯å‡ºåœ¨æ‰§è¡Œæ­¥éª¤çš„ç¬¬ 3 æ­¥, å¦‚æžœå•ç‹¬æŠŠè¿™ä¸€æ­¥æ”¹æˆ SQL è¯­å¥çš„è¯, é‚£å°±æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" tradeid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$L2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å…¶ä¸­, "),t("code",[s._v("$L2.tradeid.value")]),s._v("â€‹ çš„å­—ç¬¦é›†æ˜¯ utf8mb4.")]),s._v(" "),t("p",[s._v("å‚ç…§å‰é¢çš„ä¸¤ä¸ªä¾‹å­, ä½ è‚¯å®šå°±æƒ³åˆ°äº†, å­—ç¬¦é›† utf8mb4 æ˜¯ utf8 çš„è¶…é›†, æ‰€ä»¥å½“è¿™ä¸¤ä¸ªç±»åž‹çš„å­—ç¬¦ä¸²åœ¨åšæ¯”è¾ƒçš„æ—¶å€™, "),t("strong",[s._v("MySQL å†…éƒ¨çš„æ“ä½œæ˜¯, å…ˆæŠŠ utf8 å­—ç¬¦ä¸²è½¬æˆ utf8mb4 å­—ç¬¦é›†, å†åšæ¯”è¾ƒ")]),s._v(".")]),s._v(" "),t("p",[s._v('è¿™ä¸ªè®¾å®šå¾ˆå¥½ç†è§£, utf8mb4 æ˜¯ utf8 çš„è¶…é›†. ç±»ä¼¼åœ°, åœ¨ç¨‹åºè®¾è®¡è¯­è¨€é‡Œé¢, åšè‡ªåŠ¨ç±»åž‹è½¬æ¢çš„æ—¶å€™, ä¸ºäº†é¿å…æ•°æ®åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ç”±äºŽæˆªæ–­å¯¼è‡´æ•°æ®é”™è¯¯, ä¹Ÿéƒ½æ˜¯"æŒ‰æ•°æ®é•¿åº¦å¢žåŠ çš„æ–¹å‘"è¿›è¡Œè½¬æ¢çš„.')]),s._v(" "),t("p",[s._v("å› æ­¤åœ¨æ‰§è¡Œä¸Šé¢è¿™ä¸ªè¯­å¥çš„æ—¶å€™, éœ€è¦å°†è¢«é©±åŠ¨æ•°æ®è¡¨é‡Œçš„å­—æ®µ"),t("strong",[s._v("ä¸€ä¸ªä¸ªåœ°è½¬æ¢æˆ utf8mb4")]),s._v(", å†è·Ÿ L2 åšæ¯”è¾ƒ. ä¹Ÿå°±æ˜¯è¯´, å®žé™…ä¸Šè¿™ä¸ªè¯­å¥ç­‰åŒäºŽä¸‹é¢è¿™ä¸ªå†™æ³•:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" trade_detail "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CONVERT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("traideid "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" utf8mb4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$L2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("CONVERT() å‡½æ•°åœ¨è¿™é‡Œçš„æ„æ€æ˜¯æŠŠè¾“å…¥çš„å­—ç¬¦ä¸²è½¬æˆ utf8mb4 å­—ç¬¦é›†. è¿™å°±å†æ¬¡è§¦å‘äº†ä¸Šé¢è¯´åˆ°çš„åŽŸåˆ™: å¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œ, ä¼˜åŒ–å™¨ä¼šæ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œ, ä½ ç»ˆäºŽæ˜Žç¡®äº†, å­—ç¬¦é›†ä¸åŒåªæ˜¯æ¡ä»¶ä¹‹ä¸€, "),t("strong",[s._v("è¿žæŽ¥è¿‡ç¨‹ä¸­è¦æ±‚åœ¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•å­—æ®µä¸ŠåŠ å‡½æ•°æ“ä½œ")]),s._v(", æ˜¯ç›´æŽ¥å¯¼è‡´å¯¹è¢«é©±åŠ¨è¡¨åšå…¨è¡¨æ‰«æçš„åŽŸå› .")]),s._v(" "),t("p",[s._v('ä½œä¸ºå¯¹æ¯”éªŒè¯, å†æå¦å¤–ä¸€ä¸ªéœ€æ±‚, "æŸ¥æ‰¾ trade_detail è¡¨é‡Œ id=4 çš„æ“ä½œ, å¯¹åº”çš„æ“ä½œè€…æ˜¯è°", å†æ¥çœ‹ä¸‹è¿™ä¸ªè¯­å¥å’Œå®ƒçš„æ‰§è¡Œè®¡åˆ’.')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("operator "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" trade_detail d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/a093b77168ab8573bc5be01fa2e78f18-20230731161914-emi8l9k.png",alt:""}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¯­å¥é‡Œ trade_detail è¡¨æˆäº†é©±åŠ¨è¡¨, ä½†æ˜¯ explain ç»“æžœçš„ç¬¬äºŒè¡Œæ˜¾ç¤º, è¿™æ¬¡çš„æŸ¥è¯¢æ“ä½œç”¨ä¸Šäº†è¢«é©±åŠ¨è¡¨ tradelog é‡Œçš„ç´¢å¼• (tradeid), æ‰«æè¡Œæ•°æ˜¯ 1.")]),s._v(" "),t("p",[s._v("è¿™ä¹Ÿæ˜¯ä¸¤ä¸ª tradeid å­—æ®µçš„ join æ“ä½œ, ä¸ºä»€ä¹ˆè¿™æ¬¡èƒ½ç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ tradeid ç´¢å¼•å‘¢? æ¥åˆ†æžä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("å‡è®¾é©±åŠ¨è¡¨ trade_detail é‡Œ id=4 çš„è¡Œè®°ä¸º R4, é‚£ä¹ˆåœ¨è¿žæŽ¥çš„æ—¶å€™, è¢«é©±åŠ¨è¡¨ tradelog ä¸Šæ‰§è¡Œçš„å°±æ˜¯ç±»ä¼¼è¿™æ ·çš„ SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" operator "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" traideid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$R4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ—¶å€™ "),t("code",[s._v("$R4.tradeid.value")]),s._v("â€‹ çš„å­—ç¬¦é›†æ˜¯ utf8, æŒ‰ç…§å­—ç¬¦é›†è½¬æ¢è§„åˆ™, è¦è½¬æˆ utf8mb4, æ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹å°±è¢«æ”¹å†™æˆ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" operator "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" traideid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CONVERT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("$R4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" utf8mb4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä½ çœ‹, è¿™é‡Œçš„ CONVERT å‡½æ•°æ˜¯"),t("strong",[s._v("åŠ åœ¨è¾“å…¥å‚æ•°ä¸Š")]),s._v("çš„, è¿™æ ·å°±å¯ä»¥ç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ traideid ç´¢å¼•. ç†è§£äº†åŽŸç†ä»¥åŽ, å°±å¯ä»¥ç”¨æ¥æŒ‡å¯¼æ“ä½œäº†. å¦‚æžœè¦ä¼˜åŒ–è¯­å¥")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" trade_detail d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("çš„æ‰§è¡Œè¿‡ç¨‹, æœ‰ä¸¤ç§åšæ³•:")]),s._v(" "),t("ul",[t("li",[s._v("æ¯”è¾ƒå¸¸è§çš„ä¼˜åŒ–æ–¹æ³•æ˜¯, æŠŠ trade_detail è¡¨ä¸Šçš„ tradeid å­—æ®µçš„å­—ç¬¦é›†ä¹Ÿæ”¹æˆ utf8mb4, è¿™æ ·å°±æ²¡æœ‰å­—ç¬¦é›†è½¬æ¢çš„é—®é¢˜äº†.")]),s._v(" "),t("li",[s._v("å¦‚æžœèƒ½å¤Ÿä¿®æ”¹å­—æ®µçš„å­—ç¬¦é›†çš„è¯, æ˜¯æœ€å¥½ä¸è¿‡äº†. ä½†å¦‚æžœæ•°æ®é‡æ¯”è¾ƒå¤§, æˆ–è€…ä¸šåŠ¡ä¸Šæš‚æ—¶ä¸èƒ½åšè¿™ä¸ª DDL çš„è¯, é‚£å°±åªèƒ½é‡‡ç”¨ä¿®æ”¹ SQL è¯­å¥çš„æ–¹æ³•äº†. å¦‚ä¸‹æ‰€ç¤º:")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tradelog l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" trade_detail d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CONVERT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tradeid "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" utf8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Â·Â·Â·")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/da9a75daf758539d9baab5d0b46f6a02-20230731161914-ktxsost.png",alt:""}})]),s._v(" "),t("p",[s._v("è¿™é‡Œä¸»åŠ¨æŠŠ l.tradeid è½¬æˆ utf8, å°±"),t("strong",[s._v("é¿å…äº†è¢«é©±åŠ¨è¡¨ä¸Šçš„å­—ç¬¦ç¼–ç è½¬æ¢")]),s._v(", ä»Ž explain ç»“æžœå¯ä»¥çœ‹åˆ°, è¿™æ¬¡ç´¢å¼•èµ°å¯¹äº†.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-17"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-17"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†"),t("mark",[t("strong",[s._v("å¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œ, å¯èƒ½ä¼šç ´åç´¢å¼•å€¼çš„æœ‰åºæ€§, å› æ­¤ä¼˜åŒ–å™¨å°±å†³å®šæ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("ç¬¬äºŒä¸ªä¾‹å­æ˜¯éšå¼ç±»åž‹è½¬æ¢, ç¬¬ä¸‰ä¸ªä¾‹å­æ˜¯éšå¼å­—ç¬¦ç¼–ç è½¬æ¢, å®ƒä»¬éƒ½è·Ÿç¬¬ä¸€ä¸ªä¾‹å­ä¸€æ ·, å› ä¸ºè¦æ±‚åœ¨ç´¢å¼•å­—æ®µä¸Šåšå‡½æ•°æ“ä½œè€Œå¯¼è‡´äº†"),t("strong",[s._v("å…¨ç´¢å¼•æ‰«æ")]),s._v(".")]),s._v(" "),t("p",[s._v('MySQL çš„ä¼˜åŒ–å™¨ç¡®å®žæœ‰"å·æ‡’"çš„å«Œç–‘, å³ä½¿ç®€å•åœ°æŠŠ '),t("code",[s._v("where id+1=1000")]),s._v("â€‹ æ”¹å†™æˆ "),t("code",[s._v("where id=1000-1")]),s._v("â€‹ å°±èƒ½å¤Ÿç”¨ä¸Šç´¢å¼•å¿«é€ŸæŸ¥æ‰¾, ä¹Ÿä¸ä¼šä¸»åŠ¨åšè¿™ä¸ªè¯­å¥é‡å†™.")]),s._v(" "),t("p",[s._v("å› æ­¤, æ¯æ¬¡ä½ çš„ä¸šåŠ¡ä»£ç å‡çº§æ—¶, æŠŠå¯èƒ½å‡ºçŽ°çš„æ–°çš„ SQL è¯­å¥ explain ä¸€ä¸‹, æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯.")]),s._v(" "),t("h4",{attrs:{id:"_19-ä¸ºä»€ä¹ˆåªæŸ¥ä¸€è¡Œçš„è¯­å¥-ä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_19-ä¸ºä»€ä¹ˆåªæŸ¥ä¸€è¡Œçš„è¯­å¥-ä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢"}},[s._v("#")]),s._v(" 19-ä¸ºä»€ä¹ˆåªæŸ¥ä¸€è¡Œçš„è¯­å¥,ä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢?")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬æƒ…å†µä¸‹, å¦‚æžœè¯´æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–, ä½ é¦–å…ˆä¼šæƒ³åˆ°ä¸€äº›å¤æ‚çš„è¯­å¥, æƒ³åˆ°æŸ¥è¯¢éœ€è¦è¿”å›žå¤§é‡çš„æ•°æ®. ä½†"),t("strong",[s._v('æœ‰äº›æƒ…å†µä¸‹, "æŸ¥ä¸€è¡Œ", ä¹Ÿä¼šæ‰§è¡Œå¾—ç‰¹åˆ«æ…¢')]),s._v(". æœ¬èŠ‚å°±æ¥çœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹, ä¼šå‡ºçŽ°è¿™ä¸ªçŽ°è±¡. éœ€è¦è¯´æ˜Žçš„æ˜¯, å¦‚æžœ MySQL æ•°æ®åº“æœ¬èº«å°±æœ‰å¾ˆå¤§çš„åŽ‹åŠ›, å¯¼è‡´æ•°æ®åº“æœåŠ¡å™¨ CPU å ç”¨çŽ‡å¾ˆé«˜æˆ– ioutil(IO åˆ©ç”¨çŽ‡)å¾ˆé«˜, è¿™ç§æƒ…å†µä¸‹æ‰€æœ‰è¯­å¥çš„æ‰§è¡Œéƒ½æœ‰å¯èƒ½å˜æ…¢, ä¸å±žäºŽæœ¬èŠ‚çš„è®¨è®ºèŒƒå›´.")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽæè¿°, è¿˜æ˜¯æž„é€ ä¸€ä¸ªè¡¨, åŸºäºŽè¿™ä¸ªè¡¨æ¥è¯´æ˜Žé—®é¢˜. è¿™ä¸ªè¡¨æœ‰ä¸¤ä¸ªå­—æ®µ id å’Œ c, å¹¶ä¸”é‡Œé¢æ’å…¥äº† 10 ä¸‡è¡Œè®°å½•.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("æŽ¥ä¸‹æ¥ç”¨å‡ ä¸ªä¸åŒçš„åœºæ™¯æ¥ä¸¾ä¾‹, æœ‰äº›æ˜¯å‰é¢çš„å·²ç»ä»‹ç»è¿‡çš„çŸ¥è¯†ç‚¹.")]),s._v(" "),t("h5",{attrs:{id:"ç¬¬ä¸€ç±»-æŸ¥è¯¢é•¿æ—¶é—´ä¸è¿”å›ž"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¬¬ä¸€ç±»-æŸ¥è¯¢é•¿æ—¶é—´ä¸è¿”å›ž"}},[s._v("#")]),s._v(" ç¬¬ä¸€ç±»:æŸ¥è¯¢é•¿æ—¶é—´ä¸è¿”å›ž")]),s._v(" "),t("p",[s._v("åœ¨è¡¨ t æ‰§è¡Œä¸‹é¢çš„ SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("mark",[t("strong",[s._v("æŸ¥è¯¢ç»“æžœé•¿æ—¶é—´ä¸è¿”å›ž. ä¸€èˆ¬ç¢°åˆ°è¿™ç§æƒ…å†µçš„è¯, å¤§æ¦‚çŽ‡æ˜¯è¡¨ t è¢«é”ä½äº†. æŽ¥ä¸‹æ¥åˆ†æžåŽŸå› çš„æ—¶å€™, ä¸€èˆ¬éƒ½æ˜¯é¦–å…ˆæ‰§è¡Œä¸€ä¸‹ show processlist å‘½ä»¤, çœ‹çœ‹å½“å‰è¯­å¥å¤„äºŽä»€ä¹ˆçŠ¶æ€.")])])]),s._v(" "),t("p",[s._v("ç„¶åŽå†é’ˆå¯¹æ¯ç§çŠ¶æ€, åŽ»åˆ†æžå®ƒä»¬äº§ç”Ÿçš„åŽŸå› , å¦‚ä½•å¤çŽ°, ä»¥åŠå¦‚ä½•å¤„ç†.")]),s._v(" "),t("h6",{attrs:{id:"_1-ç­‰mdlé”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç­‰mdlé”"}},[s._v("#")]),s._v(" (1)ç­‰MDLé”")]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯ä½¿ç”¨ show processlist å‘½ä»¤æŸ¥çœ‹ "),t("mark",[t("strong",[s._v("Waiting for table metadata lock")])]),s._v(" çš„ç¤ºæ„å›¾. å‡ºçŽ°**è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºçš„æ˜¯, çŽ°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¡¨ t ä¸Šè¯·æ±‚æˆ–è€…æŒæœ‰ MDL å†™é”, æŠŠ select è¯­å¥å µä½äº†. **")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/76a4216bd0a34218cfd8a5c61da56870-20230731161914-xr18p0s.png",alt:"",title:"Waiting for table metadata lock çŠ¶æ€ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»è¿‡ä¸€ç§å¤çŽ°æ–¹æ³•. ä½†éœ€è¦è¯´æ˜Žçš„æ˜¯, é‚£ä¸ªå¤çŽ°è¿‡ç¨‹æ˜¯åŸºäºŽ MySQL 5.6 ç‰ˆæœ¬çš„. è€Œ MySQL 5.7 ç‰ˆæœ¬ä¿®æ”¹äº† MDL çš„åŠ é”ç­–ç•¥, æ‰€ä»¥å°±ä¸èƒ½å¤çŽ°è¿™ä¸ªåœºæ™¯äº†.")]),s._v(" "),t("p",[s._v("ä¸è¿‡, åœ¨ MySQL 5.7 ç‰ˆæœ¬ä¸‹å¤çŽ°è¿™ä¸ªåœºæ™¯, ä¹Ÿå¾ˆå®¹æ˜“. å¦‚ä¸‹å›¾æ‰€ç¤º, ç»™å‡ºäº†ç®€å•çš„å¤çŽ°æ­¥éª¤.\n"),t("img",{attrs:{src:"/img/0a5cb10c5e8d1f7f07cb5d77aab1ba8a-20230731161914-y7c5isf.png",alt:"",title:"MySQL 5.7 ä¸­ Waiting for table metadata lock çš„å¤çŽ°æ­¥éª¤"}})]),s._v(" "),t("p",[t("strong",[s._v("session A é€šè¿‡ lock table å‘½ä»¤æŒæœ‰è¡¨ t çš„ MDL å†™é”, è€Œ session B çš„æŸ¥è¯¢éœ€è¦èŽ·å– MDL è¯»é”. æ‰€ä»¥ session B è¿›å…¥ç­‰å¾…çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ç±»é—®é¢˜çš„å¤„ç†æ–¹å¼, å°±æ˜¯"),t("mark",[t("strong",[s._v("æ‰¾åˆ°è°æŒæœ‰ MDL å†™é”, ç„¶åŽæŠŠå®ƒ kill æŽ‰")])]),s._v(".")]),s._v(" "),t("p",[s._v('ä½†æ˜¯, ç”±äºŽåœ¨ show processlist çš„ç»“æžœé‡Œé¢, session A çš„ Command åˆ—æ˜¯ "Sleep", å¯¼è‡´æŸ¥æ‰¾èµ·æ¥å¾ˆä¸æ–¹ä¾¿. ä¸è¿‡æœ‰äº† performance_schema å’Œ sys ç³»ç»Ÿåº“ä»¥åŽ, å°±æ–¹ä¾¿å¤šäº†. (MySQL å¯åŠ¨æ—¶éœ€è¦è®¾ç½® performance_schema=on, ç›¸æ¯”äºŽè®¾ç½®ä¸º off ä¼šæœ‰ 10% å·¦å³çš„æ€§èƒ½æŸå¤±).')]),s._v(" "),t("p",[s._v("é€šè¿‡æŸ¥è¯¢ "),t("strong",[s._v("sys.schema_table_lock_waits")]),s._v(" è¿™å¼ è¡¨, å°±å¯ä»¥ç›´æŽ¥æ‰¾å‡ºé€ æˆé˜»å¡žçš„ process id, æŠŠè¿™ä¸ªè¿žæŽ¥ç”¨ kill å‘½ä»¤æ–­å¼€å³å¯.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3cd84b726769877980f5dea13cfc535f-20230731161914-m5gys9x.png",alt:"",title:"æŸ¥èŽ·åŠ è¡¨é”çš„çº¿ç¨‹ id"}})]),s._v(" "),t("h6",{attrs:{id:"_2-ç­‰flush"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç­‰flush"}},[s._v("#")]),s._v(" (2)ç­‰flush")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥ä¸¾å¦å¤–ä¸€ç§æŸ¥è¯¢è¢«å µä½çš„æƒ…å†µ. åœ¨è¡¨ t ä¸Š, æ‰§è¡Œä¸‹é¢çš„ SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("processlist "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™é‡ŒæŸ¥å‡ºæ¥è¿™ä¸ªçº¿ç¨‹çš„çŠ¶æ€æ˜¯ "),t("mark",[t("strong",[s._v("Waiting for table flush")])]),s._v(", ä½ å¯ä»¥è®¾æƒ³ä¸€ä¸‹è¿™æ˜¯ä»€ä¹ˆåŽŸå› .")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/58c221d28280d57566355fd3cbc8d9ad-20230731161914-ww0406e.png",alt:"",title:"Waiting for table flushçŠ¶æ€ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºçš„æ˜¯, çŽ°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£è¦å¯¹è¡¨ t åš flush æ“ä½œ. MySQL é‡Œé¢å¯¹è¡¨åš flush æ“ä½œçš„ç”¨æ³•, ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ä¸ª:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("flush "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™ä¸¤ä¸ª flush è¯­å¥, å¦‚æžœæŒ‡å®šè¡¨ t çš„è¯, ä»£è¡¨çš„æ˜¯åªå…³é—­è¡¨ t; å¦‚æžœæ²¡æœ‰æŒ‡å®šå…·ä½“çš„è¡¨å, åˆ™è¡¨ç¤ºå…³é—­ MySQL é‡Œæ‰€æœ‰æ‰“å¼€çš„è¡¨. ä½†æ˜¯æ­£å¸¸è¿™ä¸¤ä¸ªè¯­å¥æ‰§è¡Œèµ·æ¥éƒ½å¾ˆå¿«, é™¤éžå®ƒä»¬ä¹Ÿè¢«åˆ«çš„çº¿ç¨‹å µä½äº†.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, å‡ºçŽ° Waiting for table flush çŠ¶æ€çš„å¯èƒ½æƒ…å†µæ˜¯: "),t("mark",[t("strong",[s._v("æœ‰ä¸€ä¸ª flush tables å‘½ä»¤è¢«åˆ«çš„è¯­å¥å µä½äº†, ç„¶åŽå®ƒåˆå µä½äº†æˆ‘ä»¬çš„ select è¯­å¥")])]),s._v(".")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä¸€èµ·æ¥å¤çŽ°ä¸€ä¸‹è¿™ç§æƒ…å†µ, "),t("strong",[s._v("å¤çŽ°æ­¥éª¤")]),s._v("å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/27b2522bc7cd2538086e19ddfa49dc58-20230731161914-k1ssnv9.png",alt:"",title:"Waiting for table flush çš„å¤çŽ°æ­¥éª¤"}})]),s._v(" "),t("p",[s._v('åœ¨ session A ä¸­, æ•…æ„æ¯è¡Œéƒ½è°ƒç”¨ä¸€æ¬¡ sleep(1), è¿™æ ·è¿™ä¸ªè¯­å¥é»˜è®¤è¦æ‰§è¡Œ 10 ä¸‡ç§’, åœ¨è¿™æœŸé—´è¡¨ t ä¸€ç›´æ˜¯è¢« session A "æ‰“å¼€" ç€. ç„¶åŽ session B çš„ flush tables t å‘½ä»¤å†'),t("strong",[s._v("è¦åŽ»å…³é—­è¡¨ t")]),s._v(", å°±éœ€è¦ç­‰ session A çš„æŸ¥è¯¢ç»“æŸ. "),t("strong",[s._v("è¿™æ · session C è¦å†æ¬¡æŸ¥è¯¢çš„è¯, å°±ä¼šè¢« flush å‘½ä»¤å µä½äº†")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹å›¾æ˜¯è¿™ä¸ªå¤çŽ°æ­¥éª¤çš„ show processlist ç»“æžœ. è¿™ä¸ªä¾‹å­çš„æŽ’æŸ¥ä¹Ÿå¾ˆç®€å•, ä½ çœ‹åˆ°è¿™ä¸ª show processlist çš„ç»“æžœ, è‚¯å®šå°±çŸ¥é“åº”è¯¥æ€Žä¹ˆåšäº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/65f2e40fa686aee609e82954fb07274b-20230731161914-2z49tcy.png",alt:"",title:"Waiting for table flush çš„ show processlist ç»“æžœ"}})]),s._v(" "),t("h6",{attrs:{id:"_3-ç­‰è¡Œé”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç­‰è¡Œé”"}},[s._v("#")]),s._v(" (3)ç­‰è¡Œé”")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ç»è¿‡äº†è¡¨çº§é”çš„è€ƒéªŒ, select è¯­å¥ç»ˆäºŽæ¥åˆ°å¼•æ“Žé‡Œäº†.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("share")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™é‡Œç”±äºŽè®¿é—® id=1 è¿™ä¸ªè®°å½•æ—¶è¦"),t("strong",[s._v("åŠ è¯»é”")]),s._v(", å¦‚æžœè¿™æ—¶å€™"),t("strong",[s._v("å·²ç»æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿™è¡Œè®°å½•ä¸ŠæŒæœ‰ä¸€ä¸ªå†™é”")]),s._v(", é‚£ä¹ˆ select è¯­å¥å°±ä¼šè¢«å µä½.")]),s._v(" "),t("p",[s._v("å¤çŽ°æ­¥éª¤å’ŒçŽ°åœºå¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/17465632f546ea650d129c78a3f57072-20230731161914-zhq0vni.png",alt:"",title:"è¡Œé”å¤çŽ°"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c2b499b2716b9fc59d73c5a46c006f4c-20230731161914-34mv2n8.png",alt:"",title:"è¡Œé” show processlist çŽ°åœº"}})]),s._v(" "),t("p",[t("strong",[s._v("æ˜¾ç„¶, session A å¯åŠ¨äº†äº‹åŠ¡, å æœ‰å†™é”, è¿˜ä¸æäº¤, æ˜¯å¯¼è‡´ session B è¢«å µä½çš„åŽŸå› .")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜å¹¶ä¸éš¾åˆ†æž, ä½†é—®é¢˜æ˜¯æ€Žä¹ˆæŸ¥å‡ºæ˜¯è°å ç€è¿™ä¸ªå†™é”. å¦‚æžœæ˜¯ MySQL 5.7 ç‰ˆæœ¬, å¯ä»¥é€šè¿‡ sys.innodb_lock_waits è¡¨æŸ¥åˆ°.")]),s._v(" "),t("p",[s._v("æŸ¥è¯¢æ–¹æ³•æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t sys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" locked_table"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("'test'.'t'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v("\\G\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/3773fa58b4acd0a60cad23579c6b7af3-20230731161914-xvigifo.png",alt:"",title:"é€šè¿‡ sys.innodb_lock_waits æŸ¥è¡Œé”"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªä¿¡æ¯å¾ˆå…¨, "),t("strong",[s._v("4 å·çº¿ç¨‹æ˜¯é€ æˆå µå¡žçš„ç½ªé­ç¥¸é¦–")]),s._v(". è€Œå¹²æŽ‰è¿™ä¸ªç½ªé­ç¥¸é¦–çš„æ–¹å¼, å°±æ˜¯ KILL QUERY 4 æˆ– KILL 4.")]),s._v(" "),t("p",[s._v('ä¸è¿‡, è¿™é‡Œä¸åº”è¯¥æ˜¾ç¤º "KILL QUERY 4". è¿™ä¸ªå‘½ä»¤è¡¨ç¤ºåœæ­¢ 4 å·çº¿ç¨‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¯­å¥, è€Œè¿™ä¸ªæ–¹æ³•å…¶å®žæ˜¯æ²¡æœ‰ç”¨çš„. å› ä¸ºå æœ‰è¡Œé”çš„æ˜¯ update è¯­å¥, è¿™ä¸ªè¯­å¥å·²ç»æ˜¯ä¹‹å‰æ‰§è¡Œå®Œæˆäº†çš„, çŽ°åœ¨æ‰§è¡Œ KILL QUERY, æ— æ³•è®©è¿™ä¸ªäº‹åŠ¡åŽ»æŽ‰ id=1 ä¸Šçš„è¡Œé”.')]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, "),t("strong",[s._v("KILL 4 æ‰æœ‰æ•ˆ")]),s._v(", ä¹Ÿå°±æ˜¯è¯´ç›´æŽ¥æ–­å¼€è¿™ä¸ªè¿žæŽ¥. è¿™é‡Œéšå«çš„ä¸€ä¸ªé€»è¾‘å°±æ˜¯, "),t("strong",[s._v("è¿žæŽ¥è¢«æ–­å¼€çš„æ—¶å€™, ä¼šè‡ªåŠ¨å›žæ»šè¿™ä¸ªè¿žæŽ¥é‡Œé¢æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹")]),s._v(", ä¹Ÿå°±é‡Šæ”¾äº† id=1 ä¸Šçš„è¡Œé”.")]),s._v(" "),t("h5",{attrs:{id:"ç¬¬äºŒç±»-æŸ¥è¯¢æ…¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¬¬äºŒç±»-æŸ¥è¯¢æ…¢"}},[s._v("#")]),s._v(" ç¬¬äºŒç±»:æŸ¥è¯¢æ…¢")]),s._v(" "),t("p",[s._v('ç»è¿‡äº†é‡é‡å°"é”", å†æ¥çœ‹çœ‹ä¸€äº›æŸ¥è¯¢æ…¢çš„ä¾‹å­.')]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ä¸€æ¡ä½ ä¸€å®šçŸ¥é“åŽŸå› çš„ SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç”±äºŽ"),t("strong",[s._v("å­—æ®µ c ä¸Šæ²¡æœ‰ç´¢å¼•")]),s._v(", è¿™ä¸ªè¯­å¥åªèƒ½èµ° id ä¸»é”®é¡ºåºæ‰«æ, å› æ­¤éœ€è¦æ‰«æ 5 ä¸‡è¡Œ. ä½œä¸ºç¡®è®¤, å¯ä»¥çœ‹ä¸€ä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—. æ³¨æ„è¿™é‡Œä¸ºäº†æŠŠæ‰€æœ‰è¯­å¥è®°å½•åˆ° slow log é‡Œ, åœ¨è¿žæŽ¥åŽå…ˆæ‰§è¡Œäº† "),t("code",[s._v("set long_query_time=0")]),s._v("â€‹, å°†æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´é˜ˆå€¼è®¾ç½®ä¸º 0.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/919be7501cb102ba472d76cb368d567f-20230731161914-i1ooys3.png",alt:"",title:"å…¨è¡¨æ‰«æ 5 ä¸‡è¡Œçš„ slow log"}})]),s._v(" "),t("p",[s._v("Rows_examined æ˜¾ç¤ºæ‰«æäº† 50000 è¡Œ. ä½ å¯èƒ½ä¼šè¯´, ä¸æ˜¯å¾ˆæ…¢å‘€, 11.5 æ¯«ç§’å°±è¿”å›žäº†, çº¿ä¸Šä¸€èˆ¬éƒ½é…ç½®è¶…è¿‡ 1 ç§’æ‰ç®—æ…¢æŸ¥è¯¢. ä½†è¦è®°ä½: "),t("mark",[t("strong",[s._v("åæŸ¥è¯¢ä¸ä¸€å®šæ˜¯æ…¢æŸ¥è¯¢")])]),s._v(". è¿™ä¸ªä¾‹å­é‡Œé¢åªæœ‰ 10 ä¸‡è¡Œè®°å½•, æ•°æ®é‡å¤§èµ·æ¥çš„è¯, æ‰§è¡Œæ—¶é—´å°±çº¿æ€§æ¶¨ä¸ŠåŽ»äº†. æ‰«æè¡Œæ•°å¤š, æ‰€ä»¥æ‰§è¡Œæ…¢, è¿™ä¸ªå¾ˆå¥½ç†è§£.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªåªæ‰«æä¸€è¡Œ, ä½†æ˜¯æ‰§è¡Œå¾ˆæ…¢çš„è¯­å¥.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è™½ç„¶æ‰«æè¡Œæ•°æ˜¯ 1, ä½†æ‰§è¡Œæ—¶é—´å´é•¿è¾¾ 800 æ¯«ç§’.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/bf230fba66183fa62c3e5f69dfc11a49-20230731161914-houn7m2.png",alt:"",title:"æ‰«æä¸€è¡Œå´æ‰§è¡Œå¾—å¾ˆæ…¢"}})]),s._v(" "),t("p",[s._v("æ˜¯ä¸æ˜¯æœ‰ç‚¹å¥‡æ€ªå‘¢, è¿™äº›æ—¶é—´éƒ½èŠ±åœ¨å“ªé‡Œäº†?")]),s._v(" "),t("p",[s._v("å¦‚æžœæŠŠè¿™ä¸ª slow log çš„æˆªå›¾å†å¾€ä¸‹æ‹‰ä¸€ç‚¹, å¯ä»¥çœ‹åˆ°ä¸‹ä¸€ä¸ªè¯­å¥, "),t("code",[s._v("select * from t where id=1 lock in share mode")]),s._v("â€‹, æ‰§è¡Œæ—¶æ‰«æè¡Œæ•°ä¹Ÿæ˜¯ 1 è¡Œ, æ‰§è¡Œæ—¶é—´æ˜¯ 0.2 æ¯«ç§’.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ec7cd121c8449d35db4910d935dd5cc0-20230731161914-g56a9r1.png",alt:"",title:"åŠ ä¸Š lock in share mode çš„ slow log"}})]),s._v(" "),t("p",[s._v("çœ‹ä¸ŠåŽ»æ˜¯ä¸æ˜¯æ›´å¥‡æ€ªäº†? "),t("strong",[s._v("æŒ‰ç†è¯´ lock in share mode è¿˜è¦åŠ é”, æ—¶é—´åº”è¯¥æ›´é•¿æ‰å¯¹")]),s._v("å•Š.")]),s._v(" "),t("p",[s._v("å¦‚æžœä½ è¿˜æ²¡æœ‰ç­”æ¡ˆçš„è¯, å†ç»™ä¸€ä¸ªæç¤ºä¿¡æ¯, ä¸‹å›¾æ˜¯è¿™ä¸¤ä¸ªè¯­å¥çš„æ‰§è¡Œè¾“å‡ºç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5078b3d10e247fa17ebd2d6083d197f4-20230731161914-p6fuvrf.png",alt:""}})]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ä¸ªè¯­å¥çš„æŸ¥è¯¢ç»“æžœé‡Œ c=1, å¸¦ "),t("code",[s._v("lock in share mode")]),s._v("â€‹ çš„è¯­å¥è¿”å›žçš„æ˜¯ c=1000001. çœ‹åˆ°è¿™é‡Œåº”è¯¥æœ‰æ›´å¤šçš„åŒå­¦çŸ¥é“åŽŸå› äº†. å¦‚æžœä½ è¿˜æ˜¯æ²¡æœ‰å¤´ç»ªçš„è¯, ä¹Ÿåˆ«ç€æ€¥. å…ˆè·Ÿä½ è¯´æ˜Žä¸€ä¸‹å¤çŽ°æ­¥éª¤, å†åˆ†æžåŽŸå› .")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7f9019044ecb543e53522773ed9a6860-20230731161914-dg7w0i7.png",alt:""}})]),s._v(" "),t("p",[s._v("ä½ çœ‹åˆ°äº†, "),t("strong",[s._v("session A å…ˆç”¨ start transaction with consistent snapshot å‘½ä»¤å¯åŠ¨äº†ä¸€ä¸ªäº‹åŠ¡, ä¹‹åŽ session B æ‰å¼€å§‹æ‰§è¡Œ update è¯­å¥")]),s._v(".")]),s._v(" "),t("p",[s._v("session B æ‰§è¡Œå®Œ 100 ä¸‡æ¬¡ update è¯­å¥åŽ, id=1 è¿™ä¸€è¡Œå¤„äºŽä»€ä¹ˆçŠ¶æ€å‘¢? å¯ä»¥ä»Žå›¾ 16 ä¸­æ‰¾åˆ°ç­”æ¡ˆ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/eed41c34beeea2829c2a01b81a2fa1c1-20230731161914-jxdpv40.png",alt:"",title:"id=1çš„æ•°æ®çŠ¶æ€"}})]),s._v(" "),t("p",[t("strong",[s._v("è¿™é‡Œ session B æ›´æ–°å®Œ 100 ä¸‡æ¬¡, ç”Ÿæˆäº† 100 ä¸‡ä¸ªå›žæ»šæ—¥å¿— (undo log). å¸¦ lock in share mode çš„ SQL è¯­å¥, æ˜¯")]),s._v("â€‹"),t("mark",[t("strong",[s._v("å½“å‰è¯»")])]),s._v("â€‹ "),t("strong",[s._v(", å› æ­¤ä¼šç›´æŽ¥è¯»åˆ° 1000001 è¿™ä¸ªç»“æžœ, æ‰€ä»¥é€Ÿåº¦å¾ˆå¿«; è€Œ select * from t where id=1 è¿™ä¸ªè¯­å¥, æ˜¯")]),s._v("â€‹"),t("mark",[t("strong",[s._v("ä¸€è‡´æ€§è¯»")])]),s._v("â€‹ "),t("strong",[s._v(", å› æ­¤éœ€è¦ä»Ž 1000001 å¼€å§‹, ä¾æ¬¡æ‰§è¡Œ undo log, æ‰§è¡Œäº† 100 ä¸‡æ¬¡ä»¥åŽ, æ‰å°† 1 è¿™ä¸ªç»“æžœè¿”å›ž.")])]),s._v(" "),t("p",[s._v('æ³¨æ„, undo log é‡Œè®°å½•çš„å…¶å®žæ˜¯ "æŠŠ 2 æ”¹æˆ 1", "æŠŠ 3 æ”¹æˆ 2" è¿™æ ·çš„æ“ä½œé€»è¾‘, ç”»æˆå‡ 1 çš„ç›®çš„æ˜¯æ–¹ä¾¿ä½ çœ‹å›¾.')]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-18"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-18"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v('æœ¬èŠ‚ä¸¾äº†åœ¨ä¸€ä¸ªç®€å•çš„è¡¨ä¸Š, æ‰§è¡Œ"æŸ¥ä¸€è¡Œ", å¯èƒ½ä¼šå‡ºçŽ°çš„è¢«é”ä½å’Œæ‰§è¡Œæ…¢çš„ä¾‹å­. è¿™å…¶ä¸­æ¶‰åŠåˆ°äº†'),t("strong",[s._v("è¡¨é”, è¡Œé”å’Œä¸€è‡´æ€§è¯»çš„æ¦‚å¿µ")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨å®žé™…ä½¿ç”¨ä¸­, ç¢°åˆ°çš„åœºæ™¯ä¼šæ›´å¤æ‚. ä½†å¤§åŒå°å¼‚, å¯ä»¥æŒ‰ç…§æˆ‘åœ¨æ–‡ç« ä¸­ä»‹ç»çš„å®šä½æ–¹æ³•, æ¥å®šä½å¹¶è§£å†³é—®é¢˜.")]),s._v(" "),t("h4",{attrs:{id:"_20-å¹»è¯»æ˜¯ä»€ä¹ˆ-å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_20-å¹»è¯»æ˜¯ä»€ä¹ˆ-å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜"}},[s._v("#")]),s._v(" 20-å¹»è¯»æ˜¯ä»€ä¹ˆ,å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜?")]),s._v(" "),t("p",[s._v("å‰é¢åœ¨ä¸¾ä¾‹åŠ é”è¯»çš„æ—¶å€™, ç”¨çš„æ˜¯è¿™ä¸ªè¯­å¥, "),t("code",[s._v("select * from t where id=1 lock in share mode")]),s._v("â€‹. ç”±äºŽ id ä¸Šæœ‰ç´¢å¼•, æ‰€ä»¥å¯ä»¥ç›´æŽ¥å®šä½åˆ° id=1 è¿™ä¸€è¡Œ, å› æ­¤"),t("strong",[s._v("è¯»é”ä¹Ÿæ˜¯åªåŠ åœ¨äº†è¿™ä¸€è¡Œ")]),s._v("ä¸Š.")]),s._v(" "),t("p",[s._v("ä½†å¦‚æžœæ˜¯ä¸‹é¢çš„ SQL è¯­å¥,")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™ä¸ª"),t("strong",[s._v("è¯­å¥åºåˆ—æ˜¯æ€Žä¹ˆåŠ é”çš„å‘¢? åŠ çš„é”åˆæ˜¯ä»€ä¹ˆæ—¶å€™é‡Šæ”¾")]),s._v("å‘¢? æœ¬èŠ‚å°±ä»Žè¿™ä¸ªé—®é¢˜è¯´èµ·.")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽè¯´æ˜Žé—®é¢˜, æœ¬èŠ‚å°±å…ˆä½¿ç”¨ä¸€ä¸ªå°ä¸€ç‚¹å„¿çš„è¡¨. å»ºè¡¨å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹(ä¸ºäº†ä¾¿äºŽæœ¬æœŸçš„ä¾‹å­è¯´æ˜Ž, è¿™é‡ŒæŠŠä¸ŠèŠ‚ä¸­ç”¨åˆ°çš„è¡¨ç»“æž„åšäº†ç‚¹å„¿ä¿®æ”¹):")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¡¨é™¤äº†ä¸»é”® id å¤–, è¿˜æœ‰ä¸€ä¸ªç´¢å¼• c, åˆå§‹åŒ–è¯­å¥åœ¨è¡¨ä¸­æ’å…¥äº† 6 è¡Œæ•°æ®.")]),s._v(" "),t("p",[s._v("å¯¹äºŽå‰é¢çš„ SQL è¯­å¥, æ¯”è¾ƒå¥½ç†è§£çš„æ˜¯, è¿™ä¸ªè¯­å¥ä¼šå‘½ä¸­ d=5 çš„è¿™ä¸€è¡Œ, å¯¹åº”çš„ä¸»é”® id=5, å› æ­¤åœ¨ select è¯­å¥æ‰§è¡Œå®ŒæˆåŽ, id=5 "),t("strong",[s._v("è¿™ä¸€è¡Œä¼šåŠ ä¸€ä¸ªå†™é”, è€Œä¸”ç”±äºŽä¸¤é˜¶æ®µé”åè®®, è¿™ä¸ªå†™é”ä¼šåœ¨æ‰§è¡Œ commit è¯­å¥çš„æ—¶å€™é‡Šæ”¾")]),s._v(".")]),s._v(" "),t("p",[s._v("ç”±äºŽå­—æ®µ d ä¸Šæ²¡æœ‰ç´¢å¼•, å› æ­¤è¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šåš"),t("strong",[s._v("å…¨è¡¨æ‰«æ")]),s._v(". é‚£"),t("strong",[s._v("å…¶ä»–è¢«æ‰«æåˆ°çš„, ä½†æ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„ 5 è¡Œè®°å½•ä¸Š, ä¼šä¸ä¼šè¢«åŠ é”")]),s._v("å‘¢? ç”±äºŽ InnoDB çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯», æ‰€ä»¥æœ¬æ–‡æŽ¥ä¸‹æ¥æ²¡æœ‰ç‰¹æ®Šè¯´æ˜Žçš„éƒ¨åˆ†, éƒ½æ˜¯è®¾å®šåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"å¹»è¯»æ˜¯ä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹»è¯»æ˜¯ä»€ä¹ˆ"}},[s._v("#")]),s._v(" å¹»è¯»æ˜¯ä»€ä¹ˆ?")]),s._v(" "),t("p",[s._v("çŽ°åœ¨å°±æ¥åˆ†æžä¸€ä¸‹, "),t("strong",[s._v("å¦‚æžœåªåœ¨ id=5 è¿™ä¸€è¡ŒåŠ é”, è€Œå…¶ä»–è¡Œçš„ä¸åŠ é”çš„è¯, ä¼šæ€Žä¹ˆæ ·")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹é¢å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯(æ³¨æ„: è¿™æ˜¯å‡è®¾çš„ä¸€ä¸ªåœºæ™¯):")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0f02d0025955139b2eb919de60465f33-20230731161914-31jrooj.png",alt:"",title:"å‡è®¾åªåœ¨ id=5 è¿™ä¸€è¡ŒåŠ è¡Œé”"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, session A é‡Œæ‰§è¡Œäº†ä¸‰æ¬¡æŸ¥è¯¢, åˆ†åˆ«æ˜¯ Q1, Q2 å’Œ Q3. å®ƒä»¬çš„ SQL è¯­å¥ç›¸åŒ, éƒ½æ˜¯ "),t("code",[s._v("select * from t where d=5 for update")]),s._v("â€‹. è¿™ä¸ªè¯­å¥çš„æ„æ€ä½ åº”è¯¥å¾ˆæ¸…æ¥šäº†, æŸ¥æ‰€æœ‰ d=5 çš„è¡Œ, è€Œä¸”ä½¿ç”¨çš„æ˜¯"),t("mark",[t("strong",[s._v("å½“å‰è¯»")])]),s._v(", å¹¶ä¸”åŠ ä¸Šå†™é”. çŽ°åœ¨æ¥çœ‹ä¸€ä¸‹è¿™ä¸‰æ¡ SQL è¯­å¥, åˆ†åˆ«ä¼šè¿”å›žä»€ä¹ˆç»“æžœ.")]),s._v(" "),t("ol",[t("li",[s._v("Q1 åªè¿”å›ž id=5 è¿™ä¸€è¡Œ;")]),s._v(" "),t("li",[s._v("åœ¨ T2 æ—¶åˆ», session B æŠŠ id=0 è¿™ä¸€è¡Œçš„ d å€¼æ”¹æˆäº† 5, å› æ­¤ T3 æ—¶åˆ» Q2 æŸ¥å‡ºæ¥çš„æ˜¯ id=0 å’Œ id=5 è¿™ä¸¤è¡Œ;")]),s._v(" "),t("li",[s._v("åœ¨ T4 æ—¶åˆ», session C åˆæ’å…¥ä¸€è¡Œ(1,1,5), å› æ­¤ T5 æ—¶åˆ» Q3 æŸ¥å‡ºæ¥çš„æ˜¯ id=0, id=1 å’Œ id=5 çš„è¿™ä¸‰è¡Œ.")])]),s._v(" "),t("p",[s._v('å…¶ä¸­, Q3 è¯»åˆ° id=1 è¿™ä¸€è¡Œçš„çŽ°è±¡, è¢«ç§°ä¸º "'),t("strong",[s._v("å¹»è¯»")]),s._v('". '),t("mark",[t("strong",[s._v("å¹»è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å‰åŽä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´çš„æ—¶å€™, åŽä¸€æ¬¡æŸ¥è¯¢çœ‹åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„è¡Œ")])]),s._v(".")]),s._v(" "),t("p",[s._v('è¿™é‡Œéœ€è¦å¯¹"å¹»è¯»"åšä¸€ä¸ªè¯´æ˜Ž:')]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v('åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹, æ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯», æ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„. å› æ­¤, å¹»è¯»åœ¨ "å½“å‰è¯»" ä¸‹æ‰ä¼šå‡ºçŽ°.')])])]),s._v(" "),t("li",[s._v('ä¸Šé¢ session B çš„ä¿®æ”¹ç»“æžœ, è¢« session A ä¹‹åŽçš„ select è¯­å¥ç”¨ "å½“å‰è¯»" çœ‹åˆ°, ä¸èƒ½ç§°ä¸ºå¹»è¯». '),t("mark",[t("strong",[s._v('å¹»è¯»ä»…ä¸“æŒ‡ "æ–°æ’å…¥çš„è¡Œ"')])]),s._v(" .")])]),s._v(" "),t("p",[s._v("å¦‚æžœåªä»Žå‰é¢ä»‹ç»çš„äº‹åŠ¡å¯è§æ€§è§„åˆ™æ¥åˆ†æžçš„è¯, ä¸Šé¢è¿™ä¸‰æ¡ SQL è¯­å¥çš„è¿”å›žç»“æžœéƒ½æ²¡æœ‰é—®é¢˜. å› ä¸ºè¿™"),t("mark",[t("strong",[s._v("ä¸‰ä¸ªæŸ¥è¯¢éƒ½æ˜¯åŠ äº† for update, éƒ½æ˜¯å½“å‰è¯». è€Œå½“å‰è¯»çš„è§„åˆ™, å°±æ˜¯è¦èƒ½è¯»åˆ°æ‰€æœ‰å·²ç»æäº¤çš„è®°å½•çš„æœ€æ–°å€¼")])]),s._v(". å¹¶ä¸” session B å’Œ sessionC çš„ä¸¤æ¡è¯­å¥, æ‰§è¡ŒåŽå°±ä¼šæäº¤, æ‰€ä»¥ Q2 å’Œ Q3 å°±æ˜¯åº”è¯¥çœ‹åˆ°è¿™ä¸¤ä¸ªäº‹åŠ¡çš„æ“ä½œæ•ˆæžœ, è€Œä¸”ä¹Ÿçœ‹åˆ°äº†, "),t("strong",[s._v("è¿™è·Ÿäº‹åŠ¡çš„å¯è§æ€§è§„åˆ™å¹¶ä¸çŸ›ç›¾")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†è¿™æ˜¯ä¸æ˜¯çœŸçš„æ²¡é—®é¢˜å‘¢? ä¸, è¿™é‡Œè¿˜çœŸå°±æœ‰é—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜"}},[s._v("#")]),s._v(" å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜?")]),s._v(" "),t("p",[t("strong",[s._v('é¦–å…ˆæ˜¯è¯­ä¹‰ä¸Šçš„. ** session A åœ¨ T1 æ—¶åˆ»å°±å£°æ˜Žäº†, "'),t("strong",[s._v("æˆ‘è¦æŠŠæ‰€æœ‰ d=5 çš„è¡Œé”ä½, ä¸å‡†åˆ«çš„äº‹åŠ¡è¿›è¡Œè¯»å†™æ“ä½œ")]),s._v('". è€Œå®žé™…ä¸Š, è¿™ä¸ª')]),s._v("è¯­ä¹‰è¢«ç ´å**äº†.")]),s._v(" "),t("p",[s._v("å¦‚æžœçŽ°åœ¨è¿™æ ·çœ‹æ„Ÿè§‰è¿˜ä¸æ˜Žæ˜¾çš„è¯, å†å¾€ session B å’Œ session C é‡Œé¢åˆ†åˆ«åŠ ä¸€æ¡ SQL è¯­å¥, å†çœ‹çœ‹ä¼šå‡ºçŽ°ä»€ä¹ˆçŽ°è±¡.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/abdf2ae439c3cfec20335c3690f23ed7-20230731161914-6wfzzl5.png",alt:"",title:"å‡è®¾åªåœ¨ id=5 è¿™ä¸€è¡ŒåŠ è¡Œé” -- è¯­ä¹‰è¢«ç ´å"}})]),s._v(" "),t("p",[s._v("session B çš„ç¬¬äºŒæ¡è¯­å¥ "),t("code",[s._v("update t set c=5 where id=0")]),s._v('â€‹, è¯­ä¹‰æ˜¯ "æˆ‘æŠŠ id=0, d=5 è¿™ä¸€è¡Œçš„ c å€¼, æ”¹æˆäº† 5".')]),s._v(" "),t("p",[s._v("ç”±äºŽåœ¨ T1 æ—¶åˆ», session A è¿˜"),t("strong",[s._v("åªæ˜¯ç»™ id=5 è¿™ä¸€è¡ŒåŠ äº†è¡Œé”, å¹¶æ²¡æœ‰ç»™ id=0 è¿™è¡ŒåŠ ä¸Šé”")]),s._v(". å› æ­¤ session B åœ¨ T2 æ—¶åˆ», æ˜¯å¯ä»¥æ‰§è¡Œè¿™ä¸¤æ¡ update è¯­å¥çš„. è¿™æ ·å°±ç ´åäº† session A é‡Œ Q1 è¯­å¥è¦é”ä½æ‰€æœ‰ d=5 çš„è¡Œçš„åŠ é”å£°æ˜Ž.")]),s._v(" "),t("p",[s._v("session C ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†, å¯¹ id=1 è¿™ä¸€è¡Œçš„ä¿®æ”¹, ä¹Ÿæ˜¯ç ´åäº† Q1 çš„åŠ é”å£°æ˜Ž.")]),s._v(" "),t("p",[t("strong",[s._v("å…¶æ¬¡, æ˜¯æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜. é”çš„è®¾è®¡æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§. è€Œè¿™ä¸ªä¸€è‡´æ€§, ä¸æ­¢æ˜¯æ•°æ®åº“å†…éƒ¨æ•°æ®çŠ¶æ€åœ¨æ­¤åˆ»çš„ä¸€è‡´æ€§, è¿˜åŒ…å«äº†æ•°æ®å’Œæ—¥å¿—åœ¨é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§.")])]),s._v(" "),t("p",[s._v("ä¸ºäº†è¯´æ˜Žè¿™ä¸ªé—®é¢˜, ç»™ session A åœ¨ T1 æ—¶åˆ»å†åŠ ä¸€ä¸ªæ›´æ–°è¯­å¥, å³: "),t("code",[s._v("update t set d=100 where d=5")]),s._v("â€‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2e306265ae78ee5cf0cdb84e14460f41-20230731161914-dvir9z8.png",alt:"",title:"å‡è®¾åªåœ¨ id=5 è¿™ä¸€è¡ŒåŠ è¡Œé” -- æ•°æ®ä¸€è‡´æ€§é—®é¢˜"}})]),s._v(" "),t("p",[s._v("update çš„åŠ é”è¯­ä¹‰å’Œ "),t("code",[s._v("select ... for update")]),s._v('â€‹ æ˜¯ä¸€è‡´çš„, æ‰€ä»¥è¿™æ—¶å€™åŠ ä¸Šè¿™æ¡ update è¯­å¥ä¹Ÿå¾ˆåˆç†. session A å£°æ˜Žè¯´ "è¦ç»™ d=5 çš„è¯­å¥åŠ ä¸Šé”", å°±æ˜¯ä¸ºäº†è¦æ›´æ–°æ•°æ®, æ–°åŠ çš„è¿™æ¡ update è¯­å¥å°±æ˜¯æŠŠå®ƒè®¤ä¸ºåŠ ä¸Šäº†é”çš„è¿™ä¸€è¡Œçš„ d å€¼ä¿®æ”¹æˆäº† 100.')]),s._v(" "),t("p",[s._v("çŽ°åœ¨æ¥åˆ†æžä¸€ä¸‹ä¸Šå›¾æ‰§è¡Œå®ŒæˆåŽ, æ•°æ®åº“é‡Œä¼šæ˜¯ä»€ä¹ˆç»“æžœ.")]),s._v(" "),t("ol",[t("li",[s._v("ç»è¿‡ T1 æ—¶åˆ», id=5 è¿™ä¸€è¡Œå˜æˆ (5,5,100), å½“ç„¶è¿™ä¸ªç»“æžœ"),t("strong",[s._v("æœ€ç»ˆ")]),s._v("æ˜¯åœ¨ T6 æ—¶åˆ»æ­£å¼æäº¤çš„;")]),s._v(" "),t("li",[s._v("ç»è¿‡ T2 æ—¶åˆ», id=0 è¿™ä¸€è¡Œå˜æˆ (0,5,5);")]),s._v(" "),t("li",[s._v("ç»è¿‡ T4 æ—¶åˆ», è¡¨é‡Œé¢å¤šäº†ä¸€è¡Œ (1,5,5);")]),s._v(" "),t("li",[s._v("å…¶ä»–è¡Œè·Ÿè¿™ä¸ªæ‰§è¡Œåºåˆ—æ— å…³, ä¿æŒä¸å˜.")])]),s._v(" "),t("p",[s._v("è¿™æ ·çœ‹, è¿™äº›æ•°æ®ä¹Ÿæ²¡å•¥é—®é¢˜, ä½†æ˜¯å†æ¥çœ‹çœ‹è¿™æ—¶å€™ "),t("strong",[s._v("binlog é‡Œé¢çš„å†…å®¹")]),s._v(".")]),s._v(" "),t("ol",[t("li",[s._v("T2 æ—¶åˆ», session B äº‹åŠ¡æäº¤, å†™å…¥äº†ä¸¤æ¡è¯­å¥;")]),s._v(" "),t("li",[s._v("T4 æ—¶åˆ», session C äº‹åŠ¡æäº¤, å†™å…¥äº†ä¸¤æ¡è¯­å¥;")]),s._v(" "),t("li",[s._v("T6 æ—¶åˆ», session A äº‹åŠ¡æäº¤, å†™å…¥äº† "),t("code",[s._v("update t set d=100 where d=5")]),s._v("â€‹ è¿™æ¡è¯­å¥.")])]),s._v(" "),t("p",[s._v("ç»Ÿä¸€æ”¾åˆ°ä¸€èµ·çš„è¯, å°±æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*(0,0,5)*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*(0,5,5)*/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*(1,1,5)*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*(1,5,5)*/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*æ‰€æœ‰d=5çš„è¡Œ, dæ”¹æˆ100*/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("å¥½, ä½ åº”è¯¥çœ‹å‡ºé—®é¢˜äº†. è¿™ä¸ªè¯­å¥åºåˆ—, ä¸è®ºæ˜¯æ‹¿åˆ°å¤‡åº“åŽ»æ‰§è¡Œ, è¿˜æ˜¯ä»¥åŽç”¨ binlog æ¥å…‹éš†ä¸€ä¸ªåº“, "),t("strong",[s._v("è¿™ä¸‰è¡Œçš„ç»“æžœ, éƒ½å˜æˆäº† (0,5,100), (1,5,100) å’Œ (5,5,100)")]),s._v(" . ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("==id=0 å’Œ id=1 è¿™ä¸¤è¡Œ, å‘ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´==")]),s._v(". è¿™ä¸ªé—®é¢˜å¾ˆä¸¥é‡, æ˜¯ä¸è¡Œçš„.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œå†å›žé¡¾ä¸€ä¸‹, **è¿™ä¸ªæ•°æ®ä¸ä¸€è‡´åˆ°åº•æ˜¯æ€Žä¹ˆå¼•å…¥çš„? **")]),s._v(" "),t("p",[s._v('åˆ†æžä¸€ä¸‹å¯ä»¥çŸ¥é“, è¿™æ˜¯å‡è®¾ "'),t("code",[s._v("select * from t where d=5 for update")]),s._v("â€‹ è¿™æ¡è¯­å¥"),t("strong",[s._v("åªç»™ d=5 è¿™ä¸€è¡Œ, ä¹Ÿå°±æ˜¯ id=5 çš„è¿™ä¸€è¡ŒåŠ é”")]),s._v('" å¯¼è‡´çš„. æ‰€ä»¥æˆ‘ä»¬è®¤ä¸º, ä¸Šé¢çš„è®¾å®šä¸åˆç†, è¦æ”¹.')]),s._v(" "),t("p",[s._v("é‚£æ€Žä¹ˆæ”¹å‘¢? "),t("strong",[s._v("æŠŠæ‰«æè¿‡ç¨‹ä¸­ç¢°åˆ°çš„è¡Œ, ä¹Ÿéƒ½åŠ ä¸Šå†™é”")]),s._v(", å†æ¥çœ‹çœ‹æ‰§è¡Œæ•ˆæžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cd508de46eafd1fcab6f8023adfab0d5-20230731161914-9gr5pld.png",alt:"",title:"å‡è®¾æ‰«æåˆ°çš„è¡Œéƒ½è¢«åŠ ä¸Šäº†è¡Œé”"}})]),s._v(" "),t("p",[t("strong",[s._v("ç”±äºŽ session A æŠŠæ‰€æœ‰çš„è¡Œéƒ½åŠ äº†å†™é”, æ‰€ä»¥ session B åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ª update è¯­å¥çš„æ—¶å€™å°±è¢«é”ä½äº†. éœ€è¦ç­‰åˆ° T6 æ—¶åˆ» session A æäº¤ä»¥åŽ, session B æ‰èƒ½ç»§ç»­æ‰§è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ ·å¯¹äºŽ id=0 è¿™ä¸€è¡Œ, åœ¨æ•°æ®åº“é‡Œçš„æœ€ç»ˆç»“æžœè¿˜æ˜¯ (0,5,5). åœ¨ binlog é‡Œé¢, æ‰§è¡Œåºåˆ—æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*(1,1,5)*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*(1,5,5)*/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*æ‰€æœ‰d=5çš„è¡Œ, dæ”¹æˆ100*/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*(0,0,5)*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*(0,5,5)*/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°, æŒ‰ç…§æ—¥å¿—é¡ºåºæ‰§è¡Œ, id=0 è¿™ä¸€è¡Œçš„æœ€ç»ˆç»“æžœä¹Ÿæ˜¯ (0,5,5). æ‰€ä»¥ id=0 è¿™ä¸€è¡Œçš„é—®é¢˜è§£å†³äº†.")]),s._v(" "),t("p",[s._v('ä½†åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°, id=1 è¿™ä¸€è¡Œ, åœ¨æ•°æ®åº“é‡Œé¢çš„ç»“æžœæ˜¯ (1,5,5), è€Œæ ¹æ® binlog çš„æ‰§è¡Œç»“æžœæ˜¯ (1,5,100), ä¹Ÿå°±æ˜¯è¯´å¹»è¯»çš„é—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³. ä¸ºä»€ä¹ˆå·²ç»è¿™ä¹ˆ "å‡¶æ®‹" åœ°, æŠŠæ‰€æœ‰çš„è®°å½•éƒ½ä¸Šäº†é”, è¿˜æ˜¯é˜»æ­¢ä¸äº† id=1 è¿™ä¸€è¡Œçš„æ’å…¥å’Œæ›´æ–°å‘¢?')]),s._v(" "),t("p",[s._v('åŽŸå› å¾ˆç®€å•. **==åœ¨ T3 æ—¶åˆ», ç»™æ‰€æœ‰è¡ŒåŠ é”çš„æ—¶å€™, id=1 è¿™ä¸€è¡Œè¿˜ä¸å­˜åœ¨, ä¸å­˜åœ¨ä¹Ÿå°±åŠ ä¸ä¸Šé”. ä¹Ÿå°±æ˜¯è¯´, å³ä½¿æŠŠæ‰€æœ‰çš„è®°å½•éƒ½åŠ ä¸Šé”, è¿˜æ˜¯é˜»æ­¢ä¸äº†æ–°æ’å…¥çš„è®°å½•==**â€‹ **, ** è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ "å¹»è¯»" ä¼šè¢«å•ç‹¬æ‹¿å‡ºæ¥è§£å†³çš„åŽŸå› .')]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œ, å…¶å®žåˆšè¯´æ˜Žå®Œæœ¬èŠ‚æ ‡é¢˜: å¹»è¯»çš„å®šä¹‰å’Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜. æŽ¥ä¸‹æ¥å†çœ‹çœ‹ InnoDB æ€Žä¹ˆè§£å†³å¹»è¯»çš„é—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"innodbå¦‚ä½•è§£å†³å¹»è¯»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#innodbå¦‚ä½•è§£å†³å¹»è¯»"}},[s._v("#")]),s._v(" InnoDBå¦‚ä½•è§£å†³å¹»è¯»?")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä½ çŸ¥é“äº†, "),t("mark",[t("strong",[s._v('äº§ç”Ÿå¹»è¯»çš„åŽŸå› æ˜¯, è¡Œé”åªèƒ½é”ä½è¡Œ, ä½†æ˜¯æ–°æ’å…¥è®°å½•è¿™ä¸ªåŠ¨ä½œ, è¦æ›´æ–°çš„æ˜¯è®°å½•ä¹‹é—´çš„"é—´éš™". å› æ­¤, ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜, InnoDB åªå¥½å¼•å…¥æ–°çš„é”, ä¹Ÿå°±æ˜¯é—´éš™é” (Gap Lock)')])]),s._v(" .")]),s._v(" "),t("p",[s._v("é¡¾åæ€ä¹‰, é—´éš™é”, "),t("strong",[s._v("é”çš„å°±æ˜¯ä¸¤ä¸ªå€¼ä¹‹é—´çš„ç©ºéš™")]),s._v(". æ¯”å¦‚æœ¬èŠ‚å¼€å¤´çš„è¡¨ t, åˆå§‹åŒ–æ’å…¥äº† 6 ä¸ªè®°å½•, è¿™å°±äº§ç”Ÿäº† 7 ä¸ªé—´éš™.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/757ec6db64c8f287844a5502c3047984-20230731161914-ibuarc7.png",alt:"",title:"è¡¨ t ä¸»é”®ç´¢å¼•ä¸Šçš„è¡Œé”å’Œé—´éš™é”"}})]),s._v(" "),t("p",[s._v("è¿™æ ·, å½“ä½ æ‰§è¡Œ "),t("code",[s._v("select * from t where d=5 for update")]),s._v("â€‹ çš„æ—¶å€™, å°±ä¸æ­¢æ˜¯ç»™æ•°æ®åº“ä¸­å·²æœ‰çš„ 6 ä¸ªè®°å½•åŠ ä¸Šäº†è¡Œé”, "),t("strong",[s._v("è¿˜åŒæ—¶åŠ äº† 7 ä¸ªé—´éš™é”. è¿™æ ·å°±ç¡®ä¿äº†æ— æ³•å†æ’å…¥æ–°çš„è®°å½•")]),s._v(". ä¹Ÿå°±æ˜¯è¯´è¿™æ—¶å€™, åœ¨ä¸€è¡Œè¡Œæ‰«æçš„è¿‡ç¨‹ä¸­, "),t("strong",[s._v("ä¸ä»…å°†ç»™è¡ŒåŠ ä¸Šäº†è¡Œé”, è¿˜ç»™è¡Œä¸¤è¾¹çš„ç©ºéš™, ä¹ŸåŠ ä¸Šäº†é—´éš™é”")]),s._v(".")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä½ çŸ¥é“äº†, "),t("strong",[s._v("æ•°æ®è¡Œæ˜¯å¯ä»¥åŠ ä¸Šé”çš„å®žä½“, æ•°æ®è¡Œä¹‹é—´çš„é—´éš™, ä¹Ÿæ˜¯å¯ä»¥åŠ ä¸Šé”çš„å®žä½“")]),s._v(". ä½†æ˜¯é—´éš™é”è·Ÿæˆ‘ä»¬ä¹‹å‰ç¢°åˆ°è¿‡çš„é”éƒ½ä¸å¤ªä¸€æ ·.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚è¡Œé”, åˆ†æˆè¯»é”å’Œå†™é”. ä¸‹å›¾å°±æ˜¯è¿™ä¸¤ç§ç±»åž‹è¡Œé”çš„å†²çªå…³ç³». ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v('è·Ÿè¡Œé”æœ‰å†²çªå…³ç³»çš„æ˜¯ "å¦å¤–ä¸€ä¸ªè¡Œé”"')]),s._v(" .")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/21ce55783f1e1ea5e1c2e41de7527fb5-20230731161914-amz5y6y.png",alt:"",title:"ä¸¤ç§è¡Œé”é—´çš„å†²çªå…³ç³»"}})]),s._v(" "),t("p",[s._v("ä½†æ˜¯é—´éš™é”ä¸ä¸€æ ·, "),t("mark",[t("strong",[s._v('è·Ÿé—´éš™é”å­˜åœ¨å†²çªå…³ç³»çš„, æ˜¯ "å¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•" è¿™ä¸ªæ“ä½œ. é—´éš™é”ä¹‹é—´éƒ½ä¸å­˜åœ¨å†²çªå…³ç³»')])]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™å¥è¯ä¸å¤ªå¥½ç†è§£, ä¸¾ä¸ªä¾‹å­:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/484f59cce0ea97441550c537600f62e9-20230731161914-fr1xyrj.png",alt:"",title:"é—´éš™é”ä¹‹é—´ä¸äº’é”"}})]),s._v(" "),t("p",[t("strong",[s._v("è¿™é‡Œ session B å¹¶ä¸ä¼šè¢«å µä½")]),s._v(". å› ä¸ºè¡¨ t é‡Œå¹¶æ²¡æœ‰ c=7 è¿™ä¸ªè®°å½•, "),t("strong",[s._v("å› æ­¤ session A åŠ çš„æ˜¯é—´éš™é” (5,10)")]),s._v(" . è€Œ session B ä¹Ÿæ˜¯åœ¨è¿™ä¸ªé—´éš™åŠ çš„é—´éš™é”. "),t("mark",[t("strong",[s._v("å®ƒä»¬æœ‰å…±åŒçš„ç›®æ ‡, å³: ä¿æŠ¤è¿™ä¸ªé—´éš™, ä¸å…è®¸æ’å…¥å€¼. ä½†å®ƒä»¬ä¹‹é—´æ˜¯ä¸å†²çªçš„")])]),s._v(".")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("é—´éš™é”å’Œè¡Œé”åˆç§° next-key lock, æ¯ä¸ª next-key lock æ˜¯å‰å¼€åŽé—­åŒºé—´")])]),s._v(". ä¹Ÿå°±æ˜¯è¯´, è¡¨ t åˆå§‹åŒ–ä»¥åŽ, å¦‚æžœç”¨ "),t("code",[s._v("select * from t for update")]),s._v("â€‹ è¦æŠŠæ•´ä¸ªè¡¨æ‰€æœ‰è®°å½•é”èµ·æ¥, å°±å½¢æˆäº† 7 ä¸ª next-key lock, åˆ†åˆ«æ˜¯ "),t("code",[s._v("(-âˆž,0], (0,5], (5,10], (10,15], (15,20], (20, 25], (25, +supremum]")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("å¤‡æ³¨: æœ¬èŠ‚å¦‚æžœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜Ž, æŠŠé—´éš™é”è®°ä¸ºå¼€åŒºé—´, æŠŠ next-key lock è®°ä¸ºå‰å¼€åŽé—­åŒºé—´.")]),s._v(" "),t("p",[s._v('ä½ å¯èƒ½ä¼šé—®è¯´, è¿™ä¸ª supremum ä»Žå“ªå„¿æ¥çš„å‘¢? è¿™æ˜¯å› ä¸º +âˆž æ˜¯å¼€åŒºé—´. å®žçŽ°ä¸Š, InnoDB ç»™æ¯ä¸ªç´¢å¼•åŠ äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æœ€å¤§å€¼ supremum, è¿™æ ·æ‰ç¬¦åˆå‰é¢è¯´çš„ "éƒ½æ˜¯å‰å¼€åŽé—­åŒºé—´".')]),s._v(" "),t("p",[s._v('**é—´éš™é”å’Œ next-key lock çš„å¼•å…¥, è§£å†³äº†å¹»è¯»çš„é—®é¢˜, ä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›"å›°æ‰°". **')]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜å¯¹åº”åˆ°æœ¬èŠ‚è¿™ä¸ªä¾‹å­çš„è¡¨æ¥è¯´, ä¸šåŠ¡é€»è¾‘è¿™æ ·çš„: "),t("strong",[s._v("ä»»æ„é”ä½ä¸€è¡Œ, å¦‚æžœè¿™ä¸€è¡Œä¸å­˜åœ¨çš„è¯å°±æ’å…¥, å¦‚æžœå­˜åœ¨è¿™ä¸€è¡Œå°±æ›´æ–°å®ƒçš„æ•°æ®")]),s._v(", ä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("N "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*å¦‚æžœè¡Œä¸å­˜åœ¨*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("N"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("N"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("N"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*å¦‚æžœè¡Œå­˜åœ¨*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("N "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("N"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("å¯èƒ½ä½ ä¼šè¯´, è¿™ä¸ªä¸æ˜¯ "),t("code",[s._v("insert ... on duplicate key update")]),s._v("â€‹ å°±èƒ½è§£å†³å—? ä½†å…¶å®žåœ¨æœ‰"),t("strong",[s._v("å¤šä¸ªå”¯ä¸€é”®")]),s._v("çš„æ—¶å€™, è¿™ä¸ªæ–¹æ³•æ˜¯ä¸èƒ½æ»¡è¶³è¿™ä½æé—®åŒå­¦çš„éœ€æ±‚çš„. è‡³äºŽä¸ºä»€ä¹ˆ, åŽé¢çš„æ–‡ç« ä¸­å†å±•å¼€è¯´æ˜Ž.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨, å°±åªè®¨è®ºè¿™ä¸ªé€»è¾‘.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜çš„çŽ°è±¡æ˜¯, "),t("strong",[s._v("è¿™ä¸ªé€»è¾‘ä¸€æ—¦æœ‰å¹¶å‘, å°±ä¼šç¢°åˆ°æ­»é”")]),s._v(". ä½ ä¸€å®šä¹Ÿè§‰å¾—å¥‡æ€ª, è¿™ä¸ªé€»è¾‘æ¯æ¬¡æ“ä½œå‰ç”¨ "),t("code",[s._v("for update")]),s._v("â€‹ é”èµ·æ¥, å·²ç»æ˜¯æœ€ä¸¥æ ¼çš„æ¨¡å¼äº†, æ€Žä¹ˆè¿˜ä¼šæœ‰æ­»é”å‘¢?")]),s._v(" "),t("p",[s._v("è¿™é‡Œç”¨ä¸¤ä¸ª session æ¥æ¨¡æ‹Ÿå¹¶å‘, å¹¶å‡è®¾ N=9.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d1fcdf7f7c288bbf92655e2995a787b6-20230731161914-pukwzi0.png",alt:"",title:"é—´éš™é”å¯¼è‡´çš„æ­»é”"}})]),s._v(" "),t("p",[s._v("ä½ çœ‹åˆ°äº†, å…¶å®žéƒ½ä¸éœ€è¦ç”¨åˆ°åŽé¢çš„ update è¯­å¥, å°±å·²ç»å½¢æˆæ­»é”äº†. æŒ‰è¯­å¥æ‰§è¡Œé¡ºåºæ¥åˆ†æžä¸€ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("session A æ‰§è¡Œ "),t("code",[s._v("select ... for update")]),s._v("â€‹ è¯­å¥, ç”±äºŽ id=9 è¿™ä¸€è¡Œå¹¶ä¸å­˜åœ¨, å› æ­¤ä¼š"),t("strong",[s._v("åŠ ä¸Šé—´éš™é” (5,10)")]),s._v(" ;")]),s._v(" "),t("li",[s._v("session B æ‰§è¡Œ "),t("code",[s._v("select ... for update")]),s._v("â€‹ è¯­å¥, åŒæ ·ä¼šåŠ ä¸Šé—´éš™é” (5,10), é—´éš™é”ä¹‹é—´"),t("strong",[s._v("ä¸ä¼šå†²çª")]),s._v(", å› æ­¤è¿™ä¸ªè¯­å¥"),t("strong",[s._v("å¯ä»¥æ‰§è¡ŒæˆåŠŸ")]),s._v(";")]),s._v(" "),t("li",[s._v("session B è¯•å›¾æ’å…¥ä¸€è¡Œ (9,9,9), "),t("strong",[s._v("è¢« session A çš„é—´éš™é”æŒ¡ä½")]),s._v("äº†, åªå¥½è¿›å…¥ç­‰å¾…;")]),s._v(" "),t("li",[s._v("session A è¯•å›¾æ’å…¥ä¸€è¡Œ (9,9,9), "),t("strong",[s._v("è¢« session B çš„é—´éš™é”æŒ¡ä½")]),s._v("äº†.")])]),s._v(" "),t("p",[s._v("è‡³æ­¤, ä¸¤ä¸ª session è¿›å…¥äº’ç›¸ç­‰å¾…çŠ¶æ€, å½¢æˆæ­»é”. å½“ç„¶ InnoDB çš„æ­»é”æ£€æµ‹é©¬ä¸Šå°±å‘çŽ°äº†è¿™å¯¹æ­»é”å…³ç³», è®© session A çš„ insert è¯­å¥æŠ¥é”™è¿”å›žäº†.")]),s._v(" "),t("p",[s._v("ä½ çŽ°åœ¨çŸ¥é“äº†, "),t("mark",[t("strong",[s._v("é—´éš™é”çš„å¼•å…¥, å¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´, è¿™å…¶å®žæ˜¯å½±å“äº†å¹¶å‘åº¦çš„")])]),s._v(". å…¶å®žè¿™è¿˜åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­, åœ¨ä¸‹ä¸€èŠ‚ä¸­è¿˜ä¼šç¢°åˆ°æ›´å¤š, æ›´å¤æ‚çš„ä¾‹å­.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè¯´, ä¸ºäº†è§£å†³å¹»è¯»çš„é—®é¢˜, å¼•å…¥äº†è¿™ä¹ˆä¸€å¤§ä¸²å†…å®¹, æœ‰æ²¡æœ‰æ›´ç®€å•ä¸€ç‚¹çš„å¤„ç†æ–¹æ³•å‘¢.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä¸€å¼€å§‹å°±è¯´è¿‡, å¦‚æžœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜Ž, æœ¬èŠ‚åˆ†æžçš„é—®é¢˜éƒ½æ˜¯åœ¨"),t("strong",[s._v("å¯é‡å¤è¯»éš”ç¦»çº§åˆ«")]),s._v("ä¸‹çš„, "),t("strong",[s._v("é—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„")]),s._v(". æ‰€ä»¥"),t("strong",[s._v("å¦‚æžœæŠŠéš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»æäº¤çš„è¯, å°±æ²¡æœ‰é—´éš™é”")]),s._v("äº†. ä½†åŒæ—¶è¦è§£å†³å¯èƒ½å‡ºçŽ°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜, éœ€è¦æŠŠ binlog æ ¼å¼è®¾ç½®ä¸º row. è¿™ä¹Ÿæ˜¯çŽ°åœ¨ä¸å°‘å…¬å¸ä½¿ç”¨çš„é…ç½®ç»„åˆ.")]),s._v(" "),t("p",[s._v("å‰é¢æ–‡ç« çš„è¯„è®ºåŒºæœ‰åŒå­¦ç•™è¨€è¯´, ä»–ä»¬å…¬å¸å°±ä½¿ç”¨çš„æ˜¯è¯»æäº¤éš”ç¦»çº§åˆ«åŠ  binlog_format=row çš„ç»„åˆ. ä»–æ›¾é—®ä»–ä»¬å…¬å¸çš„ DBA è¯´, ä½ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆé…ç½®. DBA ç›´æŽ¥ç­”å¤è¯´, å› ä¸ºå¤§å®¶éƒ½è¿™ä¹ˆç”¨å‘€. æ‰€ä»¥è¿™ä¸ªåŒå­¦å°±é—®è¿™ä¸ªé…ç½®åˆ°åº•åˆä¸åˆç†.")]),s._v(" "),t("p",[s._v("å…³äºŽè¿™ä¸ªé—®é¢˜æœ¬èº«çš„ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("å¦‚æžœè¯»æäº¤éš”ç¦»çº§åˆ«å¤Ÿç”¨, ä¹Ÿå°±æ˜¯è¯´, ä¸šåŠ¡ä¸éœ€è¦å¯é‡å¤è¯»çš„ä¿è¯, è¿™æ ·è€ƒè™‘åˆ°è¯»æäº¤ä¸‹æ“ä½œæ•°æ®çš„é”èŒƒå›´æ›´å°(æ²¡æœ‰é—´éš™é”), è¿™ä¸ªé€‰æ‹©æ˜¯åˆç†çš„")]),s._v('. ä½†å…¶å®žæˆ‘æƒ³è¯´çš„æ˜¯, é…ç½®æ˜¯å¦åˆç†, è·Ÿä¸šåŠ¡åœºæ™¯æœ‰å…³, éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æž. å¦‚æžœ DBA è®¤ä¸ºä¹‹æ‰€ä»¥è¿™ä¹ˆç”¨çš„åŽŸå› æ˜¯"å¤§å®¶éƒ½è¿™ä¹ˆç”¨", é‚£å°±æœ‰é—®é¢˜äº†, æˆ–è€…è¿Ÿæ—©ä¼šå‡ºé—®é¢˜.')]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-19"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-19"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æåˆ°äº†å…¨è¡¨æ‰«æçš„åŠ é”æ–¹å¼. æˆ‘ä»¬å‘çŽ°"),t("strong",[s._v("å³ä½¿ç»™æ‰€æœ‰çš„è¡Œéƒ½åŠ ä¸Šè¡Œé”, ä»ç„¶æ— æ³•è§£å†³å¹»è¯»é—®é¢˜, å› æ­¤å¼•å…¥äº†é—´éš™é”çš„æ¦‚å¿µ")]),s._v(".")]),s._v(" "),t("p",[s._v("æˆ‘ç¢°åˆ°è¿‡å¾ˆå¤šå¯¹æ•°æ®åº“æœ‰ä¸€å®šäº†è§£çš„ä¸šåŠ¡å¼€å‘äººå‘˜, ä»–ä»¬åœ¨è®¾è®¡æ•°æ®è¡¨ç»“æž„å’Œä¸šåŠ¡ SQL è¯­å¥çš„æ—¶å€™, å¯¹è¡Œé”æœ‰å¾ˆå‡†ç¡®çš„è®¤è¯†, ä½†å´å¾ˆå°‘è€ƒè™‘åˆ°é—´éš™é”. æœ€åŽçš„ç»“æžœ, å°±æ˜¯ç”Ÿäº§åº“ä¸Šä¼šç»å¸¸å‡ºçŽ°"),t("strong",[s._v("ç”±äºŽé—´éš™é”å¯¼è‡´çš„æ­»é”çŽ°è±¡")]),s._v(".")]),s._v(" "),t("p",[s._v("è¡Œé”ç¡®å®žæ¯”è¾ƒç›´è§‚, åˆ¤æ–­è§„åˆ™ä¹Ÿç›¸å¯¹ç®€å•, é—´éš™é”çš„å¼•å…¥ä¼šå½±å“ç³»ç»Ÿçš„å¹¶å‘åº¦, ä¹Ÿå¢žåŠ äº†é”åˆ†æžçš„å¤æ‚åº¦, ä½†ä¹Ÿæœ‰ç« å¯å¾ª. ä¸‹ä¸€èŠ‚å°±ä¼šä¸ºä½ "),t("strong",[s._v("è®²è§£ InnoDB çš„åŠ é”è§„åˆ™")]),s._v(', å¸®ä½ ç†é¡ºè¿™å…¶ä¸­çš„"ç« æ³•".')]),s._v(" "),t("h4",{attrs:{id:"_21-ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥-é”è¿™ä¹ˆå¤š"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_21-ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥-é”è¿™ä¹ˆå¤š"}},[s._v("#")]),s._v(" 21-ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥,é”è¿™ä¹ˆå¤š?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚ä»‹ç»äº†é—´éš™é”å’Œ next-key lock çš„æ¦‚å¿µ, ä½†æ˜¯"),t("strong",[s._v("å¹¶æ²¡æœ‰è¯´æ˜ŽåŠ é”è§„åˆ™")]),s._v(". é—´éš™é”çš„æ¦‚å¿µç†è§£èµ·æ¥ç¡®å®žæœ‰ç‚¹å„¿éš¾, å°¤å…¶åœ¨é…åˆä¸Šè¡Œé”ä»¥åŽ, å¾ˆå®¹æ˜“åœ¨åˆ¤æ–­æ˜¯å¦ä¼šå‡ºçŽ°é”ç­‰å¾…çš„é—®é¢˜ä¸ŠçŠ¯é”™. æ‰€ä»¥æœ¬èŠ‚å°±å…ˆä»Žè¿™ä¸ª"),t("strong",[s._v("åŠ é”è§„åˆ™")]),s._v("å¼€å§‹å§.")]),s._v(" "),t("p",[s._v("é¦–å…ˆè¯´æ˜Žä¸€ä¸‹, è¿™äº›åŠ é”è§„åˆ™æˆ‘æ²¡åœ¨åˆ«çš„åœ°æ–¹çœ‹åˆ°è¿‡æœ‰ç±»ä¼¼çš„æ€»ç»“, ä»¥å‰æˆ‘è‡ªå·±åˆ¤æ–­çš„æ—¶å€™éƒ½æ˜¯æƒ³ç€ä»£ç é‡Œé¢çš„å®žçŽ°æ¥è„‘è¡¥çš„. è¿™æ¬¡ä¸ºäº†æ€»ç»“æˆä¸çœ‹ä»£ç çš„åŒå­¦ä¹Ÿèƒ½ç†è§£çš„è§„åˆ™, æ˜¯æˆ‘åˆé‡æ–°åˆ·äº†ä»£ç ä¸´æ—¶æ€»ç»“å‡ºæ¥çš„. æ‰€ä»¥**è¿™ä¸ªè§„åˆ™æœ‰ä»¥ä¸‹ä¸¤æ¡å‰æè¯´æ˜Ž: **")]),s._v(" "),t("ol",[t("li",[s._v("MySQL åŽé¢çš„ç‰ˆæœ¬å¯èƒ½ä¼šæ”¹å˜åŠ é”ç­–ç•¥, æ‰€ä»¥è¿™ä¸ªè§„åˆ™åªé™äºŽæˆªæ­¢åˆ°çŽ°åœ¨çš„æœ€æ–°ç‰ˆæœ¬, å³ 5.x ç³»åˆ— <=5.7.24, 8.0 ç³»åˆ— <=8.0.13.")]),s._v(" "),t("li",[s._v("æœ‰å¯èƒ½å­˜åœ¨ bad case.")])]),s._v(" "),t("p",[s._v("å› ä¸ºé—´éš™é”åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰æœ‰æ•ˆ, æ‰€ä»¥æœ¬èŠ‚è‹¥æ²¡æœ‰ç‰¹æ®Šè¯´æ˜Ž, é»˜è®¤æ˜¯"),t("strong",[s._v("å¯é‡å¤è¯»éš”ç¦»çº§åˆ«")]),s._v(".")]),s._v(" "),t("p",[s._v('**æˆ‘æ€»ç»“çš„åŠ é”è§„åˆ™é‡Œé¢, åŒ…å«äº†ä¸¤ä¸ª"åŽŸåˆ™", ä¸¤ä¸ª"ä¼˜åŒ–"å’Œä¸€ä¸ª"bug". **')]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v("åŽŸåˆ™ 1: åŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lock. next-key lock æ˜¯å‰å¼€åŽé—­åŒºé—´.")])])]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("åŽŸåˆ™ 2: æŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”.")])])]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("ä¼˜åŒ– 1: ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢, ç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™, next-key lock é€€åŒ–ä¸ºè¡Œé”.")])])]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("ä¼˜åŒ– 2: ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢, å‘å³éåŽ†æ—¶ä¸”æœ€åŽä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™, next-key lock é€€åŒ–ä¸ºé—´éš™é”.")])])]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("ä¸€ä¸ª bug: å”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢.")])])])]),s._v(" "),t("p",[s._v("è¿˜æ˜¯ä»¥ä¸ŠèŠ‚çš„è¡¨ t ä¸ºä¾‹, æ¥è§£é‡Šä¸€ä¸‹è¿™äº›è§„åˆ™. è¡¨ t çš„å»ºè¡¨è¯­å¥å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v('æŽ¥ä¸‹æ¥çš„ä¾‹å­åŸºæœ¬éƒ½æ˜¯é…åˆç€å›¾ç‰‡è¯´æ˜Žçš„, æ‰€ä»¥å»ºè®®å¯ä»¥å¯¹ç…§ç€æ–‡ç¨¿çœ‹, æœ‰äº›ä¾‹å­å¯èƒ½ä¼š"æ¯ä¸‰è§‚", ä¹Ÿå»ºè®®ä½ è¯»å®ŒåŽå®žè·µä¸€ä¸‹.')]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹ä¸€-ç­‰å€¼æŸ¥è¯¢é—´éš™é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹ä¸€-ç­‰å€¼æŸ¥è¯¢é—´éš™é”"}},[s._v("#")]),s._v(" æ¡ˆä¾‹ä¸€:ç­‰å€¼æŸ¥è¯¢é—´éš™é”")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯å…³äºŽ"),t("strong",[s._v("ç­‰å€¼æ¡ä»¶æ“ä½œé—´éš™")]),s._v(":")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f5fe73e462cf97bec71aa31a746cf262-20230731161914-7w7gd74.png",alt:"",title:"ç­‰å€¼æŸ¥è¯¢çš„é—´éš™é”"}})]),s._v(" "),t("p",[s._v("ç”±äºŽè¡¨ t ä¸­æ²¡æœ‰ id=7 çš„è®°å½•, æ‰€ä»¥ç”¨ä¸Šé¢æåˆ°çš„åŠ é”è§„åˆ™åˆ¤æ–­ä¸€ä¸‹çš„è¯:")]),s._v(" "),t("ol",[t("li",[s._v("æ ¹æ®åŽŸåˆ™ 1, åŠ é”å•ä½æ˜¯ next-key lock, "),t("strong",[s._v("session A åŠ é”èŒƒå›´å°±æ˜¯ (5,10]")]),s._v(" ;")]),s._v(" "),t("li",[s._v("åŒæ—¶æ ¹æ®ä¼˜åŒ– 2, è¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ (id=7), è€Œ id=10 ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶, next-key lock é€€åŒ–æˆ"),t("strong",[s._v("é—´éš™é”")]),s._v(", å› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯  "),t("strong",[s._v("(5,10)")]),s._v(" .")])]),s._v(" "),t("p",[t("strong",[s._v("æ‰€ä»¥ session B è¦å¾€è¿™ä¸ªé—´éš™é‡Œé¢æ’å…¥ id=8 çš„è®°å½•ä¼šè¢«é”ä½, ä½†æ˜¯ session C ä¿®æ”¹ id=10 è¿™è¡Œæ˜¯å¯ä»¥çš„")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹äºŒ-éžå”¯ä¸€ç´¢å¼•ç­‰å€¼é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹äºŒ-éžå”¯ä¸€ç´¢å¼•ç­‰å€¼é”"}},[s._v("#")]),s._v(" æ¡ˆä¾‹äºŒ:éžå”¯ä¸€ç´¢å¼•ç­‰å€¼é”")]),s._v(" "),t("p",[s._v("ç¬¬äºŒä¸ªä¾‹å­æ˜¯å…³äºŽ"),t("strong",[s._v("è¦†ç›–ç´¢å¼•ä¸Šçš„é”")]),s._v(":")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/77c2972ec74bf6e6ebd007c1010ac6c9-20230731161914-7j3q8vs.png",alt:"",title:"åªåŠ åœ¨éžå”¯ä¸€ç´¢å¼•ä¸Šçš„é”"}})]),s._v(" "),t("p",[s._v('çœ‹åˆ°è¿™ä¸ªä¾‹å­, ä½ æ˜¯ä¸æ˜¯æœ‰ä¸€ç§ "è¯¥é”çš„ä¸é”, ä¸è¯¥é”çš„ä¹±é”" çš„æ„Ÿè§‰? æ¥åˆ†æžä¸€ä¸‹å§.')]),s._v(" "),t("p",[s._v("è¿™é‡Œ session A è¦ç»™ç´¢å¼• c ä¸Š c=5 çš„è¿™ä¸€è¡ŒåŠ ä¸Šè¯»é”.")]),s._v(" "),t("ol",[t("li",[s._v("æ ¹æ®åŽŸåˆ™ 1, åŠ é”å•ä½æ˜¯ next-key lock, "),t("strong",[s._v("å› æ­¤ä¼šç»™ (0,5] åŠ ä¸Š next-key lock")]),s._v(".")]),s._v(" "),t("li",[s._v("è¦æ³¨æ„ c æ˜¯æ™®é€šç´¢å¼•, å› æ­¤ä»…è®¿é—® c=5 è¿™ä¸€æ¡è®°å½•æ˜¯ä¸èƒ½é©¬ä¸Šåœä¸‹æ¥çš„, "),t("strong",[s._v("éœ€è¦å‘å³éåŽ†, æŸ¥åˆ° c=10 æ‰æ”¾å¼ƒ")]),s._v(". æ ¹æ®åŽŸåˆ™ 2, "),t("strong",[s._v("è®¿é—®åˆ°çš„éƒ½è¦åŠ é”, å› æ­¤è¦ç»™ (5,10] åŠ  next-key lock")]),s._v(".")]),s._v(" "),t("li",[s._v("ä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ– 2: ç­‰å€¼åˆ¤æ–­, å‘å³éåŽ†, æœ€åŽä¸€ä¸ªå€¼ä¸æ»¡è¶³ c=5 è¿™ä¸ªç­‰å€¼æ¡ä»¶, å› æ­¤"),t("strong",[s._v("é€€åŒ–æˆé—´éš™é”")]),s._v(" (5,10).")]),s._v(" "),t("li",[s._v("æ ¹æ®åŽŸåˆ™ 2, "),t("strong",[s._v("åªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”")]),s._v(", è¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨"),t("strong",[s._v("è¦†ç›–ç´¢å¼•")]),s._v(", å¹¶"),t("strong",[s._v("ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•")]),s._v(", æ‰€ä»¥ä¸»é”®ç´¢å¼•ä¸Šæ²¡æœ‰åŠ ä»»ä½•é”, "),t("strong",[s._v("è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ session B çš„ update è¯­å¥å¯ä»¥æ‰§è¡Œå®Œæˆ")]),s._v(".")])]),s._v(" "),t("p",[s._v("ä½† session C è¦æ’å…¥ä¸€ä¸ª (7,7,7) çš„è®°å½•, å°±ä¼šè¢« session A çš„"),t("strong",[s._v("é—´éš™é” (5,10) é”ä½")]),s._v(".")]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„, åœ¨è¿™ä¸ªä¾‹å­ä¸­, "),t("strong",[s._v("lock in share mode åªé”è¦†ç›–ç´¢å¼•")]),s._v(", ä½†æ˜¯å¦‚æžœæ˜¯ for update å°±ä¸ä¸€æ ·äº†. æ‰§è¡Œ for update æ—¶, ç³»ç»Ÿä¼šè®¤ä¸ºä½ æŽ¥ä¸‹æ¥è¦"),t("strong",[s._v("æ›´æ–°æ•°æ®")]),s._v(", å› æ­¤"),t("strong",[s._v("ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªä¾‹å­è¯´æ˜Ž, "),t("mark",[t("strong",[s._v("é”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„")])]),s._v("; åŒæ—¶, å®ƒç»™æˆ‘ä»¬çš„æŒ‡å¯¼æ˜¯, å¦‚æžœè¦ç”¨ lock in share mode æ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯, å°±å¿…é¡»å¾—"),t("strong",[s._v("ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–")]),s._v(", åœ¨æŸ¥è¯¢å­—æ®µä¸­åŠ å…¥ç´¢å¼•ä¸­ä¸å­˜åœ¨çš„å­—æ®µ. æ¯”å¦‚å°† session A çš„æŸ¥è¯¢è¯­å¥æ”¹æˆ "),t("code",[s._v("select d from t where c=5 lock in share mode")]),s._v("â€‹. ä½ å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹æ•ˆæžœ.")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹ä¸‰-ä¸»é”®ç´¢å¼•èŒƒå›´é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹ä¸‰-ä¸»é”®ç´¢å¼•èŒƒå›´é”"}},[s._v("#")]),s._v(" æ¡ˆä¾‹ä¸‰:ä¸»é”®ç´¢å¼•èŒƒå›´é”")]),s._v(" "),t("p",[s._v("ç¬¬ä¸‰ä¸ªä¾‹å­æ˜¯å…³äºŽ"),t("strong",[s._v("èŒƒå›´æŸ¥è¯¢")]),s._v("çš„. ä¸¾ä¾‹ä¹‹å‰, å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹è¿™ä¸ªé—®é¢˜: å¯¹äºŽè¿™ä¸ªè¡¨ t, ä¸‹é¢è¿™ä¸¤æ¡æŸ¥è¯¢è¯­å¥, åŠ é”èŒƒå›´ç›¸åŒå—?")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("ä½ å¯èƒ½ä¼šæƒ³, id å®šä¹‰ä¸º int ç±»åž‹, è¿™ä¸¤ä¸ªè¯­å¥å°±æ˜¯ç­‰ä»·çš„å§? å…¶å®žå®ƒä»¬å¹¶ä¸å®Œå…¨ç­‰ä»·.")]),s._v(" "),t("p",[s._v("åœ¨é€»è¾‘ä¸Š, è¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„, ä½†æ˜¯å®ƒä»¬çš„"),t("strong",[s._v("åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·")]),s._v(". çŽ°åœ¨å°±è®© session A æ‰§è¡Œç¬¬äºŒä¸ªæŸ¥è¯¢è¯­å¥, æ¥çœ‹çœ‹åŠ é”æ•ˆæžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/48e433565753685e890dcdb745f7658f-20230731161914-tsb2i62.png",alt:"",title:"ä¸»é”®ç´¢å¼•ä¸ŠèŒƒå›´æŸ¥è¯¢çš„é”"}})]),s._v(" "),t("p",[s._v("çŽ°åœ¨å°±ç”¨å‰é¢æåˆ°çš„åŠ é”è§„åˆ™, æ¥åˆ†æžä¸€ä¸‹ session A ä¼šåŠ ä»€ä¹ˆé”?")]),s._v(" "),t("ol",[t("li",[s._v("å¼€å§‹æ‰§è¡Œçš„æ—¶å€™, è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª id=10 çš„è¡Œ, å› æ­¤æœ¬è¯¥æ˜¯ "),t("strong",[s._v("next-key lock(5,10]")]),s._v(" . æ ¹æ®ä¼˜åŒ– 1, ä¸»é”® id ä¸Šçš„ç­‰å€¼æ¡ä»¶, é€€åŒ–æˆè¡Œé”, "),t("strong",[s._v("åªåŠ äº† id=10 è¿™ä¸€è¡Œçš„è¡Œé”")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("èŒƒå›´æŸ¥æ‰¾å°±å¾€åŽç»§ç»­æ‰¾")]),s._v(", æ‰¾åˆ° id=15 è¿™ä¸€è¡Œåœä¸‹æ¥, å› æ­¤éœ€è¦åŠ  "),t("strong",[s._v("next-key lock(10,15]")]),s._v(" .")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥ session A è¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯"),t("strong",[s._v("ä¸»é”®ç´¢å¼•ä¸Š, è¡Œé” id=10 å’Œ next-key lock(10,15]")]),s._v(" . è¿™æ · session B å’Œ session C çš„ç»“æžœå°±éƒ½è¢«é˜»å¡žäº†.")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹, é¦–æ¬¡ session A å®šä½æŸ¥æ‰¾ id=10 çš„è¡Œçš„æ—¶å€™, æ˜¯å½“åš"),t("strong",[s._v("ç­‰å€¼æŸ¥è¯¢")]),s._v("æ¥åˆ¤æ–­çš„, è€Œå‘å³æ‰«æåˆ° id=15 çš„æ—¶å€™, ç”¨çš„æ˜¯"),t("strong",[s._v("èŒƒå›´æŸ¥è¯¢")]),s._v("åˆ¤æ–­.")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹å››-éžå”¯ä¸€ç´¢å¼•èŒƒå›´é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å››-éžå”¯ä¸€ç´¢å¼•èŒƒå›´é”"}},[s._v("#")]),s._v(" æ¡ˆä¾‹å››:éžå”¯ä¸€ç´¢å¼•èŒƒå›´é”")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹ä¸¤ä¸ª"),t("strong",[s._v("èŒƒå›´æŸ¥è¯¢")]),s._v("åŠ é”çš„ä¾‹å­, å¯ä»¥å¯¹ç…§ç€æ¡ˆä¾‹ä¸‰æ¥çœ‹. éœ€è¦æ³¨æ„çš„æ˜¯, ä¸Žæ¡ˆä¾‹ä¸‰ä¸åŒçš„æ˜¯, æ¡ˆä¾‹å››ä¸­æŸ¥è¯¢è¯­å¥çš„ where éƒ¨åˆ†ç”¨çš„æ˜¯"),t("strong",[s._v("å­—æ®µ c")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/10ea465e81d9f756f92f788920123a64-20230731161914-6s6aczb.png",alt:"",title:"éžå”¯ä¸€ç´¢å¼•èŒƒå›´é”"}})]),s._v(" "),t("p",[s._v("è¿™æ¬¡ session A ç”¨å­—æ®µ c æ¥åˆ¤æ–­, åŠ é”è§„åˆ™è·Ÿæ¡ˆä¾‹ä¸‰å”¯ä¸€çš„ä¸åŒæ˜¯: åœ¨ç¬¬ä¸€æ¬¡ç”¨ c=10 å®šä½è®°å½•çš„æ—¶å€™, ç´¢å¼• c ä¸ŠåŠ äº† (5,10] è¿™ä¸ª next-key lock åŽ, "),t("strong",[s._v("ç”±äºŽç´¢å¼• c æ˜¯éžå”¯ä¸€ç´¢å¼•, æ²¡æœ‰ä¼˜åŒ–è§„åˆ™, ä¹Ÿå°±æ˜¯è¯´ä¸ä¼šèœ•å˜ä¸ºè¡Œé”, å› æ­¤æœ€ç»ˆ sesion A åŠ çš„é”æ˜¯, ç´¢å¼• c ä¸Šçš„ (5,10] å’Œ (10,15] è¿™ä¸¤ä¸ª next-key lock")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ä»Žç»“æžœä¸Šæ¥çœ‹, sesson B è¦æ’å…¥(8,8,8) çš„è¿™ä¸ª insert è¯­å¥æ—¶å°±è¢«å µä½äº†.")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦æ‰«æåˆ° c=15 æ‰åœæ­¢æ‰«æ, æ˜¯åˆç†çš„, å› ä¸º InnoDB è¦æ‰«åˆ° c=15, æ‰çŸ¥é“ä¸éœ€è¦ç»§ç»­å¾€åŽæ‰¾äº†.")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹äº”-å”¯ä¸€ç´¢å¼•èŒƒå›´é”bug"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹äº”-å”¯ä¸€ç´¢å¼•èŒƒå›´é”bug"}},[s._v("#")]),s._v(" æ¡ˆä¾‹äº”:å”¯ä¸€ç´¢å¼•èŒƒå›´é”bug")]),s._v(" "),t("p",[s._v("å‰é¢çš„å››ä¸ªæ¡ˆä¾‹, å·²ç»ç”¨åˆ°äº†åŠ é”è§„åˆ™ä¸­çš„ä¸¤ä¸ªåŽŸåˆ™å’Œä¸¤ä¸ªä¼˜åŒ–, æŽ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªå…³äºŽåŠ é”è§„åˆ™ä¸­ bug çš„æ¡ˆä¾‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cde5851a9de87dc6b919f8e4c61bd256-20230731161914-e40ysjg.png",alt:"",title:"å”¯ä¸€ç´¢å¼•èŒƒå›´é”çš„ bug"}})]),s._v(" "),t("p",[s._v("session A æ˜¯ä¸€ä¸ª"),t("strong",[s._v("èŒƒå›´æŸ¥è¯¢")]),s._v(", æŒ‰ç…§åŽŸåˆ™ 1 çš„è¯, åº”è¯¥æ˜¯ç´¢å¼• id ä¸Š"),t("strong",[s._v("åªåŠ  (10,15] è¿™ä¸ª next-key lock")]),s._v(", å¹¶ä¸”å› ä¸º id æ˜¯å”¯ä¸€é”®, æ‰€ä»¥å¾ªçŽ¯åˆ¤æ–­åˆ° id=15 è¿™ä¸€è¡Œå°±åº”è¯¥åœæ­¢äº†.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯å®žçŽ°ä¸Š, "),t("strong",[s._v("InnoDB ä¼šå¾€å‰æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸ºæ­¢, ä¹Ÿå°±æ˜¯ id=20")]),s._v(". è€Œä¸”ç”±äºŽè¿™æ˜¯ä¸ªèŒƒå›´æ‰«æ, å› æ­¤ç´¢å¼• id ä¸Šçš„ (15,20] è¿™ä¸ª next-key lock ä¹Ÿä¼šè¢«é”ä¸Š.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ session B è¦æ›´æ–° id=20 è¿™ä¸€è¡Œ, æ˜¯ä¼šè¢«é”ä½çš„. åŒæ ·åœ°, session C è¦æ’å…¥ id=16 çš„ä¸€è¡Œ, ä¹Ÿä¼šè¢«é”ä½.")]),s._v(" "),t("p",[s._v("ç…§ç†è¯´, è¿™é‡Œé”ä½ id=20 è¿™ä¸€è¡Œçš„è¡Œä¸º, å…¶å®žæ˜¯æ²¡æœ‰å¿…è¦çš„. å› ä¸ºæ‰«æåˆ° id=15, å°±å¯ä»¥ç¡®å®šä¸ç”¨å¾€åŽå†æ‰¾äº†. ä½†å®žçŽ°ä¸Šè¿˜æ˜¯è¿™ä¹ˆåšäº†, å› æ­¤æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ª bug.")]),s._v(" "),t("p",[s._v("æˆ‘ä¹Ÿæ›¾æ‰¾ç¤¾åŒºçš„ä¸“å®¶è®¨è®ºè¿‡, å®˜æ–¹ bug ç³»ç»Ÿä¸Šä¹Ÿæœ‰æåˆ°, ä½†æ˜¯å¹¶æœªè¢« verified. æ‰€ä»¥è®¤ä¸ºè¿™æ˜¯ bug è¿™ä¸ªäº‹å„¿, ä¹Ÿåªèƒ½ç®—æˆ‘çš„ä¸€å®¶ä¹‹è¨€, å¦‚æžœä½ æœ‰å…¶ä»–è§è§£çš„è¯, ä¹Ÿæ¬¢è¿Žä½ æå‡ºæ¥.")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹å…­-éžå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨-ç­‰å€¼-çš„ä¾‹å­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å…­-éžå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨-ç­‰å€¼-çš„ä¾‹å­"}},[s._v("#")]),s._v(' æ¡ˆä¾‹å…­:éžå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨"ç­‰å€¼"çš„ä¾‹å­')]),s._v(" "),t("p",[s._v('æŽ¥ä¸‹æ¥çš„ä¾‹å­, æ˜¯ä¸ºäº†æ›´å¥½åœ°è¯´æ˜Ž "é—´éš™" è¿™ä¸ªæ¦‚å¿µ. è¿™é‡Œç»™è¡¨ t æ’å…¥ä¸€æ¡æ–°è®°å½•.')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ–°æ’å…¥çš„è¿™ä¸€è¡Œ c=10, ä¹Ÿå°±æ˜¯è¯´çŽ°åœ¨è¡¨é‡Œ"),t("strong",[s._v("æœ‰ä¸¤ä¸ª c=10 çš„è¡Œ")]),s._v(". é‚£ä¹ˆè¿™æ—¶å€™"),t("strong",[s._v("ç´¢å¼• c ä¸Šçš„é—´éš™")]),s._v('æ˜¯ä»€ä¹ˆçŠ¶æ€äº†å‘¢? ä½ è¦çŸ¥é“, ç”±äºŽéžå”¯ä¸€ç´¢å¼•ä¸ŠåŒ…å«ä¸»é”®çš„å€¼, æ‰€ä»¥æ˜¯ä¸å¯èƒ½å­˜åœ¨ "ç›¸åŒ" çš„ä¸¤è¡Œçš„.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d1818cbc67cf566f446ab856c66601ed-20230731161914-7uhklzq.png",alt:"",title:"éžå”¯ä¸€ç´¢å¼•ç­‰å€¼çš„ä¾‹å­"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è™½ç„¶æœ‰ä¸¤ä¸ª c=10, ä½†æ˜¯å®ƒä»¬çš„"),t("strong",[s._v("ä¸»é”®å€¼ id æ˜¯ä¸åŒçš„")]),s._v("(åˆ†åˆ«æ˜¯ 10 å’Œ 30), "),t("strong",[s._v("å› æ­¤è¿™ä¸¤ä¸ª c=10 çš„è®°å½•ä¹‹é—´, ä¹Ÿæ˜¯æœ‰é—´éš™çš„")]),s._v(". å›¾ä¸­ç”»å‡ºäº†ç´¢å¼• c ä¸Šçš„ä¸»é”® id. ä¸ºäº†è·Ÿé—´éš™é”çš„å¼€åŒºé—´å½¢å¼è¿›è¡ŒåŒºåˆ«, æˆ‘ç”¨ (c=10,id=30) è¿™æ ·çš„å½¢å¼, æ¥è¡¨ç¤ºç´¢å¼•ä¸Šçš„ä¸€è¡Œ.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨æ¥çœ‹ä¸€ä¸‹æ¡ˆä¾‹å…­.")]),s._v(" "),t("p",[s._v("è¿™æ¬¡ç”¨ delete è¯­å¥æ¥éªŒè¯. æ³¨æ„ delete è¯­å¥åŠ é”çš„é€»è¾‘, å…¶å®žè·Ÿ "),t("code",[s._v("select ... for update")]),s._v('â€‹ æ˜¯ç±»ä¼¼çš„, ä¹Ÿå°±æ˜¯å¼€å§‹æ€»ç»“çš„ä¸¤ä¸ª"åŽŸåˆ™", ä¸¤ä¸ª"ä¼˜åŒ–"å’Œä¸€ä¸ª"bug".')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6f15bae13ff3f9c972e36320434c2a0f-20230731161914-2holmat.png",alt:"",title:"delete ç¤ºä¾‹"}})]),s._v(" "),t("p",[s._v("è¿™æ—¶, session A åœ¨éåŽ†çš„æ—¶å€™, å…ˆè®¿é—®ç¬¬ä¸€ä¸ª c=10 çš„è®°å½•. åŒæ ·åœ°æ ¹æ®åŽŸåˆ™ 1, è¿™é‡ŒåŠ çš„æ˜¯ (c=5,id=5) åˆ° (c=10,id=10) è¿™ä¸ª next-key lock.")]),s._v(" "),t("p",[s._v("ç„¶åŽ, session A "),t("strong",[s._v("å‘å³æŸ¥æ‰¾")]),s._v(", ç›´åˆ°ç¢°åˆ° (c=15,id=15) è¿™ä¸€è¡Œ, å¾ªçŽ¯æ‰ç»“æŸ. æ ¹æ®ä¼˜åŒ– 2, è¿™æ˜¯ä¸€ä¸ª"),t("strong",[s._v("ç­‰å€¼æŸ¥è¯¢")]),s._v(", å‘å³æŸ¥æ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œ, æ‰€ä»¥ä¼šé€€åŒ–æˆ  "),t("strong",[s._v("(c=10,id=10) åˆ° (c=15,id=15)")]),s._v("  çš„é—´éš™é”.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ª delete è¯­å¥åœ¨ç´¢å¼• c ä¸Šçš„"),t("strong",[s._v("åŠ é”èŒƒå›´")]),s._v(", å°±æ˜¯ä¸‹å›¾ä¸­è“è‰²åŒºåŸŸè¦†ç›–çš„éƒ¨åˆ†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/da1631187177007caa3c761d04cf672c-20230731161914-a8x6x0j.png",alt:"",title:"delete åŠ é”æ•ˆæžœç¤ºä¾‹"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½æ˜¯è™šçº¿, è¡¨ç¤ºå¼€åŒºé—´, å³ (c=5,id=5) å’Œ (c=15,id=15) è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”.")]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹ä¸ƒ-limitè¯­å¥åŠ é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹ä¸ƒ-limitè¯­å¥åŠ é”"}},[s._v("#")]),s._v(" æ¡ˆä¾‹ä¸ƒ:limitè¯­å¥åŠ é”")]),s._v(" "),t("p",[s._v("ä¾‹å­ 6 ä¹Ÿæœ‰ä¸€ä¸ªå¯¹ç…§æ¡ˆä¾‹, åœºæ™¯å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7794a1c4f5fe4bd277243de6a4200f14-20230731161914-cr21ic9.png",alt:"",title:"limit è¯­å¥åŠ é”"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªä¾‹å­é‡Œ, session A çš„ delete è¯­å¥åŠ äº† limit 2. ä½ çŸ¥é“è¡¨ t é‡Œ c=10 çš„è®°å½•å…¶å®žåªæœ‰ä¸¤æ¡, å› æ­¤åŠ ä¸åŠ  limit 2, åˆ é™¤çš„æ•ˆæžœéƒ½æ˜¯ä¸€æ ·çš„, ä½†æ˜¯"),t("strong",[s._v("åŠ é”çš„æ•ˆæžœå´ä¸åŒ")]),s._v(". å¯ä»¥çœ‹åˆ°, session B çš„ insert è¯­å¥æ‰§è¡Œé€šè¿‡äº†, è·Ÿæ¡ˆä¾‹å…­çš„ç»“æžœä¸åŒ.")]),s._v(" "),t("p",[s._v("è¿™æ˜¯å› ä¸º, æ¡ˆä¾‹ä¸ƒé‡Œçš„ delete è¯­å¥æ˜Žç¡®åŠ äº† limit 2 çš„é™åˆ¶, å› æ­¤åœ¨éåŽ†åˆ° (c=10, id=30) è¿™ä¸€è¡Œä¹‹åŽ, æ»¡è¶³æ¡ä»¶çš„è¯­å¥å·²ç»æœ‰ä¸¤æ¡, "),t("strong",[s._v("å¾ªçŽ¯å°±ç»“æŸäº†")]),s._v(".")]),s._v(" "),t("p",[s._v("å› æ­¤, ç´¢å¼• c ä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»Ž (c=5,id=5) åˆ° (c=10,id=30) è¿™ä¸ªå‰å¼€åŽé—­åŒºé—´, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4a183d8a3b85b31aabfbbfd5481409d9-20230731161914-opb9olu.png",alt:"",title:"å¸¦ limit 2 çš„åŠ é”æ•ˆæžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, (c=10,id=30) ä¹‹åŽçš„è¿™ä¸ªé—´éš™å¹¶æ²¡æœ‰åœ¨åŠ é”èŒƒå›´é‡Œ, å› æ­¤ insert è¯­å¥æ’å…¥ c=12 æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("è¿™ä¸ªä¾‹å­å¯¹å®žè·µçš„æŒ‡å¯¼æ„ä¹‰å°±æ˜¯, åœ¨åˆ é™¤æ•°æ®çš„æ—¶å€™å°½é‡åŠ  limit. è¿™æ ·ä¸ä»…å¯ä»¥æŽ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°, è®©æ“ä½œæ›´å®‰å…¨, è¿˜å¯ä»¥å‡å°åŠ é”çš„èŒƒå›´.")])])]),s._v(" "),t("h5",{attrs:{id:"æ¡ˆä¾‹å…«-ä¸€ä¸ªæ­»é”çš„ä¾‹å­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å…«-ä¸€ä¸ªæ­»é”çš„ä¾‹å­"}},[s._v("#")]),s._v(" æ¡ˆä¾‹å…«:ä¸€ä¸ªæ­»é”çš„ä¾‹å­")]),s._v(" "),t("p",[s._v("å‰é¢çš„ä¾‹å­ä¸­, åœ¨åˆ†æžçš„æ—¶å€™, æ˜¯æŒ‰ç…§ next-key lock çš„é€»è¾‘æ¥åˆ†æžçš„, å› ä¸ºè¿™æ ·åˆ†æžæ¯”è¾ƒæ–¹ä¾¿. æœ€åŽå†çœ‹ä¸€ä¸ªæ¡ˆä¾‹, ç›®çš„æ˜¯è¯´æ˜Ž: "),t("mark",[t("strong",[s._v("next-key lock å®žé™…ä¸Šæ˜¯é—´éš™é”å’Œè¡Œé”åŠ èµ·æ¥çš„ç»“æžœ")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šä¼šç–‘æƒ‘, è¿™ä¸ªæ¦‚å¿µä¸æ˜¯ä¸€å¼€å§‹å°±è¯´äº†å—? ä¸è¦ç€æ€¥, å…ˆæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c848c5496eb0e9a52171d32babae91ae-20230731161914-06r0aip.png",alt:"",title:"æ¡ˆä¾‹å…«çš„æ“ä½œåºåˆ—"}})]),s._v(" "),t("p",[s._v("çŽ°åœ¨æŒ‰æ—¶é—´é¡ºåºæ¥åˆ†æžä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ç»“æžœ.")]),s._v(" "),t("ol",[t("li",[s._v("session A å¯åŠ¨äº‹åŠ¡åŽæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ  "),t("code",[s._v("lock in share mode")]),s._v("â€‹, åœ¨ç´¢å¼• c ä¸ŠåŠ äº† "),t("strong",[s._v("next-key lock(5,10] å’Œé—´éš™é” (10,15)")]),s._v(" ;")]),s._v(" "),t("li",[s._v("session B çš„ update è¯­å¥ä¹Ÿè¦åœ¨ç´¢å¼• c ä¸ŠåŠ  "),t("strong",[s._v("next-key lock(5,10]")]),s._v(" , è¿›å…¥é”ç­‰å¾…;")]),s._v(" "),t("li",[s._v("ç„¶åŽ session A è¦å†æ’å…¥ (8,8,8) è¿™ä¸€è¡Œ, è¢« session B çš„é—´éš™é”é”ä½. ç”±äºŽå‡ºçŽ°äº†æ­»é”, InnoDB è®© session B å›žæ»š.")])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, session B çš„ next-key lock ä¸æ˜¯è¿˜æ²¡ç”³è¯·æˆåŠŸå—?")]),s._v(" "),t("p",[s._v('å…¶å®žæ˜¯è¿™æ ·çš„, session B çš„ "åŠ  next-key lock(5,10]" æ“ä½œ, å®žé™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥, å…ˆæ˜¯åŠ  (5,10) çš„é—´éš™é”, åŠ é”æˆåŠŸ; ç„¶åŽåŠ  c=10 çš„è¡Œé”, è¿™æ—¶å€™æ‰è¢«é”ä½çš„.')]),s._v(" "),t("p",[t("strong",[s._v("ä¹Ÿå°±æ˜¯è¯´, åœ¨åˆ†æžåŠ é”è§„åˆ™çš„æ—¶å€™å¯ä»¥ç”¨ next-key lock æ¥åˆ†æž. ä½†æ˜¯è¦çŸ¥é“, å…·ä½“æ‰§è¡Œçš„æ—¶å€™, æ˜¯è¦åˆ†æˆé—´éš™é”å’Œè¡Œé”ä¸¤æ®µæ¥æ‰§è¡Œçš„")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-20"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-20"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("å†æ¬¡è¯´æ˜Žä¸€ä¸‹, "),t("strong",[s._v("ä¸Šé¢çš„æ‰€æœ‰æ¡ˆä¾‹éƒ½æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«")]),s._v("(repeatable-read) ä¸‹éªŒè¯çš„. åŒæ—¶, "),t("strong",[s._v("å¯é‡å¤è¯»éš”ç¦»çº§åˆ«éµå®ˆä¸¤é˜¶æ®µé”åè®®, æ‰€æœ‰åŠ é”çš„èµ„æº, éƒ½æ˜¯åœ¨äº‹åŠ¡æäº¤æˆ–è€…å›žæ»šçš„æ—¶å€™æ‰é‡Šæ”¾çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨æœ€åŽçš„æ¡ˆä¾‹ä¸­, "),t("strong",[s._v("å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“ next-key lock å®žé™…ä¸Šæ˜¯ç”±é—´éš™é”åŠ è¡Œé”å®žçŽ°çš„. å¦‚æžœåˆ‡æ¢åˆ°è¯»æäº¤éš”ç¦»çº§åˆ« (read-committed) çš„è¯, å°±å¥½ç†è§£äº†, è¿‡ç¨‹ä¸­åŽ»æŽ‰é—´éš™é”çš„éƒ¨åˆ†, ä¹Ÿå°±æ˜¯åªå‰©ä¸‹è¡Œé”çš„éƒ¨åˆ†")]),s._v(".")]),s._v(" "),t("p",[s._v('å…¶å®žè¯»æäº¤éš”ç¦»çº§åˆ«åœ¨å¤–é”®åœºæ™¯ä¸‹è¿˜æ˜¯æœ‰é—´éš™é”, ç›¸å¯¹æ¯”è¾ƒå¤æ‚, è¿™é‡Œå…ˆä¸å±•å¼€. å¦å¤–, åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–, å³: è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ ä¸Šçš„è¡Œé”, åœ¨è¯­å¥æ‰§è¡Œå®ŒæˆåŽ, å°±è¦æŠŠ "ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œ" ä¸Šçš„è¡Œé”ç›´æŽ¥é‡Šæ”¾äº†, ä¸éœ€è¦ç­‰åˆ°äº‹åŠ¡æäº¤. ä¹Ÿå°±æ˜¯è¯´, '),t("strong",[s._v("è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹, é”çš„èŒƒå›´æ›´å°, é”çš„æ—¶é—´æ›´çŸ­")]),s._v(", è¿™ä¹Ÿæ˜¯ä¸å°‘ä¸šåŠ¡éƒ½é»˜è®¤ä½¿ç”¨è¯»æäº¤éš”ç¦»çº§åˆ«çš„åŽŸå› .")]),s._v(" "),t("p",[s._v("åœ¨ä¸šåŠ¡éœ€è¦ä½¿ç”¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„æ—¶å€™, èƒ½å¤Ÿæ›´ç»†è‡´åœ°è®¾è®¡æ“ä½œæ•°æ®åº“çš„è¯­å¥, è§£å†³å¹»è¯»é—®é¢˜çš„åŒæ—¶, æœ€å¤§é™åº¦åœ°æå‡ç³»ç»Ÿå¹¶è¡Œå¤„ç†äº‹åŠ¡çš„èƒ½åŠ›.")]),s._v(" "),t("h4",{attrs:{id:"_22-mysqlæœ‰å“ªäº›-é¥®é¸©æ­¢æ¸´-æé«˜æ€§èƒ½çš„æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_22-mysqlæœ‰å“ªäº›-é¥®é¸©æ­¢æ¸´-æé«˜æ€§èƒ½çš„æ–¹æ³•"}},[s._v("#")]),s._v(' 22-MySQLæœ‰å“ªäº›"é¥®é¸©æ­¢æ¸´"æé«˜æ€§èƒ½çš„æ–¹æ³•?')]),s._v(" "),t("p",[s._v("ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ç¢°åˆ°è¿™æ ·çš„æƒ…æ™¯: "),t("strong",[s._v("ä¸šåŠ¡é«˜å³°æœŸ, ç”Ÿäº§çŽ¯å¢ƒçš„ MySQL åŽ‹åŠ›å¤ªå¤§, æ²¡æ³•æ­£å¸¸å“åº”, éœ€è¦çŸ­æœŸå†…, ä¸´æ—¶æ€§åœ°æå‡ä¸€äº›æ€§èƒ½")]),s._v(".")]),s._v(" "),t("p",[s._v("æˆ‘ä»¥å‰åšä¸šåŠ¡æŠ¤èˆªçš„æ—¶å€™, å°±å¶å°”ä¼šç¢°ä¸Šè¿™ç§åœºæ™¯. ç”¨æˆ·çš„å¼€å‘è´Ÿè´£äººè¯´, ä¸ç®¡ä½ ç”¨ä»€ä¹ˆæ–¹æ¡ˆ, è®©ä¸šåŠ¡å…ˆè·‘èµ·æ¥å†è¯´.   ä½†å¦‚æžœæ˜¯æ— æŸæ–¹æ¡ˆçš„è¯, è‚¯å®šä¸éœ€è¦ç­‰åˆ°è¿™ä¸ªæ—¶å€™æ‰ä¸Šåœº. æœ¬èŠ‚å°±æ¥èŠèŠè¿™äº›ä¸´æ—¶æ–¹æ¡ˆ, å¹¶ç€é‡è¯´ä¸€è¯´å®ƒä»¬å¯èƒ½å­˜åœ¨çš„é£Žé™©.")]),s._v(" "),t("h5",{attrs:{id:"çŸ­è¿žæŽ¥é£Žæš´"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#çŸ­è¿žæŽ¥é£Žæš´"}},[s._v("#")]),s._v(" çŸ­è¿žæŽ¥é£Žæš´")]),s._v(" "),t("p",[s._v("æ­£å¸¸çš„çŸ­è¿žæŽ¥æ¨¡å¼å°±æ˜¯è¿žæŽ¥åˆ°æ•°æ®åº“åŽ, æ‰§è¡Œå¾ˆå°‘çš„ SQL è¯­å¥å°±æ–­å¼€, ä¸‹æ¬¡éœ€è¦çš„æ—¶å€™å†é‡è¿ž. å¦‚æžœä½¿ç”¨çš„æ˜¯çŸ­è¿žæŽ¥, åœ¨ä¸šåŠ¡é«˜å³°æœŸçš„æ—¶å€™, å°±å¯èƒ½å‡ºçŽ°"),t("strong",[s._v("è¿žæŽ¥æ•°çªç„¶æš´æ¶¨")]),s._v("çš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("å‰é¢è¯´è¿‡, MySQL "),t("strong",[s._v("å»ºç«‹è¿žæŽ¥çš„è¿‡ç¨‹, æˆæœ¬æ˜¯å¾ˆé«˜çš„")]),s._v(". é™¤äº†æ­£å¸¸çš„ç½‘ç»œè¿žæŽ¥ä¸‰æ¬¡æ¡æ‰‹å¤–, è¿˜éœ€è¦åšç™»å½•æƒé™åˆ¤æ–­å’ŒèŽ·å¾—è¿™ä¸ªè¿žæŽ¥çš„æ•°æ®è¯»å†™æƒé™. åœ¨æ•°æ®åº“åŽ‹åŠ›æ¯”è¾ƒå°çš„æ—¶å€™, è¿™äº›é¢å¤–çš„æˆæœ¬å¹¶ä¸æ˜Žæ˜¾.")]),s._v(" "),t("p",[t("strong",[s._v('ä½†æ˜¯, çŸ­è¿žæŽ¥æ¨¡åž‹å­˜åœ¨ä¸€ä¸ªé£Žé™©, å°±æ˜¯ä¸€æ—¦æ•°æ®åº“å¤„ç†å¾—æ…¢ä¸€äº›, è¿žæŽ¥æ•°å°±ä¼šæš´æ¶¨. max_connections å‚æ•°, ç”¨æ¥æŽ§åˆ¶ä¸€ä¸ª MySQL å®žä¾‹åŒæ—¶å­˜åœ¨çš„è¿žæŽ¥æ•°çš„ä¸Šé™, è¶…è¿‡è¿™ä¸ªå€¼, ç³»ç»Ÿå°±ä¼šæ‹’ç»æŽ¥ä¸‹æ¥çš„è¿žæŽ¥è¯·æ±‚, å¹¶æŠ¥é”™æç¤º "Too many connections". å¯¹äºŽè¢«æ‹’ç»è¿žæŽ¥çš„è¯·æ±‚æ¥è¯´, ä»Žä¸šåŠ¡è§’åº¦çœ‹å°±æ˜¯æ•°æ®åº“ä¸å¯ç”¨.')])]),s._v(" "),t("p",[s._v("åœ¨æœºå™¨è´Ÿè½½æ¯”è¾ƒé«˜çš„æ—¶å€™, å¤„ç†çŽ°æœ‰è¯·æ±‚çš„æ—¶é—´å˜é•¿, æ¯ä¸ªè¿žæŽ¥ä¿æŒçš„æ—¶é—´ä¹Ÿæ›´é•¿. è¿™æ—¶å†æœ‰æ–°å»ºè¿žæŽ¥çš„è¯, å°±å¯èƒ½ä¼šè¶…è¿‡ max_connections çš„é™åˆ¶.")]),s._v(" "),t("p",[s._v("ç¢°åˆ°è¿™ç§æƒ…å†µæ—¶, ä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„æƒ³æ³•, å°±æ˜¯è°ƒé«˜ max_connections çš„å€¼. ä½†è¿™æ ·åšæ˜¯æœ‰é£Žé™©çš„. å› ä¸ºè®¾è®¡ max_connections è¿™ä¸ªå‚æ•°çš„ç›®çš„æ˜¯æƒ³ä¿æŠ¤ MySQL, å¦‚æžœæŠŠå®ƒæ”¹å¾—å¤ªå¤§, è®©æ›´å¤šçš„è¿žæŽ¥éƒ½å¯ä»¥è¿›æ¥, é‚£ä¹ˆç³»ç»Ÿçš„è´Ÿè½½å¯èƒ½ä¼šè¿›ä¸€æ­¥åŠ å¤§, å¤§é‡çš„èµ„æºè€—è´¹åœ¨æƒé™éªŒè¯ç­‰é€»è¾‘ä¸Š, ç»“æžœå¯èƒ½æ˜¯é€‚å¾—å…¶å, å·²ç»è¿žæŽ¥çš„çº¿ç¨‹æ‹¿ä¸åˆ° CPU èµ„æºåŽ»æ‰§è¡Œä¸šåŠ¡çš„ SQL è¯·æ±‚.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹, è¿˜æœ‰æ²¡æœ‰åˆ«çš„å»ºè®®å‘¢? è¿™é‡Œè¿˜æœ‰ä¸¤ç§æ–¹æ³•, ä½†è¦æ³¨æ„è¿™äº›æ–¹æ³•éƒ½æ˜¯"),t("strong",[s._v("æœ‰æŸ")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("**ç¬¬ä¸€ç§æ–¹æ³•: å…ˆå¤„ç†æŽ‰é‚£äº›å ç€è¿žæŽ¥ä½†æ˜¯ä¸å·¥ä½œçš„çº¿ç¨‹. **")]),s._v(" "),t("p",[s._v("max_connections çš„è®¡ç®—, ä¸æ˜¯çœ‹è°åœ¨ running, æ˜¯åªè¦è¿žç€å°±å ç”¨ä¸€ä¸ªè®¡æ•°ä½ç½®. å¯¹äºŽé‚£äº›"),t("strong",[s._v("ä¸éœ€è¦ä¿æŒçš„è¿žæŽ¥")]),s._v(", å¯ä»¥é€šè¿‡ kill connection ä¸»åŠ¨è¸¢æŽ‰. è¿™ä¸ªè¡Œä¸ºè·Ÿäº‹å…ˆè®¾ç½® wait_timeout çš„æ•ˆæžœæ˜¯ä¸€æ ·çš„. è®¾ç½® wait_timeout å‚æ•°è¡¨ç¤ºçš„æ˜¯, "),t("strong",[s._v("ä¸€ä¸ªçº¿ç¨‹ç©ºé—² wait_timeout è¿™ä¹ˆå¤šç§’ä¹‹åŽ, å°±ä¼šè¢« MySQL ç›´æŽ¥æ–­å¼€è¿žæŽ¥")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æ˜¯éœ€è¦æ³¨æ„, åœ¨ show processlist çš„ç»“æžœé‡Œ, è¸¢æŽ‰æ˜¾ç¤ºä¸º sleep çš„çº¿ç¨‹, å¯èƒ½æ˜¯æœ‰æŸçš„. æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ad42632d77feb65bd760c5ee4503fed1-20230731161914-yc6kuno.png",alt:"",title:"sleep çº¿ç¨‹çš„ä¸¤ç§çŠ¶æ€"}})]),s._v(" "),t("p",[s._v("åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­é‡Œ, å¦‚æžœæ–­å¼€ session A çš„è¿žæŽ¥, å› ä¸ºè¿™æ—¶å€™ session A "),t("strong",[s._v("è¿˜æ²¡æœ‰æäº¤")]),s._v(", æ‰€ä»¥ MySQL åªèƒ½æŒ‰ç…§å›žæ»šäº‹åŠ¡æ¥å¤„ç†; è€Œæ–­å¼€ session B çš„è¿žæŽ¥, å°±æ²¡ä»€ä¹ˆå¤§å½±å“. æ‰€ä»¥å¦‚æžœæŒ‰ç…§ä¼˜å…ˆçº§æ¥è¯´, åº”è¯¥ä¼˜å…ˆæ–­å¼€åƒ session B è¿™æ ·çš„äº‹åŠ¡å¤–ç©ºé—²çš„è¿žæŽ¥.")]),s._v(" "),t("p",[s._v("ä½†æ€Žä¹ˆåˆ¤æ–­å“ªäº›æ˜¯äº‹åŠ¡å¤–ç©ºé—²çš„å‘¢? session C åœ¨ T æ—¶åˆ»ä¹‹åŽçš„ 30 ç§’æ‰§è¡Œ show processlist, çœ‹åˆ°çš„ç»“æžœæ˜¯è¿™æ ·çš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/138b5fd3d305c0e61f3c71ba81fbd174-20230731161914-qa83k6o.png",alt:"",title:"sleep çº¿ç¨‹çš„ä¸¤ç§çŠ¶æ€, show processlist ç»“æžœ"}})]),s._v(" "),t("p",[s._v("å›¾ä¸­ id=4 å’Œ id=5 çš„ä¸¤ä¸ªä¼šè¯éƒ½æ˜¯ Sleep çŠ¶æ€. è€Œè¦çœ‹"),t("strong",[s._v("äº‹åŠ¡å…·ä½“çŠ¶æ€")]),s._v("çš„è¯, å¯ä»¥æŸ¥ information_schema åº“çš„ innodb_trx è¡¨.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a2308a72c0cc6069ae0e5407e9453da7-20230731161914-9rpj2ew.png",alt:"",title:"ä»Ž information_schema.innodb_trx æŸ¥è¯¢äº‹åŠ¡çŠ¶æ€"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªç»“æžœé‡Œ, trx_mysql_thread_id=4, è¡¨ç¤º id=4 çš„çº¿ç¨‹è¿˜å¤„åœ¨äº‹åŠ¡ä¸­.")]),s._v(" "),t("p",[s._v("å› æ­¤å¦‚æžœæ˜¯"),t("strong",[s._v("è¿žæŽ¥æ•°è¿‡å¤š, å¯ä»¥ä¼˜å…ˆæ–­å¼€äº‹åŠ¡å¤–ç©ºé—²å¤ªä¹…çš„è¿žæŽ¥")]),s._v("; å¦‚æžœè¿™æ ·è¿˜ä¸å¤Ÿ, å†è€ƒè™‘æ–­å¼€äº‹åŠ¡å†…ç©ºé—²å¤ªä¹…çš„è¿žæŽ¥.")]),s._v(" "),t("p",[s._v("ä»ŽæœåŠ¡ç«¯æ–­å¼€è¿žæŽ¥ä½¿ç”¨çš„æ˜¯ kill connection + id çš„å‘½ä»¤, ä¸€ä¸ªå®¢æˆ·ç«¯å¤„äºŽ sleep çŠ¶æ€æ—¶, å®ƒçš„è¿žæŽ¥è¢«æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€åŽ, è¿™ä¸ª"),t("strong",[s._v("å®¢æˆ·ç«¯å¹¶ä¸ä¼šé©¬ä¸ŠçŸ¥é“")]),s._v('. ç›´åˆ°å®¢æˆ·ç«¯åœ¨å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™, æ‰ä¼šæ”¶åˆ°è¿™æ ·çš„æŠ¥é”™ "ERROR 2013 (HY000): Lost connection to MySQL server during query". ä»Žæ•°æ®åº“ç«¯ä¸»åŠ¨æ–­å¼€è¿žæŽ¥å¯èƒ½æ˜¯æœ‰æŸçš„, å°¤å…¶æ˜¯æœ‰çš„åº”ç”¨ç«¯æ”¶åˆ°è¿™ä¸ªé”™è¯¯åŽ, ä¸é‡æ–°è¿žæŽ¥, è€Œæ˜¯ç›´æŽ¥ç”¨è¿™ä¸ªå·²ç»ä¸èƒ½ç”¨çš„å¥æŸ„é‡è¯•æŸ¥è¯¢. è¿™ä¼šå¯¼è‡´ä»Žåº”ç”¨ç«¯çœ‹ä¸ŠåŽ», "MySQL ä¸€ç›´æ²¡æ¢å¤".')]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½è§‰å¾—è¿™æ˜¯ä¸€ä¸ªå†·ç¬‘è¯, ä½†å®žé™…ä¸Šæˆ‘ç¢°åˆ°è¿‡ä¸ä¸‹ 10 æ¬¡.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, å¦‚æžœä½ æ˜¯ä¸€ä¸ª DBA, ä¸è¦å‡è®¾æ‰€æœ‰çš„åº”ç”¨ä»£ç éƒ½ä¼šè¢«æ­£ç¡®åœ°å¤„ç†. å³ä½¿åªæ˜¯ä¸€ä¸ªæ–­å¼€è¿žæŽ¥çš„æ“ä½œ, ä¹Ÿè¦ç¡®ä¿é€šçŸ¥åˆ°ä¸šåŠ¡å¼€å‘å›¢é˜Ÿ.")]),s._v(" "),t("p",[s._v("**ç¬¬äºŒç§æ–¹æ³•: å‡å°‘è¿žæŽ¥è¿‡ç¨‹çš„æ¶ˆè€—. **")]),s._v(" "),t("p",[s._v("æœ‰çš„ä¸šåŠ¡ä»£ç ä¼šåœ¨çŸ­æ—¶é—´å†…å…ˆå¤§é‡ç”³è¯·æ•°æ®åº“è¿žæŽ¥åšå¤‡ç”¨, å¦‚æžœçŽ°åœ¨æ•°æ®åº“ç¡®è®¤æ˜¯è¢«è¿žæŽ¥è¡Œä¸ºæ‰“æŒ‚äº†, é‚£ä¹ˆä¸€ç§å¯èƒ½çš„åšæ³•, æ˜¯è®©æ•°æ®åº“è·³è¿‡æƒé™éªŒè¯é˜¶æ®µ.")]),s._v(" "),t("p",[s._v("è·³è¿‡æƒé™éªŒè¯çš„æ–¹æ³•æ˜¯: é‡å¯æ•°æ®åº“, å¹¶ä½¿ç”¨ â€“skip-grant-tables å‚æ•°å¯åŠ¨. è¿™æ ·æ•´ä¸ª MySQL ä¼šè·³è¿‡æ‰€æœ‰çš„æƒé™éªŒè¯é˜¶æ®µ, åŒ…æ‹¬è¿žæŽ¥è¿‡ç¨‹å’Œè¯­å¥æ‰§è¡Œè¿‡ç¨‹åœ¨å†….")]),s._v(" "),t("p",[s._v('ä½†æ˜¯è¿™ç§æ–¹æ³•ç‰¹åˆ«ç¬¦åˆæ ‡é¢˜é‡Œè¯´çš„"é¥®é¸©æ­¢æ¸´", é£Žé™©æžé«˜, æ˜¯ç‰¹åˆ«ä¸å»ºè®®ä½¿ç”¨çš„æ–¹æ¡ˆ. å°¤å…¶ä½ çš„åº“å¤–ç½‘å¯è®¿é—®çš„è¯, å°±æ›´ä¸èƒ½è¿™ä¹ˆåšäº†. åœ¨ MySQL 8.0 ç‰ˆæœ¬é‡Œ, å¦‚æžœå¯ç”¨ â€“skip-grant-tables å‚æ•°, MySQL ä¼šé»˜è®¤æŠŠ --skip-networking å‚æ•°æ‰“å¼€, è¡¨ç¤ºè¿™æ—¶å€™æ•°æ®åº“åªèƒ½è¢«æœ¬åœ°çš„å®¢æˆ·ç«¯è¿žæŽ¥. å¯è§, MySQL å®˜æ–¹å¯¹ skip-grant-tables è¿™ä¸ªå‚æ•°çš„å®‰å…¨é—®é¢˜ä¹Ÿå¾ˆé‡è§†.')]),s._v(" "),t("h5",{attrs:{id:"æ…¢æŸ¥è¯¢æ€§èƒ½é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ…¢æŸ¥è¯¢æ€§èƒ½é—®é¢˜"}},[s._v("#")]),s._v(" æ…¢æŸ¥è¯¢æ€§èƒ½é—®é¢˜")]),s._v(" "),t("p",[s._v("é™¤äº†çŸ­è¿žæŽ¥æ•°æš´å¢žå¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜å¤–, å®žé™…ä¸Š, åœ¨çº¿ä¸Šç¢°åˆ°æ›´å¤šçš„æ˜¯"),t("strong",[s._v("æŸ¥è¯¢æˆ–è€…æ›´æ–°è¯­å¥å¯¼è‡´çš„æ€§èƒ½é—®é¢˜")]),s._v(". å…¶ä¸­, æŸ¥è¯¢é—®é¢˜æ¯”è¾ƒå…¸åž‹çš„æœ‰ä¸¤ç±», ä¸€ç±»æ˜¯ç”±æ–°å‡ºçŽ°çš„æ…¢æŸ¥è¯¢å¯¼è‡´çš„, ä¸€ç±»æ˜¯ç”± QPS(æ¯ç§’æŸ¥è¯¢æ•°)çªå¢žå¯¼è‡´çš„. è€Œå…³äºŽæ›´æ–°è¯­å¥å¯¼è‡´çš„æ€§èƒ½é—®é¢˜, ä¼šåœ¨ä¸‹ä¸€èŠ‚å±•å¼€è¯´æ˜Ž.")]),s._v(" "),t("p",[s._v("åœ¨ MySQL ä¸­, ä¼šå¼•å‘æ€§èƒ½é—®é¢˜çš„æ…¢æŸ¥è¯¢, å¤§ä½“æœ‰ä»¥ä¸‹ä¸‰ç§å¯èƒ½:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ç´¢å¼•æ²¡æœ‰è®¾è®¡å¥½;")])]),s._v(" "),t("li",[t("strong",[s._v("SQL è¯­å¥æ²¡å†™å¥½;")])]),s._v(" "),t("li",[t("strong",[s._v("MySQL é€‰é”™äº†ç´¢å¼•.")])])]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å°±å…·ä½“åˆ†æžä¸€ä¸‹è¿™ä¸‰ç§å¯èƒ½, ä»¥åŠå¯¹åº”çš„è§£å†³æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("**å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬ä¸€ç§å¯èƒ½æ˜¯, ç´¢å¼•æ²¡æœ‰è®¾è®¡å¥½. **")]),s._v(" "),t("p",[s._v("è¿™ç§åœºæ™¯ä¸€èˆ¬å°±æ˜¯é€šè¿‡"),t("strong",[s._v("ç´§æ€¥åˆ›å»ºç´¢å¼•")]),s._v("æ¥è§£å†³. MySQL 5.6 ç‰ˆæœ¬ä»¥åŽ, åˆ›å»ºç´¢å¼•éƒ½æ”¯æŒ Online DDL äº†, å¯¹äºŽé‚£ç§é«˜å³°æœŸæ•°æ®åº“å·²ç»è¢«è¿™ä¸ªè¯­å¥æ‰“æŒ‚äº†çš„æƒ…å†µ, æœ€é«˜æ•ˆçš„åšæ³•å°±æ˜¯"),t("strong",[s._v("ç›´æŽ¥æ‰§è¡Œ alter table è¯­å¥")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”è¾ƒç†æƒ³çš„æ˜¯èƒ½å¤Ÿ"),t("strong",[s._v("åœ¨å¤‡åº“å…ˆæ‰§è¡Œ")]),s._v(". å‡è®¾çŽ°åœ¨çš„æœåŠ¡æ˜¯ä¸€ä¸»ä¸€å¤‡, ä¸»åº“ A, å¤‡åº“ B, è¿™ä¸ªæ–¹æ¡ˆçš„å¤§è‡´æµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œ set sql_log_bin=off, ä¹Ÿå°±æ˜¯ä¸å†™ binlog, ç„¶åŽæ‰§è¡Œ alter table è¯­å¥åŠ ä¸Šç´¢å¼•;")]),s._v(" "),t("li",[s._v("æ‰§è¡Œ"),t("strong",[s._v("ä¸»å¤‡åˆ‡æ¢")]),s._v(";")]),s._v(" "),t("li",[s._v("è¿™æ—¶å€™ä¸»åº“æ˜¯ B, å¤‡åº“æ˜¯ A. åœ¨ A ä¸Šæ‰§è¡Œ set sql_log_bin=off, ç„¶åŽæ‰§è¡Œ alter table è¯­å¥åŠ ä¸Šç´¢å¼•.")])]),s._v(" "),t("p",[s._v('è¿™æ˜¯ä¸€ä¸ª "å¤è€" çš„ DDL æ–¹æ¡ˆ. å¹³æ—¶åœ¨åšå˜æ›´çš„æ—¶å€™, åº”è¯¥è€ƒè™‘ç±»ä¼¼ '),t("strong",[s._v("gh-ost")]),s._v(" è¿™æ ·çš„æ–¹æ¡ˆ, æ›´åŠ ç¨³å¦¥. ä½†æ˜¯åœ¨éœ€è¦ç´§æ€¥å¤„ç†æ—¶, ä¸Šé¢è¿™ä¸ªæ–¹æ¡ˆçš„æ•ˆçŽ‡æ˜¯æœ€é«˜çš„.")]),s._v(" "),t("p",[s._v("**å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬äºŒç§å¯èƒ½æ˜¯, è¯­å¥æ²¡å†™å¥½. **")]),s._v(" "),t("p",[s._v("æ¯”å¦‚å› ä¸ºä¸€äº›åŽŸå› å¯¼è‡´ SQL è¯­å¥æ²¡æœ‰ä½¿ç”¨ä¸Šç´¢å¼•. è¿™æ—¶å¯ä»¥é€šè¿‡æ”¹å†™ SQL è¯­å¥æ¥å¤„ç†. MySQL 5.7 æä¾›äº† "),t("strong",[s._v("query_rewrite")]),s._v(" åŠŸèƒ½, å¯ä»¥æŠŠè¾“å…¥çš„ä¸€ç§è¯­å¥æ”¹å†™æˆå¦å¤–ä¸€ç§æ¨¡å¼.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚, è¯­å¥è¢«é”™è¯¯åœ°å†™æˆäº† "),t("code",[s._v("select * from t where id + 1 = 10000")]),s._v("â€‹, å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼, å¢žåŠ ä¸€ä¸ªè¯­å¥æ”¹å†™è§„åˆ™.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" query_rewrite"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rewrite_rules"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pattern"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" replacement"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pattern_database"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"select * from t where id + 1 = ?"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"select * from t where id = ? - 1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" query_rewrite"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flush_rewrite_rules"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™é‡Œ, call query_rewrite.flush_rewrite_rules() è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹, "),t("strong",[s._v("æ˜¯è®©æ’å…¥çš„æ–°è§„åˆ™ç”Ÿæ•ˆ")]),s._v(', ä¹Ÿå°±æ˜¯è¯´çš„ "æŸ¥è¯¢é‡å†™". å¯ä»¥ç”¨ä¸‹å›¾ä¸­çš„æ–¹æ³•æ¥ç¡®è®¤æ”¹å†™è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4ba7b911301379bb02526dc235857056-20230731161914-kc6pbkd.png",alt:"",title:"æŸ¥è¯¢é‡å†™æ•ˆæžœ"}})]),s._v(" "),t("p",[s._v("**å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬ä¸‰ç§å¯èƒ½, å°±æ˜¯ç¢°ä¸Šäº†å‰é¢æåˆ°çš„ MySQL é€‰é”™äº†ç´¢å¼•. **")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™, åº”æ€¥æ–¹æ¡ˆå°±æ˜¯ç»™è¿™ä¸ªè¯­å¥åŠ ä¸Š "),t("strong",[s._v("force index")]),s._v(". åŒæ ·åœ°, ä½¿ç”¨æŸ¥è¯¢é‡å†™åŠŸèƒ½, ç»™åŽŸæ¥çš„è¯­å¥åŠ ä¸Š force index, ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("ä¸Šé¢è®¨è®ºçš„ç”±æ…¢æŸ¥è¯¢å¯¼è‡´æ€§èƒ½é—®é¢˜çš„ä¸‰ç§å¯èƒ½æƒ…å†µ, å®žé™…ä¸Šå‡ºçŽ°æœ€å¤šçš„æ˜¯å‰ä¸¤ç§, å³: ç´¢å¼•æ²¡è®¾è®¡å¥½å’Œè¯­å¥æ²¡å†™å¥½. è€Œè¿™ä¸¤ç§æƒ…å†µ, æ°æ°æ˜¯å®Œå…¨å¯ä»¥é¿å…çš„. æ¯”å¦‚"),t("strong",[s._v("é€šè¿‡ä¸‹é¢è¿™ä¸ªè¿‡ç¨‹, å°±å¯ä»¥é¢„å…ˆå‘çŽ°é—®é¢˜")]),s._v(".")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä¸Šçº¿å‰, åœ¨æµ‹è¯•çŽ¯å¢ƒ, æŠŠæ…¢æŸ¥è¯¢æ—¥å¿—(slow log)æ‰“å¼€, å¹¶ä¸”æŠŠ long_query_time è®¾ç½®æˆ 0, ç¡®ä¿æ¯ä¸ªè¯­å¥éƒ½ä¼šè¢«è®°å½•å…¥æ…¢æŸ¥è¯¢æ—¥å¿—;")])]),s._v(" "),t("li",[t("strong",[s._v("åœ¨æµ‹è¯•è¡¨é‡Œæ’å…¥æ¨¡æ‹Ÿçº¿ä¸Šçš„æ•°æ®, åšä¸€éå›žå½’æµ‹è¯•;")])]),s._v(" "),t("li",[t("strong",[s._v("è§‚å¯Ÿæ…¢æŸ¥è¯¢æ—¥å¿—é‡Œæ¯ç±»è¯­å¥çš„è¾“å‡º, ç‰¹åˆ«ç•™æ„ Rows_examined å­—æ®µæ˜¯å¦ä¸Žé¢„æœŸä¸€è‡´.")])])]),s._v(" "),t("p",[s._v('ä¸è¦åå•¬è¿™æ®µèŠ±åœ¨ä¸Šçº¿å‰çš„ "é¢å¤–" æ—¶é—´, å› ä¸ºè¿™ä¼šå¸®ä½ çœä¸‹å¾ˆå¤šæ•…éšœå¤ç›˜çš„æ—¶é—´.')]),s._v(" "),t("p",[s._v("å¦‚æžœæ–°å¢žçš„ SQL è¯­å¥ä¸å¤š, æ‰‹åŠ¨è·‘ä¸€ä¸‹å°±å¯ä»¥. è€Œå¦‚æžœæ˜¯æ–°é¡¹ç›®çš„è¯, æˆ–è€…æ˜¯ä¿®æ”¹äº†åŽŸæœ‰é¡¹ç›®çš„è¡¨ç»“æž„è®¾è®¡, å…¨é‡å›žå½’æµ‹è¯•éƒ½æ˜¯å¿…è¦çš„. è¿™æ—¶å€™, ä½ éœ€è¦å·¥å…·å¸®ä½ æ£€æŸ¥æ‰€æœ‰çš„ SQL è¯­å¥çš„è¿”å›žç»“æžœ. æ¯”å¦‚å¯ä»¥ä½¿ç”¨å¼€æºå·¥å…· pt-query-digest("),t("a",{attrs:{href:"https://www.percona.com/doc/percona-toolkit/3.0/pt-query-digest.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.percona.com/doc/percona-toolkit/3.0/pt-query-digest.html"),t("OutboundLink")],1),s._v(").")]),s._v(" "),t("h5",{attrs:{id:"qpsçªå¢žé—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#qpsçªå¢žé—®é¢˜"}},[s._v("#")]),s._v(" QPSçªå¢žé—®é¢˜")]),s._v(" "),t("p",[s._v("æœ‰æ—¶å€™ç”±äºŽä¸šåŠ¡çªç„¶å‡ºçŽ°é«˜å³°, æˆ–è€…åº”ç”¨ç¨‹åº bug, å¯¼è‡´"),t("strong",[s._v("æŸä¸ªè¯­å¥çš„ QPS çªç„¶æš´æ¶¨")]),s._v(", ä¹Ÿå¯èƒ½å¯¼è‡´ MySQL åŽ‹åŠ›è¿‡å¤§, å½±å“æœåŠ¡.")]),s._v(" "),t("p",[s._v("æˆ‘ä¹‹å‰ç¢°åˆ°è¿‡ä¸€ç±»æƒ…å†µ, æ˜¯ç”±ä¸€ä¸ªæ–°åŠŸèƒ½çš„ bug å¯¼è‡´çš„. å½“ç„¶æœ€ç†æƒ³çš„æƒ…å†µæ˜¯è®©ä¸šåŠ¡æŠŠè¿™ä¸ªåŠŸèƒ½ä¸‹æŽ‰, æœåŠ¡è‡ªç„¶å°±ä¼šæ¢å¤. è€Œä¸‹æŽ‰ä¸€ä¸ªåŠŸèƒ½, å¦‚æžœä»Žæ•°æ®åº“ç«¯å¤„ç†çš„è¯, å¯¹åº”äºŽä¸åŒçš„èƒŒæ™¯, æœ‰ä¸åŒçš„æ–¹æ³•å¯ç”¨. è¿™é‡Œå†å±•å¼€è¯´æ˜Žä¸€ä¸‹.")]),s._v(" "),t("ol",[t("li",[s._v("ä¸€ç§æ˜¯ç”±å…¨æ–°ä¸šåŠ¡çš„ bug å¯¼è‡´çš„. å‡è®¾ä½ çš„ DB è¿ç»´æ˜¯æ¯”è¾ƒè§„èŒƒçš„, ä¹Ÿå°±æ˜¯è¯´ç™½åå•æ˜¯ä¸€ä¸ªä¸ªåŠ çš„. è¿™ç§æƒ…å†µä¸‹, å¦‚æžœèƒ½å¤Ÿç¡®å®šä¸šåŠ¡æ–¹ä¼šä¸‹æŽ‰è¿™ä¸ªåŠŸèƒ½, åªæ˜¯æ—¶é—´ä¸Šæ²¡é‚£ä¹ˆå¿«, é‚£ä¹ˆå°±å¯ä»¥ä»Žæ•°æ®åº“ç«¯ç›´æŽ¥æŠŠç™½åå•åŽ»æŽ‰.")]),s._v(" "),t("li",[s._v("å¦‚æžœè¿™ä¸ªæ–°åŠŸèƒ½ä½¿ç”¨çš„æ˜¯å•ç‹¬çš„æ•°æ®åº“ç”¨æˆ·, å¯ä»¥ç”¨ç®¡ç†å‘˜è´¦å·æŠŠè¿™ä¸ªç”¨æˆ·åˆ æŽ‰, ç„¶åŽæ–­å¼€çŽ°æœ‰è¿žæŽ¥. è¿™æ ·è¿™ä¸ªæ–°åŠŸèƒ½çš„è¿žæŽ¥ä¸æˆåŠŸ, ç”±å®ƒå¼•å‘çš„ QPS å°±ä¼šå˜æˆ 0.")]),s._v(" "),t("li",[s._v('å¦‚æžœè¿™ä¸ªæ–°å¢žçš„åŠŸèƒ½è·Ÿä¸»ä½“åŠŸèƒ½æ˜¯éƒ¨ç½²åœ¨ä¸€èµ·çš„, é‚£ä¹ˆåªèƒ½é€šè¿‡å¤„ç†è¯­å¥æ¥é™åˆ¶. è¿™æ—¶å¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„æŸ¥è¯¢é‡å†™åŠŸèƒ½, æŠŠåŽ‹åŠ›æœ€å¤§çš„ SQL è¯­å¥ç›´æŽ¥é‡å†™æˆ "select 1" è¿”å›ž.')])]),s._v(" "),t("p",[s._v("å½“ç„¶è¿™ä¸ªæ“ä½œçš„é£Žé™©å¾ˆé«˜, éœ€è¦ç‰¹åˆ«ç»†è‡´. å®ƒå¯èƒ½å­˜åœ¨ä¸¤ä¸ªå‰¯ä½œç”¨:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœåˆ«çš„åŠŸèƒ½é‡Œé¢ä¹Ÿç”¨åˆ°äº†è¿™ä¸ª SQL è¯­å¥æ¨¡æ¿, ä¼šæœ‰è¯¯ä¼¤;")]),s._v(" "),t("li",[s._v("å¾ˆå¤šä¸šåŠ¡å¹¶ä¸æ˜¯é è¿™ä¸€ä¸ªè¯­å¥å°±èƒ½å®Œæˆé€»è¾‘çš„, æ‰€ä»¥å¦‚æžœå•ç‹¬æŠŠè¿™ä¸€ä¸ªè¯­å¥ä»¥ select 1 çš„ç»“æžœè¿”å›žçš„è¯, å¯èƒ½ä¼šå¯¼è‡´åŽé¢çš„ä¸šåŠ¡é€»è¾‘ä¸€èµ·å¤±è´¥.")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥, æ–¹æ¡ˆ 3 æ˜¯ç”¨äºŽæ­¢è¡€çš„, è·Ÿå‰é¢æåˆ°çš„åŽ»æŽ‰æƒé™éªŒè¯ä¸€æ ·, åº”è¯¥æ˜¯ä½ æ‰€æœ‰é€‰é¡¹é‡Œä¼˜å…ˆçº§æœ€ä½Žçš„ä¸€ä¸ªæ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("åŒæ—¶ä½ ä¼šå‘çŽ°, å…¶å®žæ–¹æ¡ˆ 1 å’Œ 2 éƒ½è¦"),t("strong",[s._v("ä¾èµ–äºŽè§„èŒƒçš„è¿ç»´ä½“ç³»")]),s._v(": è™šæ‹ŸåŒ–, ç™½åå•æœºåˆ¶, ä¸šåŠ¡è´¦å·åˆ†ç¦». ç”±æ­¤å¯è§, æ›´å¤šçš„å‡†å¤‡, å¾€å¾€æ„å‘³ç€æ›´ç¨³å®šçš„ç³»ç»Ÿ.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-21"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-21"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»¥ä¸šåŠ¡é«˜å³°æœŸçš„æ€§èƒ½é—®é¢˜ä¸ºèƒŒæ™¯, ä»‹ç»äº†ä¸€äº›ç´§æ€¥å¤„ç†çš„æ‰‹æ®µ. è¿™äº›å¤„ç†æ‰‹æ®µä¸­, æ—¢åŒ…æ‹¬äº†ç²—æš´åœ°æ‹’ç»è¿žæŽ¥å’Œæ–­å¼€è¿žæŽ¥, ä¹Ÿæœ‰é€šè¿‡é‡å†™è¯­å¥æ¥ç»•è¿‡ä¸€äº›å‘çš„æ–¹æ³•; æ—¢æœ‰ä¸´æ—¶çš„é«˜å±æ–¹æ¡ˆ, ä¹Ÿæœ‰æœªé›¨ç»¸ç¼ªçš„, ç›¸å¯¹å®‰å…¨çš„é¢„æ¡ˆ.")]),s._v(" "),t("p",[s._v("åœ¨å®žé™…å¼€å‘ä¸­, ä¹Ÿè¦å°½é‡é¿å…ä¸€äº›ä½Žæ•ˆçš„æ–¹æ³•, æ¯”å¦‚"),t("strong",[s._v("é¿å…å¤§é‡åœ°ä½¿ç”¨çŸ­è¿žæŽ¥")]),s._v(". åŒæ—¶, å¦‚æžœä½ åšä¸šåŠ¡å¼€å‘çš„è¯, è¦çŸ¥é“"),t("strong",[s._v("è¿žæŽ¥å¼‚å¸¸æ–­å¼€æ˜¯å¸¸æœ‰çš„äº‹, ä½ çš„ä»£ç é‡Œè¦æœ‰æ­£ç¡®åœ°é‡è¿žå¹¶é‡è¯•çš„æœºåˆ¶")]),s._v(".")]),s._v(" "),t("p",[s._v("DBA è™½ç„¶å¯ä»¥é€šè¿‡è¯­å¥é‡å†™æ¥æš‚æ—¶å¤„ç†é—®é¢˜, ä½†æ˜¯è¿™æœ¬èº«æ˜¯ä¸€ä¸ªé£Žé™©é«˜çš„æ“ä½œ, åšå¥½ SQL å®¡è®¡å¯ä»¥å‡å°‘éœ€è¦è¿™ç±»æ“ä½œçš„æœºä¼š.")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹å¾—å‡ºæ¥, æœ¬èŠ‚æåˆ°çš„"),t("strong",[s._v("è§£å†³æ–¹æ³•ä¸»è¦é›†ä¸­åœ¨ server å±‚")]),s._v(". åœ¨ä¸‹ä¸€èŠ‚ç« ä¸­, ä¼šç»§ç»­å’Œè®¨è®ºä¸€äº›è·Ÿ InnoDB æœ‰å…³çš„å¤„ç†æ–¹æ³•.")]),s._v(" "),t("h4",{attrs:{id:"_23-mysqlæ˜¯æ€Žä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_23-mysqlæ˜¯æ€Žä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„"}},[s._v("#")]),s._v(" 23-MySQLæ˜¯æ€Žä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„?")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä¼šç»§ç»­ä»‹ç»"),t("strong",[s._v("åœ¨ä¸šåŠ¡é«˜å³°æœŸä¸´æ—¶æå‡æ€§èƒ½")]),s._v('çš„æ–¹æ³•. ä»Žæ–‡ç« æ ‡é¢˜ "MySQL æ˜¯æ€Žä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„?", å°±å¯ä»¥çœ‹å‡ºæ¥, ä»Šå¤©ä»‹ç»çš„æ–¹æ³•, è·Ÿ'),t("strong",[s._v("æ•°æ®çš„å¯é æ€§æœ‰å…³")]),s._v(".")]),s._v(" "),t("p",[s._v("å‰é¢ç€é‡ä»‹ç»äº† WAL æœºåˆ¶, å¾—åˆ°çš„ç»“è®ºæ˜¯: "),t("mark",[t("strong",[s._v("åªè¦ redo log å’Œ binlog ä¿è¯æŒä¹…åŒ–åˆ°ç£ç›˜, å°±èƒ½ç¡®ä¿ MySQL å¼‚å¸¸é‡å¯åŽ, æ•°æ®å¯ä»¥æ¢å¤")])]),s._v(". æœ‰äººç»§ç»­è¿½é—®, redo log çš„å†™å…¥æµç¨‹æ˜¯æ€Žä¹ˆæ ·çš„, "),t("strong",[s._v("å¦‚ä½•ä¿è¯ redo log çœŸå®žåœ°å†™å…¥äº†ç£ç›˜")]),s._v(". æœ¬èŠ‚å°±å†ä¸€èµ·çœ‹çœ‹ MySQL å†™å…¥ binlog å’Œ redo log çš„æµç¨‹.")]),s._v(" "),t("h5",{attrs:{id:"binlogçš„å†™å…¥æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#binlogçš„å†™å…¥æœºåˆ¶"}},[s._v("#")]),s._v(" binlogçš„å†™å…¥æœºåˆ¶")]),s._v(" "),t("p",[s._v("å…¶å®ž, binlog çš„å†™å…¥é€»è¾‘æ¯”è¾ƒç®€å•: "),t("mark",[t("strong",[s._v("äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­, å…ˆæŠŠæ—¥å¿—å†™åˆ° binlog cache, äº‹åŠ¡æäº¤çš„æ—¶å€™, å†æŠŠ binlog cache å†™åˆ° binlog æ–‡ä»¶ä¸­")])]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("ä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯ä¸èƒ½è¢«æ‹†å¼€çš„, å› æ­¤ä¸è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§, ä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥. è¿™å°±æ¶‰åŠåˆ°äº† binlog cache çš„ä¿å­˜é—®é¢˜. ç³»ç»Ÿç»™ binlog cache åˆ†é…äº†ä¸€ç‰‡å†…å­˜, æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ª, å‚æ•° binlog_cache_size ç”¨äºŽæŽ§åˆ¶å•ä¸ªçº¿ç¨‹å†… binlog cache æ‰€å å†…å­˜çš„å¤§å°. å¦‚æžœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°, å°±è¦æš‚å­˜åˆ°ç£ç›˜. äº‹åŠ¡æäº¤çš„æ—¶å€™, æ‰§è¡Œå™¨æŠŠ binlog cache é‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ° binlog ä¸­, å¹¶æ¸…ç©º binlog cache. çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤º.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/eb7ecb6b95a39cb26661f8f6b282407c-20230731161914-hhjvxiy.png",alt:"",title:"binlogå†™ç›˜çŠ¶æ€"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·± binlog cache, ä½†æ˜¯å…±ç”¨åŒä¸€ä»½ binlog æ–‡ä»¶")]),s._v(".")]),s._v(" "),t("ul",[t("li",[s._v("å›¾ä¸­çš„ "),t("strong",[s._v("write")]),s._v(", æŒ‡çš„å°±æ˜¯æŒ‡"),t("strong",[s._v("æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache, å¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜")]),s._v(", æ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«.")]),s._v(" "),t("li",[s._v("å›¾ä¸­çš„ "),t("strong",[s._v("fsync")]),s._v(", æ‰æ˜¯"),t("strong",[s._v("å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œ")]),s._v(". ä¸€èˆ¬æƒ…å†µä¸‹, è®¤ä¸º fsync æ‰å ç£ç›˜çš„ IOPS.")])]),s._v(" "),t("p",[s._v("write å’Œ fsync çš„æ—¶æœº, æ˜¯ç”±å‚æ•° "),t("mark",[t("strong",[s._v("sync_binlog")])]),s._v(" æŽ§åˆ¶çš„:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("sync_binlog=0 çš„æ—¶å€™, è¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª write, ä¸ fsync;")])]),s._v(" "),t("li",[t("strong",[s._v("sync_binlog=1 çš„æ—¶å€™, è¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ fsync;")])]),s._v(" "),t("li",[t("strong",[s._v("sync_binlog=N(N>1) çš„æ—¶å€™, è¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ write, ä½†ç´¯ç§¯ N ä¸ªäº‹åŠ¡åŽæ‰ fsync.")])])]),s._v(" "),t("p",[s._v("å› æ­¤, åœ¨å‡ºçŽ° IO ç“¶é¢ˆçš„åœºæ™¯é‡Œ, å°† sync_binlog è®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼, å¯ä»¥"),t("strong",[s._v("æå‡æ€§èƒ½")]),s._v(". åœ¨å®žé™…çš„ä¸šåŠ¡åœºæ™¯ä¸­, è€ƒè™‘åˆ°ä¸¢å¤±æ—¥å¿—é‡çš„å¯æŽ§æ€§, ä¸€èˆ¬ä¸å»ºè®®å°†è¿™ä¸ªå‚æ•°è®¾æˆ 0, æ¯”è¾ƒå¸¸è§çš„æ˜¯"),t("strong",[s._v("å°†å…¶è®¾ç½®ä¸º 100~1000 ä¸­çš„æŸä¸ªæ•°å€¼")]),s._v(". ä½†æ˜¯å°† sync_binlog è®¾ç½®ä¸º N, å¯¹åº”çš„é£Žé™©æ˜¯: "),t("strong",[s._v("å¦‚æžœä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯, ä¼šä¸¢å¤±æœ€è¿‘ N ä¸ªäº‹åŠ¡çš„ binlog æ—¥å¿—")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"redo-logçš„å†™å…¥æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redo-logçš„å†™å…¥æœºåˆ¶"}},[s._v("#")]),s._v(" redo logçš„å†™å…¥æœºåˆ¶")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†è¯´è¯´ redo log çš„å†™å…¥æœºåˆ¶.")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº† redo log buffer. "),t("strong",[s._v("äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­, ç”Ÿæˆçš„ redo log æ˜¯è¦å…ˆå†™åˆ° redo log buffer çš„")]),s._v(". ç„¶åŽå°±æœ‰äººé—®äº†, redo log buffer é‡Œé¢çš„å†…å®¹, æ˜¯ä¸æ˜¯æ¯æ¬¡ç”ŸæˆåŽéƒ½è¦ç›´æŽ¥æŒä¹…åŒ–åˆ°ç£ç›˜å‘¢?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("ä¸éœ€è¦")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æžœäº‹åŠ¡æ‰§è¡ŒæœŸé—´ MySQL å‘ç”Ÿå¼‚å¸¸é‡å¯, é‚£è¿™éƒ¨åˆ†æ—¥å¿—å°±ä¸¢äº†. ç”±äºŽäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤, æ‰€ä»¥è¿™æ—¶æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±.")])]),s._v(" "),t("p",[s._v("é‚£å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯, äº‹åŠ¡è¿˜æ²¡æäº¤çš„æ—¶å€™, redo log buffer ä¸­çš„éƒ¨åˆ†æ—¥å¿—æœ‰æ²¡æœ‰å¯èƒ½è¢«æŒä¹…åŒ–åˆ°ç£ç›˜å‘¢?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("ç¡®å®žä¼šæœ‰")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜, è¦ä»Ž redo log å¯èƒ½å­˜åœ¨çš„ä¸‰ç§çŠ¶æ€è¯´èµ·. è¿™ä¸‰ç§çŠ¶æ€, å¯¹åº”çš„å°±æ˜¯å›¾ 2 ä¸­çš„ä¸‰ä¸ªé¢œè‰²å—.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0b8674db00e35da26a3c5af0e37f3c77-20230731161914-u5ui6nv.png",alt:"",title:"MySQL redo log å­˜å‚¨çŠ¶æ€"}})]),s._v(" "),t("p",[s._v("è¿™ä¸‰ç§çŠ¶æ€åˆ†åˆ«æ˜¯:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å­˜åœ¨ redo log buffer ä¸­, ç‰©ç†ä¸Šæ˜¯åœ¨ MySQL è¿›ç¨‹å†…å­˜ä¸­, å°±æ˜¯å›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("å†™åˆ°ç£ç›˜ (write), ä½†æ˜¯æ²¡æœ‰æŒä¹…åŒ–(fsync), ç‰©ç†ä¸Šæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ page cache é‡Œé¢, ä¹Ÿå°±æ˜¯å›¾ä¸­çš„é»„è‰²éƒ¨åˆ†")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("æŒä¹…åŒ–åˆ°ç£ç›˜, å¯¹åº”çš„æ˜¯ hard disk, ä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç»¿è‰²éƒ¨åˆ†")]),s._v(".")])]),s._v(" "),t("p",[s._v("æ—¥å¿—å†™åˆ° redo log buffer æ˜¯å¾ˆå¿«çš„, wirte åˆ° page cache ä¹Ÿå·®ä¸å¤š, ä½†æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜çš„é€Ÿåº¦å°±æ…¢å¤šäº†.")]),s._v(" "),t("p",[s._v("ä¸ºäº†æŽ§åˆ¶ redo log çš„å†™å…¥ç­–ç•¥, InnoDB æä¾›äº† "),t("strong",[s._v("innodb_flush_log_at_trx_commit")]),s._v(" å‚æ•°, å®ƒæœ‰ä¸‰ç§å¯èƒ½å–å€¼:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("è®¾ç½®ä¸º 0 çš„æ—¶å€™, è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­;")])]),s._v(" "),t("li",[t("strong",[s._v("è®¾ç½®ä¸º 1 çš„æ—¶å€™, è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æŽ¥æŒä¹…åŒ–åˆ°ç£ç›˜;")])]),s._v(" "),t("li",[t("strong",[s._v("è®¾ç½®ä¸º 2 çš„æ—¶å€™, è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cache.")])])]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("InnoDB æœ‰ä¸€ä¸ªåŽå°çº¿ç¨‹, æ¯éš” 1 ç§’, å°±ä¼šæŠŠ redo log buffer ä¸­çš„æ—¥å¿—, è°ƒç”¨ write å†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache, ç„¶åŽè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç£ç›˜")])]),s._v(".")]),s._v(" "),t("p",[s._v("æ³¨æ„, äº‹åŠ¡æ‰§è¡Œä¸­é—´è¿‡ç¨‹çš„ redo log ä¹Ÿæ˜¯ç›´æŽ¥å†™åœ¨ "),t("strong",[s._v("redo log buffer")]),s._v(" ä¸­çš„, è¿™äº› redo log ä¹Ÿä¼šè¢«åŽå°çº¿ç¨‹ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("ä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log, ä¹Ÿæ˜¯å¯èƒ½å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, é™¤äº†åŽå°çº¿ç¨‹æ¯ç§’ä¸€æ¬¡çš„è½®è¯¢æ“ä½œå¤–, è¿˜æœ‰ä¸¤ç§åœºæ™¯ä¼šè®©ä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log å†™å…¥åˆ°ç£ç›˜ä¸­.")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä¸€ç§æ˜¯, redo log buffer å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size ä¸€åŠçš„æ—¶å€™, åŽå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜. ** æ³¨æ„ç”±äºŽè¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤, æ‰€ä»¥è¿™ä¸ªå†™ç›˜åŠ¨ä½œ")]),s._v("åªæ˜¯ write**, è€Œæ²¡æœ‰è°ƒç”¨ fsync, ä¹Ÿå°±æ˜¯åªç•™åœ¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ page cache.")]),s._v(" "),t("li",[s._v("**å¦ä¸€ç§æ˜¯, å¹¶è¡Œçš„äº‹åŠ¡æäº¤çš„æ—¶å€™, é¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„ redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜. ** å‡è®¾ä¸€ä¸ªäº‹åŠ¡ A æ‰§è¡Œåˆ°ä¸€åŠ, å·²ç»å†™äº†ä¸€äº› redo log åˆ° buffer ä¸­, è¿™æ—¶å€™æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„äº‹åŠ¡ B æäº¤, å¦‚æžœ innodb_flush_log_at_trx_commit è®¾ç½®çš„æ˜¯ 1, é‚£ä¹ˆæŒ‰ç…§è¿™ä¸ªå‚æ•°çš„é€»è¾‘, äº‹åŠ¡ B è¦æŠŠ redo log buffer é‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜. è¿™æ—¶å€™å°±ä¼šå¸¦ä¸Šäº‹åŠ¡ A åœ¨ redo log buffer é‡Œçš„æ—¥å¿—ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜.")])]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦è¯´æ˜Žçš„æ˜¯, "),t("mark",[t("strong",[s._v("åœ¨ä»‹ç»ä¸¤é˜¶æ®µæäº¤çš„æ—¶å€™è¯´è¿‡, æ—¶åºä¸Š redo log å…ˆ prepare,  å†å†™ binlog, æœ€åŽå†æŠŠ redo log commit")])]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æžœæŠŠ innodb_flush_log_at_trx_commit è®¾ç½®æˆ 1, é‚£ä¹ˆ redo log åœ¨ prepare é˜¶æ®µå°±è¦æŒä¹…åŒ–ä¸€æ¬¡, å› ä¸ºæœ‰ä¸€ä¸ªå´©æºƒæ¢å¤é€»è¾‘æ˜¯è¦ä¾èµ–äºŽ prepare çš„ redo log, å†åŠ ä¸Š binlog æ¥æ¢å¤çš„.")]),s._v(" "),t("p",[s._v("æ¯ç§’ä¸€æ¬¡åŽå°è½®è¯¢åˆ·ç›˜, å†åŠ ä¸Šå´©æºƒæ¢å¤è¿™ä¸ªé€»è¾‘, InnoDB å°±è®¤ä¸º redo log åœ¨ commit çš„æ—¶å€™å°±ä¸éœ€è¦ fsync äº†, åªä¼š write åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache ä¸­å°±å¤Ÿäº†.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v('é€šå¸¸è¯´ MySQL çš„ "åŒ 1" é…ç½®, æŒ‡çš„å°±æ˜¯ sync_binlog å’Œ innodb_flush_log_at_trx_commit éƒ½è®¾ç½®æˆ 1. ä¹Ÿå°±æ˜¯è¯´, ä¸€ä¸ªäº‹åŠ¡å®Œæ•´æäº¤å‰, éœ€è¦ç­‰å¾…ä¸¤æ¬¡åˆ·ç›˜, ä¸€æ¬¡æ˜¯ redo log(prepare é˜¶æ®µ), ä¸€æ¬¡æ˜¯ binlog.')])])]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™, ä½ å¯èƒ½æœ‰ä¸€ä¸ªç–‘é—®, è¿™æ„å‘³ç€ä»Ž MySQL çœ‹åˆ°çš„ TPS æ˜¯æ¯ç§’ä¸¤ä¸‡çš„è¯, æ¯ç§’å°±ä¼šå†™å››ä¸‡æ¬¡ç£ç›˜. ä½†æ˜¯ç”¨å·¥å…·æµ‹è¯•å‡ºæ¥, ç£ç›˜èƒ½åŠ›ä¹Ÿå°±ä¸¤ä¸‡å·¦å³, æ€Žä¹ˆèƒ½å®žçŽ°ä¸¤ä¸‡çš„ TPS?")]),s._v(" "),t("p",[s._v("è§£é‡Šè¿™ä¸ªé—®é¢˜, å°±è¦ç”¨åˆ°"),t("strong",[s._v("ç»„æäº¤(group commit)æœºåˆ¶")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦å…ˆä»‹ç»"),t("strong",[s._v("æ—¥å¿—é€»è¾‘åºåˆ—å·")]),s._v("(log sequence number, LSN)çš„æ¦‚å¿µ. LSN æ˜¯å•è°ƒé€’å¢žçš„, ç”¨æ¥å¯¹åº” redo log çš„ä¸€ä¸ªä¸ªå†™å…¥ç‚¹. æ¯æ¬¡å†™å…¥é•¿åº¦ä¸º length çš„ redo log, LSN çš„å€¼å°±ä¼šåŠ ä¸Š length.")]),s._v(" "),t("p",[t("strong",[s._v("LSN ä¹Ÿä¼šå†™åˆ° InnoDB çš„æ•°æ®é¡µä¸­, æ¥ç¡®ä¿æ•°æ®é¡µä¸ä¼šè¢«å¤šæ¬¡æ‰§è¡Œé‡å¤çš„ redo log")]),s._v(". å…³äºŽ LSN å’Œ redo log, checkpoint çš„å…³ç³», ä¼šåœ¨åŽé¢è¯¦ç»†å±•å¼€.")]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤º, æ˜¯"),t("strong",[s._v("ä¸‰ä¸ªå¹¶å‘äº‹åŠ¡ (trx1, trx2, trx3) åœ¨ prepare é˜¶æ®µ, éƒ½å†™å®Œ redo log buffer, æŒä¹…åŒ–åˆ°ç£ç›˜çš„è¿‡ç¨‹")]),s._v(", å¯¹åº”çš„ LSN åˆ†åˆ«æ˜¯ 50, 120 å’Œ 160.")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/2b53768e263988977cb31181061af9e8-20230731161914-p65s4qj.png",alt:"",title:"redo log ç»„æäº¤"}}),s._v("â€‹")]),s._v(" "),t("p",[s._v("ä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°,")]),s._v(" "),t("ol",[t("li",[s._v("trx1 æ˜¯ç¬¬ä¸€ä¸ªåˆ°è¾¾çš„, ä¼šè¢«é€‰ä¸ºè¿™ç»„çš„ leader;")]),s._v(" "),t("li",[s._v("ç­‰ trx1 è¦å¼€å§‹å†™ç›˜çš„æ—¶å€™, è¿™ä¸ªç»„é‡Œé¢å·²ç»æœ‰äº†ä¸‰ä¸ªäº‹åŠ¡, è¿™æ—¶å€™ LSN ä¹Ÿå˜æˆäº† 160;")]),s._v(" "),t("li",[s._v("trx1 åŽ»å†™ç›˜çš„æ—¶å€™, å¸¦çš„å°±æ˜¯ LSN=160, å› æ­¤ç­‰ trx1 è¿”å›žæ—¶, æ‰€æœ‰ LSN å°äºŽç­‰äºŽ 160 çš„ redo log, éƒ½å·²ç»è¢«æŒä¹…åŒ–åˆ°ç£ç›˜;")]),s._v(" "),t("li",[s._v("è¿™æ—¶å€™ trx2 å’Œ trx3 å°±å¯ä»¥ç›´æŽ¥è¿”å›žäº†.")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥, "),t("strong",[s._v("ä¸€æ¬¡ç»„æäº¤é‡Œé¢, ç»„å‘˜è¶Šå¤š, èŠ‚çº¦ç£ç›˜ IOPS çš„æ•ˆæžœè¶Šå¥½")]),s._v(". ä½†å¦‚æžœåªæœ‰å•çº¿ç¨‹åŽ‹æµ‹, é‚£å°±åªèƒ½è€è€å®žå®žåœ°ä¸€ä¸ªäº‹åŠ¡å¯¹åº”ä¸€æ¬¡æŒä¹…åŒ–æ“ä½œäº†.")]),s._v(" "),t("p",[s._v("åœ¨å¹¶å‘æ›´æ–°åœºæ™¯ä¸‹, ç¬¬ä¸€ä¸ªäº‹åŠ¡å†™å®Œ redo log buffer ä»¥åŽ, æŽ¥ä¸‹æ¥è¿™ä¸ª fsync è¶Šæ™šè°ƒç”¨, ç»„å‘˜å¯èƒ½è¶Šå¤š, èŠ‚çº¦ IOPS çš„æ•ˆæžœå°±è¶Šå¥½.")]),s._v(" "),t("p",[s._v("ä¸ºäº†è®©ä¸€æ¬¡ fsync å¸¦çš„ç»„å‘˜æ›´å¤š, MySQL æœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ä¼˜åŒ–: "),t("strong",[s._v("æ‹–æ—¶é—´")]),s._v(". åœ¨ä»‹ç»ä¸¤é˜¶æ®µæäº¤çš„æ—¶å€™, æ›¾ç»ç”»äº†ä¸€ä¸ªå›¾, çŽ°åœ¨æˆ‘æŠŠå®ƒæˆªè¿‡æ¥.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/901e08b9add7085339e02cc13fb4171b-20230731161914-1hiczvx.png",alt:"",title:"ä¸¤é˜¶æ®µæäº¤"}})]),s._v(" "),t("p",[s._v('å›¾ä¸­æŠŠ "å†™ binlog" å½“æˆä¸€ä¸ªåŠ¨ä½œ. ä½†å®žé™…ä¸Š, '),t("strong",[s._v("å†™ binlog æ˜¯åˆ†æˆä¸¤æ­¥")]),s._v("çš„:")]),s._v(" "),t("ol",[t("li",[s._v("å…ˆæŠŠ binlog ä»Ž binlog cache ä¸­å†™åˆ°ç£ç›˜ä¸Šçš„ binlog æ–‡ä»¶;")]),s._v(" "),t("li",[s._v("è°ƒç”¨ fsync æŒä¹…åŒ–.")])]),s._v(" "),t("p",[s._v("MySQL ä¸ºäº†è®©ç»„æäº¤çš„æ•ˆæžœæ›´å¥½, "),t("strong",[s._v("æŠŠ redo log åš fsync çš„æ—¶é—´æ‹–åˆ°äº†æ­¥éª¤ 1 ä¹‹åŽ")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, ä¸Šé¢çš„å›¾å˜æˆäº†è¿™æ ·:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4141df161d231298b44260878c4d0667-20230731161914-7x56exw.png",alt:"",title:"ä¸¤é˜¶æ®µæäº¤ç»†åŒ–"}})]),s._v(" "),t("p",[s._v("è¿™ä¹ˆä¸€æ¥, "),t("strong",[s._v("binlog ä¹Ÿå¯ä»¥ç»„æäº¤")]),s._v("äº†. åœ¨æ‰§è¡Œç¬¬ 4 æ­¥æŠŠ binlog fsync åˆ°ç£ç›˜æ—¶, å¦‚æžœæœ‰å¤šä¸ªäº‹åŠ¡çš„ binlog å·²ç»å†™å®Œäº†, ä¹Ÿæ˜¯ä¸€èµ·æŒä¹…åŒ–çš„, è¿™æ ·ä¹Ÿå¯ä»¥å‡å°‘ IOPS çš„æ¶ˆè€—. ä¸è¿‡é€šå¸¸æƒ…å†µä¸‹ç¬¬ 3 æ­¥æ‰§è¡Œå¾—ä¼šå¾ˆå¿«, æ‰€ä»¥ binlog çš„ write å’Œ fsync é—´çš„é—´éš”æ—¶é—´çŸ­, å¯¼è‡´èƒ½é›†åˆåˆ°ä¸€èµ·æŒä¹…åŒ–çš„ binlog æ¯”è¾ƒå°‘, å› æ­¤ binlog çš„ç»„æäº¤çš„æ•ˆæžœé€šå¸¸ä¸å¦‚ redo log çš„æ•ˆæžœé‚£ä¹ˆå¥½.")]),s._v(" "),t("p",[s._v("å¦‚æžœæƒ³æå‡ binlog ç»„æäº¤çš„æ•ˆæžœ, å¯ä»¥é€šè¿‡è®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_count æ¥å®žçŽ°.")]),s._v(" "),t("ol",[t("li",[s._v("binlog_group_commit_sync_delay å‚æ•°, è¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åŽæ‰è°ƒç”¨ fsync;")]),s._v(" "),t("li",[s._v("binlog_group_commit_sync_no_delay_count å‚æ•°, è¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åŽæ‰è°ƒç”¨ fsync.")])]),s._v(" "),t("p",[s._v("è¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯æˆ–çš„å…³ç³», ä¹Ÿå°±æ˜¯è¯´åªè¦æœ‰ä¸€ä¸ªæ»¡è¶³æ¡ä»¶å°±ä¼šè°ƒç”¨ fsync. æ‰€ä»¥, å½“ binlog_group_commit_sync_delay è®¾ç½®ä¸º 0 çš„æ—¶å€™, binlog_group_commit_sync_no_delay_count ä¹Ÿæ— æ•ˆäº†.")]),s._v(" "),t("p",[s._v("ä¹‹å‰æœ‰äººé—®åˆ°, "),t("strong",[s._v("WAL æœºåˆ¶æ˜¯å‡å°‘ç£ç›˜å†™, å¯æ˜¯æ¯æ¬¡æäº¤äº‹åŠ¡éƒ½è¦å†™ redo log å’Œ binlog, è¿™ç£ç›˜è¯»å†™æ¬¡æ•°ä¹Ÿæ²¡å˜å°‘å‘€")]),s._v("?")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä½ å°±èƒ½ç†è§£äº†, WAL æœºåˆ¶ä¸»è¦å¾—ç›ŠäºŽä¸¤ä¸ªæ–¹é¢:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("redo log å’Œ binlog éƒ½æ˜¯é¡ºåºå†™, ç£ç›˜çš„é¡ºåºå†™æ¯”éšæœºå†™é€Ÿåº¦è¦å¿«;")])]),s._v(" "),t("li",[t("strong",[s._v("ç»„æäº¤æœºåˆ¶, å¯ä»¥å¤§å¹…åº¦é™ä½Žç£ç›˜çš„ IOPS æ¶ˆè€—.")])])]),s._v(" "),t("p",[s._v("åˆ†æžåˆ°è¿™é‡Œ, å†æ¥å›žç­”è¿™ä¸ªé—®é¢˜: **å¦‚æžœ MySQL å‡ºçŽ°äº†æ€§èƒ½ç“¶é¢ˆ, è€Œä¸”ç“¶é¢ˆåœ¨ IO ä¸Š, å¯ä»¥é€šè¿‡å“ªäº›æ–¹æ³•æ¥æå‡æ€§èƒ½å‘¢? **")]),s._v(" "),t("p",[s._v("é’ˆå¯¹è¿™ä¸ªé—®é¢˜, å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸‰ç§æ–¹æ³•:")]),s._v(" "),t("ol",[t("li",[s._v("è®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_count å‚æ•°, "),t("strong",[s._v("å‡å°‘ binlog çš„å†™ç›˜æ¬¡æ•°")]),s._v('. è¿™ä¸ªæ–¹æ³•æ˜¯åŸºäºŽ "é¢å¤–çš„æ•…æ„ç­‰å¾… "æ¥å®žçŽ°çš„, '),t("strong",[s._v("å› æ­¤å¯èƒ½ä¼šå¢žåŠ è¯­å¥çš„å“åº”æ—¶é—´, ä½†æ²¡æœ‰ä¸¢å¤±æ•°æ®çš„é£Žé™©")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("å°† sync_binlog è®¾ç½®ä¸ºå¤§äºŽ 1 çš„å€¼(æ¯”è¾ƒå¸¸è§æ˜¯ 100~1000)")]),s._v(" . è¿™æ ·åšçš„é£Žé™©æ˜¯, ä¸»æœºæŽ‰ç”µæ—¶ä¼šä¸¢ binlog æ—¥å¿—.")]),s._v(" "),t("li",[t("strong",[s._v("å°† innodb_flush_log_at_trx_commit è®¾ç½®ä¸º 2")]),s._v(". è¿™æ ·åšçš„é£Žé™©æ˜¯, ä¸»æœºæŽ‰ç”µçš„æ—¶å€™ä¼šä¸¢æ•°æ®.")])]),s._v(" "),t("p",[s._v("ä¸å»ºè®®æŠŠ innodb_flush_log_at_trx_commit è®¾ç½®æˆ 0. å› ä¸ºæŠŠè¿™ä¸ªå‚æ•°è®¾ç½®æˆ 0, è¡¨ç¤º redo log åªä¿å­˜åœ¨å†…å­˜ä¸­, è¿™æ ·çš„è¯ MySQL æœ¬èº«å¼‚å¸¸é‡å¯ä¹Ÿä¼šä¸¢æ•°æ®, é£Žé™©å¤ªå¤§. è€Œ redo log å†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache çš„é€Ÿåº¦ä¹Ÿæ˜¯å¾ˆå¿«çš„, æ‰€ä»¥å°†è¿™ä¸ªå‚æ•°è®¾ç½®æˆ 2 è·Ÿè®¾ç½®æˆ 0 å…¶å®žæ€§èƒ½å·®ä¸å¤š, ä½†è¿™æ ·åš MySQL å¼‚å¸¸é‡å¯æ—¶å°±ä¸ä¼šä¸¢æ•°æ®äº†, ç›¸æ¯”ä¹‹ä¸‹é£Žé™©ä¼šæ›´å°.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-22"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-22"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v('å‰é¢åˆ†æžè¿‡å¦‚æžœ redo log å’Œ binlog æ˜¯å®Œæ•´çš„, MySQL æ˜¯å¦‚ä½•ä¿è¯ crash-safe çš„. æœ¬èŠ‚ç€é‡å’Œä½ ä»‹ç»çš„æ˜¯ MySQL æ˜¯ "'),t("strong",[s._v("æ€Žä¹ˆä¿è¯ redo log å’Œ binlog æ˜¯å®Œæ•´çš„")]),s._v('". å¸Œæœ›è¿™äº›èƒ½å¤Ÿè®©ä½ å¯¹ crash-safe è¿™ä¸ªæ¦‚å¿µæœ‰æ›´æ¸…æ™°çš„ç†è§£.')]),s._v(" "),t("p",[s._v("è¿™é‡Œä¸ºäº†æ–¹ä¾¿ä½ å›žé¡¾, å­¦ä¹ , è¿™é‡Œå†é›†ä¸­å›žç­”ä¸€æ¬¡ä¸€äº›æ—¥å¿—ç›¸å…³çš„é—®é¢˜.")]),s._v(" "),t("blockquote",[t("p",[s._v("é—®é¢˜ 1: æ‰§è¡Œä¸€ä¸ª update è¯­å¥ä»¥åŽ, å†åŽ»æ‰§è¡Œ hexdump å‘½ä»¤ç›´æŽ¥æŸ¥çœ‹ ibd æ–‡ä»¶å†…å®¹, ä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ°æ•°æ®æœ‰æ”¹å˜å‘¢?")])]),s._v(" "),t("p",[s._v("å›žç­”: è¿™å¯èƒ½æ˜¯å› ä¸º WAL æœºåˆ¶çš„åŽŸå› . update è¯­å¥æ‰§è¡Œå®ŒæˆåŽ, InnoDB åªä¿è¯å†™å®Œäº† redo log, å†…å­˜, å¯èƒ½è¿˜æ²¡æ¥å¾—åŠå°†æ•°æ®å†™åˆ°ç£ç›˜.")]),s._v(" "),t("blockquote",[t("p",[s._v("é—®é¢˜ 2: ä¸ºä»€ä¹ˆ binlog cache æ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±ç»´æŠ¤çš„, è€Œ redo log buffer æ˜¯å…¨å±€å…±ç”¨çš„?")])]),s._v(" "),t("p",[s._v("å›žç­”: MySQL è¿™ä¹ˆè®¾è®¡çš„ä¸»è¦åŽŸå› æ˜¯, "),t("strong",[s._v('binlog æ˜¯ä¸èƒ½"è¢«æ‰“æ–­çš„"')]),s._v(' . ä¸€ä¸ªäº‹åŠ¡çš„ binlog å¿…é¡»è¿žç»­å†™, å› æ­¤è¦æ•´ä¸ªäº‹åŠ¡å®ŒæˆåŽ, å†ä¸€èµ·å†™åˆ°æ–‡ä»¶é‡Œ. è€Œ redo log å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚, ä¸­é—´æœ‰ç”Ÿæˆçš„æ—¥å¿—å¯ä»¥å†™åˆ° redo log buffer ä¸­. redo log buffer ä¸­çš„å†…å®¹è¿˜èƒ½"æ­ä¾¿è½¦", å…¶ä»–äº‹åŠ¡æäº¤çš„æ—¶å€™å¯ä»¥'),t("strong",[s._v("è¢«ä¸€èµ·å†™åˆ°ç£ç›˜ä¸­")]),s._v(".")]),s._v(" "),t("blockquote",[t("p",[s._v("é—®é¢˜ 3: äº‹åŠ¡æ‰§è¡ŒæœŸé—´, è¿˜æ²¡åˆ°æäº¤é˜¶æ®µ, å¦‚æžœå‘ç”Ÿ crash çš„è¯, redo log è‚¯å®šä¸¢äº†, è¿™ä¼šä¸ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´å‘¢?")])]),s._v(" "),t("p",[s._v("å›žç­”: ä¸ä¼š. å› ä¸º"),t("strong",[s._v("è¿™æ—¶å€™ binlog ä¹Ÿè¿˜åœ¨ binlog cache é‡Œ, æ²¡å‘ç»™å¤‡åº“")]),s._v(". crash ä»¥åŽ redo log å’Œ binlog éƒ½æ²¡æœ‰äº†, ä»Žä¸šåŠ¡è§’åº¦çœ‹"),t("strong",[s._v("è¿™ä¸ªäº‹åŠ¡ä¹Ÿæ²¡æœ‰æäº¤, æ‰€ä»¥æ•°æ®æ˜¯ä¸€è‡´")]),s._v("çš„.")]),s._v(" "),t("blockquote",[t("p",[s._v("é—®é¢˜ 4: å¦‚æžœ binlog å†™å®Œç›˜ä»¥åŽå‘ç”Ÿ crash, è¿™æ—¶å€™è¿˜æ²¡ç»™å®¢æˆ·ç«¯ç­”å¤å°±é‡å¯äº†. ç­‰å®¢æˆ·ç«¯å†é‡è¿žè¿›æ¥, å‘çŽ°äº‹åŠ¡å·²ç»æäº¤æˆåŠŸäº†, è¿™æ˜¯ä¸æ˜¯ bug?")])]),s._v(" "),t("p",[s._v('å›žç­”: ä¸æ˜¯. å¯ä»¥è®¾æƒ³ä¸€ä¸‹æ›´æžç«¯çš„æƒ…å†µ, æ•´ä¸ªäº‹åŠ¡éƒ½æäº¤æˆåŠŸäº†, redo log commit å®Œæˆäº†, å¤‡åº“ä¹Ÿæ”¶åˆ° binlog å¹¶æ‰§è¡Œäº†. ä½†æ˜¯ä¸»åº“å’Œå®¢æˆ·ç«¯ç½‘ç»œæ–­å¼€äº†, å¯¼è‡´äº‹åŠ¡æˆåŠŸçš„åŒ…è¿”å›žä¸å›žåŽ», è¿™æ—¶å€™å®¢æˆ·ç«¯ä¹Ÿä¼šæ”¶åˆ°"ç½‘ç»œæ–­å¼€"çš„å¼‚å¸¸. è¿™ç§ä¹Ÿåªèƒ½ç®—æ˜¯äº‹åŠ¡æˆåŠŸçš„, ä¸èƒ½è®¤ä¸ºæ˜¯ bug.')]),s._v(" "),t("p",[s._v("å®žé™…ä¸Šæ•°æ®åº“çš„ crash-safe ä¿è¯çš„æ˜¯:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœå®¢æˆ·ç«¯æ”¶åˆ°äº‹åŠ¡æˆåŠŸçš„æ¶ˆæ¯, äº‹åŠ¡å°±ä¸€å®šæŒä¹…åŒ–äº†;")]),s._v(" "),t("li",[s._v("å¦‚æžœå®¢æˆ·ç«¯æ”¶åˆ°äº‹åŠ¡å¤±è´¥(æ¯”å¦‚ä¸»é”®å†²çª, å›žæ»šç­‰)çš„æ¶ˆæ¯, äº‹åŠ¡å°±ä¸€å®šå¤±è´¥äº†;")]),s._v(" "),t("li",[s._v('å¦‚æžœå®¢æˆ·ç«¯æ”¶åˆ°"æ‰§è¡Œå¼‚å¸¸"çš„æ¶ˆæ¯, åº”ç”¨éœ€è¦é‡è¿žåŽé€šè¿‡æŸ¥è¯¢å½“å‰çŠ¶æ€æ¥ç»§ç»­åŽç»­çš„é€»è¾‘. æ­¤æ—¶æ•°æ®åº“åªéœ€è¦ä¿è¯å†…éƒ¨(æ•°æ®å’Œæ—¥å¿—ä¹‹é—´, ä¸»åº“å’Œå¤‡åº“ä¹‹é—´)ä¸€è‡´å°±å¯ä»¥äº†.')])]),s._v(" "),t("h4",{attrs:{id:"_24-mysqlæ˜¯æ€Žä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_24-mysqlæ˜¯æ€Žä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„"}},[s._v("#")]),s._v(" 24-MySQLæ˜¯æ€Žä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„?")]),s._v(" "),t("p",[s._v("å¤§å®¶çŸ¥é“ binlog å¯ä»¥ç”¨æ¥"),t("strong",[s._v("å½’æ¡£")]),s._v(", ä¹Ÿå¯ä»¥ç”¨æ¥åš"),t("strong",[s._v("ä¸»å¤‡åŒæ­¥")]),s._v(", ä½†å®ƒçš„å†…å®¹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢? ä¸ºä»€ä¹ˆå¤‡åº“æ‰§è¡Œäº† binlog å°±å¯ä»¥è·Ÿä¸»åº“ä¿æŒä¸€è‡´äº†å‘¢? æœ¬èŠ‚å°±æ­£å¼ä»‹ç»ä¸€ä¸‹å®ƒ.")]),s._v(" "),t("p",[s._v("æ¯«ä¸å¤¸å¼ åœ°è¯´, "),t("strong",[s._v("MySQL èƒ½å¤Ÿæˆä¸ºçŽ°ä¸‹æœ€æµè¡Œçš„å¼€æºæ•°æ®åº“, binlog åŠŸä¸å¯æ²¡")]),s._v(". åœ¨æœ€å¼€å§‹, MySQL æ˜¯ä»¥å®¹æ˜“å­¦ä¹ å’Œæ–¹ä¾¿çš„é«˜å¯ç”¨æž¶æž„, è¢«å¼€å‘äººå‘˜é’ççš„. "),t("strong",[s._v("è€Œå®ƒçš„å‡ ä¹Žæ‰€æœ‰çš„é«˜å¯ç”¨æž¶æž„, éƒ½ç›´æŽ¥ä¾èµ–äºŽ binlog")]),s._v(". è™½ç„¶è¿™äº›é«˜å¯ç”¨æž¶æž„å·²ç»å‘ˆçŽ°å‡ºè¶Šæ¥è¶Šå¤æ‚çš„è¶‹åŠ¿, ä½†éƒ½æ˜¯ä»Žæœ€åŸºæœ¬çš„ä¸€ä¸»ä¸€å¤‡æ¼”åŒ–è¿‡æ¥çš„.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä¸»è¦ä»‹ç»"),t("strong",[s._v("ä¸»å¤‡çš„åŸºæœ¬åŽŸç†")]),s._v(". ç†è§£äº†èƒŒåŽçš„è®¾è®¡åŽŸç†, ä¹Ÿå¯ä»¥ä»Žä¸šåŠ¡å¼€å‘çš„è§’åº¦, æ¥å€Ÿé‰´è¿™äº›è®¾è®¡æ€æƒ³.")]),s._v(" "),t("h5",{attrs:{id:"mysqlä¸»å¤‡çš„åŸºæœ¬åŽŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqlä¸»å¤‡çš„åŸºæœ¬åŽŸç†"}},[s._v("#")]),s._v(" MySQLä¸»å¤‡çš„åŸºæœ¬åŽŸç†")]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤ºå°±æ˜¯åŸºæœ¬çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ba850a9829780c53f1c4e21537be61c7-20230731161914-6liyyd1.png",alt:"",title:"MySQLä¸»å¤‡åˆ‡æ¢æµç¨‹"}})]),s._v(" "),t("p",[t("strong",[s._v("åœ¨çŠ¶æ€ 1 ä¸­, å®¢æˆ·ç«¯çš„è¯»å†™éƒ½ç›´æŽ¥è®¿é—®èŠ‚ç‚¹ A, è€ŒèŠ‚ç‚¹ B æ˜¯ A çš„å¤‡åº“, åªæ˜¯å°† A çš„æ›´æ–°éƒ½åŒæ­¥è¿‡æ¥, åˆ°æœ¬åœ°æ‰§è¡Œ. è¿™æ ·å¯ä»¥ä¿æŒèŠ‚ç‚¹ B å’Œ A çš„æ•°æ®æ˜¯ç›¸åŒçš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“éœ€è¦åˆ‡æ¢çš„æ—¶å€™, å°±åˆ‡æˆçŠ¶æ€ 2. è¿™æ—¶å€™å®¢æˆ·ç«¯è¯»å†™è®¿é—®çš„éƒ½æ˜¯èŠ‚ç‚¹ B, è€ŒèŠ‚ç‚¹ A æ˜¯ B çš„å¤‡åº“.")]),s._v(" "),t("p",[s._v("åœ¨çŠ¶æ€ 1 ä¸­, è™½ç„¶èŠ‚ç‚¹ B æ²¡æœ‰è¢«ç›´æŽ¥è®¿é—®, ä½†æ˜¯ä¾ç„¶å»ºè®®æŠŠèŠ‚ç‚¹ B(ä¹Ÿå°±æ˜¯å¤‡åº“)è®¾ç½®æˆ"),t("strong",[s._v("åªè¯»(readonly)æ¨¡å¼")]),s._v(". è¿™æ ·åš, æœ‰ä»¥ä¸‹å‡ ä¸ªè€ƒè™‘:")]),s._v(" "),t("ol",[t("li",[s._v("æœ‰æ—¶å€™ä¸€äº›è¿è¥ç±»çš„æŸ¥è¯¢è¯­å¥ä¼šè¢«æ”¾åˆ°å¤‡åº“ä¸ŠåŽ»æŸ¥, è®¾ç½®ä¸ºåªè¯»å¯ä»¥é˜²æ­¢è¯¯æ“ä½œ;")]),s._v(" "),t("li",[s._v("é˜²æ­¢åˆ‡æ¢é€»è¾‘æœ‰ bug, æ¯”å¦‚åˆ‡æ¢è¿‡ç¨‹ä¸­å‡ºçŽ°åŒå†™, é€ æˆä¸»å¤‡ä¸ä¸€è‡´;")]),s._v(" "),t("li",[s._v("å¯ä»¥ç”¨ readonly çŠ¶æ€, æ¥åˆ¤æ–­èŠ‚ç‚¹çš„è§’è‰².")])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, æŠŠå¤‡åº“è®¾ç½®æˆåªè¯»äº†, è¿˜æ€Žä¹ˆè·Ÿä¸»åº“ä¿æŒåŒæ­¥æ›´æ–°å‘¢? è¿™ä¸ªé—®é¢˜ä¸ç”¨æ‹…å¿ƒ. "),t("strong",[s._v("å› ä¸º readonly è®¾ç½®å¯¹è¶…çº§ (super) æƒé™ç”¨æˆ·æ˜¯æ— æ•ˆçš„, è€Œç”¨äºŽåŒæ­¥æ›´æ–°çš„çº¿ç¨‹, å°±æ‹¥æœ‰è¶…çº§æƒé™")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹çœ‹"),t("strong",[s._v("èŠ‚ç‚¹ A åˆ° B è¿™æ¡çº¿çš„å†…éƒ¨æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„")]),s._v(". ä¸‹å›¾å°±æ˜¯ä¸€ä¸ª update è¯­å¥åœ¨èŠ‚ç‚¹ A æ‰§è¡Œ, ç„¶åŽåŒæ­¥åˆ°èŠ‚ç‚¹ B çš„å®Œæ•´æµç¨‹å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/02e08fa178a98082c56d6750b4008573-20230731161914-388fy2z.png",alt:"",title:"ä¸»å¤‡æµç¨‹å›¾"}})]),s._v(" "),t("p",[s._v("ä¸Šå›¾åŒ…å«äº†ä¸Šä¸€èŠ‚ä¸­è®²åˆ°çš„ binlog å’Œ redo log çš„å†™å…¥æœºåˆ¶ç›¸å…³çš„å†…å®¹, å¯ä»¥çœ‹åˆ°: "),t("mark",[t("strong",[s._v("ä¸»åº“æŽ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ›´æ–°è¯·æ±‚åŽ, æ‰§è¡Œå†…éƒ¨äº‹åŠ¡çš„æ›´æ–°é€»è¾‘, åŒæ—¶å†™ binlog")])]),s._v(".")]),s._v(" "),t("p",[s._v("å¤‡åº“ B è·Ÿä¸»åº“ A ä¹‹é—´ç»´æŒäº†ä¸€ä¸ª"),t("strong",[s._v("é•¿è¿žæŽ¥")]),s._v(". ä¸»åº“ A å†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹, ä¸“é—¨ç”¨äºŽæœåŠ¡å¤‡åº“ B çš„è¿™ä¸ªé•¿è¿žæŽ¥. "),t("mark",[t("strong",[s._v("ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹æ˜¯è¿™æ ·çš„")])]),s._v(":")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨å¤‡åº“ B ä¸Šé€šè¿‡ change master å‘½ä»¤, è®¾ç½®ä¸»åº“ A çš„ IP, ç«¯å£, ç”¨æˆ·å, å¯†ç , ä»¥åŠè¦ä»Žå“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚ binlog, è¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡.")]),s._v(" "),t("li",[s._v("åœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œ "),t("strong",[s._v("start slave å‘½ä»¤")]),s._v(", è¿™æ—¶å€™å¤‡åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹, å°±æ˜¯å›¾ä¸­çš„ "),t("strong",[s._v("io_thread")]),s._v(" å’Œ "),t("strong",[s._v("sql_thread")]),s._v(". å…¶ä¸­ io_thread è´Ÿè´£ä¸Žä¸»åº“å»ºç«‹è¿žæŽ¥.")]),s._v(" "),t("li",[s._v("ä¸»åº“ A æ ¡éªŒå®Œç”¨æˆ·å, å¯†ç åŽ, å¼€å§‹æŒ‰ç…§å¤‡åº“ B ä¼ è¿‡æ¥çš„ä½ç½®, "),t("strong",[s._v("ä»Žæœ¬åœ°è¯»å– binlog, å‘ç»™ B")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("å¤‡åº“ B æ‹¿åˆ° binlog åŽ, å†™åˆ°æœ¬åœ°æ–‡ä»¶, ç§°ä¸º")]),s._v("â€‹"),t("mark",[t("strong",[s._v("ä¸­è½¬æ—¥å¿—(relay log)")])]),s._v(" .")]),s._v(" "),t("li",[t("strong",[s._v("sql_thread è¯»å–ä¸­è½¬æ—¥å¿—, è§£æžå‡ºæ—¥å¿—é‡Œçš„å‘½ä»¤, å¹¶æ‰§è¡Œ")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦è¯´æ˜Ž, åŽæ¥ç”±äºŽå¤šçº¿ç¨‹å¤åˆ¶æ–¹æ¡ˆçš„å¼•å…¥, sql_thread æ¼”åŒ–æˆä¸ºäº†"),t("strong",[s._v("å¤šä¸ªçº¿ç¨‹")]),s._v(", è·Ÿæœ¬èŠ‚è¦ä»‹ç»çš„åŽŸç†æ²¡æœ‰ç›´æŽ¥å…³ç³», æš‚ä¸”ä¸å±•å¼€.")]),s._v(" "),t("p",[s._v("åˆ†æžå®Œäº†è¿™ä¸ªé•¿è¿žæŽ¥çš„é€»è¾‘, å†æ¥çœ‹ä¸€ä¸ªé—®é¢˜: "),t("strong",[s._v("binlog é‡Œé¢åˆ°åº•æ˜¯ä»€ä¹ˆå†…å®¹, ä¸ºä»€ä¹ˆå¤‡åº“æ‹¿è¿‡åŽ»å¯ä»¥ç›´æŽ¥æ‰§è¡Œ")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"binlogçš„ä¸‰ç§æ ¼å¼å¯¹æ¯”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#binlogçš„ä¸‰ç§æ ¼å¼å¯¹æ¯”"}},[s._v("#")]),s._v(" binlogçš„ä¸‰ç§æ ¼å¼å¯¹æ¯”")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°è¿‡ "),t("strong",[s._v("binlog æœ‰ä¸¤ç§æ ¼å¼, ä¸€ç§æ˜¯ statement, ä¸€ç§æ˜¯ row")]),s._v(". å¯èƒ½ä½ åœ¨å…¶ä»–èµ„æ–™ä¸Šè¿˜ä¼šçœ‹åˆ°æœ‰ç¬¬ä¸‰ç§æ ¼å¼, å«ä½œ "),t("strong",[s._v("mixed")]),s._v(", å…¶å®žå®ƒå°±æ˜¯å‰ä¸¤ç§æ ¼å¼çš„æ··åˆ.")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽæè¿° binlog çš„è¿™ä¸‰ç§æ ¼å¼é—´çš„åŒºåˆ«, æˆ‘åˆ›å»ºäº†ä¸€ä¸ªè¡¨, å¹¶åˆå§‹åŒ–å‡ è¡Œæ•°æ®.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURRENT_TIMESTAMP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-11-13'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-11-12'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-11-11'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-11-10'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-11-09'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("å¦‚æžœè¦åœ¨è¡¨ä¸­åˆ é™¤ä¸€è¡Œæ•°æ®çš„è¯, æ¥çœ‹çœ‹è¿™ä¸ª "),t("strong",[s._v("delete è¯­å¥çš„ binlog æ˜¯æ€Žä¹ˆè®°å½•")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("æ³¨æ„ä¸‹é¢è¿™ä¸ªè¯­å¥åŒ…å«æ³¨é‡Š, å¦‚æžœç”¨ MySQL å®¢æˆ·ç«¯æ¥åšè¿™ä¸ªå®žéªŒçš„è¯, è¦è®°å¾—åŠ  -c å‚æ•°, å¦åˆ™å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨åŽ»æŽ‰æ³¨é‡Š.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*comment*/")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t_modified"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-11-10'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("å½“ binlog_format=statement æ—¶, binlog é‡Œé¢è®°å½•çš„å°±æ˜¯ SQL è¯­å¥çš„åŽŸæ–‡")]),s._v(". å¯ä»¥ç”¨")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" binlog events "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'master.000001'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å‘½ä»¤çœ‹ binlog ä¸­çš„å†…å®¹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ed0920e51e54188c1a417e744c3b53b0-20230731161914-f4molaf.png",alt:"",title:"statement æ ¼å¼ binlog ç¤ºä¾‹"}})]),s._v(" "),t("p",[s._v("çŽ°åœ¨æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æžœ.")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€è¡Œ SET @@SESSION.GTID_NEXT='ANONYMOUS' å¯ä»¥å…ˆå¿½ç•¥, åŽé¢ä¼šåœ¨ä»‹ç»"),t("strong",[s._v("ä¸»å¤‡åˆ‡æ¢")]),s._v("çš„æ—¶å€™å†æåˆ°;")]),s._v(" "),t("li",[s._v("ç¬¬äºŒè¡Œæ˜¯ä¸€ä¸ª BEGIN, è·Ÿç¬¬å››è¡Œçš„ commit å¯¹åº”, è¡¨ç¤º"),t("strong",[s._v("ä¸­é—´æ˜¯ä¸€ä¸ªäº‹åŠ¡")]),s._v(";")]),s._v(" "),t("li",[s._v("ç¬¬ä¸‰è¡Œå°±æ˜¯"),t("strong",[s._v("çœŸå®žæ‰§è¡Œçš„è¯­å¥")]),s._v('äº†. å¯ä»¥çœ‹åˆ°, åœ¨çœŸå®žæ‰§è¡Œçš„ delete å‘½ä»¤ä¹‹å‰, è¿˜æœ‰ä¸€ä¸ª "'),t("code",[s._v("use 'test'")]),s._v('â€‹" å‘½ä»¤. è¿™æ¡å‘½ä»¤ä¸æ˜¯ä¸»åŠ¨æ‰§è¡Œçš„, è€Œæ˜¯ MySQL æ ¹æ®å½“å‰è¦æ“ä½œçš„è¡¨æ‰€åœ¨çš„æ•°æ®åº“, è‡ªè¡Œæ·»åŠ çš„. è¿™æ ·åšå¯ä»¥ä¿è¯æ—¥å¿—ä¼ åˆ°å¤‡åº“åŽ»æ‰§è¡Œçš„æ—¶å€™, ä¸è®ºå½“å‰çš„å·¥ä½œçº¿ç¨‹åœ¨å“ªä¸ªåº“é‡Œ, éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°æ›´æ–°åˆ° test åº“çš„è¡¨ t.\n'),t("code",[s._v("use 'test'")]),s._v('â€‹ å‘½ä»¤ä¹‹åŽçš„ delete è¯­å¥, å°±æ˜¯è¾“å…¥çš„ SQL åŽŸæ–‡äº†. å¯ä»¥çœ‹åˆ°, binlog "å¿ å®ž" åœ°è®°å½•äº† SQL å‘½ä»¤, ç”šè‡³è¿žæ³¨é‡Šä¹Ÿä¸€å¹¶è®°å½•äº†.')]),s._v(" "),t("li",[s._v("æœ€åŽä¸€è¡Œæ˜¯ä¸€ä¸ª COMMIT. å¯ä»¥çœ‹åˆ°é‡Œé¢å†™ç€ "),t("strong",[s._v("xid=61")]),s._v(".")])]),s._v(" "),t("p",[s._v("ä¸ºäº†è¯´æ˜Ž statement å’Œ row æ ¼å¼çš„åŒºåˆ«, æ¥çœ‹ä¸€ä¸‹è¿™æ¡ delete å‘½ä»¤çš„æ‰§è¡Œæ•ˆæžœå›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4d6cc6ac554aecfa6ebcfe2c7d42f2e3-20230731161914-uql0q6f.png",alt:""}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿è¡Œè¿™æ¡ delete å‘½ä»¤äº§ç”Ÿäº†ä¸€ä¸ª "),t("strong",[s._v("warning")]),s._v(", åŽŸå› æ˜¯å½“å‰ binlog è®¾ç½®çš„æ˜¯ statement æ ¼å¼, å¹¶ä¸”è¯­å¥ä¸­æœ‰ limit, æ‰€ä»¥è¿™ä¸ªå‘½ä»¤å¯èƒ½æ˜¯ "),t("strong",[s._v("unsafe")]),s._v(" çš„.")]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢? è¿™æ˜¯"),t("strong",[s._v("å› ä¸º delete å¸¦ limit, å¾ˆå¯èƒ½ä¼šå‡ºçŽ°ä¸»å¤‡æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ")]),s._v(". æ¯”å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœ delete è¯­å¥ä½¿ç”¨çš„æ˜¯ç´¢å¼• a, é‚£ä¹ˆä¼šæ ¹æ®ç´¢å¼• a æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è¡Œ, ä¹Ÿå°±æ˜¯è¯´åˆ é™¤çš„æ˜¯ a=4 è¿™ä¸€è¡Œ;")]),s._v(" "),t("li",[s._v("ä½†å¦‚æžœä½¿ç”¨çš„æ˜¯ç´¢å¼• t_modified, é‚£ä¹ˆåˆ é™¤çš„å°±æ˜¯ "),t("code",[s._v("t_modified='2018-11-09'")]),s._v("â€‹ ä¹Ÿå°±æ˜¯ a=5 è¿™ä¸€è¡Œ.")])]),s._v(" "),t("p",[s._v("ç”±äºŽ statement æ ¼å¼ä¸‹, è®°å½•åˆ° binlog é‡Œçš„æ˜¯"),t("strong",[s._v("è¯­å¥åŽŸæ–‡")]),s._v(", å› æ­¤å¯èƒ½ä¼šå‡ºçŽ°è¿™æ ·ä¸€ç§æƒ…å†µ: "),t("mark",[t("strong",[s._v("åœ¨ä¸»åº“æ‰§è¡Œè¿™æ¡ SQL è¯­å¥çš„æ—¶å€™, ç”¨çš„æ˜¯ç´¢å¼• a; è€Œåœ¨å¤‡åº“æ‰§è¡Œè¿™æ¡ SQL è¯­å¥çš„æ—¶å€™, å´ä½¿ç”¨äº†ç´¢å¼• t_modified")])]),s._v(". å› æ­¤, MySQL è®¤ä¸ºè¿™æ ·å†™æ˜¯æœ‰é£Žé™©çš„.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, å¦‚æžœæŠŠ binlog çš„æ ¼å¼æ”¹ä¸º "),t("code",[s._v("binlog_format='row'")]),s._v("â€‹, æ˜¯ä¸æ˜¯å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜äº†å‘¢? å…ˆæ¥çœ‹çœ‹è¿™æ—¶å€™ binog ä¸­çš„å†…å®¹å§.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e3799c35cdcf53ae1acd320f14b88c81-20230731161914-2avre0o.png",alt:""}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ä¸Ž statement æ ¼å¼çš„ binlog ç›¸æ¯”, å‰åŽçš„ BEGIN å’Œ COMMIT æ˜¯ä¸€æ ·çš„. ä½†æ˜¯, "),t("mark",[t("strong",[s._v("row æ ¼å¼çš„ binlog é‡Œæ²¡æœ‰äº† SQL è¯­å¥çš„åŽŸæ–‡, è€Œæ˜¯æ›¿æ¢æˆäº†ä¸¤ä¸ª event: Table_map å’Œ Delete_rows")])]),s._v(".")]),s._v(" "),t("ol",[t("li",[s._v("Table_map event, ç”¨äºŽè¯´æ˜ŽæŽ¥ä¸‹æ¥è¦æ“ä½œçš„è¡¨æ˜¯ test åº“çš„è¡¨ t;")]),s._v(" "),t("li",[s._v("Delete_rows event, ç”¨äºŽ"),t("strong",[s._v("å®šä¹‰åˆ é™¤çš„è¡Œä¸º")]),s._v(".")])]),s._v(" "),t("p",[s._v("å…¶å®žé€šè¿‡ä¸Šå›¾æ˜¯çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯çš„, è¿˜éœ€è¦å€ŸåŠ© "),t("strong",[s._v("mysqlbinlog")]),s._v(" å·¥å…·, ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤"),t("strong",[s._v("è§£æžå’ŒæŸ¥çœ‹ binlog ä¸­çš„å†…å®¹")]),s._v(". å› ä¸ºä¸Šå›¾çš„ä¿¡æ¯æ˜¾ç¤º, è¿™ä¸ª"),t("strong",[s._v("äº‹åŠ¡çš„ binlog æ˜¯ä»Ž 8900 è¿™ä¸ªä½ç½®å¼€å§‹")]),s._v("çš„, æ‰€ä»¥å¯ä»¥ç”¨ start-position å‚æ•°æ¥æŒ‡å®šä»Žè¿™ä¸ªä½ç½®çš„æ—¥å¿—å¼€å§‹è§£æž.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysqlbinlog  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vv "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--start-position=8900;")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/22d5830aba7a1cd8d62324e498e041c2-20230731161914-gh0bq29.png",alt:"",title:"row æ ¼å¼ binlog ç¤ºä¾‹çš„è¯¦ç»†ä¿¡æ¯"}})]),s._v(" "),t("p",[s._v("ä»Žè¿™ä¸ªå›¾ä¸­, å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªä¿¡æ¯:")]),s._v(" "),t("ul",[t("li",[s._v("server id 1, è¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡æ˜¯åœ¨ server_id=1 çš„è¿™ä¸ªåº“ä¸Šæ‰§è¡Œçš„.")]),s._v(" "),t("li",[s._v("æ¯ä¸ª event éƒ½æœ‰ CRC32 çš„å€¼, è¿™æ˜¯å› ä¸ºæŠŠå‚æ•° binlog_checksum è®¾ç½®æˆäº† CRC32.")]),s._v(" "),t("li",[s._v("Table_map event æ˜¾ç¤ºäº†æŽ¥ä¸‹æ¥è¦æ‰“å¼€çš„è¡¨, map åˆ°æ•°å­— 226. çŽ°åœ¨è¿™æ¡ SQL è¯­å¥åªæ“ä½œäº†ä¸€å¼ è¡¨, å¦‚æžœè¦æ“ä½œå¤šå¼ è¡¨å‘¢? æ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Table_map event, éƒ½ä¼š map åˆ°ä¸€ä¸ªå•ç‹¬çš„æ•°å­—, ç”¨äºŽåŒºåˆ†å¯¹ä¸åŒè¡¨çš„æ“ä½œ.")]),s._v(" "),t("li",[s._v("åœ¨ mysqlbinlog çš„å‘½ä»¤ä¸­, ä½¿ç”¨äº† -vv å‚æ•°æ˜¯ä¸ºäº†æŠŠå†…å®¹éƒ½è§£æžå‡ºæ¥, æ‰€ä»¥ä»Žç»“æžœé‡Œé¢å¯ä»¥çœ‹åˆ°å„ä¸ªå­—æ®µçš„å€¼(æ¯”å¦‚, @1=4, @2=4 è¿™äº›å€¼).")]),s._v(" "),t("li",[s._v("binlog_row_image çš„é»˜è®¤é…ç½®æ˜¯ "),t("strong",[s._v("FULL")]),s._v(", å› æ­¤ Delete_event é‡Œé¢, "),t("strong",[s._v("åŒ…å«äº†åˆ æŽ‰çš„è¡Œçš„æ‰€æœ‰å­—æ®µçš„å€¼")]),s._v(". å¦‚æžœæŠŠ binlog_row_image è®¾ç½®ä¸º MINIMAL, åˆ™åªä¼šè®°å½•å¿…è¦çš„ä¿¡æ¯, åœ¨è¿™ä¸ªä¾‹å­é‡Œ, å°±æ˜¯åªä¼šè®°å½• id=4 è¿™ä¸ªä¿¡æ¯.")]),s._v(" "),t("li",[s._v("æœ€åŽçš„ Xid event, ç”¨äºŽè¡¨ç¤ºäº‹åŠ¡"),t("strong",[s._v("è¢«æ­£ç¡®åœ°æäº¤")]),s._v("äº†.")])]),s._v(" "),t("p",[t("strong",[s._v("==å¯ä»¥çœ‹åˆ°, å½“ binlog_format ä½¿ç”¨ row æ ¼å¼çš„æ—¶å€™, binlog é‡Œé¢è®°å½•äº†çœŸå®žåˆ é™¤è¡Œçš„ä¸»é”® id, è¿™æ · binlog ä¼ åˆ°å¤‡åº“åŽ»çš„æ—¶å€™, å°±è‚¯å®šä¼šåˆ é™¤ id=4 çš„è¡Œ, ä¸ä¼šæœ‰ä¸»å¤‡åˆ é™¤ä¸åŒè¡Œçš„é—®é¢˜.==")])]),s._v(" "),t("h5",{attrs:{id:"ä¸ºä»€ä¹ˆä¼šæœ‰mixedæ ¼å¼çš„binlog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆä¼šæœ‰mixedæ ¼å¼çš„binlog"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆä¼šæœ‰mixedæ ¼å¼çš„binlog?")]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢çš„ä¿¡æ¯, æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜: **ä¸ºä»€ä¹ˆä¼šæœ‰ mixed è¿™ç§ binlog æ ¼å¼çš„å­˜åœ¨åœºæ™¯? ** æŽ¨è®ºè¿‡ç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å› ä¸ºæœ‰äº› statement æ ¼å¼çš„ binlog å¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´, æ‰€ä»¥è¦ä½¿ç”¨ row æ ¼å¼")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("ä½† row æ ¼å¼çš„ç¼ºç‚¹æ˜¯, å¾ˆå ç©ºé—´")]),s._v(". æ¯”å¦‚ç”¨ä¸€ä¸ª delete è¯­å¥åˆ æŽ‰ 10 ä¸‡è¡Œæ•°æ®, ç”¨ statement çš„è¯å°±æ˜¯ä¸€ä¸ª SQL è¯­å¥è¢«è®°å½•åˆ° binlog ä¸­, å ç”¨å‡ åä¸ªå­—èŠ‚çš„ç©ºé—´. ä½†å¦‚æžœç”¨ row æ ¼å¼çš„ binlog, å°±è¦æŠŠè¿™ 10 ä¸‡æ¡è®°å½•éƒ½å†™åˆ° binlog ä¸­. è¿™æ ·ä¸ä»…ä¼šå ç”¨æ›´å¤§çš„ç©ºé—´, åŒæ—¶å†™ binlog ä¹Ÿè¦è€—è´¹ IO èµ„æº, å½±å“æ‰§è¡Œé€Ÿåº¦.")]),s._v(" "),t("li",[s._v("æ‰€ä»¥, MySQL å°±å–äº†ä¸ªæŠ˜ä¸­æ–¹æ¡ˆ, ä¹Ÿå°±æ˜¯æœ‰äº† mixed æ ¼å¼çš„ binlog. mixed æ ¼å¼çš„æ„æ€æ˜¯, "),t("mark",[t("strong",[s._v("MySQL è‡ªå·±ä¼šåˆ¤æ–­è¿™æ¡ SQL è¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·ä¸»å¤‡ä¸ä¸€è‡´, å¦‚æžœæœ‰å¯èƒ½, å°±ç”¨ row æ ¼å¼, å¦åˆ™å°±ç”¨ statement æ ¼å¼")])]),s._v(".")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("mixed æ ¼å¼å¯ä»¥åˆ©ç”¨ statment æ ¼å¼çš„ä¼˜ç‚¹, åŒæ—¶åˆé¿å…äº†æ•°æ®ä¸ä¸€è‡´çš„é£Žé™©")]),s._v(". å› æ­¤, å¦‚æžœä½ çš„çº¿ä¸Š MySQL è®¾ç½®çš„ binlog æ ¼å¼æ˜¯ statement çš„è¯, é‚£åŸºæœ¬ä¸Šå°±å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸åˆç†çš„è®¾ç½®. ä½ è‡³å°‘åº”è¯¥æŠŠ binlog çš„æ ¼å¼è®¾ç½®ä¸º mixed.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚è¿™ä¸ªä¾‹å­, è®¾ç½®ä¸º mixed åŽ, å°±ä¼šè®°å½•ä¸º row æ ¼å¼; è€Œå¦‚æžœæ‰§è¡Œçš„è¯­å¥åŽ»æŽ‰ limit 1, å°±ä¼šè®°å½•ä¸º statement æ ¼å¼.")]),s._v(" "),t("p",[s._v("å½“ç„¶æˆ‘è¦è¯´çš„æ˜¯, "),t("mark",[t("strong",[s._v("çŽ°åœ¨è¶Šæ¥è¶Šå¤šçš„åœºæ™¯è¦æ±‚æŠŠ MySQL çš„ binlog æ ¼å¼è®¾ç½®æˆ row")])]),s._v(". è¿™ä¹ˆåšçš„ç†ç”±æœ‰å¾ˆå¤š, ä¸¾ä¸€ä¸ªå¯ä»¥ç›´æŽ¥çœ‹å‡ºæ¥çš„å¥½å¤„: "),t("strong",[s._v("æ¢å¤æ•°æ®")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, å°±"),t("strong",[s._v("åˆ†åˆ«ä»Ž delete, insert å’Œ update è¿™ä¸‰ç§ SQL è¯­å¥çš„è§’åº¦, æ¥çœ‹çœ‹æ•°æ®æ¢å¤çš„é—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("ä»Žå‰é¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥, å³ä½¿æ‰§è¡Œçš„æ˜¯ delete è¯­å¥, "),t("strong",[s._v("row æ ¼å¼çš„ binlog ä¹Ÿä¼šæŠŠè¢«åˆ æŽ‰çš„è¡Œçš„æ•´è¡Œä¿¡æ¯ä¿å­˜èµ·æ¥")]),s._v(". æ‰€ä»¥å¦‚æžœåœ¨æ‰§è¡Œå®Œä¸€æ¡ delete è¯­å¥ä»¥åŽ, "),t("strong",[s._v("å‘çŽ°åˆ é”™æ•°æ®äº†, å¯ä»¥ç›´æŽ¥æŠŠ binlog ä¸­è®°å½•çš„ delete è¯­å¥è½¬æˆ insert, æŠŠè¢«é”™åˆ çš„æ•°æ®æ’å…¥å›žåŽ»å°±å¯ä»¥æ¢å¤")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("å¦‚æžœæ˜¯æ‰§è¡Œé”™äº† insert è¯­å¥å‘¢? é‚£å°±æ›´ç›´æŽ¥äº†. row æ ¼å¼ä¸‹, insert è¯­å¥çš„ binlog é‡Œä¼šè®°å½•æ‰€æœ‰çš„å­—æ®µä¿¡æ¯, è¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥ç²¾ç¡®å®šä½åˆšåˆšè¢«æ’å…¥çš„é‚£ä¸€è¡Œ. è¿™æ—¶ç›´æŽ¥æŠŠ insert è¯­å¥è½¬æˆ delete è¯­å¥, åˆ é™¤æŽ‰è¿™è¢«è¯¯æ’å…¥çš„ä¸€è¡Œæ•°æ®å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("å¦‚æžœæ‰§è¡Œçš„æ˜¯ update è¯­å¥çš„è¯, "),t("strong",[s._v("binlog é‡Œé¢ä¼šè®°å½•ä¿®æ”¹å‰æ•´è¡Œçš„æ•°æ®å’Œä¿®æ”¹åŽçš„æ•´è¡Œæ•°æ®")]),s._v(". æ‰€ä»¥å¦‚æžœè¯¯æ‰§è¡Œäº† update è¯­å¥çš„è¯, åªéœ€è¦æŠŠè¿™ä¸ª event "),t("strong",[s._v("å‰åŽçš„ä¸¤è¡Œä¿¡æ¯å¯¹è°ƒä¸€ä¸‹")]),s._v(", å†åŽ»æ•°æ®åº“é‡Œé¢æ‰§è¡Œ, å°±èƒ½æ¢å¤è¿™ä¸ªæ›´æ–°æ“ä½œäº†.")]),s._v(" "),t("p",[s._v("å…¶å®ž, ç”± delete, insert æˆ–è€… update è¯­å¥å¯¼è‡´çš„æ•°æ®æ“ä½œé”™è¯¯, éœ€è¦æ¢å¤åˆ°æ“ä½œä¹‹å‰çŠ¶æ€çš„æƒ…å†µ, ä¹Ÿæ—¶æœ‰å‘ç”Ÿ. MariaDB çš„ "),t("a",{attrs:{href:"https://mariadb.com/kb/en/library/flashback/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Flashback"),t("OutboundLink")],1),s._v(" å·¥å…·å°±æ˜¯åŸºäºŽä¸Šé¢ä»‹ç»çš„åŽŸç†æ¥å›žæ»šæ•°æ®çš„.")]),s._v(" "),t("p",[s._v("è™½ç„¶ mixed æ ¼å¼çš„ binlog çŽ°åœ¨å·²ç»ç”¨å¾—ä¸å¤šäº†, ä½†è¿™é‡Œè¿˜æ˜¯è¦å†å€Ÿç”¨ä¸€ä¸‹ mixed æ ¼å¼æ¥è¯´æ˜Žä¸€ä¸ªé—®é¢˜, æ¥çœ‹ä¸€ä¸‹è¿™æ¡ SQL è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æžœæŠŠ binlog æ ¼å¼è®¾ç½®ä¸º mixed, ä½ è§‰å¾— MySQL ä¼šæŠŠå®ƒè®°å½•ä¸º row æ ¼å¼è¿˜æ˜¯ statement æ ¼å¼å‘¢?")]),s._v(" "),t("p",[s._v("å…ˆä¸è¦ç€æ€¥è¯´ç»“æžœ, ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¿™æ¡è¯­å¥æ‰§è¡Œçš„æ•ˆæžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d8b2492f31a78df98039addefa8fe232-20230731161914-15h0a9r.png",alt:"",title:"mixed æ ¼å¼å’Œ now()"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, MySQL ç”¨çš„å±…ç„¶æ˜¯ statement æ ¼å¼. ä½ ä¸€å®šä¼šå¥‡æ€ª, å¦‚æžœè¿™ä¸ª binlog è¿‡äº† 1 åˆ†é’Ÿæ‰ä¼ ç»™å¤‡åº“çš„è¯, é‚£ä¸»å¤‡çš„æ•°æ®ä¸å°±ä¸ä¸€è‡´äº†å—?")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, å†ç”¨ mysqlbinlog å·¥å…·æ¥çœ‹çœ‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/9e200ab3a3e9a72d6438e0f9609662d7-20230731161914-ns5fc7m.png",alt:""}})]),s._v(" "),t("p",[s._v("ä»Žå›¾ä¸­çš„ç»“æžœå¯ä»¥çœ‹åˆ°, åŽŸæ¥ binlog åœ¨è®°å½• event çš„æ—¶å€™, å¤šè®°äº†ä¸€æ¡å‘½ä»¤: SET TIMESTAMP=1546103491. å®ƒç”¨ SET TIMESTAMP å‘½ä»¤çº¦å®šäº†æŽ¥ä¸‹æ¥çš„ now() å‡½æ•°çš„è¿”å›žæ—¶é—´.")]),s._v(" "),t("p",[s._v("å› æ­¤, ä¸è®ºè¿™ä¸ª binlog æ˜¯ 1 åˆ†é’Ÿä¹‹åŽè¢«å¤‡åº“æ‰§è¡Œ, è¿˜æ˜¯ 3 å¤©åŽç”¨æ¥æ¢å¤è¿™ä¸ªåº“çš„å¤‡ä»½, è¿™ä¸ª insert è¯­å¥æ’å…¥çš„è¡Œ, å€¼éƒ½æ˜¯å›ºå®šçš„. ä¹Ÿå°±æ˜¯è¯´, é€šè¿‡è¿™æ¡ SET TIMESTAMP å‘½ä»¤, MySQL å°±ç¡®ä¿äº†ä¸»å¤‡æ•°æ®çš„ä¸€è‡´æ€§.")]),s._v(" "),t("p",[s._v("ä¹‹å‰çœ‹è¿‡æœ‰äººåœ¨é‡æ”¾ binlog æ•°æ®çš„æ—¶å€™, æ˜¯è¿™ä¹ˆåšçš„: ç”¨ mysqlbinlog è§£æžå‡ºæ—¥å¿—, ç„¶åŽæŠŠé‡Œé¢çš„ statement è¯­å¥ç›´æŽ¥æ‹·è´å‡ºæ¥æ‰§è¡Œ. æ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯æœ‰é£Žé™©çš„. "),t("strong",[s._v("å› ä¸ºæœ‰äº›è¯­å¥çš„æ‰§è¡Œç»“æžœæ˜¯ä¾èµ–äºŽä¸Šä¸‹æ–‡å‘½ä»¤çš„, ç›´æŽ¥æ‰§è¡Œçš„ç»“æžœå¾ˆå¯èƒ½æ˜¯é”™è¯¯çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, "),t("strong",[s._v("ç”¨ binlog æ¥æ¢å¤æ•°æ®çš„æ ‡å‡†åšæ³•æ˜¯, ç”¨ mysqlbinlog å·¥å…·è§£æžå‡ºæ¥, ç„¶åŽæŠŠè§£æžç»“æžœæ•´ä¸ªå‘ç»™ MySQL æ‰§è¡Œ")]),s._v(". ç±»ä¼¼ä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysqlbinlog master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--start-position=2738 --stop-position=2973 | mysql -h127.0.0.1 -P13000 -u$user -p$pwd;")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯, å°† master.000001 æ–‡ä»¶é‡Œé¢ä»Žç¬¬ 2738 å­—èŠ‚åˆ°ç¬¬ 2973 å­—èŠ‚"),t("strong",[s._v("ä¸­é—´è¿™æ®µå†…å®¹")]),s._v("è§£æžå‡ºæ¥, æ”¾åˆ° MySQL åŽ»æ‰§è¡Œ.")]),s._v(" "),t("h5",{attrs:{id:"å¾ªçŽ¯å¤åˆ¶é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¾ªçŽ¯å¤åˆ¶é—®é¢˜"}},[s._v("#")]),s._v(" å¾ªçŽ¯å¤åˆ¶é—®é¢˜")]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šé¢å¯¹ MySQL ä¸­ binlog åŸºæœ¬å†…å®¹çš„ç†è§£, çŽ°åœ¨å¯ä»¥çŸ¥é“, binlog çš„ç‰¹æ€§ç¡®ä¿äº†åœ¨å¤‡åº“æ‰§è¡Œç›¸åŒçš„ binlog, å¯ä»¥å¾—åˆ°ä¸Žä¸»åº“ç›¸åŒçš„çŠ¶æ€. å› æ­¤, å¯ä»¥è®¤ä¸ºæ­£å¸¸æƒ…å†µä¸‹ä¸»å¤‡çš„æ•°æ®æ˜¯ä¸€è‡´çš„.")]),s._v(" "),t("p",[s._v("å®žé™…ç”Ÿäº§ä¸Šä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯"),t("strong",[s._v("åŒ M ç»“æž„")]),s._v(", ä¹Ÿå°±æ˜¯ä¸‹å›¾æ‰€ç¤ºçš„ä¸»å¤‡åˆ‡æ¢æµç¨‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/fc9bf8f40de800339f126b2dc3cb57d7-20230731161914-67o9awr.png",alt:"",title:"MySQL ä¸»å¤‡åˆ‡æ¢æµç¨‹-åŒMç»“æž„"}})]),s._v(" "),t("p",[s._v("å¯¹æ¯”åŒ M ç»“æž„ä¸Žä¹‹å‰çš„ç»“æž„, å¯ä»¥å‘çŽ°, åŒ M ç»“æž„å’Œ M-S ç»“æž„, å…¶å®žåŒºåˆ«åªæ˜¯å¤šäº†ä¸€æ¡çº¿, å³: "),t("strong",[s._v("èŠ‚ç‚¹ A å’Œ B ä¹‹é—´æ€»æ˜¯äº’ä¸ºä¸»å¤‡å…³ç³». è¿™æ ·åœ¨åˆ‡æ¢çš„æ—¶å€™å°±ä¸ç”¨å†ä¿®æ”¹ä¸»å¤‡å…³ç³»")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, åŒ M ç»“æž„è¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³.")]),s._v(" "),t("p",[s._v("ä¸šåŠ¡é€»è¾‘åœ¨èŠ‚ç‚¹ A ä¸Šæ›´æ–°äº†ä¸€æ¡è¯­å¥, ç„¶åŽå†æŠŠç”Ÿæˆçš„ binlog å‘ç»™èŠ‚ç‚¹ B, èŠ‚ç‚¹ B æ‰§è¡Œå®Œè¿™æ¡æ›´æ–°è¯­å¥åŽä¹Ÿä¼šç”Ÿæˆ binlog. (å»ºè®®æŠŠå‚æ•° log_slave_updates è®¾ç½®ä¸º on, è¡¨ç¤ºå¤‡åº“æ‰§è¡Œ relay log åŽç”Ÿæˆ binlog).")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, "),t("strong",[s._v("å¦‚æžœèŠ‚ç‚¹ A åŒæ—¶æ˜¯èŠ‚ç‚¹ B çš„å¤‡åº“, ç›¸å½“äºŽåˆæŠŠèŠ‚ç‚¹ B æ–°ç”Ÿæˆçš„ binlog æ‹¿è¿‡æ¥æ‰§è¡Œäº†ä¸€æ¬¡, ç„¶åŽèŠ‚ç‚¹ A å’Œ B é—´, ä¼šä¸æ–­åœ°å¾ªçŽ¯æ‰§è¡Œè¿™ä¸ªæ›´æ–°è¯­å¥, ä¹Ÿå°±æ˜¯å¾ªçŽ¯å¤åˆ¶äº†")]),s._v(". è¿™ä¸ªè¦æ€Žä¹ˆè§£å†³å‘¢?")]),s._v(" "),t("p",[s._v("ä»Žå‰é¢å¯çŸ¥, MySQL åœ¨ binlog ä¸­"),t("strong",[s._v("è®°å½•äº†è¿™ä¸ªå‘½ä»¤ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶æ‰€åœ¨å®žä¾‹çš„ server id")]),s._v(". å› æ­¤å¯ä»¥ç”¨ä¸‹é¢çš„é€»è¾‘, æ¥è§£å†³ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„å¾ªçŽ¯å¤åˆ¶çš„é—®é¢˜:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("è§„å®šä¸¤ä¸ªåº“çš„ server id å¿…é¡»ä¸åŒ, å¦‚æžœç›¸åŒ, åˆ™å®ƒä»¬ä¹‹é—´ä¸èƒ½è®¾å®šä¸ºä¸»å¤‡å…³ç³»;")])]),s._v(" "),t("li",[t("strong",[s._v("ä¸€ä¸ªå¤‡åº“æŽ¥åˆ° binlog å¹¶åœ¨é‡æ”¾çš„è¿‡ç¨‹ä¸­, ç”Ÿæˆä¸ŽåŽŸ binlog çš„ server id ç›¸åŒçš„æ–°çš„ binlog;")])]),s._v(" "),t("li",[t("strong",[s._v("æ¯ä¸ªåº“åœ¨æ”¶åˆ°ä»Žè‡ªå·±çš„ä¸»åº“å‘è¿‡æ¥çš„æ—¥å¿—åŽ, å…ˆåˆ¤æ–­ server id, å¦‚æžœè·Ÿè‡ªå·±çš„ç›¸åŒ, è¡¨ç¤ºè¿™ä¸ªæ—¥å¿—æ˜¯è‡ªå·±ç”Ÿæˆçš„, å°±ç›´æŽ¥ä¸¢å¼ƒè¿™ä¸ªæ—¥å¿—.")])])]),s._v(" "),t("p",[s._v("æŒ‰ç…§è¿™ä¸ªé€»è¾‘, å¦‚æžœè®¾ç½®äº†åŒ M ç»“æž„, æ—¥å¿—çš„æ‰§è¡Œæµå°±ä¼šå˜æˆè¿™æ ·:")]),s._v(" "),t("ol",[t("li",[s._v("ä»ŽèŠ‚ç‚¹ A æ›´æ–°çš„äº‹åŠ¡, binlog é‡Œé¢è®°çš„éƒ½æ˜¯ A çš„ server id;")]),s._v(" "),t("li",[s._v("ä¼ åˆ°èŠ‚ç‚¹ B æ‰§è¡Œä¸€æ¬¡ä»¥åŽ, èŠ‚ç‚¹ B ç”Ÿæˆçš„ binlog çš„ server id ä¹Ÿæ˜¯ A çš„ server id;")]),s._v(" "),t("li",[s._v("å†ä¼ å›žç»™èŠ‚ç‚¹ A, A åˆ¤æ–­åˆ°è¿™ä¸ª server id ä¸Žè‡ªå·±çš„ç›¸åŒ, å°±ä¸ä¼šå†å¤„ç†è¿™ä¸ªæ—¥å¿—. æ‰€ä»¥æ­»å¾ªçŽ¯åœ¨è¿™é‡Œå°±æ–­æŽ‰äº†.")])]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-23"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-23"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL binlog çš„æ ¼å¼å’Œä¸€äº›åŸºæœ¬æœºåˆ¶, è¿™æ˜¯åŽé¢è¦ä»‹ç»çš„è¯»å†™åˆ†ç¦»ç­‰ç³»åˆ—æ–‡ç« çš„èƒŒæ™¯çŸ¥è¯†.")]),s._v(" "),t("p",[t("strong",[s._v("binlog åœ¨ MySQL çš„å„ç§é«˜å¯ç”¨æ–¹æ¡ˆä¸Šæ‰®æ¼”äº†é‡è¦è§’è‰²")]),s._v(". æœ¬èŠ‚ä»‹ç»çš„å¯ä»¥è¯´æ˜¯æ‰€æœ‰ MySQL é«˜å¯ç”¨æ–¹æ¡ˆçš„åŸºç¡€. åœ¨è¿™ä¹‹ä¸Šæ¼”åŒ–å‡ºäº†è¯¸å¦‚"),t("strong",[s._v("å¤šèŠ‚ç‚¹, åŠåŒæ­¥, MySQL group replication")]),s._v(" ç­‰ç›¸å¯¹å¤æ‚çš„æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚è¿˜ä»‹ç»äº† MySQL ä¸åŒæ ¼å¼ binlog çš„ä¼˜ç¼ºç‚¹, å’Œè®¾è®¡è€…çš„æ€è€ƒ. å¸Œæœ›ä½ åœ¨åšç³»ç»Ÿå¼€å‘æ—¶å€™, ä¹Ÿèƒ½å€Ÿé‰´è¿™äº›è®¾è®¡æ€æƒ³.")]),s._v(" "),t("p",[s._v("è¯´åˆ°å¾ªçŽ¯å¤åˆ¶é—®é¢˜çš„æ—¶å€™, æˆ‘ä»¬è¯´ MySQL é€šè¿‡åˆ¤æ–­ server id çš„æ–¹å¼, æ–­æŽ‰æ­»å¾ªçŽ¯. ä½†æ˜¯, è¿™ä¸ªæœºåˆ¶å…¶å®žå¹¶ä¸å®Œå¤‡, åœ¨æŸäº›åœºæ™¯ä¸‹, è¿˜æ˜¯æœ‰å¯èƒ½å‡ºçŽ°æ­»å¾ªçŽ¯. ä½ èƒ½æž„é€ å‡ºä¸€ä¸ªè¿™æ ·çš„åœºæ™¯å—? åˆåº”è¯¥æ€Žä¹ˆè§£å†³å‘¢?")]),s._v(" "),t("p",[s._v("ä¸€ç§åœºæ™¯æ˜¯, åœ¨ä¸€ä¸ªä¸»åº“æ›´æ–°äº‹åŠ¡åŽ, ç”¨å‘½ä»¤ set global server_id=x "),t("strong",[s._v("ä¿®æ”¹äº† server_id")]),s._v(". ç­‰æ—¥å¿—å†ä¼ å›žæ¥çš„æ—¶å€™, å‘çŽ° server_id è·Ÿè‡ªå·±çš„ server_id ä¸åŒ, å°±åªèƒ½æ‰§è¡Œäº†.")]),s._v(" "),t("p",[s._v("å¦ä¸€ç§åœºæ™¯æ˜¯, æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„æ—¶å€™, å¦‚ä¸‹å›¾æ‰€ç¤º, trx1 æ˜¯åœ¨èŠ‚ç‚¹ B æ‰§è¡Œçš„, å› æ­¤ binlog ä¸Šçš„ server_id å°±æ˜¯ B, binlog ä¼ ç»™èŠ‚ç‚¹ A, ç„¶åŽ A å’Œ Aâ€™ æ­å»ºäº†åŒ M ç»“æž„, å°±ä¼šå‡ºçŽ°å¾ªçŽ¯å¤åˆ¶.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/45382f8d83831edcd5e04f67112e6c2c-20230731161914-cb8xmjq.png",alt:"",title:"ä¸‰èŠ‚ç‚¹å¾ªçŽ¯å¤åˆ¶"}})]),s._v(" "),t("p",[s._v("è¿™ç§ä¸‰èŠ‚ç‚¹å¤åˆ¶çš„åœºæ™¯, åš"),t("strong",[s._v("æ•°æ®åº“è¿ç§»")]),s._v("çš„æ—¶å€™ä¼šå‡ºçŽ°.")]),s._v(" "),t("p",[s._v("å¦‚æžœå‡ºçŽ°äº†å¾ªçŽ¯å¤åˆ¶, å¯ä»¥åœ¨ A æˆ–è€… Aâ€™ ä¸Š, æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("stop slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \nCHANGE MASTER "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" IGNORE_SERVER_IDS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server_id_of_B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™æ ·è¿™ä¸ªèŠ‚ç‚¹æ”¶åˆ°æ—¥å¿—åŽå°±ä¸ä¼šå†æ‰§è¡Œ. è¿‡ä¸€æ®µæ—¶é—´åŽ, å†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŠŠè¿™ä¸ªå€¼æ”¹å›žæ¥.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("stop slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \nCHANGE MASTER "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" IGNORE_SERVER_IDS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"_25-mysqlæ˜¯æ€Žä¹ˆä¿è¯é«˜å¯ç”¨çš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_25-mysqlæ˜¯æ€Žä¹ˆä¿è¯é«˜å¯ç”¨çš„"}},[s._v("#")]),s._v(" 25-MySQLæ˜¯æ€Žä¹ˆä¿è¯é«˜å¯ç”¨çš„?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚ä»‹ç»äº† binlog çš„åŸºæœ¬å†…å®¹, "),t("strong",[s._v("åœ¨ä¸€ä¸ªä¸»å¤‡å…³ç³»ä¸­, æ¯ä¸ªå¤‡åº“æŽ¥æ”¶ä¸»åº“çš„ binlog å¹¶æ‰§è¡Œ")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("æ­£å¸¸æƒ…å†µä¸‹, åªè¦ä¸»åº“æ‰§è¡Œæ›´æ–°ç”Ÿæˆçš„æ‰€æœ‰ binlog, éƒ½å¯ä»¥ä¼ åˆ°å¤‡åº“å¹¶è¢«æ­£ç¡®åœ°æ‰§è¡Œ, å¤‡åº“å°±èƒ½è¾¾åˆ°è·Ÿä¸»åº“ä¸€è‡´çš„çŠ¶æ€, è¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´æ€§.")])]),s._v(" "),t("p",[s._v("ä½†æ˜¯, MySQL "),t("strong",[s._v("è¦æä¾›é«˜å¯ç”¨èƒ½åŠ›, åªæœ‰æœ€ç»ˆä¸€è‡´æ€§æ˜¯ä¸å¤Ÿçš„")]),s._v(". ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢? æœ¬èŠ‚å°±ç€é‡åˆ†æžä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("è¿™é‡Œ,å†æ”¾ä¸€æ¬¡ä¸Šä¸€èŠ‚ä¸­è®²åˆ°çš„åŒ M ç»“æž„çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3c51021bb7a908bc3e8cc4b95edfdcf2-20230731161914-rk0k7mt.png",alt:"",title:"MySQLä¸»å¤‡åˆ‡æ¢æµç¨‹-åŒMç»“æž„"}})]),s._v(" "),t("h5",{attrs:{id:"ä¸»å¤‡å»¶è¿Ÿ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»å¤‡å»¶è¿Ÿ"}},[s._v("#")]),s._v(" ä¸»å¤‡å»¶è¿Ÿ")]),s._v(" "),t("p",[t("strong",[s._v("ä¸»å¤‡åˆ‡æ¢")]),s._v("å¯èƒ½æ˜¯ä¸€ä¸ªä¸»åŠ¨è¿ç»´åŠ¨ä½œ, æ¯”å¦‚è½¯ä»¶å‡çº§, ä¸»åº“æ‰€åœ¨æœºå™¨æŒ‰è®¡åˆ’ä¸‹çº¿ç­‰, ä¹Ÿå¯èƒ½æ˜¯è¢«åŠ¨æ“ä½œ, æ¯”å¦‚ä¸»åº“æ‰€åœ¨æœºå™¨æŽ‰ç”µ.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, å…ˆä¸€èµ·çœ‹çœ‹ä¸»åŠ¨åˆ‡æ¢çš„åœºæ™¯.")]),s._v(" "),t("p",[s._v('åœ¨ä»‹ç»ä¸»åŠ¨åˆ‡æ¢æµç¨‹çš„è¯¦ç»†æ­¥éª¤ä¹‹å‰, è¦å…ˆè·Ÿè¯´æ˜Žä¸€ä¸ªæ¦‚å¿µ, å³"'),t("mark",[t("strong",[s._v("åŒæ­¥å»¶è¿Ÿ")])]),s._v('". ä¸Žæ•°æ®åŒæ­¥æœ‰å…³çš„æ—¶é—´ç‚¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ª:')]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä¸»åº“ A æ‰§è¡Œå®Œæˆä¸€ä¸ªäº‹åŠ¡, å†™å…¥ binlog, æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸º T1;")])]),s._v(" "),t("li",[t("strong",[s._v("ä¹‹åŽä¼ ç»™å¤‡åº“ B, æŠŠå¤‡åº“ B æŽ¥æ”¶å®Œè¿™ä¸ª binlog çš„æ—¶åˆ»è®°ä¸º T2;")])]),s._v(" "),t("li",[t("strong",[s._v("å¤‡åº“ B æ‰§è¡Œå®Œæˆè¿™ä¸ªäº‹åŠ¡, æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸º T3.")])])]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("æ‰€è°“ä¸»å¤‡å»¶è¿Ÿ, å°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡, åœ¨å¤‡åº“æ‰§è¡Œå®Œæˆçš„æ—¶é—´å’Œä¸»åº“æ‰§è¡Œå®Œæˆçš„æ—¶é—´ä¹‹é—´çš„å·®å€¼, ä¹Ÿå°±æ˜¯ T3-T1")])]),s._v(".")]),s._v(" "),t("p",[s._v("å¯ä»¥åœ¨å¤‡åº“ä¸Šæ‰§è¡Œ "),t("code",[s._v("show slave status")]),s._v("â€‹ å‘½ä»¤, å®ƒçš„è¿”å›žç»“æžœé‡Œé¢ä¼šæ˜¾ç¤º "),t("strong",[s._v("seconds_behind_master")]),s._v(", ç”¨äºŽè¡¨ç¤º"),t("strong",[s._v("å½“å‰å¤‡åº“å»¶è¿Ÿäº†å¤šå°‘ç§’")]),s._v(".")]),s._v(" "),t("p",[s._v("seconds_behind_master çš„è®¡ç®—æ–¹æ³•æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("æ¯ä¸ªäº‹åŠ¡çš„ binlog é‡Œé¢éƒ½æœ‰ä¸€ä¸ªæ—¶é—´å­—æ®µ, ç”¨äºŽ"),t("strong",[s._v("è®°å½•ä¸»åº“ä¸Šå†™å…¥çš„æ—¶é—´")]),s._v(";")]),s._v(" "),t("li",[s._v("å¤‡åº“å–å‡º"),t("strong",[s._v("å½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡çš„æ—¶é—´å­—æ®µçš„å€¼")]),s._v(", è®¡ç®—å®ƒä¸Žå½“å‰ç³»ç»Ÿæ—¶é—´çš„å·®å€¼, å¾—åˆ° seconds_behind_master.")])]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, å…¶å®ž seconds_behind_master è¿™ä¸ªå‚æ•°è®¡ç®—çš„å°±æ˜¯ T3-T1. æ‰€ä»¥å¯ä»¥ç”¨ "),t("strong",[s._v("seconds_behind_master æ¥ä½œä¸ºä¸»å¤‡å»¶è¿Ÿçš„å€¼, è¿™ä¸ªå€¼çš„æ—¶é—´ç²¾åº¦æ˜¯ç§’")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, å¦‚æžœä¸»å¤‡åº“æœºå™¨çš„ç³»ç»Ÿæ—¶é—´è®¾ç½®ä¸ä¸€è‡´, ä¼šä¸ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„å€¼ä¸å‡†?")]),s._v(" "),t("p",[s._v("å…¶å®žä¸ä¼šçš„. å› ä¸ºå¤‡åº“è¿žæŽ¥åˆ°ä¸»åº“çš„æ—¶å€™, ä¼šé€šè¿‡æ‰§è¡Œ SELECT UNIX_TIMESTAMP() å‡½æ•°æ¥èŽ·å¾—å½“å‰ä¸»åº“çš„ç³»ç»Ÿæ—¶é—´. å¦‚æžœè¿™æ—¶å€™å‘çŽ°ä¸»åº“çš„ç³»ç»Ÿæ—¶é—´ä¸Žè‡ªå·±ä¸ä¸€è‡´, å¤‡åº“åœ¨æ‰§è¡Œ seconds_behind_master è®¡ç®—çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰£æŽ‰è¿™ä¸ªå·®å€¼.")]),s._v(" "),t("p",[s._v("éœ€è¦è¯´æ˜Žçš„æ˜¯, åœ¨ç½‘ç»œæ­£å¸¸çš„æ—¶å€™, æ—¥å¿—ä»Žä¸»åº“ä¼ ç»™å¤‡åº“æ‰€éœ€çš„æ—¶é—´æ˜¯å¾ˆçŸ­çš„, å³ T2-T1 çš„å€¼æ˜¯éžå¸¸å°çš„. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("ç½‘ç»œæ­£å¸¸æƒ…å†µä¸‹, ä¸»å¤‡å»¶è¿Ÿçš„ä¸»è¦æ¥æºæ˜¯å¤‡åº“æŽ¥æ”¶å®Œ binlog å’Œæ‰§è¡Œå®Œè¿™ä¸ªäº‹åŠ¡ä¹‹é—´çš„æ—¶é—´å·®")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¯´, "),t("strong",[s._v("ä¸»å¤‡å»¶è¿Ÿæœ€ç›´æŽ¥çš„è¡¨çŽ°æ˜¯, å¤‡åº“æ¶ˆè´¹ä¸­è½¬æ—¥å¿—(relay log)çš„é€Ÿåº¦, æ¯”ä¸»åº“ç”Ÿäº§ binlog çš„é€Ÿåº¦è¦æ…¢")]),s._v(". æŽ¥ä¸‹æ¥å°±ä¸€èµ·åˆ†æžä¸‹, è¿™å¯èƒ½æ˜¯ç”±å“ªäº›åŽŸå› å¯¼è‡´çš„.")]),s._v(" "),t("h5",{attrs:{id:"ä¸»å¤‡å»¶è¿Ÿçš„æ¥æº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»å¤‡å»¶è¿Ÿçš„æ¥æº"}},[s._v("#")]),s._v(" ä¸»å¤‡å»¶è¿Ÿçš„æ¥æº")]),s._v(" "),t("p",[s._v("**é¦–å…ˆ, æœ‰äº›éƒ¨ç½²æ¡ä»¶ä¸‹, å¤‡åº“æ‰€åœ¨æœºå™¨çš„æ€§èƒ½è¦æ¯”ä¸»åº“æ‰€åœ¨çš„æœºå™¨æ€§èƒ½å·®. **")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬æƒ…å†µä¸‹, æœ‰äººè¿™ä¹ˆéƒ¨ç½²æ—¶çš„æƒ³æ³•æ˜¯, åæ­£å¤‡åº“æ²¡æœ‰è¯·æ±‚, æ‰€ä»¥å¯ä»¥ç”¨å·®ä¸€ç‚¹å„¿çš„æœºå™¨. æˆ–è€…ä¼šæŠŠ 20 ä¸ªä¸»åº“æ”¾åœ¨ 4 å°æœºå™¨ä¸Š, è€ŒæŠŠå¤‡åº“é›†ä¸­åœ¨ä¸€å°æœºå™¨ä¸Š.")]),s._v(" "),t("p",[s._v("å…¶å®ž"),t("strong",[s._v("æ›´æ–°è¯·æ±‚å¯¹ IOPS çš„åŽ‹åŠ›, åœ¨ä¸»åº“å’Œå¤‡åº“ä¸Šæ˜¯æ— å·®åˆ«")]),s._v('çš„. æ‰€ä»¥, åšè¿™ç§éƒ¨ç½²æ—¶, ä¸€èˆ¬éƒ½ä¼šå°†å¤‡åº“è®¾ç½®ä¸º "éžåŒ 1" çš„æ¨¡å¼.')]),s._v(" "),t("p",[t("strong",[s._v("ä½†å®žé™…ä¸Š, æ›´æ–°è¿‡ç¨‹ä¸­ä¹Ÿä¼šè§¦å‘å¤§é‡çš„è¯»æ“ä½œ. æ‰€ä»¥å½“å¤‡åº“ä¸»æœºä¸Šçš„å¤šä¸ªå¤‡åº“éƒ½åœ¨äº‰æŠ¢èµ„æºçš„æ—¶å€™, å°±å¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿäº†")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶, è¿™ç§éƒ¨ç½²çŽ°åœ¨æ¯”è¾ƒå°‘äº†. å› ä¸ºä¸»å¤‡å¯èƒ½å‘ç”Ÿåˆ‡æ¢, å¤‡åº“éšæ—¶å¯èƒ½å˜æˆä¸»åº“, æ‰€ä»¥ä¸»å¤‡åº“é€‰ç”¨ç›¸åŒè§„æ ¼çš„æœºå™¨, å¹¶ä¸”åšå¯¹ç§°éƒ¨ç½², æ˜¯çŽ°åœ¨æ¯”è¾ƒå¸¸è§çš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("è¿½é—® 1: åšäº†å¯¹ç§°éƒ¨ç½²ä»¥åŽ, è¿˜å¯èƒ½ä¼šæœ‰å»¶è¿Ÿ. è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("è¿™å°±æ˜¯"),t("strong",[s._v("ç¬¬äºŒç§å¸¸è§çš„å¯èƒ½äº†, å³å¤‡åº“çš„åŽ‹åŠ›å¤§")]),s._v(". ä¸€èˆ¬çš„æƒ³æ³•æ˜¯, ä¸»åº“æ—¢ç„¶æä¾›äº†å†™èƒ½åŠ›, é‚£ä¹ˆå¤‡åº“å¯ä»¥æä¾›ä¸€äº›è¯»èƒ½åŠ›. æˆ–è€…ä¸€äº›è¿è¥åŽå°éœ€è¦çš„åˆ†æžè¯­å¥, ä¸èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡, æ‰€ä»¥"),t("strong",[s._v("åªèƒ½åœ¨å¤‡åº“ä¸Šè·‘")]),s._v(".")]),s._v(" "),t("p",[s._v("æˆ‘çœŸå°±è§è¿‡ä¸å°‘è¿™æ ·çš„æƒ…å†µ. ç”±äºŽä¸»åº“ç›´æŽ¥å½±å“ä¸šåŠ¡, å¤§å®¶ä½¿ç”¨èµ·æ¥ä¼šæ¯”è¾ƒå…‹åˆ¶, åè€Œå¿½è§†äº†å¤‡åº“çš„åŽ‹åŠ›æŽ§åˆ¶. ç»“æžœå°±æ˜¯, "),t("mark",[t("strong",[s._v("å¤‡åº“ä¸Šçš„æŸ¥è¯¢è€—è´¹äº†å¤§é‡çš„ CPU èµ„æº, å½±å“äº†åŒæ­¥é€Ÿåº¦, é€ æˆä¸»å¤‡å»¶è¿Ÿ")])]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ç§æƒ…å†µä¸€èˆ¬å¯ä»¥è¿™ä¹ˆå¤„ç†:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä¸€ä¸»å¤šä»Ž")]),s._v(". é™¤äº†å¤‡åº“å¤–, å¯ä»¥å¤šæŽ¥å‡ ä¸ªä»Žåº“, è®©è¿™äº›ä»Žåº“æ¥åˆ†æ‹…è¯»çš„åŽ‹åŠ›.")]),s._v(" "),t("li",[t("strong",[s._v("é€šè¿‡ binlog è¾“å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿ, æ¯”å¦‚ Hadoop è¿™ç±»ç³»ç»Ÿ, è®©å¤–éƒ¨ç³»ç»Ÿæä¾›ç»Ÿè®¡ç±»æŸ¥è¯¢çš„èƒ½åŠ›")]),s._v(".")])]),s._v(" "),t("p",[s._v("å…¶ä¸­, ä¸€ä¸»å¤šä»Žçš„æ–¹å¼å¤§éƒ½ä¼šè¢«é‡‡ç”¨. å› ä¸ºä½œä¸ºæ•°æ®åº“ç³»ç»Ÿ, è¿˜å¿…é¡»ä¿è¯æœ‰"),t("strong",[s._v("å®šæœŸå…¨é‡å¤‡ä»½çš„èƒ½åŠ›")]),s._v(". è€Œä»Žåº“å°±å¾ˆé€‚åˆç”¨æ¥åšå¤‡ä»½. è¿™é‡Œéœ€è¦è¯´æ˜Žä¸€ä¸‹, ä»Žåº“å’Œå¤‡åº“åœ¨æ¦‚å¿µä¸Šå…¶å®žå·®ä¸å¤š. åœ¨è¿™ä¸ªä¸“æ é‡Œ, ä¸ºäº†æ–¹ä¾¿æè¿°, "),t("strong",[s._v("æŠŠä¼šåœ¨ HA è¿‡ç¨‹ä¸­è¢«é€‰æˆæ–°ä¸»åº“çš„, ç§°ä¸ºå¤‡åº“, å…¶ä»–çš„ç§°ä¸ºä»Žåº“")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿½é—® 2: é‡‡ç”¨äº†ä¸€ä¸»å¤šä»Ž, ä¿è¯å¤‡åº“çš„åŽ‹åŠ›ä¸ä¼šè¶…è¿‡ä¸»åº“, è¿˜æœ‰ä»€ä¹ˆæƒ…å†µå¯èƒ½å¯¼è‡´ä¸»å¤‡å»¶è¿Ÿå—?")]),s._v(" "),t("p",[s._v("**è¿™å°±æ˜¯ç¬¬ä¸‰ç§å¯èƒ½äº†, å³å¤§äº‹åŠ¡. **")]),s._v(" "),t("p",[s._v("å¤§äº‹åŠ¡è¿™ç§æƒ…å†µå¾ˆå¥½ç†è§£. å› ä¸º"),t("strong",[s._v("ä¸»åº“ä¸Šå¿…é¡»ç­‰äº‹åŠ¡æ‰§è¡Œå®Œæˆæ‰ä¼šå†™å…¥ binlog, å†ä¼ ç»™å¤‡åº“")]),s._v(". æ‰€ä»¥å¦‚æžœä¸€ä¸ªä¸»åº“ä¸Šçš„è¯­å¥æ‰§è¡Œ 10 åˆ†é’Ÿ, é‚£è¿™ä¸ªäº‹åŠ¡å¾ˆå¯èƒ½å°±ä¼šå¯¼è‡´ä»Žåº“å»¶è¿Ÿ 10 åˆ†é’Ÿ.")]),s._v(" "),t("p",[s._v("ä¸çŸ¥é“ä½ æ‰€åœ¨å…¬å¸çš„ DBA æœ‰æ²¡æœ‰è·Ÿä½ è¿™ä¹ˆè¯´è¿‡: "),t("mark",[t("strong",[s._v("ä¸è¦ä¸€æ¬¡æ€§åœ°ç”¨ delete è¯­å¥åˆ é™¤å¤ªå¤šæ•°æ®")])]),s._v(". å…¶å®žè¿™å°±æ˜¯ä¸€ä¸ªå…¸åž‹çš„å¤§äº‹åŠ¡åœºæ™¯.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸€äº›å½’æ¡£ç±»çš„æ•°æ®, å¹³æ—¶æ²¡æœ‰æ³¨æ„åˆ é™¤åŽ†å²æ•°æ®, ç­‰åˆ°ç©ºé—´å¿«æ»¡äº†, ä¸šåŠ¡å¼€å‘äººå‘˜è¦ä¸€æ¬¡æ€§åœ°åˆ æŽ‰å¤§é‡åŽ†å²æ•°æ®. åŒæ—¶åˆå› ä¸ºè¦é¿å…åœ¨é«˜å³°æœŸæ“ä½œä¼šå½±å“ä¸šåŠ¡(è‡³å°‘æœ‰è¿™ä¸ªæ„è¯†è¿˜æ˜¯å¾ˆä¸é”™çš„), æ‰€ä»¥ä¼šåœ¨æ™šä¸Šæ‰§è¡Œè¿™äº›å¤§é‡æ•°æ®çš„åˆ é™¤æ“ä½œ. ç»“æžœ, è´Ÿè´£çš„ DBA åŒå­¦åŠå¤œå°±ä¼šæ”¶åˆ°å»¶è¿ŸæŠ¥è­¦. ç„¶åŽ DBA å›¢é˜Ÿå°±è¦æ±‚ä½ åŽç»­å†åˆ é™¤æ•°æ®çš„æ—¶å€™, è¦æŽ§åˆ¶æ¯ä¸ªäº‹åŠ¡åˆ é™¤çš„æ•°æ®é‡, åˆ†æˆå¤šæ¬¡åˆ é™¤.")]),s._v(" "),t("p",[s._v("**å¦ä¸€ç§å…¸åž‹çš„å¤§äº‹åŠ¡åœºæ™¯, å°±æ˜¯å¤§è¡¨ DDL. ** è¿™ä¸ªåœºæ™¯, åœ¨å‰é¢ä»‹ç»è¿‡. å¤„ç†æ–¹æ¡ˆå°±æ˜¯, è®¡åˆ’å†…çš„ DDL, å»ºè®®ä½¿ç”¨ gh-ost æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("è¿½é—® 3: å¦‚æžœä¸»åº“ä¸Šä¹Ÿä¸åšå¤§äº‹åŠ¡äº†, è¿˜æœ‰ä»€ä¹ˆåŽŸå› ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿå—?")]),s._v(" "),t("p",[s._v("é€ æˆä¸»å¤‡å»¶è¿Ÿè¿˜æœ‰ä¸€ä¸ªå¤§æ–¹å‘çš„åŽŸå› , å°±æ˜¯"),t("strong",[s._v("å¤‡åº“çš„å¹¶è¡Œå¤åˆ¶èƒ½åŠ›")]),s._v(". è¿™ä¸ªè¯é¢˜ä¼šç•™åœ¨ä¸‹ä¸€èŠ‚è¯¦ç»†ä»‹ç».")]),s._v(" "),t("p",[t("strong",[s._v("ç”±äºŽä¸»å¤‡å»¶è¿Ÿçš„å­˜åœ¨, æ‰€ä»¥åœ¨ä¸»å¤‡åˆ‡æ¢çš„æ—¶å€™, å°±ç›¸åº”çš„æœ‰ä¸åŒçš„ç­–ç•¥.")])]),s._v(" "),t("h5",{attrs:{id:"æ•°æ®å¯é æ€§ä¼˜å…ˆç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®å¯é æ€§ä¼˜å…ˆç­–ç•¥"}},[s._v("#")]),s._v(" æ•°æ®å¯é æ€§ä¼˜å…ˆç­–ç•¥")]),s._v(" "),t("p",[s._v("åœ¨å‰é¢çš„åŒ M ç»“æž„ä¸‹, "),t("strong",[s._v("ä»ŽçŠ¶æ€ 1 åˆ°çŠ¶æ€ 2 è¿›è¡Œä¸»ä»Žåˆ‡æ¢")]),s._v("çš„è¯¦ç»†è¿‡ç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("åˆ¤æ–­å¤‡åº“ B çŽ°åœ¨çš„ seconds_behind_master, å¦‚æžœå°äºŽæŸä¸ªå€¼(æ¯”å¦‚ 5 ç§’)ç»§ç»­ä¸‹ä¸€æ­¥, å¦åˆ™æŒç»­é‡è¯•è¿™ä¸€æ­¥;")]),s._v(" "),t("li",[s._v("æŠŠä¸»åº“ A æ”¹æˆ"),t("strong",[s._v("åªè¯»çŠ¶æ€")]),s._v(", å³æŠŠ readonly è®¾ç½®ä¸º true;")]),s._v(" "),t("li",[t("strong",[s._v("åˆ¤æ–­å¤‡åº“ B çš„ seconds_behind_master çš„å€¼, ç›´åˆ°è¿™ä¸ªå€¼å˜æˆ 0 ä¸ºæ­¢")]),s._v("; ä¹Ÿå°±æ˜¯ä¸¤è¾¹çš„æ•°æ®å®Œå…¨ä¸€è‡´.")]),s._v(" "),t("li",[s._v("æŠŠå¤‡åº“ B æ”¹æˆå¯è¯»å†™çŠ¶æ€, ä¹Ÿå°±æ˜¯æŠŠ readonly è®¾ç½®ä¸º false;")]),s._v(" "),t("li",[s._v("æŠŠä¸šåŠ¡è¯·æ±‚åˆ‡åˆ°å¤‡åº“ B.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªåˆ‡æ¢æµç¨‹, ä¸€èˆ¬æ˜¯ç”±ä¸“é—¨çš„ HA ç³»ç»Ÿæ¥å®Œæˆçš„, æš‚æ—¶ç§°ä¹‹ä¸º"),t("strong",[s._v("å¯é æ€§ä¼˜å…ˆæµç¨‹")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/da2caf654133a5570e6b478dadf885a4-20230731161914-q192ldv.png",alt:"",title:"MySQLå¯é æ€§ä¼˜å…ˆä¸»å¤‡åˆ‡æ¢æµç¨‹"}})]),s._v(" "),t("p",[s._v("å¤‡æ³¨: å›¾ä¸­çš„ SBM, æ˜¯ "),t("strong",[s._v("seconds_behind_master")]),s._v(" å‚æ•°çš„ç®€å†™.")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªåˆ‡æ¢æµç¨‹ä¸­æ˜¯"),t("mark",[t("strong",[s._v("æœ‰ä¸å¯ç”¨æ—¶é—´")])]),s._v("çš„. å› ä¸ºåœ¨æ­¥éª¤ 2 ä¹‹åŽ, "),t("strong",[s._v("ä¸»åº“ A å’Œå¤‡åº“ B éƒ½å¤„äºŽ readonly çŠ¶æ€, ä¹Ÿå°±æ˜¯è¯´è¿™æ—¶ç³»ç»Ÿå¤„äºŽä¸å¯å†™çŠ¶æ€, ç›´åˆ°æ­¥éª¤ 5 å®ŒæˆåŽæ‰èƒ½æ¢å¤")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªä¸å¯ç”¨çŠ¶æ€ä¸­, æ¯”è¾ƒè€—è´¹æ—¶é—´çš„æ˜¯æ­¥éª¤ 3, å¯èƒ½éœ€è¦è€—è´¹å¥½å‡ ç§’çš„æ—¶é—´. è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéœ€è¦åœ¨æ­¥éª¤ 1 å…ˆåšåˆ¤æ–­, ç¡®ä¿ seconds_behind_master çš„å€¼"),t("strong",[s._v("è¶³å¤Ÿå°")]),s._v(". è¯•æƒ³å¦‚æžœä¸€å¼€å§‹ä¸»å¤‡å»¶è¿Ÿå°±é•¿è¾¾ 30 åˆ†é’Ÿ, è€Œä¸å…ˆåšåˆ¤æ–­ç›´æŽ¥åˆ‡æ¢çš„è¯, ç³»ç»Ÿçš„ä¸å¯ç”¨æ—¶é—´å°±ä¼šé•¿è¾¾ 30 åˆ†é’Ÿ, è¿™ç§æƒ…å†µä¸€èˆ¬ä¸šåŠ¡éƒ½æ˜¯ä¸å¯æŽ¥å—çš„.")]),s._v(" "),t("p",[s._v("å½“ç„¶, ç³»ç»Ÿçš„ä¸å¯ç”¨æ—¶é—´, æ˜¯ç”±è¿™ä¸ª"),t("strong",[s._v("æ•°æ®å¯é æ€§ä¼˜å…ˆçš„ç­–ç•¥")]),s._v("å†³å®šçš„, ä¹Ÿå°±æ˜¯ä¿è¯ä¸»ä»Žçš„æ•°æ®éƒ½æ˜¯å¯é çš„. ä¹Ÿå¯ä»¥é€‰æ‹©"),t("strong",[s._v("å¯ç”¨æ€§ä¼˜å…ˆ")]),s._v("çš„ç­–ç•¥, æ¥æŠŠè¿™ä¸ªä¸å¯ç”¨æ—¶é—´å‡ ä¹Žé™ä¸º 0.")]),s._v(" "),t("h5",{attrs:{id:"å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥"}},[s._v("#")]),s._v(" å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥")]),s._v(" "),t("p",[s._v("å¦‚æžœå¼ºè¡ŒæŠŠæ­¥éª¤ 4, 5 è°ƒæ•´åˆ°æœ€å¼€å§‹æ‰§è¡Œ, ä¹Ÿå°±æ˜¯è¯´"),t("strong",[s._v("ä¸ç­‰ä¸»å¤‡æ•°æ®åŒæ­¥, ç›´æŽ¥æŠŠè¿žæŽ¥åˆ‡åˆ°å¤‡åº“ B, å¹¶ä¸”è®©å¤‡åº“ B å¯ä»¥è¯»å†™, é‚£ä¹ˆç³»ç»Ÿå‡ ä¹Žå°±æ²¡æœ‰ä¸å¯ç”¨æ—¶é—´äº†")]),s._v(". æŠŠè¿™ä¸ªåˆ‡æ¢æµç¨‹, æš‚æ—¶ç§°ä½œ"),t("strong",[s._v("å¯ç”¨æ€§ä¼˜å…ˆæµç¨‹")]),s._v(". è¿™ä¸ªåˆ‡æ¢æµç¨‹çš„ä»£ä»·, å°±æ˜¯"),t("strong",[s._v("å¯èƒ½å‡ºçŽ°æ•°æ®ä¸ä¸€è‡´")]),s._v("çš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, å°±åˆ†äº«ä¸€ä¸ªå¯ç”¨æ€§ä¼˜å…ˆæµç¨‹äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„ä¾‹å­. å‡è®¾æœ‰ä¸€ä¸ªè¡¨ t:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¡¨å®šä¹‰äº†ä¸€ä¸ªè‡ªå¢žä¸»é”® id, åˆå§‹åŒ–æ•°æ®åŽ, ä¸»åº“å’Œå¤‡åº“ä¸Šéƒ½æ˜¯ 3 è¡Œæ•°æ®. æŽ¥ä¸‹æ¥, ä¸šåŠ¡äººå‘˜è¦ç»§ç»­åœ¨è¡¨ t ä¸Šæ‰§è¡Œä¸¤æ¡æ’å…¥è¯­å¥çš„å‘½ä»¤, ä¾æ¬¡æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å‡è®¾, çŽ°åœ¨ä¸»åº“ä¸Šå…¶ä»–çš„æ•°æ®è¡¨æœ‰"),t("strong",[s._v("å¤§é‡çš„æ›´æ–°")]),s._v(", å¯¼è‡´ä¸»å¤‡å»¶è¿Ÿè¾¾åˆ° 5 ç§’. åœ¨æ’å…¥ä¸€æ¡ c=4 çš„è¯­å¥åŽ, å‘èµ·äº†ä¸»å¤‡åˆ‡æ¢.")]),s._v(" "),t("p",[s._v("ä¸‹å›¾æ˜¯**å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥, ä¸” binlog_format=mixed ** æ—¶çš„åˆ‡æ¢æµç¨‹å’Œæ•°æ®ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e193212bd9194b4c9fcce1e911690676-20230731161914-q9fh5ov.png",alt:"",title:"å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥(ä¸”binlog_format=mixed)"}})]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä¸€èµ·åˆ†æžä¸‹è¿™ä¸ªåˆ‡æ¢æµç¨‹:")]),s._v(" "),t("ol",[t("li",[s._v("æ­¥éª¤ 2 ä¸­, ä¸»åº“ A æ‰§è¡Œå®Œ insert è¯­å¥, æ’å…¥äº†ä¸€è¡Œæ•°æ®(4,4), ä¹‹åŽå¼€å§‹è¿›è¡Œä¸»å¤‡åˆ‡æ¢.")]),s._v(" "),t("li",[s._v('æ­¥éª¤ 3 ä¸­, ç”±äºŽä¸»å¤‡ä¹‹é—´æœ‰ 5 ç§’çš„å»¶è¿Ÿ, æ‰€ä»¥å¤‡åº“ B è¿˜æ²¡æ¥å¾—åŠåº”ç”¨ "æ’å…¥ c=4" è¿™ä¸ªä¸­è½¬æ—¥å¿—, å°±å¼€å§‹æŽ¥æ”¶å®¢æˆ·ç«¯ "æ’å…¥ c=5" çš„å‘½ä»¤.')]),s._v(" "),t("li",[s._v("æ­¥éª¤ 4 ä¸­, å¤‡åº“ B æ’å…¥äº†ä¸€è¡Œæ•°æ®(4,5), å¹¶ä¸”æŠŠè¿™ä¸ª binlog å‘ç»™ä¸»åº“ A.")]),s._v(" "),t("li",[s._v('æ­¥éª¤ 5 ä¸­, å¤‡åº“ B æ‰§è¡Œ "æ’å…¥ c=4" è¿™ä¸ªä¸­è½¬æ—¥å¿—, æ’å…¥äº†ä¸€è¡Œæ•°æ®(5,4). è€Œç›´æŽ¥åœ¨å¤‡åº“ B æ‰§è¡Œçš„ "æ’å…¥ c=5" è¿™ä¸ªè¯­å¥, ä¼ åˆ°ä¸»åº“ A, å°±æ’å…¥äº†ä¸€è¡Œæ–°æ•°æ®(5,5).')])]),s._v(" "),t("p",[s._v("æœ€åŽçš„ç»“æžœå°±æ˜¯, "),t("strong",[s._v("ä¸»åº“ A å’Œå¤‡åº“ B ä¸Šå‡ºçŽ°äº†ä¸¤è¡Œä¸ä¸€è‡´çš„æ•°æ®")]),s._v(". å¯ä»¥çœ‹åˆ°, è¿™ä¸ªæ•°æ®ä¸ä¸€è‡´, æ˜¯ç”±å¯ç”¨æ€§ä¼˜å…ˆæµç¨‹å¯¼è‡´çš„.")]),s._v(" "),t("p",[s._v("é‚£å¦‚æžœè¿˜æ˜¯ç”¨"),t("strong",[s._v("å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥, ä½†è®¾ç½® binlog_format=row")]),s._v(", æƒ…å†µåˆä¼šæ€Žæ ·å‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("å› ä¸º row æ ¼å¼åœ¨è®°å½• binlog çš„æ—¶å€™, ä¼šè®°å½•æ–°æ’å…¥çš„è¡Œçš„æ‰€æœ‰å­—æ®µå€¼, æ‰€ä»¥æœ€åŽåªä¼šæœ‰ä¸€è¡Œä¸ä¸€è‡´")]),s._v(". è€Œä¸”ä¸¤è¾¹çš„ä¸»å¤‡åŒæ­¥çš„åº”ç”¨çº¿ç¨‹ä¼šæŠ¥é”™ duplicate key error å¹¶åœæ­¢. ä¹Ÿå°±æ˜¯è¯´, è¿™ç§æƒ…å†µä¸‹, å¤‡åº“ B çš„ (5,4) å’Œä¸»åº“ A çš„ (5,5) è¿™ä¸¤è¡Œæ•°æ®, éƒ½ä¸ä¼šè¢«å¯¹æ–¹æ‰§è¡Œ.")]),s._v(" "),t("p",[s._v("ä¸‹å›¾ç”»å‡ºäº†è¯¦ç»†è¿‡ç¨‹, å¯ä»¥è‡ªå·±å†åˆ†æžä¸€ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4c04253a39bfa8db39c973666c99ba14-20230731161914-kr3yfd4.png",alt:"",title:"å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥(ä¸”binlog_format=row)"}})]),s._v(" "),t("p",[s._v("ä»Žä¸Šé¢çš„åˆ†æžä¸­, å¯ä»¥çœ‹åˆ°ä¸€äº›ç»“è®º:")]),s._v(" "),t("ol",[t("li",[s._v("ä½¿ç”¨ row æ ¼å¼çš„ binlog æ—¶, æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜æ›´å®¹æ˜“è¢«å‘çŽ°. è€Œä½¿ç”¨ mixed æˆ–è€… statement æ ¼å¼çš„ binlog æ—¶, æ•°æ®å¾ˆå¯èƒ½æ‚„æ‚„åœ°å°±ä¸ä¸€è‡´äº†. å¦‚æžœè¿‡äº†å¾ˆä¹…æ‰å‘çŽ°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜, å¾ˆå¯èƒ½è¿™æ—¶çš„æ•°æ®ä¸ä¸€è‡´å·²ç»ä¸å¯æŸ¥, æˆ–è€…è¿žå¸¦é€ æˆäº†æ›´å¤šçš„æ•°æ®é€»è¾‘ä¸ä¸€è‡´.")]),s._v(" "),t("li",[s._v("ä¸»å¤‡åˆ‡æ¢çš„å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´. å› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹, "),t("mark",[t("strong",[s._v("éƒ½å»ºè®®ä½¿ç”¨æ•°æ®å¯é æ€§ä¼˜å…ˆç­–ç•¥")])]),s._v(". æ¯•ç«Ÿ"),t("strong",[s._v("å¯¹æ•°æ®æœåŠ¡æ¥è¯´çš„è¯, æ•°æ®çš„å¯é æ€§ä¸€èˆ¬è¿˜æ˜¯è¦ä¼˜äºŽå¯ç”¨æ€§çš„")]),s._v(".")])]),s._v(" "),t("p",[s._v("ä½†äº‹æ— ç»å¯¹, **æœ‰æ²¡æœ‰å“ªç§æƒ…å†µæ•°æ®çš„å¯ç”¨æ€§ä¼˜å…ˆçº§æ›´é«˜å‘¢? **")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, æœ‰çš„.")]),s._v(" "),t("p",[s._v("æˆ‘æ›¾ç»ç¢°åˆ°è¿‡è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯:")]),s._v(" "),t("ul",[t("li",[s._v("æœ‰ä¸€ä¸ªåº“çš„ä½œç”¨æ˜¯"),t("strong",[s._v("è®°å½•æ“ä½œæ—¥å¿—")]),s._v(". è¿™æ—¶å€™å¦‚æžœæ•°æ®ä¸ä¸€è‡´å¯ä»¥é€šè¿‡ binlog æ¥ä¿®è¡¥, è€Œè¿™ä¸ªçŸ­æš‚çš„ä¸ä¸€è‡´ä¹Ÿä¸ä¼šå¼•å‘ä¸šåŠ¡é—®é¢˜.")]),s._v(" "),t("li",[s._v("åŒæ—¶ä¸šåŠ¡ç³»ç»Ÿä¾èµ–äºŽè¿™ä¸ªæ—¥å¿—å†™å…¥é€»è¾‘, å¦‚æžœè¿™ä¸ªåº“ä¸å¯å†™, ä¼šå¯¼è‡´çº¿ä¸Šçš„ä¸šåŠ¡æ“ä½œæ— æ³•æ‰§è¡Œ.")])]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™å¯èƒ½å°±éœ€è¦é€‰æ‹©å…ˆå¼ºè¡Œåˆ‡æ¢, äº‹åŽå†è¡¥æ•°æ®çš„ç­–ç•¥.")]),s._v(" "),t("p",[s._v("å½“ç„¶äº‹åŽå¤ç›˜çš„æ—¶å€™, æˆ‘ä»¬æƒ³åˆ°äº†ä¸€ä¸ªæ”¹è¿›æŽªæ–½å°±æ˜¯, "),t("strong",[s._v("è®©ä¸šåŠ¡é€»è¾‘ä¸è¦ä¾èµ–äºŽè¿™ç±»æ—¥å¿—çš„å†™å…¥")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("æ—¥å¿—å†™å…¥è¿™ä¸ªé€»è¾‘æ¨¡å—åº”è¯¥å¯ä»¥é™çº§, æ¯”å¦‚å†™åˆ°æœ¬åœ°æ–‡ä»¶, æˆ–è€…å†™åˆ°å¦å¤–ä¸€ä¸ªä¸´æ—¶åº“é‡Œé¢")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ ·çš„è¯, è¿™ç§åœºæ™¯å°±åˆå¯ä»¥ä½¿ç”¨å¯é æ€§ä¼˜å…ˆç­–ç•¥äº†.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹çœ‹, **æŒ‰ç…§å¯é æ€§ä¼˜å…ˆçš„æ€è·¯, å¼‚å¸¸åˆ‡æ¢ä¼šæ˜¯ä»€ä¹ˆæ•ˆæžœ? **")]),s._v(" "),t("p",[s._v("å‡è®¾ä¸»åº“ A å’Œå¤‡åº“ B é—´çš„ä¸»å¤‡å»¶è¿Ÿæ˜¯ 30 åˆ†é’Ÿ, è¿™æ—¶å€™ä¸»åº“ A æŽ‰ç”µäº†, HA ç³»ç»Ÿè¦åˆ‡æ¢ B ä½œä¸ºä¸»åº“. åœ¨ä¸»åŠ¨åˆ‡æ¢çš„æ—¶å€™, å¯ä»¥ç­‰åˆ°ä¸»å¤‡å»¶è¿Ÿå°äºŽ 5 ç§’çš„æ—¶å€™å†å¯åŠ¨åˆ‡æ¢, ä½†è¿™æ—¶å€™"),t("strong",[s._v("å·²ç»åˆ«æ— é€‰æ‹©")]),s._v("äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/23ed2cfa73ab4f13ec85f533d28c29a0-20230731161914-v5wog3p.png",alt:"",title:"å¯é æ€§ä¼˜å…ˆç­–ç•¥,ä¸»åº“ä¸å¯ç”¨"}})]),s._v(" "),t("p",[s._v("é‡‡ç”¨å¯é æ€§ä¼˜å…ˆç­–ç•¥çš„è¯, å°±å¿…é¡»å¾—ç­‰åˆ°å¤‡åº“ B çš„ seconds_behind_master=0 ä¹‹åŽæ‰èƒ½åˆ‡æ¢. ä½†çŽ°åœ¨çš„æƒ…å†µæ¯”åˆšåˆšæ›´ä¸¥é‡, å¹¶ä¸æ˜¯ç³»ç»Ÿåªè¯», ä¸å¯å†™çš„é—®é¢˜äº†, è€Œæ˜¯ç³»ç»Ÿå¤„äºŽå®Œå…¨ä¸å¯ç”¨çš„çŠ¶æ€. å› ä¸ºä¸»åº“ A æŽ‰ç”µåŽ, è¿žæŽ¥è¿˜æ²¡æœ‰åˆ‡åˆ°å¤‡åº“ B.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, é‚£"),t("strong",[s._v("èƒ½ä¸èƒ½ç›´æŽ¥åˆ‡æ¢åˆ°å¤‡åº“ B, ä½†æ˜¯ä¿æŒ B åªè¯»")]),s._v("å‘¢?")]),s._v(" "),t("p",[s._v('è¿™æ ·ä¹Ÿä¸è¡Œ. å› ä¸º, è¿™æ®µæ—¶é—´å†…, ä¸­è½¬æ—¥å¿—è¿˜æ²¡æœ‰åº”ç”¨å®Œæˆ, å¦‚æžœç›´æŽ¥å‘èµ·ä¸»å¤‡åˆ‡æ¢, å®¢æˆ·ç«¯æŸ¥è¯¢çœ‹ä¸åˆ°ä¹‹å‰æ‰§è¡Œå®Œæˆçš„äº‹åŠ¡, ä¼šè®¤ä¸ºæœ‰ "æ•°æ®ä¸¢å¤±". è™½ç„¶éšç€ä¸­è½¬æ—¥å¿—çš„ç»§ç»­åº”ç”¨, è¿™äº›æ•°æ®ä¼šæ¢å¤å›žæ¥, ä½†æ˜¯å¯¹äºŽä¸€äº›ä¸šåŠ¡æ¥è¯´, æŸ¥è¯¢åˆ°"æš‚æ—¶ä¸¢å¤±æ•°æ®çš„çŠ¶æ€"ä¹Ÿæ˜¯ä¸èƒ½è¢«æŽ¥å—çš„.')]),s._v(" "),t("p",[s._v("èŠåˆ°è¿™é‡Œä½ å°±çŸ¥é“äº†, "),t("strong",[s._v("åœ¨æ»¡è¶³æ•°æ®å¯é æ€§çš„å‰æä¸‹, MySQL é«˜å¯ç”¨ç³»ç»Ÿçš„å¯ç”¨æ€§, æ˜¯ä¾èµ–äºŽä¸»å¤‡å»¶è¿Ÿçš„. å»¶è¿Ÿçš„æ—¶é—´è¶Šå°, åœ¨ä¸»åº“æ•…éšœçš„æ—¶å€™, æœåŠ¡æ¢å¤éœ€è¦çš„æ—¶é—´å°±è¶ŠçŸ­, å¯ç”¨æ€§å°±è¶Šé«˜")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-24"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-24"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL é«˜å¯ç”¨ç³»ç»Ÿçš„åŸºç¡€, å°±æ˜¯ä¸»å¤‡åˆ‡æ¢é€»è¾‘. ç´§æŽ¥ç€åˆè®¨è®ºäº†å‡ ç§ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„æƒ…å†µ, ä»¥åŠç›¸åº”çš„æ”¹è¿›æ–¹å‘.")]),s._v(" "),t("p",[t("strong",[s._v("ç”±äºŽä¸»å¤‡å»¶è¿Ÿçš„å­˜åœ¨, åˆ‡æ¢ç­–ç•¥å°±æœ‰ä¸åŒçš„é€‰æ‹©")]),s._v(". æ‰€ä»¥åˆä¸€èµ·åˆ†æžäº†"),t("mark",[t("strong",[s._v("å¯é æ€§ä¼˜å…ˆå’Œå¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥")])]),s._v("çš„åŒºåˆ«. "),t("strong",[s._v("åœ¨å®žé™…çš„åº”ç”¨ä¸­, æ›´å»ºè®®ä½¿ç”¨å¯é æ€§ä¼˜å…ˆçš„ç­–ç•¥")]),s._v(". æ¯•ç«Ÿä¿è¯æ•°æ®å‡†ç¡®, åº”è¯¥æ˜¯æ•°æ®åº“æœåŠ¡çš„åº•çº¿. åœ¨è¿™ä¸ªåŸºç¡€ä¸Š, é€šè¿‡"),t("strong",[s._v("å‡å°‘ä¸»å¤‡å»¶è¿Ÿ, æå‡ç³»ç»Ÿçš„å¯ç”¨æ€§")]),s._v(".")]),s._v(" "),t("p",[s._v("æœ€åŽ, æˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§.")]),s._v(" "),t("p",[t("strong",[s._v("ä¸€èˆ¬çŽ°åœ¨çš„æ•°æ®åº“è¿ç»´ç³»ç»Ÿéƒ½æœ‰å¤‡åº“å»¶è¿Ÿç›‘æŽ§, å…¶å®žå°±æ˜¯åœ¨å¤‡åº“ä¸Šæ‰§è¡Œ show slave status, é‡‡é›† seconds_behind_master çš„å€¼.")])]),s._v(" "),t("p",[s._v("å‡è®¾, çŽ°åœ¨ä½ çœ‹åˆ°ä½ ç»´æŠ¤çš„ä¸€ä¸ªå¤‡åº“, å®ƒçš„å»¶è¿Ÿç›‘æŽ§çš„å›¾åƒç±»ä¼¼ä¸‹å›¾, æ˜¯ä¸€ä¸ª 45Â°æ–œå‘ä¸Šçš„çº¿æ®µ, ä½ è§‰å¾—å¯èƒ½æ˜¯ä»€ä¹ˆåŽŸå› å¯¼è‡´å‘¢? ä½ åˆä¼šæ€Žä¹ˆåŽ»ç¡®è®¤è¿™ä¸ªåŽŸå› å‘¢?")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/bc5c5d4ea6e55ba4e442a594b08f3262-20230731161914-wywzn48.png",alt:""}})]),s._v(" "),t("p",[s._v("è¿™ç§çŽ°è±¡çš„åŽŸå› å¯èƒ½æ˜¯"),t("strong",[s._v("å¤‡åº“çš„åŒæ­¥åœ¨è¿™æ®µæ—¶é—´å®Œå…¨è¢«å µä½äº†")]),s._v(". äº§ç”Ÿè¿™ç§çŽ°è±¡å…¸åž‹çš„åœºæ™¯ä¸»è¦åŒ…æ‹¬ä¸¤ç§:")]),s._v(" "),t("ul",[t("li",[s._v("ä¸€ç§æ˜¯å¤§äº‹åŠ¡(åŒ…æ‹¬å¤§è¡¨ DDL, ä¸€ä¸ªäº‹åŠ¡æ“ä½œå¾ˆå¤šè¡Œ);")]),s._v(" "),t("li",[s._v("è¿˜æœ‰ä¸€ç§æƒ…å†µæ¯”è¾ƒéšè”½, å°±æ˜¯å¤‡åº“èµ·äº†ä¸€ä¸ªé•¿äº‹åŠ¡.")])]),s._v(" "),t("h4",{attrs:{id:"_26-å¤‡åº“ä¸ºä»€ä¹ˆä¼šå»¶è¿Ÿå¥½å‡ ä¸ªå°æ—¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_26-å¤‡åº“ä¸ºä»€ä¹ˆä¼šå»¶è¿Ÿå¥½å‡ ä¸ªå°æ—¶"}},[s._v("#")]),s._v(" 26-å¤‡åº“ä¸ºä»€ä¹ˆä¼šå»¶è¿Ÿå¥½å‡ ä¸ªå°æ—¶?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚ä»‹ç»äº†å‡ ç§å¯èƒ½å¯¼è‡´å¤‡åº“å»¶è¿Ÿçš„åŽŸå› . è¿™äº›åœºæ™¯é‡Œ, ä¸è®ºæ˜¯å¶å‘æ€§çš„æŸ¥è¯¢åŽ‹åŠ›, è¿˜æ˜¯å¤‡ä»½, å¯¹å¤‡åº“å»¶è¿Ÿçš„å½±å“ä¸€èˆ¬æ˜¯åˆ†é’Ÿçº§çš„, è€Œä¸”åœ¨å¤‡åº“æ¢å¤æ­£å¸¸ä»¥åŽéƒ½èƒ½å¤Ÿè¿½ä¸Šæ¥.")]),s._v(" "),t("p",[t("strong",[s._v("ä½†å¦‚æžœå¤‡åº“æ‰§è¡Œæ—¥å¿—çš„é€Ÿåº¦æŒç»­ä½ŽäºŽä¸»åº“ç”Ÿæˆæ—¥å¿—çš„é€Ÿåº¦, é‚£è¿™ä¸ªå»¶è¿Ÿå°±æœ‰å¯èƒ½æˆäº†å°æ—¶çº§åˆ«. è€Œä¸”å¯¹äºŽä¸€ä¸ªåŽ‹åŠ›æŒç»­æ¯”è¾ƒé«˜çš„ä¸»åº“æ¥è¯´, å¤‡åº“å¾ˆå¯èƒ½æ°¸è¿œéƒ½è¿½ä¸ä¸Šä¸»åº“çš„èŠ‚å¥.")])]),s._v(" "),t("p",[s._v("è¿™å°±æ¶‰åŠåˆ°æœ¬èŠ‚çš„è¯é¢˜: "),t("strong",[s._v("å¤‡åº“å¹¶è¡Œå¤åˆ¶èƒ½åŠ›")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸ºä¾¿äºŽç†è§£, å†ä¸€èµ·çœ‹ä¸€ä¸‹å‰é¢æåˆ°çš„ä¸»å¤‡æµç¨‹å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/98e9824ac0c696f76ea51a5c100d58d3-20230731161914-d6tbwla.png",alt:"",title:"ä¸»å¤‡æµç¨‹å›¾"}})]),s._v(" "),t("p",[s._v("è°ˆåˆ°ä¸»å¤‡çš„å¹¶è¡Œå¤åˆ¶èƒ½åŠ›, "),t("strong",[s._v("è¦å…³æ³¨çš„æ˜¯å›¾ä¸­é»‘è‰²çš„ä¸¤ä¸ªç®­å¤´. ä¸€ä¸ªç®­å¤´ä»£è¡¨äº†å®¢æˆ·ç«¯å†™å…¥ä¸»åº“, å¦ä¸€ç®­å¤´ä»£è¡¨çš„æ˜¯å¤‡åº“ä¸Š sql_thread æ‰§è¡Œä¸­è½¬æ—¥å¿—(relay log)")]),s._v(" . å¦‚æžœç”¨ç®­å¤´çš„ç²—ç»†æ¥ä»£è¡¨å¹¶è¡Œåº¦çš„è¯, é‚£ä¹ˆçœŸå®žæƒ…å†µå°±å¦‚å›¾æ‰€ç¤º, ç¬¬ä¸€ä¸ªç®­å¤´è¦æ˜Žæ˜¾ç²—äºŽç¬¬äºŒä¸ªç®­å¤´.")]),s._v(" "),t("p",[s._v("åœ¨ä¸»åº“ä¸Š, "),t("strong",[s._v("å½±å“å¹¶å‘åº¦çš„åŽŸå› å°±æ˜¯å„ç§é”")]),s._v("äº†. ç”±äºŽ InnoDB å¼•æ“Žæ”¯æŒè¡Œé”, é™¤äº†æ‰€æœ‰å¹¶å‘äº‹åŠ¡éƒ½åœ¨æ›´æ–°åŒä¸€è¡Œ(çƒ­ç‚¹è¡Œ)è¿™ç§æžç«¯åœºæ™¯å¤–, å®ƒå¯¹ä¸šåŠ¡å¹¶å‘åº¦çš„æ”¯æŒè¿˜æ˜¯å¾ˆå‹å¥½çš„. æ‰€ä»¥åœ¨æ€§èƒ½æµ‹è¯•çš„æ—¶å€™ä¼šå‘çŽ°, å¹¶å‘åŽ‹æµ‹çº¿ç¨‹ 32 å°±æ¯”å•çº¿ç¨‹æ—¶, æ€»ä½“åžåé‡é«˜.")]),s._v(" "),t("p",[t("strong",[s._v("è€Œæ—¥å¿—åœ¨å¤‡åº“ä¸Šçš„æ‰§è¡Œ, å°±æ˜¯å›¾ä¸­å¤‡åº“ä¸Š sql_thread æ›´æ–°æ•°æ® (DATA) çš„é€»è¾‘. å¦‚æžœæ˜¯ç”¨å•çº¿ç¨‹çš„è¯, å°±ä¼šå¯¼è‡´å¤‡åº“åº”ç”¨æ—¥å¿—ä¸å¤Ÿå¿«, é€ æˆä¸»å¤‡å»¶è¿Ÿ")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨å®˜æ–¹çš„ 5.6 ç‰ˆæœ¬ä¹‹å‰, MySQL åªæ”¯æŒå•çº¿ç¨‹å¤åˆ¶, ç”±æ­¤åœ¨ä¸»åº“å¹¶å‘é«˜, TPS é«˜æ—¶å°±ä¼šå‡ºçŽ°ä¸¥é‡çš„ä¸»å¤‡å»¶è¿Ÿé—®é¢˜.  ä»Žå•çº¿ç¨‹å¤åˆ¶åˆ°æœ€æ–°ç‰ˆæœ¬çš„å¤šçº¿ç¨‹å¤åˆ¶, ä¸­é—´çš„æ¼”åŒ–ç»åŽ†äº†å¥½å‡ ä¸ªç‰ˆæœ¬. æŽ¥ä¸‹æ¥å°±è¯´è¯´ "),t("strong",[s._v("MySQL å¤šçº¿ç¨‹å¤åˆ¶çš„æ¼”è¿›è¿‡ç¨‹")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶å®žè¯´åˆ°åº•, æ‰€æœ‰çš„å¤šçº¿ç¨‹å¤åˆ¶æœºåˆ¶, éƒ½æ˜¯è¦æŠŠå›¾ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„ sql_thread, æ‹†æˆå¤šä¸ªçº¿ç¨‹, ä¹Ÿå°±æ˜¯éƒ½ç¬¦åˆä¸‹é¢çš„è¿™ä¸ªæ¨¡åž‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6d4d43a734df13edd76bbefaa9ee00c0-20230731161914-o37wgpw.png",alt:"",title:"å¤šçº¿ç¨‹æ¨¡åž‹"}})]),s._v(" "),t("p",[s._v("å›¾ä¸­, coordinator å°±æ˜¯åŽŸæ¥çš„ sql_thread, ä¸è¿‡çŽ°åœ¨å®ƒ"),t("strong",[s._v("ä¸å†ç›´æŽ¥æ›´æ–°æ•°æ®äº†, åªè´Ÿè´£è¯»å–ä¸­è½¬æ—¥å¿—å’Œåˆ†å‘äº‹åŠ¡")]),s._v(". çœŸæ­£æ›´æ–°æ—¥å¿—çš„, å˜æˆäº† worker çº¿ç¨‹. è€Œ work çº¿ç¨‹çš„ä¸ªæ•°, å°±æ˜¯ç”±å‚æ•° "),t("strong",[s._v("slave_parallel_workers")]),s._v(" å†³å®šçš„. æ ¹æ®ç»éªŒ, æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸º "),t("strong",[s._v("8~16 ä¹‹é—´æœ€å¥½(32 æ ¸ç‰©ç†æœºçš„æƒ…å†µ)")]),s._v(" , æ¯•ç«Ÿå¤‡åº“è¿˜æœ‰å¯èƒ½è¦æä¾›è¯»æŸ¥è¯¢, ä¸èƒ½æŠŠ CPU éƒ½åƒå…‰äº†.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥éœ€è¦å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜: "),t("strong",[s._v("äº‹åŠ¡èƒ½ä¸èƒ½æŒ‰ç…§è½®è¯¢çš„æ–¹å¼åˆ†å‘ç»™å„ä¸ª worker, ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªäº‹åŠ¡åˆ†ç»™ worker_1, ç¬¬äºŒä¸ªäº‹åŠ¡å‘ç»™ worker_2 å‘¢")]),s._v("?")]),s._v(" "),t("p",[s._v("å…¶å®ž"),t("strong",[s._v("æ˜¯ä¸è¡Œçš„")]),s._v(". å› ä¸ºäº‹åŠ¡è¢«åˆ†å‘ç»™ worker ä»¥åŽ, ä¸åŒçš„ worker å°±ç‹¬ç«‹æ‰§è¡Œäº†. ä½†æ˜¯"),t("strong",[s._v("ç”±äºŽ CPU çš„è°ƒåº¦ç­–ç•¥, å¾ˆå¯èƒ½ç¬¬äºŒä¸ªäº‹åŠ¡æœ€ç»ˆæ¯”ç¬¬ä¸€ä¸ªäº‹åŠ¡å…ˆæ‰§è¡Œ")]),s._v(". è€Œå¦‚æžœè¿™æ—¶å€™åˆšå¥½è¿™ä¸¤ä¸ªäº‹åŠ¡æ›´æ–°çš„æ˜¯åŒä¸€è¡Œ, ä¹Ÿå°±æ„å‘³ç€, åŒä¸€è¡Œä¸Šçš„ä¸¤ä¸ªäº‹åŠ¡, åœ¨ä¸»åº“å’Œå¤‡åº“ä¸Šçš„æ‰§è¡Œé¡ºåºç›¸å, "),t("strong",[s._v("ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´çš„é—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†è®¾æƒ³ä¸€ä¸‹å¦å¤–ä¸€ä¸ªé—®é¢˜: "),t("strong",[s._v("åŒä¸€ä¸ªäº‹åŠ¡çš„å¤šä¸ªæ›´æ–°è¯­å¥, èƒ½ä¸èƒ½åˆ†ç»™ä¸åŒçš„ worker æ¥æ‰§è¡Œ")]),s._v("å‘¢?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("ä¹Ÿä¸è¡Œ")]),s._v('. ä¸¾ä¸ªä¾‹å­, ä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†è¡¨ t1 å’Œè¡¨ t2 ä¸­çš„å„ä¸€è¡Œ, å¦‚æžœè¿™ä¸¤æ¡æ›´æ–°è¯­å¥è¢«åˆ†åˆ°ä¸åŒ worker çš„è¯, è™½ç„¶æœ€ç»ˆçš„ç»“æžœæ˜¯ä¸»å¤‡ä¸€è‡´çš„, ä½†å¦‚æžœè¡¨ t1 æ‰§è¡Œå®Œæˆçš„çž¬é—´, å¤‡åº“ä¸Šæœ‰ä¸€ä¸ªæŸ¥è¯¢, å°±ä¼šçœ‹åˆ°è¿™ä¸ªäº‹åŠ¡ "æ›´æ–°äº†ä¸€åŠçš„ç»“æžœ", ç ´åäº†äº‹åŠ¡é€»è¾‘çš„éš”ç¦»æ€§.')]),s._v(" "),t("p",[s._v("æ‰€ä»¥ coordinator åœ¨åˆ†å‘çš„æ—¶å€™, éœ€è¦æ»¡è¶³ä»¥ä¸‹è¿™ä¸¤ä¸ªåŸºæœ¬è¦æ±‚:")]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v("ä¸èƒ½é€ æˆæ›´æ–°è¦†ç›–. è¿™å°±è¦æ±‚æ›´æ–°åŒä¸€è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡, å¿…é¡»è¢«åˆ†å‘åˆ°åŒä¸€ä¸ª worker ä¸­")])]),s._v(".")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("åŒä¸€ä¸ªäº‹åŠ¡ä¸èƒ½è¢«æ‹†å¼€, å¿…é¡»æ”¾åˆ°åŒä¸€ä¸ª worker ä¸­")])]),s._v(".")])]),s._v(" "),t("p",[s._v("å„ä¸ªç‰ˆæœ¬çš„å¤šçº¿ç¨‹å¤åˆ¶, éƒ½éµå¾ªäº†è¿™ä¸¤æ¡åŸºæœ¬åŽŸåˆ™. æŽ¥ä¸‹æ¥å°±çœ‹çœ‹å„ä¸ªç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥.")]),s._v(" "),t("h5",{attrs:{id:"mysql-5-5ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-5-5ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[s._v("#")]),s._v(" MySQL 5.5ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥")]),s._v(" "),t("p",[s._v("å®˜æ–¹ MySQL 5.5 ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒå¹¶è¡Œå¤åˆ¶çš„. ä½†åœ¨ 2012 å¹´çš„æ—¶å€™, æˆ‘è‡ªå·±æœåŠ¡çš„ä¸šåŠ¡å‡ºçŽ°äº†ä¸¥é‡çš„ä¸»å¤‡å»¶è¿Ÿ, åŽŸå› å°±æ˜¯å¤‡åº“åªæœ‰å•çº¿ç¨‹å¤åˆ¶. ç„¶åŽæˆ‘å°±å…ˆåŽå†™äº†ä¸¤ä¸ªç‰ˆæœ¬çš„å¹¶è¡Œç­–ç•¥. è¿™é‡Œä»‹ç»ä¸€ä¸‹è¿™ä¸¤ä¸ªç‰ˆæœ¬çš„å¹¶è¡Œç­–ç•¥, å³"),t("strong",[s._v("æŒ‰è¡¨åˆ†å‘ç­–ç•¥å’ŒæŒ‰è¡Œåˆ†å‘ç­–ç•¥")]),s._v(", ä»¥å¸®åŠ©ä½ ç†è§£ MySQL å®˜æ–¹ç‰ˆæœ¬å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„è¿­ä»£.")]),s._v(" "),t("h6",{attrs:{id:"æŒ‰è¡¨åˆ†å‘ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æŒ‰è¡¨åˆ†å‘ç­–ç•¥"}},[s._v("#")]),s._v(" æŒ‰è¡¨åˆ†å‘ç­–ç•¥")]),s._v(" "),t("p",[s._v("æŒ‰è¡¨åˆ†å‘äº‹åŠ¡çš„åŸºæœ¬æ€è·¯æ˜¯, å¦‚æžœ"),t("strong",[s._v("ä¸¤ä¸ªäº‹åŠ¡æ›´æ–°ä¸åŒçš„è¡¨, å®ƒä»¬å°±å¯ä»¥å¹¶è¡Œ")]),s._v(". å› ä¸ºæ•°æ®æ˜¯å­˜å‚¨åœ¨è¡¨é‡Œçš„, æ‰€ä»¥æŒ‰è¡¨åˆ†å‘, å¯ä»¥ä¿è¯ä¸¤ä¸ª worker ä¸ä¼šæ›´æ–°åŒä¸€è¡Œ.")]),s._v(" "),t("p",[s._v("å½“ç„¶, å¦‚æžœ"),t("strong",[s._v("æœ‰è·¨è¡¨çš„äº‹åŠ¡, è¿˜æ˜¯è¦æŠŠä¸¤å¼ è¡¨æ”¾åœ¨ä¸€èµ·è€ƒè™‘")]),s._v("çš„. å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯æŒ‰è¡¨åˆ†å‘çš„è§„åˆ™.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/dba4ce813aebf1b7feecee71c1ee26fd-20230731161914-6hcrc28.png",alt:"",title:"æŒ‰è¡¨å¹¶è¡Œå¤åˆ¶ç¨‹æ¨¡åž‹"}})]),s._v(" "),t("p",[s._v('å¯ä»¥çœ‹åˆ°, æ¯ä¸ª worker çº¿ç¨‹å¯¹åº”ä¸€ä¸ª hash è¡¨, ç”¨äºŽä¿å­˜å½“å‰æ­£åœ¨è¿™ä¸ª worker çš„ "æ‰§è¡Œé˜Ÿåˆ—" é‡Œçš„äº‹åŠ¡æ‰€æ¶‰åŠçš„è¡¨. hash è¡¨çš„ key æ˜¯ "åº“å. è¡¨å", value æ˜¯ä¸€ä¸ªæ•°å­—, è¡¨ç¤ºé˜Ÿåˆ—ä¸­æœ‰å¤šå°‘ä¸ªäº‹åŠ¡ä¿®æ”¹è¿™ä¸ªè¡¨.')]),s._v(" "),t("p",[s._v("åœ¨æœ‰äº‹åŠ¡åˆ†é…ç»™ worker æ—¶, äº‹åŠ¡é‡Œé¢æ¶‰åŠçš„è¡¨ä¼šè¢«åŠ åˆ°å¯¹åº”çš„ hash è¡¨ä¸­. worker æ‰§è¡Œå®ŒæˆåŽ, è¿™ä¸ªè¡¨ä¼šè¢«ä»Ž hash è¡¨ä¸­åŽ»æŽ‰.")]),s._v(" "),t("p",[s._v('ä¸Šå›¾ä¸­, hash_table_1 è¡¨ç¤º, çŽ°åœ¨ worker_1 çš„ "å¾…æ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—"é‡Œ, æœ‰ 4 ä¸ªäº‹åŠ¡æ¶‰åŠåˆ° db1.t1 è¡¨, æœ‰ 1 ä¸ªäº‹åŠ¡æ¶‰åŠåˆ° db2.t2 è¡¨; hash_table_2 è¡¨ç¤º, çŽ°åœ¨ worker_2 ä¸­æœ‰ä¸€ä¸ªäº‹åŠ¡ä¼šæ›´æ–°åˆ°è¡¨ t3 çš„æ•°æ®.')]),s._v(" "),t("p",[s._v("å‡è®¾åœ¨å›¾ä¸­çš„æƒ…å†µä¸‹, coordinator ä»Žä¸­è½¬æ—¥å¿—ä¸­è¯»å…¥ä¸€ä¸ªæ–°äº‹åŠ¡ T, è¿™ä¸ªäº‹åŠ¡ä¿®æ”¹çš„è¡Œæ¶‰åŠåˆ°è¡¨ t1 å’Œ t3.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ç”¨äº‹åŠ¡ T çš„åˆ†é…æµç¨‹, æ¥çœ‹ä¸€ä¸‹åˆ†é…è§„åˆ™.")]),s._v(" "),t("ol",[t("li",[s._v("ç”±äºŽäº‹åŠ¡ T ä¸­æ¶‰åŠä¿®æ”¹è¡¨ t1, è€Œ worker_1 é˜Ÿåˆ—ä¸­æœ‰äº‹åŠ¡åœ¨ä¿®æ”¹è¡¨ t1, äº‹åŠ¡ T å’Œé˜Ÿåˆ—ä¸­çš„æŸä¸ªäº‹åŠ¡è¦ä¿®æ”¹åŒä¸€ä¸ªè¡¨çš„æ•°æ®, è¿™ç§æƒ…å†µäº‹åŠ¡ T å’Œ worker_1 æ˜¯å†²çªçš„.")]),s._v(" "),t("li",[s._v("æŒ‰ç…§è¿™ä¸ªé€»è¾‘, é¡ºåºåˆ¤æ–­äº‹åŠ¡ T å’Œæ¯ä¸ª worker é˜Ÿåˆ—çš„å†²çªå…³ç³», ä¼šå‘çŽ°äº‹åŠ¡ T è·Ÿ worker_2 ä¹Ÿå†²çª.")]),s._v(" "),t("li",[s._v("äº‹åŠ¡ T è·Ÿå¤šäºŽä¸€ä¸ª worker å†²çª, coordinator çº¿ç¨‹å°±è¿›å…¥ç­‰å¾….")]),s._v(" "),t("li",[s._v("æ¯ä¸ª worker ç»§ç»­æ‰§è¡Œ, åŒæ—¶ä¿®æ”¹ hash_table. å‡è®¾ hash_table_2 é‡Œé¢æ¶‰åŠåˆ°ä¿®æ”¹è¡¨ t3 çš„äº‹åŠ¡å…ˆæ‰§è¡Œå®Œæˆ, å°±ä¼šä»Ž hash_table_2 ä¸­æŠŠ db1.t3 è¿™ä¸€é¡¹åŽ»æŽ‰.")]),s._v(" "),t("li",[s._v("è¿™æ · coordinator ä¼šå‘çŽ°è·Ÿäº‹åŠ¡ T å†²çªçš„ worker åªæœ‰ worker_1 äº†, å› æ­¤å°±æŠŠå®ƒåˆ†é…ç»™ worker_1.")]),s._v(" "),t("li",[s._v("coordinator ç»§ç»­è¯»ä¸‹ä¸€ä¸ªä¸­è½¬æ—¥å¿—, ç»§ç»­åˆ†é…äº‹åŠ¡.")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, æ¯ä¸ªäº‹åŠ¡åœ¨åˆ†å‘çš„æ—¶å€™, è·Ÿæ‰€æœ‰ worker çš„å†²çªå…³ç³»åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§æƒ…å†µ:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœè·Ÿæ‰€æœ‰ worker éƒ½ä¸å†²çª, coordinator çº¿ç¨‹å°±ä¼šæŠŠè¿™ä¸ªäº‹åŠ¡åˆ†é…ç»™"),t("strong",[s._v("æœ€ç©ºé—²çš„ woker")]),s._v(";")]),s._v(" "),t("li",[s._v("å¦‚æžœ"),t("strong",[s._v("è·Ÿå¤šäºŽä¸€ä¸ª worker å†²çª, coordinator çº¿ç¨‹å°±è¿›å…¥ç­‰å¾…çŠ¶æ€")]),s._v(", ç›´åˆ°å’Œè¿™ä¸ªäº‹åŠ¡å­˜åœ¨å†²çªå…³ç³»çš„ worker åªå‰©ä¸‹ 1 ä¸ª;")]),s._v(" "),t("li",[s._v("å¦‚æžœ"),t("strong",[s._v("åªè·Ÿä¸€ä¸ª worker å†²çª, coordinator çº¿ç¨‹å°±ä¼šæŠŠè¿™ä¸ªäº‹åŠ¡åˆ†é…ç»™è¿™ä¸ªå­˜åœ¨å†²çªå…³ç³»çš„ worker")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæŒ‰è¡¨åˆ†å‘çš„æ–¹æ¡ˆ, åœ¨å¤šä¸ªè¡¨è´Ÿè½½å‡åŒ€çš„åœºæ™¯é‡Œåº”ç”¨æ•ˆæžœå¾ˆå¥½. ä½†å¦‚æžœç¢°åˆ°çƒ­ç‚¹è¡¨, æ¯”å¦‚æ‰€æœ‰çš„æ›´æ–°äº‹åŠ¡éƒ½ä¼šæ¶‰åŠåˆ°æŸä¸€ä¸ªè¡¨çš„æ—¶å€™, æ‰€æœ‰äº‹åŠ¡éƒ½ä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ª worker ä¸­, å°±å˜æˆå•çº¿ç¨‹å¤åˆ¶äº†.")]),s._v(" "),t("h6",{attrs:{id:"æŒ‰è¡Œåˆ†å‘ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æŒ‰è¡Œåˆ†å‘ç­–ç•¥"}},[s._v("#")]),s._v(" æŒ‰è¡Œåˆ†å‘ç­–ç•¥")]),s._v(" "),t("p",[s._v("è¦è§£å†³çƒ­ç‚¹è¡¨çš„å¹¶è¡Œå¤åˆ¶é—®é¢˜, å°±éœ€è¦ä¸€ä¸ªæŒ‰è¡Œå¹¶è¡Œå¤åˆ¶çš„æ–¹æ¡ˆ. æŒ‰è¡Œå¤åˆ¶çš„æ ¸å¿ƒæ€è·¯æ˜¯: "),t("strong",[s._v("å¦‚æžœä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ›´æ–°ç›¸åŒçš„è¡Œ, å®ƒä»¬åœ¨å¤‡åº“ä¸Šå¯ä»¥å¹¶è¡Œæ‰§è¡Œ. æ˜¾ç„¶è¿™ä¸ªæ¨¡å¼è¦æ±‚ binlog æ ¼å¼å¿…é¡»æ˜¯ row")]),s._v(".")]),s._v(" "),t("p",[s._v('è¿™æ—¶åˆ¤æ–­ä¸€ä¸ªäº‹åŠ¡ T å’Œ worker æ˜¯å¦å†²çª, ç”¨çš„å°±è§„åˆ™å°±ä¸æ˜¯"ä¿®æ”¹åŒä¸€ä¸ªè¡¨", è€Œæ˜¯ "'),t("strong",[s._v("ä¿®æ”¹åŒä¸€è¡Œ")]),s._v('".')]),s._v(" "),t("p",[s._v('æŒ‰è¡Œå¤åˆ¶å’ŒæŒ‰è¡¨å¤åˆ¶çš„æ•°æ®ç»“æž„å·®ä¸å¤š, ä¹Ÿæ˜¯ä¸ºæ¯ä¸ª worker, åˆ†é…ä¸€ä¸ª hash è¡¨. åªæ˜¯è¦å®žçŽ°æŒ‰è¡Œåˆ†å‘, è¿™æ—¶å€™çš„ key, å°±å¿…é¡»æ˜¯ "'),t("strong",[s._v("åº“å + è¡¨å + å”¯ä¸€é”®çš„å€¼")]),s._v('".')]),s._v(" "),t("p",[s._v('ä½†æ˜¯, è¿™ä¸ª "å”¯ä¸€é”®" åªæœ‰ä¸»é”® id è¿˜æ˜¯ä¸å¤Ÿçš„, è¿˜éœ€è¦è€ƒè™‘ä¸‹é¢è¿™ç§åœºæ™¯, è¡¨ t1 ä¸­é™¤äº†ä¸»é”®, è¿˜æœ‰å”¯ä¸€ç´¢å¼• a:')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("å‡è®¾æŽ¥ä¸‹æ¥è¦åœ¨ä¸»åº“æ‰§è¡Œè¿™ä¸¤ä¸ªäº‹åŠ¡:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b048ef5dcf1367e3905ce5d73426b493-20230731161914-mhvtylj.png",alt:"",title:"å”¯ä¸€é”®å†²çªç¤ºä¾‹"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸¤ä¸ªäº‹åŠ¡è¦"),t("strong",[s._v("æ›´æ–°çš„è¡Œçš„ä¸»é”®å€¼ä¸åŒ")]),s._v(", ä½†æ˜¯å¦‚æžœå®ƒä»¬è¢«åˆ†åˆ°ä¸åŒçš„ worker, å°±æœ‰å¯èƒ½ session B çš„è¯­å¥å…ˆæ‰§è¡Œ. è¿™æ—¶å€™ id=1 çš„è¡Œçš„ a çš„å€¼è¿˜æ˜¯ 1, å°±ä¼š"),t("strong",[s._v("æŠ¥å”¯ä¸€é”®å†²çª")]),s._v(".")]),s._v(" "),t("p",[s._v("å› æ­¤, åŸºäºŽè¡Œçš„ç­–ç•¥, "),t("strong",[s._v("äº‹åŠ¡ hash è¡¨ä¸­è¿˜éœ€è¦è€ƒè™‘å”¯ä¸€é”®")]),s._v(', å³ key åº”è¯¥æ˜¯ "'),t("strong",[s._v("åº“å + è¡¨å + ç´¢å¼• a çš„åå­— + a çš„å€¼")]),s._v('".')]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­, è¦åœ¨è¡¨ t1 ä¸Šæ‰§è¡Œ "),t("code",[s._v("update t1 set a=1 where id=2")]),s._v("â€‹ è¯­å¥, åœ¨ binlog é‡Œé¢è®°å½•äº†æ•´è¡Œçš„æ•°æ®ä¿®æ”¹å‰å„ä¸ªå­—æ®µçš„å€¼, å’Œä¿®æ”¹åŽå„ä¸ªå­—æ®µçš„å€¼.")]),s._v(" "),t("p",[s._v("å› æ­¤, coordinator åœ¨è§£æžè¿™ä¸ªè¯­å¥çš„ binlog çš„æ—¶å€™, è¿™ä¸ªäº‹åŠ¡çš„ hash è¡¨å°±æœ‰ä¸‰ä¸ªé¡¹:")]),s._v(" "),t("ol",[t("li",[s._v("â€‹"),t("code",[s._v('key=hash_func(db1+t1+"PRIMARY"+2)')]),s._v("â€‹, value=2; è¿™é‡Œ value=2 æ˜¯å› ä¸ºä¿®æ”¹å‰åŽçš„è¡Œ id å€¼ä¸å˜, å‡ºçŽ°äº†ä¸¤æ¬¡.")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v('key=hash_func(db1+t1+"a"+2)')]),s._v("â€‹, value=1, è¡¨ç¤ºä¼šå½±å“åˆ°è¿™ä¸ªè¡¨ a=2 çš„è¡Œ.")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v('key=hash_func(db1+t1+"a"+1)')]),s._v("â€‹, value=1, è¡¨ç¤ºä¼šå½±å“åˆ°è¿™ä¸ªè¡¨ a=1 çš„è¡Œ.")])]),s._v(" "),t("p",[s._v("å¯è§, **ç›¸æ¯”äºŽæŒ‰è¡¨å¹¶è¡Œåˆ†å‘ç­–ç•¥, æŒ‰è¡Œå¹¶è¡Œç­–ç•¥åœ¨å†³å®šçº¿ç¨‹åˆ†å‘çš„æ—¶å€™, éœ€è¦æ¶ˆè€—æ›´å¤šçš„è®¡ç®—èµ„æº. **ä½ å¯èƒ½ä¹Ÿå‘çŽ°äº†, è¿™ä¸¤ä¸ªæ–¹æ¡ˆå…¶å®žéƒ½æœ‰ä¸€äº›çº¦æŸæ¡ä»¶:")]),s._v(" "),t("ol",[t("li",[s._v("è¦èƒ½å¤Ÿä»Ž binlog é‡Œé¢è§£æžå‡ºè¡¨å, ä¸»é”®å€¼å’Œå”¯ä¸€ç´¢å¼•çš„å€¼. ä¹Ÿå°±æ˜¯è¯´, ä¸»åº“çš„ binlog æ ¼å¼"),t("strong",[s._v("å¿…é¡»æ˜¯ row")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("è¡¨å¿…é¡»æœ‰ä¸»é”®")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("ä¸èƒ½æœ‰å¤–é”®")]),s._v(". è¡¨ä¸Šå¦‚æžœæœ‰å¤–é”®, çº§è”æ›´æ–°çš„è¡Œä¸ä¼šè®°å½•åœ¨ binlog ä¸­, è¿™æ ·å†²çªæ£€æµ‹å°±ä¸å‡†ç¡®.")])]),s._v(" "),t("p",[s._v("ä½†å¥½åœ¨è¿™ä¸‰æ¡çº¦æŸè§„åˆ™, æœ¬æ¥å°±æ˜¯ DBA ä¹‹å‰è¦æ±‚ä¸šåŠ¡å¼€å‘äººå‘˜å¿…é¡»éµå®ˆçš„çº¿ä¸Šä½¿ç”¨è§„èŒƒ, æ‰€ä»¥è¿™ä¸¤ä¸ªå¹¶è¡Œå¤åˆ¶ç­–ç•¥åœ¨åº”ç”¨ä¸Šä¹Ÿæ²¡æœ‰ç¢°åˆ°ä»€ä¹ˆéº»çƒ¦.")]),s._v(" "),t("p",[s._v("å¯¹æ¯”æŒ‰è¡¨åˆ†å‘å’ŒæŒ‰è¡Œåˆ†å‘è¿™ä¸¤ä¸ªæ–¹æ¡ˆçš„è¯, æŒ‰è¡Œåˆ†å‘ç­–ç•¥çš„å¹¶è¡Œåº¦æ›´é«˜. ä¸è¿‡å¦‚æžœæ˜¯è¦æ“ä½œå¾ˆå¤šè¡Œçš„å¤§äº‹åŠ¡çš„è¯, æŒ‰è¡Œåˆ†å‘çš„ç­–ç•¥æœ‰ä¸¤ä¸ªé—®é¢˜:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("è€—è´¹å†…å­˜")]),s._v(". æ¯”å¦‚ä¸€ä¸ªè¯­å¥è¦åˆ é™¤ 100 ä¸‡è¡Œæ•°æ®, è¿™æ—¶å€™ hash è¡¨å°±è¦è®°å½• 100 ä¸‡ä¸ªé¡¹.")]),s._v(" "),t("li",[t("strong",[s._v("è€—è´¹ CPU")]),s._v(". è§£æž binlog, ç„¶åŽè®¡ç®— hash å€¼, å¯¹äºŽå¤§äº‹åŠ¡, è¿™ä¸ªæˆæœ¬è¿˜æ˜¯å¾ˆé«˜çš„.")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥åœ¨å®žçŽ°è¿™ä¸ªç­–ç•¥çš„æ—¶å€™ä¼šè®¾ç½®ä¸€ä¸ªé˜ˆå€¼, å•ä¸ªäº‹åŠ¡å¦‚æžœè¶…è¿‡è®¾ç½®çš„è¡Œæ•°é˜ˆå€¼(æ¯”å¦‚, å¦‚æžœå•ä¸ªäº‹åŠ¡æ›´æ–°çš„è¡Œæ•°è¶…è¿‡ 10 ä¸‡è¡Œ), å°±æš‚æ—¶é€€åŒ–ä¸ºå•çº¿ç¨‹æ¨¡å¼, é€€åŒ–è¿‡ç¨‹çš„é€»è¾‘å¤§æ¦‚æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("coordinator æš‚æ—¶å…ˆ hold ä½è¿™ä¸ªäº‹åŠ¡;")]),s._v(" "),t("li",[s._v("ç­‰å¾…æ‰€æœ‰ worker éƒ½æ‰§è¡Œå®Œæˆ, å˜æˆç©ºé˜Ÿåˆ—;")]),s._v(" "),t("li",[s._v("coordinator ç›´æŽ¥æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡;")]),s._v(" "),t("li",[s._v("æ¢å¤å¹¶è¡Œæ¨¡å¼.")])]),s._v(" "),t("p",[s._v("è¯»åˆ°è¿™é‡Œ, ä½ å¯èƒ½ä¼šæ„Ÿåˆ°å¥‡æ€ª, è¿™ä¸¤ä¸ªç­–ç•¥åˆæ²¡æœ‰è¢«åˆåˆ°å®˜æ–¹, æˆ‘ä¸ºä»€ä¹ˆè¦ä»‹ç»è¿™ä¹ˆè¯¦ç»†å‘¢? å…¶å®žä»‹ç»è¿™ä¸¤ä¸ªç­–ç•¥çš„ç›®çš„æ˜¯æŠ›ç –å¼•çŽ‰, æ–¹ä¾¿ä½ ç†è§£åŽé¢è¦ä»‹ç»çš„ç¤¾åŒºç‰ˆæœ¬ç­–ç•¥.")]),s._v(" "),t("h5",{attrs:{id:"mysql5-6ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql5-6ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[s._v("#")]),s._v(" MySQL5.6ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥")]),s._v(" "),t("p",[s._v("å®˜æ–¹ MySQL5.6 ç‰ˆæœ¬, æ”¯æŒäº†å¹¶è¡Œå¤åˆ¶, åªæ˜¯æ”¯æŒçš„ç²’åº¦æ˜¯"),t("strong",[s._v("æŒ‰åº“å¹¶è¡Œ")]),s._v(". ç†è§£äº†ä¸Šé¢ä»‹ç»çš„æŒ‰è¡¨åˆ†å‘ç­–ç•¥å’ŒæŒ‰è¡Œåˆ†å‘ç­–ç•¥, ä½ å°±ç†è§£äº†, "),t("strong",[s._v("ç”¨äºŽå†³å®šåˆ†å‘ç­–ç•¥çš„ hash è¡¨é‡Œ, key å°±æ˜¯æ•°æ®åº“å")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªç­–ç•¥çš„å¹¶è¡Œæ•ˆæžœ, å–å†³äºŽåŽ‹åŠ›æ¨¡åž‹. å¦‚æžœåœ¨ä¸»åº“ä¸Šæœ‰å¤šä¸ª DB, å¹¶ä¸”å„ä¸ª DB çš„åŽ‹åŠ›å‡è¡¡, ä½¿ç”¨è¿™ä¸ªç­–ç•¥çš„æ•ˆæžœä¼šå¾ˆå¥½.")]),s._v(" "),t("p",[s._v("ç›¸æ¯”äºŽæŒ‰è¡¨å’ŒæŒ‰è¡Œåˆ†å‘, è¿™ä¸ªç­–ç•¥æœ‰ä¸¤ä¸ªä¼˜åŠ¿:")]),s._v(" "),t("ol",[t("li",[s._v("æž„é€  hash å€¼çš„æ—¶å€™å¾ˆå¿«, åªéœ€è¦åº“å; è€Œä¸”ä¸€ä¸ªå®žä¾‹ä¸Š DB æ•°ä¹Ÿä¸ä¼šå¾ˆå¤š, ä¸ä¼šå‡ºçŽ°éœ€è¦æž„é€  100 ä¸‡ä¸ªé¡¹è¿™ç§æƒ…å†µ.")]),s._v(" "),t("li",[s._v("ä¸è¦æ±‚ binlog çš„æ ¼å¼. å› ä¸º statement æ ¼å¼çš„ binlog ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“æ‹¿åˆ°åº“å.")])]),s._v(" "),t("p",[s._v("ä½†å¦‚æžœä¸»åº“ä¸Šçš„è¡¨éƒ½æ”¾åœ¨åŒä¸€ä¸ª DB é‡Œé¢, è¿™ä¸ªç­–ç•¥å°±æ²¡æœ‰æ•ˆæžœäº†; æˆ–è€…å¦‚æžœä¸åŒ DB çš„çƒ­ç‚¹ä¸åŒ, æ¯”å¦‚ä¸€ä¸ªæ˜¯ä¸šåŠ¡é€»è¾‘åº“, ä¸€ä¸ªæ˜¯ç³»ç»Ÿé…ç½®åº“, é‚£ä¹Ÿèµ·ä¸åˆ°å¹¶è¡Œçš„æ•ˆæžœ. ç†è®ºä¸Šå¯ä»¥åˆ›å»ºä¸åŒçš„ DB, æŠŠç›¸åŒçƒ­åº¦çš„è¡¨å‡åŒ€åˆ†åˆ°è¿™äº›ä¸åŒçš„ DB ä¸­, å¼ºè¡Œä½¿ç”¨è¿™ä¸ªç­–ç•¥. ä¸è¿‡æ®æˆ‘æ‰€çŸ¥, ç”±äºŽéœ€è¦ç‰¹åœ°ç§»åŠ¨æ•°æ®, "),t("strong",[s._v("è¿™ä¸ªç­–ç•¥ç”¨å¾—å¹¶ä¸å¤š")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"mariadbçš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mariadbçš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[s._v("#")]),s._v(" MariaDBçš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº† redo log ç»„æäº¤ (group commit) ä¼˜åŒ–, è€Œ MariaDB çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥åˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªç‰¹æ€§:")]),s._v(" "),t("ol",[t("li",[s._v("**èƒ½å¤Ÿåœ¨åŒä¸€ç»„é‡Œæäº¤çš„äº‹åŠ¡, ä¸€å®šä¸ä¼šä¿®æ”¹åŒä¸€è¡Œ; **")]),s._v(" "),t("li",[t("strong",[s._v("ä¸»åº“ä¸Šå¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡, å¤‡åº“ä¸Šä¹Ÿä¸€å®šæ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„.")])])]),s._v(" "),t("p",[s._v("åœ¨å®žçŽ°ä¸Š, MariaDB æ˜¯è¿™ä¹ˆåšçš„:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("åœ¨ä¸€ç»„é‡Œé¢ä¸€èµ·æäº¤çš„äº‹åŠ¡, æœ‰ä¸€ä¸ªç›¸åŒçš„ commit_id, ä¸‹ä¸€ç»„å°±æ˜¯ commit_id+1;")])]),s._v(" "),t("li",[t("strong",[s._v("commit_id ç›´æŽ¥å†™åˆ° binlog é‡Œé¢;")])]),s._v(" "),t("li",[s._v("ä¼ åˆ°å¤‡åº“åº”ç”¨çš„æ—¶å€™, ç›¸åŒ commit_id çš„äº‹åŠ¡åˆ†å‘åˆ°å¤šä¸ª worker æ‰§è¡Œ;")]),s._v(" "),t("li",[t("strong",[s._v("è¿™ä¸€ç»„å…¨éƒ¨æ‰§è¡Œå®ŒæˆåŽ, coordinator å†åŽ»å–ä¸‹ä¸€æ‰¹")]),s._v(".")])]),s._v(" "),t("p",[s._v('å½“æ—¶è¿™ä¸ªç­–ç•¥å‡ºæ¥çš„æ—¶å€™æ˜¯ç›¸å½“æƒŠè‰³çš„. å› ä¸ºä¹‹å‰ä¸šç•Œçš„æ€è·¯éƒ½æ˜¯åœ¨ "åˆ†æž binlog, å¹¶æ‹†åˆ†åˆ° worker"ä¸Š. è€Œ MariaDB çš„è¿™ä¸ªç­–ç•¥, ç›®æ ‡æ˜¯ "'),t("strong",[s._v("æ¨¡æ‹Ÿä¸»åº“çš„å¹¶è¡Œæ¨¡å¼")]),s._v('".')]),s._v(" "),t("p",[s._v('ä½†è¿™ä¸ªç­–ç•¥æœ‰ä¸€ä¸ªé—®é¢˜, å®ƒå¹¶æ²¡æœ‰å®žçŽ° "çœŸæ­£çš„æ¨¡æ‹Ÿä¸»åº“å¹¶å‘åº¦" è¿™ä¸ªç›®æ ‡. åœ¨ä¸»åº“ä¸Š, ä¸€ç»„äº‹åŠ¡åœ¨ commit çš„æ—¶å€™, ä¸‹ä¸€ç»„äº‹åŠ¡æ˜¯åŒæ—¶å¤„äºŽ "æ‰§è¡Œä¸­" çŠ¶æ€çš„.')]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤º, å‡è®¾äº†ä¸‰ç»„äº‹åŠ¡åœ¨ä¸»åº“çš„æ‰§è¡Œæƒ…å†µ, å¯ä»¥çœ‹åˆ°åœ¨ trx1, trx2 å’Œ trx3 "),t("strong",[s._v("æäº¤")]),s._v("çš„æ—¶å€™, trx4, trx5 å’Œ trx6 æ˜¯åœ¨æ‰§è¡Œçš„. è¿™æ ·åœ¨ç¬¬ä¸€ç»„äº‹åŠ¡æäº¤å®Œæˆçš„æ—¶å€™, ä¸‹ä¸€ç»„äº‹åŠ¡å¾ˆå¿«å°±ä¼šè¿›å…¥ commit çŠ¶æ€.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a26f8826ecd45e492a4441ec5864db73-20230731161914-2u69znz.png",alt:"",title:"ä¸»åº“å¹¶è¡Œäº‹åŠ¡"}})]),s._v(" "),t("p",[s._v("è€ŒæŒ‰ç…§ MariaDB çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥, å¤‡åº“ä¸Šçš„æ‰§è¡Œæ•ˆæžœå¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/166496132894bda358685ab887d64c50-20230731161914-rt82djm.png",alt:"",title:"MariaDBå¹¶è¡Œå¤åˆ¶,å¤‡åº“å¹¶è¡Œæ•ˆæžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("åœ¨å¤‡åº“ä¸Šæ‰§è¡Œçš„æ—¶å€™, è¦ç­‰ç¬¬ä¸€ç»„äº‹åŠ¡å®Œå…¨æ‰§è¡Œå®ŒæˆåŽ, ç¬¬äºŒç»„äº‹åŠ¡æ‰èƒ½å¼€å§‹æ‰§è¡Œ, è¿™æ ·ç³»ç»Ÿçš„åžåé‡å°±ä¸å¤Ÿ")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦å¤–, è¿™ä¸ªæ–¹æ¡ˆå¾ˆå®¹æ˜“"),t("strong",[s._v("è¢«å¤§äº‹åŠ¡æ‹–åŽè…¿")]),s._v(". å‡è®¾ trx2 æ˜¯ä¸€ä¸ªè¶…å¤§äº‹åŠ¡, é‚£ä¹ˆåœ¨å¤‡åº“åº”ç”¨çš„æ—¶å€™, trx1 å’Œ trx3 æ‰§è¡Œå®ŒæˆåŽ, å°±åªèƒ½ç­‰ trx2 å®Œå…¨æ‰§è¡Œå®Œæˆ, ä¸‹ä¸€ç»„æ‰èƒ½å¼€å§‹æ‰§è¡Œ. è¿™æ®µæ—¶é—´, åªæœ‰ä¸€ä¸ª worker çº¿ç¨‹åœ¨å·¥ä½œ, æ˜¯å¯¹èµ„æºçš„æµªè´¹.")]),s._v(" "),t("p",[s._v("ä¸è¿‡å³ä½¿å¦‚æ­¤, è¿™ä¸ªç­–ç•¥ä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆæ¼‚äº®çš„åˆ›æ–°. å› ä¸ºå®ƒå¯¹åŽŸç³»ç»Ÿçš„æ”¹é€ éžå¸¸å°‘, å®žçŽ°ä¹Ÿå¾ˆä¼˜é›….")]),s._v(" "),t("h5",{attrs:{id:"mysql5-7çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql5-7çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[s._v("#")]),s._v(" MySQL5.7çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥")]),s._v(" "),t("p",[s._v("åœ¨ MariaDB å¹¶è¡Œå¤åˆ¶å®žçŽ°ä¹‹åŽ, å®˜æ–¹çš„ MySQL5.7 ç‰ˆæœ¬ä¹Ÿæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½, ç”±å‚æ•° "),t("strong",[s._v("slave-parallel-type")]),s._v(" æ¥æŽ§åˆ¶å¹¶è¡Œå¤åˆ¶ç­–ç•¥:")]),s._v(" "),t("ol",[t("li",[s._v("é…ç½®ä¸º DATABASE, è¡¨ç¤ºä½¿ç”¨ MySQL 5.6 ç‰ˆæœ¬çš„æŒ‰åº“å¹¶è¡Œç­–ç•¥;")]),s._v(" "),t("li",[s._v("é…ç½®ä¸º LOGICAL_CLOCK, è¡¨ç¤ºçš„å°±æ˜¯ç±»ä¼¼ MariaDB çš„ç­–ç•¥. ä¸è¿‡, MySQL 5.7 è¿™ä¸ªç­–ç•¥, é’ˆå¯¹å¹¶è¡Œåº¦åšäº†ä¼˜åŒ–. è¿™ä¸ªä¼˜åŒ–çš„æ€è·¯ä¹Ÿå¾ˆæœ‰è¶£.")])]),s._v(" "),t("p",[s._v("å¯ä»¥å…ˆè€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜: "),t("strong",[s._v('åŒæ—¶å¤„äºŽ "æ‰§è¡ŒçŠ¶æ€" çš„æ‰€æœ‰äº‹åŠ¡, æ˜¯ä¸æ˜¯å¯ä»¥å¹¶è¡Œ')]),s._v("?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("ä¸èƒ½")]),s._v(".")]),s._v(" "),t("p",[s._v("å› ä¸ºè¿™é‡Œé¢å¯èƒ½æœ‰ç”±äºŽé”å†²çªè€Œå¤„äºŽé”ç­‰å¾…çŠ¶æ€çš„äº‹åŠ¡. å¦‚æžœè¿™äº›äº‹åŠ¡åœ¨å¤‡åº“ä¸Šè¢«åˆ†é…åˆ°ä¸åŒçš„ worker, å°±ä¼šå‡ºçŽ°å¤‡åº“è·Ÿä¸»åº“ä¸ä¸€è‡´çš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("è€Œä¸Šé¢æåˆ°çš„ "),t("strong",[s._v('MariaDB è¿™ä¸ªç­–ç•¥çš„æ ¸å¿ƒ, æ˜¯ "æ‰€æœ‰å¤„äºŽ commit" çŠ¶æ€çš„äº‹åŠ¡å¯ä»¥å¹¶è¡Œ. äº‹åŠ¡å¤„äºŽ commit çŠ¶æ€, è¡¨ç¤ºå·²ç»é€šè¿‡äº†é”å†²çªçš„æ£€éªŒäº†')]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™å¯ä»¥å†å›žé¡¾ä¸€ä¸‹ä¸¤é˜¶æ®µæäº¤, å†è´´ä¸€ä¸‹è¿‡ç¨‹å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4141df161d231298b44260878c4d0667-20230731161914-5lllx22.png",alt:"",title:"ä¸¤é˜¶æ®µæäº¤ç»†åŒ–è¿‡ç¨‹å›¾"}})]),s._v(" "),t("p",[s._v("å…¶å®ž, ä¸ç”¨ç­‰åˆ° commit é˜¶æ®µ, "),t("strong",[s._v("åªè¦èƒ½å¤Ÿåˆ°è¾¾ redo log prepare é˜¶æ®µ, å°±è¡¨ç¤ºäº‹åŠ¡å·²ç»é€šè¿‡é”å†²çªçš„æ£€éªŒ")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("å› æ­¤, MySQL 5.7 å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„æ€æƒ³æ˜¯:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("åŒæ—¶å¤„äºŽ prepare çŠ¶æ€çš„äº‹åŠ¡, åœ¨å¤‡åº“æ‰§è¡Œæ—¶æ˜¯å¯ä»¥å¹¶è¡Œçš„")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("å¤„äºŽ prepare çŠ¶æ€çš„äº‹åŠ¡, ä¸Žå¤„äºŽ commit çŠ¶æ€çš„äº‹åŠ¡ä¹‹é—´, åœ¨å¤‡åº“æ‰§è¡Œæ—¶ä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œçš„")]),s._v(".")])]),s._v(" "),t("p",[s._v("å‰é¢è®² binlog çš„ç»„æäº¤çš„æ—¶å€™, ä»‹ç»è¿‡ä¸¤ä¸ªå‚æ•°:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("binlog_group_commit_sync_delay")]),s._v(" å‚æ•°, è¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åŽæ‰è°ƒç”¨ fsync;")]),s._v(" "),t("li",[t("strong",[s._v("binlog_group_commit_sync_no_delay_count")]),s._v(" å‚æ•°, è¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åŽæ‰è°ƒç”¨ fsync.")])]),s._v(" "),t("p",[s._v("è¿™ä¸¤ä¸ªå‚æ•°æ˜¯ç”¨äºŽæ•…æ„æ‹‰é•¿ binlog ä»Ž write åˆ° fsync çš„æ—¶é—´, ä»¥æ­¤å‡å°‘ binlog çš„å†™ç›˜æ¬¡æ•°. åœ¨ MySQL 5.7 çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥é‡Œ, å®ƒä»¬"),t("strong",[s._v('å¯ä»¥ç”¨æ¥åˆ¶é€ æ›´å¤šçš„ "åŒæ—¶å¤„äºŽ prepare é˜¶æ®µçš„äº‹åŠ¡"')]),s._v(" . è¿™æ ·å°±å¢žåŠ äº†å¤‡åº“å¤åˆ¶çš„å¹¶è¡Œåº¦.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸¤ä¸ªå‚æ•°, "),t("strong",[s._v('æ—¢å¯ä»¥ "æ•…æ„" è®©ä¸»åº“æäº¤å¾—æ…¢äº›, åˆå¯ä»¥è®©å¤‡åº“æ‰§è¡Œå¾—å¿«äº›')]),s._v(". åœ¨ MySQL 5.7 å¤„ç†å¤‡åº“å»¶è¿Ÿçš„æ—¶å€™, "),t("strong",[s._v("å¯ä»¥è€ƒè™‘è°ƒæ•´è¿™ä¸¤ä¸ªå‚æ•°å€¼, æ¥è¾¾åˆ°æå‡å¤‡åº“å¤åˆ¶å¹¶å‘åº¦çš„ç›®çš„")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"mysql5-7-22çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql5-7-22çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥"}},[s._v("#")]),s._v(" MySQL5.7.22çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥")]),s._v(" "),t("p",[s._v("åœ¨ 2018 å¹´ 4 æœˆä»½å‘å¸ƒçš„ MySQL 5.7.22 ç‰ˆæœ¬é‡Œ, MySQL å¢žåŠ äº†ä¸€ä¸ªæ–°çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥, "),t("strong",[s._v("åŸºäºŽ WRITESET çš„å¹¶è¡Œå¤åˆ¶")]),s._v(".")]),s._v(" "),t("p",[s._v("ç›¸åº”åœ°, æ–°å¢žäº†ä¸€ä¸ªå‚æ•° "),t("strong",[s._v("binlog-transaction-dependency-tracking")]),s._v(", ç”¨æ¥æŽ§åˆ¶æ˜¯å¦å¯ç”¨è¿™ä¸ªæ–°ç­–ç•¥. è¿™ä¸ªå‚æ•°çš„å¯é€‰å€¼æœ‰ä»¥ä¸‹ä¸‰ç§.")]),s._v(" "),t("ol",[t("li",[s._v("COMMIT_ORDER, è¡¨ç¤ºçš„å°±æ˜¯å‰é¢ä»‹ç»çš„, æ ¹æ®"),t("strong",[s._v("åŒæ—¶è¿›å…¥ prepare å’Œ commit æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥å¹¶è¡Œçš„ç­–ç•¥")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("WRITESET, è¡¨ç¤ºçš„æ˜¯å¯¹äºŽäº‹åŠ¡æ¶‰åŠæ›´æ–°çš„æ¯ä¸€è¡Œ, è®¡ç®—å‡ºè¿™ä¸€è¡Œçš„ hash å€¼, ç»„æˆé›†åˆ writeset. å¦‚æžœä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ“ä½œç›¸åŒçš„è¡Œ, ä¹Ÿå°±æ˜¯è¯´å®ƒä»¬çš„ writeset æ²¡æœ‰äº¤é›†, å°±å¯ä»¥å¹¶è¡Œ")]),s._v(".")]),s._v(" "),t("li",[s._v("WRITESET_SESSION, æ˜¯åœ¨ WRITESET çš„åŸºç¡€ä¸Šå¤šäº†ä¸€ä¸ªçº¦æŸ, å³"),t("strong",[s._v("åœ¨ä¸»åº“ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹å…ˆåŽæ‰§è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡, åœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™, è¦ä¿è¯ç›¸åŒçš„å…ˆåŽé¡ºåº")]),s._v(".")])]),s._v(" "),t("p",[s._v('å½“ç„¶ä¸ºäº†å”¯ä¸€æ ‡è¯†, è¿™ä¸ª hash å€¼æ˜¯é€šè¿‡ "'),t("strong",[s._v("åº“å + è¡¨å + ç´¢å¼•å + å€¼")]),s._v('" è®¡ç®—å‡ºæ¥çš„. å¦‚æžœä¸€ä¸ªè¡¨ä¸Šé™¤äº†æœ‰ä¸»é”®ç´¢å¼•å¤–, è¿˜æœ‰å…¶ä»–å”¯ä¸€ç´¢å¼•, é‚£ä¹ˆå¯¹äºŽæ¯ä¸ªå”¯ä¸€ç´¢å¼•, insert è¯­å¥å¯¹åº”çš„ writeset å°±è¦å¤šå¢žåŠ ä¸€ä¸ª hash å€¼.')]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½çœ‹å‡ºæ¥äº†, è¿™è·Ÿå‰é¢ä»‹ç»çš„åŸºäºŽ MySQL 5.5 ç‰ˆæœ¬çš„æŒ‰è¡Œåˆ†å‘çš„ç­–ç•¥æ˜¯å·®ä¸å¤šçš„. ä¸è¿‡ MySQL å®˜æ–¹çš„è¿™ä¸ªå®žçŽ°è¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("writeset æ˜¯åœ¨ä¸»åº“ç”ŸæˆåŽç›´æŽ¥å†™å…¥åˆ° binlog é‡Œé¢çš„")]),s._v(", è¿™æ ·åœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™, ä¸éœ€è¦è§£æž binlog å†…å®¹(event é‡Œçš„è¡Œæ•°æ®), èŠ‚çœäº†å¾ˆå¤šè®¡ç®—é‡;")]),s._v(" "),t("li",[t("strong",[s._v("ä¸éœ€è¦æŠŠæ•´ä¸ªäº‹åŠ¡çš„ binlog éƒ½æ‰«ä¸€éæ‰èƒ½å†³å®šåˆ†å‘åˆ°å“ªä¸ª worker, æ›´çœå†…å­˜")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("ç”±äºŽå¤‡åº“çš„åˆ†å‘ç­–ç•¥ä¸ä¾èµ–äºŽ binlog å†…å®¹, æ‰€ä»¥ binlog æ˜¯ statement æ ¼å¼ä¹Ÿæ˜¯å¯ä»¥çš„.")])])]),s._v(" "),t("p",[s._v("å› æ­¤ MySQL 5.7.22 çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥åœ¨é€šç”¨æ€§ä¸Šè¿˜æ˜¯æœ‰ä¿è¯çš„.")]),s._v(" "),t("p",[s._v('å½“ç„¶, å¯¹äºŽ"è¡¨ä¸Šæ²¡ä¸»é”®"å’Œ"å¤–é”®çº¦æŸ"çš„åœºæ™¯, WRITESET ç­–ç•¥ä¹Ÿæ˜¯æ²¡æ³•å¹¶è¡Œçš„, ä¹Ÿä¼šæš‚æ—¶é€€åŒ–ä¸ºå•çº¿ç¨‹æ¨¡åž‹.')]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-25"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-25"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL çš„"),t("strong",[s._v("å„ç§å¤šçº¿ç¨‹å¤åˆ¶ç­–ç•¥")]),s._v(". ä¸ºä»€ä¹ˆè¦æœ‰å¤šçº¿ç¨‹å¤åˆ¶å‘¢? è¿™æ˜¯å› ä¸ºå•çº¿ç¨‹å¤åˆ¶çš„èƒ½åŠ›å…¨é¢ä½ŽäºŽå¤šçº¿ç¨‹å¤åˆ¶, "),t("strong",[s._v("å¯¹äºŽæ›´æ–°åŽ‹åŠ›è¾ƒå¤§çš„ä¸»åº“, å¤‡åº“æ˜¯å¯èƒ½ä¸€ç›´è¿½ä¸ä¸Šä¸»åº“çš„")]),s._v(". ä»ŽçŽ°è±¡ä¸Šçœ‹å°±æ˜¯, å¤‡åº“ä¸Š seconds_behind_master çš„å€¼è¶Šæ¥è¶Šå¤§.")]),s._v(" "),t("p",[s._v("åœ¨ä»‹ç»å®Œæ¯ä¸ªå¹¶è¡Œå¤åˆ¶ç­–ç•¥åŽ, è¿˜å°±æ˜¯äº†ä¸åŒç­–ç•¥çš„ä¼˜ç¼ºç‚¹:")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æžœä½ æ˜¯ DBA, å°±éœ€è¦æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯, é€‰æ‹©ä¸åŒçš„ç­–ç•¥;")]),s._v(" "),t("li",[s._v("å¦‚æžœæ˜¯ä½ ä¸šåŠ¡å¼€å‘äººå‘˜, ä¹Ÿå¸Œæœ›ä½ èƒ½ä»Žä¸­èŽ·å–çµæ„Ÿç”¨åˆ°å¹³æ—¶çš„å¼€å‘å·¥ä½œä¸­.")])]),s._v(" "),t("p",[s._v("ä»Žè¿™äº›åˆ†æžä¸­, å¯ä»¥å‘çŽ°"),t("strong",[s._v("å¤§äº‹åŠ¡ä¸ä»…ä¼šå½±å“åˆ°ä¸»åº“, ä¹Ÿæ˜¯é€ æˆå¤‡åº“å¤åˆ¶å»¶è¿Ÿçš„ä¸»è¦åŽŸå› ä¹‹ä¸€")]),s._v(". å› æ­¤åœ¨å¹³æ—¶çš„å¼€å‘å·¥ä½œä¸­, "),t("mark",[t("strong",[s._v("å»ºè®®å°½é‡å‡å°‘å¤§äº‹åŠ¡æ“ä½œ, æŠŠå¤§äº‹åŠ¡æ‹†æˆå°äº‹åŠ¡")])]),s._v(".")]),s._v(" "),t("p",[s._v("å®˜æ–¹ MySQL5.7 ç‰ˆæœ¬æ–°å¢žçš„å¤‡åº“å¹¶è¡Œç­–ç•¥, ä¿®æ”¹äº† binlog çš„å†…å®¹, ä¹Ÿå°±æ˜¯è¯´ binlog åè®®å¹¶ä¸æ˜¯å‘ä¸Šå…¼å®¹çš„, åœ¨ä¸»å¤‡åˆ‡æ¢, ç‰ˆæœ¬å‡çº§çš„æ—¶å€™éœ€è¦æŠŠè¿™ä¸ªå› ç´ ä¹Ÿè€ƒè™‘è¿›åŽ».")]),s._v(" "),t("p",[s._v("æä¸€ä¸ªé—®é¢˜. å‡è®¾ä¸€ä¸ª MySQL 5.7.22 ç‰ˆæœ¬çš„ä¸»åº“, å•çº¿ç¨‹æ’å…¥äº†å¾ˆå¤šæ•°æ®, è¿‡äº† 3 ä¸ªå°æ—¶åŽ, æˆ‘ä»¬è¦ç»™è¿™ä¸ªä¸»åº“æ­å»ºä¸€ä¸ªç›¸åŒç‰ˆæœ¬çš„å¤‡åº“. è¿™æ—¶å€™, ä¸ºäº†æ›´å¿«åœ°è®©å¤‡åº“è¿½ä¸Šä¸»åº“, è¦å¼€å¹¶è¡Œå¤åˆ¶. åœ¨ binlog-transaction-dependency-tracking å‚æ•°çš„ COMMIT_ORDER, WRITESET å’Œ WRITE_SESSION è¿™ä¸‰ä¸ªå–å€¼ä¸­, ä½ ä¼šé€‰æ‹©å“ªä¸€ä¸ªå‘¢? ä½ é€‰æ‹©çš„åŽŸå› æ˜¯ä»€ä¹ˆ? å¦‚æžœè®¾ç½®å¦å¤–ä¸¤ä¸ªå‚æ•°, ä½ è®¤ä¸ºä¼šå‡ºçŽ°ä»€ä¹ˆçŽ°è±¡å‘¢?")]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯, åº”è¯¥å°†è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º "),t("strong",[s._v("WRITESET")]),s._v(".")]),s._v(" "),t("p",[s._v("ç”±äºŽä¸»åº“æ˜¯å•çº¿ç¨‹åŽ‹åŠ›æ¨¡å¼, æ‰€ä»¥"),t("strong",[s._v("æ¯ä¸ªäº‹åŠ¡çš„ commit_id éƒ½ä¸åŒ")]),s._v(", é‚£ä¹ˆè®¾ç½®ä¸º COMMIT_ORDER æ¨¡å¼çš„è¯, ä»Žåº“ä¹Ÿåªèƒ½å•çº¿ç¨‹æ‰§è¡Œ. åŒæ ·åœ°, ç”±äºŽ WRITESET_SESSION æ¨¡å¼è¦æ±‚åœ¨å¤‡åº“åº”ç”¨æ—¥å¿—çš„æ—¶å€™, åŒä¸€ä¸ªçº¿ç¨‹çš„æ—¥å¿—å¿…é¡»ä¸Žä¸»åº“ä¸Šæ‰§è¡Œçš„å…ˆåŽé¡ºåºç›¸åŒ, ä¹Ÿä¼šå¯¼è‡´ä¸»åº“å•çº¿ç¨‹åŽ‹åŠ›æ¨¡å¼ä¸‹é€€åŒ–æˆå•çº¿ç¨‹å¤åˆ¶. æ‰€ä»¥, åº”è¯¥å°† binlog-transaction-dependency-tracking è®¾ç½®ä¸º WRITESET.")]),s._v(" "),t("h4",{attrs:{id:"_27-ä¸»åº“å‡ºé—®é¢˜äº†-ä»Žåº“æ€Žä¹ˆåŠž"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_27-ä¸»åº“å‡ºé—®é¢˜äº†-ä»Žåº“æ€Žä¹ˆåŠž"}},[s._v("#")]),s._v(" 27-ä¸»åº“å‡ºé—®é¢˜äº†,ä»Žåº“æ€Žä¹ˆåŠž?")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº† MySQL ä¸»å¤‡å¤åˆ¶çš„åŸºç¡€ç»“æž„, ä½†è¿™äº›éƒ½æ˜¯"),t("strong",[s._v("ä¸€ä¸»ä¸€å¤‡")]),s._v("çš„ç»“æž„. å¤§å¤šæ•°çš„äº’è”ç½‘åº”ç”¨åœºæ™¯éƒ½æ˜¯è¯»å¤šå†™å°‘, å› æ­¤ä½ è´Ÿè´£çš„ä¸šåŠ¡, åœ¨å‘å±•è¿‡ç¨‹ä¸­å¾ˆå¯èƒ½å…ˆä¼šé‡åˆ°è¯»æ€§èƒ½çš„é—®é¢˜. è€Œåœ¨æ•°æ®åº“å±‚è§£å†³è¯»æ€§èƒ½é—®é¢˜, å°±è¦æ¶‰åŠåˆ°æŽ¥ä¸‹æ¥ä¸¤èŠ‚è¦è®¨è®ºçš„æž¶æž„: "),t("mark",[t("strong",[s._v("ä¸€ä¸»å¤šä»Ž")])]),s._v(".")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å°±å…ˆèŠèŠ"),t("strong",[s._v("ä¸€ä¸»å¤šä»Žçš„åˆ‡æ¢æ­£ç¡®æ€§")]),s._v(". ç„¶åŽåœ¨ä¸‹ä¸€èŠ‚ä¸­å†èŠèŠè§£å†³ä¸€ä¸»å¤šä»Žçš„æŸ¥è¯¢é€»è¾‘æ­£ç¡®æ€§çš„æ–¹æ³•.")]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä¸€ä¸»å¤šä»Žç»“æž„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/39c841e0c38199ec493b09f1552bddda-20230731161914-rou90ud.png",alt:"",title:"ä¸€ä¸»å¤šä»ŽåŸºæœ¬ç»“æž„"}})]),s._v(" "),t("p",[s._v("å›¾ä¸­, è™šçº¿ç®­å¤´è¡¨ç¤ºçš„æ˜¯"),t("strong",[s._v("ä¸»å¤‡å…³ç³»")]),s._v(", ä¹Ÿå°±æ˜¯ A å’Œ Aâ€™ äº’ä¸ºä¸»å¤‡,  ä»Žåº“ B, C, D æŒ‡å‘çš„æ˜¯ä¸»åº“ A. ä¸€ä¸»å¤šä»Žçš„è®¾ç½®, "),t("strong",[s._v("ä¸€èˆ¬ç”¨äºŽè¯»å†™åˆ†ç¦», ä¸»åº“è´Ÿè´£æ‰€æœ‰çš„å†™å…¥å’Œä¸€éƒ¨åˆ†è¯», å…¶ä»–çš„è¯»è¯·æ±‚åˆ™ç”±ä»Žåº“åˆ†æ‹…")]),s._v(".")]),s._v(" "),t("p",[s._v("ä»Šå¤©è¦è®¨è®ºçš„å°±æ˜¯, "),t("strong",[s._v("åœ¨ä¸€ä¸»å¤šä»Žæž¶æž„ä¸‹, ä¸»åº“æ•…éšœåŽçš„ä¸»å¤‡åˆ‡æ¢é—®é¢˜")]),s._v(". å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯ä¸»åº“å‘ç”Ÿæ•…éšœ, ä¸»å¤‡åˆ‡æ¢åŽçš„ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e15347e77baab4afa37605dbe2b68e28-20230731161914-wbrczi7.png",alt:"",title:"ä¸€ä¸»å¤šä»ŽåŸºæœ¬ç»“æž„-ä¸»å¤‡åˆ‡æ¢"}})]),s._v(" "),t("p",[s._v("ç›¸æ¯”äºŽä¸€ä¸»ä¸€å¤‡çš„åˆ‡æ¢æµç¨‹, "),t("strong",[s._v("ä¸€ä¸»å¤šä»Žç»“æž„åœ¨åˆ‡æ¢å®ŒæˆåŽ, Aâ€™ ä¼šæˆä¸ºæ–°çš„ä¸»åº“, ä»Žåº“ B, C, D ä¹Ÿè¦æ”¹æŽ¥åˆ° Aâ€™. æ­£æ˜¯ç”±äºŽå¤šäº†ä»Žåº“ B, C, D é‡æ–°æŒ‡å‘çš„è¿™ä¸ªè¿‡ç¨‹, æ‰€ä»¥ä¸»å¤‡åˆ‡æ¢çš„å¤æ‚æ€§ä¹Ÿç›¸åº”å¢žåŠ äº†")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥ä¸€èµ·çœ‹çœ‹ä¸€ä¸ªåˆ‡æ¢ç³»ç»Ÿä¼šæ€Žä¹ˆå®Œæˆä¸€ä¸»å¤šä»Žçš„ä¸»å¤‡åˆ‡æ¢è¿‡ç¨‹.")]),s._v(" "),t("h5",{attrs:{id:"åŸºäºŽä½ç‚¹çš„ä¸»å¤‡åˆ‡æ¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºŽä½ç‚¹çš„ä¸»å¤‡åˆ‡æ¢"}},[s._v("#")]),s._v(" åŸºäºŽä½ç‚¹çš„ä¸»å¤‡åˆ‡æ¢")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦å…ˆæ¥å›žé¡¾ä¸€ä¸ªçŸ¥è¯†ç‚¹.")]),s._v(" "),t("p",[s._v("å½“æŠŠèŠ‚ç‚¹ B è®¾ç½®æˆèŠ‚ç‚¹ Aâ€™ çš„ä»Žåº“çš„æ—¶å€™, éœ€è¦æ‰§è¡Œä¸€æ¡ "),t("strong",[s._v("change master")]),s._v(" å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("CHANGE MASTER "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" \nMASTER_HOST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$host_name \nMASTER_PORT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$port \nMASTER_USER"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$user_name \nMASTER_PASSWORD"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$password \nMASTER_LOG_FILE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$master_log_name \nMASTER_LOG_POS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$master_log_pos  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("è¿™æ¡å‘½ä»¤æœ‰ 6 ä¸ªå‚æ•°:")]),s._v(" "),t("ul",[t("li",[s._v("MASTER_HOST, MASTER_PORT, MASTER_USER å’Œ MASTER_PASSWORD å››ä¸ªå‚æ•°, åˆ†åˆ«ä»£è¡¨äº†ä¸»åº“ Aâ€™ çš„ IP, ç«¯å£, ç”¨æˆ·åå’Œå¯†ç .")]),s._v(" "),t("li",[s._v("æœ€åŽä¸¤ä¸ªå‚æ•° MASTER_LOG_FILE å’Œ MASTER_LOG_POS è¡¨ç¤º, è¦"),t("strong",[s._v("ä»Žä¸»åº“çš„ master_log_name æ–‡ä»¶çš„ master_log_pos è¿™ä¸ªä½ç½®çš„æ—¥å¿—ç»§ç»­åŒæ­¥")]),s._v(". è€Œè¿™ä¸ªä½ç½®å°±æ˜¯"),t("mark",[t("strong",[s._v("åŒæ­¥ä½ç‚¹, ä¹Ÿå°±æ˜¯ä¸»åº“å¯¹åº”çš„æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡")])]),s._v(".")])]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†, èŠ‚ç‚¹ B è¦è®¾ç½®æˆ Aâ€™ çš„ä»Žåº“, å°±è¦æ‰§è¡Œ change master å‘½ä»¤, å°±ä¸å¯é¿å…åœ°è¦è®¾ç½®ä½ç‚¹çš„è¿™ä¸¤ä¸ªå‚æ•°, ä½†æ˜¯"),t("strong",[s._v("è¿™ä¸¤ä¸ªå‚æ•°åˆ°åº•åº”è¯¥æ€Žä¹ˆè®¾ç½®å‘¢")]),s._v("?")]),s._v(" "),t("p",[t("strong",[s._v('åŽŸæ¥èŠ‚ç‚¹ B æ˜¯ A çš„ä»Žåº“, æœ¬åœ°è®°å½•çš„ä¹Ÿæ˜¯ A çš„ä½ç‚¹. ä½†æ˜¯ç›¸åŒçš„æ—¥å¿—, A çš„ä½ç‚¹å’Œ Aâ€™ çš„ä½ç‚¹æ˜¯ä¸åŒçš„. å› æ­¤, ä»Žåº“ B è¦åˆ‡æ¢çš„æ—¶å€™, å°±éœ€è¦å…ˆç»è¿‡"æ‰¾åŒæ­¥ä½ç‚¹"è¿™ä¸ªé€»è¾‘')]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªä½ç‚¹å¾ˆéš¾ç²¾ç¡®å–åˆ°, "),t("strong",[s._v("åªèƒ½å–ä¸€ä¸ªå¤§æ¦‚ä½ç½®")]),s._v(". ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢? æ¥åˆ†æžä¸€ä¸‹çœ‹çœ‹è¿™ä¸ªä½ç‚¹ä¸€èˆ¬æ˜¯æ€Žä¹ˆèŽ·å–åˆ°çš„, å°±æ¸…æ¥šå…¶ä¸­ä¸ç²¾ç¡®çš„åŽŸå› äº†.")]),s._v(" "),t("p",[s._v("è€ƒè™‘åˆ°åˆ‡æ¢è¿‡ç¨‹ä¸­"),t("strong",[s._v("ä¸èƒ½ä¸¢æ•°æ®")]),s._v(', æ‰€ä»¥æ‰¾ä½ç‚¹çš„æ—¶å€™, æ€»æ˜¯è¦æ‰¾ä¸€ä¸ª "'),t("strong",[s._v("ç¨å¾®å¾€å‰")]),s._v('" çš„, ç„¶åŽå†'),t("strong",[s._v("é€šè¿‡åˆ¤æ–­è·³è¿‡é‚£äº›åœ¨ä»Žåº“ B ä¸Šå·²ç»æ‰§è¡Œè¿‡çš„äº‹åŠ¡")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸€ç§å–åŒæ­¥ä½ç‚¹çš„æ–¹æ³•æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("ç­‰å¾…æ–°ä¸»åº“ Aâ€™ æŠŠä¸­è½¬æ—¥å¿—(relay log)å…¨éƒ¨åŒæ­¥å®Œæˆ;")]),s._v(" "),t("li",[s._v("åœ¨ Aâ€™ ä¸Šæ‰§è¡Œ show master status å‘½ä»¤, å¾—åˆ°å½“å‰ Aâ€™ ä¸Šæœ€æ–°çš„ File å’Œ Position;")]),s._v(" "),t("li",[s._v("å–åŽŸä¸»åº“ A æ•…éšœçš„æ—¶åˆ» T;")]),s._v(" "),t("li",[s._v("ç”¨ mysqlbinlog å·¥å…·è§£æž Aâ€™ çš„ File, å¾—"),t("strong",[s._v("åˆ° T æ—¶åˆ»çš„ä½ç‚¹")]),s._v(".")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysqlbinlog "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("File")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--stop-datetime=T --start-datetime=T")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Â·Â·Â·")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c196fc91bf5d81f9e12d6592ae2e470e-20230731161914-2ulky2x.png",alt:"",title:"mysqlbinlogéƒ¨åˆ†è¾“å‡ºç»“æžœ"}})]),s._v(" "),t("p",[s._v('å›¾ä¸­, end_log_pos åŽé¢çš„å€¼ "123", è¡¨ç¤ºçš„å°±æ˜¯ Aâ€™ è¿™ä¸ªå®žä¾‹, åœ¨ T æ—¶åˆ»å†™å…¥æ–°çš„ binlog çš„ä½ç½®. ç„¶åŽå°±å¯ä»¥æŠŠ 123 è¿™ä¸ªå€¼ä½œä¸º '),t("code",[s._v("$master_log_pos")]),s._v("â€‹, ç”¨åœ¨èŠ‚ç‚¹ B çš„ change master å‘½ä»¤é‡Œ.")]),s._v(" "),t("p",[s._v("å½“ç„¶è¿™ä¸ªå€¼"),t("strong",[s._v("å¹¶ä¸ç²¾ç¡®")]),s._v(". ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("å¯ä»¥è®¾æƒ³æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µ, å‡è®¾åœ¨ T è¿™ä¸ªæ—¶åˆ», ä¸»åº“ A å·²ç»æ‰§è¡Œå®Œæˆäº†ä¸€ä¸ª insert è¯­å¥æ’å…¥äº†ä¸€è¡Œæ•°æ® R, å¹¶ä¸”å·²ç»å°† binlog ä¼ ç»™äº† Aâ€™ å’Œ B, ç„¶åŽåœ¨ä¼ å®Œçš„çž¬é—´ä¸»åº“ A çš„ä¸»æœºå°±æŽ‰ç”µäº†.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆè¿™æ—¶å€™ç³»ç»Ÿçš„çŠ¶æ€æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨ä»Žåº“ B ä¸Š, ç”±äºŽåŒæ­¥äº† binlog, R è¿™ä¸€è¡Œå·²ç»å­˜åœ¨;")]),s._v(" "),t("li",[s._v("åœ¨æ–°ä¸»åº“ Aâ€™ ä¸Š, R è¿™ä¸€è¡Œä¹Ÿå·²ç»å­˜åœ¨, æ—¥å¿—æ˜¯å†™åœ¨ 123 è¿™ä¸ªä½ç½®ä¹‹åŽçš„;")]),s._v(" "),t("li",[s._v("åœ¨ä»Žåº“ B ä¸Šæ‰§è¡Œ change master å‘½ä»¤, æŒ‡å‘ Aâ€™ çš„ File æ–‡ä»¶çš„ 123 ä½ç½®, å°±ä¼šæŠŠæ’å…¥ R è¿™ä¸€è¡Œæ•°æ®çš„ binlog åˆåŒæ­¥åˆ°ä»Žåº“ B åŽ»æ‰§è¡Œ.")])]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™, ä»Žåº“ B çš„åŒæ­¥çº¿ç¨‹å°±ä¼šæŠ¥å‘Š "),t("code",[s._v("Duplicate entry 'id_of_R' for key 'PRIMARY'")]),s._v("â€‹ é”™è¯¯, æç¤ºå‡ºçŽ°äº†ä¸»é”®å†²çª, ç„¶åŽåœæ­¢åŒæ­¥.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, **é€šå¸¸æƒ…å†µä¸‹, åœ¨åˆ‡æ¢ä»»åŠ¡çš„æ—¶å€™, è¦å…ˆä¸»åŠ¨è·³è¿‡è¿™äº›é”™è¯¯, æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•. **")]),s._v(" "),t("p",[t("strong",[s._v("ä¸€ç§åšæ³•æ˜¯")]),s._v(", ä¸»åŠ¨è·³è¿‡ä¸€ä¸ªäº‹åŠ¡. è·³è¿‡å‘½ä»¤çš„å†™æ³•æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" sql_slave_skip_counter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å› ä¸ºåˆ‡æ¢è¿‡ç¨‹ä¸­, å¯èƒ½ä¼šä¸æ­¢é‡å¤æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡, æ‰€ä»¥éœ€è¦åœ¨ä»Žåº“ B åˆšå¼€å§‹æŽ¥åˆ°æ–°ä¸»åº“ Aâ€™ æ—¶, æŒç»­è§‚å¯Ÿ, æ¯æ¬¡ç¢°åˆ°è¿™äº›é”™è¯¯å°±åœä¸‹æ¥, æ‰§è¡Œä¸€æ¬¡è·³è¿‡å‘½ä»¤, ç›´åˆ°ä¸å†å‡ºçŽ°åœä¸‹æ¥çš„æƒ…å†µ, ä»¥æ­¤æ¥è·³è¿‡å¯èƒ½æ¶‰åŠçš„æ‰€æœ‰äº‹åŠ¡.")]),s._v(" "),t("p",[s._v("**å¦å¤–ä¸€ç§æ–¹å¼æ˜¯, ** é€šè¿‡è®¾ç½® "),t("strong",[s._v("slave_skip_errors")]),s._v(" å‚æ•°, ç›´æŽ¥è®¾ç½®è·³è¿‡æŒ‡å®šçš„é”™è¯¯.")]),s._v(" "),t("p",[s._v("åœ¨æ‰§è¡Œä¸»å¤‡åˆ‡æ¢æ—¶, æœ‰è¿™ä¹ˆä¸¤ç±»é”™è¯¯, æ˜¯ç»å¸¸ä¼šé‡åˆ°çš„:")]),s._v(" "),t("ul",[t("li",[s._v("1062 é”™è¯¯æ˜¯æ’å…¥æ•°æ®æ—¶å”¯ä¸€é”®å†²çª;")]),s._v(" "),t("li",[s._v("1032 é”™è¯¯æ˜¯åˆ é™¤æ•°æ®æ—¶æ‰¾ä¸åˆ°è¡Œ.")])]),s._v(" "),t("p",[s._v('å› æ­¤å¯ä»¥æŠŠ slave_skip_errors è®¾ç½®ä¸º "1032,1062", è¿™æ ·ä¸­é—´ç¢°åˆ°è¿™ä¸¤ä¸ªé”™è¯¯æ—¶å°±ç›´æŽ¥è·³è¿‡.')]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, è¿™ç§ç›´æŽ¥è·³è¿‡æŒ‡å®šé”™è¯¯çš„æ–¹æ³•, "),t("strong",[s._v("é’ˆå¯¹çš„æ˜¯ä¸»å¤‡åˆ‡æ¢æ—¶, ç”±äºŽæ‰¾ä¸åˆ°ç²¾ç¡®çš„åŒæ­¥ä½ç‚¹, æ‰€ä»¥åªèƒ½é‡‡ç”¨è¿™ç§æ–¹æ³•æ¥åˆ›å»ºä»Žåº“å’Œæ–°ä¸»åº“çš„ä¸»å¤‡å…³ç³»")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªèƒŒæ™¯æ˜¯, æˆ‘ä»¬å¾ˆæ¸…æ¥šåœ¨ä¸»å¤‡åˆ‡æ¢è¿‡ç¨‹ä¸­, ç›´æŽ¥è·³è¿‡ 1032 å’Œ 1062 è¿™ä¸¤ç±»é”™è¯¯æ˜¯"),t("strong",[s._v("æ— æŸ")]),s._v("çš„, æ‰€ä»¥æ‰å¯ä»¥è¿™ä¹ˆè®¾ç½® slave_skip_errors å‚æ•°. ç­‰åˆ°ä¸»å¤‡é—´çš„åŒæ­¥å…³ç³»å»ºç«‹å®Œæˆ, å¹¶ç¨³å®šæ‰§è¡Œä¸€æ®µæ—¶é—´ä¹‹åŽ, è¿˜éœ€è¦æŠŠè¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºç©º, ä»¥å…ä¹‹åŽçœŸçš„å‡ºçŽ°äº†ä¸»ä»Žæ•°æ®ä¸ä¸€è‡´, ä¹Ÿè·³è¿‡äº†.")]),s._v(" "),t("h5",{attrs:{id:"gtid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gtid"}},[s._v("#")]),s._v(" GTID")]),s._v(" "),t("p",[s._v("é€šè¿‡ sql_slave_skip_counter è·³è¿‡äº‹åŠ¡å’Œé€šè¿‡ slave_skip_errors å¿½ç•¥é”™è¯¯çš„æ–¹æ³•, è™½ç„¶éƒ½æœ€ç»ˆå¯ä»¥å»ºç«‹ä»Žåº“ B å’Œæ–°ä¸»åº“ Aâ€™ çš„ä¸»å¤‡å…³ç³», ä½†è¿™ä¸¤ç§æ“ä½œéƒ½å¾ˆå¤æ‚, è€Œä¸”å®¹æ˜“å‡ºé”™. æ‰€ä»¥ MySQL 5.6 ç‰ˆæœ¬å¼•å…¥äº† GTID, å½»åº•è§£å†³äº†è¿™ä¸ªå›°éš¾. GTID æ˜¯ä»€ä¹ˆæ„æ€, åˆæ˜¯å¦‚ä½•è§£å†³æ‰¾åŒæ­¥ä½ç‚¹è¿™ä¸ªé—®é¢˜å‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("GTID çš„å…¨ç§°æ˜¯ Global Transaction Identifier, ä¹Ÿå°±æ˜¯å…¨å±€äº‹åŠ¡ ID, æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨æäº¤çš„æ—¶å€™ç”Ÿæˆçš„, æ˜¯è¿™ä¸ªäº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†")]),s._v(". å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆ, æ ¼å¼æ˜¯:")]),s._v(" "),t("blockquote",[t("p",[s._v("GTID=server_uuid:gno")])]),s._v(" "),t("p",[s._v("å…¶ä¸­:")]),s._v(" "),t("ul",[t("li",[s._v("server_uuid æ˜¯ä¸€ä¸ªå®žä¾‹ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„, æ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å€¼;")]),s._v(" "),t("li",[s._v("gno æ˜¯ä¸€ä¸ªæ•´æ•°, åˆå§‹å€¼æ˜¯ 1, æ¯æ¬¡æäº¤äº‹åŠ¡çš„æ—¶å€™åˆ†é…ç»™è¿™ä¸ªäº‹åŠ¡, å¹¶åŠ  1.")])]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦è¯´æ˜Žä¸€ä¸‹, åœ¨ MySQL çš„å®˜æ–¹æ–‡æ¡£é‡Œ, GTID æ ¼å¼æ˜¯è¿™ä¹ˆå®šä¹‰çš„:")]),s._v(" "),t("blockquote",[t("p",[s._v("GTID=source_id:transaction_id")])]),s._v(" "),t("p",[s._v("è¿™é‡Œçš„ source_id å°±æ˜¯ server_uuid; è€ŒåŽé¢çš„è¿™ä¸ª transaction_id, æˆ‘è§‰å¾—å®¹æ˜“é€ æˆè¯¯å¯¼, æ‰€ä»¥æˆ‘æ”¹æˆäº† gno. ä¸ºä»€ä¹ˆè¯´ä½¿ç”¨ transaction_id å®¹æ˜“é€ æˆè¯¯è§£å‘¢?")]),s._v(" "),t("p",[s._v("å› ä¸º, åœ¨ MySQL é‡Œé¢æˆ‘ä»¬è¯´ transaction_id å°±æ˜¯æŒ‡äº‹åŠ¡ id, äº‹åŠ¡ id æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†é…çš„, å¦‚æžœè¿™ä¸ªäº‹åŠ¡å›žæ»šäº†, äº‹åŠ¡ id ä¹Ÿä¼šé€’å¢ž, "),t("strong",[s._v("è€Œ gno æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™æ‰ä¼šåˆ†é…")]),s._v(".")]),s._v(" "),t("p",[s._v("ä»Žæ•ˆæžœä¸Šçœ‹, GTID å¾€å¾€æ˜¯è¿žç»­çš„, å› æ­¤ç”¨ gno æ¥è¡¨ç¤ºæ›´å®¹æ˜“ç†è§£.")]),s._v(" "),t("p",[s._v("GTID æ¨¡å¼çš„å¯åŠ¨ä¹Ÿå¾ˆç®€å•, åªéœ€è¦åœ¨å¯åŠ¨ä¸€ä¸ª MySQL å®žä¾‹çš„æ—¶å€™, "),t("strong",[s._v("åŠ ä¸Šå‚æ•° gtid_mode=on å’Œ enforce_gtid_consistency=on")]),s._v(" å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[t("strong",[s._v("åœ¨ GTID æ¨¡å¼ä¸‹, æ¯ä¸ªäº‹åŠ¡éƒ½ä¼šè·Ÿä¸€ä¸ª GTID ä¸€ä¸€å¯¹åº”")]),s._v(". è¿™ä¸ª GTID æœ‰ä¸¤ç§ç”Ÿæˆæ–¹å¼, è€Œä½¿ç”¨å“ªç§æ–¹å¼å–å†³äºŽ session å˜é‡ gtid_next çš„å€¼.")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœ gtid_next=automatic, ä»£è¡¨ä½¿ç”¨é»˜è®¤å€¼. è¿™æ—¶ MySQL å°±ä¼šæŠŠ server_uuid:gno åˆ†é…ç»™è¿™ä¸ªäº‹åŠ¡. (1) è®°å½• binlog çš„æ—¶å€™, å…ˆè®°å½•ä¸€è¡Œ "),t("code",[s._v("SET @@SESSION.GTID_NEXT='â€˜server_uuid:gno';")]),s._v("â€‹ (2)æŠŠè¿™ä¸ª GTID åŠ å…¥æœ¬å®žä¾‹çš„ GTID é›†åˆ.")]),s._v(" "),t("li",[s._v("å¦‚æžœ gtid_next æ˜¯ä¸€ä¸ªæŒ‡å®šçš„ GTID çš„å€¼, æ¯”å¦‚é€šè¿‡ "),t("code",[s._v("set gtid_next='current_gtid'")]),s._v("â€‹ æŒ‡å®šä¸º current_gtid, é‚£ä¹ˆå°±æœ‰ä¸¤ç§å¯èƒ½: (1)å¦‚æžœ current_gtid å·²ç»å­˜åœ¨äºŽå®žä¾‹çš„ GTID é›†åˆä¸­, æŽ¥ä¸‹æ¥æ‰§è¡Œçš„è¿™ä¸ªäº‹åŠ¡ä¼šç›´æŽ¥è¢«ç³»ç»Ÿå¿½ç•¥; (2)å¦‚æžœ current_gtid æ²¡æœ‰å­˜åœ¨äºŽå®žä¾‹çš„ GTID é›†åˆä¸­, å°±å°†è¿™ä¸ª current_gtid åˆ†é…ç»™æŽ¥ä¸‹æ¥è¦æ‰§è¡Œçš„äº‹åŠ¡, ä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿä¸éœ€è¦ç»™è¿™ä¸ªäº‹åŠ¡ç”Ÿæˆæ–°çš„ GTID, å› æ­¤ gno ä¹Ÿä¸ç”¨åŠ  1.")])]),s._v(" "),t("p",[s._v("æ³¨æ„, ä¸€ä¸ª current_gtid åªèƒ½ç»™ä¸€ä¸ªäº‹åŠ¡ä½¿ç”¨. è¿™ä¸ªäº‹åŠ¡æäº¤åŽ, å¦‚æžœè¦æ‰§è¡Œä¸‹ä¸€ä¸ªäº‹åŠ¡, å°±è¦æ‰§è¡Œ set å‘½ä»¤, æŠŠ gtid_next è®¾ç½®æˆå¦å¤–ä¸€ä¸ª gtid æˆ–è€… automatic.")]),s._v(" "),t("p",[s._v('è¿™æ ·æ¯ä¸ª MySQL å®žä¾‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ª GTID é›†åˆ, ç”¨æ¥å¯¹åº” "'),t("strong",[s._v("è¿™ä¸ªå®žä¾‹æ‰§è¡Œè¿‡çš„æ‰€æœ‰äº‹åŠ¡")]),s._v('".')]),s._v(" "),t("p",[s._v("è¿™æ ·çœ‹ä¸ŠåŽ»ä¸å¤ªå®¹æ˜“ç†è§£, æŽ¥ä¸‹æ¥å°±ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­, æ¥è¯´æ˜Ž GTID çš„åŸºæœ¬ç”¨æ³•.")]),s._v(" "),t("p",[s._v("åœ¨å®žä¾‹ X ä¸­åˆ›å»ºä¸€ä¸ªè¡¨ t.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/faa850cffaaf266623752059a45af986-20230731161914-rjsapn9.png",alt:"",title:"åˆå§‹åŒ–æ•°æ®çš„binlog"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, äº‹åŠ¡çš„ BEGIN ä¹‹å‰æœ‰ä¸€æ¡ "),t("code",[s._v("SET @@SESSION.GTID_NEXT")]),s._v("â€‹ å‘½ä»¤. è¿™æ—¶å¦‚æžœå®žä¾‹ X æœ‰ä»Žåº“, é‚£ä¹ˆå°† CREATE TABLE å’Œ insert è¯­å¥çš„ binlog åŒæ­¥è¿‡åŽ»æ‰§è¡Œçš„è¯, æ‰§è¡Œäº‹åŠ¡ä¹‹å‰å°±ä¼šå…ˆæ‰§è¡Œè¿™ä¸¤ä¸ª SET å‘½ä»¤, è¿™æ ·è¢«åŠ å…¥ä»Žåº“çš„ GTID é›†åˆçš„, å°±æ˜¯å›¾ä¸­çš„è¿™ä¸¤ä¸ª GTID.")]),s._v(" "),t("p",[s._v("å‡è®¾, çŽ°åœ¨è¿™ä¸ªå®žä¾‹ X æ˜¯å¦å¤–ä¸€ä¸ªå®žä¾‹ Y çš„ä»Žåº“, å¹¶ä¸”æ­¤æ—¶åœ¨å®žä¾‹ Y ä¸Šæ‰§è¡Œäº†ä¸‹é¢è¿™æ¡æ’å…¥è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v('å¹¶ä¸”è¿™æ¡è¯­å¥åœ¨å®žä¾‹ Y ä¸Šçš„ GTID æ˜¯ "'),t("code",[s._v("aaaaaaaa-cccc-dddd-eeee-ffffffffffff:10")]),s._v('â€‹".')]),s._v(" "),t("p",[s._v("é‚£ä¹ˆå®žä¾‹ X ä½œä¸º Y çš„ä»Žåº“, å°±è¦åŒæ­¥è¿™ä¸ªäº‹åŠ¡è¿‡æ¥æ‰§è¡Œ, æ˜¾ç„¶ä¼šå‡ºçŽ°ä¸»é”®å†²çª, å¯¼è‡´å®žä¾‹ X çš„åŒæ­¥çº¿ç¨‹åœæ­¢. è¿™æ—¶, åº”è¯¥æ€Žä¹ˆå¤„ç†å‘¢? å¤„ç†æ–¹æ³•å°±æ˜¯, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„è¿™ä¸ªè¯­å¥åºåˆ—:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" gtid_next"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aaaaaaaa-cccc-dddd-eeee-ffffffffffff:10'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" gtid_next"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("automatic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("å…¶ä¸­, å‰ä¸‰æ¡è¯­å¥çš„ä½œç”¨, æ˜¯é€šè¿‡æäº¤ä¸€ä¸ªç©ºäº‹åŠ¡, æŠŠè¿™ä¸ª GTID åŠ åˆ°å®žä¾‹ X çš„ GTID é›†åˆä¸­. å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯æ‰§è¡Œå®Œè¿™ä¸ªç©ºäº‹åŠ¡ä¹‹åŽçš„ show master status çš„ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/bc32d9009fcc59b6d73d88dc8c50d6f7-20230731161914-ss86dms.png",alt:"",title:"show master statusç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°å®žä¾‹ X çš„ Executed_Gtid_set é‡Œé¢, å·²ç»åŠ å…¥äº†è¿™ä¸ª GTID.")]),s._v(" "),t("p",[s._v('è¿™æ ·, å†æ‰§è¡Œ start slave å‘½ä»¤è®©åŒæ­¥çº¿ç¨‹æ‰§è¡Œèµ·æ¥çš„æ—¶å€™, è™½ç„¶å®žä¾‹ X ä¸Šè¿˜æ˜¯ä¼šç»§ç»­æ‰§è¡Œå®žä¾‹ Y ä¼ è¿‡æ¥çš„äº‹åŠ¡, ä½†æ˜¯ç”±äºŽ "'),t("code",[s._v("aaaaaaaa-cccc-dddd-eeee-ffffffffffff:10")]),s._v('â€‹" å·²ç»å­˜åœ¨äºŽå®žä¾‹ X çš„ GTID é›†åˆä¸­äº†, æ‰€ä»¥å®žä¾‹ X å°±ä¼š'),t("strong",[s._v("ç›´æŽ¥è·³è¿‡è¿™ä¸ªäº‹åŠ¡, ä¹Ÿå°±ä¸ä¼šå†å‡ºçŽ°ä¸»é”®å†²çªçš„é”™è¯¯")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šé¢çš„è¿™ä¸ªè¯­å¥åºåˆ—ä¸­, start slave å‘½ä»¤ä¹‹å‰è¿˜æœ‰ä¸€å¥ "),t("code",[s._v("set gtid_next=automatic")]),s._v('â€‹. è¿™å¥è¯çš„ä½œç”¨æ˜¯"æ¢å¤ GTID çš„é»˜è®¤åˆ†é…è¡Œä¸º", ä¹Ÿå°±æ˜¯è¯´å¦‚æžœä¹‹åŽæœ‰æ–°çš„äº‹åŠ¡å†æ‰§è¡Œ, å°±è¿˜æ˜¯æŒ‰ç…§åŽŸæ¥çš„åˆ†é…æ–¹å¼, ç»§ç»­åˆ†é… gno=3.')]),s._v(" "),t("h5",{attrs:{id:"åŸºäºŽgtidçš„ä¸»å¤‡åˆ‡æ¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºŽgtidçš„ä¸»å¤‡åˆ‡æ¢"}},[s._v("#")]),s._v(" åŸºäºŽGTIDçš„ä¸»å¤‡åˆ‡æ¢")]),s._v(" "),t("p",[s._v("çŽ°åœ¨å·²ç»ç†è§£ GTID çš„æ¦‚å¿µ, å†ä¸€èµ·æ¥çœ‹çœ‹åŸºäºŽ GTID çš„ä¸»å¤‡å¤åˆ¶çš„ç”¨æ³•.")]),s._v(" "),t("p",[s._v("åœ¨ GTID æ¨¡å¼ä¸‹, å¤‡åº“ B è¦è®¾ç½®ä¸ºæ–°ä¸»åº“ Aâ€™ çš„ä»Žåº“çš„è¯­æ³•å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("CHANGE MASTER "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" \nMASTER_HOST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$host_name \nMASTER_PORT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$port \nMASTER_USER"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$user_name \nMASTER_PASSWORD"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$password \nmaster_auto_position"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("å…¶ä¸­, master_auto_position=1 å°±è¡¨ç¤ºè¿™ä¸ª"),t("strong",[s._v("ä¸»å¤‡å…³ç³»ä½¿ç”¨çš„æ˜¯ GTID åè®®")]),s._v(". å¯ä»¥çœ‹åˆ°, å‰é¢è®©æˆ‘ä»¬å¤´ç–¼ä¸å·²çš„ MASTER_LOG_FILE å’Œ MASTER_LOG_POS å‚æ•°, å·²ç»ä¸éœ€è¦æŒ‡å®šäº†.")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬æŠŠçŽ°åœ¨è¿™ä¸ªæ—¶åˆ», å®žä¾‹ Aâ€™ çš„ GTID é›†åˆè®°ä¸º set_a, å®žä¾‹ B çš„ GTID é›†åˆè®°ä¸º set_b. æŽ¥ä¸‹æ¥çœ‹çœ‹çŽ°åœ¨çš„ä¸»å¤‡åˆ‡æ¢é€»è¾‘.")]),s._v(" "),t("p",[s._v("åœ¨å®žä¾‹ B ä¸Šæ‰§è¡Œ start slave å‘½ä»¤, å– binlog çš„é€»è¾‘æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("å®žä¾‹ B æŒ‡å®šä¸»åº“ Aâ€™, åŸºäºŽä¸»å¤‡åè®®å»ºç«‹è¿žæŽ¥.")]),s._v(" "),t("li",[s._v("å®žä¾‹ B æŠŠ set_b å‘ç»™ä¸»åº“ Aâ€™.")]),s._v(" "),t("li",[t("strong",[s._v("å®žä¾‹ Aâ€™ ç®—å‡º set_a ä¸Ž set_b çš„å·®é›†")]),s._v(", ä¹Ÿå°±æ˜¯æ‰€æœ‰å­˜åœ¨äºŽ set_a, ä½†æ˜¯ä¸å­˜åœ¨äºŽ set_b çš„ GTID çš„é›†åˆ, åˆ¤æ–­ Aâ€™ æœ¬åœ°æ˜¯å¦åŒ…å«äº†è¿™ä¸ªå·®é›†éœ€è¦çš„æ‰€æœ‰ binlog äº‹åŠ¡. (1) å¦‚æžœä¸åŒ…å«, è¡¨ç¤º Aâ€™ å·²ç»æŠŠå®žä¾‹ B éœ€è¦çš„ binlog ç»™åˆ æŽ‰äº†, ç›´æŽ¥è¿”å›žé”™è¯¯; (2) å¦‚æžœç¡®è®¤å…¨éƒ¨åŒ…å«, Aâ€™ ä»Žè‡ªå·±çš„ binlog æ–‡ä»¶é‡Œé¢, æ‰¾å‡ºç¬¬ä¸€ä¸ªä¸åœ¨ set_b çš„äº‹åŠ¡, å‘ç»™ B;")]),s._v(" "),t("li",[s._v("ä¹‹åŽå°±ä»Žè¿™ä¸ªäº‹åŠ¡å¼€å§‹, å¾€åŽè¯»æ–‡ä»¶, æŒ‰é¡ºåºå– binlog å‘ç»™ B åŽ»æ‰§è¡Œ.")])]),s._v(" "),t("p",[s._v("å…¶å®ž, è¿™ä¸ªé€»è¾‘é‡Œé¢åŒ…å«äº†ä¸€ä¸ªè®¾è®¡æ€æƒ³: "),t("strong",[s._v("åœ¨åŸºäºŽ GTID çš„ä¸»å¤‡å…³ç³»é‡Œ, ç³»ç»Ÿè®¤ä¸ºåªè¦å»ºç«‹ä¸»å¤‡å…³ç³», å°±å¿…é¡»ä¿è¯ä¸»åº“å‘ç»™å¤‡åº“çš„æ—¥å¿—æ˜¯å®Œæ•´çš„")]),s._v(". å› æ­¤, å¦‚æžœå®žä¾‹ B éœ€è¦çš„æ—¥å¿—å·²ç»ä¸å­˜åœ¨, Aâ€™ å°±æ‹’ç»æŠŠæ—¥å¿—å‘ç»™ B.")]),s._v(" "),t("p",[s._v("è¿™è·ŸåŸºäºŽä½ç‚¹çš„ä¸»å¤‡åè®®ä¸åŒ. åŸºäºŽä½ç‚¹çš„åè®®, æ˜¯ç”±å¤‡åº“å†³å®šçš„, å¤‡åº“æŒ‡å®šå“ªä¸ªä½ç‚¹, ä¸»åº“å°±å‘å“ªä¸ªä½ç‚¹, ä¸åšæ—¥å¿—çš„å®Œæ•´æ€§åˆ¤æ–­.")]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢çš„ä»‹ç», å†æ¥çœ‹çœ‹å¼•å…¥ GTID åŽ, ä¸€ä¸»å¤šä»Žçš„åˆ‡æ¢åœºæ™¯ä¸‹, ä¸»å¤‡åˆ‡æ¢æ˜¯å¦‚ä½•å®žçŽ°çš„.")]),s._v(" "),t("p",[t("strong",[s._v("ç”±äºŽä¸éœ€è¦æ‰¾ä½ç‚¹äº†, æ‰€ä»¥ä»Žåº“ B, C, D åªéœ€è¦åˆ†åˆ«æ‰§è¡Œ change master å‘½ä»¤æŒ‡å‘å®žä¾‹ Aâ€™ å³å¯")]),s._v(". å…¶å®žä¸¥è°¨åœ°è¯´, ä¸»å¤‡åˆ‡æ¢ä¸æ˜¯ä¸éœ€è¦æ‰¾ä½ç‚¹äº†, è€Œæ˜¯æ‰¾ä½ç‚¹è¿™ä¸ªå·¥ä½œ, åœ¨å®žä¾‹ Aâ€™ å†…éƒ¨å°±å·²ç»è‡ªåŠ¨å®Œæˆäº†. ä½†ç”±äºŽè¿™ä¸ªå·¥ä½œæ˜¯è‡ªåŠ¨çš„, æ‰€ä»¥å¯¹ HA ç³»ç»Ÿçš„å¼€å‘äººå‘˜æ¥è¯´, éžå¸¸å‹å¥½.")]),s._v(" "),t("p",[s._v("ä¹‹åŽè¿™ä¸ªç³»ç»Ÿå°±ç”±æ–°ä¸»åº“ Aâ€™ å†™å…¥, ä¸»åº“ Aâ€™ çš„è‡ªå·±ç”Ÿæˆçš„ binlog ä¸­çš„ GTID é›†åˆæ ¼å¼æ˜¯: "),t("code",[s._v("server_uuid_of_Aâ€™:1-M")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("å¦‚æžœä¹‹å‰ä»Žåº“ B çš„ GTID é›†åˆæ ¼å¼æ˜¯ "),t("code",[s._v("server_uuid_of_A:1-N")]),s._v("â€‹, é‚£ä¹ˆåˆ‡æ¢ä¹‹åŽ GTID é›†åˆçš„æ ¼å¼å°±å˜æˆäº† "),t("code",[s._v("server_uuid_of_A:1-N, server_uuid_of_Aâ€™:1-M")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("å½“ç„¶, ä¸»åº“ Aâ€™ ä¹‹å‰ä¹Ÿæ˜¯ A çš„å¤‡åº“, å› æ­¤ä¸»åº“ Aâ€™ å’Œä»Žåº“ B çš„ GTID é›†åˆæ˜¯ä¸€æ ·çš„. è¿™å°±è¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸ.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-26"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-26"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†ä¸€ä¸»å¤šä»Žçš„ä¸»å¤‡åˆ‡æ¢æµç¨‹. åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, "),t("strong",[s._v("ä»Žåº“æ‰¾æ–°ä¸»åº“çš„ä½ç‚¹æ˜¯ä¸€ä¸ªç—›ç‚¹")]),s._v(". ç”±æ­¤å¼•å‡ºäº† MySQL 5.6 ç‰ˆæœ¬å¼•å…¥çš„ GTID æ¨¡å¼, ä»‹ç»äº† GTID çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•. å¯ä»¥çœ‹åˆ°, åœ¨ GTID æ¨¡å¼ä¸‹, ä¸€ä¸»å¤šä»Žåˆ‡æ¢å°±éžå¸¸æ–¹ä¾¿äº†. å› æ­¤, å¦‚æžœä½ ä½¿ç”¨çš„ MySQL ç‰ˆæœ¬æ”¯æŒ GTID çš„è¯, éƒ½å»ºè®®"),t("strong",[s._v("å°½é‡ä½¿ç”¨ GTID æ¨¡å¼æ¥åšä¸€ä¸»å¤šä»Žçš„åˆ‡æ¢")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ä¸‹ä¸€æŽ¥è¿˜èƒ½çœ‹åˆ° GTID æ¨¡å¼åœ¨è¯»å†™åˆ†ç¦»åœºæ™¯çš„åº”ç”¨.")]),s._v(" "),t("h4",{attrs:{id:"_28-è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_28-è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘"}},[s._v("#")]),s._v(" 28-è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘?")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šä¸€æŽ¥ä»‹ç»äº†ä¸€ä¸»å¤šä»Žçš„ç»“æž„ä»¥åŠåˆ‡æ¢æµç¨‹. æœ¬èŠ‚ç»§ç»­èŠèŠä¸€ä¸»å¤šä»Žæž¶æž„çš„åº”ç”¨åœºæ™¯: "),t("strong",[s._v("è¯»å†™åˆ†ç¦», ä»¥åŠæ€Žä¹ˆå¤„ç†ä¸»å¤‡å»¶è¿Ÿå¯¼è‡´çš„è¯»å†™åˆ†ç¦»é—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„ä¸€ä¸»å¤šä»Žçš„ç»“æž„, å…¶å®žå°±æ˜¯è¯»å†™åˆ†ç¦»çš„åŸºæœ¬ç»“æž„äº†. è¿™é‡Œå†æŠŠè¿™å¼ å›¾è´´è¿‡æ¥, æ–¹ä¾¿ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c169fa3fae077a572e67d5ddfc0afabb-20230731161914-28ykeqv.png",alt:"",title:"è¯»å†™åˆ†ç¦»åŸºæœ¬ç»“æž„"}})]),s._v(" "),t("p",[t("strong",[s._v("è¯»å†™åˆ†ç¦»çš„ä¸»è¦ç›®æ ‡å°±æ˜¯åˆ†æ‘Šä¸»åº“çš„åŽ‹åŠ›")]),s._v(". å›¾ä¸­çš„ç»“æž„æ˜¯å®¢æˆ·ç«¯(client)ä¸»åŠ¨åšè´Ÿè½½å‡è¡¡, è¿™ç§æ¨¡å¼ä¸‹ä¸€èˆ¬ä¼šæŠŠæ•°æ®åº“çš„è¿žæŽ¥ä¿¡æ¯æ”¾åœ¨å®¢æˆ·ç«¯çš„è¿žæŽ¥å±‚. ä¹Ÿå°±æ˜¯è¯´, ç”±å®¢æˆ·ç«¯æ¥é€‰æ‹©åŽç«¯æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢.")]),s._v(" "),t("p",[s._v("è¿˜æœ‰ä¸€ç§æž¶æž„æ˜¯, åœ¨ MySQL å’Œå®¢æˆ·ç«¯ä¹‹é—´æœ‰ä¸€ä¸ª"),t("strong",[s._v("ä¸­é—´ä»£ç†å±‚ proxy")]),s._v(", å®¢æˆ·ç«¯åªè¿žæŽ¥ proxy, ç”± proxy æ ¹æ®è¯·æ±‚ç±»åž‹å’Œä¸Šä¸‹æ–‡å†³å®šè¯·æ±‚çš„åˆ†å‘è·¯ç”±.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ec2e4a7ac5c5b035f5d676cd4f9d834d-20230731161914-5zyuwkd.png",alt:"",title:"å¸¦proxyçš„è¯»å†™åˆ†ç¦»æž¶æž„"}})]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, å°±çœ‹ä¸€ä¸‹å®¢æˆ·ç«¯ç›´è¿žå’Œå¸¦ proxy çš„è¯»å†™åˆ†ç¦»æž¶æž„, å„æœ‰å“ªäº›ç‰¹ç‚¹.")]),s._v(" "),t("ol",[t("li",[s._v("å®¢æˆ·ç«¯ç›´è¿žæ–¹æ¡ˆ, å› ä¸ºå°‘äº†ä¸€å±‚ proxy è½¬å‘, æ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ç¨å¾®å¥½ä¸€ç‚¹, å¹¶ä¸”æ•´ä½“æž¶æž„ç®€å•, æŽ’æŸ¥é—®é¢˜æ›´æ–¹ä¾¿. ä½†æ˜¯è¿™ç§æ–¹æ¡ˆ, ç”±äºŽè¦äº†è§£åŽç«¯éƒ¨ç½²ç»†èŠ‚, æ‰€ä»¥åœ¨å‡ºçŽ°ä¸»å¤‡åˆ‡æ¢, åº“è¿ç§»ç­‰æ“ä½œçš„æ—¶å€™, å®¢æˆ·ç«¯éƒ½ä¼šæ„ŸçŸ¥åˆ°, å¹¶ä¸”éœ€è¦è°ƒæ•´æ•°æ®åº“è¿žæŽ¥ä¿¡æ¯. ä½ å¯èƒ½ä¼šè§‰å¾—è¿™æ ·å®¢æˆ·ç«¯ä¹Ÿå¤ªéº»çƒ¦äº†, ä¿¡æ¯å¤§é‡å†—ä½™, æž¶æž„å¾ˆä¸‘. å…¶å®žä¹Ÿæœªå¿…, ä¸€èˆ¬é‡‡ç”¨è¿™æ ·çš„æž¶æž„, "),t("strong",[s._v("ä¸€å®šä¼šä¼´éšä¸€ä¸ªè´Ÿè´£ç®¡ç†åŽç«¯çš„ç»„ä»¶, æ¯”å¦‚ Zookeeper, å°½é‡è®©ä¸šåŠ¡ç«¯åªä¸“æ³¨äºŽä¸šåŠ¡é€»è¾‘å¼€å‘")]),s._v(".")]),s._v(" "),t("li",[s._v("å¸¦ proxy çš„æž¶æž„, å¯¹å®¢æˆ·ç«¯æ¯”è¾ƒå‹å¥½. å®¢æˆ·ç«¯ä¸éœ€è¦å…³æ³¨åŽç«¯ç»†èŠ‚, è¿žæŽ¥ç»´æŠ¤, åŽç«¯ä¿¡æ¯ç»´æŠ¤ç­‰å·¥ä½œ, éƒ½æ˜¯ç”± proxy å®Œæˆçš„. ä½†è¿™æ ·å¯¹åŽç«¯ç»´æŠ¤å›¢é˜Ÿçš„è¦æ±‚ä¼šæ›´é«˜. è€Œä¸” proxy ä¹Ÿéœ€è¦æœ‰"),t("strong",[s._v("é«˜å¯ç”¨æž¶æž„")]),s._v(". å› æ­¤å¸¦ proxy æž¶æž„çš„æ•´ä½“å°±ç›¸å¯¹æ¯”è¾ƒå¤æ‚.")])]),s._v(" "),t("p",[s._v("ç†è§£äº†è¿™ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜åŠ£, å…·ä½“é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆå°±å–å†³äºŽæ•°æ®åº“å›¢é˜Ÿæä¾›çš„èƒ½åŠ›äº†. ä½†ç›®å‰çœ‹, "),t("strong",[s._v("è¶‹åŠ¿æ˜¯å¾€å¸¦ proxy çš„æž¶æž„æ–¹å‘å‘å±•çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†ä¸è®ºä½¿ç”¨å“ªç§æž¶æž„, éƒ½ä¼šç¢°åˆ°ä»Šå¤©è¦è®¨è®ºçš„é—®é¢˜: "),t("mark",[t("strong",[s._v("ç”±äºŽä¸»ä»Žå¯èƒ½å­˜åœ¨å»¶è¿Ÿ, å®¢æˆ·ç«¯æ‰§è¡Œå®Œä¸€ä¸ªæ›´æ–°äº‹åŠ¡åŽé©¬ä¸Šå‘èµ·æŸ¥è¯¢, å¦‚æžœæŸ¥è¯¢é€‰æ‹©çš„æ˜¯ä»Žåº“çš„è¯, å°±æœ‰å¯èƒ½è¯»åˆ°åˆšåˆšçš„äº‹åŠ¡æ›´æ–°ä¹‹å‰çš„çŠ¶æ€")])]),s._v(".")]),s._v(" "),t("p",[s._v('**è¿™ç§"åœ¨ä»Žåº“ä¸Šä¼šè¯»åˆ°ç³»ç»Ÿçš„ä¸€ä¸ªè¿‡æœŸçŠ¶æ€"çš„çŽ°è±¡, åœ¨è¿™ç¯‡æ–‡ç« é‡Œ, æš‚ä¸”ç§°ä¹‹ä¸º"è¿‡æœŸè¯»". **')]),s._v(" "),t("p",[s._v("å‰é¢è¯´è¿‡äº†å‡ ç§å¯èƒ½å¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„åŽŸå› , ä»¥åŠå¯¹åº”çš„ä¼˜åŒ–ç­–ç•¥, ä½†æ˜¯ä¸»ä»Žå»¶è¿Ÿè¿˜æ˜¯ä¸èƒ½ 100% é¿å…çš„. ä¸è®ºå“ªç§ç»“æž„, å®¢æˆ·ç«¯éƒ½å¸Œæœ›æŸ¥è¯¢ä»Žåº“çš„æ•°æ®ç»“æžœ, è·ŸæŸ¥ä¸»åº“çš„æ•°æ®ç»“æžœæ˜¯ä¸€æ ·çš„.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å°±æ¥è®¨è®ºæ€Žä¹ˆå¤„ç†è¿‡æœŸè¯»é—®é¢˜. è¿™é‡Œå…ˆæŠŠæœ¬èŠ‚æ¶‰åŠåˆ°çš„å¤„ç†è¿‡æœŸè¯»çš„æ–¹æ¡ˆæ±‡æ€»åœ¨è¿™é‡Œ, ä»¥å¸®åŠ©æ›´å¥½åœ°ç†è§£å’ŒæŽŒæ¡å…¨æ–‡çš„çŸ¥è¯†è„‰ç»œ. è¿™äº›æ–¹æ¡ˆåŒ…æ‹¬:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("sleep æ–¹æ¡ˆ")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("é…åˆ semi-sync æ–¹æ¡ˆ")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("ç­‰ GTID æ–¹æ¡ˆ")]),s._v(".")])]),s._v(" "),t("h5",{attrs:{id:"å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ"}},[s._v("#")]),s._v(" å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ")]),s._v(" "),t("p",[s._v("å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆå…¶å®žå°±æ˜¯, å°†æŸ¥è¯¢è¯·æ±‚åšåˆ†ç±». é€šå¸¸æƒ…å†µä¸‹, å¯ä»¥å°†æŸ¥è¯¢è¯·æ±‚åˆ†ä¸ºè¿™ä¹ˆä¸¤ç±»:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¯¹äºŽå¿…é¡»è¦æ‹¿åˆ°æœ€æ–°ç»“æžœçš„è¯·æ±‚, å¼ºåˆ¶å°†å…¶å‘åˆ°ä¸»åº“ä¸Š")]),s._v(". æ¯”å¦‚åœ¨ä¸€ä¸ªäº¤æ˜“å¹³å°ä¸Š, å–å®¶å‘å¸ƒå•†å“ä»¥åŽ, é©¬ä¸Šè¦è¿”å›žä¸»é¡µé¢, çœ‹å•†å“æ˜¯å¦å‘å¸ƒæˆåŠŸ. é‚£ä¹ˆè¿™ä¸ªè¯·æ±‚éœ€è¦æ‹¿åˆ°æœ€æ–°çš„ç»“æžœ, å°±å¿…é¡»èµ°ä¸»åº“.")]),s._v(" "),t("li",[t("strong",[s._v("å¯¹äºŽå¯ä»¥è¯»åˆ°æ—§æ•°æ®çš„è¯·æ±‚, æ‰å°†å…¶å‘åˆ°ä»Žåº“ä¸Š")]),s._v(". åœ¨è¿™ä¸ªäº¤æ˜“å¹³å°ä¸Š, ä¹°å®¶æ¥é€›å•†é“ºé¡µé¢, å°±ç®—æ™šå‡ ç§’çœ‹åˆ°æœ€æ–°å‘å¸ƒçš„å•†å“, ä¹Ÿæ˜¯å¯ä»¥æŽ¥å—çš„. é‚£ä¹ˆè¿™ç±»è¯·æ±‚å°±å¯ä»¥èµ°ä»Žåº“.")])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè¯´, è¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸æ˜¯æœ‰ç‚¹ç•éš¾å’Œå–å·§çš„æ„æ€, "),t("mark",[t("strong",[s._v("ä½†å…¶å®žè¿™ä¸ªæ–¹æ¡ˆæ˜¯ç”¨å¾—æœ€å¤šçš„")])]),s._v('. å½“ç„¶, è¿™ä¸ªæ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜åœ¨äºŽ, æœ‰æ—¶å€™ä½ ä¼šç¢°åˆ° "æ‰€æœ‰æŸ¥è¯¢éƒ½ä¸èƒ½æ˜¯è¿‡æœŸè¯»" çš„éœ€æ±‚, æ¯”å¦‚ä¸€äº›é‡‘èžç±»çš„ä¸šåŠ¡. è¿™æ ·çš„è¯, å°±è¦æ”¾å¼ƒè¯»å†™åˆ†ç¦», æ‰€æœ‰è¯»å†™åŽ‹åŠ›éƒ½åœ¨ä¸»åº“, ç­‰åŒäºŽæ”¾å¼ƒäº†æ‰©å±•æ€§.')]),s._v(" "),t("p",[s._v("å› æ­¤æŽ¥ä¸‹æ¥è®¨è®ºçš„è¯é¢˜æ˜¯: "),t("strong",[s._v("å¯ä»¥æ”¯æŒè¯»å†™åˆ†ç¦»çš„åœºæ™¯ä¸‹, æœ‰å“ªäº›è§£å†³è¿‡æœŸè¯»çš„æ–¹æ¡ˆ, å¹¶åˆ†æžå„ä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"sleepæ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sleepæ–¹æ¡ˆ"}},[s._v("#")]),s._v(" Sleepæ–¹æ¡ˆ")]),s._v(" "),t("p",[t("strong",[s._v("ä¸»åº“æ›´æ–°åŽ, è¯»ä»Žåº“ä¹‹å‰å…ˆ sleep ä¸€ä¸‹")]),s._v(". å…·ä½“çš„æ–¹æ¡ˆå°±æ˜¯, ç±»ä¼¼äºŽæ‰§è¡Œä¸€æ¡ select sleep(1) å‘½ä»¤. è¿™ä¸ªæ–¹æ¡ˆçš„å‡è®¾æ˜¯, å¤§å¤šæ•°æƒ…å†µä¸‹ä¸»å¤‡å»¶è¿Ÿåœ¨ 1 ç§’ä¹‹å†…, åšä¸€ä¸ª sleep å¯ä»¥æœ‰å¾ˆå¤§æ¦‚çŽ‡æ‹¿åˆ°æœ€æ–°çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ–¹æ¡ˆç»™ä½ çš„ç¬¬ä¸€æ„Ÿè§‰, å¾ˆå¯èƒ½æ˜¯ä¸é è°±, åº”è¯¥ä¸ä¼šæœ‰äººç”¨å§? å¹¶ä¸”ä½ è¿˜å¯èƒ½ä¼šè¯´, ç›´æŽ¥åœ¨å‘èµ·æŸ¥è¯¢æ—¶å…ˆæ‰§è¡Œä¸€æ¡ sleep è¯­å¥, ç”¨æˆ·ä½“éªŒå¾ˆä¸å‹å¥½å•Š.")]),s._v(" "),t("p",[s._v("ä½†, è¿™ä¸ªæ€è·¯ç¡®å®žå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³é—®é¢˜. ä¸ºäº†çœ‹èµ·æ¥æ›´é è°±, å¯ä»¥æ¢ä¸€ç§æ–¹å¼.")]),s._v(" "),t("p",[s._v('ä»¥å–å®¶å‘å¸ƒå•†å“ä¸ºä¾‹, å•†å“å‘å¸ƒåŽ, ç”¨ Ajax(Asynchronous JavaScript + XML, å¼‚æ­¥ JavaScript å’Œ XML)ç›´æŽ¥æŠŠå®¢æˆ·ç«¯è¾“å…¥çš„å†…å®¹ä½œä¸º "æ–°çš„å•†å“" æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š, è€Œä¸æ˜¯çœŸæ­£åœ°åŽ»æ•°æ®åº“åšæŸ¥è¯¢. è¿™æ ·å–å®¶å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ˜¾ç¤º, æ¥ç¡®è®¤äº§å“å·²ç»å‘å¸ƒæˆåŠŸäº†. ç­‰åˆ°å–å®¶å†åˆ·æ–°é¡µé¢, åŽ»æŸ¥çœ‹å•†å“çš„æ—¶å€™, å…¶å®žå·²ç»è¿‡äº†ä¸€æ®µæ—¶é—´, ä¹Ÿå°±è¾¾åˆ°äº† sleep çš„ç›®çš„, è¿›è€Œä¹Ÿå°±è§£å†³äº†è¿‡æœŸè¯»çš„é—®é¢˜.')]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("è¿™ä¸ª sleep æ–¹æ¡ˆç¡®å®žè§£å†³äº†ç±»ä¼¼åœºæ™¯ä¸‹çš„è¿‡æœŸè¯»é—®é¢˜")]),s._v(". ä½†ä»Žä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´, è¿™ä¸ªæ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜å°±æ˜¯ä¸ç²¾ç¡®. è¿™ä¸ªä¸ç²¾ç¡®åŒ…å«äº†ä¸¤å±‚æ„æ€:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚æœ¬æ¥ 0.5 ç§’å°±å¯ä»¥åœ¨ä»Žåº“ä¸Šæ‹¿åˆ°æ­£ç¡®ç»“æžœ, ä¹Ÿä¼šç­‰ 1 ç§’;")]),s._v(" "),t("li",[s._v("å¦‚æžœå»¶è¿Ÿè¶…è¿‡ 1 ç§’, è¿˜æ˜¯ä¼šå‡ºçŽ°è¿‡æœŸè¯».")])]),s._v(" "),t("p",[s._v('çœ‹åˆ°è¿™é‡Œ, ä½ æ˜¯ä¸æ˜¯æœ‰ä¸€ç§"ä½ æ˜¯ä¸æ˜¯åœ¨é€—æˆ‘"çš„æ„Ÿè§‰, è¿™ä¸ªæ”¹è¿›æ–¹æ¡ˆè™½ç„¶å¯ä»¥è§£å†³ç±»ä¼¼ Ajax åœºæ™¯ä¸‹çš„è¿‡æœŸè¯»é—®é¢˜, ä½†è¿˜æ˜¯æ€Žä¹ˆçœ‹éƒ½ä¸é è°±. æŽ¥ä¸‹æ¥å°±ä»‹ç»ä¸€äº›æ›´å‡†ç¡®çš„æ–¹æ¡ˆ.')]),s._v(" "),t("h5",{attrs:{id:"åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ"}},[s._v("#")]),s._v(" åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ")]),s._v(" "),t("p",[s._v("è¦"),t("strong",[s._v("ç¡®ä¿å¤‡åº“æ— å»¶è¿Ÿ")]),s._v(", é€šå¸¸æœ‰ä¸‰ç§åšæ³•.")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°è¿‡ show slave status ç»“æžœé‡Œçš„ "),t("strong",[s._v("seconds_behind_master")]),s._v(" å‚æ•°çš„å€¼, å¯ä»¥ç”¨æ¥è¡¡é‡ä¸»å¤‡å»¶è¿Ÿæ—¶é—´çš„é•¿çŸ­.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥**ç¬¬ä¸€ç§ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿçš„æ–¹æ³•æ˜¯, ** æ¯æ¬¡ä»Žåº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚å‰, å…ˆåˆ¤æ–­ seconds_behind_master æ˜¯å¦å·²ç»ç­‰äºŽ 0. å¦‚æžœè¿˜ä¸ç­‰äºŽ 0, é‚£å°±å¿…é¡»ç­‰åˆ°è¿™ä¸ªå‚æ•°å˜ä¸º 0 æ‰èƒ½æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚.")]),s._v(" "),t("p",[s._v("seconds_behind_master çš„å•ä½æ˜¯ç§’, å¦‚æžœä½ è§‰å¾—ç²¾åº¦ä¸å¤Ÿçš„è¯, è¿˜å¯ä»¥"),t("strong",[s._v("é‡‡ç”¨å¯¹æ¯”ä½ç‚¹å’Œ GTID çš„æ–¹æ³•")]),s._v("æ¥ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿ, ä¹Ÿå°±æ˜¯æŽ¥ä¸‹æ¥è¦è¯´çš„ç¬¬äºŒå’Œç¬¬ä¸‰ç§æ–¹æ³•.")]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤º, æ˜¯ä¸€ä¸ª show slave status ç»“æžœçš„éƒ¨åˆ†æˆªå›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2a9fa8e275e20e6d4a941d65f5060cc6-20230731161914-kbg9uxk.png",alt:"",title:"show slave statusç»“æžœ"}})]),s._v(" "),t("p",[s._v("çŽ°åœ¨å°±é€šè¿‡è¿™ä¸ªç»“æžœ, æ¥çœ‹çœ‹å…·ä½“"),t("strong",[s._v("å¦‚ä½•é€šè¿‡å¯¹æ¯”ä½ç‚¹å’Œ GTID æ¥ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿ")]),s._v(".")]),s._v(" "),t("p",[s._v("**ç¬¬äºŒç§æ–¹æ³•, **å¯¹æ¯”ä½ç‚¹ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿ:")]),s._v(" "),t("ul",[t("li",[s._v("Master_Log_File å’Œ Read_Master_Log_Pos, è¡¨ç¤ºçš„æ˜¯"),t("strong",[s._v("è¯»åˆ°çš„ä¸»åº“çš„æœ€æ–°ä½ç‚¹")]),s._v(";")]),s._v(" "),t("li",[s._v("Relay_Master_Log_File å’Œ Exec_Master_Log_Pos, è¡¨ç¤ºçš„æ˜¯"),t("strong",[s._v("å¤‡åº“æ‰§è¡Œçš„æœ€æ–°ä½ç‚¹")]),s._v(".")])]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æžœ Master_Log_File å’Œ Relay_Master_Log_File, Read_Master_Log_Pos å’Œ Exec_Master_Log_Pos è¿™ä¸¤ç»„å€¼å®Œå…¨ç›¸åŒ, å°±è¡¨ç¤ºæŽ¥æ”¶åˆ°çš„æ—¥å¿—å·²ç»åŒæ­¥å®Œæˆ")]),s._v(".")]),s._v(" "),t("p",[s._v("**ç¬¬ä¸‰ç§æ–¹æ³•, **å¯¹æ¯” GTID é›†åˆç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿ:")]),s._v(" "),t("ul",[t("li",[s._v("Auto_Position=1, è¡¨ç¤ºè¿™å¯¹ä¸»å¤‡å…³ç³»ä½¿ç”¨äº† GTID åè®®.")]),s._v(" "),t("li",[s._v("Retrieved_Gtid_Set, æ˜¯å¤‡åº“æ”¶åˆ°çš„æ‰€æœ‰æ—¥å¿—çš„ GTID é›†åˆ;")]),s._v(" "),t("li",[s._v("Executed_Gtid_Set, æ˜¯å¤‡åº“æ‰€æœ‰å·²ç»æ‰§è¡Œå®Œæˆçš„ GTID é›†åˆ.")])]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æžœè¿™ä¸¤ä¸ªé›†åˆç›¸åŒ, ä¹Ÿè¡¨ç¤ºå¤‡åº“æŽ¥æ”¶åˆ°çš„æ—¥å¿—éƒ½å·²ç»åŒæ­¥å®Œæˆ")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯è§, å¯¹æ¯”ä½ç‚¹å’Œå¯¹æ¯” GTID è¿™ä¸¤ç§æ–¹æ³•, éƒ½è¦æ¯”åˆ¤æ–­ seconds_behind_master æ˜¯å¦ä¸º 0 æ›´å‡†ç¡®.")]),s._v(" "),t("p",[s._v('åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ä¹‹å‰, å…ˆåˆ¤æ–­ä»Žåº“æ˜¯å¦åŒæ­¥å®Œæˆçš„æ–¹æ³•, ç›¸æ¯”äºŽ sleep æ–¹æ¡ˆ, å‡†ç¡®åº¦ç¡®å®žæå‡äº†ä¸å°‘, ä½†è¿˜æ˜¯æ²¡æœ‰è¾¾åˆ°"ç²¾ç¡®"çš„ç¨‹åº¦. ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢?')]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä¸€èµ·æ¥å›žé¡¾ä¸‹, ä¸€ä¸ªäº‹åŠ¡çš„ binlog åœ¨ä¸»å¤‡åº“ä¹‹é—´çš„çŠ¶æ€:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸»åº“æ‰§è¡Œå®Œæˆ, å†™å…¥ binlog, å¹¶åé¦ˆç»™å®¢æˆ·ç«¯;")]),s._v(" "),t("li",[s._v("binlog è¢«ä»Žä¸»åº“å‘é€ç»™å¤‡åº“, å¤‡åº“æ”¶åˆ°;")]),s._v(" "),t("li",[s._v("åœ¨å¤‡åº“æ‰§è¡Œ binlog å®Œæˆ.")])]),s._v(" "),t("p",[s._v('ä¸Šé¢åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿçš„é€»è¾‘, æ˜¯ "å¤‡åº“æ”¶åˆ°çš„æ—¥å¿—éƒ½æ‰§è¡Œå®Œæˆäº†". ä½†æ˜¯ä»Ž binlog åœ¨ä¸»å¤‡ä¹‹é—´çŠ¶æ€çš„åˆ†æžä¸­, ä¸éš¾çœ‹å‡º'),t("strong",[s._v("è¿˜æœ‰ä¸€éƒ¨åˆ†æ—¥å¿—, å¤„äºŽå®¢æˆ·ç«¯å·²ç»æ”¶åˆ°æäº¤ç¡®è®¤, è€Œå¤‡åº“è¿˜æ²¡æ”¶åˆ°æ—¥å¿—çš„çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤ºå°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªçŠ¶æ€.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cedff097b5346a3f858ddfc08d25eb2b-20230731161914-qyrmytg.png",alt:"",title:"å¤‡åº“è¿˜æ²¡æ”¶åˆ°trx3"}})]),s._v(" "),t("p",[s._v("è¿™æ—¶, ä¸»åº“ä¸Šæ‰§è¡Œå®Œæˆäº†ä¸‰ä¸ªäº‹åŠ¡ trx1, trx2 å’Œ trx3, å…¶ä¸­:")]),s._v(" "),t("ol",[t("li",[s._v("trx1 å’Œ trx2 å·²ç»ä¼ åˆ°ä»Žåº“, å¹¶ä¸”å·²ç»æ‰§è¡Œå®Œæˆäº†;")]),s._v(" "),t("li",[s._v("trx3 åœ¨ä¸»åº“æ‰§è¡Œå®Œæˆ, å¹¶ä¸”å·²ç»å›žå¤ç»™å®¢æˆ·ç«¯, ä½†æ˜¯è¿˜æ²¡æœ‰ä¼ åˆ°ä»Žåº“ä¸­.")])]),s._v(" "),t("p",[s._v("å¦‚æžœè¿™æ—¶å€™åœ¨ä»Žåº“ B ä¸Šæ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚, æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘, "),t("strong",[s._v("ä»Žåº“è®¤ä¸ºå·²ç»æ²¡æœ‰åŒæ­¥å»¶è¿Ÿ")]),s._v(", ä½†è¿˜æ˜¯æŸ¥ä¸åˆ° trx3 çš„. ä¸¥æ ¼åœ°è¯´, å°±æ˜¯å‡ºçŽ°äº†è¿‡æœŸè¯».")]),s._v(" "),t("p",[s._v("é‚£è¿™ä¸ªé—®é¢˜æœ‰æ²¡æœ‰åŠžæ³•è§£å†³å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"é…åˆsemi-sync"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é…åˆsemi-sync"}},[s._v("#")]),s._v(" é…åˆsemi-sync")]),s._v(" "),t("p",[s._v("è¦è§£å†³è¿™ä¸ªé—®é¢˜, å°±è¦"),t("strong",[s._v("å¼•å…¥åŠåŒæ­¥å¤åˆ¶, ä¹Ÿå°±æ˜¯ semi-sync replication")]),s._v(".")]),s._v(" "),t("p",[s._v("semi-sync åšäº†è¿™æ ·çš„è®¾è®¡:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("äº‹åŠ¡æäº¤çš„æ—¶å€™, ä¸»åº“æŠŠ binlog å‘ç»™ä»Žåº“;")])]),s._v(" "),t("li",[t("strong",[s._v("ä»Žåº“æ”¶åˆ° binlog ä»¥åŽ, å‘å›žç»™ä¸»åº“ä¸€ä¸ª ack, è¡¨ç¤ºæ”¶åˆ°äº†")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v('ä¸»åº“æ”¶åˆ°è¿™ä¸ª ack ä»¥åŽ, æ‰èƒ½ç»™å®¢æˆ·ç«¯è¿”å›ž"äº‹åŠ¡å®Œæˆ"çš„ç¡®è®¤')]),s._v(".")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, å¦‚æžœå¯ç”¨äº† semi-sync, å°±è¡¨ç¤º"),t("strong",[s._v("æ‰€æœ‰ç»™å®¢æˆ·ç«¯å‘é€è¿‡ç¡®è®¤çš„äº‹åŠ¡, éƒ½ç¡®ä¿äº†å¤‡åº“å·²ç»æ”¶åˆ°äº†è¿™ä¸ªæ—¥å¿—")]),s._v(".")]),s._v(" "),t("p",[s._v("å‰é¢æœ‰äººé—®åˆ°: å¦‚æžœä¸»åº“æŽ‰ç”µçš„æ—¶å€™, æœ‰äº› binlog è¿˜æ¥ä¸åŠå‘ç»™ä»Žåº“, ä¼šä¸ä¼šå¯¼è‡´ç³»ç»Ÿæ•°æ®ä¸¢å¤±? ç­”æ¡ˆæ˜¯, å¦‚æžœä½¿ç”¨çš„æ˜¯æ™®é€šçš„å¼‚æ­¥å¤åˆ¶æ¨¡å¼, å°±å¯èƒ½ä¼šä¸¢å¤±, ä½† semi-sync å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("è¿™æ · semi-sync é…åˆå‰é¢å…³äºŽä½ç‚¹çš„åˆ¤æ–­, å°±èƒ½å¤Ÿç¡®å®šåœ¨ä»Žåº“ä¸Šæ‰§è¡Œçš„æŸ¥è¯¢è¯·æ±‚, å¯ä»¥é¿å…è¿‡æœŸè¯».")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, semi-sync+ ä½ç‚¹åˆ¤æ–­çš„æ–¹æ¡ˆ, åªå¯¹ä¸€ä¸»ä¸€å¤‡çš„åœºæ™¯æ˜¯æˆç«‹çš„. "),t("strong",[s._v("åœ¨ä¸€ä¸»å¤šä»Žåœºæ™¯ä¸­, ä¸»åº“åªè¦ç­‰åˆ°ä¸€ä¸ªä»Žåº“çš„ ack, å°±å¼€å§‹ç»™å®¢æˆ·ç«¯è¿”å›žç¡®è®¤")]),s._v(". è¿™æ—¶åœ¨ä»Žåº“ä¸Šæ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚, å°±æœ‰ä¸¤ç§æƒ…å†µ:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœæŸ¥è¯¢æ˜¯è½åœ¨è¿™ä¸ªå“åº”äº† ack çš„ä»Žåº“ä¸Š, æ˜¯èƒ½å¤Ÿç¡®ä¿è¯»åˆ°æœ€æ–°æ•°æ®;")]),s._v(" "),t("li",[s._v("ä½†å¦‚æžœæ˜¯æŸ¥è¯¢è½åˆ°å…¶ä»–ä»Žåº“ä¸Š, å®ƒä»¬å¯èƒ½è¿˜æ²¡æœ‰æ”¶åˆ°æœ€æ–°çš„æ—¥å¿—, å°±ä¼šäº§ç”Ÿè¿‡æœŸè¯»çš„é—®é¢˜.")])]),s._v(" "),t("p",[s._v("å…¶å®ž, åˆ¤æ–­åŒæ­¥ä½ç‚¹çš„æ–¹æ¡ˆè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜, å³: å¦‚æžœåœ¨ä¸šåŠ¡æ›´æ–°çš„é«˜å³°æœŸ, ä¸»åº“çš„ä½ç‚¹æˆ–è€… GTID é›†åˆæ›´æ–°å¾ˆå¿«, é‚£ä¹ˆä¸Šé¢çš„ä¸¤ä¸ªä½ç‚¹ç­‰å€¼åˆ¤æ–­å°±ä¼šä¸€ç›´ä¸æˆç«‹, å¾ˆå¯èƒ½å‡ºçŽ°ä»Žåº“ä¸Šè¿Ÿè¿Ÿæ— æ³•å“åº”æŸ¥è¯¢è¯·æ±‚çš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, å›žåˆ°æœ€åˆçš„ä¸šåŠ¡é€»è¾‘é‡Œ, "),t("strong",[s._v('å½“å‘èµ·ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ä»¥åŽ, è¦å¾—åˆ°å‡†ç¡®çš„ç»“æžœ, å…¶å®žå¹¶ä¸éœ€è¦ç­‰åˆ° "ä¸»å¤‡å®Œå…¨åŒæ­¥"')]),s._v(" .")]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢? æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ—¶åºå›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/841dffc5a6a096e7482867136161b46d-20230731161914-twx3xku.png",alt:"",title:"ä¸»å¤‡æŒç»­å»¶è¿Ÿä¸€ä¸ªäº‹åŠ¡"}})]),s._v(" "),t("p",[s._v("å¦‚ä¸Šå›¾æ‰€ç¤º, å°±æ˜¯ç­‰å¾…ä½ç‚¹æ–¹æ¡ˆçš„ä¸€ä¸ª bad case. å›¾ä¸­å¤‡åº“ B ä¸‹çš„è™šçº¿æ¡†, åˆ†åˆ«è¡¨ç¤º relaylog å’Œ binlog ä¸­çš„äº‹åŠ¡. å¯ä»¥çœ‹åˆ°, å›¾ä¸­ä»ŽçŠ¶æ€ 1 åˆ°çŠ¶æ€ 4, "),t("strong",[s._v("ä¸€ç›´å¤„äºŽå»¶è¿Ÿä¸€ä¸ªäº‹åŠ¡çš„çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[s._v("å¤‡åº“ B ä¸€ç›´åˆ°çŠ¶æ€ 4 éƒ½å’Œä¸»åº“ A å­˜åœ¨å»¶è¿Ÿ, å¦‚æžœç”¨ä¸Šé¢å¿…é¡»ç­‰åˆ°æ— å»¶è¿Ÿæ‰èƒ½æŸ¥è¯¢çš„æ–¹æ¡ˆ, select è¯­å¥ç›´åˆ°çŠ¶æ€ 4 éƒ½ä¸èƒ½è¢«æ‰§è¡Œ.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, å…¶å®žå®¢æˆ·ç«¯æ˜¯åœ¨å‘å®Œ trx1 æ›´æ–°åŽå‘èµ·çš„ select è¯­å¥, åªéœ€è¦ç¡®ä¿ trx1 å·²ç»æ‰§è¡Œå®Œæˆå°±å¯ä»¥æ‰§è¡Œ select è¯­å¥äº†. ä¹Ÿå°±æ˜¯è¯´, å¦‚æžœåœ¨çŠ¶æ€ 3 æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚, å¾—åˆ°çš„å°±æ˜¯é¢„æœŸç»“æžœäº†.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œå°ç»“ä¸€ä¸‹, semi-sync é…åˆåˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿçš„æ–¹æ¡ˆ, å­˜åœ¨ä¸¤ä¸ªé—®é¢˜:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸€ä¸»å¤šä»Žçš„æ—¶å€™, åœ¨æŸäº›ä»Žåº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ä¼šå­˜åœ¨è¿‡æœŸè¯»çš„çŽ°è±¡;")]),s._v(" "),t("li",[s._v("åœ¨æŒç»­å»¶è¿Ÿçš„æƒ…å†µä¸‹, å¯èƒ½å‡ºçŽ°è¿‡åº¦ç­‰å¾…çš„é—®é¢˜.")])]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥è¦ä»‹ç»çš„ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ, å°±å¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ"}},[s._v("#")]),s._v(" ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ")]),s._v(" "),t("p",[s._v("è¦ç†è§£ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ, éœ€è¦å…ˆä»‹ç»ä¸€æ¡å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" master_pos_wait"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ¡å‘½ä»¤çš„é€»è¾‘å¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("å®ƒæ˜¯åœ¨"),t("strong",[s._v("ä»Žåº“")]),s._v("æ‰§è¡Œçš„;")]),s._v(" "),t("li",[s._v("å‚æ•° file å’Œ pos æŒ‡çš„æ˜¯ä¸»åº“ä¸Šçš„æ–‡ä»¶åå’Œä½ç½®;")]),s._v(" "),t("li",[s._v("timeout å¯é€‰, è®¾ç½®ä¸ºæ­£æ•´æ•° N è¡¨ç¤ºè¿™ä¸ªå‡½æ•°æœ€å¤šç­‰å¾… N ç§’.")])]),s._v(" "),t("p",[t("strong",[s._v("è¿™ä¸ªå‘½ä»¤æ­£å¸¸è¿”å›žçš„ç»“æžœæ˜¯ä¸€ä¸ªæ­£æ•´æ•° M, è¡¨ç¤ºä»Žå‘½ä»¤å¼€å§‹æ‰§è¡Œ, åˆ°åº”ç”¨å®Œ file å’Œ pos è¡¨ç¤ºçš„ binlog ä½ç½®, æ‰§è¡Œäº†å¤šå°‘äº‹åŠ¡")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶, é™¤äº†æ­£å¸¸è¿”å›žä¸€ä¸ªæ­£æ•´æ•° M å¤–, è¿™æ¡å‘½ä»¤è¿˜ä¼šè¿”å›žä¸€äº›å…¶ä»–ç»“æžœ, åŒ…æ‹¬:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœæ‰§è¡ŒæœŸé—´, å¤‡åº“åŒæ­¥çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸, åˆ™è¿”å›ž NULL;")]),s._v(" "),t("li",[s._v("å¦‚æžœç­‰å¾…è¶…è¿‡ N ç§’, å°±è¿”å›ž -1;")]),s._v(" "),t("li",[s._v("å¦‚æžœåˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™, å°±å‘çŽ°å·²ç»æ‰§è¡Œè¿‡è¿™ä¸ªä½ç½®äº†, åˆ™è¿”å›ž 0.")])]),s._v(" "),t("p",[s._v("å¯¹äºŽå‰é¢å›¾ä¸­å…ˆæ‰§è¡Œ trx1, å†æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚çš„é€»è¾‘, è¦ä¿è¯èƒ½å¤ŸæŸ¥åˆ°æ­£ç¡®çš„æ•°æ®, å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€»è¾‘:")]),s._v(" "),t("ol",[t("li",[s._v("trx1 äº‹åŠ¡æ›´æ–°å®ŒæˆåŽ, é©¬ä¸Šæ‰§è¡Œ show master status å¾—åˆ°å½“å‰ä¸»åº“æ‰§è¡Œåˆ°çš„ File å’Œ Position;")]),s._v(" "),t("li",[s._v("é€‰å®šä¸€ä¸ªä»Žåº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥;")]),s._v(" "),t("li",[s._v("åœ¨ä»Žåº“ä¸Šæ‰§è¡Œ select master_pos_wait(File, Position, 1);")]),s._v(" "),t("li",[s._v("å¦‚æžœè¿”å›žå€¼æ˜¯ >=0 çš„æ­£æ•´æ•°, åˆ™åœ¨è¿™ä¸ªä»Žåº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥;")]),s._v(" "),t("li",[s._v("å¦åˆ™, åˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥.")])]),s._v(" "),t("p",[s._v("æŠŠä¸Šé¢è¿™ä¸ªæµç¨‹ç”»å‡ºæ¥.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a90e934272661d778744f633a62a6f9d-20230731161914-p9u5ja8.png",alt:"",title:"master_pos_waitæ–¹æ¡ˆ"}})]),s._v(" "),t("p",[s._v("è¿™é‡Œæˆ‘ä»¬å‡è®¾è¿™æ¡ select æŸ¥è¯¢æœ€å¤šåœ¨ä»Žåº“ä¸Šç­‰å¾… 1 ç§’. é‚£ä¹ˆå¦‚æžœ 1 ç§’å†… master_pos_wait è¿”å›žä¸€ä¸ªå¤§äºŽç­‰äºŽ 0 çš„æ•´æ•°, å°±ç¡®ä¿äº†ä»Žåº“ä¸Šæ‰§è¡Œçš„è¿™ä¸ªæŸ¥è¯¢ç»“æžœä¸€å®šåŒ…å«äº† trx1 çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("æ­¥éª¤ 5 åˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥, æ˜¯è¿™ç±»æ–¹æ¡ˆå¸¸ç”¨çš„é€€åŒ–æœºåˆ¶. å› ä¸ºä»Žåº“çš„å»¶è¿Ÿæ—¶é—´ä¸å¯æŽ§, ä¸èƒ½æ— é™ç­‰å¾…, æ‰€ä»¥å¦‚æžœç­‰å¾…è¶…æ—¶, å°±åº”è¯¥æ”¾å¼ƒ, ç„¶åŽåˆ°ä¸»åº“åŽ»æŸ¥.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè¯´, å¦‚æžœæ‰€æœ‰çš„ä»Žåº“éƒ½å»¶è¿Ÿè¶…è¿‡ 1 ç§’äº†, é‚£æŸ¥è¯¢åŽ‹åŠ›ä¸å°±éƒ½è·‘åˆ°ä¸»åº“ä¸Šäº†å—? ç¡®å®žæ˜¯è¿™æ ·.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯æŒ‰ç…§"),t("strong",[s._v("è®¾å®šä¸å…è®¸è¿‡æœŸè¯»çš„è¦æ±‚, å°±åªæœ‰ä¸¤ç§é€‰æ‹©, ä¸€ç§æ˜¯è¶…æ—¶æ”¾å¼ƒ, ä¸€ç§æ˜¯è½¬åˆ°ä¸»åº“æŸ¥è¯¢")]),s._v(". å…·ä½“æ€Žä¹ˆé€‰æ‹©, å°±éœ€è¦ä¸šåŠ¡å¼€å‘åŒå­¦åšå¥½é™æµç­–ç•¥äº†.")]),s._v(" "),t("h5",{attrs:{id:"gtidæ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gtidæ–¹æ¡ˆ"}},[s._v("#")]),s._v(" GTIDæ–¹æ¡ˆ")]),s._v(" "),t("p",[s._v("å¦‚æžœæ•°æ®åº“å¼€å¯äº† GTID æ¨¡å¼, å¯¹åº”çš„ä¹Ÿæœ‰ç­‰å¾… GTID çš„æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("MySQL ä¸­åŒæ ·æä¾›äº†ä¸€ä¸ªç±»ä¼¼çš„å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" wait_for_executed_gtid_set"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gtid_set"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ¡å‘½ä»¤çš„é€»è¾‘æ˜¯:")]),s._v(" "),t("ol",[t("li",[s._v("ç­‰å¾…, ç›´åˆ°è¿™ä¸ªåº“æ‰§è¡Œçš„äº‹åŠ¡ä¸­åŒ…å«ä¼ å…¥çš„ gtid_set, è¿”å›ž 0;")]),s._v(" "),t("li",[s._v("è¶…æ—¶è¿”å›ž 1.")])]),s._v(" "),t("p",[s._v("åœ¨å‰é¢ç­‰ä½ç‚¹çš„æ–¹æ¡ˆä¸­, æ‰§è¡Œå®Œäº‹åŠ¡åŽ, è¿˜è¦ä¸»åŠ¨åŽ»ä¸»åº“æ‰§è¡Œ show master status. è€Œ MySQL 5.7.6 ç‰ˆæœ¬å¼€å§‹, "),t("strong",[s._v("å…è®¸åœ¨æ‰§è¡Œå®Œæ›´æ–°ç±»äº‹åŠ¡åŽ, æŠŠè¿™ä¸ªäº‹åŠ¡çš„ GTID è¿”å›žç»™å®¢æˆ·ç«¯, è¿™æ ·ç­‰ GTID çš„æ–¹æ¡ˆå°±å¯ä»¥å‡å°‘ä¸€æ¬¡æŸ¥è¯¢")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ—¶, ç­‰ GTID çš„æ‰§è¡Œæµç¨‹å°±å˜æˆäº†:")]),s._v(" "),t("ol",[t("li",[s._v("trx1 äº‹åŠ¡æ›´æ–°å®ŒæˆåŽ, ä»Žè¿”å›žåŒ…ç›´æŽ¥èŽ·å–è¿™ä¸ªäº‹åŠ¡çš„ GTID, è®°ä¸º gtid1;")]),s._v(" "),t("li",[s._v("é€‰å®šä¸€ä¸ªä»Žåº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥;")]),s._v(" "),t("li",[s._v("åœ¨ä»Žåº“ä¸Šæ‰§è¡Œ select wait_for_executed_gtid_set(gtid1, 1);")]),s._v(" "),t("li",[s._v("å¦‚æžœè¿”å›žå€¼æ˜¯ 0, åˆ™åœ¨è¿™ä¸ªä»Žåº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥;")]),s._v(" "),t("li",[s._v("å¦åˆ™, åˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥.")])]),s._v(" "),t("p",[s._v("è·Ÿç­‰ä¸»åº“ä½ç‚¹çš„æ–¹æ¡ˆä¸€æ ·, ç­‰å¾…è¶…æ—¶åŽæ˜¯å¦ç›´æŽ¥åˆ°ä¸»åº“æŸ¥è¯¢, éœ€è¦ä¸šåŠ¡å¼€å‘åŒå­¦æ¥åšé™æµè€ƒè™‘.")]),s._v(" "),t("p",[s._v("æŠŠè¿™ä¸ªæµç¨‹å›¾ç”»å‡ºæ¥.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/adc745b0a706cd6de180563c6c0bf665-20230731161914-6f7utr7.png",alt:"",title:"wait_for_executed_gtid_setæ–¹æ¡ˆ"}})]),s._v(" "),t("p",[s._v("åœ¨ä¸Šé¢çš„ç¬¬ä¸€æ­¥ä¸­, trx1 äº‹åŠ¡æ›´æ–°å®ŒæˆåŽ, ä»Žè¿”å›žåŒ…ç›´æŽ¥èŽ·å–è¿™ä¸ªäº‹åŠ¡çš„ GTID. é—®é¢˜æ˜¯, æ€Žä¹ˆèƒ½å¤Ÿè®© MySQL åœ¨æ‰§è¡Œäº‹åŠ¡åŽ, è¿”å›žåŒ…ä¸­å¸¦ä¸Š GTID å‘¢?")]),s._v(" "),t("p",[s._v("åªéœ€è¦å°†å‚æ•° session_track_gtids è®¾ç½®ä¸º OWN_GTID, ç„¶åŽé€šè¿‡ API æŽ¥å£ mysql_session_track_get_first ä»Žè¿”å›žåŒ…è§£æžå‡º GTID çš„å€¼å³å¯.")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç» mysql_reset_connection çš„æ—¶å€™, æœ‰äººé—®è¿™ç±»æŽ¥å£åº”è¯¥æ€Žä¹ˆä½¿ç”¨. è¿™é‡Œå†å›žç­”ä¸€ä¸‹. å…¶å®ž, MySQL å¹¶æ²¡æœ‰æä¾›è¿™ç±»æŽ¥å£çš„ SQL ç”¨æ³•, æ˜¯æä¾›ç»™ç¨‹åºçš„ API("),t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/c-api-functions.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://dev.mysql.com/doc/refman/5.7/en/c-api-functions.html"),t("OutboundLink")],1),s._v(").")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸ºäº†è®©å®¢æˆ·ç«¯åœ¨äº‹åŠ¡æäº¤åŽ, è¿”å›žçš„ GITD èƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºå‡ºæ¥, å¯¹ MySQL å®¢æˆ·ç«¯ä»£ç åšäº†ç‚¹ä¿®æ”¹, å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5e2ac2f3ccf6e40d82a7fe51a209bad1-20230731161914-wgpa34t.png",alt:"",title:"æ˜¾ç¤ºæ›´æ–°äº‹åŠ¡çš„GTID-ä»£ç "}})]),s._v(" "),t("p",[s._v("è¿™æ ·å°±å¯ä»¥çœ‹åˆ°è¯­å¥æ‰§è¡Œå®Œæˆ, æ˜¾ç¤ºå‡º GITD çš„å€¼.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/602b5c25ef4f3cc28930e1bb0cef934e-20230731161914-lrlgxup.png",alt:"",title:"æ˜¾ç¤ºæ›´æ–°äº‹åŠ¡çš„GTID-æ•ˆæžœ"}})]),s._v(" "),t("p",[s._v("å½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªä¾‹å­. è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆçš„æ—¶å€™, è¿˜æ˜¯åº”è¯¥åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­è°ƒç”¨ mysql_session_track_get_first è¿™ä¸ªå‡½æ•°.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-27"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-27"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†ä¸€ä¸»å¤šä»Žåšè¯»å†™åˆ†ç¦»æ—¶, å¯èƒ½ç¢°åˆ°è¿‡æœŸè¯»çš„åŽŸå› , ä»¥åŠå‡ ç§åº”å¯¹çš„æ–¹æ¡ˆ.")]),s._v(" "),t("p",[t("strong",[s._v("è¿™å‡ ç§æ–¹æ¡ˆä¸­, æœ‰çš„æ–¹æ¡ˆçœ‹ä¸ŠåŽ»æ˜¯åšäº†å¦¥å, æœ‰çš„æ–¹æ¡ˆçœ‹ä¸ŠåŽ»ä¸é‚£ä¹ˆé è°±å„¿, ä½†éƒ½æ˜¯æœ‰å®žé™…åº”ç”¨åœºæ™¯çš„, ä½ éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©")]),s._v(".")]),s._v(" "),t("p",[s._v("å³ä½¿æ˜¯æœ€åŽç­‰å¾…ä½ç‚¹å’Œç­‰å¾… GTID è¿™ä¸¤ä¸ªæ–¹æ¡ˆ, è™½ç„¶çœ‹ä¸ŠåŽ»æ¯”è¾ƒé è°±, ä½†ä»ç„¶å­˜åœ¨éœ€è¦æƒè¡¡çš„æƒ…å†µ. å¦‚æžœæ‰€æœ‰çš„ä»Žåº“éƒ½å»¶è¿Ÿ, é‚£ä¹ˆè¯·æ±‚å°±ä¼šå…¨éƒ¨è½åˆ°ä¸»åº“ä¸Š, è¿™æ—¶å€™ä¼šä¸ä¼šç”±äºŽåŽ‹åŠ›çªç„¶å¢žå¤§, æŠŠä¸»åº“æ‰“æŒ‚äº†å‘¢?")]),s._v(" "),t("p",[s._v("å…¶å®ž, åœ¨å®žé™…åº”ç”¨ä¸­, è¿™å‡ ä¸ªæ–¹æ¡ˆæ˜¯"),t("strong",[s._v("å¯ä»¥æ··åˆä½¿ç”¨")]),s._v("çš„. "),t("strong",[s._v("æ¯”å¦‚, å…ˆåœ¨å®¢æˆ·ç«¯å¯¹è¯·æ±‚åšåˆ†ç±», åŒºåˆ†å“ªäº›è¯·æ±‚å¯ä»¥æŽ¥å—è¿‡æœŸè¯», è€Œå“ªäº›è¯·æ±‚å®Œå…¨ä¸èƒ½æŽ¥å—è¿‡æœŸè¯»; ç„¶åŽ, å¯¹äºŽä¸èƒ½æŽ¥å—è¿‡æœŸè¯»çš„è¯­å¥, å†ä½¿ç”¨ç­‰ GTID æˆ–ç­‰ä½ç‚¹çš„æ–¹æ¡ˆ")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†è¯è¯´å›žæ¥, "),t("mark",[t("strong",[s._v("è¿‡æœŸè¯»åœ¨æœ¬è´¨ä¸Šæ˜¯ç”±ä¸€å†™å¤šè¯»å¯¼è‡´çš„")])]),s._v(". åœ¨å®žé™…åº”ç”¨ä¸­, å¯èƒ½ä¼šæœ‰åˆ«çš„ä¸éœ€è¦ç­‰å¾…å°±å¯ä»¥æ°´å¹³æ‰©å±•çš„æ•°æ®åº“æ–¹æ¡ˆ, ä½†è¿™å¾€å¾€æ˜¯ç”¨ç‰ºç‰²å†™æ€§èƒ½æ¢æ¥çš„, ä¹Ÿå°±æ˜¯éœ€è¦åœ¨è¯»æ€§èƒ½å’Œå†™æ€§èƒ½ä¸­å–æƒè¡¡.")]),s._v(" "),t("h4",{attrs:{id:"_29-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_29-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†"}},[s._v("#")]),s._v(" 29-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†?")]),s._v(" "),t("p",[s._v("å‰é¢ä¸¤èŠ‚ä»‹ç»äº†ä¸»å¤‡åˆ‡æ¢æµç¨‹. é€šè¿‡è¿™äº›å†…å®¹çš„è®²è§£, ä½ åº”è¯¥å·²ç»å¾ˆæ¸…æ¥šäº†: åœ¨ä¸€ä¸»ä¸€å¤‡çš„åŒ M æž¶æž„é‡Œ, ä¸»å¤‡åˆ‡æ¢åªéœ€è¦æŠŠå®¢æˆ·ç«¯æµé‡åˆ‡åˆ°å¤‡åº“; è€Œåœ¨ä¸€ä¸»å¤šä»Žæž¶æž„é‡Œ, ä¸»å¤‡åˆ‡æ¢é™¤äº†è¦æŠŠå®¢æˆ·ç«¯æµé‡åˆ‡åˆ°å¤‡åº“å¤–, è¿˜éœ€è¦æŠŠä»Žåº“æŽ¥åˆ°æ–°ä¸»åº“ä¸Š. ä¸»å¤‡åˆ‡æ¢æœ‰ä¸¤ç§åœºæ™¯, "),t("strong",[s._v("ä¸€ç§æ˜¯ä¸»åŠ¨åˆ‡æ¢, ä¸€ç§æ˜¯è¢«åŠ¨åˆ‡æ¢")]),s._v(". è€Œå…¶ä¸­è¢«åŠ¨åˆ‡æ¢, å¾€å¾€æ˜¯å› ä¸ºä¸»åº“å‡ºé—®é¢˜äº†, ç”± HA ç³»ç»Ÿå‘èµ·çš„.")]),s._v(" "),t("p",[s._v("è¿™ä¹Ÿå°±å¼•å‡ºäº†ä»Šå¤©è¦è®¨è®ºçš„é—®é¢˜: **æ€Žä¹ˆåˆ¤æ–­ä¸€ä¸ªä¸»åº“å‡ºé—®é¢˜äº†? ** ä½ ä¸€å®šä¼šè¯´, è¿™å¾ˆç®€å•å•Š, è¿žä¸Š MySQL, æ‰§è¡Œä¸ª select 1 å°±å¥½äº†. ä½†æ˜¯ select 1 æˆåŠŸè¿”å›žäº†, å°±è¡¨ç¤ºä¸»åº“æ²¡é—®é¢˜å—?")]),s._v(" "),t("h5",{attrs:{id:"select-1åˆ¤æ–­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#select-1åˆ¤æ–­"}},[s._v("#")]),s._v(" select 1åˆ¤æ–­")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, select 1 æˆåŠŸè¿”å›ž, "),t("strong",[s._v("åªèƒ½è¯´æ˜Žè¿™ä¸ªåº“çš„è¿›ç¨‹è¿˜åœ¨")]),s._v(", å¹¶ä¸èƒ½è¯´æ˜Žä¸»åº“æ²¡é—®é¢˜. çŽ°åœ¨æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" innodb_thread_concurrency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/77989bb851024ce825267c6ba368e7ed-20230731161914-awndzgq.png",alt:"",title:"æŸ¥è¯¢blocked"}})]),s._v(" "),t("p",[s._v("è®¾ç½® innodb_thread_concurrency å‚æ•°çš„ç›®çš„æ˜¯, æŽ§åˆ¶ InnoDB çš„"),t("strong",[s._v("å¹¶å‘çº¿ç¨‹ä¸Šé™")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, ä¸€æ—¦å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°è¿™ä¸ªå€¼, InnoDB åœ¨æŽ¥æ”¶åˆ°æ–°è¯·æ±‚çš„æ—¶å€™, å°±ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€, ç›´åˆ°æœ‰çº¿ç¨‹é€€å‡º. è¿™é‡ŒæŠŠ innodb_thread_concurrency è®¾ç½®æˆ 3, "),t("strong",[s._v("è¡¨ç¤º InnoDB åªå…è®¸ 3 ä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ")]),s._v('. è€Œåœ¨ä¾‹å­ä¸­, å‰ä¸‰ä¸ª session ä¸­çš„ sleep(100), ä½¿å¾—è¿™ä¸‰ä¸ªè¯­å¥éƒ½å¤„äºŽ"æ‰§è¡Œ"çŠ¶æ€, ä»¥æ­¤æ¥æ¨¡æ‹Ÿå¤§æŸ¥è¯¢.')]),s._v(" "),t("p",[s._v("ä½ çœ‹åˆ°äº†, session D é‡Œé¢, "),t("strong",[s._v("select 1 æ˜¯èƒ½æ‰§è¡ŒæˆåŠŸçš„, ä½†æ˜¯æŸ¥è¯¢è¡¨ t çš„è¯­å¥ä¼šè¢«å µä½")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, å¦‚æžœè¿™æ—¶å€™ç”¨ select 1 æ¥æ£€æµ‹å®žä¾‹æ˜¯å¦æ­£å¸¸çš„è¯, æ˜¯æ£€æµ‹ä¸å‡ºé—®é¢˜çš„.")]),s._v(" "),t("p",[s._v("åœ¨ InnoDB ä¸­, innodb_thread_concurrency è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼æ˜¯ 0, è¡¨ç¤º"),t("strong",[s._v("ä¸é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡")]),s._v(". ä½†æ˜¯ä¸é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°è‚¯å®šæ˜¯ä¸è¡Œçš„. å› ä¸ºä¸€ä¸ªæœºå™¨çš„ CPU æ ¸æ•°æœ‰é™, çº¿ç¨‹å…¨å†²è¿›æ¥, "),t("strong",[s._v("ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬å°±ä¼šå¤ªé«˜")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹, "),t("strong",[s._v("å»ºè®®æŠŠ innodb_thread_concurrency è®¾ç½®ä¸º 64~128 ä¹‹é—´çš„å€¼")]),s._v(". è¿™æ—¶ä½ ä¸€å®šä¼šæœ‰ç–‘é—®, å¹¶å‘çº¿ç¨‹ä¸Šé™æ•°è®¾ç½®ä¸º 128 å¤Ÿå¹²å•¥, çº¿ä¸Šçš„å¹¶å‘è¿žæŽ¥æ•°åŠ¨ä¸åŠ¨å°±ä¸Šåƒäº†. äº§ç”Ÿè¿™ä¸ªç–‘é—®çš„åŽŸå› , æ˜¯æžæ··äº†"),t("strong",[s._v("å¹¶å‘è¿žæŽ¥å’Œå¹¶å‘æŸ¥è¯¢. ** å¹¶å‘è¿žæŽ¥å’Œå¹¶å‘æŸ¥è¯¢ "),t("strong",[s._v(", å¹¶ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µ")]),s._v(". ä½ åœ¨ show processlist çš„ç»“æžœé‡Œ, çœ‹åˆ°çš„å‡ åƒä¸ªè¿žæŽ¥, æŒ‡çš„å°±æ˜¯")]),s._v('å¹¶å‘è¿žæŽ¥**. è€Œ "å½“å‰æ­£åœ¨æ‰§è¡Œ" çš„è¯­å¥, æ‰æ˜¯æ‰€è¯´çš„å¹¶å‘æŸ¥è¯¢.')]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("å¹¶å‘è¿žæŽ¥æ•°è¾¾åˆ°å‡ åƒä¸ªå½±å“å¹¶ä¸å¤§, å°±æ˜¯å¤šå ä¸€äº›å†…å­˜è€Œå·²")])]),s._v(". åº”è¯¥å…³æ³¨çš„æ˜¯å¹¶å‘æŸ¥è¯¢, å› ä¸ºå¹¶å‘æŸ¥è¯¢å¤ªé«˜æ‰æ˜¯ CPU æ€æ‰‹. è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½® innodb_thread_concurrency å‚æ•°çš„åŽŸå› .")]),s._v(" "),t("p",[s._v("ç„¶åŽ, ä½ å¯èƒ½è¿˜ä¼šæƒ³å‰é¢è®²åˆ°çš„çƒ­ç‚¹æ›´æ–°å’Œæ­»é”æ£€æµ‹çš„æ—¶å€™, å¦‚æžœæŠŠ innodb_thread_concurrency è®¾ç½®ä¸º 128 çš„è¯, é‚£ä¹ˆå‡ºçŽ°åŒä¸€è¡Œçƒ­ç‚¹æ›´æ–°çš„é—®é¢˜æ—¶, æ˜¯ä¸æ˜¯å¾ˆå¿«å°±æŠŠ 128 æ¶ˆè€—å®Œäº†, è¿™æ ·æ•´ä¸ªç³»ç»Ÿæ˜¯ä¸æ˜¯å°±æŒ‚äº†å‘¢?")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, "),t("mark",[t("strong",[s._v("åœ¨çº¿ç¨‹è¿›å…¥é”ç­‰å¾…ä»¥åŽ, å¹¶å‘çº¿ç¨‹çš„è®¡æ•°ä¼šå‡ä¸€")])]),s._v(", ä¹Ÿå°±æ˜¯è¯´ç­‰è¡Œé”(ä¹ŸåŒ…æ‹¬é—´éš™é”)çš„çº¿ç¨‹æ˜¯ä¸ç®—åœ¨ 128 é‡Œé¢çš„. "),t("strong",[s._v("MySQL è¿™æ ·è®¾è®¡æ˜¯éžå¸¸æœ‰æ„ä¹‰çš„. å› ä¸ºè¿›å…¥é”ç­‰å¾…çš„çº¿ç¨‹å·²ç»ä¸åƒ CPU äº†; æ›´é‡è¦çš„æ˜¯, å¿…é¡»è¿™ä¹ˆè®¾è®¡, æ‰èƒ½é¿å…æ•´ä¸ªç³»ç»Ÿé”æ­»")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆå‘¢? å‡è®¾å¤„äºŽé”ç­‰å¾…çš„çº¿ç¨‹ä¹Ÿå å¹¶å‘çº¿ç¨‹çš„è®¡æ•°, å¯ä»¥è®¾æƒ³ä¸€ä¸‹è¿™ä¸ªåœºæ™¯:")]),s._v(" "),t("ol",[t("li",[s._v("çº¿ç¨‹ 1 æ‰§è¡Œ "),t("code",[s._v("begin; update t set c=c+1 where id=1")]),s._v("â€‹, å¯åŠ¨äº†äº‹åŠ¡ trx1, ç„¶åŽä¿æŒè¿™ä¸ªçŠ¶æ€. è¿™æ—¶å€™, çº¿ç¨‹å¤„äºŽç©ºé—²çŠ¶æ€, ä¸ç®—åœ¨å¹¶å‘çº¿ç¨‹é‡Œé¢.")]),s._v(" "),t("li",[s._v("çº¿ç¨‹ 2 åˆ°çº¿ç¨‹ 129 éƒ½æ‰§è¡Œ "),t("code",[s._v("update t set c=c+1 where id=1;")]),s._v("â€‹ ç”±äºŽç­‰è¡Œé”, è¿›å…¥ç­‰å¾…çŠ¶æ€. è¿™æ ·å°±æœ‰ 128 ä¸ªçº¿ç¨‹å¤„äºŽç­‰å¾…çŠ¶æ€;")]),s._v(" "),t("li",[s._v("å¦‚æžœå¤„äºŽé”ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è®¡æ•°ä¸å‡ä¸€, InnoDB å°±ä¼šè®¤ä¸ºçº¿ç¨‹æ•°ç”¨æ»¡äº†, ä¼šé˜»æ­¢å…¶ä»–è¯­å¥è¿›å…¥å¼•æ“Žæ‰§è¡Œ, è¿™æ ·çº¿ç¨‹ 1 ä¸èƒ½æäº¤äº‹åŠ¡. è€Œå¦å¤–çš„ 128 ä¸ªçº¿ç¨‹åˆå¤„äºŽé”ç­‰å¾…çŠ¶æ€, æ•´ä¸ªç³»ç»Ÿå°±å µä½äº†.")])]),s._v(" "),t("p",[s._v("ä¸‹å›¾æ˜¾ç¤ºçš„å°±æ˜¯è¿™ä¸ªçŠ¶æ€.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ff35126db0dc40c19660a7b357895a68-20230731161914-ebokt3p.png",alt:"",title:"ç³»ç»Ÿé”æ­»çŠ¶æ€(å‡è®¾ç­‰è¡Œé”çš„è¯­å¥å ç”¨å¹¶å‘è®¡æ•°)"}})]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™ InnoDB ä¸èƒ½å“åº”ä»»ä½•è¯·æ±‚, æ•´ä¸ªç³»ç»Ÿè¢«é”æ­». è€Œä¸”ç”±äºŽæ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºŽç­‰å¾…çŠ¶æ€, æ­¤æ—¶å ç”¨çš„ CPU å´æ˜¯ 0, è€Œè¿™æ˜Žæ˜¾ä¸åˆç†. æ‰€ä»¥ InnoDB åœ¨è®¾è®¡æ—¶, "),t("strong",[s._v("é‡åˆ°è¿›ç¨‹è¿›å…¥é”ç­‰å¾…çš„æƒ…å†µæ—¶, å°†å¹¶å‘çº¿ç¨‹çš„è®¡æ•°å‡ 1 çš„è®¾è®¡, æ˜¯åˆç†è€Œä¸”æ˜¯å¿…è¦çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("è™½ç„¶è¯´ç­‰é”çš„çº¿ç¨‹ä¸ç®—åœ¨å¹¶å‘çº¿ç¨‹è®¡æ•°é‡Œ, ä½†å¦‚æžœå®ƒåœ¨"),t("strong",[s._v("çœŸæ­£åœ°æ‰§è¡ŒæŸ¥è¯¢")]),s._v(", å°±æ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­å‰ä¸‰ä¸ªäº‹åŠ¡ä¸­çš„ "),t("code",[s._v("select sleep(100) from t")]),s._v("â€‹, è¿˜æ˜¯è¦ç®—è¿›å¹¶å‘çº¿ç¨‹çš„è®¡æ•°çš„.")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªä¾‹å­ä¸­, åŒæ—¶åœ¨æ‰§è¡Œçš„è¯­å¥è¶…è¿‡äº†è®¾ç½®çš„ innodb_thread_concurrency çš„å€¼, è¿™æ—¶å€™ç³»ç»Ÿå…¶å®žå·²ç»ä¸è¡Œäº†, ä½†æ˜¯é€šè¿‡ select 1 æ¥æ£€æµ‹ç³»ç»Ÿ, ä¼šè®¤ä¸ºç³»ç»Ÿè¿˜æ˜¯æ­£å¸¸çš„.")]),s._v(" "),t("p",[s._v("å› æ­¤ä½¿ç”¨ select 1 çš„åˆ¤æ–­é€»è¾‘è¦ä¿®æ”¹ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"æŸ¥è¡¨åˆ¤æ–­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥è¡¨åˆ¤æ–­"}},[s._v("#")]),s._v(" æŸ¥è¡¨åˆ¤æ–­")]),s._v(" "),t("p",[s._v("ä¸ºäº†èƒ½å¤Ÿæ£€æµ‹ InnoDB å¹¶å‘çº¿ç¨‹æ•°è¿‡å¤šå¯¼è‡´çš„ç³»ç»Ÿä¸å¯ç”¨æƒ…å†µ, éœ€è¦æ‰¾ä¸€ä¸ªè®¿é—® InnoDB çš„åœºæ™¯. ä¸€èˆ¬çš„åšæ³•æ˜¯, åœ¨ç³»ç»Ÿåº“(mysql åº“)é‡Œåˆ›å»ºä¸€ä¸ªè¡¨, æ¯”å¦‚å‘½åä¸º health_check, é‡Œé¢åªæ”¾ä¸€è¡Œæ•°æ®, ç„¶åŽå®šæœŸæ‰§è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("health_check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä½¿ç”¨è¿™ä¸ªæ–¹æ³•, å¯ä»¥æ£€æµ‹å‡º"),t("strong",[s._v("ç”±äºŽå¹¶å‘çº¿ç¨‹è¿‡å¤šå¯¼è‡´çš„æ•°æ®åº“ä¸å¯ç”¨")]),s._v("çš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯é©¬ä¸Šè¿˜ä¼šç¢°åˆ°ä¸‹ä¸€ä¸ªé—®é¢˜, å³: ç©ºé—´æ»¡äº†ä»¥åŽ, è¿™ç§æ–¹æ³•åˆä¼šå˜å¾—ä¸å¥½ä½¿.")]),s._v(" "),t("p",[s._v("ç”±äºŽæ›´æ–°äº‹åŠ¡è¦å†™ binlog, è€Œä¸€æ—¦ binlog æ‰€åœ¨ç£ç›˜çš„ç©ºé—´å ç”¨çŽ‡è¾¾åˆ° 100%, é‚£ä¹ˆ"),t("strong",[s._v("æ‰€æœ‰çš„æ›´æ–°è¯­å¥å’Œäº‹åŠ¡æäº¤çš„ commit è¯­å¥å°±éƒ½ä¼šè¢«å µä½")]),s._v(". ä½†æ˜¯ç³»ç»Ÿè¿™æ—¶å€™è¿˜æ˜¯å¯ä»¥æ­£å¸¸è¯»æ•°æ®çš„.")]),s._v(" "),t("p",[s._v("å› æ­¤è¿˜æ˜¯æŠŠè¿™æ¡ç›‘æŽ§è¯­å¥å†æ”¹è¿›ä¸€ä¸‹. æŽ¥ä¸‹æ¥å°±çœ‹çœ‹"),t("strong",[s._v("æŠŠæŸ¥è¯¢è¯­å¥æ”¹æˆæ›´æ–°è¯­å¥")]),s._v("åŽçš„æ•ˆæžœ.")]),s._v(" "),t("h5",{attrs:{id:"æ›´æ–°åˆ¤æ–­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ›´æ–°åˆ¤æ–­"}},[s._v("#")]),s._v(" æ›´æ–°åˆ¤æ–­")]),s._v(" "),t("p",[s._v("æ—¢ç„¶è¦æ›´æ–°, å°±è¦æ”¾ä¸ªæœ‰æ„ä¹‰çš„å­—æ®µ, å¸¸è§åšæ³•æ˜¯æ”¾ä¸€ä¸ª "),t("strong",[s._v("timestamp")]),s._v(" å­—æ®µ, ç”¨æ¥è¡¨ç¤ºæœ€åŽä¸€æ¬¡æ‰§è¡Œæ£€æµ‹çš„æ—¶é—´. è¿™æ¡æ›´æ–°è¯­å¥ç±»ä¼¼äºŽ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("health_check "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" t_modified"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("èŠ‚ç‚¹å¯ç”¨æ€§çš„æ£€æµ‹éƒ½åº”è¯¥åŒ…å«ä¸»åº“å’Œå¤‡åº“")]),s._v(". å¦‚æžœç”¨æ›´æ–°æ¥æ£€æµ‹ä¸»åº“çš„è¯, é‚£ä¹ˆå¤‡åº“ä¹Ÿè¦è¿›è¡Œæ›´æ–°æ£€æµ‹.")]),s._v(" "),t("p",[s._v("ä½†å¤‡åº“çš„æ£€æµ‹ä¹Ÿæ˜¯è¦å†™ binlog çš„. ç”±äºŽä¸€èˆ¬ä¼šæŠŠæ•°æ®åº“ A å’Œ B çš„ä¸»å¤‡å…³ç³»è®¾è®¡ä¸ºåŒ M ç»“æž„, æ‰€ä»¥åœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œçš„æ£€æµ‹å‘½ä»¤, ä¹Ÿè¦å‘å›žç»™ä¸»åº“ A. ä½†æ˜¯å¦‚æžœä¸»åº“ A å’Œå¤‡åº“ B éƒ½ç”¨ç›¸åŒçš„æ›´æ–°å‘½ä»¤, å°±å¯èƒ½å‡ºçŽ°è¡Œå†²çª, ä¹Ÿå°±æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢. æ‰€ä»¥çŽ°åœ¨çœ‹æ¥ mysql.health_check è¿™ä¸ªè¡¨å°±ä¸èƒ½åªæœ‰ä¸€è¡Œæ•°æ®äº†.")]),s._v(" "),t("p",[s._v("ä¸ºäº†è®©ä¸»å¤‡ä¹‹é—´çš„æ›´æ–°ä¸äº§ç”Ÿå†²çª, å¯ä»¥åœ¨ mysql.health_check è¡¨ä¸Š"),t("strong",[s._v("å­˜å…¥å¤šè¡Œæ•°æ®")]),s._v(", å¹¶ç”¨ A, B çš„ server_id åšä¸»é”®.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("health_check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURRENT_TIMESTAMP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æ£€æµ‹å‘½ä»¤ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("health_check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t_modified"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@server_id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("duplicate")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t_modified"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("ç”±äºŽ MySQL è§„å®šäº†"),t("strong",[s._v("ä¸»åº“å’Œå¤‡åº“çš„ server_id å¿…é¡»ä¸åŒ")]),s._v("(å¦åˆ™åˆ›å»ºä¸»å¤‡å…³ç³»çš„æ—¶å€™å°±ä¼šæŠ¥é”™), è¿™æ ·å°±å¯ä»¥ä¿è¯ä¸», å¤‡åº“å„è‡ªçš„æ£€æµ‹å‘½ä»¤ä¸ä¼šå‘ç”Ÿå†²çª.")]),s._v(" "),t("p",[t("strong",[s._v("æ›´æ–°åˆ¤æ–­æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ¡ˆäº†")]),s._v(', ä¸è¿‡ä¾ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜. å…¶ä¸­, "åˆ¤å®šæ…¢"ä¸€ç›´æ˜¯è®© DBA å¤´ç–¼çš„é—®é¢˜.')]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šä¼šç–‘æƒ‘, **æ›´æ–°è¯­å¥, å¦‚æžœå¤±è´¥æˆ–è€…è¶…æ—¶, å°±å¯ä»¥å‘èµ·ä¸»å¤‡åˆ‡æ¢äº†, ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰åˆ¤å®šæ…¢çš„é—®é¢˜å‘¢? **")]),s._v(" "),t("p",[s._v("å…¶å®ž, è¿™é‡Œæ¶‰åŠåˆ°çš„æ˜¯æœåŠ¡å™¨ IO èµ„æºåˆ†é…çš„é—®é¢˜. é¦–å…ˆæ‰€æœ‰çš„æ£€æµ‹é€»è¾‘éƒ½éœ€è¦ä¸€ä¸ªè¶…æ—¶æ—¶é—´ N. æ‰§è¡Œä¸€æ¡ update è¯­å¥, è¶…è¿‡ N ç§’åŽè¿˜ä¸è¿”å›ž, å°±è®¤ä¸ºç³»ç»Ÿä¸å¯ç”¨.")]),s._v(" "),t("p",[s._v("å¯ä»¥è®¾æƒ³ä¸€ä¸ªæ—¥å¿—ç›˜çš„ IO åˆ©ç”¨çŽ‡å·²ç»æ˜¯ 100% çš„åœºæ™¯. è¿™æ—¶å€™æ•´ä¸ªç³»ç»Ÿå“åº”éžå¸¸æ…¢, å·²ç»éœ€è¦åšä¸»å¤‡åˆ‡æ¢äº†.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯è¦çŸ¥é“, IO åˆ©ç”¨çŽ‡ 100% è¡¨ç¤ºç³»ç»Ÿçš„ IO æ˜¯åœ¨å·¥ä½œçš„, "),t("strong",[s._v("æ¯ä¸ªè¯·æ±‚éƒ½æœ‰æœºä¼šèŽ·å¾— IO èµ„æº")]),s._v(", æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡. è€Œæ£€æµ‹ä½¿ç”¨çš„ update å‘½ä»¤, éœ€è¦çš„èµ„æºå¾ˆå°‘, æ‰€ä»¥å¯èƒ½åœ¨æ‹¿åˆ° IO èµ„æºçš„æ—¶å€™å°±å¯ä»¥æäº¤æˆåŠŸ, å¹¶ä¸”åœ¨è¶…æ—¶æ—¶é—´ N ç§’æœªåˆ°è¾¾ä¹‹å‰å°±è¿”å›žç»™äº†æ£€æµ‹ç³»ç»Ÿ.")]),s._v(" "),t("p",[s._v('æ£€æµ‹ç³»ç»Ÿä¸€çœ‹, update å‘½ä»¤æ²¡æœ‰è¶…æ—¶, äºŽæ˜¯å°±å¾—åˆ°äº†"ç³»ç»Ÿæ­£å¸¸"çš„ç»“è®º. ä¹Ÿå°±æ˜¯è¯´, è¿™æ—¶å€™åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸Šæ­£å¸¸çš„ SQL è¯­å¥å·²ç»æ‰§è¡Œå¾—å¾ˆæ…¢äº†, ä½†æ˜¯ DBA ä¸ŠåŽ»ä¸€çœ‹, HA ç³»ç»Ÿè¿˜åœ¨æ­£å¸¸å·¥ä½œ, å¹¶ä¸”è®¤ä¸ºä¸»åº“çŽ°åœ¨å¤„äºŽå¯ç”¨çŠ¶æ€.')]),s._v(" "),t("p",[s._v("ä¹‹æ‰€ä»¥ä¼šå‡ºçŽ°è¿™ä¸ªçŽ°è±¡, æ ¹æœ¬åŽŸå› æ˜¯ä¸Šé¢è¯´çš„æ‰€æœ‰æ–¹æ³•, éƒ½æ˜¯"),t("strong",[s._v("åŸºäºŽå¤–éƒ¨æ£€æµ‹")]),s._v("çš„. å¤–éƒ¨æ£€æµ‹å¤©ç„¶æœ‰ä¸€ä¸ªé—®é¢˜, å°±æ˜¯éšæœºæ€§. å› ä¸º, å¤–éƒ¨æ£€æµ‹éƒ½éœ€è¦å®šæ—¶è½®è¯¢, æ‰€ä»¥ç³»ç»Ÿå¯èƒ½å·²ç»å‡ºé—®é¢˜äº†, ä½†æ˜¯å´éœ€è¦ç­‰åˆ°ä¸‹ä¸€ä¸ªæ£€æµ‹å‘èµ·æ‰§è¡Œè¯­å¥çš„æ—¶å€™, æ‰æœ‰å¯èƒ½å‘çŽ°é—®é¢˜. è€Œä¸”å¦‚æžœä½ çš„è¿æ°”ä¸å¤Ÿå¥½çš„è¯, å¯èƒ½ç¬¬ä¸€æ¬¡è½®è¯¢è¿˜ä¸èƒ½å‘çŽ°, è¿™å°±ä¼šå¯¼è‡´åˆ‡æ¢æ…¢çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, æŽ¥ä¸‹æ¥å†ä»‹ç»ä¸€ç§"),t("strong",[s._v("åœ¨ MySQL å†…éƒ¨å‘çŽ°æ•°æ®åº“é—®é¢˜çš„æ–¹æ³•")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å†…éƒ¨ç»Ÿè®¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…éƒ¨ç»Ÿè®¡"}},[s._v("#")]),s._v(" å†…éƒ¨ç»Ÿè®¡")]),s._v(" "),t("p",[s._v("é’ˆå¯¹ç£ç›˜åˆ©ç”¨çŽ‡è¿™ä¸ªé—®é¢˜, å¦‚æžœ MySQL å¯ä»¥å‘Šè¯‰æˆ‘ä»¬, å†…éƒ¨æ¯ä¸€æ¬¡ IO è¯·æ±‚çš„æ—¶é—´, é‚£åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å‡ºé—®é¢˜çš„æ–¹æ³•å°±å¯é å¾—å¤šäº†. å…¶å®ž MySQL 5.6 ç‰ˆæœ¬ä»¥åŽæä¾›çš„ performance_schema åº“, å°±åœ¨ "),t("strong",[s._v("file_summary_by_event_name")]),s._v(" è¡¨é‡Œç»Ÿè®¡äº†æ¯æ¬¡ IO è¯·æ±‚çš„æ—¶é—´.")]),s._v(" "),t("p",[s._v("file_summary_by_event_name è¡¨é‡Œæœ‰å¾ˆå¤šè¡Œæ•°æ®, å…ˆæ¥çœ‹çœ‹ "),t("code",[s._v("event_name='wait/io/file/innodb/innodb_log_file'")]),s._v("â€‹ è¿™ä¸€è¡Œ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0f828836c41aed88800180e0125713f5-20230731161914-on9xlrh.png",alt:""}})]),s._v(" "),t("p",[s._v("å›¾ä¸­è¿™ä¸€è¡Œè¡¨ç¤ºç»Ÿè®¡çš„æ˜¯ redo log çš„å†™å…¥æ—¶é—´, ç¬¬ä¸€åˆ— EVENT_NAME è¡¨ç¤ºç»Ÿè®¡çš„ç±»åž‹.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥çš„ä¸‰ç»„æ•°æ®, æ˜¾ç¤ºçš„æ˜¯ redo log æ“ä½œçš„æ—¶é—´ç»Ÿè®¡.")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ç»„äº”åˆ—, "),t("strong",[s._v("æ˜¯æ‰€æœ‰ IO ç±»åž‹çš„ç»Ÿè®¡")]),s._v(". å…¶ä¸­, COUNT_STAR æ˜¯æ‰€æœ‰ IO çš„æ€»æ¬¡æ•°, æŽ¥ä¸‹æ¥å››åˆ—æ˜¯å…·ä½“çš„ç»Ÿè®¡é¡¹,  å•ä½æ˜¯çš®ç§’; å‰ç¼€ SUM, MIN, AVG, MAX, é¡¾åæ€ä¹‰æŒ‡çš„å°±æ˜¯æ€»å’Œ, æœ€å°å€¼, å¹³å‡å€¼å’Œæœ€å¤§å€¼.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒç»„å…­åˆ—, "),t("strong",[s._v("æ˜¯è¯»æ“ä½œçš„ç»Ÿè®¡")]),s._v(". æœ€åŽä¸€åˆ— SUM_NUMBER_OF_BYTES_READ ç»Ÿè®¡çš„æ˜¯, æ€»å…±ä»Ž redo log é‡Œè¯»äº†å¤šå°‘ä¸ªå­—èŠ‚.")]),s._v(" "),t("p",[s._v("ç¬¬ä¸‰ç»„å…­åˆ—, "),t("strong",[s._v("ç»Ÿè®¡çš„æ˜¯å†™æ“ä½œ")]),s._v(".")]),s._v(" "),t("p",[s._v("æœ€åŽçš„ç¬¬å››ç»„æ•°æ®, æ˜¯å¯¹å…¶ä»–ç±»åž‹æ•°æ®çš„ç»Ÿè®¡. åœ¨ redo log é‡Œ, å¯ä»¥è®¤ä¸ºå®ƒä»¬å°±æ˜¯å¯¹ fsync çš„ç»Ÿè®¡.")]),s._v(" "),t("p",[s._v('åœ¨ performance_schema åº“çš„ file_summary_by_event_name è¡¨é‡Œ, binlog å¯¹åº”çš„æ˜¯ event_name = "wait/io/file/sql/binlog" è¿™ä¸€è¡Œ. å„ä¸ªå­—æ®µçš„ç»Ÿè®¡é€»è¾‘, ä¸Ž redo log çš„å„ä¸ªå­—æ®µå®Œå…¨ç›¸åŒ. è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†.')]),s._v(" "),t("p",[s._v("å› ä¸ºæ¯ä¸€æ¬¡æ“ä½œæ•°æ®åº“, performance_schema éƒ½éœ€è¦é¢å¤–åœ°ç»Ÿè®¡è¿™äº›ä¿¡æ¯, æ‰€ä»¥æ‰“å¼€è¿™ä¸ªç»Ÿè®¡åŠŸèƒ½æ˜¯æœ‰æ€§èƒ½æŸè€—çš„.")]),s._v(" "),t("p",[s._v("æˆ‘çš„æµ‹è¯•ç»“æžœæ˜¯, å¦‚æžœæ‰“å¼€æ‰€æœ‰çš„ performance_schema é¡¹, æ€§èƒ½å¤§æ¦‚ä¼šä¸‹é™ 10% å·¦å³. æ‰€ä»¥å»ºè®®åªæ‰“å¼€è‡ªå·±éœ€è¦çš„é¡¹è¿›è¡Œç»Ÿè®¡. å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ‰“å¼€æˆ–è€…å…³é—­æŸä¸ªå…·ä½“é¡¹çš„ç»Ÿè®¡.")]),s._v(" "),t("p",[s._v("å¦‚æžœè¦æ‰“å¼€ redo log çš„æ—¶é—´ç›‘æŽ§, å¯ä»¥æ‰§è¡Œè¿™ä¸ªè¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" setup_instruments "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Timed"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%wait/io/file/innodb/innodb_log_file%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å‡è®¾çŽ°åœ¨ä½ å·²ç»å¼€å¯äº† redo log å’Œ binlog è¿™ä¸¤ä¸ªç»Ÿè®¡ä¿¡æ¯, é‚£è¦æ€Žä¹ˆæŠŠè¿™ä¸ªä¿¡æ¯ç”¨åœ¨å®žä¾‹çŠ¶æ€è¯Šæ–­ä¸Šå‘¢?")]),s._v(" "),t("p",[s._v("å¾ˆç®€å•, å¯ä»¥"),t("strong",[s._v("é€šè¿‡ MAX_TIMER çš„å€¼æ¥åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å‡ºé—®é¢˜")]),s._v("äº†. æ¯”å¦‚å¯ä»¥è®¾å®šé˜ˆå€¼, å•æ¬¡ IO è¯·æ±‚æ—¶é—´è¶…è¿‡ 200 æ¯«ç§’å±žäºŽå¼‚å¸¸, ç„¶åŽä½¿ç”¨ç±»ä¼¼ä¸‹é¢è¿™æ¡è¯­å¥ä½œä¸ºæ£€æµ‹é€»è¾‘.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" event_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MAX_TIMER_WAIT  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_summary_by_event_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" event_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wait/io/file/innodb/innodb_log_file'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wait/io/file/sql/binlog'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" MAX_TIMER_WAIT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å‘çŽ°å¼‚å¸¸åŽ, å–åˆ°éœ€è¦çš„ä¿¡æ¯, å†é€šè¿‡ä¸‹é¢è¿™æ¡è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("truncate")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" performance_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_summary_by_event_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æŠŠä¹‹å‰çš„ç»Ÿè®¡ä¿¡æ¯æ¸…ç©º. è¿™æ ·å¦‚æžœåŽé¢çš„ç›‘æŽ§ä¸­, å†æ¬¡å‡ºçŽ°è¿™ä¸ªå¼‚å¸¸, å°±å¯ä»¥åŠ å…¥ç›‘æŽ§ç´¯ç§¯å€¼äº†.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-28"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-28"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†"),t("strong",[s._v("æ£€æµ‹ä¸€ä¸ª MySQL å®žä¾‹å¥åº·çŠ¶æ€çš„å‡ ç§æ–¹æ³•")]),s._v(", ä»¥åŠå„ç§æ–¹æ³•å­˜åœ¨çš„é—®é¢˜å’Œæ¼”è¿›çš„é€»è¾‘.")]),s._v(" "),t("p",[s._v("ä½ çœ‹å®ŒåŽå¯èƒ½ä¼šè§‰å¾—, select 1 è¿™æ ·çš„æ–¹æ³•æ˜¯ä¸æ˜¯å·²ç»è¢«æ·˜æ±°äº†å‘¢, ä½†å®žé™…ä¸Šä½¿ç”¨éžå¸¸å¹¿æ³›çš„ "),t("strong",[s._v("MHA(Master High Availability), é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•")]),s._v('. MHA ä¸­çš„å¦ä¸€ä¸ªå¯é€‰æ–¹æ³•æ˜¯åªåšè¿žæŽ¥, å°±æ˜¯ "å¦‚æžœè¿žæŽ¥æˆåŠŸå°±è®¤ä¸ºä¸»åº“æ²¡é—®é¢˜". ä¸è¿‡æ®æˆ‘æ‰€çŸ¥, é€‰æ‹©è¿™ä¸ªæ–¹æ³•çš„å¾ˆå°‘.')]),s._v(" "),t("p",[s._v('å…¶å®žæ¯ä¸ªæ”¹è¿›çš„æ–¹æ¡ˆ, éƒ½ä¼šå¢žåŠ é¢å¤–æŸè€—, å¹¶ä¸èƒ½ç”¨"å¯¹é”™"åšç›´æŽ¥åˆ¤æ–­, éœ€è¦æ ¹æ®ä¸šåŠ¡å®žé™…æƒ…å†µåŽ»åšæƒè¡¡. æˆ‘ä¸ªäººæ¯”è¾ƒå€¾å‘çš„æ–¹æ¡ˆ, æ˜¯'),t("strong",[s._v("ä¼˜å…ˆè€ƒè™‘ update ç³»ç»Ÿè¡¨, ç„¶åŽå†é…åˆå¢žåŠ æ£€æµ‹ performance_schema çš„ä¿¡æ¯")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_30-ç­”ç–‘-äºŒ-ç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_30-ç­”ç–‘-äºŒ-ç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”"}},[s._v("#")]),s._v(" 30-ç­”ç–‘(äºŒ):ç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº† InnoDB çš„é—´éš™é”, next-key lock, ä»¥åŠåŠ é”è§„åˆ™. æœ‰äº›é—®é¢˜å¯ä»¥å¸®åŠ©ä½ åŠ æ·±å¯¹åŠ é”è§„åˆ™çš„ç†è§£. è¿™é‡ŒæŒ‘é€‰äº†å‡ ä¸ªæœ‰ä»£è¡¨æ€§çš„é—®é¢˜, æž„æˆäº†ä»Šå¤©æœ¬èŠ‚çš„ä¸»é¢˜, å³: "),t("strong",[s._v("ç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”")]),s._v(".")]),s._v(" "),t("p",[s._v('**ä¸ºäº†æ–¹ä¾¿ç†è§£, å†ä¸€èµ·å¤ä¹ ä¸€ä¸‹åŠ é”è§„åˆ™. è¿™ä¸ªè§„åˆ™ä¸­, åŒ…å«äº†ä¸¤ä¸ª"åŽŸåˆ™", ä¸¤ä¸ª"ä¼˜åŒ–"å’Œä¸€ä¸ª"bug": **')]),s._v(" "),t("ul",[t("li",[s._v("åŽŸåˆ™ 1: åŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lock. å¸Œæœ›ä½ è¿˜è®°å¾—, next-key lock æ˜¯å‰å¼€åŽé—­åŒºé—´.")]),s._v(" "),t("li",[s._v("åŽŸåˆ™ 2: æŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”.")]),s._v(" "),t("li",[s._v("ä¼˜åŒ– 1: ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢, ç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™, next-key lock é€€åŒ–ä¸ºè¡Œé”.")]),s._v(" "),t("li",[s._v("ä¼˜åŒ– 2: ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢, å‘å³éåŽ†æ—¶ä¸”æœ€åŽä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™, next-key lock é€€åŒ–ä¸ºé—´éš™é”.")]),s._v(" "),t("li",[s._v("ä¸€ä¸ª bug: å”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢.")])]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, è®¨è®ºè¿˜æ˜¯åŸºäºŽä¸‹é¢è¿™ä¸ªè¡¨ t:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h5",{attrs:{id:"ä¸ç­‰å·æ¡ä»¶é‡Œçš„ç­‰å€¼æŸ¥è¯¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ç­‰å·æ¡ä»¶é‡Œçš„ç­‰å€¼æŸ¥è¯¢"}},[s._v("#")]),s._v(" ä¸ç­‰å·æ¡ä»¶é‡Œçš„ç­‰å€¼æŸ¥è¯¢")]),s._v(" "),t("p",[s._v('æœ‰äººé—®ç­‰å€¼æŸ¥è¯¢å’Œ"éåŽ†"æœ‰ä»€ä¹ˆåŒºåˆ«? ä¸ºä»€ä¹ˆæœ‰de ä¾‹å­é‡Œé¢, where æ¡ä»¶æ˜¯ä¸ç­‰å·, è¿™ä¸ªè¿‡ç¨‹é‡Œä¹Ÿæœ‰ç­‰å€¼æŸ¥è¯¢? ä¸€èµ·æ¥çœ‹ä¸‹è¿™ä¸ªä¾‹å­, åˆ†æžä¸€ä¸‹è¿™æ¡æŸ¥è¯¢è¯­å¥çš„åŠ é”èŒƒå›´:')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("åˆ©ç”¨ä¸Šé¢çš„åŠ é”è§„åˆ™, å¯ä»¥çŸ¥é“è¿™ä¸ªè¯­å¥çš„åŠ é”èŒƒå›´æ˜¯ä¸»é”®ç´¢å¼•ä¸Šçš„ (0,5], (5,10] å’Œ (10, 15). ä¹Ÿå°±æ˜¯è¯´, id=15 è¿™ä¸€è¡Œ, å¹¶æ²¡æœ‰è¢«åŠ ä¸Šè¡Œé”. ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬è¯´åŠ é”å•ä½æ˜¯ next-key lock, éƒ½æ˜¯å‰å¼€åŽé—­åŒºé—´, ä½†æ˜¯è¿™é‡Œç”¨åˆ°äº†ä¼˜åŒ– 2, å³ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢, å‘å³éåŽ†çš„æ—¶å€™ id=15 ä¸æ»¡è¶³æ¡ä»¶, æ‰€ä»¥ next-key lock é€€åŒ–ä¸ºäº†é—´éš™é” (10, 15).")]),s._v(" "),t("p",[s._v('ä½†æ˜¯æŸ¥è¯¢è¯­å¥ä¸­ where æ¡ä»¶æ˜¯å¤§äºŽå·å’Œå°äºŽå·, è¿™é‡Œçš„"ç­‰å€¼æŸ¥è¯¢"åˆæ˜¯ä»Žå“ªé‡Œæ¥çš„å‘¢?')]),s._v(" "),t("p",[s._v("è¦çŸ¥é“, "),t("strong",[s._v("åŠ é”åŠ¨ä½œæ˜¯å‘ç”Ÿåœ¨è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„")]),s._v(", æ‰€ä»¥åœ¨åˆ†æžåŠ é”è¡Œä¸ºçš„æ—¶å€™, è¦ä»Žç´¢å¼•ä¸Šçš„æ•°æ®ç»“æž„å¼€å§‹. è¿™é‡Œå†æŠŠè¿™ä¸ªè¿‡ç¨‹æ‹†è§£ä¸€ä¸‹. å¦‚ä¸‹å›¾æ‰€ç¤º, æ˜¯è¿™ä¸ªè¡¨çš„ç´¢å¼• id çš„ç¤ºæ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1fb6a761de5cfca08e299bbe6ef57757-20230731161914-oa7s0k3.png",alt:""}})]),s._v(" "),t("ol",[t("li",[s._v('é¦–å…ˆè¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰æ˜¯ order by id desc, è¦æ‹¿åˆ°æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œ, ä¼˜åŒ–å™¨å¿…é¡»å…ˆæ‰¾åˆ°"ç¬¬ä¸€ä¸ª id<12 çš„å€¼".')]),s._v(" "),t("li",[s._v("è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ç´¢å¼•æ ‘çš„æœç´¢è¿‡ç¨‹å¾—åˆ°çš„, åœ¨å¼•æ“Žå†…éƒ¨, å…¶å®žæ˜¯è¦æ‰¾åˆ° id=12 çš„è¿™ä¸ªå€¼, åªæ˜¯æœ€ç»ˆæ²¡æ‰¾åˆ°, ä½†æ‰¾åˆ°äº† (10,15) è¿™ä¸ªé—´éš™.")]),s._v(" "),t("li",[s._v("ç„¶åŽå‘å·¦éåŽ†, åœ¨éåŽ†è¿‡ç¨‹ä¸­, å°±ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢äº†, ä¼šæ‰«æåˆ° id=5 è¿™ä¸€è¡Œ, æ‰€ä»¥ä¼šåŠ ä¸€ä¸ª next-key lock (0,5].")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­, "),t("strong",[s._v('é€šè¿‡æ ‘æœç´¢çš„æ–¹å¼å®šä½è®°å½•çš„æ—¶å€™, ç”¨çš„æ˜¯"ç­‰å€¼æŸ¥è¯¢"çš„æ–¹æ³•')]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ç­‰å€¼æŸ¥è¯¢çš„è¿‡ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç­‰å€¼æŸ¥è¯¢çš„è¿‡ç¨‹"}},[s._v("#")]),s._v(" ç­‰å€¼æŸ¥è¯¢çš„è¿‡ç¨‹")]),s._v(" "),t("p",[s._v("ä¸Žä¸Šé¢è¿™ä¸ªä¾‹å­å¯¹åº”çš„, æ˜¯è¿™ä¸ªé—®é¢˜: ä¸‹é¢è¿™ä¸ªè¯­å¥çš„åŠ é”èŒƒå›´æ˜¯ä»€ä¹ˆ?")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("share")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™æ¡æŸ¥è¯¢è¯­å¥é‡Œç”¨çš„æ˜¯ in, å…ˆæ¥çœ‹è¿™æ¡è¯­å¥çš„ explain ç»“æžœ.")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/58dc1a1034358019ed3638666037666e-20230731161914-wbv09bk.png",alt:""}}),s._v("å¯ä»¥çœ‹åˆ°, è¿™æ¡ in è¯­å¥ä½¿ç”¨äº†"),t("strong",[s._v("ç´¢å¼• c")]),s._v(" å¹¶ä¸” rows=3, è¯´æ˜Žè¿™ä¸‰ä¸ªå€¼éƒ½æ˜¯"),t("strong",[s._v("é€šè¿‡ B+ æ ‘æœç´¢å®šä½")]),s._v("çš„. åœ¨æŸ¥æ‰¾ c=5 çš„æ—¶å€™, å…ˆé”ä½äº† (0,5]. ä½†æ˜¯å› ä¸º c ä¸æ˜¯å”¯ä¸€ç´¢å¼•, ä¸ºäº†ç¡®è®¤è¿˜æœ‰æ²¡æœ‰åˆ«çš„è®°å½• c=5, å°±è¦"),t("strong",[s._v("å‘å³éåŽ†")]),s._v(", æ‰¾åˆ° c=10 æ‰ç¡®è®¤æ²¡æœ‰äº†, è¿™ä¸ªè¿‡ç¨‹æ»¡è¶³ä¼˜åŒ– 2, æ‰€ä»¥åŠ äº†"),t("strong",[s._v("é—´éš™é” (5,10)")]),s._v(" . åŒæ ·çš„, æ‰§è¡Œ c=10 è¿™ä¸ªé€»è¾‘çš„æ—¶å€™, åŠ é”çš„èŒƒå›´æ˜¯ (5,10] å’Œ (10,15); æ‰§è¡Œ c=20 è¿™ä¸ªé€»è¾‘çš„æ—¶å€™, åŠ é”çš„èŒƒå›´æ˜¯ (15,20] å’Œ (20,25).")]),s._v(" "),t("p",[s._v("é€šè¿‡è¿™ä¸ªåˆ†æžå¯ä»¥çŸ¥é“, è¿™æ¡è¯­å¥åœ¨ç´¢å¼• c ä¸ŠåŠ çš„ä¸‰ä¸ªè®°å½•é”çš„é¡ºåºæ˜¯: å…ˆåŠ  c=5 çš„è®°å½•é”, å†åŠ  c=10 çš„è®°å½•é”, æœ€åŽåŠ  c=20 çš„è®°å½•é”.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè¯´, è¿™ä¸ªåŠ é”èŒƒå›´, ä¸å°±æ˜¯ä»Ž (5,25) ä¸­åŽ»æŽ‰ c=15 çš„è¡Œé”å—? ä¸ºä»€ä¹ˆè¿™ä¹ˆéº»çƒ¦åœ°åˆ†æ®µè¯´å‘¢? å› ä¸ºè¦å¼ºè°ƒè¿™ä¸ªè¿‡ç¨‹: "),t("mark",[t("strong",[s._v('è¿™äº›é”æ˜¯"åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸€ä¸ªä¸€ä¸ªåŠ çš„", è€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ ä¸ŠåŽ»çš„')])]),s._v(".")]),s._v(" "),t("p",[s._v("ç†è§£äº†è¿™ä¸ªåŠ é”è¿‡ç¨‹ä¹‹åŽ, å°±å¯ä»¥æ¥åˆ†æžä¸‹é¢ä¾‹å­ä¸­çš„æ­»é”é—®é¢˜äº†.")]),s._v(" "),t("p",[s._v("å¦‚æžœåŒæ—¶æœ‰å¦å¤–ä¸€ä¸ªè¯­å¥, æ˜¯è¿™ä¹ˆå†™çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ­¤æ—¶çš„åŠ é”èŒƒå›´, åˆæ˜¯ä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("çŽ°åœ¨éƒ½çŸ¥é“"),t("strong",[s._v("é—´éš™é”æ˜¯ä¸äº’é”")]),s._v("çš„, ä½†æ˜¯è¿™ä¸¤æ¡è¯­å¥éƒ½ä¼šåœ¨ç´¢å¼• c ä¸Šçš„ c=5, 10, 20 è¿™ä¸‰è¡Œè®°å½•ä¸ŠåŠ è®°å½•é”.")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹, ç”±äºŽè¯­å¥é‡Œé¢æ˜¯ order by c desc, "),t("strong",[s._v("è¿™ä¸‰ä¸ªè®°å½•é”çš„åŠ é”é¡ºåº, æ˜¯å…ˆé” c=20, ç„¶åŽ c=10, æœ€åŽæ˜¯ c=5")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("è¿™ä¸¤æ¡è¯­å¥è¦åŠ é”ç›¸åŒçš„èµ„æº, ä½†æ˜¯åŠ é”é¡ºåºç›¸å. å½“è¿™ä¸¤æ¡è¯­å¥å¹¶å‘æ‰§è¡Œçš„æ—¶å€™, å°±å¯èƒ½å‡ºçŽ°æ­»é”")]),s._v(".")]),s._v(" "),t("p",[s._v("å…³äºŽæ­»é”çš„ä¿¡æ¯, MySQL åªä¿ç•™äº†æœ€åŽä¸€ä¸ªæ­»é”çš„çŽ°åœº, ä½†è¿™ä¸ªçŽ°åœºè¿˜æ˜¯ä¸å®Œå¤‡çš„. æœ‰äººé—®åˆ°æ€Žä¹ˆçœ‹æ­»é”. çŽ°åœ¨å°±æ¥ç®€å•åˆ†æžä¸€ä¸‹ä¸Šé¢è¿™ä¸ªä¾‹å­çš„æ­»é”çŽ°åœº.")]),s._v(" "),t("h5",{attrs:{id:"æ€Žä¹ˆçœ‹æ­»é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€Žä¹ˆçœ‹æ­»é”"}},[s._v("#")]),s._v(" æ€Žä¹ˆçœ‹æ­»é”?")]),s._v(" "),t("p",[s._v("ä¸‹å›¾æ˜¯åœ¨å‡ºçŽ°æ­»é”åŽ, æ‰§è¡Œ show engine innodb status å‘½ä»¤å¾—åˆ°çš„éƒ¨åˆ†è¾“å‡º. è¿™ä¸ªå‘½ä»¤ä¼šè¾“å‡ºå¾ˆå¤šä¿¡æ¯, æœ‰ä¸€èŠ‚ LATESTDETECTED DEADLOCK, å°±æ˜¯è®°å½•çš„æœ€åŽä¸€æ¬¡æ­»é”ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("â€‹â€‹"),t("img",{attrs:{src:"/img/c1312cb7a5117b42d4858ecb42624188-20230731161914-t7ue6qw.png",alt:"",title:"æ­»é”çŽ°åœº"}}),s._v("â€‹â€‹æ¥çœ‹çœ‹è¿™å›¾ä¸­çš„å‡ ä¸ªå…³é”®ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªç»“æžœåˆ†æˆä¸‰éƒ¨åˆ†:")]),s._v(" "),t("ul",[t("li",[s._v("(1) TRANSACTION, æ˜¯"),t("strong",[s._v("ç¬¬ä¸€ä¸ªäº‹åŠ¡")]),s._v("çš„ä¿¡æ¯;")]),s._v(" "),t("li",[s._v("(2) TRANSACTION, æ˜¯"),t("strong",[s._v("ç¬¬äºŒä¸ªäº‹åŠ¡")]),s._v("çš„ä¿¡æ¯;")]),s._v(" "),t("li",[s._v("WE ROLL BACK TRANSACTION (1), æ˜¯æœ€ç»ˆçš„å¤„ç†ç»“æžœ, è¡¨ç¤º"),t("strong",[s._v("å›žæ»šäº†ç¬¬ä¸€ä¸ªäº‹åŠ¡")]),s._v(".")])]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ä¸ªäº‹åŠ¡çš„ä¿¡æ¯ä¸­:")]),s._v(" "),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v("WAITING FOR THIS LOCK TO BE GRANTED")]),s._v("â€‹, è¡¨ç¤ºçš„æ˜¯è¿™ä¸ªäº‹åŠ¡åœ¨ç­‰å¾…çš„é”ä¿¡æ¯;")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v("index c of table `test`.`t`")]),s._v("â€‹, è¯´æ˜Žåœ¨ç­‰çš„æ˜¯è¡¨ t çš„ç´¢å¼• c ä¸Šé¢çš„é”;")]),s._v(" "),t("li",[s._v("lock mode S waiting è¡¨ç¤ºè¿™ä¸ªè¯­å¥è¦è‡ªå·±åŠ ä¸€ä¸ªè¯»é”, å½“å‰çš„çŠ¶æ€æ˜¯ç­‰å¾…ä¸­;")]),s._v(" "),t("li",[s._v("Record lock è¯´æ˜Žè¿™æ˜¯ä¸€ä¸ªè®°å½•é”;")]),s._v(" "),t("li",[s._v("n_fields 2 è¡¨ç¤ºè¿™ä¸ªè®°å½•æ˜¯ä¸¤åˆ—, ä¹Ÿå°±æ˜¯å­—æ®µ c å’Œä¸»é”®å­—æ®µ id;")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v("0: len 4; hex 0000000a; asc ;;")]),s._v("â€‹ æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µ, ä¹Ÿå°±æ˜¯ c. å€¼æ˜¯åå…­è¿›åˆ¶ a, ä¹Ÿå°±æ˜¯ 10;")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v("1: len 4; hex 0000000a; asc ;;")]),s._v("â€‹ æ˜¯ç¬¬äºŒä¸ªå­—æ®µ, ä¹Ÿå°±æ˜¯ä¸»é”® id, å€¼ä¹Ÿæ˜¯ 10;")]),s._v(" "),t("li",[s._v('è¿™ä¸¤è¡Œé‡Œé¢çš„ asc è¡¨ç¤ºçš„æ˜¯, æŽ¥ä¸‹æ¥è¦æ‰“å°å‡ºå€¼é‡Œé¢çš„"å¯æ‰“å°å­—ç¬¦", ä½† 10 ä¸æ˜¯å¯æ‰“å°å­—ç¬¦, å› æ­¤å°±æ˜¾ç¤ºç©ºæ ¼.')]),s._v(" "),t("li",[s._v("ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¿¡æ¯å°±åªæ˜¾ç¤ºå‡ºäº†ç­‰é”çš„çŠ¶æ€, åœ¨ç­‰å¾… (c=10,id=10) è¿™ä¸€è¡Œçš„é”.")]),s._v(" "),t("li",[s._v("å½“ç„¶ä½ æ˜¯çŸ¥é“çš„, æ—¢ç„¶å‡ºçŽ°æ­»é”äº†, å°±è¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡ä¹Ÿå æœ‰åˆ«çš„é”, ä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥. åˆ«ç€æ€¥, æˆ‘ä»¬ä»Žç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿¡æ¯ä¸­æŽ¨å¯¼å‡ºæ¥.")])]),s._v(" "),t("p",[s._v("ç¬¬äºŒä¸ªäº‹åŠ¡æ˜¾ç¤ºçš„ä¿¡æ¯è¦å¤šä¸€äº›:")]),s._v(" "),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v('" HOLDS THE LOCK(S)"')]),s._v("â€‹ ç”¨æ¥æ˜¾ç¤ºè¿™ä¸ªäº‹åŠ¡æŒæœ‰å“ªäº›é”;")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v("index c of table `test`.`t`")]),s._v("â€‹ è¡¨ç¤ºé”æ˜¯åœ¨è¡¨ t çš„ç´¢å¼• c ä¸Š;")]),s._v(" "),t("li",[s._v("hex 0000000a å’Œ hex 00000014 è¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡æŒæœ‰ c=10 å’Œ c=20 è¿™ä¸¤ä¸ªè®°å½•é”;")]),s._v(" "),t("li",[s._v("WAITING FOR THIS LOCK TO BE GRANTED, è¡¨ç¤ºåœ¨ç­‰ (c=5,id=5) è¿™ä¸ªè®°å½•é”.")])]),s._v(" "),t("p",[s._v("ä»Žä¸Šé¢è¿™äº›ä¿¡æ¯ä¸­å¯ä»¥çŸ¥é“:")]),s._v(" "),t("ol",[t("li",[s._v('"lock in share mode" çš„è¿™æ¡è¯­å¥, æŒæœ‰ c=5 çš„è®°å½•é”, åœ¨ç­‰ c=10 çš„é”;')]),s._v(" "),t("li",[s._v('"for update" è¿™ä¸ªè¯­å¥, æŒæœ‰ c=20 å’Œ c=10 çš„è®°å½•é”, åœ¨ç­‰ c=5 çš„è®°å½•é”.')])]),s._v(" "),t("p",[s._v("å› æ­¤å¯¼è‡´äº†æ­»é”. è¿™é‡Œå¯ä»¥å¾—åˆ°ä¸¤ä¸ªç»“è®º:")]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v("ç”±äºŽé”æ˜¯ä¸€ä¸ªä¸ªåŠ çš„, è¦é¿å…æ­»é”, å¯¹åŒä¸€ç»„èµ„æº, è¦æŒ‰ç…§å°½é‡ç›¸åŒçš„é¡ºåºè®¿é—®;")])])]),s._v(" "),t("li",[t("strong",[s._v("åœ¨å‘ç”Ÿæ­»é”çš„æ—¶åˆ», for update è¿™æ¡è¯­å¥å æœ‰çš„èµ„æºæ›´å¤š, å›žæ»šæˆæœ¬æ›´å¤§, æ‰€ä»¥ InnoDB é€‰æ‹©äº†å›žæ»šæˆæœ¬æ›´å°çš„ lock in share mode è¯­å¥æ¥å›žæ»š.")])])]),s._v(" "),t("h5",{attrs:{id:"æ€Žä¹ˆçœ‹é”ç­‰å¾…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€Žä¹ˆçœ‹é”ç­‰å¾…"}},[s._v("#")]),s._v(" æ€Žä¹ˆçœ‹é”ç­‰å¾…?")]),s._v(" "),t("p",[s._v("çœ‹å®Œæ­»é”, å†æ¥çœ‹ä¸€ä¸ª"),t("strong",[s._v("é”ç­‰å¾…")]),s._v("çš„ä¾‹å­. æœ‰äººåšäº†ä¸€ä¸ªæœ‰è¶£éªŒè¯, æˆ‘æŠŠå¤çŽ°æ­¥éª¤åˆ—å‡ºæ¥:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/75d29613580da0940508404f36bbc62f-20230731161914-96f4xrq.png",alt:"",title:"deleteå¯¼è‡´é—´éš™å˜åŒ–"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ç”±äºŽ session A å¹¶æ²¡æœ‰é”ä½ c=10 è¿™ä¸ªè®°å½•, æ‰€ä»¥ session B åˆ é™¤ id=10 è¿™ä¸€è¡Œæ˜¯å¯ä»¥çš„. ä½†æ˜¯ä¹‹åŽ, session B å†æƒ³ insert id=10 è¿™ä¸€è¡Œå›žåŽ»å°±ä¸è¡Œäº†.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä¸€èµ·çœ‹ä¸€ä¸‹æ­¤æ—¶ show engine innodb status çš„ç»“æžœ, çœ‹çœ‹èƒ½ä¸èƒ½æœ‰ä¸€äº›æç¤º. é”ä¿¡æ¯æ˜¯åœ¨è¿™ä¸ªå‘½ä»¤è¾“å‡ºç»“æžœçš„ TRANSACTIONS è¿™ä¸€èŠ‚.")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/63d77830b0aa615e26cca69f0f38345e-20230731161914-jwdiu40.png",alt:"",title:"é”ç­‰å¾…ä¿¡æ¯"}}),s._v("â€‹æ¥çœ‹å‡ ä¸ªå…³é”®ä¿¡æ¯.")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("â€‹"),t("code",[s._v("index PRIMARY of table `test`.`t`")]),s._v("â€‹, è¡¨ç¤ºè¿™ä¸ªè¯­å¥è¢«é”ä½æ˜¯å› ä¸ºè¡¨ t ä¸»é”®ä¸Šçš„æŸä¸ªé”.")])]),s._v(" "),t("li",[t("p",[s._v("lock_mode X locks gap before rec insert intention waiting è¿™é‡Œæœ‰å‡ ä¸ªä¿¡æ¯: (1) insert intention è¡¨ç¤ºå½“å‰çº¿ç¨‹å‡†å¤‡æ’å…¥ä¸€ä¸ªè®°å½•, è¿™æ˜¯ä¸€ä¸ªæ’å…¥æ„å‘é”. ä¸ºäº†ä¾¿äºŽç†è§£, ä½ å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯è¿™ä¸ªæ’å…¥åŠ¨ä½œæœ¬èº«. (2) gap before rec è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé—´éš™é”, è€Œä¸æ˜¯è®°å½•é”.")])]),s._v(" "),t("li",[t("p",[s._v("é‚£ä¹ˆè¿™ä¸ª gap æ˜¯åœ¨å“ªä¸ªè®°å½•ä¹‹å‰çš„å‘¢? æŽ¥ä¸‹æ¥çš„ 0~4 è¿™ 5 è¡Œçš„å†…å®¹å°±æ˜¯è¿™ä¸ªè®°å½•çš„ä¿¡æ¯.")])]),s._v(" "),t("li",[t("p",[s._v("n_fields 5 ä¹Ÿè¡¨ç¤ºäº†, è¿™ä¸€ä¸ªè®°å½•æœ‰ 5 åˆ—:")]),s._v(" "),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v("0: len 4; hex 0000000f; asc ;;")]),s._v("â€‹ ç¬¬ä¸€åˆ—æ˜¯ä¸»é”® id å­—æ®µ, åå…­è¿›åˆ¶ f å°±æ˜¯ id=15. æ‰€ä»¥, è¿™æ—¶æˆ‘ä»¬å°±çŸ¥é“äº†, è¿™ä¸ªé—´éš™å°±æ˜¯ id=15 ä¹‹å‰çš„, å› ä¸º id=10 å·²ç»ä¸å­˜åœ¨äº†, å®ƒè¡¨ç¤ºçš„å°±æ˜¯ (5,15).")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v("1: len 6; hex 000000000513; asc ;;")]),s._v("â€‹ ç¬¬äºŒåˆ—æ˜¯é•¿åº¦ä¸º 6 å­—èŠ‚çš„äº‹åŠ¡ id, è¡¨ç¤ºæœ€åŽä¿®æ”¹è¿™ä¸€è¡Œçš„æ˜¯ trx id ä¸º 1299 çš„äº‹åŠ¡.")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v("2: len 7; hex b0000001250134; asc % 4;;")]),s._v("â€‹ ç¬¬ä¸‰åˆ—é•¿åº¦ä¸º 7 å­—èŠ‚çš„å›žæ»šæ®µä¿¡æ¯. å¯ä»¥çœ‹åˆ°, è¿™é‡Œçš„ acs åŽé¢æœ‰æ˜¾ç¤ºå†…å®¹ (% å’Œ 4), è¿™æ˜¯å› ä¸ºåˆšå¥½è¿™ä¸ªå­—èŠ‚æ˜¯å¯æ‰“å°å­—ç¬¦.")]),s._v(" "),t("li",[s._v("åŽé¢ä¸¤åˆ—æ˜¯ c å’Œ d çš„å€¼, éƒ½æ˜¯ 15.")])])])]),s._v(" "),t("p",[s._v("å› æ­¤, æˆ‘ä»¬å°±çŸ¥é“äº†, ç”±äºŽ delete æ“ä½œæŠŠ id=10 è¿™ä¸€è¡Œåˆ æŽ‰äº†, "),t("strong",[s._v("åŽŸæ¥çš„ä¸¤ä¸ªé—´éš™ (5,10), (10,15)å˜æˆäº†ä¸€ä¸ª (5,15)")]),s._v(" .")]),s._v(" "),t("p",[s._v("è¯´åˆ°è¿™é‡Œ, å¯ä»¥è”åˆèµ·æ¥å†æ€è€ƒä¸€ä¸‹è¿™ä¸¤ä¸ªçŽ°è±¡ä¹‹é—´çš„å…³è”:")]),s._v(" "),t("ol",[t("li",[s._v('session A æ‰§è¡Œå®Œ select è¯­å¥åŽ, ä»€ä¹ˆéƒ½æ²¡åš, ä½†å®ƒåŠ é”çš„èŒƒå›´çªç„¶"å˜å¤§"äº†;')]),s._v(" "),t("li",[s._v("å½“æ‰§è¡Œ select * from t where c>=15 and c<=20 order by c desc lock in share mode; å‘å·¦æ‰«æåˆ° c=10 çš„æ—¶å€™, è¦æŠŠ (5,10] é”èµ·æ¥.")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v('æ‰€è°“"é—´éš™", å…¶å®žæ ¹æœ¬å°±æ˜¯ç”±"è¿™ä¸ªé—´éš™å³è¾¹çš„é‚£ä¸ªè®°å½•"å®šä¹‰çš„')]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"updateçš„ä¾‹å­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#updateçš„ä¾‹å­"}},[s._v("#")]),s._v(" updateçš„ä¾‹å­")]),s._v(" "),t("p",[s._v("çœ‹è¿‡äº† insert å’Œ delete çš„åŠ é”ä¾‹å­, å†æ¥çœ‹ä¸€ä¸ª update è¯­å¥çš„æ¡ˆä¾‹. å®žéªŒå¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/02705d2fb0056e614957ff56ac238f62-20230731161914-646l9um.png",alt:""}})]),s._v(" "),t("p",[s._v("åˆ†æžä¸€ä¸‹å¯çŸ¥ session A çš„åŠ é”èŒƒå›´æ˜¯ç´¢å¼• c ä¸Šçš„ (5,10], (10,15], (15,20], (20,25] å’Œ (25,supremum].")]),s._v(" "),t("p",[s._v("æ³¨æ„: æ ¹æ® c>5 æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªè®°å½•æ˜¯ c=10, å› æ­¤ä¸ä¼šåŠ  (0,5] è¿™ä¸ª next-key lock.")]),s._v(" "),t("p",[s._v("ä¹‹åŽ session B çš„ç¬¬ä¸€ä¸ª update è¯­å¥, è¦æŠŠ c=5 æ”¹æˆ c=1, å¯ä»¥ç†è§£ä¸ºä¸¤æ­¥:")]),s._v(" "),t("ol",[t("li",[s._v("æ’å…¥ (c=1, id=5) è¿™ä¸ªè®°å½•;")]),s._v(" "),t("li",[s._v("åˆ é™¤ (c=5, id=5) è¿™ä¸ªè®°å½•.")])]),s._v(" "),t("p",[s._v("æŒ‰ç…§ä¸Šä¸€èŠ‚è¯´çš„, ç´¢å¼• c ä¸Š (5,10) é—´éš™æ˜¯ç”±è¿™ä¸ªé—´éš™å³è¾¹çš„è®°å½•, ä¹Ÿå°±æ˜¯ c=10 å®šä¹‰çš„. æ‰€ä»¥é€šè¿‡è¿™ä¸ªæ“ä½œ, session A çš„åŠ é”èŒƒå›´å˜æˆäº†ä¸‹å›¾æ‰€ç¤ºçš„æ ·å­:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/359259178b20096d835d1d35cf7bfd72-20230731161914-h3hhu0x.png",alt:""}})]),s._v(" "),t("p",[s._v("å¥½, æŽ¥ä¸‹æ¥ session B è¦æ‰§è¡Œ "),t("code",[s._v("update t set c = 5 where c = 1")]),s._v("â€‹ è¿™ä¸ªè¯­å¥äº†, ä¸€æ ·åœ°å¯ä»¥æ‹†æˆä¸¤æ­¥:")]),s._v(" "),t("ol",[t("li",[s._v("æ’å…¥ (c=5, id=5) è¿™ä¸ªè®°å½•;")]),s._v(" "),t("li",[s._v("åˆ é™¤ (c=1, id=5) è¿™ä¸ªè®°å½•.")])]),s._v(" "),t("p",[s._v("ç¬¬ä¸€æ­¥è¯•å›¾åœ¨å·²ç»åŠ äº†é—´éš™é”çš„ (1,10) ä¸­æ’å…¥æ•°æ®, æ‰€ä»¥å°±è¢«å µä½äº†.")]),s._v(" "),t("h4",{attrs:{id:"_31-è¯¯åˆ æ•°æ®åŽé™¤äº†è·‘è·¯-è¿˜èƒ½æ€Žä¹ˆåŠž"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_31-è¯¯åˆ æ•°æ®åŽé™¤äº†è·‘è·¯-è¿˜èƒ½æ€Žä¹ˆåŠž"}},[s._v("#")]),s._v(" 31-è¯¯åˆ æ•°æ®åŽé™¤äº†è·‘è·¯,è¿˜èƒ½æ€Žä¹ˆåŠž?")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚è®¨è®ºçš„æ˜¯ä¸€ä¸ªæ²‰é‡çš„è¯é¢˜: "),t("strong",[s._v("è¯¯åˆ æ•°æ®")]),s._v(". è™½ç„¶å¤§å¤šæ•°çš„æ•°æ®è¢«åˆ , éƒ½æ˜¯è¿ç»´åŒå­¦æˆ–è€… DBA èƒŒé”…çš„. ä½†å®žé™…ä¸Š, åªè¦æœ‰æ•°æ®æ“ä½œæƒé™çš„åŒå­¦, éƒ½æœ‰å¯èƒ½è¸©åˆ°è¯¯åˆ æ•°æ®è¿™æ¡çº¿.")]),s._v(" "),t("p",[s._v("åœ¨å‰é¢å‡ èŠ‚ä»‹ç»äº† MySQL çš„é«˜å¯ç”¨æž¶æž„. å½“ç„¶, ä¼ ç»Ÿçš„é«˜å¯ç”¨æž¶æž„æ˜¯ä¸èƒ½é¢„é˜²è¯¯åˆ æ•°æ®çš„, å› ä¸ºä¸»åº“çš„ä¸€ä¸ª drop table å‘½ä»¤, ä¼šé€šè¿‡ binlog ä¼ ç»™æ‰€æœ‰ä»Žåº“å’Œçº§è”ä»Žåº“, è¿›è€Œå¯¼è‡´æ•´ä¸ªé›†ç¾¤çš„å®žä¾‹éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å°±èŠèŠè¯¯åˆ æ•°æ®å‰åŽ, æˆ‘ä»¬å¯ä»¥åšäº›ä»€ä¹ˆ, å‡å°‘è¯¯åˆ æ•°æ®çš„é£Žé™©, å’Œç”±è¯¯åˆ æ•°æ®å¸¦æ¥çš„æŸå¤±.")]),s._v(" "),t("p",[s._v("ä¸ºäº†æ‰¾åˆ°è§£å†³è¯¯åˆ æ•°æ®çš„æ›´é«˜æ•ˆçš„æ–¹æ³•, éœ€è¦å…ˆå¯¹å’Œ MySQL ç›¸å…³çš„è¯¯åˆ æ•°æ®, åšä¸‹åˆ†ç±»:")]),s._v(" "),t("ol",[t("li",[s._v("ä½¿ç”¨ delete è¯­å¥"),t("strong",[s._v("è¯¯åˆ æ•°æ®è¡Œ")]),s._v(";")]),s._v(" "),t("li",[s._v("ä½¿ç”¨ drop table æˆ–è€… truncate table è¯­å¥"),t("strong",[s._v("è¯¯åˆ æ•°æ®è¡¨")]),s._v(";")]),s._v(" "),t("li",[s._v("ä½¿ç”¨ drop database è¯­å¥"),t("strong",[s._v("è¯¯åˆ æ•°æ®åº“")]),s._v(";")]),s._v(" "),t("li",[s._v("ä½¿ç”¨ rm å‘½ä»¤"),t("strong",[s._v("è¯¯åˆ æ•´ä¸ª MySQL å®žä¾‹")]),s._v(".")])]),s._v(" "),t("h5",{attrs:{id:"è¯¯åˆ è¡Œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¯¯åˆ è¡Œ"}},[s._v("#")]),s._v(" è¯¯åˆ è¡Œ")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°å¦‚æžœæ˜¯ä½¿ç”¨ delete è¯­å¥è¯¯åˆ äº†æ•°æ®è¡Œ, "),t("strong",[s._v("å¯ä»¥ç”¨ Flashback å·¥å…·é€šè¿‡é—ªå›žæŠŠæ•°æ®æ¢å¤å›žæ¥")]),s._v(". Flashback æ¢å¤æ•°æ®çš„åŽŸç†, "),t("strong",[s._v("æ˜¯ä¿®æ”¹ binlog çš„å†…å®¹, æ‹¿å›žåŽŸåº“é‡æ”¾")]),s._v(". è€Œèƒ½å¤Ÿä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆçš„å‰ææ˜¯, éœ€è¦ç¡®ä¿ "),t("strong",[s._v("binlog_format=row å’Œ binlog_row_image=FULL")]),s._v(".")]),s._v(" "),t("p",[s._v("å…·ä½“æ¢å¤æ•°æ®æ—¶, å¯¹å•ä¸ªäº‹åŠ¡åšå¦‚ä¸‹å¤„ç†:")]),s._v(" "),t("ol",[t("li",[s._v("å¯¹äºŽ insert è¯­å¥, å¯¹åº”çš„ binlog event ç±»åž‹æ˜¯ Write_rows event, æŠŠå®ƒæ”¹æˆ Delete_rows event å³å¯;")]),s._v(" "),t("li",[s._v("åŒç†, å¯¹äºŽ delete è¯­å¥, ä¹Ÿæ˜¯å°† Delete_rows event æ”¹ä¸º Write_rows event;")]),s._v(" "),t("li",[s._v("è€Œå¦‚æžœæ˜¯ Update_rows çš„è¯, binlog é‡Œé¢è®°å½•äº†æ•°æ®è¡Œä¿®æ”¹å‰å’Œä¿®æ”¹åŽçš„å€¼, å¯¹è°ƒè¿™ä¸¤è¡Œçš„ä½ç½®å³å¯.")])]),s._v(" "),t("p",[s._v("å¦‚æžœè¯¯æ“ä½œä¸æ˜¯ä¸€ä¸ª, è€Œæ˜¯å¤šä¸ª, ä¼šæ€Žä¹ˆæ ·å‘¢? æ¯”å¦‚ä¸‹é¢ä¸‰ä¸ªäº‹åŠ¡:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("C"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("çŽ°åœ¨è¦æŠŠæ•°æ®åº“æ¢å¤å›žè¿™ä¸‰ä¸ªäº‹åŠ¡æ“ä½œä¹‹å‰çš„çŠ¶æ€, ç”¨ Flashback å·¥å…·è§£æž binlog åŽ, å†™å›žä¸»åº“çš„å‘½ä»¤æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reverse C"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reverse B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reverse A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, å¦‚æžœè¯¯åˆ æ•°æ®æ¶‰åŠåˆ°äº†å¤šä¸ªäº‹åŠ¡çš„è¯, éœ€è¦"),t("strong",[s._v("å°†äº‹åŠ¡çš„é¡ºåºè°ƒè¿‡æ¥å†æ‰§è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("**éœ€è¦è¯´æ˜Žçš„æ˜¯, ä¸å»ºè®®ç›´æŽ¥åœ¨ä¸»åº“ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œ. ** æ¢å¤æ•°æ®æ¯”è¾ƒå®‰å…¨çš„åšæ³•, æ˜¯æ¢å¤å‡ºä¸€ä¸ªå¤‡ä»½, æˆ–è€…æ‰¾ä¸€ä¸ªä»Žåº“ä½œä¸ºä¸´æ—¶åº“, åœ¨è¿™ä¸ªä¸´æ—¶åº“ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œ, ç„¶åŽå†å°†ç¡®è®¤è¿‡çš„ä¸´æ—¶åº“çš„æ•°æ®, æ¢å¤å›žä¸»åº“.")]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢?")]),s._v(" "),t("p",[s._v("è¿™æ˜¯å› ä¸º, ä¸€ä¸ªåœ¨æ‰§è¡Œçº¿ä¸Šé€»è¾‘çš„ä¸»åº“, æ•°æ®çŠ¶æ€çš„å˜æ›´å¾€å¾€æ˜¯æœ‰å…³è”çš„. å¯èƒ½ç”±äºŽå‘çŽ°æ•°æ®é—®é¢˜çš„æ—¶é—´æ™šäº†ä¸€ç‚¹å„¿, å°±å¯¼è‡´å·²ç»åœ¨ä¹‹å‰è¯¯æ“ä½œçš„åŸºç¡€ä¸Š, ä¸šåŠ¡ä»£ç é€»è¾‘åˆç»§ç»­ä¿®æ”¹äº†å…¶ä»–æ•°æ®. æ‰€ä»¥å¦‚æžœè¿™æ—¶å€™å•ç‹¬æ¢å¤è¿™å‡ è¡Œæ•°æ®, è€Œåˆæœªç»ç¡®è®¤çš„è¯, å°±å¯èƒ½ä¼šå‡ºçŽ°å¯¹æ•°æ®çš„äºŒæ¬¡ç ´å.")]),s._v(" "),t("p",[s._v("å½“ç„¶, "),t("strong",[s._v("ä¸æ­¢è¦è¯´è¯¯åˆ æ•°æ®çš„äº‹åŽå¤„ç†åŠžæ³•, æ›´é‡è¦æ˜¯è¦åšåˆ°äº‹å‰é¢„é˜²")]),s._v(". æœ‰ä»¥ä¸‹ä¸¤ä¸ªå»ºè®®:")]),s._v(" "),t("ol",[t("li",[s._v("æŠŠ sql_safe_updates å‚æ•°è®¾ç½®ä¸º on. è¿™æ ·ä¸€æ¥, å¦‚æžœå¿˜è®°åœ¨ delete æˆ–è€… update è¯­å¥ä¸­å†™ where æ¡ä»¶, æˆ–è€… where æ¡ä»¶é‡Œé¢æ²¡æœ‰åŒ…å«ç´¢å¼•å­—æ®µçš„è¯, è¿™æ¡è¯­å¥çš„æ‰§è¡Œå°±ä¼šæŠ¥é”™.")]),s._v(" "),t("li",[s._v("ä»£ç ä¸Šçº¿å‰, å¿…é¡»ç»è¿‡ SQL å®¡è®¡.")])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè¯´, è®¾ç½®äº† sql_safe_updates=on, å¦‚æžœçœŸçš„è¦æŠŠä¸€ä¸ªå°è¡¨çš„æ•°æ®å…¨éƒ¨åˆ æŽ‰, åº”è¯¥æ€Žä¹ˆåŠžå‘¢? å¦‚æžœç¡®å®šè¿™ä¸ªåˆ é™¤æ“ä½œæ²¡é—®é¢˜çš„è¯, å¯ä»¥åœ¨ delete è¯­å¥ä¸­åŠ ä¸Š where æ¡ä»¶, æ¯”å¦‚ where id>=0. ä½†æ˜¯, delete å…¨è¡¨æ˜¯å¾ˆæ…¢çš„, éœ€è¦ç”Ÿæˆå›žæ»šæ—¥å¿—, å†™ redo, å†™ binlog. æ‰€ä»¥ä»Žæ€§èƒ½è§’åº¦è€ƒè™‘, åº”è¯¥"),t("strong",[s._v("ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ truncate table æˆ–è€… drop table å‘½ä»¤")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½¿ç”¨ delete å‘½ä»¤åˆ é™¤çš„æ•°æ®, è¿˜å¯ä»¥ç”¨ Flashback æ¥æ¢å¤. è€Œä½¿ç”¨ truncate /drop table å’Œ drop database å‘½ä»¤åˆ é™¤çš„æ•°æ®, å°±æ²¡åŠžæ³•é€šè¿‡ Flashback æ¥æ¢å¤äº†. ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("è¿™æ˜¯å› ä¸º, å³ä½¿é…ç½®äº† binlog_format=row, æ‰§è¡Œè¿™ä¸‰ä¸ªå‘½ä»¤æ—¶, è®°å½•çš„ binlog è¿˜æ˜¯ statement æ ¼å¼. binlog é‡Œé¢å°±åªæœ‰ä¸€ä¸ª truncate/drop è¯­å¥, è¿™äº›ä¿¡æ¯æ˜¯æ¢å¤ä¸å‡ºæ•°æ®çš„.")]),s._v(" "),t("p",[s._v("é‚£å¦‚æžœçœŸçš„æ˜¯ä½¿ç”¨è¿™å‡ æ¡å‘½ä»¤è¯¯åˆ æ•°æ®äº†, åˆè¯¥æ€Žä¹ˆåŠžå‘¢?")]),s._v(" "),t("h5",{attrs:{id:"è¯¯åˆ åº“-è¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¯¯åˆ åº“-è¡¨"}},[s._v("#")]),s._v(" è¯¯åˆ åº“/è¡¨")]),s._v(" "),t("p",[s._v("è¿™ç§æƒ…å†µä¸‹, è¦æƒ³æ¢å¤æ•°æ®, "),t("strong",[s._v("å°±éœ€è¦ä½¿ç”¨å…¨é‡å¤‡ä»½, åŠ å¢žé‡æ—¥å¿—çš„æ–¹å¼")]),s._v("äº†. è¿™ä¸ªæ–¹æ¡ˆ"),t("strong",[s._v("è¦æ±‚çº¿ä¸Šæœ‰å®šæœŸçš„å…¨é‡å¤‡ä»½, å¹¶ä¸”å®žæ—¶å¤‡ä»½ binlog")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸¤ä¸ªæ¡ä»¶éƒ½å…·å¤‡çš„æƒ…å†µä¸‹, å‡å¦‚æœ‰äººä¸­åˆ 12 ç‚¹è¯¯åˆ äº†ä¸€ä¸ªåº“, æ¢å¤æ•°æ®çš„æµç¨‹å¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("å–æœ€è¿‘ä¸€æ¬¡å…¨é‡å¤‡ä»½, å‡è®¾è¿™ä¸ªåº“æ˜¯ä¸€å¤©ä¸€å¤‡, ä¸Šæ¬¡å¤‡ä»½æ˜¯å½“å¤© 0 ç‚¹;")]),s._v(" "),t("li",[s._v("ç”¨å¤‡ä»½æ¢å¤å‡ºä¸€ä¸ª"),t("strong",[s._v("ä¸´æ—¶åº“")]),s._v(";")]),s._v(" "),t("li",[s._v("ä»Žæ—¥å¿—å¤‡ä»½é‡Œé¢, "),t("strong",[s._v("å–å‡ºå‡Œæ™¨ 0 ç‚¹ä¹‹åŽçš„æ—¥å¿—")]),s._v(";")]),s._v(" "),t("li",[s._v("æŠŠè¿™äº›æ—¥å¿—, é™¤äº†è¯¯åˆ é™¤æ•°æ®çš„è¯­å¥å¤–, å…¨éƒ¨åº”ç”¨åˆ°ä¸´æ—¶åº“.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/fc771c57d17b49dd272a87eda6e2f87a-20230731161914-8638kty.png",alt:"",title:"æ•°æ®æ¢å¤æµç¨‹-mysqlbinlogæ–¹æ³•"}})]),s._v(" "),t("p",[s._v("å…³äºŽè¿™ä¸ªè¿‡ç¨‹, éœ€è¦å’Œè¯´æ˜Žå¦‚ä¸‹å‡ ç‚¹:")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("ä¸ºäº†åŠ é€Ÿæ•°æ®æ¢å¤, å¦‚æžœè¿™ä¸ªä¸´æ—¶åº“ä¸Šæœ‰å¤šä¸ªæ•°æ®åº“, å¯ä»¥åœ¨ä½¿ç”¨ mysqlbinlog å‘½ä»¤æ—¶, åŠ ä¸Šä¸€ä¸ª â€“database å‚æ•°, ç”¨æ¥æŒ‡å®šè¯¯åˆ è¡¨æ‰€åœ¨çš„åº“. è¿™æ ·å°±é¿å…äº†åœ¨æ¢å¤æ•°æ®æ—¶è¿˜è¦åº”ç”¨å…¶ä»–åº“æ—¥å¿—çš„æƒ…å†µ.")])]),s._v(" "),t("li",[t("p",[s._v("åœ¨åº”ç”¨æ—¥å¿—çš„æ—¶å€™, éœ€è¦è·³è¿‡ 12 ç‚¹è¯¯æ“ä½œçš„é‚£ä¸ªè¯­å¥çš„ binlog:")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æžœåŽŸå®žä¾‹æ²¡æœ‰ä½¿ç”¨ GTID æ¨¡å¼, åªèƒ½åœ¨åº”ç”¨åˆ°åŒ…å« 12 ç‚¹çš„ binlog æ–‡ä»¶çš„æ—¶å€™, å…ˆç”¨ â€“stop-position å‚æ•°æ‰§è¡Œåˆ°è¯¯æ“ä½œä¹‹å‰çš„æ—¥å¿—, ç„¶åŽå†ç”¨ â€“start-position ä»Žè¯¯æ“ä½œä¹‹åŽçš„æ—¥å¿—ç»§ç»­æ‰§è¡Œ;")]),s._v(" "),t("li",[s._v("å¦‚æžœå®žä¾‹ä½¿ç”¨äº† GTID æ¨¡å¼, å°±æ–¹ä¾¿å¤šäº†. å‡è®¾è¯¯æ“ä½œå‘½ä»¤çš„ GTID æ˜¯ gtid1, é‚£ä¹ˆåªéœ€è¦æ‰§è¡Œ "),t("code",[s._v("set gtid_next=gtid1;begin;commit;")]),s._v("â€‹ å…ˆæŠŠè¿™ä¸ª GTID åŠ åˆ°ä¸´æ—¶å®žä¾‹çš„ GTID é›†åˆ, ä¹‹åŽæŒ‰é¡ºåºæ‰§è¡Œ binlog çš„æ—¶å€™, å°±ä¼šè‡ªåŠ¨è·³è¿‡è¯¯æ“ä½œçš„è¯­å¥.")])])])]),s._v(" "),t("p",[s._v("ä¸è¿‡å³ä½¿è¿™æ ·, ä½¿ç”¨ mysqlbinlog æ–¹æ³•æ¢å¤æ•°æ®è¿˜æ˜¯ä¸å¤Ÿå¿«, ä¸»è¦åŽŸå› æœ‰ä¸¤ä¸ª:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœæ˜¯è¯¯åˆ è¡¨, æœ€å¥½å°±æ˜¯åªæ¢å¤å‡ºè¿™å¼ è¡¨, ä¹Ÿå°±æ˜¯åªé‡æ”¾è¿™å¼ è¡¨çš„æ“ä½œ, ä½†æ˜¯ mysqlbinlog å·¥å…·å¹¶ä¸èƒ½æŒ‡å®šåªè§£æžä¸€ä¸ªè¡¨çš„æ—¥å¿—;")]),s._v(" "),t("li",[s._v("ç”¨ mysqlbinlog è§£æžå‡ºæ—¥å¿—åº”ç”¨, åº”ç”¨æ—¥å¿—çš„è¿‡ç¨‹å°±åªèƒ½æ˜¯å•çº¿ç¨‹. å‰é¢ä»‹ç»çš„é‚£äº›å¹¶è¡Œå¤åˆ¶çš„æ–¹æ³•, åœ¨è¿™é‡Œéƒ½ç”¨ä¸ä¸Š.")])]),s._v(" "),t("p",[s._v("**ä¸€ç§åŠ é€Ÿçš„æ–¹æ³•æ˜¯, **åœ¨ç”¨å¤‡ä»½æ¢å¤å‡ºä¸´æ—¶å®žä¾‹ä¹‹åŽ, å°†è¿™ä¸ªä¸´æ—¶å®žä¾‹è®¾ç½®æˆçº¿ä¸Šå¤‡åº“çš„ä»Žåº“, è¿™æ ·:")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨ start slave ä¹‹å‰, å…ˆé€šè¿‡æ‰§è¡Œ\ufeff "),t("code",[s._v("change replication filter replicate_do_table = (tbl_name)")]),s._v("â€‹ å‘½ä»¤, å°±å¯ä»¥è®©ä¸´æ—¶åº“åªåŒæ­¥è¯¯æ“ä½œçš„è¡¨;")]),s._v(" "),t("li",[s._v("è¿™æ ·åšä¹Ÿå¯ä»¥ç”¨ä¸Šå¹¶è¡Œå¤åˆ¶æŠ€æœ¯, æ¥åŠ é€Ÿæ•´ä¸ªæ•°æ®æ¢å¤è¿‡ç¨‹.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e0a90a101fb59ef241d7eb3190f2e7d2-20230731161914-2norirn.png",alt:"",title:"æ•°æ®æ¢å¤æµç¨‹-master-slaveæ–¹æ³•"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, å›¾ä¸­ binlog å¤‡ä»½ç³»ç»Ÿåˆ°çº¿ä¸Šå¤‡åº“æœ‰ä¸€æ¡è™šçº¿, æ˜¯æŒ‡å¦‚æžœç”±äºŽæ—¶é—´å¤ªä¹…, å¤‡åº“ä¸Šå·²ç»åˆ é™¤äº†ä¸´æ—¶å®žä¾‹éœ€è¦çš„ binlog çš„è¯, å¯ä»¥ä»Ž binlog å¤‡ä»½ç³»ç»Ÿä¸­æ‰¾åˆ°éœ€è¦çš„ binlog, å†æ”¾å›žå¤‡åº“ä¸­.")]),s._v(" "),t("p",[s._v("å‡è®¾å‘çŽ°å½“å‰ä¸´æ—¶å®žä¾‹éœ€è¦çš„ binlog æ˜¯ä»Ž master.000005 å¼€å§‹çš„, ä½†æ˜¯åœ¨å¤‡åº“ä¸Šæ‰§è¡Œ show binlogs æ˜¾ç¤ºçš„æœ€å°çš„ binlog æ–‡ä»¶æ˜¯ master.000007, æ„å‘³ç€å°‘äº†ä¸¤ä¸ª binlog æ–‡ä»¶. è¿™æ—¶å°±éœ€è¦åŽ» binlog å¤‡ä»½ç³»ç»Ÿä¸­æ‰¾åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶.")]),s._v(" "),t("p",[s._v("æŠŠä¹‹å‰åˆ æŽ‰çš„ binlog æ”¾å›žå¤‡åº“çš„æ“ä½œæ­¥éª¤, æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Žå¤‡ä»½ç³»ç»Ÿä¸‹è½½ master.000005 å’Œ master.000006 è¿™ä¸¤ä¸ªæ–‡ä»¶, æ”¾åˆ°å¤‡åº“çš„æ—¥å¿—ç›®å½•ä¸‹;")]),s._v(" "),t("li",[s._v('æ‰“å¼€æ—¥å¿—ç›®å½•ä¸‹çš„ master.index æ–‡ä»¶, åœ¨æ–‡ä»¶å¼€å¤´åŠ å…¥ä¸¤è¡Œ, å†…å®¹åˆ†åˆ«æ˜¯ "./master.000005" å’Œ "./master.000006";')]),s._v(" "),t("li",[t("strong",[s._v("é‡å¯å¤‡åº“, ç›®çš„æ˜¯è¦è®©å¤‡åº“é‡æ–°è¯†åˆ«è¿™ä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶")]),s._v(";")]),s._v(" "),t("li",[s._v("çŽ°åœ¨è¿™ä¸ªå¤‡åº“ä¸Šå°±æœ‰äº†ä¸´æ—¶åº“éœ€è¦çš„æ‰€æœ‰ binlog äº†, å»ºç«‹ä¸»å¤‡å…³ç³», å°±å¯ä»¥æ­£å¸¸åŒæ­¥äº†.")])]),s._v(" "),t("p",[s._v("ä¸è®ºæ˜¯æŠŠ mysqlbinlog å·¥å…·è§£æžå‡ºçš„ binlog æ–‡ä»¶åº”ç”¨åˆ°ä¸´æ—¶åº“, è¿˜æ˜¯æŠŠä¸´æ—¶åº“æŽ¥åˆ°å¤‡åº“ä¸Š, è¿™ä¸¤ä¸ªæ–¹æ¡ˆçš„å…±åŒç‚¹æ˜¯: "),t("mark",[t("strong",[s._v("è¯¯åˆ åº“æˆ–è€…è¡¨åŽ, æ¢å¤æ•°æ®çš„æ€è·¯ä¸»è¦å°±æ˜¯é€šè¿‡å¤‡ä»½, å†åŠ ä¸Šåº”ç”¨ binlog çš„æ–¹å¼")])]),s._v(". ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸¤ä¸ªæ–¹æ¡ˆéƒ½è¦æ±‚å¤‡ä»½ç³»ç»Ÿå®šæœŸå¤‡ä»½å…¨é‡æ—¥å¿—, è€Œä¸”éœ€è¦ç¡®ä¿ binlog åœ¨è¢«ä»Žæœ¬åœ°åˆ é™¤ä¹‹å‰å·²ç»åšäº†å¤‡ä»½.")]),s._v(" "),t("p",[s._v("ä½†ä¸€ä¸ªç³»ç»Ÿä¸å¯èƒ½å¤‡ä»½æ— é™çš„æ—¥å¿—, è¿˜éœ€è¦æ ¹æ®æˆæœ¬å’Œç£ç›˜ç©ºé—´èµ„æº, è®¾å®šä¸€ä¸ªæ—¥å¿—ä¿ç•™çš„å¤©æ•°. å¦‚æžœä½ çš„ DBA å›¢é˜Ÿå‘Šè¯‰ä½ , å¯ä»¥ä¿è¯æŠŠæŸä¸ªå®žä¾‹æ¢å¤åˆ°åŠä¸ªæœˆå†…çš„ä»»æ„æ—¶é—´ç‚¹, è¿™å°±è¡¨ç¤ºå¤‡ä»½ç³»ç»Ÿä¿ç•™çš„æ—¥å¿—æ—¶é—´å°±è‡³å°‘æ˜¯åŠä¸ªæœˆ.")]),s._v(" "),t("p",[s._v("å¦å¤–, å»ºè®®ä¸è®ºä½¿ç”¨ä¸Šè¿°å“ªç§æ–¹å¼, éƒ½è¦æŠŠ"),t("strong",[s._v("è¿™ä¸ªæ•°æ®æ¢å¤åŠŸèƒ½åšæˆè‡ªåŠ¨åŒ–å·¥å…·")]),s._v(", å¹¶ä¸”ç»å¸¸æ‹¿å‡ºæ¥æ¼”ç»ƒ. è¿™é‡Œçš„åŽŸå› , ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢:")]),s._v(" "),t("ol",[t("li",[s._v('è™½ç„¶"å‘ç”Ÿè¿™ç§äº‹, å¤§å®¶éƒ½ä¸æƒ³çš„", ä½†æ˜¯ä¸‡ä¸€å‡ºçŽ°äº†è¯¯åˆ äº‹ä»¶, èƒ½å¤Ÿå¿«é€Ÿæ¢å¤æ•°æ®, å°†æŸå¤±é™åˆ°æœ€å°, ä¹Ÿåº”è¯¥ä¸ç”¨è·‘è·¯äº†.')]),s._v(" "),t("li",[s._v("è€Œå¦‚æžœä¸´æ—¶å†æ‰‹å¿™è„šä¹±åœ°æ‰‹åŠ¨æ“ä½œ, æœ€åŽåˆè¯¯æ“ä½œäº†, å¯¹ä¸šåŠ¡é€ æˆäº†äºŒæ¬¡ä¼¤å®³, é‚£å°±è¯´ä¸è¿‡åŽ»äº†.")])]),s._v(" "),t("h5",{attrs:{id:"å»¶è¿Ÿå¤åˆ¶å¤‡åº“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å»¶è¿Ÿå¤åˆ¶å¤‡åº“"}},[s._v("#")]),s._v(" å»¶è¿Ÿå¤åˆ¶å¤‡åº“")]),s._v(" "),t("p",[s._v('è™½ç„¶å¯ä»¥é€šè¿‡åˆ©ç”¨å¹¶è¡Œå¤åˆ¶æ¥åŠ é€Ÿæ¢å¤æ•°æ®çš„è¿‡ç¨‹, ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆä»ç„¶å­˜åœ¨ "æ¢å¤æ—¶é—´ä¸å¯æŽ§" çš„é—®é¢˜. å¦‚æžœä¸€ä¸ªåº“çš„å¤‡ä»½ç‰¹åˆ«å¤§, æˆ–è€…è¯¯æ“ä½œçš„æ—¶é—´è·ç¦»ä¸Šä¸€ä¸ªå…¨é‡å¤‡ä»½çš„æ—¶é—´è¾ƒé•¿, æ¯”å¦‚ä¸€å‘¨ä¸€å¤‡çš„å®žä¾‹, åœ¨å¤‡ä»½ä¹‹åŽçš„ç¬¬ 6 å¤©å‘ç”Ÿè¯¯æ“ä½œ, é‚£å°±éœ€è¦æ¢å¤ 6 å¤©çš„æ—¥å¿—, è¿™ä¸ªæ¢å¤æ—¶é—´å¯èƒ½æ˜¯è¦æŒ‰å¤©æ¥è®¡ç®—çš„.')]),s._v(" "),t("p",[s._v("é‚£ä¹ˆæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ç¼©çŸ­æ¢å¤æ•°æ®éœ€è¦çš„æ—¶é—´å‘¢? å¦‚æžœæœ‰éžå¸¸æ ¸å¿ƒçš„ä¸šåŠ¡, ä¸å…è®¸å¤ªé•¿çš„æ¢å¤æ—¶é—´, å¯ä»¥è€ƒè™‘**æ­å»ºå»¶è¿Ÿå¤åˆ¶çš„å¤‡åº“. ** è¿™ä¸ªåŠŸèƒ½æ˜¯ MySQL 5.6 ç‰ˆæœ¬å¼•å…¥çš„.")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬çš„ä¸»å¤‡å¤åˆ¶ç»“æž„å­˜åœ¨çš„é—®é¢˜æ˜¯, å¦‚æžœä¸»åº“ä¸Šæœ‰ä¸ªè¡¨è¢«è¯¯åˆ äº†, è¿™ä¸ªå‘½ä»¤å¾ˆå¿«ä¹Ÿä¼šè¢«å‘ç»™æ‰€æœ‰ä»Žåº“, è¿›è€Œå¯¼è‡´æ‰€æœ‰ä»Žåº“çš„æ•°æ®è¡¨ä¹Ÿéƒ½ä¸€èµ·è¢«è¯¯åˆ äº†. "),t("strong",[s._v("å»¶è¿Ÿå¤åˆ¶çš„å¤‡åº“æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¤‡åº“, é€šè¿‡ CHANGE MASTER TO MASTER_DELAY = N å‘½ä»¤, å¯ä»¥æŒ‡å®šè¿™ä¸ªå¤‡åº“æŒç»­ä¿æŒè·Ÿä¸»åº“æœ‰ N ç§’çš„å»¶è¿Ÿ")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚æŠŠ N è®¾ç½®ä¸º 3600, è¿™å°±ä»£è¡¨äº†å¦‚æžœä¸»åº“ä¸Šæœ‰æ•°æ®è¢«è¯¯åˆ äº†, å¹¶ä¸”åœ¨ 1 å°æ—¶å†…å‘çŽ°äº†è¿™ä¸ªè¯¯æ“ä½œå‘½ä»¤, è¿™ä¸ªå‘½ä»¤å°±è¿˜æ²¡æœ‰åœ¨è¿™ä¸ªå»¶è¿Ÿå¤åˆ¶çš„å¤‡åº“æ‰§è¡Œ. è¿™æ—¶å€™åˆ°è¿™ä¸ªå¤‡åº“ä¸Šæ‰§è¡Œ stop slave, å†é€šè¿‡ä¹‹å‰ä»‹ç»çš„æ–¹æ³•, è·³è¿‡è¯¯æ“ä½œå‘½ä»¤, å°±å¯ä»¥æ¢å¤å‡ºéœ€è¦çš„æ•°æ®. è¿™æ ·å°±éšæ—¶å¯ä»¥å¾—åˆ°ä¸€ä¸ª, åªéœ€è¦æœ€å¤šå†è¿½ 1 å°æ—¶, å°±å¯ä»¥æ¢å¤å‡ºæ•°æ®çš„ä¸´æ—¶å®žä¾‹, ä¹Ÿå°±ç¼©çŸ­äº†æ•´ä¸ªæ•°æ®æ¢å¤éœ€è¦çš„æ—¶é—´.")]),s._v(" "),t("h5",{attrs:{id:"é¢„é˜²è¯¯åˆ åº“-è¡¨çš„æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é¢„é˜²è¯¯åˆ åº“-è¡¨çš„æ–¹æ³•"}},[s._v("#")]),s._v(" é¢„é˜²è¯¯åˆ åº“/è¡¨çš„æ–¹æ³•")]),s._v(" "),t("p",[s._v("è™½ç„¶å¸¸åœ¨æ²³è¾¹èµ°, å¾ˆéš¾ä¸æ¹¿éž‹, ä½†ç»ˆç©¶è¿˜æ˜¯å¯ä»¥æ‰¾åˆ°ä¸€äº›æ–¹æ³•æ¥é¿å…çš„. æ‰€ä»¥è¿™é‡Œä¹Ÿç»™ä¸€äº›å‡å°‘è¯¯åˆ æ“ä½œé£Žé™©çš„å»ºè®®.")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€æ¡å»ºè®®æ˜¯, "),t("strong",[s._v("è´¦å·åˆ†ç¦»")]),s._v(". è¿™æ ·åšçš„ç›®çš„æ˜¯, é¿å…å†™é”™å‘½ä»¤. æ¯”å¦‚:")]),s._v(" "),t("ul",[t("li",[s._v("åªç»™ä¸šåŠ¡å¼€å‘åŒå­¦ DML æƒé™, è€Œä¸ç»™ truncate/drop æƒé™. è€Œå¦‚æžœä¸šåŠ¡å¼€å‘äººå‘˜æœ‰ DDL éœ€æ±‚çš„è¯, ä¹Ÿå¯ä»¥é€šè¿‡å¼€å‘ç®¡ç†ç³»ç»Ÿå¾—åˆ°æ”¯æŒ.")]),s._v(" "),t("li",[s._v("å³ä½¿æ˜¯ DBA å›¢é˜Ÿæˆå‘˜, æ—¥å¸¸ä¹Ÿéƒ½è§„å®šåªä½¿ç”¨åªè¯»è´¦å·, å¿…è¦çš„æ—¶å€™æ‰ä½¿ç”¨æœ‰æ›´æ–°æƒé™çš„è´¦å·.")])]),s._v(" "),t("p",[s._v("ç¬¬äºŒæ¡å»ºè®®æ˜¯, "),t("strong",[s._v("åˆ¶å®šæ“ä½œè§„èŒƒ")]),s._v(". è¿™æ ·åšçš„ç›®çš„, æ˜¯é¿å…å†™é”™è¦åˆ é™¤çš„è¡¨å. æ¯”å¦‚:")]),s._v(" "),t("ul",[t("li",[s._v("åœ¨åˆ é™¤æ•°æ®è¡¨ä¹‹å‰, å¿…é¡»å…ˆå¯¹è¡¨åšæ”¹åæ“ä½œ. ç„¶åŽè§‚å¯Ÿä¸€æ®µæ—¶é—´, ç¡®ä¿å¯¹ä¸šåŠ¡æ— å½±å“ä»¥åŽå†åˆ é™¤è¿™å¼ è¡¨.")]),s._v(" "),t("li",[s._v("æ”¹è¡¨åçš„æ—¶å€™, è¦æ±‚ç»™è¡¨ååŠ å›ºå®šçš„åŽç¼€(æ¯”å¦‚åŠ  _to_be_deleted), ç„¶åŽåˆ é™¤è¡¨çš„åŠ¨ä½œå¿…é¡»é€šè¿‡ç®¡ç†ç³»ç»Ÿæ‰§è¡Œ. å¹¶ä¸”ç®¡ç†ç³»åˆ é™¤è¡¨çš„æ—¶å€™, åªèƒ½åˆ é™¤å›ºå®šåŽç¼€çš„è¡¨.")])]),s._v(" "),t("h5",{attrs:{id:"rmåˆ é™¤æ•°æ®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rmåˆ é™¤æ•°æ®"}},[s._v("#")]),s._v(" rmåˆ é™¤æ•°æ®")]),s._v(" "),t("p",[s._v("å…¶å®ž, å¯¹äºŽä¸€ä¸ªæœ‰é«˜å¯ç”¨æœºåˆ¶çš„ MySQL é›†ç¾¤æ¥è¯´, æœ€ä¸æ€•çš„å°±æ˜¯ rm åˆ é™¤æ•°æ®äº†. åªè¦ä¸æ˜¯æ¶æ„åœ°æŠŠæ•´ä¸ªé›†ç¾¤åˆ é™¤, è€Œåªæ˜¯åˆ æŽ‰äº†å…¶ä¸­æŸä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®çš„è¯, HA ç³»ç»Ÿå°±ä¼šå¼€å§‹å·¥ä½œ, é€‰å‡ºä¸€ä¸ªæ–°çš„ä¸»åº“, ä»Žè€Œä¿è¯æ•´ä¸ªé›†ç¾¤çš„æ­£å¸¸å·¥ä½œ. è¿™æ—¶è¦åšçš„å°±æ˜¯åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠæŠŠæ•°æ®æ¢å¤å›žæ¥, å†æŽ¥å…¥æ•´ä¸ªé›†ç¾¤.")]),s._v(" "),t("p",[s._v("å½“ç„¶äº†, çŽ°åœ¨ä¸æ­¢æ˜¯ DBA æœ‰è‡ªåŠ¨åŒ–ç³»ç»Ÿ, SA(ç³»ç»Ÿç®¡ç†å‘˜)ä¹Ÿæœ‰è‡ªåŠ¨åŒ–ç³»ç»Ÿ, æ‰€ä»¥ä¹Ÿè®¸ä¸€ä¸ªæ‰¹é‡ä¸‹çº¿æœºå™¨çš„æ“ä½œ, ä¼šè®©ä½ æ•´ä¸ª MySQL é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å…¨å†›è¦†æ²¡.")]),s._v(" "),t("p",[s._v("åº”å¯¹è¿™ç§æƒ…å†µ, å»ºè®®åªèƒ½æ˜¯è¯´å°½é‡æŠŠä½ çš„å¤‡ä»½è·¨æœºæˆ¿, æˆ–è€…æœ€å¥½æ˜¯è·¨åŸŽå¸‚ä¿å­˜.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-29"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-29"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚è®¨è®ºäº†è¯¯åˆ æ•°æ®çš„å‡ ç§å¯èƒ½, ä»¥åŠè¯¯åˆ åŽçš„å¤„ç†æ–¹æ³•. ä½†è¦å¼ºè°ƒçš„æ˜¯, "),t("strong",[s._v("é¢„é˜²è¿œæ¯”å¤„ç†çš„æ„ä¹‰æ¥å¾—å¤§")]),s._v(". å¦å¤–, åœ¨ MySQL çš„é›†ç¾¤æ–¹æ¡ˆä¸­, ä¼šæ—¶ä¸æ—¶åœ°ç”¨åˆ°å¤‡ä»½æ¥æ¢å¤å®žä¾‹, å› æ­¤"),t("strong",[s._v("å®šæœŸæ£€æŸ¥å¤‡ä»½çš„æœ‰æ•ˆæ€§")]),s._v("ä¹Ÿå¾ˆæœ‰å¿…è¦.")]),s._v(" "),t("p",[s._v("å¦‚æžœä½ æ˜¯ä¸šåŠ¡å¼€å‘åŒå­¦, å¯ä»¥ç”¨ show grants å‘½ä»¤æŸ¥çœ‹è´¦æˆ·çš„æƒé™, å¦‚æžœæƒé™è¿‡å¤§, å¯ä»¥å»ºè®® DBA åŒå­¦ç»™ä½ åˆ†é…æƒé™ä½Žä¸€äº›çš„è´¦å·; ä½ ä¹Ÿå¯ä»¥è¯„ä¼°ä¸šåŠ¡çš„é‡è¦æ€§, å’Œ DBA å•†é‡å¤‡ä»½çš„å‘¨æœŸ, æ˜¯å¦æœ‰å¿…è¦åˆ›å»ºå»¶è¿Ÿå¤åˆ¶çš„å¤‡åº“ç­‰ç­‰.")]),s._v(" "),t("p",[s._v("æ•°æ®å’ŒæœåŠ¡çš„å¯é æ€§ä¸æ­¢æ˜¯è¿ç»´å›¢é˜Ÿçš„å·¥ä½œ, æœ€ç»ˆæ˜¯å„ä¸ªçŽ¯èŠ‚ä¸€èµ·ä¿éšœçš„ç»“æžœ.")]),s._v(" "),t("h4",{attrs:{id:"_32-ä¸ºä»€ä¹ˆè¿˜æœ‰killä¸æŽ‰çš„è¯­å¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_32-ä¸ºä»€ä¹ˆè¿˜æœ‰killä¸æŽ‰çš„è¯­å¥"}},[s._v("#")]),s._v(" 32-ä¸ºä»€ä¹ˆè¿˜æœ‰killä¸æŽ‰çš„è¯­å¥?")]),s._v(" "),t("p",[s._v("åœ¨ MySQL ä¸­æœ‰ä¸¤ä¸ª kill å‘½ä»¤: "),t("strong",[s._v("ä¸€ä¸ªæ˜¯ kill query + çº¿ç¨‹ id, è¡¨ç¤ºç»ˆæ­¢è¿™ä¸ªçº¿ç¨‹ä¸­æ­£åœ¨æ‰§è¡Œçš„è¯­å¥; ä¸€ä¸ªæ˜¯ kill connection + çº¿ç¨‹ id, è¿™é‡Œ connection å¯ç¼ºçœ, è¡¨ç¤ºæ–­å¼€è¿™ä¸ªçº¿ç¨‹çš„è¿žæŽ¥, å½“ç„¶å¦‚æžœè¿™ä¸ªçº¿ç¨‹æœ‰è¯­å¥æ­£åœ¨æ‰§è¡Œ, ä¹Ÿæ˜¯è¦å…ˆåœæ­¢æ­£åœ¨æ‰§è¡Œçš„è¯­å¥çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸çŸ¥é“ä½ åœ¨ä½¿ç”¨ MySQL çš„æ—¶å€™, æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„çŽ°è±¡: "),t("strong",[s._v("ä½¿ç”¨äº† kill å‘½ä»¤, å´æ²¡èƒ½æ–­å¼€è¿™ä¸ªè¿žæŽ¥")]),s._v(". å†æ‰§è¡Œ show processlist å‘½ä»¤, çœ‹åˆ°è¿™æ¡è¯­å¥çš„ Command åˆ—æ˜¾ç¤ºçš„æ˜¯ Killed.")]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šä¼šå¥‡æ€ª, æ˜¾ç¤ºä¸º Killed æ˜¯ä»€ä¹ˆæ„æ€, ä¸æ˜¯åº”è¯¥ç›´æŽ¥åœ¨ show processlist çš„ç»“æžœé‡Œçœ‹ä¸åˆ°è¿™ä¸ªçº¿ç¨‹äº†å—?  æœ¬èŠ‚å°±æ¥è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("å…¶å®žå¤§å¤šæ•°æƒ…å†µä¸‹, kill query/connection å‘½ä»¤æ˜¯æœ‰æ•ˆçš„. æ¯”å¦‚æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢çš„è¿‡ç¨‹ä¸­, å‘çŽ°æ‰§è¡Œæ—¶é—´å¤ªä¹…, è¦æ”¾å¼ƒç»§ç»­æŸ¥è¯¢, è¿™æ—¶å°±å¯ä»¥ç”¨ kill query å‘½ä»¤, ç»ˆæ­¢è¿™æ¡æŸ¥è¯¢è¯­å¥.")]),s._v(" "),t("p",[s._v("è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯, "),t("strong",[s._v("è¯­å¥å¤„äºŽé”ç­‰å¾…çš„æ—¶å€™, ç›´æŽ¥ä½¿ç”¨ kill å‘½ä»¤ä¹Ÿæ˜¯æœ‰æ•ˆ")]),s._v("çš„. ä¸€èµ·æ¥çœ‹ä¸‹è¿™ä¸ªä¾‹å­:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/182c861d1e5eed5a1d24061284e36b8b-20230731161914-awjhii2.png",alt:"",title:"kill queryæˆåŠŸçš„ä¾‹å­"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, session C æ‰§è¡Œ kill query ä»¥åŽ, session B å‡ ä¹ŽåŒæ—¶å°±æç¤ºäº†è¯­å¥è¢«ä¸­æ–­. è¿™å°±æ˜¯é¢„æœŸçš„ç»“æžœ.")]),s._v(" "),t("h5",{attrs:{id:"æ”¶åˆ°killä»¥åŽ-çº¿ç¨‹åšä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ”¶åˆ°killä»¥åŽ-çº¿ç¨‹åšä»€ä¹ˆ"}},[s._v("#")]),s._v(" æ”¶åˆ°killä»¥åŽ,çº¿ç¨‹åšä»€ä¹ˆ?")]),s._v(" "),t("p",[s._v("ä½†è¿™é‡Œè¦åœä¸‹æ¥æƒ³ä¸€ä¸‹: session B æ˜¯ç›´æŽ¥ç»ˆæ­¢æŽ‰çº¿ç¨‹, ä»€ä¹ˆéƒ½ä¸ç®¡å°±ç›´æŽ¥é€€å‡ºå—? æ˜¾ç„¶è¿™æ˜¯ä¸è¡Œçš„.")]),s._v(" "),t("p",[s._v("å‰é¢è®²è¿‡, "),t("strong",[s._v("å½“å¯¹ä¸€ä¸ªè¡¨åšå¢žåˆ æ”¹æŸ¥æ“ä½œæ—¶, ä¼šåœ¨è¡¨ä¸ŠåŠ  MDL è¯»é”")]),s._v(". æ‰€ä»¥ session B è™½ç„¶å¤„äºŽ blocked çŠ¶æ€, ä½†è¿˜æ˜¯æ‹¿ç€ä¸€ä¸ª MDL è¯»é”çš„. å¦‚æžœçº¿ç¨‹è¢« kill çš„æ—¶å€™, å°±ç›´æŽ¥ç»ˆæ­¢, "),t("strong",[s._v("é‚£ä¹‹åŽè¿™ä¸ª MDL è¯»é”å°±æ²¡æœºä¼šè¢«é‡Šæ”¾")]),s._v('äº†. è¿™æ ·çœ‹æ¥, kill å¹¶ä¸æ˜¯é©¬ä¸Šåœæ­¢çš„æ„æ€, è€Œæ˜¯å‘Šè¯‰æ‰§è¡Œçº¿ç¨‹è¯´, è¿™æ¡è¯­å¥å·²ç»ä¸éœ€è¦ç»§ç»­æ‰§è¡Œäº†, å¯ä»¥å¼€å§‹"æ‰§è¡Œåœæ­¢çš„é€»è¾‘äº†".')]),s._v(" "),t("blockquote",[t("p",[s._v('å…¶å®ž, è¿™è·Ÿ Linux çš„ kill å‘½ä»¤ç±»ä¼¼, kill -N pid å¹¶ä¸æ˜¯è®©è¿›ç¨‹ç›´æŽ¥åœæ­¢, è€Œæ˜¯ç»™è¿›ç¨‹å‘ä¸€ä¸ªä¿¡å·, ç„¶åŽè¿›ç¨‹å¤„ç†è¿™ä¸ªä¿¡å·, è¿›å…¥ç»ˆæ­¢é€»è¾‘. åªæ˜¯å¯¹äºŽ MySQL çš„ kill å‘½ä»¤æ¥è¯´, ä¸éœ€è¦ä¼ ä¿¡å·é‡å‚æ•°, å°±åªæœ‰"åœæ­¢"è¿™ä¸ªå‘½ä»¤.')])]),s._v(" "),t("p",[s._v("**å®žçŽ°ä¸Š, å½“ç”¨æˆ·æ‰§è¡Œ kill query thread_id_B æ—¶, MySQL é‡Œå¤„ç† kill å‘½ä»¤çš„çº¿ç¨‹åšäº†ä¸¤ä»¶äº‹: **")]),s._v(" "),t("ol",[t("li",[s._v("æŠŠ session B çš„è¿è¡ŒçŠ¶æ€æ”¹æˆ "),t("code",[s._v("THD::KILL_QUERY")]),s._v("â€‹(å°†å˜é‡ killed èµ‹å€¼ä¸º "),t("code",[s._v("THD::KILL_QUERY")]),s._v("â€‹);")]),s._v(" "),t("li",[s._v("ç»™ session B çš„æ‰§è¡Œçº¿ç¨‹å‘ä¸€ä¸ªä¿¡å·.")])]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆè¦å‘ä¿¡å·å‘¢?")]),s._v(" "),t("p",[s._v("å› ä¸ºåƒä¸Šå›¾çš„ä¾‹å­é‡Œé¢, session B å¤„äºŽé”ç­‰å¾…çŠ¶æ€, å¦‚æžœåªæ˜¯æŠŠ session B çš„çº¿ç¨‹çŠ¶æ€è®¾ç½® "),t("code",[s._v("THD::KILL_QUERY")]),s._v("â€‹, çº¿ç¨‹ B å¹¶ä¸çŸ¥é“è¿™ä¸ªçŠ¶æ€å˜åŒ–, è¿˜æ˜¯ä¼šç»§ç»­ç­‰å¾…. å‘ä¸€ä¸ªä¿¡å·çš„ç›®çš„, å°±æ˜¯è®© session B é€€å‡ºç­‰å¾…, æ¥å¤„ç†è¿™ä¸ª "),t("code",[s._v("THD::KILL_QUERY")]),s._v("â€‹ çŠ¶æ€.")]),s._v(" "),t("p",[s._v("ä¸Šé¢çš„åˆ†æžä¸­, éšå«äº†è¿™ä¹ˆä¸‰å±‚æ„æ€:")]),s._v(" "),t("ol",[t("li",[s._v('ä¸€ä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰å¤šå¤„ "åŸ‹ç‚¹", åœ¨è¿™äº›"åŸ‹ç‚¹"çš„åœ°æ–¹åˆ¤æ–­çº¿ç¨‹çŠ¶æ€, å¦‚æžœå‘çŽ°çº¿ç¨‹çŠ¶æ€æ˜¯ '),t("code",[s._v("THD::KILL_QUERY")]),s._v("â€‹, æ‰å¼€å§‹è¿›å…¥è¯­å¥ç»ˆæ­¢é€»è¾‘;")]),s._v(" "),t("li",[s._v('å¦‚æžœå¤„äºŽç­‰å¾…çŠ¶æ€, å¿…é¡»æ˜¯ä¸€ä¸ªå¯ä»¥è¢«å”¤é†’çš„ç­‰å¾…, å¦åˆ™æ ¹æœ¬ä¸ä¼šæ‰§è¡Œåˆ°"åŸ‹ç‚¹"å¤„;')]),s._v(" "),t("li",[s._v("è¯­å¥ä»Žå¼€å§‹è¿›å…¥ç»ˆæ­¢é€»è¾‘, åˆ°ç»ˆæ­¢é€»è¾‘å®Œå…¨å®Œæˆ, æ˜¯æœ‰ä¸€ä¸ªè¿‡ç¨‹çš„.")])]),s._v(" "),t("p",[s._v('åˆ°è¿™é‡Œä½ å°±çŸ¥é“äº†, åŽŸæ¥ä¸æ˜¯ "è¯´åœå°±åœçš„".')]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥"),t("strong",[s._v("å†çœ‹ä¸€ä¸ª kill ä¸æŽ‰çš„ä¾‹å­")]),s._v(", ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„ innodb_thread_concurrency ä¸å¤Ÿç”¨çš„ä¾‹å­.")]),s._v(" "),t("p",[s._v("é¦–å…ˆ, æ‰§è¡Œ set global innodb_thread_concurrency=2, å°† InnoDB çš„å¹¶å‘çº¿ç¨‹ä¸Šé™æ•°è®¾ç½®ä¸º 2; ç„¶åŽ, æ‰§è¡Œä¸‹é¢çš„åºåˆ—:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3d459e05ee4e087e2e48079a6cef6eaf-20230731161914-apyd4q7.png",alt:"",title:"kill queryæ— æ•ˆçš„ä¾‹å­"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°:")]),s._v(" "),t("ol",[t("li",[s._v("sesssion C æ‰§è¡Œçš„æ—¶å€™è¢«å µä½äº†;")]),s._v(" "),t("li",[s._v("ä½†æ˜¯ session D æ‰§è¡Œçš„ kill query C å‘½ä»¤å´æ²¡ä»€ä¹ˆæ•ˆæžœ,")]),s._v(" "),t("li",[s._v('ç›´åˆ° session E æ‰§è¡Œäº† kill connection å‘½ä»¤, æ‰æ–­å¼€äº† session C çš„è¿žæŽ¥, æç¤º "Lost connection to MySQL server during query",')]),s._v(" "),t("li",[s._v("ä½†æ˜¯è¿™æ—¶å€™, å¦‚æžœåœ¨ session E ä¸­æ‰§è¡Œ show processlist, å°±èƒ½çœ‹åˆ°ä¸‹é¢è¿™ä¸ªå›¾.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/fb7be88745df229320147762456ad4ed-20230731161914-gu10smr.png",alt:"",title:"kill connectionä¹‹åŽçš„æ•ˆæžœ"}})]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™, id=12 è¿™ä¸ªçº¿ç¨‹çš„ Commnad åˆ—æ˜¾ç¤ºçš„æ˜¯ Killed. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("å®¢æˆ·ç«¯è™½ç„¶æ–­å¼€äº†è¿žæŽ¥, ä½†å®žé™…ä¸ŠæœåŠ¡ç«¯ä¸Šè¿™æ¡è¯­å¥è¿˜åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­")]),s._v(".")]),s._v(" "),t("p",[s._v("**ä¸ºä»€ä¹ˆåœ¨æ‰§è¡Œ kill query å‘½ä»¤æ—¶, è¿™æ¡è¯­å¥ä¸åƒç¬¬ä¸€ä¸ªä¾‹å­çš„ update è¯­å¥ä¸€æ ·é€€å‡ºå‘¢? **")]),s._v(" "),t("p",[s._v("åœ¨å®žçŽ°ä¸Š, ç­‰è¡Œé”æ—¶, ä½¿ç”¨çš„æ˜¯ pthread_cond_timedwait å‡½æ•°, è¿™ä¸ªç­‰å¾…çŠ¶æ€å¯ä»¥è¢«å”¤é†’. ä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­é‡Œ, 12 å·çº¿ç¨‹çš„ç­‰å¾…é€»è¾‘æ˜¯è¿™æ ·çš„: æ¯ 10 æ¯«ç§’åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å¯ä»¥è¿›å…¥ InnoDB æ‰§è¡Œ, å¦‚æžœä¸è¡Œ, å°±è°ƒç”¨ nanosleep å‡½æ•°è¿›å…¥ sleep çŠ¶æ€.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("è™½ç„¶ 12 å·çº¿ç¨‹çš„çŠ¶æ€å·²ç»è¢«è®¾ç½®æˆäº† KILL_QUERY, ä½†æ˜¯åœ¨è¿™ä¸ªç­‰å¾…è¿›å…¥ InnoDB çš„å¾ªçŽ¯è¿‡ç¨‹ä¸­, å¹¶æ²¡æœ‰åŽ»åˆ¤æ–­çº¿ç¨‹çš„çŠ¶æ€, å› æ­¤æ ¹æœ¬ä¸ä¼šè¿›å…¥ç»ˆæ­¢é€»è¾‘é˜¶æ®µ")]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œå½“ session E æ‰§è¡Œ kill connection å‘½ä»¤æ—¶, æ˜¯è¿™ä¹ˆåšçš„,")]),s._v(" "),t("ol",[t("li",[s._v("æŠŠ 12 å·çº¿ç¨‹çŠ¶æ€è®¾ç½®ä¸º KILL_CONNECTION;")]),s._v(" "),t("li",[s._v("å…³æŽ‰ 12 å·çº¿ç¨‹çš„ç½‘ç»œè¿žæŽ¥. å› ä¸ºæœ‰è¿™ä¸ªæ“ä½œ, æ‰€ä»¥ä½ ä¼šçœ‹åˆ°, è¿™æ—¶å€™ session C æ”¶åˆ°äº†æ–­å¼€è¿žæŽ¥çš„æç¤º.")])]),s._v(" "),t("p",[s._v("é‚£ä¸ºä»€ä¹ˆæ‰§è¡Œ show processlist çš„æ—¶å€™, ä¼šçœ‹åˆ° Command åˆ—æ˜¾ç¤ºä¸º killed å‘¢? å…¶å®žè¿™å°±æ˜¯å› ä¸ºåœ¨æ‰§è¡Œ show processlist çš„æ—¶å€™, æœ‰ä¸€ä¸ªç‰¹åˆ«çš„é€»è¾‘: å¦‚æžœä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€æ˜¯ KILL_CONNECTION, å°±æŠŠ Command åˆ—æ˜¾ç¤ºæˆ Killed. æ‰€ä»¥å…¶å®ž, å³ä½¿æ˜¯å®¢æˆ·ç«¯é€€å‡ºäº†, è¿™ä¸ªçº¿ç¨‹çš„çŠ¶æ€ä»ç„¶æ˜¯åœ¨ç­‰å¾…ä¸­.")]),s._v(" "),t("p",[s._v("é‚£è¿™ä¸ªçº¿ç¨‹ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºå‘¢? ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("åªæœ‰ç­‰åˆ°æ»¡è¶³è¿›å…¥ InnoDB çš„æ¡ä»¶åŽ, session C çš„æŸ¥è¯¢è¯­å¥ç»§ç»­æ‰§è¡Œ, ç„¶åŽæ‰æœ‰å¯èƒ½åˆ¤æ–­åˆ°çº¿ç¨‹çŠ¶æ€å·²ç»å˜æˆäº† KILL_QUERY æˆ–è€… KILL_CONNECTION, å†è¿›å…¥ç»ˆæ­¢é€»è¾‘é˜¶æ®µ")]),s._v(".")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œ, æ¥å°ç»“ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("**è¿™ä¸ªä¾‹å­æ˜¯ kill æ— æ•ˆçš„ç¬¬ä¸€ç±»æƒ…å†µ, å³: çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œåˆ°åˆ¤æ–­çº¿ç¨‹çŠ¶æ€çš„é€»è¾‘. **è·Ÿè¿™ç§æƒ…å†µç›¸åŒçš„, è¿˜æœ‰ç”±äºŽ IO åŽ‹åŠ›è¿‡å¤§, è¯»å†™ IO çš„å‡½æ•°ä¸€ç›´æ— æ³•è¿”å›ž, å¯¼è‡´ä¸èƒ½åŠæ—¶åˆ¤æ–­çº¿ç¨‹çš„çŠ¶æ€.")]),s._v(" "),t("p",[s._v("**å¦ä¸€ç±»æƒ…å†µæ˜¯, ç»ˆæ­¢é€»è¾‘è€—æ—¶è¾ƒé•¿. **è¿™æ—¶å€™, ä»Ž show processlist ç»“æžœä¸Šçœ‹ä¹Ÿæ˜¯ Command=Killed, éœ€è¦ç­‰åˆ°ç»ˆæ­¢é€»è¾‘å®Œæˆ, è¯­å¥æ‰ç®—çœŸæ­£å®Œæˆ. è¿™ç±»æƒ…å†µ, æ¯”è¾ƒå¸¸è§çš„åœºæ™¯æœ‰ä»¥ä¸‹å‡ ç§:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("è¶…å¤§äº‹åŠ¡æ‰§è¡ŒæœŸé—´è¢« kill")]),s._v(". è¿™æ—¶å€™, å›žæ»šæ“ä½œéœ€è¦å¯¹äº‹åŠ¡æ‰§è¡ŒæœŸé—´ç”Ÿæˆçš„æ‰€æœ‰æ–°æ•°æ®ç‰ˆæœ¬åšå›žæ”¶æ“ä½œ, è€—æ—¶å¾ˆé•¿.")]),s._v(" "),t("li",[t("strong",[s._v("å¤§æŸ¥è¯¢å›žæ»š")]),s._v(". å¦‚æžœæŸ¥è¯¢è¿‡ç¨‹ä¸­ç”Ÿæˆäº†æ¯”è¾ƒå¤§çš„ä¸´æ—¶æ–‡ä»¶, åŠ ä¸Šæ­¤æ—¶æ–‡ä»¶ç³»ç»ŸåŽ‹åŠ›å¤§, åˆ é™¤ä¸´æ—¶æ–‡ä»¶å¯èƒ½éœ€è¦ç­‰å¾… IO èµ„æº, å¯¼è‡´è€—æ—¶è¾ƒé•¿.")]),s._v(" "),t("li",[s._v("DDL å‘½ä»¤æ‰§è¡Œåˆ°æœ€åŽé˜¶æ®µ, å¦‚æžœè¢« kill, éœ€è¦åˆ é™¤ä¸­é—´è¿‡ç¨‹çš„ä¸´æ—¶æ–‡ä»¶, ä¹Ÿå¯èƒ½å— IO èµ„æºå½±å“è€—æ—¶è¾ƒä¹….")])]),s._v(" "),t("p",[s._v("ä¹‹å‰æœ‰äººé—®è¿‡æˆ‘, å¦‚æžœç›´æŽ¥åœ¨å®¢æˆ·ç«¯é€šè¿‡ Ctrl+C å‘½ä»¤, æ˜¯ä¸æ˜¯å°±å¯ä»¥ç›´æŽ¥ç»ˆæ­¢çº¿ç¨‹å‘¢?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, "),t("strong",[s._v("ä¸å¯ä»¥")]),s._v(". è¿™é‡Œæœ‰ä¸€ä¸ªè¯¯è§£, å…¶å®žåœ¨å®¢æˆ·ç«¯çš„æ“ä½œåªèƒ½æ“ä½œåˆ°å®¢æˆ·ç«¯çš„çº¿ç¨‹, å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åªèƒ½é€šè¿‡ç½‘ç»œäº¤äº’, æ˜¯ä¸å¯èƒ½ç›´æŽ¥æ“ä½œæœåŠ¡ç«¯çº¿ç¨‹çš„. è€Œç”±äºŽ MySQL æ˜¯åœç­‰åè®®, æ‰€ä»¥è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œçš„è¯­å¥è¿˜æ²¡æœ‰è¿”å›žçš„æ—¶å€™, å†å¾€è¿™ä¸ªè¿žæŽ¥é‡Œé¢ç»§ç»­å‘å‘½ä»¤ä¹Ÿæ˜¯æ²¡æœ‰ç”¨çš„. å®žé™…ä¸Š, æ‰§è¡Œ Ctrl+C çš„æ—¶å€™, æ˜¯ MySQL å®¢æˆ·ç«¯å¦å¤–å¯åŠ¨ä¸€ä¸ªè¿žæŽ¥, ç„¶åŽå‘é€ä¸€ä¸ª kill query å‘½ä»¤. æ‰€ä»¥, åˆ«ä»¥ä¸ºåœ¨å®¢æˆ·ç«¯æ‰§è¡Œå®Œ Ctrl+C å°±ä¸‡äº‹å¤§å‰äº†. å› ä¸ºè¦ kill æŽ‰ä¸€ä¸ªçº¿ç¨‹, è¿˜æ¶‰åŠåˆ°åŽç«¯çš„å¾ˆå¤šæ“ä½œ.")]),s._v(" "),t("h5",{attrs:{id:"å¦å¤–ä¸¤ä¸ªå…³äºŽå®¢æˆ·ç«¯çš„è¯¯è§£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦å¤–ä¸¤ä¸ªå…³äºŽå®¢æˆ·ç«¯çš„è¯¯è§£"}},[s._v("#")]),s._v(" å¦å¤–ä¸¤ä¸ªå…³äºŽå®¢æˆ·ç«¯çš„è¯¯è§£")]),s._v(" "),t("p",[s._v("åœ¨å®žé™…ä½¿ç”¨ä¸­, æˆ‘ä¹Ÿç»å¸¸ä¼šç¢°åˆ°ä¸€äº›åŒå­¦å¯¹å®¢æˆ·ç«¯çš„ä½¿ç”¨æœ‰è¯¯è§£. ä¸‹é¢å°±æ¥çœ‹çœ‹ä¸¤ä¸ªæœ€å¸¸è§çš„è¯¯è§£.")]),s._v(" "),t("p",[s._v("**ç¬¬ä¸€ä¸ªè¯¯è§£æ˜¯: å¦‚æžœåº“é‡Œé¢çš„è¡¨ç‰¹åˆ«å¤š, è¿žæŽ¥å°±ä¼šå¾ˆæ…¢. **")]),s._v(" "),t("p",[s._v("æœ‰äº›çº¿ä¸Šçš„åº“, ä¼šåŒ…å«å¾ˆå¤šè¡¨(æˆ‘è§è¿‡æœ€å¤šçš„ä¸€ä¸ªåº“é‡Œæœ‰ 6 ä¸‡ä¸ªè¡¨). è¿™æ—¶å€™, ä½ å°±ä¼šå‘çŽ°, æ¯æ¬¡ç”¨å®¢æˆ·ç«¯è¿žæŽ¥éƒ½ä¼šå¡åœ¨ä¸‹é¢è¿™ä¸ªç•Œé¢ä¸Š.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/975b2432edb339742987f037265b631b-20230731161914-5fb5mjv.png",alt:"",title:"è¿žæŽ¥ç­‰å¾…"}})]),s._v(" "),t("p",[s._v("è€Œå¦‚æžœ db1 è¿™ä¸ªåº“é‡Œè¡¨å¾ˆå°‘çš„è¯, è¿žæŽ¥èµ·æ¥å°±ä¼šå¾ˆå¿«, å¯ä»¥å¾ˆå¿«è¿›å…¥è¾“å…¥å‘½ä»¤çš„çŠ¶æ€. å› æ­¤æœ‰åŒå­¦ä¼šè®¤ä¸ºæ˜¯è¡¨çš„æ•°ç›®å½±å“äº†è¿žæŽ¥æ€§èƒ½.")]),s._v(" "),t("p",[s._v("å‰é¢è®²è¿‡, "),t("strong",[s._v("æ¯ä¸ªå®¢æˆ·ç«¯åœ¨å’ŒæœåŠ¡ç«¯å»ºç«‹è¿žæŽ¥çš„æ—¶å€™, éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯ TCP æ¡æ‰‹, ç”¨æˆ·æ ¡éªŒ, èŽ·å–æƒé™. ä½†è¿™å‡ ä¸ªæ“ä½œ, æ˜¾ç„¶è·Ÿåº“é‡Œé¢è¡¨çš„ä¸ªæ•°æ— å…³")]),s._v(". ä½†å®žé™…ä¸Š, æ­£å¦‚å›¾ä¸­çš„æ–‡å­—æç¤ºæ‰€è¯´çš„, å½“ä½¿ç”¨é»˜è®¤å‚æ•°è¿žæŽ¥çš„æ—¶å€™, MySQL å®¢æˆ·ç«¯ä¼šæä¾›ä¸€ä¸ªæœ¬åœ°åº“åå’Œè¡¨åè¡¥å…¨çš„åŠŸèƒ½. ä¸ºäº†å®žçŽ°è¿™ä¸ªåŠŸèƒ½, å®¢æˆ·ç«¯åœ¨è¿žæŽ¥æˆåŠŸåŽ, éœ€è¦"),t("strong",[s._v("å¤šåšä¸€äº›æ“ä½œ")]),s._v(":")]),s._v(" "),t("ol",[t("li",[s._v("æ‰§è¡Œ show databases;")]),s._v(" "),t("li",[s._v("åˆ‡åˆ° db1 åº“, æ‰§è¡Œ show tables;")]),s._v(" "),t("li",[s._v("æŠŠè¿™ä¸¤ä¸ªå‘½ä»¤çš„ç»“æžœç”¨äºŽæž„å»ºä¸€ä¸ªæœ¬åœ°çš„å“ˆå¸Œè¡¨.")])]),s._v(" "),t("p",[s._v("åœ¨è¿™äº›æ“ä½œä¸­, æœ€èŠ±æ—¶é—´çš„å°±æ˜¯ç¬¬ä¸‰æ­¥"),t("strong",[s._v("åœ¨æœ¬åœ°æž„å»ºå“ˆå¸Œè¡¨")]),s._v("çš„æ“ä½œ. æ‰€ä»¥å½“ä¸€ä¸ªåº“ä¸­çš„è¡¨ä¸ªæ•°éžå¸¸å¤šçš„æ—¶å€™, è¿™ä¸€æ­¥å°±ä¼šèŠ±æ¯”è¾ƒé•¿çš„æ—¶é—´.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, **æˆ‘ä»¬æ„ŸçŸ¥åˆ°çš„è¿žæŽ¥è¿‡ç¨‹æ…¢, å…¶å®žå¹¶ä¸æ˜¯è¿žæŽ¥æ…¢, ä¹Ÿä¸æ˜¯æœåŠ¡ç«¯æ…¢, è€Œæ˜¯å®¢æˆ·ç«¯æ…¢. **")]),s._v(" "),t("p",[s._v("å›¾ä¸­çš„æç¤ºä¹Ÿè¯´äº†, å¦‚æžœåœ¨è¿žæŽ¥å‘½ä»¤ä¸­åŠ ä¸Š -A, å°±å¯ä»¥"),t("strong",[s._v("å…³æŽ‰è¿™ä¸ªè‡ªåŠ¨è¡¥å…¨")]),s._v("çš„åŠŸèƒ½, ç„¶åŽå®¢æˆ·ç«¯å°±å¯ä»¥å¿«é€Ÿè¿”å›žäº†. è¿™é‡Œè‡ªåŠ¨è¡¥å…¨çš„æ•ˆæžœå°±æ˜¯, ä½ åœ¨è¾“å…¥åº“åæˆ–è€…è¡¨åçš„æ—¶å€™, è¾“å…¥å‰ç¼€, å¯ä»¥ä½¿ç”¨ Tab é”®è‡ªåŠ¨è¡¥å…¨è¡¨åæˆ–è€…æ˜¾ç¤ºæç¤º. å®žé™…ä½¿ç”¨ä¸­, å¦‚æžœè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ç”¨å¾—å¹¶ä¸å¤š, å°±å»ºè®®æ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™éƒ½é»˜è®¤åŠ  -A.")]),s._v(" "),t("p",[s._v("å…¶å®žæç¤ºé‡Œé¢æ²¡æœ‰è¯´, é™¤äº†åŠ  -A ä»¥å¤–, åŠ  â€“quick(æˆ–è€…ç®€å†™ä¸º -q) å‚æ•°, ä¹Ÿå¯ä»¥è·³è¿‡è¿™ä¸ªé˜¶æ®µ. ä½†æ˜¯è¿™ä¸ª  **â€“quick æ˜¯ä¸€ä¸ªæ›´å®¹æ˜“å¼•èµ·è¯¯ä¼šçš„å‚æ•°, ä¹Ÿæ˜¯å…³äºŽå®¢æˆ·ç«¯å¸¸è§çš„ä¸€ä¸ªè¯¯è§£. **")]),s._v(" "),t("p",[s._v("ä½ çœ‹åˆ°è¿™ä¸ªå‚æ•°, æ˜¯ä¸æ˜¯è§‰å¾—è¿™åº”è¯¥æ˜¯ä¸€ä¸ªè®©æœåŠ¡ç«¯åŠ é€Ÿçš„å‚æ•°? ä½†å®žé™…ä¸Šæ°æ°ç›¸å, "),t("strong",[s._v("è®¾ç½®äº†è¿™ä¸ªå‚æ•°å¯èƒ½ä¼šé™ä½ŽæœåŠ¡ç«¯çš„æ€§èƒ½")]),s._v(". ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢?")]),s._v(" "),t("p",[s._v("MySQL å®¢æˆ·ç«¯å‘é€è¯·æ±‚åŽ, æŽ¥æ”¶æœåŠ¡ç«¯è¿”å›žç»“æžœçš„æ–¹å¼æœ‰ä¸¤ç§:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸€ç§æ˜¯æœ¬åœ°ç¼“å­˜, ä¹Ÿå°±æ˜¯åœ¨æœ¬åœ°å¼€ä¸€ç‰‡å†…å­˜, å…ˆæŠŠç»“æžœå­˜èµ·æ¥. å¦‚æžœç”¨ API å¼€å‘, å¯¹åº”çš„å°±æ˜¯ mysql_store_result æ–¹æ³•.")]),s._v(" "),t("li",[s._v("å¦ä¸€ç§æ˜¯ä¸ç¼“å­˜, è¯»ä¸€ä¸ªå¤„ç†ä¸€ä¸ª. å¦‚æžœç”¨ API å¼€å‘, å¯¹åº”çš„å°±æ˜¯ mysql_use_result æ–¹æ³•.")])]),s._v(" "),t("p",[s._v("MySQL å®¢æˆ·ç«¯é»˜è®¤é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼, "),t("strong",[s._v("è€Œå¦‚æžœåŠ ä¸Š â€“quick å‚æ•°, å°±ä¼šä½¿ç”¨ç¬¬äºŒç§ä¸ç¼“å­˜çš„æ–¹å¼")]),s._v(". é‡‡ç”¨ä¸ç¼“å­˜çš„æ–¹å¼æ—¶, å¦‚æžœæœ¬åœ°å¤„ç†å¾—æ…¢, å°±ä¼šå¯¼è‡´æœåŠ¡ç«¯å‘é€ç»“æžœè¢«é˜»å¡ž, å› æ­¤ä¼šè®©æœåŠ¡ç«¯å˜æ…¢. å…³äºŽæœåŠ¡ç«¯çš„å…·ä½“è¡Œä¸º, ä¼šåœ¨ä¸‹ä¸€èŠ‚å†å±•å¼€è¯´æ˜Ž.")]),s._v(" "),t("p",[s._v("é‚£ä½ ä¼šè¯´, æ—¢ç„¶è¿™æ ·, ä¸ºä»€ä¹ˆè¦ç»™è¿™ä¸ªå‚æ•°å–åå«ä½œ quick å‘¢? è¿™æ˜¯å› ä¸ºä½¿ç”¨è¿™ä¸ªå‚æ•°å¯ä»¥è¾¾åˆ°ä»¥ä¸‹ä¸‰ç‚¹æ•ˆæžœ:")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€ç‚¹, å°±æ˜¯å‰é¢æåˆ°çš„, è·³è¿‡è¡¨åè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½.")]),s._v(" "),t("li",[s._v("ç¬¬äºŒç‚¹, mysql_store_result éœ€è¦ç”³è¯·æœ¬åœ°å†…å­˜æ¥ç¼“å­˜æŸ¥è¯¢ç»“æžœ, å¦‚æžœæŸ¥è¯¢ç»“æžœå¤ªå¤§, ä¼šè€—è´¹è¾ƒå¤šçš„æœ¬åœ°å†…å­˜, å¯èƒ½ä¼šå½±å“å®¢æˆ·ç«¯æœ¬åœ°æœºå™¨çš„æ€§èƒ½;")]),s._v(" "),t("li",[s._v("ç¬¬ä¸‰ç‚¹, æ˜¯ä¸ä¼šæŠŠæ‰§è¡Œå‘½ä»¤è®°å½•åˆ°æœ¬åœ°çš„å‘½ä»¤åŽ†å²æ–‡ä»¶.")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥  "),t("strong",[s._v("â€“quick å‚æ•°çš„æ„æ€, æ˜¯è®©å®¢æˆ·ç«¯å˜å¾—æ›´å¿«")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-30"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-30"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v('æœ¬èŠ‚ä»‹ç»äº† MySQL ä¸­, æœ‰äº›è¯­å¥å’Œè¿žæŽ¥"kill ä¸æŽ‰"çš„æƒ…å†µ. '),t("strong",[s._v('è¿™äº› "kill ä¸æŽ‰" çš„æƒ…å†µ, å…¶å®žæ˜¯å› ä¸ºå‘é€ kill å‘½ä»¤çš„å®¢æˆ·ç«¯, å¹¶æ²¡æœ‰å¼ºè¡Œåœæ­¢ç›®æ ‡çº¿ç¨‹çš„æ‰§è¡Œ, è€Œåªæ˜¯è®¾ç½®äº†ä¸ªçŠ¶æ€, å¹¶å”¤é†’å¯¹åº”çš„çº¿ç¨‹. è€Œè¢« kill çš„çº¿ç¨‹, éœ€è¦æ‰§è¡Œåˆ°åˆ¤æ–­çŠ¶æ€çš„ "åŸ‹ç‚¹", æ‰ä¼šå¼€å§‹è¿›å…¥ç»ˆæ­¢é€»è¾‘é˜¶æ®µ. å¹¶ä¸”, ç»ˆæ­¢é€»è¾‘æœ¬èº«ä¹Ÿæ˜¯éœ€è¦è€—è´¹æ—¶é—´çš„')]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, å¦‚æžœä½ å‘çŽ°ä¸€ä¸ªçº¿ç¨‹å¤„äºŽ Killed çŠ¶æ€, å¯ä»¥åšçš„äº‹æƒ…å°±æ˜¯, é€šè¿‡å½±å“ç³»ç»ŸçŽ¯å¢ƒ, è®©è¿™ä¸ª Killed çŠ¶æ€å°½å¿«ç»“æŸ.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚, å¦‚æžœæ˜¯ç¬¬ä¸€ä¸ªä¾‹å­é‡Œ InnoDB å¹¶å‘åº¦çš„é—®é¢˜, å°±å¯ä»¥ä¸´æ—¶è°ƒå¤§ innodb_thread_concurrency çš„å€¼, æˆ–è€…åœæŽ‰åˆ«çš„çº¿ç¨‹, è®©å‡ºä½å­ç»™è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œ. è€Œå¦‚æžœæ˜¯å›žæ»šé€»è¾‘ç”±äºŽå—åˆ° IO èµ„æºé™åˆ¶æ‰§è¡Œå¾—æ¯”è¾ƒæ…¢, å°±é€šè¿‡å‡å°‘ç³»ç»ŸåŽ‹åŠ›è®©å®ƒåŠ é€Ÿ. åšå®Œè¿™äº›æ“ä½œåŽ, å…¶å®žä½ å·²ç»æ²¡æœ‰åŠžæ³•å†å¯¹å®ƒåšä»€ä¹ˆäº†, åªèƒ½ç­‰å¾…æµç¨‹è‡ªå·±å®Œæˆ.")]),s._v(" "),t("h4",{attrs:{id:"_33-æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®-ä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_33-æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®-ä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†"}},[s._v("#")]),s._v(" 33-æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®,ä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†?")]),s._v(" "),t("p",[s._v("æˆ‘ç»å¸¸ä¼šè¢«é—®åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜: "),t("strong",[s._v("ä¸»æœºå†…å­˜åªæœ‰ 100G, çŽ°åœ¨è¦å¯¹ä¸€ä¸ª 200G çš„å¤§è¡¨åšå…¨è¡¨æ‰«æ, ä¼šä¸ä¼šæŠŠæ•°æ®åº“ä¸»æœºçš„å†…å­˜ç”¨å…‰")]),s._v("äº†?")]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜ç¡®å®žå€¼å¾—æ‹…å¿ƒ, è¢«ç³»ç»Ÿ OOM(out of memory)å¯ä¸æ˜¯é—¹ç€çŽ©çš„. ä½†åè¿‡æ¥æƒ³æƒ³, é€»è¾‘å¤‡ä»½çš„æ—¶å€™, å¯ä¸å°±æ˜¯åšæ•´åº“æ‰«æå—? å¦‚æžœè¿™æ ·å°±ä¼šæŠŠå†…å­˜åƒå…‰, é€»è¾‘å¤‡ä»½ä¸æ˜¯æ—©å°±æŒ‚äº†? æ‰€ä»¥å¯¹å¤§è¡¨åšå…¨è¡¨æ‰«æ, çœ‹æ¥åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„. ä½†è¿™ä¸ªæµç¨‹åˆ°åº•æ˜¯æ€Žä¹ˆæ ·çš„å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"å…¨è¡¨æ‰«æå¯¹serverå±‚çš„å½±å“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¨è¡¨æ‰«æå¯¹serverå±‚çš„å½±å“"}},[s._v("#")]),s._v(" å…¨è¡¨æ‰«æå¯¹serverå±‚çš„å½±å“")]),s._v(" "),t("p",[s._v("å‡è®¾, çŽ°åœ¨è¦å¯¹ä¸€ä¸ª 200G çš„ InnoDB è¡¨ db1. t, æ‰§è¡Œä¸€ä¸ªå…¨è¡¨æ‰«æ. å½“ç„¶è¦æŠŠæ‰«æç»“æžœä¿å­˜åœ¨å®¢æˆ·ç«¯, ä¼šä½¿ç”¨ç±»ä¼¼è¿™æ ·çš„å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h$host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P$port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p$pwd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"select * from db1.t"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" $target_file\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å·²ç»çŸ¥é“äº†, InnoDB çš„æ•°æ®æ˜¯ä¿å­˜åœ¨"),t("strong",[s._v("ä¸»é”®ç´¢å¼•")]),s._v("ä¸Šçš„, æ‰€ä»¥å…¨è¡¨æ‰«æå®žé™…ä¸Šæ˜¯ç›´æŽ¥æ‰«æè¡¨ t çš„ä¸»é”®ç´¢å¼•. è¿™æ¡æŸ¥è¯¢è¯­å¥ç”±äºŽæ²¡æœ‰å…¶ä»–çš„åˆ¤æ–­æ¡ä»¶, æ‰€ä»¥æŸ¥åˆ°çš„æ¯ä¸€è¡Œéƒ½å¯ä»¥ç›´æŽ¥æ”¾åˆ°ç»“æžœé›†é‡Œé¢, ç„¶åŽè¿”å›žç»™å®¢æˆ·ç«¯.")]),s._v(" "),t("p",[t("strong",[s._v('é‚£ä¹ˆè¿™ä¸ª"ç»“æžœé›†"å­˜åœ¨å“ªé‡Œå‘¢?')])]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, "),t("strong",[s._v("æœåŠ¡ç«¯å¹¶ä¸éœ€è¦ä¿å­˜ä¸€ä¸ªå®Œæ•´çš„ç»“æžœé›†")]),s._v(". å–æ•°æ®å’Œå‘æ•°æ®çš„æµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("èŽ·å–ä¸€è¡Œ, å†™åˆ° net_buffer ä¸­. è¿™å—å†…å­˜çš„å¤§å°æ˜¯ç”±å‚æ•° net_buffer_length å®šä¹‰çš„, é»˜è®¤æ˜¯ 16k.")]),s._v(" "),t("li",[s._v("é‡å¤èŽ·å–è¡Œ, ç›´åˆ° net_buffer å†™æ»¡, "),t("strong",[s._v("è°ƒç”¨ç½‘ç»œæŽ¥å£å‘å‡ºåŽ»")]),s._v(".")]),s._v(" "),t("li",[s._v("å¦‚æžœå‘é€æˆåŠŸ, å°±æ¸…ç©º net_buffer, ç„¶åŽç»§ç»­å–ä¸‹ä¸€è¡Œ, å¹¶å†™å…¥ net_buffer.")]),s._v(" "),t("li",[s._v("å¦‚æžœå‘é€å‡½æ•°è¿”å›ž EAGAIN æˆ– WSAEWOULDBLOCK, å°±è¡¨ç¤ºæœ¬åœ°ç½‘ç»œæ ˆ(socket send buffer)å†™æ»¡äº†, è¿›å…¥ç­‰å¾…. ç›´åˆ°ç½‘ç»œæ ˆé‡æ–°å¯å†™, å†ç»§ç»­å‘é€.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹å¯¹åº”çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/00845daa093b21246e46f453458f61b9-20230731161914-nxain9d.png",alt:"",title:"æŸ¥è¯¢ç»“æžœå‘é€æµç¨‹"}})]),s._v(" "),t("p",[s._v("ä»Žè¿™ä¸ªæµç¨‹å¯ä»¥çœ‹åˆ°:")]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v("ä¸€ä¸ªæŸ¥è¯¢åœ¨å‘é€è¿‡ç¨‹ä¸­, å ç”¨çš„ MySQL å†…éƒ¨çš„å†…å­˜æœ€å¤§å°±æ˜¯ net_buffer_length è¿™ä¹ˆå¤§")])]),s._v(", å¹¶ä¸ä¼šè¾¾åˆ° 200G;")]),s._v(" "),t("li",[s._v("socket send buffer ä¹Ÿä¸å¯èƒ½è¾¾åˆ° 200G(é»˜è®¤å®šä¹‰ "),t("code",[s._v("/proc/sys/net/core/wmem_default")]),s._v("â€‹), å¦‚æžœ socket send buffer è¢«å†™æ»¡, å°±ä¼š"),t("strong",[s._v("æš‚åœè¯»æ•°æ®çš„æµç¨‹")]),s._v(".")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("mark",[t("strong",[s._v('MySQL æ˜¯ "è¾¹è¯»è¾¹å‘çš„"')])]),s._v(" , è¿™ä¸ªæ¦‚å¿µå¾ˆé‡è¦. è¿™å°±æ„å‘³ç€, "),t("strong",[s._v("å¦‚æžœå®¢æˆ·ç«¯æŽ¥æ”¶å¾—æ…¢, ä¼šå¯¼è‡´ MySQL æœåŠ¡ç«¯ç”±äºŽç»“æžœå‘ä¸å‡ºåŽ», è¿™ä¸ªäº‹åŠ¡çš„æ‰§è¡Œæ—¶é—´å˜é•¿")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸‹é¢è¿™ä¸ªçŠ¶æ€, å°±æ˜¯æ•…æ„è®©å®¢æˆ·ç«¯ä¸åŽ»è¯» socket receive buffer ä¸­çš„å†…å®¹, ç„¶åŽåœ¨æœåŠ¡ç«¯ show processlist çœ‹åˆ°çš„ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/db4c091fe5399aa3e1b8d41834989a93-20230731161914-jhin0r8.png",alt:"",title:"æœåŠ¡ç«¯å‘é€é˜»å¡ž"}})]),s._v(" "),t("p",[s._v("å¦‚æžœçœ‹åˆ° State çš„å€¼ä¸€ç›´å¤„äºŽ  "),t("strong",[s._v('"Sending to client"')]),s._v(" , å°±è¡¨ç¤º"),t("strong",[s._v("æœåŠ¡å™¨ç«¯çš„ç½‘ç»œæ ˆå†™æ»¡")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("å‰é¢æ›¾æåˆ°, å¦‚æžœå®¢æˆ·ç«¯ä½¿ç”¨ â€“quick å‚æ•°, ä¼šä½¿ç”¨ mysql_use_result æ–¹æ³•. è¿™ä¸ªæ–¹æ³•æ˜¯è¯»ä¸€è¡Œå¤„ç†ä¸€è¡Œ. å¯ä»¥æƒ³è±¡ä¸€ä¸‹, å‡è®¾æœ‰ä¸€ä¸ªä¸šåŠ¡çš„é€»è¾‘æ¯”è¾ƒå¤æ‚, æ¯è¯»ä¸€è¡Œæ•°æ®ä»¥åŽè¦å¤„ç†çš„é€»è¾‘å¦‚æžœå¾ˆæ…¢, å°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¦è¿‡å¾ˆä¹…æ‰ä¼šåŽ»å–ä¸‹ä¸€è¡Œæ•°æ®, å¯èƒ½å°±ä¼šå‡ºçŽ°å¦‚ä¸Šå›¾æ‰€ç¤ºçš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("å› æ­¤, "),t("mark",[t("strong",[s._v("å¯¹äºŽæ­£å¸¸çš„çº¿ä¸Šä¸šåŠ¡æ¥è¯´, å¦‚æžœä¸€ä¸ªæŸ¥è¯¢çš„è¿”å›žç»“æžœä¸ä¼šå¾ˆå¤šçš„è¯, éƒ½å»ºè®®ä½ ä½¿ç”¨ mysql_store_result è¿™ä¸ªæŽ¥å£, ç›´æŽ¥æŠŠæŸ¥è¯¢ç»“æžœä¿å­˜åˆ°æœ¬åœ°å†…å­˜")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("å½“ç„¶å‰ææ˜¯æŸ¥è¯¢è¿”å›žç»“æžœä¸å¤š. æœ‰åŒå­¦è¯´è‡ªå·±å› ä¸ºæ‰§è¡Œäº†ä¸€ä¸ªå¤§æŸ¥è¯¢å¯¼è‡´å®¢æˆ·ç«¯å ç”¨å†…å­˜è¿‘ 20G, è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦æ”¹ç”¨ mysql_use_result æŽ¥å£äº†.")]),s._v(" "),t("p",[s._v('å¦ä¸€æ–¹é¢, å¦‚æžœä½ åœ¨è‡ªå·±è´Ÿè´£ç»´æŠ¤çš„ MySQL é‡Œçœ‹åˆ°å¾ˆå¤šä¸ªçº¿ç¨‹éƒ½å¤„äºŽ "Sending to client" è¿™ä¸ªçŠ¶æ€, å°±æ„å‘³ç€è¦è®©ä¸šåŠ¡å¼€å‘åŒå­¦ä¼˜åŒ–æŸ¥è¯¢ç»“æžœ, å¹¶è¯„ä¼°è¿™ä¹ˆå¤šçš„è¿”å›žç»“æžœæ˜¯å¦åˆç†. è€Œå¦‚æžœè¦å¿«é€Ÿå‡å°‘å¤„äºŽè¿™ä¸ªçŠ¶æ€çš„çº¿ç¨‹çš„è¯, '),t("strong",[s._v("å°† net_buffer_length å‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªæ›´å¤§çš„å€¼")]),s._v("æ˜¯ä¸€ä¸ªå¯é€‰æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v('ä¸Ž "Sending to client" é•¿ç›¸å¾ˆç±»ä¼¼çš„ä¸€ä¸ªçŠ¶æ€æ˜¯  '),t("strong",[s._v('"Sending data"')]),s._v(' , è¿™æ˜¯ä¸€ä¸ªç»å¸¸è¢«è¯¯ä¼šçš„é—®é¢˜. æœ‰åŒå­¦é—®æˆ‘è¯´, åœ¨è‡ªå·±ç»´æŠ¤çš„å®žä¾‹ä¸Šçœ‹åˆ°å¾ˆå¤šæŸ¥è¯¢è¯­å¥çš„çŠ¶æ€æ˜¯ "Sending data", ä½†æŸ¥çœ‹ç½‘ç»œä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜å•Š, ä¸ºä»€ä¹ˆ Sending data è¦è¿™ä¹ˆä¹…?')]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„çŠ¶æ€å˜åŒ–æ˜¯è¿™æ ·çš„(æ³¨æ„: è¿™é‡Œç•¥åŽ»äº†å…¶ä»–æ— å…³çš„çŠ¶æ€):")]),s._v(" "),t("ul",[t("li",[s._v("MySQL æŸ¥è¯¢è¯­å¥"),t("strong",[s._v("è¿›å…¥æ‰§è¡Œé˜¶æ®µ")]),s._v('åŽ, é¦–å…ˆæŠŠçŠ¶æ€è®¾ç½®æˆ "Sending data";')]),s._v(" "),t("li",[s._v("ç„¶åŽ, å‘é€æ‰§è¡Œç»“æžœçš„åˆ—ç›¸å…³çš„ä¿¡æ¯(meta data) ç»™å®¢æˆ·ç«¯;")]),s._v(" "),t("li",[s._v("å†ç»§ç»­æ‰§è¡Œè¯­å¥çš„æµç¨‹;")]),s._v(" "),t("li",[s._v("æ‰§è¡Œå®ŒæˆåŽ, æŠŠçŠ¶æ€è®¾ç½®æˆç©ºå­—ç¬¦ä¸².")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´,  "),t("strong",[s._v('"Sending data" å¹¶ä¸ä¸€å®šæ˜¯æŒ‡ "æ­£åœ¨å‘é€æ•°æ®", è€Œå¯èƒ½æ˜¯å¤„äºŽæ‰§è¡Œå™¨è¿‡ç¨‹ä¸­çš„ä»»æ„é˜¶æ®µ')]),s._v(". æ¯”å¦‚å¯ä»¥æž„é€ ä¸€ä¸ªé”ç­‰å¾…çš„åœºæ™¯, å°±èƒ½çœ‹åˆ° Sending data çŠ¶æ€.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/847ed3ba640f54de228a52a97dabbf56-20230731161914-f7wdq5w.png",alt:"",title:"è¯»å…¨è¡¨è¢«é”"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2d349ce862e956c035a4e3ef428dc44f-20230731161914-g4ig2px.png",alt:"",title:"Sending dataçŠ¶æ€"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, session B æ˜Žæ˜¾æ˜¯åœ¨ç­‰é”, çŠ¶æ€æ˜¾ç¤ºä¸º Sending data.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, ä»…"),t("strong",[s._v('å½“ä¸€ä¸ªçº¿ç¨‹å¤„äºŽ "ç­‰å¾…å®¢æˆ·ç«¯æŽ¥æ”¶ç»“æžœ" çš„çŠ¶æ€, æ‰ä¼šæ˜¾ç¤º "Sending to client"; è€Œå¦‚æžœæ˜¾ç¤ºæˆ"Sending data", å®ƒçš„æ„æ€åªæ˜¯ "æ­£åœ¨æ‰§è¡Œ"')]),s._v(" .")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä½ çŸ¥é“äº†, æŸ¥è¯¢çš„ç»“æžœæ˜¯åˆ†æ®µå‘ç»™å®¢æˆ·ç«¯çš„, "),t("strong",[s._v("å› æ­¤æ‰«æå…¨è¡¨, æŸ¥è¯¢è¿”å›žå¤§é‡çš„æ•°æ®, å¹¶ä¸ä¼šæŠŠå†…å­˜æ‰“çˆ†")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("åœ¨ server å±‚çš„å¤„ç†é€»è¾‘éƒ½æ¸…æ¥šäº†, åœ¨ InnoDB å¼•æ“Žé‡Œé¢åˆæ˜¯æ€Žä¹ˆå¤„ç†çš„å‘¢? æ‰«æå…¨è¡¨ä¼šä¸ä¼šå¯¹å¼•æ“Žç³»ç»Ÿé€ æˆå½±å“å‘¢")]),s._v("?")]),s._v(" "),t("h5",{attrs:{id:"å…¨è¡¨æ‰«æå¯¹innodbçš„å½±å“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¨è¡¨æ‰«æå¯¹innodbçš„å½±å“"}},[s._v("#")]),s._v(" å…¨è¡¨æ‰«æå¯¹InnoDBçš„å½±å“")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç» WAL æœºåˆ¶çš„æ—¶å€™, åˆ†æžäº† InnoDB å†…å­˜çš„ä¸€ä¸ªä½œç”¨, æ˜¯"),t("strong",[s._v("ä¿å­˜æ›´æ–°çš„ç»“æžœ")]),s._v(", å†é…åˆ redo log, å°±é¿å…äº†éšæœºå†™ç›˜.")]),s._v(" "),t("p",[t("strong",[s._v("å†…å­˜çš„æ•°æ®é¡µæ˜¯åœ¨ Buffer Pool (BP)")]),s._v("  ä¸­ç®¡ç†çš„, åœ¨ WAL é‡Œ Buffer Pool èµ·åˆ°äº†åŠ é€Ÿæ›´æ–°çš„ä½œç”¨. è€Œå®žé™…ä¸Š, Buffer Pool è¿˜æœ‰ä¸€ä¸ªæ›´é‡è¦çš„ä½œç”¨, å°±æ˜¯"),t("strong",[s._v("åŠ é€ŸæŸ¥è¯¢")]),s._v(".")]),s._v(" "),t("p",[s._v("æœ‰äººé—®é“, ç”±äºŽæœ‰ WAL æœºåˆ¶, å½“äº‹åŠ¡æäº¤çš„æ—¶å€™, ç£ç›˜ä¸Šçš„æ•°æ®é¡µæ˜¯æ—§çš„, é‚£å¦‚æžœè¿™æ—¶å€™é©¬ä¸Šæœ‰ä¸€ä¸ªæŸ¥è¯¢è¦æ¥è¯»è¿™ä¸ªæ•°æ®é¡µ, æ˜¯ä¸æ˜¯è¦é©¬ä¸ŠæŠŠ redo log åº”ç”¨åˆ°æ•°æ®é¡µå‘¢? ç­”æ¡ˆæ˜¯ä¸éœ€è¦. "),t("strong",[s._v("å› ä¸ºè¿™æ—¶å€™å†…å­˜æ•°æ®é¡µçš„ç»“æžœæ˜¯æœ€æ–°çš„, ç›´æŽ¥è¯»å†…å­˜é¡µå°±å¯ä»¥äº†")]),s._v(". ä½ çœ‹è¿™æ—¶å€™æŸ¥è¯¢æ ¹æœ¬ä¸éœ€è¦è¯»ç£ç›˜, ç›´æŽ¥ä»Žå†…å­˜æ‹¿ç»“æžœ, é€Ÿåº¦æ˜¯å¾ˆå¿«çš„. æ‰€ä»¥ Buffer Pool è¿˜æœ‰åŠ é€ŸæŸ¥è¯¢çš„ä½œç”¨.")]),s._v(" "),t("p",[s._v("è€Œ Buffer Pool å¯¹æŸ¥è¯¢çš„åŠ é€Ÿæ•ˆæžœ, ä¾èµ–äºŽä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡, å³: "),t("strong",[s._v("å†…å­˜å‘½ä¸­çŽ‡")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ å¯ä»¥åœ¨ "),t("code",[s._v("show engine innodb status")]),s._v("â€‹ ç»“æžœä¸­, "),t("strong",[s._v("æŸ¥çœ‹ä¸€ä¸ªç³»ç»Ÿå½“å‰çš„ BP å‘½ä¸­çŽ‡")]),s._v('. ä¸€èˆ¬æƒ…å†µä¸‹, ä¸€ä¸ªç¨³å®šæœåŠ¡çš„çº¿ä¸Šç³»ç»Ÿ, è¦ä¿è¯å“åº”æ—¶é—´ç¬¦åˆè¦æ±‚çš„è¯, å†…å­˜å‘½ä¸­çŽ‡è¦åœ¨ 99% ä»¥ä¸Š. æ‰§è¡Œ show engine innodb status, å¯ä»¥çœ‹åˆ° "Buffer pool hit rate" å­—æ ·, æ˜¾ç¤ºçš„å°±æ˜¯å½“å‰çš„å‘½ä¸­çŽ‡. æ¯”å¦‚ä¸‹å›¾è¿™ä¸ªå‘½ä¸­çŽ‡, å°±æ˜¯ 99.0%.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/00a06b7a32e955157c85b1a01127359e-20230731161914-a04heg9.png",alt:""}})]),s._v(" "),t("p",[s._v("å¦‚æžœæ‰€æœ‰æŸ¥è¯¢éœ€è¦çš„æ•°æ®é¡µéƒ½èƒ½å¤Ÿç›´æŽ¥ä»Žå†…å­˜å¾—åˆ°, é‚£æ˜¯æœ€å¥½çš„, å¯¹åº”çš„å‘½ä¸­çŽ‡å°±æ˜¯ 100%. ä½†è¿™åœ¨å®žé™…ç”Ÿäº§ä¸Šæ˜¯å¾ˆéš¾åšåˆ°çš„.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("InnoDB Buffer Pool çš„å¤§å°æ˜¯ç”±å‚æ•° innodb_buffer_pool_size ç¡®å®šçš„, ä¸€èˆ¬å»ºè®®è®¾ç½®æˆå¯ç”¨ç‰©ç†å†…å­˜çš„ 60%~80%")])]),s._v(" .")]),s._v(" "),t("p",[s._v("åœ¨å¤§çº¦åå¹´å‰, å•æœºçš„æ•°æ®é‡æ˜¯ä¸Šç™¾ä¸ª G, è€Œç‰©ç†å†…å­˜æ˜¯å‡ ä¸ª G; çŽ°åœ¨è™½ç„¶å¾ˆå¤šæœåŠ¡å™¨éƒ½èƒ½æœ‰ 128G ç”šè‡³æ›´é«˜çš„å†…å­˜, ä½†æ˜¯å•æœºçš„æ•°æ®é‡å´è¾¾åˆ°äº† T çº§åˆ«. æ‰€ä»¥, innodb_buffer_pool_size å°äºŽç£ç›˜çš„æ•°æ®é‡æ˜¯å¾ˆå¸¸è§çš„. "),t("strong",[s._v("å¦‚æžœä¸€ä¸ª Buffer Pool æ»¡äº†, è€Œåˆè¦ä»Žç£ç›˜è¯»å…¥ä¸€ä¸ªæ•°æ®é¡µ, é‚£è‚¯å®šæ˜¯è¦æ·˜æ±°ä¸€ä¸ªæ—§æ•°æ®é¡µçš„. InnoDB å†…å­˜ç®¡ç†ç”¨çš„æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨ (Least Recently Used, LRU) ç®—æ³•, è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹å›¾æ˜¯ä¸€ä¸ª LRU ç®—æ³•çš„åŸºæœ¬æ¨¡åž‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c49ddb3bd1985a4ca628d5956a6b8b19-20230731161914-kw9g61m.png",alt:"",title:"åŸºæœ¬çš„LRUç®—æ³•"}})]),s._v(" "),t("p",[s._v("InnoDB ç®¡ç† Buffer Pool çš„ LRU ç®—æ³•, æ˜¯"),t("strong",[s._v("ç”¨é“¾è¡¨æ¥å®žçŽ°")]),s._v("çš„.")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨ä¸Šå›¾çš„çŠ¶æ€ 1 é‡Œ, é“¾è¡¨å¤´éƒ¨æ˜¯ P1, è¡¨ç¤º P1 æ˜¯æœ€è¿‘åˆšåˆšè¢«è®¿é—®è¿‡çš„æ•°æ®é¡µ; å‡è®¾å†…å­˜é‡Œåªèƒ½æ”¾ä¸‹è¿™ä¹ˆå¤šæ•°æ®é¡µ;")]),s._v(" "),t("li",[s._v("è¿™æ—¶å€™æœ‰ä¸€ä¸ªè¯»è¯·æ±‚è®¿é—® P3, å› æ­¤å˜æˆçŠ¶æ€ 2, P3 è¢«ç§»åˆ°æœ€å‰é¢;")]),s._v(" "),t("li",[s._v("çŠ¶æ€ 3 è¡¨ç¤º, è¿™æ¬¡è®¿é—®çš„æ•°æ®é¡µæ˜¯ä¸å­˜åœ¨äºŽé“¾è¡¨ä¸­çš„, æ‰€ä»¥éœ€è¦åœ¨ Buffer Pool ä¸­æ–°ç”³è¯·ä¸€ä¸ªæ•°æ®é¡µ Px, åŠ åˆ°é“¾è¡¨å¤´éƒ¨. ä½†æ˜¯ç”±äºŽå†…å­˜å·²ç»æ»¡äº†, "),t("strong",[s._v("ä¸èƒ½ç”³è¯·æ–°çš„å†…å­˜")]),s._v(". äºŽæ˜¯, ä¼š"),t("strong",[s._v("æ¸…ç©ºé“¾è¡¨æœ«å°¾ Pm è¿™ä¸ªæ•°æ®é¡µçš„å†…å­˜")]),s._v(", å­˜å…¥ Px çš„å†…å®¹, ç„¶åŽæ”¾åˆ°é“¾è¡¨å¤´éƒ¨.")]),s._v(" "),t("li",[s._v("ä»Žæ•ˆæžœä¸Šçœ‹, å°±æ˜¯æœ€ä¹…æ²¡æœ‰è¢«è®¿é—®çš„æ•°æ®é¡µ Pm, è¢«æ·˜æ±°äº†.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªç®—æ³•ä¹ä¸€çœ‹ä¸ŠåŽ»æ²¡ä»€ä¹ˆé—®é¢˜, ä½†æ˜¯"),t("strong",[s._v("å¦‚æžœè€ƒè™‘åˆ°è¦åšä¸€ä¸ªå…¨è¡¨æ‰«æ")]),s._v(", ä¼šä¸ä¼šæœ‰é—®é¢˜å‘¢?")]),s._v(" "),t("p",[s._v("å‡è®¾æŒ‰ç…§è¿™ä¸ªç®—æ³•, è¦æ‰«æä¸€ä¸ª 200G çš„è¡¨, è€Œè¿™ä¸ªè¡¨æ˜¯ä¸€ä¸ªåŽ†å²æ•°æ®è¡¨, å¹³æ—¶æ²¡æœ‰ä¸šåŠ¡è®¿é—®å®ƒ. é‚£ä¹ˆ, æŒ‰ç…§è¿™ä¸ªç®—æ³•æ‰«æçš„è¯, "),t("strong",[s._v("å°±ä¼šæŠŠå½“å‰çš„ Buffer Pool é‡Œçš„æ•°æ®å…¨éƒ¨æ·˜æ±°æŽ‰, å­˜å…¥æ‰«æè¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„æ•°æ®é¡µçš„å†…å®¹")]),s._v(". ä¹Ÿå°±æ˜¯è¯´ Buffer Pool é‡Œé¢ä¸»è¦æ”¾çš„æ˜¯è¿™ä¸ªåŽ†å²æ•°æ®è¡¨çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("å¯¹äºŽä¸€ä¸ªæ­£åœ¨åšä¸šåŠ¡æœåŠ¡çš„åº“, è¿™å¯ä¸å¦™. ä½ ä¼šçœ‹åˆ°, Buffer Pool çš„å†…å­˜å‘½ä¸­çŽ‡æ€¥å‰§ä¸‹é™, ç£ç›˜åŽ‹åŠ›å¢žåŠ , SQL è¯­å¥å“åº”å˜æ…¢.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ InnoDB ä¸èƒ½ç›´æŽ¥ä½¿ç”¨è¿™ä¸ª LRU ç®—æ³•. å®žé™…ä¸Š, "),t("mark",[t("strong",[s._v("InnoDB å¯¹ LRU ç®—æ³•åšäº†æ”¹è¿›")])]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/04d7ce0185318f469972bce8bbd87386-20230731161914-4fs08gw.png",alt:"",title:"æ”¹è¿›çš„LRUç®—æ³•"}})]),s._v(" "),t("p",[s._v("åœ¨ InnoDB å®žçŽ°ä¸Š, "),t("strong",[s._v("æŒ‰ç…§ 5:3 çš„æ¯”ä¾‹æŠŠæ•´ä¸ª LRU é“¾è¡¨åˆ†æˆäº† young åŒºåŸŸå’Œ old åŒºåŸŸ")]),s._v(". å›¾ä¸­ LRU_old æŒ‡å‘çš„å°±æ˜¯ old åŒºåŸŸçš„ç¬¬ä¸€ä¸ªä½ç½®, æ˜¯æ•´ä¸ªé“¾è¡¨çš„ 5/8 å¤„. ä¹Ÿå°±æ˜¯è¯´, é è¿‘é“¾è¡¨å¤´éƒ¨çš„ 5/8 æ˜¯ young åŒºåŸŸ, é è¿‘é“¾è¡¨å°¾éƒ¨çš„ 3/8 æ˜¯ old åŒºåŸŸ.")]),s._v(" "),t("p",[s._v("æ”¹è¿›åŽçš„ LRU ç®—æ³•æ‰§è¡Œæµç¨‹å˜æˆäº†ä¸‹é¢è¿™æ ·.")]),s._v(" "),t("ol",[t("li",[s._v("ä¸Šå›¾ä¸­çŠ¶æ€ 1, è¦è®¿é—®æ•°æ®é¡µ P3, ç”±äºŽ P3 åœ¨ young åŒºåŸŸ, å› æ­¤å’Œä¼˜åŒ–å‰çš„ LRU ç®—æ³•ä¸€æ ·, å°†å…¶ç§»åˆ°é“¾è¡¨å¤´éƒ¨, å˜æˆçŠ¶æ€ 2.")]),s._v(" "),t("li",[s._v("ä¹‹åŽè¦è®¿é—®ä¸€ä¸ªæ–°çš„ä¸å­˜åœ¨äºŽå½“å‰é“¾è¡¨çš„æ•°æ®é¡µ, è¿™æ—¶å€™ä¾ç„¶æ˜¯æ·˜æ±°æŽ‰æ•°æ®é¡µ Pm, ä½†æ˜¯"),t("strong",[s._v("æ–°æ’å…¥çš„æ•°æ®é¡µ Px, æ˜¯æ”¾åœ¨ LRU_old å¤„")]),s._v(".")]),s._v(" "),t("li",[s._v("å¤„äºŽ old åŒºåŸŸçš„æ•°æ®é¡µ, æ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™éƒ½è¦åšä¸‹é¢è¿™ä¸ªåˆ¤æ–­: (1) è‹¥è¿™ä¸ªæ•°æ®é¡µåœ¨ LRU é“¾è¡¨ä¸­å­˜åœ¨çš„æ—¶é—´è¶…è¿‡äº† 1 ç§’, å°±æŠŠå®ƒç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨; (2) å¦‚æžœè¿™ä¸ªæ•°æ®é¡µåœ¨ LRU é“¾è¡¨ä¸­å­˜åœ¨çš„æ—¶é—´çŸ­äºŽ 1 ç§’, ä½ç½®ä¿æŒä¸å˜. 1 ç§’è¿™ä¸ªæ—¶é—´, æ˜¯ç”±å‚æ•° innodb_old_blocks_time æŽ§åˆ¶çš„. å…¶é»˜è®¤å€¼æ˜¯ 1000, å•ä½æ¯«ç§’.")])]),s._v(" "),t("p",[t("strong",[s._v("è¿™ä¸ªç­–ç•¥, å°±æ˜¯ä¸ºäº†å¤„ç†ç±»ä¼¼å…¨è¡¨æ‰«æçš„æ“ä½œé‡èº«å®šåˆ¶")]),s._v("çš„. è¿˜æ˜¯ä»¥åˆšåˆšçš„æ‰«æ 200G çš„åŽ†å²æ•°æ®è¡¨ä¸ºä¾‹, çœ‹çœ‹æ”¹è¿›åŽçš„ LRU ç®—æ³•çš„æ“ä½œé€»è¾‘:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰«æè¿‡ç¨‹ä¸­, "),t("strong",[s._v("éœ€è¦æ–°æ’å…¥çš„æ•°æ®é¡µ, éƒ½è¢«æ”¾åˆ° old åŒºåŸŸ")]),s._v(";")]),s._v(" "),t("li",[s._v("ä¸€ä¸ªæ•°æ®é¡µé‡Œé¢æœ‰å¤šæ¡è®°å½•, è¿™ä¸ªæ•°æ®é¡µä¼šè¢«å¤šæ¬¡è®¿é—®åˆ°, ä½†ç”±äºŽæ˜¯é¡ºåºæ‰«æ, è¿™ä¸ªæ•°æ®é¡µç¬¬ä¸€æ¬¡è¢«è®¿é—®å’Œæœ€åŽä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´é—´éš”"),t("strong",[s._v("ä¸ä¼šè¶…è¿‡ 1 ç§’")]),s._v(", å› æ­¤è¿˜æ˜¯ä¼šè¢«ä¿ç•™åœ¨ old åŒºåŸŸ;")]),s._v(" "),t("li",[s._v("å†ç»§ç»­æ‰«æåŽç»­çš„æ•°æ®, ä¹‹å‰çš„è¿™ä¸ªæ•°æ®é¡µä¹‹åŽä¹Ÿä¸ä¼šå†è¢«è®¿é—®åˆ°, äºŽæ˜¯å§‹ç»ˆæ²¡æœ‰æœºä¼šç§»åˆ°é“¾è¡¨å¤´éƒ¨(ä¹Ÿå°±æ˜¯ young åŒºåŸŸ), "),t("strong",[s._v("å¾ˆå¿«å°±ä¼šè¢«æ·˜æ±°å‡ºåŽ»")]),s._v(".")])]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªç­–ç•¥æœ€å¤§çš„æ”¶ç›Š, å°±æ˜¯åœ¨æ‰«æè¿™ä¸ªå¤§è¡¨çš„è¿‡ç¨‹ä¸­, è™½ç„¶ä¹Ÿç”¨åˆ°äº† Buffer Pool, ä½†æ˜¯å¯¹ young åŒºåŸŸå®Œå…¨æ²¡æœ‰å½±å“, ä»Žè€Œä¿è¯äº† Buffer Pool å“åº”æ­£å¸¸ä¸šåŠ¡çš„æŸ¥è¯¢å‘½ä¸­çŽ‡. å…¶å®žæ€»ç»“èµ·æ¥å°±æ˜¯, young åŒºæ”¾çš„éƒ½æ˜¯çƒ­ç‚¹æ•°æ®, old åŒºæ”¾çš„æ˜¯æ–°åŠ è½½åˆ°å†…å­˜çš„æ•°æ®, å¦‚æžœæ˜¯å…¨è¡¨éåŽ†, é‚£æ•´ä¸ªåŠ è½½ä¸Žæ·˜æ±°çš„è¿‡ç¨‹å¤§æ¦‚çŽ‡å°±æ˜¯åœ¨ old åŒºè¿›è¡Œäº†, å¯¹çƒ­ç‚¹æ•°æ®å½±å“å°±å°äº†.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-31"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-31"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v('æœ¬èŠ‚ç”¨"å¤§æŸ¥è¯¢ä¼šä¸ä¼šæŠŠå†…å­˜ç”¨å…‰"è¿™ä¸ªé—®é¢˜, ä»‹ç»äº† MySQL çš„æŸ¥è¯¢ç»“æžœ, å‘é€ç»™å®¢æˆ·ç«¯çš„è¿‡ç¨‹.')]),s._v(" "),t("p",[t("strong",[s._v("ç”±äºŽ MySQL é‡‡ç”¨çš„æ˜¯è¾¹ç®—è¾¹å‘çš„é€»è¾‘, å› æ­¤å¯¹äºŽæ•°æ®é‡å¾ˆå¤§çš„æŸ¥è¯¢ç»“æžœæ¥è¯´, ä¸ä¼šåœ¨ server ç«¯ä¿å­˜å®Œæ•´çš„ç»“æžœé›†. æ‰€ä»¥å¦‚æžœå®¢æˆ·ç«¯è¯»ç»“æžœä¸åŠæ—¶, ä¼šå µä½ MySQL çš„æŸ¥è¯¢è¿‡ç¨‹, ä½†æ˜¯ä¸ä¼šæŠŠå†…å­˜æ‰“çˆ†.")])]),s._v(" "),t("p",[t("strong",[s._v("è€Œå¯¹äºŽ InnoDB å¼•æ“Žå†…éƒ¨, ç”±äºŽæœ‰æ·˜æ±°ç­–ç•¥, å¤§æŸ¥è¯¢ä¹Ÿä¸ä¼šå¯¼è‡´å†…å­˜æš´æ¶¨. å¹¶ä¸”, ç”±äºŽ InnoDB å¯¹ LRU ç®—æ³•åšäº†æ”¹è¿›, å†·æ•°æ®çš„å…¨è¡¨æ‰«æ, å¯¹ Buffer Pool çš„å½±å“ä¹Ÿèƒ½åšåˆ°å¯æŽ§")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶å‰é¢æœ‰è¯´è¿‡, å…¨è¡¨æ‰«æè¿˜æ˜¯æ¯”è¾ƒè€—è´¹ IO èµ„æºçš„, æ‰€ä»¥ä¸šåŠ¡é«˜å³°æœŸè¿˜æ˜¯ä¸èƒ½ç›´æŽ¥åœ¨çº¿ä¸Šä¸»åº“æ‰§è¡Œå…¨è¡¨æ‰«æçš„.")]),s._v(" "),t("h4",{attrs:{id:"_34-åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨join"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_34-åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨join"}},[s._v("#")]),s._v(" 34-åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨join?")]),s._v(" "),t("p",[s._v("åœ¨å®žé™…ç”Ÿäº§ä¸­, å…³äºŽ join è¯­å¥ä½¿ç”¨çš„é—®é¢˜, ä¸€èˆ¬ä¼šé›†ä¸­åœ¨ä»¥ä¸‹ä¸¤ç±»:")]),s._v(" "),t("ol",[t("li",[s._v("DBA ä¸è®©ä½¿ç”¨ join, ä½¿ç”¨ join æœ‰ä»€ä¹ˆé—®é¢˜å‘¢?")]),s._v(" "),t("li",[s._v("å¦‚æžœæœ‰ä¸¤ä¸ªå¤§å°ä¸åŒçš„è¡¨åš join, åº”è¯¥ç”¨å“ªä¸ªè¡¨åšé©±åŠ¨è¡¨å‘¢?")])]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å°±å…ˆè¯´è¯´ join è¯­å¥åˆ°åº•æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„, ç„¶åŽå†æ¥å›žç­”è¿™ä¸¤ä¸ªé—®é¢˜. ä¸ºäº†ä¾¿äºŽé‡åŒ–åˆ†æž, è¿˜æ˜¯åˆ›å»ºä¸¤ä¸ªè¡¨ t1 å’Œ t2 æ¥å’Œä½ è¯´æ˜Ž.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("è¿™ä¸¤ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼• id å’Œä¸€ä¸ªç´¢å¼• a, å­—æ®µ b ä¸Šæ— ç´¢å¼•")]),s._v(". å­˜å‚¨è¿‡ç¨‹ idata() å¾€è¡¨ t2 é‡Œæ’å…¥äº† 1000 è¡Œæ•°æ®, åœ¨è¡¨ t1 é‡Œæ’å…¥çš„æ˜¯ 100 è¡Œæ•°æ®.")]),s._v(" "),t("h5",{attrs:{id:"index-nested-loop-join"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#index-nested-loop-join"}},[s._v("#")]),s._v(" Index Nested-Loop Join")]),s._v(" "),t("p",[s._v("æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 straight_join t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æžœç›´æŽ¥ä½¿ç”¨ join è¯­å¥, MySQL ä¼˜åŒ–å™¨å¯èƒ½ä¼šé€‰æ‹©è¡¨ t1 æˆ– t2 ä½œä¸ºé©±åŠ¨è¡¨, è¿™æ ·ä¼šå½±å“åˆ†æž SQL è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹. æ‰€ä»¥ä¸ºäº†ä¾¿äºŽåˆ†æžæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ€§èƒ½é—®é¢˜, æ”¹ç”¨ straight_join è®© MySQL ä½¿ç”¨"),t("strong",[s._v("å›ºå®šçš„è¿žæŽ¥æ–¹å¼")]),s._v("æ‰§è¡ŒæŸ¥è¯¢, è¿™æ ·ä¼˜åŒ–å™¨åªä¼šæŒ‰ç…§æŒ‡å®šçš„æ–¹å¼åŽ» join. åœ¨è¿™ä¸ªè¯­å¥é‡Œ, "),t("strong",[s._v("t1 æ˜¯é©±åŠ¨è¡¨, t2 æ˜¯è¢«é©±åŠ¨è¡¨")]),s._v(".")]),s._v(" "),t("p",[s._v("çŽ°åœ¨æ¥çœ‹ä¸€ä¸‹è¿™æ¡è¯­å¥çš„ explain ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c8d4e05e79cd8e7b7070f3b902734f9b-20230731161914-xytvxej.png",alt:"",title:"ä½¿ç”¨ç´¢å¼•å­—æ®µjoinçš„explainç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, åœ¨è¿™æ¡è¯­å¥é‡Œ, è¢«é©±åŠ¨è¡¨ t2 çš„å­—æ®µ a ä¸Šæœ‰ç´¢å¼•, join è¿‡ç¨‹ç”¨ä¸Šäº†è¿™ä¸ªç´¢å¼•, å› æ­¤è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("ä»Žè¡¨ t1 ä¸­è¯»å…¥ä¸€è¡Œæ•°æ® R;")]),s._v(" "),t("li",[s._v("ä»Žæ•°æ®è¡Œ R ä¸­, å–å‡º a å­—æ®µåˆ°è¡¨ t2 é‡ŒåŽ»æŸ¥æ‰¾;")]),s._v(" "),t("li",[s._v("å–å‡ºè¡¨ t2 ä¸­æ»¡è¶³æ¡ä»¶çš„è¡Œ, "),t("strong",[s._v("è·Ÿ R ç»„æˆä¸€è¡Œ, ä½œä¸ºç»“æžœé›†çš„ä¸€éƒ¨åˆ†")]),s._v(";")]),s._v(" "),t("li",[s._v("é‡å¤æ‰§è¡Œæ­¥éª¤ 1 åˆ° 3, ç›´åˆ°è¡¨ t1 çš„æœ«å°¾å¾ªçŽ¯ç»“æŸ.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹æ˜¯"),t("strong",[s._v("å…ˆéåŽ†è¡¨ t1")]),s._v(", ç„¶åŽæ ¹æ®ä»Žè¡¨ t1 ä¸­å–å‡ºçš„æ¯è¡Œæ•°æ®ä¸­çš„ a å€¼, åŽ»è¡¨ t2 ä¸­æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„è®°å½•. åœ¨å½¢å¼ä¸Š, è¿™ä¸ªè¿‡ç¨‹å°±è·Ÿå†™ç¨‹åºæ—¶çš„åµŒå¥—æŸ¥è¯¢ç±»ä¼¼, å¹¶ä¸”"),t("strong",[s._v("å¯ä»¥ç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•")]),s._v(', æ‰€ä»¥ç§°ä¹‹ä¸º "Index Nested-Loop Join", ç®€ç§° '),t("strong",[s._v("NLJ")]),s._v(".")]),s._v(" "),t("p",[s._v("å®ƒå¯¹åº”çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ffa6ab4acce62c9ecae7a71c14811a1c-20230731161914-44xf1fo.png",alt:"",title:"Index Nested-Loop Joinç®—æ³•çš„æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªæµç¨‹é‡Œ:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¯¹é©±åŠ¨è¡¨ t1 åšäº†å…¨è¡¨æ‰«æ")]),s._v(", è¿™ä¸ªè¿‡ç¨‹éœ€è¦æ‰«æ 100 è¡Œ;")]),s._v(" "),t("li",[s._v("è€Œå¯¹äºŽæ¯ä¸€è¡Œ R, æ ¹æ® a å­—æ®µåŽ»è¡¨ t2 æŸ¥æ‰¾, èµ°çš„æ˜¯æ ‘æœç´¢è¿‡ç¨‹. ç”±äºŽæž„é€ çš„æ•°æ®éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„, å› æ­¤æ¯æ¬¡çš„æœç´¢è¿‡ç¨‹éƒ½"),t("strong",[s._v("åªæ‰«æä¸€è¡Œ")]),s._v(", ä¹Ÿæ˜¯æ€»å…±æ‰«æ 100 è¡Œ;")]),s._v(" "),t("li",[s._v("æ‰€ä»¥æ•´ä¸ªæ‰§è¡Œæµç¨‹, æ€»æ‰«æè¡Œæ•°æ˜¯ 200.")])]),s._v(" "),t("p",[s._v("çŽ°åœ¨çŸ¥é“äº†è¿™ä¸ªè¿‡ç¨‹, å†è¯•ç€å›žç­”ä¸€ä¸‹æ–‡ç« å¼€å¤´çš„ä¸¤ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("å…ˆçœ‹ç¬¬ä¸€ä¸ªé—®é¢˜: **èƒ½ä¸èƒ½ä½¿ç”¨ join? ** å‡è®¾ä¸ä½¿ç”¨ join, é‚£å°±åªèƒ½ç”¨å•è¡¨æŸ¥è¯¢. çœ‹çœ‹ä¸Šé¢è¿™æ¡è¯­å¥çš„éœ€æ±‚, ç”¨å•è¡¨æŸ¥è¯¢æ€Žä¹ˆå®žçŽ°.")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("æ‰§è¡Œ "),t("code",[s._v("select * from t1")]),s._v("â€‹, æŸ¥å‡ºè¡¨ t1 çš„æ‰€æœ‰æ•°æ®, è¿™é‡Œæœ‰ 100 è¡Œ;")])]),s._v(" "),t("li",[t("p",[s._v("å¾ªçŽ¯éåŽ†è¿™ 100 è¡Œæ•°æ®:")]),s._v(" "),t("ul",[t("li",[s._v("ä»Žæ¯ä¸€è¡Œ R å–å‡ºå­—æ®µ a çš„å€¼ "),t("code",[s._v("$R.a")]),s._v("â€‹;")]),s._v(" "),t("li",[s._v("æ‰§è¡Œ "),t("code",[s._v("select * from t2 where a=$R.a")]),s._v("â€‹;")]),s._v(" "),t("li",[s._v("æŠŠè¿”å›žçš„ç»“æžœå’Œ R æž„æˆç»“æžœé›†çš„ä¸€è¡Œ.")])])])]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, åœ¨è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹, ä¹Ÿæ˜¯æ‰«æäº† 200 è¡Œ, ä½†æ˜¯"),t("strong",[s._v("æ€»å…±æ‰§è¡Œäº† 101 æ¡è¯­å¥")]),s._v(", æ¯”ç›´æŽ¥ join å¤šäº† 100 æ¬¡äº¤äº’. é™¤æ­¤ä¹‹å¤–, å®¢æˆ·ç«¯è¿˜è¦è‡ªå·±æ‹¼æŽ¥ SQL è¯­å¥å’Œç»“æžœ. æ˜¾ç„¶è¿™ä¹ˆåšè¿˜ä¸å¦‚ç›´æŽ¥ join å¥½.")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹çœ‹ç¬¬äºŒä¸ªé—®é¢˜: **æ€Žä¹ˆé€‰æ‹©é©±åŠ¨è¡¨? **")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ª join è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­, "),t("strong",[s._v("é©±åŠ¨è¡¨æ˜¯èµ°å…¨è¡¨æ‰«æ, è€Œè¢«é©±åŠ¨è¡¨æ˜¯èµ°æ ‘æœç´¢")]),s._v(".")]),s._v(" "),t("p",[s._v("å‡è®¾è¢«é©±åŠ¨è¡¨çš„è¡Œæ•°æ˜¯ M. æ¯æ¬¡åœ¨è¢«é©±åŠ¨è¡¨æŸ¥ä¸€è¡Œæ•°æ®, è¦å…ˆæœç´¢ç´¢å¼• a, å†æœç´¢ä¸»é”®ç´¢å¼•. æ¯æ¬¡æœç´¢ä¸€æ£µæ ‘è¿‘ä¼¼å¤æ‚åº¦æ˜¯ä»¥ 2 ä¸ºåº•çš„ M çš„å¯¹æ•°, è®°ä¸º "),t("code",[s._v("logâ‚‚M")]),s._v("â€‹, æ‰€ä»¥åœ¨è¢«é©±åŠ¨è¡¨ä¸ŠæŸ¥ä¸€è¡Œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ "),t("code",[s._v("2*logâ‚‚M")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("å‡è®¾é©±åŠ¨è¡¨çš„è¡Œæ•°æ˜¯ N, æ‰§è¡Œè¿‡ç¨‹å°±è¦æ‰«æé©±åŠ¨è¡¨ N è¡Œ, ç„¶åŽå¯¹äºŽæ¯ä¸€è¡Œ, åˆ°è¢«é©±åŠ¨è¡¨ä¸ŠåŒ¹é…ä¸€æ¬¡.")]),s._v(" "),t("p",[s._v("å› æ­¤æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹, è¿‘ä¼¼å¤æ‚åº¦æ˜¯ "),t("code",[s._v("N + N*2*logâ‚‚M")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("æ˜¾ç„¶, N å¯¹æ‰«æè¡Œæ•°çš„å½±å“æ›´å¤§, "),t("mark",[t("strong",[s._v("å› æ­¤åº”è¯¥è®©å°è¡¨æ¥åšé©±åŠ¨è¡¨")])]),s._v('. å¦‚æžœä½ æ²¡è§‰å¾—è¿™ä¸ªå½±å“æœ‰é‚£ä¹ˆ"æ˜¾ç„¶", å¯ä»¥è¿™ä¹ˆç†è§£: N æ‰©å¤§ 1000 å€çš„è¯, æ‰«æè¡Œæ•°å°±ä¼šæ‰©å¤§ 1000 å€; è€Œ M æ‰©å¤§ 1000 å€, æ‰«æè¡Œæ•°æ‰©å¤§ä¸åˆ° 10 å€.')]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œå°ç»“ä¸€ä¸‹, é€šè¿‡ä¸Šé¢çš„åˆ†æžå¾—åˆ°äº†ä¸¤ä¸ªç»“è®º:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä½¿ç”¨ join è¯­å¥, æ€§èƒ½æ¯”å¼ºè¡Œæ‹†æˆå¤šä¸ªå•è¡¨æ‰§è¡Œ SQL è¯­å¥çš„æ€§èƒ½è¦å¥½;")])]),s._v(" "),t("li",[t("strong",[s._v("å¦‚æžœä½¿ç”¨ join è¯­å¥çš„è¯, éœ€è¦è®©å°è¡¨åšé©±åŠ¨è¡¨.")])])]),s._v(" "),t("p",[s._v('ä½†éœ€è¦æ³¨æ„, è¿™ä¸ªç»“è®ºçš„å‰ææ˜¯ "'),t("strong",[s._v("å¯ä»¥ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•")]),s._v('".')]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹çœ‹"),t("strong",[s._v("è¢«é©±åŠ¨è¡¨ç”¨ä¸ä¸Šç´¢å¼•")]),s._v("çš„æƒ…å†µ.")]),s._v(" "),t("h5",{attrs:{id:"simple-nested-loop-join"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#simple-nested-loop-join"}},[s._v("#")]),s._v(" Simple Nested-Loop Join")]),s._v(" "),t("p",[s._v("çŽ°åœ¨, æŠŠ SQL è¯­å¥æ”¹æˆè¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 straight_join t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç”±äºŽè¡¨ t2 çš„å­—æ®µ b ä¸Šæ²¡æœ‰ç´¢å¼•, å› æ­¤å†ç”¨å‰é¢çš„æ‰§è¡Œæµç¨‹æ—¶, "),t("strong",[s._v("æ¯æ¬¡åˆ° t2 åŽ»åŒ¹é…çš„æ—¶å€™, å°±è¦åšä¸€æ¬¡å…¨è¡¨æ‰«æ")]),s._v('. å¯ä»¥å…ˆè®¾æƒ³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜, ç»§ç»­ä½¿ç”¨å‰é¢çš„ç®—æ³•, æ˜¯ä¸æ˜¯å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æžœå‘¢? å¦‚æžœåªçœ‹ç»“æžœçš„è¯, è¿™ä¸ªç®—æ³•æ˜¯æ­£ç¡®çš„, è€Œä¸”è¿™ä¸ªç®—æ³•ä¹Ÿæœ‰ä¸€ä¸ªåå­—, å«åš "Simple Nested-Loop Join".')]),s._v(" "),t("p",[s._v("ä½†æ˜¯è¿™æ ·ç®—æ¥, "),t("strong",[s._v("è¿™ä¸ª SQL è¯·æ±‚å°±è¦æ‰«æè¡¨ t2 å¤šè¾¾ 100 æ¬¡, æ€»å…±æ‰«æ 100*1000=10 ä¸‡è¡Œ")]),s._v('. è¿™è¿˜åªæ˜¯ä¸¤ä¸ªå°è¡¨, å¦‚æžœ t1 å’Œ t2 éƒ½æ˜¯ 10 ä¸‡è¡Œçš„è¡¨(å½“ç„¶è¿™ä¹Ÿè¿˜æ˜¯å±žäºŽå°è¡¨çš„èŒƒå›´), å°±è¦æ‰«æ 100 äº¿è¡Œ, è¿™ä¸ªç®—æ³•çœ‹ä¸ŠåŽ»å¤ª"ç¬¨é‡"äº†.')]),s._v(" "),t("p",[s._v("å½“ç„¶, MySQL ä¹Ÿæ²¡æœ‰ä½¿ç”¨è¿™ä¸ª Simple Nested-Loop Join ç®—æ³•, è€Œæ˜¯ä½¿ç”¨äº†å¦ä¸€ä¸ªå«ä½œ  "),t("strong",[s._v('"Block Nested-Loop Join" çš„ç®—æ³•, ç®€ç§° BNL')]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"block-nested-loop-join"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#block-nested-loop-join"}},[s._v("#")]),s._v(" Block Nested-Loop Join")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™, "),t("mark",[t("strong",[s._v("è¢«é©±åŠ¨è¡¨ä¸Šæ²¡æœ‰å¯ç”¨çš„ç´¢å¼•")])]),s._v(", ç®—æ³•çš„æµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("æŠŠè¡¨ t1 çš„æ•°æ®è¯»å…¥çº¿ç¨‹å†…å­˜ join_buffer ä¸­")]),s._v(", ç”±äºŽè¿™ä¸ªè¯­å¥ä¸­å†™çš„æ˜¯ "),t("code",[s._v("select *")]),s._v("â€‹, å› æ­¤æ˜¯æŠŠæ•´ä¸ªè¡¨ t1 æ”¾å…¥äº†å†…å­˜;")]),s._v(" "),t("li",[s._v("æ‰«æè¡¨ t2, æŠŠè¡¨ t2 ä¸­çš„æ¯ä¸€è¡Œå–å‡ºæ¥, è·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”, æ»¡è¶³ join æ¡ä»¶çš„, ä½œä¸ºç»“æžœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ž.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹çš„æµç¨‹å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/49eeb550550f5a1e45cb6c43a04fd4ed-20230731161914-mzqlmw8.png",alt:"",title:"Block Nested-Loop Joinç®—æ³•çš„æ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("å¯¹åº”åœ°, è¿™æ¡ SQL è¯­å¥çš„ explain ç»“æžœå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3500d98a3cefe79fc257b3fe00b0ee3f-20230731161914-9kwaeu5.png",alt:"",title:"ä¸ä½¿ç”¨ç´¢å¼•å­—æ®µjoinçš„explainç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, "),t("strong",[s._v("å¯¹è¡¨ t1 å’Œ t2 éƒ½åšäº†ä¸€æ¬¡å…¨è¡¨æ‰«æ, å› æ­¤æ€»çš„æ‰«æè¡Œæ•°æ˜¯ 1100")]),s._v(". ç”±äºŽ join_buffer æ˜¯ä»¥æ— åºæ•°ç»„çš„æ–¹å¼ç»„ç»‡çš„, å› æ­¤å¯¹è¡¨ t2 ä¸­çš„æ¯ä¸€è¡Œ, éƒ½è¦åš 100 æ¬¡åˆ¤æ–­, æ€»å…±éœ€è¦"),t("strong",[s._v("åœ¨å†…å­˜ä¸­åšçš„åˆ¤æ–­æ¬¡æ•°")]),s._v("æ˜¯: 100*1000=10 ä¸‡æ¬¡.")]),s._v(" "),t("p",[s._v("å‰é¢è¯´è¿‡, å¦‚æžœä½¿ç”¨ Simple Nested-Loop Join ç®—æ³•è¿›è¡ŒæŸ¥è¯¢, æ‰«æè¡Œæ•°ä¹Ÿæ˜¯ 10 ä¸‡è¡Œ. å› æ­¤, ä»Žæ—¶é—´å¤æ‚åº¦ä¸Šæ¥è¯´, è¿™ä¸¤ä¸ªç®—æ³•æ˜¯ä¸€æ ·çš„. ä½†æ˜¯ Block Nested-Loop Join ç®—æ³•çš„è¿™ 10 ä¸‡æ¬¡åˆ¤æ–­æ˜¯"),t("strong",[s._v("å†…å­˜æ“ä½œ")]),s._v(", é€Ÿåº¦ä¸Šä¼šå¿«å¾ˆå¤š, æ€§èƒ½ä¹Ÿæ›´å¥½.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥çœ‹ä¸€ä¸‹, åœ¨è¿™ç§æƒ…å†µä¸‹, åº”è¯¥"),t("strong",[s._v("é€‰æ‹©å“ªä¸ªè¡¨åšé©±åŠ¨è¡¨")]),s._v(".")]),s._v(" "),t("p",[s._v("å‡è®¾å°è¡¨çš„è¡Œæ•°æ˜¯ N, å¤§è¡¨çš„è¡Œæ•°æ˜¯ M, é‚£ä¹ˆåœ¨è¿™ä¸ªç®—æ³•é‡Œ:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸¤ä¸ªè¡¨éƒ½åšä¸€æ¬¡å…¨è¡¨æ‰«æ, æ‰€ä»¥æ€»çš„æ‰«æè¡Œæ•°æ˜¯ M+N;")]),s._v(" "),t("li",[s._v("å†…å­˜ä¸­çš„åˆ¤æ–­æ¬¡æ•°æ˜¯ M*N.")])]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è°ƒæ¢è¿™ä¸¤ä¸ªç®—å¼ä¸­çš„ M å’Œ N æ²¡å·®åˆ«, å› æ­¤è¿™æ—¶å€™é€‰æ‹©å¤§è¡¨è¿˜æ˜¯å°è¡¨åšé©±åŠ¨è¡¨, æ‰§è¡Œè€—æ—¶æ˜¯ä¸€æ ·çš„.")]),s._v(" "),t("p",[s._v("ç„¶åŽ, ä½ å¯èƒ½é©¬ä¸Šå°±ä¼šé—®äº†, è¿™ä¸ªä¾‹å­é‡Œè¡¨ t1 æ‰ 100 è¡Œ, è¦æ˜¯è¡¨ t1 æ˜¯ä¸€ä¸ªå¤§è¡¨, "),t("strong",[s._v("join_buffer æ”¾ä¸ä¸‹")]),s._v("æ€Žä¹ˆåŠžå‘¢? join_buffer çš„å¤§å°æ˜¯ç”±å‚æ•° "),t("strong",[s._v("join_buffer_size")]),s._v(" è®¾å®šçš„, é»˜è®¤å€¼æ˜¯ 256k. **å¦‚æžœæ”¾ä¸ä¸‹è¡¨ t1 çš„æ‰€æœ‰æ•°æ®è¯, ç­–ç•¥å¾ˆç®€å•, å°±æ˜¯åˆ†æ®µæ”¾. ** æˆ‘æŠŠ join_buffer_size æ”¹æˆ 1200, å†æ‰§è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 straight_join t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ‰§è¡Œè¿‡ç¨‹å°±å˜æˆäº†:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰«æè¡¨ t1, é¡ºåºè¯»å–æ•°æ®è¡Œæ”¾å…¥ join_buffer ä¸­, æ”¾å®Œç¬¬ 88 è¡Œ "),t("strong",[s._v("join_buffer æ»¡äº†")]),s._v(", ç»§ç»­ç¬¬ 2 æ­¥;")]),s._v(" "),t("li",[s._v("æ‰«æè¡¨ t2, æŠŠ t2 ä¸­çš„æ¯ä¸€è¡Œå–å‡ºæ¥, è·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”, æ»¡è¶³ join æ¡ä»¶çš„, ä½œä¸ºç»“æžœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ž;")]),s._v(" "),t("li",[t("strong",[s._v("æ¸…ç©º join_buffer")]),s._v(";")]),s._v(" "),t("li",[s._v("ç»§ç»­æ‰«æè¡¨ t1, é¡ºåºè¯»å–æœ€åŽçš„ 12 è¡Œæ•°æ®æ”¾å…¥ join_buffer ä¸­, ç»§ç»­æ‰§è¡Œç¬¬ 2 æ­¥.")])]),s._v(" "),t("p",[s._v("æ‰§è¡Œæµç¨‹å›¾ä¹Ÿå°±å˜æˆè¿™æ ·:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1f4577281551f8559bb9a0d992c84b2e-20230731161914-5v4a9o8.png",alt:"",title:"Block Nested-Loop Join-ä¸¤æ®µ"}})]),s._v(" "),t("p",[s._v('å›¾ä¸­çš„æ­¥éª¤ 4 å’Œ 5, è¡¨ç¤ºæ¸…ç©º join_buffer å†å¤ç”¨. è¿™ä¸ªæµç¨‹æ‰ä½“çŽ°å‡ºäº†è¿™ä¸ªç®—æ³•åå­—ä¸­ "Block" çš„ç”±æ¥, è¡¨ç¤º "åˆ†å—åŽ» join".')]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, *"),t("em",[s._v("è¿™æ—¶å€™ç”±äºŽè¡¨ t1 è¢«åˆ†æˆäº†ä¸¤æ¬¡æ”¾å…¥ join_buffer ä¸­, å¯¼è‡´è¡¨ t2 ä¼šè¢«æ‰«æä¸¤æ¬¡. è™½ç„¶åˆ†æˆä¸¤æ¬¡æ”¾å…¥ join_buffer, ä½†æ˜¯åˆ¤æ–­ç­‰å€¼æ¡ä»¶çš„æ¬¡æ•°è¿˜æ˜¯ä¸å˜çš„, ä¾ç„¶æ˜¯ (88+12)"),t("em",[s._v("1000=10 ä¸‡æ¬¡")])]),s._v(".")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹ä¸‹, åœ¨è¿™ç§æƒ…å†µä¸‹é©±åŠ¨è¡¨çš„é€‰æ‹©é—®é¢˜.")]),s._v(" "),t("p",[s._v("å‡è®¾, é©±åŠ¨è¡¨çš„æ•°æ®è¡Œæ•°æ˜¯ N, éœ€è¦åˆ† K æ®µæ‰èƒ½å®Œæˆç®—æ³•æµç¨‹, è¢«é©±åŠ¨è¡¨çš„æ•°æ®è¡Œæ•°æ˜¯ M.")]),s._v(" "),t("p",[s._v("æ³¨æ„, è¿™é‡Œçš„ K ä¸æ˜¯å¸¸æ•°, N è¶Šå¤§ K å°±ä¼šè¶Šå¤§, å› æ­¤æŠŠ K è¡¨ç¤ºä¸ºÎ»*N, æ˜¾ç„¶Î»çš„å–å€¼èŒƒå›´æ˜¯ (0,1).")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, åœ¨è¿™ä¸ªç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰«æè¡Œæ•°æ˜¯ N+Î»*N*M;")]),s._v(" "),t("li",[s._v("å†…å­˜åˆ¤æ–­ N*M æ¬¡.")])]),s._v(" "),t("p",[s._v("æ˜¾ç„¶, å†…å­˜åˆ¤æ–­æ¬¡æ•°æ˜¯ä¸å—é€‰æ‹©å“ªä¸ªè¡¨ä½œä¸ºé©±åŠ¨è¡¨å½±å“çš„. è€Œè€ƒè™‘åˆ°æ‰«æè¡Œæ•°, åœ¨ M å’Œ N å¤§å°ç¡®å®šçš„æƒ…å†µä¸‹, N å°ä¸€äº›, æ•´ä¸ªç®—å¼çš„ç»“æžœä¼šæ›´å°.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ç»“è®ºæ˜¯, "),t("strong",[s._v("åº”è¯¥è®©å°è¡¨å½“é©±åŠ¨è¡¨")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶, ä½ ä¼šå‘çŽ°, åœ¨ N+Î»*N*M è¿™ä¸ªå¼å­é‡Œ, Î» æ‰æ˜¯å½±å“æ‰«æè¡Œæ•°çš„å…³é”®å› ç´ , è¿™ä¸ªå€¼è¶Šå°è¶Šå¥½. åˆšåˆšè¯´äº† N è¶Šå¤§, åˆ†æ®µæ•° K è¶Šå¤§. é‚£ä¹ˆ, N å›ºå®šçš„æ—¶å€™, ä»€ä¹ˆå‚æ•°ä¼šå½±å“ K çš„å¤§å°å‘¢? (ä¹Ÿå°±æ˜¯ Î» çš„å¤§å°)ç­”æ¡ˆæ˜¯ join_buffer_size. "),t("strong",[s._v("join_buffer_size è¶Šå¤§, ä¸€æ¬¡å¯ä»¥æ”¾å…¥çš„è¡Œè¶Šå¤š, åˆ†æˆçš„æ®µæ•°ä¹Ÿå°±è¶Šå°‘, å¯¹è¢«é©±åŠ¨è¡¨çš„å…¨è¡¨æ‰«ææ¬¡æ•°å°±è¶Šå°‘")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ, å¯èƒ½ä¼šçœ‹åˆ°ä¸€äº›å»ºè®®å‘Šè¯‰ä½ , "),t("strong",[s._v("å¦‚æžœ join è¯­å¥å¾ˆæ…¢, å°±æŠŠ join_buffer_size æ”¹å¤§")]),s._v(".")]),s._v(" "),t("p",[s._v("ç†è§£äº† MySQL æ‰§è¡Œ join çš„ä¸¤ç§ç®—æ³•, çŽ°åœ¨å†æ¥è¯•ç€"),t("strong",[s._v("å›žç­”å¼€å¤´çš„ä¸¤ä¸ªé—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ä¸ªé—®é¢˜: èƒ½ä¸èƒ½ä½¿ç”¨ join è¯­å¥?")]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v("å¦‚æžœå¯ä»¥ä½¿ç”¨ Index Nested-Loop Join ç®—æ³•, ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨ä¸Šè¢«é©±åŠ¨è¡¨ä¸Šçš„ç´¢å¼•, å…¶å®žæ˜¯æ²¡é—®é¢˜çš„;")])])]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("å¦‚æžœä½¿ç”¨ Block Nested-Loop Join ç®—æ³•, æ‰«æè¡Œæ•°å°±ä¼šè¿‡å¤š. å°¤å…¶æ˜¯åœ¨å¤§è¡¨ä¸Šçš„ join æ“ä½œ, è¿™æ ·å¯èƒ½è¦æ‰«æè¢«é©±åŠ¨è¡¨å¾ˆå¤šæ¬¡, ä¼šå ç”¨å¤§é‡çš„ç³»ç»Ÿèµ„æº. æ‰€ä»¥è¿™ç§ join å°½é‡ä¸è¦ç”¨.")])])])]),s._v(" "),t("p",[s._v("æ‰€ä»¥åœ¨"),t("mark",[t("strong",[s._v('åˆ¤æ–­è¦ä¸è¦ä½¿ç”¨ join è¯­å¥æ—¶, å°±æ˜¯çœ‹ explain ç»“æžœé‡Œé¢, Extra å­—æ®µé‡Œé¢æœ‰æ²¡æœ‰å‡ºçŽ° "Block Nested Loop" å­—æ ·')])]),s._v(".")]),s._v(" "),t("p",[s._v("ç¬¬äºŒä¸ªé—®é¢˜æ˜¯: å¦‚æžœè¦ä½¿ç”¨ join, åº”è¯¥é€‰æ‹©å¤§è¡¨åšé©±åŠ¨è¡¨è¿˜æ˜¯é€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨?")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœæ˜¯ Index Nested-Loop Join ç®—æ³•, åº”è¯¥é€‰æ‹©"),t("strong",[s._v("å°è¡¨åšé©±åŠ¨è¡¨")]),s._v(";")]),s._v(" "),t("li",[s._v("å¦‚æžœæ˜¯ Block Nested-Loop Join ç®—æ³•: (1) åœ¨ join_buffer_size è¶³å¤Ÿå¤§çš„æ—¶å€™, æ˜¯ä¸€æ ·çš„; (2) åœ¨ join_buffer_size ä¸å¤Ÿå¤§çš„æ—¶å€™(è¿™ç§æƒ…å†µæ›´å¸¸è§), åº”è¯¥é€‰æ‹©"),t("strong",[s._v("å°è¡¨åšé©±åŠ¨è¡¨")]),s._v(".")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¿™ä¸ªé—®é¢˜çš„ç»“è®ºå°±æ˜¯, "),t("mark",[t("strong",[s._v("æ€»æ˜¯åº”è¯¥ä½¿ç”¨å°è¡¨åšé©±åŠ¨è¡¨")])]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶è¿™é‡Œéœ€è¦è¯´æ˜Žä¸‹, "),t("strong",[s._v('ä»€ä¹ˆå«ä½œ"å°è¡¨"')]),s._v(" . å‰é¢çš„ä¾‹å­æ˜¯æ²¡æœ‰åŠ æ¡ä»¶çš„. å¦‚æžœè¯­å¥çš„ where æ¡ä»¶åŠ ä¸Š "),t("code",[s._v("t2.id<=50")]),s._v("â€‹ è¿™ä¸ªé™å®šæ¡ä»¶, å†æ¥çœ‹ä¸‹è¿™ä¸¤æ¡è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 straight_join t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t2 straight_join t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("æ³¨æ„, ä¸ºäº†è®©ä¸¤æ¡è¯­å¥çš„è¢«é©±åŠ¨è¡¨éƒ½ç”¨ä¸ä¸Šç´¢å¼•, æ‰€ä»¥ join å­—æ®µéƒ½ä½¿ç”¨äº†æ²¡æœ‰ç´¢å¼•çš„å­—æ®µ b.")]),s._v(" "),t("p",[s._v('ä½†å¦‚æžœæ˜¯ç”¨ç¬¬äºŒä¸ªè¯­å¥çš„è¯, join_buffer åªéœ€è¦æ”¾å…¥ t2 çš„å‰ 50 è¡Œ, æ˜¾ç„¶æ˜¯æ›´å¥½çš„. æ‰€ä»¥è¿™é‡Œ, "t2 çš„å‰ 50 è¡Œ" æ˜¯é‚£ä¸ª'),t("strong",[s._v('ç›¸å¯¹å°çš„è¡¨, ä¹Ÿå°±æ˜¯"å°è¡¨"')]),s._v(" .")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹å¦å¤–ä¸€ç»„ä¾‹å­:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  t1  straight_join t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  t2  straight_join t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™ä¸ªä¾‹å­é‡Œ, è¡¨ t1 å’Œ t2 éƒ½æ˜¯åªæœ‰ 100 è¡Œå‚åŠ  join. ä½†æ˜¯è¿™ä¸¤æ¡è¯­å¥æ¯æ¬¡æŸ¥è¯¢æ”¾å…¥ join_buffer ä¸­çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„:")]),s._v(" "),t("ul",[t("li",[s._v("è¡¨ t1 åªæŸ¥å­—æ®µ b, å› æ­¤å¦‚æžœæŠŠ t1 æ”¾åˆ° join_buffer ä¸­, åˆ™ join_buffer ä¸­åªéœ€è¦æ”¾å…¥ b çš„å€¼;")]),s._v(" "),t("li",[s._v("è¡¨ t2 éœ€è¦æŸ¥æ‰€æœ‰çš„å­—æ®µ, å› æ­¤å¦‚æžœæŠŠè¡¨ t2 æ”¾åˆ° join_buffer ä¸­çš„è¯, å°±éœ€è¦æ”¾å…¥ä¸‰ä¸ªå­—æ®µ id, a å’Œ b.")])]),s._v(" "),t("p",[s._v('è¿™é‡Œåº”è¯¥é€‰æ‹©è¡¨ t1 ä½œä¸ºé©±åŠ¨è¡¨. ä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ä¸ªä¾‹å­é‡Œ, "åªéœ€è¦ä¸€åˆ—å‚ä¸Ž join çš„è¡¨ t1" æ˜¯é‚£ä¸ª'),t("strong",[s._v("ç›¸å¯¹å°çš„è¡¨")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥æ›´å‡†ç¡®åœ°è¯´, "),t("mark",[t("strong",[s._v('åœ¨å†³å®šå“ªä¸ªè¡¨åšé©±åŠ¨è¡¨çš„æ—¶å€™, åº”è¯¥æ˜¯ä¸¤ä¸ªè¡¨æŒ‰ç…§å„è‡ªçš„æ¡ä»¶è¿‡æ»¤, è¿‡æ»¤å®Œæˆä¹‹åŽ, è®¡ç®—å‚ä¸Ž join çš„å„ä¸ªå­—æ®µçš„æ€»æ•°æ®é‡, æ•°æ®é‡å°çš„é‚£ä¸ªè¡¨, å°±æ˜¯"å°è¡¨", åº”è¯¥ä½œä¸ºé©±åŠ¨è¡¨')])]),s._v("â€‹ **. **")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-32"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-32"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[t("strong",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL æ‰§è¡Œ join è¯­å¥çš„ä¸¤ç§å¯èƒ½ç®—æ³•, è¿™ä¸¤ç§ç®—æ³•æ˜¯ç”±èƒ½å¦ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•å†³å®šçš„. è€Œèƒ½å¦ç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•, å¯¹ join è¯­å¥çš„æ€§èƒ½å½±å“å¾ˆå¤§.")])]),s._v(" "),t("p",[s._v("é€šè¿‡å¯¹ Index Nested-Loop Join å’Œ Block Nested-Loop Join ä¸¤ä¸ªç®—æ³•æ‰§è¡Œè¿‡ç¨‹çš„åˆ†æž, ä¹Ÿå¾—åˆ°äº†æ–‡ç« å¼€å¤´ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆ:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¦‚æžœå¯ä»¥ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•, join è¯­å¥è¿˜æ˜¯æœ‰å…¶ä¼˜åŠ¿çš„")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("ä¸èƒ½ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•, åªèƒ½ä½¿ç”¨ Block Nested-Loop Join ç®—æ³•, è¿™æ ·çš„è¯­å¥å°±å°½é‡ä¸è¦ä½¿ç”¨")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("åœ¨ä½¿ç”¨ join çš„æ—¶å€™, åº”è¯¥è®©å°è¡¨åšé©±åŠ¨è¡¨")]),s._v(".")])]),s._v(" "),t("h4",{attrs:{id:"_35-joinè¯­å¥æ€Žä¹ˆä¼˜åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_35-joinè¯­å¥æ€Žä¹ˆä¼˜åŒ–"}},[s._v("#")]),s._v(" 35-joinè¯­å¥æ€Žä¹ˆä¼˜åŒ–?")]),s._v(" "),t("p",[s._v("å‰ä¸€èŠ‚ä»‹ç»äº† join è¯­å¥çš„ä¸¤ç§ç®—æ³•, åˆ†åˆ«æ˜¯ "),t("strong",[s._v("Index Nested-Loop Join(NLJ) å’Œ Block Nested-Loop Join(BNL)")]),s._v(" . æˆ‘ä»¬å‘çŽ°åœ¨ä½¿ç”¨ NLJ ç®—æ³•çš„æ—¶å€™, å…¶å®ž"),t("strong",[s._v("æ•ˆæžœè¿˜æ˜¯ä¸é”™")]),s._v("çš„, æ¯”é€šè¿‡åº”ç”¨å±‚æ‹†åˆ†æˆå¤šä¸ªè¯­å¥ç„¶åŽå†æ‹¼æŽ¥æŸ¥è¯¢ç»“æžœæ›´æ–¹ä¾¿, è€Œä¸”æ€§èƒ½ä¹Ÿä¸ä¼šå·®.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯ BNL ç®—æ³•åœ¨å¤§è¡¨ join çš„æ—¶å€™æ€§èƒ½å°±å·®å¤šäº†, æ¯”è¾ƒæ¬¡æ•°ç­‰äºŽä¸¤ä¸ªè¡¨å‚ä¸Ž join çš„è¡Œæ•°çš„ä¹˜ç§¯, å¾ˆæ¶ˆè€— CPU èµ„æº.")]),s._v(" "),t("p",[s._v("å½“ç„¶äº†, è¿™ä¸¤ä¸ªç®—æ³•éƒ½è¿˜æœ‰ç»§ç»­ä¼˜åŒ–çš„ç©ºé—´, ä»Šå¤©å°±æ¥èŠèŠè¿™ä¸ªè¯é¢˜.")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽåˆ†æž, è¿˜æ˜¯åˆ›å»ºä¸¤ä¸ªè¡¨ t1, t2 æ¥å±•å¼€ä»Šå¤©çš„é—®é¢˜.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("ä¸ºäº†ä¾¿äºŽåŽé¢é‡åŒ–è¯´æ˜Ž, åœ¨è¡¨ t1 é‡Œ, æ’å…¥äº† 1000 è¡Œæ•°æ®, æ¯ä¸€è¡Œçš„ "),t("code",[s._v("a=1001-id")]),s._v("â€‹ çš„å€¼. ä¹Ÿå°±æ˜¯è¯´, è¡¨ t1 ä¸­å­—æ®µ a æ˜¯é€†åºçš„. åŒæ—¶åœ¨è¡¨ t2 ä¸­æ’å…¥äº† 100 ä¸‡è¡Œæ•°æ®.")]),s._v(" "),t("h5",{attrs:{id:"multi-range-readä¼˜åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#multi-range-readä¼˜åŒ–"}},[s._v("#")]),s._v(" Multi-Range Readä¼˜åŒ–")]),s._v(" "),t("p",[s._v("åœ¨ä»‹ç» join è¯­å¥çš„ä¼˜åŒ–æ–¹æ¡ˆä¹‹å‰, æˆ‘è¦å…ˆä»‹ç»ä¸€ä¸ªçŸ¥è¯†ç‚¹, å³: "),t("strong",[s._v("Multi-Range Read ä¼˜åŒ– (MRR). è¿™ä¸ªä¼˜åŒ–çš„ä¸»è¦ç›®çš„æ˜¯å°½é‡ä½¿ç”¨é¡ºåºè¯»ç›˜")]),s._v(".")]),s._v(" "),t("p",[s._v('å‰é¢ä»‹ç» InnoDB çš„ç´¢å¼•ç»“æž„æ—¶, æåˆ°äº†"å›žè¡¨"çš„æ¦‚å¿µ. å›žè¡¨æ˜¯æŒ‡ InnoDB åœ¨æ™®é€šç´¢å¼• a ä¸ŠæŸ¥åˆ°ä¸»é”® id çš„å€¼åŽ, å†æ ¹æ®ä¸€ä¸ªä¸ªä¸»é”® id çš„å€¼åˆ°ä¸»é”®ç´¢å¼•ä¸ŠåŽ»æŸ¥æ•´è¡Œæ•°æ®çš„è¿‡ç¨‹. '),t("strong",[s._v("é‚£å›žè¡¨è¿‡ç¨‹æ˜¯ä¸€è¡Œè¡Œåœ°æŸ¥æ•°æ®, è¿˜æ˜¯æ‰¹é‡åœ°æŸ¥æ•°æ®")]),s._v("?")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹çœ‹è¿™ä¸ªé—®é¢˜. å‡è®¾æ‰§è¡Œè¿™ä¸ªè¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¸»é”®ç´¢å¼•æ˜¯ä¸€æ£µ B+ æ ‘, åœ¨è¿™æ£µæ ‘ä¸Š, æ¯æ¬¡åªèƒ½æ ¹æ®ä¸€ä¸ªä¸»é”® id æŸ¥åˆ°ä¸€è¡Œæ•°æ®. å› æ­¤, "),t("strong",[s._v("å›žè¡¨è‚¯å®šæ˜¯ä¸€è¡Œè¡Œæœç´¢ä¸»é”®ç´¢å¼•çš„")]),s._v(", åŸºæœ¬æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/75afafbe048cd02f3fb9aa4ddcdff9e1-20230731161914-18cm2mz.png",alt:"",title:"åŸºæœ¬å›žè¡¨æµç¨‹"}})]),s._v(" "),t("p",[s._v('å¦‚æžœéšç€ a çš„å€¼é€’å¢žé¡ºåºæŸ¥è¯¢çš„è¯, id çš„å€¼å°±å˜æˆéšæœºçš„, é‚£ä¹ˆå°±ä¼šå‡ºçŽ°éšæœºè®¿é—®, æ€§èƒ½ç›¸å¯¹è¾ƒå·®. è™½ç„¶"æŒ‰è¡ŒæŸ¥"è¿™ä¸ªæœºåˆ¶ä¸èƒ½æ”¹, ä½†æ˜¯'),t("strong",[s._v("è°ƒæ•´æŸ¥è¯¢çš„é¡ºåº")]),s._v(", è¿˜æ˜¯èƒ½å¤ŸåŠ é€Ÿçš„. **å› ä¸ºå¤§å¤šæ•°çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”®é€’å¢žé¡ºåºæ’å…¥å¾—åˆ°çš„, æ‰€ä»¥å¯ä»¥è®¤ä¸º, å¦‚æžœæŒ‰ç…§ä¸»é”®çš„é€’å¢žé¡ºåºæŸ¥è¯¢çš„è¯, å¯¹ç£ç›˜çš„è¯»æ¯”è¾ƒæŽ¥è¿‘é¡ºåºè¯», èƒ½å¤Ÿæå‡è¯»æ€§èƒ½. **")]),s._v(" "),t("p",[s._v("è¿™å°±æ˜¯ MRR ä¼˜åŒ–çš„è®¾è®¡æ€è·¯. æ­¤æ—¶è¯­å¥çš„æ‰§è¡Œæµç¨‹å˜æˆäº†è¿™æ ·:")]),s._v(" "),t("ol",[t("li",[s._v("æ ¹æ®ç´¢å¼• a, å®šä½åˆ°æ»¡è¶³æ¡ä»¶çš„è®°å½•, å°† id å€¼æ”¾å…¥ read_rnd_buffer ä¸­ ;")]),s._v(" "),t("li",[t("strong",[s._v("å°† read_rnd_buffer ä¸­çš„ id è¿›è¡Œé€’å¢žæŽ’åº")]),s._v(";")]),s._v(" "),t("li",[s._v("æŽ’åºåŽçš„ id æ•°ç»„, ä¾æ¬¡åˆ°ä¸»é”® id ç´¢å¼•ä¸­æŸ¥è®°å½•, å¹¶ä½œä¸ºç»“æžœè¿”å›ž.")])]),s._v(" "),t("p",[s._v("è¿™é‡Œ read_rnd_buffer çš„å¤§å°æ˜¯ç”± read_rnd_buffer_size å‚æ•°æŽ§åˆ¶çš„. å¦‚æžœæ­¥éª¤ 1 ä¸­, read_rnd_buffer æ”¾æ»¡äº†, å°±ä¼šå…ˆæ‰§è¡Œå®Œæ­¥éª¤ 2 å’Œ 3, ç„¶åŽæ¸…ç©º read_rnd_buffer. ä¹‹åŽç»§ç»­æ‰¾ç´¢å¼• a çš„ä¸‹ä¸ªè®°å½•, å¹¶ç»§ç»­å¾ªçŽ¯.")]),s._v(" "),t("p",[s._v("å¦å¤–éœ€è¦è¯´æ˜Žçš„æ˜¯, å¦‚æžœæƒ³è¦ç¨³å®šåœ°ä½¿ç”¨ MRR ä¼˜åŒ–çš„è¯, éœ€è¦è®¾ç½® "),t("code",[s._v('set optimizer_switch="mrr_cost_based=off"')]),s._v("â€‹. (å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•, æ˜¯çŽ°åœ¨çš„ä¼˜åŒ–å™¨ç­–ç•¥, åˆ¤æ–­æ¶ˆè€—çš„æ—¶å€™, ä¼šæ›´å€¾å‘äºŽä¸ä½¿ç”¨ MRR, æŠŠ mrr_cost_based è®¾ç½®ä¸º off, å°±æ˜¯å›ºå®šä½¿ç”¨ MRR äº†.)")]),s._v(" "),t("p",[s._v("ä¸‹é¢ä¸¤å¹…å›¾å°±æ˜¯ä½¿ç”¨äº† MRR ä¼˜åŒ–åŽçš„æ‰§è¡Œæµç¨‹å’Œ explain ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/9d3f11becf7476e0c896f78a0a4d5445-20230731161914-37cbzg7.png",alt:"",title:"MRRæ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/9dc6ebd48f826062337cb78565a9b281-20230731161914-2qeir5z.png",alt:"",title:"MRR æ‰§è¡Œæµç¨‹çš„explainç»“æžœ"}})]),s._v(" "),t("p",[s._v("ä»Žå›¾ 3 çš„ explain ç»“æžœä¸­, å¯ä»¥çœ‹åˆ° Extra å­—æ®µå¤šäº† "),t("strong",[s._v("Using MRR")]),s._v(", è¡¨ç¤ºçš„æ˜¯ç”¨ä¸Šäº† MRR ä¼˜åŒ–. è€Œä¸”ç”±äºŽåœ¨ read_rnd_buffer ä¸­æŒ‰ç…§ id åšäº†æŽ’åº, æ‰€ä»¥"),t("strong",[s._v("æœ€åŽå¾—åˆ°çš„ç»“æžœé›†ä¹Ÿæ˜¯æŒ‰ç…§ä¸»é”® id é€’å¢žé¡ºåºçš„")]),s._v(", ä¹Ÿå°±æ˜¯ä¸Žå›¾ 1 ç»“æžœé›†ä¸­è¡Œçš„é¡ºåºç›¸å.")]),s._v(" "),t("p",[s._v("å°ç»“ä¸€ä¸‹. "),t("strong",[s._v("MRR èƒ½å¤Ÿæå‡æ€§èƒ½çš„æ ¸å¿ƒ")]),s._v("åœ¨äºŽ, è¿™æ¡æŸ¥è¯¢è¯­å¥åœ¨ç´¢å¼• a ä¸Šåšçš„æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢(ä¹Ÿå°±æ˜¯è¯´, è¿™æ˜¯ä¸€ä¸ªå¤šå€¼æŸ¥è¯¢), å¯ä»¥å¾—åˆ°è¶³å¤Ÿå¤šçš„ä¸»é”® id. "),t("strong",[s._v('è¿™æ ·é€šè¿‡æŽ’åºä»¥åŽ, å†åŽ»ä¸»é”®ç´¢å¼•æŸ¥æ•°æ®, æ‰èƒ½ä½“çŽ°å‡º"é¡ºåºæ€§"çš„ä¼˜åŠ¿')]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"batched-key-access"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#batched-key-access"}},[s._v("#")]),s._v(" Batched Key Access")]),s._v(" "),t("p",[s._v("ç†è§£äº† MRR æ€§èƒ½æå‡çš„åŽŸç†, å°±èƒ½ç†è§£ MySQL åœ¨ 5.6 ç‰ˆæœ¬åŽå¼€å§‹å¼•å…¥çš„ "),t("strong",[s._v("Batched Key Access(BKA) ç®—æ³•")]),s._v("äº†. è¿™ä¸ª BKA ç®—æ³•, å…¶å®ž"),t("strong",[s._v("å°±æ˜¯å¯¹ NLJ ç®—æ³•çš„ä¼˜åŒ–")]),s._v(".")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹çœ‹ä¸Šä¸€èŠ‚ç”¨åˆ°çš„ NLJ ç®—æ³•çš„æµç¨‹å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/627324ead818f5fdc89d1651fc3ecb2c-20230731161914-txsr5qz.png",alt:"",title:"å›¾4 Index Nested-Loop Joinæµç¨‹å›¾"}})]),s._v(" "),t("p",[s._v("NLJ ç®—æ³•æ‰§è¡Œçš„é€»è¾‘æ˜¯: "),t("strong",[s._v("ä»Žé©±åŠ¨è¡¨ t1, ä¸€è¡Œè¡Œåœ°å–å‡º a çš„å€¼, å†åˆ°è¢«é©±åŠ¨è¡¨ t2 åŽ»åš join")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, å¯¹äºŽè¡¨ t2 æ¥è¯´, "),t("strong",[s._v("æ¯æ¬¡éƒ½æ˜¯åŒ¹é…ä¸€ä¸ªå€¼")]),s._v(". è¿™æ—¶ MRR çš„ä¼˜åŠ¿å°±ç”¨ä¸ä¸Šäº†.")]),s._v(" "),t("p",[s._v("é‚£æ€Žä¹ˆæ‰èƒ½ä¸€æ¬¡æ€§åœ°å¤šä¼ äº›å€¼ç»™è¡¨ t2 å‘¢? æ–¹æ³•å°±æ˜¯, "),t("strong",[s._v("ä»Žè¡¨ t1 é‡Œä¸€æ¬¡æ€§åœ°å¤šæ‹¿äº›è¡Œå‡ºæ¥, ä¸€èµ·ä¼ ç»™è¡¨ t")]),s._v("2. æ—¢ç„¶å¦‚æ­¤, å°±æŠŠè¡¨ t1 çš„æ•°æ®å–å‡ºæ¥ä¸€éƒ¨åˆ†, "),t("strong",[s._v("å…ˆæ”¾åˆ°ä¸€ä¸ªä¸´æ—¶å†…å­˜. è¿™ä¸ªä¸´æ—¶å†…å­˜ä¸æ˜¯åˆ«äºº, å°±æ˜¯ join_buffer")]),s._v(".")]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šä¸€èŠ‚, æˆ‘ä»¬çŸ¥é“ join_buffer åœ¨ BNL ç®—æ³•é‡Œçš„ä½œç”¨, æ˜¯"),t("strong",[s._v("æš‚å­˜é©±åŠ¨è¡¨")]),s._v("çš„æ•°æ®. ä½†æ˜¯åœ¨ NLJ ç®—æ³•é‡Œå¹¶æ²¡æœ‰ç”¨. é‚£ä¹ˆ"),t("strong",[s._v("åˆšå¥½å°±å¯ä»¥å¤ç”¨ join_buffer åˆ° BKA ç®—æ³•ä¸­")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚å›¾ 5 æ‰€ç¤º, æ˜¯ä¸Šé¢çš„ NLJ ç®—æ³•ä¼˜åŒ–åŽçš„ BKA ç®—æ³•çš„æµç¨‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c5a4ccabac842da3e7cecdf1e71b23ad-20230731161914-jjjjshi.png",alt:"",title:"å›¾5 Batched Key Accessæµç¨‹"}})]),s._v(" "),t("p",[s._v("å›¾ä¸­, åœ¨ join_buffer ä¸­æ”¾å…¥çš„æ•°æ®æ˜¯ P1-P100, è¡¨ç¤ºçš„æ˜¯åªä¼šå–æŸ¥è¯¢éœ€è¦çš„å­—æ®µ. å½“ç„¶å¦‚æžœ join buffer æ”¾ä¸ä¸‹ P1-P100 çš„æ‰€æœ‰æ•°æ®, å°±ä¼šæŠŠè¿™ 100 è¡Œæ•°æ®åˆ†æˆå¤šæ®µæ‰§è¡Œä¸Šå›¾çš„æµç¨‹.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, è¿™ä¸ª BKA ç®—æ³•åˆ°åº•è¦æ€Žä¹ˆå¯ç”¨å‘¢?")]),s._v(" "),t("p",[s._v("å¦‚æžœè¦ä½¿ç”¨ BKA ä¼˜åŒ–ç®—æ³•çš„è¯, éœ€è¦åœ¨æ‰§è¡Œ SQL è¯­å¥ä¹‹å‰, å…ˆè®¾ç½®")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" optimizer_switch"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mrr=on,mrr_cost_based=off,batched_key_access=on'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å…¶ä¸­, å‰ä¸¤ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯è¦å¯ç”¨ MRR. è¿™ä¹ˆåšçš„åŽŸå› æ˜¯, "),t("strong",[s._v("BKA ç®—æ³•çš„ä¼˜åŒ–è¦ä¾èµ–äºŽ MRR")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"bnlç®—æ³•çš„æ€§èƒ½é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bnlç®—æ³•çš„æ€§èƒ½é—®é¢˜"}},[s._v("#")]),s._v(" BNLç®—æ³•çš„æ€§èƒ½é—®é¢˜")]),s._v(" "),t("p",[s._v("è¯´å®Œäº† NLJ ç®—æ³•çš„ä¼˜åŒ–, å†æ¥çœ‹ BNL ç®—æ³•çš„ä¼˜åŒ–.")]),s._v(" "),t("p",[s._v("æ€è€ƒä¸€ä¸ªé—®é¢˜, ä½¿ç”¨ Block Nested-Loop Join(BNL) ç®—æ³•æ—¶, å¯èƒ½ä¼šå¯¹è¢«é©±åŠ¨è¡¨åšå¤šæ¬¡æ‰«æ. å¦‚æžœè¿™ä¸ªè¢«é©±åŠ¨è¡¨æ˜¯ä¸€ä¸ª"),t("strong",[s._v("å¤§çš„å†·æ•°æ®è¡¨")]),s._v(", é™¤äº†ä¼šå¯¼è‡´ IO åŽ‹åŠ›å¤§ä»¥å¤–, è¿˜ä¼šå¯¹ç³»ç»Ÿæœ‰ä»€ä¹ˆå½±å“å‘¢?")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç» InnoDB çš„ LRU ç®—æ³•çš„æ—¶å€™æåˆ°, ç”±äºŽ InnoDB å¯¹ Bufffer Pool çš„ LRU ç®—æ³•åšäº†ä¼˜åŒ–, å³: "),t("strong",[s._v("ç¬¬ä¸€æ¬¡ä»Žç£ç›˜è¯»å…¥å†…å­˜çš„æ•°æ®é¡µ, ä¼šå…ˆæ”¾åœ¨ old åŒºåŸŸ")]),s._v(". å¦‚æžœ 1 ç§’ä¹‹åŽè¿™ä¸ªæ•°æ®é¡µä¸å†è¢«è®¿é—®äº†, å°±ä¸ä¼šè¢«ç§»åŠ¨åˆ° LRU é“¾è¡¨å¤´éƒ¨, è¿™æ ·å¯¹ Buffer Pool çš„å‘½ä¸­çŽ‡å½±å“å°±ä¸å¤§. "),t("strong",[s._v("ä½†å¦‚æžœä¸€ä¸ªä½¿ç”¨ BNL ç®—æ³•çš„ join è¯­å¥, å¤šæ¬¡æ‰«æä¸€ä¸ªå†·è¡¨, è€Œä¸”è¿™ä¸ªè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡ 1 ç§’, å°±ä¼šåœ¨å†æ¬¡æ‰«æå†·è¡¨çš„æ—¶å€™, æŠŠå†·è¡¨çš„æ•°æ®é¡µç§»åˆ° LRU é“¾è¡¨å¤´éƒ¨")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ç§æƒ…å†µå¯¹åº”çš„, æ˜¯å†·è¡¨çš„æ•°æ®é‡å°äºŽæ•´ä¸ª Buffer Pool çš„ 3/8, èƒ½å¤Ÿå®Œå…¨æ”¾å…¥ old åŒºåŸŸçš„æƒ…å†µ. å¦‚æžœè¿™ä¸ªå†·è¡¨å¾ˆå¤§, å°±ä¼šå‡ºçŽ°å¦å¤–ä¸€ç§æƒ…å†µ: "),t("strong",[s._v("ä¸šåŠ¡æ­£å¸¸è®¿é—®çš„æ•°æ®é¡µ, æ²¡æœ‰æœºä¼šè¿›å…¥ young åŒºåŸŸ")]),s._v(". ç”±äºŽä¼˜åŒ–æœºåˆ¶çš„å­˜åœ¨, ä¸€ä¸ªæ­£å¸¸è®¿é—®çš„æ•°æ®é¡µ, è¦è¿›å…¥ young åŒºåŸŸ, éœ€è¦éš” 1 ç§’åŽå†æ¬¡è¢«è®¿é—®åˆ°. ä½†æ˜¯, ç”±äºŽ join è¯­å¥åœ¨å¾ªçŽ¯è¯»ç£ç›˜å’Œæ·˜æ±°å†…å­˜é¡µ, è¿›å…¥ old åŒºåŸŸçš„æ•°æ®é¡µ, å¾ˆå¯èƒ½åœ¨ 1 ç§’ä¹‹å†…å°±è¢«æ·˜æ±°äº†. "),t("strong",[s._v("è¿™æ ·å°±ä¼šå¯¼è‡´è¿™ä¸ª MySQL å®žä¾‹çš„ Buffer Pool åœ¨è¿™æ®µæ—¶é—´å†…, young åŒºåŸŸçš„æ•°æ®é¡µæ²¡æœ‰è¢«åˆç†åœ°æ·˜æ±°")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šå½±å“ Buffer Pool çš„æ­£å¸¸è¿ä½œ.")]),s._v(" "),t("p",[s._v("**å¤§è¡¨ join æ“ä½œè™½ç„¶å¯¹ IO æœ‰å½±å“, ä½†æ˜¯åœ¨è¯­å¥æ‰§è¡Œç»“æŸåŽ, å¯¹ IO çš„å½±å“ä¹Ÿå°±ç»“æŸäº†. ä½†æ˜¯å¯¹ Buffer Pool çš„å½±å“å°±æ˜¯æŒç»­æ€§çš„, éœ€è¦ä¾é åŽç»­çš„æŸ¥è¯¢è¯·æ±‚æ…¢æ…¢æ¢å¤å†…å­˜å‘½ä¸­çŽ‡. **")]),s._v(" "),t("p",[s._v("ä¸ºäº†å‡å°‘è¿™ç§å½±å“, "),t("strong",[s._v("å¯ä»¥è€ƒè™‘å¢žå¤§ join_buffer_size çš„å€¼, å‡å°‘å¯¹è¢«é©±åŠ¨è¡¨çš„æ‰«ææ¬¡æ•°")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, BNL ç®—æ³•å¯¹ç³»ç»Ÿçš„å½±å“ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢:")]),s._v(" "),t("ol",[t("li",[s._v("å¯èƒ½ä¼šå¤šæ¬¡æ‰«æè¢«é©±åŠ¨è¡¨, å ç”¨ç£ç›˜ IO èµ„æº;")]),s._v(" "),t("li",[s._v("åˆ¤æ–­ join æ¡ä»¶éœ€è¦æ‰§è¡Œ M*N æ¬¡å¯¹æ¯”(M, N åˆ†åˆ«æ˜¯ä¸¤å¼ è¡¨çš„è¡Œæ•°), å¦‚æžœæ˜¯å¤§è¡¨å°±ä¼šå ç”¨éžå¸¸å¤šçš„ CPU èµ„æº;")]),s._v(" "),t("li",[t("strong",[s._v("å¯èƒ½ä¼šå¯¼è‡´ Buffer Pool çš„çƒ­æ•°æ®è¢«æ·˜æ±°, å½±å“å†…å­˜å‘½ä¸­çŽ‡")]),s._v(".")])]),s._v(" "),t("p",[s._v("æˆ‘ä»¬æ‰§è¡Œè¯­å¥ä¹‹å‰, éœ€è¦é€šè¿‡ç†è®ºåˆ†æžå’ŒæŸ¥çœ‹ explain ç»“æžœçš„æ–¹å¼, "),t("strong",[s._v("ç¡®è®¤æ˜¯å¦è¦ä½¿ç”¨ BNL ç®—æ³•")]),s._v(". å¦‚æžœç¡®è®¤ä¼˜åŒ–å™¨ä¼šä½¿ç”¨ BNL ç®—æ³•, å°±éœ€è¦åšä¼˜åŒ–. ä¼˜åŒ–çš„å¸¸è§åšæ³•æ˜¯, "),t("strong",[s._v("ç»™è¢«é©±åŠ¨è¡¨çš„ join å­—æ®µåŠ ä¸Šç´¢å¼•, æŠŠ BNL ç®—æ³•è½¬æˆ BKA ç®—æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å°±å…·ä½“çœ‹çœ‹, è¿™ä¸ªä¼˜åŒ–æ€Žä¹ˆåš?")]),s._v(" "),t("h5",{attrs:{id:"bnlè½¬bka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bnlè½¬bka"}},[s._v("#")]),s._v(" BNLè½¬BKA")]),s._v(" "),t("p",[s._v("ä¸€äº›æƒ…å†µä¸‹, "),t("strong",[s._v("å¯ä»¥ç›´æŽ¥åœ¨è¢«é©±åŠ¨è¡¨ä¸Šå»ºç´¢å¼•, è¿™æ—¶å°±å¯ä»¥ç›´æŽ¥è½¬æˆ BKA ç®—æ³•")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯æœ‰æ—¶å€™ç¡®å®žä¼šç¢°åˆ°ä¸€äº›ä¸é€‚åˆåœ¨è¢«é©±åŠ¨è¡¨ä¸Šå»ºç´¢å¼•çš„æƒ…å†µ. æ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æœ¬èŠ‚å¼€å§‹çš„æ—¶å€™, åœ¨è¡¨ t2 ä¸­æ’å…¥äº† 100 ä¸‡è¡Œæ•°æ®, ä½†æ˜¯ç»è¿‡ where æ¡ä»¶è¿‡æ»¤åŽ, éœ€è¦å‚ä¸Ž join çš„åªæœ‰ 2000 è¡Œæ•°æ®. å¦‚æžœè¿™æ¡è¯­å¥åŒæ—¶æ˜¯ä¸€ä¸ªä½Žé¢‘çš„ SQL è¯­å¥, é‚£ä¹ˆå†ä¸ºè¿™ä¸ªè¯­å¥åœ¨è¡¨ t2 çš„å­—æ®µ b ä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•å°±å¾ˆæµªè´¹äº†.")]),s._v(" "),t("p",[s._v("ä½†å¦‚æžœä½¿ç”¨ BNL ç®—æ³•æ¥ join çš„è¯, è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("æŠŠè¡¨ t1 çš„æ‰€æœ‰å­—æ®µå–å‡ºæ¥, å­˜å…¥ join_buffer ä¸­. è¿™ä¸ªè¡¨åªæœ‰ 1000 è¡Œ, join_buffer_size é»˜è®¤å€¼æ˜¯ 256k, å¯ä»¥å®Œå…¨å­˜å…¥.")]),s._v(" "),t("li",[s._v("æ‰«æè¡¨ t2, å–å‡ºæ¯ä¸€è¡Œæ•°æ®è·Ÿ join_buffer ä¸­çš„æ•°æ®è¿›è¡Œå¯¹æ¯”, (1) å¦‚æžœä¸æ»¡è¶³ t1.b=t2.b, åˆ™è·³è¿‡; (2) å¦‚æžœæ»¡è¶³ t1.b=t2.b, å†åˆ¤æ–­å…¶ä»–æ¡ä»¶, ä¹Ÿå°±æ˜¯æ˜¯å¦æ»¡è¶³ t2.b å¤„äºŽ [1,2000] çš„æ¡ä»¶, å¦‚æžœæ˜¯, å°±ä½œä¸ºç»“æžœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ž, å¦åˆ™è·³è¿‡.")])]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚ä¸­è¯´è¿‡, "),t("strong",[s._v("å¯¹äºŽè¡¨ t2 çš„æ¯ä¸€è¡Œ, åˆ¤æ–­ join æ˜¯å¦æ»¡è¶³çš„æ—¶å€™, éƒ½éœ€è¦éåŽ† join_buffer ä¸­çš„æ‰€æœ‰è¡Œ")]),s._v(". å› æ­¤åˆ¤æ–­ç­‰å€¼æ¡ä»¶çš„æ¬¡æ•°æ˜¯ 1000*100 ä¸‡ =10 äº¿æ¬¡, è¿™ä¸ªåˆ¤æ–­çš„å·¥ä½œé‡å¾ˆå¤§.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5253746fe0a596a5ff98ebcec9f8f05e-20230731161914-56yhcgb.png",alt:"",title:"å›¾6 explainç»“æžœ"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c6f56795a1ceff274b08521f3482df73-20230731161914-4i51y96.png",alt:"",title:"å›¾7 è¯­å¥æ‰§è¡Œæ—¶é—´"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, explain ç»“æžœé‡Œ Extra å­—æ®µæ˜¾ç¤ºä½¿ç”¨äº† BNL ç®—æ³•. åœ¨æˆ‘çš„æµ‹è¯•çŽ¯å¢ƒé‡Œ, è¿™æ¡è¯­å¥éœ€è¦æ‰§è¡Œ 1 åˆ† 11 ç§’.")]),s._v(" "),t("p",[s._v("åœ¨è¡¨ t2 çš„å­—æ®µ b ä¸Šåˆ›å»ºç´¢å¼•ä¼šæµªè´¹èµ„æº, ä½†æ˜¯ä¸åˆ›å»ºç´¢å¼•çš„è¯è¿™ä¸ªè¯­å¥çš„ç­‰å€¼æ¡ä»¶è¦åˆ¤æ–­ 10 äº¿æ¬¡, æƒ³æƒ³ä¹Ÿæ˜¯æµªè´¹. é‚£æœ‰æ²¡æœ‰ä¸¤å…¨å…¶ç¾Žçš„åŠžæ³•å‘¢?")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™å¯ä»¥"),t("strong",[s._v("è€ƒè™‘ä½¿ç”¨ä¸´æ—¶è¡¨")]),s._v(". ä½¿ç”¨ä¸´æ—¶è¡¨çš„å¤§è‡´æ€è·¯æ˜¯:")]),s._v(" "),t("ol",[t("li",[s._v("æŠŠè¡¨ t2 ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®æ”¾åœ¨ä¸´æ—¶è¡¨ tmp_t ä¸­;")]),s._v(" "),t("li",[s._v("ä¸ºäº†è®© join ä½¿ç”¨ BKA ç®—æ³•, "),t("strong",[s._v("ç»™ä¸´æ—¶è¡¨ tmp_t çš„å­—æ®µ b åŠ ä¸Šç´¢å¼•")]),s._v(";")]),s._v(" "),t("li",[s._v("è®©è¡¨ t1 å’Œ tmp_t åš join æ“ä½œ.")])]),s._v(" "),t("p",[s._v("æ­¤æ—¶, å¯¹åº”çš„ SQL è¯­å¥çš„å†™æ³•å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temporary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å›¾ 8 å°±æ˜¯è¿™ä¸ªè¯­å¥åºåˆ—çš„æ‰§è¡Œæ•ˆæžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/02e9e919d362279f3430046522887752-20230731161914-m5fyghp.png",alt:"",title:"å›¾8 ä½¿ç”¨ä¸´æ—¶è¡¨çš„æ‰§è¡Œæ•ˆæžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, æ•´ä¸ªè¿‡ç¨‹ 3 ä¸ªè¯­å¥æ‰§è¡Œæ—¶é—´çš„æ€»å’Œè¿˜ä¸åˆ° 1 ç§’, ç›¸æ¯”äºŽå‰é¢çš„ 1 åˆ† 11 ç§’, æ€§èƒ½å¾—åˆ°äº†å¤§å¹…æå‡. æŽ¥ä¸‹æ¥, ä¸€èµ·çœ‹ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹çš„æ¶ˆè€—:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰§è¡Œ insert è¯­å¥æž„é€  temp_t è¡¨å¹¶æ’å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­, å¯¹è¡¨ t2 åšäº†å…¨è¡¨æ‰«æ, è¿™é‡Œæ‰«æè¡Œæ•°æ˜¯ 100 ä¸‡.")]),s._v(" "),t("li",[s._v("ä¹‹åŽçš„ join è¯­å¥, æ‰«æè¡¨ t1, è¿™é‡Œçš„æ‰«æè¡Œæ•°æ˜¯ 1000; join æ¯”è¾ƒè¿‡ç¨‹ä¸­, åšäº† 1000 æ¬¡å¸¦ç´¢å¼•çš„æŸ¥è¯¢. ç›¸æ¯”äºŽä¼˜åŒ–å‰çš„ join è¯­å¥éœ€è¦åš 10 äº¿æ¬¡æ¡ä»¶åˆ¤æ–­æ¥è¯´, è¿™ä¸ªä¼˜åŒ–æ•ˆæžœè¿˜æ˜¯å¾ˆæ˜Žæ˜¾çš„.")])]),s._v(" "),t("p",[s._v("æ€»ä½“æ¥çœ‹, "),t("strong",[s._v("ä¸è®ºæ˜¯åœ¨åŽŸè¡¨ä¸ŠåŠ ç´¢å¼•, è¿˜æ˜¯ç”¨æœ‰ç´¢å¼•çš„ä¸´æ—¶è¡¨, æ€è·¯éƒ½æ˜¯è®© join è¯­å¥èƒ½å¤Ÿç”¨ä¸Šè¢«é©±åŠ¨è¡¨ä¸Šçš„ç´¢å¼•, æ¥è§¦å‘ BKA ç®—æ³•, æå‡æŸ¥è¯¢æ€§èƒ½")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ‰©å±•-hash-join"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ‰©å±•-hash-join"}},[s._v("#")]),s._v(" æ‰©å±•-hash join")]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½å‘çŽ°äº†, å…¶å®žä¸Šé¢è®¡ç®— 10 äº¿æ¬¡é‚£ä¸ªæ“ä½œ, çœ‹ä¸ŠåŽ»æœ‰ç‚¹å„¿å‚». å¦‚æžœ join_buffer é‡Œé¢ç»´æŠ¤çš„ä¸æ˜¯ä¸€ä¸ªæ— åºæ•°ç»„, è€Œæ˜¯"),t("strong",[s._v("ä¸€ä¸ªå“ˆå¸Œè¡¨")]),s._v("çš„è¯, é‚£ä¹ˆå°±ä¸æ˜¯ 10 äº¿æ¬¡åˆ¤æ–­, è€Œæ˜¯ 100 ä¸‡æ¬¡ hash æŸ¥æ‰¾. è¿™æ ·çš„è¯, æ•´æ¡è¯­å¥çš„æ‰§è¡Œé€Ÿåº¦å°±å¿«å¤šäº†å§?")]),s._v(" "),t("p",[s._v("ç¡®å®žå¦‚æ­¤. è¿™ä¹Ÿæ­£æ˜¯ MySQL çš„ä¼˜åŒ–å™¨å’Œæ‰§è¡Œå™¨ä¸€ç›´è¢«è¯Ÿç—…çš„ä¸€ä¸ªåŽŸå› : "),t("strong",[s._v("ä¸æ”¯æŒå“ˆå¸Œ join")]),s._v(". å¹¶ä¸” MySQL å®˜æ–¹çš„ roadmap, ä¹Ÿæ˜¯è¿Ÿè¿Ÿæ²¡æœ‰æŠŠè¿™ä¸ªä¼˜åŒ–æŽ’ä¸Šè®®ç¨‹.")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, è¿™ä¸ªä¼˜åŒ–æ€è·¯, å¯ä»¥è‡ªå·±å®žçŽ°åœ¨ä¸šåŠ¡ç«¯. å®žçŽ°æµç¨‹å¤§è‡´å¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("â€‹"),t("code",[s._v("select * from t1;")]),s._v("â€‹ å–å¾—è¡¨ t1 çš„å…¨éƒ¨ 1000 è¡Œæ•°æ®, åœ¨ä¸šåŠ¡ç«¯å­˜å…¥ä¸€ä¸ª hash ç»“æž„.")]),s._v(" "),t("li",[t("code",[s._v("select * from t2 where b>=1 and b<=2000;")]),s._v(" èŽ·å–è¡¨ t2 ä¸­æ»¡è¶³æ¡ä»¶çš„ 2000 è¡Œæ•°æ®.")]),s._v(" "),t("li",[s._v("æŠŠè¿™ 2000 è¡Œæ•°æ®, ä¸€è¡Œä¸€è¡Œåœ°å–åˆ°ä¸šåŠ¡ç«¯, åˆ° hash ç»“æž„çš„æ•°æ®è¡¨ä¸­å¯»æ‰¾åŒ¹é…çš„æ•°æ®. æ»¡è¶³åŒ¹é…çš„æ¡ä»¶çš„è¿™è¡Œæ•°æ®, å°±ä½œä¸ºç»“æžœé›†çš„ä¸€è¡Œ.")])]),s._v(" "),t("p",[s._v("ç†è®ºä¸Š, è¿™ä¸ªè¿‡ç¨‹ä¼šæ¯”ä¸´æ—¶è¡¨æ–¹æ¡ˆçš„æ‰§è¡Œé€Ÿåº¦è¿˜è¦å¿«ä¸€äº›.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-33"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-33"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚åˆ†äº«äº† "),t("code",[s._v("Index Nested-Loop Join(NLJ) å’Œ Block Nested-Loop Join(BNL)çš„ä¼˜åŒ–æ–¹æ³•")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("åœ¨è¿™äº›ä¼˜åŒ–æ–¹æ³•ä¸­:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("BKA ä¼˜åŒ–æ˜¯ MySQL å·²ç»å†…ç½®æ”¯æŒçš„, å»ºè®®ä½ é»˜è®¤ä½¿ç”¨")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("BNL ç®—æ³•æ•ˆçŽ‡ä½Ž, å»ºè®®éƒ½å°½é‡è½¬æˆ BKA ç®—æ³•. ä¼˜åŒ–çš„æ–¹å‘å°±æ˜¯ç»™è¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µåŠ ä¸Šç´¢å¼•")]),s._v(";")]),s._v(" "),t("li",[s._v("åŸºäºŽä¸´æ—¶è¡¨çš„æ”¹è¿›æ–¹æ¡ˆ, å¯¹äºŽèƒ½å¤Ÿæå‰è¿‡æ»¤å‡ºå°æ•°æ®çš„ join è¯­å¥æ¥è¯´, æ•ˆæžœè¿˜æ˜¯å¾ˆå¥½çš„;")]),s._v(" "),t("li",[s._v("MySQL ç›®å‰çš„ç‰ˆæœ¬è¿˜ä¸æ”¯æŒ hash join, ä½†ä½ å¯ä»¥é…åˆåº”ç”¨ç«¯è‡ªå·±æ¨¡æ‹Ÿå‡ºæ¥, ç†è®ºä¸Šæ•ˆæžœè¦å¥½äºŽä¸´æ—¶è¡¨çš„æ–¹æ¡ˆ.")])]),s._v(" "),t("h4",{attrs:{id:"_36-ä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡å"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_36-ä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡å"}},[s._v("#")]),s._v(" 36-ä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡å?")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šä¸€èŠ‚, æˆ‘ä»¬åœ¨ä¼˜åŒ– join æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨åˆ°äº†ä¸´æ—¶è¡¨. å½“æ—¶æ˜¯è¿™ä¹ˆç”¨çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temporary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("ä½ å¯èƒ½ä¼šæœ‰ç–‘é—®, ä¸ºä»€ä¹ˆè¦ç”¨ä¸´æ—¶è¡¨å‘¢? ç›´æŽ¥ç”¨æ™®é€šè¡¨æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å‘¢? ä»Šå¤©å°±ä»Žè¿™ä¸ªé—®é¢˜è¯´èµ·: "),t("strong",[s._v("ä¸´æ—¶è¡¨æœ‰å“ªäº›ç‰¹å¾, ä¸ºä»€ä¹ˆå®ƒé€‚åˆè¿™ä¸ªåœºæ™¯")]),s._v("?")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦å…ˆåŽ˜æ¸…ä¸€ä¸ªå®¹æ˜“è¯¯è§£çš„é—®é¢˜: æœ‰çš„äººå¯èƒ½ä¼šè®¤ä¸º, ä¸´æ—¶è¡¨å°±æ˜¯å†…å­˜è¡¨. ä½†è¿™ä¸¤ä¸ªæ¦‚å¿µå¯æ˜¯å®Œå…¨ä¸åŒçš„.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å†…å­˜è¡¨, æŒ‡çš„æ˜¯ä½¿ç”¨ Memory å¼•æ“Žçš„è¡¨")]),s._v(", å»ºè¡¨è¯­æ³•æ˜¯ "),t("code",[s._v("create table ... engine=memory")]),s._v('â€‹. è¿™ç§è¡¨çš„æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜é‡Œ, ç³»ç»Ÿé‡å¯çš„æ—¶å€™ä¼šè¢«æ¸…ç©º, ä½†æ˜¯è¡¨ç»“æž„è¿˜åœ¨. é™¤äº†è¿™ä¸¤ä¸ªç‰¹æ€§çœ‹ä¸ŠåŽ»æ¯”è¾ƒ"å¥‡æ€ª"å¤–, ä»Žå…¶ä»–çš„ç‰¹å¾ä¸Šçœ‹, å®ƒå°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„è¡¨.')]),s._v(" "),t("li",[t("strong",[s._v("è€Œä¸´æ—¶è¡¨, å¯ä»¥ä½¿ç”¨å„ç§å¼•æ“Žç±»åž‹")]),s._v(". å¦‚æžœæ˜¯ä½¿ç”¨ InnoDB å¼•æ“Žæˆ–è€… MyISAM å¼•æ“Žçš„ä¸´æ—¶è¡¨, "),t("strong",[s._v("å†™æ•°æ®çš„æ—¶å€™æ˜¯å†™åˆ°ç£ç›˜ä¸Šçš„")]),s._v(". å½“ç„¶ä¸´æ—¶è¡¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Memory å¼•æ“Ž.")])]),s._v(" "),t("p",[s._v("å¼„æ¸…æ¥šäº†å†…å­˜è¡¨å’Œä¸´æ—¶è¡¨çš„åŒºåˆ«ä»¥åŽ, å†æ¥çœ‹çœ‹ä¸´æ—¶è¡¨æœ‰å“ªäº›ç‰¹å¾.")]),s._v(" "),t("h5",{attrs:{id:"ä¸´æ—¶è¡¨çš„ç‰¹æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸´æ—¶è¡¨çš„ç‰¹æ€§"}},[s._v("#")]),s._v(" ä¸´æ—¶è¡¨çš„ç‰¹æ€§")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽç†è§£, æ¥çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªæ“ä½œåºåˆ—:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a237bac17459aef4a182113f736dff4c-20230731161914-kpaautp.png",alt:"",title:"å›¾1 ä¸´æ—¶è¡¨ç‰¹æ€§ç¤ºä¾‹"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ä¸´æ—¶è¡¨åœ¨ä½¿ç”¨ä¸Šæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹:")]),s._v(" "),t("ol",[t("li",[s._v("å»ºè¡¨è¯­æ³•æ˜¯ "),t("code",[s._v("create temporary table ...")]),s._v("â€‹.")]),s._v(" "),t("li",[t("strong",[s._v("ä¸€ä¸ªä¸´æ—¶è¡¨åªèƒ½è¢«åˆ›å»ºå®ƒçš„ session è®¿é—®, å¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§")]),s._v(". æ‰€ä»¥, å›¾ä¸­ session A åˆ›å»ºçš„ä¸´æ—¶è¡¨ t, å¯¹äºŽ session B å°±æ˜¯ä¸å¯è§çš„.")]),s._v(" "),t("li",[t("strong",[s._v("ä¸´æ—¶è¡¨å¯ä»¥ä¸Žæ™®é€šè¡¨åŒå")]),s._v(".")]),s._v(" "),t("li",[s._v("session A å†…æœ‰åŒåçš„ä¸´æ—¶è¡¨å’Œæ™®é€šè¡¨çš„æ—¶å€™, show create è¯­å¥, ä»¥åŠå¢žåˆ æ”¹æŸ¥è¯­å¥è®¿é—®çš„æ˜¯ä¸´æ—¶è¡¨.")]),s._v(" "),t("li",[s._v("show tables å‘½ä»¤ä¸æ˜¾ç¤ºä¸´æ—¶è¡¨.")])]),s._v(" "),t("p",[s._v("ç”±äºŽä¸´æ—¶è¡¨åªèƒ½è¢«åˆ›å»ºå®ƒçš„ session è®¿é—®, æ‰€ä»¥åœ¨è¿™ä¸ª session ç»“æŸçš„æ—¶å€™, "),t("strong",[s._v("ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶è¡¨")]),s._v(". ä¹Ÿæ­£æ˜¯ç”±äºŽè¿™ä¸ªç‰¹æ€§, "),t("strong",[s._v("ä¸´æ—¶è¡¨å°±ç‰¹åˆ«é€‚åˆä¹‹å‰çš„ join ä¼˜åŒ–è¿™ç§åœºæ™¯")]),s._v(". ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("åŽŸå› ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä¸åŒ session çš„ä¸´æ—¶è¡¨æ˜¯å¯ä»¥é‡åçš„, å¦‚æžœæœ‰å¤šä¸ª session åŒæ—¶æ‰§è¡Œ join ä¼˜åŒ–, ä¸éœ€è¦æ‹…å¿ƒè¡¨åé‡å¤å¯¼è‡´å»ºè¡¨å¤±è´¥çš„é—®é¢˜.")])]),s._v(" "),t("li",[t("strong",[s._v("ä¸éœ€è¦æ‹…å¿ƒæ•°æ®åˆ é™¤é—®é¢˜")]),s._v(". å¦‚æžœä½¿ç”¨æ™®é€šè¡¨, åœ¨æµç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­å®¢æˆ·ç«¯å‘ç”Ÿäº†å¼‚å¸¸æ–­å¼€, æˆ–è€…æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯, è¿˜éœ€è¦ä¸“é—¨æ¥æ¸…ç†ä¸­é—´è¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ•°æ®è¡¨. è€Œä¸´æ—¶è¡¨ç”±äºŽä¼šè‡ªåŠ¨å›žæ”¶, æ‰€ä»¥ä¸éœ€è¦è¿™ä¸ªé¢å¤–çš„æ“ä½œ.")])]),s._v(" "),t("h5",{attrs:{id:"ä¸´æ—¶è¡¨çš„åº”ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸´æ—¶è¡¨çš„åº”ç”¨"}},[s._v("#")]),s._v(" ä¸´æ—¶è¡¨çš„åº”ç”¨")]),s._v(" "),t("p",[s._v("ç”±äºŽä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¹‹é—´çš„é‡åå†²çª, "),t("strong",[s._v("ä¸´æ—¶è¡¨ç»å¸¸ä¼šè¢«ç”¨åœ¨å¤æ‚æŸ¥è¯¢çš„ä¼˜åŒ–è¿‡ç¨‹")]),s._v("ä¸­. å…¶ä¸­, åˆ†åº“åˆ†è¡¨ç³»ç»Ÿçš„"),t("strong",[s._v("è·¨åº“æŸ¥è¯¢")]),s._v("å°±æ˜¯ä¸€ä¸ªå…¸åž‹çš„ä½¿ç”¨åœºæ™¯.")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬åˆ†åº“åˆ†è¡¨çš„åœºæ™¯, å°±æ˜¯è¦æŠŠä¸€ä¸ªé€»è¾‘ä¸Šçš„å¤§è¡¨åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“å®žä¾‹ä¸Š. æ¯”å¦‚å°†ä¸€ä¸ªå¤§è¡¨ ht, æŒ‰ç…§å­—æ®µ f, æ‹†åˆ†æˆ 1024 ä¸ªåˆ†è¡¨, ç„¶åŽåˆ†å¸ƒåˆ° 32 ä¸ªæ•°æ®åº“å®žä¾‹ä¸Š. å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/65ea2bc0535a8d5f23ef4442e4e19cc9-20230731161914-2fzbrmt.png",alt:"",title:"å›¾2 åˆ†åº“åˆ†è¡¨ç®€å›¾"}})]),s._v(" "),t("p",[s._v("ä¸€èˆ¬æƒ…å†µä¸‹, è¿™ç§åˆ†åº“åˆ†è¡¨ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ª"),t("strong",[s._v("ä¸­é—´å±‚ proxy")]),s._v(". ä¸è¿‡ä¹Ÿæœ‰ä¸€äº›æ–¹æ¡ˆä¼šè®©å®¢æˆ·ç«¯ç›´æŽ¥è¿žæŽ¥æ•°æ®åº“, ä¹Ÿå°±æ˜¯æ²¡æœ‰ proxy è¿™ä¸€å±‚.")]),s._v(" "),t("p",[s._v('åœ¨è¿™ä¸ªæž¶æž„ä¸­, åˆ†åŒº key çš„é€‰æ‹©æ˜¯ä»¥ "å‡å°‘è·¨åº“å’Œè·¨è¡¨æŸ¥è¯¢" ä¸ºä¾æ®çš„. å¦‚æžœå¤§éƒ¨åˆ†çš„è¯­å¥éƒ½ä¼šåŒ…å« f çš„ç­‰å€¼æ¡ä»¶, é‚£ä¹ˆå°±è¦ç”¨ f åšåˆ†åŒºé”®. è¿™æ ·åœ¨ proxy è¿™ä¸€å±‚è§£æžå®Œ SQL è¯­å¥ä»¥åŽ, å°±èƒ½ç¡®å®šå°†è¿™æ¡è¯­å¥è·¯ç”±åˆ°å“ªä¸ªåˆ†è¡¨åšæŸ¥è¯¢.')]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸‹é¢è¿™æ¡è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" v "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" ht "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("N"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ—¶å°±å¯ä»¥é€šè¿‡åˆ†è¡¨è§„åˆ™(æ¯”å¦‚, N%1024) æ¥ç¡®è®¤éœ€è¦çš„æ•°æ®è¢«æ”¾åœ¨äº†å“ªä¸ªåˆ†è¡¨ä¸Š. è¿™ç§è¯­å¥åªéœ€è¦è®¿é—®ä¸€ä¸ªåˆ†è¡¨, æ˜¯åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆæœ€æ¬¢è¿Žçš„è¯­å¥å½¢å¼äº†.")]),s._v(" "),t("p",[s._v("ä½†å¦‚æžœè¿™ä¸ªè¡¨ä¸Šè¿˜æœ‰å¦å¤–ä¸€ä¸ªç´¢å¼• k, å¹¶ä¸”æŸ¥è¯¢è¯­å¥æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" v "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" ht "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" k "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" M "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" t_modified "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ—¶å€™, ç”±äºŽæŸ¥è¯¢æ¡ä»¶é‡Œé¢æ²¡æœ‰ç”¨åˆ°åˆ†åŒºå­—æ®µ f, åªèƒ½åˆ°æ‰€æœ‰çš„åˆ†åŒºä¸­åŽ»æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œ, ç„¶åŽç»Ÿä¸€åš order by çš„æ“ä½œ. è¿™ç§æƒ…å†µä¸‹, æœ‰ä¸¤ç§æ¯”è¾ƒå¸¸ç”¨çš„æ€è·¯.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬ä¸€ç§æ€è·¯æ˜¯, åœ¨ proxy å±‚çš„è¿›ç¨‹ä»£ç ä¸­å®žçŽ°æŽ’åº")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ç§æ–¹å¼çš„ä¼˜åŠ¿æ˜¯å¤„ç†é€Ÿåº¦å¿«, æ‹¿åˆ°åˆ†åº“çš„æ•°æ®ä»¥åŽ, ç›´æŽ¥åœ¨å†…å­˜ä¸­å‚ä¸Žè®¡ç®—. ä¸è¿‡è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜Žæ˜¾:")]),s._v(" "),t("ol",[t("li",[s._v("éœ€è¦çš„å¼€å‘å·¥ä½œé‡æ¯”è¾ƒå¤§. ä¸¾ä¾‹çš„è¿™æ¡è¯­å¥è¿˜ç®—æ˜¯æ¯”è¾ƒç®€å•çš„, å¦‚æžœæ¶‰åŠåˆ°å¤æ‚çš„æ“ä½œ, æ¯”å¦‚ group by, ç”šè‡³ join è¿™æ ·çš„æ“ä½œ, å¯¹ä¸­é—´å±‚çš„å¼€å‘èƒ½åŠ›è¦æ±‚æ¯”è¾ƒé«˜;")]),s._v(" "),t("li",[s._v("å¯¹ proxy ç«¯çš„"),t("strong",[s._v("åŽ‹åŠ›æ¯”è¾ƒå¤§")]),s._v(", å°¤å…¶æ˜¯å¾ˆå®¹æ˜“å‡ºçŽ°å†…å­˜ä¸å¤Ÿç”¨å’Œ CPU ç“¶é¢ˆçš„é—®é¢˜.")])]),s._v(" "),t("p",[t("strong",[s._v("å¦ä¸€ç§æ€è·¯å°±æ˜¯, æŠŠå„ä¸ªåˆ†åº“æ‹¿åˆ°çš„æ•°æ®, æ±‡æ€»åˆ°ä¸€ä¸ª MySQL å®žä¾‹çš„ä¸€ä¸ªè¡¨ä¸­, ç„¶åŽåœ¨è¿™ä¸ªæ±‡æ€»å®žä¾‹ä¸Šåšé€»è¾‘æ“ä½œ")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸Šé¢è¿™æ¡è¯­å¥, æ‰§è¡Œæµç¨‹å¯ä»¥ç±»ä¼¼è¿™æ ·:")]),s._v(" "),t("ul",[t("li",[s._v("åœ¨æ±‡æ€»åº“ä¸Šåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ temp_ht, è¡¨é‡ŒåŒ…å«ä¸‰ä¸ªå­—æ®µ v, k, t_modified;")]),s._v(" "),t("li",[s._v("åœ¨å„ä¸ªåˆ†åº“ä¸Šæ‰§è¡Œ â€‹"),t("code",[s._v("select v,k,t_modified from ht_x where k >= M order by t_modified desc limit 100;")]),s._v("â€‹")]),s._v(" "),t("li",[s._v("æŠŠåˆ†åº“æ‰§è¡Œçš„"),t("strong",[s._v("ç»“æžœæ’å…¥åˆ° temp_ht è¡¨")]),s._v("ä¸­;")]),s._v(" "),t("li",[s._v("æ‰§è¡Œ "),t("code",[s._v("select v from temp_ht order by t_modified desc limit 100;")]),s._v("â€‹ å¾—åˆ°ç»“æžœ.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹å¯¹åº”çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3dd7d3f2185183d65619968ada3c59a1-20230731161914-0ya24hl.png",alt:"",title:"å›¾3 è·¨åº“æŸ¥è¯¢æµç¨‹ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("**åœ¨å®žè·µä¸­, å¾€å¾€ä¼šå‘çŽ°æ¯ä¸ªåˆ†åº“çš„è®¡ç®—é‡éƒ½ä¸é¥±å’Œ, æ‰€ä»¥ä¼šç›´æŽ¥æŠŠä¸´æ—¶è¡¨ temp_ht æ”¾åˆ° 32 ä¸ªåˆ†åº“ä¸­çš„æŸä¸€ä¸ªä¸Š. ** è¿™æ—¶çš„æŸ¥è¯¢é€»è¾‘ä¸Žå›¾ 3 ç±»ä¼¼, å¯ä»¥è‡ªå·±å†æ€è€ƒä¸€ä¸‹å…·ä½“çš„æµç¨‹.")]),s._v(" "),t("h5",{attrs:{id:"ä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡å"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡å"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡å?")]),s._v(" "),t("p",[s._v("ä¸åŒçº¿ç¨‹å¯ä»¥åˆ›å»ºåŒåçš„ä¸´æ—¶è¡¨, è¿™æ˜¯æ€Žä¹ˆåšåˆ°çš„å‘¢? æŽ¥ä¸‹æ¥å°±çœ‹ä¸€ä¸‹è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬åœ¨æ‰§è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temporary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¯­å¥çš„æ—¶å€™, MySQL è¦ç»™è¿™ä¸ª InnoDB è¡¨"),t("strong",[s._v("åˆ›å»ºä¸€ä¸ª frm æ–‡ä»¶ä¿å­˜è¡¨ç»“æž„å®šä¹‰")]),s._v(', è¿˜è¦æœ‰åœ°æ–¹ä¿å­˜è¡¨æ•°æ®. **è¿™ä¸ª frm æ–‡ä»¶æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹, æ–‡ä»¶åçš„åŽç¼€æ˜¯ .frm, ** å‰ç¼€æ˜¯ "'),t("code",[s._v("#sql{è¿›ç¨‹ id}{çº¿ç¨‹ id} åºåˆ—å·")]),s._v('â€‹". å¯ä»¥ä½¿ç”¨ '),t("code",[s._v("select @@tmpdir")]),s._v("â€‹ å‘½ä»¤, æ¥æ˜¾ç¤ºå®žä¾‹çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•.")]),s._v(" "),t("p",[s._v("è€Œå…³äºŽè¡¨ä¸­æ•°æ®çš„å­˜æ”¾æ–¹å¼, åœ¨ä¸åŒçš„ MySQL ç‰ˆæœ¬ä¸­æœ‰ç€ä¸åŒçš„å¤„ç†æ–¹å¼:")]),s._v(" "),t("ul",[t("li",[s._v("åœ¨ 5.6 ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬é‡Œ, MySQL ä¼šåœ¨ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç›¸åŒå‰ç¼€, ä»¥ .ibd ä¸ºåŽç¼€çš„æ–‡ä»¶, ç”¨æ¥å­˜æ”¾æ•°æ®æ–‡ä»¶;")]),s._v(" "),t("li",[s._v("è€Œä»Ž 5.7 ç‰ˆæœ¬å¼€å§‹, MySQL å¼•å…¥äº†ä¸€ä¸ª"),t("strong",[s._v("ä¸´æ—¶æ–‡ä»¶è¡¨ç©ºé—´")]),s._v(", ä¸“é—¨ç”¨æ¥å­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„æ•°æ®. å› æ­¤å°±ä¸éœ€è¦å†åˆ›å»º ibd æ–‡ä»¶äº†.")])]),s._v(" "),t("p",[s._v("ä»Žæ–‡ä»¶åçš„å‰ç¼€è§„åˆ™, å¯ä»¥çœ‹åˆ°, å…¶å®žåˆ›å»ºä¸€ä¸ªå«ä½œ t1 çš„ InnoDB ä¸´æ—¶è¡¨, MySQL åœ¨å­˜å‚¨ä¸Šè®¤ä¸ºæˆ‘ä»¬åˆ›å»ºçš„è¡¨åè·Ÿæ™®é€šè¡¨ t1 æ˜¯ä¸åŒçš„, å› æ­¤åŒä¸€ä¸ªåº“ä¸‹é¢å·²ç»æœ‰æ™®é€šè¡¨ t1 çš„æƒ…å†µä¸‹, è¿˜æ˜¯å¯ä»¥å†åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ t1 çš„.")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽåŽé¢è®¨è®º, å…ˆæ¥ä¸¾ä¸€ä¸ªä¾‹å­.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/157bcd31ea4c38257bb36816228daee2-20230731161914-fz0yuym.png",alt:"",title:"å›¾4 ä¸´æ—¶è¡¨çš„è¡¨å"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·æ˜¯ 1234, session A çš„çº¿ç¨‹ id æ˜¯ 4, session B çš„çº¿ç¨‹ id æ˜¯ 5. æ‰€ä»¥ä½ çœ‹åˆ°äº†, session A å’Œ session B åˆ›å»ºçš„ä¸´æ—¶è¡¨, åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ä¸ä¼šé‡å.")]),s._v(" "),t("p",[s._v("MySQL ç»´æŠ¤æ•°æ®è¡¨, é™¤äº†ç‰©ç†ä¸Šè¦æœ‰æ–‡ä»¶å¤–, å†…å­˜é‡Œé¢ä¹Ÿæœ‰ä¸€å¥—æœºåˆ¶åŒºåˆ«ä¸åŒçš„è¡¨, æ¯ä¸ªè¡¨éƒ½å¯¹åº”ä¸€ä¸ª table_def_key.")]),s._v(" "),t("ul",[t("li",[s._v('ä¸€ä¸ªæ™®é€šè¡¨çš„ table_def_key çš„å€¼æ˜¯ç”± "åº“å + è¡¨å" å¾—åˆ°çš„, æ‰€ä»¥å¦‚æžœè¦åœ¨åŒä¸€ä¸ªåº“ä¸‹åˆ›å»ºä¸¤ä¸ªåŒåçš„æ™®é€šè¡¨, åˆ›å»ºç¬¬äºŒä¸ªè¡¨çš„è¿‡ç¨‹ä¸­å°±ä¼šå‘çŽ° table_def_key å·²ç»å­˜åœ¨äº†.')]),s._v(" "),t("li",[s._v('è€Œå¯¹äºŽä¸´æ—¶è¡¨, table_def_key åœ¨ "åº“å + è¡¨å" åŸºç¡€ä¸Š, åˆåŠ å…¥äº† "server_id + thread_id".')])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("session A å’Œ sessionB åˆ›å»ºçš„ä¸¤ä¸ªä¸´æ—¶è¡¨ t1, å®ƒä»¬çš„ table_def_key ä¸åŒ, ç£ç›˜æ–‡ä»¶åä¹Ÿä¸åŒ, å› æ­¤å¯ä»¥å¹¶å­˜")]),s._v(".")]),s._v(" "),t("p",[s._v('åœ¨å®žçŽ°ä¸Š, æ¯ä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤äº†è‡ªå·±çš„ä¸´æ—¶è¡¨é“¾è¡¨. è¿™æ ·æ¯æ¬¡ session å†…æ“ä½œè¡¨çš„æ—¶å€™, å…ˆéåŽ†é“¾è¡¨, æ£€æŸ¥æ˜¯å¦æœ‰è¿™ä¸ªåå­—çš„ä¸´æ—¶è¡¨, å¦‚æžœæœ‰å°±ä¼˜å…ˆæ“ä½œä¸´æ—¶è¡¨, å¦‚æžœæ²¡æœ‰å†æ“ä½œæ™®é€šè¡¨; åœ¨ session ç»“æŸçš„æ—¶å€™, å¯¹é“¾è¡¨é‡Œçš„æ¯ä¸ªä¸´æ—¶è¡¨, æ‰§è¡Œ "DROP TEMPORARY TABLE + è¡¨å" æ“ä½œ.')]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™ä½ ä¼šå‘çŽ°, binlog ä¸­ä¹Ÿè®°å½•äº† DROP TEMPORARY TABLE è¿™æ¡å‘½ä»¤. ä½ ä¸€å®šä¼šè§‰å¾—å¥‡æ€ª, ä¸´æ—¶è¡¨åªåœ¨çº¿ç¨‹å†…è‡ªå·±å¯ä»¥è®¿é—®, ä¸ºä»€ä¹ˆéœ€è¦å†™åˆ° binlog é‡Œé¢?")]),s._v(" "),t("p",[s._v("è¿™å°±éœ€è¦è¯´åˆ°"),t("strong",[s._v("ä¸»å¤‡å¤åˆ¶")]),s._v("äº†.")]),s._v(" "),t("h5",{attrs:{id:"ä¸´æ—¶è¡¨å’Œä¸»å¤‡å¤åˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸´æ—¶è¡¨å’Œä¸»å¤‡å¤åˆ¶"}},[s._v("#")]),s._v(" ä¸´æ—¶è¡¨å’Œä¸»å¤‡å¤åˆ¶")]),s._v(" "),t("p",[s._v("æ—¢ç„¶å†™ binlog, å°±æ„å‘³ç€å¤‡åº“éœ€è¦.")]),s._v(" "),t("p",[s._v("å¯ä»¥è®¾æƒ³ä¸€ä¸‹, åœ¨ä¸»åº“ä¸Šæ‰§è¡Œä¸‹é¢è¿™ä¸ªè¯­å¥åºåˆ—:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t_normal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*Q1*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temporary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" t_normal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*Q2*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*Q3*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t_normal "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*Q4*/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v('å¦‚æžœå…³äºŽä¸´æ—¶è¡¨çš„æ“ä½œéƒ½ä¸è®°å½•, é‚£ä¹ˆåœ¨å¤‡åº“å°±åªæœ‰ create table t_normal è¡¨å’Œ insert into t_normal select * from temp_t è¿™ä¸¤ä¸ªè¯­å¥çš„ binlog æ—¥å¿—, å¤‡åº“åœ¨æ‰§è¡Œåˆ° insert into t_normal çš„æ—¶å€™, å°±ä¼šæŠ¥é”™ "è¡¨ temp_t ä¸å­˜åœ¨".')]),s._v(" "),t("p",[s._v('ä½ å¯èƒ½ä¼šè¯´, å¦‚æžœæŠŠ binlog è®¾ç½®ä¸º row æ ¼å¼å°±å¥½äº†å§? å› ä¸º binlog æ˜¯ row æ ¼å¼æ—¶, åœ¨è®°å½• insert into t_normal çš„ binlog æ—¶, è®°å½•çš„æ˜¯è¿™ä¸ªæ“ä½œçš„æ•°æ®, å³: write_row event é‡Œé¢è®°å½•çš„é€»è¾‘æ˜¯"æ’å…¥ä¸€è¡Œæ•°æ®(1,1)". ç¡®å®žæ˜¯è¿™æ ·. å¦‚æžœå½“å‰çš„ binlog_format=row, é‚£ä¹ˆè·Ÿä¸´æ—¶è¡¨æœ‰å…³çš„è¯­å¥, å°±ä¸ä¼šè®°å½•åˆ° binlog é‡Œ. ä¹Ÿå°±æ˜¯è¯´, åªåœ¨ binlog_format=statment/mixed çš„æ—¶å€™, binlog ä¸­æ‰ä¼šè®°å½•ä¸´æ—¶è¡¨çš„æ“ä½œ.')]),s._v(" "),t("p",[s._v("è¿™ç§æƒ…å†µä¸‹, åˆ›å»ºä¸´æ—¶è¡¨çš„è¯­å¥ä¼šä¼ åˆ°å¤‡åº“æ‰§è¡Œ, å› æ­¤å¤‡åº“çš„åŒæ­¥çº¿ç¨‹å°±ä¼šåˆ›å»ºè¿™ä¸ªä¸´æ—¶è¡¨. ä¸»åº“åœ¨çº¿ç¨‹é€€å‡ºçš„æ—¶å€™, ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶è¡¨, ä½†æ˜¯å¤‡åº“åŒæ­¥çº¿ç¨‹æ˜¯æŒç»­åœ¨è¿è¡Œçš„. æ‰€ä»¥è¿™æ—¶å€™å°±éœ€è¦åœ¨ä¸»åº“ä¸Šå†å†™ä¸€ä¸ª DROP TEMPORARY TABLE ä¼ ç»™å¤‡åº“æ‰§è¡Œ.")]),s._v(" "),t("p",[s._v("**ä¹‹å‰æœ‰äººé—®è¿‡æˆ‘ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜: **MySQL åœ¨è®°å½• binlog çš„æ—¶å€™, ä¸è®ºæ˜¯ create table è¿˜æ˜¯ alter table è¯­å¥, éƒ½æ˜¯åŽŸæ ·è®°å½•, ç”šè‡³äºŽè¿žç©ºæ ¼éƒ½ä¸å˜. ä½†æ˜¯å¦‚æžœæ‰§è¡Œ drop table t_normal, ç³»ç»Ÿè®°å½• binlog å°±ä¼šå†™æˆ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_normal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* generated by server */")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¹Ÿå°±æ˜¯æ”¹æˆäº†æ ‡å‡†çš„æ ¼å¼. ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢?")]),s._v(" "),t("p",[s._v('çŽ°åœ¨ä½ çŸ¥é“åŽŸå› äº†, é‚£å°±æ˜¯: drop table å‘½ä»¤æ˜¯å¯ä»¥ä¸€æ¬¡åˆ é™¤å¤šä¸ªè¡¨çš„. æ¯”å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, è®¾ç½® binlog_format=row, å¦‚æžœä¸»åº“ä¸Šæ‰§è¡Œ "drop table t_normal, temp_t" è¿™ä¸ªå‘½ä»¤, é‚£ä¹ˆ binlog ä¸­å°±åªèƒ½è®°å½•:')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t_normal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* generated by server */")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å› ä¸ºå¤‡åº“ä¸Šå¹¶æ²¡æœ‰è¡¨ temp_t, å°†è¿™ä¸ªå‘½ä»¤é‡å†™åŽå†ä¼ åˆ°å¤‡åº“æ‰§è¡Œ, æ‰ä¸ä¼šå¯¼è‡´å¤‡åº“åŒæ­¥çº¿ç¨‹åœæ­¢.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, drop table å‘½ä»¤è®°å½• binlog çš„æ—¶å€™, å°±å¿…é¡»å¯¹è¯­å¥åšæ”¹å†™. "),t("code",[s._v('"/* generated by server */"')]),s._v("â€‹ è¯´æ˜Žäº†è¿™æ˜¯ä¸€ä¸ªè¢«æœåŠ¡ç«¯æ”¹å†™è¿‡çš„å‘½ä»¤.")]),s._v(" "),t("p",[s._v("è¯´åˆ°ä¸»å¤‡å¤åˆ¶, "),t("strong",[s._v("è¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³")]),s._v(": ä¸»åº“ä¸Šä¸åŒçš„çº¿ç¨‹åˆ›å»ºåŒåçš„ä¸´æ—¶è¡¨æ˜¯æ²¡å…³ç³»çš„, ä½†æ˜¯ä¼ åˆ°å¤‡åº“æ‰§è¡Œæ˜¯æ€Žä¹ˆå¤„ç†çš„å‘¢?")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä¸¾ä¸ªä¾‹å­, ä¸‹é¢çš„åºåˆ—ä¸­å®žä¾‹ S æ˜¯ M çš„å¤‡åº“.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/630f6c2e74138a44109bed62f0169f8a-20230731161914-0ljduzo.png",alt:"",title:"å›¾5 ä¸»å¤‡å…³ç³»ä¸­çš„ä¸´æ—¶è¡¨æ“ä½œ"}})]),s._v(" "),t("p",[s._v("ä¸»åº“ M ä¸Šçš„ä¸¤ä¸ª session åˆ›å»ºäº†åŒåçš„ä¸´æ—¶è¡¨ t1, è¿™ä¸¤ä¸ª create temporary table t1 è¯­å¥éƒ½ä¼šè¢«ä¼ åˆ°å¤‡åº“ S ä¸Š.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯å¤‡åº“çš„åº”ç”¨æ—¥å¿—çº¿ç¨‹æ˜¯å…±ç”¨çš„, ä¹Ÿå°±æ˜¯è¯´è¦åœ¨åº”ç”¨çº¿ç¨‹é‡Œé¢å…ˆåŽæ‰§è¡Œè¿™ä¸ª create è¯­å¥ä¸¤æ¬¡. (å³ä½¿å¼€äº†å¤šçº¿ç¨‹å¤åˆ¶, ä¹Ÿå¯èƒ½è¢«åˆ†é…åˆ°ä»Žåº“çš„åŒä¸€ä¸ª worker ä¸­æ‰§è¡Œ). é‚£ä¹ˆè¿™ä¼šä¸ä¼šå¯¼è‡´åŒæ­¥çº¿ç¨‹æŠ¥é”™?")]),s._v(" "),t("p",[s._v("æ˜¾ç„¶æ˜¯ä¸ä¼šçš„, å¦åˆ™ä¸´æ—¶è¡¨å°±æ˜¯ä¸€ä¸ª bug äº†. ä¹Ÿå°±æ˜¯è¯´, å¤‡åº“çº¿ç¨‹åœ¨æ‰§è¡Œçš„æ—¶å€™, è¦æŠŠè¿™ä¸¤ä¸ª t1 è¡¨å½“åšä¸¤ä¸ªä¸åŒçš„ä¸´æ—¶è¡¨æ¥å¤„ç†. è¿™åˆæ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢?")]),s._v(" "),t("p",[s._v("MySQL åœ¨è®°å½• binlog çš„æ—¶å€™, ä¼šæŠŠä¸»åº“æ‰§è¡Œè¿™ä¸ªè¯­å¥çš„çº¿ç¨‹ id å†™åˆ° binlog ä¸­. è¿™æ ·åœ¨å¤‡åº“çš„åº”ç”¨çº¿ç¨‹å°±èƒ½å¤ŸçŸ¥é“æ‰§è¡Œæ¯ä¸ªè¯­å¥çš„ä¸»åº“çº¿ç¨‹ id, å¹¶åˆ©ç”¨è¿™ä¸ªçº¿ç¨‹ id æ¥æž„é€ ä¸´æ—¶è¡¨çš„ table_def_key:")]),s._v(" "),t("ol",[t("li",[s._v('session A çš„ä¸´æ—¶è¡¨ t1, åœ¨å¤‡åº“çš„ table_def_key å°±æ˜¯: åº“å + t1 + "M çš„ serverid" + "session A çš„ thread_id";')]),s._v(" "),t("li",[s._v('session B çš„ä¸´æ—¶è¡¨ t1, åœ¨å¤‡åº“çš„ table_def_key å°±æ˜¯ : åº“å + t1 + "M çš„ serverid" + "session B çš„ thread_id".')])]),s._v(" "),t("p",[s._v("ç”±äºŽ table_def_key ä¸åŒ, æ‰€ä»¥è¿™ä¸¤ä¸ªè¡¨åœ¨å¤‡åº“çš„åº”ç”¨çº¿ç¨‹é‡Œé¢æ˜¯ä¸ä¼šå†²çªçš„.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-34"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-34"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†ä¸´æ—¶è¡¨çš„ç”¨æ³•å’Œç‰¹æ€§. åœ¨å®žé™…åº”ç”¨ä¸­, "),t("strong",[s._v("ä¸´æ—¶è¡¨ä¸€èˆ¬ç”¨äºŽå¤„ç†æ¯”è¾ƒå¤æ‚çš„è®¡ç®—é€»è¾‘. ç”±äºŽä¸´æ—¶è¡¨æ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±å¯è§çš„, æ‰€ä»¥ä¸éœ€è¦è€ƒè™‘å¤šä¸ªçº¿ç¨‹æ‰§è¡ŒåŒä¸€ä¸ªå¤„ç†é€»è¾‘æ—¶, ä¸´æ—¶è¡¨çš„é‡åé—®é¢˜. åœ¨çº¿ç¨‹é€€å‡ºçš„æ—¶å€™, ä¸´æ—¶è¡¨ä¹Ÿèƒ½è‡ªåŠ¨åˆ é™¤, çœåŽ»äº†æ”¶å°¾å’Œå¼‚å¸¸å¤„ç†çš„å·¥ä½œ")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ binlog_format='row' çš„æ—¶å€™, ä¸´æ—¶è¡¨çš„æ“ä½œä¸è®°å½•åˆ° binlog ä¸­, ä¹ŸçœåŽ»äº†ä¸å°‘éº»çƒ¦, è¿™ä¹Ÿå¯ä»¥æˆä¸ºä½ é€‰æ‹© binlog_format æ—¶çš„ä¸€ä¸ªè€ƒè™‘å› ç´ .")]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, ä¸Šé¢è¯´åˆ°çš„è¿™ç§ä¸´æ—¶è¡¨, æ˜¯ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„, ä¹Ÿå¯ä»¥ç§°ä¸º"),t("strong",[s._v("ç”¨æˆ·ä¸´æ—¶è¡¨")]),s._v(". ä¸Žå®ƒç›¸å¯¹åº”çš„, å°±æ˜¯å†…éƒ¨ä¸´æ—¶è¡¨, å‰é¢å·²ç»ä»‹ç»è¿‡.")]),s._v(" "),t("h4",{attrs:{id:"_37-ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_37-ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨"}},[s._v("#")]),s._v(" 37-ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨?")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº† "),t("strong",[s._v("sort buffer, å†…å­˜ä¸´æ—¶è¡¨å’Œ join buffer")]),s._v(". è¿™ä¸‰ä¸ªæ•°æ®ç»“æž„éƒ½æ˜¯"),t("strong",[s._v("ç”¨æ¥å­˜æ”¾è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸­é—´æ•°æ®, ä»¥è¾…åŠ© SQL è¯­å¥çš„æ‰§è¡Œ")]),s._v("çš„. å…¶ä¸­åœ¨æŽ’åºçš„æ—¶å€™ç”¨åˆ°äº† sort buffer, åœ¨ä½¿ç”¨ join è¯­å¥çš„æ—¶å€™ç”¨åˆ°äº† join buffer.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®, "),t("strong",[s._v("MySQL ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨")]),s._v("å‘¢?")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å°±å…ˆä¸¾ä¸¤ä¸ªéœ€è¦ç”¨åˆ°å†…éƒ¨ä¸´æ—¶è¡¨çš„ä¾‹å­, æ¥çœ‹çœ‹å†…éƒ¨ä¸´æ—¶è¡¨æ˜¯æ€Žä¹ˆå·¥ä½œçš„. ç„¶åŽå†æ¥åˆ†æž, ä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨.")]),s._v(" "),t("h5",{attrs:{id:"unionæ‰§è¡Œæµç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#unionæ‰§è¡Œæµç¨‹"}},[s._v("#")]),s._v(" unionæ‰§è¡Œæµç¨‹")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽé‡åŒ–åˆ†æž, ç”¨ä¸‹é¢çš„è¡¨ t1 æ¥ä¸¾ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("ç„¶åŽæ‰§è¡Œä¸‹é¢è¿™æ¡è¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("union")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ¡è¯­å¥ç”¨åˆ°äº† union, å®ƒçš„è¯­ä¹‰æ˜¯, "),t("strong",[s._v("å–è¿™ä¸¤ä¸ªå­æŸ¥è¯¢ç»“æžœçš„å¹¶é›†")]),s._v(". å¹¶é›†çš„æ„æ€å°±æ˜¯è¿™ä¸¤ä¸ªé›†åˆåŠ èµ·æ¥, é‡å¤çš„è¡Œåªä¿ç•™ä¸€è¡Œ.")]),s._v(" "),t("p",[s._v("ä¸‹å›¾æ˜¯è¿™ä¸ªè¯­å¥çš„ explain ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0ab6cb9727a546fa8c623028cbb932f2-20230731161914-h8klt4z.png",alt:"",title:"å›¾1 unionè¯­å¥explainç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°:")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬äºŒè¡Œçš„ key=PRIMARY, è¯´æ˜Ž"),t("strong",[s._v("ç¬¬äºŒä¸ªå­å¥ç”¨åˆ°äº†ç´¢å¼• id")]),s._v(".")]),s._v(" "),t("li",[s._v("ç¬¬ä¸‰è¡Œçš„ Extra å­—æ®µ, è¡¨ç¤ºåœ¨å¯¹å­æŸ¥è¯¢çš„ç»“æžœé›†åš union çš„æ—¶å€™, ä½¿ç”¨äº†"),t("strong",[s._v("ä¸´æ—¶è¡¨")]),s._v("(Using temporary).")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("åˆ›å»ºä¸€ä¸ª"),t("strong",[s._v("å†…å­˜ä¸´æ—¶è¡¨")]),s._v(", è¿™ä¸ªä¸´æ—¶è¡¨åªæœ‰ä¸€ä¸ªæ•´åž‹å­—æ®µ f, å¹¶ä¸” f æ˜¯ä¸»é”®å­—æ®µ.")])]),s._v(" "),t("li",[t("p",[s._v("æ‰§è¡Œç¬¬ä¸€ä¸ªå­æŸ¥è¯¢, å¾—åˆ° 1000 è¿™ä¸ªå€¼, å¹¶å­˜å…¥ä¸´æ—¶è¡¨ä¸­.")])]),s._v(" "),t("li",[t("p",[s._v("æ‰§è¡Œç¬¬äºŒä¸ªå­æŸ¥è¯¢:")]),s._v(" "),t("ul",[t("li",[s._v("æ‹¿åˆ°ç¬¬ä¸€è¡Œ id=1000, è¯•å›¾æ’å…¥ä¸´æ—¶è¡¨ä¸­. ä½†ç”±äºŽ 1000 è¿™ä¸ªå€¼å·²ç»å­˜åœ¨äºŽä¸´æ—¶è¡¨äº†, è¿åäº†å”¯ä¸€æ€§çº¦æŸ, æ‰€ä»¥æ’å…¥å¤±è´¥, ç„¶åŽç»§ç»­æ‰§è¡Œ;")]),s._v(" "),t("li",[s._v("å–åˆ°ç¬¬äºŒè¡Œ id=999, æ’å…¥ä¸´æ—¶è¡¨æˆåŠŸ.")])])]),s._v(" "),t("li",[t("p",[s._v("ä»Žä¸´æ—¶è¡¨ä¸­æŒ‰è¡Œå–å‡ºæ•°æ®, è¿”å›žç»“æžœ, å¹¶åˆ é™¤ä¸´æ—¶è¡¨, ç»“æžœä¸­åŒ…å«ä¸¤è¡Œæ•°æ®åˆ†åˆ«æ˜¯ 1000 å’Œ 999.")])])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a0cd3ae557a517ac3ba094a789d5a329-20230731161914-lc2qwgg.png",alt:"",title:"å›¾2 unionæ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™é‡Œçš„"),t("strong",[s._v("å†…å­˜ä¸´æ—¶è¡¨èµ·åˆ°äº†æš‚å­˜æ•°æ®çš„ä½œç”¨")]),s._v(", è€Œä¸”è®¡ç®—è¿‡ç¨‹è¿˜ç”¨ä¸Šäº†ä¸´æ—¶è¡¨ä¸»é”® id çš„å”¯ä¸€æ€§çº¦æŸ, å®žçŽ°äº† union çš„è¯­ä¹‰.")]),s._v(" "),t("p",[s._v('é¡ºä¾¿æä¸€ä¸‹, å¦‚æžœæŠŠä¸Šé¢è¿™ä¸ªè¯­å¥ä¸­çš„ union æ”¹æˆ union all çš„è¯, å°±æ²¡æœ‰äº†"åŽ»é‡"çš„è¯­ä¹‰. è¿™æ ·æ‰§è¡Œçš„æ—¶å€™, å°±ä¾æ¬¡æ‰§è¡Œå­æŸ¥è¯¢, å¾—åˆ°çš„ç»“æžœç›´æŽ¥ä½œä¸ºç»“æžœé›†çš„ä¸€éƒ¨åˆ†, å‘ç»™å®¢æˆ·ç«¯. å› æ­¤ä¹Ÿå°±ä¸éœ€è¦ä¸´æ—¶è¡¨äº†.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/685974a4f6db56cb5c839cb2f72f5c89-20230731161914-3svlqhq.png",alt:"",title:"å›¾3 union allçš„explainç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ç¬¬äºŒè¡Œçš„ Extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ Using index, è¡¨ç¤ºåªä½¿ç”¨äº†è¦†ç›–ç´¢å¼•, æ²¡æœ‰ç”¨ä¸´æ—¶è¡¨äº†.")]),s._v(" "),t("h5",{attrs:{id:"group-byæ‰§è¡Œæµç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#group-byæ‰§è¡Œæµç¨‹"}},[s._v("#")]),s._v(" group byæ‰§è¡Œæµç¨‹")]),s._v(" "),t("p",[s._v("å¦å¤–ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨ä¸´æ—¶è¡¨çš„ä¾‹å­æ˜¯ group by, æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¯­å¥:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¯­å¥çš„é€»è¾‘æ˜¯æŠŠè¡¨ t1 é‡Œçš„æ•°æ®, æŒ‰ç…§ id%10 è¿›è¡Œåˆ†ç»„ç»Ÿè®¡, å¹¶æŒ‰ç…§ m çš„ç»“æžœæŽ’åºåŽè¾“å‡º. å®ƒçš„ explain ç»“æžœå¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/9fb550c78d3e315aba267074e1b1569b-20230731161914-mq2dxrm.png",alt:"",title:"å›¾4 group byçš„explainç»“æžœ"}})]),s._v(" "),t("p",[s._v("åœ¨ Extra å­—æ®µé‡Œé¢, å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªä¿¡æ¯:")]),s._v(" "),t("ul",[t("li",[s._v("Using index, è¡¨ç¤ºè¿™ä¸ªè¯­å¥ä½¿ç”¨äº†"),t("strong",[s._v("è¦†ç›–ç´¢å¼•")]),s._v(", é€‰æ‹©äº†ç´¢å¼• a, ä¸éœ€è¦å›žè¡¨;")]),s._v(" "),t("li",[s._v("Using temporary, è¡¨ç¤ºä½¿ç”¨äº†"),t("strong",[s._v("ä¸´æ—¶è¡¨")]),s._v(";")]),s._v(" "),t("li",[s._v("Using filesort, è¡¨ç¤ºéœ€è¦"),t("strong",[s._v("æŽ’åº")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("åˆ›å»ºå†…å­˜ä¸´æ—¶è¡¨, è¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µ m å’Œ c, ä¸»é”®æ˜¯ m;")])]),s._v(" "),t("li",[t("p",[s._v("æ‰«æè¡¨ t1 çš„ç´¢å¼• a, ä¾æ¬¡å–å‡ºå¶å­èŠ‚ç‚¹ä¸Šçš„ id å€¼, è®¡ç®— id%10 çš„ç»“æžœ, è®°ä¸º x;")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æžœä¸´æ—¶è¡¨ä¸­æ²¡æœ‰ä¸»é”®ä¸º x çš„è¡Œ, å°±æ’å…¥ä¸€ä¸ªè®°å½• (x,1);")]),s._v(" "),t("li",[s._v("å¦‚æžœè¡¨ä¸­æœ‰ä¸»é”®ä¸º x çš„è¡Œ, å°±å°† x è¿™ä¸€è¡Œçš„ c å€¼åŠ  1;")])])]),s._v(" "),t("li",[t("p",[s._v("éåŽ†å®ŒæˆåŽ, å†æ ¹æ®å­—æ®µ m åšæŽ’åº, å¾—åˆ°ç»“æžœé›†è¿”å›žç»™å®¢æˆ·ç«¯.")])])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæµç¨‹çš„æ‰§è¡Œå›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ef11efa0c4bdcc94c543d0aea6262513-20230731161914-mngu4qi.png",alt:"",title:"å›¾5 group byæ‰§è¡Œæµç¨‹"}})]),s._v(" "),t("p",[s._v("å›¾ä¸­æœ€åŽä¸€æ­¥, å¯¹å†…å­˜ä¸´æ—¶è¡¨çš„æŽ’åº, å‰é¢å·²ç»æœ‰è¿‡ä»‹ç», æˆ‘æŠŠå›¾è´´è¿‡æ¥, æ–¹ä¾¿ä½ å›žé¡¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f9411f66d015d6371e6a6eabe92b8265-20230731161914-v6ijjwe.png",alt:"",title:"å›¾6 å†…å­˜ä¸´æ—¶è¡¨æŽ’åºæµç¨‹"}})]),s._v(" "),t("p",[s._v("å…¶ä¸­, ä¸´æ—¶è¡¨çš„æŽ’åºè¿‡ç¨‹å°±æ˜¯å›¾ 6 ä¸­è™šçº¿æ¡†å†…çš„è¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, å†çœ‹ä¸€ä¸‹è¿™æ¡è¯­å¥çš„æ‰§è¡Œç»“æžœ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6df29bad0c5b1339db190eb505fdc409-20230731161914-7cx98en.png",alt:"",title:"å›¾7 group byæ‰§è¡Œç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¦‚æžœéœ€æ±‚å¹¶ä¸éœ€è¦å¯¹ç»“æžœè¿›è¡ŒæŽ’åº, é‚£å¯ä»¥åœ¨ SQL è¯­å¥æœ«å°¾å¢žåŠ  order by null, ä¹Ÿå°±æ˜¯æ”¹æˆ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" m "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ ·å°±è·³è¿‡äº†æœ€åŽæŽ’åºçš„é˜¶æ®µ, ç›´æŽ¥ä»Žä¸´æ—¶è¡¨ä¸­å–æ•°æ®è¿”å›ž. è¿”å›žçš„ç»“æžœå¦‚å›¾ 8 æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e470abf93d4e95e02570862260d88311-20230731161914-c6c4kxe.png",alt:"",title:"å›¾8 group + order by nullçš„ç»“æžœ(å†…å­˜ä¸´æ—¶è¡¨)"}})]),s._v(" "),t("p",[s._v("ç”±äºŽè¡¨ t1 ä¸­çš„ id å€¼æ˜¯ä»Ž 1 å¼€å§‹çš„, å› æ­¤è¿”å›žçš„ç»“æžœé›†ä¸­ç¬¬ä¸€è¡Œæ˜¯ id=1; æ‰«æåˆ° id=10 çš„æ—¶å€™æ‰æ’å…¥ m=0 è¿™ä¸€è¡Œ, å› æ­¤ç»“æžœé›†é‡Œæœ€åŽä¸€è¡Œæ‰æ˜¯ m=0.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªä¾‹å­é‡Œç”±äºŽä¸´æ—¶è¡¨åªæœ‰ 10 è¡Œ, å†…å­˜å¯ä»¥æ”¾å¾—ä¸‹, å› æ­¤å…¨ç¨‹åªä½¿ç”¨äº†"),t("strong",[s._v("å†…å­˜ä¸´æ—¶è¡¨")]),s._v(". ä½†æ˜¯"),t("strong",[s._v("å†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„, å‚æ•° tmp_table_size å°±æ˜¯æŽ§åˆ¶è¿™ä¸ªå†…å­˜å¤§å°çš„, é»˜è®¤æ˜¯ 16M")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æžœæ‰§è¡Œä¸‹é¢è¿™ä¸ªè¯­å¥åºåˆ—:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" tmp_table_size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" m "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("æŠŠå†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°é™åˆ¶ä¸ºæœ€å¤§ 1024 å­—èŠ‚, å¹¶æŠŠè¯­å¥æ”¹æˆ id % 100, è¿™æ ·è¿”å›žç»“æžœé‡Œæœ‰ 100 è¡Œæ•°æ®. ä½†è¿™æ—¶çš„å†…å­˜ä¸´æ—¶è¡¨å¤§å°ä¸å¤Ÿå­˜ä¸‹è¿™ 100 è¡Œæ•°æ®, ä¹Ÿå°±æ˜¯è¯´, æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼š"),t("strong",[s._v("å‘çŽ°å†…å­˜ä¸´æ—¶è¡¨å¤§å°åˆ°è¾¾äº†ä¸Šé™(1024 å­—èŠ‚)")]),s._v(" .")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆè¿™æ—¶å€™"),t("strong",[s._v("å°±ä¼šæŠŠå†…å­˜ä¸´æ—¶è¡¨è½¬æˆç£ç›˜ä¸´æ—¶è¡¨")]),s._v(", ç£ç›˜ä¸´æ—¶è¡¨é»˜è®¤ä½¿ç”¨çš„å¼•æ“Žæ˜¯ InnoDB. è¿™æ—¶è¿”å›žçš„ç»“æžœå¦‚å›¾ 9 æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0c0534245cc862c1a931ddfb28c8e810-20230731161914-5cmli45.png",alt:"",title:"å›¾9 group + order by nullçš„ç»“æžœ(ç£ç›˜ä¸´æ—¶è¡¨)"}})]),s._v(" "),t("p",[s._v("å¦‚æžœè¿™ä¸ªè¡¨ t1 çš„æ•°æ®é‡å¾ˆå¤§, å¾ˆå¯èƒ½è¿™ä¸ªæŸ¥è¯¢éœ€è¦çš„ç£ç›˜ä¸´æ—¶è¡¨å°±ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´.")]),s._v(" "),t("h5",{attrs:{id:"group-byä¼˜åŒ–æ–¹æ³•-ç´¢å¼•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#group-byä¼˜åŒ–æ–¹æ³•-ç´¢å¼•"}},[s._v("#")]),s._v(" group byä¼˜åŒ–æ–¹æ³•--ç´¢å¼•")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ä¸è®ºæ˜¯ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨, "),t("strong",[s._v("group by é€»è¾‘éƒ½éœ€è¦æž„é€ ä¸€ä¸ªå¸¦å”¯ä¸€ç´¢å¼•çš„è¡¨")]),s._v(", æ‰§è¡Œä»£ä»·éƒ½æ˜¯æ¯”è¾ƒé«˜çš„. å¦‚æžœè¡¨çš„æ•°æ®é‡æ¯”è¾ƒå¤§, ä¸Šé¢è¿™ä¸ª group by è¯­å¥æ‰§è¡Œèµ·æ¥å°±ä¼šå¾ˆæ…¢, æœ‰ä»€ä¹ˆä¼˜åŒ–çš„æ–¹æ³•å‘¢?")]),s._v(" "),t("p",[s._v("è¦è§£å†³ group by è¯­å¥çš„ä¼˜åŒ–é—®é¢˜, å¯ä»¥å…ˆæƒ³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜: "),t("strong",[s._v("æ‰§è¡Œ group by è¯­å¥ä¸ºä»€ä¹ˆéœ€è¦ä¸´æ—¶è¡¨")]),s._v("?")]),s._v(" "),t("p",[s._v("group by çš„è¯­ä¹‰é€»è¾‘, æ˜¯ç»Ÿè®¡ä¸åŒçš„å€¼å‡ºçŽ°çš„ä¸ªæ•°. ä½†ç”±äºŽæ¯ä¸€è¡Œçš„ id%100 çš„ç»“æžœæ˜¯æ— åºçš„, æ‰€ä»¥"),t("strong",[s._v("å°±éœ€è¦æœ‰ä¸€ä¸ªä¸´æ—¶è¡¨, æ¥è®°å½•å¹¶ç»Ÿè®¡ç»“æžœ")]),s._v(". é‚£å¦‚æžœæ‰«æè¿‡ç¨‹ä¸­å¯ä»¥ä¿è¯å‡ºçŽ°çš„æ•°æ®æ˜¯æœ‰åºçš„, æ˜¯ä¸æ˜¯å°±ç®€å•äº†å‘¢?")]),s._v(" "),t("p",[s._v("å‡è®¾, çŽ°åœ¨æœ‰ä¸€ä¸ªç±»ä¼¼å›¾ 10 çš„è¿™ä¹ˆä¸€ä¸ªæ•°æ®ç»“æž„, æ¥çœ‹çœ‹ group by å¯ä»¥æ€Žä¹ˆåš.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ab281739c7032614927a2541cf8fab50-20230731161914-1wr44r7.png",alt:"",title:"å›¾10 group byç®—æ³•ä¼˜åŒ–-æœ‰åºè¾“å…¥"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, å¦‚æžœå¯ä»¥ç¡®ä¿è¾“å…¥çš„æ•°æ®æ˜¯æœ‰åºçš„, é‚£ä¹ˆè®¡ç®— group by çš„æ—¶å€™, å°±åªéœ€è¦ä»Žå·¦åˆ°å³, é¡ºåºæ‰«æ, ä¾æ¬¡ç´¯åŠ . ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ªè¿‡ç¨‹:")]),s._v(" "),t("ul",[t("li",[s._v("å½“ç¢°åˆ°ç¬¬ä¸€ä¸ª 1 çš„æ—¶å€™, å·²ç»çŸ¥é“ç´¯ç§¯äº† X ä¸ª 0, ç»“æžœé›†é‡Œçš„ç¬¬ä¸€è¡Œå°±æ˜¯ (0,X);")]),s._v(" "),t("li",[s._v("å½“ç¢°åˆ°ç¬¬ä¸€ä¸ª 2 çš„æ—¶å€™, å·²ç»çŸ¥é“ç´¯ç§¯äº† Y ä¸ª 1, ç»“æžœé›†é‡Œçš„ç¬¬äºŒè¡Œå°±æ˜¯ (1,Y);")])]),s._v(" "),t("p",[s._v("æŒ‰ç…§è¿™ä¸ªé€»è¾‘æ‰§è¡Œçš„è¯, æ‰«æåˆ°æ•´ä¸ªè¾“å…¥çš„æ•°æ®ç»“æŸ, å°±å¯ä»¥æ‹¿åˆ° group by çš„ç»“æžœ, "),t("strong",[s._v("ä¸éœ€è¦ä¸´æ—¶è¡¨")]),s._v(", ä¹Ÿä¸éœ€è¦å†é¢å¤–æŽ’åº.")]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šæƒ³åˆ°äº†, "),t("strong",[s._v("InnoDB çš„ç´¢å¼•")]),s._v(", å°±å¯ä»¥æ»¡è¶³è¿™ä¸ªè¾“å…¥æœ‰åºçš„æ¡ä»¶. åœ¨ MySQL 5.7 ç‰ˆæœ¬æ”¯æŒäº† generated column æœºåˆ¶, ç”¨æ¥å®žçŽ°åˆ—æ•°æ®çš„å…³è”æ›´æ–°. å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªåˆ— z, ç„¶åŽåœ¨ z åˆ—ä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•(å¦‚æžœæ˜¯ MySQL 5.6 åŠä¹‹å‰çš„ç‰ˆæœ¬, ä¹Ÿå¯ä»¥åˆ›å»ºæ™®é€šåˆ—å’Œç´¢å¼•, æ¥è§£å†³è¿™ä¸ªé—®é¢˜).")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" z "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" generated always "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("z"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ ·, ç´¢å¼• z ä¸Šçš„æ•°æ®å°±æ˜¯ç±»ä¼¼å›¾ 10 è¿™æ ·æœ‰åºçš„äº†. ä¸Šé¢çš„ group by è¯­å¥å°±å¯ä»¥æ”¹æˆ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" z"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" z"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¼˜åŒ–åŽçš„ group by è¯­å¥çš„ explain ç»“æžœ, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/dbdd74ae9e619ab0551d11bf9bd561d8-20230731161914-mw7h19i.png",alt:"",title:"å›¾11 group byä¼˜åŒ–çš„explainç»“æžœ"}})]),s._v(" "),t("p",[s._v("ä»Ž Extra å­—æ®µå¯ä»¥çœ‹åˆ°, è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œä¸å†éœ€è¦ä¸´æ—¶è¡¨, ä¹Ÿä¸éœ€è¦æŽ’åºäº†.")]),s._v(" "),t("h5",{attrs:{id:"group-byä¼˜åŒ–æ–¹æ³•-ç›´æŽ¥æŽ’åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#group-byä¼˜åŒ–æ–¹æ³•-ç›´æŽ¥æŽ’åº"}},[s._v("#")]),s._v(" group byä¼˜åŒ–æ–¹æ³•-ç›´æŽ¥æŽ’åº")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, å¦‚æžœå¯ä»¥é€šè¿‡åŠ ç´¢å¼•æ¥å®Œæˆ group by é€»è¾‘å°±å†å¥½ä¸è¿‡äº†. ä½†æ˜¯å¦‚æžœç¢°ä¸Š"),t("strong",[s._v("ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„åœºæ™¯")]),s._v(", è¿˜æ˜¯è¦è€è€å®žå®žåšæŽ’åºçš„. é‚£ä¹ˆè¿™æ—¶å€™çš„ group by è¦æ€Žä¹ˆä¼˜åŒ–å‘¢?")]),s._v(" "),t("p",[s._v('å¦‚æžœæ˜Žæ˜ŽçŸ¥é“, ä¸€ä¸ª group by è¯­å¥ä¸­éœ€è¦æ”¾åˆ°ä¸´æ—¶è¡¨ä¸Šçš„æ•°æ®é‡ç‰¹åˆ«å¤§, å´è¿˜æ˜¯è¦æŒ‰ç…§ "å…ˆæ”¾åˆ°å†…å­˜ä¸´æ—¶è¡¨, æ’å…¥ä¸€éƒ¨åˆ†æ•°æ®åŽ, å‘çŽ°å†…å­˜ä¸´æ—¶è¡¨ä¸å¤Ÿç”¨äº†å†è½¬æˆç£ç›˜ä¸´æ—¶è¡¨", çœ‹ä¸ŠåŽ»å°±æœ‰ç‚¹å‚».')]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, æˆ‘ä»¬å°±ä¼šæƒ³äº†, "),t("strong",[s._v("MySQL æœ‰æ²¡æœ‰è®©æˆ‘ä»¬ç›´æŽ¥èµ°ç£ç›˜ä¸´æ—¶è¡¨")]),s._v("çš„æ–¹æ³•å‘¢?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, æœ‰çš„. åœ¨ group by è¯­å¥ä¸­åŠ å…¥ SQL_BIG_RESULT è¿™ä¸ªæç¤º(hint), å°±å¯ä»¥å‘Šè¯‰ä¼˜åŒ–å™¨: "),t("strong",[s._v("è¿™ä¸ªè¯­å¥æ¶‰åŠçš„æ•°æ®é‡å¾ˆå¤§, è¯·ç›´æŽ¥ç”¨ç£ç›˜ä¸´æ—¶è¡¨")]),s._v(". MySQL çš„ä¼˜åŒ–å™¨ä¸€çœ‹, ç£ç›˜ä¸´æ—¶è¡¨æ˜¯ B+ æ ‘å­˜å‚¨, å­˜å‚¨æ•ˆçŽ‡ä¸å¦‚æ•°ç»„æ¥å¾—é«˜. æ‰€ä»¥æ—¢ç„¶ä½ å‘Šè¯‰æˆ‘æ•°æ®é‡å¾ˆå¤§, é‚£ä»Žç£ç›˜ç©ºé—´è€ƒè™‘, è¿˜æ˜¯ç›´æŽ¥ç”¨æ•°ç»„æ¥å­˜å§.")]),s._v(" "),t("p",[s._v("å› æ­¤, ä¸‹é¢è¿™ä¸ªè¯­å¥")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" SQL_BIG_RESULT id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("çš„æ‰§è¡Œæµç¨‹å°±æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("åˆå§‹åŒ– sort_buffer, ç¡®å®šæ”¾å…¥ä¸€ä¸ªæ•´åž‹å­—æ®µ, è®°ä¸º m;")]),s._v(" "),t("li",[s._v("æ‰«æè¡¨ t1 çš„ç´¢å¼• a, ä¾æ¬¡å–å‡ºé‡Œé¢çš„ id å€¼, å°† id%100 çš„å€¼å­˜å…¥ sort_buffer ä¸­;")]),s._v(" "),t("li",[s._v("æ‰«æå®ŒæˆåŽ, å¯¹ sort_buffer çš„å­—æ®µ m åšæŽ’åº(å¦‚æžœ sort_buffer å†…å­˜ä¸å¤Ÿç”¨, å°±ä¼šåˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æŽ’åº);")]),s._v(" "),t("li",[s._v("æŽ’åºå®ŒæˆåŽ, å°±å¾—åˆ°äº†ä¸€ä¸ªæœ‰åºæ•°ç»„.")])]),s._v(" "),t("p",[s._v("æ ¹æ®æœ‰åºæ•°ç»„, å¾—åˆ°æ•°ç»„é‡Œé¢çš„ä¸åŒå€¼, ä»¥åŠæ¯ä¸ªå€¼çš„å‡ºçŽ°æ¬¡æ•°. è¿™ä¸€æ­¥çš„é€»è¾‘, ä½ å·²ç»ä»Žå‰é¢çš„å›¾ 10 ä¸­äº†è§£è¿‡äº†.")]),s._v(" "),t("p",[s._v("ä¸‹é¢ä¸¤å¼ å›¾åˆ†åˆ«æ˜¯æ‰§è¡Œæµç¨‹å›¾å’Œæ‰§è¡Œ explain å‘½ä»¤å¾—åˆ°çš„ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/af6704c9959bb6af81c0dc2d7206ca1e-20230731161914-5y969l3.png",alt:"",title:"å›¾12 ä½¿ç”¨SQL_BIG_RESULTçš„æ‰§è¡Œæµç¨‹å›¾"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/29b37e0486ceadb683c4feecfe9142b3-20230731161914-fcujolx.png",alt:"",title:"å›¾13 ä½¿ç”¨SQL_BIG_RESULTçš„explainç»“æžœ"}})]),s._v(" "),t("p",[s._v("ä»Ž Extra å­—æ®µå¯ä»¥çœ‹åˆ°, è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ²¡æœ‰å†ä½¿ç”¨ä¸´æ—¶è¡¨, è€Œæ˜¯ç›´æŽ¥ç”¨äº†æŽ’åºç®—æ³•.")]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢çš„ union, union all å’Œ group by è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹çš„åˆ†æž, æ¥å›žç­”æœ¬èŠ‚å¼€å¤´çš„é—®é¢˜: "),t("strong",[s._v("MySQL ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨")]),s._v("?")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¦‚æžœè¯­å¥æ‰§è¡Œè¿‡ç¨‹å¯ä»¥ä¸€è¾¹è¯»æ•°æ®, ä¸€è¾¹ç›´æŽ¥å¾—åˆ°ç»“æžœ, æ˜¯ä¸éœ€è¦é¢å¤–å†…å­˜çš„, å¦åˆ™å°±éœ€è¦é¢å¤–çš„å†…å­˜, æ¥ä¿å­˜ä¸­é—´ç»“æžœ;")])]),s._v(" "),t("li",[t("strong",[s._v("join_buffer æ˜¯æ— åºæ•°ç»„, sort_buffer æ˜¯æœ‰åºæ•°ç»„, ä¸´æ—¶è¡¨æ˜¯äºŒç»´è¡¨ç»“æž„;")])]),s._v(" "),t("li",[t("strong",[s._v("å¦‚æžœæ‰§è¡Œé€»è¾‘éœ€è¦ç”¨åˆ°äºŒç»´è¡¨ç‰¹æ€§, å°±ä¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ä¸´æ—¶è¡¨")]),s._v(". æ¯”å¦‚ä¾‹å­ä¸­, union éœ€è¦ç”¨åˆ°å”¯ä¸€ç´¢å¼•çº¦æŸ,  group by è¿˜éœ€è¦ç”¨åˆ°å¦å¤–ä¸€ä¸ªå­—æ®µæ¥å­˜ç´¯ç§¯è®¡æ•°.")])]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-35"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-35"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† group by çš„å‡ ç§å®žçŽ°ç®—æ³•, ä»Žä¸­å¯ä»¥æ€»ç»“ä¸€äº›ä½¿ç”¨çš„æŒ‡å¯¼åŽŸåˆ™:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¦‚æžœå¯¹ group by è¯­å¥çš„ç»“æžœæ²¡æœ‰æŽ’åºè¦æ±‚, è¦åœ¨è¯­å¥åŽé¢åŠ  order by null;")])]),s._v(" "),t("li",[t("strong",[s._v("å°½é‡è®© group by è¿‡ç¨‹ç”¨ä¸Šè¡¨çš„ç´¢å¼•, ç¡®è®¤æ–¹æ³•æ˜¯ explain ç»“æžœé‡Œæ²¡æœ‰ Using temporary å’Œ Using filesort")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("å¦‚æžœ group by éœ€è¦ç»Ÿè®¡çš„æ•°æ®é‡ä¸å¤§, å°½é‡åªä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨; ä¹Ÿå¯ä»¥é€šè¿‡é€‚å½“è°ƒå¤§ tmp_table_size å‚æ•°, æ¥é¿å…ç”¨åˆ°ç£ç›˜ä¸´æ—¶è¡¨")]),s._v(";")]),s._v(" "),t("li",[s._v("å¦‚æžœæ•°æ®é‡å®žåœ¨å¤ªå¤§, ä½¿ç”¨ SQL_BIG_RESULT è¿™ä¸ªæç¤º, æ¥å‘Šè¯‰ä¼˜åŒ–å™¨ç›´æŽ¥ä½¿ç”¨æŽ’åºç®—æ³•å¾—åˆ° group by çš„ç»“æžœ.")])]),s._v(" "),t("h4",{attrs:{id:"_38-éƒ½è¯´innodbå¥½-é‚£è¿˜è¦ä¸è¦ä½¿ç”¨memoryå¼•æ“Ž"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_38-éƒ½è¯´innodbå¥½-é‚£è¿˜è¦ä¸è¦ä½¿ç”¨memoryå¼•æ“Ž"}},[s._v("#")]),s._v(" 38-éƒ½è¯´InnoDBå¥½,é‚£è¿˜è¦ä¸è¦ä½¿ç”¨Memoryå¼•æ“Ž?")]),s._v(" "),t("p",[s._v("æä¸€ä¸ªé—®é¢˜: ä¸¤ä¸ª group by è¯­å¥éƒ½ç”¨äº† order by null, ä¸ºä»€ä¹ˆ"),t("strong",[s._v("ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨å¾—åˆ°çš„è¯­å¥ç»“æžœé‡Œ, 0 è¿™ä¸ªå€¼åœ¨æœ€åŽä¸€è¡Œ; è€Œä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨å¾—åˆ°çš„ç»“æžœé‡Œ, 0 è¿™ä¸ªå€¼åœ¨ç¬¬ä¸€è¡Œ")]),s._v("?")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å°±æ¥çœ‹çœ‹å‡ºçŽ°è¿™ä¸ªé—®é¢˜çš„åŽŸå› .")]),s._v(" "),t("h5",{attrs:{id:"å†…å­˜è¡¨çš„æ•°æ®ç»„ç»‡ç»“æž„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜è¡¨çš„æ•°æ®ç»„ç»‡ç»“æž„"}},[s._v("#")]),s._v(" å†…å­˜è¡¨çš„æ•°æ®ç»„ç»‡ç»“æž„")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽåˆ†æž, æ¥æŠŠè¿™ä¸ªé—®é¢˜ç®€åŒ–ä¸€ä¸‹, å‡è®¾æœ‰ä»¥ä¸‹çš„ä¸¤å¼ è¡¨ t1 å’Œ t2, å…¶ä¸­è¡¨ t1 ä½¿ç”¨ Memory å¼•æ“Ž,  è¡¨ t2 ä½¿ç”¨ InnoDB å¼•æ“Ž.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Memory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("ç„¶åŽåˆ†åˆ«æ‰§è¡Œ select * from t1 å’Œ select * from t2.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/dea4f91e099b60043fabbee922a25384-20230731161914-uke0gmx.png",alt:"",title:"å›¾1 ä¸¤ä¸ªæŸ¥è¯¢ç»“æžœ-0çš„ä½ç½®"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("å†…å­˜è¡¨ t1 çš„è¿”å›žç»“æžœé‡Œé¢ 0 åœ¨æœ€åŽä¸€è¡Œ, è€Œ InnoDB è¡¨ t2 çš„è¿”å›žç»“æžœé‡Œ 0 åœ¨ç¬¬ä¸€è¡Œ")]),s._v(". å‡ºçŽ°è¿™ä¸ªåŒºåˆ«çš„åŽŸå› , è¦ä»Žè¿™ä¸¤ä¸ªå¼•æ“Žçš„"),t("strong",[s._v("ä¸»é”®ç´¢å¼•çš„ç»„ç»‡æ–¹å¼")]),s._v("è¯´èµ·.")]),s._v(" "),t("p",[s._v("è¡¨ t2 ç”¨çš„æ˜¯ InnoDB å¼•æ“Ž, å®ƒçš„ä¸»é”®ç´¢å¼• id çš„ç»„ç»‡æ–¹å¼, ä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†: InnoDB è¡¨çš„æ•°æ®å°±æ”¾åœ¨ä¸»é”®ç´¢å¼•æ ‘ä¸Š, ä¸»é”®ç´¢å¼•æ˜¯ B+ æ ‘. æ‰€ä»¥è¡¨ t2 çš„æ•°æ®ç»„ç»‡æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0190c42da6fb2d6deff1c5661252c261-20230731161914-quf942k.png",alt:"",title:"å›¾2 è¡¨t2çš„æ•°æ®ç»„ç»‡"}})]),s._v(" "),t("p",[s._v("ä¸»é”®ç´¢å¼•ä¸Šçš„å€¼æ˜¯"),t("strong",[s._v("æœ‰åºå­˜å‚¨")]),s._v("çš„. åœ¨æ‰§è¡Œ "),t("code",[s._v("select *")]),s._v("â€‹ çš„æ—¶å€™, å°±ä¼š"),t("strong",[s._v("æŒ‰ç…§å¶å­èŠ‚ç‚¹ä»Žå·¦åˆ°å³æ‰«æ, æ‰€ä»¥å¾—åˆ°çš„ç»“æžœé‡Œ, 0 å°±å‡ºçŽ°åœ¨ç¬¬ä¸€è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸Ž InnoDB å¼•æ“Žä¸åŒ, Memory å¼•æ“Žçš„"),t("strong",[s._v("æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€")]),s._v("çš„. æ¥çœ‹ä¸€ä¸‹è¡¨ t1 ä¸­çš„æ•°æ®å†…å®¹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1e8e0939d2944d3450a84377dc479457-20230731161914-08cwuk2.png",alt:"",title:"å›¾3 è¡¨t1çš„æ•°æ®ç»„ç»‡"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("å†…å­˜è¡¨çš„æ•°æ®éƒ¨åˆ†ä»¥æ•°ç»„çš„æ–¹å¼å•ç‹¬å­˜æ”¾, è€Œä¸»é”® id ç´¢å¼•é‡Œ, å­˜çš„æ˜¯æ¯ä¸ªæ•°æ®çš„ä½ç½®")]),s._v(". ä¸»é”® id æ˜¯ hash ç´¢å¼•, å¯ä»¥çœ‹åˆ°ç´¢å¼•ä¸Šçš„ key å¹¶ä¸æ˜¯æœ‰åºçš„.")]),s._v(" "),t("p",[s._v("åœ¨å†…å­˜è¡¨ t1 ä¸­, å½“æ‰§è¡Œ select * çš„æ—¶å€™, èµ°çš„æ˜¯"),t("strong",[s._v("å…¨è¡¨æ‰«æ")]),s._v(", ä¹Ÿå°±æ˜¯é¡ºåºæ‰«æè¿™ä¸ªæ•°ç»„. å› æ­¤, 0 å°±æ˜¯æœ€åŽä¸€ä¸ªè¢«è¯»åˆ°, å¹¶æ”¾å…¥ç»“æžœé›†çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("å¯è§, InnoDB å’Œ Memory å¼•æ“Žçš„æ•°æ®ç»„ç»‡æ–¹å¼æ˜¯ä¸åŒçš„:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("InnoDB å¼•æ“ŽæŠŠæ•°æ®æ”¾åœ¨ä¸»é”®ç´¢å¼•ä¸Š, å…¶ä»–ç´¢å¼•ä¸Šä¿å­˜çš„æ˜¯ä¸»é”® id")]),s._v(". è¿™ç§æ–¹å¼ç§°ä¹‹ä¸º"),t("strong",[s._v("ç´¢å¼•ç»„ç»‡è¡¨")]),s._v("(Index Organizied Table).")]),s._v(" "),t("li",[t("strong",[s._v("è€Œ Memory å¼•æ“Žé‡‡ç”¨çš„æ˜¯æŠŠæ•°æ®å•ç‹¬å­˜æ”¾, ç´¢å¼•ä¸Šä¿å­˜æ•°æ®ä½ç½®çš„æ•°æ®ç»„ç»‡å½¢å¼")]),s._v(", ç§°ä¹‹ä¸º"),t("strong",[s._v("å †ç»„ç»‡è¡¨")]),s._v("(Heap Organizied Table).")])]),s._v(" "),t("p",[s._v("ä»Žä¸­å¯ä»¥çœ‹å‡º, è¿™ä¸¤ä¸ªå¼•æ“Žçš„ä¸€äº›å…¸åž‹ä¸åŒ:")]),s._v(" "),t("ol",[t("li",[s._v("InnoDB è¡¨çš„æ•°æ®æ€»æ˜¯"),t("strong",[s._v("æœ‰åºå­˜æ”¾")]),s._v("çš„, è€Œå†…å­˜è¡¨çš„æ•°æ®å°±æ˜¯"),t("strong",[s._v("æŒ‰ç…§å†™å…¥é¡ºåºå­˜æ”¾")]),s._v("çš„;")]),s._v(" "),t("li",[s._v("å½“æ•°æ®æ–‡ä»¶æœ‰ç©ºæ´žçš„æ—¶å€™, InnoDB è¡¨åœ¨æ’å…¥æ–°æ•°æ®çš„æ—¶å€™, "),t("strong",[s._v("ä¸ºäº†ä¿è¯æ•°æ®æœ‰åºæ€§, åªèƒ½åœ¨å›ºå®šçš„ä½ç½®å†™å…¥æ–°å€¼, è€Œå†…å­˜è¡¨æ‰¾åˆ°ç©ºä½å°±å¯ä»¥æ’å…¥æ–°å€¼")]),s._v(";")]),s._v(" "),t("li",[s._v("æ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™, InnoDB è¡¨åªéœ€è¦ä¿®æ”¹ä¸»é”®ç´¢å¼•, è€Œå†…å­˜è¡¨éœ€è¦ä¿®æ”¹æ‰€æœ‰ç´¢å¼•;")]),s._v(" "),t("li",[s._v('InnoDB è¡¨ç”¨ä¸»é”®ç´¢å¼•æŸ¥è¯¢æ—¶éœ€è¦èµ°ä¸€æ¬¡ç´¢å¼•æŸ¥æ‰¾, ç”¨æ™®é€šç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™, éœ€è¦èµ°ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾. è€Œå†…å­˜è¡¨æ²¡æœ‰è¿™ä¸ªåŒºåˆ«, æ‰€æœ‰ç´¢å¼•çš„ "åœ°ä½" éƒ½æ˜¯ç›¸åŒçš„.')]),s._v(" "),t("li",[s._v("InnoDB æ”¯æŒå˜é•¿æ•°æ®ç±»åž‹, ä¸åŒè®°å½•çš„é•¿åº¦å¯èƒ½ä¸åŒ; å†…å­˜è¡¨ä¸æ”¯æŒ Blob å’Œ Text å­—æ®µ, å¹¶ä¸”å³ä½¿å®šä¹‰äº† varchar(N), å®žé™…ä¹Ÿå½“ä½œ char(N), ä¹Ÿå°±æ˜¯å›ºå®šé•¿åº¦å­—ç¬¦ä¸²æ¥å­˜å‚¨, "),t("strong",[s._v("å› æ­¤å†…å­˜è¡¨çš„æ¯è¡Œæ•°æ®é•¿åº¦ç›¸åŒ")]),s._v(".")])]),s._v(" "),t("p",[s._v("ç”±äºŽå†…å­˜è¡¨çš„è¿™äº›ç‰¹æ€§, æ¯ä¸ªæ•°æ®è¡Œè¢«åˆ é™¤ä»¥åŽ, ç©ºå‡ºçš„è¿™ä¸ªä½ç½®éƒ½å¯ä»¥è¢«æŽ¥ä¸‹æ¥è¦æ’å…¥çš„æ•°æ®å¤ç”¨. æ¯”å¦‚, å¦‚æžœè¦åœ¨è¡¨ t1 ä¸­æ‰§è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å°±ä¼šçœ‹åˆ°è¿”å›žç»“æžœé‡Œ, id=10 è¿™ä¸€è¡Œå‡ºçŽ°åœ¨ id=4 ä¹‹åŽ, ä¹Ÿå°±æ˜¯åŽŸæ¥ id=5 è¿™è¡Œæ•°æ®çš„ä½ç½®.")]),s._v(" "),t("p",[s._v("éœ€è¦æŒ‡å‡ºçš„æ˜¯, è¡¨ t1 çš„è¿™ä¸ªä¸»é”®ç´¢å¼•æ˜¯å“ˆå¸Œç´¢å¼•, å› æ­¤å¦‚æžœæ‰§è¡Œ"),t("strong",[s._v("èŒƒå›´æŸ¥è¯¢")]),s._v(", æ¯”å¦‚")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ˜¯ç”¨ä¸ä¸Šä¸»é”®ç´¢å¼•çš„, éœ€è¦èµ°"),t("strong",[s._v("å…¨è¡¨æ‰«æ")]),s._v(". é‚£å¦‚æžœè¦è®©å†…å­˜è¡¨æ”¯æŒèŒƒå›´æ‰«æ, åº”è¯¥æ€Žä¹ˆåŠžå‘¢?")]),s._v(" "),t("h5",{attrs:{id:"hashç´¢å¼•å’Œb-treeç´¢å¼•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hashç´¢å¼•å’Œb-treeç´¢å¼•"}},[s._v("#")]),s._v(" hashç´¢å¼•å’ŒB-Treeç´¢å¼•")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, "),t("strong",[s._v("å†…å­˜è¡¨ä¹Ÿæ˜¯æ”¯æŒ B-Tree ç´¢å¼•çš„. åœ¨ id åˆ—ä¸Šåˆ›å»ºä¸€ä¸ª B-Tree ç´¢å¼•")]),s._v(", SQL è¯­å¥å¯ä»¥è¿™ä¹ˆå†™:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" a_btree_index "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("btree")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ—¶è¡¨ t1 çš„æ•°æ®ç»„ç»‡å½¢å¼å°±å˜æˆäº†è¿™æ ·:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2965ecd8c447afd7af39669232126cb3-20230731161914-w15lt75.png",alt:"",title:"å›¾4 è¡¨t1çš„æ•°æ®ç»„ç»‡-å¢žåŠ B-Treeç´¢å¼•"}})]),s._v(" "),t("p",[s._v("æ–°å¢žçš„è¿™ä¸ª B-Tree ç´¢å¼•ä½ çœ‹ç€å°±çœ¼ç†Ÿäº†, è¿™è·Ÿ InnoDB çš„ b+ æ ‘ç´¢å¼•ç»„ç»‡å½¢å¼ç±»ä¼¼.")]),s._v(" "),t("p",[s._v("ä½œä¸ºå¯¹æ¯”, å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥çš„è¾“å‡º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/763d90dd2221e013b427e1a938231b85-20230731161914-nucetz0.png",alt:"",title:"å›¾5 ä½¿ç”¨B-Treeå’Œhashç´¢å¼•æŸ¥è¯¢è¿”å›žç»“æžœå¯¹æ¯”"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, æ‰§è¡Œ "),t("code",[s._v("select * from t1 where id<5")]),s._v("â€‹ çš„æ—¶å€™, ä¼˜åŒ–å™¨ä¼š"),t("strong",[s._v("é€‰æ‹© B-Tree ç´¢å¼•")]),s._v(", æ‰€ä»¥è¿”å›žç»“æžœæ˜¯ 0 åˆ° 4. ä½¿ç”¨ force index å¼ºè¡Œä½¿ç”¨ä¸»é”® id è¿™ä¸ªç´¢å¼•, id=0 è¿™ä¸€è¡Œå°±åœ¨ç»“æžœé›†çš„æœ€æœ«å°¾äº†.")]),s._v(" "),t("p",[s._v("å…¶å®ž, ä¸€èˆ¬åœ¨æˆ‘ä»¬çš„å°è±¡ä¸­, å†…å­˜è¡¨çš„ä¼˜åŠ¿æ˜¯é€Ÿåº¦å¿«, "),t("strong",[s._v("å…¶ä¸­çš„ä¸€ä¸ªåŽŸå› å°±æ˜¯ Memory å¼•æ“Žæ”¯æŒ hash ç´¢å¼•")]),s._v(". å½“ç„¶æ›´é‡è¦çš„åŽŸå› æ˜¯, å†…å­˜è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜, è€Œå†…å­˜çš„è¯»å†™é€Ÿåº¦æ€»æ˜¯æ¯”ç£ç›˜å¿«.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, æŽ¥ä¸‹æ¥è¦è·Ÿä½ è¯´æ˜Ž, ä¸ºä»€ä¹ˆ"),t("strong",[s._v("ä¸å»ºè®®åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸Šä½¿ç”¨å†…å­˜è¡¨")]),s._v(". è¿™é‡Œçš„åŽŸå› ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢:")]),s._v(" "),t("ol",[t("li",[s._v("é”ç²’åº¦é—®é¢˜;")]),s._v(" "),t("li",[s._v("æ•°æ®æŒä¹…åŒ–é—®é¢˜.")])]),s._v(" "),t("h5",{attrs:{id:"å†…å­˜è¡¨çš„é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜è¡¨çš„é”"}},[s._v("#")]),s._v(" å†…å­˜è¡¨çš„é”")]),s._v(" "),t("p",[s._v("å…ˆæ¥è¯´è¯´å†…å­˜è¡¨çš„é”ç²’åº¦é—®é¢˜.")]),s._v(" "),t("p",[t("strong",[s._v("å†…å­˜è¡¨ä¸æ”¯æŒè¡Œé”, åªæ”¯æŒè¡¨é”")]),s._v(". å› æ­¤ä¸€å¼ è¡¨åªè¦æœ‰æ›´æ–°, å°±ä¼š"),t("strong",[s._v("å µä½å…¶ä»–æ‰€æœ‰åœ¨è¿™ä¸ªè¡¨ä¸Šçš„è¯»å†™æ“ä½œ")]),s._v(".")]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, è¿™é‡Œçš„è¡¨é”è·Ÿä¹‹å‰ä»‹ç»è¿‡çš„ MDL é”ä¸åŒ, ä½†éƒ½æ˜¯è¡¨çº§çš„é”. æŽ¥ä¸‹æ¥, æˆ‘é€šè¿‡ä¸‹é¢è¿™ä¸ªåœºæ™¯æ¥æ¨¡æ‹Ÿä¸€ä¸‹å†…å­˜è¡¨çš„è¡¨çº§é”.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b3d9cffa69660707b36d10ac0b4745e9-20230731161914-mgcd3ai.png",alt:"",title:"å›¾6 å†…å­˜è¡¨çš„è¡¨é”-å¤çŽ°æ­¥éª¤"}})]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªæ‰§è¡Œåºåˆ—é‡Œ, session A çš„ update è¯­å¥è¦æ‰§è¡Œ 50 ç§’, åœ¨è¿™ä¸ªè¯­å¥æ‰§è¡ŒæœŸé—´ session B çš„æŸ¥è¯¢ä¼šè¿›å…¥"),t("strong",[s._v("é”ç­‰å¾…çŠ¶æ€")]),s._v(". session C çš„ show processlist ç»“æžœè¾“å‡ºå¦‚ä¸‹:")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/e936d01be36f7473e8b21b93b651c217-20230731161914-6n35g6d.png",alt:"",title:"å›¾7 å†…å­˜è¡¨çš„è¡¨é”-ç»“æžœ"}}),s._v("â€‹")]),s._v(" "),t("p",[s._v("è·Ÿè¡Œé”æ¯”èµ·æ¥, è¡¨é”å¯¹å¹¶å‘è®¿é—®çš„æ”¯æŒä¸å¤Ÿå¥½. æ‰€ä»¥å†…å­˜è¡¨çš„é”ç²’åº¦é—®é¢˜, å†³å®šäº†å®ƒåœ¨å¤„ç†å¹¶å‘äº‹åŠ¡çš„æ—¶å€™, æ€§èƒ½ä¹Ÿä¸ä¼šå¤ªå¥½.")]),s._v(" "),t("h5",{attrs:{id:"æ•°æ®æŒä¹…æ€§é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®æŒä¹…æ€§é—®é¢˜"}},[s._v("#")]),s._v(" æ•°æ®æŒä¹…æ€§é—®é¢˜")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹çœ‹æ•°æ®æŒä¹…æ€§çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("æ•°æ®æ”¾åœ¨å†…å­˜ä¸­, æ˜¯å†…å­˜è¡¨çš„ä¼˜åŠ¿, ä½†ä¹Ÿæ˜¯ä¸€ä¸ªåŠ£åŠ¿. å› ä¸ºæ•°æ®åº“é‡å¯çš„æ—¶å€™, æ‰€æœ‰çš„å†…å­˜è¡¨éƒ½ä¼šè¢«æ¸…ç©º.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè¯´, å¦‚æžœæ•°æ®åº“å¼‚å¸¸é‡å¯, å†…å­˜è¡¨è¢«æ¸…ç©ºä¹Ÿå°±æ¸…ç©ºäº†, ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å•Š. ä½†æ˜¯åœ¨é«˜å¯ç”¨æž¶æž„ä¸‹, å†…å­˜è¡¨çš„è¿™ä¸ªç‰¹ç‚¹ç®€ç›´å¯ä»¥å½“åš bug æ¥çœ‹å¾…äº†. ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢?")]),s._v(" "),t("p",[s._v("**å…ˆçœ‹çœ‹ M-S æž¶æž„ä¸‹, ä½¿ç”¨å†…å­˜è¡¨å­˜åœ¨çš„é—®é¢˜. **")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f857dde661da9d0a9659b98f9894bef9-20230731161914-8d63o1v.png",alt:"",title:"å›¾8 M-SåŸºæœ¬æž¶æž„"}})]),s._v(" "),t("p",[s._v("æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªæ—¶åº:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸šåŠ¡æ­£å¸¸è®¿é—®ä¸»åº“;")]),s._v(" "),t("li",[s._v("å¤‡åº“ç¡¬ä»¶å‡çº§, å¤‡åº“é‡å¯, å†…å­˜è¡¨ t1 å†…å®¹è¢«æ¸…ç©º;")]),s._v(" "),t("li",[s._v('å¤‡åº“é‡å¯åŽ, å®¢æˆ·ç«¯å‘é€ä¸€æ¡ update è¯­å¥, ä¿®æ”¹è¡¨ t1 çš„æ•°æ®è¡Œ, è¿™æ—¶å¤‡åº“åº”ç”¨çº¿ç¨‹å°±ä¼šæŠ¥é”™"æ‰¾ä¸åˆ°è¦æ›´æ–°çš„è¡Œ".')])]),s._v(" "),t("p",[s._v('è¿™æ ·å°±ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢. å½“ç„¶å¦‚æžœè¿™æ—¶å€™å‘ç”Ÿä¸»å¤‡åˆ‡æ¢çš„è¯, å®¢æˆ·ç«¯ä¼šçœ‹åˆ°, è¡¨ t1 çš„æ•°æ®"ä¸¢å¤±"äº†.')]),s._v(" "),t("p",[s._v('åœ¨å›¾ 8 ä¸­è¿™ç§æœ‰ proxy çš„æž¶æž„é‡Œ, å¤§å®¶é»˜è®¤ä¸»å¤‡åˆ‡æ¢çš„é€»è¾‘æ˜¯ç”±æ•°æ®åº“ç³»ç»Ÿè‡ªå·±ç»´æŠ¤çš„. è¿™æ ·å¯¹å®¢æˆ·ç«¯æ¥è¯´, å°±æ˜¯ "ç½‘ç»œæ–­å¼€, é‡è¿žä¹‹åŽ, å‘çŽ°å†…å­˜è¡¨æ•°æ®ä¸¢å¤±äº†".')]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½è¯´è¿™è¿˜å¥½å•Š, æ¯•ç«Ÿä¸»å¤‡å‘ç”Ÿåˆ‡æ¢, è¿žæŽ¥ä¼šæ–­å¼€, ä¸šåŠ¡ç«¯èƒ½å¤Ÿæ„ŸçŸ¥åˆ°å¼‚å¸¸.")]),s._v(" "),t("p",[s._v('ä½†æ˜¯æŽ¥ä¸‹æ¥å†…å­˜è¡¨çš„è¿™ä¸ªç‰¹æ€§å°±ä¼šè®©ä½¿ç”¨çŽ°è±¡æ˜¾å¾—æ›´"è¯¡å¼‚"äº†. ç”±äºŽ MySQL çŸ¥é“é‡å¯ä¹‹åŽ, å†…å­˜è¡¨çš„æ•°æ®ä¼šä¸¢å¤±. æ‰€ä»¥æ‹…å¿ƒä¸»åº“é‡å¯ä¹‹åŽ, å‡ºçŽ°ä¸»å¤‡ä¸ä¸€è‡´, MySQL åœ¨å®žçŽ°ä¸Šåšäº†è¿™æ ·ä¸€ä»¶äº‹å„¿: åœ¨æ•°æ®åº“é‡å¯ä¹‹åŽ, å¾€ binlog é‡Œé¢å†™å…¥ä¸€è¡Œ DELETE FROM t1.')]),s._v(" "),t("p",[s._v("**å¦‚æžœä½ ä½¿ç”¨æ˜¯å¦‚å›¾ 9 æ‰€ç¤ºçš„åŒ M ç»“æž„çš„è¯: **")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c85e7ba88e7a59302bdb1e3b7c55198a-20230731161914-in04vya.png",alt:"",title:"å›¾9 åŒMç»“æž„"}})]),s._v(" "),t("p",[s._v("åœ¨å¤‡åº“é‡å¯çš„æ—¶å€™, "),t("strong",[s._v("å¤‡åº“ binlog é‡Œçš„ delete è¯­å¥å°±ä¼šä¼ åˆ°ä¸»åº“, ç„¶åŽæŠŠä¸»åº“å†…å­˜è¡¨çš„å†…å®¹åˆ é™¤")]),s._v(". è¿™æ ·ä½ åœ¨ä½¿ç”¨çš„æ—¶å€™å°±ä¼šå‘çŽ°, ä¸»åº“çš„å†…å­˜è¡¨æ•°æ®çªç„¶è¢«æ¸…ç©ºäº†.")]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢çš„åˆ†æž, å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("å†…å­˜è¡¨å¹¶ä¸é€‚åˆåœ¨ç”Ÿäº§çŽ¯å¢ƒä¸Šä½œä¸ºæ™®é€šæ•°æ®è¡¨ä½¿ç”¨.")])]),s._v(" "),t("p",[s._v("æœ‰åŒå­¦ä¼šè¯´, ä½†æ˜¯å†…å­˜è¡¨æ‰§è¡Œé€Ÿåº¦å¿«å‘€. è¿™ä¸ªé—®é¢˜, å…¶å®žå¯ä»¥è¿™ä¹ˆåˆ†æž:")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æžœä½ çš„è¡¨æ›´æ–°é‡å¤§, é‚£ä¹ˆå¹¶å‘åº¦æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å‚è€ƒæŒ‡æ ‡, InnoDB æ”¯æŒè¡Œé”, å¹¶å‘åº¦æ¯”å†…å­˜è¡¨å¥½;")]),s._v(" "),t("li",[s._v("èƒ½æ”¾åˆ°å†…å­˜è¡¨çš„æ•°æ®é‡éƒ½ä¸å¤§. å¦‚æžœä½ è€ƒè™‘çš„æ˜¯è¯»çš„æ€§èƒ½, ä¸€ä¸ªè¯» QPS å¾ˆé«˜å¹¶ä¸”æ•°æ®é‡ä¸å¤§çš„è¡¨, å³ä½¿æ˜¯ä½¿ç”¨ InnoDB, æ•°æ®ä¹Ÿæ˜¯éƒ½ä¼šç¼“å­˜åœ¨ InnoDB Buffer Pool é‡Œçš„. å› æ­¤ä½¿ç”¨ InnoDB è¡¨çš„è¯»æ€§èƒ½ä¹Ÿä¸ä¼šå·®.")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥**å»ºè®®æŠŠæ™®é€šå†…å­˜è¡¨éƒ½ç”¨ InnoDB è¡¨æ¥ä»£æ›¿. **")]),s._v(" "),t("p",[s._v("ä½†æ˜¯æœ‰ä¸€ä¸ªåœºæ™¯å´æ˜¯ä¾‹å¤–çš„. è¿™ä¸ªåœºæ™¯å°±æ˜¯å‰é¢è¯´åˆ°çš„ç”¨æˆ·ä¸´æ—¶è¡¨. åœ¨æ•°æ®é‡å¯æŽ§, ä¸ä¼šè€—è´¹è¿‡å¤šå†…å­˜çš„æƒ…å†µä¸‹, å¯ä»¥è€ƒè™‘ä½¿ç”¨å†…å­˜è¡¨. å†…å­˜ä¸´æ—¶è¡¨åˆšå¥½å¯ä»¥æ— è§†å†…å­˜è¡¨çš„ä¸¤ä¸ªä¸è¶³, ä¸»è¦æ˜¯ä¸‹é¢çš„ä¸‰ä¸ªåŽŸå› :")]),s._v(" "),t("ol",[t("li",[s._v("ä¸´æ—¶è¡¨ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹è®¿é—®, æ²¡æœ‰å¹¶å‘æ€§çš„é—®é¢˜;")]),s._v(" "),t("li",[s._v("ä¸´æ—¶è¡¨é‡å¯åŽä¹Ÿæ˜¯éœ€è¦åˆ é™¤çš„, æ¸…ç©ºæ•°æ®è¿™ä¸ªé—®é¢˜ä¸å­˜åœ¨;")]),s._v(" "),t("li",[s._v("å¤‡åº“çš„ä¸´æ—¶è¡¨ä¹Ÿä¸ä¼šå½±å“ä¸»åº“çš„ç”¨æˆ·çº¿ç¨‹.")])]),s._v(" "),t("p",[s._v("çŽ°åœ¨å›žè¿‡å¤´å†çœ‹ä¸€ä¸‹å‰é¢ join è¯­å¥ä¼˜åŒ–çš„ä¾‹å­, å½“æ—¶å»ºè®®çš„æ˜¯åˆ›å»ºä¸€ä¸ª InnoDB ä¸´æ—¶è¡¨, ä½¿ç”¨çš„è¯­å¥åºåˆ—æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temporary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("äº†è§£äº†å†…å­˜è¡¨çš„ç‰¹æ€§, ä½ å°±çŸ¥é“äº†, å…¶å®žè¿™é‡Œä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„æ•ˆæžœæ›´å¥½, åŽŸå› æœ‰ä¸‰ä¸ª:")]),s._v(" "),t("ol",[t("li",[s._v("ç›¸æ¯”äºŽ InnoDB è¡¨, ä½¿ç”¨å†…å­˜è¡¨ä¸éœ€è¦å†™ç£ç›˜, å¾€è¡¨ temp_t çš„å†™æ•°æ®çš„é€Ÿåº¦æ›´å¿«;")]),s._v(" "),t("li",[s._v("ç´¢å¼• b ä½¿ç”¨ hash ç´¢å¼•, æŸ¥æ‰¾çš„é€Ÿåº¦æ¯” B-Tree ç´¢å¼•å¿«;")]),s._v(" "),t("li",[s._v("ä¸´æ—¶è¡¨æ•°æ®åªæœ‰ 2000 è¡Œ, å ç”¨çš„å†…å­˜æœ‰é™.")])]),s._v(" "),t("p",[s._v("å› æ­¤å¯ä»¥å¯¹"),t("a",{attrs:{href:"https://time.geekbang.org/column/article/80147",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç¬¬ 35 ç¯‡æ–‡ç« "),t("OutboundLink")],1),s._v("çš„è¯­å¥åºåˆ—åšä¸€ä¸ªæ”¹å†™, å°†ä¸´æ—¶è¡¨ t1 æ”¹æˆå†…å­˜ä¸´æ—¶è¡¨, å¹¶ä¸”åœ¨å­—æ®µ b ä¸Šåˆ›å»ºä¸€ä¸ª hash ç´¢å¼•.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temporary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("memory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" temp_t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/5d3d714bb040bc8ba37e41bcf006414f-20230731161914-dn1zsjy.png",alt:"",title:"å›¾10 ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„æ‰§è¡Œæ•ˆæžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ä¸è®ºæ˜¯å¯¼å…¥æ•°æ®çš„æ—¶é—´, è¿˜æ˜¯æ‰§è¡Œ join çš„æ—¶é—´, ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„é€Ÿåº¦éƒ½æ¯”ä½¿ç”¨ InnoDB ä¸´æ—¶è¡¨è¦æ›´å¿«ä¸€äº›.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-36"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-36"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v('æœ¬èŠ‚ä»Ž"è¦ä¸è¦ä½¿ç”¨å†…å­˜è¡¨"è¿™ä¸ªé—®é¢˜å±•å¼€, ä»‹ç»äº† Memory å¼•æ“Žçš„å‡ ä¸ªç‰¹æ€§. å¯ä»¥çœ‹åˆ°, '),t("strong",[s._v("ç”±äºŽé‡å¯ä¼šä¸¢æ•°æ®, å¦‚æžœä¸€ä¸ªå¤‡åº“é‡å¯, ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥çº¿ç¨‹åœæ­¢; å¦‚æžœä¸»åº“è·Ÿè¿™ä¸ªå¤‡åº“æ˜¯åŒ M æž¶æž„, è¿˜å¯èƒ½å¯¼è‡´ä¸»åº“çš„å†…å­˜è¡¨æ•°æ®è¢«åˆ æŽ‰. å› æ­¤, åœ¨ç”Ÿäº§ä¸Šä¸å»ºè®®ä½¿ç”¨æ™®é€šå†…å­˜è¡¨")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æžœä½ æ˜¯ DBA, å¯ä»¥åœ¨å»ºè¡¨çš„å®¡æ ¸ç³»ç»Ÿä¸­å¢žåŠ è¿™ç±»è§„åˆ™, è¦æ±‚ä¸šåŠ¡æ”¹ç”¨ InnoDB è¡¨. æ–‡ä¸­ä¹Ÿåˆ†æžäº†, å…¶å®ž InnoDB è¡¨æ€§èƒ½è¿˜ä¸é”™, è€Œä¸”æ•°æ®å®‰å…¨ä¹Ÿæœ‰ä¿éšœ. è€Œå†…å­˜è¡¨ç”±äºŽä¸æ”¯æŒè¡Œé”, æ›´æ–°è¯­å¥ä¼šé˜»å¡žæŸ¥è¯¢, æ€§èƒ½ä¹Ÿæœªå¿…å°±å¦‚æƒ³è±¡ä¸­é‚£ä¹ˆå¥½.")]),s._v(" "),t("p",[s._v("åŸºäºŽå†…å­˜è¡¨çš„ç‰¹æ€§, è¿˜åˆ†æžäº†"),t("strong",[s._v("å®ƒçš„ä¸€ä¸ªé€‚ç”¨åœºæ™¯, å°±æ˜¯å†…å­˜ä¸´æ—¶è¡¨")]),s._v(". å†…å­˜è¡¨æ”¯æŒ hash ç´¢å¼•, è¿™ä¸ªç‰¹æ€§åˆ©ç”¨èµ·æ¥, å¯¹å¤æ‚æŸ¥è¯¢çš„åŠ é€Ÿæ•ˆæžœè¿˜æ˜¯å¾ˆä¸é”™çš„.")]),s._v(" "),t("h4",{attrs:{id:"_39-è‡ªå¢žä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿žç»­çš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_39-è‡ªå¢žä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿žç»­çš„"}},[s._v("#")]),s._v(" 39-è‡ªå¢žä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿žç»­çš„?")]),s._v(" "),t("p",[s._v("è‡ªå¢žä¸»é”®å¯ä»¥è®©ä¸»é”®ç´¢å¼•å°½é‡åœ°ä¿æŒé€’å¢žé¡ºåºæ’å…¥, é¿å…äº†é¡µåˆ†è£‚, å› æ­¤ç´¢å¼•æ›´ç´§å‡‘. ä¹‹å‰æˆ‘è§è¿‡æœ‰çš„ä¸šåŠ¡è®¾è®¡ä¾èµ–äºŽè‡ªå¢žä¸»é”®çš„è¿žç»­æ€§, ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªè®¾è®¡"),t("strong",[s._v("å‡è®¾è‡ªå¢žä¸»é”®æ˜¯è¿žç»­")]),s._v("çš„. ä½†å®žé™…ä¸Š, è¿™æ ·çš„å‡è®¾æ˜¯é”™çš„, "),t("strong",[s._v("å› ä¸ºè‡ªå¢žä¸»é”®ä¸èƒ½ä¿è¯è¿žç»­é€’å¢ž")]),s._v(".")]),s._v(" "),t("p",[s._v('æœ¬èŠ‚å°±æ¥è¯´è¯´è¿™ä¸ªé—®é¢˜, çœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹è‡ªå¢žä¸»é”®ä¼šå‡ºçŽ° "ç©ºæ´ž"?')]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽè¯´æ˜Ž, æ¥åˆ›å»ºä¸€ä¸ªè¡¨ t, å…¶ä¸­ id æ˜¯è‡ªå¢žä¸»é”®å­—æ®µ, c æ˜¯å”¯ä¸€ç´¢å¼•.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"è‡ªå¢žå€¼ä¿å­˜åœ¨å“ªå„¿"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªå¢žå€¼ä¿å­˜åœ¨å“ªå„¿"}},[s._v("#")]),s._v(" è‡ªå¢žå€¼ä¿å­˜åœ¨å“ªå„¿?")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªç©ºè¡¨ t é‡Œé¢æ‰§è¡Œ "),t("code",[s._v("insert into t values(null, 1, 1);")]),s._v("â€‹ æ’å…¥ä¸€è¡Œæ•°æ®, å†æ‰§è¡Œ show create table å‘½ä»¤, å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç»“æžœ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/90caa594d6f29bd0b9791375b4e989b3-20230731161914-dh2ajrv.png",alt:"",title:"å›¾1 è‡ªåŠ¨ç”Ÿæˆçš„AUTO_INCREMENTå€¼"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¡¨å®šä¹‰é‡Œé¢å‡ºçŽ°äº†ä¸€ä¸ª AUTO_INCREMENT=2, è¡¨ç¤ºä¸‹ä¸€æ¬¡æ’å…¥æ•°æ®æ—¶, å¦‚æžœéœ€è¦è‡ªåŠ¨ç”Ÿæˆè‡ªå¢žå€¼, ä¼šç”Ÿæˆ id=2.")]),s._v(" "),t("p",[s._v("å…¶å®ž, è¿™ä¸ªè¾“å‡ºç»“æžœå®¹æ˜“å¼•èµ·è¿™æ ·çš„è¯¯è§£: è‡ªå¢žå€¼æ˜¯ä¿å­˜åœ¨è¡¨ç»“æž„å®šä¹‰é‡Œçš„. å®žé™…ä¸Š, **è¡¨çš„ç»“æž„å®šä¹‰å­˜æ”¾åœ¨åŽç¼€åä¸º .frm çš„æ–‡ä»¶ä¸­, ä½†æ˜¯å¹¶ä¸ä¼šä¿å­˜è‡ªå¢žå€¼. **")]),s._v(" "),t("p",[s._v("ä¸åŒçš„å¼•æ“Žå¯¹äºŽè‡ªå¢žå€¼çš„ä¿å­˜ç­–ç•¥ä¸åŒ.")]),s._v(" "),t("ul",[t("li",[s._v("MyISAM å¼•æ“Žçš„è‡ªå¢žå€¼ä¿å­˜åœ¨æ•°æ®æ–‡ä»¶ä¸­.")]),s._v(" "),t("li",[s._v("InnoDB å¼•æ“Žçš„è‡ªå¢žå€¼, å…¶å®žæ˜¯"),t("strong",[s._v("ä¿å­˜åœ¨äº†å†…å­˜é‡Œ")]),s._v(', å¹¶ä¸”åˆ°äº† MySQL 8.0 ç‰ˆæœ¬åŽ, æ‰æœ‰äº† "è‡ªå¢žå€¼æŒä¹…åŒ–" çš„èƒ½åŠ›, ä¹Ÿå°±æ˜¯æ‰å®žçŽ°äº†"å¦‚æžœå‘ç”Ÿé‡å¯, è¡¨çš„è‡ªå¢žå€¼å¯ä»¥æ¢å¤ä¸º MySQL é‡å¯å‰çš„å€¼", å…·ä½“æƒ…å†µæ˜¯: (1) åœ¨ MySQL 5.7 åŠä¹‹å‰çš„ç‰ˆæœ¬, è‡ªå¢žå€¼ä¿å­˜åœ¨å†…å­˜é‡Œ, '),t("strong",[s._v("å¹¶æ²¡æœ‰æŒä¹…åŒ–")]),s._v(". æ¯æ¬¡é‡å¯åŽ, ç¬¬ä¸€æ¬¡æ‰“å¼€è¡¨çš„æ—¶å€™, éƒ½ä¼šåŽ»æ‰¾è‡ªå¢žå€¼çš„"),t("strong",[s._v("æœ€å¤§å€¼ max(id)")]),s._v(" , ç„¶åŽå°† max(id)+1 ä½œä¸ºè¿™ä¸ªè¡¨å½“å‰çš„è‡ªå¢žå€¼. \ufeffä¸¾ä¾‹æ¥è¯´, å¦‚æžœä¸€ä¸ªè¡¨å½“å‰æ•°æ®è¡Œé‡Œæœ€å¤§çš„ id æ˜¯ 10, AUTO_INCREMENT=11. è¿™æ—¶å€™, æˆ‘ä»¬åˆ é™¤ id=10 çš„è¡Œ, AUTO_INCREMENT è¿˜æ˜¯ 11. ä½†å¦‚æžœé©¬ä¸Šé‡å¯å®žä¾‹, é‡å¯åŽè¿™ä¸ªè¡¨çš„ AUTO_INCREMENT å°±ä¼šå˜æˆ 10. \ufeffä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("MySQL é‡å¯å¯èƒ½ä¼šä¿®æ”¹ä¸€ä¸ªè¡¨çš„ AUTO_INCREMENT çš„å€¼")]),s._v(". (2) åœ¨ MySQL 8.0 ç‰ˆæœ¬, "),t("strong",[s._v("å°†è‡ªå¢žå€¼çš„å˜æ›´è®°å½•åœ¨äº† redo log ä¸­")]),s._v(", é‡å¯çš„æ—¶å€™ä¾é  redo log æ¢å¤é‡å¯ä¹‹å‰çš„å€¼.")])]),s._v(" "),t("p",[s._v("ç†è§£äº† MySQL å¯¹è‡ªå¢žå€¼çš„ä¿å­˜ç­–ç•¥ä»¥åŽ, å†çœ‹çœ‹è‡ªå¢žå€¼ä¿®æ”¹æœºåˆ¶.")]),s._v(" "),t("h5",{attrs:{id:"è‡ªå¢žå€¼ä¿®æ”¹æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªå¢žå€¼ä¿®æ”¹æœºåˆ¶"}},[s._v("#")]),s._v(" è‡ªå¢žå€¼ä¿®æ”¹æœºåˆ¶")]),s._v(" "),t("p",[s._v("åœ¨ MySQL é‡Œé¢, å¦‚æžœå­—æ®µ id è¢«å®šä¹‰ä¸º AUTO_INCREMENT, åœ¨æ’å…¥ä¸€è¡Œæ•°æ®çš„æ—¶å€™, è‡ªå¢žå€¼çš„è¡Œä¸ºå¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¦‚æžœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šä¸º 0, null æˆ–æœªæŒ‡å®šå€¼, é‚£ä¹ˆå°±æŠŠè¿™ä¸ªè¡¨å½“å‰çš„ AUTO_INCREMENT å€¼å¡«åˆ°è‡ªå¢žå­—æ®µ;")])]),s._v(" "),t("li",[t("strong",[s._v("å¦‚æžœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šäº†å…·ä½“çš„å€¼, å°±ç›´æŽ¥ä½¿ç”¨è¯­å¥é‡ŒæŒ‡å®šçš„å€¼.")])])]),s._v(" "),t("p",[s._v("æ ¹æ®è¦æ’å…¥çš„å€¼å’Œå½“å‰è‡ªå¢žå€¼çš„å¤§å°å…³ç³», è‡ªå¢žå€¼çš„å˜æ›´ç»“æžœä¹Ÿä¼šæœ‰æ‰€ä¸åŒ. å‡è®¾æŸæ¬¡è¦æ’å…¥çš„å€¼æ˜¯ X, å½“å‰çš„è‡ªå¢žå€¼æ˜¯ Y.")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¦‚æžœ X<Y, é‚£ä¹ˆè¿™ä¸ªè¡¨çš„è‡ªå¢žå€¼ä¸å˜")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("å¦‚æžœ Xâ‰¥Y, å°±éœ€è¦æŠŠå½“å‰è‡ªå¢žå€¼ä¿®æ”¹ä¸ºæ–°çš„è‡ªå¢žå€¼")]),s._v(".")])]),s._v(" "),t("p",[t("strong",[s._v("æ–°çš„è‡ªå¢žå€¼ç”Ÿæˆç®—æ³•æ˜¯")]),s._v(": ä»Ž auto_increment_offset å¼€å§‹, ä»¥ auto_increment_increment ä¸ºæ­¥é•¿, æŒç»­å åŠ , ç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºŽ X çš„å€¼, ä½œä¸ºæ–°çš„è‡ªå¢žå€¼.")]),s._v(" "),t("p",[s._v("å…¶ä¸­, auto_increment_offset å’Œ auto_increment_increment æ˜¯ä¸¤ä¸ªç³»ç»Ÿå‚æ•°, åˆ†åˆ«ç”¨æ¥è¡¨ç¤ºè‡ªå¢žçš„"),t("strong",[s._v("åˆå§‹å€¼å’Œæ­¥é•¿")]),s._v(", é»˜è®¤å€¼éƒ½æ˜¯ 1.")]),s._v(" "),t("p",[s._v("å¤‡æ³¨: åœ¨ä¸€äº›åœºæ™¯ä¸‹, ä½¿ç”¨çš„å°±ä¸å…¨æ˜¯é»˜è®¤å€¼. æ¯”å¦‚åŒ M çš„ä¸»å¤‡ç»“æž„é‡Œè¦æ±‚åŒå†™çš„æ—¶å€™, å°±å¯èƒ½ä¼šè®¾ç½®æˆ auto_increment_increment=2, è®©ä¸€ä¸ªåº“çš„è‡ªå¢ž id éƒ½æ˜¯å¥‡æ•°, å¦ä¸€ä¸ªåº“çš„è‡ªå¢ž id éƒ½æ˜¯å¶æ•°, é¿å…ä¸¤ä¸ªåº“ç”Ÿæˆçš„ä¸»é”®å‘ç”Ÿå†²çª.")]),s._v(" "),t("p",[s._v("å½“ auto_increment_offset å’Œ auto_increment_increment éƒ½æ˜¯ 1 çš„æ—¶å€™, æ–°çš„è‡ªå¢žå€¼ç”Ÿæˆé€»è¾‘å¾ˆç®€å•, å°±æ˜¯:")]),s._v(" "),t("ol",[t("li",[s._v('å¦‚æžœå‡†å¤‡æ’å…¥çš„å€¼ >= å½“å‰è‡ªå¢žå€¼, æ–°çš„è‡ªå¢žå€¼å°±æ˜¯ "å‡†å¤‡æ’å…¥çš„å€¼ +1";')]),s._v(" "),t("li",[s._v("å¦åˆ™, è‡ªå¢žå€¼ä¸å˜.")])]),s._v(" "),t("p",[s._v("è¿™å°±å¼•å…¥äº†å¼€å¤´æåˆ°çš„é—®é¢˜, "),t("strong",[s._v("åœ¨è¿™ä¸¤ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸º 1 çš„æ—¶å€™, è‡ªå¢žä¸»é”® id å´ä¸èƒ½ä¿è¯æ˜¯è¿žç»­çš„, è¿™æ˜¯ä»€ä¹ˆåŽŸå› ")]),s._v("å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"è‡ªå¢žå€¼çš„ä¿®æ”¹æ—¶æœº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªå¢žå€¼çš„ä¿®æ”¹æ—¶æœº"}},[s._v("#")]),s._v(" è‡ªå¢žå€¼çš„ä¿®æ”¹æ—¶æœº")]),s._v(" "),t("p",[s._v("è¦å›žç­”è¿™ä¸ªé—®é¢˜, å°±è¦çœ‹ä¸€ä¸‹è‡ªå¢žå€¼çš„ä¿®æ”¹æ—¶æœº.")]),s._v(" "),t("p",[s._v("å‡è®¾, è¡¨ t é‡Œé¢å·²ç»æœ‰äº† (1,1,1) è¿™æ¡è®°å½•, è¿™æ—¶å†æ‰§è¡Œä¸€æ¡æ’å…¥æ•°æ®å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹å°±æ˜¯:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰§è¡Œå™¨è°ƒç”¨ InnoDB å¼•æ“ŽæŽ¥å£å†™å…¥ä¸€è¡Œ, ä¼ å…¥çš„è¿™ä¸€è¡Œçš„å€¼æ˜¯ (0,1,1);")]),s._v(" "),t("li",[s._v("InnoDB å‘çŽ°ç”¨æˆ·æ²¡æœ‰æŒ‡å®šè‡ªå¢ž id çš„å€¼, èŽ·å–è¡¨ t å½“å‰çš„è‡ªå¢žå€¼ 2;")]),s._v(" "),t("li",[s._v("å°†ä¼ å…¥çš„è¡Œçš„å€¼æ”¹æˆ (2,1,1);")]),s._v(" "),t("li",[s._v("å°†è¡¨çš„è‡ªå¢žå€¼æ”¹æˆ 3;")]),s._v(" "),t("li",[s._v("ç»§ç»­æ‰§è¡Œæ’å…¥æ•°æ®æ“ä½œ, ç”±äºŽå·²ç»å­˜åœ¨ c=1 çš„è®°å½•, æ‰€ä»¥æŠ¥ Duplicate key error, è¯­å¥è¿”å›ž.")])]),s._v(" "),t("p",[s._v("å¯¹åº”çš„æ‰§è¡Œæµç¨‹å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cb89c8a6fbdd9d6a4f0e4b347e61ce5c-20230731161914-omm0w8e.png",alt:"",title:"å›¾2 insert(null, 1,1)å”¯ä¸€é”®å†²çª"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("è¿™ä¸ªè¡¨çš„è‡ªå¢žå€¼æ”¹æˆ 3, æ˜¯åœ¨çœŸæ­£æ‰§è¡Œæ’å…¥æ•°æ®çš„æ“ä½œä¹‹å‰")]),s._v(". è¿™ä¸ªè¯­å¥çœŸæ­£æ‰§è¡Œçš„æ—¶å€™, å› ä¸ºç¢°åˆ°å”¯ä¸€é”® c å†²çª, æ‰€ä»¥ id=2 è¿™ä¸€è¡Œå¹¶æ²¡æœ‰æ’å…¥æˆåŠŸ, "),t("mark",[t("strong",[s._v("ä½†ä¹Ÿæ²¡æœ‰å°†è‡ªå¢žå€¼å†æ”¹å›žåŽ»")])]),s._v(". æ‰€ä»¥åœ¨è¿™ä¹‹åŽ, å†æ’å…¥æ–°çš„æ•°æ®è¡Œæ—¶, æ‹¿åˆ°çš„è‡ªå¢ž id å°±æ˜¯ 3. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("å‡ºçŽ°äº†è‡ªå¢žä¸»é”®ä¸è¿žç»­")]),s._v("çš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤ºå°±æ˜¯å®Œæ•´çš„æ¼”ç¤ºç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/659aca97ffcf5d4d30e33cc43289f02d-20230731161914-4z9jwkj.png",alt:"",title:"å›¾3 ä¸€ä¸ªè‡ªå¢žä¸»é”®idä¸è¿žç»­çš„å¤çŽ°æ­¥éª¤"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªæ“ä½œåºåˆ—å¤çŽ°äº†ä¸€ä¸ªè‡ªå¢žä¸»é”® id ä¸è¿žç»­çš„çŽ°åœº (æ²¡æœ‰ id=2 çš„è¡Œ). å¯è§, "),t("mark",[t("strong",[s._v("å”¯ä¸€é”®å†²çªæ˜¯å¯¼è‡´è‡ªå¢žä¸»é”® id ä¸è¿žç»­çš„ç¬¬ä¸€ç§åŽŸå› ")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("åŒæ ·åœ°, "),t("mark",[t("strong",[s._v("äº‹åŠ¡å›žæ»šä¹Ÿä¼šäº§ç”Ÿç±»ä¼¼çš„çŽ°è±¡, è¿™å°±æ˜¯ç¬¬äºŒç§åŽŸå› ")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("ä¸‹é¢è¿™ä¸ªè¯­å¥åºåˆ—å°±å¯ä»¥æž„é€ ä¸è¿žç»­çš„è‡ªå¢ž id, å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rollback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ’å…¥çš„è¡Œæ˜¯(3,2,2)")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, ä¸ºä»€ä¹ˆåœ¨å‡ºçŽ°å”¯ä¸€é”®å†²çªæˆ–è€…å›žæ»šçš„æ—¶å€™, MySQL æ²¡æœ‰æŠŠè¡¨ t çš„è‡ªå¢žå€¼æ”¹å›žåŽ»å‘¢? å¦‚æžœæŠŠè¡¨ t çš„å½“å‰è‡ªå¢žå€¼ä»Ž 3 æ”¹å›ž 2, å†æ’å…¥æ–°æ•°æ®çš„æ—¶å€™, ä¸å°±å¯ä»¥ç”Ÿæˆ id=2 çš„ä¸€è¡Œæ•°æ®äº†å—?")]),s._v(" "),t("p",[s._v("å…¶å®ž, "),t("strong",[s._v("MySQL è¿™ä¹ˆè®¾è®¡æ˜¯ä¸ºäº†æå‡æ€§èƒ½")]),s._v(". æŽ¥ä¸‹æ¥å°±æžä¸€ä¸‹è¿™ä¸ªè®¾è®¡æ€è·¯, çœ‹çœ‹"),t("mark",[t("strong",[s._v("è‡ªå¢žå€¼ä¸ºä»€ä¹ˆä¸èƒ½å›žé€€")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("å‡è®¾æœ‰ä¸¤ä¸ªå¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡, åœ¨ç”³è¯·è‡ªå¢žå€¼çš„æ—¶å€™, "),t("strong",[s._v("ä¸ºäº†é¿å…ä¸¤ä¸ªäº‹åŠ¡ç”³è¯·åˆ°ç›¸åŒçš„è‡ªå¢ž id, è‚¯å®šè¦åŠ é”, ç„¶åŽé¡ºåºç”³è¯·")]),s._v(".")]),s._v(" "),t("ol",[t("li",[s._v("å‡è®¾äº‹åŠ¡ A ç”³è¯·åˆ°äº† id=2, äº‹åŠ¡ B ç”³è¯·åˆ° id=3, é‚£ä¹ˆè¿™æ—¶å€™è¡¨ t çš„è‡ªå¢žå€¼æ˜¯ 4, ä¹‹åŽç»§ç»­æ‰§è¡Œ.")]),s._v(" "),t("li",[s._v("äº‹åŠ¡ B æ­£ç¡®æäº¤äº†, ä½†äº‹åŠ¡ A å‡ºçŽ°äº†å”¯ä¸€é”®å†²çª.")]),s._v(" "),t("li",[s._v("å¦‚æžœå…è®¸äº‹åŠ¡ A æŠŠè‡ªå¢ž id å›žé€€, ä¹Ÿå°±æ˜¯æŠŠè¡¨ t çš„å½“å‰è‡ªå¢žå€¼æ”¹å›ž 2, é‚£ä¹ˆå°±ä¼šå‡ºçŽ°è¿™æ ·çš„æƒ…å†µ: è¡¨é‡Œé¢å·²ç»æœ‰ id=3 çš„è¡Œ, è€Œå½“å‰çš„è‡ªå¢ž id å€¼æ˜¯ 2.")]),s._v(" "),t("li",[s._v('æŽ¥ä¸‹æ¥, ç»§ç»­æ‰§è¡Œçš„å…¶ä»–äº‹åŠ¡å°±ä¼šç”³è¯·åˆ° id=2, ç„¶åŽå†ç”³è¯·åˆ° id=3. è¿™æ—¶å°±ä¼šå‡ºçŽ°æ’å…¥è¯­å¥æŠ¥é”™"ä¸»é”®å†²çª".')])]),s._v(" "),t("p",[s._v("è€Œä¸ºäº†è§£å†³è¿™ä¸ªä¸»é”®å†²çª, æœ‰ä¸¤ç§æ–¹æ³•:")]),s._v(" "),t("ol",[t("li",[s._v("æ¯æ¬¡ç”³è¯· id ä¹‹å‰, å…ˆåˆ¤æ–­è¡¨é‡Œé¢æ˜¯å¦å·²ç»å­˜åœ¨è¿™ä¸ª id. å¦‚æžœå­˜åœ¨, å°±è·³è¿‡è¿™ä¸ª id. ä½†æ˜¯è¿™ä¸ªæ–¹æ³•çš„æˆæœ¬å¾ˆé«˜. å› ä¸ºæœ¬æ¥ç”³è¯· id æ˜¯ä¸€ä¸ªå¾ˆå¿«çš„æ“ä½œ, çŽ°åœ¨è¿˜è¦å†åŽ»ä¸»é”®ç´¢å¼•æ ‘ä¸Šåˆ¤æ–­ id æ˜¯å¦å­˜åœ¨.")]),s._v(" "),t("li",[s._v("æŠŠè‡ªå¢ž id çš„é”èŒƒå›´æ‰©å¤§, å¿…é¡»ç­‰åˆ°ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆå¹¶æäº¤, ä¸‹ä¸€ä¸ªäº‹åŠ¡æ‰èƒ½å†ç”³è¯·è‡ªå¢ž id. è¿™ä¸ªæ–¹æ³•çš„é—®é¢˜, å°±æ˜¯é”çš„ç²’åº¦å¤ªå¤§, ç³»ç»Ÿå¹¶å‘èƒ½åŠ›å¤§å¤§ä¸‹é™.")])]),s._v(" "),t("p",[s._v('å¯è§, è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜. é€ æˆè¿™äº›éº»çƒ¦çš„ç½ªé­ç¥¸é¦–, å°±æ˜¯å‡è®¾çš„è¿™ä¸ª"å…è®¸è‡ªå¢ž id å›žé€€"çš„å‰æå¯¼è‡´çš„. å› æ­¤, InnoDB æ”¾å¼ƒäº†è¿™ä¸ªè®¾è®¡, '),t("mark",[t("strong",[s._v("è¯­å¥æ‰§è¡Œå¤±è´¥ä¹Ÿä¸å›žé€€è‡ªå¢ž id. ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™æ ·, æ‰€ä»¥æ‰åªä¿è¯äº†è‡ªå¢ž id æ˜¯é€’å¢žçš„, ä½†ä¸ä¿è¯æ˜¯è¿žç»­çš„")])]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"è‡ªå¢žé”çš„ä¼˜åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªå¢žé”çš„ä¼˜åŒ–"}},[s._v("#")]),s._v(" è‡ªå¢žé”çš„ä¼˜åŒ–")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è‡ªå¢ž id é”å¹¶ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡é”, è€Œæ˜¯æ¯æ¬¡ç”³è¯·å®Œå°±é©¬ä¸Šé‡Šæ”¾, ä»¥ä¾¿å…è®¸åˆ«çš„äº‹åŠ¡å†ç”³è¯·. å…¶å®žåœ¨ MySQL 5.1 ç‰ˆæœ¬ä¹‹å‰, å¹¶ä¸æ˜¯è¿™æ ·çš„. æŽ¥ä¸‹æ¥å…ˆä»‹ç»ä¸‹è‡ªå¢žé”è®¾è®¡çš„åŽ†å², è¿™æ ·æœ‰åŠ©äºŽä½ åˆ†æžæŽ¥ä¸‹æ¥çš„ä¸€ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("åœ¨ MySQL 5.0 ç‰ˆæœ¬çš„æ—¶å€™, è‡ªå¢žé”çš„èŒƒå›´æ˜¯è¯­å¥çº§åˆ«. ä¹Ÿå°±æ˜¯è¯´, å¦‚æžœä¸€ä¸ªè¯­å¥ç”³è¯·äº†ä¸€ä¸ªè¡¨è‡ªå¢žé”, è¿™ä¸ªé”ä¼šç­‰è¯­å¥æ‰§è¡Œç»“æŸä»¥åŽæ‰é‡Šæ”¾. æ˜¾ç„¶è¿™æ ·è®¾è®¡ä¼šå½±å“å¹¶å‘åº¦.")]),s._v(" "),t("p",[s._v("MySQL 5.1.22 ç‰ˆæœ¬å¼•å…¥äº†ä¸€ä¸ªæ–°ç­–ç•¥, æ–°å¢žå‚æ•° innodb_autoinc_lock_mode, é»˜è®¤å€¼æ˜¯ 1.")]),s._v(" "),t("ol",[t("li",[s._v("è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 0 æ—¶, è¡¨ç¤ºé‡‡ç”¨ä¹‹å‰ MySQL 5.0 ç‰ˆæœ¬çš„ç­–ç•¥, å³è¯­å¥æ‰§è¡Œç»“æŸåŽæ‰é‡Šæ”¾é”;")]),s._v(" "),t("li",[s._v("è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 1 æ—¶: (1) æ™®é€š insert è¯­å¥, è‡ªå¢žé”åœ¨ç”³è¯·ä¹‹åŽå°±é©¬ä¸Šé‡Šæ”¾; (2) ç±»ä¼¼ "),t("code",[s._v("insert ... select")]),s._v("â€‹ è¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥, è‡ªå¢žé”è¿˜æ˜¯è¦ç­‰è¯­å¥ç»“æŸåŽæ‰è¢«é‡Šæ”¾;")]),s._v(" "),t("li",[s._v("è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 2 æ—¶, æ‰€æœ‰çš„ç”³è¯·è‡ªå¢žä¸»é”®çš„åŠ¨ä½œéƒ½æ˜¯ç”³è¯·åŽå°±é‡Šæ”¾é”.")])]),s._v(" "),t("p",[s._v("ä½ ä¸€å®šæœ‰ä¸¤ä¸ªç–‘é—®: **ä¸ºä»€ä¹ˆé»˜è®¤è®¾ç½®ä¸‹, insert ... select è¦ä½¿ç”¨è¯­å¥çº§çš„é”? ä¸ºä»€ä¹ˆè¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ä¸æ˜¯ 2? **")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯, è¿™ä¹ˆè®¾è®¡è¿˜æ˜¯ä¸ºäº†"),t("strong",[s._v("æ•°æ®çš„ä¸€è‡´æ€§")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/24ff4911ebde0fd8153d480d798e6106-20230731161914-n9o5p8v.png",alt:"",title:"å›¾4 æ‰¹é‡æ’å…¥æ•°æ®çš„è‡ªå¢žé”"}})]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªä¾‹å­é‡Œ, å¾€è¡¨ t1 ä¸­æ’å…¥äº† 4 è¡Œæ•°æ®, ç„¶åŽåˆ›å»ºäº†ä¸€ä¸ªç›¸åŒç»“æž„çš„è¡¨ t2, ç„¶åŽä¸¤ä¸ª session åŒæ—¶æ‰§è¡Œå‘è¡¨ t2 ä¸­æ’å…¥æ•°æ®çš„æ“ä½œ.")]),s._v(" "),t("p",[s._v("å¯ä»¥è®¾æƒ³ä¸€ä¸‹, å¦‚æžœ session B æ˜¯ç”³è¯·äº†è‡ªå¢žå€¼ä»¥åŽé©¬ä¸Šå°±é‡Šæ”¾è‡ªå¢žé”, é‚£ä¹ˆå°±å¯èƒ½å‡ºçŽ°è¿™æ ·çš„æƒ…å†µ:")]),s._v(" "),t("ul",[t("li",[s._v("session B å…ˆæ’å…¥äº†ä¸¤ä¸ªè®°å½•, (1,1,1), (2,2,2);")]),s._v(" "),t("li",[s._v("ç„¶åŽ, session A æ¥ç”³è¯·è‡ªå¢ž id å¾—åˆ° id=3, æ’å…¥äº†(3,5,5);")]),s._v(" "),t("li",[s._v("ä¹‹åŽ, session B ç»§ç»­æ‰§è¡Œ, æ’å…¥ä¸¤æ¡è®°å½• (4,3,3), (5,4,4).")])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè¯´, è¿™ä¹Ÿæ²¡å…³ç³»å§, æ¯•ç«Ÿ session B çš„è¯­ä¹‰æœ¬èº«å°±æ²¡æœ‰è¦æ±‚è¡¨ t2 çš„æ‰€æœ‰è¡Œçš„æ•°æ®éƒ½è·Ÿ session A ç›¸åŒ. æ˜¯çš„, ä»Žæ•°æ®é€»è¾‘ä¸Šçœ‹æ˜¯å¯¹çš„. ä½†å¦‚æžœçŽ°åœ¨çš„ binlog_format=statement, å¯ä»¥è®¾æƒ³ä¸‹, binlog ä¼šæ€Žä¹ˆè®°å½•å‘¢?")]),s._v(" "),t("p",[s._v("ç”±äºŽä¸¤ä¸ª session æ˜¯åŒæ—¶æ‰§è¡Œæ’å…¥æ•°æ®å‘½ä»¤çš„, æ‰€ä»¥ binlog é‡Œé¢å¯¹è¡¨ t2 çš„æ›´æ–°æ—¥å¿—åªæœ‰ä¸¤ç§æƒ…å†µ: è¦ä¹ˆå…ˆè®° session A çš„, è¦ä¹ˆå…ˆè®° session B çš„.")]),s._v(" "),t("p",[s._v("ä½†ä¸è®ºæ˜¯å“ªä¸€ç§, è¿™ä¸ª binlog æ‹¿åŽ»ä»Žåº“æ‰§è¡Œ, æˆ–è€…ç”¨æ¥æ¢å¤ä¸´æ—¶å®žä¾‹, å¤‡åº“å’Œä¸´æ—¶å®žä¾‹é‡Œé¢, session B è¿™ä¸ªè¯­å¥æ‰§è¡Œå‡ºæ¥, ç”Ÿæˆçš„ç»“æžœé‡Œé¢, id éƒ½æ˜¯è¿žç»­çš„. è¿™æ—¶è¿™ä¸ªåº“å°±å‘ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´.")]),s._v(" "),t("p",[s._v("ä½ å¯ä»¥åˆ†æžä¸€ä¸‹, å‡ºçŽ°è¿™ä¸ªé—®é¢˜çš„åŽŸå› æ˜¯ä»€ä¹ˆ?")]),s._v(" "),t("p",[s._v("å…¶å®ž, è¿™æ˜¯"),t("strong",[s._v("å› ä¸ºåŽŸåº“ session B çš„ insert è¯­å¥, ç”Ÿæˆçš„ id ä¸è¿žç»­")]),s._v(". è¿™ä¸ªä¸è¿žç»­çš„ id, ç”¨ statement æ ¼å¼çš„ binlog æ¥ä¸²è¡Œæ‰§è¡Œ, æ˜¯æ‰§è¡Œä¸å‡ºæ¥çš„.")]),s._v(" "),t("p",[s._v("è€Œè¦è§£å†³è¿™ä¸ªé—®é¢˜, æœ‰ä¸¤ç§æ€è·¯:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸€ç§æ€è·¯æ˜¯, è®©åŽŸåº“çš„æ‰¹é‡æ’å…¥æ•°æ®è¯­å¥, å›ºå®šç”Ÿæˆè¿žç»­çš„ id å€¼. æ‰€ä»¥è‡ªå¢žé”ç›´åˆ°è¯­å¥æ‰§è¡Œç»“æŸæ‰é‡Šæ”¾, å°±æ˜¯ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„.")]),s._v(" "),t("li",[s._v("å¦ä¸€ç§æ€è·¯æ˜¯, åœ¨ binlog é‡Œé¢æŠŠæ’å…¥æ•°æ®çš„æ“ä½œéƒ½å¦‚å®žè®°å½•è¿›æ¥, åˆ°å¤‡åº“æ‰§è¡Œçš„æ—¶å€™, ä¸å†ä¾èµ–äºŽè‡ªå¢žä¸»é”®åŽ»ç”Ÿæˆ. è¿™ç§æƒ…å†µ, å…¶å®žå°±æ˜¯ innodb_autoinc_lock_mode è®¾ç½®ä¸º 2, åŒæ—¶ binlog_format è®¾ç½®ä¸º row.")])]),s._v(" "),t("p",[s._v("å› æ­¤, "),t("strong",[s._v("åœ¨ç”Ÿäº§ä¸Š, å°¤å…¶æ˜¯æœ‰ insert ... select è¿™ç§æ‰¹é‡æ’å…¥æ•°æ®çš„åœºæ™¯æ—¶, ä»Žå¹¶å‘æ’å…¥æ•°æ®æ€§èƒ½çš„è§’åº¦è€ƒè™‘, å»ºè®®è¿™æ ·è®¾ç½®: innodb_autoinc_lock_mode=2, å¹¶ä¸” binlog_format=row")]),s._v(". è¿™æ ·åšæ—¢èƒ½æå‡å¹¶å‘æ€§, åˆä¸ä¼šå‡ºçŽ°æ•°æ®ä¸€è‡´æ€§é—®é¢˜.")]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, è¿™é‡Œè¯´çš„**æ‰¹é‡æ’å…¥æ•°æ®, åŒ…å«çš„è¯­å¥ç±»åž‹æ˜¯ insert ... select, replace ... select å’Œ load data è¯­å¥. **")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, åœ¨æ™®é€šçš„ insert è¯­å¥é‡Œé¢åŒ…å«å¤šä¸ª value å€¼çš„æƒ…å†µä¸‹, å³ä½¿ innodb_autoinc_lock_mode è®¾ç½®ä¸º 1, ä¹Ÿä¸ä¼šç­‰è¯­å¥æ‰§è¡Œå®Œæˆæ‰é‡Šæ”¾é”. å› ä¸ºè¿™ç±»è¯­å¥åœ¨ç”³è¯·è‡ªå¢ž id çš„æ—¶å€™, æ˜¯å¯ä»¥ç²¾ç¡®è®¡ç®—å‡ºéœ€è¦å¤šå°‘ä¸ª id çš„, ç„¶åŽä¸€æ¬¡æ€§ç”³è¯·, "),t("strong",[s._v("ç”³è¯·å®ŒæˆåŽé”å°±å¯ä»¥é‡Šæ”¾")]),s._v("äº†. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v('æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥, ä¹‹æ‰€ä»¥éœ€è¦è¿™ä¹ˆè®¾ç½®, æ˜¯å› ä¸º"ä¸çŸ¥é“è¦é¢„å…ˆç”³è¯·å¤šå°‘ä¸ª id"')]),s._v(" .")]),s._v(" "),t("p",[s._v("æ—¢ç„¶é¢„å…ˆä¸çŸ¥é“è¦ç”³è¯·å¤šå°‘ä¸ªè‡ªå¢ž id, é‚£ä¹ˆä¸€ç§ç›´æŽ¥çš„æƒ³æ³•å°±æ˜¯éœ€è¦ä¸€ä¸ªæ—¶ç”³è¯·ä¸€ä¸ª. ä½†å¦‚æžœä¸€ä¸ª select ... insert è¯­å¥è¦æ’å…¥ 10 ä¸‡è¡Œæ•°æ®, æŒ‰ç…§è¿™ä¸ªé€»è¾‘çš„è¯å°±è¦ç”³è¯· 10 ä¸‡æ¬¡. æ˜¾ç„¶è¿™ç§ç”³è¯·è‡ªå¢ž id çš„ç­–ç•¥, åœ¨å¤§æ‰¹é‡æ’å…¥æ•°æ®çš„æƒ…å†µä¸‹, ä¸ä½†é€Ÿåº¦æ…¢, è¿˜ä¼šå½±å“å¹¶å‘æ’å…¥çš„æ€§èƒ½.")]),s._v(" "),t("p",[s._v("å› æ­¤å¯¹äºŽæ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥, MySQL æœ‰ä¸€ä¸ªæ‰¹é‡ç”³è¯·è‡ªå¢ž id çš„ç­–ç•¥:")]),s._v(" "),t("ol",[t("li",[s._v("è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­, ç¬¬ä¸€æ¬¡ç”³è¯·è‡ªå¢ž id, ä¼šåˆ†é… 1 ä¸ª;")]),s._v(" "),t("li",[s._v("1 ä¸ªç”¨å®Œä»¥åŽ, è¿™ä¸ªè¯­å¥ç¬¬äºŒæ¬¡ç”³è¯·è‡ªå¢ž id, ä¼šåˆ†é… 2 ä¸ª;")]),s._v(" "),t("li",[s._v("2 ä¸ªç”¨å®Œä»¥åŽ, è¿˜æ˜¯è¿™ä¸ªè¯­å¥, ç¬¬ä¸‰æ¬¡ç”³è¯·è‡ªå¢ž id, ä¼šåˆ†é… 4 ä¸ª;")]),s._v(" "),t("li",[s._v("ä¾æ­¤ç±»æŽ¨, åŒä¸€ä¸ªè¯­å¥åŽ»ç”³è¯·è‡ªå¢ž id, æ¯æ¬¡ç”³è¯·åˆ°çš„è‡ªå¢ž id ä¸ªæ•°éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„ä¸¤å€.")])]),s._v(" "),t("p",[s._v("ä¸¾ä¸ªä¾‹å­, ä¸€èµ·çœ‹çœ‹ä¸‹é¢çš„è¿™ä¸ªè¯­å¥åºåˆ—:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("â€‹"),t("code",[s._v("insert ... select")]),s._v("â€‹, å®žé™…ä¸Šå¾€è¡¨ t2 ä¸­æ’å…¥äº† 4 è¡Œæ•°æ®. ä½†è¿™å››è¡Œæ•°æ®æ˜¯åˆ†ä¸‰æ¬¡ç”³è¯·çš„è‡ªå¢ž id, ç¬¬ä¸€æ¬¡ç”³è¯·åˆ°äº† id=1, ç¬¬äºŒæ¬¡è¢«åˆ†é…äº† id=2 å’Œ id=3,  ç¬¬ä¸‰æ¬¡è¢«åˆ†é…åˆ° id=4 åˆ° id=7.")]),s._v(" "),t("p",[s._v("ç”±äºŽè¿™æ¡è¯­å¥å®žé™…åªç”¨ä¸Šäº† 4 ä¸ª id, æ‰€ä»¥ id=5 åˆ° id=7 å°±è¢«æµªè´¹æŽ‰äº†. ä¹‹åŽå†æ‰§è¡Œ "),t("code",[s._v("insert into t2 values(null, 5,5)")]),s._v("â€‹, å®žé™…ä¸Šæ’å…¥çš„æ•°æ®å°±æ˜¯(8,5,5).")]),s._v(" "),t("p",[s._v("**è¿™æ˜¯ä¸»é”® id å‡ºçŽ°è‡ªå¢ž id ä¸è¿žç»­çš„ç¬¬ä¸‰ç§åŽŸå› . **")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-37"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-37"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v('æœ¬èŠ‚ä»Ž"è‡ªå¢žä¸»é”®ä¸ºä»€ä¹ˆä¼šå‡ºçŽ°ä¸è¿žç»­çš„å€¼"è¿™ä¸ªé—®é¢˜å¼€å§‹, é¦–å…ˆè®¨è®ºäº†è‡ªå¢žå€¼çš„å­˜å‚¨. åœ¨ MyISAM å¼•æ“Žé‡Œé¢, è‡ªå¢žå€¼æ˜¯è¢«å†™åœ¨æ•°æ®æ–‡ä»¶ä¸Šçš„. è€Œåœ¨ InnoDB ä¸­, è‡ªå¢žå€¼æ˜¯è¢«è®°å½•åœ¨å†…å­˜çš„. MySQL ç›´åˆ° 8.0 ç‰ˆæœ¬, æ‰ç»™ InnoDB è¡¨çš„è‡ªå¢žå€¼åŠ ä¸Šäº†æŒä¹…åŒ–çš„èƒ½åŠ›, ç¡®ä¿é‡å¯å‰åŽä¸€ä¸ªè¡¨çš„è‡ªå¢žå€¼ä¸å˜.')]),s._v(" "),t("p",[s._v("ç„¶åŽä»‹ç»äº†åœ¨ä¸€ä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­, è‡ªå¢žå€¼æ”¹å˜çš„æ—¶æœº, åˆ†æžäº†ä¸ºä»€ä¹ˆ "),t("strong",[s._v("MySQL åœ¨äº‹åŠ¡å›žæ»šçš„æ—¶å€™ä¸èƒ½å›žæ”¶è‡ªå¢ž id")]),s._v(".")]),s._v(" "),t("p",[s._v("MySQL 5.1.22 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„å‚æ•° innodb_autoinc_lock_mode, æŽ§åˆ¶äº†è‡ªå¢žå€¼ç”³è¯·æ—¶çš„é”èŒƒå›´. ä»Žå¹¶å‘æ€§èƒ½çš„è§’åº¦è€ƒè™‘, å»ºè®®å°†å…¶è®¾ç½®ä¸º 2, åŒæ—¶å°† binlog_format è®¾ç½®ä¸º row. åœ¨å‰é¢å…¶å®žå¤šæ¬¡æåˆ°, "),t("strong",[s._v("binlog_format è®¾ç½®ä¸º row, æ˜¯å¾ˆæœ‰å¿…è¦çš„")]),s._v(". ä»Šå¤©çš„ä¾‹å­ç»™è¿™ä¸ªç»“è®ºå¤šäº†ä¸€ä¸ªç†ç”±.")]),s._v(" "),t("h4",{attrs:{id:"_40-insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_40-insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š"}},[s._v("#")]),s._v(" 40-insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚æåˆ° MySQL å¯¹è‡ªå¢žä¸»é”®é”åšäº†ä¼˜åŒ–, å°½é‡åœ¨ç”³è¯·åˆ°è‡ªå¢ž id ä»¥åŽ, å°±é‡Šæ”¾è‡ªå¢žé”.")]),s._v(" "),t("p",[s._v('å› æ­¤, insert è¯­å¥æ˜¯ä¸€ä¸ªå¾ˆè½»é‡çš„æ“ä½œ. ä¸è¿‡è¿™ä¸ªç»“è®ºå¯¹äºŽ"æ™®é€šçš„ insert è¯­å¥"æ‰æœ‰æ•ˆ. ä¹Ÿå°±æ˜¯è¯´, '),t("strong",[s._v('è¿˜æœ‰äº› insert è¯­å¥æ˜¯å±žäºŽ"ç‰¹æ®Šæƒ…å†µ"çš„, åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦ç»™å…¶ä»–èµ„æºåŠ é”, æˆ–è€…æ— æ³•åœ¨ç”³è¯·åˆ°è‡ªå¢ž id ä»¥åŽå°±ç«‹é©¬é‡Šæ”¾è‡ªå¢žé”')]),s._v(". æœ¬èŠ‚å°±æ¥èŠèŠè¿™ä¸ªè¯é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"insert-selectè¯­å¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#insert-selectè¯­å¥"}},[s._v("#")]),s._v(" insert ... selectè¯­å¥")]),s._v(" "),t("p",[s._v("å…ˆä»Žå‰ä¸€èŠ‚çš„é—®é¢˜è¯´èµ·å§. è¡¨ t å’Œ t2 çš„è¡¨ç»“æž„, åˆå§‹åŒ–æ•°æ®è¯­å¥å¦‚ä¸‹, æœ¬èŠ‚è¿˜æ˜¯é’ˆå¯¹è¿™ä¸¤ä¸ªè¡¨å±•å¼€.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" t\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("çŽ°åœ¨ä¸€èµ·æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹, binlog_format=statement æ—¶æ‰§è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¯­å¥æ—¶, éœ€è¦å¯¹è¡¨ t çš„æ‰€æœ‰è¡Œå’Œé—´éš™åŠ é”å‘¢? å…¶å®ž, è¿™ä¸ªé—®é¢˜éœ€è¦è€ƒè™‘çš„è¿˜æ˜¯"),t("strong",[s._v("æ—¥å¿—å’Œæ•°æ®çš„ä¸€è‡´æ€§")]),s._v(". çœ‹ä¸‹è¿™ä¸ªæ‰§è¡Œåºåˆ—:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/20b44991955d15a9a6a13ee75da254b3-20230731161914-45vcfz7.png",alt:"",title:"å›¾1 å¹¶å‘insertåœºæ™¯"}})]),s._v(" "),t("p",[s._v("å®žé™…çš„æ‰§è¡Œæ•ˆæžœæ˜¯, å¦‚æžœ session B å…ˆæ‰§è¡Œ, ç”±äºŽè¿™ä¸ªè¯­å¥å¯¹è¡¨ t ä¸»é”®ç´¢å¼•åŠ äº† (-âˆž,1] è¿™ä¸ª next-key lock, ä¼šåœ¨è¯­å¥æ‰§è¡Œå®ŒæˆåŽ, æ‰å…è®¸ session A çš„ insert è¯­å¥æ‰§è¡Œ.")]),s._v(" "),t("p",[s._v("ä½†å¦‚æžœæ²¡æœ‰é”çš„è¯, å°±å¯èƒ½å‡ºçŽ° session B çš„ insert è¯­å¥å…ˆæ‰§è¡Œ, ä½†æ˜¯åŽå†™å…¥ binlog çš„æƒ…å†µ. äºŽæ˜¯, åœ¨ binlog_format=statement çš„æƒ…å†µä¸‹, binlog é‡Œé¢å°±è®°å½•äº†è¿™æ ·çš„è¯­å¥åºåˆ—:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¯­å¥åˆ°äº†å¤‡åº“æ‰§è¡Œ, å°±ä¼šæŠŠ id=-1 è¿™ä¸€è¡Œä¹Ÿå†™åˆ°è¡¨ t2 ä¸­, å‡ºçŽ°ä¸»å¤‡ä¸ä¸€è‡´.")]),s._v(" "),t("h5",{attrs:{id:"insertå¾ªçŽ¯å†™å…¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#insertå¾ªçŽ¯å†™å…¥"}},[s._v("#")]),s._v(" insertå¾ªçŽ¯å†™å…¥")]),s._v(" "),t("p",[s._v("å½“ç„¶äº†, æ‰§è¡Œ insert ... select çš„æ—¶å€™, å¯¹ç›®æ ‡è¡¨ä¹Ÿä¸æ˜¯é”å…¨è¡¨, è€Œæ˜¯"),t("strong",[s._v("åªé”ä½éœ€è¦è®¿é—®çš„èµ„æº")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æžœçŽ°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚: è¦å¾€è¡¨ t2 ä¸­æ’å…¥ä¸€è¡Œæ•°æ®, è¿™ä¸€è¡Œçš„ c å€¼æ˜¯è¡¨ t ä¸­ c å€¼çš„æœ€å¤§å€¼åŠ  1.")]),s._v(" "),t("p",[s._v("æ­¤æ—¶å¯ä»¥è¿™ä¹ˆå†™è¿™æ¡ SQL è¯­å¥ :")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("force")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè¯­å¥çš„åŠ é”èŒƒå›´, å°±æ˜¯è¡¨ t ç´¢å¼• c ä¸Šçš„ (3,4] å’Œ (4,supremum] è¿™ä¸¤ä¸ª next-key lock, ä»¥åŠä¸»é”®ç´¢å¼•ä¸Š id=4 è¿™ä¸€è¡Œ. å®ƒçš„æ‰§è¡Œæµç¨‹ä¹Ÿæ¯”è¾ƒç®€å•, ä»Žè¡¨ t ä¸­æŒ‰ç…§ç´¢å¼• c å€’åº, æ‰«æç¬¬ä¸€è¡Œ, æ‹¿åˆ°ç»“æžœå†™å…¥åˆ°è¡¨ t2 ä¸­. å› æ­¤æ•´æ¡è¯­å¥çš„æ‰«æè¡Œæ•°æ˜¯ 1.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ…¢æŸ¥è¯¢æ—¥å¿—(slow log), å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7a2232dcb802e848c1f639649b0bd081-20230731161914-68udks5.png",alt:"",title:"å›¾2 æ…¢æŸ¥è¯¢æ—¥å¿—-å°†æ•°æ®æ’å…¥è¡¨t2"}})]),s._v(" "),t("p",[s._v("é€šè¿‡è¿™ä¸ªæ…¢æŸ¥è¯¢æ—¥å¿—, çœ‹åˆ° Rows_examined=1, æ­£å¥½éªŒè¯äº†æ‰§è¡Œè¿™æ¡è¯­å¥çš„æ‰«æè¡Œæ•°ä¸º 1.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, å¦‚æžœæ˜¯è¦æŠŠè¿™æ ·çš„ä¸€è¡Œæ•°æ®æ’å…¥åˆ°è¡¨ t ä¸­çš„è¯:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("force")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯æ€Žæ ·çš„? æ‰«æè¡Œæ•°åˆæ˜¯å¤šå°‘å‘¢?")]),s._v(" "),t("p",[s._v("è¿™æ—¶å€™, å†çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—å°±ä¼šå‘çŽ°ä¸å¯¹äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4f4052aa06e33ddc8ea946849840a07b-20230731161914-ez3841n.png",alt:"",title:"å›¾3 æ…¢æŸ¥è¯¢æ—¥å¿—-å°†æ•°æ®æ’å…¥è¡¨t"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™æ—¶å€™çš„ Rows_examined çš„å€¼æ˜¯ 5.")]),s._v(" "),t("p",[s._v('å‰é¢çš„æ–‡ç« ä¸­æåˆ°è¿‡, å¸Œæœ›ä½ éƒ½èƒ½å¤Ÿå­¦ä¼šç”¨ explain çš„ç»“æžœæ¥"è„‘è¡¥"æ•´æ¡è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹. çŽ°åœ¨å°±æ¥ä¸€èµ·è¯•è¯•. å¦‚ä¸‹å›¾æ‰€ç¤ºå°±æ˜¯è¿™æ¡è¯­å¥çš„ explain ç»“æžœ.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/296b97aed94cd23362d416230e2a2464-20230731161914-rp4ssyz.png",alt:"",title:"å›¾4 explainç»“æžœ"}})]),s._v(" "),t("p",[s._v('ä»Ž Extra å­—æ®µå¯ä»¥çœ‹åˆ° "Using temporary" å­—æ ·, è¡¨ç¤ºè¿™ä¸ªè¯­å¥ç”¨åˆ°äº†ä¸´æ—¶è¡¨. ä¹Ÿå°±æ˜¯è¯´, æ‰§è¡Œè¿‡ç¨‹ä¸­, éœ€è¦æŠŠè¡¨ t çš„å†…å®¹è¯»å‡ºæ¥, å†™å…¥ä¸´æ—¶è¡¨.')]),s._v(" "),t("p",[s._v("å›¾ä¸­ rows æ˜¾ç¤ºçš„æ˜¯ 1, ä¸å¦¨å…ˆå¯¹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹åšä¸€ä¸ªçŒœæµ‹: å¦‚æžœè¯´æ˜¯æŠŠå­æŸ¥è¯¢çš„ç»“æžœè¯»å‡ºæ¥(æ‰«æ 1 è¡Œ), å†™å…¥ä¸´æ—¶è¡¨, ç„¶åŽå†ä»Žä¸´æ—¶è¡¨è¯»å‡ºæ¥(æ‰«æ 1 è¡Œ), å†™å›žè¡¨ t ä¸­. é‚£ä¹ˆè¿™ä¸ªè¯­å¥çš„æ‰«æè¡Œæ•°å°±åº”è¯¥æ˜¯ 2, è€Œä¸æ˜¯ 5.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¿™ä¸ªçŒœæµ‹ä¸å¯¹. å®žé™…ä¸Š, Explain ç»“æžœé‡Œçš„ rows=1 æ˜¯å› ä¸ºå—åˆ°äº† limit 1 çš„å½±å“.")]),s._v(" "),t("p",[s._v("ä»Žå¦ä¸€ä¸ªè§’åº¦è€ƒè™‘çš„è¯, å¯ä»¥çœ‹çœ‹ InnoDB æ‰«æäº†å¤šå°‘è¡Œ. å¦‚å›¾ 5 æ‰€ç¤º, æ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªè¯­å¥å‰åŽæŸ¥çœ‹ Innodb_rows_read çš„ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2ec93137911412600fe60b8b3fb449f5-20230731161914-4ixs782.png",alt:"",title:"å›¾5 æŸ¥çœ‹Innodb_rows_readå˜åŒ–"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªè¯­å¥æ‰§è¡Œå‰åŽ, Innodb_rows_read çš„å€¼å¢žåŠ äº† 4. å› ä¸ºé»˜è®¤ä¸´æ—¶è¡¨æ˜¯ä½¿ç”¨ Memory å¼•æ“Žçš„, æ‰€ä»¥è¿™ 4 è¡ŒæŸ¥çš„éƒ½æ˜¯è¡¨ t, ä¹Ÿå°±æ˜¯è¯´å¯¹è¡¨ t åšäº†"),t("strong",[s._v("å…¨è¡¨æ‰«æ")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ ·å°±æŠŠæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ç†æ¸…æ¥šäº†:")]),s._v(" "),t("ol",[t("li",[s._v("åˆ›å»ºä¸´æ—¶è¡¨, è¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µ c å’Œ d.")]),s._v(" "),t("li",[s._v("æŒ‰ç…§ç´¢å¼• c æ‰«æè¡¨ t, ä¾æ¬¡å– c=4, 3, 2, 1, ç„¶åŽå›žè¡¨, è¯»åˆ° c å’Œ d çš„å€¼å†™å…¥ä¸´æ—¶è¡¨. è¿™æ—¶ Rows_examined=4.")]),s._v(" "),t("li",[s._v("ç”±äºŽè¯­ä¹‰é‡Œé¢æœ‰ limit 1, æ‰€ä»¥åªå–äº†ä¸´æ—¶è¡¨çš„ç¬¬ä¸€è¡Œ, å†æ’å…¥åˆ°è¡¨ t ä¸­. è¿™æ—¶ Rows_examined çš„å€¼åŠ  1, å˜æˆäº† 5.")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªè¯­å¥ä¼šå¯¼è‡´åœ¨è¡¨ t ä¸Šåšå…¨è¡¨æ‰«æ, å¹¶ä¸”ä¼šç»™ç´¢å¼• c ä¸Šçš„æ‰€æœ‰é—´éš™éƒ½åŠ ä¸Šå…±äº«çš„ next-key lock. æ‰€ä»¥è¿™ä¸ªè¯­å¥æ‰§è¡ŒæœŸé—´, å…¶ä»–äº‹åŠ¡ä¸èƒ½åœ¨è¿™ä¸ªè¡¨ä¸Šæ’å…¥æ•°æ®.")]),s._v(" "),t("p",[s._v("è‡³äºŽè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œä¸ºä»€ä¹ˆéœ€è¦ä¸´æ—¶è¡¨, åŽŸå› æ˜¯è¿™ç±»ä¸€è¾¹éåŽ†æ•°æ®, ä¸€è¾¹æ›´æ–°æ•°æ®çš„æƒ…å†µ, å¦‚æžœè¯»å‡ºæ¥çš„æ•°æ®ç›´æŽ¥å†™å›žåŽŸè¡¨, å°±å¯èƒ½åœ¨éåŽ†è¿‡ç¨‹ä¸­, è¯»åˆ°åˆšåˆšæ’å…¥çš„è®°å½•, æ–°æ’å…¥çš„è®°å½•å¦‚æžœå‚ä¸Žè®¡ç®—é€»è¾‘, å°±è·Ÿè¯­ä¹‰ä¸ç¬¦.")]),s._v(" "),t("p",[s._v("ç”±äºŽå®žçŽ°ä¸Šè¿™ä¸ªè¯­å¥æ²¡æœ‰åœ¨å­æŸ¥è¯¢ä¸­å°±ç›´æŽ¥ä½¿ç”¨ limit 1, ä»Žè€Œå¯¼è‡´äº†è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œéœ€è¦éåŽ†æ•´ä¸ªè¡¨ t. å®ƒçš„ä¼˜åŒ–æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•, å°±æ˜¯ç”¨å‰é¢ä»‹ç»çš„æ–¹æ³•, å…ˆ insert into åˆ°ä¸´æ—¶è¡¨ temp_t, è¿™æ ·å°±åªéœ€è¦æ‰«æä¸€è¡Œ; ç„¶åŽå†ä»Žè¡¨ temp_t é‡Œé¢å–å‡ºè¿™è¡Œæ•°æ®æ’å…¥è¡¨ t1.")]),s._v(" "),t("p",[s._v("å½“ç„¶ç”±äºŽè¿™ä¸ªè¯­å¥æ¶‰åŠçš„æ•°æ®é‡å¾ˆå°, å¯ä»¥è€ƒè™‘ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨æ¥åšè¿™ä¸ªä¼˜åŒ–. ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ä¼˜åŒ–æ—¶, è¯­å¥åºåˆ—çš„å†™æ³•å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temporary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("memory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" temp_t  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("force")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" temp_t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"insertå”¯ä¸€é”®å†²çª"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#insertå”¯ä¸€é”®å†²çª"}},[s._v("#")]),s._v(" insertå”¯ä¸€é”®å†²çª")]),s._v(" "),t("p",[s._v("å‰é¢çš„ä¸¤ä¸ªä¾‹å­æ˜¯ä½¿ç”¨ "),t("code",[s._v("insert ... select")]),s._v("â€‹ çš„æƒ…å†µ, æŽ¥ä¸‹æ¥è¦ä»‹ç»çš„è¿™ä¸ªä¾‹å­å°±æ˜¯"),t("strong",[s._v("æœ€å¸¸è§çš„ insert è¯­å¥å‡ºçŽ°å”¯ä¸€é”®å†²çªçš„æƒ…å†µ")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯¹äºŽæœ‰å”¯ä¸€é”®çš„è¡¨, æ’å…¥æ•°æ®æ—¶å‡ºçŽ°å”¯ä¸€é”®å†²çªä¹Ÿæ˜¯å¸¸è§çš„æƒ…å†µäº†. å…ˆä¸¾ä¸€ä¸ªç®€å•çš„å”¯ä¸€é”®å†²çªçš„ä¾‹å­.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/67876865df2910770710f60df5fd7ba2-20230731161914-le1m4fa.png",alt:"",title:"å›¾6 å”¯ä¸€é”®å†²çªåŠ é”"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªä¾‹å­ä¹Ÿæ˜¯åœ¨å¯é‡å¤è¯»(repeatable read)éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œçš„. å¯ä»¥çœ‹åˆ°, session B è¦æ‰§è¡Œçš„ insert è¯­å¥è¿›å…¥äº†é”ç­‰å¾…çŠ¶æ€.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, session A æ‰§è¡Œçš„ insert è¯­å¥, "),t("strong",[s._v("å‘ç”Ÿå”¯ä¸€é”®å†²çªçš„æ—¶å€™, å¹¶ä¸åªæ˜¯ç®€å•åœ°æŠ¥é”™è¿”å›ž, è¿˜åœ¨å†²çªçš„ç´¢å¼•ä¸ŠåŠ äº†é”")]),s._v(". å‰é¢è¯´è¿‡, ä¸€ä¸ª next-key lock å°±æ˜¯ç”±å®ƒ"),t("strong",[s._v("å³è¾¹ç•Œçš„å€¼")]),s._v("å®šä¹‰çš„. è¿™æ—¶å€™, session A æŒæœ‰"),t("strong",[s._v("ç´¢å¼• c ä¸Šçš„ (5,10] å…±äº« next-key lock(è¯»é”)")]),s._v(" .")]),s._v(" "),t("p",[s._v("è‡³äºŽä¸ºä»€ä¹ˆè¦åŠ è¿™ä¸ªè¯»é”, å…¶å®žæˆ‘ä¹Ÿæ²¡æœ‰æ‰¾åˆ°åˆç†çš„è§£é‡Š. ä»Žä½œç”¨ä¸Šæ¥çœ‹, è¿™æ ·åšå¯ä»¥é¿å…è¿™ä¸€è¡Œè¢«åˆ«çš„äº‹åŠ¡åˆ æŽ‰. è¿™é‡Œ"),t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("å®˜æ–¹æ–‡æ¡£"),t("OutboundLink")],1),s._v("æœ‰ä¸€ä¸ªæè¿°é”™è¯¯, è®¤ä¸ºå¦‚æžœå†²çªçš„æ˜¯ä¸»é”®ç´¢å¼•, å°±åŠ è®°å½•é”, å”¯ä¸€ç´¢å¼•æ‰åŠ  next-key lock. ä½†å®žé™…ä¸Šè¿™ä¸¤ç±»ç´¢å¼•å†²çªåŠ çš„éƒ½æ˜¯ next-key lock.")]),s._v(" "),t("p",[s._v("è¿™é‡Œå…ˆåˆ†äº«ä¸€ä¸ªç»å…¸çš„æ­»é”åœºæ™¯.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/03db97eb891fafd0283d52173aa4a5e5-20230731161914-xeod0ya.png",alt:"",title:"å›¾7 å”¯ä¸€é”®å†²çª-æ­»é”"}})]),s._v(" "),t("p",[t("strong",[s._v("åœ¨ session A æ‰§è¡Œ rollback è¯­å¥å›žæ»šçš„æ—¶å€™, session C å‡ ä¹ŽåŒæ—¶å‘çŽ°æ­»é”å¹¶è¿”å›ž.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ­»é”äº§ç”Ÿçš„é€»è¾‘æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨ T1 æ—¶åˆ», å¯åŠ¨ session A, å¹¶æ‰§è¡Œ insert è¯­å¥, æ­¤æ—¶åœ¨ç´¢å¼• c çš„ c=5 ä¸ŠåŠ äº†"),t("strong",[s._v("è®°å½•é”")]),s._v(". æ³¨æ„, è¿™ä¸ªç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•, å› æ­¤é€€åŒ–ä¸ºè®°å½•é”(å¯ä»¥å›žé¡¾ä¸‹å‰é¢ä»‹ç»çš„åŠ é”è§„åˆ™).")]),s._v(" "),t("li",[s._v("åœ¨ T2 æ—¶åˆ», session B è¦æ‰§è¡Œç›¸åŒçš„ insert è¯­å¥, "),t("strong",[s._v("å‘çŽ°äº†å”¯ä¸€é”®å†²çª, åŠ ä¸Šè¯»é”")]),s._v("; åŒæ ·åœ°, session C ä¹Ÿåœ¨ç´¢å¼• c ä¸Š, c=5 è¿™ä¸€ä¸ªè®°å½•ä¸Š, "),t("strong",[s._v("åŠ äº†è¯»é”")]),s._v(".")]),s._v(" "),t("li",[s._v("T3 æ—¶åˆ», session A å›žæ»š. è¿™æ—¶å€™, session B å’Œ session C "),t("strong",[s._v("éƒ½è¯•å›¾ç»§ç»­æ‰§è¡Œæ’å…¥æ“ä½œ")]),s._v(", éƒ½è¦åŠ ä¸Šå†™é”. "),t("strong",[s._v("ä¸¤ä¸ª session éƒ½è¦ç­‰å¾…å¯¹æ–¹çš„è¡Œé”, æ‰€ä»¥å°±å‡ºçŽ°äº†æ­»é”")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæµç¨‹çš„çŠ¶æ€å˜åŒ–å›¾å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0058e1154b6cb957f0e9166b72db9616-20230731161914-twyvtpp.png",alt:"",title:"å›¾8 çŠ¶æ€å˜åŒ–å›¾-æ­»é”"}})]),s._v(" "),t("h5",{attrs:{id:"insert-into-on-duplicate-key-update"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#insert-into-on-duplicate-key-update"}},[s._v("#")]),s._v(" insert into ... on duplicate key update")]),s._v(" "),t("p",[s._v("ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¯ä¸»é”®å†²çªåŽç›´æŽ¥æŠ¥é”™, å¦‚æžœæ˜¯æ”¹å†™æˆ")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("duplicate")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("çš„è¯, å°±ä¼šç»™ç´¢å¼• c ä¸Š (5,10] åŠ ä¸€ä¸ªæŽ’ä»–çš„ next-key lock(å†™é”).")]),s._v(" "),t("p",[t("strong",[s._v("insert into ... on duplicate key update è¿™ä¸ªè¯­ä¹‰çš„é€»è¾‘æ˜¯, æ’å…¥ä¸€è¡Œæ•°æ®, å¦‚æžœç¢°åˆ°å”¯ä¸€é”®çº¦æŸ, å°±æ‰§è¡ŒåŽé¢çš„æ›´æ–°è¯­å¥. ** æ³¨æ„, å¦‚æžœæœ‰å¤šä¸ªåˆ—è¿åäº†å”¯ä¸€æ€§çº¦æŸ, å°±ä¼š")]),s._v("æŒ‰ç…§ç´¢å¼•çš„é¡ºåº, ä¿®æ”¹è·Ÿç¬¬ä¸€ä¸ªç´¢å¼•å†²çªçš„è¡Œ**.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨è¡¨ t é‡Œé¢å·²ç»æœ‰äº† (1,1,1) å’Œ (2,2,2) è¿™ä¸¤è¡Œ, å†æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ•ˆæžœ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/922d87ad368f6e072e2b6c859300c1ef-20230731161914-odhw6g0.png",alt:"",title:"å›¾9 ä¸¤ä¸ªå”¯ä¸€é”®åŒæ—¶å†²çª"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("ä¸»é”® id æ˜¯å…ˆåˆ¤æ–­")]),s._v("çš„, MySQL è®¤ä¸ºè¿™ä¸ªè¯­å¥è·Ÿ id=2 è¿™ä¸€è¡Œå†²çª, æ‰€ä»¥ä¿®æ”¹çš„æ˜¯ id=2 çš„è¡Œ.")]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, æ‰§è¡Œè¿™æ¡è¯­å¥çš„ affected rows è¿”å›žçš„æ˜¯ 2, å¾ˆå®¹æ˜“é€ æˆè¯¯è§£. å®žé™…ä¸ŠçœŸæ­£æ›´æ–°çš„åªæœ‰ä¸€è¡Œ, åªæ˜¯åœ¨ä»£ç å®žçŽ°ä¸Š, insert å’Œ update éƒ½è®¤ä¸ºè‡ªå·±æˆåŠŸäº†, update è®¡æ•°åŠ äº† 1,  insert è®¡æ•°ä¹ŸåŠ äº† 1.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-38"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-38"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†å‡ ç§ç‰¹æ®Šæƒ…å†µä¸‹çš„ insert è¯­å¥.")]),s._v(" "),t("p",[s._v("insert ... select æ˜¯å¾ˆå¸¸è§çš„åœ¨"),t("strong",[s._v("ä¸¤ä¸ªè¡¨ä¹‹é—´æ‹·è´æ•°æ®")]),s._v("çš„æ–¹æ³•. éœ€è¦æ³¨æ„, åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹, è¿™ä¸ªè¯­å¥ä¼šç»™ select çš„è¡¨é‡Œæ‰«æåˆ°çš„è®°å½•å’Œé—´éš™åŠ è¯»é”. è€Œå¦‚æžœ insert å’Œ select çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªè¡¨, åˆ™æœ‰å¯èƒ½ä¼šé€ æˆå¾ªçŽ¯å†™å…¥. è¿™ç§æƒ…å†µä¸‹, éœ€è¦å¼•å…¥ç”¨æˆ·ä¸´æ—¶è¡¨æ¥åšä¼˜åŒ–.")]),s._v(" "),t("p",[t("strong",[s._v("insert è¯­å¥å¦‚æžœå‡ºçŽ°å”¯ä¸€é”®å†²çª, ä¼šåœ¨å†²çªçš„å”¯ä¸€å€¼ä¸ŠåŠ å…±äº«çš„ next-key lock(S é”). å› æ­¤ç¢°åˆ°ç”±äºŽå”¯ä¸€é”®çº¦æŸå¯¼è‡´æŠ¥é”™åŽ, è¦å°½å¿«æäº¤æˆ–å›žæ»šäº‹åŠ¡, é¿å…åŠ é”æ—¶é—´è¿‡é•¿")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_41-æ€Žä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_41-æ€Žä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨"}},[s._v("#")]),s._v(" 41-æ€Žä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨?")]),s._v(" "),t("p",[s._v("æ€è€ƒä¸€ä¸ªé—®é¢˜, æ€Žä¹ˆåœ¨ä¸¤å¼ è¡¨ä¸­æ‹·è´æ•°æ®?")]),s._v(" "),t("p",[s._v("å¦‚æžœå¯ä»¥æŽ§åˆ¶å¯¹æºè¡¨çš„æ‰«æè¡Œæ•°å’ŒåŠ é”èŒƒå›´å¾ˆå°çš„è¯, ç®€å•åœ°ä½¿ç”¨ insert ... select è¯­å¥å³å¯å®žçŽ°. å½“ç„¶, ä¸ºäº†é¿å…å¯¹æºè¡¨åŠ è¯»é”, æ›´ç¨³å¦¥çš„æ–¹æ¡ˆæ˜¯å…ˆå°†æ•°æ®å†™åˆ°å¤–éƒ¨æ–‡æœ¬æ–‡ä»¶, ç„¶åŽå†å†™å›žç›®æ ‡è¡¨. è¿™æ—¶æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•. æŽ¥ä¸‹æ¥è¯¦ç»†å±•å¼€ä¸€ä¸‹è¿™ä¸¤ç§æ–¹æ³•.")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽè¯´æ˜Ž, è¿˜æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªè¡¨ db1.t, å¹¶æ’å…¥ 1000 è¡Œæ•°æ®, åŒæ—¶åˆ›å»ºä¸€ä¸ªç›¸åŒç»“æž„çš„è¡¨ db2.t.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" db1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" db1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" idata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" db2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" db2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" db1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("å‡è®¾è¦æŠŠ db1.t é‡Œé¢ a>900 çš„æ•°æ®è¡Œå¯¼å‡ºæ¥, æ’å…¥åˆ° db2.t ä¸­.")]),s._v(" "),t("h5",{attrs:{id:"mysqldumpæ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqldumpæ–¹æ³•"}},[s._v("#")]),s._v(" mysqldumpæ–¹æ³•")]),s._v(" "),t("p",[s._v("ä¸€ç§æ–¹æ³•æ˜¯, "),t("strong",[s._v("ä½¿ç”¨ mysqldump å‘½ä»¤å°†æ•°æ®å¯¼å‡ºæˆä¸€ç»„ INSERT è¯­å¥")]),s._v(". å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysqldump "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h$host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P$port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('--add-locks=0 --no-create-info --single-transaction  --set-gtid-purged=OFF db1 t --where="a>900" --result-file=/client_tmp/t.sql')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æŠŠç»“æžœè¾“å‡ºåˆ°ä¸´æ—¶æ–‡ä»¶.")]),s._v(" "),t("p",[s._v("è¿™æ¡å‘½ä»¤ä¸­, ä¸»è¦å‚æ•°å«ä¹‰å¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("â€“single-transaction çš„ä½œç”¨æ˜¯, åœ¨å¯¼å‡ºæ•°æ®çš„æ—¶å€™ä¸éœ€è¦å¯¹è¡¨ db1.t åŠ è¡¨é”, è€Œæ˜¯ä½¿ç”¨ START TRANSACTION WITH CONSISTENT SNAPSHOT çš„æ–¹æ³•;")]),s._v(" "),t("li",[s._v('â€“add-locks è®¾ç½®ä¸º 0, è¡¨ç¤ºåœ¨è¾“å‡ºçš„æ–‡ä»¶ç»“æžœé‡Œ, ä¸å¢žåŠ  "'),t("code",[s._v("LOCK TABLES t WRITE;")]),s._v('â€‹";')]),s._v(" "),t("li",[s._v("â€“no-create-info çš„æ„æ€æ˜¯, ä¸éœ€è¦å¯¼å‡ºè¡¨ç»“æž„;")]),s._v(" "),t("li",[s._v("â€“set-gtid-purged=off è¡¨ç¤ºçš„æ˜¯, ä¸è¾“å‡ºè·Ÿ GTID ç›¸å…³çš„ä¿¡æ¯;")]),s._v(" "),t("li",[s._v("â€“result-file æŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„, å…¶ä¸­ client è¡¨ç¤ºç”Ÿæˆçš„æ–‡ä»¶æ˜¯åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šçš„.")])]),s._v(" "),t("p",[s._v("é€šè¿‡è¿™æ¡ mysqldump å‘½ä»¤ç”Ÿæˆçš„ t.sql æ–‡ä»¶ä¸­å°±åŒ…å«äº†å¦‚å›¾ 1 æ‰€ç¤ºçš„ INSERT è¯­å¥.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/db5ace24ccfc1747dc3bdb50fdcd8ee9-20230731161914-1swkwsd.png",alt:"",title:"å›¾1 mysqldumpè¾“å‡ºæ–‡ä»¶çš„éƒ¨åˆ†ç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ä¸€æ¡ INSERT è¯­å¥é‡Œé¢ä¼šåŒ…å«å¤šä¸ª value å¯¹, è¿™æ˜¯ä¸ºäº†åŽç»­ç”¨è¿™ä¸ªæ–‡ä»¶æ¥å†™å…¥æ•°æ®çš„æ—¶å€™, æ‰§è¡Œé€Ÿåº¦å¯ä»¥æ›´å¿«.")]),s._v(" "),t("p",[s._v("å¦‚æžœä½ å¸Œæœ›ç”Ÿæˆçš„æ–‡ä»¶ä¸­ä¸€æ¡ INSERT è¯­å¥åªæ’å…¥ä¸€è¡Œæ•°æ®çš„è¯, å¯ä»¥åœ¨æ‰§è¡Œ mysqldump å‘½ä»¤æ—¶, åŠ ä¸Šå‚æ•° â€“skip-extended-insert.")]),s._v(" "),t("p",[s._v("ç„¶åŽå¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ¡å‘½ä»¤, å°†è¿™äº› INSERT è¯­å¥æ”¾åˆ° db2 åº“é‡ŒåŽ»æ‰§è¡Œ.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h127"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P13000  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot db2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source /client_tmp/t.sql"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("éœ€è¦è¯´æ˜Žçš„æ˜¯, source å¹¶ä¸æ˜¯ä¸€æ¡ SQL è¯­å¥, è€Œæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å‘½ä»¤. mysql å®¢æˆ·ç«¯æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„æµç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰“å¼€æ–‡ä»¶, é»˜è®¤ä»¥åˆ†å·ä¸ºç»“å°¾è¯»å–ä¸€æ¡æ¡çš„ SQL è¯­å¥;")]),s._v(" "),t("li",[s._v("å°† SQL è¯­å¥å‘é€åˆ°æœåŠ¡ç«¯æ‰§è¡Œ.")])]),s._v(" "),t("p",[s._v('ä¹Ÿå°±æ˜¯è¯´, æœåŠ¡ç«¯æ‰§è¡Œçš„å¹¶ä¸æ˜¯è¿™ä¸ª "source t.sql" è¯­å¥, è€Œæ˜¯ INSERT è¯­å¥. æ‰€ä»¥ä¸è®ºæ˜¯åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—(slow log), è¿˜æ˜¯åœ¨ binlog, è®°å½•çš„éƒ½æ˜¯è¿™äº›è¦è¢«çœŸæ­£æ‰§è¡Œçš„ INSERT è¯­å¥.')]),s._v(" "),t("h5",{attrs:{id:"å¯¼å‡ºcsvæ–‡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯¼å‡ºcsvæ–‡ä»¶"}},[s._v("#")]),s._v(" å¯¼å‡ºCSVæ–‡ä»¶")]),s._v(" "),t("p",[s._v("å¦ä¸€ç§æ–¹æ³•æ˜¯ç›´æŽ¥å°†ç»“æžœå¯¼å‡ºæˆ .csv æ–‡ä»¶. MySQL æä¾›äº†ä¸‹é¢çš„è¯­æ³•, ç”¨æ¥å°†æŸ¥è¯¢ç»“æžœå¯¼å‡ºåˆ°æœåŠ¡ç«¯æœ¬åœ°ç›®å½•:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" db1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("outfile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/server_tmp/t.csv'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("åœ¨ä½¿ç”¨è¿™æ¡è¯­å¥æ—¶, éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹.")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("è¿™æ¡è¯­å¥ä¼šå°†ç»“æžœä¿å­˜åœ¨æœåŠ¡ç«¯. å¦‚æžœä½ æ‰§è¡Œå‘½ä»¤çš„å®¢æˆ·ç«¯å’Œ MySQL æœåŠ¡ç«¯ä¸åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Š, å®¢æˆ·ç«¯æœºå™¨çš„ä¸´æ—¶ç›®å½•ä¸‹æ˜¯ä¸ä¼šç”Ÿæˆ t.csv æ–‡ä»¶çš„.")])]),s._v(" "),t("li",[t("p",[s._v("into outfile æŒ‡å®šäº†æ–‡ä»¶çš„ç”Ÿæˆä½ç½®("),t("code",[s._v("/server_tmp/")]),s._v("â€‹), è¿™ä¸ªä½ç½®å¿…é¡»å—å‚æ•° secure_file_priv çš„é™åˆ¶. å‚æ•° secure_file_priv çš„å¯é€‰å€¼å’Œä½œç”¨åˆ†åˆ«æ˜¯:")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æžœè®¾ç½®ä¸º empty, è¡¨ç¤ºä¸é™åˆ¶æ–‡ä»¶ç”Ÿæˆçš„ä½ç½®, è¿™æ˜¯ä¸å®‰å…¨çš„è®¾ç½®;")]),s._v(" "),t("li",[s._v("å¦‚æžœè®¾ç½®ä¸ºä¸€ä¸ªè¡¨ç¤ºè·¯å¾„çš„å­—ç¬¦ä¸², å°±è¦æ±‚ç”Ÿæˆçš„æ–‡ä»¶åªèƒ½æ”¾åœ¨è¿™ä¸ªæŒ‡å®šçš„ç›®å½•, æˆ–è€…å®ƒçš„å­ç›®å½•;")]),s._v(" "),t("li",[s._v("å¦‚æžœè®¾ç½®ä¸º NULL, å°±è¡¨ç¤ºç¦æ­¢åœ¨è¿™ä¸ª MySQL å®žä¾‹ä¸Šæ‰§è¡Œ "),t("code",[s._v("select ... into outfile")]),s._v("â€‹ æ“ä½œ.")])])]),s._v(" "),t("li",[t("p",[s._v("è¿™æ¡å‘½ä»¤ä¸ä¼šå¸®ä½ è¦†ç›–æ–‡ä»¶, å› æ­¤éœ€è¦ç¡®ä¿ "),t("code",[s._v("/server_tmp/t.csv")]),s._v("â€‹ è¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨, å¦åˆ™æ‰§è¡Œè¯­å¥æ—¶å°±ä¼šå› ä¸ºæœ‰åŒåæ–‡ä»¶çš„å­˜åœ¨è€ŒæŠ¥é”™.")])]),s._v(" "),t("li",[t("p",[s._v("è¿™æ¡å‘½ä»¤ç”Ÿæˆçš„æ–‡æœ¬æ–‡ä»¶ä¸­, åŽŸåˆ™ä¸Šä¸€ä¸ªæ•°æ®è¡Œå¯¹åº”æ–‡æœ¬æ–‡ä»¶çš„ä¸€è¡Œ. ä½†æ˜¯, å¦‚æžœå­—æ®µä¸­åŒ…å«æ¢è¡Œç¬¦, åœ¨ç”Ÿæˆçš„æ–‡æœ¬ä¸­ä¹Ÿä¼šæœ‰æ¢è¡Œç¬¦. ä¸è¿‡ç±»ä¼¼æ¢è¡Œç¬¦, åˆ¶è¡¨ç¬¦è¿™ç±»ç¬¦å·, å‰é¢éƒ½ä¼šè·Ÿä¸Š "),t("code",[s._v('"\\"')]),s._v("â€‹ è¿™ä¸ªè½¬ä¹‰ç¬¦, è¿™æ ·å°±å¯ä»¥è·Ÿå­—æ®µä¹‹é—´, æ•°æ®è¡Œä¹‹é—´çš„åˆ†éš”ç¬¦åŒºåˆ†å¼€.")])])]),s._v(" "),t("p",[s._v("å¾—åˆ° .csv å¯¼å‡ºæ–‡ä»¶åŽ, å°±å¯ä»¥ç”¨ä¸‹é¢çš„ load data å‘½ä»¤å°†æ•°æ®å¯¼å…¥åˆ°ç›®æ ‡è¡¨ db2.t ä¸­.")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("load")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("infile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/server_tmp/t.csv'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" db2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("æ‰“å¼€æ–‡ä»¶ "),t("code",[s._v("/server_tmp/t.csv")]),s._v("â€‹, ä»¥åˆ¶è¡¨ç¬¦ "),t("code",[s._v("(\\t)")]),s._v("â€‹ ä½œä¸ºå­—æ®µé—´çš„åˆ†éš”ç¬¦, ä»¥æ¢è¡Œç¬¦(\\n)ä½œä¸ºè®°å½•ä¹‹é—´çš„åˆ†éš”ç¬¦, è¿›è¡Œæ•°æ®è¯»å–;")])]),s._v(" "),t("li",[t("p",[s._v("å¯åŠ¨äº‹åŠ¡.")])]),s._v(" "),t("li",[t("p",[s._v("åˆ¤æ–­æ¯ä¸€è¡Œçš„å­—æ®µæ•°ä¸Žè¡¨ db2.t æ˜¯å¦ç›¸åŒ:")]),s._v(" "),t("ul",[t("li",[s._v("è‹¥ä¸ç›¸åŒ, åˆ™ç›´æŽ¥æŠ¥é”™, äº‹åŠ¡å›žæ»š;")]),s._v(" "),t("li",[s._v("è‹¥ç›¸åŒ, åˆ™æž„é€ æˆä¸€è¡Œ, è°ƒç”¨ InnoDB å¼•æ“ŽæŽ¥å£, å†™å…¥åˆ°è¡¨ä¸­.")])])]),s._v(" "),t("li",[t("p",[s._v("é‡å¤æ­¥éª¤ 3, ç›´åˆ° "),t("code",[s._v("/server_tmp/t.csv")]),s._v("â€‹ æ•´ä¸ªæ–‡ä»¶è¯»å…¥å®Œæˆ, æäº¤äº‹åŠ¡.")])])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½æœ‰ä¸€ä¸ªç–‘é—®, **å¦‚æžœ binlog_format=statement, è¿™ä¸ª load è¯­å¥è®°å½•åˆ° binlog é‡Œä»¥åŽ, æ€Žä¹ˆåœ¨å¤‡åº“é‡æ”¾å‘¢? **")]),s._v(" "),t("p",[s._v("ç”±äºŽ "),t("code",[s._v("/server_tmp/t.csv")]),s._v("â€‹ æ–‡ä»¶åªä¿å­˜åœ¨ä¸»åº“æ‰€åœ¨çš„ä¸»æœºä¸Š, å¦‚æžœåªæ˜¯æŠŠè¿™æ¡è¯­å¥åŽŸæ–‡å†™åˆ° binlog ä¸­, åœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™, å¤‡åº“çš„æœ¬åœ°æœºå™¨ä¸Šæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶, å°±ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¿™æ¡è¯­å¥æ‰§è¡Œçš„å®Œæ•´æµç¨‹, å…¶å®žæ˜¯ä¸‹é¢è¿™æ ·çš„.")]),s._v(" "),t("ol",[t("li",[s._v("ä¸»åº“æ‰§è¡Œå®ŒæˆåŽ, å°† "),t("code",[s._v("/server_tmp/t.csv")]),s._v("â€‹ æ–‡ä»¶çš„å†…å®¹ç›´æŽ¥å†™åˆ° binlog æ–‡ä»¶ä¸­.")]),s._v(" "),t("li",[s._v("å¾€ binlog æ–‡ä»¶ä¸­å†™å…¥è¯­å¥ "),t("code",[s._v("load data local infile '/tmp/SQL_LOAD_MB-1-0' INTO TABLE `db2`.`t`")]),s._v("â€‹.")]),s._v(" "),t("li",[s._v("æŠŠè¿™ä¸ª binlog æ—¥å¿—ä¼ åˆ°å¤‡åº“.")]),s._v(" "),t("li",[s._v("å¤‡åº“çš„ apply çº¿ç¨‹åœ¨æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡æ—¥å¿—æ—¶: (1) å…ˆå°† binlog ä¸­ t.csv æ–‡ä»¶çš„å†…å®¹è¯»å‡ºæ¥, å†™å…¥åˆ°æœ¬åœ°ä¸´æ—¶ç›®å½• /tmp/SQL_LOAD_MB-1-0 ä¸­; (2) å†æ‰§è¡Œ load data è¯­å¥, å¾€å¤‡åº“çš„ db2.t è¡¨ä¸­æ’å…¥è·Ÿä¸»åº“ç›¸åŒçš„æ•°æ®.")])]),s._v(" "),t("p",[s._v("æ‰§è¡Œæµç¨‹å¦‚å›¾ 2 æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d71fe3e3b7eaaa5a047df96d0a49b8de-20230731161914-fezlmxl.png",alt:"",title:"å›¾2 load dataçš„åŒæ­¥æµç¨‹"}})]),s._v(" "),t("p",[s._v('æ³¨æ„, è¿™é‡Œå¤‡åº“æ‰§è¡Œçš„ load data è¯­å¥é‡Œé¢, å¤šäº†ä¸€ä¸ª "local". å®ƒçš„æ„æ€æ˜¯ "å°†æ‰§è¡Œè¿™æ¡å‘½ä»¤çš„å®¢æˆ·ç«¯æ‰€åœ¨æœºå™¨çš„æœ¬åœ°æ–‡ä»¶ '),t("code",[s._v("/tmp/SQL_LOAD_MB-1-0")]),s._v('â€‹ çš„å†…å®¹, åŠ è½½åˆ°ç›®æ ‡è¡¨ db2.t ä¸­".')]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("load data å‘½ä»¤æœ‰ä¸¤ç§ç”¨æ³•")]),s._v(":")]),s._v(" "),t("ol",[t("li",[s._v('ä¸åŠ  "local", æ˜¯è¯»å–æœåŠ¡ç«¯çš„æ–‡ä»¶, è¿™ä¸ªæ–‡ä»¶å¿…é¡»åœ¨ secure_file_priv æŒ‡å®šçš„ç›®å½•æˆ–å­ç›®å½•ä¸‹;')]),s._v(" "),t("li",[s._v('åŠ ä¸Š "local", è¯»å–çš„æ˜¯å®¢æˆ·ç«¯çš„æ–‡ä»¶, åªè¦ mysql å®¢æˆ·ç«¯æœ‰è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„æƒé™å³å¯. è¿™æ—¶å€™, MySQL å®¢æˆ·ç«¯ä¼šå…ˆæŠŠæœ¬åœ°æ–‡ä»¶ä¼ ç»™æœåŠ¡ç«¯, ç„¶åŽæ‰§è¡Œä¸Šè¿°çš„ load data æµç¨‹.')])]),s._v(" "),t("p",[s._v("å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯, "),t("strong",[s._v("select ... into outfile æ–¹æ³•ä¸ä¼šç”Ÿæˆè¡¨ç»“æž„æ–‡ä»¶")]),s._v(", æ‰€ä»¥å¯¼æ•°æ®æ—¶è¿˜éœ€è¦å•ç‹¬çš„å‘½ä»¤å¾—åˆ°è¡¨ç»“æž„å®šä¹‰. mysqldump æä¾›äº†ä¸€ä¸ª â€“tab å‚æ•°, å¯ä»¥åŒæ—¶å¯¼å‡ºè¡¨ç»“æž„å®šä¹‰æ–‡ä»¶å’Œ csv æ•°æ®æ–‡ä»¶. è¿™æ¡å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysqldump "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h$host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P$port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('---single-transaction  --set-gtid-purged=OFF db1 t --where="a>900" --tab=$secure_file_priv')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ¡å‘½ä»¤ä¼šåœ¨ "),t("code",[s._v("$secure_file_priv")]),s._v("â€‹ å®šä¹‰çš„ç›®å½•ä¸‹, åˆ›å»ºä¸€ä¸ª t.sql æ–‡ä»¶ä¿å­˜å»ºè¡¨è¯­å¥, åŒæ—¶åˆ›å»ºä¸€ä¸ª t.txt æ–‡ä»¶ä¿å­˜ CSV æ•°æ®.")]),s._v(" "),t("h5",{attrs:{id:"ç‰©ç†æ‹·è´æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç‰©ç†æ‹·è´æ–¹æ³•"}},[s._v("#")]),s._v(" ç‰©ç†æ‹·è´æ–¹æ³•")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°çš„ mysqldump æ–¹æ³•å’Œå¯¼å‡º CSV æ–‡ä»¶çš„æ–¹æ³•, éƒ½æ˜¯é€»è¾‘å¯¼æ•°æ®çš„æ–¹æ³•, ä¹Ÿå°±æ˜¯å°†æ•°æ®ä»Žè¡¨ db1.t ä¸­è¯»å‡ºæ¥, ç”Ÿæˆæ–‡æœ¬, ç„¶åŽå†å†™å…¥ç›®æ ‡è¡¨ db2.t ä¸­.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, æœ‰ç‰©ç†å¯¼æ•°æ®çš„æ–¹æ³•å—? æ¯”å¦‚ç›´æŽ¥æŠŠ db1.t è¡¨çš„ .frm æ–‡ä»¶å’Œ .ibd æ–‡ä»¶æ‹·è´åˆ° db2 ç›®å½•ä¸‹, æ˜¯å¦å¯è¡Œå‘¢?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯"),t("strong",[s._v("ä¸è¡Œ")]),s._v("çš„. å› ä¸ºä¸€ä¸ª InnoDB è¡¨, é™¤äº†åŒ…å«è¿™ä¸¤ä¸ªç‰©ç†æ–‡ä»¶å¤–, è¿˜éœ€è¦åœ¨æ•°æ®å­—å…¸ä¸­æ³¨å†Œ. ç›´æŽ¥æ‹·è´è¿™ä¸¤ä¸ªæ–‡ä»¶çš„è¯, å› ä¸ºæ•°æ®å­—å…¸ä¸­æ²¡æœ‰ db2.t è¿™ä¸ªè¡¨, ç³»ç»Ÿæ˜¯ä¸ä¼šè¯†åˆ«å’ŒæŽ¥å—å®ƒä»¬çš„.")]),s._v(" "),t("p",[s._v("ä¸è¿‡, åœ¨ MySQL 5.6 ç‰ˆæœ¬å¼•å…¥äº†"),t("strong",[s._v("å¯ä¼ è¾“è¡¨ç©ºé—´")]),s._v("(transportable tablespace) çš„æ–¹æ³•, å¯ä»¥é€šè¿‡"),t("strong",[s._v("å¯¼å‡º + å¯¼å…¥è¡¨ç©ºé—´")]),s._v("çš„æ–¹å¼, å®žçŽ°ç‰©ç†æ‹·è´è¡¨çš„åŠŸèƒ½.")]),s._v(" "),t("p",[s._v("å‡è®¾çŽ°åœ¨çš„ç›®æ ‡æ˜¯åœ¨ db1 åº“ä¸‹, å¤åˆ¶ä¸€ä¸ªè·Ÿè¡¨ t ç›¸åŒçš„è¡¨ r, å…·ä½“çš„æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰§è¡Œ "),t("code",[s._v("create table r like t")]),s._v("â€‹, åˆ›å»ºä¸€ä¸ªç›¸åŒè¡¨ç»“æž„çš„ç©ºè¡¨;")]),s._v(" "),t("li",[s._v("æ‰§è¡Œ "),t("code",[s._v("alter table r discard tablespace")]),s._v("â€‹, è¿™æ—¶å€™ r.ibd æ–‡ä»¶ä¼šè¢«åˆ é™¤;")]),s._v(" "),t("li",[s._v("æ‰§è¡Œ "),t("code",[s._v("flush table t for export")]),s._v("â€‹, è¿™æ—¶å€™ db1 ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª t.cfg æ–‡ä»¶;")]),s._v(" "),t("li",[s._v("åœ¨ db1 ç›®å½•ä¸‹æ‰§è¡Œ "),t("code",[s._v("cp t.cfg r.cfg; cp t.ibd r.ibd")]),s._v("â€‹; è¿™ä¸¤ä¸ªå‘½ä»¤(è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, æ‹·è´å¾—åˆ°çš„ä¸¤ä¸ªæ–‡ä»¶, MySQL è¿›ç¨‹è¦æœ‰è¯»å†™æƒé™);")]),s._v(" "),t("li",[s._v("æ‰§è¡Œ "),t("code",[s._v("unlock tables")]),s._v("â€‹, è¿™æ—¶å€™ t.cfg æ–‡ä»¶ä¼šè¢«åˆ é™¤;")]),s._v(" "),t("li",[s._v("æ‰§è¡Œ "),t("code",[s._v("alter table r import tablespace")]),s._v("â€‹, å°†è¿™ä¸ª r.ibd æ–‡ä»¶ä½œä¸ºè¡¨ r çš„æ–°çš„è¡¨ç©ºé—´, ç”±äºŽè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®å†…å®¹å’Œ t.ibd æ˜¯ç›¸åŒçš„, æ‰€ä»¥è¡¨ r ä¸­å°±æœ‰äº†å’Œè¡¨ t ç›¸åŒçš„æ•°æ®.")])]),s._v(" "),t("p",[s._v("è‡³æ­¤, æ‹·è´è¡¨æ•°æ®çš„æ“ä½œå°±å®Œæˆäº†. è¿™ä¸ªæµç¨‹çš„æ‰§è¡Œè¿‡ç¨‹å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/19046e84ad120343e65b8173d2271ad8-20230731161914-y2i2a8p.png",alt:"",title:"å›¾3 ç‰©ç†æ‹·è´è¡¨"}})]),s._v(" "),t("p",[s._v("å…³äºŽæ‹·è´è¡¨çš„è¿™ä¸ªæµç¨‹, æœ‰ä»¥ä¸‹å‡ ä¸ªæ³¨æ„ç‚¹:")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨ç¬¬ 3 æ­¥æ‰§è¡Œå®Œ flsuh table å‘½ä»¤ä¹‹åŽ, db1.t æ•´ä¸ªè¡¨å¤„äºŽåªè¯»çŠ¶æ€, ç›´åˆ°æ‰§è¡Œ unlock tables å‘½ä»¤åŽæ‰é‡Šæ”¾è¯»é”;")]),s._v(" "),t("li",[s._v("åœ¨æ‰§è¡Œ import tablespace çš„æ—¶å€™, ä¸ºäº†è®©æ–‡ä»¶é‡Œçš„è¡¨ç©ºé—´ id å’Œæ•°æ®å­—å…¸ä¸­çš„ä¸€è‡´, ä¼šä¿®æ”¹ r.ibd çš„è¡¨ç©ºé—´ id. è€Œè¿™ä¸ªè¡¨ç©ºé—´ id å­˜åœ¨äºŽæ¯ä¸€ä¸ªæ•°æ®é¡µä¸­. å› æ­¤, å¦‚æžœæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶(æ¯”å¦‚ TB çº§åˆ«), æ¯ä¸ªæ•°æ®é¡µéƒ½éœ€è¦ä¿®æ”¹, æ‰€ä»¥ä½ ä¼šçœ‹åˆ°è¿™ä¸ª import è¯­å¥çš„æ‰§è¡Œæ˜¯éœ€è¦ä¸€äº›æ—¶é—´çš„. å½“ç„¶, å¦‚æžœæ˜¯ç›¸æ¯”äºŽé€»è¾‘å¯¼å…¥çš„æ–¹æ³•, import è¯­å¥çš„è€—æ—¶æ˜¯éžå¸¸çŸ­çš„.")])]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-39"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-39"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†ä¸‰ç§å°†ä¸€ä¸ªè¡¨çš„æ•°æ®å¯¼å…¥åˆ°å¦å¤–ä¸€ä¸ªè¡¨ä¸­çš„æ–¹æ³•.")]),s._v(" "),t("p",[s._v("æ¥å¯¹æ¯”ä¸€ä¸‹è¿™ä¸‰ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹.")]),s._v(" "),t("ol",[t("li",[s._v("ç‰©ç†æ‹·è´çš„æ–¹å¼é€Ÿåº¦æœ€å¿«, å°¤å…¶å¯¹äºŽå¤§è¡¨æ‹·è´æ¥è¯´æ˜¯æœ€å¿«çš„æ–¹æ³•. å¦‚æžœå‡ºçŽ°è¯¯åˆ è¡¨çš„æƒ…å†µ, ç”¨å¤‡ä»½æ¢å¤å‡ºè¯¯åˆ ä¹‹å‰çš„ä¸´æ—¶åº“, ç„¶åŽå†æŠŠä¸´æ—¶åº“ä¸­çš„è¡¨æ‹·è´åˆ°ç”Ÿäº§åº“ä¸Š, æ˜¯æ¢å¤æ•°æ®æœ€å¿«çš„æ–¹æ³•. ä½†è¿™ç§æ–¹æ³•çš„ä½¿ç”¨ä¹Ÿæœ‰ä¸€å®šçš„å±€é™æ€§: (1) å¿…é¡»æ˜¯å…¨è¡¨æ‹·è´, ä¸èƒ½åªæ‹·è´éƒ¨åˆ†æ•°æ®; (2) éœ€è¦åˆ°æœåŠ¡å™¨ä¸Šæ‹·è´æ•°æ®, åœ¨ç”¨æˆ·æ— æ³•ç™»å½•æ•°æ®åº“ä¸»æœºçš„åœºæ™¯ä¸‹æ— æ³•ä½¿ç”¨; (3) ç”±äºŽæ˜¯é€šè¿‡æ‹·è´ç‰©ç†æ–‡ä»¶å®žçŽ°çš„, æºè¡¨å’Œç›®æ ‡è¡¨éƒ½æ˜¯ä½¿ç”¨ InnoDB å¼•æ“Žæ—¶æ‰èƒ½ä½¿ç”¨.")]),s._v(" "),t("li",[s._v("ç”¨ mysqldump ç”ŸæˆåŒ…å« INSERT è¯­å¥æ–‡ä»¶çš„æ–¹æ³•, å¯ä»¥åœ¨ where å‚æ•°å¢žåŠ è¿‡æ»¤æ¡ä»¶, æ¥å®žçŽ°åªå¯¼å‡ºéƒ¨åˆ†æ•°æ®. è¿™ä¸ªæ–¹å¼çš„ä¸è¶³ä¹‹ä¸€æ˜¯, ä¸èƒ½ä½¿ç”¨ join è¿™ç§æ¯”è¾ƒå¤æ‚çš„ where æ¡ä»¶å†™æ³•.")]),s._v(" "),t("li",[s._v("ç”¨ select ... into outfile çš„æ–¹æ³•æ˜¯æœ€çµæ´»çš„, æ”¯æŒæ‰€æœ‰çš„ SQL å†™æ³•. ä½†è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹ä¹‹ä¸€å°±æ˜¯, æ¯æ¬¡åªèƒ½å¯¼å‡ºä¸€å¼ è¡¨çš„æ•°æ®, è€Œä¸”è¡¨ç»“æž„ä¹Ÿéœ€è¦å¦å¤–çš„è¯­å¥å•ç‹¬å¤‡ä»½.")])]),s._v(" "),t("p",[s._v("åŽä¸¤ç§æ–¹å¼éƒ½æ˜¯"),t("strong",[s._v("é€»è¾‘å¤‡ä»½")]),s._v("æ–¹å¼, æ˜¯å¯ä»¥è·¨å¼•æ“Žä½¿ç”¨çš„.")]),s._v(" "),t("h4",{attrs:{id:"_42-grantä¹‹åŽè¦è·Ÿç€flush-privilegeså—"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_42-grantä¹‹åŽè¦è·Ÿç€flush-privilegeså—"}},[s._v("#")]),s._v(" 42-grantä¹‹åŽè¦è·Ÿç€flush privilegeså—?")]),s._v(" "),t("p",[s._v("åœ¨ MySQL é‡Œé¢, "),t("strong",[s._v("grant è¯­å¥æ˜¯ç”¨æ¥ç»™ç”¨æˆ·èµ‹æƒ")]),s._v("çš„. ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰è§è¿‡ä¸€äº›æ“ä½œæ–‡æ¡£é‡Œé¢æåˆ°, grant ä¹‹åŽè¦é©¬ä¸Šè·Ÿç€"),t("strong",[s._v("æ‰§è¡Œä¸€ä¸ª flush privileges å‘½ä»¤")]),s._v(", æ‰èƒ½ä½¿èµ‹æƒè¯­å¥ç”Ÿæ•ˆ. æˆ‘æœ€å¼€å§‹ä½¿ç”¨ MySQL çš„æ—¶å€™, å°±æ˜¯ç…§ç€ä¸€ä¸ªæ“ä½œæ–‡æ¡£çš„è¯´æ˜ŽæŒ‰ç…§è¿™ä¸ªé¡ºåºæ“ä½œçš„.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, grant ä¹‹åŽçœŸçš„éœ€è¦æ‰§è¡Œ flush privileges å—? å¦‚æžœæ²¡æœ‰æ‰§è¡Œè¿™ä¸ª flush å‘½ä»¤çš„è¯, èµ‹æƒè¯­å¥çœŸçš„ä¸èƒ½ç”Ÿæ•ˆå—?")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥, å°±å…ˆä»‹ç»ä¸€ä¸‹ grant è¯­å¥å’Œ flush privileges è¯­å¥åˆ†åˆ«åšäº†ä»€ä¹ˆäº‹æƒ…, ç„¶åŽå†ä¸€èµ·æ¥åˆ†æžè¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¾¿äºŽè¯´æ˜Ž, å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ua'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" identified "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pa'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ¡è¯­å¥çš„é€»è¾‘æ˜¯åˆ›å»ºä¸€ä¸ªç”¨æˆ· "),t("code",[s._v("'ua'@'%'")]),s._v("â€‹, å¯†ç æ˜¯ pa. æ³¨æ„, åœ¨ MySQL é‡Œé¢, ç”¨æˆ·å (user)+ åœ°å€ (host) æ‰è¡¨ç¤ºä¸€ä¸ªç”¨æˆ·, å› æ­¤ ua@ip1 å’Œ ua@ip2 ä»£è¡¨çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç”¨æˆ·.")]),s._v(" "),t("p",[s._v("è¿™æ¡å‘½ä»¤åšäº†ä¸¤ä¸ªåŠ¨ä½œ:")]),s._v(" "),t("ol",[t("li",[s._v("ç£ç›˜ä¸Š, "),t("strong",[s._v("å¾€ mysql.user è¡¨é‡Œæ’å…¥ä¸€è¡Œ")]),s._v(", ç”±äºŽæ²¡æœ‰æŒ‡å®šæƒé™, æ‰€ä»¥è¿™è¡Œæ•°æ®ä¸Šæ‰€æœ‰è¡¨ç¤ºæƒé™çš„å­—æ®µçš„å€¼éƒ½æ˜¯ N;")]),s._v(" "),t("li",[s._v("å†…å­˜é‡Œ, å¾€æ•°ç»„ acl_users é‡Œæ’å…¥ä¸€ä¸ª acl_user å¯¹è±¡, è¿™ä¸ªå¯¹è±¡çš„ access å­—æ®µå€¼ä¸º 0.")])]),s._v(" "),t("p",[s._v("ä¸‹å›¾å°±æ˜¯è¿™ä¸ªæ—¶åˆ»ç”¨æˆ· ua åœ¨ user è¡¨ä¸­çš„çŠ¶æ€.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b57fe266eb902dca82c55b6371ea3f8d-20230731161914-qghdyr8.png",alt:"",title:"å›¾1 mysql.useræ•°æ®è¡Œ"}})]),s._v(" "),t("p",[s._v("åœ¨ MySQL ä¸­, "),t("strong",[s._v("ç”¨æˆ·æƒé™æ˜¯æœ‰ä¸åŒçš„èŒƒå›´")]),s._v("çš„. æŽ¥ä¸‹æ¥å°±æŒ‰ç…§ç”¨æˆ·æƒé™èŒƒå›´ä»Žå¤§åˆ°å°çš„é¡ºåºä¾æ¬¡æ¥è¯´æ˜Ž.")]),s._v(" "),t("h5",{attrs:{id:"å…¨å±€æƒé™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¨å±€æƒé™"}},[s._v("#")]),s._v(" å…¨å±€æƒé™")]),s._v(" "),t("p",[s._v("å…¨å±€æƒé™, ä½œç”¨äºŽæ•´ä¸ª MySQL å®žä¾‹, è¿™äº›æƒé™ä¿¡æ¯ä¿å­˜åœ¨ mysql åº“çš„ user è¡¨é‡Œ. å¦‚æžœè¦ç»™ç”¨æˆ· ua èµ‹ä¸€ä¸ªæœ€é«˜æƒé™çš„è¯, è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ua'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("option")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ª grant å‘½ä»¤åšäº†ä¸¤ä¸ªåŠ¨ä½œ:")]),s._v(" "),t("ol",[t("li",[s._v("ç£ç›˜ä¸Š, å°† mysql.user è¡¨é‡Œ, ç”¨æˆ· "),t("code",[s._v("'ua'@'%'")]),s._v("â€‹ è¿™ä¸€è¡Œçš„æ‰€æœ‰è¡¨ç¤ºæƒé™çš„å­—æ®µçš„å€¼éƒ½ä¿®æ”¹ä¸º 'Y';")]),s._v(" "),t("li",[s._v('å†…å­˜é‡Œ, ä»Žæ•°ç»„ acl_users ä¸­æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·å¯¹åº”çš„å¯¹è±¡, å°† access å€¼(æƒé™ä½)ä¿®æ”¹ä¸ºäºŒè¿›åˆ¶çš„ "å…¨ 1".')])]),s._v(" "),t("p",[t("strong",[s._v("åœ¨è¿™ä¸ª grant å‘½ä»¤æ‰§è¡Œå®ŒæˆåŽ, å¦‚æžœæœ‰æ–°çš„å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·å ua ç™»å½•æˆåŠŸ, MySQL ä¼šä¸ºæ–°è¿žæŽ¥ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡, ç„¶åŽä»Ž acl_users æ•°ç»„é‡ŒæŸ¥åˆ°è¿™ä¸ªç”¨æˆ·çš„æƒé™, å¹¶å°†æƒé™å€¼æ‹·è´åˆ°è¿™ä¸ªçº¿ç¨‹å¯¹è±¡ä¸­. ä¹‹åŽåœ¨è¿™ä¸ªè¿žæŽ¥ä¸­æ‰§è¡Œçš„è¯­å¥, æ‰€æœ‰å…³äºŽå…¨å±€æƒé™çš„åˆ¤æ–­, éƒ½ç›´æŽ¥ä½¿ç”¨çº¿ç¨‹å¯¹è±¡å†…éƒ¨ä¿å­˜çš„æƒé™ä½.")])]),s._v(" "),t("p",[s._v("åŸºäºŽä¸Šé¢çš„åˆ†æžå¯ä»¥çŸ¥é“:")]),s._v(" "),t("ol",[t("li",[s._v("grant å‘½ä»¤å¯¹äºŽå…¨å±€æƒé™, åŒæ—¶æ›´æ–°äº†ç£ç›˜å’Œå†…å­˜. å‘½ä»¤å®ŒæˆåŽ"),t("strong",[s._v("å³æ—¶ç”Ÿæ•ˆ")]),s._v(", æŽ¥ä¸‹æ¥"),t("strong",[s._v("æ–°åˆ›å»ºçš„è¿žæŽ¥ä¼šä½¿ç”¨æ–°çš„æƒé™")]),s._v(".")]),s._v(" "),t("li",[s._v("å¯¹äºŽä¸€ä¸ªå·²ç»å­˜åœ¨çš„è¿žæŽ¥, å®ƒçš„å…¨å±€æƒé™ä¸å— grant å‘½ä»¤çš„å½±å“.")])]),s._v(" "),t("p",[s._v("éœ€è¦è¯´æ˜Žçš„æ˜¯, "),t("strong",[s._v("ä¸€èˆ¬åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸Šè¦åˆç†æŽ§åˆ¶ç”¨æˆ·æƒé™çš„èŒƒå›´")]),s._v(". ä¸Šé¢ç”¨åˆ°çš„è¿™ä¸ª grant è¯­å¥å°±æ˜¯ä¸€ä¸ªå…¸åž‹çš„é”™è¯¯ç¤ºèŒƒ. å¦‚æžœä¸€ä¸ªç”¨æˆ·æœ‰æ‰€æœ‰æƒé™, ä¸€èˆ¬å°±ä¸åº”è¯¥è®¾ç½®ä¸ºæ‰€æœ‰ IP åœ°å€éƒ½å¯ä»¥è®¿é—®.")]),s._v(" "),t("p",[s._v("å¦‚æžœè¦å›žæ”¶ä¸Šé¢çš„ grant è¯­å¥èµ‹äºˆçš„æƒé™, å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("revoke")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ua'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ¡ revoke å‘½ä»¤çš„ç”¨æ³•ä¸Ž grant ç±»ä¼¼, åšäº†å¦‚ä¸‹ä¸¤ä¸ªåŠ¨ä½œ:")]),s._v(" "),t("ol",[t("li",[s._v("ç£ç›˜ä¸Š, å°† mysql.user è¡¨é‡Œ, ç”¨æˆ· "),t("code",[s._v("'ua'@'%'")]),s._v('â€‹ è¿™ä¸€è¡Œçš„æ‰€æœ‰è¡¨ç¤ºæƒé™çš„å­—æ®µçš„å€¼éƒ½ä¿®æ”¹ä¸º "N";')]),s._v(" "),t("li",[s._v("å†…å­˜é‡Œ, ä»Žæ•°ç»„ acl_users ä¸­æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·å¯¹åº”çš„å¯¹è±¡, å°† access çš„å€¼ä¿®æ”¹ä¸º 0.")])]),s._v(" "),t("h5",{attrs:{id:"dbæƒé™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dbæƒé™"}},[s._v("#")]),s._v(" dbæƒé™")]),s._v(" "),t("p",[s._v("é™¤äº†å…¨å±€æƒé™, MySQL ä¹Ÿæ”¯æŒåº“çº§åˆ«çš„æƒé™å®šä¹‰. å¦‚æžœè¦è®©ç”¨æˆ· ua æ‹¥æœ‰åº“ db1 çš„æ‰€æœ‰æƒé™, å¯ä»¥æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" db1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ua'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("option")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("åŸºäºŽåº“çš„æƒé™è®°å½•ä¿å­˜åœ¨ mysql.db è¡¨ä¸­, åœ¨å†…å­˜é‡Œåˆ™ä¿å­˜åœ¨æ•°ç»„ acl_dbs ä¸­. è¿™æ¡ grant å‘½ä»¤åšäº†å¦‚ä¸‹ä¸¤ä¸ªåŠ¨ä½œ:")]),s._v(" "),t("ol",[t("li",[s._v("ç£ç›˜ä¸Š, å¾€ "),t("strong",[s._v("mysql.db")]),s._v(' è¡¨ä¸­æ’å…¥äº†ä¸€è¡Œè®°å½•, æ‰€æœ‰æƒé™ä½å­—æ®µè®¾ç½®ä¸º "Y";')]),s._v(" "),t("li",[s._v('å†…å­˜é‡Œ, å¢žåŠ ä¸€ä¸ªå¯¹è±¡åˆ°æ•°ç»„ acl_dbs ä¸­, è¿™ä¸ªå¯¹è±¡çš„æƒé™ä½ä¸º "å…¨ 1".')])]),s._v(" "),t("p",[s._v("ä¸‹å›¾å°±æ˜¯è¿™ä¸ªæ—¶åˆ»ç”¨æˆ· ua åœ¨ db è¡¨ä¸­çš„çŠ¶æ€.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c9510c21cce20684d5bbc3f29c9b4f83-20230731161914-nz86f1c.png",alt:"",title:"å›¾2 mysql.dbæ•°æ®è¡Œ"}})]),s._v(" "),t("p",[t("strong",[s._v("æ¯æ¬¡éœ€è¦åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·å¯¹ä¸€ä¸ªæ•°æ®åº“è¯»å†™æƒé™çš„æ—¶å€™, éƒ½éœ€è¦éåŽ†ä¸€æ¬¡ acl_dbs æ•°ç»„, æ ¹æ® user, host å’Œ db æ‰¾åˆ°åŒ¹é…çš„å¯¹è±¡, ç„¶åŽæ ¹æ®å¯¹è±¡çš„æƒé™ä½æ¥åˆ¤æ–­")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, grant ä¿®æ”¹ db æƒé™çš„æ—¶å€™, æ˜¯"),t("strong",[s._v("åŒæ—¶å¯¹ç£ç›˜å’Œå†…å­˜ç”Ÿæ•ˆ")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("grant æ“ä½œå¯¹äºŽå·²ç»å­˜åœ¨çš„è¿žæŽ¥çš„å½±å“, åœ¨å…¨å±€æƒé™å’ŒåŸºäºŽ db çš„æƒé™æ•ˆæžœæ˜¯ä¸åŒçš„. æŽ¥ä¸‹æ¥åšä¸€ä¸ªå¯¹ç…§è¯•éªŒæ¥åˆ†åˆ«çœ‹ä¸€ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/fb2071351c6ed9ea8f26465b93e40f91-20230731161914-ovn7wca.png",alt:"",title:"å›¾3 æƒé™æ“ä½œæ•ˆæžœ"}})]),s._v(" "),t("p",[s._v("éœ€è¦è¯´æ˜Žçš„æ˜¯, å›¾ä¸­ set global sync_binlog è¿™ä¸ªæ“ä½œæ˜¯éœ€è¦ super æƒé™çš„.")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è™½ç„¶ç”¨æˆ· ua çš„ super æƒé™åœ¨ T3 æ—¶åˆ»å·²ç»é€šè¿‡ revoke è¯­å¥å›žæ”¶äº†, ä½†æ˜¯åœ¨ T4 æ—¶åˆ»æ‰§è¡Œ set global çš„æ—¶å€™, æƒé™éªŒè¯è¿˜æ˜¯é€šè¿‡äº†. è¿™æ˜¯å› ä¸º super æ˜¯"),t("strong",[s._v("å…¨å±€æƒé™")]),s._v(", è¿™ä¸ªæƒé™ä¿¡æ¯åœ¨çº¿ç¨‹å¯¹è±¡ä¸­, è€Œ revoke æ“ä½œå½±å“ä¸åˆ°è¿™ä¸ªçº¿ç¨‹å¯¹è±¡.")]),s._v(" "),t("p",[s._v('è€Œåœ¨ T5 æ—¶åˆ»åŽ»æŽ‰ ua å¯¹ db1 åº“çš„æ‰€æœ‰æƒé™åŽ, åœ¨ T6 æ—¶åˆ» session B å†æ“ä½œ db1 åº“çš„è¡¨, å°±ä¼šæŠ¥é”™ "æƒé™ä¸è¶³". è¿™æ˜¯å› ä¸º acl_dbs æ˜¯ä¸€ä¸ª'),t("strong",[s._v("å…¨å±€æ•°ç»„")]),s._v(", æ‰€æœ‰çº¿ç¨‹åˆ¤æ–­ db æƒé™éƒ½ç”¨è¿™ä¸ªæ•°ç»„, è¿™æ · revoke æ“ä½œé©¬ä¸Šå°±ä¼šå½±å“åˆ° session B.")]),s._v(" "),t("p",[s._v("è¿™é‡Œåœ¨ä»£ç å®žçŽ°ä¸Šæœ‰ä¸€ä¸ªç‰¹åˆ«çš„é€»è¾‘, å¦‚æžœå½“å‰ä¼šè¯å·²ç»å¤„äºŽæŸä¸€ä¸ª db é‡Œé¢, ä¹‹å‰ use è¿™ä¸ªåº“çš„æ—¶å€™æ‹¿åˆ°çš„åº“æƒé™ä¼šä¿å­˜åœ¨ä¼šè¯å˜é‡ä¸­.")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°åœ¨ T6 æ—¶åˆ», session C å’Œ session B å¯¹è¡¨ t çš„æ“ä½œé€»è¾‘æ˜¯ä¸€æ ·çš„. ä½†æ˜¯ session B æŠ¥é”™, è€Œ session C å¯ä»¥æ‰§è¡ŒæˆåŠŸ. è¿™æ˜¯å› ä¸º session C åœ¨ T2 æ—¶åˆ»æ‰§è¡Œçš„ use db1, æ‹¿åˆ°äº†è¿™ä¸ªåº“çš„æƒé™, åœ¨åˆ‡æ¢å‡º db1 åº“ä¹‹å‰, session C å¯¹è¿™ä¸ªåº“å°±ä¸€ç›´æœ‰æƒé™.")]),s._v(" "),t("h5",{attrs:{id:"è¡¨æƒé™å’Œåˆ—æƒé™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¡¨æƒé™å’Œåˆ—æƒé™"}},[s._v("#")]),s._v(" è¡¨æƒé™å’Œåˆ—æƒé™")]),s._v(" "),t("p",[s._v("é™¤äº† db çº§åˆ«çš„æƒé™å¤–, MySQL æ”¯æŒæ›´ç»†ç²’åº¦çš„"),t("strong",[s._v("è¡¨æƒé™å’Œåˆ—æƒé™")]),s._v(". å…¶ä¸­, è¡¨æƒé™å®šä¹‰å­˜æ”¾åœ¨è¡¨ "),t("strong",[s._v("mysql.tables_priv")]),s._v(" ä¸­, åˆ—æƒé™å®šä¹‰å­˜æ”¾åœ¨è¡¨ "),t("strong",[s._v("mysql.columns_priv")]),s._v(" ä¸­. è¿™ä¸¤ç±»æƒé™, ç»„åˆèµ·æ¥å­˜æ”¾åœ¨å†…å­˜çš„ hash ç»“æž„ column_priv_hash ä¸­.")]),s._v(" "),t("p",[s._v("è¿™ä¸¤ç±»æƒé™çš„èµ‹æƒå‘½ä»¤å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" db1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" db1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ua'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("option")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" mydb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mytbl "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ua'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("option")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("è·Ÿ db æƒé™ç±»ä¼¼, è¿™ä¸¤ä¸ªæƒé™æ¯æ¬¡ grant çš„æ—¶å€™éƒ½ä¼šä¿®æ”¹æ•°æ®è¡¨, ä¹Ÿä¼šåŒæ­¥ä¿®æ”¹å†…å­˜ä¸­çš„ hash ç»“æž„. å› æ­¤, å¯¹è¿™ä¸¤ç±»æƒé™çš„æ“ä½œ, "),t("strong",[s._v("ä¹Ÿä¼šé©¬ä¸Šå½±å“åˆ°å·²ç»å­˜åœ¨çš„è¿žæŽ¥")]),s._v(".")]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™é‡Œ, ä½ ä¸€å®šä¼šé—®, çœ‹æ¥ grant è¯­å¥éƒ½æ˜¯"),t("strong",[s._v("å³æ—¶ç”Ÿæ•ˆ")]),s._v("çš„, é‚£è¿™ä¹ˆçœ‹åº”è¯¥å°±ä¸éœ€è¦æ‰§è¡Œ flush privileges è¯­å¥äº†å‘€.")]),s._v(" "),t("p",[t("strong",[s._v("ç­”æ¡ˆä¹Ÿç¡®å®žæ˜¯è¿™æ ·çš„")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("flush privileges å‘½ä»¤ä¼šæ¸…ç©º acl_users æ•°ç»„, ç„¶åŽä»Ž mysql.user è¡¨ä¸­è¯»å–æ•°æ®é‡æ–°åŠ è½½, é‡æ–°æž„é€ ä¸€ä¸ª acl_users æ•°ç»„. ä¹Ÿå°±æ˜¯è¯´, ä»¥æ•°æ®è¡¨ä¸­çš„æ•°æ®ä¸ºå‡†, ä¼šå°†å…¨å±€æƒé™å†…å­˜æ•°ç»„é‡æ–°åŠ è½½ä¸€é.")])]),s._v(" "),t("p",[s._v("åŒæ ·åœ°, å¯¹äºŽ db æƒé™, è¡¨æƒé™å’Œåˆ—æƒé™, MySQL ä¹Ÿåšäº†è¿™æ ·çš„å¤„ç†.")]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, å¦‚æžœå†…å­˜çš„æƒé™æ•°æ®å’Œç£ç›˜æ•°æ®è¡¨ç›¸åŒçš„è¯, ä¸éœ€è¦æ‰§è¡Œ flush privileges. è€Œå¦‚æžœéƒ½æ˜¯ç”¨ "),t("code",[s._v("grant/revoke")]),s._v("â€‹ è¯­å¥æ¥æ‰§è¡Œçš„è¯, å†…å­˜å’Œæ•°æ®è¡¨æœ¬æ¥å°±æ˜¯ä¿æŒåŒæ­¥æ›´æ–°çš„.")]),s._v(" "),t("p",[s._v("**å› æ­¤, æ­£å¸¸æƒ…å†µä¸‹, grant å‘½ä»¤ä¹‹åŽ, æ²¡æœ‰å¿…è¦è·Ÿç€æ‰§è¡Œ flush privileges å‘½ä»¤. **")]),s._v(" "),t("h5",{attrs:{id:"flush-privilegesä½¿ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flush-privilegesä½¿ç”¨åœºæ™¯"}},[s._v("#")]),s._v(" flush privilegesä½¿ç”¨åœºæ™¯")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, flush privileges æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å‘¢? æ˜¾ç„¶, "),t("strong",[s._v("å½“æ•°æ®è¡¨ä¸­çš„æƒé™æ•°æ®è·Ÿå†…å­˜ä¸­çš„æƒé™æ•°æ®ä¸ä¸€è‡´çš„æ—¶å€™, flush privileges è¯­å¥å¯ä»¥ç”¨æ¥é‡å»ºå†…å­˜æ•°æ®, è¾¾åˆ°ä¸€è‡´çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ç§ä¸ä¸€è‡´å¾€å¾€æ˜¯ç”±ä¸è§„èŒƒçš„æ“ä½œå¯¼è‡´çš„, æ¯”å¦‚ç›´æŽ¥ç”¨ DML è¯­å¥æ“ä½œç³»ç»Ÿæƒé™è¡¨. æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªåœºæ™¯:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/fc7ace21a01d3824f18c1b0b5612db48-20230731161914-eax5nxi.png",alt:"",title:"å›¾4 ä½¿ç”¨flush privileges"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, T3 æ—¶åˆ»è™½ç„¶å·²ç»ç”¨ delete è¯­å¥åˆ é™¤äº†ç”¨æˆ· ua, ä½†æ˜¯åœ¨ T4 æ—¶åˆ», ä»ç„¶å¯ä»¥ç”¨ ua è¿žæŽ¥æˆåŠŸ. åŽŸå› å°±æ˜¯, è¿™æ—¶å€™å†…å­˜ä¸­ acl_users æ•°ç»„ä¸­è¿˜æœ‰è¿™ä¸ªç”¨æˆ·, å› æ­¤ç³»ç»Ÿåˆ¤æ–­æ—¶è®¤ä¸ºç”¨æˆ·è¿˜æ­£å¸¸å­˜åœ¨.")]),s._v(" "),t("p",[s._v('åœ¨ T5 æ—¶åˆ»æ‰§è¡Œè¿‡ flush å‘½ä»¤åŽ, å†…å­˜æ›´æ–°, T6 æ—¶åˆ»å†è¦ç”¨ ua æ¥ç™»å½•çš„è¯, å°±ä¼šæŠ¥é”™"æ— æ³•è®¿é—®"äº†.')]),s._v(" "),t("p",[t("strong",[s._v('ç›´æŽ¥æ“ä½œç³»ç»Ÿè¡¨æ˜¯ä¸è§„èŒƒçš„æ“ä½œ, è¿™ä¸ªä¸ä¸€è‡´çŠ¶æ€ä¹Ÿä¼šå¯¼è‡´ä¸€äº›æ›´"è¯¡å¼‚"çš„çŽ°è±¡å‘ç”Ÿ')]),s._v(". æ¯”å¦‚, å‰é¢è¿™ä¸ªé€šè¿‡ delete è¯­å¥åˆ é™¤ç”¨æˆ·çš„ä¾‹å­, å°±ä¼šå‡ºçŽ°ä¸‹é¢çš„æƒ…å†µ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2cd5ab49a72de2c66ce5e6bd655138e2-20230731161914-fe02hul.png",alt:"",title:"å›¾5 ä¸è§„èŒƒæƒé™æ“ä½œå¯¼è‡´çš„å¼‚å¸¸"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ç”±äºŽåœ¨ T3 æ—¶åˆ»ç›´æŽ¥åˆ é™¤äº†æ•°æ®è¡¨çš„è®°å½•, è€Œå†…å­˜çš„æ•°æ®è¿˜å­˜åœ¨. è¿™å°±å¯¼è‡´äº†:")]),s._v(" "),t("ol",[t("li",[s._v("T4 æ—¶åˆ»ç»™ç”¨æˆ· ua èµ‹æƒé™å¤±è´¥, å› ä¸º mysql.user è¡¨ä¸­æ‰¾ä¸åˆ°è¿™è¡Œè®°å½•;")]),s._v(" "),t("li",[s._v("è€Œ T5 æ—¶åˆ»è¦é‡æ–°åˆ›å»ºè¿™ä¸ªç”¨æˆ·ä¹Ÿä¸è¡Œ, å› ä¸ºåœ¨åšå†…å­˜åˆ¤æ–­çš„æ—¶å€™, ä¼šè®¤ä¸ºè¿™ä¸ªç”¨æˆ·è¿˜å­˜åœ¨.")])]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-40"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-40"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL ç”¨æˆ·æƒé™åœ¨æ•°æ®è¡¨å’Œå†…å­˜ä¸­çš„å­˜åœ¨å½¢å¼, ä»¥åŠ grant å’Œ revoke å‘½ä»¤çš„æ‰§è¡Œé€»è¾‘.")]),s._v(" "),t("p",[t("strong",[s._v("grant è¯­å¥ä¼šåŒæ—¶ä¿®æ”¹æ•°æ®è¡¨å’Œå†…å­˜, åˆ¤æ–­æƒé™çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯å†…å­˜æ•°æ®. å› æ­¤, è§„èŒƒåœ°ä½¿ç”¨ grant å’Œ revoke è¯­å¥, æ˜¯ä¸éœ€è¦éšåŽåŠ ä¸Š flush privileges è¯­å¥çš„.")])]),s._v(" "),t("p",[s._v("flush privileges è¯­å¥æœ¬èº«ä¼šç”¨æ•°æ®è¡¨çš„æ•°æ®é‡å»ºä¸€ä»½å†…å­˜æƒé™æ•°æ®, æ‰€ä»¥åœ¨æƒé™æ•°æ®å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µä¸‹å†ä½¿ç”¨. è€Œè¿™ç§ä¸ä¸€è‡´å¾€å¾€æ˜¯ç”±äºŽç›´æŽ¥ç”¨ DML è¯­å¥æ“ä½œç³»ç»Ÿæƒé™è¡¨å¯¼è‡´çš„, æ‰€ä»¥å°½é‡ä¸è¦ä½¿ç”¨è¿™ç±»è¯­å¥.")]),s._v(" "),t("h4",{attrs:{id:"_43-è¦ä¸è¦ä½¿ç”¨åˆ†åŒºè¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_43-è¦ä¸è¦ä½¿ç”¨åˆ†åŒºè¡¨"}},[s._v("#")]),s._v(" 43-è¦ä¸è¦ä½¿ç”¨åˆ†åŒºè¡¨?")]),s._v(" "),t("p",[s._v("æˆ‘ç»å¸¸è¢«é—®åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜: "),t("strong",[s._v("åˆ†åŒºè¡¨æœ‰ä»€ä¹ˆé—®é¢˜, ä¸ºä»€ä¹ˆå…¬å¸è§„èŒƒä¸è®©ä½¿ç”¨åˆ†åŒºè¡¨å‘¢")]),s._v("? æœ¬èŠ‚å°±æ¥èŠèŠåˆ†åŒºè¡¨çš„ä½¿ç”¨è¡Œä¸º, ç„¶åŽå†ä¸€èµ·å›žç­”è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"åˆ†åŒºè¡¨æ˜¯ä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†åŒºè¡¨æ˜¯ä»€ä¹ˆ"}},[s._v("#")]),s._v(" åˆ†åŒºè¡¨æ˜¯ä»€ä¹ˆ?")]),s._v(" "),t("p",[s._v("ä¸ºäº†è¯´æ˜Žåˆ†åŒºè¡¨çš„ç»„ç»‡å½¢å¼, å…ˆåˆ›å»ºä¸€ä¸ªè¡¨ t:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ftime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("datetime")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ftime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("latin1\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" RANGE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("YEAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ftime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" p_2017 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" LESS THAN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" p_2018 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" LESS THAN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" p_2019 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" LESS THAN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" p_others "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" LESS THAN MAXVALUE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-4-1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2018-4-1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("åœ¨è¡¨ t ä¸­åˆå§‹åŒ–æ’å…¥äº†ä¸¤è¡Œè®°å½•, æŒ‰ç…§å®šä¹‰çš„åˆ†åŒºè§„åˆ™, è¿™ä¸¤è¡Œè®°å½•åˆ†åˆ«è½åœ¨ p_2018 å’Œ p_2019 è¿™"),t("strong",[s._v("ä¸¤ä¸ªåˆ†åŒº")]),s._v("ä¸Š.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ae865a83b8450d3a4886ef1f38db263a-20230731161914-2gk8bm6.png",alt:"",title:"å›¾1 è¡¨tçš„ç£ç›˜æ–‡ä»¶"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªè¡¨åŒ…å«äº†ä¸€ä¸ª .frm æ–‡ä»¶å’Œ 4 ä¸ª.ibd æ–‡ä»¶, æ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ª .ibd æ–‡ä»¶. ä¹Ÿå°±æ˜¯è¯´:")]),s._v(" "),t("ul",[t("li",[s._v("å¯¹äºŽå¼•æ“Žå±‚æ¥è¯´, è¿™æ˜¯ 4 ä¸ªè¡¨;")]),s._v(" "),t("li",[s._v("å¯¹äºŽ Server å±‚æ¥è¯´, è¿™æ˜¯ 1 ä¸ªè¡¨.")])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šè§‰å¾—è¿™ä¸¤å¥éƒ½æ˜¯åºŸè¯. å…¶å®žä¸ç„¶, è¿™ä¸¤å¥è¯éžå¸¸é‡è¦, å¯ä»¥å¸®ç†è§£åˆ†åŒºè¡¨çš„æ‰§è¡Œé€»è¾‘.")]),s._v(" "),t("h5",{attrs:{id:"åˆ†åŒºè¡¨çš„å¼•æ“Žå±‚è¡Œä¸º"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†åŒºè¡¨çš„å¼•æ“Žå±‚è¡Œä¸º"}},[s._v("#")]),s._v(" åˆ†åŒºè¡¨çš„å¼•æ“Žå±‚è¡Œä¸º")]),s._v(" "),t("p",[s._v("å…ˆä¸¾ä¸ªåœ¨åˆ†åŒºè¡¨"),t("strong",[s._v("åŠ é—´éš™é”")]),s._v("çš„ä¾‹å­, ç›®çš„æ˜¯è¯´æ˜Žå¯¹äºŽ InnoDB æ¥è¯´, è¿™æ˜¯ 4 ä¸ªè¡¨.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a47a3d7ff87f6870e5c7a72c11dc3e4d-20230731161914-wycxkmk.png",alt:"",title:"å›¾2 åˆ†åŒºè¡¨é—´éš™é”ç¤ºä¾‹"}})]),s._v(" "),t("p",[s._v("å¯ä»¥å¤ä¹ ä¸€ä¸‹å‰é¢ä»‹ç»çš„é—´éš™é”åŠ é”è§„åˆ™. è¿™é‡Œåˆå§‹åŒ–è¡¨ t çš„æ—¶å€™, åªæ’å…¥äº†ä¸¤è¡Œæ•°æ®, ftime çš„å€¼åˆ†åˆ«æ˜¯ '2017-4-1' å’Œ '2018-4-1'. session A çš„ select è¯­å¥å¯¹ç´¢å¼• ftime ä¸Š"),t("strong",[s._v("è¿™ä¸¤ä¸ªè®°å½•ä¹‹é—´çš„é—´éš™åŠ äº†é”")]),s._v(". å¦‚æžœæ˜¯ä¸€ä¸ªæ™®é€šè¡¨çš„è¯, é‚£ä¹ˆ T1 æ—¶åˆ», åœ¨è¡¨ t çš„ ftime ç´¢å¼•ä¸Š, é—´éš™å’ŒåŠ é”çŠ¶æ€åº”è¯¥æ˜¯å›¾ 3 è¿™æ ·çš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2a4744ffb50e2677ae8c1c2c58af7f28-20230731161914-4w5korm.png",alt:"",title:"å›¾3 æ™®é€šè¡¨çš„åŠ é”èŒƒå›´"}})]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, '2017-4-1' å’Œ '2018-4-1' è¿™ä¸¤ä¸ªè®°å½•ä¹‹é—´çš„é—´éš™æ˜¯ä¼šè¢«é”ä½çš„. é‚£ä¹ˆ, sesion B çš„ä¸¤æ¡æ’å…¥è¯­å¥åº”è¯¥éƒ½è¦è¿›å…¥"),t("strong",[s._v("é”ç­‰å¾…çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½†æ˜¯ä»Žä¸Šé¢çš„å®žéªŒæ•ˆæžœå¯ä»¥çœ‹å‡º, session B çš„ç¬¬ä¸€ä¸ª insert è¯­å¥æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„. è¿™æ˜¯å› ä¸º, å¯¹äºŽå¼•æ“Žæ¥è¯´, p_2018 å’Œ p_2019 æ˜¯"),t("strong",[s._v("ä¸¤ä¸ªä¸åŒçš„è¡¨")]),s._v(", ä¹Ÿå°±æ˜¯è¯´ '2017-4-1' çš„ä¸‹ä¸€ä¸ªè®°å½•å¹¶ä¸æ˜¯ '2018-4-1', è€Œæ˜¯ p_2018 åˆ†åŒºçš„ supremum. æ‰€ä»¥ T1 æ—¶åˆ», åœ¨è¡¨ t çš„ ftime ç´¢å¼•ä¸Š, é—´éš™å’ŒåŠ é”çš„çŠ¶æ€å…¶å®žæ˜¯å›¾ 4 è¿™æ ·çš„:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7eee3c1b420cbf78e94d7d3a0e97da4f-20230731161914-i49gdty.png",alt:"",title:"å›¾4 åˆ†åŒºè¡¨tçš„åŠ é”èŒƒå›´"}})]),s._v(" "),t("p",[s._v("ç”±äºŽåˆ†åŒºè¡¨çš„è§„åˆ™, session A çš„ select è¯­å¥å…¶å®žåªæ“ä½œäº†åˆ†åŒº p_2018, å› æ­¤åŠ é”èŒƒå›´å°±æ˜¯å›¾ 4 ä¸­æ·±ç»¿è‰²çš„éƒ¨åˆ†.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, session B è¦å†™å…¥ä¸€è¡Œ ftime æ˜¯ 2018-2-1 çš„æ—¶å€™æ˜¯å¯ä»¥æˆåŠŸçš„, è€Œè¦å†™å…¥ '2017-12-1' è¿™ä¸ªè®°å½•, å°±è¦ç­‰ session A çš„é—´éš™é”.")]),s._v(" "),t("p",[s._v("å›¾ 5 å°±æ˜¯è¿™æ—¶å€™çš„ show engine innodb status çš„éƒ¨åˆ†ç»“æžœ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e7f2e3086e3f831512df12f907be103c-20230731161914-y0ymldq.png",alt:"",title:"å›¾5 session Bè¢«é”ä½ä¿¡æ¯"}})]),s._v(" "),t("p",[s._v("çœ‹å®Œ InnoDB å¼•æ“Žçš„ä¾‹å­, å†æ¥ä¸€ä¸ª MyISAM åˆ†åŒºè¡¨çš„ä¾‹å­.")]),s._v(" "),t("p",[s._v("é¦–å…ˆç”¨ "),t("code",[s._v("alter table t engine=myisam")]),s._v("â€‹, æŠŠè¡¨ t æ”¹æˆ MyISAM è¡¨; ç„¶åŽå†ç”¨ä¸‹é¢è¿™ä¸ªä¾‹å­è¯´æ˜Ž, å¯¹äºŽ MyISAM å¼•æ“Žæ¥è¯´, è¿™æ˜¯ 4 ä¸ªè¡¨.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f630d513bbc80a84f2f80c7ea9288cb5-20230731161914-2356fjy.png",alt:"",title:"å›¾6 ç”¨MyISAMè¡¨é”éªŒè¯"}})]),s._v(" "),t("p",[s._v("åœ¨ session A é‡Œé¢, ç”¨ sleep(100) å°†è¿™æ¡è¯­å¥çš„æ‰§è¡Œæ—¶é—´è®¾ç½®ä¸º 100 ç§’. ç”±äºŽ MyISAM å¼•æ“Žåªæ”¯æŒè¡¨é”, æ‰€ä»¥è¿™æ¡ update è¯­å¥ä¼šé”ä½æ•´ä¸ªè¡¨ t ä¸Šçš„è¯».")]),s._v(" "),t("p",[s._v("ä½†çœ‹åˆ°çš„ç»“æžœæ˜¯, session B çš„ç¬¬ä¸€æ¡æŸ¥è¯¢è¯­å¥æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„, ç¬¬äºŒæ¡è¯­å¥æ‰è¿›å…¥é”ç­‰å¾…çŠ¶æ€.")]),s._v(" "),t("p",[s._v("è¿™æ­£æ˜¯å› ä¸º MyISAM çš„"),t("strong",[s._v("è¡¨é”æ˜¯åœ¨å¼•æ“Žå±‚å®žçŽ°")]),s._v("çš„, session A åŠ çš„è¡¨é”, å…¶å®žæ˜¯é”åœ¨åˆ†åŒº p_2018 ä¸Š. å› æ­¤, åªä¼šå µä½åœ¨è¿™ä¸ªåˆ†åŒºä¸Šæ‰§è¡Œçš„æŸ¥è¯¢, è½åˆ°å…¶ä»–åˆ†åŒºçš„æŸ¥è¯¢æ˜¯ä¸å—å½±å“çš„.")]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™é‡Œ, ä½ å¯èƒ½ä¼šè¯´, åˆ†åŒºè¡¨çœ‹æ¥è¿˜ä¸é”™å˜›, ä¸ºä»€ä¹ˆä¸è®©ç”¨å‘¢? "),t("strong",[s._v("ä½¿ç”¨åˆ†åŒºè¡¨çš„ä¸€ä¸ªé‡è¦åŽŸå› å°±æ˜¯å•è¡¨è¿‡å¤§")]),s._v(". é‚£ä¹ˆ, å¦‚æžœä¸ä½¿ç”¨åˆ†åŒºè¡¨çš„è¯, å°±æ˜¯è¦ä½¿ç”¨"),t("strong",[s._v("æ‰‹åŠ¨åˆ†è¡¨")]),s._v("çš„æ–¹å¼.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥çœ‹çœ‹"),t("strong",[s._v("æ‰‹åŠ¨åˆ†è¡¨å’Œåˆ†åŒºè¡¨æœ‰ä»€ä¹ˆåŒºåˆ«")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚, æŒ‰ç…§å¹´ä»½æ¥åˆ’åˆ†, å°±åˆ†åˆ«åˆ›å»ºæ™®é€šè¡¨ t_2017, t_2018, t_2019 ç­‰ç­‰. æ‰‹å·¥åˆ†è¡¨çš„é€»è¾‘, ä¹Ÿæ˜¯æ‰¾åˆ°éœ€è¦æ›´æ–°çš„æ‰€æœ‰åˆ†è¡¨, ç„¶åŽä¾æ¬¡æ‰§è¡Œæ›´æ–°. åœ¨æ€§èƒ½ä¸Š, è¿™å’Œåˆ†åŒºè¡¨å¹¶æ²¡æœ‰å®žè´¨çš„å·®åˆ«.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("åˆ†åŒºè¡¨å’Œæ‰‹å·¥åˆ†è¡¨, ä¸€ä¸ªæ˜¯ç”± server å±‚æ¥å†³å®šä½¿ç”¨å“ªä¸ªåˆ†åŒº, ä¸€ä¸ªæ˜¯ç”±åº”ç”¨å±‚ä»£ç æ¥å†³å®šä½¿ç”¨å“ªä¸ªåˆ†è¡¨")])]),s._v(". å› æ­¤, ä»Žå¼•æ“Žå±‚çœ‹, è¿™ä¸¤ç§æ–¹å¼ä¹Ÿæ˜¯æ²¡æœ‰å·®åˆ«çš„. å…¶å®žè¿™ä¸¤ä¸ªæ–¹æ¡ˆçš„åŒºåˆ«, ä¸»è¦æ˜¯åœ¨ server å±‚ä¸Š. "),t("strong",[s._v("ä»Ž server å±‚çœ‹, å°±ä¸å¾—ä¸æåˆ°åˆ†åŒºè¡¨ä¸€ä¸ªè¢«å¹¿ä¸ºè¯Ÿç—…çš„é—®é¢˜: æ‰“å¼€è¡¨çš„è¡Œä¸º")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"åˆ†åŒºç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†åŒºç­–ç•¥"}},[s._v("#")]),s._v(" åˆ†åŒºç­–ç•¥")]),s._v(" "),t("p",[s._v("æ¯å½“ç¬¬ä¸€æ¬¡è®¿é—®ä¸€ä¸ªåˆ†åŒºè¡¨çš„æ—¶å€™, MySQL éœ€è¦æŠŠæ‰€æœ‰çš„åˆ†åŒºéƒ½è®¿é—®ä¸€é. "),t("strong",[s._v("ä¸€ä¸ªå…¸åž‹çš„æŠ¥é”™æƒ…å†µ")]),s._v("æ˜¯è¿™æ ·çš„: å¦‚æžœä¸€ä¸ªåˆ†åŒºè¡¨çš„åˆ†åŒºå¾ˆå¤š, æ¯”å¦‚è¶…è¿‡äº† 1000 ä¸ª, è€Œ MySQL å¯åŠ¨çš„æ—¶å€™, open_files_limit å‚æ•°ä½¿ç”¨çš„æ˜¯é»˜è®¤å€¼ 1024, é‚£ä¹ˆå°±ä¼šåœ¨è®¿é—®è¿™ä¸ªè¡¨çš„æ—¶å€™, ç”±äºŽéœ€è¦æ‰“å¼€æ‰€æœ‰çš„æ–‡ä»¶, å¯¼è‡´æ‰“å¼€è¡¨æ–‡ä»¶çš„ä¸ªæ•°è¶…è¿‡äº†ä¸Šé™è€ŒæŠ¥é”™.")]),s._v(" "),t("p",[s._v("ä¸‹å›¾å°±æ˜¯åˆ›å»ºçš„ä¸€ä¸ªåŒ…å«äº†å¾ˆå¤šåˆ†åŒºçš„è¡¨ t_myisam, æ‰§è¡Œä¸€æ¡æ’å…¥è¯­å¥åŽæŠ¥é”™çš„æƒ…å†µ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/76b816955f69414b9b20c6f5d8f5919d-20230731161914-6f1jrks.png",alt:"",title:"å›¾7 insertè¯­å¥æŠ¥é”™"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™æ¡ insert è¯­å¥, æ˜Žæ˜¾åªéœ€è¦è®¿é—®ä¸€ä¸ªåˆ†åŒº, ä½†è¯­å¥å´æ— æ³•æ‰§è¡Œ. è¿™æ—¶, ä½ ä¸€å®šä»Žè¡¨åçŒœåˆ°äº†, è¿™ä¸ªè¡¨ç”¨çš„æ˜¯ MyISAM å¼•æ“Ž. æ˜¯çš„, å› ä¸ºä½¿ç”¨ InnoDB å¼•æ“Žçš„è¯, å¹¶ä¸ä¼šå‡ºçŽ°è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("MyISAM åˆ†åŒºè¡¨ä½¿ç”¨çš„åˆ†åŒºç­–ç•¥, ç§°ä¸º"),t("strong",[s._v("é€šç”¨åˆ†åŒºç­–ç•¥")]),s._v("(generic partitioning), æ¯æ¬¡è®¿é—®åˆ†åŒº"),t("strong",[s._v("éƒ½ç”± server å±‚æŽ§åˆ¶")]),s._v(". é€šç”¨åˆ†åŒºç­–ç•¥, æ˜¯ MySQL ä¸€å¼€å§‹æ”¯æŒåˆ†åŒºè¡¨çš„æ—¶å€™å°±å­˜åœ¨çš„ä»£ç , åœ¨æ–‡ä»¶ç®¡ç†, è¡¨ç®¡ç†çš„å®žçŽ°ä¸Šå¾ˆç²—ç³™, å› æ­¤æœ‰æ¯”è¾ƒä¸¥é‡çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),t("p",[s._v("ä»Ž MySQL 5.7.9 å¼€å§‹, InnoDB å¼•æ“Žå¼•å…¥äº†"),t("strong",[s._v("æœ¬åœ°åˆ†åŒºç­–ç•¥")]),s._v("(native partitioning). è¿™ä¸ªç­–ç•¥æ˜¯åœ¨ "),t("strong",[s._v("InnoDB å†…éƒ¨è‡ªå·±ç®¡ç†æ‰“å¼€åˆ†åŒº")]),s._v("çš„è¡Œä¸º.")]),s._v(" "),t("p",[s._v('MySQL ä»Ž 5.7.17 å¼€å§‹, å°† MyISAM åˆ†åŒºè¡¨æ ‡è®°ä¸ºå³å°†å¼ƒç”¨ (deprecated), æ„æ€æ˜¯"ä»Žè¿™ä¸ªç‰ˆæœ¬å¼€å§‹ä¸å»ºè®®è¿™ä¹ˆä½¿ç”¨, è¯·ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ. åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ä¼šåºŸå¼ƒè¿™ä¸ªåŠŸèƒ½".')]),s._v(" "),t("p",[s._v("ä»Ž MySQL 8.0 ç‰ˆæœ¬å¼€å§‹, å°±"),t("strong",[s._v("ä¸å…è®¸åˆ›å»º MyISAM åˆ†åŒºè¡¨")]),s._v("äº†, åªå…è®¸åˆ›å»ºå·²ç»å®žçŽ°äº†æœ¬åœ°åˆ†åŒºç­–ç•¥çš„å¼•æ“Ž. ç›®å‰æ¥çœ‹, åªæœ‰ InnoDB å’Œ NDB è¿™ä¸¤ä¸ªå¼•æ“Žæ”¯æŒäº†æœ¬åœ°åˆ†åŒºç­–ç•¥.")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹ä¸€ä¸‹åˆ†åŒºè¡¨åœ¨ server å±‚çš„è¡Œä¸º.")]),s._v(" "),t("h5",{attrs:{id:"åˆ†åŒºè¡¨çš„serverå±‚è¡Œä¸º"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†åŒºè¡¨çš„serverå±‚è¡Œä¸º"}},[s._v("#")]),s._v(" åˆ†åŒºè¡¨çš„serverå±‚è¡Œä¸º")]),s._v(" "),t("p",[s._v("å¦‚æžœä»Ž server å±‚çœ‹çš„è¯, ä¸€ä¸ªåˆ†åŒºè¡¨å°±åªæ˜¯ä¸€ä¸ªè¡¨.")]),s._v(" "),t("p",[s._v("è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€å‘¢? æŽ¥ä¸‹æ¥, å°±ç”¨ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯´æ˜Ž. å¦‚å›¾ 8 å’Œå›¾ 9 æ‰€ç¤º, åˆ†åˆ«æ˜¯è¿™ä¸ªä¾‹å­çš„æ“ä½œåºåˆ—å’Œæ‰§è¡Œç»“æžœå›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c96e9f906800eb27555f673313539be0-20230731161914-o2qdx88.png",alt:"",title:"å›¾8 åˆ†åŒºè¡¨çš„MDLé”"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ce45b2f0c89dde2cca42d84e9564f2b8-20230731161914-aajv1fv.png",alt:"",title:"å›¾9 show processlistç»“æžœ"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è™½ç„¶ session B åªéœ€è¦æ“ä½œ p_2107 è¿™ä¸ªåˆ†åŒº, "),t("strong",[s._v("ä½†æ˜¯ç”±äºŽ session A æŒæœ‰æ•´ä¸ªè¡¨ t çš„ MDL é”, å°±å¯¼è‡´äº† session B çš„ alter è¯­å¥è¢«å µä½")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¹Ÿæ˜¯ DBA åŒå­¦ç»å¸¸è¯´çš„, åˆ†åŒºè¡¨åœ¨åš DDL çš„æ—¶å€™, å½±å“ä¼šæ›´å¤§. å¦‚æžœä½¿ç”¨çš„æ˜¯æ™®é€šåˆ†è¡¨, é‚£ä¹ˆå½“åœ¨ truncate ä¸€ä¸ªåˆ†è¡¨çš„æ—¶å€™, è‚¯å®šä¸ä¼šè·Ÿå¦å¤–ä¸€ä¸ªåˆ†è¡¨ä¸Šçš„æŸ¥è¯¢è¯­å¥, å‡ºçŽ° MDL é”å†²çª.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œå°ç»“ä¸€ä¸‹:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("MySQL åœ¨ç¬¬ä¸€æ¬¡æ‰“å¼€åˆ†åŒºè¡¨çš„æ—¶å€™, éœ€è¦è®¿é—®æ‰€æœ‰çš„åˆ†åŒº;")])]),s._v(" "),t("li",[t("strong",[s._v("åœ¨ server å±‚, è®¤ä¸ºè¿™æ˜¯åŒä¸€å¼ è¡¨, å› æ­¤æ‰€æœ‰åˆ†åŒºå…±ç”¨åŒä¸€ä¸ª MDL é”;")])]),s._v(" "),t("li",[t("strong",[s._v("åœ¨å¼•æ“Žå±‚, è®¤ä¸ºè¿™æ˜¯ä¸åŒçš„è¡¨, å› æ­¤ MDL é”ä¹‹åŽçš„æ‰§è¡Œè¿‡ç¨‹, ä¼šæ ¹æ®åˆ†åŒºè¡¨è§„åˆ™, åªè®¿é—®å¿…è¦çš„åˆ†åŒº.")])])]),s._v(" "),t("p",[s._v('è€Œå…³äºŽ"å¿…è¦çš„åˆ†åŒº"çš„åˆ¤æ–­, å°±æ˜¯æ ¹æ® SQL è¯­å¥ä¸­çš„ where æ¡ä»¶, ç»“åˆåˆ†åŒºè§„åˆ™æ¥å®žçŽ°çš„. æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­, '),t("code",[s._v("where ftime='2018-4-1'")]),s._v("â€‹, æ ¹æ®åˆ†åŒºè§„åˆ™ year å‡½æ•°ç®—å‡ºæ¥çš„å€¼æ˜¯ 2018, é‚£ä¹ˆå°±ä¼šè½åœ¨ p_2019 è¿™ä¸ªåˆ†åŒº.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯å¦‚æžœè¿™ä¸ª where æ¡ä»¶æ”¹æˆ "),t("code",[s._v("where ftime>='2018-4-1'")]),s._v("â€‹, è™½ç„¶æŸ¥è¯¢ç»“æžœç›¸åŒ, ä½†æ˜¯è¿™æ—¶å€™æ ¹æ® where æ¡ä»¶, å°±è¦è®¿é—® p_2019 å’Œ p_others è¿™ä¸¤ä¸ªåˆ†åŒº.")]),s._v(" "),t("p",[s._v("å¦‚æžœæŸ¥è¯¢è¯­å¥çš„ where æ¡ä»¶ä¸­æ²¡æœ‰åˆ†åŒº key, é‚£å°±åªèƒ½è®¿é—®æ‰€æœ‰åˆ†åŒºäº†. å½“ç„¶, è¿™å¹¶ä¸æ˜¯åˆ†åŒºè¡¨çš„é—®é¢˜. å³ä½¿æ˜¯ä½¿ç”¨ä¸šåŠ¡åˆ†è¡¨çš„æ–¹å¼, where æ¡ä»¶ä¸­æ²¡æœ‰ä½¿ç”¨åˆ†è¡¨çš„ key, ä¹Ÿå¿…é¡»è®¿é—®æ‰€æœ‰çš„åˆ†è¡¨.")]),s._v(" "),t("p",[s._v("å‰é¢å·²ç»ç†è§£äº†åˆ†åŒºè¡¨çš„æ¦‚å¿µ, é‚£ä¹ˆä»€ä¹ˆåœºæ™¯ä¸‹é€‚åˆä½¿ç”¨åˆ†åŒºè¡¨å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"åˆ†åŒºè¡¨çš„åº”ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†åŒºè¡¨çš„åº”ç”¨åœºæ™¯"}},[s._v("#")]),s._v(" åˆ†åŒºè¡¨çš„åº”ç”¨åœºæ™¯")]),s._v(" "),t("p",[s._v("åˆ†åŒºè¡¨çš„ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„ä¼˜åŠ¿æ˜¯å¯¹ä¸šåŠ¡é€æ˜Ž, ç›¸å¯¹äºŽç”¨æˆ·åˆ†è¡¨æ¥è¯´, ä½¿ç”¨åˆ†åŒºè¡¨çš„ä¸šåŠ¡ä»£ç æ›´ç®€æ´. è¿˜æœ‰, åˆ†åŒºè¡¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ¸…ç†åŽ†å²æ•°æ®.")]),s._v(" "),t("p",[s._v("å¦‚æžœä¸€é¡¹ä¸šåŠ¡è·‘çš„æ—¶é—´è¶³å¤Ÿé•¿, å¾€å¾€å°±ä¼šæœ‰æ ¹æ®æ—¶é—´åˆ é™¤åŽ†å²æ•°æ®çš„éœ€æ±‚. è¿™æ—¶å€™, æŒ‰ç…§æ—¶é—´åˆ†åŒºçš„åˆ†åŒºè¡¨, å°±å¯ä»¥ç›´æŽ¥é€šè¿‡ "),t("code",[s._v("alter table t drop partition ...")]),s._v("â€‹ è¿™ä¸ªè¯­æ³•åˆ æŽ‰åˆ†åŒº, ä»Žè€Œåˆ æŽ‰è¿‡æœŸçš„åŽ†å²æ•°æ®.")]),s._v(" "),t("p",[s._v("è¿™ä¸ª "),t("code",[s._v("alter table t drop partition ...")]),s._v("â€‹ æ“ä½œæ˜¯ç›´æŽ¥åˆ é™¤åˆ†åŒºæ–‡ä»¶, æ•ˆæžœè·Ÿ drop æ™®é€šè¡¨ç±»ä¼¼. ä¸Žä½¿ç”¨ delete è¯­å¥åˆ é™¤æ•°æ®ç›¸æ¯”, ä¼˜åŠ¿æ˜¯é€Ÿåº¦å¿«, å¯¹ç³»ç»Ÿå½±å“å°.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-41"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-41"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»çš„æ˜¯ server å±‚å’Œå¼•æ“Žå±‚å¯¹åˆ†åŒºè¡¨çš„å¤„ç†æ–¹å¼. éœ€è¦æ³¨æ„çš„æ˜¯, æœ¬èŠ‚æ˜¯ä»¥èŒƒå›´åˆ†åŒº(range)ä¸ºä¾‹æ¥ä»‹ç»çš„. å®žé™…ä¸Š, MySQL è¿˜æ”¯æŒ hash åˆ†åŒº, list åˆ†åŒºç­‰åˆ†åŒºæ–¹æ³•. å¯ä»¥åœ¨éœ€è¦ç”¨åˆ°çš„æ—¶å€™, å†ç¿»ç¿»"),t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/partitioning-types.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ‰‹å†Œ"),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("p",[s._v("å®žé™…ä½¿ç”¨æ—¶, åˆ†åŒºè¡¨è·Ÿç”¨æˆ·åˆ†è¡¨æ¯”èµ·æ¥, æœ‰ä¸¤ä¸ªç»•ä¸å¼€çš„é—®é¢˜: "),t("mark",[t("strong",[s._v("ä¸€ä¸ªæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™éœ€è¦è®¿é—®æ‰€æœ‰åˆ†åŒº, å¦ä¸€ä¸ªæ˜¯å…±ç”¨ MDL é”")])]),s._v(".")]),s._v(" "),t("p",[s._v("å› æ­¤, å¦‚æžœè¦ä½¿ç”¨åˆ†åŒºè¡¨, å°±ä¸è¦åˆ›å»ºå¤ªå¤šçš„åˆ†åŒº. æˆ‘è§è¿‡ä¸€ä¸ªç”¨æˆ·åšäº†æŒ‰å¤©åˆ†åŒºç­–ç•¥, ç„¶åŽé¢„å…ˆåˆ›å»ºäº† 10 å¹´çš„åˆ†åŒº. è¿™ç§æƒ…å†µä¸‹, è®¿é—®åˆ†åŒºè¡¨çš„æ€§èƒ½è‡ªç„¶æ˜¯ä¸å¥½çš„. è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦æ³¨æ„:")]),s._v(" "),t("ol",[t("li",[s._v("åˆ†åŒºå¹¶ä¸æ˜¯è¶Šç»†è¶Šå¥½. å®žé™…ä¸Š, å•è¡¨æˆ–è€…å•åˆ†åŒºçš„æ•°æ®ä¸€åƒä¸‡è¡Œ, åªè¦æ²¡æœ‰ç‰¹åˆ«å¤§çš„ç´¢å¼•, å¯¹äºŽçŽ°åœ¨çš„ç¡¬ä»¶èƒ½åŠ›æ¥è¯´éƒ½å·²ç»æ˜¯å°è¡¨äº†.")]),s._v(" "),t("li",[s._v("åˆ†åŒºä¹Ÿä¸è¦æå‰é¢„ç•™å¤ªå¤š, åœ¨ä½¿ç”¨ä¹‹å‰é¢„å…ˆåˆ›å»ºå³å¯. æ¯”å¦‚, å¦‚æžœæ˜¯æŒ‰æœˆåˆ†åŒº, æ¯å¹´å¹´åº•æ—¶å†æŠŠä¸‹ä¸€å¹´åº¦çš„ 12 ä¸ªæ–°åˆ†åŒºåˆ›å»ºä¸Šå³å¯. å¯¹äºŽæ²¡æœ‰æ•°æ®çš„åŽ†å²åˆ†åŒº, è¦åŠæ—¶çš„ drop æŽ‰.")])]),s._v(" "),t("p",[s._v("è‡³äºŽåˆ†åŒºè¡¨çš„å…¶ä»–é—®é¢˜, æ¯”å¦‚æŸ¥è¯¢éœ€è¦è·¨å¤šä¸ªåˆ†åŒºå–æ•°æ®, æŸ¥è¯¢æ€§èƒ½å°±ä¼šæ¯”è¾ƒæ…¢, åŸºæœ¬ä¸Šå°±ä¸æ˜¯åˆ†åŒºè¡¨æœ¬èº«çš„é—®é¢˜, è€Œæ˜¯æ•°æ®é‡çš„é—®é¢˜æˆ–è€…è¯´æ˜¯ä½¿ç”¨æ–¹å¼çš„é—®é¢˜äº†.")]),s._v(" "),t("p",[s._v("å½“ç„¶, å¦‚æžœä½ çš„å›¢é˜Ÿå·²ç»ç»´æŠ¤äº†æˆç†Ÿçš„åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶, ç”¨ä¸šåŠ¡åˆ†è¡¨, å¯¹ä¸šåŠ¡å¼€å‘åŒå­¦æ²¡æœ‰é¢å¤–çš„å¤æ‚æ€§, å¯¹ DBA ä¹Ÿæ›´ç›´è§‚, è‡ªç„¶æ˜¯æ›´å¥½çš„.")]),s._v(" "),t("h4",{attrs:{id:"_45-è‡ªå¢židç”¨å®Œæ€Žä¹ˆåŠž"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_45-è‡ªå¢židç”¨å®Œæ€Žä¹ˆåŠž"}},[s._v("#")]),s._v(" 45-è‡ªå¢židç”¨å®Œæ€Žä¹ˆåŠž?")]),s._v(" "),t("p",[s._v("MySQL é‡Œæœ‰å¾ˆå¤šè‡ªå¢žçš„ id, æ¯ä¸ªè‡ªå¢ž id éƒ½æ˜¯å®šä¹‰äº†åˆå§‹å€¼, ç„¶åŽä¸åœåœ°å¾€ä¸ŠåŠ æ­¥é•¿. è™½ç„¶è‡ªç„¶æ•°æ˜¯æ²¡æœ‰ä¸Šé™çš„, ä½†æ˜¯åœ¨è®¡ç®—æœºé‡Œ, åªè¦å®šä¹‰äº†è¡¨ç¤ºè¿™ä¸ªæ•°çš„å­—èŠ‚é•¿åº¦, é‚£å®ƒå°±æœ‰ä¸Šé™. æ¯”å¦‚æ— ç¬¦å·æ•´åž‹ (unsigned int) æ˜¯ 4 ä¸ªå­—èŠ‚, ä¸Šé™å°±æ˜¯ "),t("code",[s._v("2^32-1")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("æ—¢ç„¶è‡ªå¢ž id æœ‰ä¸Šé™, å°±æœ‰å¯èƒ½è¢«ç”¨å®Œ. ä½†æ˜¯"),t("strong",[s._v("è‡ªå¢ž id ç”¨å®Œäº†ä¼šæ€Žä¹ˆæ ·")]),s._v("å‘¢? æœ¬èŠ‚å°±æ¥çœ‹çœ‹ MySQL é‡Œé¢çš„å‡ ç§è‡ªå¢ž id, ä¸€èµ·åˆ†æžä¸€ä¸‹å®ƒä»¬çš„å€¼è¾¾åˆ°ä¸Šé™ä»¥åŽ, ä¼šå‡ºçŽ°ä»€ä¹ˆæƒ…å†µ.")]),s._v(" "),t("h5",{attrs:{id:"è¡¨å®šä¹‰è‡ªå¢žå€¼id"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¡¨å®šä¹‰è‡ªå¢žå€¼id"}},[s._v("#")]),s._v(" è¡¨å®šä¹‰è‡ªå¢žå€¼id")]),s._v(" "),t("p",[s._v("è¯´åˆ°è‡ªå¢ž id, ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„åº”è¯¥å°±æ˜¯è¡¨ç»“æž„å®šä¹‰é‡Œçš„è‡ªå¢žå­—æ®µ, ä¹Ÿå°±æ˜¯å‰é¢ä»‹ç»è¿‡çš„è‡ªå¢žä¸»é”® id. "),t("strong",[s._v("è¡¨å®šä¹‰çš„è‡ªå¢žå€¼è¾¾åˆ°ä¸Šé™åŽçš„é€»è¾‘æ˜¯: å†ç”³è¯·ä¸‹ä¸€ä¸ª id æ—¶, å¾—åˆ°çš„å€¼ä¿æŒä¸å˜")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªè¯­å¥åºåˆ—éªŒè¯ä¸€ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auto_increment")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auto_increment")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967295")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æˆåŠŸæ’å…¥ä¸€è¡Œ 4294967295")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* CREATE TABLE `t` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4294967295;\n*/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Duplicate entry '4294967295' for key 'PRIMARY'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°, ç¬¬ä¸€ä¸ª insert è¯­å¥æ’å…¥æ•°æ®æˆåŠŸåŽ, è¿™ä¸ªè¡¨çš„ AUTO_INCREMENT æ²¡æœ‰æ”¹å˜(è¿˜æ˜¯ 4294967295), å°±å¯¼è‡´äº†ç¬¬äºŒä¸ª insert è¯­å¥åˆæ‹¿åˆ°"),t("strong",[s._v("ç›¸åŒçš„è‡ªå¢ž id å€¼, å†è¯•å›¾æ‰§è¡Œæ’å…¥è¯­å¥, æŠ¥ä¸»é”®å†²çªé”™è¯¯")]),s._v(".")]),s._v(" "),t("p",[s._v("**2^32-1(4294967295) ** ä¸æ˜¯ä¸€ä¸ªç‰¹åˆ«å¤§çš„æ•°, å¯¹äºŽä¸€ä¸ªé¢‘ç¹æ’å…¥åˆ é™¤æ•°æ®çš„è¡¨æ¥è¯´, æ˜¯å¯èƒ½ä¼šè¢«ç”¨å®Œçš„. å› æ­¤åœ¨å»ºè¡¨çš„æ—¶å€™éœ€è¦è€ƒå¯Ÿè¡¨æ˜¯å¦æœ‰å¯èƒ½è¾¾åˆ°è¿™ä¸ªä¸Šé™, å¦‚æžœæœ‰å¯èƒ½, å°±åº”è¯¥åˆ›å»ºæˆ 8 ä¸ªå­—èŠ‚çš„ bigint unsigned.")]),s._v(" "),t("h5",{attrs:{id:"innodbç³»ç»Ÿè‡ªå¢žrow-id"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#innodbç³»ç»Ÿè‡ªå¢žrow-id"}},[s._v("#")]),s._v(" InnoDBç³»ç»Ÿè‡ªå¢žrow_id")]),s._v(" "),t("p",[s._v("å¦‚æžœåˆ›å»ºçš„ InnoDB è¡¨æ²¡æœ‰æŒ‡å®šä¸»é”®, é‚£ä¹ˆ InnoDB åˆ›å»ºä¸€ä¸ªä¸å¯è§çš„, "),t("strong",[s._v("é•¿åº¦ä¸º 6 ä¸ªå­—èŠ‚çš„ row_id")]),s._v(". InnoDB ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„ dict_sys.row_id å€¼, æ‰€æœ‰æ— ä¸»é”®çš„ InnoDB è¡¨, æ¯æ’å…¥ä¸€è¡Œæ•°æ®, éƒ½å°†å½“å‰çš„ dict_sys.row_id å€¼ä½œä¸ºè¦æ’å…¥æ•°æ®çš„ row_id, ç„¶åŽæŠŠ dict_sys.row_id çš„å€¼åŠ  1.")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, åœ¨ä»£ç å®žçŽ°æ—¶ row_id æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 8 å­—èŠ‚çš„æ— ç¬¦å·é•¿æ•´åž‹ (bigint unsigned). ä½†æ˜¯, InnoDB åœ¨è®¾è®¡æ—¶, ç»™ row_id ç•™çš„åªæ˜¯ 6 ä¸ªå­—èŠ‚çš„é•¿åº¦, è¿™æ ·å†™åˆ°æ•°æ®è¡¨ä¸­æ—¶åªæ”¾äº†æœ€åŽ 6 ä¸ªå­—èŠ‚, æ‰€ä»¥ row_id èƒ½å†™åˆ°æ•°æ®è¡¨ä¸­çš„å€¼, å°±æœ‰ä¸¤ä¸ªç‰¹å¾:")]),s._v(" "),t("ol",[t("li",[s._v("row_id å†™å…¥è¡¨ä¸­çš„å€¼èŒƒå›´, æ˜¯ä»Ž 0 åˆ° "),t("code",[s._v("2^48-1")]),s._v("â€‹;")]),s._v(" "),t("li",[s._v("å½“ "),t("code",[s._v("dict_sys.row_id=2^48")]),s._v("â€‹ æ—¶, å¦‚æžœå†æœ‰æ’å…¥æ•°æ®çš„è¡Œä¸ºè¦æ¥ç”³è¯· row_id, æ‹¿åˆ°ä»¥åŽå†å–æœ€åŽ 6 ä¸ªå­—èŠ‚çš„è¯å°±æ˜¯ 0.")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, å†™å…¥è¡¨çš„ row_id æ˜¯ä»Ž 0 å¼€å§‹åˆ° â€‹"),t("code",[s._v("2^48-1")]),s._v("â€‹. è¾¾åˆ°ä¸Šé™åŽ, "),t("strong",[s._v("ä¸‹ä¸€ä¸ªå€¼å°±æ˜¯ 0, ç„¶åŽç»§ç»­å¾ªçŽ¯")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶, â€‹"),t("code",[s._v("2^48-1")]),s._v("â€‹ è¿™ä¸ªå€¼æœ¬èº«å·²ç»å¾ˆå¤§äº†, ä½†æ˜¯å¦‚æžœä¸€ä¸ª MySQL å®žä¾‹è·‘å¾—è¶³å¤Ÿä¹…çš„è¯, è¿˜æ˜¯å¯èƒ½è¾¾åˆ°è¿™ä¸ªä¸Šé™çš„. åœ¨ InnoDB é€»è¾‘é‡Œ, ç”³è¯·åˆ° row_id=N åŽ, å°±å°†è¿™è¡Œæ•°æ®å†™å…¥è¡¨ä¸­; å¦‚æžœè¡¨ä¸­å·²ç»å­˜åœ¨ row_id=N çš„è¡Œ, æ–°å†™å…¥çš„è¡Œå°±ä¼š"),t("strong",[s._v("è¦†ç›–åŽŸæœ‰çš„è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("è¦éªŒè¯è¿™ä¸ªç»“è®ºçš„è¯, å¯ä»¥é€šè¿‡ gdb ä¿®æ”¹ç³»ç»Ÿçš„è‡ªå¢ž row_id æ¥å®žçŽ°. æ³¨æ„, ç”¨ gdb æ”¹å˜é‡è¿™ä¸ªæ“ä½œæ˜¯ä¸ºäº†ä¾¿äºŽå¤çŽ°é—®é¢˜, åªèƒ½åœ¨æµ‹è¯•çŽ¯å¢ƒä½¿ç”¨.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c1830faaacf311a1ec6224824b642282-20230731161914-hzfybhm.png",alt:"",title:"å›¾1 row_idç”¨å®Œçš„éªŒè¯åºåˆ—"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f660a1198916221455a32a9326bc0519-20230731161914-sblab8c.png",alt:"",title:"å›¾2 row_idç”¨å®Œçš„æ•ˆæžœéªŒè¯"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, åœ¨ç”¨ gdb å°† dict_sys.row_id è®¾ç½®ä¸º "),t("code",[s._v("2^48")]),s._v("â€‹ ä¹‹åŽ, å†æ’å…¥çš„ a=2 çš„è¡Œä¼šå‡ºçŽ°åœ¨è¡¨ t çš„ç¬¬ä¸€è¡Œ, å› ä¸ºè¿™ä¸ªå€¼çš„ row_id=0. ä¹‹åŽå†æ’å…¥çš„ a=3 çš„è¡Œ, ç”±äºŽ row_id=1, å°±è¦†ç›–äº†ä¹‹å‰ a=1 çš„è¡Œ, å› ä¸º a=1 è¿™ä¸€è¡Œçš„ row_id ä¹Ÿæ˜¯ 1.")]),s._v(" "),t("p",[s._v("ä»Žè¿™ä¸ªè§’åº¦çœ‹, "),t("strong",[s._v("è¿˜æ˜¯åº”è¯¥åœ¨ InnoDB è¡¨ä¸­ä¸»åŠ¨åˆ›å»ºè‡ªå¢žä¸»é”®. å› ä¸ºè¡¨è‡ªå¢ž id åˆ°è¾¾ä¸Šé™åŽ, å†æ’å…¥æ•°æ®æ—¶æŠ¥ä¸»é”®å†²çªé”™è¯¯, æ˜¯æ›´èƒ½è¢«æŽ¥å—çš„.")])]),s._v(" "),t("p",[s._v("æ¯•ç«Ÿè¦†ç›–æ•°æ®, å°±æ„å‘³ç€æ•°æ®ä¸¢å¤±, å½±å“çš„æ˜¯æ•°æ®å¯é æ€§; æŠ¥ä¸»é”®å†²çª, æ˜¯æ’å…¥å¤±è´¥, å½±å“çš„æ˜¯å¯ç”¨æ€§. è€Œä¸€èˆ¬æƒ…å†µä¸‹, å¯é æ€§ä¼˜å…ˆäºŽå¯ç”¨æ€§.")]),s._v(" "),t("h5",{attrs:{id:"xid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#xid"}},[s._v("#")]),s._v(" Xid")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç» redo log å’Œ binlog ç›¸é…åˆçš„æ—¶å€™, æåˆ°äº†å®ƒä»¬"),t("strong",[s._v("æœ‰ä¸€ä¸ªå…±åŒçš„å­—æ®µå«ä½œ Xid")]),s._v(". å®ƒåœ¨ MySQL ä¸­æ˜¯ç”¨æ¥å¯¹åº”äº‹åŠ¡çš„. é‚£ä¹ˆ, "),t("strong",[s._v("Xid åœ¨ MySQL å†…éƒ¨æ˜¯æ€Žä¹ˆç”Ÿæˆçš„")]),s._v("å‘¢?")]),s._v(" "),t("p",[s._v("MySQL å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€å˜é‡ "),t("strong",[s._v("global_query_id")]),s._v(", æ¯æ¬¡æ‰§è¡Œè¯­å¥çš„æ—¶å€™å°†å®ƒèµ‹å€¼ç»™ Query_id, ç„¶åŽç»™è¿™ä¸ªå˜é‡åŠ  1. å¦‚æžœå½“å‰è¯­å¥æ˜¯è¿™ä¸ªäº‹åŠ¡æ‰§è¡Œçš„ç¬¬ä¸€æ¡è¯­å¥, é‚£ä¹ˆ MySQL è¿˜ä¼šåŒæ—¶æŠŠ Query_id èµ‹å€¼ç»™è¿™ä¸ªäº‹åŠ¡çš„ Xid.")]),s._v(" "),t("p",[s._v("è€Œ global_query_id æ˜¯ä¸€ä¸ª"),t("strong",[s._v("çº¯å†…å­˜å˜é‡")]),s._v(", é‡å¯ä¹‹åŽå°±æ¸…é›¶äº†. æ‰€ä»¥åœ¨åŒä¸€ä¸ªæ•°æ®åº“å®žä¾‹ä¸­, "),t("strong",[s._v("ä¸åŒäº‹åŠ¡çš„ Xid ä¹Ÿæ˜¯æœ‰å¯èƒ½ç›¸åŒ")]),s._v("çš„. ä½†æ˜¯ MySQL é‡å¯ä¹‹åŽä¼šé‡æ–°ç”Ÿæˆæ–°çš„ binlog æ–‡ä»¶, è¿™å°±ä¿è¯äº†, "),t("strong",[s._v("åŒä¸€ä¸ª binlog æ–‡ä»¶é‡Œ, Xid ä¸€å®šæ˜¯æƒŸä¸€çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("è™½ç„¶ MySQL é‡å¯ä¸ä¼šå¯¼è‡´åŒä¸€ä¸ª binlog é‡Œé¢å‡ºçŽ°ä¸¤ä¸ªç›¸åŒçš„ Xid, "),t("strong",[s._v("ä½†æ˜¯å¦‚æžœ global_query_id è¾¾åˆ°ä¸Šé™åŽ, å°±ä¼šç»§ç»­ä»Ž 0 å¼€å§‹è®¡æ•°")]),s._v(". ä»Žç†è®ºä¸Šè®², è¿˜æ˜¯å°±ä¼šå‡ºçŽ°åŒä¸€ä¸ª binlog é‡Œé¢å‡ºçŽ°ç›¸åŒ Xid çš„åœºæ™¯.")]),s._v(" "),t("p",[s._v("å› ä¸º global_query_id å®šä¹‰çš„é•¿åº¦æ˜¯ 8 ä¸ªå­—èŠ‚, è¿™ä¸ªè‡ªå¢žå€¼çš„ä¸Šé™æ˜¯ "),t("code",[s._v("2^64-1")]),s._v("â€‹. è¦å‡ºçŽ°è¿™ç§æƒ…å†µ, å¿…é¡»æ˜¯ä¸‹é¢è¿™æ ·çš„è¿‡ç¨‹:")]),s._v(" "),t("ol",[t("li",[s._v("æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡, å‡è®¾ Xid æ˜¯ A;")]),s._v(" "),t("li",[s._v("æŽ¥ä¸‹æ¥æ‰§è¡Œ "),t("code",[s._v("2^64")]),s._v("â€‹ æ¬¡æŸ¥è¯¢è¯­å¥, è®© global_query_id å›žåˆ° A;")]),s._v(" "),t("li",[s._v("å†å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡, è¿™ä¸ªäº‹åŠ¡çš„ Xid ä¹Ÿæ˜¯ A.")])]),s._v(" "),t("p",[s._v("ä¸è¿‡, "),t("code",[s._v("2^64")]),s._v("â€‹ è¿™ä¸ªå€¼å¤ªå¤§äº†, å¤§åˆ°ä½ å¯ä»¥è®¤ä¸ºè¿™ä¸ªå¯èƒ½æ€§åªä¼šå­˜åœ¨äºŽç†è®ºä¸Š.")]),s._v(" "),t("h5",{attrs:{id:"innodb-trx-id"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#innodb-trx-id"}},[s._v("#")]),s._v(" Innodb trx_id")]),s._v(" "),t("p",[s._v("Xid å’Œ InnoDB çš„ trx_id æ˜¯ä¸¤ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µ.")]),s._v(" "),t("p",[t("strong",[s._v("Xid æ˜¯ç”± server å±‚ç»´æŠ¤çš„. InnoDB å†…éƒ¨ä½¿ç”¨ Xid, å°±æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ InnoDB äº‹åŠ¡å’Œ server ä¹‹é—´åšå…³è”. ä½†æ˜¯ InnoDB è‡ªå·±çš„ trx_id, æ˜¯å¦å¤–ç»´æŠ¤çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶å®ž, ä½ åº”è¯¥éžå¸¸ç†Ÿæ‚‰è¿™ä¸ª trx_id. å®ƒå°±æ˜¯åœ¨å‰é¢ä¸­"),t("strong",[s._v("è®²äº‹åŠ¡å¯è§æ€§æ—¶, ç”¨åˆ°çš„äº‹åŠ¡ id(transaction id)")]),s._v(" . InnoDB å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª "),t("strong",[s._v("max_trx_id")]),s._v(" å…¨å±€å˜é‡, æ¯æ¬¡éœ€è¦ç”³è¯·ä¸€ä¸ªæ–°çš„ trx_id æ—¶, å°±èŽ·å¾— max_trx_id çš„å½“å‰å€¼, ç„¶åŽå¹¶å°† max_trx_id åŠ  1.")]),s._v(" "),t("p",[s._v("InnoDB æ•°æ®å¯è§æ€§çš„æ ¸å¿ƒæ€æƒ³æ˜¯: "),t("strong",[s._v("æ¯ä¸€è¡Œæ•°æ®éƒ½è®°å½•äº†æ›´æ–°å®ƒçš„ trx_id, å½“ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°ä¸€è¡Œæ•°æ®çš„æ—¶å€™, åˆ¤æ–­è¿™ä¸ªæ•°æ®æ˜¯å¦å¯è§çš„æ–¹æ³•, å°±æ˜¯é€šè¿‡äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ä¸Žè¿™è¡Œæ•°æ®çš„ trx_id åšå¯¹æ¯”")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯¹äºŽæ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡, å¯ä»¥ä»Ž information_schema.innodb_trx è¡¨ä¸­çœ‹åˆ°äº‹åŠ¡çš„ trx_id.")]),s._v(" "),t("p",[s._v("çŽ°åœ¨ä¸€èµ·æ¥çœ‹ä¸€ä¸ªäº‹åŠ¡çŽ°åœº:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1734721f82bc62bfc1b33ccdefa22468-20230731161914-dudrkd4.png",alt:"",title:"å›¾3 äº‹åŠ¡çš„trx_id"}})]),s._v(" "),t("p",[s._v("session B é‡Œ, ä»Ž innodb_trx è¡¨é‡ŒæŸ¥å‡ºçš„è¿™ä¸¤ä¸ªå­—æ®µ, ç¬¬äºŒä¸ªå­—æ®µ trx_mysql_thread_id å°±æ˜¯çº¿ç¨‹ id. æ˜¾ç¤ºçº¿ç¨‹ id, æ˜¯ä¸ºäº†è¯´æ˜Žè¿™ä¸¤æ¬¡æŸ¥è¯¢çœ‹åˆ°çš„äº‹åŠ¡å¯¹åº”çš„çº¿ç¨‹ id éƒ½æ˜¯ 5, ä¹Ÿå°±æ˜¯ session A æ‰€åœ¨çš„çº¿ç¨‹.")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, T2 æ—¶åˆ»æ˜¾ç¤ºçš„ trx_id æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°; T4 æ—¶åˆ»æ˜¾ç¤ºçš„ trx_id æ˜¯ 1289, çœ‹ä¸ŠåŽ»æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ­£å¸¸çš„æ•°å­—. è¿™æ˜¯ä»€ä¹ˆåŽŸå› å‘¢?")]),s._v(" "),t("p",[s._v("å®žé™…ä¸Š, åœ¨ T1 æ—¶åˆ», session A è¿˜æ²¡æœ‰æ¶‰åŠåˆ°æ›´æ–°, æ˜¯ä¸€ä¸ªåªè¯»äº‹åŠ¡. "),t("strong",[s._v("è€Œå¯¹äºŽåªè¯»äº‹åŠ¡, InnoDB å¹¶ä¸ä¼šåˆ†é… trx_id")]),s._v(". ä¹Ÿå°±æ˜¯è¯´:")]),s._v(" "),t("ol",[t("li",[s._v("åœ¨ T1 æ—¶åˆ», trx_id çš„å€¼å…¶å®žå°±æ˜¯ 0. è€Œè¿™ä¸ªå¾ˆå¤§çš„æ•°, åªæ˜¯æ˜¾ç¤ºç”¨çš„. ä¸€ä¼šå„¿ä¼šå†è¯´è¯´è¿™ä¸ªæ•°æ®çš„ç”Ÿæˆé€»è¾‘.")]),s._v(" "),t("li",[s._v("ç›´åˆ° session A åœ¨ T3 æ—¶åˆ»æ‰§è¡Œ insert è¯­å¥çš„æ—¶å€™, InnoDB æ‰çœŸæ­£åˆ†é…äº† trx_id. æ‰€ä»¥ T4 æ—¶åˆ», session B æŸ¥åˆ°çš„è¿™ä¸ª trx_id çš„å€¼å°±æ˜¯ 1289.")])]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, é™¤äº†æ˜¾è€Œæ˜“è§çš„ä¿®æ”¹ç±»è¯­å¥å¤–, "),t("strong",[s._v("å¦‚æžœåœ¨ select è¯­å¥åŽé¢åŠ ä¸Š for update, è¿™ä¸ªäº‹åŠ¡ä¹Ÿä¸æ˜¯åªè¯»äº‹åŠ¡")]),s._v(".")]),s._v(" "),t("p",[s._v("æœ‰äººå‘çŽ°å®žéªŒçš„æ—¶å€™å‘çŽ°ä¸æ­¢åŠ  1. è¿™æ˜¯å› ä¸º:")]),s._v(" "),t("ol",[t("li",[s._v("update å’Œ delete è¯­å¥é™¤äº†äº‹åŠ¡æœ¬èº«, è¿˜æ¶‰åŠåˆ°"),t("strong",[s._v("æ ‡è®°åˆ é™¤æ—§æ•°æ®")]),s._v(", ä¹Ÿå°±æ˜¯è¦æŠŠæ•°æ®æ”¾åˆ° purge é˜Ÿåˆ—é‡Œç­‰å¾…åŽç»­ç‰©ç†åˆ é™¤, è¿™ä¸ªæ“ä½œä¹Ÿä¼šæŠŠ max_trx_id+1, å› æ­¤åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è‡³å°‘åŠ  2;")]),s._v(" "),t("li",[s._v("InnoDB çš„åŽå°æ“ä½œ, æ¯”å¦‚è¡¨çš„ç´¢å¼•ä¿¡æ¯ç»Ÿè®¡è¿™ç±»æ“ä½œ, ä¹Ÿæ˜¯ä¼šå¯åŠ¨å†…éƒ¨äº‹åŠ¡çš„, å› æ­¤ä½ å¯èƒ½çœ‹åˆ°, trx_id å€¼å¹¶ä¸æ˜¯æŒ‰ç…§åŠ  1 é€’å¢žçš„.")])]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, **T2 æ—¶åˆ»æŸ¥åˆ°çš„è¿™ä¸ªå¾ˆå¤§çš„æ•°å­—æ˜¯æ€Žä¹ˆæ¥çš„å‘¢? **")]),s._v(" "),t("p",[s._v("å…¶å®žè¿™ä¸ªæ•°å­—æ˜¯æ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™ç”±ç³»ç»Ÿä¸´æ—¶è®¡ç®—å‡ºæ¥çš„. å®ƒçš„ç®—æ³•æ˜¯: æŠŠå½“å‰äº‹åŠ¡çš„ trx å˜é‡çš„æŒ‡é’ˆåœ°å€è½¬æˆæ•´æ•°, å†åŠ ä¸Š "),t("code",[s._v("2^48")]),s._v("â€‹. ä½¿ç”¨è¿™ä¸ªç®—æ³•, å°±å¯ä»¥ä¿è¯ä»¥ä¸‹ä¸¤ç‚¹:")]),s._v(" "),t("ol",[t("li",[s._v("å› ä¸ºåŒä¸€ä¸ªåªè¯»äº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´, å®ƒçš„æŒ‡é’ˆåœ°å€æ˜¯ä¸ä¼šå˜çš„, æ‰€ä»¥ä¸è®ºæ˜¯åœ¨ innodb_trx è¿˜æ˜¯åœ¨ innodb_locks è¡¨é‡Œ, åŒä¸€ä¸ªåªè¯»äº‹åŠ¡æŸ¥å‡ºæ¥çš„ trx_id å°±ä¼šæ˜¯ä¸€æ ·çš„.")]),s._v(" "),t("li",[s._v("å¦‚æžœæœ‰å¹¶è¡Œçš„å¤šä¸ªåªè¯»äº‹åŠ¡, æ¯ä¸ªäº‹åŠ¡çš„ trx å˜é‡çš„æŒ‡é’ˆåœ°å€è‚¯å®šä¸åŒ. è¿™æ ·ä¸åŒçš„å¹¶å‘åªè¯»äº‹åŠ¡, æŸ¥å‡ºæ¥çš„ trx_id å°±æ˜¯ä¸åŒçš„.")])]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, "),t("strong",[s._v("ä¸ºä»€ä¹ˆè¿˜è¦å†åŠ ä¸Š "),t("strong",[s._v("â€‹")]),s._v("â€‹"),t("code",[s._v("2^48")]),s._v("â€‹")]),s._v("â€‹ ** å‘¢? **")]),s._v(" "),t("p",[s._v("åœ¨æ˜¾ç¤ºå€¼é‡Œé¢åŠ ä¸Š "),t("code",[s._v("2^48")]),s._v("â€‹, ç›®çš„æ˜¯è¦ä¿è¯åªè¯»äº‹åŠ¡æ˜¾ç¤ºçš„ trx_id å€¼æ¯”è¾ƒå¤§, æ­£å¸¸æƒ…å†µä¸‹å°±ä¼šåŒºåˆ«äºŽè¯»å†™äº‹åŠ¡çš„ id. ä½†æ˜¯, trx_id è·Ÿ row_id çš„é€»è¾‘ç±»ä¼¼, å®šä¹‰é•¿åº¦ä¹Ÿæ˜¯ 8 ä¸ªå­—èŠ‚. å› æ­¤åœ¨ç†è®ºä¸Šè¿˜æ˜¯å¯èƒ½å‡ºçŽ°ä¸€ä¸ªè¯»å†™äº‹åŠ¡ä¸Žä¸€ä¸ªåªè¯»äº‹åŠ¡æ˜¾ç¤ºçš„ trx_id ç›¸åŒçš„æƒ…å†µ. ä¸è¿‡è¿™ä¸ªæ¦‚çŽ‡å¾ˆä½Ž, å¹¶ä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå®žè´¨å±å®³, å¯ä»¥ä¸ç®¡å®ƒ.")]),s._v(" "),t("p",[s._v("å¦ä¸€ä¸ªé—®é¢˜æ˜¯, **åªè¯»äº‹åŠ¡ä¸åˆ†é… trx_id, æœ‰ä»€ä¹ˆå¥½å¤„å‘¢? **")]),s._v(" "),t("ul",[t("li",[s._v("ä¸€ä¸ªå¥½å¤„æ˜¯, è¿™æ ·åšå¯ä»¥å‡å°äº‹åŠ¡è§†å›¾é‡Œé¢æ´»è·ƒäº‹åŠ¡æ•°ç»„çš„å¤§å°. å› ä¸ºå½“å‰æ­£åœ¨è¿è¡Œçš„åªè¯»äº‹åŠ¡, æ˜¯ä¸å½±å“æ•°æ®çš„å¯è§æ€§åˆ¤æ–­çš„. æ‰€ä»¥åœ¨åˆ›å»ºäº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾æ—¶, InnoDB å°±åªéœ€è¦æ‹·è´è¯»å†™äº‹åŠ¡çš„ trx_id.")]),s._v(" "),t("li",[s._v("å¦ä¸€ä¸ªå¥½å¤„æ˜¯, å¯ä»¥å‡å°‘ trx_id çš„ç”³è¯·æ¬¡æ•°. åœ¨ InnoDB é‡Œ, å³ä½¿ä½ åªæ˜¯æ‰§è¡Œä¸€ä¸ªæ™®é€šçš„ select è¯­å¥, åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­, ä¹Ÿæ˜¯è¦å¯¹åº”ä¸€ä¸ªåªè¯»äº‹åŠ¡çš„. æ‰€ä»¥åªè¯»äº‹åŠ¡ä¼˜åŒ–åŽ, æ™®é€šçš„æŸ¥è¯¢è¯­å¥ä¸éœ€è¦ç”³è¯· trx_id, å°±å¤§å¤§å‡å°‘äº†å¹¶å‘äº‹åŠ¡ç”³è¯· trx_id çš„é”å†²çª.")])]),s._v(" "),t("p",[s._v("ç”±äºŽåªè¯»äº‹åŠ¡ä¸åˆ†é… trx_id, ä¸€ä¸ªè‡ªç„¶è€Œç„¶çš„ç»“æžœå°±æ˜¯ trx_id çš„å¢žåŠ é€Ÿåº¦å˜æ…¢äº†.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯ max_trx_id ä¼šæŒä¹…åŒ–å­˜å‚¨, é‡å¯ä¹Ÿä¸ä¼šé‡ç½®ä¸º 0, é‚£ä¹ˆä»Žç†è®ºä¸Šè®², åªè¦ä¸€ä¸ª MySQL æœåŠ¡è·‘å¾—è¶³å¤Ÿä¹…, å°±å¯èƒ½å‡ºçŽ° max_trx_id è¾¾åˆ° "),t("code",[s._v("2^48-1")]),s._v("â€‹ çš„ä¸Šé™, ç„¶åŽä»Ž 0 å¼€å§‹çš„æƒ…å†µ.")]),s._v(" "),t("p",[s._v("å½“è¾¾åˆ°è¿™ä¸ªçŠ¶æ€åŽ, MySQL å°±ä¼šæŒç»­å‡ºçŽ°ä¸€ä¸ªè„è¯»çš„ bug, æ¥å¤çŽ°ä¸€ä¸‹è¿™ä¸ª bug. é¦–å…ˆéœ€è¦æŠŠå½“å‰çš„ max_trx_id å…ˆä¿®æ”¹æˆ "),t("code",[s._v("2^48-1")]),s._v("â€‹. æ³¨æ„: è¿™ä¸ª case é‡Œä½¿ç”¨çš„æ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«. å…·ä½“çš„æ“ä½œæµç¨‹å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/86839a7abd6c7eb0d7757b8776c6e345-20230731161914-h6u6dg8.png",alt:"",title:"å›¾4 å¤çŽ°è„è¯»"}})]),s._v(" "),t("p",[s._v("ç”±äºŽå·²ç»æŠŠç³»ç»Ÿçš„ max_trx_id è®¾ç½®æˆäº† â€‹"),t("code",[s._v("2^48-1")]),s._v("â€‹, æ‰€ä»¥åœ¨ session A å¯åŠ¨çš„äº‹åŠ¡ TA çš„ä½Žæ°´ä½å°±æ˜¯ â€‹"),t("code",[s._v("2^48-1")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("åœ¨ T2 æ—¶åˆ», session B æ‰§è¡Œç¬¬ä¸€æ¡ update è¯­å¥çš„äº‹åŠ¡ id å°±æ˜¯ â€‹"),t("code",[s._v("2^48-1")]),s._v("â€‹, è€Œç¬¬äºŒæ¡ update è¯­å¥çš„äº‹åŠ¡ id å°±æ˜¯ 0 äº†, è¿™æ¡ update è¯­å¥æ‰§è¡ŒåŽç”Ÿæˆçš„æ•°æ®ç‰ˆæœ¬ä¸Šçš„ trx_id å°±æ˜¯ 0.")]),s._v(" "),t("p",[s._v("åœ¨ T3 æ—¶åˆ», session A æ‰§è¡Œ select è¯­å¥çš„æ—¶å€™, åˆ¤æ–­å¯è§æ€§å‘çŽ°, c=3 è¿™ä¸ªæ•°æ®ç‰ˆæœ¬çš„ trx_id, å°äºŽäº‹åŠ¡ TA çš„ä½Žæ°´ä½, å› æ­¤è®¤ä¸ºè¿™ä¸ªæ•°æ®å¯è§.")]),s._v(" "),t("p",[s._v("ä½†, è¿™ä¸ªæ˜¯è„è¯».")]),s._v(" "),t("p",[s._v("ç”±äºŽä½Žæ°´ä½å€¼ä¼šæŒç»­å¢žåŠ , è€Œäº‹åŠ¡ id ä»Ž 0 å¼€å§‹è®¡æ•°, å°±å¯¼è‡´äº†ç³»ç»Ÿåœ¨è¿™ä¸ªæ—¶åˆ»ä¹‹åŽ, æ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä¼šå‡ºçŽ°è„è¯»çš„. å¹¶ä¸” MySQL é‡å¯æ—¶ max_trx_id ä¹Ÿä¸ä¼šæ¸… 0, ä¹Ÿå°±æ˜¯è¯´é‡å¯ MySQL, è¿™ä¸ª bug ä»ç„¶å­˜åœ¨.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ, **è¿™ä¸ª bug ä¹Ÿæ˜¯åªå­˜åœ¨äºŽç†è®ºä¸Šå—? **")]),s._v(" "),t("p",[s._v("å‡è®¾ä¸€ä¸ª MySQL å®žä¾‹çš„ TPS æ˜¯æ¯ç§’ 50 ä¸‡, æŒç»­è¿™ä¸ªåŽ‹åŠ›çš„è¯, åœ¨ 17.8 å¹´åŽ, å°±ä¼šå‡ºçŽ°è¿™ä¸ªæƒ…å†µ. å¦‚æžœ TPS æ›´é«˜, è¿™ä¸ªå¹´é™è‡ªç„¶ä¹Ÿå°±æ›´çŸ­äº†. ä½†æ˜¯, ä»Ž MySQL çš„çœŸæ­£å¼€å§‹æµè¡Œåˆ°çŽ°åœ¨, ææ€•éƒ½è¿˜æ²¡æœ‰å®žä¾‹è·‘åˆ°è¿‡è¿™ä¸ªä¸Šé™. ä¸è¿‡, è¿™ä¸ª bug æ˜¯åªè¦ MySQL å®žä¾‹æœåŠ¡æ—¶é—´å¤Ÿé•¿, å°±ä¼šå¿…ç„¶å‡ºçŽ°çš„.")]),s._v(" "),t("h5",{attrs:{id:"thread-id"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#thread-id"}},[s._v("#")]),s._v(" thread_id")]),s._v(" "),t("p",[s._v("æŽ¥ä¸‹æ¥å†çœ‹çœ‹çº¿ç¨‹ id(thread_id). å…¶å®ž, "),t("strong",[s._v("çº¿ç¨‹ id æ‰æ˜¯ MySQL ä¸­æœ€å¸¸è§çš„ä¸€ç§è‡ªå¢ž id")]),s._v(". å¹³æ—¶åœ¨æŸ¥å„ç§çŽ°åœºçš„æ—¶å€™, "),t("strong",[s._v("show processlist é‡Œé¢çš„ç¬¬ä¸€åˆ—, å°±æ˜¯ thread_id")]),s._v(".")]),s._v(" "),t("p",[s._v("thread_id çš„é€»è¾‘å¾ˆå¥½ç†è§£: "),t("mark",[t("strong",[s._v("ç³»ç»Ÿä¿å­˜äº†ä¸€ä¸ªå…¨å±€å˜é‡ thread_id_counter, æ¯æ–°å»ºä¸€ä¸ªè¿žæŽ¥, å°±å°† thread_id_counter èµ‹å€¼ç»™è¿™ä¸ªæ–°è¿žæŽ¥çš„çº¿ç¨‹å˜é‡")])]),s._v(".")]),s._v(" "),t("p",[s._v("thread_id_counter å®šä¹‰çš„å¤§å°æ˜¯ 4 ä¸ªå­—èŠ‚, å› æ­¤è¾¾åˆ° "),t("code",[s._v("2^32-1")]),s._v("â€‹ åŽ, å®ƒå°±ä¼šé‡ç½®ä¸º 0, ç„¶åŽç»§ç»­å¢žåŠ . ä½†æ˜¯, ä½ ä¸ä¼šåœ¨ show processlist é‡Œçœ‹åˆ°ä¸¤ä¸ªç›¸åŒçš„ thread_id.")]),s._v(" "),t("p",[s._v("è¿™æ˜¯å› ä¸º MySQL è®¾è®¡äº†ä¸€ä¸ªå”¯ä¸€æ•°ç»„çš„é€»è¾‘, ç»™æ–°çº¿ç¨‹åˆ†é… thread_id çš„æ—¶å€™, é€»è¾‘ä»£ç æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" {\n  new_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" thread_id_counter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n} "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("thread_ids"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("insert_unique"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("new_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("second")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™ä¸ªä»£ç é€»è¾‘ç®€å•è€Œä¸”å®žçŽ°ä¼˜é›…, ç›¸ä¿¡ä½ ä¸€çœ‹å°±èƒ½æ˜Žç™½.")]),s._v(" "),t("h5",{attrs:{id:"å°ç»“-42"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-42"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† MySQL ä¸åŒçš„è‡ªå¢ž id è¾¾åˆ°ä¸Šé™ä»¥åŽçš„è¡Œä¸º. æ•°æ®åº“ç³»ç»Ÿä½œä¸ºä¸€ä¸ªå¯èƒ½éœ€è¦ 7*24 å°æ—¶å…¨å¹´æ— ä¼‘çš„æœåŠ¡, è€ƒè™‘è¿™äº›è¾¹ç•Œæ˜¯éžå¸¸æœ‰å¿…è¦çš„.")]),s._v(" "),t("p",[s._v("æ¯ç§è‡ªå¢ž id æœ‰å„è‡ªçš„åº”ç”¨åœºæ™¯, åœ¨è¾¾åˆ°ä¸Šé™åŽçš„è¡¨çŽ°ä¹Ÿä¸åŒ:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("è¡¨çš„è‡ªå¢ž id è¾¾åˆ°ä¸Šé™åŽ, å†ç”³è¯·æ—¶å®ƒçš„å€¼å°±ä¸ä¼šæ”¹å˜, è¿›è€Œå¯¼è‡´ç»§ç»­æ’å…¥æ•°æ®æ—¶æŠ¥ä¸»é”®å†²çªçš„é”™è¯¯.")])]),s._v(" "),t("li",[t("strong",[s._v("row_id è¾¾åˆ°ä¸Šé™åŽ, åˆ™ä¼šå½’ 0 å†é‡æ–°é€’å¢ž, å¦‚æžœå‡ºçŽ°ç›¸åŒçš„ row_id, åŽå†™çš„æ•°æ®ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®")]),s._v(".")]),s._v(" "),t("li",[s._v("Xid åªéœ€è¦ä¸åœ¨åŒä¸€ä¸ª binlog æ–‡ä»¶ä¸­å‡ºçŽ°é‡å¤å€¼å³å¯. è™½ç„¶ç†è®ºä¸Šä¼šå‡ºçŽ°é‡å¤å€¼, ä½†æ˜¯æ¦‚çŽ‡æžå°, å¯ä»¥å¿½ç•¥ä¸è®¡.")]),s._v(" "),t("li",[s._v("InnoDB çš„ max_trx_id é€’å¢žå€¼æ¯æ¬¡ MySQL é‡å¯éƒ½ä¼šè¢«ä¿å­˜èµ·æ¥, æ‰€ä»¥æœ¬èŠ‚çš„è„è¯»çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªå¿…çŽ°çš„ bug, å¥½åœ¨ç•™ç»™æˆ‘ä»¬çš„æ—¶é—´è¿˜å¾ˆå……è£•.")]),s._v(" "),t("li",[s._v("thread_id æ˜¯ä½¿ç”¨ä¸­æœ€å¸¸è§çš„, è€Œä¸”ä¹Ÿæ˜¯å¤„ç†å¾—æœ€å¥½çš„ä¸€ä¸ªè‡ªå¢ž id é€»è¾‘äº†.")])]),s._v(" "),t("p",[s._v("å½“ç„¶, åœ¨ MySQL é‡Œè¿˜æœ‰åˆ«çš„è‡ªå¢ž id, æ¯”å¦‚ table_id, binlog æ–‡ä»¶åºå·ç­‰, å°±ç•™ç»™ä½ åŽ»éªŒè¯å’ŒæŽ¢ç´¢äº†.")]),s._v(" "),t("p",[s._v("ä¸åŒçš„è‡ªå¢ž id æœ‰ä¸åŒçš„ä¸Šé™å€¼, "),t("strong",[s._v("ä¸Šé™å€¼çš„å¤§å°å–å†³äºŽå£°æ˜Žçš„ç±»åž‹é•¿åº¦")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"æˆ‘çš„mysqlå¿ƒè·¯åŽ†ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æˆ‘çš„mysqlå¿ƒè·¯åŽ†ç¨‹"}},[s._v("#")]),s._v(" æˆ‘çš„MySQLå¿ƒè·¯åŽ†ç¨‹")]),s._v(" "),t("h5",{attrs:{id:"æˆ‘çš„ç»åŽ†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æˆ‘çš„ç»åŽ†"}},[s._v("#")]),s._v(" æˆ‘çš„ç»åŽ†")]),s._v(" "),t("blockquote",[t("p",[s._v("ä»¥ä¸°å¯Œçš„ç»åŽ†è¿›å…¥ç™¾åº¦")])]),s._v(" "),t("p",[s._v("æˆ‘æ˜¯ç¦å·žå¤§å­¦æ¯•ä¸šçš„, æ®æˆ‘äº†è§£, é‚£æ—¶å€™æˆ‘ä»¬å­¦æ ¡çš„åº”å±Šç”Ÿå¾ˆéš¾ç›´æŽ¥è¿›å…¥ç™¾åº¦, éƒ½è¦è€ƒåˆ°æµ™æ±Ÿå¤§å­¦è¯»ä¸ªç ”ç©¶ç”Ÿæ‰è¡Œ. æ²¡æƒ³åˆ°çš„æ˜¯, æˆ‘æŠ•é€’äº†ç®€åŽ†åŽå±…ç„¶è¿›äº†é¢è¯•.")]),s._v(" "),t("p",[s._v('å…¥èŒä»¥åŽ, æˆ‘è·‘åŽ»é—®å½“æ—¶çš„é¢è¯•å®˜, ä¸ºä»€ä¹ˆæˆ‘çš„ç®€åŽ†å¯ä»¥é€šè¿‡ç­›é€‰? ä»–ä»¬è¯´: "å› ä¸ºä½ çš„ç®€åŽ†åŽšå•Š". æˆ‘åœ¨è¯»ä¹¦çš„æ—¶å€™, ç¡®å®žåšäº†å¾ˆå¤šé¡¹ç›®, ä¹Ÿå®žä¹ è¿‡ä¸å°‘å…¬å¸, æ‰€ä»¥ç®€åŽ†é‡Œé¢çš„ç»åŽ†å°±æ˜¾å¾—å¾ˆä¸°å¯Œäº†.')]),s._v(" "),t("p",[s._v("åœ¨é¢è¯•çš„æ—¶å€™, æœ‰ä¸ªè®©æˆ‘å°è±¡å¾ˆæ·±åˆ»çš„äº‹å„¿. é¢è¯•å®˜é—®æˆ‘è¯´, ä½ æœ‰è¿™ä¹ˆå¤šå®žä¹ ç»åŽ†, æœ‰æ²¡æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çŽ©å„¿çš„äº‹? æˆ‘æƒ³äº†æƒ³ç­”é“, è·Ÿä½ è¯´ä¸ªæ•°æ®é‡å¾ˆå¤§çš„äº‹å„¿, åœ¨è·Ÿç§»åŠ¨åšæ—¥å¿—åˆ†æžçš„æ—¶å€™æˆ‘ç¢°åˆ°äº†å‡ åƒä¸‡è¡Œçš„æ•°æ®. ä»–å¬å®Œä»¥åŽå°±ç¬‘äº†. åŽæ¥è¿›äº†ç™¾åº¦æ‰çŸ¥é“, å‡ åƒä¸‡è¡Œé‚£éƒ½æ˜¯å°æ•°æ®.")]),s._v(" "),t("blockquote",[t("p",[s._v("å¼€å§‹å°è¯•çœ‹æºç è§£å†³é—®é¢˜")])]),s._v(" "),t("p",[s._v("åŠ å…¥ç™¾åº¦åŽ, æˆ‘æ˜¯åœ¨è´´å§åšåŽç«¯ç¨‹åº, æ¯”å¦‚æƒé™ç³»ç»Ÿç­‰ç­‰. å…¶å®žå¾ˆç®€å•, å°±æ˜¯å†™ä¸€ä¸ª C è¯­è¨€ç¨‹åº, å“åº”å®¢æˆ·ç«¯è¯·æ±‚, ç„¶åŽè¿”å›žç»“æžœ.")]),s._v(" "),t("p",[s._v("é‚£ä¸ªæ—¶å€™, æˆ‘è¿˜ä»…ä»…æ˜¯ä¸ª MySQL çš„æ™®é€šç”¨æˆ·, ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´åŽå°±å‡ºçŽ°é—®é¢˜äº†: ä¸€ä¸ªè·‘å¾—å¾ˆå¿«çš„è¯·æ±‚, å¶å°”ä¼šåˆè·‘å¾—éžå¸¸æ…¢. è€æ¿é—®è¿™æ˜¯ä»€ä¹ˆåŽŸå› , è€Œæˆ‘åˆä¸å¥½æ„æ€è¯´ä¸çŸ¥é“, äºŽæ˜¯å°±è‡ªå·±ä¸Šç½‘æŸ¥èµ„æ–™.")]),s._v(" "),t("p",[s._v("ä½† 2008 å¹´é‚£ä¼šå„¿, ç½‘ä¸Šèµ„æ–™å¾ˆå°‘, èŠ±äº†æŒºé•¿æ—¶é—´ä¹Ÿæ²¡æŸ¥å‡ºä¸ªæ‰€ä»¥ç„¶. æœ€ç»ˆ, æˆ‘åªå¥½åŽ»çœ‹æºç . ç¿»åˆ°æºç , æˆ‘å½“æ—¶å°±è§‰å¾—å®ƒè¿˜è›®æœ‰æ„æ€çš„. è€Œä¸”, æºç çœŸçš„å¯ä»¥å¸®æˆ‘è§£å†³ä¸€äº›é—®é¢˜.")]),s._v(" "),t("p",[s._v("äºŽæ˜¯ä¸€å‘ä¸å¯æ”¶æ‹¾, æˆ‘ä»Žé‚£æ—¶å€™å°±"),t("strong",[s._v('å…¥äº†æºç çš„"å‘"')]),s._v(" .")]),s._v(" "),t("blockquote",[t("p",[s._v("æ··ç¤¾åŒºåˆ†äº«ç»éªŒ")])]),s._v(" "),t("p",[s._v("2010 å¹´çš„æ—¶å€™, é˜¿é‡Œæ­£å¥½åœ¨æ‹›æ•°æ®åº“çš„å¼€å‘äººå‘˜. è™½ç„¶é‚£æ—¶æˆ‘è¿˜åªæ˜¯çœ‹å¾—æ‡‚æºç , æ²¡æœ‰ä»€ä¹ˆå¼€å‘ç»éªŒ, ä½†è¿˜æ˜¯æŠ±ç€è¯•è¯•çœ‹çš„æ€åº¦æŠ•äº†ç®€åŽ†. ç„¶åŽé¡ºåˆ©é€šè¿‡äº†é¢è¯•, æˆåŠŸè¿›å…¥äº†é˜¿é‡Œ. ä¹‹åŽ, æˆ‘å°±è·Ÿç€è¤šéœ¸(éœ¸çˆ·)å¹²äº† 7 å¹´å¤šæ‰ç¦»å¼€äº†é˜¿é‡Œ.")]),s._v(" "),t("p",[s._v("åœ¨ç™¾åº¦çš„æ—¶å€™, æˆ‘åŸºæœ¬ä¸Šæ²¡æœ‰å‚åŠ è¿‡ç¤¾åŒºæ´»åŠ¨. å› ä¸ºé‚£æ—¶å€™ç™¾åº¦å¯èƒ½æ›´æå€¡å†…éƒ¨åˆ†äº«, è§£å†³é—®é¢˜çš„ç»éªŒåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨å†…ç½‘åˆ†äº«. æ‰€ä»¥åŽ»äº†é˜¿é‡Œä»¥åŽ, æˆ‘æ‰å»ºäº†åšå®¢, å¼€äº†å¾®åš. æˆ‘åœ¨é˜¿é‡Œçš„èŠ±åå«ä¸å¥‡, åšå®¢, å¾®åš, ç¤¾åŒºä¹Ÿå› æ­¤éƒ½æ˜¯ç”¨çš„è¿™ä¸ªåå­—.")]),s._v(" "),t("h5",{attrs:{id:"ä¸ºä»€ä¹ˆè¦äº†è§£æ•°æ®åº“åŽŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆè¦äº†è§£æ•°æ®åº“åŽŸç†"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆè¦äº†è§£æ•°æ®åº“åŽŸç†?")]),s._v(" "),t("p",[s._v("è¿™é‡Œæˆ‘è®²å‡ ä¸ªäº²èº«ç»åŽ†çš„äº‹æƒ…, å’Œä½ èŠèŠä¸ºä»€ä¹ˆè¦äº†è§£æ•°æ®åº“åŽŸç†.")]),s._v(" "),t("blockquote",[t("p",[s._v("äº†è§£åŽŸç†èƒ½å¸®ä½ æ›´å¥½åœ°å®šä½é—®é¢˜")])]),s._v(" "),t("p",[s._v("ä¸€æ¬¡åŒå­¦èšä¼š, å¤§å®¶è°ˆèµ·äº†æŠ€æœ¯é—®é¢˜. ä¸€ä¸ªåœ¨æ”¿åºœé‡Œçš„åŒå­¦è¯´, ä»–ä»¬çš„ç³»ç»Ÿå¾ˆå¥‡æ€ª, æ¯å¤©æ—©ä¸Šéƒ½å¾—é‡å¯ä¸€ä¸‹åº”ç”¨ç¨‹åº, å¦åˆ™å°±æç¤ºè¿žæŽ¥æ•°æ®åº“å¤±è´¥, ä»–ä»¬éƒ½ä¸çŸ¥é“è¯¥æ€Žä¹ˆåŠž.")]),s._v(" "),t("p",[s._v("æˆ‘åˆ†æžè¯´, æŒ‰ç…§è¿™ä¸ªé”™è¯¯æç¤º, åº”è¯¥å°±æ˜¯è¿žæŽ¥æ—¶é—´è¿‡é•¿äº†, æ–­å¼€äº†è¿žæŽ¥. æ•°æ®åº“é»˜è®¤çš„è¶…æ—¶æ—¶é—´æ˜¯ 8 å°æ—¶, è€Œä½ ä»¬å¹³æ—¶å…­ç‚¹ä¸‹ç­, ä¸‹ç­ä¹‹åŽç³»ç»Ÿå°±æ²¡æœ‰äººç”¨äº†, ç­‰åˆ°ç¬¬äºŒå¤©æ—©ä¸Šä¹ç‚¹ç”šè‡³åç‚¹æ‰ä¸Šç­, è¿™ä¸­é—´çš„æ—¶é—´å·²ç»è¶…è¿‡ 10 ä¸ªå°æ—¶äº†, æ•°æ®åº“çš„è¿žæŽ¥è‚¯å®šå°±ä¼šæ–­å¼€äº†.")]),s._v(" "),t("p",[s._v("æˆ‘å½“æ—¶è¯´, ä¼°è®¡è¿™ä¸ªç³»ç»Ÿç¨‹åºå†™å¾—æ¯”è¾ƒå·®, è¿žæŽ¥å¤±è´¥ä¹Ÿä¸ä¼šé‡è¿ž, ä»ç„¶ç”¨åŽŸæ¥æ–­æŽ‰çš„è¿žæŽ¥, æ‰€ä»¥å°±æŠ¥é”™äº†. ç„¶åŽ, æˆ‘è®©ä»–å›žåŽ»æŠŠè¶…æ—¶æ—¶é—´æ”¹å¾—é•¿ä¸€ç‚¹. åŽæ¥ä»–è·Ÿæˆ‘è¯´, æŒ‰ç…§è¿™ä¸ªæ–¹æ³•, é—®é¢˜å·²ç»è§£å†³äº†.")]),s._v(" "),t("p",[s._v("ç”±æ­¤, æˆ‘ä¹Ÿæ›´æ·±åˆ»åœ°ä½“ä¼šåˆ°, ä½œä¸ºå¼€å‘äººå‘˜, å³ä½¿æˆ‘ä»¬åªçŸ¥é“æ¯ä¸ªå‚æ•°çš„æ„æ€, å¯èƒ½å°±å¯ä»¥ç»™å‡ºä¸€äº›é—®é¢˜çš„æ­£ç¡®åº”å¯¹æ–¹æ³•.")]),s._v(" "),t("blockquote",[t("p",[s._v("äº†è§£åŽŸç†èƒ½è®©ä½ æ›´å·§å¦™åœ°è§£å†³é—®é¢˜")])]),s._v(" "),t("p",[s._v("æˆ‘åœ¨åšè´´å§ç³»ç»Ÿçš„æ—¶å€™, æ¯æ¬¡è®¿é—®é¡µé¢éƒ½è¦è¯·æ±‚ä¸€æ¬¡æƒé™. æ‰€ä»¥, è¿™ä¸ªè¯·æ±‚æƒé™çš„è¯·æ±‚, è®¿é—®æ¦‚çŽ‡ä¼šéžå¸¸é«˜, ä¸å¯èƒ½æ¯æ¬¡éƒ½åŽ»æ•°æ®åº“é‡ŒæŸ¥, æ€Žä¹ˆåŠžå‘¢?")]),s._v(" "),t("p",[s._v("æˆ‘æƒ³äº†ä¸ªç®€å•çš„æ–¹æ¡ˆ: åœ¨åº”ç”¨ç¨‹åºé‡Œé¢å¼€äº†ä¸ªå¾ˆå¤§çš„å†…å­˜, å¯åŠ¨çš„æ—¶å€™å°±æŠŠæ•´å¼ è¡¨å…¨éƒ¨ load åˆ°å†…å­˜é‡ŒåŽ». è¿™æ ·å†æœ‰æƒé™è¯·æ±‚çš„æ—¶å€™, ç›´æŽ¥ä»Žå†…å­˜é‡Œå–å°±è¡Œäº†.")]),s._v(" "),t("p",[s._v("æ•°æ®åº“é‡å¯æ—¶, æˆ‘çš„è¿›ç¨‹ä¹Ÿä¼šè·Ÿç€é‡å¯, æŽ¥ä¸‹æ¥å°±ä¼šåˆ°æ•°æ®è¡¨é‡Œé¢åšå…¨è¡¨æ‰«æ, æŠŠæ•´ä¸ªç”¨æˆ·ç›¸å…³ä¿¡æ¯å…¨éƒ¨å¡žåˆ°å†…å­˜é‡Œé¢åŽ».")]),s._v(" "),t("p",[s._v("ä½†æ˜¯, åŽæ¥æˆ‘é‡åˆ°äº†ä¸€ä¸ªå¾ˆéƒé—·çš„æƒ…å†µ. æœ‰æ—¶å€™ MySQL å´©æºƒäº†, æˆ‘çš„ç¨‹åºé‡æ–°åŠ è½½æƒé™åˆ°å†…å­˜é‡Œ, ç»“æžœè¿™ä¸ª select è¯­å¥è¦æ‰§è¡Œ 30 åˆ†é’Ÿå·¦å³. æœ¬æ¥ MySQL æ­£å¸¸é‡å¯ä¸€ä¸‹æ˜¯å¾ˆå¿«çš„, è¿›ç¨‹é‡å¯ä¹Ÿå¾ˆå¿«, æ­£å¸¸åŠ è½½æƒé™çš„è¿‡ç¨‹åªéœ€è¦ä¸¤åˆ†é’Ÿå°±è·‘å®Œäº†. ä½†æ˜¯, ä¸ºä»€ä¹ˆå¼‚å¸¸é‡å¯çš„æ—¶å€™å°±è¦ 30 åˆ†é’Ÿå‘¢?")]),s._v(" "),t("p",[s._v("æˆ‘æ²¡è¾™äº†, åªå¥½åŽ»çœ‹æºç . ç„¶åŽ, æˆ‘å‘çŽ° MySQL æœ‰ä¸ªæœºåˆ¶, "),t("strong",[s._v("å½“å®ƒè§‰å¾—ç³»ç»Ÿç©ºé—²æ—¶ä¼šå°½é‡åŽ»åˆ·è„é¡µ")]),s._v(". å…·ä½“åˆ°æˆ‘ä»¬çš„ä¾‹å­é‡Œ, MySQL é‡å¯ä»¥åŽ, ä¼šæ‰§è¡Œæˆ‘çš„è¿›ç¨‹åšå…¨è¡¨æ‰«æ, ä½†æ˜¯å› ä¸ºè¿™ä¸ªæ—¶å€™æƒé™æ•°æ®è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆ, æˆ‘çš„ Server å±‚ä¸å¯èƒ½æä¾›æœåŠ¡, äºŽæ˜¯ MySQL é‡Œé¢å°±åªæœ‰æˆ‘é‚£ä¸€ä¸ª select å…¨è¡¨æ‰«æçš„è¯·æ±‚, MySQL å°±è®¤ä¸ºçŽ°åœ¨å¾ˆé—², å¼€å§‹æ‹¼å‘½åœ°åˆ·è„é¡µ, ç»“æžœå°±åƒæŽ‰äº†å¤§é‡çš„ç£ç›˜èµ„æº, å¯¼è‡´æˆ‘çš„å…¨è¡¨æ‰«æä¹Ÿè·‘å¾—å¾ˆæ…¢.")]),s._v(" "),t("p",[s._v("çŸ¥é“äº†è¿™ä¸ªæœºåˆ¶ä»¥åŽ, æˆ‘å°±å†™äº†ä¸ªè„šæœ¬, æ¯éš” 0.5 ç§’å‘ä¸€ä¸ªè¯·æ±‚, æ‰§è¡Œä¸€ä¸ªç®€å•çš„ SQL æŸ¥è¯¢, å‘Šè¯‰æ•°æ®åº“å…¶å®žæˆ‘çŽ°åœ¨å¾ˆå¿™, è„é¡µåˆ·å¾—æ…¢ä¸€ç‚¹. è„šæœ¬ä¸€å‘å¸ƒä½¿ç”¨, è„é¡µæžœç„¶åˆ·å¾—æ…¢äº†, åŠ è½½æƒé™çš„æ‰«æä¹Ÿè·‘å¾—å¾ˆå¿«äº†. æ®è¯´æˆ‘ç¦»èŒä¸¤å¹´å¤šä»¥åŽ, è¿™ä¸ªè„šæœ¬è¿˜åœ¨ç”¨.")]),s._v(" "),t("p",[s._v("ä½ çœ‹, å¦‚æžœæˆ‘ä»¬æ‡‚å¾—ä¸€äº›å‚æ•°, å¹¶å¯ä»¥ç†è§£è¿™äº›å‚æ•°, å°±å¯ä»¥åšæ­£ç¡®çš„è®¾ç½®äº†. è€Œå¦‚æžœæˆ‘ä»¬è¿›ä¸€æ­¥åœ°æ‡‚å¾—ä¸€äº›åŽŸç†, å°±å¯ä»¥æ›´å·§å¦™åœ°è§£å†³é—®é¢˜äº†.")]),s._v(" "),t("blockquote",[t("p",[s._v("çœ‹å¾—æ‡‚æºç è®©ä½ æœ‰æ›´å¤šçš„æ–¹æ³•")])]),s._v(" "),t("p",[s._v("2012 å¹´çš„æ—¶å€™, é˜¿é‡ŒåŒåä¸€ä¸šåŠ¡çš„åŽ‹åŠ›æ¯”è¾ƒå¤§. å½“æ—¶è¿˜æ²¡æœ‰è¿™ä¹ˆå¤šçš„ SSD, æ˜¯æœºæ¢°ç¡¬ç›˜çš„æ—¶ä»£.")]),s._v(" "),t("p",[s._v("ä¸ºäº†åº”å¯¹åŽ‹åŠ›æˆ‘ä»¬å¼€å§‹å¼•å…¥ SSD, ä½†æ˜¯ä¸æ•¢æŠŠ SSD ç›´æŽ¥å½“å­˜å‚¨ç”¨, è€Œæ˜¯ä½œä¸ºäºŒçº§ç¼“å­˜. å½“æ—¶, æˆ‘ä»¬ç”¨äº†ä¸€ä¸ªå«ä½œ Flashcache çš„å¼€æºç³»ç»Ÿ(çŽ°åœ¨å·²ç»æ˜¯è€å¤è‘£çº§åˆ«äº†, ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å¬è¿‡è¿™ä¸ªç³»ç»Ÿ).")]),s._v(" "),t("p",[s._v("Flashcache å®žçŽ°, æŠŠ SSD å½“ä½œç‰©ç†ç›˜çš„äºŒçº§ç¼“å­˜, å¯ä»¥æå‡æ€§èƒ½. ä½†æ˜¯, æˆ‘ä»¬è‡ªå·±éƒ¨ç½²åŽå‘çŽ°æ€§èƒ½æå‡çš„æ•ˆæžœæ²¡æœ‰é¢„æƒ³çš„é‚£ä¹ˆå¥½, ç”šè‡³è¿˜ä¸å¦‚çº¯æœºæ¢°ç›˜.")]),s._v(" "),t("p",[s._v("äºŽæ˜¯, æˆ‘è·Ÿéœ¸çˆ·å°±å¼€å§‹ç ”ç©¶. éœ¸çˆ·è´Ÿè´£åˆ†æž Flashcache çš„æºç , æˆ‘è´Ÿè´£åˆ†æž MySQL æºç . åŽæ¥æˆ‘ä»¬å‘çŽ° Flashcache æ˜¯æœ‰è„é¡µæ¯”ä¾‹çš„, å½“è„é¡µæ¯”ä¾‹åˆ°äº† 80% å°±ä¼šåœä¸‹æ¥å¼ºè¡Œåˆ·ç›˜. ä¸€å¼€å§‹æˆ‘ä»¬ä»¥ä¸ºè¿™ä¸ªè„é¡µæ¯”ä¾‹æ˜¯å…¨éƒ¨çš„ 20%, çœ‹äº†æºç æ‰çŸ¥é“, åŽŸæ¥å®ƒåˆ†äº†å¾ˆå¤šä¸ªæ¡¶, æ¯”å¦‚è¯´ä¸€ä¸ªæ¡¶ 20M, è¿™ä¸ªæ¡¶å¦‚æžœç”¨å®Œ 80%, å®ƒå°±è®¤ä¸ºè„é¡µæ»¡äº†, å°±å¼€å§‹åˆ·è„é¡µ. è¿™ä¹Ÿå°±æ„å‘³ç€, å¦‚æžœä½ æ˜¯é¡ºåºå†™çš„è¯, å¾ˆå®¹æ˜“å°±ä¼šæŠŠä¸€ä¸ªæ¡¶å†™æ»¡.")]),s._v(" "),t("p",[s._v("çŸ¥é“äº†è¿™ä¸ªåŽŸç†ä»¥åŽ, æˆ‘å°±æŠŠæ—¥å¿—ä¹‹ç±»é¡ºåºå†™çš„æ•°æ®å…¨éƒ½æ”¾åˆ°äº†æœºæ¢°ç¡¬ç›˜, æŠŠéšæœºå†™çš„æ•°æ®æ”¾åˆ°äº† Flashcache ä¸Š. è¿™æ ·ä¿®æ”¹ä»¥åŽ, æ•ˆæžœå°±å¥½äº†.")]),s._v(" "),t("p",[s._v("ä½ çœ‹, å¦‚æžœèƒ½çœ‹å¾—æ‡‚æºç , ä½ çš„æ“ä½œè¡Œä¸ºå°±ä¼šä¸ä¸€æ ·.")]),s._v(" "),t("h5",{attrs:{id:"mysqlå­¦ä¹ è·¯å¾„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqlå­¦ä¹ è·¯å¾„"}},[s._v("#")]),s._v(" MySQLå­¦ä¹ è·¯å¾„")]),s._v(" "),t("p",[s._v("è¯´åˆ° MySQL çš„å­¦ä¹ è·¯å¾„, å…¶å®žæˆ‘ä¸Šé¢åˆ†äº«çš„è¿™äº›å†…å®¹, éƒ½å¯ä»¥å½’ç»“ä¸ºå­¦ä¹ è·¯å¾„.")]),s._v(" "),t("p",[t("strong",[s._v("é¦–å…ˆä½ è¦ä¼šç”¨, è¦åŽ»äº†è§£æ¯ä¸ªå‚æ•°çš„æ„ä¹‰, è¿™æ ·ä½ çš„è¿ç»´è¡Œä¸º(ä½¿ç”¨è¡Œä¸º)å°±ä¼šä¸ä¸€æ ·")]),s._v(". åƒä¸‡ä¸è¦ä»Žç½‘ä¸Šæ‹¿äº†ä¸€äº›ä½¿ç”¨å»ºè®®, åˆ«äººæ€Žä¹ˆç”¨, ä½ å°±æ€Žä¹ˆç”¨, è€Œä¸åŽ»æƒ³ä¸ºä»€ä¹ˆ. å†å¾€åŽ, å°±è¦åŽ»äº†è§£æ¯ä¸ªå‚æ•°çš„å®žçŽ°åŽŸç†. ä¸€æ—¦ä½ äº†è§£äº†è¿™äº›åŽŸç†, ä½ çš„æ“ä½œè¡Œä¸ºå°±ä¼šä¸ä¸€æ ·.  å†è¿›ä¸€æ­¥, å¦‚æžœçœ‹å¾—æ‡‚æºç , é‚£ä¹ˆä½ å¯¹æ•°æ®åº“çš„ç†è§£ä¹Ÿä¼šä¸ä¸€æ ·.")]),s._v(" "),t("p",[s._v("å†æ¥è®²è®²æˆ‘æ˜¯æ€Žä¹ˆå¸¦åº”å±Šç”Ÿçš„. "),t("strong",[s._v("å®žè·µæ˜¯å¾ˆå¥½çš„å­¦ä¹ æ–¹å¼,")]),s._v("  æ‰€ä»¥æˆ‘ä¼šè®©æ–°äººæ¥äº†ä»¥åŽå…ˆæ­ä¸»å¤‡, ç„¶åŽä½ å°±ä¼šå‘çŽ°æ¯ä¸ªäººçš„è‡ªå­¦èƒ½åŠ›éƒ½ä¸ä¸€æ ·. æ¯”å¦‚é‡åˆ°æœ‰å»¶è¿Ÿ, æˆ–è€…æˆ‘ä»¬æ•…æ„æž„é€ ä¸€ä¸ªä¸»å¤‡æ•°æ®ä¸ä¸€è‡´çš„åœºæ™¯, è®©æ–°äººäº†è§£æ€Žä¹ˆåˆ†æžé—®é¢˜, è§£å†³é—®é¢˜.")]),s._v(" "),t("p",[s._v("å¦‚æžœä¸€å®šè¦æ€»ç»“å‡ºä¸€æ¡å­¦ä¹ è·¯å¾„çš„è¯, é‚£é¦–å…ˆè¦ä¼š"),t("strong",[s._v("ç”¨")]),s._v(", ç„¶åŽå¯ä»¥"),t("strong",[s._v("å‘çŽ°é—®é¢˜")]),s._v(". æˆ‘çš„å»ºè®®æ˜¯, "),t("strong",[s._v("ä½ å¯ä»¥å°è¯•å…ˆä¸çœ‹ç­”æ¡ˆè‡ªå·±åŽ»æ€è€ƒ")]),s._v(", æˆ–è€…åŽ»æ•°æ®åº“é‡Œé¢ç¿»ä¸€ç¿», è¿™å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„è¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("å†ä¸‹ä¸€æ­¥å°±æ˜¯"),t("strong",[s._v("å®žè·µ")]),s._v('. ä¹‹åŽå½“ä½ è§‰å¾—å¼€å§‹æœ‰ä¸€äº›"çº¿"çš„æ¦‚å¿µäº†, å†åŽ»'),t("strong",[s._v("çœ‹ MySQL çš„å®˜æ–¹æ‰‹å†Œ")]),s._v(". åœ¨æˆ‘çš„ä¸“æ é‡Œ, æœ‰äººæ›¾é—®æˆ‘è¦ä¸è¦ç›´æŽ¥åŽ»çœ‹æ‰‹å†Œ? æˆ‘çš„å»ºè®®æ˜¯, ä¸€å¼€å§‹åƒä¸‡ä¸è¦ç€æ€¥çœ‹æ‰‹å†Œ, è¿™é‡Œé¢æœ‰ 100 å¤šä¸‡ä¸ªè‹±æ–‡å•è¯, ä½ å°±ç®—å†åŽ‰å®³, ä¹Ÿæ˜¯çœ‹äº†åŽé¢å¿˜äº†å‰é¢. "),t("strong",[s._v("æ‰€ä»¥ä½ ä¸€å®šè¦è‡ªå·±å…ˆæœ‰è„‰ç»œ, ç„¶åŽæœ‰ä¸€ä¸ªçŸ¥è¯†ç½‘ç»œ, å†çœ‹æ‰‹å†ŒåŽ»æŸ¥æ¼è¡¥ç¼º")]),s._v(".")]),s._v(" "),t("p",[s._v("æˆ‘è‡ªå·±å°±æ˜¯è¿™ä¹ˆä¸€è·¯èµ°è¿‡æ¥çš„.")]),s._v(" "),t("p",[s._v("å¾ˆå¤šç”¨æˆ·éƒ½å¸Œæœ›æˆ‘èƒ½æŽ¨èä¸€æœ¬ä¹¦æ­é…ä¸“æ å­¦ä¹ . å¦‚æžœåªæŽ¨èä¸€æœ¬çš„è¯, æˆ‘å»ºè®®ä½ è¯»ä¸€ä¸‹ "),t("strong",[s._v("ã€Šé«˜æ€§èƒ½ MySQLã€‹")]),s._v(" è¿™æœ¬ä¹¦, å®ƒæ˜¯ MySQL è¿™ä¸ªé¢†åŸŸçš„ç»å…¸å›¾ä¹¦, å·²ç»å‡ºåˆ°ç¬¬ä¸‰ç‰ˆäº†, ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹å®ƒçš„æµè¡Œåº¦.")]),s._v(" "),t("h5",{attrs:{id:"dbaçš„ä¿®ç‚¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dbaçš„ä¿®ç‚¼"}},[s._v("#")]),s._v(" DBAçš„ä¿®ç‚¼")]),s._v(" "),t("blockquote",[t("p",[s._v("DBAå’Œå¼€å‘å·¥ç¨‹å¸ˆæœ‰ä»€ä¹ˆç›¸åŒç‚¹?")])]),s._v(" "),t("p",[s._v("æˆ‘å¸¦è¿‡å¼€å‘å›¢é˜Ÿ, ä¹Ÿå¸¦è¿‡ DBA å›¢é˜Ÿ, æ‰€ä»¥å¯ä»¥åˆ†äº«ä¸€ä¸‹è¿™ä¸¤ä¸ªå²—ä½çš„äº¤é›†.")]),s._v(" "),t("p",[s._v("å…¶å®ž, DBA æœ¬èº«è¦æœ‰äº›å¼€å‘åº•å­, æ¯”å¦‚è¯´åšè¿ç»´ç³»ç»Ÿçš„å¼€å‘. å¦å¤–, è‡ªåŠ¨åŒ–ç¨‹åº¦è¶Šé«˜, DBA çš„æ—¥å¸¸è¿ç»´å·¥ä½œé‡å°±è¶Šå°‘, DBA å¾—åŽ»äº†è§£å¼€å‘ä¸šåŠ¡é€»è¾‘, å¾€ä¸šåŠ¡æž¶æž„å¸ˆè¿™ä¸ªæ–¹å‘åŽ»åš.")]),s._v(" "),t("p",[s._v("å¼€å‘å·¥ç¨‹å¸ˆä¹Ÿæ˜¯ä¸€æ ·, ä¸èƒ½æ‰€æœ‰çš„é—®é¢˜éƒ½æŒ‡æœ› DBA æ¥è§£å†³. å› ä¸º, DBA åœ¨æ¯ä¸ªå…¬å¸éƒ½æ˜¯å¾ˆå°‘çš„å‡ ä¸ªäºº. æ‰€ä»¥, å¼€å‘ä¹Ÿéœ€è¦å¯¹æ•°æ®åº“åŽŸç†æœ‰ä¸€å®šçš„äº†è§£, è¿™æ ·å‘ DBA è¯·æ•™é—®é¢˜æ—¶æ‰èƒ½æ›´ä¸“ä¸š, æ›´é«˜æ•ˆåœ°è§£å†³é—®é¢˜.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¯´, è¿™ä¸¤ä¸ªå²—ä½åº”è¯¥æœ‰ä¸€å®šç¨‹åº¦çš„èžåˆ, å³: å¼€å‘è¦äº†è§£æ•°æ®åº“åŽŸç†, DBA è¦äº†è§£ä¸šåŠ¡å’Œå¼€å‘.")]),s._v(" "),t("blockquote",[t("p",[s._v("DBAæœ‰å‰é€”å—?")])]),s._v(" "),t("p",[s._v("è¿™é‡Œæˆ‘è¦å¼ºè°ƒçš„æ˜¯, æ¯ä¸ªå²—ä½éƒ½æœ‰å‰é€”, åªéœ€è¦æ ¹æ®æ—¶ä»£å˜è¿ç¨å¾®è°ƒæ•´ä¸€ä¸‹æ–¹å‘.")]),s._v(" "),t("p",[s._v("åƒåŽŸæ¥å¼€çŽ©ç¬‘è¯´ DBA è¦ä½“åŠ›å¥½, å› ä¸ºå¾—æ¬æœåŠ¡å™¨. åŽæ¥ DBA çš„æ ¸å¿ƒæŠ€èƒ½æˆäº†ä¼šæ­åº“, ä¼šä¸»å¤‡åˆ‡æ¢, ä½†æ˜¯çŽ°åœ¨è¿™äº›ä¹Ÿä¸å¤Ÿç”¨äº†, å› ä¸ºå·²ç»æœ‰äº†è‡ªåŠ¨åŒ–ç³»ç»Ÿ.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, DBA æŽ¥ä¸‹æ¥ä¸€æ–¹é¢æ˜¯è¦äº†è§£ä¸šåŠ¡, åšä¸šåŠ¡çš„æž¶æž„å¸ˆ; å¦ä¸€æ–¹é¢, æ˜¯è¦æœ‰å‰çž»æ€§, åšä¸»åŠ¨è¯Šæ–­ç³»ç»Ÿ, æŠŠæ¯ä¸ªä¸šåŠ¡çš„é—®é¢˜æŒ‘å‡ºæ¥åšæˆæœˆæŠ¥, è®©ä¸šåŠ¡å¼€å‘åŽ»ä¼˜åŒ–, æœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹, å¼€å‘åŒå­¦ä¼šæ¥æ‰¾ä½ å’¨è¯¢. ä½ å¸®åŠ©ä»–ä»¬åšå¥½äº†ä¼˜åŒ–ä¹‹åŽ, å¯ä»¥æŠŠä¼˜åŒ–çš„æŒ‡æ ‡å‘ˆçŽ°å‡ºæ¥. è¿™å°†å¾ˆå¥½åœ°ä½“çŽ°å‡ºä½ å¯¹äºŽå…¬å¸çš„ä»·å€¼.")]),s._v(" "),t("blockquote",[t("p",[s._v("æœ‰å“ªäº›æ¯”è¾ƒå¥½çš„ä¹ æƒ¯å’Œæé«˜SQLæ•ˆçŽ‡çš„æ–¹æ³•?")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ–¹æ³•, æ€»ç»“èµ·æ¥å°±æ˜¯: è¦å¤šå†™ SQL, åŸ¹å…»è‡ªå·±å¯¹ SQL è¯­å¥æ‰§è¡Œæ•ˆçŽ‡çš„æ„Ÿè§‰. ä»¥åŽå†å†™æˆ–è€…å»ºç´¢å¼•çš„æ—¶å€™, çŸ¥é“è¿™ä¸ªè¯­å¥æ‰§è¡Œä¸‹åŽ»å¤§æ¦‚çš„æ—¶é—´å¤æ‚åº¦, æ˜¯å…¨è¡¨æ‰«æè¿˜æ˜¯ç´¢å¼•æ‰«æ, æ˜¯ä¸æ˜¯éœ€è¦å›žè¡¨, åœ¨å¿ƒé‡Œéƒ½æœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ¦‚å¿µ.")]),s._v(" "),t("p",[s._v("è¿™æ ·æ¯æ¬¡å†™å‡ºæ¥çš„ SQL éƒ½ä¼šå¿«ä¸€ç‚¹, è€Œä¸”ä¸å®¹æ˜“çŠ¯ä½Žçº§é”™è¯¯. è¿™ä¹Ÿæ­£å¼æˆ‘å¼€è®¾è¿™ä¸ªä¸“æ çš„ç›®æ ‡.")]),s._v(" "),t("blockquote",[t("p",[s._v("çœ‹æºç éœ€è¦ä»€ä¹ˆæŠ€æœ¯?")])]),s._v(" "),t("p",[s._v("çœ‹æºç çš„è¯, ä¸€æ˜¯è¦æŽŒæ¡ C å’Œ C++; å¦å¤–è¿˜è¦ç†Ÿæ‚‰ä¸€äº›è°ƒè¯•å·¥å…·. å› ä¸ºä»£ç æ˜¯é™æ€çš„, è¿è¡Œèµ·æ¥æ˜¯åŠ¨æ€çš„, çœ‹ä»£ç æ˜¯å•çº¿ç¨‹çš„, è¿è¡Œèµ·æ¥æ˜¯å¤šçº¿ç¨‹çš„, æ‰€ä»¥è¦ä¼šè°ƒè¯•.")]),s._v(" "),t("p",[s._v("å¦å¤–, æˆ‘ä¸å»ºè®®ä½ ç”¨å¯è§†åŒ–çš„å·¥å…·. è™½ç„¶å¯è§†åŒ–å·¥å…·å¾ˆæ–¹ä¾¿, ä½†ä½ ä¸çŸ¥é“è¿™ä¸ªæ“ä½œç‚¹ä¸‹åŽ»ä»¥åŽ, å®žé™…ä¸Šåšäº†ä»€ä¹ˆ, æ‰€ä»¥æˆ‘å»ºè®®ä½ è‡ªå·±æ‰‹å†™ä»£ç å’Œ SQL è¯­å¥, è¿™æ ·å¯¹ä¸€äº›åº•å±‚åŽŸç†ä½ ä¼šæ›´æ˜Žç™½.")]),s._v(" "),t("blockquote",[t("p",[s._v("æ€Žä¹ˆå­¦ä¹  C, C++?")])]),s._v(" "),t("p",[s._v("æˆ‘åœ¨è¯»ç ”ç©¶ç”Ÿçš„æ—¶å€™, åœ¨ C å’Œ C++ è¯­è¨€çš„å­¦ä¹ ä¸Šè¿›æ­¥æœ€å¤§.")]),s._v(" "),t("p",[s._v("é‚£æ—¶, æˆ‘åŽ»ç»™ä¸“ç§‘ä¸Š C å’Œ C++ çš„è¯¾. æˆ‘è§‰å¾—è‡ªå·±å·²ç»ä¼šäº†, å®Œå…¨å¯ä»¥æ•™å¾—äº†. ä½†åŽ»äº†ä¹‹åŽ, æˆ‘æ‰çŸ¥é“, è‡ªå·±ä¼šè·Ÿèƒ½å¤Ÿæ•™åˆ«äººå®Œå…¨æ˜¯ä¸¤ç äº‹å„¿. å¤‡è¯¾çš„æ—¶å€™, ä½ ä¸èƒ½åªè®²ä¼šç”¨çš„éƒ¨åˆ†, è¿˜å¾—æŠŠåŽŸç†è®²æ¸…æ¥š. è¿™æ ·, å°±ä¼šå€’é€¼è‡ªå·±è¿›è¡Œæ›´æ·±å…¥æ›´å…¨é¢çš„å­¦ä¹ .")]),s._v(" "),t("p",[s._v("æœ‰çš„äººçœ‹å®ŒæŠ€æœ¯åšå®¢å’Œä¸“æ , ä¼šæŠŠè¿™ç¯‡æ–‡ç« çš„æçº²åˆ—ä¸€ä¸‹, å†™å†™è‡ªå·±çš„é—®é¢˜å’Œå¯¹è¿™ç¯‡æ–‡ç« çš„ç†è§£. è¿™ä¸ªè¿‡ç¨‹, æ˜¯éžå¸¸åˆ©äºŽå­¦ä¹ çš„. å› ä¸ºä½ å¬è¿›æ¥æ˜¯ä¸€å›žäº‹å„¿, è®²å‡ºåŽ»åˆ™æ˜¯å¦ä¸€å›žäº‹å„¿.")]),s._v(" "),t("blockquote",[t("p",[s._v("å­¦æ•°æ®åº“è¦ä¿æŒä»€ä¹ˆå¿ƒæ€?")])]),s._v(" "),t("p",[s._v("ä¸åªæ˜¯æ•°æ®åº“, æ‰€æœ‰å¤šçº¿ç¨‹çš„æœåŠ¡, è°ƒè¯•å’Œè¿½æŸ¥é—®é¢˜çš„è¿‡ç¨‹éƒ½æ˜¯å¾ˆæž¯ç‡¥çš„, é‡åˆ°é—®é¢˜éƒ½ä¼šå¾ˆéº»çƒ¦. ä½†æ˜¯, ä½ æ‰¾å‡ºé—®é¢˜æ—¶çš„é‚£ä¸€ä¸‹ä¼šå¾ˆçˆ½.")]),s._v(" "),t("p",[s._v("æˆ‘è§‰å¾—ä½ å¾—æ‰¾åˆ°è¿™ç§æ„Ÿè§‰, å®ƒå¯ä»¥æ”¯æŒä½ åº¦è¿‡æŽ¥ä¸‹æ¥è¦æž¯ç‡¥å¾ˆä¹…çš„é‚£æ®µæ—¶å…‰, è¿™æ ·ä½ æ‰èƒ½ç»§ç»­åšæŒä¸‹åŽ».")]),s._v(" "),t("h4",{attrs:{id:"ç»“æŸè¯­-ç‚¹çº¿ç½‘é¢-ä¸€èµ·æž„å»ºmysqlçŸ¥è¯†ç½‘ç»œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“æŸè¯­-ç‚¹çº¿ç½‘é¢-ä¸€èµ·æž„å»ºmysqlçŸ¥è¯†ç½‘ç»œ"}},[s._v("#")]),s._v(" ç»“æŸè¯­-ç‚¹çº¿ç½‘é¢,ä¸€èµ·æž„å»ºMySQLçŸ¥è¯†ç½‘ç»œ")]),s._v(" "),t("p",[s._v("åœ¨æˆ‘çš„ç†è§£é‡Œ, ä»‹ç»æ•°æ®åº“çš„æ–‡ç« éœ€è¦æœ‰æ“ä½œæ€§, æ¯ä¸€ä¸ªæ“ä½œæœ‰ç›¸åº”çš„åŽŸç†, æ¯ä¸€ä¸ªåŽŸç†èƒŒåŽåˆæœ‰å®ƒçš„åŽŸç†, è¿™æ˜¯ä¸€ä¸ªé“¾æ¡. èƒ½å¤Ÿè®²æ¸…æ¥šé“¾æ¡ä¸­çš„ä¸€ä¸ªçŽ¯èŠ‚, å°±å¯èƒ½æ˜¯ä¸€ç¯‡å¥½æ–‡ç« . ä½†æ˜¯, æ¯ä¸€å±‚éƒ½æœ‰ä¸åŒçš„å—ä¼—. æ‰€ä»¥, æˆ‘ç»™è¿™ 45 ç¯‡æ–‡ç« å®šçš„ç›®æ ‡å°±æ˜¯: è®²æ¸…æ¥šæ“ä½œå’Œç¬¬ä¸€å±‚çš„åŽŸç†, å¹¶é€‚å½“è§¦åŠç¬¬äºŒå±‚åŽŸç†. å¸Œæœ›è¿™æ ·çš„è®¾è®¡ä¸ä¼šè®©ä½ è§‰å¾—å¤ªæµ….")]),s._v(" "),t("p",[s._v("æœ‰åŒå­¦åœ¨é—® MySQL çš„å­¦ä¹ è·¯å¾„, æˆ‘åœ¨è¿™é‡Œå°±å’Œä½ è°ˆè°ˆæˆ‘çš„ç†è§£.")]),s._v(" "),t("h5",{attrs:{id:"_1-è·¯å¾„åƒä¸‡æ¡-å®žè·µç¬¬ä¸€æ¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-è·¯å¾„åƒä¸‡æ¡-å®žè·µç¬¬ä¸€æ¡"}},[s._v("#")]),s._v(" 1.è·¯å¾„åƒä¸‡æ¡,å®žè·µç¬¬ä¸€æ¡")]),s._v(" "),t("p",[s._v('å¦‚æžœä½ é—®ä¸€ä¸ª DBA"ç†è§£å¾—æœ€æ·±åˆ»çš„çŸ¥è¯†ç‚¹", ä»–å¾ˆå¯èƒ½å‘Šè¯‰ä½ æ˜¯ä»–è¸©å¾—æœ€æ·±çš„é‚£ä¸ªå‘. ç”±æ­¤, "å®žè·µ"çš„é‡è¦æ€§å¯è§ä¸€æ–‘.')]),s._v(" "),t("p",[s._v("ä»¥å‰æˆ‘å¸¦æ–°äººçš„æ—¶å€™, ç¬¬ä¸€æ­¥å°±æ˜¯è¦æ±‚ä»–ä»¬æ‰‹åŠ¨æ­å»ºä¸€å¥—ä¸»å¤‡å¤åˆ¶ç»“æž„. å¹¶ä¸”, å¹³æ—¶ç¢°åˆ°é—®é¢˜çš„æ—¶å€™, æˆ‘è¦æ±‚è¦åŠ¨æ‰‹å¤çŽ°.")]),s._v(" "),t("p",[s._v("ä»Žä¸“æ è¯„è®ºåŒºçš„ç•™è¨€å¯ä»¥çœ‹å‡ºæ¥, æœ‰ä¸å°‘åŒå­¦åœ¨è·Ÿç€ä¸“æ ä¸­çš„æ¡ˆä¾‹åšå®žéªŒ, æˆ‘è§‰å¾—è¿™æ˜¯ä¸ªéžå¸¸å¥½çš„ä¹ æƒ¯, å¸Œæœ›ä½ èƒ½ç»§ç»­åšæŒä¸‹åŽ». åœ¨é˜…è¯»å…¶ä»–æŠ€æœ¯æ–‡ç« , å›¾ä¹¦çš„æ—¶å€™, ä¹Ÿæ˜¯åŒæ ·çš„é“ç†. å¦‚æžœä½ è§‰å¾—è‡ªå·±ç†è§£äº†ä¸€ä¸ªçŸ¥è¯†ç‚¹, ä¹Ÿä¸€å®šè¦å°è¯•è®¾è®¡ä¸€ä¸ªä¾‹å­æ¥éªŒè¯å®ƒ.")]),s._v(" "),t("p",[s._v("åŒæ—¶, åœ¨è®¾è®¡æ¡ˆä¾‹çš„æ—¶å€™, æˆ‘å»ºè®®ä½ ä¹Ÿè®¾è®¡ä¸€ä¸ªå¯¹ç…§çš„åä¾‹, ä»Žè€Œè¾¾åˆ°çŸ¥è¯†èžæ±‡è´¯é€šçš„ç›®çš„. å°±åƒæˆ‘åœ¨å†™è¿™ä¸ªä¸“æ çš„è¿‡ç¨‹ä¸­, å°±æ„Ÿè§‰è‡ªå·±ä¹Ÿæ¶¨äº†ä¸å°‘çŸ¥è¯†, ä¸»è¦å°±å¾—ç›ŠäºŽç»™æ–‡ç« è®¾è®¡æ¡ˆä¾‹çš„è¿‡ç¨‹.")]),s._v(" "),t("h5",{attrs:{id:"_2-åŽŸç†è¯´ä¸æ¸…-åŒæ‰‹ç™½è´¹åŠ²"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-åŽŸç†è¯´ä¸æ¸…-åŒæ‰‹ç™½è´¹åŠ²"}},[s._v("#")]),s._v(" 2.åŽŸç†è¯´ä¸æ¸…,åŒæ‰‹ç™½è´¹åŠ²")]),s._v(" "),t("p",[t("strong",[s._v("ä¸è®ºæ˜¯å…ˆå®žè·µå†æžæ¸…æ¥šåŽŸç†åŽ»è§£é‡Š, è¿˜æ˜¯å…ˆæ˜Žç™½åŽŸç†å†é€šè¿‡å®žè·µåŽ»éªŒè¯")]),s._v(", éƒ½ä¸å¤±ä¸ºä¸€ç§å¥½çš„å­¦ä¹ æ–¹æ³•, å› äººè€Œå¼‚. ä½†æ˜¯, æ€Žä¹ˆè¯æ˜Žè‡ªå·±æ˜¯ä¸æ˜¯çœŸçš„æŠŠåŽŸç†å¼„æ¸…æ¥šäº†å‘¢? ç­”æ¡ˆæ˜¯è¯´å‡ºæ¥, å†™å‡ºæ¥.")]),s._v(" "),t("p",[s._v("å¦‚æžœæœ‰äººè¯·æ•™ä½ æŸä¸ªçŸ¥è¯†ç‚¹, é‚£çœŸæ˜¯å¤ªå¥½äº†, ä¸€å®šè¦è·Ÿä»–è®²æ˜Žç™½. ä¸è¦è§‰å¾—è¿™æ˜¯åœ¨æµªè´¹æ—¶é—´. å› ä¸ºè¿™æ ·åš, ä¸€æ¥å¯ä»¥å¸®ä½ éªŒè¯è‡ªå·±ç¡®å®žæžæ‡‚äº†è¿™ä¸ªçŸ¥è¯†ç‚¹; äºŒæ¥å¯ä»¥æå‡è‡ªå·±çš„æŠ€æœ¯è¡¨è¾¾èƒ½åŠ›, æ¯•ç«Ÿä½ ç»ˆç©¶è¦é¢ä¸´å’Œè¿™æ ·çš„ä¸‰ç±»äººè®²æ¸…æ¥šåŽŸç†çš„æƒ…å†µ, å³: è€æ¿, æ™‹å‡ç­”è¾©çš„è¯„å§”, æ–°å·¥ä½œçš„é¢è¯•å®˜.")]),s._v(" "),t("p",[s._v("æˆ‘åœ¨å¸¦æ–°äººçš„æ—¶å€™, å¦‚æžœè¿™ä¸€å±Šçš„æ–°äººä¸æ­¢ä¸€ä¸ª, å°±ä¼šè®©ä»–ä»¬ç»„æˆå­¦ä¹ å°ç»„, å¹¶å®šæœŸç»™ä»–ä»¬å‡ºä¸€ä¸ªå·²ç»æœ‰ç¡®å®šç­”æ¡ˆçš„é—®é¢˜. å¤§å®¶åˆ†å¤´åŽ»ç ”ç©¶, ä¹‹åŽåœ¨å°ç»„å†…è¿›è¡Œè®¨è®º. å¦‚æžœä½ èƒ½ç¢°åˆ°æ„¿æ„è·Ÿä½ ç»“æˆå­¦ä¹ å°ç»„çš„åŒå­¦, ä¸€å®šè¦å¥½å¥½çæƒœ.")]),s._v(" "),t("p",[s._v('è€Œ"å†™å‡ºæ¥"åˆæ˜¯ä¸€ä¸ªæ›´é«˜çš„å¢ƒç•Œ. å› ä¸º, ä½ åœ¨å†™çš„è¿‡ç¨‹ä¸­, å°±ä¼šå‘çŽ°è¿™ä¸ª"æ˜Žç™½"å¾ˆå¯èƒ½åªæ˜¯ä¸€ä¸ªå‡è±¡. æ‰€ä»¥, åœ¨ä¸“æ ä¸‹é¢å†™ä¸‹è‡ªå·±å¯¹æœ¬ç« çŸ¥è¯†ç‚¹çš„ç†è§£, ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„å¤¯å®žå­¦ä¹ æˆæžœçš„æ–¹æ³•.')]),s._v(" "),t("h5",{attrs:{id:"_3-çŸ¥è¯†æ²¡ä½“ç³»-è½¬èº«å°±å¿˜è®°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-çŸ¥è¯†æ²¡ä½“ç³»-è½¬èº«å°±å¿˜è®°"}},[s._v("#")]),s._v(" 3.çŸ¥è¯†æ²¡ä½“ç³»,è½¬èº«å°±å¿˜è®°")]),s._v(" "),t("p",[s._v('æŠŠçŸ¥è¯†ç‚¹"å†™ä¸‹æ¥", è¿˜æœ‰ä¸€ä¸ªå¥½å¤„, å°±æ˜¯ä½ ä¼šå‘çŽ°è¿™ä¸ªçŸ¥è¯†ç‚¹çš„å…³è”çŸ¥è¯†ç‚¹. '),t("strong",[s._v("æ·±ç©¶ä¸‹åŽ», ç‚¹å°±è¿žæˆçº¿, ç„¶åŽå†è·Ÿåˆ«çš„çº¿æ‰¾äº¤å‰")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚, æˆ‘ä»¬ä¸“æ é‡Œé¢è®²åˆ°å¯¹ä¸´æ—¶è¡¨çš„æ“ä½œä¸è®°å½•æ—¥å¿—, ç„¶åŽä½ å°±å¯ä»¥ç»™è‡ªå·±ä¸€ä¸ªé—®é¢˜, è¿™ä¼šä¸ä¼šå¯¼è‡´å¤‡åº“åŒæ­¥å‡ºé”™? å†æ¯”å¦‚, äº†è§£äº†ä¸´æ—¶è¡¨åœ¨ä¸åŒçš„ binlog æ ¼å¼ä¸‹çš„è¡Œä¸º, å†è¿½é—®ä¸€å¥, å¦‚æžœåˆ›å»ºè¡¨çš„æ—¶å€™æ˜¯ statement æ ¼å¼, ä¹‹åŽå†ä¿®æ”¹ä¸º row æ ¼å¼(æˆ–è€…åä¹‹), ä¼šæ€Žä¹ˆæ ·å‘¢?")]),s._v(" "),t("p",[s._v("æŠŠè¿™äº›éƒ½æžæ˜Žç™½ä»¥åŽ, ä½ å°±èƒ½å¤ŸæŠŠä¸´æ—¶è¡¨, æ—¥å¿—æ ¼å¼, åŒæ­¥æœºåˆ¶, ç”šè‡³äºŽäº‹åŠ¡æœºåˆ¶éƒ½è¿žèµ·æ¥äº†.")]),s._v(" "),t("p",[s._v("ç›¸ä¿¡ä½ å’Œæˆ‘ä¸€æ ·, åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æœ€å–œæ¬¢çš„å°±æ˜¯è¿™ç§äº¤å‰çš„çž¬é—´. äº¤å‰å¤šäº†, å°±å½¢æˆäº†ç½‘ç»œ. è€Œæœ‰äº†ç½‘ç»œä»¥åŽ, å¸æ”¶æ–°çŸ¥è¯†çš„é€Ÿåº¦å°±å¾ˆå¿«äº†.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚, å¦‚æžœä½ å¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«å¼„å¾—å¾ˆæ¸…æ¥šäº†, åœ¨çœ‹åˆ°ç¬¬ 45 ç¯‡æ–‡ç« è®²çš„ max_trx_id è¶…é™ä¼šå¯¼è‡´æŒç»­è„è¯»çš„æ—¶å€™, ç›¸ä¿¡ä½ ç†è§£èµ·æ¥å°±å¾ˆå®¹æ˜“äº†.")]),s._v(" "),t("h5",{attrs:{id:"_4-æ‰‹å†Œè¡¥å…¨é¢-æ¡ˆä¾‹æ‰«ç›²ç‚¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ‰‹å†Œè¡¥å…¨é¢-æ¡ˆä¾‹æ‰«ç›²ç‚¹"}},[s._v("#")]),s._v(" 4.æ‰‹å†Œè¡¥å…¨é¢,æ¡ˆä¾‹æ‰«ç›²ç‚¹")]),s._v(" "),t("p",[s._v("æœ‰åŒå­¦è¿˜é—®æˆ‘, è¦ä¸è¦ä¸€å¼€å§‹å°±çœ‹æ‰‹å†Œ? æˆ‘çš„å»ºè®®æ˜¯ä¸è¦. çœ‹æ‰‹å†Œçš„æ—¶æœº, åº”è¯¥æ˜¯ä½ çš„çŸ¥è¯†ç½‘ç»œæž„å»ºå¾—å·®ä¸å¤šçš„æ—¶å€™.")]),s._v(" "),t("p",[s._v("é‚£ä½ å¯èƒ½ä¼šé—®, ä»€ä¹ˆæ—¶å€™ç®—æ˜¯å·®ä¸å¤šå‘¢? å…¶å®ž, è¿™æ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„æ ‡å‡†. ä½†æ˜¯, æœ‰ä¸€äº›åŸºæœ¬å®žè·µå¯ä»¥å¸®ä½ åŽ»åšä¸€ä¸ªæ£€éªŒ.")]),s._v(" "),t("ul",[t("li",[s._v("èƒ½å¦è§£é‡Šæ¸…æ¥šé”™è¯¯æ—¥å¿—(error log), æ…¢æŸ¥è¯¢æ—¥å¿—(slow log)ä¸­æ¯ä¸€è¡Œçš„æ„æ€?")]),s._v(" "),t("li",[s._v("èƒ½å¦å¿«é€Ÿè¯„ä¼°å‡ºä¸€ä¸ªè¡¨ç»“æž„æˆ–è€…ä¸€æ¡ SQL è¯­å¥, è®¾è®¡å¾—æ˜¯å¦åˆç†?")]),s._v(" "),t("li",[s._v('èƒ½å¦é€šè¿‡ explain çš„ç»“æžœ, æ¥"è„‘è¡¥"æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹(æˆ‘ä»¬å·²ç»åœ¨ä¸“æ ä¸­ç»ƒä¹ å‡ æ¬¡äº†)?')]),s._v(" "),t("li",[s._v("åˆ°ç½‘ç»œä¸Šæ‰¾ MySQL çš„å®žè·µå»ºè®®, å¯¹äºŽæ¯ä¸€æ¡åšä¸€æ¬¡åˆ†æž:\n"),t("ul",[t("li",[s._v("å¦‚æžœè§‰å¾—ä¸åˆç†, èƒ½å¦ç»™å‡ºè‡ªå·±çš„æ„è§?")]),s._v(" "),t("li",[s._v("å¦‚æžœè§‰å¾—åˆç†, èƒ½å¦ç»™å‡ºè‡ªå·±çš„è§£é‡Š?")])])])]),s._v(" "),t("p",[s._v("é‚£æ€Žä¹ˆåˆ¤æ–­è‡ªå·±çš„æ„è§æˆ–è€…è§£é‡Šå¯¹ä¸å¯¹å‘¢? æœ€å¿«é€Ÿ, æœ‰æ•ˆçš„é€”å¾„, å°±æ˜¯æ‰¾æœ‰ç»éªŒçš„äººè®¨è®º. æ¯”å¦‚è¯´, ç•™è¨€åˆ°æˆ‘ä»¬ä¸“æ çš„ç›¸å…³æ–‡ç« çš„è¯„è®ºåŒº, å°±æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•.")]),s._v(" "),t("p",[s._v("è¿™äº›å®žè·µåšå®ŒåŽ, ä½ å°±åº”è¯¥å¯¹è‡ªå·±æ¯”è¾ƒæœ‰ä¿¡å¿ƒäº†. è¿™æ—¶å€™, ä½ å¯ä»¥å†åŽ»çœ‹æ‰‹å†Œ, æŠŠçŸ¥è¯†ç½‘ç»œä¸­çš„ç›²ç‚¹è¡¥å…¨, è¿›è€Œå½¢æˆé¢. è€Œè¡¥å…¨çš„æ–¹æ³•å°±æ˜¯å‰ä¸¤ç‚¹äº†, ç†è®ºåŠ å®žè·µ.")]),s._v(" "),t("p",[s._v("æˆ‘å¸Œæœ›è¿™ 45 ç¯‡æ–‡ç« , å¯ä»¥åœ¨ä½ æž„å»º MySQL çŸ¥è¯†ä½“ç³»çš„è¿‡ç¨‹ä¸­, èµ·åˆ°ä¸€ä¸ªåŠ é€Ÿå™¨çš„ä½œç”¨.")]),s._v(" "),t("p",[s._v('æˆ‘ç‰¹æ„å®‰æŽ’åœ¨æœ€åŽä¸€ç¯‡æ–‡ç« , å’Œä½ ä»‹ç» MySQL é‡Œå„ç§è‡ªå¢ž id è¾¾åˆ°å®šä¹‰çš„ä¸Šé™ä»¥åŽçš„ä¸åŒè¡Œä¸º. "45"å°±æ˜¯æˆ‘ä»¬è¿™ä¸ªä¸“æ çš„ id ä¸Šé™, è€Œè¿™ä¸€ç¯‡ç»“æŸè¯­, ä¾¿æ˜¯è¶…è¿‡ä¸Šé™åŽçš„ç¬¬ä¸€ä¸ªå€¼. è¿™æ˜¯ä¸€ä¸ªæœªå®šä¹‰çš„å€¼, ç”±ä½ æ¥å®šä¹‰:')]),s._v(" "),t("ul",[t("li",[s._v("æœ‰çš„åŒå­¦å¯èƒ½ä¼šåƒè¡¨å®šä¹‰çš„è‡ªå¢ž id ä¸€æ ·, å°±è®©å®ƒå®šæ ¼åœ¨è¿™é‡Œ;")]),s._v(" "),t("li",[s._v("æœ‰çš„åŒå­¦å¯èƒ½ä¼šåƒ row_id ä¸€æ ·, äºŒåˆ·, ç„¶åŽç”¨æ–°çš„, æ›´å…¨é¢çš„ç†è§£åŽ»æ›¿ä»£ä¹‹å‰çš„ç†è§£;")]),s._v(" "),t("li",[s._v("ä¹Ÿè®¸æœ€å¤šçš„æƒ…å†µæ˜¯ä¼šåƒ thread_id ä¸€æ ·, å°†å·²ç»å½»åº•æŽŒæ¡çš„æ–‡ç« æ ‡è®°èµ·æ¥, ä¸“é—¨åˆ·é‚£äº›ä¹‹å‰çœ‹è¿‡, ä½†æ˜¯å·²ç»å°è±¡æ¨¡ç³Šçš„æ–‡ç« .")])]),s._v(" "),t("p",[s._v('ä¸è®ºæ˜¯å“ªä¸€ç§ç­–ç•¥, åªè¦è¿™ 45 ç¯‡æ–‡ç« ä¸­, æœ‰é‚£ä¹ˆå‡ ä¸ªçŸ¥è¯†ç‚¹, åƒ Xid æˆ–è€… InnoDB trx_id ä¸€æ ·, æŒä¹…åŒ–åˆ°äº†ä½ çš„çŸ¥è¯†ç½‘ç»œé‡Œ, ä½ å’Œæˆ‘åœ¨è¿™é‡ŒèŠ±è´¹çš„æ—¶é—´, å°±æ˜¯"æžå®¢"çš„æ—¶é—´, å°±å€¼äº†.')]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")])])}),[],!1,null,null,null);t.default=e.exports}}]);