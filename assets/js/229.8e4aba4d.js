(window.webpackJsonp=window.webpackJsonp||[]).push([[229],{557:function(_,v,t){"use strict";t.r(v);var s=t(4),r=Object(s.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"_31-redisæŒä¹…åŒ–"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_31-redisæŒä¹…åŒ–"}},[_._v("#")]),_._v(" 31.RedisæŒä¹…åŒ–")]),_._v(" "),v("p",[_._v("æŒä¹…åŒ–æ–¹å¼: "),v("strong",[_._v("RDB, AOF, æ··åˆæŒä¹…åŒ–")]),_._v(".")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20200425182633664.png",alt:"image-20200425182633664"}})]),_._v(" "),v("ol",[v("li",[_._v("å®¢æˆ·ç«¯å‘æ•°æ®åº“"),v("strong",[_._v("å‘é€å†™å‘½ä»¤")]),_._v(".")]),_._v(" "),v("li",[_._v("æ•°æ®åº“"),v("strong",[_._v("æ¥æ”¶")]),_._v("åˆ°å®¢æˆ·ç«¯"),v("strong",[_._v("å†™è¯·æ±‚")]),_._v(".")]),_._v(" "),v("li",[_._v("æ•°æ®åº“"),v("strong",[_._v("è°ƒç”¨ç³»ç»Ÿ API")]),_._v("å°†æ•°æ®å†™å…¥ç£ç›˜(æ•°æ®åœ¨å†…æ ¸ç¼“å†²åŒºä¸­).")]),_._v(" "),v("li",[_._v("æ“ä½œç³»ç»Ÿå°†"),v("strong",[_._v("å†™ç¼“å†²åŒº")]),_._v("ä¼ è¾“åˆ°"),v("strong",[_._v("ç£ç›˜æ§æ§åˆ¶å™¨")]),_._v("(æ•°æ®åœ¨ç£ç›˜ç¼“å­˜ä¸­).")]),_._v(" "),v("li",[_._v("æ“ä½œç³»ç»Ÿçš„ç£ç›˜æ§åˆ¶å™¨å°†æ•°æ®å†™å…¥å®é™…çš„ç‰©ç†åª’ä»‹ä¸­(æ•°æ®åœ¨ç£ç›˜ä¸­).")])]),_._v(" "),v("p",[v("strong",[_._v("æ³¨æ„")]),_._v(": ä¸Šé¢çš„è¿‡ç¨‹å…¶å®æ˜¯ "),v("strong",[_._v("æåº¦ç²¾ç®€")]),_._v(" çš„, åœ¨å®é™…çš„æ“ä½œç³»ç»Ÿä¸­, "),v("strong",[_._v("ç¼“å­˜")]),_._v("å’Œ"),v("strong",[_._v("ç¼“å†²åŒº")]),_._v("ä¼šæ¯”è¿™ "),v("strong",[_._v("å¤šå¾—å¤š")]),_._v(".")]),_._v(" "),v("h4",{attrs:{id:"rdbæŒä¹…åŒ–ğŸŒŸ"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdbæŒä¹…åŒ–ğŸŒŸ"}},[_._v("#")]),_._v(" RDBæŒä¹…åŒ–ğŸŒŸ")]),_._v(" "),v("p",[_._v("RDB æŒä¹…åŒ–æ˜¯æŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆ"),v("strong",[_._v("å¿«ç…§")]),_._v("ä¿å­˜åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹.")]),_._v(" "),v("h5",{attrs:{id:"_1-è§¦å‘æœºåˆ¶"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-è§¦å‘æœºåˆ¶"}},[_._v("#")]),_._v(" 1.è§¦å‘æœºåˆ¶")]),_._v(" "),v("p",[_._v("è§¦å‘ RDB æŒä¹…åŒ–è¿‡ç¨‹åˆ†ä¸º"),v("strong",[_._v("æ‰‹åŠ¨è§¦å‘")]),_._v("å’Œ"),v("strong",[_._v("è‡ªåŠ¨è§¦å‘")]),_._v(".")]),_._v(" "),v("h6",{attrs:{id:"_1-æ‰‹åŠ¨è§¦å‘"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ‰‹åŠ¨è§¦å‘"}},[_._v("#")]),_._v(" (1)æ‰‹åŠ¨è§¦å‘")]),_._v(" "),v("p",[v("strong",[_._v("æ‰‹åŠ¨è§¦å‘")]),_._v("åˆ†åˆ«å¯¹åº” "),v("strong",[_._v("save")]),_._v(" å’Œ "),v("strong",[_._v("bgsave")]),_._v(" å‘½ä»¤.")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("save")]),_._v(": "),v("strong",[_._v("é˜»å¡")]),_._v("å½“å‰ Redis æœåŠ¡å™¨, ç›´åˆ° RDB è¿‡ç¨‹å®Œæˆ. å¦‚æœæ•°æ®é‡å¤§å¯èƒ½é˜»å¡å¤ªé•¿, å·²ç»"),v("strong",[_._v("åºŸå¼ƒ")]),_._v(", ç”Ÿäº§ç¯å¢ƒåˆ«ç”¨.")]),_._v(" "),v("li",[v("strong",[_._v("bgsave")]),_._v(": Redis è¿›ç¨‹æ‰§è¡Œ "),v("strong",[_._v("fork")]),_._v(" æ“ä½œåˆ›å»º"),v("strong",[_._v("å­è¿›ç¨‹")]),_._v(", RDB æŒä¹…åŒ–è¿‡ç¨‹ç”±"),v("strong",[_._v("å­è¿›ç¨‹è´Ÿè´£")]),_._v(", å®Œæˆåè‡ªåŠ¨ç»“æŸ. "),v("strong",[_._v("é˜»å¡åªå‘ç”Ÿåœ¨ fork åˆ›å»ºå­è¿›ç¨‹çš„é˜¶æ®µ, ä¸€èˆ¬æ—¶é—´å¾ˆçŸ­")]),_._v(", ç”Ÿäº§ç¯å¢ƒä½¿ç”¨.")])]),_._v(" "),v("h6",{attrs:{id:"_2-è‡ªåŠ¨è§¦å‘"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-è‡ªåŠ¨è§¦å‘"}},[_._v("#")]),_._v(" (2)è‡ªåŠ¨è§¦å‘")]),_._v(" "),v("p",[_._v("è‡ªåŠ¨è§¦å‘çš„åœºæ™¯:")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("save m n")]),_._v(" è¡¨ç¤ºå¦‚æœåœ¨ m ç§’å†…æ•°æ®é›†å­˜åœ¨ n æ¬¡ä¿®æ”¹æ—¶, "),v("strong",[_._v("è‡ªåŠ¨è§¦å‘ bgsave")]),_._v(".")]),_._v(" "),v("li",[_._v("å¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œ"),v("strong",[_._v("å…¨é‡å¤åˆ¶")]),_._v("æ“ä½œ, ä¸»èŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œ bgsave ç”Ÿæˆ RDB æ–‡ä»¶å¹¶å‘é€ç»™ä»èŠ‚ç‚¹.")]),_._v(" "),v("li",[_._v("æ‰§è¡Œ debug reload å‘½ä»¤é‡æ–°åŠ è½½ Redis æ—¶, ä¹Ÿä¼šè‡ªåŠ¨è§¦å‘ save æ“ä½œ.")]),_._v(" "),v("li",[_._v("é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œ shutdown å‘½ä»¤æ—¶, å¦‚æœæ²¡æœ‰å¼€å¯ AOF, åˆ™è‡ªåŠ¨æ‰§è¡Œ bgsave.")])]),_._v(" "),v("h5",{attrs:{id:"_2-æµç¨‹è¯´æ˜"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-æµç¨‹è¯´æ˜"}},[_._v("#")]),_._v(" 2.æµç¨‹è¯´æ˜")]),_._v(" "),v("h6",{attrs:{id:"_1-æµç¨‹æ¦‚è¿°"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-æµç¨‹æ¦‚è¿°"}},[_._v("#")]),_._v(" (1)æµç¨‹æ¦‚è¿°")]),_._v(" "),v("p",[v("strong",[_._v("bgsave")]),_._v(" æ˜¯ä¸»æµçš„è§¦å‘ RDB æŒä¹…åŒ–çš„æ–¹å¼, æµç¨‹å¦‚ä¸‹.")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220522212958905.png",alt:""}})]),_._v(" "),v("p",[_._v("(1) Redis çˆ¶è¿›ç¨‹é¦–å…ˆåˆ¤æ–­: å½“å‰"),v("strong",[_._v("æ˜¯å¦æ­£åœ¨æ‰§è¡Œ")]),_._v(" save æˆ– bgsave/bgrewriteaof çš„å­è¿›ç¨‹, å¦‚æœåœ¨æ‰§è¡Œåˆ™ bgsave å‘½ä»¤"),v("strong",[_._v("ç›´æ¥è¿”å›")]),_._v(". bgsave/bgrewriteaof çš„å­è¿›ç¨‹"),v("strong",[_._v("ä¸èƒ½åŒæ—¶æ‰§è¡Œ")]),_._v(", ä¸»è¦æ˜¯åŸºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘: ä¸¤ä¸ªå¹¶å‘çš„å­è¿›ç¨‹åŒæ—¶æ‰§è¡Œå¤§é‡çš„ç£ç›˜å†™æ“ä½œ, å¯èƒ½å¼•èµ·ä¸¥é‡çš„æ€§èƒ½é—®é¢˜.")]),_._v(" "),v("p",[_._v("(2) çˆ¶è¿›ç¨‹æ‰§è¡Œ "),v("strong",[_._v("fork")]),_._v(" æ“ä½œ"),v("strong",[_._v("åˆ›å»ºå­è¿›ç¨‹")]),_._v(", è¿™ä¸ªè¿‡ç¨‹ä¸­"),v("strong",[_._v("çˆ¶è¿›ç¨‹æ˜¯é˜»å¡")]),_._v("çš„, Redis ä¸èƒ½æ‰§è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„ä»»ä½•å‘½ä»¤, ä½†è¿™ä¸ªé˜»å¡æ—¶é—´"),v("strong",[_._v("å¾ˆçŸ­")]),_._v(".")]),_._v(" "),v("p",[_._v("(3) çˆ¶è¿›ç¨‹ fork åˆ›å»ºå®Œå­è¿›ç¨‹å, "),v("strong",[_._v("bgsave å‘½ä»¤")]),_._v('è¿”å› "Background saving started" ä¿¡æ¯å¹¶'),v("strong",[_._v("ä¸å†é˜»å¡")]),_._v("çˆ¶è¿›ç¨‹, å¹¶å¯ä»¥å“åº”å…¶ä»–å‘½ä»¤.")]),_._v(" "),v("p",[_._v("(4) å­è¿›ç¨‹"),v("strong",[_._v("åˆ›å»º RDB")]),_._v(" æ–‡ä»¶, æ ¹æ®"),v("strong",[_._v("çˆ¶è¿›ç¨‹å†…å­˜å¿«ç…§ç”Ÿæˆä¸´æ—¶å¿«ç…§æ–‡ä»¶")]),_._v(", å®Œæˆåå¯¹"),v("strong",[_._v("åŸæœ‰æ–‡ä»¶")]),_._v("è¿›è¡Œ"),v("strong",[_._v("åŸå­æ›¿æ¢")]),_._v(".")]),_._v(" "),v("p",[_._v("(5) å­è¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆ, çˆ¶è¿›ç¨‹"),v("strong",[_._v("æ›´æ–°ç»Ÿè®¡ä¿¡æ¯")]),_._v(".")]),_._v(" "),v("h6",{attrs:{id:"_2-å†™æ—¶å¤åˆ¶æœºåˆ¶"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†™æ—¶å¤åˆ¶æœºåˆ¶"}},[_._v("#")]),_._v(" (2)å†™æ—¶å¤åˆ¶æœºåˆ¶")]),_._v(" "),v("p",[_._v('RBD ä¹Ÿå« "'),v("strong",[_._v("å¿«ç…§")]),_._v('" æŒä¹…åŒ–. æ“ä½œç³»ç»Ÿå¤šè¿›ç¨‹å†™æ—¶å¤åˆ¶ '),v("strong",[_._v("COW(Copy On Write) æœºåˆ¶")]),_._v(" ååˆ†é‡è¦. "),v("strong",[_._v("Redis")]),_._v(" åœ¨æŒä¹…åŒ–æ—¶ä¼šè°ƒç”¨å‡½æ•° "),v("strong",[_._v("fork()")]),_._v(" äº§ç”Ÿä¸€ä¸ª"),v("strong",[_._v("å­è¿›ç¨‹")]),_._v(", ç®€å•ç†è§£ä¹Ÿå°±æ˜¯åŸºäºå½“å‰è¿›ç¨‹"),v("strong",[_._v("å¤åˆ¶")]),_._v("äº†ä¸€ä¸ªè¿›ç¨‹, ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼š"),v("strong",[_._v("å…±äº«")]),_._v("å†…å­˜é‡Œé¢çš„ä»£ç å—å’Œæ•°æ®æ®µ:")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20200425182803920.png",alt:"image-20200425182803920"}})]),_._v(" "),v("p",[_._v("æ‰€ä»¥"),v("strong",[_._v("å¿«ç…§æŒä¹…åŒ–")]),_._v("å¯ä»¥å®Œå…¨äº¤ç»™"),v("strong",[_._v("å­è¿›ç¨‹")]),_._v("æ¥å¤„ç†, "),v("strong",[_._v("çˆ¶è¿›ç¨‹")]),_._v("åˆ™ç»§ç»­"),v("strong",[_._v("å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚")]),_._v(". "),v("strong",[_._v("å­è¿›ç¨‹")]),_._v("åšæ•°æ®æŒä¹…åŒ–, å®ƒ"),v("strong",[_._v("ä¸ä¼šä¿®æ”¹ç°æœ‰çš„å†…å­˜æ•°æ®ç»“æ„")]),_._v(", å®ƒåªæ˜¯å¯¹æ•°æ®ç»“æ„è¿›è¡Œ"),v("strong",[_._v("éå†è¯»å–")]),_._v(", ç„¶ååºåˆ—åŒ–å†™åˆ°ç£ç›˜ä¸­. ä½†"),v("strong",[_._v("çˆ¶è¿›ç¨‹")]),_._v("ä¸ä¸€æ ·, å®ƒå¿…é¡»æŒç»­æœåŠ¡å®¢æˆ·ç«¯è¯·æ±‚, ç„¶åå¯¹"),v("strong",[_._v("å†…å­˜æ•°æ®ç»“æ„è¿›è¡Œä¸é—´æ–­çš„ä¿®æ”¹")]),_._v(".")]),_._v(" "),v("p",[_._v("è¿™æ—¶å€™å°±ä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ "),v("strong",[_._v("Copy On Write æœºåˆ¶")]),_._v("æ¥è¿›è¡Œ"),v("strong",[_._v("æ•°æ®æ®µé¡µé¢")]),_._v("çš„"),v("strong",[_._v("åˆ†ç¦»")]),_._v(". æ•°æ®æ®µæ˜¯ç”±å¾ˆå¤šæ“ä½œç³»ç»Ÿçš„é¡µé¢ç»„åˆè€Œæˆ, å½“çˆ¶è¿›ç¨‹å¯¹å…¶ä¸­ä¸€ä¸ªé¡µé¢çš„æ•°æ®è¿›è¡Œ"),v("strong",[_._v("ä¿®æ”¹")]),_._v("æ—¶, ä¼šå°†"),v("strong",[_._v("è¢«å…±äº«çš„é¡µé¢å¤åˆ¶ä¸€ä»½åˆ†ç¦»")]),_._v("å‡ºæ¥, ç„¶å"),v("strong",[_._v("å¯¹è¿™ä¸ªå¤åˆ¶çš„é¡µé¢è¿›è¡Œä¿®æ”¹")]),_._v(". è¿™æ—¶"),v("strong",[_._v("å­è¿›ç¨‹")]),_._v("ç›¸åº”çš„é¡µé¢æ˜¯"),v("strong",[_._v("æ²¡æœ‰å˜åŒ–çš„")]),_._v(", è¿˜æ˜¯è¿›ç¨‹äº§ç”Ÿæ—¶"),v("strong",[_._v("é‚£ä¸€ç¬é—´")]),_._v("çš„æ•°æ®.")]),_._v(" "),v("p",[_._v("å­è¿›ç¨‹å› ä¸ºæ•°æ®æ²¡æœ‰å˜åŒ–, å®ƒèƒ½çœ‹åˆ°çš„"),v("strong",[_._v("å†…å­˜é‡Œçš„æ•°æ®åœ¨è¿›ç¨‹äº§ç”Ÿçš„ä¸€ç¬é—´å°±å‡å›º")]),_._v("äº†, å†ä¹Ÿä¸ä¼šæ”¹å˜, è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ "),v("strong",[_._v("Redis")]),_._v(" çš„æŒä¹…åŒ–"),v("strong",[_._v("å«ã€Œå¿«ç…§ã€çš„åŸå› ")]),_._v("!!! æ¥ä¸‹æ¥å­è¿›ç¨‹å°±å¯ä»¥éå¸¸å®‰å¿ƒçš„éå†æ•°æ®äº†è¿›è¡Œåºåˆ—åŒ–å†™ç£ç›˜äº†.")]),_._v(" "),v("h5",{attrs:{id:"_3-rdbæ–‡ä»¶"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-rdbæ–‡ä»¶"}},[_._v("#")]),_._v(" 3.RDBæ–‡ä»¶")]),_._v(" "),v("p",[_._v("RDB æ–‡ä»¶æ˜¯ç»è¿‡"),v("strong",[_._v("å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶")]),_._v(", Redis é»˜è®¤é‡‡ç”¨ "),v("strong",[_._v("LZF ç®—æ³•")]),_._v("å¯¹ç”Ÿæˆçš„ RDB æ–‡ä»¶åš"),v("strong",[_._v("å‹ç¼©å¤„ç†")]),_._v(", å‹ç¼©åçš„æ–‡ä»¶"),v("strong",[_._v("è¿œè¿œå°äº")]),_._v("å†…å­˜å¤§å°.")]),_._v(" "),v("p",[v("strong",[_._v("RDB æ–‡ä»¶ä¿å­˜åœ¨ dir é…ç½®æŒ‡å®šçš„ç›®å½•ä¸‹, æ–‡ä»¶åé€šè¿‡ dbfilename é…ç½®.")])]),_._v(" "),v("h5",{attrs:{id:"_4-rdbä¼˜ç¼ºç‚¹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-rdbä¼˜ç¼ºç‚¹"}},[_._v("#")]),_._v(" 4.RDBä¼˜ç¼ºç‚¹")]),_._v(" "),v("p",[v("strong",[_._v("(1)ä¼˜ç‚¹")])]),_._v(" "),v("p",[_._v("RDB æ–‡ä»¶æ˜¯ç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶, æ¶ˆè€—"),v("strong",[_._v("ç©ºé—´å°‘")]),_._v(". RDB æ–‡ä»¶ä»£è¡¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„"),v("strong",[_._v("æ•°æ®å¿«ç…§")]),_._v(", æ‰€ä»¥éå¸¸é€‚åˆäº"),v("strong",[_._v("å¤‡ä»½, å…¨é‡å¤åˆ¶")]),_._v("ç­‰åœºæ™¯. Redis "),v("strong",[_._v("åŠ è½½ RDB æ–‡ä»¶æ¢å¤æ•°æ®çš„é€Ÿåº¦è¿œè¿œå¿«äº")]),_._v(" AOF æ–¹å¼.")]),_._v(" "),v("p",[v("strong",[_._v("(2)ç¼ºç‚¹")])]),_._v(" "),v("p",[_._v("RDB "),v("strong",[_._v("æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–, ç§’çº§æŒä¹…åŒ–")]),_._v(". å› ä¸º RDB å±äº"),v("strong",[_._v("é‡é‡çº§æ“ä½œ")]),_._v(", ä¸èƒ½é¢‘ç¹æ‰§è¡Œ. ä¸€èˆ¬ç”¨äº"),v("strong",[_._v("æ•°æ®å†·å¤‡å’Œå¤åˆ¶ä¼ è¾“")]),_._v(". RDB æ˜¯ç”¨ç‰¹å®šçš„äºŒè¿›åˆ¶æ ¼å¼å­˜å‚¨, ä¼šå‡ºç°å¤šç‰ˆæœ¬çš„æ ¼å¼, å¯¼è‡´æ–°è€ç‰ˆæœ¬ä¸å…¼å®¹.")]),_._v(" "),v("h4",{attrs:{id:"aofæŒä¹…åŒ–ğŸŒŸ"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aofæŒä¹…åŒ–ğŸŒŸ"}},[_._v("#")]),_._v(" AOFæŒä¹…åŒ–ğŸŒŸ")]),_._v(" "),v("p",[_._v("ç”±äº RDB ä¸é€‚åˆå®æ—¶æŒä¹…åŒ–, æ‰€ä»¥ Redis æä¾›äº† AOF æŒä¹…åŒ–æ–¹å¼. "),v("strong",[_._v("AOF(Append Only File) æŒä¹…åŒ–")]),_._v(", æ˜¯å°† Redis æ‰§è¡Œçš„æ¯æ¬¡å†™"),v("strong",[_._v("å‘½ä»¤è®°å½•åˆ°å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶")]),_._v("ä¸­, å½“ Redis "),v("strong",[_._v("é‡å¯")]),_._v("æ—¶"),v("strong",[_._v("å†æ¬¡æ‰§è¡Œ")]),_._v(" AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®. ä¸ RDB ç›¸æ¯”, AOF çš„"),v("strong",[_._v("å®æ—¶æ€§æ›´å¥½")]),_._v(", å› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–æ–¹æ¡ˆ.")]),_._v(" "),v("h5",{attrs:{id:"_1-ä½¿ç”¨aof"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä½¿ç”¨aof"}},[_._v("#")]),_._v(" 1.ä½¿ç”¨AOF")]),_._v(" "),v("p",[_._v("é…ç½®å¼€å¯ AOF: "),v("strong",[_._v("appendonly yes")]),_._v(".")]),_._v(" "),v("p",[_._v("æ–‡ä»¶åé…ç½®: "),v("strong",[_._v("appendfilename")]),_._v(". é»˜è®¤ appendonly.aof.")]),_._v(" "),v("p",[_._v("ä¿å­˜è·¯å¾„: "),v("strong",[_._v("dir")]),_._v(".")]),_._v(" "),v("p",[_._v("ç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥: "),v("strong",[_._v("appendfsync")]),_._v(" å‚æ•°é…ç½®.")]),_._v(" "),v("h5",{attrs:{id:"_2-å·¥ä½œæµç¨‹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-å·¥ä½œæµç¨‹"}},[_._v("#")]),_._v(" 2.å·¥ä½œæµç¨‹")]),_._v(" "),v("p",[_._v("AOF å·¥ä½œæµç¨‹å¦‚ä¸‹: å‘½ä»¤å†™å…¥, æ–‡ä»¶åŒæ­¥, æ–‡ä»¶é‡å†™, é‡å¯åŠ è½½.")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220522213407811.png",alt:""}})]),_._v(" "),v("h6",{attrs:{id:"_1-å‘½ä»¤å†™å…¥"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-å‘½ä»¤å†™å…¥"}},[_._v("#")]),_._v(" (1)å‘½ä»¤å†™å…¥")]),_._v(" "),v("p",[_._v("å†™å…¥çš„å†…å®¹ç›´æ¥æ˜¯"),v("strong",[_._v("æ–‡æœ¬åè®®æ ¼å¼")]),_._v(". è¿™æ ·å¯ä»¥æé«˜å…¼å®¹æ€§åŒæ—¶é¿å…äºŒæ¬¡å¤„ç†çš„å¼€é”€, ä¸”"),v("strong",[_._v("å¯è¯»æ€§")]),_._v("æ›´å¥½.")]),_._v(" "),v("p",[_._v("å¦‚æœæ¯æ¡æŒ‡ä»¤éƒ½ç›´æ¥å†™å…¥ç¡¬ç›˜, é‚£å¼€é”€å¤ªå¤§äº†, æ‰€ä»¥"),v("strong",[_._v("å†™çš„å‘½ä»¤")]),_._v("éƒ½æ˜¯å…ˆè¿½åŠ åˆ° "),v("strong",[_._v("aod_buf(ç¼“å†²åŒº)"),v("strong",[_._v("â€‹"),v("strong",[v("strong",[_._v("ä¸­, ä¹‹åæ ¹æ®ä¸€å®šçš„")])]),_._v("â€‹")]),_._v("åŒæ­¥ç­–ç•¥")]),_._v("å°†ç¼“å†²åŒºçš„å‘½ä»¤åŒæ­¥åˆ°ç£ç›˜ä¸­. Redis å¯ä»¥æä¾›"),v("strong",[_._v("å¤šç§ç¼“å†²åŒºåŒæ­¥ç­–ç•¥")]),_._v(", åœ¨æ€§èƒ½å’Œå®‰å…¨æ€§æ–¹é¢åšå‡ºå¹³è¡¡.")]),_._v(" "),v("h6",{attrs:{id:"_2-æ–‡ä»¶åŒæ­¥"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ–‡ä»¶åŒæ­¥"}},[_._v("#")]),_._v(" (2)æ–‡ä»¶åŒæ­¥")]),_._v(" "),v("p",[_._v("æŒ‡ä»¤è¢«å†™å…¥ AOF æ—¥å¿—, è€Œ "),v("strong",[_._v("AOF æ—¥å¿—")]),_._v("æ˜¯ä»¥"),v("strong",[_._v("æ–‡ä»¶")]),_._v("çš„å½¢å¼å­˜åœ¨çš„, å½“ç¨‹åºå¯¹ AOF æ—¥å¿—æ–‡ä»¶è¿›è¡Œå†™æ“ä½œæ—¶, å®é™…ä¸Šæ˜¯å°†å†…å®¹å†™åˆ°äº†"),v("strong",[_._v("å†…æ ¸ä¸ºæ–‡ä»¶æè¿°ç¬¦åˆ†é…çš„ä¸€ä¸ªå†…å­˜ç¼“å­˜")]),_._v("ä¸­, ç„¶åå†…æ ¸ä¼šå¼‚æ­¥å°†å‘½ä»¤æ•°æ®åˆ·å›åˆ°ç£ç›˜.")]),_._v(" "),v("p",[_._v("æœ‰å¤šç§ AOF ç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥, ç”± "),v("strong",[_._v("appendfsync")]),_._v(" å‚æ•°é…ç½®, å¯é…ç½®å€¼å¦‚ä¸‹.")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"center"}},[_._v("åŒæ­¥ç­–ç•¥å¯é…ç½®å€¼")]),_._v(" "),v("th",{staticStyle:{"text-align":"center"}},[_._v("è¯´æ˜")])])]),_._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"center"}},[_._v("always")]),_._v(" "),v("td",{staticStyle:{"text-align":"center"}},[_._v("å‘½ä»¤å†™å…¥ "),v("strong",[_._v("aof_buf")]),_._v(" å"),v("strong",[_._v("ç«‹å³è°ƒç”¨ç³»ç»Ÿ")]),_._v(" "),v("strong",[_._v("fsync æ“ä½œ")]),_._v("åŒæ­¥åˆ° AOF æ–‡ä»¶, fsync å®Œæˆåçº¿ç¨‹è¿”å›. è¿™æ ·"),v("strong",[_._v("æ¯æ¬¡æœ‰å†™å‘½ä»¤éƒ½è¦åŒæ­¥")]),_._v("åˆ° AOF æ–‡ä»¶, ç¡¬ç›˜ IO æˆä¸ºæ€§èƒ½ç“¶é¢ˆ, æ­¤æ—¶åªèƒ½æ”¯æŒå¤§çº¦"),v("strong",[_._v("å‡ ç™¾")]),_._v(" TPS å†™å…¥, ä¸¥é‡é™ä½äº†æ€§èƒ½, åˆ«ç”¨!!!")])]),_._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"center"}},[_._v("no")]),_._v(" "),v("td",{staticStyle:{"text-align":"center"}},[_._v("å‘½ä»¤å†™å…¥ "),v("strong",[_._v("aof_buf")]),_._v(" åè°ƒç”¨ç³»ç»Ÿ "),v("strong",[_._v("write æ“ä½œ")]),_._v(", ä¸å¯¹ AOF æ–‡ä»¶åš "),v("strong",[_._v("fsync åŒæ­¥")]),_._v("; åŒæ­¥"),v("strong",[_._v("ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£")]),_._v(", é€šå¸¸åŒæ­¥å‘¨æœŸä¸º "),v("strong",[_._v("30 ç§’")]),_._v(". æ–‡ä»¶åŒæ­¥çš„æ—¶é—´"),v("strong",[_._v("ä¸å¯æ§")]),_._v(", ä¸”ç¼“å†²åŒºä¸­å †ç§¯çš„æ•°æ®ä¼šå¾ˆå¤š, æ•°æ®å®‰å…¨æ€§"),v("strong",[_._v("æ— æ³•ä¿è¯")]),_._v(".")])]),_._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"center"}},[v("strong",[_._v("==everysec==")])]),_._v(" "),v("td",{staticStyle:{"text-align":"center"}},[_._v("å‘½ä»¤å†™å…¥ "),v("strong",[_._v("aof_buf")]),_._v(" åè°ƒç”¨ç³»ç»Ÿ "),v("strong",[_._v("write æ“ä½œ")]),_._v(", write å®Œæˆåçº¿ç¨‹"),v("strong",[_._v("è¿”å›")]),_._v("; "),v("strong",[_._v("fsync åŒæ­¥æ–‡ä»¶")]),_._v("æ“ä½œç”±"),v("strong",[_._v("ä¸“é—¨çš„çº¿ç¨‹æ¯ç§’è°ƒç”¨ä¸€æ¬¡")]),_._v(". å®ƒæ˜¯å‰è¿°ä¸¤ç§ç­–ç•¥çš„æŠ˜ä¸­, æ˜¯æ€§èƒ½å’Œæ•°æ®å®‰å…¨æ€§çš„å¹³è¡¡, å› æ­¤æ˜¯ Redis çš„"),v("strong",[_._v("é»˜è®¤æ¨èé…ç½®")]),_._v(". ç†è®ºä¸Šæ¥è¯´ç³»ç»Ÿå®•æœºä¸¢å¤±çš„æ•°æ®ä¹Ÿåœ¨ "),v("strong",[_._v("2 ç§’")]),_._v("ä¹‹å†…(ä¸æ˜¯ 1 ç§’).")])])])]),_._v(" "),v("blockquote",[v("p",[v("strong",[_._v("å…³äºç³»ç»Ÿè°ƒç”¨writeä¸fsync")])])]),_._v(" "),v("p",[v("strong",[_._v("write ç³»ç»Ÿè°ƒç”¨ä¼šè§¦å‘å»¶è¿Ÿå†™æœºåˆ¶")]),_._v(". Linux åœ¨å†…æ ¸æä¾›é¡µç¼“å†²åŒºæ¥æé«˜ç¡¬ç›˜ IO æ€§èƒ½. write æ“ä½œåœ¨"),v("strong",[_._v("å†™å…¥ç³»ç»Ÿç¼“å†²åŒº")]),_._v("å"),v("strong",[_._v("ç›´æ¥è¿”å›")]),_._v(". åŒæ­¥ç¡¬ç›˜æ“ä½œä¾èµ–äºç³»ç»Ÿè°ƒåº¦æœºåˆ¶. åŒæ­¥æ–‡ä»¶ä¹‹å‰, å¦‚æœç³»ç»Ÿå®•æœº, é‚£ä¹ˆç¼“å†²åŒºå†…çš„æ•°æ®ä¸¢å¤±.")]),_._v(" "),v("p",[v("strong",[_._v("fsync ç³»ç»Ÿè°ƒç”¨")]),_._v("é’ˆå¯¹å•ä¸ªæ–‡ä»¶æ“ä½œ(æ¯”å¦‚ AOF æ–‡ä»¶), å°†"),v("strong",[_._v("é˜»å¡")]),_._v("ç›´åˆ°æ•°æ®å†™å…¥ç¡¬ç›˜åè¿”å›, åš"),v("strong",[_._v("å¼ºåˆ¶ç¡¬ç›˜åŒæ­¥")]),_._v(", ä¿è¯æ•°æ®æŒä¹…åŒ–, ä½†æ˜¯å¼€é”€è¾ƒå¤§.")]),_._v(" "),v("h6",{attrs:{id:"_3-æ–‡ä»¶é‡å†™"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ–‡ä»¶é‡å†™"}},[_._v("#")]),_._v(" (3)æ–‡ä»¶é‡å†™")]),_._v(" "),v("p",[_._v("Redis æœåŠ¡å™¨æ‰§è¡Œçš„"),v("strong",[_._v("å†™å‘½ä»¤")]),_._v("éšæ—¶é—´è¶Šæ¥è¶Šå¤š, AOF æ–‡ä»¶ä¹Ÿä¼š"),v("strong",[_._v("è¶Šæ¥è¶Šå¤§")]),_._v("; è¿‡å¤§çš„ AOF æ–‡ä»¶ä¸ä»…ä¼šå½±å“æœåŠ¡å™¨çš„æ­£å¸¸è¿è¡Œ, ä¹Ÿä¼šå¯¼è‡´"),v("strong",[_._v("æ•°æ®æ¢å¤éœ€è¦çš„æ—¶é—´è¿‡é•¿")]),_._v(".")]),_._v(" "),v("blockquote",[v("p",[_._v("AOFæŒä¹…åŒ–æ–¹å¼ä¸ºä»€ä¹ˆè¦æ–‡ä»¶é‡å†™?")])]),_._v(" "),v("p",[v("strong",[_._v("AOF é‡å†™")]),_._v("æ˜¯æŒ‡"),v("strong",[_._v("å®šæœŸé‡å†™ AOF æ–‡ä»¶")]),_._v(", "),v("strong",[_._v("å‡å°äº† AOF æ–‡ä»¶çš„ä½“ç§¯")]),_._v(". ç”±äºé‡å†™å AOF æ‰§è¡Œçš„å‘½ä»¤å‡å°‘äº†, æ–‡ä»¶é‡å†™æ—¢å¯ä»¥å‡å°‘æ–‡ä»¶å ç”¨çš„ç©ºé—´, ä¹Ÿå¯ä»¥"),v("strong",[_._v("åŠ å¿«åŠ è½½æ¢å¤çš„é€Ÿåº¦")]),_._v(".")]),_._v(" "),v("blockquote",[v("p",[_._v("æ–‡ä»¶é‡å†™ä¸ºä»€ä¹ˆèƒ½å‹ç¼©AOFæ–‡ä»¶?")])]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("è¿‡æœŸ")]),_._v("çš„æ•°æ®ä¸å†å†™å…¥æ–‡ä»¶.")]),_._v(" "),v("li",[v("strong",[_._v("æ— æ•ˆçš„å‘½ä»¤")]),_._v("ä¸å†å†™å…¥æ–‡ä»¶: å¦‚æœ‰äº›æ•°æ®è¢«é‡å¤è®¾å€¼(set mykey v1, set mykey v2), æœ‰äº›æ•°æ®è¢«åˆ é™¤äº†(sadd myset v1, del myset)ç­‰.")]),_._v(" "),v("li",[_._v("å¤šæ¡å‘½ä»¤å¯ä»¥"),v("strong",[_._v("åˆå¹¶ä¸ºä¸€ä¸ª")]),_._v(": å¦‚ sadd myset v1, sadd myset v2, sadd myset v3 å¯ä»¥åˆå¹¶ä¸º sadd myset v1 v2 v3.")])]),_._v(" "),v("p",[_._v("éœ€è¦æ³¨æ„, "),v("strong",[_._v("AOF é‡å†™")]),_._v("æ˜¯æŠŠ Redis "),v("strong",[_._v("è¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸ºå†™å‘½ä»¤")]),_._v(", åŒæ­¥åˆ°æ–°çš„ AOF æ–‡ä»¶; "),v("strong",[_._v("ä¸ä¼šå¯¹æ—§çš„")]),_._v(" AOF æ–‡ä»¶è¿›è¡Œä»»ä½•è¯»å–, å†™å…¥æ“ä½œ!")]),_._v(" "),v("blockquote",[v("p",[_._v("AOFé‡å†™ä½•æ—¶è¿›è¡Œ? è§¦å‘æœºåˆ¶?")])]),_._v(" "),v("p",[v("strong",[_._v("(1)")]),_._v(" "),v("strong",[_._v("æ‰‹åŠ¨è§¦å‘")]),_._v(": ç›´æ¥è°ƒç”¨ "),v("strong",[_._v("bgrewriteaof")]),_._v(" å‘½ä»¤. è¯¥å‘½ä»¤çš„æ‰§è¡Œä¸ bgsave æœ‰äº›ç±»ä¼¼: éƒ½æ˜¯ fork å­è¿›ç¨‹è¿›è¡Œå…·ä½“çš„å·¥ä½œ, ä¸”éƒ½åªæœ‰åœ¨ fork æ—¶é˜»å¡.")]),_._v(" "),v("p",[v("strong",[_._v("(2) è‡ªåŠ¨è§¦å‘")]),_._v(": æ ¹æ® "),v("strong",[_._v("auto-aof-rewrite-min-size")]),_._v(" å’Œ "),v("strong",[_._v("auto-aof-rewrite-percentage")]),_._v(" å‚æ•°, ä»¥åŠ aof_current_size å’Œ aof_base_size çŠ¶æ€ç¡®å®šè§¦å‘æ—¶æœº.")]),_._v(" "),v("ul",[v("li",[_._v("auto-aof-rewrite-min-size: æ‰§è¡Œ AOF "),v("strong",[_._v("é‡å†™æ—¶")]),_._v(", æ–‡ä»¶çš„"),v("strong",[_._v("æœ€å°ä½“ç§¯")]),_._v(", é»˜è®¤å€¼ä¸º 64MB.")]),_._v(" "),v("li",[_._v("auto-aof-rewrite-percentage: æ‰§è¡Œ AOF é‡å†™æ—¶, "),v("strong",[_._v("å½“å‰")]),_._v(" AOF å¤§å°(å³ aof_current_size)å’Œä¸Šä¸€æ¬¡é‡å†™æ—¶ AOF å¤§å°(aof_base_size)çš„"),v("strong",[_._v("æ¯”å€¼")]),_._v(".")])]),_._v(" "),v("p",[_._v("åªæœ‰å½“ auto-aof-rewrite-min-size å’Œ auto-aof-rewrite-percentage ä¸¤ä¸ªå‚æ•°"),v("strong",[_._v("åŒæ—¶æ»¡è¶³")]),_._v("æ—¶, æ‰ä¼šè‡ªåŠ¨è§¦å‘ AOF é‡å†™, å³ "),v("strong",[_._v("bgrewriteaof")]),_._v(" æ“ä½œ.")]),_._v(" "),v("blockquote",[v("p",[_._v("AOFé‡å†™æµç¨‹?")])]),_._v(" "),v("p",[_._v("è§ä¸‹å›¾.")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220522213612372.png",alt:""}})]),_._v(" "),v("p",[_._v("(1) Redis çˆ¶è¿›ç¨‹é¦–å…ˆåˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨"),v("strong",[_._v("æ­£åœ¨æ‰§è¡Œ")]),_._v(" bgsave/bgrewriteaof çš„å­è¿›ç¨‹, å¦‚æœå­˜åœ¨åˆ™ bgrewriteaof å‘½ä»¤"),v("strong",[_._v("ç›´æ¥è¿”å›")]),_._v("; å¦‚æœå­˜åœ¨ bgsave å‘½ä»¤åˆ™ç­‰ bgsave æ‰§è¡Œå®Œæˆåå†æ‰§è¡Œ, è¿™ä¸ªä¸»è¦æ˜¯åŸºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘.")]),_._v(" "),v("p",[_._v("(2) çˆ¶è¿›ç¨‹æ‰§è¡Œ "),v("strong",[_._v("fork æ“ä½œ")]),_._v("åˆ›å»º"),v("strong",[_._v("å­è¿›ç¨‹")]),_._v(", è¿™ä¸ªè¿‡ç¨‹ä¸­"),v("strong",[_._v("çˆ¶è¿›ç¨‹æ˜¯é˜»å¡")]),_._v("çš„, ä»…è¿™ä¸€æ®µæ—¶é—´.")]),_._v(" "),v("p",[_._v("(3) çˆ¶è¿›ç¨‹ fork å, "),v("strong",[_._v("bgrewriteaof å‘½ä»¤è¿”å›")]),_._v(' "Background append only file rewrite started" ä¿¡æ¯å¹¶'),v("strong",[_._v("ä¸å†é˜»å¡")]),_._v("çˆ¶è¿›ç¨‹, ç„¶åå¯ä»¥ç»§ç»­å“åº”å…¶ä»–å‘½ä»¤. Redis çš„æ‰€æœ‰å†™å‘½ä»¤"),v("strong",[_._v("ä¾ç„¶å†™å…¥ AOF ç¼“å†²åŒº")]),_._v(", å¹¶æ ¹æ® appendfsync ç­–ç•¥åŒæ­¥åˆ°ç¡¬ç›˜, ä¿è¯åŸæœ‰ AOF æœºåˆ¶çš„æ­£ç¡®.")]),_._v(" "),v("p",[_._v("(4) ç”±äº fork æ“ä½œä½¿ç”¨**==å†™æ—¶å¤åˆ¶æŠ€æœ¯=="),v("strong",[_._v(", å­è¿›ç¨‹åªèƒ½")]),_._v("å…±äº« fork æ“ä½œæ—¶"),v("strong",[_._v("çš„å†…å­˜æ•°æ®. ç”±äºçˆ¶è¿›ç¨‹")]),_._v("ä¾ç„¶åœ¨å“åº”å‘½ä»¤**, å› æ­¤ Redis ä½¿ç”¨ "),v("strong",[_._v("AOF é‡å†™ç¼“å†²åŒº")]),_._v("(å›¾ä¸­çš„ aof_rewrite_buf)ä¿å­˜è¿™éƒ¨åˆ†æ•°æ®, é˜²æ­¢"),v("strong",[_._v("æ–° AOF æ–‡ä»¶ç”ŸæˆæœŸé—´ä¸¢å¤±è¿™éƒ¨åˆ†æ•°æ®")]),_._v(". ä¹Ÿå°±æ˜¯è¯´, bgrewriteaof æ‰§è¡ŒæœŸé—´, Redis çš„"),v("strong",[_._v("å†™å‘½ä»¤åŒæ—¶è¿½åŠ ")]),_._v("åˆ° aof_buf å’Œ aof_rewirte_buf ä¸¤ä¸ªç¼“å†²åŒº. ç¼“å†²åŒºä¸“é—¨ç”¨äºä¿å­˜"),v("strong",[_._v("åœ¨é‡å†™æœŸé—´æ“ä½œæ•°æ®å¸¦æ¥çš„å˜åŒ–")]),_._v(".")]),_._v(" "),v("p",[_._v("(5) å­è¿›ç¨‹æ ¹æ®"),v("strong",[_._v("å†…å­˜å¿«ç…§")]),_._v(", æŒ‰ç…§å‘½ä»¤åˆå¹¶è§„åˆ™å†™å…¥åˆ°"),v("strong",[_._v("æ–°çš„ AOF")]),_._v(" æ–‡ä»¶. å­è¿›ç¨‹å†™å®Œæ–°çš„ AOF æ–‡ä»¶å, å‘çˆ¶è¿›ç¨‹å‘ä¿¡å·, çˆ¶è¿›ç¨‹æ›´æ–°"),v("strong",[_._v("ç»Ÿè®¡ä¿¡æ¯")]),_._v(", å…·ä½“å¯ä»¥é€šè¿‡ "),v("strong",[_._v("info persistence")]),_._v(" æŸ¥çœ‹.")]),_._v(" "),v("p",[_._v("(6) çˆ¶è¿›ç¨‹æŠŠ AOF "),v("strong",[_._v("é‡å†™ç¼“å†²åŒº(aof_rewrite_buf)")]),_._v(" çš„æ•°æ®å†™å…¥åˆ°"),v("strong",[_._v("æ–°çš„")]),_._v(" AOF æ–‡ä»¶, è¿™æ ·å°±ä¿è¯äº†æ–° AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€å’ŒæœåŠ¡å™¨"),v("strong",[_._v("å½“å‰çŠ¶æ€ä¸€è‡´")]),_._v(".")]),_._v(" "),v("p",[_._v("(7) ä½¿ç”¨æ–°çš„ AOF æ–‡ä»¶"),v("strong",[_._v("æ›¿æ¢")]),_._v("è€æ–‡ä»¶, å®Œæˆ AOF é‡å†™.")]),_._v(" "),v("h6",{attrs:{id:"_4-é‡å¯åŠ è½½"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-é‡å¯åŠ è½½"}},[_._v("#")]),_._v(" (4)é‡å¯åŠ è½½")]),_._v(" "),v("p",[_._v("å½“ AOF "),v("strong",[_._v("å¼€å¯")]),_._v("æ—¶, Redis å¯åŠ¨æ—¶ä¼š"),v("strong",[_._v("ä¼˜å…ˆè½½å…¥ AOF æ–‡ä»¶")]),_._v("æ¥æ¢å¤æ•°æ®; åªæœ‰å½“ "),v("strong",[_._v("AOF å…³é—­")]),_._v("æ—¶, æ‰ä¼šè½½å…¥ "),v("strong",[_._v("RDB")]),_._v(" æ–‡ä»¶æ¢å¤æ•°æ®.")]),_._v(" "),v("p",[v("strong",[_._v("æ–‡ä»¶æ ¡éªŒæœºåˆ¶")]),_._v(": å¦‚æœ"),v("strong",[_._v("åŠ è½½æŸå")]),_._v("çš„ AOF æ–‡ä»¶æ—¶ä¼š"),v("strong",[_._v("æ‹’ç»å¯åŠ¨")]),_._v(", å¹¶æ‰“å°æ—¥å¿—. æŸåçš„ AOF æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥ä¿®å¤çš„.")]),_._v(" "),v("h4",{attrs:{id:"æ··åˆæŒä¹…åŒ–"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#æ··åˆæŒä¹…åŒ–"}},[_._v("#")]),_._v(" æ··åˆæŒä¹…åŒ–")]),_._v(" "),v("p",[_._v("é‡å¯ Redis æ—¶, å¾ˆå°‘ä½¿ç”¨ RDB æ¥æ¢å¤å†…å­˜çŠ¶æ€, å› ä¸ºä¼šä¸¢å¤±å¤§é‡æ•°æ®. é€šå¸¸ä½¿ç”¨ "),v("strong",[_._v("AOF æ—¥å¿—é‡æ”¾")]),_._v(", ä½†æ˜¯é‡æ”¾ AOF æ—¥å¿—æ€§èƒ½ç›¸å¯¹ RDB æ¥è¯´è¦"),v("strong",[_._v("æ…¢å¾ˆå¤š")]),_._v(", è¿™æ ·åœ¨ Redis å®ä¾‹å¾ˆå¤§çš„æƒ…å†µä¸‹, å¯åŠ¨éœ€è¦èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´.")]),_._v(" "),v("p",[v("strong",[_._v("Redis 4.0")]),_._v(" ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„æŒä¹…åŒ–é€‰é¡¹: "),v("strong",[_._v("æ··åˆæŒä¹…åŒ–")]),_._v(". å°† RDB æ–‡ä»¶çš„å†…å®¹å’Œå¢é‡çš„ AOF æ—¥å¿—æ–‡ä»¶"),v("strong",[_._v("å­˜åœ¨ä¸€èµ·")]),_._v(". è¿™é‡Œçš„ AOF æ—¥å¿—ä¸å†æ˜¯å…¨é‡çš„æ—¥å¿—, è€Œæ˜¯"),v("strong",[_._v("è‡ªæŒä¹…åŒ–å¼€å§‹åˆ°æŒä¹…åŒ–ç»“æŸ")]),_._v(" çš„è¿™æ®µæ—¶é—´å‘ç”Ÿçš„"),v("strong",[_._v("å¢é‡ AOF æ—¥å¿—")]),_._v(", é€šå¸¸è¿™éƒ¨åˆ† AOF æ—¥å¿—å¾ˆå°:")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220522223551618.png",alt:""}})]),_._v(" "),v("p",[_._v("äºæ˜¯åœ¨ Redis é‡å¯çš„æ—¶å€™, å¯ä»¥å…ˆåŠ è½½ RDB çš„å†…å®¹, ç„¶åå†é‡æ”¾å¢é‡ AOF æ—¥å¿—å°±å¯ä»¥å®Œå…¨æ›¿ä»£ä¹‹å‰çš„ AOF å…¨é‡æ–‡ä»¶é‡æ”¾, "),v("strong",[_._v("é‡å¯æ•ˆç‡å› æ­¤å¤§å¹…å¾—åˆ°æå‡")]),_._v(".")]),_._v(" "),v("h4",{attrs:{id:"æŒä¹…åŒ–é—®é¢˜ä¸ä¼˜åŒ–ğŸŒŸ"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#æŒä¹…åŒ–é—®é¢˜ä¸ä¼˜åŒ–ğŸŒŸ"}},[_._v("#")]),_._v(" æŒä¹…åŒ–é—®é¢˜ä¸ä¼˜åŒ–ğŸŒŸ")]),_._v(" "),v("p",[_._v("æŒä¹…åŒ–é˜»å¡ä¸»çº¿ç¨‹åœºæ™¯ä¸»è¦æœ‰: "),v("strong",[_._v("fork é˜»å¡å’Œ AOF è¿½åŠ é˜»å¡")]),_._v(". "),v("strong",[_._v("fork é˜»å¡æ—¶é—´è·Ÿå†…å­˜é‡å’Œç³»ç»Ÿæœ‰å…³, AOF è¿½åŠ é˜»å¡è¯´æ˜ç³»ç»Ÿç¡¬ç›˜èµ„æºç´§å¼ .")])]),_._v(" "),v("h5",{attrs:{id:"_1-forkæ“ä½œ"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-forkæ“ä½œ"}},[_._v("#")]),_._v(" 1.forkæ“ä½œ")]),_._v(" "),v("p",[_._v("å½“ Redis åš RDB æˆ– AOF é‡å†™æ—¶, å¿…ä¸å¯å°‘çš„æ“ä½œå°±æ˜¯æ‰§è¡Œ "),v("strong",[_._v("fork ç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºå­è¿›ç¨‹")]),_._v(", ä½†è¿™æ˜¯ä¸€ä¸ª"),v("strong",[_._v("é‡é‡çº§æ“ä½œ")]),_._v(". è™½ç„¶ fork åˆ›å»ºçš„å­è¿›ç¨‹ä¸éœ€è¦æ‹·è´çˆ¶è¿›ç¨‹çš„ç‰©ç†ç©ºé—´, ä½†æ˜¯ä¼š"),v("strong",[_._v("å¤åˆ¶çˆ¶è¿›ç¨‹çš„ç©ºé—´å†…å­˜é¡µè¡¨")]),_._v("(é¡µè¡¨ç›¸å½“äºå†…å­˜çš„ç´¢å¼•, ç›®å½•). æ‰€ä»¥ fork æ“ä½œè€—æ—¶ä¸"),v("strong",[_._v("è¿›ç¨‹æ€»å†…å­˜é‡")]),_._v("æ¯æ¯ç›¸å…³. "),v("strong",[_._v("çˆ¶è¿›ç¨‹")]),_._v("çš„æ•°æ®ç©ºé—´è¶Šå¤§, å†…å­˜é¡µè¡¨è¶Šå¤§, fork æ—¶å¤åˆ¶"),v("strong",[_._v("è€—æ—¶ä¹Ÿä¼šè¶Šå¤š")]),_._v(".")]),_._v(" "),v("blockquote",[v("p",[_._v("å¦‚ä½•æ”¹å–„ fork æ“ä½œçš„è€—æ—¶?")])]),_._v(" "),v("ul",[v("li",[_._v("æ§åˆ¶ Redis å®ä¾‹"),v("strong",[_._v("æœ€å¤§å¯ç”¨å†…å­˜")]),_._v(", fork è€—æ—¶ä¸å†…å­˜é‡æˆæ­£æ¯”. çº¿ä¸Šå»ºè®®ä¸€ä¸ª Redis å®ä¾‹å†…å­˜æ§åˆ¶åœ¨ 10GB ä¹‹å†….")]),_._v(" "),v("li",[_._v("åˆç†é…ç½® Linux å†…å­˜åˆ†é…ç­–ç•¥, é¿å…"),v("strong",[_._v("ç‰©ç†å†…å­˜ä¸è¶³")]),_._v("å¯¼è‡´ fork å¤±è´¥.")]),_._v(" "),v("li",[_._v("é™ä½ fork æ“ä½œé¢‘ç‡, å¦‚å¯ç”¨é€‚å½“æ”¾å®½ AOF è‡ªåŠ¨è§¦å‘æ—¶æœº.")])]),_._v(" "),v("h5",{attrs:{id:"_2-å­è¿›ç¨‹å¼€é”€"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-å­è¿›ç¨‹å¼€é”€"}},[_._v("#")]),_._v(" 2.å­è¿›ç¨‹å¼€é”€")]),_._v(" "),v("p",[_._v("éœ€è¦é‡ç‚¹å…³æ³¨.")]),_._v(" "),v("ul",[v("li",[_._v("CPU: å°½é‡ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œ.")]),_._v(" "),v("li",[_._v("å†…å­˜: é¿å…åœ¨å¤§é‡å†™å…¥æ—¶åšå­è¿›ç¨‹"),v("strong",[_._v("é‡å†™")]),_._v("æ“ä½œ, è¿™æ ·å°†å¯¼è‡´çˆ¶è¿›ç¨‹ç»´æŠ¤å¤§é‡é¡µå‰¯æœ¬, é€ æˆå†…å­˜æ¶ˆè€—.")]),_._v(" "),v("li",[_._v("ç¡¬ç›˜: ä¸è¦å’Œå…¶ä»–é«˜ç¡¬ç›˜è´Ÿè½½çš„æœåŠ¡éƒ¨ç½²åˆ°ä¸€èµ·, å¦‚å­˜å‚¨æœåŠ¡, æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ç­‰.")])]),_._v(" "),v("h5",{attrs:{id:"_3-aofè¿½åŠ é˜»å¡"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-aofè¿½åŠ é˜»å¡"}},[_._v("#")]),_._v(" 3.AOFè¿½åŠ é˜»å¡")]),_._v(" "),v("p",[_._v("AOF æŒä¹…åŒ–æ—¶ "),v("strong",[_._v("everysec")]),_._v(" æ˜¯å¸¸ç”¨çš„åŒæ­¥ç¡¬ç›˜ç­–ç•¥. Redis ä½¿ç”¨"),v("strong",[_._v("å¦ä¸€æ¡çº¿ç¨‹æ¯ç§’æ‰§è¡Œ fsync åŒæ­¥ç¡¬ç›˜")]),_._v(". å½“ç³»ç»Ÿèµ„æº"),v("strong",[_._v("ç¹å¿™")]),_._v("æ—¶, ä¼šé€ æˆ Redis "),v("strong",[_._v("ä¸»çº¿ç¨‹é˜»å¡")]),_._v(".")]),_._v(" "),v("p",[_._v("æ³¨æ„: "),v("strong",[_._v("everysec")]),_._v(" é…ç½®"),v("strong",[_._v("æœ€å¤šå¯èƒ½ä¸¢å¤± 2 ç§’")]),_._v("å†…çš„æ•°æ®, ä¸æ˜¯ 1 ç§’. å¦‚æœç³»ç»Ÿ fsync ç¼“æ…¢, å°†ä¼šå¯¼è‡´ Redis çº¿ç¨‹é˜»å¡å½±å“æ•ˆç‡.")]),_._v(" "),v("p",[_._v("â€")]),_._v(" "),v("p",[_._v("â€")]),_._v(" "),v("h4",{attrs:{id:"å‚è€ƒèµ„æ–™"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒèµ„æ–™"}},[_._v("#")]),_._v(" å‚è€ƒèµ„æ–™")]),_._v(" "),v("ul",[v("li",[_._v("ã€ŠRediså¼€å‘ä¸è¿ç»´ã€‹")])])])}),[],!1,null,null,null);v.default=r.exports}}]);