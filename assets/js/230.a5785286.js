(window.webpackJsonp=window.webpackJsonp||[]).push([[230],{534:function(t,a,e){"use strict";e.r(a);var s=e(7),_=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_11-口算c端服务权限校验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-口算c端服务权限校验"}},[t._v("#")]),t._v(" 11.口算C端服务权限校验")]),t._v(" "),a("p",[t._v("口算服务端的权限校验主要由 fenbi-auth, leo-auth, solar-encoder 组成。"),a("mark",[a("strong",[t._v("其中 fenbi-auth 校验ytkUserId, leo-auth 校验deviceId, solar-encoder 校验签名")])]),t._v("。可以单独使用也可以进行组合使用。")]),t._v(" "),a("h4",{attrs:{id:"fenbi-auth"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fenbi-auth"}},[t._v("#")]),t._v(" fenbi-auth")]),t._v(" "),a("h5",{attrs:{id:"_1-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置"}},[t._v("#")]),t._v(" 1.配置")]),t._v(" "),a("p",[t._v("使用 fenbi-auth 需要引入 fenbi-auth-common 并在 application.yaml 中的 authFilter 进行 appKey、escapePatterns、authPatterns、bypassPatterns 配置。")]),t._v(" "),a("p",[t._v("escapePatterns 表示不需要进行权限校验 urls.")]),t._v(" "),a("p",[t._v("authPatterns 表示必须进行权限的 urls。escapePatterns 与 authPatterns不能同时配置，也不能都不配置。配置 escapePatterns 表示，escapePatterns 中的 urls 无需校验，其他 urls 均需要校验。")]),t._v(" "),a("p",[t._v("配置了 authPatterns 表示，authPatterns 中的 urls 需要权限校验，其他 urls 均无需校验。一般都是设置 escapePatterns。")]),t._v(" "),a("p",[a("strong",[t._v("bypassPattern 表示配置的 urls，不管 auth 校验成功或者失败均让通过")]),t._v("。bypass 验证成功会把相应的 id 写到 http 的 attr 里，后端可以在 http 中直接读取。")]),t._v(" "),a("p",[t._v("在 fenbi-auth 中 escapePatterns 与 bypassPattern 组合使用。authPatterns 与 bypassPattern 组合使用.")]),t._v(" "),a("h5",{attrs:{id:"_2-校验流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-校验流程"}},[t._v("#")]),t._v(" 2.校验流程")]),t._v(" "),a("p",[t._v("取 cookie 中的 "),a("strong",[t._v("sess，persistent，userid")]),t._v(" 进行权限校验.")]),t._v(" "),a("p",[t._v("​"),a("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/AuthFilter-20250101204150-haju5jd.png",alt:""}}),t._v("​")]),t._v(" "),a("h4",{attrs:{id:"leo-auth"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#leo-auth"}},[t._v("#")]),t._v(" leo-auth")]),t._v(" "),a("h5",{attrs:{id:"_1-配置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置-2"}},[t._v("#")]),t._v(" 1.配置")]),t._v(" "),a("p",[t._v("使用 leo-auth 需要引入 leo-auth-client 并在 application.yaml 中的 leoAuthFilter 进行 escapePatterns、bypassPatterns 配置。")]),t._v(" "),a("p",[t._v("escapePatterns 表示不需要进行权限校验 urls.")]),t._v(" "),a("p",[t._v("bypassPattern 表示配置的 urls，不管 aut h校验成功或者失败均让通过，但是会进行 cookie 校验，并写入 cookie。bypass 验证成功会把相应的 id 写到 http 的 attr 里，后端可以在 http 中直接读取。")]),t._v(" "),a("p",[t._v("主要验证 deviceid 与 ip，cookie 有效期 1 天.")]),t._v(" "),a("h5",{attrs:{id:"_2-流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-流程"}},[t._v("#")]),t._v(" 2.流程")]),t._v(" "),a("p",[t._v("取 cookie 中的 ks_sess、ks_deviceid 进行校验。")]),t._v(" "),a("p",[t._v("首先取 ks_sess 进行解密，校验 deviceId（ks_deviceid）、ip、过期时间，校验成功写入 "),a("code",[t._v("_ks_deviceid_")]),t._v("​。")]),t._v(" "),a("p",[t._v("如果校验失败，走 febi-auth 校验流程图中的第三部分的 bypass 校验流程。")]),t._v(" "),a("h4",{attrs:{id:"solar-encoder"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#solar-encoder"}},[t._v("#")]),t._v(" solar-encoder")]),t._v(" "),a("p",[t._v("用于 app 中的接口进行权限校验。")]),t._v(" "),a("h5",{attrs:{id:"_1-配置-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置-3"}},[t._v("#")]),t._v(" 1.配置")]),t._v(" "),a("p",[t._v("使用 solar-encoder 需要引入 solar-encoder-common。并在 application.ymal 中 signFilter 中进行 escapePatterns 配置。")]),t._v(" "),a("p",[t._v("escapePatterns 表示不需要进行权限校验 urls。")]),t._v(" "),a("p",[t._v("示例：")]),t._v(" "),a("p",[t._v("​"),a("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_04bee2f2-c1df-4f01-8eef-cd37a2f8b628-20250101204150-f62misd.png",alt:""}}),t._v("​")]),t._v(" "),a("h5",{attrs:{id:"_2-流程-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-流程-2"}},[t._v("#")]),t._v(" 2.流程")]),t._v(" "),a("p",[a("strong",[t._v("取请求参数中的 sign、version(客户端版本号)、av（api版本号）进行校验")]),t._v("。")]),t._v(" "),a("p",[t._v("对 sign 进行"),a("strong",[t._v("验签")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),a("p",[t._v("在一些情况下需要引入权限校验的包，但是不需要权限校验，这个时候需要设置 enabled: false，否则会出现权限校验错误。")]),t._v(" "),a("p",[t._v("例如：需要 solar-encoder 中的加解密包，但是又不需要进行签名校验，就需要设置 signFilter.enabled: false.")]),t._v(" "),a("blockquote",[a("p",[t._v("测试环境跳过权限校验")])]),t._v(" "),a("ul",[a("li",[t._v("fenbi-auth：url 请求路径上添加 "),a("code",[t._v("__debug_user__")]),t._v("​ 参数，"),a("code",[t._v("__debug_user__=41323186")]),t._v("​.")]),t._v(" "),a("li",[t._v("leo-auth：url 请求路径上添加 "),a("code",[t._v("__debug_ytk_user__")]),t._v("​ 参数，"),a("code",[t._v("__debug_ytk_user__=17726357")]),t._v("​.")]),t._v(" "),a("li",[t._v("solar-encode：url 请求路径上添加 sign 参数，"),a("code",[t._v("sign=xysttest")]),t._v("​.")])]),t._v(" "),a("p",[t._v("‍")])])}),[],!1,null,null,null);a.default=_.exports}}]);