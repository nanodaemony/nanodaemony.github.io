(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{621:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_30-linuxæ€§èƒ½ä¼˜åŒ–å®æˆ˜-æå®¢æ—¶é—´-ğŸŒ¸"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_30-linuxæ€§èƒ½ä¼˜åŒ–å®æˆ˜-æå®¢æ—¶é—´-ğŸŒ¸"}},[s._v("#")]),s._v(" 30.Linuxæ€§èƒ½ä¼˜åŒ–å®æˆ˜(æå®¢æ—¶é—´)ğŸŒ¸")]),s._v(" "),a("h3",{attrs:{id:"å¼€ç¯‡è¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¼€ç¯‡è¯"}},[s._v("#")]),s._v(" å¼€ç¯‡è¯")]),s._v(" "),a("h4",{attrs:{id:"å¼€ç¯‡è¯-åˆ«å†è®©linuxæ€§èƒ½é—®é¢˜æˆä¸ºä½ çš„ç»Šè„šçŸ³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¼€ç¯‡è¯-åˆ«å†è®©linuxæ€§èƒ½é—®é¢˜æˆä¸ºä½ çš„ç»Šè„šçŸ³"}},[s._v("#")]),s._v(" å¼€ç¯‡è¯-åˆ«å†è®©Linuxæ€§èƒ½é—®é¢˜æˆä¸ºä½ çš„ç»Šè„šçŸ³")]),s._v(" "),a("p",[s._v("ä½ å¥½, æˆ‘æ˜¯å€ªæœ‹é£, å¾®è½¯ Azure çš„èµ„æ·±å·¥ç¨‹å¸ˆ, åŒæ—¶ä¹Ÿæ˜¯ Kubernetes é¡¹ç›®ç»´æŠ¤è€…, ä¸»è¦è´Ÿè´£å¼€æºå®¹å™¨ç¼–æ’ç³»ç»Ÿ Kubernetes åœ¨ Azure çš„è½åœ°å®è·µ.")]),s._v(" "),a("p",[s._v('ä¸€ç›´ä»¥æ¥, æˆ‘éƒ½åœ¨äº‘è®¡ç®—é¢†åŸŸå·¥ä½œ. å¯¹äºæœåŠ¡å™¨æ€§èƒ½çš„å…³æ³¨, å¯ä»¥è¿½æº¯åˆ°æˆ‘åˆšå‚åŠ å·¥ä½œé‚£ä¼šå„¿. ä¸ºä»€ä¹ˆé‚£ä¹ˆæ—©å°±å¼€å§‹æ¢ç´¢æ€§èƒ½é—®é¢˜å‘¢? å…¶å®æ˜¯æºäºä¸€æ¬¡æˆ‘æ°¸è¿œéƒ½å¿˜ä¸äº†çš„"äº‹æ•…". é‚£ä¼šå„¿æˆ‘åœ¨ç››å¤§äº‘å·¥ä½œ, å¿™æ´»äº†å¤§åŠå¤œæŠŠäº§å“å‘å¸ƒä¸Šçº¿å, åˆšåˆšèººä¸‹æ‰“ç®—ä¼‘æ¯, å´çªç„¶æ”¶åˆ°å¤§é‡çš„å‘Šè­¦. åŒ†å¿™çˆ¬èµ·æ¥ç™»å½•åˆ°æœåŠ¡å™¨ä¹‹å, æˆ‘å‘ç°æœ‰ä¸€äº›ç³»ç»Ÿè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡é«˜è¾¾ 100%. å½“æ—¶æˆ‘å®Œå…¨æ˜¯ä¸¤çœ¼ä¸€æŠ¹é»‘, å¯ä»¥è¯´æ˜¯åªèƒ½çœ‹åˆ°ç—‡çŠ¶, å´å®Œå…¨ä¸çŸ¥é“è¯¥ä»å“ªå„¿ä¸‹æ‰‹å»æ’æŸ¥å’Œè§£å†³å®ƒ. ç›´åˆ°æœ€å, æˆ‘ä¹Ÿæ²¡èƒ½æƒ³åˆ°å¥½åŠæ³•, è¿™æ¬¡å‘å¸ƒä¹Ÿæˆäº†æˆ‘å¿ƒä¸­ä¹‹ç—›.')]),s._v(" "),a("p",[s._v("ä»é‚£ä¹‹å, æˆ‘å¼€å§‹åˆ°å¤„æŸ¥çœ‹å„ç§ç›¸å…³ä¹¦ç±, ä»æ“ä½œç³»ç»ŸåŸç†, åˆ° Linux å†…æ ¸, å†åˆ°ç¡¬ä»¶é©±åŠ¨ç¨‹åºç­‰ç­‰. å¯æ˜¯, å­¦äº†é‚£ä¹ˆå¤šçŸ¥è¯†ä¹‹å, æˆ‘è¿˜æ˜¯ä¸èƒ½å¾ˆå¿«è§£å†³ç±»ä¼¼çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("äºæ˜¯, æˆ‘åˆé€šè¿‡ç½‘ç»œæœç´¢, æˆ–è€…è¯·æ•™å…¬å¸çš„æŠ€æœ¯å¤§æ‹¿, å­¦ä¹ äº†å¤§é‡æ€§èƒ½ä¼˜åŒ–çš„æ€è·¯å’Œæ–¹æ³•, è¿™æœŸé—´å°è¯•äº†å¤§é‡çš„ Linux æ€§èƒ½å·¥å…·. åœ¨ä¸æ–­çš„å®è·µå’Œæ€»ç»“å, æˆ‘ç»ˆäºçŸ¥é“, æ€ä¹ˆ**æŠŠè§‚å¯Ÿåˆ°çš„æ€§èƒ½é—®é¢˜è·Ÿç³»ç»ŸåŸç†å…³è”èµ·æ¥, ç‰¹åˆ«æ˜¯æŠŠç³»ç»Ÿä»åº”ç”¨ç¨‹åº, åº“å‡½æ•°, ç³»ç»Ÿè°ƒç”¨, å†åˆ°å†…æ ¸å’Œç¡¬ä»¶ç­‰ä¸åŒçš„å±‚çº§è´¯ç©¿èµ·æ¥. **")]),s._v(" "),a("p",[s._v('è¿™æ®µå­¦ä¹ å¯ä»¥ç®—å¾—ä¸Šæ˜¯æˆ‘çš„"é»‘æš—"ç»å†äº†. æˆ‘æƒ³å¾ˆå¤šäººåº”è¯¥éƒ½æœ‰è¿‡è¿™æ ·çš„æŒ«æŠ˜. æ¯”å¦‚:')]),s._v(" "),a("ul",[a("li",[s._v("æµé‡é«˜å³°æœŸ, æœåŠ¡å™¨ CPU ä½¿ç”¨ç‡è¿‡é«˜æŠ¥è­¦, ä½ ç™»å½• Linux ä¸Šå» top å®Œä¹‹å, å´ä¸çŸ¥é“æ€ä¹ˆè¿›ä¸€æ­¥å®šä½, åˆ°åº•æ˜¯ç³»ç»Ÿ CPU èµ„æºå¤ªå°‘, è¿˜æ˜¯ç¨‹åºå¹¶å‘éƒ¨åˆ†å†™çš„æœ‰é—®é¢˜?")]),s._v(" "),a("li",[s._v("ç³»ç»Ÿå¹¶æ²¡æœ‰è·‘ä»€ä¹ˆåƒå†…å­˜çš„ç¨‹åº, ä½†æ˜¯æ•²å®Œ free å‘½ä»¤ä¹‹å, å´å‘ç°ç³»ç»Ÿå·²ç»æ²¡æœ‰ä»€ä¹ˆå†…å­˜äº†, é‚£åˆ°åº•æ˜¯å“ªé‡Œå ç”¨äº†å†…å­˜? ä¸ºä»€ä¹ˆ?")]),s._v(" "),a("li",[s._v("ä¸€å¤§æ—©å°±æ”¶åˆ° Zabbix å‘Šè­¦, ä½ å‘ç°æŸå°å­˜æ”¾ç›‘æ§æ•°æ®çš„æ•°æ®åº“ä¸»æœºçš„ iowait è¾ƒé«˜, è¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠ?")])]),s._v(" "),a("p",[s._v("è¿™äº›é—®é¢˜æˆ–è€…åœºæ™¯, ä½ è‚¯å®šæˆ–å¤šæˆ–å°‘éƒ½é‡åˆ°è¿‡.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, "),a("strong",[s._v('æ€§èƒ½ä¼˜åŒ–ä¸€ç›´éƒ½æ˜¯å¤§å¤šæ•°è½¯ä»¶å·¥ç¨‹å¸ˆå¤´ä¸Šçš„"ç´§ç®å’’"')]),s._v(" , ç”šè‡³è®¸å¤šå·¥ä½œå¤šå¹´çš„èµ„æ·±å·¥ç¨‹å¸ˆ, ä¹Ÿæ— æ³•å‡†ç¡®åœ°åˆ†æå‡ºçº¿ä¸Šçš„å¾ˆå¤šæ€§èƒ½é—®é¢˜. æ€§èƒ½é—®é¢˜ä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾å‘¢? æˆ‘è§‰å¾—ä¸»è¦æ˜¯å› ä¸ºæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸ª"),a("strong",[s._v("ç³»ç»Ÿå·¥ç¨‹")]),s._v(", æ€»æ˜¯ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«. å®ƒæ¶‰åŠäº†ä»ç¨‹åºè®¾è®¡, ç®—æ³•åˆ†æ, ç¼–ç¨‹è¯­è¨€, å†åˆ°ç³»ç»Ÿ, å­˜å‚¨, ç½‘ç»œç­‰å„ç§åº•å±‚åŸºç¡€è®¾æ–½çš„æ–¹æ–¹é¢é¢. æ¯ä¸€ä¸ªç»„ä»¶éƒ½æœ‰å¯èƒ½å‡ºé—®é¢˜, è€Œä¸”å¾ˆæœ‰å¯èƒ½å¤šä¸ªç»„ä»¶åŒæ—¶å‡ºé—®é¢˜.")]),s._v(" "),a("p",[s._v("æ¯«æ— ç–‘é—®, æ€§èƒ½ä¼˜åŒ–æ˜¯è½¯ä»¶ç³»ç»Ÿä¸­æœ€æœ‰æŒ‘æˆ˜çš„å·¥ä½œä¹‹ä¸€, ä½†æ˜¯æ¢ä¸ªè§’åº¦çœ‹, "),a("strong",[s._v("å®ƒä¹Ÿæ˜¯æœ€è€ƒéªŒä½“ç°ä½ ç»¼åˆèƒ½åŠ›çš„å·¥ä½œä¹‹ä¸€")]),s._v(". å¦‚æœè¯´ä½ èƒ½æŠŠæ€§èƒ½ä¼˜åŒ–çš„å„ä¸ªå…³é”®ç‚¹åƒé€, é‚£æˆ‘å¯ä»¥è‚¯å®šåœ°è¯´, ä½ å·²ç»æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„è½¯ä»¶å·¥ç¨‹å¸ˆäº†.")]),s._v(" "),a("p",[s._v("é‚£æ€æ ·æ‰èƒ½æŒæ¡è¿™ä¸ªæŠ€èƒ½å‘¢? ä½ å¯ä»¥åƒæˆ‘å‰é¢è¯´çš„é‚£æ ·, èŠ±å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›å»é’»ç ”, ä»å†…åŠŸåˆ°å®æˆ˜ä¸€ä¸€è‹¦ç»ƒ. å½“ç„¶, é‚£æ ·å¯è¡Œ, ä½†ä¹Ÿä¼šèµ°å¾ˆå¤šå¼¯è·¯, è€Œä¸”å¯èƒ½ä½ å•ƒäº†å¾ˆå¤šå¤§å—å¤´çš„ä¹¦, ç»ˆäºæ‹¿ä¸‹äº†æœ€éš¾çš„åº•å±‚ä½“ç³», å´å› ä¸ºç¼ºä¹å®æˆ˜ç»éªŒ, åœ¨å®é™…å¼€å‘å·¥ä½œä¸­ä»ç„¶æ²¡æœ‰å¤´ç»ª.")]),s._v(" "),a("p",[s._v("å…¶å®, å¯¹äºå¤§å¤šæ•°äººæ¥è¯´, "),a("strong",[s._v("æœ€å¥½çš„å­¦ä¹ æ–¹å¼ä¸€å®šæ˜¯å¸¦ç€é—®é¢˜å­¦ä¹ ")]),s._v(", è€Œä¸æ˜¯å…ˆå»å•ƒé‚£å‡ æœ¬åšåšçš„åŸç†ä¹¦ç±, è¿™æ ·å¾ˆå®¹æ˜“æŠŠè‡ªå·±çš„ä¿¡å¿ƒå‹å®.")]),s._v(" "),a("p",[s._v("æˆ‘è®¤ä¸º, "),a("strong",[s._v("å­¦ä¹ è¦ä¼šæŠ“é‡ç‚¹")]),s._v(". å…¶å®åªè¦ä½ äº†è§£å°‘æ•°å‡ ä¸ªç³»ç»Ÿç»„ä»¶çš„åŸºæœ¬åŸç†å’Œåä½œæ–¹å¼, æŒæ¡åŸºæœ¬çš„æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·, å­¦ä¼šå®é™…å·¥ä½œä¸­æ€§èƒ½ä¼˜åŒ–çš„å¸¸ç”¨æŠ€å·§, å°±å·²ç»å¯ä»¥å‡†ç¡®åˆ†æå’Œä¼˜åŒ–å¤§å¤šæ•°çš„æ€§èƒ½é—®é¢˜äº†. åœ¨è¿™ä¸ªè®¤çŸ¥çš„åŸºç¡€ä¸Š, å†åè¿‡æ¥å»é˜…è¯»é‚£äº›ç»å…¸çš„æ“ä½œç³»ç»Ÿæˆ–è€…å…¶å®ƒå›¾ä¹¦, ä½ æ‰èƒ½äº‹åŠåŠŸå€.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥åœ¨è¿™ä¸ªä¸“æ é‡Œ, æˆ‘ä¼šä»¥"),a("strong",[s._v("æ¡ˆä¾‹é©±åŠ¨")]),s._v("çš„æ€è·¯, ç»™ä½ è®²è§£ Linux æ€§èƒ½çš„åŸºæœ¬æŒ‡æ ‡, å·¥å…·, ä»¥åŠç›¸åº”çš„è§‚æµ‹, åˆ†æå’Œè°ƒä¼˜æ–¹æ³•.")]),s._v(" "),a("p",[s._v("å…·ä½“æ¥çœ‹, æˆ‘ä¼šåˆ†ä¸º 5 ä¸ªæ¨¡å—. å‰ 4 ä¸ªæ¨¡å—ä¼šä»èµ„æºä½¿ç”¨çš„è§†è§’å‡ºå‘, åˆ†æå„ç§ Linux èµ„æºå¯èƒ½ä¼šç¢°åˆ°çš„æ€§èƒ½é—®é¢˜, åŒ…æ‹¬ "),a("strong",[s._v("CPU æ€§èƒ½")]),s._v(", "),a("strong",[s._v("ç£ç›˜ I/O æ€§èƒ½")]),s._v(", "),a("strong",[s._v("å†…å­˜æ€§èƒ½")]),s._v("ä»¥åŠ"),a("strong",[s._v("ç½‘ç»œæ€§èƒ½")]),s._v(". æ¯ä¸ªæ¨¡å—è¿˜ç”±æµ…å…¥æ·±åˆ’åˆ†ä¸ºå››ä¸ªä¸åŒçš„ç¯‡ç« .")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("åŸºç¡€ç¯‡")]),s._v(", ä»‹ç» Linux å¿…å¤‡çš„åŸºæœ¬åŸç†ä»¥åŠå¯¹åº”çš„æ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½å·¥å…·. æ¯”å¦‚æ€ä¹ˆç†è§£å¹³å‡è´Ÿè½½, æ€ä¹ˆç†è§£ä¸Šä¸‹æ–‡åˆ‡æ¢, Linux å†…å­˜çš„å·¥ä½œåŸç†ç­‰ç­‰.")]),s._v(" "),a("li",[a("strong",[s._v("æ¡ˆä¾‹ç¯‡")]),s._v(", è¿™é‡Œé€šè¿‡æ¨¡æ‹Ÿæ¡ˆä¾‹, å¸®ä½ åˆ†æé«˜æ‰‹åœ¨é‡åˆ°èµ„æºç“¶é¢ˆæ—¶, æ˜¯å¦‚ä½•è§‚æµ‹, å®šä½, åˆ†æå¹¶ä¼˜åŒ–è¿™äº›æ€§èƒ½é—®é¢˜çš„.")]),s._v(" "),a("li",[a("strong",[s._v("å¥—è·¯ç¯‡")]),s._v(", åœ¨ç†è§£äº†åŸºç¡€, äº²èº«ä½“éªŒäº†æ¨¡æ‹Ÿæ¡ˆä¾‹ä¹‹å, æˆ‘ä¼šå¸®ä½ æ¢³ç†å‡ºæ’æŸ¥é—®é¢˜çš„æ•´ä½“æ€è·¯, ä¹Ÿå°±æ˜¯æ£€æŸ¥æ€§èƒ½é—®é¢˜çš„ä¸€èˆ¬æ­¥éª¤, è¿™æ ·ä»¥åä½ é‡åˆ°é—®é¢˜, å°±å¯ä»¥æŒ‰ç…§è¿™æ ·çš„è·¯å­æ¥.")]),s._v(" "),a("li",[a("strong",[s._v("ç­”ç–‘ç¯‡")]),s._v(", æˆ‘ç›¸ä¿¡åœ¨å­¦ä¹ å®Œæ¯ä¸€ä¸ªæ¨¡å—ä¹‹å, ä½ éƒ½ä¼šæœ‰å¾ˆå¤šçš„é—®é¢˜, åœ¨ç­”ç–‘ç¯‡é‡Œ, æˆ‘ä¼šæ‹¿å‡ºæé—®é¢‘æ¬¡è¾ƒé«˜çš„é—®é¢˜ç»™ä½ ç³»ç»Ÿè§£ç­”.")])]),s._v(" "),a("p",[s._v('ç¬¬ 5 ä¸ªç»¼åˆå®æˆ˜æ¨¡å—, æˆ‘å°†ä¸ºä½ è¿˜åŸçœŸå®çš„å·¥ä½œåœºæ™¯, æ‰‹æŠŠæ‰‹å¸¦ä½ åœ¨"'),a("strong",[s._v("é«˜çº§æˆ˜åœº")]),s._v('"ä¸­æ¼”ç»ƒ, è¿™æ ·ä½ èƒ½æŠŠå‰é¢å­¦åˆ°çš„æ‰€æœ‰çŸ¥è¯†èä¼šè´¯é€š, å¹¶ä¸”çœ‹å®Œä¸“æ , é©¬ä¸Šå°±èƒ½ç”¨åœ¨å·¥ä½œä¸­. "æƒ³è¦å¾—åˆ°ä½ å°±è¦å­¦ä¼šä»˜å‡º, è¦ä»˜å‡ºè¿˜è¦åšæŒ; å¦‚æœä½ çœŸçš„è§‰å¾—å¾ˆéš¾, é‚£ä½ å°±æ”¾å¼ƒ, å¦‚æœä½ æ”¾å¼ƒäº†å°±ä¸è¦æŠ±æ€¨. äººç”Ÿå°±æ˜¯è¿™æ ·, ä¸–ç•Œæ˜¯å¹³è¡¡çš„, æ¯ä¸ªäººéƒ½æ˜¯é€šè¿‡è‡ªå·±çš„åŠªåŠ›, å»å†³å®šè‡ªå·±ç”Ÿæ´»çš„æ ·å­."')]),s._v(" "),a("h4",{attrs:{id:"_01-å¦‚ä½•å­¦ä¹ linuxæ€§èƒ½ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_01-å¦‚ä½•å­¦ä¹ linuxæ€§èƒ½ä¼˜åŒ–"}},[s._v("#")]),s._v(" 01-å¦‚ä½•å­¦ä¹ Linuxæ€§èƒ½ä¼˜åŒ–?")]),s._v(" "),a("p",[s._v("ä½ æ˜¯å¦ä¹Ÿæ›¾è·Ÿæˆ‘ä¸€æ ·, çœ‹äº†å¾ˆå¤šä¹¦, å­¦äº†å¾ˆå¤š Linux æ€§èƒ½å·¥å…·, ä½†åœ¨é¢å¯¹ Linux æ€§èƒ½é—®é¢˜æ—¶, è¿˜æ˜¯æŸæ‰‹æ— ç­–? å®é™…ä¸Š, æ€§èƒ½åˆ†æå’Œä¼˜åŒ–å§‹ç»ˆæ˜¯å¤§å¤šæ•°è½¯ä»¶å·¥ç¨‹å¸ˆçš„ä¸€ä¸ªç—›ç‚¹. ä½†é¢å¯¹éš¾é¢˜, æˆ‘ä»¬çœŸçš„å°±æ— è§£äº†å—?")]),s._v(" "),a("p",[s._v('åœ¨æˆ‘çœ‹æ¥, å¤§å¤šæ•°äººå¯¹æ€§èƒ½é—®é¢˜"æŠ•é™", åŸå› å¯èƒ½åªæœ‰ä¸¤ä¸ª. ä¸€ä¸ªæ˜¯ä½ '),a("strong",[s._v("æ²¡æ‰¾åˆ°æœ‰æ•ˆçš„æ–¹æ³•å­¦åŸç†")]),s._v(', ä¸€å¬åˆ°"ç³»ç»Ÿ", "åº•å±‚"è¿™äº›è¯å°±å‘æ€µ, è§‰å¾—ä¸œè¥¿å¤ªéš¾, è‡ªå·±ä¸€å®šå­¦ä¸ä¼š, è‡ªç„¶ä¹Ÿå°±æ— æ³•æ·±å…¥å­¦ä¸‹å», ä»è€Œ'),a("strong",[s._v("ä¸èƒ½å»ºç«‹èµ·æ€§èƒ½çš„å…¨å±€è§‚")]),s._v(". å†ä¸€ä¸ªå°±æ˜¯, ä½ çœ‹åˆ°æ€§èƒ½é—®é¢˜çš„æ ¹æºå¤ªå¤æ‚, æ—¢ä¸æ‡‚æ€ä¹ˆå»åˆ†æ, ä¹Ÿä¸èƒ½æŠ½ä¸å‰¥èŒ§æ‰¾åˆ°ç“¶é¢ˆ. ä½ å¯èƒ½ä¼šæƒ³, åæ­£ç¨‹åºå‡ºäº†é—®é¢˜, ä¸Šç½‘æŸ¥å°±æ˜¯äº†, ç”¨åˆ«äººçš„æ–¹æ³•, å›«å›µåæ£åœ°å¤šè¯•å‡ æ¬¡, æœ‰å¯èƒ½å°±è§£å†³äº†. äºæ˜¯, ä½ æ‡’å¾—æ·±ç©¶è¿™äº›æ–¹æ³•ä¸ºå•¥æœ‰æ•ˆ, æ›´ä¸çŸ¥é“ä¸ºä»€ä¹ˆ, å¾ˆå¤šæ–¹æ³•åœ¨åˆ«äººçš„ç¯å¢ƒæœ‰æ•ˆ, åˆ°ä½ è¿™å„¿å°±ä¸è¡Œäº†.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ç›¸åŒçš„é”™è¯¯é‡å¤åœ¨çŠ¯, ç›¸åŒçš„çŠ¶å†µä¹Ÿæ˜¯é‡å¤å‡ºç°.")]),s._v(" "),a("p",[s._v("å…¶å®, æ€§èƒ½é—®é¢˜å¹¶æ²¡æœ‰ä½ æƒ³åƒå¾—é‚£ä¹ˆéš¾, "),a("strong",[s._v("åªè¦ç†è§£äº†åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„å°‘æ•°å‡ ä¸ªåŸºæœ¬åŸç†, å†è¿›è¡Œå¤§é‡çš„å®æˆ˜ç»ƒä¹ , å»ºç«‹èµ·æ•´ä½“æ€§èƒ½çš„å…¨å±€è§‚")]),s._v(", å¤§å¤šæ•°æ€§èƒ½é—®é¢˜çš„ä¼˜åŒ–å°±ä¼šæ°´åˆ°æ¸ æˆ. å¾ˆå¤šå·¥ç¨‹å¸ˆåœ¨åˆ†æåº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶çš„æ€§èƒ½æ—¶, å¹¶ä¸ç†Ÿæ‚‰è¿™äº›ç»„ä»¶æ‰€ç”¨çš„ç¼–ç¨‹è¯­è¨€, å´ä¾ç„¶å¯ä»¥åˆ†æå‡ºçº¿ä¸Šé—®é¢˜çš„æ ¹æº, å¹¶èƒ½é€šè¿‡ä¸€äº›æ–¹æ³•è¿›è¡Œä¼˜åŒ–, æ¯”å¦‚ä¿®æ”¹åº”ç”¨ç¨‹åºå¯¹å®ƒä»¬çš„è°ƒç”¨é€»è¾‘, æˆ–è€…è°ƒæ•´ç»„ä»¶çš„é…ç½®é€‰é¡¹ç­‰.")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯é‚£å¥è¯, "),a("strong",[s._v("ä½ ä¸éœ€è¦äº†è§£æ¯ä¸ªç»„ä»¶çš„æ‰€æœ‰å®ç°ç»†èŠ‚")]),s._v(", åªè¦èƒ½ç†è§£å®ƒä»¬æœ€åŸºæœ¬çš„å·¥ä½œåŸç†å’Œåä½œæ–¹å¼, ä½ ä¹Ÿå¯ä»¥åšåˆ°.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ€§èƒ½æŒ‡æ ‡æ˜¯ä»€ä¹ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ€§èƒ½æŒ‡æ ‡æ˜¯ä»€ä¹ˆ"}},[s._v("#")]),s._v(" 1.æ€§èƒ½æŒ‡æ ‡æ˜¯ä»€ä¹ˆ?")]),s._v(" "),a("p",[s._v('å­¦ä¹ æ€§èƒ½ä¼˜åŒ–çš„ç¬¬ä¸€æ­¥, ä¸€å®šæ˜¯äº†è§£"æ€§èƒ½æŒ‡æ ‡"è¿™ä¸ªæ¦‚å¿µ.')]),s._v(" "),a("p",[s._v('å½“çœ‹åˆ°æ€§èƒ½æŒ‡æ ‡æ—¶, ä½ ä¼šé¦–å…ˆæƒ³åˆ°ä»€ä¹ˆå‘¢? "'),a("strong",[s._v("é«˜å¹¶å‘")]),s._v('"å’Œ"'),a("strong",[s._v("å“åº”å¿«")]),s._v('" ä¸€å®šæ˜¯æœ€å…ˆå‡ºç°åœ¨ä½ è„‘æµ·é‡Œçš„ä¸¤ä¸ªè¯, è€Œå®ƒä»¬ä¹Ÿæ­£å¯¹åº”ç€æ€§èƒ½ä¼˜åŒ–çš„'),a("mark",[a("strong",[s._v('ä¸¤ä¸ªæ ¸å¿ƒæŒ‡æ ‡--"åå"å’Œ"å»¶æ—¶"')])]),s._v(" . è¿™ä¸¤ä¸ªæŒ‡æ ‡æ˜¯"),a("mark",[a("strong",[s._v("ä»åº”ç”¨è´Ÿè½½çš„è§†è§’")])]),s._v("æ¥è€ƒå¯Ÿæ€§èƒ½, ç›´æ¥å½±å“äº†äº§å“ç»ˆç«¯çš„ç”¨æˆ·ä½“éªŒ. è·Ÿå®ƒä»¬å¯¹åº”çš„, æ˜¯"),a("mark",[a("strong",[s._v("ä»ç³»ç»Ÿèµ„æºçš„è§†è§’")])]),s._v("å‡ºå‘çš„æŒ‡æ ‡, æ¯”å¦‚èµ„æºä½¿ç”¨ç‡, é¥±å’Œåº¦ç­‰.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/e781e331b9052efa6e9d0d186a0cf588-20230731161933-3lw4eqi.png",alt:""}})]),s._v(" "),a("p",[s._v("éšç€åº”ç”¨è´Ÿè½½çš„å¢åŠ , ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ä¹Ÿä¼šå‡é«˜, ç”šè‡³è¾¾åˆ°æé™. è€Œ"),a("strong",[s._v("æ€§èƒ½é—®é¢˜çš„æœ¬è´¨")]),s._v(", å°±æ˜¯ç³»ç»Ÿèµ„æºå·²ç»è¾¾åˆ°ç“¶é¢ˆ, ä½†è¯·æ±‚çš„å¤„ç†å´è¿˜ä¸å¤Ÿå¿«, æ— æ³•æ”¯æ’‘æ›´å¤šçš„è¯·æ±‚. æ€§èƒ½åˆ†æ, å…¶å®å°±æ˜¯"),a("strong",[s._v("æ‰¾å‡ºåº”ç”¨æˆ–ç³»ç»Ÿçš„ç“¶é¢ˆ, å¹¶è®¾æ³•å»é¿å…æˆ–è€…ç¼“è§£å®ƒä»¬")]),s._v(", ä»è€Œæ›´é«˜æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºå¤„ç†æ›´å¤šçš„è¯·æ±‚.")]),s._v(" "),a("p",[s._v("è¿™åŒ…å«äº†ä¸€ç³»åˆ—çš„æ­¥éª¤, æ¯”å¦‚ä¸‹é¢è¿™å…­ä¸ªæ­¥éª¤.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("é€‰æ‹©æŒ‡æ ‡è¯„ä¼°åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„æ€§èƒ½")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("ä¸ºåº”ç”¨ç¨‹åºå’Œç³»ç»Ÿè®¾ç½®æ€§èƒ½ç›®æ ‡")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("è¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("æ€§èƒ½åˆ†æå®šä½ç“¶é¢ˆ")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("ä¼˜åŒ–ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åº")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦")]),s._v(".")])]),s._v(" "),a("p",[s._v("äº†è§£äº†è¿™äº›æ€§èƒ½ç›¸å…³çš„åŸºæœ¬æŒ‡æ ‡å’Œæ ¸å¿ƒæ­¥éª¤å, è¯¥æ€ä¹ˆå­¦å‘¢? æ¥ä¸‹æ¥è¯´è¯´è¦å­¦å¥½ Linux æ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªé‡è¦é—®é¢˜.")]),s._v(" "),a("blockquote",[a("p",[s._v("å­¦è¿™ä¸ªä¸“æ éœ€è¦ä»€ä¹ˆåŸºç¡€")])]),s._v(" "),a("p",[s._v("è¿™ä¸ªä¸“æ çš„æ ¸å¿ƒæ˜¯æ€§èƒ½çš„åˆ†æå’Œä¼˜åŒ–, è€Œä¸æ˜¯æœ€åŸºæœ¬çš„ Linux æ“ä½œç³»ç»Ÿçš„ä½¿ç”¨æ–¹æ³•.")]),s._v(" "),a("p",[s._v("å› è€Œæœ€å¥½ç”¨è¿‡ Linux æ“ä½œç³»ç»Ÿ, ç„¶åè¦å…·å¤‡ä¸€äº›"),a("strong",[s._v("ç¼–ç¨‹åŸºç¡€")]),s._v(", æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("äº†è§£ Linux å¸¸ç”¨å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•;")]),s._v(" "),a("li",[s._v("çŸ¥é“æ€ä¹ˆå®‰è£…å’Œç®¡ç†è½¯ä»¶åŒ…;")]),s._v(" "),a("li",[s._v("çŸ¥é“æ€ä¹ˆé€šè¿‡ç¼–ç¨‹è¯­è¨€å¼€å‘åº”ç”¨ç¨‹åºç­‰.")])]),s._v(" "),a("p",[s._v("è¿™æ ·, åœ¨æˆ‘è®²æ€§èƒ½æ—¶, ä½ å°±æ›´å®¹æ˜“ç†è§£æ€§èƒ½èƒŒåçš„åŸç†, ç‰¹åˆ«æ˜¯åœ¨ç»“åˆä¸“æ é‡Œçš„æ¡ˆä¾‹å®è·µå, å¯¹æ€§èƒ½åˆ†æèƒ½æœ‰æ›´ç›´è§‚çš„ä½“ä¼š. è¿™ä¸ªä¸“æ ä¸ä¼šåƒæ•™ç§‘ä¹¦é‚£æ ·, è¯¦ç»†æ•™ä½ æ“ä½œç³»ç»Ÿ, ç®—æ³•åŸç†, ç½‘ç»œåè®®ä¹ƒè‡³å„ç§ç¼–ç¨‹è¯­è¨€çš„å…¨éƒ¨ç»†èŠ‚, ä½†ä¸€äº›é‡è¦çš„ç³»ç»ŸåŸç†è¿˜æ˜¯å¿…ä¸å¯å°‘çš„. æˆ‘è¿˜ä¼šç”¨å®é™…æ¡ˆä¾‹ä¸€æ­¥æ­¥æ•™ä½ , è´¯ç©¿ä»åº”ç”¨ç¨‹åºåˆ°æ“ä½œç³»ç»Ÿçš„å„ä¸ªç»„ä»¶.")]),s._v(" "),a("blockquote",[a("p",[s._v("å­¦ä¹ çš„é‡ç‚¹æ˜¯ä»€ä¹ˆ?")])]),s._v(" "),a("p",[s._v("æƒ³è¦å­¦ä¹ å¥½æ€§èƒ½åˆ†æå’Œä¼˜åŒ–, "),a("strong",[s._v("å»ºç«‹æ•´ä½“ç³»ç»Ÿæ€§èƒ½çš„å…¨å±€è§‚")]),s._v("æ˜¯æœ€æ ¸å¿ƒçš„è¯é¢˜. å› è€Œ,")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç†è§£æœ€åŸºæœ¬çš„å‡ ä¸ªç³»ç»ŸçŸ¥è¯†åŸç†")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("æŒæ¡å¿…è¦çš„æ€§èƒ½å·¥å…·")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("é€šè¿‡å®é™…çš„åœºæ™¯æ¼”ç»ƒ, è´¯ç©¿ä¸åŒçš„ç»„ä»¶")]),s._v(".")])]),s._v(" "),a("p",[s._v("è¿™ä¸‰ç‚¹å°±æ˜¯å­¦ä¹ çš„é‡ä¸­ä¹‹é‡. ä¸“æ çš„æ¯ç¯‡æ–‡ç« ä¸­, é’ˆå¯¹ä¸åŒåœºæ™¯, ä¼šæŠŠè¿™ä¸‰ä¸ªæ–¹é¢ç»™ä½ è®²æ¸…æ¥š.")]),s._v(" "),a("p",[s._v("å…¶å®è¯´åˆ°æ€§èƒ½å·¥å…·, å°±ä¸å¾—ä¸ææ€§èƒ½é¢†åŸŸçš„å¤§å¸ˆå¸ƒä¼¦ä¸¹Â·æ ¼é›·æ ¼(Brendan Gregg). ä»–ä¸ä»…æ˜¯åŠ¨æ€è¿½è¸ªå·¥å…· DTrace çš„ä½œè€…, è¿˜å¼€å‘äº†è®¸è®¸å¤šå¤šçš„æ€§èƒ½å·¥å…·. æˆ‘ç›¸ä¿¡ä½ ä¸€å®šè§è¿‡ä»–æ‰€æç»˜çš„ Linux æ€§èƒ½å·¥å…·å›¾è°±:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/300131a5a064cb0c7a606dc104994b29-20230731161933-tdnn1jk.png",alt:""}})]),s._v(" "),a("p",[s._v("(å›¾ç‰‡æ¥è‡ª"),a("a",{attrs:{href:"http://www.brendangregg.com/Perf/linux_perf_tools_full.png",target:"_blank",rel:"noopener noreferrer"}},[s._v("brendangregg.com"),a("OutboundLink")],1),s._v(")")]),s._v(" "),a("p",[s._v("è¿™ä¸ªå›¾æ˜¯ Linux æ€§èƒ½åˆ†ææœ€é‡è¦çš„å‚è€ƒèµ„æ–™ä¹‹ä¸€, å®ƒå‘Šè¯‰ä½ , "),a("strong",[s._v("åœ¨ Linux ä¸åŒå­ç³»ç»Ÿå‡ºç°æ€§èƒ½é—®é¢˜å, åº”è¯¥ç”¨ä»€ä¹ˆæ ·çš„å·¥å…·æ¥è§‚æµ‹å’Œåˆ†æ")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å½“é‡åˆ° I/O æ€§èƒ½é—®é¢˜æ—¶, å¯ä»¥å‚è€ƒå›¾ç‰‡æœ€ä¸‹æ–¹çš„ I/O å­ç³»ç»Ÿ, ä½¿ç”¨ iostat, iotop, blktrace ç­‰å·¥å…·åˆ†æç£ç›˜ I/O çš„ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("å¦å¤–, è¿˜è¦ç‰¹åˆ«å¼ºè°ƒä¸€ç‚¹, å°±æ˜¯"),a("strong",[s._v("æ€§èƒ½å·¥å…·çš„é€‰ç”¨")]),s._v(". æœ‰å¥è¯æ˜¯è¿™ä¹ˆè¯´çš„, "),a("strong",[s._v("ä¸€ä¸ªæ­£ç¡®çš„é€‰æ‹©èƒœè¿‡åƒç™¾æ¬¡çš„åŠªåŠ›")]),s._v(". è™½ç„¶å¤¸å¼ äº†äº›, ä½†æ˜¯é€‰ç”¨åˆé€‚çš„æ€§èƒ½å·¥å…·, ç¡®å®å¯ä»¥å¤§å¤§ç®€åŒ–æ•´ä¸ªæ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹. åœ¨ä»€ä¹ˆåœºæ™¯é€‰ç”¨ä»€ä¹ˆæ ·çš„å·¥å…·, ä»¥åŠæ€ä¹ˆå­¦ä¼šé€‰æ‹©åˆé€‚å·¥å…·, éƒ½æ˜¯æˆ‘æƒ³æ•™ç»™ä½ çš„ä¸œè¥¿.")]),s._v(" "),a("p",[s._v("ä½†æ˜¯åˆ‡è®°, "),a("strong",[s._v("åƒä¸‡ä¸è¦æŠŠæ€§èƒ½å·¥å…·å½“æˆå­¦ä¹ çš„å…¨éƒ¨")]),s._v(". å·¥å…·åªæ˜¯è§£å†³é—®é¢˜çš„æ‰‹æ®µ, å…³é”®åœ¨äºä½ çš„ç”¨æ³•. åªæœ‰çœŸæ­£ç†è§£äº†å®ƒä»¬èƒŒåçš„åŸç†, å¹¶ä¸”ç»“åˆå…·ä½“åœºæ™¯, èä¼šè´¯é€šç³»ç»Ÿçš„ä¸åŒç»„ä»¶, ä½ æ‰èƒ½çœŸæ­£æŒæ¡å®ƒä»¬.")]),s._v(" "),a("p",[s._v("æœ€å, ä¸ºäº†è®©ä½ å¯¹æ€§èƒ½æœ‰ä¸ªå…¨é¢çš„è®¤è¯†, æˆ‘ç”»äº†ä¸€å¼ æ€ç»´å¯¼å›¾, é‡Œé¢æ¶µç›–äº†å¤§éƒ¨åˆ†æ€§èƒ½åˆ†æå’Œä¼˜åŒ–éƒ½ä¼šåŒ…å«çš„çŸ¥è¯†, ä¸“æ ä¸­ä¹ŸåŸºæœ¬éƒ½ä¼šè®²åˆ°. ä½ å¯ä»¥ä¿å­˜æˆ–è€…æ‰“å°ä¸‹æ¥, æ¯å­¦ä¼šä¸€éƒ¨åˆ†å°±æ ‡è®°å‡ºæ¥, è®°å½•å¹¶æŠŠæ¡è‡ªå·±çš„å­¦ä¹ è¿›åº¦.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/c1270db676f656c14ecbd7c310b4555f-20230731161933-ltn6er5.png",alt:""}})]),s._v(" "),a("blockquote",[a("p",[s._v("æ€ä¹ˆå­¦æ›´é«˜æ•ˆ?")])]),s._v(" "),a("p",[s._v("å‰é¢è®²äº† Linux æ€§èƒ½ä¼˜åŒ–çš„å­¦ä¹ é‡ç‚¹, æ¥ä¸‹æ¥å†åˆ†äº«ä¸€ä¸‹å‡ ä¸ªå­¦ä¹ æŠ€å·§. æŒæ¡è¿™äº›æŠ€å·§, å¯ä»¥è®©ä½ å­¦å¾—æ›´è½»æ¾.")]),s._v(" "),a("p",[s._v("**æŠ€å·§ä¸€: è™½ç„¶ç³»ç»Ÿçš„åŸç†å¾ˆé‡è¦, ä½†åœ¨åˆšå¼€å§‹ä¸€å®šä¸è¦è¯•å›¾æŠ“ä½æ‰€æœ‰çš„å®ç°ç»†èŠ‚. **")]),s._v(" "),a("p",[s._v("æ·±é™·åˆ°ç³»ç»Ÿå®ç°çš„å†…éƒ¨, å¯èƒ½ä¼šè®©ä½ ä¸¢æ‰å­¦ä¹ çš„é‡ç‚¹, è€Œä¸”ç¹æ‚çš„å®ç°é€»è¾‘, å¾ˆå¯èƒ½ä¼šæ‰“é€€ä½ å­¦ä¹ çš„ç§¯ææ€§. æ‰€ä»¥, æˆ‘ä¸ªäººè§‚ç‚¹æ˜¯ä¸€å®šè¦é€‚åº¦.")]),s._v(" "),a("p",[s._v("ä½ å¯ä»¥å…ˆå­¦ä¼šè¿™äº›ç³»ç»Ÿå·¥ä½œåŸç†, ä½†ä¸è¦å»æ·±ç©¶ Linux å†…æ ¸æ˜¯å¦‚ä½•åšåˆ°çš„, è€Œæ˜¯è¦æŠŠé‡ç‚¹æ”¾åˆ°å¦‚ä½•è§‚å¯Ÿå’Œè¿ç”¨è¿™äº›åŸç†ä¸Š, æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("æœ‰å“ªäº›æŒ‡æ ‡å¯ä»¥è¡¡é‡æ€§èƒ½?")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ä»€ä¹ˆæ ·çš„æ€§èƒ½å·¥å…·æ¥è§‚å¯ŸæŒ‡æ ‡?")]),s._v(" "),a("li",[s._v("å¯¼è‡´è¿™äº›æŒ‡æ ‡å˜åŒ–çš„å› ç´ ç­‰.")])]),s._v(" "),a("p",[s._v("**æŠ€å·§äºŒ: è¾¹å­¦è¾¹å®è·µ, é€šè¿‡å¤§é‡çš„æ¡ˆä¾‹æ¼”ä¹ æŒæ¡ Linux æ€§èƒ½çš„åˆ†æå’Œä¼˜åŒ–. **")]),s._v(" "),a("p",[s._v("åªæœ‰é€šè¿‡åœ¨æœºå™¨ä¸Šç»ƒä¹ , æŠŠè®²çš„çŸ¥è¯†å’Œæ¡ˆä¾‹è‡ªå·±è¿‡ä¸€é, è¿™äº›ä¸œè¥¿æ‰èƒ½è½¬åŒ–æˆä½ çš„. æˆ‘ç²¾å¿ƒè®¾è®¡è¿™äº›æ¡ˆä¾‹, æ­£æ˜¯ä¸ºäº†è®©ä½ æœ‰æ›´å¥½çš„å­¦ä¹ ç†è§£å’Œæ“ä½œä½“éªŒ. æ‰€ä»¥å¼ºçƒˆæ¨èä½ å»å®é™…è¿è¡Œ, åˆ†æè¿™äº›æ¡ˆä¾‹, æˆ–è€…ç”¨å­¦åˆ°çš„çŸ¥è¯†å»åˆ†æä½ è‡ªå·±çš„ç³»ç»Ÿ, è¿™æ ·ä½ ä¼šæœ‰æ›´ç›´è§‚çš„æ„Ÿå—, è·å¾—æ›´å¥½çš„å­¦ä¹ æ•ˆæœ.")]),s._v(" "),a("p",[s._v("**æŠ€å·§ä¸‰: å‹¤æ€è€ƒ, å¤šåæ€, å–„æ€»ç»“, å¤šé—®ä¸ºä»€ä¹ˆ. **")]),s._v(" "),a("p",[s._v("æƒ³çœŸæ­£å­¦æ‡‚ä¸€é—¨çŸ¥è¯†, æœ€å¥½çš„æ–¹æ³•å°±æ˜¯é—®é—®é¢˜. å½“ä½ èƒ½æå‡ºå¥½çš„é—®é¢˜æ—¶, å°±è¯´æ˜ä½ å·²ç»æ·±å…¥äº†è§£äº†å®ƒ.")]),s._v(" "),a("h3",{attrs:{id:"cpuæ€§èƒ½ç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cpuæ€§èƒ½ç¯‡"}},[s._v("#")]),s._v(" CPUæ€§èƒ½ç¯‡")]),s._v(" "),a("h4",{attrs:{id:"_02-åŸºç¡€ç¯‡-åˆ°åº•åº”è¯¥æ€ä¹ˆç†è§£-å¹³å‡è´Ÿè½½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_02-åŸºç¡€ç¯‡-åˆ°åº•åº”è¯¥æ€ä¹ˆç†è§£-å¹³å‡è´Ÿè½½"}},[s._v("#")]),s._v(' 02-åŸºç¡€ç¯‡:åˆ°åº•åº”è¯¥æ€ä¹ˆç†è§£"å¹³å‡è´Ÿè½½"?')]),s._v(" "),a("p",[s._v("æ¯æ¬¡å‘ç°ç³»ç»Ÿå˜æ…¢æ—¶, å¤§å®¶é€šå¸¸åšçš„ç¬¬ä¸€ä»¶äº‹, å°±æ˜¯"),a("strong",[s._v("æ‰§è¡Œ top æˆ–è€… uptime å‘½ä»¤")]),s._v(", æ¥äº†è§£ç³»ç»Ÿçš„"),a("strong",[s._v("è´Ÿè½½æƒ…å†µ")]),s._v(". æ¯”å¦‚åœ¨å‘½ä»¤è¡Œé‡Œè¾“å…¥äº† uptime å‘½ä»¤, ç³»ç»Ÿä¹Ÿéšå³ç»™å‡ºäº†ç»“æœ.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v("\n02:34:03 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":14,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.63")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.83")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.88")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("é‚£ä½ çœŸçš„çŸ¥é“è¿™é‡Œæ¯åˆ—è¾“å‡ºçš„å«ä¹‰å—?")]),s._v(" "),a("p",[s._v("æˆ‘ç›¸ä¿¡ä½ å¯¹å‰é¢çš„å‡ åˆ—æ¯”è¾ƒç†Ÿæ‚‰, å®ƒä»¬åˆ†åˆ«æ˜¯"),a("strong",[s._v("å½“å‰æ—¶é—´, ç³»ç»Ÿè¿è¡Œæ—¶é—´ä»¥åŠæ­£åœ¨ç™»å½•ç”¨æˆ·æ•°")]),s._v(".")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("02:34:03              // å½“å‰æ—¶é—´\nup "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":14      // ç³»ç»Ÿè¿è¡Œæ—¶é—´\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user                // æ­£åœ¨ç™»å½•ç”¨æˆ·æ•°\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è€Œæœ€åä¸‰ä¸ªæ•°å­—å‘¢, "),a("strong",[s._v("ä¾æ¬¡åˆ™æ˜¯è¿‡å» 1 åˆ†é’Ÿ, 5 åˆ†é’Ÿ, 15 åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½(Load Average)")]),s._v(" .")]),s._v(" "),a("p",[a("strong",[s._v("å¹³å‡è´Ÿè½½")]),s._v('? è¿™ä¸ªè¯å¯¹å¾ˆå¤šäººæ¥è¯´, å¯èƒ½æ—¢ç†Ÿæ‚‰åˆé™Œç”Ÿ. æˆ‘å°±é‡åˆ°è¿‡è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯. å…¬å¸ä¸€ä¸ªå®ä¹ ç”Ÿä¸€ç›´è¿½é—®æˆ‘, ä»€ä¹ˆæ˜¯å¹³å‡è´Ÿè½½, æˆ‘æ”¯æ”¯å¾å¾åŠå¤©, æœ€åä¹Ÿæ²¡èƒ½è§£é‡Šæ˜ç™½. æ˜æ˜æ€»çœ‹åˆ°ä¹Ÿæ€»ä¼šç”¨åˆ°, æ€ä¹ˆå°±è¯´ä¸æ˜ç™½å‘¢? åæ¥æˆ‘é™ä¸‹æ¥æƒ³æƒ³, å…¶å®è¿˜æ˜¯è‡ªå·±çš„åŠŸåº•ä¸å¤Ÿ. äºæ˜¯è¿™å‡ å¹´, æˆ‘é‡åˆ°é—®é¢˜, ç‰¹åˆ«æ˜¯åŸºç¡€é—®é¢˜, éƒ½ä¼šå¤šé—®è‡ªå·±å‡ ä¸ª "ä¸ºä»€ä¹ˆ", ä»¥æ±‚èƒ½å¤Ÿå½»åº•ç†è§£ç°è±¡èƒŒåçš„æœ¬è´¨åŸç†, ç”¨èµ·æ¥æ›´çµæ´», ä¹Ÿæ›´æœ‰åº•æ°”.')]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å°±æ¥å­¦ä¹ ä¸‹, "),a("strong",[s._v("å¦‚ä½•è§‚æµ‹å’Œç†è§£è¿™ä¸ªæœ€å¸¸è§, ä¹Ÿæ˜¯æœ€é‡è¦çš„ç³»ç»ŸæŒ‡æ ‡")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸€å®šæœ‰äººä¼šè¯´, å¹³å‡è´Ÿè½½ä¸å°±æ˜¯å•ä½æ—¶é—´å†…çš„ CPU ä½¿ç”¨ç‡å—? ä¸Šé¢çš„ 0.63, å°±ä»£è¡¨ CPU ä½¿ç”¨ç‡æ˜¯ 63%. å…¶å®å¹¶ä¸æ˜¯è¿™æ ·, å¯ä»¥é€šè¿‡æ‰§è¡Œ man uptime å‘½ä»¤, æ¥äº†è§£å¹³å‡è´Ÿè½½çš„è¯¦ç»†è§£é‡Š.")]),s._v(" "),a("p",[s._v("ç®€å•æ¥è¯´, "),a("mark",[a("strong",[s._v("å¹³å‡è´Ÿè½½æ˜¯æŒ‡å•ä½æ—¶é—´å†…, ç³»ç»Ÿå¤„äºå¯è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€çš„å¹³å‡è¿›ç¨‹æ•°, ä¹Ÿå°±æ˜¯å¹³å‡æ´»è·ƒè¿›ç¨‹æ•°, å®ƒå’Œ CPU ä½¿ç”¨ç‡å¹¶æ²¡æœ‰ç›´æ¥å…³ç³»")])]),s._v(". è¿™é‡Œå…ˆè§£é‡Šä¸‹, å¯è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€è¿™ä¿©è¯å„¿.")]),s._v(" "),a("p",[a("strong",[s._v("æ‰€è°“å¯è¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹, æ˜¯æŒ‡æ­£åœ¨ä½¿ç”¨ CPU æˆ–è€…æ­£åœ¨ç­‰å¾… CPU çš„è¿›ç¨‹, ä¹Ÿå°±æ˜¯ ps å‘½ä»¤çœ‹åˆ°çš„, å¤„äº R çŠ¶æ€(Running æˆ– Runnable)çš„è¿›ç¨‹")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("ä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹åˆ™æ˜¯æ­£å¤„äºå†…æ ¸æ€å…³é”®æµç¨‹ä¸­çš„è¿›ç¨‹, å¹¶ä¸”è¿™äº›æµç¨‹æ˜¯ä¸å¯æ‰“æ–­çš„, æ¯”å¦‚æœ€å¸¸è§çš„æ˜¯ç­‰å¾…ç¡¬ä»¶è®¾å¤‡çš„ I/O å“åº”, ä¹Ÿå°±æ˜¯åœ¨ ps å‘½ä»¤ä¸­çœ‹åˆ°çš„ D çŠ¶æ€(Uninterruptible Sleep, ä¹Ÿç§°ä¸º Disk Sleep)çš„è¿›ç¨‹.")])]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å½“ä¸€ä¸ªè¿›ç¨‹å‘ç£ç›˜è¯»å†™æ•°æ®æ—¶, ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§, åœ¨å¾—åˆ°ç£ç›˜å›å¤å‰, å®ƒæ˜¯ä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹æˆ–è€…ä¸­æ–­æ‰“æ–­çš„, è¿™ä¸ªæ—¶å€™çš„è¿›ç¨‹å°±å¤„äº"),a("strong",[s._v("ä¸å¯ä¸­æ–­çŠ¶æ€")]),s._v(". å¦‚æœæ­¤æ—¶çš„è¿›ç¨‹è¢«æ‰“æ–­äº†, å°±å®¹æ˜“å‡ºç°ç£ç›˜æ•°æ®ä¸è¿›ç¨‹æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, "),a("strong",[s._v("ä¸å¯ä¸­æ–­çŠ¶æ€å®é™…ä¸Šæ˜¯ç³»ç»Ÿå¯¹è¿›ç¨‹å’Œç¡¬ä»¶è®¾å¤‡çš„ä¸€ç§ä¿æŠ¤æœºåˆ¶")]),s._v(".")]),s._v(" "),a("p",[s._v("å› æ­¤å¯ä»¥ç®€å•ç†è§£ä¸º, "),a("strong",[s._v("å¹³å‡è´Ÿè½½å…¶å®å°±æ˜¯å¹³å‡æ´»è·ƒè¿›ç¨‹æ•°")]),s._v('. å¹³å‡æ´»è·ƒè¿›ç¨‹æ•°, ç›´è§‚ä¸Šçš„ç†è§£å°±æ˜¯å•ä½æ—¶é—´å†…çš„æ´»è·ƒè¿›ç¨‹æ•°, ä½†å®ƒå®é™…ä¸Šæ˜¯æ´»è·ƒè¿›ç¨‹æ•°çš„æŒ‡æ•°è¡°å‡å¹³å‡å€¼. è¿™ä¸ª "æŒ‡æ•°è¡°å‡å¹³å‡" çš„è¯¦ç»†å«ä¹‰ä¸ç”¨è®¡è¾ƒ, è¿™åªæ˜¯ç³»ç»Ÿçš„ä¸€ç§æ›´å¿«é€Ÿçš„è®¡ç®—æ–¹å¼, æŠŠå®ƒç›´æ¥å½“æˆæ´»è·ƒè¿›ç¨‹æ•°çš„å¹³å‡å€¼ä¹Ÿæ²¡é—®é¢˜.')]),s._v(" "),a("p",[a("strong",[s._v("æ—¢ç„¶å¹³å‡çš„æ˜¯æ´»è·ƒè¿›ç¨‹æ•°")]),s._v(", é‚£ä¹ˆæœ€ç†æƒ³çš„, å°±æ˜¯æ¯ä¸ª CPU ä¸Šéƒ½åˆšå¥½è¿è¡Œç€ä¸€ä¸ªè¿›ç¨‹, è¿™æ ·æ¯ä¸ª CPU éƒ½å¾—åˆ°äº†å……åˆ†åˆ©ç”¨. æ¯”å¦‚å½“å¹³å‡è´Ÿè½½ä¸º 2 æ—¶, æ„å‘³ç€ä»€ä¹ˆå‘¢?")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("åœ¨åªæœ‰ 2 ä¸ª CPU çš„ç³»ç»Ÿä¸Š, æ„å‘³ç€æ‰€æœ‰çš„ CPU éƒ½åˆšå¥½è¢«å®Œå…¨å ç”¨")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("åœ¨ 4 ä¸ª CPU çš„ç³»ç»Ÿä¸Š, æ„å‘³ç€ CPU æœ‰ 50% çš„ç©ºé—²")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("è€Œåœ¨åªæœ‰ 1 ä¸ª CPU çš„ç³»ç»Ÿä¸­, åˆ™æ„å‘³ç€æœ‰ä¸€åŠçš„è¿›ç¨‹ç«äº‰ä¸åˆ° CPU")]),s._v(".")])]),s._v(" "),a("h5",{attrs:{id:"_1-å¹³å‡è´Ÿè½½ä¸ºå¤šå°‘æ—¶åˆç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å¹³å‡è´Ÿè½½ä¸ºå¤šå°‘æ—¶åˆç†"}},[s._v("#")]),s._v(" 1.å¹³å‡è´Ÿè½½ä¸ºå¤šå°‘æ—¶åˆç†")]),s._v(" "),a("p",[s._v("è®²å®Œäº†ä»€ä¹ˆæ˜¯å¹³å‡è´Ÿè½½, ç°åœ¨å†å›åˆ°æœ€å¼€å§‹çš„ä¾‹å­, ä¸çŸ¥é“ä½ èƒ½å¦åˆ¤æ–­å‡º, åœ¨ uptime å‘½ä»¤çš„ç»“æœé‡Œ, é‚£ä¸‰ä¸ªæ—¶é—´æ®µçš„å¹³å‡è´Ÿè½½æ•°, å¤šå¤§çš„æ—¶å€™èƒ½è¯´æ˜ç³»ç»Ÿè´Ÿè½½é«˜? æˆ–æ˜¯å¤šå°çš„æ—¶å€™å°±èƒ½è¯´æ˜ç³»ç»Ÿè´Ÿè½½å¾ˆä½å‘¢?")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("å¹³å‡è´Ÿè½½æœ€ç†æƒ³çš„æƒ…å†µæ˜¯ç­‰äº CPU ä¸ªæ•°")])]),s._v(". æ‰€ä»¥åœ¨è¯„åˆ¤å¹³å‡è´Ÿè½½æ—¶, "),a("strong",[s._v("é¦–å…ˆè¦çŸ¥é“ç³»ç»Ÿæœ‰å‡ ä¸ª CPU")]),s._v(", è¿™å¯ä»¥é€šè¿‡ top å‘½ä»¤æˆ–è€…ä»æ–‡ä»¶ "),a("code",[s._v("/proc/cpuinfo")]),s._v("â€‹ ä¸­è¯»å–, æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'model name'")]),s._v(" /proc/cpuinfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("æœ‰äº† CPU ä¸ªæ•°, å°±å¯ä»¥åˆ¤æ–­å‡º, å½“å¹³å‡è´Ÿè½½æ¯” CPU ä¸ªæ•°è¿˜å¤§çš„æ—¶å€™, ç³»ç»Ÿå·²ç»å‡ºç°äº†è¿‡è½½.")])]),s._v(" "),a("p",[s._v("ä¸è¿‡, æ–°çš„é—®é¢˜åˆæ¥äº†. åœ¨ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°, å¹³å‡è´Ÿè½½æœ‰ä¸‰ä¸ªæ•°å€¼, åˆ°åº•è¯¥å‚è€ƒå“ªä¸€ä¸ªå‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, éƒ½è¦çœ‹. ä¸‰ä¸ªä¸åŒæ—¶é—´é—´éš”çš„å¹³å‡å€¼, å…¶å®æä¾›äº†, åˆ†æ"),a("strong",[s._v("ç³»ç»Ÿè´Ÿè½½è¶‹åŠ¿")]),s._v("çš„æ•°æ®æ¥æº, å°±èƒ½æ›´å…¨é¢, æ›´ç«‹ä½“åœ°ç†è§£ç›®å‰çš„è´Ÿè½½çŠ¶å†µ.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚åˆç§‹æ—¶åŒ—äº¬çš„å¤©æ°”, å¦‚æœåªçœ‹ä¸­åˆçš„æ¸©åº¦, ä½ å¯èƒ½ä»¥ä¸ºè¿˜åœ¨ 7 æœˆä»½çš„å¤§å¤å¤©. ä½†å¦‚æœä½ ç»“åˆäº†æ—©ä¸Š, ä¸­åˆ, æ™šä¸Šä¸‰ä¸ªæ—¶é—´ç‚¹çš„æ¸©åº¦æ¥çœ‹, åŸºæœ¬å°±å¯ä»¥å…¨æ–¹ä½äº†è§£è¿™ä¸€å¤©çš„å¤©æ°”æƒ…å†µäº†.")]),s._v(" "),a("p",[s._v("åŒæ ·çš„, å‰é¢è¯´åˆ°çš„ CPU çš„ä¸‰ä¸ªè´Ÿè½½æ—¶é—´æ®µä¹Ÿæ˜¯è¿™ä¸ªé“ç†.")]),s._v(" "),a("ul",[a("li",[s._v("å¦‚æœ 1 åˆ†é’Ÿ, 5 åˆ†é’Ÿ, 15 åˆ†é’Ÿçš„ä¸‰ä¸ªå€¼åŸºæœ¬ç›¸åŒ, æˆ–è€…ç›¸å·®ä¸å¤§, é‚£å°±è¯´æ˜ç³»ç»Ÿè´Ÿè½½å¾ˆå¹³ç¨³.")]),s._v(" "),a("li",[s._v("ä½†å¦‚æœ 1 åˆ†é’Ÿçš„å€¼è¿œå°äº 15 åˆ†é’Ÿçš„å€¼, å°±è¯´æ˜ç³»ç»Ÿæœ€è¿‘ 1 åˆ†é’Ÿçš„è´Ÿè½½åœ¨å‡å°‘, è€Œè¿‡å» 15 åˆ†é’Ÿå†…å´æœ‰å¾ˆå¤§çš„è´Ÿè½½.")]),s._v(" "),a("li",[s._v("åè¿‡æ¥, å¦‚æœ 1 åˆ†é’Ÿçš„å€¼è¿œå¤§äº 15 åˆ†é’Ÿçš„å€¼, å°±è¯´æ˜æœ€è¿‘ 1 åˆ†é’Ÿçš„è´Ÿè½½åœ¨å¢åŠ , è¿™ç§å¢åŠ æœ‰å¯èƒ½åªæ˜¯ä¸´æ—¶æ€§çš„, ä¹Ÿæœ‰å¯èƒ½è¿˜ä¼šæŒç»­å¢åŠ ä¸‹å», æ‰€ä»¥å°±éœ€è¦æŒç»­è§‚å¯Ÿ. ä¸€æ—¦ 1 åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½æ¥è¿‘æˆ–è¶…è¿‡äº† CPU çš„ä¸ªæ•°, å°±æ„å‘³ç€ç³»ç»Ÿæ­£åœ¨å‘ç”Ÿè¿‡è½½çš„é—®é¢˜, è¿™æ—¶å°±å¾—åˆ†æè°ƒæŸ¥æ˜¯å“ªé‡Œå¯¼è‡´çš„é—®é¢˜, å¹¶è¦æƒ³åŠæ³•ä¼˜åŒ–äº†.")])]),s._v(" "),a("p",[s._v("å†ä¸¾ä¸ªä¾‹å­, å‡è®¾åœ¨ä¸€ä¸ªå• CPU ç³»ç»Ÿä¸Šçœ‹åˆ°å¹³å‡è´Ÿè½½ä¸º 1.73, 0.60, 7.98, é‚£ä¹ˆè¯´æ˜åœ¨è¿‡å» 1 åˆ†é’Ÿå†…, ç³»ç»Ÿ"),a("strong",[s._v("æœ‰ 73% çš„è¶…è½½")]),s._v(", è€Œåœ¨ 15 åˆ†é’Ÿå†…, æœ‰ 698% çš„è¶…è½½, ä»æ•´ä½“è¶‹åŠ¿æ¥çœ‹, "),a("strong",[s._v("ç³»ç»Ÿçš„è´Ÿè½½åœ¨é™ä½")]),s._v(".")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­, å¹³å‡è´Ÿè½½å¤šé«˜æ—¶, éœ€è¦é‡ç‚¹å…³æ³¨å‘¢?")]),s._v(" "),a("p",[s._v("åœ¨æˆ‘çœ‹æ¥, "),a("strong",[s._v("å½“å¹³å‡è´Ÿè½½é«˜äº CPU æ•°é‡ 70% çš„æ—¶å€™")]),s._v(", å°±åº”è¯¥åˆ†ææ’æŸ¥è´Ÿè½½é«˜çš„é—®é¢˜äº†. ä¸€æ—¦è´Ÿè½½è¿‡é«˜, å°±å¯èƒ½å¯¼è‡´è¿›ç¨‹å“åº”å˜æ…¢, è¿›è€Œå½±å“æœåŠ¡çš„æ­£å¸¸åŠŸèƒ½.")]),s._v(" "),a("p",[s._v("ä½† 70% è¿™ä¸ªæ•°å­—å¹¶ä¸æ˜¯ç»å¯¹çš„, æœ€æ¨èçš„æ–¹æ³•, è¿˜æ˜¯æŠŠç³»ç»Ÿçš„å¹³å‡è´Ÿè½½ç›‘æ§èµ·æ¥, ç„¶åæ ¹æ®æ›´å¤šçš„å†å²æ•°æ®, åˆ¤æ–­è´Ÿè½½çš„å˜åŒ–è¶‹åŠ¿. å½“å‘ç°è´Ÿè½½æœ‰æ˜æ˜¾å‡é«˜è¶‹åŠ¿æ—¶, æ¯”å¦‚è¯´è´Ÿè½½ç¿»å€äº†, ä½ å†å»åšåˆ†æå’Œè°ƒæŸ¥.")]),s._v(" "),a("h5",{attrs:{id:"_2-å¹³å‡è´Ÿè½½ä¸cpuä½¿ç”¨ç‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¹³å‡è´Ÿè½½ä¸cpuä½¿ç”¨ç‡"}},[s._v("#")]),s._v(" 2.å¹³å‡è´Ÿè½½ä¸CPUä½¿ç”¨ç‡")]),s._v(" "),a("p",[s._v("ç°å®å·¥ä½œä¸­, ç»å¸¸å®¹æ˜“æŠŠ"),a("strong",[s._v("å¹³å‡è´Ÿè½½å’Œ CPU ä½¿ç”¨ç‡æ··æ·†")]),s._v(", æ‰€ä»¥åœ¨è¿™é‡Œä¹Ÿåšä¸€ä¸ªåŒºåˆ†.")]),s._v(" "),a("p",[s._v("å¯èƒ½ä½ ä¼šç–‘æƒ‘, æ—¢ç„¶å¹³å‡è´Ÿè½½ä»£è¡¨çš„æ˜¯æ´»è·ƒè¿›ç¨‹æ•°, é‚£å¹³å‡è´Ÿè½½é«˜äº†, ä¸å°±æ„å‘³ç€ CPU ä½¿ç”¨ç‡é«˜å—?")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯è¦å›åˆ°å¹³å‡è´Ÿè½½çš„å«ä¹‰ä¸Šæ¥, "),a("mark",[a("strong",[s._v("å¹³å‡è´Ÿè½½æ˜¯æŒ‡å•ä½æ—¶é—´å†…, å¤„äºå¯è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹æ•°. æ‰€ä»¥, å®ƒä¸ä»…åŒ…æ‹¬äº†æ­£åœ¨ä½¿ç”¨ CPU çš„è¿›ç¨‹, è¿˜åŒ…æ‹¬ç­‰å¾… CPU å’Œç­‰å¾… I/O çš„è¿›ç¨‹")])]),s._v(".")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("è€Œ CPU ä½¿ç”¨ç‡, æ˜¯å•ä½æ—¶é—´å†… CPU ç¹å¿™æƒ…å†µçš„ç»Ÿè®¡, è·Ÿå¹³å‡è´Ÿè½½å¹¶ä¸ä¸€å®šå®Œå…¨å¯¹åº”")])]),s._v(". æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("CPU å¯†é›†å‹è¿›ç¨‹, ä½¿ç”¨å¤§é‡ CPU ä¼šå¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜, æ­¤æ—¶è¿™ä¸¤è€…æ˜¯ä¸€è‡´çš„;")]),s._v(" "),a("li",[s._v("I/O å¯†é›†å‹è¿›ç¨‹, ç­‰å¾… I/O ä¹Ÿä¼šå¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜, "),a("strong",[s._v("ä½† CPU ä½¿ç”¨ç‡ä¸ä¸€å®šå¾ˆé«˜")]),s._v(";")]),s._v(" "),a("li",[s._v("å¤§é‡ç­‰å¾… CPU çš„è¿›ç¨‹è°ƒåº¦ä¹Ÿä¼šå¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜, æ­¤æ—¶çš„ CPU ä½¿ç”¨ç‡ä¹Ÿä¼šæ¯”è¾ƒé«˜.")])]),s._v(" "),a("h5",{attrs:{id:"_3-å¹³å‡è´Ÿè½½æ¡ˆä¾‹åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å¹³å‡è´Ÿè½½æ¡ˆä¾‹åˆ†æ"}},[s._v("#")]),s._v(" 3.å¹³å‡è´Ÿè½½æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("ä¸‹é¢ä»¥ä¸‰ä¸ªç¤ºä¾‹åˆ†åˆ«æ¥çœ‹è¿™ä¸‰ç§æƒ…å†µ, å¹¶ç”¨ "),a("strong",[s._v("iostat, mpstat, pidstat")]),s._v(" ç­‰å·¥å…·, æ‰¾å‡ºå¹³å‡è´Ÿè½½å‡é«˜çš„æ ¹æº. å› ä¸ºæ¡ˆä¾‹åˆ†æéƒ½æ˜¯åŸºäºæœºå™¨ä¸Šçš„æ“ä½œ, æ‰€ä»¥ä¸è¦åªæ˜¯å¬å¬, çœ‹çœ‹å°±å¤Ÿäº†, æœ€å¥½è¿˜æ˜¯å®é™…æ“ä½œä¸€ä¸‹.")]),s._v(" "),a("h6",{attrs:{id:"_1-å‡†å¤‡å·¥ä½œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å‡†å¤‡å·¥ä½œ"}},[s._v("#")]),s._v(" (1)å‡†å¤‡å·¥ä½œ")]),s._v(" "),a("p",[s._v("ä¸‹é¢çš„æ¡ˆä¾‹éƒ½æ˜¯åŸºäº Ubuntu 18.04, å½“ç„¶åŒæ ·é€‚ç”¨äºå…¶ä»– Linux ç³»ç»Ÿ. ä½¿ç”¨çš„æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… stress å’Œ sysstat åŒ…, å¦‚ apt install stress sysstat.")])]),s._v(" "),a("p",[s._v("åœ¨è¿™é‡Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹ stress å’Œ sysstat.")]),s._v(" "),a("p",[s._v("stress æ˜¯ä¸€ä¸ª Linux ç³»ç»Ÿå‹åŠ›æµ‹è¯•å·¥å…·, è¿™é‡Œç”¨ä½œ"),a("strong",[s._v("å¼‚å¸¸è¿›ç¨‹æ¨¡æ‹Ÿå¹³å‡è´Ÿè½½å‡é«˜çš„åœºæ™¯")]),s._v(".")]),s._v(" "),a("p",[s._v("è€Œ sysstat åŒ…å«äº†å¸¸ç”¨çš„ Linux æ€§èƒ½å·¥å…·, ç”¨æ¥ç›‘æ§å’Œåˆ†æç³»ç»Ÿçš„æ€§èƒ½. æ¡ˆä¾‹ä¼šç”¨åˆ°è¿™ä¸ªåŒ…çš„ä¸¤ä¸ªå‘½ä»¤ "),a("strong",[s._v("mpstat")]),s._v(" å’Œ "),a("strong",[s._v("pidstat")]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("mpstat æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å¤šæ ¸ CPU æ€§èƒ½åˆ†æå·¥å…·, ç”¨æ¥å®æ—¶æŸ¥çœ‹æ¯ä¸ª CPU çš„æ€§èƒ½æŒ‡æ ‡, ä»¥åŠæ‰€æœ‰ CPU çš„å¹³å‡æŒ‡æ ‡.")])]),s._v(" "),a("li",[a("strong",[s._v("pidstat æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„è¿›ç¨‹æ€§èƒ½åˆ†æå·¥å…·, ç”¨æ¥å®æ—¶æŸ¥çœ‹è¿›ç¨‹çš„ CPU, å†…å­˜, I/O ä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰æ€§èƒ½æŒ‡æ ‡.")])])]),s._v(" "),a("p",[s._v("æ­¤å¤–, æ¯ä¸ªåœºæ™¯éƒ½éœ€è¦å¼€ä¸‰ä¸ªç»ˆç«¯, ç™»å½•åˆ°åŒä¸€å° Linux æœºå™¨ä¸­.")]),s._v(" "),a("p",[s._v("å¦å¤–è¦æ³¨æ„, ä¸‹é¢çš„æ‰€æœ‰å‘½ä»¤, éƒ½æ˜¯é»˜è®¤ä»¥ root ç”¨æˆ·è¿è¡Œ. å¦‚æœä¸Šé¢çš„è¦æ±‚éƒ½å·²ç»å®Œæˆäº†, å¯ä»¥å…ˆç”¨ uptime å‘½ä»¤, çœ‹ä¸€ä¸‹æµ‹è¯•å‰çš„å¹³å‡è´Ÿè½½æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.11")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.15")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.09")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h6",{attrs:{id:"_2-åœºæ™¯ä¸€-cpuå¯†é›†å‹è¿›ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-åœºæ™¯ä¸€-cpuå¯†é›†å‹è¿›ç¨‹"}},[s._v("#")]),s._v(" (2)åœºæ™¯ä¸€:CPUå¯†é›†å‹è¿›ç¨‹")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œ stress å‘½ä»¤, æ¨¡æ‹Ÿä¸€ä¸ª CPU ä½¿ç”¨ç‡ 100% çš„åœºæ™¯:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ stress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cpu")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ¥ç€, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œ uptime æŸ¥çœ‹å¹³å‡è´Ÿè½½çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d å‚æ•°è¡¨ç¤ºé«˜äº®æ˜¾ç¤ºå˜åŒ–çš„åŒºåŸŸ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.75")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.39")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æœ€å, åœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯"),a("strong",[s._v("è¿è¡Œ mpstat æŸ¥çœ‹ CPU ä½¿ç”¨ç‡")]),s._v("çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -P ALL è¡¨ç¤ºç›‘æ§æ‰€æœ‰ CPU, åé¢æ•°å­— 5 è¡¨ç¤ºé—´éš” 5 ç§’åè¾“å‡ºä¸€ç»„æ•°æ®")]),s._v("\n$ mpstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" ALL "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nLinux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.15")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 09/22/18 _x86_64_ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CPU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":30:06     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":30:11     all   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50.05")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49.95")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":30:11       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":30:11       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä»ç»ˆç«¯äºŒä¸­å¯ä»¥çœ‹åˆ°, "),a("strong",[s._v("1 åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½ä¼šæ…¢æ…¢å¢åŠ åˆ° 1.00")]),s._v(", è€Œä»ç»ˆç«¯ä¸‰ä¸­è¿˜å¯ä»¥çœ‹åˆ°, æ­£å¥½æœ‰ä¸€ä¸ª CPU çš„ä½¿ç”¨ç‡ä¸º 100%, ä½†å®ƒçš„ iowait åªæœ‰ 0. è¿™è¯´æ˜, å¹³å‡è´Ÿè½½çš„å‡é«˜æ­£æ˜¯"),a("strong",[s._v("ç”±äº CPU ä½¿ç”¨ç‡ä¸º 100%")]),s._v(" .")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, åˆ°åº•æ˜¯å“ªä¸ªè¿›ç¨‹å¯¼è‡´äº† CPU ä½¿ç”¨ç‡ä¸º 100% å‘¢? å¯ä»¥ä½¿ç”¨ pidstat æ¥æŸ¥è¯¢:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é—´éš” 5 ç§’åè¾“å‡ºä¸€ç»„æ•°æ®")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":37:07      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":37:12        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2962")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  stress\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥æ˜æ˜¾çœ‹åˆ°, "),a("strong",[s._v("stress è¿›ç¨‹")]),s._v("çš„ CPU ä½¿ç”¨ç‡ä¸º 100%.")]),s._v(" "),a("h6",{attrs:{id:"_3-åœºæ™¯äºŒ-i-oå¯†é›†å‹è¿›ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-åœºæ™¯äºŒ-i-oå¯†é›†å‹è¿›ç¨‹"}},[s._v("#")]),s._v(" (3)åœºæ™¯äºŒ:I/Oå¯†é›†å‹è¿›ç¨‹")]),s._v(" "),a("p",[s._v("é¦–å…ˆè¿˜æ˜¯è¿è¡Œ stress å‘½ä»¤, ä½†è¿™æ¬¡æ¨¡æ‹Ÿ I/O å‹åŠ›, å³ä¸åœåœ°æ‰§è¡Œ sync:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ stress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("è¿˜æ˜¯åœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œ uptime æŸ¥çœ‹å¹³å‡è´Ÿè½½çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.06")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.58")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.37")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶å, ç¬¬ä¸‰ä¸ªç»ˆç«¯"),a("strong",[s._v("è¿è¡Œ mpstat æŸ¥çœ‹ CPU ä½¿ç”¨ç‡çš„å˜åŒ–æƒ…å†µ")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ˜¾ç¤ºæ‰€æœ‰ CPU çš„æŒ‡æ ‡, å¹¶åœ¨é—´éš” 5 ç§’è¾“å‡ºä¸€ç»„æ•°æ®")]),s._v("\n$ mpstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" ALL "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nLinux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.15")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     09/22/18     _x86_64_    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CPU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":41:28     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":41:33     all    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.21")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.07")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32.67")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.21")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54.84")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":41:33       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.43")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23.87")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67.53")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.43")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.74")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":41:33       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.81")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.20")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.99")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°, 1 åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½ä¼šæ…¢æ…¢å¢åŠ åˆ° 1.06, å…¶ä¸­ä¸€ä¸ª CPU çš„ç³»ç»Ÿ CPU ä½¿ç”¨ç‡å‡é«˜åˆ°äº† 23.87, è€Œ iowait é«˜è¾¾ 67.53%. è¿™è¯´æ˜, "),a("strong",[s._v("å¹³å‡è´Ÿè½½çš„å‡é«˜æ˜¯ç”±äº iowait çš„å‡é«˜")]),s._v(".")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆåˆ°åº•æ˜¯å“ªä¸ªè¿›ç¨‹, å¯¼è‡´ iowait è¿™ä¹ˆé«˜å‘¢? è¿˜æ˜¯ç”¨ pidstat æ¥æŸ¥è¯¢:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é—´éš” 5 ç§’åè¾“å‡ºä¸€ç»„æ•°æ®, -u è¡¨ç¤º CPU æŒ‡æ ‡")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nLinux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.15")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     09/22/18     _x86_64_    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CPU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":42:08      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":42:13        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.39")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.39")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  kworker/1:1H\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":42:13        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("109")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.40")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.40")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  kworker/0:1H\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":42:13        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2997")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.53")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.99")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37.52")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":42:13        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3057")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.40")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.40")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  pidstat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("å¯ä»¥å‘ç°, è¿˜æ˜¯ stress è¿›ç¨‹å¯¼è‡´çš„.")]),s._v(" "),a("h6",{attrs:{id:"_4-åœºæ™¯ä¸‰-å¤§é‡è¿›ç¨‹çš„åœºæ™¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-åœºæ™¯ä¸‰-å¤§é‡è¿›ç¨‹çš„åœºæ™¯"}},[s._v("#")]),s._v(" (4)åœºæ™¯ä¸‰:å¤§é‡è¿›ç¨‹çš„åœºæ™¯")]),s._v(" "),a("p",[s._v("å½“ç³»ç»Ÿä¸­è¿è¡Œè¿›ç¨‹è¶…å‡º CPU è¿è¡Œèƒ½åŠ›æ—¶, å°±ä¼šå‡ºç°ç­‰å¾… CPU çš„è¿›ç¨‹.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚è¿˜æ˜¯ä½¿ç”¨ stress, ä½†è¿™æ¬¡æ¨¡æ‹Ÿçš„æ˜¯ 8 ä¸ªè¿›ç¨‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ stress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç”±äºç³»ç»Ÿåªæœ‰ 2 ä¸ª CPU, æ˜æ˜¾æ¯” 8 ä¸ªè¿›ç¨‹è¦å°‘å¾—å¤š, å› è€Œç³»ç»Ÿçš„ CPU å¤„äºä¸¥é‡è¿‡è½½çŠ¶æ€, å¹³å‡è´Ÿè½½é«˜è¾¾ 7.97:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.97")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.93")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.02")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ç€å†è¿è¡Œ pidstat æ¥çœ‹ä¸€ä¸‹è¿›ç¨‹çš„æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é—´éš” 5 ç§’åè¾“å‡ºä¸€ç»„æ•°æ®")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:25      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3190")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74.80")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3191")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75.20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3192")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74.80")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3193")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3194")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.80")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74.60")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.80")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3195")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.80")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.80")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3196")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.80")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74.60")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.80")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3197")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.80")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74.80")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.80")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":23:30        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3200")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.20")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.20")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.20")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  pidstat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹å‡º, "),a("strong",[s._v("8 ä¸ªè¿›ç¨‹åœ¨äº‰æŠ¢ 2 ä¸ª CPU, æ¯ä¸ªè¿›ç¨‹ç­‰å¾… CPU çš„æ—¶é—´(ä¹Ÿå°±æ˜¯ %wait åˆ—)é«˜è¾¾ 75%")]),s._v(" . è¿™äº›è¶…å‡º CPU è®¡ç®—èƒ½åŠ›çš„è¿›ç¨‹, æœ€ç»ˆå¯¼è‡´ CPU è¿‡è½½.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("åˆ†æå®Œè¿™ä¸‰ä¸ªæ¡ˆä¾‹, å†æ¥å½’çº³ä¸€ä¸‹å¹³å‡è´Ÿè½½çš„ç†è§£.")]),s._v(" "),a("p",[a("strong",[s._v("å¹³å‡è´Ÿè½½æä¾›äº†ä¸€ä¸ªå¿«é€ŸæŸ¥çœ‹ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„æ‰‹æ®µ, åæ˜ äº†æ•´ä½“çš„è´Ÿè½½æƒ…å†µ")]),s._v(". ä½†åªçœ‹å¹³å‡è´Ÿè½½æœ¬èº«, å¹¶ä¸èƒ½ç›´æ¥å‘ç°, åˆ°åº•æ˜¯å“ªé‡Œå‡ºç°äº†ç“¶é¢ˆ. æ‰€ä»¥åœ¨ç†è§£å¹³å‡è´Ÿè½½æ—¶, ä¹Ÿè¦æ³¨æ„:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å¹³å‡è´Ÿè½½é«˜æœ‰å¯èƒ½æ˜¯ CPU å¯†é›†å‹è¿›ç¨‹å¯¼è‡´çš„")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("å¹³å‡è´Ÿè½½é«˜å¹¶ä¸ä¸€å®šä»£è¡¨ CPU ä½¿ç”¨ç‡é«˜, è¿˜æœ‰å¯èƒ½æ˜¯ I/O æ›´ç¹å¿™äº†")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("å½“å‘ç°è´Ÿè½½é«˜çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨ mpstat, pidstat ç­‰å·¥å…·, è¾…åŠ©åˆ†æè´Ÿè½½çš„æ¥æº")]),s._v(".")])]),s._v(" "),a("h4",{attrs:{id:"_03-åŸºç¡€ç¯‡-ç»å¸¸è¯´çš„cpuä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä»€ä¹ˆæ„æ€-ä¸Š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_03-åŸºç¡€ç¯‡-ç»å¸¸è¯´çš„cpuä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä»€ä¹ˆæ„æ€-ä¸Š"}},[s._v("#")]),s._v(" 03-åŸºç¡€ç¯‡:ç»å¸¸è¯´çš„CPUä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä»€ä¹ˆæ„æ€?(ä¸Š)")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚è®²äº†è¦æ€ä¹ˆç†è§£å¹³å‡è´Ÿè½½( Load Average), å¹¶ç”¨ä¸‰ä¸ªæ¡ˆä¾‹å±•ç¤ºäº†ä¸åŒåœºæ™¯ä¸‹å¹³å‡è´Ÿè½½å‡é«˜çš„åˆ†ææ–¹æ³•. è¿™å…¶ä¸­, "),a("strong",[s._v("å¤šä¸ªè¿›ç¨‹ç«äº‰ CPU å°±æ˜¯ä¸€ä¸ªç»å¸¸è¢«æˆ‘ä»¬å¿½è§†çš„é—®é¢˜")]),s._v(".")]),s._v(" "),a("p",[s._v("æˆ‘æƒ³ä½ ä¸€å®šå¾ˆå¥½å¥‡, "),a("strong",[s._v("è¿›ç¨‹åœ¨ç«äº‰ CPU çš„æ—¶å€™å¹¶æ²¡æœ‰çœŸæ­£è¿è¡Œ, ä¸ºä»€ä¹ˆè¿˜ä¼šå¯¼è‡´ç³»ç»Ÿçš„è´Ÿè½½å‡é«˜å‘¢")]),s._v("? å…¶å® "),a("strong",[s._v("CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å°±æ˜¯ç½ªé­ç¥¸é¦–")]),s._v(".")]),s._v(" "),a("p",[s._v("Linux æ˜¯ä¸€ä¸ªå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿ, å®ƒæ”¯æŒè¿œå¤§äº CPU æ•°é‡çš„ä»»åŠ¡åŒæ—¶è¿è¡Œ. å½“ç„¶è¿™äº›ä»»åŠ¡å®é™…ä¸Šå¹¶ä¸æ˜¯çœŸçš„åœ¨åŒæ—¶è¿è¡Œ, è€Œæ˜¯å› ä¸º"),a("strong",[s._v("ç³»ç»Ÿåœ¨å¾ˆçŸ­çš„æ—¶é—´å†…, å°† CPU è½®æµåˆ†é…ç»™å®ƒä»¬, é€ æˆå¤šä»»åŠ¡åŒæ—¶è¿è¡Œçš„é”™è§‰")]),s._v(".")]),s._v(" "),a("p",[s._v("è€Œåœ¨æ¯ä¸ªä»»åŠ¡è¿è¡Œå‰, CPU éƒ½éœ€è¦çŸ¥é“ä»»åŠ¡ä»å“ªé‡ŒåŠ è½½, åˆä»å“ªé‡Œå¼€å§‹è¿è¡Œ, ä¹Ÿå°±æ˜¯éœ€è¦ç³»ç»Ÿäº‹å…ˆå¸®å®ƒè®¾ç½®å¥½ "),a("strong",[s._v("CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨")]),s._v("(Program Counter, PC).")]),s._v(" "),a("p",[s._v("CPU å¯„å­˜å™¨, æ˜¯ CPU å†…ç½®çš„å®¹é‡å°, ä½†é€Ÿåº¦æå¿«çš„å†…å­˜. è€Œç¨‹åºè®¡æ•°å™¨, åˆ™æ˜¯ç”¨æ¥å­˜å‚¨ CPU æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®, æˆ–è€…å³å°†æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ä½ç½®. å®ƒä»¬éƒ½æ˜¯ CPU åœ¨è¿è¡Œä»»ä½•ä»»åŠ¡å‰, å¿…é¡»çš„ä¾èµ–ç¯å¢ƒ, å› æ­¤ä¹Ÿè¢«å«åš "),a("strong",[s._v("CPU ä¸Šä¸‹æ–‡")]),s._v(".")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/d0b18f16c3eb81c3859018b9606ced32-20230731161933-fgdvxo4.png",alt:""}})]),s._v(" "),a("p",[s._v("çŸ¥é“äº†ä»€ä¹ˆæ˜¯ CPU ä¸Šä¸‹æ–‡, å°±ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ "),a("strong",[s._v("CPU ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(". CPU ä¸Šä¸‹æ–‡åˆ‡æ¢, "),a("mark",[a("strong",[s._v("å°±æ˜¯å…ˆæŠŠå‰ä¸€ä¸ªä»»åŠ¡çš„ CPU ä¸Šä¸‹æ–‡(ä¹Ÿå°±æ˜¯ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨)ä¿å­˜èµ·æ¥, ç„¶ååŠ è½½æ–°ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ°è¿™äº›å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨, æœ€åå†è·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡çš„æ–°ä½ç½®, è¿è¡Œæ–°ä»»åŠ¡")])]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("è€Œè¿™äº›ä¿å­˜ä¸‹æ¥çš„ä¸Šä¸‹æ–‡, ä¼šå­˜å‚¨åœ¨ç³»ç»Ÿå†…æ ¸ä¸­, å¹¶åœ¨ä»»åŠ¡é‡æ–°è°ƒåº¦æ‰§è¡Œæ—¶å†æ¬¡åŠ è½½è¿›æ¥. è¿™æ ·å°±èƒ½ä¿è¯ä»»åŠ¡åŸæ¥çš„çŠ¶æ€ä¸å—å½±å“, è®©ä»»åŠ¡çœ‹èµ·æ¥è¿˜æ˜¯è¿ç»­è¿è¡Œ")]),s._v(".")]),s._v(" "),a("p",[s._v("æˆ‘çŒœè‚¯å®šä¼šæœ‰äººè¯´, CPU ä¸Šä¸‹æ–‡åˆ‡æ¢æ— éå°±æ˜¯æ›´æ–°äº† CPU å¯„å­˜å™¨çš„å€¼å˜›, ä½†è¿™äº›å¯„å­˜å™¨, æœ¬èº«å°±æ˜¯ä¸ºäº†å¿«é€Ÿè¿è¡Œä»»åŠ¡è€Œè®¾è®¡çš„, ä¸ºä»€ä¹ˆä¼šå½±å“ç³»ç»Ÿçš„ CPU æ€§èƒ½å‘¢?")]),s._v(" "),a("p",[s._v('åœ¨å›ç­”è¿™ä¸ªé—®é¢˜å‰, ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æƒ³è¿‡, æ“ä½œç³»ç»Ÿç®¡ç†çš„è¿™äº›"ä»»åŠ¡"åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢?')]),s._v(" "),a("p",[s._v("ä¹Ÿè®¸ä½ ä¼šè¯´, ä»»åŠ¡å°±æ˜¯è¿›ç¨‹, æˆ–è€…è¯´ä»»åŠ¡å°±æ˜¯çº¿ç¨‹. æ˜¯çš„, è¿›ç¨‹å’Œçº¿ç¨‹æ­£æ˜¯æœ€å¸¸è§çš„ä»»åŠ¡. ä½†æ˜¯é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„ä»»åŠ¡å‘¢? ä¸è¦å¿˜äº†, ç¡¬ä»¶é€šè¿‡è§¦å‘ä¿¡å·, ä¼šå¯¼è‡´ä¸­æ–­å¤„ç†ç¨‹åºçš„è°ƒç”¨, ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ä»»åŠ¡.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, æ ¹æ®ä»»åŠ¡çš„ä¸åŒ, CPU çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å°±å¯ä»¥åˆ†ä¸ºå‡ ä¸ªä¸åŒçš„åœºæ™¯, ä¹Ÿå°±æ˜¯"),a("mark",[a("strong",[s._v("è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢")])]),s._v("â€‹"),a("mark",[s._v(", ")]),s._v("â€‹"),a("mark",[a("strong",[s._v("çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢")])]),s._v("â€‹"),a("mark",[s._v("ä»¥åŠ")]),s._v("â€‹"),a("mark",[a("strong",[s._v("ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢")])]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™èŠ‚è¯¾å°±æ¥çœ‹çœ‹, æ€ä¹ˆç†è§£è¿™å‡ ä¸ªä¸åŒçš„ä¸Šä¸‹æ–‡åˆ‡æ¢, ä»¥åŠå®ƒä»¬ä¸ºä»€ä¹ˆä¼šå¼•å‘ CPU æ€§èƒ½ç›¸å…³é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_1-è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"}},[s._v("#")]),s._v(" 1.è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(" "),a("p",[s._v("Linux æŒ‰ç…§ç‰¹æƒç­‰çº§, æŠŠè¿›ç¨‹çš„è¿è¡Œç©ºé—´åˆ†ä¸º"),a("strong",[s._v("å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´")]),s._v(", åˆ†åˆ«å¯¹åº”ç€ä¸‹å›¾ä¸­, CPU ç‰¹æƒç­‰çº§çš„ Ring 0 å’Œ Ring 3.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å†…æ ¸ç©ºé—´(Ring 0)å…·æœ‰æœ€é«˜æƒé™, å¯ä»¥ç›´æ¥è®¿é—®æ‰€æœ‰èµ„æº")]),s._v(";")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç”¨æˆ·ç©ºé—´(Ring 3)åªèƒ½è®¿é—®å—é™èµ„æº, ä¸èƒ½ç›´æ¥è®¿é—®å†…å­˜ç­‰ç¡¬ä»¶è®¾å¤‡, å¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨é™·å…¥åˆ°å†…æ ¸ä¸­, æ‰èƒ½è®¿é—®è¿™äº›ç‰¹æƒèµ„æº")]),s._v(".")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/a68ed9f2a3bbbf0d2f3880b0ede244d5-20230731161933-za0cswi.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¹Ÿå°±æ˜¯è¯´, "),a("mark",[a("strong",[s._v("è¿›ç¨‹æ—¢å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œ, åˆå¯ä»¥åœ¨å†…æ ¸ç©ºé—´ä¸­è¿è¡Œ. è¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œæ—¶, è¢«ç§°ä¸ºè¿›ç¨‹çš„ç”¨æˆ·æ€, è€Œé™·å…¥å†…æ ¸ç©ºé—´çš„æ—¶å€™, è¢«ç§°ä¸ºè¿›ç¨‹çš„å†…æ ¸æ€")])]),s._v(".")]),s._v(" "),a("p",[s._v("ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„è½¬å˜, éœ€è¦é€šè¿‡"),a("strong",[s._v("ç³»ç»Ÿè°ƒç”¨")]),s._v("æ¥å®Œæˆ. æ¯”å¦‚, å½“æŸ¥çœ‹æ–‡ä»¶å†…å®¹æ—¶, å°±éœ€è¦å¤šæ¬¡ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆ: é¦–å…ˆè°ƒç”¨ open() æ‰“å¼€æ–‡ä»¶, ç„¶åè°ƒç”¨ read() è¯»å–æ–‡ä»¶å†…å®¹, å¹¶è°ƒç”¨ write() å°†å†…å®¹å†™åˆ°æ ‡å‡†è¾“å‡º, æœ€åå†è°ƒç”¨ close() å…³é—­æ–‡ä»¶.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹æœ‰æ²¡æœ‰å‘ç”Ÿ CPU ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å‘¢? ç­”æ¡ˆè‡ªç„¶æ˜¯è‚¯å®šçš„.")]),s._v(" "),a("p",[a("strong",[s._v("CPU å¯„å­˜å™¨é‡ŒåŸæ¥ç”¨æˆ·æ€çš„æŒ‡ä»¤ä½ç½®, éœ€è¦å…ˆä¿å­˜èµ·æ¥. æ¥ç€ä¸ºäº†æ‰§è¡Œå†…æ ¸æ€ä»£ç , CPU å¯„å­˜å™¨éœ€è¦æ›´æ–°ä¸ºå†…æ ¸æ€æŒ‡ä»¤çš„æ–°ä½ç½®. æœ€åæ‰æ˜¯è·³è½¬åˆ°å†…æ ¸æ€è¿è¡Œå†…æ ¸ä»»åŠ¡")]),s._v(".")]),s._v(" "),a("p",[s._v("è€Œç³»ç»Ÿè°ƒç”¨ç»“æŸå, CPU å¯„å­˜å™¨éœ€è¦"),a("strong",[s._v("æ¢å¤")]),s._v("åŸæ¥ä¿å­˜çš„ç”¨æˆ·æ€, ç„¶åå†åˆ‡æ¢åˆ°ç”¨æˆ·ç©ºé—´, ç»§ç»­è¿è¡Œè¿›ç¨‹. æ‰€ä»¥ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹, å…¶å®æ˜¯"),a("strong",[s._v("å‘ç”Ÿäº†ä¸¤æ¬¡ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯, ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­, å¹¶ä¸ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿå†…å­˜ç­‰è¿›ç¨‹ç”¨æˆ·æ€çš„èµ„æº, ä¹Ÿä¸ä¼šåˆ‡æ¢è¿›ç¨‹. è¿™è·Ÿé€šå¸¸æ‰€è¯´çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä¸ä¸€æ ·çš„:")]),s._v(" "),a("ul",[a("li",[a("mark",[a("strong",[s._v("è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢, æ˜¯æŒ‡ä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹è¿è¡Œ")])]),s._v(".")]),s._v(" "),a("li",[a("mark",[a("strong",[s._v("è€Œç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ä¸€ç›´æ˜¯åŒä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œ")])]),s._v(".")])]),s._v(" "),a("p",[s._v("æ‰€ä»¥, "),a("strong",[s._v("ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹é€šå¸¸ç§°ä¸ºç‰¹æƒæ¨¡å¼åˆ‡æ¢, è€Œä¸æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(". ä½†å®é™…ä¸Š, "),a("strong",[s._v("ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­, CPU çš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¿˜æ˜¯æ— æ³•é¿å…çš„")]),s._v(".")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è·Ÿç³»ç»Ÿè°ƒç”¨åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?")]),s._v(" "),a("p",[s._v("é¦–å…ˆéœ€è¦çŸ¥é“, "),a("mark",[a("strong",[s._v("è¿›ç¨‹æ˜¯ç”±å†…æ ¸æ¥ç®¡ç†å’Œè°ƒåº¦çš„, è¿›ç¨‹çš„åˆ‡æ¢åªèƒ½å‘ç”Ÿåœ¨å†…æ ¸æ€")])]),s._v(". æ‰€ä»¥è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸ä»…åŒ…æ‹¬äº†è™šæ‹Ÿå†…å­˜, æ ˆ, å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æº, è¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆ, å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„çŠ¶æ€.")]),s._v(" "),a("p",[s._v("å› æ­¤, è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å°±æ¯”ç³»ç»Ÿè°ƒç”¨æ—¶å¤šäº†ä¸€æ­¥: "),a("strong",[s._v("åœ¨ä¿å­˜å½“å‰è¿›ç¨‹çš„å†…æ ¸çŠ¶æ€å’Œ CPU å¯„å­˜å™¨ä¹‹å‰, éœ€è¦å…ˆæŠŠè¯¥è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜, æ ˆç­‰ä¿å­˜ä¸‹æ¥; è€ŒåŠ è½½äº†ä¸‹ä¸€è¿›ç¨‹çš„å†…æ ¸æ€å, è¿˜éœ€è¦åˆ·æ–°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜å’Œç”¨æˆ·")]),s._v("æ ˆ.")]),s._v(" "),a("p",[s._v('å¦‚ä¸‹å›¾æ‰€ç¤º, ä¿å­˜ä¸Šä¸‹æ–‡å’Œæ¢å¤ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹å¹¶ä¸æ˜¯ "å…è´¹" çš„, éœ€è¦'),a("strong",[s._v("å†…æ ¸åœ¨ CPU ä¸Šè¿è¡Œ")]),s._v("æ‰èƒ½å®Œæˆ.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/affeed0e95391757739a96caf35b209f-20230731161933-dmjq4py.png",alt:""}})]),s._v(" "),a("p",[s._v("æ ¹æ® "),a("a",{attrs:{href:"https://blog.tsunanet.net/2010/11/how-long-does-it-take-to-make-context.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Tsuna"),a("OutboundLink")],1),s._v(" çš„æµ‹è¯•æŠ¥å‘Š, "),a("strong",[s._v("æ¯æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢éƒ½éœ€è¦å‡ åçº³ç§’åˆ°æ•°å¾®ç§’çš„ CPU æ—¶é—´")]),s._v(". è¿™ä¸ªæ—¶é—´è¿˜æ˜¯ç›¸å½“å¯è§‚çš„, ç‰¹åˆ«æ˜¯åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°è¾ƒå¤šçš„æƒ…å†µä¸‹, å¾ˆå®¹æ˜“å¯¼è‡´ CPU å°†å¤§é‡æ—¶é—´è€—è´¹åœ¨å¯„å­˜å™¨, å†…æ ¸æ ˆä»¥åŠè™šæ‹Ÿå†…å­˜ç­‰èµ„æºçš„ä¿å­˜å’Œæ¢å¤ä¸Š, è¿›è€Œå¤§å¤§ç¼©çŸ­äº†çœŸæ­£è¿è¡Œè¿›ç¨‹çš„æ—¶é—´. è¿™ä¹Ÿæ­£æ˜¯ä¸Šä¸€èŠ‚ä¸­è®²çš„, å¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜çš„ä¸€ä¸ªé‡è¦å› ç´ .")]),s._v(" "),a("p",[s._v("å¦å¤–, "),a("strong",[s._v("Linux é€šè¿‡ TLB(Translation Lookaside Buffer)æ¥ç®¡ç†è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„å…³ç³»")]),s._v(". å½“è™šæ‹Ÿå†…å­˜æ›´æ–°å, TLB ä¹Ÿéœ€è¦åˆ·æ–°, å†…å­˜çš„è®¿é—®ä¹Ÿä¼šéšä¹‹å˜æ…¢. ç‰¹åˆ«æ˜¯åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Š, ç¼“å­˜æ˜¯è¢«å¤šä¸ªå¤„ç†å™¨å…±äº«çš„, åˆ·æ–°ç¼“å­˜ä¸ä»…ä¼šå½±å“å½“å‰å¤„ç†å™¨çš„è¿›ç¨‹, è¿˜ä¼šå½±å“å…±äº«ç¼“å­˜çš„å…¶ä»–å¤„ç†å™¨çš„è¿›ç¨‹.")]),s._v(" "),a("p",[s._v("çŸ¥é“äº†è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ½œåœ¨çš„æ€§èƒ½é—®é¢˜å, å†æ¥çœ‹, "),a("strong",[s._v("ç©¶ç«Ÿä»€ä¹ˆæ—¶å€™ä¼šåˆ‡æ¢è¿›ç¨‹ä¸Šä¸‹æ–‡")]),s._v(".")]),s._v(" "),a("p",[s._v("æ˜¾ç„¶, è¿›ç¨‹åˆ‡æ¢æ—¶æ‰éœ€è¦åˆ‡æ¢ä¸Šä¸‹æ–‡, æ¢å¥è¯è¯´, "),a("mark",[a("strong",[s._v("åªæœ‰åœ¨è¿›ç¨‹è°ƒåº¦çš„æ—¶å€™, æ‰éœ€è¦åˆ‡æ¢ä¸Šä¸‹æ–‡")])]),s._v(". Linux ä¸ºæ¯ä¸ª CPU éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå°±ç»ªé˜Ÿåˆ—, å°†æ´»è·ƒè¿›ç¨‹(å³æ­£åœ¨è¿è¡Œå’Œæ­£åœ¨ç­‰å¾… CPU çš„è¿›ç¨‹)æŒ‰ç…§ä¼˜å…ˆçº§å’Œç­‰å¾… CPU çš„æ—¶é—´æ’åº, ç„¶åé€‰æ‹©æœ€éœ€è¦ CPU çš„è¿›ç¨‹, ä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§æœ€é«˜å’Œç­‰å¾… CPU æ—¶é—´æœ€é•¿çš„è¿›ç¨‹æ¥è¿è¡Œ.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, è¿›ç¨‹åœ¨ä»€ä¹ˆæ—¶å€™æ‰ä¼šè¢«è°ƒåº¦åˆ° CPU ä¸Šè¿è¡Œå‘¢?")]),s._v(" "),a("p",[s._v("æœ€å®¹æ˜“æƒ³åˆ°çš„ä¸€ä¸ªæ—¶æœº, å°±æ˜¯è¿›ç¨‹æ‰§è¡Œå®Œç»ˆæ­¢äº†, å®ƒä¹‹å‰ä½¿ç”¨çš„ CPU ä¼šé‡Šæ”¾å‡ºæ¥, è¿™ä¸ªæ—¶å€™å†ä»å°±ç»ªé˜Ÿåˆ—é‡Œ, æ‹¿ä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿‡æ¥è¿è¡Œ. å…¶å®è¿˜æœ‰å¾ˆå¤šå…¶ä»–åœºæ™¯, ä¹Ÿä¼šè§¦å‘è¿›ç¨‹è°ƒåº¦, åœ¨è¿™é‡Œé€ä¸ªæ¢³ç†ä¸‹.")]),s._v(" "),a("ul",[a("li",[s._v("å…¶ä¸€, ä¸ºäº†ä¿è¯æ‰€æœ‰è¿›ç¨‹å¯ä»¥å¾—åˆ°å…¬å¹³è°ƒåº¦, CPU æ—¶é—´è¢«åˆ’åˆ†ä¸ºä¸€æ®µæ®µçš„"),a("strong",[s._v("æ—¶é—´")]),s._v("ç‰‡, è¿™äº›æ—¶é—´ç‰‡å†è¢«è½®æµåˆ†é…ç»™å„ä¸ªè¿›ç¨‹. è¿™æ ·, "),a("strong",[s._v("å½“æŸä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡è€—å°½äº†, å°±ä¼šè¢«ç³»ç»ŸæŒ‚èµ·, åˆ‡æ¢åˆ°å…¶å®ƒæ­£åœ¨ç­‰å¾… CPU çš„è¿›ç¨‹è¿è¡Œ")]),s._v(".")]),s._v(" "),a("li",[s._v("å…¶äºŒ, è¿›ç¨‹åœ¨"),a("strong",[s._v("ç³»ç»Ÿèµ„æºä¸è¶³(æ¯”å¦‚å†…å­˜ä¸è¶³)æ—¶, è¦ç­‰åˆ°èµ„æºæ»¡è¶³åæ‰å¯ä»¥è¿è¡Œ, è¿™ä¸ªæ—¶å€™è¿›ç¨‹ä¹Ÿä¼šè¢«æŒ‚èµ·")]),s._v(", å¹¶ç”±ç³»ç»Ÿè°ƒåº¦å…¶ä»–è¿›ç¨‹è¿è¡Œ.")]),s._v(" "),a("li",[s._v("å…¶ä¸‰, å½“è¿›ç¨‹é€šè¿‡"),a("strong",[s._v("ç¡çœ å‡½æ•° sleep è¿™æ ·çš„æ–¹æ³•å°†è‡ªå·±ä¸»åŠ¨æŒ‚èµ·æ—¶")]),s._v(", è‡ªç„¶ä¹Ÿä¼šé‡æ–°è°ƒåº¦.")]),s._v(" "),a("li",[s._v("å…¶å››, å½“"),a("strong",[s._v("æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„è¿›ç¨‹è¿è¡Œæ—¶")]),s._v(", ä¸ºäº†ä¿è¯é«˜ä¼˜å…ˆçº§è¿›ç¨‹çš„è¿è¡Œ, å½“å‰è¿›ç¨‹ä¼šè¢«æŒ‚èµ·, ç”±é«˜ä¼˜å…ˆçº§è¿›ç¨‹æ¥è¿è¡Œ.")]),s._v(" "),a("li",[s._v("æœ€åä¸€ä¸ª, å‘ç”Ÿ"),a("strong",[s._v("ç¡¬ä»¶ä¸­æ–­æ—¶, CPU ä¸Šçš„è¿›ç¨‹ä¼šè¢«ä¸­æ–­æŒ‚èµ·")]),s._v(", è½¬è€Œæ‰§è¡Œå†…æ ¸ä¸­çš„ä¸­æ–­æœåŠ¡ç¨‹åº.")])]),s._v(" "),a("p",[s._v("äº†è§£è¿™å‡ ä¸ªåœºæ™¯æ˜¯éå¸¸æœ‰å¿…è¦çš„, å› ä¸ºä¸€æ—¦å‡ºç°ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ€§èƒ½é—®é¢˜, å®ƒä»¬å°±æ˜¯å¹•åå‡¶æ‰‹.")]),s._v(" "),a("h5",{attrs:{id:"_2-çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"}},[s._v("#")]),s._v(" 2.çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(" "),a("p",[s._v("è¯´å®Œäº†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢, å†æ¥çœ‹çœ‹çº¿ç¨‹ç›¸å…³çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("çº¿ç¨‹ä¸è¿›ç¨‹æœ€å¤§çš„åŒºåˆ«åœ¨äº, "),a("mark",[a("strong",[s._v("çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½, è€Œè¿›ç¨‹åˆ™æ˜¯èµ„æºæ‹¥æœ‰çš„åŸºæœ¬å•ä½")])]),s._v(". è¯´ç™½äº†, æ‰€è°“å†…æ ¸ä¸­çš„ä»»åŠ¡è°ƒåº¦, "),a("strong",[s._v("å®é™…ä¸Šçš„è°ƒåº¦å¯¹è±¡æ˜¯çº¿ç¨‹")]),s._v("; è€Œè¿›ç¨‹åªæ˜¯ç»™çº¿ç¨‹æä¾›äº†è™šæ‹Ÿå†…å­˜, å…¨å±€å˜é‡ç­‰èµ„æº. æ‰€ä»¥, å¯¹äºçº¿ç¨‹å’Œè¿›ç¨‹, æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å½“è¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ—¶, å¯ä»¥è®¤ä¸ºè¿›ç¨‹å°±ç­‰äºçº¿ç¨‹")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("å½“è¿›ç¨‹æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹æ—¶, è¿™äº›çº¿ç¨‹ä¼šå…±äº«ç›¸åŒçš„è™šæ‹Ÿå†…å­˜å’Œå…¨å±€å˜é‡ç­‰èµ„æº. è¿™äº›èµ„æºåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æ˜¯ä¸éœ€è¦ä¿®æ”¹çš„")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("å¦å¤–, çº¿ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰æ•°æ®, æ¯”å¦‚æ ˆå’Œå¯„å­˜å™¨ç­‰, è¿™äº›åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ä¹Ÿæ˜¯éœ€è¦ä¿å­˜çš„")]),s._v(".")])]),s._v(" "),a("p",[s._v("è¿™ä¹ˆä¸€æ¥, çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å…¶å®å°±å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µ:")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§, "),a("strong",[s._v("å‰åä¸¤ä¸ªçº¿ç¨‹å±äºä¸åŒè¿›ç¨‹")]),s._v(". æ­¤æ—¶, å› ä¸ºèµ„æºä¸å…±äº«, æ‰€ä»¥åˆ‡æ¢è¿‡ç¨‹å°±è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä¸€æ ·.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§, "),a("strong",[s._v("å‰åä¸¤ä¸ªçº¿ç¨‹å±äºåŒä¸€ä¸ªè¿›ç¨‹")]),s._v(". æ­¤æ—¶, å› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„, æ‰€ä»¥åœ¨åˆ‡æ¢æ—¶, è™šæ‹Ÿå†…å­˜è¿™äº›èµ„æºå°±ä¿æŒä¸åŠ¨, åªéœ€è¦åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®, å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®.")])]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œä½ åº”è¯¥ä¹Ÿå‘ç°äº†, è™½ç„¶åŒä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢, "),a("strong",[s._v("ä½†åŒè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢, è¦æ¯”å¤šè¿›ç¨‹é—´çš„åˆ‡æ¢æ¶ˆè€—æ›´å°‘çš„èµ„æº")]),s._v(", è€Œè¿™ä¹Ÿæ­£æ˜¯å¤šçº¿ç¨‹ä»£æ›¿å¤šè¿›ç¨‹çš„ä¸€ä¸ªä¼˜åŠ¿.")]),s._v(" "),a("h5",{attrs:{id:"_3-ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢"}},[s._v("#")]),s._v(" 3.ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(" "),a("p",[s._v("é™¤äº†å‰é¢ä¸¤ç§ä¸Šä¸‹æ–‡åˆ‡æ¢, è¿˜æœ‰ä¸€ä¸ªåœºæ™¯ä¹Ÿä¼šåˆ‡æ¢ CPU ä¸Šä¸‹æ–‡, é‚£å°±æ˜¯ä¸­æ–­.")]),s._v(" "),a("p",[s._v("ä¸ºäº†å¿«é€Ÿå“åº”ç¡¬ä»¶çš„äº‹ä»¶, "),a("mark",[a("strong",[s._v("ä¸­æ–­å¤„ç†ä¼šæ‰“æ–­è¿›ç¨‹çš„æ­£å¸¸è°ƒåº¦å’Œæ‰§è¡Œ, è½¬è€Œè°ƒç”¨ä¸­æ–­å¤„ç†ç¨‹åº, å“åº”è®¾å¤‡äº‹ä»¶")])]),s._v(". è€Œåœ¨æ‰“æ–­å…¶ä»–è¿›ç¨‹æ—¶, å°±éœ€è¦å°†è¿›ç¨‹å½“å‰çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥, è¿™æ ·åœ¨ä¸­æ–­ç»“æŸå, è¿›ç¨‹ä»ç„¶å¯ä»¥ä»åŸæ¥çš„çŠ¶æ€æ¢å¤è¿è¡Œ.")]),s._v(" "),a("p",[s._v("è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡ä¸åŒ, "),a("strong",[s._v("ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢å¹¶ä¸æ¶‰åŠåˆ°è¿›ç¨‹çš„ç”¨æˆ·æ€")]),s._v(". æ‰€ä»¥, å³ä¾¿ä¸­æ–­è¿‡ç¨‹æ‰“æ–­äº†ä¸€ä¸ªæ­£å¤„åœ¨ç”¨æˆ·æ€çš„è¿›ç¨‹, ä¹Ÿä¸éœ€è¦ä¿å­˜å’Œæ¢å¤è¿™ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜, å…¨å±€å˜é‡ç­‰ç”¨æˆ·æ€èµ„æº. ä¸­æ–­ä¸Šä¸‹æ–‡, å…¶å®åªåŒ…æ‹¬å†…æ ¸æ€ä¸­æ–­æœåŠ¡ç¨‹åºæ‰§è¡Œæ‰€å¿…éœ€çš„çŠ¶æ€, åŒ…æ‹¬ CPU å¯„å­˜å™¨, å†…æ ¸å †æ ˆ, ç¡¬ä»¶ä¸­æ–­å‚æ•°ç­‰.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("å¯¹åŒä¸€ä¸ª CPU æ¥è¯´, ä¸­æ–­å¤„ç†æ¯”è¿›ç¨‹æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§")])]),s._v(", æ‰€ä»¥ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢å¹¶ä¸ä¼šä¸è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢åŒæ—¶å‘ç”Ÿ. åŒæ ·é“ç†, ç”±äºä¸­æ–­ä¼šæ‰“æ–­æ­£å¸¸è¿›ç¨‹çš„è°ƒåº¦å’Œæ‰§è¡Œ, æ‰€ä»¥"),a("strong",[s._v("å¤§éƒ¨åˆ†ä¸­æ–­å¤„ç†ç¨‹åºéƒ½çŸ­å°ç²¾æ‚")]),s._v(", ä»¥ä¾¿å°½å¯èƒ½å¿«çš„æ‰§è¡Œç»“æŸ.")]),s._v(" "),a("p",[s._v("å¦å¤–, è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸€æ ·, ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿéœ€è¦æ¶ˆè€— CPU, åˆ‡æ¢æ¬¡æ•°è¿‡å¤šä¹Ÿä¼šè€—è´¹å¤§é‡çš„ CPU, ç”šè‡³ä¸¥é‡é™ä½ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½. æ‰€ä»¥, å½“å‘ç°ä¸­æ–­æ¬¡æ•°è¿‡å¤šæ—¶, å°±éœ€è¦æ³¨æ„å»æ’æŸ¥å®ƒæ˜¯å¦ä¼šç»™ç³»ç»Ÿå¸¦æ¥ä¸¥é‡çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-2"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æ€»ç»“ä¸€ä¸‹, ä¸ç®¡æ˜¯å“ªç§åœºæ™¯å¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢, éƒ½åº”è¯¥çŸ¥é“:")]),s._v(" "),a("ol",[a("li",[s._v("CPU ä¸Šä¸‹æ–‡åˆ‡æ¢, æ˜¯ä¿è¯ Linux ç³»ç»Ÿæ­£å¸¸å·¥ä½œçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€, ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ç‰¹åˆ«å…³æ³¨.")]),s._v(" "),a("li",[a("strong",[s._v("ä½†è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢, ä¼šæŠŠ CPU æ—¶é—´æ¶ˆè€—åœ¨å¯„å­˜å™¨, å†…æ ¸æ ˆä»¥åŠè™šæ‹Ÿå†…å­˜ç­‰æ•°æ®çš„ä¿å­˜å’Œæ¢å¤ä¸Š, ä»è€Œç¼©çŸ­è¿›ç¨‹çœŸæ­£è¿è¡Œçš„æ—¶é—´, å¯¼è‡´ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å¤§å¹…ä¸‹é™")]),s._v(".")])]),s._v(" "),a("p",[s._v("æœ¬èŠ‚ä¸»è¦ä»‹ç»è¿™å‡ ç§ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å·¥ä½œåŸç†, ä¸‹ä¸€èŠ‚å°†ç»§ç»­æ¡ˆä¾‹å®æˆ˜, è¯´è¯´ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜çš„åˆ†ææ–¹æ³•.")]),s._v(" "),a("h4",{attrs:{id:"_04-åŸºç¡€ç¯‡-ç»å¸¸è¯´çš„cpuä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä»€ä¹ˆæ„æ€-ä¸‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_04-åŸºç¡€ç¯‡-ç»å¸¸è¯´çš„cpuä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä»€ä¹ˆæ„æ€-ä¸‹"}},[s._v("#")]),s._v(" 04-åŸºç¡€ç¯‡:ç»å¸¸è¯´çš„CPUä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä»€ä¹ˆæ„æ€?(ä¸‹)")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚è®²äº† CPU ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å·¥ä½œåŸç†. ç®€å•å›é¡¾ä¸€ä¸‹, CPU ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä¿è¯ Linux ç³»ç»Ÿæ­£å¸¸å·¥ä½œçš„ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½, æŒ‰ç…§ä¸åŒåœºæ™¯, å¯ä»¥åˆ†ä¸º"),a("mark",[a("strong",[s._v("è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢, çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢")])]),s._v(".")]),s._v(" "),a("p",[s._v("ä»Šå¤©å°±æ¥ç€æ¥çœ‹, ç©¶ç«Ÿæ€ä¹ˆåˆ†æ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ€ä¹ˆæŸ¥çœ‹ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ€ä¹ˆæŸ¥çœ‹ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ"}},[s._v("#")]),s._v(" 1.æ€ä¹ˆæŸ¥çœ‹ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ")]),s._v(" "),a("p",[s._v("é€šè¿‡å‰é¢å­¦ä¹ å¯çŸ¥, è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢, "),a("strong",[s._v("ä¼šæŠŠ CPU æ—¶é—´æ¶ˆè€—åœ¨å¯„å­˜å™¨, å†…æ ¸æ ˆä»¥åŠè™šæ‹Ÿå†…å­˜ç­‰æ•°æ®çš„ä¿å­˜å’Œæ¢å¤ä¸Š, ç¼©çŸ­è¿›ç¨‹çœŸæ­£è¿è¡Œçš„æ—¶é—´")]),s._v(", æˆäº†ç³»ç»Ÿæ€§èƒ½å¤§å¹…ä¸‹é™çš„ä¸€ä¸ªå…ƒå‡¶.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“é‚£ä¹ˆå¤§, ä½ è‚¯å®šè¿«ä¸åŠå¾…æƒ³çŸ¥é“, åˆ°åº•è¦æ€ä¹ˆæŸ¥çœ‹ä¸Šä¸‹æ–‡åˆ‡æ¢å‘¢? åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ vmstat è¿™ä¸ªå·¥å…·, æ¥æŸ¥è¯¢ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ. "),a("strong",[s._v("vmstat æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç³»ç»Ÿæ€§èƒ½åˆ†æå·¥å…·, ä¸»è¦ç”¨æ¥åˆ†æç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µ, ä¹Ÿå¸¸ç”¨æ¥åˆ†æ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¸­æ–­çš„æ¬¡æ•°")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä¸‹é¢å°±æ˜¯ä¸€ä¸ª vmstat çš„ä½¿ç”¨ç¤ºä¾‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 5 ç§’è¾“å‡º 1 ç»„æ•°æ®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vmstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005360")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91564")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("818900")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("é‡ç‚¹å¼ºè°ƒä¸‹éœ€è¦ç‰¹åˆ«å…³æ³¨çš„å››åˆ—å†…å®¹:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("cs(context switch)æ˜¯æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("in(interrupt)åˆ™æ˜¯æ¯ç§’ä¸­æ–­çš„æ¬¡æ•°")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("r(Running or Runnable)æ˜¯å°±ç»ªé˜Ÿåˆ—çš„é•¿åº¦")]),s._v(", ä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œå’Œç­‰å¾… CPU çš„è¿›ç¨‹æ•°.")]),s._v(" "),a("li",[a("strong",[s._v("b(Blocked)åˆ™æ˜¯å¤„äºä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€çš„è¿›ç¨‹æ•°")]),s._v(".")])]),s._v(" "),a("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªä¾‹å­ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•° cs æ˜¯ 33 æ¬¡, è€Œç³»ç»Ÿä¸­æ–­æ¬¡æ•° in åˆ™æ˜¯ 25 æ¬¡, è€Œå°±ç»ªé˜Ÿåˆ—é•¿åº¦ r å’Œä¸å¯ä¸­æ–­çŠ¶æ€è¿›ç¨‹æ•° b éƒ½æ˜¯ 0.")]),s._v(" "),a("p",[s._v("vmstat åªç»™å‡ºäº†ç³»ç»Ÿ"),a("strong",[s._v("æ€»ä½“çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ")]),s._v(", è¦æƒ³æŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹çš„è¯¦ç»†æƒ…å†µ, å°±éœ€è¦ä½¿ç”¨å‰é¢æåˆ°è¿‡çš„ "),a("strong",[s._v("pidstat")]),s._v(" äº†. ç»™å®ƒåŠ ä¸Š -w é€‰é¡¹, å°±å¯ä»¥æŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æƒ…å†µäº†.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 5 ç§’è¾“å‡º 1 ç»„æ•°æ®")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nLinux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.15")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  09/23/18  _x86_64_  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CPU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n08:18:26      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   cswch/s nvcswch/s  Command\n08:18:31        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.20")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  systemd\n08:18:31        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.40")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  rcu_sched\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("è¿™ä¸ªç»“æœä¸­æœ‰ä¸¤åˆ—å†…å®¹æ˜¯é‡ç‚¹å…³æ³¨å¯¹è±¡. ä¸€ä¸ªæ˜¯ "),a("strong",[s._v("cswch , è¡¨ç¤ºæ¯ç§’è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢(voluntary context switches)çš„æ¬¡æ•°, å¦ä¸€ä¸ªåˆ™æ˜¯ nvcswch , è¡¨ç¤ºæ¯ç§’éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢(non voluntary context switches)çš„æ¬¡æ•°")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™ä¸¤ä¸ªæ¦‚å¿µä¸€å®šè¦ç‰¢ç‰¢è®°ä½, å› ä¸ºå®ƒä»¬æ„å‘³ç€ä¸åŒçš„æ€§èƒ½é—®é¢˜:")]),s._v(" "),a("ul",[a("li",[s._v("æ‰€è°“"),a("mark",[a("strong",[s._v("è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢")])]),s._v("â€‹ "),a("strong",[s._v(", æ˜¯æŒ‡è¿›ç¨‹æ— æ³•è·å–æ‰€éœ€èµ„æº, å¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(". æ¯”å¦‚ I/O, å†…å­˜ç­‰ç³»ç»Ÿèµ„æºä¸è¶³æ—¶, å°±ä¼šå‘ç”Ÿè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢.")]),s._v(" "),a("li",[s._v("è€Œ"),a("mark",[a("strong",[s._v("éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢")])]),s._v("â€‹ "),a("strong",[s._v(", åˆ™æ˜¯æŒ‡è¿›ç¨‹ç”±äºæ—¶é—´ç‰‡å·²åˆ°ç­‰åŸå› , è¢«ç³»ç»Ÿå¼ºåˆ¶è°ƒåº¦, è¿›è€Œå‘ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(". æ¯”å¦‚è¯´, å¤§é‡è¿›ç¨‹éƒ½åœ¨äº‰æŠ¢ CPU æ—¶, å°±å®¹æ˜“å‘ç”Ÿéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢.")])]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("çŸ¥é“äº†æ€ä¹ˆæŸ¥çœ‹è¿™äº›æŒ‡æ ‡, å¦ä¸€ä¸ªé—®é¢˜åˆæ¥äº†, ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç‡æ˜¯å¤šå°‘æ¬¡æ‰ç®—æ­£å¸¸å‘¢? åˆ«æ€¥ç€è¦ç­”æ¡ˆ, åŒæ ·çš„, å…ˆæ¥çœ‹ä¸€ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¡ˆä¾‹. é€šè¿‡æ¡ˆä¾‹å®æˆ˜æ¼”ç»ƒ, ä½ è‡ªå·±å°±å¯ä»¥åˆ†æå¹¶æ‰¾å‡ºè¿™ä¸ªæ ‡å‡†äº†.")]),s._v(" "),a("h6",{attrs:{id:"_1-å‡†å¤‡å·¥ä½œ-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å‡†å¤‡å·¥ä½œ-2"}},[s._v("#")]),s._v(" (1)å‡†å¤‡å·¥ä½œ")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å°†ä½¿ç”¨ sysbench æ¥æ¨¡æ‹Ÿç³»ç»Ÿå¤šçº¿ç¨‹è°ƒåº¦åˆ‡æ¢çš„æƒ…å†µ.")]),s._v(" "),a("p",[a("strong",[s._v("sysbench æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹çš„åŸºå‡†æµ‹è¯•å·¥å…·, ä¸€èˆ¬ç”¨æ¥è¯„ä¼°ä¸åŒç³»ç»Ÿå‚æ•°ä¸‹çš„æ•°æ®åº“è´Ÿè½½æƒ…å†µ")]),s._v(". å½“ç„¶, åœ¨è¿™æ¬¡æ¡ˆä¾‹ä¸­, åªæŠŠå®ƒå½“æˆä¸€ä¸ªå¼‚å¸¸è¿›ç¨‹æ¥çœ‹, ä½œç”¨æ˜¯æ¨¡æ‹Ÿä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡å¤šçš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("ä¸‹é¢çš„æ¡ˆä¾‹åŸºäº Ubuntu 18.04, å½“ç„¶å…¶ä»–çš„ Linux ç³»ç»ŸåŒæ ·é€‚ç”¨. æˆ‘ä½¿ç”¨çš„æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… sysbench å’Œ sysstat åŒ…, å¦‚ apt install sysbench sysstat")])]),s._v(" "),a("p",[s._v("æ­£å¼æ“ä½œå¼€å§‹å‰, éœ€è¦æ‰“å¼€ä¸‰ä¸ªç»ˆç«¯, ç™»å½•åˆ°åŒä¸€å° Linux æœºå™¨ä¸­, å¹¶å®‰è£…å¥½ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªè½¯ä»¶åŒ….")]),s._v(" "),a("p",[s._v("å¦å¤–æ³¨æ„, ä¸‹é¢æ‰€æœ‰å‘½ä»¤, éƒ½"),a("strong",[s._v("é»˜è®¤ä»¥ root ç”¨æˆ·è¿è¡Œ")]),s._v(". æ‰€ä»¥, å¦‚æœæ˜¯ç”¨æ™®é€šç”¨æˆ·ç™»é™†çš„ç³»ç»Ÿ, è®°ä½å…ˆè¿è¡Œ sudo su root å‘½ä»¤åˆ‡æ¢åˆ° root ç”¨æˆ·.")]),s._v(" "),a("p",[s._v("å®‰è£…å®Œæˆå, å¯ä»¥å…ˆç”¨ vmstat çœ‹ä¸€ä¸‹ç©ºé—²ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é—´éš” 1 ç§’åè¾“å‡º 1 ç»„æ•°æ®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vmstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6984064")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92668")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("830896")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, ç°åœ¨çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•° cs æ˜¯ 35, è€Œä¸­æ–­æ¬¡æ•° in æ˜¯ 19, r å’Œ b éƒ½æ˜¯ 0. å› ä¸ºè¿™ä¼šå„¿å¹¶æ²¡æœ‰è¿è¡Œå…¶ä»–ä»»åŠ¡, æ‰€ä»¥å®ƒä»¬å°±æ˜¯ç©ºé—²ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°.")]),s._v(" "),a("h6",{attrs:{id:"_2-æ“ä½œå’Œåˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ“ä½œå’Œåˆ†æ"}},[s._v("#")]),s._v(" (2)æ“ä½œå’Œåˆ†æ")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥æ­£å¼è¿›å…¥å®æˆ˜æ“ä½œ.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯é‡Œè¿è¡Œ sysbench , æ¨¡æ‹Ÿç³»ç»Ÿå¤šçº¿ç¨‹è°ƒåº¦çš„ç“¶é¢ˆ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä»¥ 10 ä¸ªçº¿ç¨‹è¿è¡Œ 5 åˆ†é’Ÿçš„åŸºå‡†æµ‹è¯•, æ¨¡æ‹Ÿå¤šçº¿ç¨‹åˆ‡æ¢çš„é—®é¢˜")]),s._v("\n$ sysbench "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--threads")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" --max-time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" threads run\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ç€, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œ vmstat, è§‚å¯Ÿä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 1 ç§’è¾“å‡º 1 ç»„æ•°æ®(éœ€è¦ Ctrl+C æ‰ç»“æŸ)")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vmstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6487428")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("118240")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1292772")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9019")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1398830")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6487428")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("118240")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1292772")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10191")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1392312")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("å¯ä»¥å‘ç°, cs åˆ—çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ä»ä¹‹å‰çš„ 35 "),a("strong",[s._v("éª¤ç„¶ä¸Šå‡åˆ°äº† 139 ä¸‡")]),s._v(". åŒæ—¶, æ³¨æ„è§‚å¯Ÿå…¶ä»–å‡ ä¸ªæŒ‡æ ‡:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("r åˆ—: å°±ç»ªé˜Ÿåˆ—çš„é•¿åº¦å·²ç»åˆ°äº† 8, è¿œè¿œè¶…è¿‡äº†ç³»ç»Ÿ CPU çš„ä¸ªæ•° 2, æ‰€ä»¥è‚¯å®šä¼šæœ‰å¤§é‡çš„ CPU ç«äº‰")]),s._v(".")]),s._v(" "),a("li",[s._v("us(user)å’Œ sy(system)åˆ—: è¿™ä¸¤åˆ—çš„ CPU ä½¿ç”¨ç‡åŠ èµ·æ¥ä¸Šå‡åˆ°äº† 100%, å…¶ä¸­"),a("strong",[s._v("ç³»ç»Ÿ CPU ä½¿ç”¨ç‡")]),s._v(", ä¹Ÿå°±æ˜¯ "),a("strong",[s._v("sy åˆ—é«˜è¾¾ 84%, è¯´æ˜ CPU ä¸»è¦æ˜¯è¢«å†…æ ¸å ç”¨")]),s._v("äº†.")]),s._v(" "),a("li",[s._v("in åˆ—: ä¸­æ–­æ¬¡æ•°ä¹Ÿä¸Šå‡åˆ°äº† 1 ä¸‡å·¦å³, è¯´æ˜"),a("strong",[s._v("ä¸­æ–­å¤„ç†")]),s._v("ä¹Ÿæ˜¯ä¸ªæ½œåœ¨çš„é—®é¢˜.")])]),s._v(" "),a("p",[s._v("ç»¼åˆè¿™å‡ ä¸ªæŒ‡æ ‡å¯ä»¥çŸ¥é“, "),a("strong",[s._v("ç³»ç»Ÿçš„å°±ç»ªé˜Ÿåˆ—è¿‡é•¿, ä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œå’Œç­‰å¾… CPU çš„è¿›ç¨‹æ•°è¿‡å¤š, å¯¼è‡´äº†å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢, è€Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆå¯¼è‡´äº†ç³»ç»Ÿ CPU çš„å ç”¨ç‡å‡é«˜")]),s._v(".")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆè¿›ç¨‹å¯¼è‡´äº†è¿™äº›é—®é¢˜å‘¢?")]),s._v(" "),a("p",[s._v("ç»§ç»­åˆ†æ, åœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯å†ç”¨ pidstat æ¥çœ‹ä¸€ä¸‹,  CPU å’Œè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 1 ç§’è¾“å‡º 1 ç»„æ•°æ®(éœ€è¦ Ctrl+C æ‰ç»“æŸ)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -w å‚æ•°è¡¨ç¤ºè¾“å‡ºè¿›ç¨‹åˆ‡æ¢æŒ‡æ ‡, è€Œ -u å‚æ•°åˆ™è¡¨ç¤ºè¾“å‡º CPU ä½¿ç”¨æŒ‡æ ‡")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n08:06:33      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10488")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  sysbench\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26326")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  kworker/u4:2\n \n08:06:33      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   cswch/s nvcswch/s  Command\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  rcu_sched\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  ksoftirqd/1\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("471")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  hv_balloon\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1230")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  iscsid\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4089")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  kworker/1:5\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4333")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  kworker/0:3\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10499")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("224.00")]),s._v("  pidstat\n08:06:34        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26326")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("236.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  kworker/u4:2\n08:06:34     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26784")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("223.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  sshd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("ä» pidstat çš„è¾“å‡ºå¯ä»¥å‘ç°, CPU ä½¿ç”¨ç‡çš„å‡é«˜æœç„¶æ˜¯ sysbench å¯¼è‡´çš„, "),a("strong",[s._v("å®ƒçš„ CPU ä½¿ç”¨ç‡å·²ç»è¾¾åˆ°äº† 100%")]),s._v(" . ä½†ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ™æ˜¯æ¥è‡ªå…¶ä»–è¿›ç¨‹, "),a("strong",[s._v("åŒ…æ‹¬éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç‡æœ€é«˜çš„ pidstat, ä»¥åŠè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç‡æœ€é«˜çš„å†…æ ¸çº¿ç¨‹ kworker å’Œ sshd")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ç»†å¿ƒçš„ä½ è‚¯å®šä¹Ÿå‘ç°äº†ä¸€ä¸ªæ€ªå¼‚çš„äº‹å„¿: pidstat è¾“å‡ºçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°, åŠ èµ·æ¥ä¹Ÿå°±å‡ ç™¾, æ¯” vmstat çš„ 139 ä¸‡æ˜æ˜¾å°äº†å¤ªå¤š. è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢? éš¾é“æ˜¯å·¥å…·æœ¬èº«å‡ºäº†é”™å—?")]),s._v(" "),a("p",[s._v("åˆ«ç€æ€¥, åœ¨æ€€ç–‘å·¥å…·ä¹‹å‰, å†æ¥å›æƒ³ä¸€ä¸‹, å‰é¢è®²åˆ°çš„å‡ ç§ä¸Šä¸‹æ–‡åˆ‡æ¢åœºæ™¯. å…¶ä¸­æœ‰ä¸€ç‚¹æåˆ°, "),a("strong",[s._v("Linux è°ƒåº¦çš„åŸºæœ¬å•ä½å®é™…ä¸Šæ˜¯çº¿ç¨‹")]),s._v(", è€Œåœºæ™¯ä¸­ sysbench æ¨¡æ‹Ÿçš„ä¹Ÿæ˜¯çº¿ç¨‹çš„è°ƒåº¦é—®é¢˜, é‚£æ˜¯ä¸æ˜¯ pidstat å¿½ç•¥äº†çº¿ç¨‹çš„æ•°æ®å‘¢?")]),s._v(" "),a("p",[s._v("é€šè¿‡è¿è¡Œ man pidstat, ä½ ä¼šå‘ç°, "),a("strong",[s._v("pidstat é»˜è®¤æ˜¾ç¤ºè¿›ç¨‹çš„æŒ‡æ ‡æ•°æ®, åŠ ä¸Š -t å‚æ•°å, æ‰ä¼šè¾“å‡ºçº¿ç¨‹çš„æŒ‡æ ‡")]),s._v(".")]),s._v(" "),a("p",[s._v("æ‰€ä»¥å¯ä»¥åœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯é‡Œ, Ctrl+C åœæ­¢åˆšæ‰çš„ pidstat å‘½ä»¤, å†åŠ ä¸Š -t å‚æ•°, é‡è¯•ä¸€ä¸‹çœ‹çœ‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 1 ç§’è¾“å‡ºä¸€ç»„æ•°æ®(éœ€è¦ Ctrl+C æ‰ç»“æŸ)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -wt å‚æ•°è¡¨ç¤ºè¾“å‡ºçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æŒ‡æ ‡")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-wt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n08:14:05      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("      TGID       TID   cswch/s nvcswch/s  Command\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n08:14:05        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10551")]),s._v("         -      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  sysbench\n08:14:05        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10551")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__sysbench\n08:14:05        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10552")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18911.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103740.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__sysbench\n08:14:05        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10553")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18915.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100955.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__sysbench\n08:14:05        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10554")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18827.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103954.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__sysbench\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("ç°åœ¨å°±èƒ½çœ‹åˆ°äº†, è™½ç„¶ sysbench è¿›ç¨‹(ä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹)çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°çœ‹èµ·æ¥å¹¶ä¸å¤š, ä½†å®ƒçš„"),a("strong",[s._v("å­çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°å´æœ‰å¾ˆå¤š")]),s._v(". çœ‹æ¥, ä¸Šä¸‹æ–‡åˆ‡æ¢ç½ªé­ç¥¸é¦–, è¿˜æ˜¯"),a("strong",[s._v("è¿‡å¤šçš„ sysbench çº¿ç¨‹")]),s._v(".")]),s._v(" "),a("p",[s._v("å·²ç»æ‰¾åˆ°äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°å¢å¤šçš„æ ¹æº, é‚£æ˜¯ä¸æ˜¯åˆ°è¿™å„¿å°±å¯ä»¥ç»“æŸäº†å‘¢?")]),s._v(" "),a("p",[s._v("å½“ç„¶ä¸æ˜¯. ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—, å‰é¢åœ¨è§‚å¯Ÿç³»ç»ŸæŒ‡æ ‡æ—¶, é™¤äº†ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç‡éª¤ç„¶å‡é«˜, è¿˜æœ‰ä¸€ä¸ªæŒ‡æ ‡ä¹Ÿæœ‰å¾ˆå¤§çš„å˜åŒ–. æ˜¯çš„, æ­£æ˜¯"),a("strong",[s._v("ä¸­æ–­æ¬¡æ•°")]),s._v(". ä¸­æ–­æ¬¡æ•°ä¹Ÿä¸Šå‡åˆ°äº† 1 ä¸‡, ä½†åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹çš„ä¸­æ–­ä¸Šå‡äº†, ç°åœ¨è¿˜ä¸æ¸…æ¥š. æ¥ä¸‹æ¥ç»§ç»­æŠ½ä¸å‰¥èŒ§æ‰¾æºå¤´.")]),s._v(" "),a("p",[a("strong",[s._v("æ—¢ç„¶æ˜¯ä¸­æ–­, é‚£å®ƒåªå‘ç”Ÿåœ¨å†…æ ¸æ€")]),s._v(", è€Œ pidstat åªæ˜¯ä¸€ä¸ªè¿›ç¨‹çš„æ€§èƒ½åˆ†æå·¥å…·, å¹¶ä¸æä¾›ä»»ä½•å…³äºä¸­æ–­çš„è¯¦ç»†ä¿¡æ¯, æ€æ ·æ‰èƒ½çŸ¥é“ä¸­æ–­å‘ç”Ÿçš„ç±»å‹å‘¢?")]),s._v(" "),a("p",[s._v("æ²¡é”™, é‚£å°±æ˜¯ä» "),a("code",[s._v("/proc/interrupts")]),s._v("â€‹ è¿™ä¸ªåªè¯»æ–‡ä»¶ä¸­è¯»å–. /proc å®é™…ä¸Šæ˜¯ Linux çš„ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ, ç”¨äºå†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´çš„é€šä¿¡. "),a("code",[s._v("/proc/interrupts")]),s._v("â€‹ å°±æ˜¯è¿™ç§é€šä¿¡æœºåˆ¶çš„ä¸€éƒ¨åˆ†, æä¾›äº†ä¸€ä¸ªåªè¯»çš„ä¸­æ–­ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯åœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯é‡Œ, Ctrl+C åœæ­¢åˆšæ‰çš„ pidstat å‘½ä»¤, ç„¶åè¿è¡Œä¸‹é¢çš„å‘½ä»¤, è§‚å¯Ÿä¸­æ–­çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d å‚æ•°è¡¨ç¤ºé«˜äº®æ˜¾ç¤ºå˜åŒ–çš„åŒºåŸŸ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/interrupts\n           CPU0       CPU1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nRES:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2450431")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5279697")]),s._v("   Rescheduling interrupts\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿä¸€æ®µæ—¶é—´, å¯ä»¥å‘ç°, å˜åŒ–é€Ÿåº¦æœ€å¿«çš„æ˜¯"),a("strong",[s._v("é‡è°ƒåº¦ä¸­æ–­")]),s._v("(RES), è¿™ä¸ªä¸­æ–­ç±»å‹è¡¨ç¤º, å”¤é†’ç©ºé—²çŠ¶æ€çš„ CPU æ¥è°ƒåº¦æ–°çš„ä»»åŠ¡è¿è¡Œ. è¿™æ˜¯å¤šå¤„ç†å™¨ç³»ç»Ÿ(SMP)ä¸­, è°ƒåº¦å™¨ç”¨æ¥åˆ†æ•£ä»»åŠ¡åˆ°ä¸åŒ CPU çš„æœºåˆ¶, é€šå¸¸ä¹Ÿè¢«ç§°ä¸º"),a("strong",[s._v("å¤„ç†å™¨é—´ä¸­æ–­")]),s._v("(Inter-Processor Interrupts, IPI).")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, è¿™é‡Œçš„ä¸­æ–­å‡é«˜è¿˜æ˜¯å› ä¸º"),a("strong",[s._v("è¿‡å¤šä»»åŠ¡çš„è°ƒåº¦é—®é¢˜")]),s._v(", è·Ÿå‰é¢ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°çš„åˆ†æç»“æœæ˜¯ä¸€è‡´çš„.")]),s._v(" "),a("p",[s._v("é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹, ä½ åº”è¯¥ä¹Ÿå‘ç°äº†å¤šå·¥å…·, å¤šæ–¹é¢æŒ‡æ ‡å¯¹æ¯”è§‚æµ‹çš„å¥½å¤„. å¦‚æœæœ€å¼€å§‹æ—¶, åªç”¨äº† pidstat è§‚æµ‹, è¿™äº›å¾ˆä¸¥é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çº¿ç¨‹, å‹æ ¹å„¿å°±å‘ç°ä¸äº†äº†.")]),s._v(" "),a("p",[s._v("ç°åœ¨å†å›åˆ°æœ€åˆçš„é—®é¢˜, "),a("strong",[s._v("æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢å¤šå°‘æ¬¡æ‰ç®—æ­£å¸¸")]),s._v("å‘¢? "),a("strong",[s._v("è¿™ä¸ªæ•°å€¼å…¶å®å–å†³äºç³»ç»Ÿæœ¬èº«çš„ CPU æ€§èƒ½")]),s._v(". åœ¨æˆ‘çœ‹æ¥, å¦‚æœç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°æ¯”è¾ƒç¨³å®š, é‚£ä¹ˆä»æ•°ç™¾åˆ°ä¸€ä¸‡ä»¥å†…, éƒ½åº”è¯¥ç®—æ˜¯æ­£å¸¸çš„. "),a("strong",[s._v("ä½†å½“ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°è¶…è¿‡ä¸€ä¸‡æ¬¡, æˆ–è€…åˆ‡æ¢æ¬¡æ•°å‡ºç°æ•°é‡çº§çš„å¢é•¿æ—¶, å°±å¾ˆå¯èƒ½å·²ç»å‡ºç°äº†æ€§èƒ½é—®é¢˜")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™æ—¶è¿˜éœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç±»å‹, å†åšå…·ä½“åˆ†æ. æ¯”æ–¹è¯´:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢å˜å¤šäº†, è¯´æ˜è¿›ç¨‹éƒ½åœ¨ç­‰å¾…èµ„æº, æœ‰å¯èƒ½å‘ç”Ÿäº† I/O ç­‰å…¶ä»–é—®é¢˜")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢å˜å¤šäº†, è¯´æ˜è¿›ç¨‹éƒ½åœ¨è¢«å¼ºåˆ¶è°ƒåº¦, ä¹Ÿå°±æ˜¯éƒ½åœ¨äº‰æŠ¢ CPU, è¯´æ˜ CPU çš„ç¡®æˆäº†ç“¶é¢ˆ")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("ä¸­æ–­æ¬¡æ•°å˜å¤šäº†, è¯´æ˜ CPU è¢«ä¸­æ–­å¤„ç†ç¨‹åºå ç”¨, è¿˜éœ€è¦é€šè¿‡æŸ¥çœ‹ /proc/interrupts æ–‡ä»¶æ¥åˆ†æå…·ä½“çš„ä¸­æ–­ç±»å‹")]),s._v(".")])]),s._v(" "),a("h4",{attrs:{id:"_05-åŸºç¡€ç¯‡-æŸä¸ªåº”ç”¨çš„cpuä½¿ç”¨ç‡å±…ç„¶è¾¾åˆ°100-è¯¥æ€ä¹ˆåŠ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_05-åŸºç¡€ç¯‡-æŸä¸ªåº”ç”¨çš„cpuä½¿ç”¨ç‡å±…ç„¶è¾¾åˆ°100-è¯¥æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 05-åŸºç¡€ç¯‡:æŸä¸ªåº”ç”¨çš„CPUä½¿ç”¨ç‡å±…ç„¶è¾¾åˆ°100%,è¯¥æ€ä¹ˆåŠ?")]),s._v(" "),a("p",[s._v("é€šè¿‡å‰ä¸¤èŠ‚å¯¹å¹³å‡è´Ÿè½½å’Œ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å­¦ä¹ , æˆ‘ç›¸ä¿¡ä½ å¯¹ CPU çš„æ€§èƒ½å·²ç»æœ‰äº†åˆæ­¥äº†è§£. ä¸è¿‡æˆ‘è¿˜æ˜¯æƒ³é—®ä¸€ä¸‹, åœ¨å­¦è¿™ä¸ªä¸“æ å‰, ä½ æœ€å¸¸ç”¨ä»€ä¹ˆæŒ‡æ ‡æ¥æè¿°ç³»ç»Ÿçš„ CPU æ€§èƒ½å‘¢? æˆ‘æƒ³ä½ çš„ç­”æ¡ˆ, å¯èƒ½ä¸æ˜¯å¹³å‡è´Ÿè½½, ä¹Ÿä¸æ˜¯ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢, è€Œæ˜¯å¦ä¸€ä¸ªæ›´ç›´è§‚çš„æŒ‡æ ‡--CPU ä½¿ç”¨ç‡.")]),s._v(" "),a("p",[s._v("å‰é¢è¯´è¿‡, "),a("strong",[s._v("CPU ä½¿ç”¨ç‡æ˜¯å•ä½æ—¶é—´å†… CPU ä½¿ç”¨æƒ…å†µçš„ç»Ÿè®¡, ä»¥ç™¾åˆ†æ¯”çš„æ–¹å¼å±•ç¤º")]),s._v(". é‚£ä¹ˆ, ä½œä¸ºæœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€ç†Ÿæ‚‰çš„ CPU æŒ‡æ ‡, ä½ èƒ½è¯´å‡º CPU ä½¿ç”¨ç‡åˆ°åº•æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„å—? å†æœ‰, è¯¸å¦‚ top, ps ä¹‹ç±»çš„æ€§èƒ½å·¥å…·å±•ç¤ºçš„ %user, %nice, %system, %iowait, %steal ç­‰ç­‰, ä½ åˆèƒ½å¼„æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„ä¸åŒå—?")]),s._v(" "),a("p",[s._v("ä»Šå¤©å°±äº†è§£ CPU ä½¿ç”¨ç‡çš„å†…å®¹, åŒæ—¶ä¹Ÿä¼šä»¥å¸¸ç”¨çš„åå‘ä»£ç†æœåŠ¡å™¨ Nginx ä¸ºä¾‹, ä¸€æ­¥æ­¥æ“ä½œå’Œåˆ†æä¸­æ·±å…¥ç†è§£.")]),s._v(" "),a("h5",{attrs:{id:"_1-cpuä½¿ç”¨ç‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-cpuä½¿ç”¨ç‡"}},[s._v("#")]),s._v(" 1.CPUä½¿ç”¨ç‡")]),s._v(" "),a("p",[s._v("åœ¨ä¸Šä¸€æœŸæåˆ°, Linux ä½œä¸ºä¸€ä¸ªå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿ, å°†æ¯ä¸ª CPU çš„æ—¶é—´åˆ’åˆ†ä¸ºå¾ˆçŸ­çš„æ—¶é—´ç‰‡, å†é€šè¿‡è°ƒåº¦å™¨è½®æµåˆ†é…ç»™å„ä¸ªä»»åŠ¡ä½¿ç”¨, å› æ­¤é€ æˆå¤šä»»åŠ¡åŒæ—¶è¿è¡Œçš„é”™è§‰.")]),s._v(" "),a("p",[s._v("ä¸ºäº†ç»´æŠ¤ CPU æ—¶é—´, Linux é€šè¿‡äº‹å…ˆå®šä¹‰çš„"),a("strong",[s._v("èŠ‚æ‹ç‡")]),s._v("(å†…æ ¸ä¸­è¡¨ç¤ºä¸º HZ), è§¦å‘æ—¶é—´ä¸­æ–­, å¹¶ä½¿ç”¨å…¨å±€å˜é‡ Jiffies è®°å½•äº†å¼€æœºä»¥æ¥çš„èŠ‚æ‹æ•°. æ¯å‘ç”Ÿä¸€æ¬¡æ—¶é—´ä¸­æ–­, Jiffies çš„å€¼å°±åŠ  1.")]),s._v(" "),a("p",[s._v("èŠ‚æ‹ç‡ HZ æ˜¯å†…æ ¸çš„å¯é…é€‰é¡¹, å¯ä»¥è®¾ç½®ä¸º 100, 250, 1000 ç­‰. ä¸åŒçš„ç³»ç»Ÿå¯èƒ½è®¾ç½®ä¸åŒæ•°å€¼, å¯ä»¥æŸ¥è¯¢ "),a("code",[s._v("/boot/config")]),s._v("â€‹ å†…æ ¸é€‰é¡¹æ¥æŸ¥çœ‹å®ƒçš„é…ç½®å€¼. æ¯”å¦‚å®éªŒç³»ç»Ÿä¸­, èŠ‚æ‹ç‡è®¾ç½®æˆäº† 250, ä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿè§¦å‘ 250 æ¬¡æ—¶é—´ä¸­æ–­.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CONFIG_HZ='")]),s._v(" /boot/config-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG_HZ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("åŒæ—¶, æ­£å› ä¸ºèŠ‚æ‹ç‡ HZ æ˜¯å†…æ ¸é€‰é¡¹, æ‰€ä»¥ç”¨æˆ·ç©ºé—´ç¨‹åºå¹¶ä¸èƒ½ç›´æ¥è®¿é—®. ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ç©ºé—´ç¨‹åº, å†…æ ¸è¿˜æä¾›äº†ä¸€ä¸ª"),a("strong",[s._v("ç”¨æˆ·ç©ºé—´èŠ‚æ‹ç‡ USER_HZ, å®ƒæ€»æ˜¯å›ºå®šä¸º 100")]),s._v(", ä¹Ÿå°±æ˜¯ 1/100 ç§’. è¿™æ ·ç”¨æˆ·ç©ºé—´ç¨‹åºå¹¶ä¸éœ€è¦å…³å¿ƒå†…æ ¸ä¸­ HZ è¢«è®¾ç½®æˆäº†å¤šå°‘, å› ä¸ºå®ƒçœ‹åˆ°çš„æ€»æ˜¯å›ºå®šå€¼ USER_HZ.")]),s._v(" "),a("p",[s._v("Linux é€šè¿‡ "),a("code",[s._v("/proc")]),s._v("â€‹ è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ, å‘ç”¨æˆ·ç©ºé—´æä¾›äº†ç³»ç»Ÿå†…éƒ¨çŠ¶æ€çš„ä¿¡æ¯, è€Œ "),a("code",[s._v("/proc/stat")]),s._v("â€‹ æä¾›çš„å°±æ˜¯ç³»ç»Ÿçš„ "),a("strong",[s._v("CPU å’Œä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯")]),s._v(". å¦‚æœåªå…³æ³¨ CPU çš„è¯, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åªä¿ç•™å„ä¸ª CPU çš„æ•°æ®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/stat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ^cpu\ncpu  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("280580")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7407")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("286084")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172900810")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83602")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("583")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ncpu0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("144745")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4181")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176701")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86423902")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52076")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ncpu1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("135834")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3226")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("109383")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86476907")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31525")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("282")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("è¿™é‡Œçš„è¾“å‡ºç»“æœæ˜¯ä¸€ä¸ªè¡¨æ ¼. å…¶ä¸­ç¬¬ä¸€åˆ—è¡¨ç¤ºçš„æ˜¯ "),a("strong",[s._v("CPU ç¼–å·")]),s._v(", å¦‚ cpu0, cpu1, è€Œç¬¬ä¸€è¡Œæ²¡æœ‰ç¼–å·çš„ cpu, è¡¨ç¤ºçš„æ˜¯"),a("strong",[s._v("æ‰€æœ‰ CPU çš„ç´¯åŠ ")]),s._v(". å…¶ä»–åˆ—åˆ™è¡¨ç¤ºä¸åŒåœºæ™¯ä¸‹ CPU çš„ç´¯åŠ èŠ‚æ‹æ•°, å®ƒçš„å•ä½æ˜¯ USER_HZ, ä¹Ÿå°±æ˜¯ 10 ms(1/100 ç§’), æ‰€ä»¥è¿™å…¶å®å°±æ˜¯ä¸åŒåœºæ™¯ä¸‹çš„ CPU æ—¶é—´.")]),s._v(" "),a("p",[s._v("å½“ç„¶, è¿™é‡Œæ¯ä¸€åˆ—çš„é¡ºåºå¹¶ä¸éœ€è¦ä½ èƒŒä¸‹æ¥. åªè¦è®°ä½, æœ‰éœ€è¦çš„æ—¶å€™, æŸ¥è¯¢ man proc å°±å¯ä»¥. ä¸è¿‡, ä½ è¦æ¸…æ¥š man proc æ–‡æ¡£é‡Œæ¯ä¸€åˆ—çš„æ¶µä¹‰, å®ƒä»¬"),a("strong",[s._v("éƒ½æ˜¯ CPU ä½¿ç”¨ç‡ç›¸å…³çš„é‡è¦æŒ‡æ ‡")]),s._v(", ä½ è¿˜ä¼šåœ¨å¾ˆå¤šå…¶ä»–çš„æ€§èƒ½å·¥å…·ä¸­çœ‹åˆ°å®ƒä»¬. ä¸‹é¢, æ¥ä¾æ¬¡è§£è¯»ä¸€ä¸‹.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("user(é€šå¸¸ç¼©å†™ä¸º us), ä»£è¡¨ç”¨æˆ·æ€ CPU æ—¶é—´")]),s._v(". æ³¨æ„, å®ƒä¸åŒ…æ‹¬ä¸‹é¢çš„ nice æ—¶é—´, ä½†åŒ…æ‹¬äº† guest æ—¶é—´.")]),s._v(" "),a("li",[a("strong",[s._v("nice(é€šå¸¸ç¼©å†™ä¸º ni), ä»£è¡¨ä½ä¼˜å…ˆçº§ç”¨æˆ·æ€ CPU æ—¶é—´")]),s._v(", ä¹Ÿå°±æ˜¯è¿›ç¨‹çš„ nice å€¼è¢«è°ƒæ•´ä¸º 1-19 ä¹‹é—´æ—¶çš„ CPU æ—¶é—´. è¿™é‡Œæ³¨æ„, nice å¯å–å€¼èŒƒå›´æ˜¯ -20 åˆ° 19, æ•°å€¼è¶Šå¤§, ä¼˜å…ˆçº§åè€Œè¶Šä½.")]),s._v(" "),a("li",[a("strong",[s._v("system(é€šå¸¸ç¼©å†™ä¸º sys), ä»£è¡¨å†…æ ¸æ€ CPU æ—¶é—´")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("idle(é€šå¸¸ç¼©å†™ä¸º id), ä»£è¡¨ç©ºé—²æ—¶é—´")]),s._v(". æ³¨æ„, å®ƒä¸åŒ…æ‹¬ç­‰å¾… I/O çš„æ—¶é—´(iowait).")]),s._v(" "),a("li",[a("strong",[s._v("iowait(é€šå¸¸ç¼©å†™ä¸º wa), ä»£è¡¨ç­‰å¾… I/O çš„ CPU æ—¶é—´")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("irq(é€šå¸¸ç¼©å†™ä¸º hi), ä»£è¡¨å¤„ç†ç¡¬ä¸­æ–­çš„ CPU æ—¶é—´")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("softirq(é€šå¸¸ç¼©å†™ä¸º si), ä»£è¡¨å¤„ç†è½¯ä¸­æ–­çš„ CPU æ—¶é—´")]),s._v(".")]),s._v(" "),a("li",[s._v("steal(é€šå¸¸ç¼©å†™ä¸º st), ä»£è¡¨å½“ç³»ç»Ÿè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­çš„æ—¶å€™, è¢«å…¶ä»–è™šæ‹Ÿæœºå ç”¨çš„ CPU æ—¶é—´.")]),s._v(" "),a("li",[s._v("guest(é€šå¸¸ç¼©å†™ä¸º guest), ä»£è¡¨é€šè¿‡è™šæ‹ŸåŒ–è¿è¡Œå…¶ä»–æ“ä½œç³»ç»Ÿçš„æ—¶é—´, ä¹Ÿå°±æ˜¯è¿è¡Œè™šæ‹Ÿæœºçš„ CPU æ—¶é—´.")]),s._v(" "),a("li",[s._v("guest_nice(é€šå¸¸ç¼©å†™ä¸º gnice), ä»£è¡¨ä»¥ä½ä¼˜å…ˆçº§è¿è¡Œè™šæ‹Ÿæœºçš„æ—¶é—´.")])]),s._v(" "),a("p",[s._v("è€Œé€šå¸¸æ‰€è¯´çš„ "),a("mark",[a("strong",[s._v("CPU ä½¿ç”¨ç‡, å°±æ˜¯é™¤äº†ç©ºé—²æ—¶é—´å¤–çš„å…¶ä»–æ—¶é—´å æ€» CPU æ—¶é—´çš„ç™¾åˆ†æ¯”")])]),s._v(", ç”¨å…¬å¼æ¥è¡¨ç¤ºå°±æ˜¯:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/327e321b40db46540623d6de344c5836-20230731161933-43tsuvg.png",alt:""}}),s._v("\næ ¹æ®è¿™ä¸ªå…¬å¼, å°±å¯ä»¥ä» "),a("code",[s._v("/proc/stat")]),s._v("â€‹ ä¸­çš„æ•°æ®, å¾ˆå®¹æ˜“åœ°è®¡ç®—å‡º CPU ä½¿ç”¨ç‡. å½“ç„¶, ä¹Ÿå¯ä»¥ç”¨æ¯ä¸€ä¸ªåœºæ™¯çš„ CPU æ—¶é—´, é™¤ä»¥æ€»çš„ CPU æ—¶é—´, è®¡ç®—å‡ºæ¯ä¸ªåœºæ™¯çš„ CPU ä½¿ç”¨ç‡.")]),s._v(" "),a("p",[s._v("ä¸è¿‡å…ˆä¸è¦ç€æ€¥è®¡ç®—, ä½ èƒ½è¯´å‡º, ç›´æ¥ç”¨ /proc/stat çš„æ•°æ®, ç®—çš„æ˜¯"),a("strong",[s._v("ä»€ä¹ˆæ—¶é—´æ®µçš„ CPU ä½¿ç”¨ç‡")]),s._v("å—? çœ‹åˆ°è¿™é‡Œ, ä½ åº”è¯¥æƒ³èµ·æ¥äº†, è¿™æ˜¯"),a("strong",[s._v("å¼€æœºä»¥æ¥")]),s._v("çš„èŠ‚æ‹æ•°ç´¯åŠ å€¼, æ‰€ä»¥ç›´æ¥ç®—å‡ºæ¥çš„, æ˜¯"),a("strong",[s._v("å¼€æœºä»¥æ¥çš„å¹³å‡ CPU ä½¿ç”¨ç‡")]),s._v(", ä¸€èˆ¬æ²¡å•¥å‚è€ƒä»·å€¼.")]),s._v(" "),a("p",[s._v("äº‹å®ä¸Š, ä¸ºäº†è®¡ç®— CPU ä½¿ç”¨ç‡, æ€§èƒ½å·¥å…·ä¸€èˆ¬éƒ½ä¼š"),a("strong",[s._v("å–é—´éš”ä¸€æ®µæ—¶é—´(æ¯”å¦‚ 3 ç§’)çš„ä¸¤æ¬¡å€¼")]),s._v(", ä½œå·®å, å†è®¡ç®—å‡ºè¿™æ®µæ—¶é—´å†…çš„å¹³å‡ CPU ä½¿ç”¨ç‡, å³")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/490c1e8b915a24e2b519b516ccfdabaa-20230731161933-k66kt78.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™ä¸ªå…¬å¼, å°±æ˜¯ç”¨å„ç§æ€§èƒ½å·¥å…·æ‰€çœ‹åˆ°çš„ CPU ä½¿ç”¨ç‡çš„å®é™…è®¡ç®—æ–¹æ³•.")]),s._v(" "),a("p",[s._v("ç°åœ¨çŸ¥é“äº†ç³»ç»Ÿ CPU ä½¿ç”¨ç‡çš„è®¡ç®—æ–¹æ³•, é‚£è¿›ç¨‹çš„å‘¢? è·Ÿç³»ç»Ÿçš„æŒ‡æ ‡ç±»ä¼¼, Linux ä¹Ÿç»™æ¯ä¸ªè¿›ç¨‹æä¾›äº†è¿è¡Œæƒ…å†µçš„ç»Ÿè®¡ä¿¡æ¯, ä¹Ÿå°±æ˜¯ "),a("code",[s._v("/proc/[pid]/stat")]),s._v("â€‹. ä¸è¿‡, è¿™ä¸ªæ–‡ä»¶åŒ…å«çš„æ•°æ®å°±æ¯”è¾ƒä¸°å¯Œäº†, æ€»å…±æœ‰ 52 åˆ—çš„æ•°æ®.")]),s._v(" "),a("p",[s._v("å½“ç„¶, ä¸ç”¨æ‹…å¿ƒ, å› ä¸ºå¹¶ä¸éœ€è¦æŒæ¡æ¯ä¸€åˆ—çš„å«ä¹‰. è¿˜æ˜¯é‚£å¥è¯, éœ€è¦çš„æ—¶å€™, æŸ¥ man proc å°±è¡Œ.")]),s._v(" "),a("p",[s._v("å›è¿‡å¤´æ¥çœ‹, æ˜¯ä¸æ˜¯è¯´è¦æŸ¥çœ‹ CPU ä½¿ç”¨ç‡, å°±å¿…é¡»å…ˆè¯»å– "),a("code",[s._v("/proc/stat")]),s._v("â€‹ å’Œ "),a("code",[s._v("/proc/[pid]/stat")]),s._v("â€‹ è¿™ä¸¤ä¸ªæ–‡ä»¶, ç„¶åå†æŒ‰ç…§ä¸Šé¢çš„å…¬å¼è®¡ç®—å‡ºæ¥å‘¢?")]),s._v(" "),a("p",[s._v("å½“ç„¶ä¸æ˜¯, å„ç§å„æ ·çš„æ€§èƒ½åˆ†æå·¥å…·å·²ç»è®¡ç®—å¥½äº†. ä¸è¿‡è¦æ³¨æ„çš„æ˜¯, "),a("mark",[a("strong",[s._v("æ€§èƒ½åˆ†æå·¥å…·ç»™å‡ºçš„éƒ½æ˜¯é—´éš”ä¸€æ®µæ—¶é—´çš„å¹³å‡ CPU ä½¿ç”¨ç‡, æ‰€ä»¥è¦æ³¨æ„é—´éš”æ—¶é—´çš„è®¾ç½®")])]),s._v(", ç‰¹åˆ«æ˜¯ç”¨å¤šä¸ªå·¥å…·å¯¹æ¯”åˆ†ææ—¶, ä¸€å®šè¦ä¿è¯å®ƒä»¬ç”¨çš„æ˜¯ç›¸åŒçš„é—´éš”æ—¶é—´.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å¯¹æ¯”ä¸€ä¸‹ top å’Œ ps è¿™ä¸¤ä¸ªå·¥å…·æŠ¥å‘Šçš„ CPU ä½¿ç”¨ç‡, é»˜è®¤çš„ç»“æœå¾ˆå¯èƒ½ä¸ä¸€æ ·, "),a("strong",[s._v("å› ä¸º top é»˜è®¤ä½¿ç”¨ 3 ç§’æ—¶é—´é—´éš”, è€Œ ps ä½¿ç”¨çš„å´æ˜¯è¿›ç¨‹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_2-æ€ä¹ˆæŸ¥çœ‹cpuä½¿ç”¨ç‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ€ä¹ˆæŸ¥çœ‹cpuä½¿ç”¨ç‡"}},[s._v("#")]),s._v(" 2.æ€ä¹ˆæŸ¥çœ‹CPUä½¿ç”¨ç‡")]),s._v(" "),a("p",[s._v("çŸ¥é“äº† CPU ä½¿ç”¨ç‡çš„å«ä¹‰å, å†æ¥çœ‹çœ‹è¦æ€ä¹ˆæŸ¥çœ‹ CPU ä½¿ç”¨ç‡. è¯´åˆ°æŸ¥çœ‹ CPU ä½¿ç”¨ç‡çš„å·¥å…·, æˆ‘çŒœä½ ç¬¬ä¸€ååº”è‚¯å®šæ˜¯ top å’Œ ps. çš„ç¡®, "),a("strong",[s._v("top å’Œ ps æ˜¯æœ€å¸¸ç”¨çš„æ€§èƒ½åˆ†æå·¥å…·")]),s._v(":")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("top æ˜¾ç¤ºäº†ç³»ç»Ÿæ€»ä½“çš„ CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ, ä»¥åŠå„ä¸ªè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µ")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("ps åˆ™åªæ˜¾ç¤ºäº†æ¯ä¸ªè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µ")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ¯”å¦‚, top çš„è¾“å‡ºæ ¼å¼ä¸º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é»˜è®¤æ¯ 3 ç§’åˆ·æ–°ä¸€æ¬¡")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":58:59 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" days, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":47,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.03")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.3")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169348")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5606884")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("334640")]),s._v(" used,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2227824")]),s._v(" buff/cache\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7497908")]),s._v(" avail Mem\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78088")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9288")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6696")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":16.83 systemd\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.05 kthreadd\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-20")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.00 kworker/0:0H\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè¾“å‡ºç»“æœä¸­, "),a("strong",[s._v("ç¬¬ä¸‰è¡Œ %Cpu å°±æ˜¯ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡")]),s._v(", å…·ä½“æ¯ä¸€åˆ—çš„å«ä¹‰ä¸Šä¸€èŠ‚è®²è¿‡, åªæ˜¯æŠŠ CPU æ—¶é—´å˜æ¢æˆäº† CPU ä½¿ç”¨ç‡, å°±ä¸å†é‡å¤è®²äº†. ä¸è¿‡éœ€è¦æ³¨æ„, "),a("strong",[s._v("top é»˜è®¤æ˜¾ç¤ºçš„æ˜¯æ‰€æœ‰ CPU çš„å¹³å‡å€¼")]),s._v(", è¿™ä¸ªæ—¶å€™åªéœ€è¦æŒ‰ä¸‹æ•°å­— 1 , å°±å¯ä»¥åˆ‡æ¢åˆ°æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡äº†.")]),s._v(" "),a("p",[s._v("ç»§ç»­å¾€ä¸‹çœ‹, "),a("strong",[s._v("ç©ºç™½è¡Œä¹‹åæ˜¯è¿›ç¨‹çš„å®æ—¶ä¿¡æ¯, æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª %CPU åˆ—, è¡¨ç¤ºè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡. å®ƒæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ CPU ä½¿ç”¨ç‡çš„æ€»å’Œ, åŒ…æ‹¬è¿›ç¨‹ç”¨æˆ·ç©ºé—´ä½¿ç”¨çš„ CPU, é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œçš„å†…æ ¸ç©ºé—´ CPU, ä»¥åŠåœ¨å°±ç»ªé˜Ÿåˆ—ç­‰å¾…è¿è¡Œçš„ CPU")]),s._v(". åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­, å®ƒè¿˜åŒ…æ‹¬äº†è¿è¡Œè™šæ‹Ÿæœºå ç”¨çš„ CPU.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, åˆ°è¿™é‡Œå¯ä»¥å‘ç°, top å¹¶"),a("strong",[s._v("æ²¡æœ‰ç»†åˆ†è¿›ç¨‹çš„ç”¨æˆ·æ€ CPU å’Œå†…æ ¸æ€ CPU")]),s._v(". é‚£è¦æ€ä¹ˆæŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹çš„è¯¦ç»†æƒ…å†µå‘¢? ä½ åº”è¯¥è¿˜è®°å¾—ä¸Šä¸€èŠ‚ç”¨åˆ°çš„ "),a("strong",[s._v("pidstat")]),s._v(" å§, å®ƒæ­£æ˜¯ä¸€ä¸ªä¸“é—¨åˆ†ææ¯ä¸ªè¿›ç¨‹ CPU ä½¿ç”¨æƒ…å†µçš„å·¥å…·.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚ä¸‹é¢çš„ pidstat å‘½ä»¤, å°±é—´éš” 1 ç§’å±•ç¤ºäº†è¿›ç¨‹çš„ 5 ç»„ CPU ä½¿ç”¨ç‡, åŒ…æ‹¬:")]),s._v(" "),a("ul",[a("li",[s._v("ç”¨æˆ·æ€ CPU ä½¿ç”¨ç‡ (%usr);")]),s._v(" "),a("li",[s._v("å†…æ ¸æ€ CPU ä½¿ç”¨ç‡(%system);")]),s._v(" "),a("li",[s._v("è¿è¡Œè™šæ‹Ÿæœº CPU ä½¿ç”¨ç‡(%guest);")]),s._v(" "),a("li",[s._v("ç­‰å¾… CPU ä½¿ç”¨ç‡(%wait);")]),s._v(" "),a("li",[s._v("ä»¥åŠæ€»çš„ CPU ä½¿ç”¨ç‡(%CPU).")])]),s._v(" "),a("p",[s._v("æœ€åçš„ Average éƒ¨åˆ†, è¿˜è®¡ç®—äº† 5 ç»„æ•°æ®çš„å¹³å‡å€¼.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 1 ç§’è¾“å‡ºä¸€ç»„æ•°æ®, å…±è¾“å‡º 5 ç»„")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":56:02      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":56:03        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15006")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.99")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.99")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  dockerd\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \nAverage:      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\nAverage:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15006")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.99")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.99")]),s._v("     -  dockerd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"_3-cpuä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-cpuä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 3.CPUä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠ?")]),s._v(" "),a("p",[s._v("é€šè¿‡ top, ps, pidstat ç­‰å·¥å…·, å°±èƒ½å¤Ÿè½»æ¾æ‰¾åˆ° CPU ä½¿ç”¨ç‡è¾ƒé«˜(æ¯”å¦‚ 100% )çš„è¿›ç¨‹. æ¥ä¸‹æ¥, ä½ å¯èƒ½åˆæƒ³çŸ¥é“, "),a("strong",[s._v("å ç”¨ CPU çš„åˆ°åº•æ˜¯ä»£ç é‡Œçš„å“ªä¸ªå‡½æ•°å‘¢")]),s._v("? æ‰¾åˆ°å®ƒ, ä½ æ‰èƒ½æ›´é«˜æ•ˆ, æ›´é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–.")]),s._v(" "),a("p",[s._v("æˆ‘çŒœä½ ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„, åº”è¯¥æ˜¯ "),a("strong",[s._v("GDB")]),s._v('(The GNU Project Debugger), è¿™ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç¨‹åºè°ƒè¯•åˆ©å™¨. çš„ç¡®, GDB åœ¨è°ƒè¯•ç¨‹åºé”™è¯¯æ–¹é¢å¾ˆå¼ºå¤§. ä½†æ˜¯, æˆ‘åˆè¦æ¥"æŒ‘åˆº"äº†. è¯·è®°ä½, '),a("strong",[s._v("GDB å¹¶ä¸é€‚åˆåœ¨æ€§èƒ½åˆ†æçš„æ—©æœŸåº”ç”¨")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸ºä»€ä¹ˆå‘¢? å› ä¸º GDB è°ƒè¯•ç¨‹åºçš„è¿‡ç¨‹ä¼šä¸­æ–­ç¨‹åºè¿è¡Œ, è¿™"),a("strong",[s._v("åœ¨çº¿ä¸Šç¯å¢ƒå¾€å¾€æ˜¯ä¸å…è®¸çš„")]),s._v(". æ‰€ä»¥, GDB åªé€‚åˆç”¨åœ¨æ€§èƒ½åˆ†æçš„åæœŸ, å½“æ‰¾åˆ°äº†å‡ºé—®é¢˜çš„å¤§è‡´å‡½æ•°å, çº¿ä¸‹å†å€ŸåŠ©å®ƒæ¥è¿›ä¸€æ­¥è°ƒè¯•å‡½æ•°å†…éƒ¨çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆå“ªç§å·¥å…·é€‚åˆåœ¨ç¬¬ä¸€æ—¶é—´åˆ†æè¿›ç¨‹çš„ CPU é—®é¢˜å‘¢? æˆ‘æ¨èæ˜¯ "),a("strong",[s._v("perf")]),s._v(". perf æ˜¯ Linux 2.6.31 ä»¥åå†…ç½®çš„æ€§èƒ½åˆ†æå·¥å…·. "),a("strong",[s._v("å®ƒä»¥æ€§èƒ½äº‹ä»¶é‡‡æ ·ä¸ºåŸºç¡€, ä¸ä»…å¯ä»¥åˆ†æç³»ç»Ÿçš„å„ç§äº‹ä»¶å’Œå†…æ ¸æ€§èƒ½, è¿˜å¯ä»¥ç”¨æ¥åˆ†ææŒ‡å®šåº”ç”¨ç¨‹åºçš„æ€§èƒ½é—®é¢˜")]),s._v(".")]),s._v(" "),a("p",[s._v("ä½¿ç”¨ perf åˆ†æ CPU æ€§èƒ½é—®é¢˜, æ¥è¯´ä¸¤ç§æœ€å¸¸è§, ä¹Ÿæ˜¯æˆ‘æœ€å–œæ¬¢çš„ç”¨æ³•.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç§å¸¸è§ç”¨æ³•æ˜¯ "),a("strong",[s._v("perf top")]),s._v(", ç±»ä¼¼äº top, å®ƒèƒ½å¤Ÿå®æ—¶"),a("strong",[s._v("æ˜¾ç¤ºå ç”¨ CPU æ—¶é’Ÿæœ€å¤šçš„å‡½æ•°æˆ–è€…æŒ‡ä»¤")]),s._v(", å› æ­¤å¯ä»¥ç”¨æ¥æŸ¥æ‰¾çƒ­ç‚¹å‡½æ•°, ä½¿ç”¨ç•Œé¢å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\nSamples: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("833")]),s._v("  of event "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cpu-clock'")]),s._v(", Event count "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("approx."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97742399")]),s._v("\nOverhead  Shared Object       Symbol\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.28")]),s._v("%  perf                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 0x00000000001f78a4\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.72")]),s._v("%  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kernel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" vsnprintf\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.32")]),s._v("%  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kernel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" module_get_kallsym\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.65")]),s._v("%  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kernel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" _raw_spin_unlock_irqrestore\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("è¾“å‡ºç»“æœä¸­, ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•°æ®, åˆ†åˆ«æ˜¯é‡‡æ ·æ•°(Samples), äº‹ä»¶ç±»å‹(event)å’Œäº‹ä»¶æ€»æ•°é‡(Event count). æ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­, perf æ€»å…±é‡‡é›†äº† 833 ä¸ª CPU æ—¶é’Ÿäº‹ä»¶, è€Œæ€»äº‹ä»¶æ•°åˆ™ä¸º 97742399.")]),s._v(" "),a("p",[s._v("å¦å¤–, "),a("strong",[s._v("é‡‡æ ·æ•°éœ€è¦ç‰¹åˆ«æ³¨æ„")]),s._v(". å¦‚æœé‡‡æ ·æ•°è¿‡å°‘(æ¯”å¦‚åªæœ‰åå‡ ä¸ª), é‚£ä¸‹é¢çš„æ’åºå’Œç™¾åˆ†æ¯”å°±æ²¡ä»€ä¹ˆå®é™…å‚è€ƒä»·å€¼äº†.")]),s._v(" "),a("p",[s._v("å†å¾€ä¸‹çœ‹æ˜¯ä¸€ä¸ªè¡¨æ ¼å¼æ ·çš„æ•°æ®, æ¯ä¸€è¡ŒåŒ…å«å››åˆ—, åˆ†åˆ«æ˜¯:")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€åˆ— Overhead, æ˜¯è¯¥ç¬¦å·çš„æ€§èƒ½äº‹ä»¶åœ¨æ‰€æœ‰é‡‡æ ·ä¸­çš„æ¯”ä¾‹, ç”¨ç™¾åˆ†æ¯”æ¥è¡¨ç¤º.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒåˆ— Shared, æ˜¯è¯¥å‡½æ•°æˆ–æŒ‡ä»¤æ‰€åœ¨çš„åŠ¨æ€å…±äº«å¯¹è±¡(Dynamic Shared Object), å¦‚å†…æ ¸, è¿›ç¨‹å, åŠ¨æ€é“¾æ¥åº“å, å†…æ ¸æ¨¡å—åç­‰.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰åˆ— Object, æ˜¯åŠ¨æ€å…±äº«å¯¹è±¡çš„ç±»å‹. æ¯”å¦‚ "),a("code",[s._v("[.]")]),s._v("â€‹ è¡¨ç¤ºç”¨æˆ·ç©ºé—´çš„å¯æ‰§è¡Œç¨‹åº, æˆ–è€…åŠ¨æ€é“¾æ¥åº“, è€Œ "),a("code",[s._v("[k]")]),s._v("â€‹ åˆ™è¡¨ç¤ºå†…æ ¸ç©ºé—´.")]),s._v(" "),a("li",[s._v("æœ€åä¸€åˆ— Symbol æ˜¯Â·Â·Â·")])]),s._v(" "),a("p",[s._v("è¿˜æ˜¯ä»¥ä¸Šé¢çš„è¾“å‡ºä¸ºä¾‹, å¯ä»¥çœ‹åˆ°, å ç”¨ CPU æ—¶é’Ÿæœ€å¤šçš„æ˜¯ perf å·¥å…·è‡ªèº«, ä¸è¿‡å®ƒçš„æ¯”ä¾‹ä¹Ÿåªæœ‰ 7.28%, è¯´æ˜ç³»ç»Ÿå¹¶æ²¡æœ‰ CPU æ€§èƒ½é—®é¢˜. perf top çš„ä½¿ç”¨ä½ åº”è¯¥å¾ˆæ¸…æ¥šäº†å§.")]),s._v(" "),a("p",[s._v("æ¥ç€å†æ¥çœ‹ç¬¬äºŒç§å¸¸è§ç”¨æ³•, ä¹Ÿå°±æ˜¯ "),a("strong",[s._v("perf record å’Œ perf report")]),s._v(". perf top è™½ç„¶å®æ—¶å±•ç¤ºäº†ç³»ç»Ÿçš„æ€§èƒ½ä¿¡æ¯, ä½†å®ƒçš„ç¼ºç‚¹æ˜¯å¹¶ä¸ä¿å­˜æ•°æ®, ä¹Ÿå°±æ— æ³•ç”¨äºç¦»çº¿æˆ–è€…åç»­çš„åˆ†æ. è€Œ perf record åˆ™æä¾›äº†ä¿å­˜æ•°æ®çš„åŠŸèƒ½, ä¿å­˜åçš„æ•°æ®, éœ€è¦ç”¨ perf report è§£æå±•ç¤º.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf record "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‰ Ctrl+C ç»ˆæ­¢é‡‡æ ·")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" perf record: Woken up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("times")]),s._v(" to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" perf record: Captured and wrote "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.452")]),s._v(" MB perf.data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6093")]),s._v(" samples"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n \n$ perf report "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å±•ç¤ºç±»ä¼¼äº perf top çš„æŠ¥å‘Š")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("åœ¨å®é™…ä½¿ç”¨ä¸­, è¿˜ç»å¸¸ä¸º perf top å’Œ perf record åŠ ä¸Š -g å‚æ•°, å¼€å¯è°ƒç”¨å…³ç³»çš„é‡‡æ ·, æ–¹ä¾¿æ ¹æ®è°ƒç”¨é“¾æ¥åˆ†ææ€§èƒ½é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_4-æ¡ˆä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ¡ˆä¾‹"}},[s._v("#")]),s._v(" 4.æ¡ˆä¾‹")]),s._v(" "),a("p",[s._v("ä¸‹é¢å°±ä»¥ Nginx + PHP çš„ Web æœåŠ¡ä¸ºä¾‹, æ¥çœ‹çœ‹"),a("mark",[a("strong",[s._v("å½“å‘ç° CPU ä½¿ç”¨ç‡è¿‡é«˜çš„é—®é¢˜å, è¦æ€ä¹ˆä½¿ç”¨ top ç­‰å·¥å…·æ‰¾å‡ºå¼‚å¸¸çš„è¿›ç¨‹, åˆè¦æ€ä¹ˆåˆ©ç”¨ perf æ‰¾å‡ºå¼•å‘æ€§èƒ½é—®é¢˜çš„å‡½æ•°")])]),s._v(".")]),s._v(" "),a("h6",{attrs:{id:"_1-å‡†å¤‡å·¥ä½œ-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å‡†å¤‡å·¥ä½œ-3"}},[s._v("#")]),s._v(" (1)å‡†å¤‡å·¥ä½œ")]),s._v(" "),a("p",[s._v("ä»¥ä¸‹æ¡ˆä¾‹åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sysstat, perf, ab ç­‰å·¥å…·, å¦‚ apt install "),a("a",{attrs:{href:"http://docker.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker.io"),a("OutboundLink")],1),s._v(" sysstat linux-tools-common apache2-utils")])]),s._v(" "),a("p",[s._v("å…ˆç®€å•ä»‹ç»ä¸€ä¸‹è¿™æ¬¡æ–°ä½¿ç”¨çš„å·¥å…· ab. ab(apache bench)æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ HTTP æœåŠ¡æ€§èƒ½æµ‹è¯•å·¥å…·, è¿™é‡Œç”¨æ¥æ¨¡æ‹Ÿ Ngnix çš„å®¢æˆ·ç«¯. ç”±äº Nginx å’Œ PHP çš„é…ç½®æ¯”è¾ƒéº»çƒ¦, æˆ‘æŠŠå®ƒä»¬æ‰“åŒ…æˆäº†ä¸¤ä¸ª "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/tree/master/nginx-high-cpu",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker é•œåƒ"),a("OutboundLink")],1),s._v(", è¿™æ ·åªéœ€è¦è¿è¡Œä¸¤ä¸ªå®¹å™¨, å°±å¯ä»¥å¾—åˆ°æ¨¡æ‹Ÿç¯å¢ƒ.")]),s._v(" "),a("p",[s._v("æ³¨æ„, è¿™ä¸ªæ¡ˆä¾‹è¦ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœº, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ea6315bcd1467b86b5d5e9016c3368a5-20230731161933-sw0gbd6.png",alt:""}})]),s._v(" "),a("p",[s._v('å¯ä»¥çœ‹åˆ°, å…¶ä¸­ä¸€å°ç”¨ä½œ Web æœåŠ¡å™¨, æ¥æ¨¡æ‹Ÿæ€§èƒ½é—®é¢˜; å¦ä¸€å°ç”¨ä½œ Web æœåŠ¡å™¨çš„å®¢æˆ·ç«¯, æ¥ç»™ Web æœåŠ¡å¢åŠ å‹åŠ›è¯·æ±‚. ä½¿ç”¨ä¸¤å°è™šæ‹Ÿæœºæ˜¯ä¸ºäº†ç›¸äº’éš”ç¦», é¿å… "äº¤å‰æ„ŸæŸ“".')]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯, åˆ†åˆ« SSH ç™»å½•åˆ°ä¸¤å°æœºå™¨ä¸Š, å¹¶å®‰è£…ä¸Šé¢æåˆ°çš„å·¥å…·. ä¸‹é¢çš„æ‰€æœ‰å‘½ä»¤, éƒ½é»˜è®¤å‡è®¾ä»¥ root ç”¨æˆ·è¿è¡Œ.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, æ“ä½œä¹‹å‰è¿˜æƒ³å†è¯´ä¸€ç‚¹. è¿™æ¬¡æ¡ˆä¾‹ä¸­ PHP åº”ç”¨çš„æ ¸å¿ƒé€»è¾‘æ¯”è¾ƒç®€å•, å¤§éƒ¨åˆ†äººä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºé—®é¢˜, ä½†ä½ è¦çŸ¥é“, å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„æºç å°±å¤æ‚å¤šäº†.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, å¸Œæœ›åœ¨æŒ‰ç…§æ­¥éª¤æ“ä½œä¹‹å‰, å…ˆä¸è¦æŸ¥çœ‹æºç (é¿å…å…ˆå…¥ä¸ºä¸»), è€Œæ˜¯"),a("strong",[s._v("æŠŠå®ƒå½“æˆä¸€ä¸ªé»‘ç›’æ¥åˆ†æ.")]),s._v("  è¿™æ ·å¯ä»¥æ›´å¥½åœ°ç†è§£æ•´ä¸ªè§£å†³æ€è·¯, æ€ä¹ˆä»ç³»ç»Ÿçš„èµ„æºä½¿ç”¨é—®é¢˜å‡ºå‘, åˆ†æå‡ºç“¶é¢ˆæ‰€åœ¨çš„åº”ç”¨, ä»¥åŠç“¶é¢ˆåœ¨åº”ç”¨ä¸­çš„å¤§æ¦‚ä½ç½®.")]),s._v(" "),a("h6",{attrs:{id:"_2-æ“ä½œå’Œåˆ†æ-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ“ä½œå’Œåˆ†æ-2"}},[s._v("#")]),s._v(" (2)æ“ä½œå’Œåˆ†æ")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, æ­£å¼è¿›å…¥æ“ä½œç¯èŠ‚.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œ Nginx å’Œ PHP åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" phpfpm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" container:nginx feisky/php-fpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶å, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä½¿ç”¨ curl è®¿é—® "),a("code",[s._v("http://[VM1 çš„ IP]:10000")]),s._v("â€‹, ç¡®è®¤ Nginx å·²æ­£å¸¸å¯åŠ¨. åº”è¯¥å¯ä»¥çœ‹åˆ° It works! çš„å“åº”.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 192.168.0.10 æ˜¯ç¬¬ä¸€å°è™šæ‹Ÿæœºçš„ IP åœ°å€")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/\nIt works"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æ¥ç€æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ª Nginx æœåŠ¡çš„æ€§èƒ½. åœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œä¸‹é¢çš„ ab å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¹¶å‘ 10 ä¸ªè¯·æ±‚æµ‹è¯• Nginx æ€§èƒ½, æ€»å…±æµ‹è¯• 100 ä¸ªè¯·æ±‚")]),s._v("\n$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" http://192.168.0.10:10000/\nThis is ApacheBench, Version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Revision")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1706008")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nCopyright "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1996")]),s._v(" Adam Twiss, Zeus Technology Ltd, \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.63")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("859.942")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä» ab çš„è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°, Nginx èƒ½æ‰¿å—çš„æ¯ç§’å¹³å‡è¯·æ±‚æ•°åªæœ‰ 11.63. ä½ ä¸€å®šåœ¨åæ§½, è¿™ä¹Ÿå¤ªå·®äº†å§. é‚£åˆ°åº•æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜å‘¢? ç”¨ top å’Œ pidstat å†æ¥è§‚å¯Ÿä¸‹.")]),s._v(" "),a("p",[s._v("è¿™æ¬¡åœ¨ç¬¬äºŒä¸ªç»ˆç«¯, å°†æµ‹è¯•çš„è¯·æ±‚æ€»æ•°å¢åŠ åˆ° 10000. ç»§ç»­åœ¨ç¬¬äºŒä¸ªç»ˆç«¯, è¿è¡Œ ab å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" http://10.240.0.5:10000/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ¥ç€, å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œ top å‘½ä»¤, å¹¶æŒ‰ä¸‹æ•°å­— 1, åˆ‡æ¢åˆ°æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.7")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.3")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21514")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8712")]),s._v(" R  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41.9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":06.00 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21513")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13244")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5572")]),s._v(" R  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":06.08 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21515")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8712")]),s._v(" R  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":05.67 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21512")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13244")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5572")]),s._v(" R  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":05.87 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21516")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8712")]),s._v(" R  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":05.61 php-fpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("è¿™é‡Œå¯ä»¥çœ‹åˆ°, ç³»ç»Ÿä¸­æœ‰å‡ ä¸ª php-fpm è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡åŠ èµ·æ¥æ¥è¿‘ 200%; è€Œæ¯ä¸ª CPU çš„ç”¨æˆ·ä½¿ç”¨ç‡(us)ä¹Ÿå·²ç»è¶…è¿‡äº† 98%, æ¥è¿‘é¥±å’Œ. è¿™æ ·å°±å¯ä»¥ç¡®è®¤, æ­£æ˜¯"),a("strong",[s._v("ç”¨æˆ·ç©ºé—´çš„ php-fpm è¿›ç¨‹, å¯¼è‡´ CPU ä½¿ç”¨ç‡éª¤å‡")]),s._v(".")]),s._v(" "),a("p",[s._v("é‚£å†å¾€ä¸‹èµ°, æ€ä¹ˆçŸ¥é“æ˜¯ php-fpm çš„"),a("strong",[s._v("å“ªä¸ªå‡½æ•°")]),s._v("å¯¼è‡´äº† CPU ä½¿ç”¨ç‡å‡é«˜å‘¢? æ¥ç”¨ perf åˆ†æä¸€ä¸‹. åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œä¸‹é¢çš„ perf å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -g å¼€å¯è°ƒç”¨å…³ç³»åˆ†æ, -p æŒ‡å®š php-fpm çš„è¿›ç¨‹å· 21515")]),s._v("\n$ perf "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21515")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æŒ‰æ–¹å‘é”®åˆ‡æ¢åˆ° php-fpm, å†æŒ‰ä¸‹å›è½¦é”®å±•å¼€ php-fpm çš„è°ƒç”¨å…³ç³», ä½ ä¼šå‘ç°, è°ƒç”¨å…³ç³»æœ€ç»ˆåˆ°äº† "),a("strong",[s._v("sqrt å’Œ add_function")]),s._v(". çœ‹æ¥éœ€è¦ä»è¿™ä¸¤ä¸ªå‡½æ•°å…¥æ‰‹äº†.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/c192e4493e891b2d9ab0b8bc4154ae7b-20230731161933-d2b14k5.png",alt:""}})]),s._v(" "),a("p",[s._v("æ‹·è´å‡º "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/nginx-high-cpu/app/index.php",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx åº”ç”¨çš„æºç "),a("OutboundLink")],1),s._v(", çœ‹çœ‹æ˜¯ä¸æ˜¯è°ƒç”¨äº†è¿™ä¸¤ä¸ªå‡½æ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä»å®¹å™¨ phpfpm ä¸­å°† PHP æºç æ‹·è´å‡ºæ¥")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" phpfpm:/app "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½¿ç”¨ grep æŸ¥æ‰¾å‡½æ•°è°ƒç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" sqrt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" app/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‰¾åˆ°äº† sqrt è°ƒç”¨")]),s._v("\napp/index.php:  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" sqrt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" add_function "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" app/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ²¡æ‰¾åˆ° add_function è°ƒç”¨, è¿™å…¶å®æ˜¯ PHP å†…ç½®å‡½æ•°")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("OK, åŸæ¥åªæœ‰ sqrt å‡½æ•°åœ¨ app/index.php æ–‡ä»¶ä¸­è°ƒç”¨äº†. é‚£æœ€åä¸€æ­¥, å°±è¯¥çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶çš„æºç äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" app/index.php\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("?php\n// "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" only.\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v("++"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" sqrt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"It works!"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("æœ‰æ²¡æœ‰å‘ç°é—®é¢˜åœ¨å“ªé‡Œå‘¢? æˆ‘æƒ³ä½ è¦ç¬‘è¯æˆ‘äº†, å±…ç„¶çŠ¯äº†ä¸€ä¸ªè¿™ä¹ˆå‚»çš„é”™è¯¯, æµ‹è¯•ä»£ç æ²¡åˆ å°±ç›´æ¥å‘å¸ƒåº”ç”¨äº†. ä¸ºäº†æ–¹ä¾¿ä½ éªŒè¯ä¼˜åŒ–åçš„æ•ˆæœ, æˆ‘æŠŠä¿®å¤åçš„åº”ç”¨ä¹Ÿæ‰“åŒ…æˆäº†ä¸€ä¸ª Docker é•œåƒ, å¯ä»¥åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œå®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœæ­¢åŸæ¥çš„åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx phpfpm\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œä¼˜åŒ–åçš„åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx:cpu-fix\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" phpfpm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" container:nginx feisky/php-fpm:cpu-fix\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("æ¥ç€, åˆ°ç¬¬äºŒä¸ªç»ˆç«¯æ¥éªŒè¯ä¸€ä¸‹ä¿®å¤åçš„æ•ˆæœ. é¦–å…ˆ Ctrl+C åœæ­¢ä¹‹å‰çš„ ab å‘½ä»¤å, å†è¿è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" http://10.240.0.5:10000/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nComplete requests:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\nFailed requests:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTotal transferred:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1720000")]),s._v(" bytes\nHTML transferred:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90000")]),s._v(" bytes\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2237.04")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.470")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.447")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("375.75")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œä½ å¯ä»¥å‘ç°, ç°åœ¨æ¯ç§’çš„å¹³å‡è¯·æ±‚æ•°, å·²ç»ä»åŸæ¥çš„ 11 å˜æˆäº† 2237. å°±æ˜¯è¿™ä¹ˆå¾ˆå‚»çš„ä¸€ä¸ªå°é—®é¢˜, å´ä¼šæå¤§çš„å½±å“æ€§èƒ½, å¹¶ä¸”æŸ¥æ‰¾èµ·æ¥ä¹Ÿå¹¶ä¸å®¹æ˜“å§. å½“ç„¶, æ‰¾åˆ°é—®é¢˜å, è§£å†³æ–¹æ³•å°±ç®€å•å¤šäº†, åˆ é™¤æµ‹è¯•ä»£ç å°±å¯ä»¥äº†.")]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[s._v("CPU ä½¿ç”¨ç‡æ˜¯æœ€ç›´è§‚å’Œæœ€å¸¸ç”¨çš„ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡, æ›´æ˜¯æ’æŸ¥æ€§èƒ½é—®é¢˜æ—¶, é€šå¸¸ä¼šå…³æ³¨çš„ç¬¬ä¸€ä¸ªæŒ‡æ ‡. æ‰€ä»¥æ›´è¦ç†Ÿæ‚‰å®ƒçš„å«ä¹‰, å°¤å…¶è¦å¼„æ¸…æ¥š"),a("strong",[s._v("ç”¨æˆ·(%user), Nice(%nice), ç³»ç»Ÿ(%system) , ç­‰å¾… I/O(%iowait) , ä¸­æ–­(%irq)ä»¥åŠè½¯ä¸­æ–­(%softirq)è¿™å‡ ç§ä¸åŒ CPU çš„ä½¿ç”¨ç‡")]),s._v(". æ¯”å¦‚è¯´:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç”¨æˆ· CPU å’Œ Nice CPU é«˜, è¯´æ˜ç”¨æˆ·æ€è¿›ç¨‹å ç”¨äº†è¾ƒå¤šçš„ CPU, æ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥è¿›ç¨‹çš„æ€§èƒ½é—®é¢˜")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("ç³»ç»Ÿ CPU é«˜, è¯´æ˜å†…æ ¸æ€å ç”¨äº†è¾ƒå¤šçš„ CPU, æ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥å†…æ ¸çº¿ç¨‹æˆ–è€…ç³»ç»Ÿè°ƒç”¨çš„æ€§èƒ½é—®é¢˜")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("I/O ç­‰å¾… CPU é«˜, è¯´æ˜ç­‰å¾… I/O çš„æ—¶é—´æ¯”è¾ƒé•¿, æ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥ç³»ç»Ÿå­˜å‚¨æ˜¯ä¸æ˜¯å‡ºç°äº† I/O é—®é¢˜")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("è½¯ä¸­æ–­å’Œç¡¬ä¸­æ–­é«˜, è¯´æ˜è½¯ä¸­æ–­æˆ–ç¡¬ä¸­æ–­çš„å¤„ç†ç¨‹åºå ç”¨äº†è¾ƒå¤šçš„ CPU, æ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥å†…æ ¸ä¸­çš„ä¸­æ–­æœåŠ¡ç¨‹åº")]),s._v(".")])]),s._v(" "),a("p",[s._v("ç¢°åˆ° CPU ä½¿ç”¨ç‡å‡é«˜çš„é—®é¢˜, å¯ä»¥å€ŸåŠ© top, pidstat ç­‰å·¥å…·, ç¡®è®¤å¼•å‘ CPU æ€§èƒ½é—®é¢˜çš„æ¥æº; å†ä½¿ç”¨ perf ç­‰å·¥å…·, æ’æŸ¥å‡ºå¼•èµ·æ€§èƒ½é—®é¢˜çš„å…·ä½“å‡½æ•°.")]),s._v(" "),a("h4",{attrs:{id:"_06-æ¡ˆä¾‹ç¯‡-ç³»ç»Ÿçš„cpuä½¿ç”¨ç‡å¾ˆé«˜-ä½†ä¸ºå•¥å´æ‰¾ä¸åˆ°é«˜cpuçš„åº”ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_06-æ¡ˆä¾‹ç¯‡-ç³»ç»Ÿçš„cpuä½¿ç”¨ç‡å¾ˆé«˜-ä½†ä¸ºå•¥å´æ‰¾ä¸åˆ°é«˜cpuçš„åº”ç”¨"}},[s._v("#")]),s._v(" 06-æ¡ˆä¾‹ç¯‡:ç³»ç»Ÿçš„CPUä½¿ç”¨ç‡å¾ˆé«˜,ä½†ä¸ºå•¥å´æ‰¾ä¸åˆ°é«˜CPUçš„åº”ç”¨?")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚è®²äº† CPU ä½¿ç”¨ç‡æ˜¯ä»€ä¹ˆ, å¹¶é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ•™ä½ ä½¿ç”¨ top, vmstat, pidstat ç­‰å·¥å…·, æ’æŸ¥é«˜ CPU ä½¿ç”¨ç‡çš„è¿›ç¨‹, ç„¶åå†ä½¿ç”¨ perf top å·¥å…·, å®šä½åº”ç”¨å†…éƒ¨å‡½æ•°çš„é—®é¢˜. ä¸è¿‡å°±æœ‰äººç•™è¨€äº†, è¯´ä¼¼ä¹æ„Ÿè§‰é«˜ CPU ä½¿ç”¨ç‡çš„é—®é¢˜, è¿˜æ˜¯æŒºå®¹æ˜“æ’æŸ¥çš„.")]),s._v(" "),a("p",[s._v("é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰ CPU ä½¿ç”¨ç‡é«˜çš„é—®é¢˜, éƒ½å¯ä»¥è¿™ä¹ˆåˆ†æå‘¢? ç­”æ¡ˆåº”è¯¥æ˜¯å¦å®šçš„.")]),s._v(" "),a("p",[s._v("å›é¡¾å‰é¢çš„å†…å®¹, ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡, ä¸ä»…åŒ…æ‹¬è¿›ç¨‹ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„è¿è¡Œ, è¿˜åŒ…æ‹¬ä¸­æ–­å¤„ç†, ç­‰å¾… I/O ä»¥åŠå†…æ ¸çº¿ç¨‹ç­‰. æ‰€ä»¥, "),a("strong",[s._v("å½“å‘ç°ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡å¾ˆé«˜çš„æ—¶å€™, ä¸ä¸€å®šèƒ½æ‰¾åˆ°ç›¸å¯¹åº”çš„é«˜ CPU ä½¿ç”¨ç‡çš„è¿›ç¨‹")]),s._v(".")]),s._v(" "),a("p",[s._v("ä»Šå¤©å°±ç”¨ä¸€ä¸ª Nginx + PHP çš„ Web æœåŠ¡çš„æ¡ˆä¾‹, æ¥åˆ†æè¿™ç§æƒ…å†µ.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹åˆ†æ"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("h6",{attrs:{id:"_1-ä½ çš„å‡†å¤‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä½ çš„å‡†å¤‡"}},[s._v("#")]),s._v(" (1)ä½ çš„å‡†å¤‡")]),s._v(" "),a("p",[s._v("ä»Šå¤©ä¾æ—§æ¢ç©¶ç³»ç»Ÿ CPU ä½¿ç”¨ç‡é«˜çš„æƒ…å†µ, æ‰€ä»¥è¿™æ¬¡å®éªŒçš„å‡†å¤‡å·¥ä½œ, ä¸ä¸ŠèŠ‚å‡†å¤‡å·¥ä½œåŸºæœ¬ç›¸åŒ, å·®åˆ«åœ¨äºæ¡ˆä¾‹æ‰€ç”¨çš„ Docker é•œåƒä¸åŒ.")]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sysstat, perf, ab ç­‰å·¥å…·, å¦‚ apt install "),a("a",{attrs:{href:"http://docker.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker.io"),a("OutboundLink")],1),s._v(" sysstat linux-tools-common apache2-utils")])]),s._v(" "),a("p",[s._v("å‰é¢è®²åˆ°è¿‡, ab(apache bench)æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ HTTP æœåŠ¡æ€§èƒ½æµ‹è¯•å·¥å…·, è¿™é‡ŒåŒæ ·ç”¨æ¥æ¨¡æ‹Ÿ Nginx çš„å®¢æˆ·ç«¯. ç”±äº Nginx å’Œ PHP çš„é…ç½®æ¯”è¾ƒéº»çƒ¦, æˆ‘æŠŠå®ƒä»¬æ‰“åŒ…æˆäº†ä¸¤ä¸ª "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/tree/master/nginx-short-process",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker é•œåƒ"),a("OutboundLink")],1),s._v(", è¿™æ ·åªéœ€è¦è¿è¡Œä¸¤ä¸ªå®¹å™¨, å°±å¯ä»¥å¾—åˆ°æ¨¡æ‹Ÿç¯å¢ƒ. æ³¨æ„, è¿™ä¸ªæ¡ˆä¾‹è¦ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœº, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ea6315bcd1467b86b5d5e9016c3368a5-20230731161933-b0inv9t.png",alt:""}})]),s._v(" "),a("p",[s._v('å¯ä»¥çœ‹åˆ°, å…¶ä¸­ä¸€å°ç”¨ä½œ Web æœåŠ¡å™¨, æ¥æ¨¡æ‹Ÿæ€§èƒ½é—®é¢˜; å¦ä¸€å°ç”¨ä½œ Web æœåŠ¡å™¨çš„å®¢æˆ·ç«¯, æ¥ç»™ Web æœåŠ¡å¢åŠ å‹åŠ›è¯·æ±‚. ä½¿ç”¨ä¸¤å°è™šæ‹Ÿæœºæ˜¯ä¸ºäº†ç›¸äº’éš”ç¦», é¿å… "äº¤å‰æ„ŸæŸ“". æ¥ä¸‹æ¥æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯, åˆ†åˆ« SSH ç™»å½•åˆ°ä¸¤å°æœºå™¨ä¸Š, å¹¶å®‰è£…ä¸Šè¿°å·¥å…·.')]),s._v(" "),a("h6",{attrs:{id:"_2-æ“ä½œå’Œåˆ†æ-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ“ä½œå’Œåˆ†æ-3"}},[s._v("#")]),s._v(" (2)æ“ä½œå’Œåˆ†æ")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿è¡Œ Nginx å’Œ PHP åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx:sp\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" phpfpm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" container:nginx feisky/php-fpm:sp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶å, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯, ä½¿ç”¨ curl è®¿é—® "),a("code",[s._v("http://[VM1 çš„ IP]:10000")]),s._v("â€‹, ç¡®è®¤ Nginx å·²æ­£å¸¸å¯åŠ¨.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 192.168.0.10 æ˜¯ç¬¬ä¸€å°è™šæ‹Ÿæœºçš„ IP åœ°å€")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/\nIt works"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æ¥ç€æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ª Nginx æœåŠ¡çš„æ€§èƒ½. åœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œä¸‹é¢çš„ ab å‘½ä»¤. è¦æ³¨æ„, ä¸ä¸Šæ¬¡æ“ä½œä¸åŒçš„æ˜¯, è¿™æ¬¡éœ€è¦å¹¶å‘ 100 ä¸ªè¯·æ±‚æµ‹è¯• Nginx æ€§èƒ½, æ€»å…±æµ‹è¯• 1000 ä¸ªè¯·æ±‚.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¹¶å‘ 100 ä¸ªè¯·æ±‚æµ‹è¯• Nginx æ€§èƒ½, æ€»å…±æµ‹è¯• 1000 ä¸ªè¯·æ±‚")]),s._v("\n$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" http://192.168.0.10:10000/\nThis is ApacheBench, Version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Revision")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1706008")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nCopyright "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1996")]),s._v(" Adam Twiss, Zeus Technology Ltd, \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87.86")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1138.229")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä» ab çš„è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°, Nginx èƒ½æ‰¿å—çš„æ¯ç§’å¹³å‡è¯·æ±‚æ•°, åªæœ‰ 87 å¤šä¸€ç‚¹, æ˜¯ä¸æ˜¯æ„Ÿè§‰å®ƒçš„æ€§èƒ½æœ‰ç‚¹å·®å‘€. é‚£ä¹ˆ, åˆ°åº•æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜å‘¢? å†ç”¨ top å’Œ pidstat æ¥è§‚å¯Ÿä¸€ä¸‹.")]),s._v(" "),a("p",[s._v("è¿™æ¬¡åœ¨ç¬¬äºŒä¸ªç»ˆç«¯, å°†æµ‹è¯•çš„å¹¶å‘è¯·æ±‚æ•°æ”¹æˆ 5, åŒæ—¶æŠŠè¯·æ±‚æ—¶é•¿è®¾ç½®ä¸º 10 åˆ†é’Ÿ(-t 600). è¿™æ ·, å½“åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·æ—¶, Nginx çš„å‹åŠ›è¿˜æ˜¯ç»§ç»­çš„.")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œ ab å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" http://192.168.0.10:10000/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶ååœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œ top å‘½ä»¤, è§‚å¯Ÿç³»ç»Ÿçš„ CPU ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n%Cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80.8")]),s._v(" us, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.1")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.8")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6882")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8456")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5052")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3884")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":04.78 docker-containe\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6947")]),s._v(" systemd+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33104")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3716")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2340")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":04.92 nginx\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7494")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15012")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7332")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":03.55 php-fpm\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7495")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15160")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7480")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":03.55 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10547")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16200")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8520")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":03.13 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10155")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16200")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8520")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":03.12 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10552")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16200")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8520")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":03.12 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15006")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1168608")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("66264")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37536")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(":39.51 dockerd\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4323")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.87 kworker/u4:1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ top è¾“å‡ºçš„è¿›ç¨‹åˆ—è¡¨å¯ä»¥å‘ç°, "),a("strong",[s._v("CPU ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹ä¹Ÿåªä¸è¿‡æ‰ 2.7%")]),s._v(" , çœ‹èµ·æ¥å¹¶ä¸é«˜.")]),s._v(" "),a("p",[s._v("ç„¶è€Œ, å†çœ‹ç³»ç»Ÿ CPU ä½¿ç”¨ç‡(%Cpu)è¿™ä¸€è¡Œ, ä½ ä¼šå‘ç°, ç³»ç»Ÿçš„æ•´ä½“ CPU ä½¿ç”¨ç‡æ˜¯æ¯”è¾ƒé«˜çš„: "),a("strong",[s._v("ç”¨æˆ· CPU ä½¿ç”¨ç‡(us)å·²ç»åˆ°äº† 80%, ç³»ç»Ÿ CPU ä¸º 15.1%, è€Œç©ºé—² CPU (id)åˆ™åªæœ‰ 2.8%")]),s._v(" .")]),s._v(" "),a("p",[s._v("ä¸ºä»€ä¹ˆç”¨æˆ· CPU ä½¿ç”¨ç‡è¿™ä¹ˆé«˜å‘¢? å†é‡æ–°åˆ†æä¸€ä¸‹è¿›ç¨‹åˆ—è¡¨, çœ‹çœ‹æœ‰æ²¡æœ‰å¯ç–‘è¿›ç¨‹:")]),s._v(" "),a("ul",[a("li",[s._v("docker-containerd è¿›ç¨‹æ˜¯ç”¨æ¥è¿è¡Œå®¹å™¨çš„, 2.7% çš„ CPU ä½¿ç”¨ç‡çœ‹èµ·æ¥æ­£å¸¸;")]),s._v(" "),a("li",[s._v("Nginx å’Œ php-fpm æ˜¯è¿è¡Œ Web æœåŠ¡çš„, å®ƒä»¬ä¼šå ç”¨ä¸€äº› CPU ä¹Ÿä¸æ„å¤–, å¹¶ä¸” 2% çš„ CPU ä½¿ç”¨ç‡ä¹Ÿä¸ç®—é«˜;")]),s._v(" "),a("li",[s._v("å†å¾€ä¸‹çœ‹, åé¢çš„è¿›ç¨‹å‘¢, åªæœ‰ 0.3% çš„ CPU ä½¿ç”¨ç‡, çœ‹èµ·æ¥ä¸å¤ªåƒä¼šå¯¼è‡´ç”¨æˆ· CPU ä½¿ç”¨ç‡è¾¾åˆ° 80%.")])]),s._v(" "),a("p",[s._v("é‚£å°±å¥‡æ€ªäº†, "),a("mark",[a("strong",[s._v("æ˜æ˜ç”¨æˆ· CPU ä½¿ç”¨ç‡éƒ½ 80% äº†, å¯æŒ¨ä¸ªåˆ†æäº†ä¸€éè¿›ç¨‹åˆ—è¡¨, è¿˜æ˜¯æ‰¾ä¸åˆ°é«˜ CPU ä½¿ç”¨ç‡çš„è¿›ç¨‹")])]),s._v(". çœ‹æ¥ top æ˜¯ä¸ç®¡ç”¨äº†, é‚£è¿˜æœ‰å…¶ä»–å·¥å…·å¯ä»¥æŸ¥çœ‹è¿›ç¨‹ CPU ä½¿ç”¨æƒ…å†µå—? ä¸çŸ¥é“ä½ è®°ä¸è®°å¾—è€æœ‹å‹ "),a("strong",[s._v("pidstat")]),s._v(", å®ƒå¯ä»¥ç”¨æ¥åˆ†æè¿›ç¨‹çš„ CPU ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥è¿˜æ˜¯åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯, è¿è¡Œ pidstat å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é—´éš” 1 ç§’è¾“å‡ºä¸€ç»„æ•°æ®(æŒ‰ Ctrl+C ç»“æŸ)")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n04:36:24      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6882")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  docker-containe\n04:36:25      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6947")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  nginx\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14834")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  php-fpm\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14835")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  php-fpm\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14845")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  php-fpm\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14855")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  php-fpm\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14857")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  php-fpm\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15006")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dockerd\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15801")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  pidstat\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17084")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  stress\n04:36:25        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31116")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  atopacctd\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿä¸€ä¼šå„¿, ä½ æ˜¯ä¸æ˜¯å‘ç°, æ‰€æœ‰è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ä¹Ÿéƒ½ä¸é«˜å•Š, æœ€é«˜çš„ Docker å’Œ Nginx ä¹Ÿåªæœ‰ 4% å’Œ 3%, å³ä½¿æ‰€æœ‰è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡éƒ½åŠ èµ·æ¥, ä¹Ÿä¸è¿‡æ˜¯ 21%, ç¦» 80% è¿˜å·®å¾—è¿œå‘¢!")]),s._v(" "),a("p",[s._v("æœ€æ—©çš„æ—¶å€™, æˆ‘ç¢°åˆ°è¿™ç§é—®é¢˜å°±å®Œå…¨æ‡µäº†: "),a("strong",[s._v("æ˜æ˜ç”¨æˆ· CPU ä½¿ç”¨ç‡å·²ç»é«˜è¾¾ 80%, ä½†æˆ‘å´æ€ä¹ˆéƒ½æ‰¾ä¸åˆ°æ˜¯å“ªä¸ªè¿›ç¨‹çš„é—®é¢˜")]),s._v(". åˆ°è¿™é‡Œ, ä½ ä¹Ÿå¯ä»¥æƒ³æƒ³, ä½ æ˜¯ä¸æ˜¯ä¹Ÿé‡åˆ°è¿‡è¿™ç§æƒ…å†µ? è¿˜èƒ½ä¸èƒ½å†åšè¿›ä¸€æ­¥çš„åˆ†æå‘¢?")]),s._v(" "),a("p",[s._v("åæ¥æˆ‘å‘ç°, ä¼šå‡ºç°è¿™ç§æƒ…å†µ, "),a("strong",[s._v("å¾ˆå¯èƒ½æ˜¯å› ä¸ºå‰é¢çš„åˆ†ææ¼äº†ä¸€äº›å…³é”®ä¿¡æ¯")]),s._v(". ä½ å¯ä»¥å…ˆæš‚åœä¸€ä¸‹, è‡ªå·±å¾€ä¸Šç¿», é‡æ–°æ“ä½œæ£€æŸ¥ä¸€é. æˆ–è€…ä¸€èµ·è¿”å›å»åˆ†æ top çš„è¾“å‡º, çœ‹çœ‹èƒ½ä¸èƒ½æœ‰æ–°å‘ç°.")]),s._v(" "),a("p",[s._v("ç°åœ¨å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯, é‡æ–°è¿è¡Œ top å‘½ä»¤, å¹¶è§‚å¯Ÿä¸€ä¼šå„¿:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - 04:58:24 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" days, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":47,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.39")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.82")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.74")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("149")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77.7")]),s._v(" us, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169348")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2543916")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("457976")]),s._v(" used,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5167456")]),s._v(" buff/cache\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7363908")]),s._v(" avail Mem\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6947")]),s._v(" systemd+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33104")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3764")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2340")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":32.69 nginx\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6882")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12108")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8360")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3884")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":31.40 docker-containe\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15465")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15256")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7576")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.62 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15466")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15196")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7516")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.62 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15489")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16200")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8520")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.62 php-fpm\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6948")]),s._v(" systemd+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33104")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3764")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2340")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.95 nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15006")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1168608")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65632")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37536")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(":51.09 dockerd\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15476")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16200")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8520")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.61 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15477")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16200")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8520")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.61 php-fpm\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24340")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8184")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1616")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("536")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24342")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8196")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1580")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("492")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24344")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8188")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1056")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("492")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 stress\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24347")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8184")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1356")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("540")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 stress\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("è¿™æ¬¡ä»å¤´å¼€å§‹çœ‹ top çš„æ¯è¡Œè¾“å‡º, å’¦? "),a("strong",[s._v("Tasks è¿™ä¸€è¡Œçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ª, å°±ç»ªé˜Ÿåˆ—ä¸­å±…ç„¶æœ‰ 6 ä¸ª Running çŠ¶æ€çš„è¿›ç¨‹(6 running)")]),s._v(" , æ˜¯ä¸æ˜¯æœ‰ç‚¹å¤šå‘¢?")]),s._v(" "),a("p",[s._v("å›æƒ³ä¸€ä¸‹ ab æµ‹è¯•çš„å‚æ•°, å¹¶å‘è¯·æ±‚æ•°æ˜¯ 5. å†çœ‹è¿›ç¨‹åˆ—è¡¨é‡Œ, php-fpm çš„æ•°é‡ä¹Ÿæ˜¯ 5, å†åŠ ä¸Š Nginx, å¥½åƒåŒæ—¶æœ‰ 6 ä¸ªè¿›ç¨‹ä¹Ÿå¹¶ä¸å¥‡æ€ª. ä½†çœŸçš„æ˜¯è¿™æ ·å—?")]),s._v(" "),a("p",[s._v("å†ä»”ç»†çœ‹è¿›ç¨‹åˆ—è¡¨, "),a("strong",[s._v("è¿™æ¬¡ä¸»è¦çœ‹ Running(R) çŠ¶æ€çš„è¿›ç¨‹")]),s._v(". ä½ æœ‰æ²¡æœ‰å‘ç°, "),a("strong",[s._v("Nginx å’Œæ‰€æœ‰çš„ php-fpm éƒ½å¤„äº Sleep(S)çŠ¶æ€, è€ŒçœŸæ­£å¤„äº Running(R)çŠ¶æ€çš„, å´æ˜¯å‡ ä¸ª stress è¿›ç¨‹")]),s._v(". è¿™å‡ ä¸ª stress è¿›ç¨‹å°±æ¯”è¾ƒå¥‡æ€ªäº†, éœ€è¦åšè¿›ä¸€æ­¥çš„åˆ†æ.")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯ä½¿ç”¨ pidstat æ¥åˆ†æè¿™å‡ ä¸ªè¿›ç¨‹, å¹¶ä¸”ä½¿ç”¨ -p é€‰é¡¹æŒ‡å®šè¿›ç¨‹çš„ PID. é¦–å…ˆ, ä»ä¸Šé¢ top çš„ç»“æœä¸­, æ‰¾åˆ°è¿™å‡ ä¸ªè¿›ç¨‹çš„ PID. æ¯”å¦‚, å…ˆéšä¾¿æ‰¾ä¸€ä¸ª 24344, ç„¶åç”¨ pidstat å‘½ä»¤çœ‹ä¸€ä¸‹å®ƒçš„ CPU ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24344")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":14:55      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¥‡æ€ª, å±…ç„¶"),a("strong",[s._v("æ²¡æœ‰ä»»ä½•è¾“å‡º")]),s._v(". éš¾é“æ˜¯ pidstat å‘½ä»¤å‡ºé—®é¢˜äº†å—? ä¹‹å‰æˆ‘è¯´è¿‡, "),a("strong",[s._v("åœ¨æ€€ç–‘æ€§èƒ½å·¥å…·å‡ºé—®é¢˜å‰, æœ€å¥½è¿˜æ˜¯å…ˆç”¨å…¶ä»–å·¥å…·äº¤å‰ç¡®è®¤ä¸€ä¸‹")]),s._v(". é‚£ç”¨ä»€ä¹ˆå·¥å…·å‘¢? ps åº”è¯¥æ˜¯æœ€ç®€å•æ˜“ç”¨çš„. åœ¨ç»ˆç«¯é‡Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤, çœ‹çœ‹ 24344 è¿›ç¨‹çš„çŠ¶æ€:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä»æ‰€æœ‰è¿›ç¨‹ä¸­æŸ¥æ‰¾ PID æ˜¯ 24344 çš„è¿›ç¨‹")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24344")]),s._v("\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9628")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14856")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1096")]),s._v(" pts/0    S+   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":15   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--color")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24344")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è¿˜æ˜¯æ²¡æœ‰è¾“å‡º. ç°åœ¨ç»ˆäºå‘ç°é—®é¢˜, "),a("strong",[s._v("åŸæ¥è¿™ä¸ªè¿›ç¨‹å·²ç»ä¸å­˜åœ¨äº†, æ‰€ä»¥ pidstat å°±æ²¡æœ‰ä»»ä½•è¾“å‡º")]),s._v(". æ—¢ç„¶è¿›ç¨‹éƒ½æ²¡äº†, é‚£æ€§èƒ½é—®é¢˜åº”è¯¥ä¹Ÿè·Ÿç€æ²¡äº†å§. å†ç”¨ top å‘½ä»¤ç¡®è®¤ä¸€ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n%Cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80.9")]),s._v(" us, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.9")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.8")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6882")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12108")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8360")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3884")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":45.63 docker-containe\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6947")]),s._v(" systemd+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33104")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3764")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2340")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":47.79 nginx\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3865")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("336696")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15056")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7376")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.15 php-fpm\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6779")]),s._v(" daemon    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8184")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1112")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("556")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 stress\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("å¥½åƒåˆé”™äº†. ç»“æœè¿˜è·ŸåŸæ¥ä¸€æ ·, ç”¨æˆ· CPU ä½¿ç”¨ç‡è¿˜æ˜¯é«˜è¾¾ 80.9%, ç³»ç»Ÿ CPU æ¥è¿‘ 15%, è€Œç©ºé—² CPU åªæœ‰ 2.8%, Running çŠ¶æ€çš„è¿›ç¨‹æœ‰ Nginx, stress ç­‰.")]),s._v(" "),a("p",[s._v("å¯æ˜¯, åˆšåˆšçœ‹åˆ° stress è¿›ç¨‹ä¸å­˜åœ¨äº†, æ€ä¹ˆç°åœ¨è¿˜åœ¨è¿è¡Œå‘¢? å†ç»†çœ‹ä¸€ä¸‹ top çš„è¾“å‡º, "),a("strong",[s._v("åŸæ¥è¿™æ¬¡ stress è¿›ç¨‹çš„ PID è·Ÿå‰é¢ä¸ä¸€æ ·äº†, åŸæ¥çš„ PID 24344 ä¸è§äº†, ç°åœ¨çš„æ˜¯ 6779")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿›ç¨‹çš„ PID åœ¨å˜, è¿™è¯´æ˜ä»€ä¹ˆå‘¢? åœ¨æˆ‘çœ‹æ¥, "),a("strong",[s._v("è¦ä¹ˆæ˜¯è¿™äº›è¿›ç¨‹åœ¨ä¸åœåœ°é‡å¯, è¦ä¹ˆå°±æ˜¯å…¨æ–°çš„è¿›ç¨‹")]),s._v(", è¿™æ— éä¹Ÿå°±ä¸¤ä¸ªåŸå› :")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç¬¬ä¸€ä¸ªåŸå› , è¿›ç¨‹åœ¨ä¸åœåœ°å´©æºƒé‡å¯, æ¯”å¦‚å› ä¸ºæ®µé”™è¯¯, é…ç½®é”™è¯¯ç­‰ç­‰, è¿™æ—¶è¿›ç¨‹åœ¨é€€å‡ºåå¯èƒ½åˆè¢«ç›‘æ§ç³»ç»Ÿè‡ªåŠ¨é‡å¯äº†.")])]),s._v(" "),a("li",[a("strong",[s._v("ç¬¬äºŒä¸ªåŸå› , è¿™äº›è¿›ç¨‹éƒ½æ˜¯çŸ­æ—¶è¿›ç¨‹, ä¹Ÿå°±æ˜¯åœ¨å…¶ä»–åº”ç”¨å†…éƒ¨é€šè¿‡ exec è°ƒç”¨çš„å¤–é¢å‘½ä»¤. è¿™äº›å‘½ä»¤ä¸€èˆ¬éƒ½åªè¿è¡Œå¾ˆçŸ­çš„æ—¶é—´å°±ä¼šç»“æŸ, å¾ˆéš¾ç”¨ top è¿™ç§é—´éš”æ—¶é—´æ¯”è¾ƒé•¿çš„å·¥å…·å‘ç°(ä¸Šé¢çš„æ¡ˆä¾‹, ç¢°å·§å‘ç°äº†)")])])]),s._v(" "),a("p",[s._v("è‡³äº stress, å‰é¢æåˆ°è¿‡, å®ƒæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å‹åŠ›æµ‹è¯•å·¥å…·. å®ƒçš„ PID åœ¨ä¸æ–­å˜åŒ–ä¸­, çœ‹èµ·æ¥åƒæ˜¯è¢«å…¶ä»–è¿›ç¨‹è°ƒç”¨çš„çŸ­æ—¶è¿›ç¨‹. è¦æƒ³ç»§ç»­åˆ†æä¸‹å», è¿˜å¾—æ‰¾åˆ°å®ƒä»¬çš„çˆ¶è¿›ç¨‹.")]),s._v(" "),a("p",[s._v("è¦æ€ä¹ˆæŸ¥æ‰¾ä¸€ä¸ªè¿›ç¨‹çš„çˆ¶è¿›ç¨‹å‘¢? æ²¡é”™, ç”¨ "),a("strong",[s._v("pstree")]),s._v(" å°±å¯ä»¥ç”¨æ ‘çŠ¶å½¢å¼æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¹‹é—´çš„å…³ç³»:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pstree "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" stress\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-docker-containe-+-php-fpm-+-php-fpm---sh---stress\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-3*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("php-fpm---sh---stress---stress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°, "),a("strong",[s._v("stress æ˜¯è¢« php-fpm è°ƒç”¨çš„å­è¿›ç¨‹, å¹¶ä¸”è¿›ç¨‹æ•°é‡ä¸æ­¢ä¸€ä¸ª(è¿™é‡Œæ˜¯ 3 ä¸ª)")]),s._v(" . æ‰¾åˆ°çˆ¶è¿›ç¨‹å, å°±èƒ½è¿›å…¥ app çš„å†…éƒ¨åˆ†æäº†.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, å½“ç„¶åº”è¯¥å»çœ‹çœ‹å®ƒçš„æºç . è¿è¡Œä¸‹é¢çš„å‘½ä»¤, æŠŠæ¡ˆä¾‹åº”ç”¨çš„æºç æ‹·è´åˆ° app ç›®å½•, ç„¶åå†æ‰§è¡Œ grep æŸ¥æ‰¾æ˜¯ä¸æ˜¯æœ‰ä»£ç å†è°ƒç”¨ stress å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‹·è´æºç åˆ°æœ¬åœ°")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" phpfpm:/app "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep æŸ¥æ‰¾çœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰ä»£ç åœ¨è°ƒç”¨ stress å‘½ä»¤")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" stress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" app\napp/index.php:// fake I/O with stress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("via write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/unlink"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(".\napp/index.php:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$result")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" exec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/stress -t 1 -d 1 2>&1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$output")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("æ‰¾åˆ°äº†, æœç„¶æ˜¯ app/index.php æ–‡ä»¶ä¸­"),a("strong",[s._v("ç›´æ¥è°ƒç”¨äº† stress å‘½ä»¤")]),s._v(".")]),s._v(" "),a("p",[s._v("å†æ¥çœ‹çœ‹ "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/nginx-short-process/app/index.php",target:"_blank",rel:"noopener noreferrer"}},[s._v("app/index.php"),a("OutboundLink")],1),s._v(" çš„æºä»£ç :")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" app/index.php\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("?php\n// fake I/O with stress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("via write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/unlink"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$result")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" exec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/stress -t 1 -d 1 2>&1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$output")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"verbose"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"verbose"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Server internal error: "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  print_r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$output")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"It works!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n?"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, æºç é‡Œ"),a("strong",[s._v("å¯¹æ¯ä¸ªè¯·æ±‚éƒ½ä¼šè°ƒç”¨ä¸€ä¸ª stress å‘½ä»¤, æ¨¡æ‹Ÿ I/O å‹åŠ›")]),s._v(". ä»æ³¨é‡Šä¸Šçœ‹, stress ä¼šé€šè¿‡ write() å’Œ unlink() å¯¹ I/O è¿›ç¨‹è¿›è¡Œå‹æµ‹, çœ‹æ¥è¿™åº”è¯¥å°±æ˜¯ç³»ç»Ÿ CPU ä½¿ç”¨ç‡å‡é«˜çš„æ ¹æºäº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, stress æ¨¡æ‹Ÿçš„æ˜¯ I/O å‹åŠ›, è€Œä¹‹å‰åœ¨ top çš„è¾“å‡ºä¸­çœ‹åˆ°çš„, å´ä¸€ç›´æ˜¯ç”¨æˆ· CPU å’Œç³»ç»Ÿ CPU å‡é«˜, å¹¶æ²¡è§åˆ° iowait å‡é«˜. è¿™åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢? stress åˆ°åº•æ˜¯ä¸æ˜¯ CPU ä½¿ç”¨ç‡å‡é«˜çš„åŸå› å‘¢?")]),s._v(" "),a("p",[s._v("è¿˜å¾—ç»§ç»­å¾€ä¸‹èµ°. ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°, ç»™è¯·æ±‚åŠ å…¥ verbose=1 å‚æ•°å, å°±å¯ä»¥æŸ¥çœ‹ stress çš„è¾“å‡º. ä½ å…ˆè¯•è¯•çœ‹, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000?verbose"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nServer internal error: Array\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stress: info: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19607")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" dispatching hogs: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" cpu, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" io, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" vm, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" hdd\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stress: FAIL: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19608")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("563")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" mkstemp failed: Permission denied\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stress: FAIL: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19607")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("394")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- worker "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19608")]),s._v(" returned error "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stress: WARN: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19607")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("396")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" now reaping child worker processes\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stress: FAIL: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19607")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" error: No such process\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stress: FAIL: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19607")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("451")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" failed run completed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 0s\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("çœ‹é”™è¯¯æ¶ˆæ¯ mkstemp failed: Permission denied, ä»¥åŠ failed run completed in 0s. "),a("strong",[s._v("åŸæ¥ stress å‘½ä»¤å¹¶æ²¡æœ‰æˆåŠŸ, å®ƒå› ä¸ºæƒé™é—®é¢˜å¤±è´¥é€€å‡ºäº†. çœ‹æ¥, æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ª PHP è°ƒç”¨å¤–éƒ¨ stress å‘½ä»¤çš„ bug: æ²¡æœ‰æƒé™åˆ›å»ºä¸´æ—¶æ–‡ä»¶.")])]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("ä»è¿™é‡Œå¯ä»¥çŒœæµ‹, æ­£æ˜¯ç”±äºæƒé™é”™è¯¯, å¤§é‡çš„ stress è¿›ç¨‹åœ¨å¯åŠ¨æ—¶åˆå§‹åŒ–å¤±è´¥, è¿›è€Œå¯¼è‡´ç”¨æˆ· CPU ä½¿ç”¨ç‡çš„å‡é«˜")])]),s._v(".")]),s._v(" "),a("p",[s._v("åˆ†æå‡ºé—®é¢˜æ¥æº, ä¸‹ä¸€æ­¥æ˜¯ä¸æ˜¯å°±è¦å¼€å§‹ä¼˜åŒ–äº†å‘¢? å½“ç„¶ä¸æ˜¯! æ—¢ç„¶åªæ˜¯çŒœæµ‹, é‚£å°±éœ€è¦å†ç¡®è®¤ä¸€ä¸‹, è¿™ä¸ªçŒœæµ‹åˆ°åº•å¯¹ä¸å¯¹, æ˜¯ä¸æ˜¯çœŸçš„æœ‰å¤§é‡çš„ stress è¿›ç¨‹. è¯¥ç”¨ä»€ä¹ˆå·¥å…·æˆ–æŒ‡æ ‡å‘¢?")]),s._v(" "),a("p",[s._v("å‰é¢å·²ç»ç”¨äº† top, pidstat, pstree ç­‰å·¥å…·, æ²¡æœ‰å‘ç°å¤§é‡çš„ stress è¿›ç¨‹. é‚£è¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„å·¥å…·å¯ä»¥ç”¨å—?")]),s._v(" "),a("p",[s._v("è¿˜è®°å¾—ä¸Šä¸€æœŸæåˆ°çš„ perf å—? å®ƒå¯ä»¥ç”¨æ¥åˆ†æ CPU æ€§èƒ½äº‹ä»¶, ç”¨åœ¨è¿™é‡Œå°±å¾ˆåˆé€‚. ä¾æ—§åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ "),a("code",[s._v("perf record -g")]),s._v("â€‹ å‘½ä»¤ , å¹¶ç­‰å¾…ä¸€ä¼šå„¿(æ¯”å¦‚ 15 ç§’)åæŒ‰ Ctrl+C é€€å‡º. ç„¶åå†è¿è¡Œ perf report æŸ¥çœ‹æŠ¥å‘Š:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®°å½•æ€§èƒ½äº‹ä»¶, ç­‰å¾…å¤§çº¦ 15 ç§’åæŒ‰ Ctrl+C é€€å‡º")]),s._v("\n$ perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹æŠ¥å‘Š")]),s._v("\n$ perf report\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("è¿™æ ·å°±å¯ä»¥çœ‹åˆ°ä¸‹å›¾è¿™ä¸ªæ€§èƒ½æŠ¥å‘Š:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/fd0ad6402bf3c0ee454ab2515dd7b7d4-20230731161933-la7dfij.png",alt:""}})]),s._v(" "),a("p",[s._v("ä½ çœ‹, "),a("strong",[s._v("stress å äº†æ‰€æœ‰ CPU æ—¶é’Ÿäº‹ä»¶çš„ 77%, è€Œ stress è°ƒç”¨è°ƒç”¨æ ˆä¸­æ¯”ä¾‹æœ€é«˜çš„, æ˜¯éšæœºæ•°ç”Ÿæˆå‡½æ•° random(), çœ‹æ¥å®ƒçš„ç¡®å°±æ˜¯ CPU ä½¿ç”¨ç‡å‡é«˜çš„å…ƒå‡¶äº†")]),s._v(". éšåçš„ä¼˜åŒ–å°±å¾ˆç®€å•äº†, åªè¦ä¿®å¤æƒé™é—®é¢˜, å¹¶å‡å°‘æˆ–åˆ é™¤ stress çš„è°ƒç”¨, å°±å¯ä»¥å‡è½»ç³»ç»Ÿçš„ CPU å‹åŠ›.")]),s._v(" "),a("p",[s._v("å½“ç„¶, å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜ä¸€èˆ¬éƒ½è¦æ¯”è¿™ä¸ªæ¡ˆä¾‹å¤æ‚, åœ¨ä½ æ‰¾åˆ°è§¦å‘ç“¶é¢ˆçš„å‘½ä»¤è¡Œå, å´å¯èƒ½å‘ç°, è¿™ä¸ªå¤–éƒ¨å‘½ä»¤çš„è°ƒç”¨è¿‡ç¨‹æ˜¯åº”ç”¨æ ¸å¿ƒé€»è¾‘çš„ä¸€éƒ¨åˆ†, å¹¶ä¸èƒ½è½»æ˜“å‡å°‘æˆ–è€…åˆ é™¤.")]),s._v(" "),a("p",[s._v("è¿™æ—¶å°±å¾—ç»§ç»­æ’æŸ¥, ä¸ºä»€ä¹ˆè¢«è°ƒç”¨çš„å‘½ä»¤, ä¼šå¯¼è‡´ CPU ä½¿ç”¨ç‡å‡é«˜æˆ– I/O å‡é«˜ç­‰é—®é¢˜. è¿™äº›å¤æ‚åœºæ™¯çš„æ¡ˆä¾‹, æˆ‘ä¼šåœ¨åé¢çš„ç»¼åˆå®æˆ˜é‡Œè¯¦ç»†åˆ†æ.")]),s._v(" "),a("p",[s._v("æœ€å, åœ¨æ¡ˆä¾‹ç»“æŸæ—¶, ä¸è¦å¿˜äº†æ¸…ç†ç¯å¢ƒ, æ‰§è¡Œä¸‹é¢çš„ Docker å‘½ä»¤, åœæ­¢æ¡ˆä¾‹ä¸­ç”¨åˆ°çš„ Nginx è¿›ç¨‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx phpfpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"_2-execsnoop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-execsnoop"}},[s._v("#")]),s._v(" 2.execsnoop")]),s._v(" "),a("p",[s._v("åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­, ä½¿ç”¨äº† top, pidstat, pstree ç­‰å·¥å…·åˆ†æäº†ç³»ç»Ÿ CPU ä½¿ç”¨ç‡é«˜çš„é—®é¢˜, å¹¶å‘ç° CPU å‡é«˜æ˜¯çŸ­æ—¶è¿›ç¨‹ stress å¯¼è‡´çš„, ä½†æ˜¯æ•´ä¸ªåˆ†æè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„. å¯¹äºè¿™ç±»é—®é¢˜, æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•"),a("strong",[s._v("ç›‘æ§")]),s._v("å‘¢?")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/brendangregg/perf-tools/blob/master/execsnoop",target:"_blank",rel:"noopener noreferrer"}},[s._v("execsnoop"),a("OutboundLink")],1),s._v(" å°±æ˜¯ä¸€ä¸ªä¸“ä¸º"),a("strong",[s._v("çŸ­æ—¶è¿›ç¨‹è®¾è®¡çš„å·¥å…·")]),s._v(". å®ƒé€šè¿‡ "),a("strong",[s._v("ftrace")]),s._v(" å®æ—¶ç›‘æ§è¿›ç¨‹çš„ exec() è¡Œä¸º, å¹¶è¾“å‡ºçŸ­æ—¶è¿›ç¨‹çš„åŸºæœ¬ä¿¡æ¯, åŒ…æ‹¬è¿›ç¨‹ PID, çˆ¶è¿›ç¨‹ PID, å‘½ä»¤è¡Œå‚æ•°ä»¥åŠæ‰§è¡Œçš„ç»“æœ.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, "),a("strong",[s._v("ç”¨ execsnoop ç›‘æ§ä¸Šè¿°æ¡ˆä¾‹, å°±å¯ä»¥ç›´æ¥å¾—åˆ° stress è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ PID ä»¥åŠå®ƒçš„å‘½ä»¤è¡Œå‚æ•°, å¹¶å¯ä»¥å‘ç°å¤§é‡çš„ stress è¿›ç¨‹åœ¨ä¸åœå¯åŠ¨")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‰ Ctrl+C ç»“æŸ")]),s._v("\n$ execsnoop\nPCOMM            PID    "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PPID")]),s._v("   RET ARGS\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30394")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30393")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nstress           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30396")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30394")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /usr/local/bin/stress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30398")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30393")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nstress           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30399")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30398")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /usr/local/bin/stress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30402")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30400")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nstress           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30403")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30402")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /usr/local/bin/stress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30405")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30393")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nstress           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30407")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30405")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /usr/local/bin/stress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("execsnoop æ‰€ç”¨çš„ ftrace æ˜¯ä¸€ç§å¸¸ç”¨çš„"),a("strong",[s._v("åŠ¨æ€è¿½è¸ªæŠ€æœ¯")]),s._v(", ä¸€èˆ¬ç”¨äºåˆ†æ Linux å†…æ ¸çš„è¿è¡Œæ—¶è¡Œä¸º, åé¢è¯¾ç¨‹ä¹Ÿä¼šè¯¦ç»†ä»‹ç»å¹¶ä½¿ç”¨.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("ç¢°åˆ°å¸¸è§„é—®é¢˜æ— æ³•è§£é‡Šçš„ CPU ä½¿ç”¨ç‡æƒ…å†µæ—¶, é¦–å…ˆè¦æƒ³åˆ°æœ‰å¯èƒ½æ˜¯"),a("strong",[s._v("çŸ­æ—¶åº”ç”¨å¯¼è‡´çš„é—®é¢˜")]),s._v(", æ¯”å¦‚æœ‰å¯èƒ½æ˜¯ä¸‹é¢è¿™ä¸¤ç§æƒ…å†µ.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, "),a("strong",[s._v("åº”ç”¨é‡Œç›´æ¥è°ƒç”¨äº†å…¶ä»–äºŒè¿›åˆ¶ç¨‹åº, è¿™äº›ç¨‹åºé€šå¸¸è¿è¡Œæ—¶é—´æ¯”è¾ƒçŸ­, é€šè¿‡ top ç­‰å·¥å…·ä¹Ÿä¸å®¹æ˜“å‘ç°")]),s._v(".")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, "),a("strong",[s._v("åº”ç”¨æœ¬èº«åœ¨ä¸åœåœ°å´©æºƒé‡å¯, è€Œå¯åŠ¨è¿‡ç¨‹çš„èµ„æºåˆå§‹åŒ–, å¾ˆå¯èƒ½ä¼šå ç”¨ç›¸å½“å¤šçš„ CPU")]),s._v(".")])]),s._v(" "),a("p",[s._v("å¯¹äºè¿™ç±»è¿›ç¨‹, "),a("strong",[s._v("å¯ä»¥ç”¨ pstree æˆ–è€… execsnoop æ‰¾åˆ°å®ƒä»¬çš„çˆ¶è¿›ç¨‹, å†ä»çˆ¶è¿›ç¨‹æ‰€åœ¨çš„åº”ç”¨å…¥æ‰‹, æ’æŸ¥é—®é¢˜çš„æ ¹æº")]),s._v(".")]),s._v(" "),a("h4",{attrs:{id:"_07-æ¡ˆä¾‹ç¯‡-ç³»ç»Ÿä¸­å‡ºç°å¤§é‡ä¸å¯ä¸­æ–­è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹æ€ä¹ˆåŠ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_07-æ¡ˆä¾‹ç¯‡-ç³»ç»Ÿä¸­å‡ºç°å¤§é‡ä¸å¯ä¸­æ–­è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 07-æ¡ˆä¾‹ç¯‡:ç³»ç»Ÿä¸­å‡ºç°å¤§é‡ä¸å¯ä¸­æ–­è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹æ€ä¹ˆåŠ?")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚ç”¨ä¸€ä¸ª Nginx+PHP çš„æ¡ˆä¾‹, è®²äº†æœåŠ¡å™¨ CPU ä½¿ç”¨ç‡é«˜çš„åˆ†æå’Œåº”å¯¹æ–¹æ³•. è¿™é‡Œä¸€å®šè¦è®°å¾—, å½“ç¢°åˆ°æ— æ³•è§£é‡Šçš„ CPU ä½¿ç”¨ç‡é—®é¢˜æ—¶, å…ˆè¦æ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯çŸ­æ—¶åº”ç”¨åœ¨æ£é¬¼.")]),s._v(" "),a("p",[a("strong",[s._v("çŸ­æ—¶åº”ç”¨çš„è¿è¡Œæ—¶é—´æ¯”è¾ƒçŸ­, å¾ˆéš¾åœ¨ top æˆ–è€… ps è¿™ç±»å±•ç¤ºç³»ç»Ÿæ¦‚è¦å’Œè¿›ç¨‹å¿«ç…§çš„å·¥å…·ä¸­å‘ç°, éœ€è¦ä½¿ç”¨è®°å½•äº‹ä»¶çš„å·¥å…·æ¥é…åˆè¯Šæ–­, æ¯”å¦‚ execsnoop æˆ–è€… perf top.")])]),s._v(" "),a("p",[s._v("è¿™äº›æ€è·¯ä½ ä¸ç”¨åˆ»æ„å»èƒŒ, å¤šç»ƒä¹ å‡ æ¬¡, å¤šåœ¨æ“ä½œä¸­æ€è€ƒ, ä½ ä¾¿èƒ½çµæ´»è¿ç”¨.")]),s._v(" "),a("p",[s._v("å¦å¤–, è¿˜è®²åˆ° CPU ä½¿ç”¨ç‡çš„ç±»å‹. é™¤äº†ä¸Šä¸€èŠ‚æåˆ°çš„ç”¨æˆ· CPU ä¹‹å¤–, å®ƒè¿˜åŒ…æ‹¬ç³»ç»Ÿ CPU(æ¯”å¦‚ä¸Šä¸‹æ–‡åˆ‡æ¢), ç­‰å¾… I/O çš„ CPU(æ¯”å¦‚ç­‰å¾…ç£ç›˜çš„å“åº”)ä»¥åŠä¸­æ–­ CPU(åŒ…æ‹¬è½¯ä¸­æ–­å’Œç¡¬ä¸­æ–­)ç­‰.")]),s._v(" "),a("p",[s._v("å‰é¢å·²ç»åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–‡ç« ä¸­, ä¸€èµ·åˆ†æäº†ç³»ç»Ÿ CPU ä½¿ç”¨ç‡é«˜çš„é—®é¢˜, å‰©ä¸‹çš„"),a("strong",[s._v("ç­‰å¾… I/O çš„ CPU ä½¿ç”¨ç‡")]),s._v("(ä»¥ä¸‹ç®€ç§°ä¸º iowait)å‡é«˜, ä¹Ÿæ˜¯æœ€å¸¸è§çš„ä¸€ä¸ªæœåŠ¡å™¨æ€§èƒ½é—®é¢˜. ä»Šå¤©å°±æ¥çœ‹ä¸€ä¸ªå¤šè¿›ç¨‹ I/O çš„æ¡ˆä¾‹, å¹¶åˆ†æè¿™ç§æƒ…å†µ.")]),s._v(" "),a("h5",{attrs:{id:"_1-è¿›ç¨‹çŠ¶æ€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-è¿›ç¨‹çŠ¶æ€"}},[s._v("#")]),s._v(" 1.è¿›ç¨‹çŠ¶æ€")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("å½“ iowait å‡é«˜æ—¶, è¿›ç¨‹å¾ˆå¯èƒ½å› ä¸ºå¾—ä¸åˆ°ç¡¬ä»¶çš„å“åº”, è€Œé•¿æ—¶é—´å¤„äºä¸å¯ä¸­æ–­çŠ¶æ€. ä» ps æˆ–è€… top å‘½ä»¤çš„è¾“å‡ºä¸­, ä½ å¯ä»¥å‘ç°å®ƒä»¬éƒ½å¤„äº D çŠ¶æ€, ä¹Ÿå°±æ˜¯ä¸å¯ä¸­æ–­çŠ¶æ€(Uninterruptible Sleep)")])]),s._v(" . æ—¢ç„¶è¯´åˆ°äº†è¿›ç¨‹çš„çŠ¶æ€, è¿›ç¨‹æœ‰å“ªäº›çŠ¶æ€ä½ è¿˜è®°å¾—å—? å…ˆæ¥å›é¡¾ä¸€ä¸‹.")]),s._v(" "),a("p",[s._v("top å’Œ ps æ˜¯æœ€å¸¸ç”¨çš„æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€çš„å·¥å…·, å°±ä» top çš„è¾“å‡ºå¼€å§‹. ä¸‹é¢æ˜¯ä¸€ä¸ª top å‘½ä»¤è¾“å‡ºçš„ç¤ºä¾‹, S åˆ—(ä¹Ÿå°±æ˜¯ Status åˆ—)è¡¨ç¤ºè¿›ç¨‹çš„çŠ¶æ€. ä»è¿™ä¸ªç¤ºä¾‹é‡Œ, å¯ä»¥çœ‹åˆ° R, D, Z, S, I ç­‰å‡ ä¸ªçŠ¶æ€, å®ƒä»¬åˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€å‘¢?")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28961")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43816")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3148")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("620")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37280")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33676")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("908")]),s._v(" D   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 app\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("160072")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9416")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6752")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":37.64 systemd\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1896")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Z   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.00 devapp\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.10 kthreadd\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-20")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.00 kworker/0:0H\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" root       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-20")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.00 mm_percpu_wq\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":06.37 ksoftirqd/0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("æŒ¨ä¸ªæ¥çœ‹ä¸€ä¸‹:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("R")]),s._v(" æ˜¯ Running æˆ– Runnable çš„ç¼©å†™, è¡¨ç¤º"),a("strong",[s._v("è¿›ç¨‹åœ¨ CPU çš„å°±ç»ªé˜Ÿåˆ—ä¸­, æ­£åœ¨è¿è¡Œæˆ–è€…æ­£åœ¨ç­‰å¾…è¿è¡Œ")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("D")]),s._v(" æ˜¯ Disk Sleep çš„ç¼©å†™, ä¹Ÿå°±æ˜¯"),a("strong",[s._v("ä¸å¯ä¸­æ–­çŠ¶æ€ç¡çœ (Uninterruptible Sleep), ä¸€èˆ¬è¡¨ç¤ºè¿›ç¨‹æ­£åœ¨è·Ÿç¡¬ä»¶äº¤äº’, å¹¶ä¸”äº¤äº’è¿‡ç¨‹ä¸å…è®¸è¢«å…¶ä»–è¿›ç¨‹æˆ–ä¸­æ–­æ‰“æ–­")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("Z")]),s._v(' æ˜¯ Zombie çš„ç¼©å†™, å¦‚æœä½ ç©è¿‡ "æ¤ç‰©å¤§æˆ˜åƒµå°¸" è¿™æ¬¾æ¸¸æˆ, åº”è¯¥çŸ¥é“å®ƒçš„æ„æ€. å®ƒè¡¨ç¤º'),a("strong",[s._v("åƒµå°¸è¿›ç¨‹, ä¹Ÿå°±æ˜¯è¿›ç¨‹å®é™…ä¸Šå·²ç»ç»“æŸäº†, ä½†æ˜¯çˆ¶è¿›ç¨‹è¿˜æ²¡æœ‰å›æ”¶å®ƒçš„èµ„æº(æ¯”å¦‚è¿›ç¨‹çš„æè¿°ç¬¦, PID ç­‰)")]),s._v(" .")]),s._v(" "),a("li",[a("strong",[s._v("S")]),s._v(" æ˜¯ Interruptible Sleep çš„ç¼©å†™, ä¹Ÿå°±æ˜¯"),a("strong",[s._v("å¯ä¸­æ–­çŠ¶æ€ç¡çœ , è¡¨ç¤ºè¿›ç¨‹å› ä¸ºç­‰å¾…æŸä¸ªäº‹ä»¶è€Œè¢«ç³»ç»ŸæŒ‚èµ·. å½“è¿›ç¨‹ç­‰å¾…çš„äº‹ä»¶å‘ç”Ÿæ—¶, å®ƒä¼šè¢«å”¤é†’å¹¶è¿›å…¥ R çŠ¶æ€")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("I")]),s._v(" æ˜¯ Idle çš„ç¼©å†™, ä¹Ÿå°±æ˜¯"),a("strong",[s._v("ç©ºé—²çŠ¶æ€, ç”¨åœ¨ä¸å¯ä¸­æ–­ç¡çœ çš„å†…æ ¸çº¿ç¨‹ä¸Š")]),s._v(". å‰é¢è¯´äº†, ç¡¬ä»¶äº¤äº’å¯¼è‡´çš„ä¸å¯ä¸­æ–­è¿›ç¨‹ç”¨ D è¡¨ç¤º, ä½†å¯¹æŸäº›å†…æ ¸çº¿ç¨‹æ¥è¯´, å®ƒä»¬æœ‰å¯èƒ½å®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•è´Ÿè½½, ç”¨ Idle æ­£æ˜¯ä¸ºäº†åŒºåˆ†è¿™ç§æƒ…å†µ. è¦æ³¨æ„, D çŠ¶æ€çš„è¿›ç¨‹ä¼šå¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜, I çŠ¶æ€çš„è¿›ç¨‹å´ä¸ä¼š.")])]),s._v(" "),a("p",[s._v("å½“ç„¶äº†, ä¸Šé¢çš„ç¤ºä¾‹å¹¶æ²¡æœ‰åŒ…æ‹¬è¿›ç¨‹çš„æ‰€æœ‰çŠ¶æ€. é™¤äº†ä»¥ä¸Š 5 ä¸ªçŠ¶æ€, è¿›ç¨‹è¿˜åŒ…æ‹¬ä¸‹é¢è¿™ 2 ä¸ªçŠ¶æ€.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ä¸ªæ˜¯ "),a("strong",[s._v("T æˆ–è€… t")]),s._v(", ä¹Ÿå°±æ˜¯ Stopped æˆ– Traced çš„ç¼©å†™, è¡¨ç¤ºè¿›ç¨‹"),a("strong",[s._v("å¤„äºæš‚åœæˆ–è€…è·Ÿè¸ªçŠ¶æ€")]),s._v(". å‘ä¸€ä¸ªè¿›ç¨‹å‘é€ SIGSTOP ä¿¡å·, å®ƒå°±ä¼šå› å“åº”è¿™ä¸ªä¿¡å·å˜æˆ"),a("strong",[s._v("æš‚åœçŠ¶æ€")]),s._v("(Stopped); å†å‘å®ƒå‘é€ SIGCONT ä¿¡å·, è¿›ç¨‹åˆä¼šæ¢å¤è¿è¡Œ(å¦‚æœè¿›ç¨‹æ˜¯ç»ˆç«¯é‡Œç›´æ¥å¯åŠ¨çš„, åˆ™éœ€è¦ä½ ç”¨ fg å‘½ä»¤, æ¢å¤åˆ°å‰å°è¿è¡Œ). è€Œå½“ç”¨è°ƒè¯•å™¨(å¦‚ gdb)è°ƒè¯•ä¸€ä¸ªè¿›ç¨‹æ—¶, åœ¨ä½¿ç”¨æ–­ç‚¹ä¸­æ–­è¿›ç¨‹å, è¿›ç¨‹å°±ä¼šå˜æˆè·Ÿè¸ªçŠ¶æ€, è¿™å…¶å®ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„æš‚åœçŠ¶æ€, åªä¸è¿‡å¯ä»¥ç”¨è°ƒè¯•å™¨æ¥è·Ÿè¸ªå¹¶æŒ‰éœ€è¦æ§åˆ¶è¿›ç¨‹çš„è¿è¡Œ.")]),s._v(" "),a("p",[s._v("å¦ä¸€ä¸ªæ˜¯ "),a("strong",[s._v("X")]),s._v(", ä¹Ÿå°±æ˜¯ Dead çš„ç¼©å†™, è¡¨ç¤º"),a("strong",[s._v("è¿›ç¨‹å·²ç»æ¶ˆäº¡")]),s._v(", æ‰€ä»¥ä¸ä¼šåœ¨ top æˆ–è€… ps å‘½ä»¤ä¸­çœ‹åˆ°å®ƒ.")]),s._v(" "),a("p",[s._v("äº†è§£äº†è¿™äº›, å†å›åˆ°ä»Šå¤©çš„ä¸»é¢˜. å…ˆçœ‹ä¸å¯ä¸­æ–­çŠ¶æ€, è¿™å…¶å®æ˜¯"),a("strong",[s._v("ä¸ºäº†ä¿è¯è¿›ç¨‹æ•°æ®ä¸ç¡¬ä»¶çŠ¶æ€ä¸€è‡´, å¹¶ä¸”æ­£å¸¸æƒ…å†µä¸‹, ä¸å¯ä¸­æ–­çŠ¶æ€åœ¨å¾ˆçŸ­æ—¶é—´å†…å°±ä¼šç»“æŸ. æ‰€ä»¥, çŸ­æ—¶çš„ä¸å¯ä¸­æ–­çŠ¶æ€è¿›ç¨‹, ä¸€èˆ¬å¯ä»¥å¿½ç•¥")]),s._v(". ä½†å¦‚æœç³»ç»Ÿæˆ–ç¡¬ä»¶å‘ç”Ÿäº†æ•…éšœ, è¿›ç¨‹å¯èƒ½ä¼šåœ¨ä¸å¯ä¸­æ–­çŠ¶æ€ä¿æŒå¾ˆä¹…, ç”šè‡³å¯¼è‡´ç³»ç»Ÿä¸­å‡ºç°å¤§é‡ä¸å¯ä¸­æ–­è¿›ç¨‹. è¿™æ—¶å°±å¾—æ³¨æ„ä¸‹, ç³»ç»Ÿæ˜¯ä¸æ˜¯å‡ºç°äº† I/O ç­‰æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("å†çœ‹åƒµå°¸è¿›ç¨‹, è¿™æ˜¯å¤šè¿›ç¨‹åº”ç”¨å¾ˆå®¹æ˜“ç¢°åˆ°çš„é—®é¢˜. æ­£å¸¸æƒ…å†µä¸‹, "),a("strong",[s._v("å½“ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºäº†å­è¿›ç¨‹å, å®ƒåº”è¯¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨ wait() æˆ–è€… waitpid() ç­‰å¾…å­è¿›ç¨‹ç»“æŸ, å›æ”¶å­è¿›ç¨‹çš„èµ„æº; è€Œå­è¿›ç¨‹åœ¨ç»“æŸæ—¶, ä¼šå‘å®ƒçš„çˆ¶è¿›ç¨‹å‘é€ SIGCHLD ä¿¡å·, æ‰€ä»¥, çˆ¶è¿›ç¨‹è¿˜å¯ä»¥æ³¨å†Œ SIGCHLD ä¿¡å·çš„å¤„ç†å‡½æ•°, å¼‚æ­¥å›æ”¶èµ„æº")]),s._v(".")]),s._v(" "),a("p",[s._v("å¦‚æœçˆ¶è¿›ç¨‹æ²¡è¿™ä¹ˆåš, æˆ–æ˜¯å­è¿›ç¨‹æ‰§è¡Œå¤ªå¿«, çˆ¶è¿›ç¨‹è¿˜æ²¡æ¥å¾—åŠå¤„ç†å­è¿›ç¨‹çŠ¶æ€, å­è¿›ç¨‹å°±å·²ç»æå‰é€€å‡º, é‚£è¿™æ—¶çš„å­è¿›ç¨‹å°±ä¼šå˜æˆ"),a("strong",[s._v("åƒµå°¸è¿›ç¨‹")]),s._v('. æ¢å¥è¯è¯´, çˆ¶äº²åº”è¯¥ä¸€ç›´å¯¹å„¿å­è´Ÿè´£, å–„å§‹å–„ç»ˆ, å¦‚æœä¸ä½œä¸ºæˆ–è€…è·Ÿä¸ä¸Š, éƒ½ä¼šå¯¼è‡´ "é—®é¢˜å°‘å¹´" çš„å‡ºç°.')]),s._v(" "),a("p",[s._v("é€šå¸¸, "),a("strong",[s._v("åƒµå°¸è¿›ç¨‹æŒç»­çš„æ—¶é—´éƒ½æ¯”è¾ƒçŸ­, åœ¨çˆ¶è¿›ç¨‹å›æ”¶å®ƒçš„èµ„æºåå°±ä¼šæ¶ˆäº¡; æˆ–è€…åœ¨çˆ¶è¿›ç¨‹é€€å‡ºå, ç”± init è¿›ç¨‹å›æ”¶åä¹Ÿä¼šæ¶ˆäº¡")]),s._v(". ä¸€æ—¦çˆ¶è¿›ç¨‹æ²¡æœ‰å¤„ç†å­è¿›ç¨‹çš„ç»ˆæ­¢, è¿˜ä¸€ç›´ä¿æŒè¿è¡ŒçŠ¶æ€, é‚£ä¹ˆå­è¿›ç¨‹å°±ä¼šä¸€ç›´å¤„äºåƒµå°¸çŠ¶æ€. "),a("mark",[a("strong",[s._v("å¤§é‡çš„åƒµå°¸è¿›ç¨‹ä¼šç”¨å°½ PID è¿›ç¨‹å·, å¯¼è‡´æ–°è¿›ç¨‹ä¸èƒ½åˆ›å»º, æ‰€ä»¥è¿™ç§æƒ…å†µä¸€å®šè¦é¿å…")])]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ-2"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°†ç”¨ä¸€ä¸ªå¤šè¿›ç¨‹åº”ç”¨çš„æ¡ˆä¾‹, åˆ†æ"),a("strong",[s._v("å¤§é‡ä¸å¯ä¸­æ–­çŠ¶æ€å’Œåƒµå°¸çŠ¶æ€è¿›ç¨‹")]),s._v("çš„é—®é¢˜. è¿™ä¸ªåº”ç”¨åŸºäº C å¼€å‘, ç”±äºå®ƒçš„ç¼–è¯‘å’Œè¿è¡Œæ­¥éª¤æ¯”è¾ƒéº»çƒ¦, æˆ‘æŠŠå®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ª "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/tree/master/high-iowait-process",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker é•œåƒ"),a("OutboundLink")],1),s._v(". è¿™æ ·åªéœ€è¦è¿è¡Œä¸€ä¸ª Docker å®¹å™¨å°±å¯ä»¥å¾—åˆ°æ¨¡æ‹Ÿç¯å¢ƒ.")]),s._v(" "),a("h6",{attrs:{id:"_1-ä½ çš„å‡†å¤‡-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä½ çš„å‡†å¤‡-2"}},[s._v("#")]),s._v(" (1)ä½ çš„å‡†å¤‡")]),s._v(" "),a("p",[s._v("ä¸‹é¢çš„æ¡ˆä¾‹ä»ç„¶åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sysstat, dstat ç­‰å·¥å…·, å¦‚ apt install "),a("a",{attrs:{href:"http://docker.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker.io"),a("OutboundLink")],1),s._v(" dstat sysstat")])]),s._v(" "),a("p",[s._v("è¿™é‡Œ, dstat æ˜¯ä¸€ä¸ªæ–°çš„æ€§èƒ½å·¥å…·, å®ƒå¸æ”¶äº† vmstat, iostat, ifstat ç­‰å‡ ç§å·¥å…·çš„ä¼˜ç‚¹, å¯ä»¥åŒæ—¶è§‚å¯Ÿç³»ç»Ÿçš„ CPU, ç£ç›˜ I/O, ç½‘ç»œä»¥åŠå†…å­˜ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, æ‰“å¼€ä¸€ä¸ªç»ˆç«¯, SSH ç™»å½•åˆ°æœºå™¨ä¸Š, å¹¶å®‰è£…ä¸Šè¿°å·¥å…·.")]),s._v(" "),a("h6",{attrs:{id:"_2-æ“ä½œå’Œåˆ†æ-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ“ä½œå’Œåˆ†æ-4"}},[s._v("#")]),s._v(" (2)æ“ä½œå’Œåˆ†æ")]),s._v(" "),a("p",[s._v("å®‰è£…å®Œæˆå, é¦–å…ˆæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿è¡Œæ¡ˆä¾‹åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/app:iowait\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶å, è¾“å…¥ ps å‘½ä»¤, ç¡®è®¤æ¡ˆä¾‹åº”ç”¨å·²æ­£å¸¸å¯åŠ¨. å¦‚æœä¸€åˆ‡æ­£å¸¸, åº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" /app\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4009")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4376")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1008")]),s._v(" pts/0    Ss+  05:51   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 /app\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4287")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.6")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37280")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33660")]),s._v(" pts/0    D+   05:54   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 /app\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4288")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.6")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37280")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33668")]),s._v(" pts/0    D+   05:54   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 /app\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä»è¿™ä¸ªç•Œé¢, å¯ä»¥å‘ç°å¤šä¸ª app è¿›ç¨‹å·²ç»å¯åŠ¨, å¹¶ä¸”å®ƒä»¬çš„çŠ¶æ€åˆ†åˆ«æ˜¯ "),a("strong",[s._v("Ss+ å’Œ D+")]),s._v(" . å…¶ä¸­, S è¡¨ç¤ºå¯ä¸­æ–­ç¡çœ çŠ¶æ€, D è¡¨ç¤ºä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€, åœ¨å‰é¢åˆšå­¦è¿‡, é‚£åé¢çš„ s å’Œ + æ˜¯ä»€ä¹ˆæ„æ€å‘¢? ä¸çŸ¥é“ä¹Ÿæ²¡å…³ç³», æŸ¥ä¸€ä¸‹ man ps å°±å¯ä»¥. ç°åœ¨è®°ä½, "),a("strong",[s._v("s è¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹æ˜¯ä¸€ä¸ªä¼šè¯çš„é¢†å¯¼è¿›ç¨‹, è€Œ + è¡¨ç¤ºå‰å°è¿›ç¨‹ç»„")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™é‡Œåˆå‡ºç°äº†ä¸¤ä¸ªæ–°æ¦‚å¿µ, "),a("strong",[s._v("è¿›ç¨‹ç»„")]),s._v("å’Œ"),a("strong",[s._v("ä¼šè¯")]),s._v(". å®ƒä»¬ç”¨æ¥ç®¡ç†ä¸€ç»„ç›¸äº’å…³è”çš„è¿›ç¨‹, æ„æ€å…¶å®å¾ˆå¥½ç†è§£.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("è¿›ç¨‹ç»„è¡¨ç¤ºä¸€ç»„ç›¸äº’å…³è”çš„è¿›ç¨‹, æ¯”å¦‚æ¯ä¸ªå­è¿›ç¨‹éƒ½æ˜¯çˆ¶è¿›ç¨‹æ‰€åœ¨ç»„çš„æˆå‘˜")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("è€Œä¼šè¯æ˜¯æŒ‡å…±äº«åŒä¸€ä¸ªæ§åˆ¶ç»ˆç«¯çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ç»„")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ¯”å¦‚é€šè¿‡ SSH ç™»å½•æœåŠ¡å™¨, å°±ä¼šæ‰“å¼€ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯(TTY), è¿™ä¸ªæ§åˆ¶ç»ˆç«¯å°±å¯¹åº”ä¸€ä¸ªä¼šè¯. è€Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œçš„å‘½ä»¤ä»¥åŠå®ƒä»¬çš„å­è¿›ç¨‹, å°±æ„æˆäº†ä¸€ä¸ªä¸ªçš„è¿›ç¨‹ç»„, å…¶ä¸­, åœ¨åå°è¿è¡Œçš„å‘½ä»¤, æ„æˆåå°è¿›ç¨‹ç»„; åœ¨å‰å°è¿è¡Œçš„å‘½ä»¤, æ„æˆå‰å°è¿›ç¨‹ç»„.")]),s._v(" "),a("p",[s._v("æ˜ç™½äº†è¿™äº›, å†ç”¨ top çœ‹ä¸€ä¸‹ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‰ä¸‹æ•°å­— 1 åˆ‡æ¢åˆ°æ‰€æœ‰ CPU çš„ä½¿ç”¨æƒ…å†µ, è§‚å¯Ÿä¸€ä¼šå„¿æŒ‰ Ctrl+C ç»“æŸ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - 05:56:23 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" days, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":45,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" users,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.68")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.39")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("247")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(" zombie\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38.9")]),s._v(" id, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60.5")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.7")]),s._v(" id, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.6")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4340")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44676")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4048")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3432")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.05 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4345")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37280")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33624")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("860")]),s._v(" D   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 app\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4344")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37280")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33624")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("860")]),s._v(" D   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 app\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("160072")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9416")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6752")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":38.59 systemd\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œä½ èƒ½çœ‹å‡ºä»€ä¹ˆé—®é¢˜å—? ç»†å¿ƒä¸€ç‚¹, é€è¡Œè§‚å¯Ÿ, åˆ«æ”¾è¿‡ä»»ä½•ä¸€ä¸ªåœ°æ–¹. å¿˜äº†å“ªè¡Œå‚æ•°æ„æ€çš„è¯, ä¹Ÿè¦åŠæ—¶è¿”å›å»å¤ä¹ . è¿™é‡Œ, æˆ‘å‘ç°äº†å››ä¸ªå¯ç–‘çš„åœ°æ–¹.")]),s._v(" "),a("ul",[a("li",[s._v("å…ˆçœ‹"),a("strong",[s._v("ç¬¬ä¸€è¡Œçš„å¹³å‡è´Ÿè½½( Load Average)")]),s._v(" , è¿‡å» 1 åˆ†é’Ÿ, 5 åˆ†é’Ÿå’Œ 15 åˆ†é’Ÿå†…çš„å¹³å‡è´Ÿè½½åœ¨ä¾æ¬¡å‡å°, è¯´æ˜"),a("strong",[s._v("å¹³å‡è´Ÿè½½æ­£åœ¨å‡é«˜")]),s._v("; è€Œ 1 åˆ†é’Ÿå†…çš„å¹³å‡è´Ÿè½½å·²ç»è¾¾åˆ°ç³»ç»Ÿçš„ CPU ä¸ªæ•°, è¯´æ˜ç³»ç»Ÿå¾ˆå¯èƒ½å·²ç»æœ‰äº†æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("li",[s._v("å†çœ‹ç¬¬äºŒè¡Œçš„ Tasks, "),a("strong",[s._v("æœ‰ 1 ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹, ä½†åƒµå°¸è¿›ç¨‹æ¯”è¾ƒå¤š, è€Œä¸”è¿˜åœ¨ä¸åœå¢åŠ , è¯´æ˜æœ‰å­è¿›ç¨‹åœ¨é€€å‡ºæ—¶æ²¡è¢«æ¸…ç†")]),s._v(".")]),s._v(" "),a("li",[s._v("æ¥ä¸‹æ¥çœ‹ä¸¤ä¸ª CPU çš„ä½¿ç”¨ç‡æƒ…å†µ, ç”¨æˆ· CPU å’Œç³»ç»Ÿ CPU éƒ½ä¸é«˜, ä½† "),a("strong",[s._v("iowait åˆ†åˆ«æ˜¯ 60.5% å’Œ 94.6%")]),s._v(" , å¥½åƒæœ‰ç‚¹å„¿ä¸æ­£å¸¸.")]),s._v(" "),a("li",[s._v("æœ€åå†çœ‹æ¯ä¸ªè¿›ç¨‹çš„æƒ…å†µ, "),a("strong",[s._v("CPU ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹åªæœ‰ 0.3%, çœ‹èµ·æ¥å¹¶ä¸é«˜; ä½†æœ‰ä¸¤ä¸ªè¿›ç¨‹å¤„äº D çŠ¶æ€, å®ƒä»¬å¯èƒ½åœ¨ç­‰å¾… I/O, ä½†å…‰å‡­è¿™é‡Œå¹¶ä¸èƒ½ç¡®å®šæ˜¯å®ƒä»¬å¯¼è‡´äº† iowait å‡é«˜")]),s._v(".")])]),s._v(" "),a("p",[s._v("æŠŠè¿™å››ä¸ªé—®é¢˜å†æ±‡æ€»ä¸€ä¸‹, å°±å¯ä»¥å¾—åˆ°å¾ˆæ˜ç¡®çš„ä¸¤ç‚¹:")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç‚¹, "),a("strong",[s._v("iowait å¤ªé«˜äº†, å¯¼è‡´ç³»ç»Ÿçš„å¹³å‡è´Ÿè½½å‡é«˜, ç”šè‡³è¾¾åˆ°äº†ç³»ç»Ÿ CPU çš„ä¸ªæ•°")]),s._v(".")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç‚¹, "),a("strong",[s._v("åƒµå°¸è¿›ç¨‹åœ¨ä¸æ–­å¢å¤š, è¯´æ˜æœ‰ç¨‹åºæ²¡èƒ½æ­£ç¡®æ¸…ç†å­è¿›ç¨‹çš„èµ„æº")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥ä¸€èµ·é¡ºç€è¿™ä¸¤ä¸ªé—®é¢˜ç»§ç»­åˆ†æ, æ‰¾å‡ºæ ¹æº.")]),s._v(" "),a("h5",{attrs:{id:"_3-iowaitåˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-iowaitåˆ†æ"}},[s._v("#")]),s._v(" 3.iowaitåˆ†æ")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹ä¸€ä¸‹ iowait å‡é«˜çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("æˆ‘ç›¸ä¿¡, ä¸€æåˆ° iowait å‡é«˜, ä½ é¦–å…ˆä¼šæƒ³è¦"),a("strong",[s._v("æŸ¥è¯¢ç³»ç»Ÿçš„ I/O æƒ…å†µ")]),s._v(". æˆ‘ä¸€èˆ¬ä¹Ÿæ˜¯è¿™ç§æ€è·¯, é‚£ä¹ˆä»€ä¹ˆå·¥å…·å¯ä»¥æŸ¥è¯¢ç³»ç»Ÿçš„ I/O æƒ…å†µå‘¢?")]),s._v(" "),a("p",[s._v("è¿™é‡Œæ¨èçš„æ­£æ˜¯ä¸ŠèŠ‚è¯¾è¦æ±‚å®‰è£…çš„ "),a("strong",[s._v("dstat")]),s._v(", å®ƒçš„å¥½å¤„æ˜¯, å¯ä»¥"),a("strong",[s._v("åŒæ—¶æŸ¥çœ‹ CPU å’Œ I/O è¿™ä¸¤ç§èµ„æºçš„ä½¿ç”¨æƒ…å†µ")]),s._v(", ä¾¿äºå¯¹æ¯”åˆ†æ.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆåœ¨ç»ˆç«¯ä¸­è¿è¡Œ dstat å‘½ä»¤, è§‚å¯Ÿ CPU å’Œ I/O çš„ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é—´éš” 1 ç§’è¾“å‡º 10 ç»„æ•°æ®")]),s._v("\n$ dstat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nYou did not "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" any stats, using "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cdngy")]),s._v(" by default.\n--total-cpu-usage-- -dsk/total- -net/total- ---paging-- ---system--\nusr sys idl wai stl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("  writ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" recv  send"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   out "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" int   csw\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("1219k  408k"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("885")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  34M    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 198B  790B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("138")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  34M    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  66B  342B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("135")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("5633k    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  66B  342B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("177")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("58")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  22M    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  66B  342B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("144")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  34M    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 200B  450B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("147")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  34M    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  66B  342B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  34M    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  66B  342B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("5633k    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  66B  342B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("168")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  22M    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  66B  342B"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("ä» dstat çš„è¾“å‡º, å¯ä»¥çœ‹åˆ°, "),a("strong",[s._v("æ¯å½“ iowait å‡é«˜(wai)æ—¶, ç£ç›˜çš„è¯»è¯·æ±‚(read)éƒ½ä¼šå¾ˆå¤§. è¿™è¯´æ˜ iowait çš„å‡é«˜è·Ÿç£ç›˜çš„è¯»è¯·æ±‚æœ‰å…³, å¾ˆå¯èƒ½å°±æ˜¯ç£ç›˜è¯»å¯¼è‡´çš„")]),s._v(".")]),s._v(" "),a("p",[s._v("é‚£åˆ°åº•æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨è¯»ç£ç›˜å‘¢? ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—, ä¸ŠèŠ‚åœ¨ top é‡Œçœ‹åˆ°çš„ä¸å¯ä¸­æ–­çŠ¶æ€è¿›ç¨‹, æˆ‘è§‰å¾—å®ƒå°±å¾ˆå¯ç–‘, è¯•ç€æ¥åˆ†æä¸‹.")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨åˆšæ‰çš„ç»ˆç«¯ä¸­, è¿è¡Œ top å‘½ä»¤, è§‚å¯Ÿ D çŠ¶æ€çš„è¿›ç¨‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è§‚å¯Ÿä¸€ä¼šå„¿æŒ‰ Ctrl+C ç»“æŸ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4340")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44676")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4048")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3432")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.05 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4345")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37280")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33624")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("860")]),s._v(" D   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 app\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4344")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37280")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33624")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("860")]),s._v(" D   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 app\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä» top çš„è¾“å‡ºæ‰¾åˆ° D çŠ¶æ€è¿›ç¨‹çš„ PID, å¯ä»¥å‘ç°, è¿™ä¸ªç•Œé¢é‡Œæœ‰ä¸¤ä¸ª D çŠ¶æ€çš„è¿›ç¨‹, PID åˆ†åˆ«æ˜¯ 4344 å’Œ 4345.")]),s._v(" "),a("p",[s._v("æ¥ç€æŸ¥çœ‹è¿™äº›è¿›ç¨‹çš„ç£ç›˜è¯»å†™æƒ…å†µ. å¯¹äº†, åˆ«å¿˜äº†å·¥å…·æ˜¯ä»€ä¹ˆ. ä¸€èˆ¬è¦æŸ¥çœ‹æŸä¸€ä¸ªè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µ, éƒ½å¯ä»¥ç”¨è€æœ‹å‹ pidstat, ä¸è¿‡è¿™æ¬¡è®°å¾—åŠ ä¸Š -d å‚æ•°, ä»¥ä¾¿è¾“å‡º I/O ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä»¥ 4344 ä¸ºä¾‹, åœ¨ç»ˆç«¯é‡Œè¿è¡Œä¸‹é¢çš„ pidstat å‘½ä»¤, å¹¶ç”¨ -p 4344 å‚æ•°æŒ‡å®šè¿›ç¨‹å·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d å±•ç¤º I/O ç»Ÿè®¡æ•°æ®, -p æŒ‡å®šè¿›ç¨‹å·, é—´éš” 1 ç§’è¾“å‡º 3 ç»„æ•°æ®")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4344")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n06:38:50      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:38:51        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4344")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  app\n06:38:52        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4344")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  app\n06:38:53        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4344")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  app\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("åœ¨è¿™ä¸ªè¾“å‡ºä¸­, kB_rd è¡¨ç¤ºæ¯ç§’è¯»çš„ KB æ•°, kB_wr è¡¨ç¤ºæ¯ç§’å†™çš„ KB æ•°, iodelay è¡¨ç¤º I/O çš„å»¶è¿Ÿ(å•ä½æ˜¯æ—¶é’Ÿå‘¨æœŸ). å®ƒä»¬éƒ½æ˜¯ 0, é‚£å°±è¡¨ç¤ºæ­¤æ—¶æ²¡æœ‰ä»»ä½•çš„è¯»å†™, è¯´æ˜é—®é¢˜ä¸æ˜¯ 4344 è¿›ç¨‹å¯¼è‡´çš„.")]),s._v(" "),a("p",[s._v("å¯æ˜¯, ç”¨åŒæ ·çš„æ–¹æ³•åˆ†æè¿›ç¨‹ 4345, ä½ ä¼šå‘ç°, å®ƒä¹Ÿæ²¡æœ‰ä»»ä½•ç£ç›˜è¯»å†™.")]),s._v(" "),a("p",[s._v("é‚£è¦æ€ä¹ˆçŸ¥é“, "),a("strong",[s._v("åˆ°åº•æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨è¿›è¡Œç£ç›˜è¯»å†™å‘¢")]),s._v("? ç»§ç»­ä½¿ç”¨ pidstat, ä½†è¿™æ¬¡å»æ‰è¿›ç¨‹å·, å¹²è„†å°±æ¥è§‚å¯Ÿæ‰€æœ‰è¿›ç¨‹çš„ I/O ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„ pidstat å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é—´éš” 1 ç§’è¾“å‡ºå¤šç»„æ•°æ® (è¿™é‡Œæ˜¯ 20 ç»„)")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n06:48:46      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:47        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4615")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  kworker/u4:1\n06:48:47        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6080")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("170")]),s._v("  app\n06:48:47        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6081")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("184")]),s._v("  app\n \n06:48:47      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:48        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6080")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v("  app\n \n06:48:48      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:49        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6081")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("191")]),s._v("  app\n \n06:48:49      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n \n06:48:50      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:51        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6082")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  app\n06:48:51        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6083")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  app\n \n06:48:51      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:52        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6082")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("184")]),s._v("  app\n06:48:52        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6083")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("175")]),s._v("  app\n \n06:48:52      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:53        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6083")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v("  app\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿä¸€ä¼šå„¿å¯ä»¥å‘ç°, çš„ç¡®æ˜¯ app è¿›ç¨‹åœ¨è¿›è¡Œç£ç›˜è¯», å¹¶ä¸”æ¯ç§’è¯»çš„æ•°æ®æœ‰ 32 MB, çœ‹æ¥å°±æ˜¯ app çš„é—®é¢˜. ä¸è¿‡, app è¿›ç¨‹åˆ°åº•åœ¨æ‰§è¡Œå•¥ I/O æ“ä½œå‘¢?")]),s._v(" "),a("p",[s._v("è¿™é‡Œéœ€è¦å›é¡¾ä¸€ä¸‹è¿›ç¨‹ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åŒºåˆ«. "),a("strong",[s._v("è¿›ç¨‹æƒ³è¦è®¿é—®ç£ç›˜, å°±å¿…é¡»ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨")]),s._v(", æ‰€ä»¥æ¥ä¸‹æ¥, é‡ç‚¹å°±æ˜¯æ‰¾å‡º app è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨äº†.")]),s._v(" "),a("p",[a("strong",[s._v("strace æ­£æ˜¯æœ€å¸¸ç”¨çš„è·Ÿè¸ªè¿›ç¨‹ç³»ç»Ÿè°ƒç”¨çš„å·¥å…·")]),s._v(". æ‰€ä»¥ä» pidstat çš„è¾“å‡ºä¸­æ‹¿åˆ°è¿›ç¨‹çš„ PID å·, æ¯”å¦‚ 6082, ç„¶ååœ¨ç»ˆç«¯ä¸­è¿è¡Œ strace å‘½ä»¤, å¹¶ç”¨ -p å‚æ•°æŒ‡å®š PID å·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6082")]),s._v("\nstrace: attach: ptrace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("PTRACE_SEIZE, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6082")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": Operation not permitted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("è¿™å„¿å‡ºç°äº†ä¸€ä¸ªå¥‡æ€ªçš„é”™è¯¯, strace å‘½ä»¤å±…ç„¶å¤±è´¥äº†, å¹¶ä¸”å‘½ä»¤æŠ¥å‡ºçš„é”™è¯¯æ˜¯"),a("strong",[s._v("æ²¡æœ‰æƒé™")]),s._v(". æŒ‰ç†æ¥è¯´, æ‰€æœ‰æ“ä½œéƒ½å·²ç»æ˜¯ä»¥ root ç”¨æˆ·è¿è¡Œäº†, ä¸ºä»€ä¹ˆè¿˜ä¼šæ²¡æœ‰æƒé™å‘¢? ä¹Ÿå¯ä»¥å…ˆæƒ³ä¸€ä¸‹, ç¢°åˆ°è¿™ç§æƒ…å†µ, ä½ ä¼šæ€ä¹ˆå¤„ç†å‘¢?")]),s._v(" "),a("p",[a("strong",[s._v("ä¸€èˆ¬é‡åˆ°è¿™ç§é—®é¢˜æ—¶, æˆ‘ä¼šå…ˆæ£€æŸ¥ä¸€ä¸‹è¿›ç¨‹çš„çŠ¶æ€æ˜¯å¦æ­£å¸¸")]),s._v(". æ¯”å¦‚ç»§ç»­åœ¨ç»ˆç«¯ä¸­è¿è¡Œ ps å‘½ä»¤, å¹¶ä½¿ç”¨ grep æ‰¾å‡ºåˆšæ‰çš„ 6082 å·è¿›ç¨‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6082")]),s._v("\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6082")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pts/0    Z+   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":43   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("defunct"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æœç„¶, è¿›ç¨‹ 6082 å·²ç»å˜æˆäº† Z çŠ¶æ€, ä¹Ÿå°±æ˜¯"),a("strong",[s._v("åƒµå°¸è¿›ç¨‹")]),s._v(". åƒµå°¸è¿›ç¨‹éƒ½æ˜¯å·²ç»é€€å‡ºçš„è¿›ç¨‹, æ‰€ä»¥å°±æ²¡æ³•å„¿ç»§ç»­åˆ†æå®ƒçš„ç³»ç»Ÿè°ƒç”¨. å…³äºåƒµå°¸è¿›ç¨‹çš„å¤„ç†æ–¹æ³•, ä¸€ä¼šå„¿å†è¯´, ç°åœ¨è¿˜æ˜¯ç»§ç»­åˆ†æ iowait çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("åˆ°è¿™ä¸€æ­¥, ä½ åº”è¯¥æ³¨æ„åˆ°äº†, ç³»ç»Ÿ iowait çš„é—®é¢˜è¿˜åœ¨ç»§ç»­, ä½†æ˜¯ top, pidstat è¿™ç±»å·¥å…·å·²ç»ä¸èƒ½ç»™å‡ºæ›´å¤šçš„ä¿¡æ¯äº†. è¿™æ—¶å°±åº”è¯¥æ±‚åŠ©é‚£äº›"),a("strong",[s._v("åŸºäºäº‹ä»¶è®°å½•çš„åŠ¨æ€è¿½è¸ªå·¥å…·")]),s._v("äº†.")]),s._v(" "),a("p",[s._v("å¯ä»¥ç”¨ perf top çœ‹çœ‹æœ‰æ²¡æœ‰æ–°å‘ç°. å†æˆ–è€…å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œ "),a("strong",[s._v("perf record")]),s._v(", æŒç»­ä¸€ä¼šå„¿(ä¾‹å¦‚ 15 ç§’), ç„¶åæŒ‰ Ctrl+C é€€å‡º, å†è¿è¡Œ perf report æŸ¥çœ‹æŠ¥å‘Š:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v("\n$ perf report\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ç€, æ‰¾åˆ°å…³æ³¨çš„ app è¿›ç¨‹, æŒ‰å›è½¦é”®å±•å¼€è°ƒç”¨æ ˆ, å°±ä¼šå¾—åˆ°ä¸‹é¢è¿™å¼ è°ƒç”¨å…³ç³»å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1b25b83b5a6b9dc07bc8dcf86640bdf5-20230731161933-iwb0d0z.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™ä¸ªå›¾é‡Œçš„ swapper æ˜¯å†…æ ¸ä¸­çš„è°ƒåº¦è¿›ç¨‹, å¯ä»¥å…ˆå¿½ç•¥æ‰.")]),s._v(" "),a("p",[s._v("æ¥çœ‹å…¶ä»–ä¿¡æ¯, å¯ä»¥å‘ç°, app çš„ç¡®åœ¨"),a("strong",[s._v("é€šè¿‡ç³»ç»Ÿè°ƒç”¨ sys_read() è¯»å–æ•°æ®")]),s._v(". å¹¶ä¸”ä» new_sync_read å’Œ blkdev_direct_IO èƒ½çœ‹å‡º, è¿›ç¨‹æ­£åœ¨å¯¹ç£ç›˜è¿›è¡Œ"),a("strong",[s._v("ç›´æ¥è¯»")]),s._v(", ä¹Ÿå°±æ˜¯"),a("strong",[s._v("ç»•è¿‡äº†ç³»ç»Ÿç¼“å­˜, æ¯ä¸ªè¯»è¯·æ±‚éƒ½ä¼šä»ç£ç›˜ç›´æ¥è¯»")]),s._v(", è¿™å°±å¯ä»¥è§£é‡Šè§‚å¯Ÿåˆ°çš„ iowait å‡é«˜äº†.")]),s._v(" "),a("p",[s._v("çœ‹æ¥, ç½ªé­ç¥¸é¦–æ˜¯ app å†…éƒ¨è¿›è¡Œäº†"),a("strong",[s._v("ç£ç›˜çš„ç›´æ¥ I/O")]),s._v(" å•Š!")]),s._v(" "),a("p",[s._v("ä¸‹é¢çš„é—®é¢˜å°±å®¹æ˜“è§£å†³äº†. æ¥ä¸‹æ¥åº”è¯¥ä»ä»£ç å±‚é¢åˆ†æ, ç©¶ç«Ÿæ˜¯å“ªé‡Œå‡ºç°äº†ç›´æ¥è¯»è¯·æ±‚. æŸ¥çœ‹æºç æ–‡ä»¶ "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/app.c",target:"_blank",rel:"noopener noreferrer"}},[s._v("app.c"),a("OutboundLink")],1),s._v(", ä¼šå‘ç°å®ƒæœç„¶"),a("strong",[s._v("ä½¿ç”¨äº† O_DIRECT é€‰é¡¹æ‰“å¼€ç£ç›˜")]),s._v(", äºæ˜¯ç»•è¿‡äº†ç³»ç»Ÿç¼“å­˜, ç›´æ¥å¯¹ç£ç›˜è¿›è¡Œè¯»å†™.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("disk, O_RDONLY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("O_DIRECT"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("O_LARGEFILE, 0755"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç›´æ¥è¯»å†™ç£ç›˜, å¯¹ I/O æ•æ„Ÿå‹åº”ç”¨(æ¯”å¦‚æ•°æ®åº“ç³»ç»Ÿ)æ˜¯å¾ˆå‹å¥½çš„, å› ä¸ºå¯ä»¥åœ¨åº”ç”¨ä¸­, ç›´æ¥æ§åˆ¶ç£ç›˜çš„è¯»å†™. ä½†åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹, æœ€å¥½è¿˜æ˜¯é€šè¿‡ç³»ç»Ÿç¼“å­˜æ¥ä¼˜åŒ–ç£ç›˜ I/O, æ¢å¥è¯è¯´, åˆ é™¤ O_DIRECT è¿™ä¸ªé€‰é¡¹å°±æ˜¯äº†.")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/app-fix1.c",target:"_blank",rel:"noopener noreferrer"}},[s._v("app-fix1.c"),a("OutboundLink")],1),s._v(" å°±æ˜¯ä¿®æ”¹åçš„æ–‡ä»¶, æˆ‘ä¹Ÿæ‰“åŒ…æˆäº†ä¸€ä¸ªé•œåƒæ–‡ä»¶, è¿è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥å¯åŠ¨å®ƒäº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é¦–å…ˆåˆ é™¤åŸæ¥çš„åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œæ–°çš„åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/app:iowait-fix1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æœ€å, å†ç”¨ top æ£€æŸ¥ä¸€ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":59:32 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" min,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.15")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.07")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" zombie\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.0")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.7")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3084")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Z   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.04 app\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3085")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Z   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.04 app\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("159848")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9120")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6724")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":09.03 systemd\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.00 kthreadd\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.40 kworker/0:0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("ä½ ä¼šå‘ç°, iowait å·²ç»éå¸¸ä½äº†, åªæœ‰ 0.3%, è¯´æ˜åˆšæ‰çš„æ”¹åŠ¨å·²ç»æˆåŠŸä¿®å¤äº† iowait é«˜çš„é—®é¢˜, å¤§åŠŸå‘Šæˆ! ä¸è¿‡, åˆ«å¿˜äº†åƒµå°¸è¿›ç¨‹è¿˜åœ¨ç­‰ç€ä½ . ä»”ç»†è§‚å¯Ÿåƒµå°¸è¿›ç¨‹çš„æ•°é‡, ä½ ä¼šéƒé—·åœ°å‘ç°, åƒµå°¸è¿›ç¨‹è¿˜åœ¨ä¸æ–­çš„å¢é•¿ä¸­.")]),s._v(" "),a("h5",{attrs:{id:"_4-åƒµå°¸è¿›ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-åƒµå°¸è¿›ç¨‹"}},[s._v("#")]),s._v(" 4.åƒµå°¸è¿›ç¨‹")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, å°±æ¥å¤„ç†åƒµå°¸è¿›ç¨‹çš„é—®é¢˜. æ—¢ç„¶åƒµå°¸è¿›ç¨‹æ˜¯å› ä¸ºçˆ¶è¿›ç¨‹æ²¡æœ‰å›æ”¶å­è¿›ç¨‹çš„èµ„æºè€Œå‡ºç°çš„, é‚£ä¹ˆè¦è§£å†³æ‰å®ƒä»¬, å°±è¦æ‰¾åˆ°å®ƒä»¬çš„æ ¹å„¿, "),a("mark",[a("strong",[s._v("ä¹Ÿå°±æ˜¯æ‰¾å‡ºçˆ¶è¿›ç¨‹, ç„¶ååœ¨çˆ¶è¿›ç¨‹é‡Œè§£å†³")])]),s._v("â€‹ "),a("strong",[s._v(".")])]),s._v(" "),a("p",[s._v("çˆ¶è¿›ç¨‹çš„æ‰¾æ³•å‰é¢è®²è¿‡, æœ€ç®€å•çš„å°±æ˜¯è¿è¡Œ "),a("strong",[s._v("pstree")]),s._v(" å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -a è¡¨ç¤ºè¾“å‡ºå‘½ä»¤è¡Œé€‰é¡¹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# p è¡¨ PID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# s è¡¨ç¤ºæŒ‡å®šè¿›ç¨‹çš„çˆ¶è¿›ç¨‹")]),s._v("\n$ pstree "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3084")]),s._v("\nsystemd,1\n  â””â”€dockerd,15006 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" fd://\n      â””â”€docker-containe,15024 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config")]),s._v(" /var/run/docker/containerd/containerd.toml\n          â””â”€docker-containe,3991 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-namespace")]),s._v(" moby -workdir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n              â””â”€app,4009\n                  â””â”€"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app,3084"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("è¿è¡Œå®Œ, ä½ ä¼šå‘ç° 3084 å·è¿›ç¨‹çš„"),a("strong",[s._v("çˆ¶è¿›ç¨‹æ˜¯ 4009")]),s._v(", ä¹Ÿå°±æ˜¯ app åº”ç”¨.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥æ¥ç€æŸ¥çœ‹ app åº”ç”¨ç¨‹åºçš„ä»£ç , çœ‹çœ‹å­è¿›ç¨‹ç»“æŸçš„å¤„ç†æ˜¯å¦æ­£ç¡®, æ¯”å¦‚"),a("strong",[s._v("æœ‰æ²¡æœ‰è°ƒç”¨ wait() æˆ– waitpid()")]),s._v(" , æŠ‘æˆ–æ˜¯, "),a("strong",[s._v("æœ‰æ²¡æœ‰æ³¨å†Œ SIGCHLD ä¿¡å·çš„å¤„ç†å‡½æ•°")]),s._v(".")]),s._v(" "),a("p",[s._v("ç°åœ¨æŸ¥çœ‹ä¿®å¤ iowait åçš„æºç æ–‡ä»¶ "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/app-fix1.c",target:"_blank",rel:"noopener noreferrer"}},[s._v("app-fix1.c"),a("OutboundLink")],1),s._v(", æ‰¾åˆ°å­è¿›ç¨‹çš„åˆ›å»ºå’Œæ¸…ç†çš„åœ°æ–¹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("int status "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("int i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i++"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      if"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sub_process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n  while"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("å¾ªç¯è¯­å¥æœ¬æ¥å°±å®¹æ˜“å‡ºé”™, ä½ èƒ½æ‰¾åˆ°è¿™é‡Œçš„é—®é¢˜å—? è¿™æ®µä»£ç è™½ç„¶çœ‹èµ·æ¥è°ƒç”¨äº† wait() å‡½æ•°ç­‰å¾…å­è¿›ç¨‹ç»“æŸ, ä½†å´é”™è¯¯åœ°æŠŠ wait() æ”¾åˆ°äº† for æ­»å¾ªç¯çš„å¤–é¢, ä¹Ÿå°±æ˜¯è¯´, "),a("strong",[s._v("wait() å‡½æ•°å®é™…ä¸Šå¹¶æ²¡è¢«è°ƒç”¨åˆ°")]),s._v(", æŠŠå®ƒæŒªåˆ° for å¾ªç¯çš„é‡Œé¢å°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v("ä¿®æ”¹åçš„æ–‡ä»¶æ”¾åˆ°äº† "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/app-fix2.c",target:"_blank",rel:"noopener noreferrer"}},[s._v("app-fix2.c"),a("OutboundLink")],1),s._v(" ä¸­, ä¹Ÿæ‰“åŒ…æˆäº†ä¸€ä¸ª Docker é•œåƒ, è¿è¡Œä¸‹é¢çš„å‘½ä»¤, ä½ å°±å¯ä»¥å¯åŠ¨å®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…ˆåœæ­¢äº§ç”Ÿåƒµå°¸è¿›ç¨‹çš„ app")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç„¶åå¯åŠ¨æ–°çš„ app")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/app:iowait-fix2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("å¯åŠ¨å, å†ç”¨ top æœ€åæ¥æ£€æŸ¥ä¸€é:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":00:44 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" min,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.04")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("125")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.3")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.7")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3198")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4376")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("840")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("780")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 app\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.00 kthreadd\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.41 kworker/0:0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("å¥½äº†, åƒµå°¸è¿›ç¨‹(Z çŠ¶æ€)æ²¡æœ‰äº†, iowait ä¹Ÿæ˜¯ 0, é—®é¢˜ç»ˆäºå…¨éƒ¨è§£å†³äº†.")]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“-2"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[s._v("ä»Šå¤©ç”¨ä¸€ä¸ªå¤šè¿›ç¨‹çš„æ¡ˆä¾‹, åˆ†æç³»ç»Ÿç­‰å¾… I/O çš„ CPU ä½¿ç”¨ç‡(ä¹Ÿå°±æ˜¯ iowait%)å‡é«˜çš„æƒ…å†µ.")]),s._v(" "),a("p",[s._v("è™½ç„¶è¿™ä¸ªæ¡ˆä¾‹æ˜¯ç£ç›˜ I/O å¯¼è‡´äº† iowait å‡é«˜, ä¸è¿‡ "),a("mark",[a("strong",[s._v("iowait é«˜ä¸ä¸€å®šä»£è¡¨ I/O æœ‰æ€§èƒ½ç“¶é¢ˆ. å½“ç³»ç»Ÿä¸­åªæœ‰ I/O ç±»å‹çš„è¿›ç¨‹åœ¨è¿è¡Œæ—¶, iowait ä¹Ÿä¼šå¾ˆé«˜, ä½†å®é™…ä¸Š, ç£ç›˜çš„è¯»å†™è¿œæ²¡æœ‰è¾¾åˆ°æ€§èƒ½ç“¶é¢ˆçš„ç¨‹åº¦")])]),s._v(".")]),s._v(" "),a("p",[s._v("å› æ­¤, ç¢°åˆ° iowait å‡é«˜æ—¶, éœ€è¦å…ˆç”¨ dstat, pidstat ç­‰å·¥å…·, "),a("strong",[s._v("ç¡®è®¤æ˜¯ä¸æ˜¯ç£ç›˜ I/O çš„é—®é¢˜")]),s._v(", ç„¶åå†æ‰¾æ˜¯å“ªäº›è¿›ç¨‹å¯¼è‡´äº† I/O.")]),s._v(" "),a("p",[a("strong",[s._v("ç­‰å¾… I/O çš„è¿›ç¨‹ä¸€èˆ¬æ˜¯ä¸å¯ä¸­æ–­çŠ¶æ€, æ‰€ä»¥ç”¨ ps å‘½ä»¤æ‰¾åˆ°çš„ D çŠ¶æ€(å³ä¸å¯ä¸­æ–­çŠ¶æ€)çš„è¿›ç¨‹, å¤šä¸ºå¯ç–‘è¿›ç¨‹")]),s._v(". ä½†è¿™ä¸ªæ¡ˆä¾‹ä¸­, åœ¨ I/O æ“ä½œå, è¿›ç¨‹åˆå˜æˆäº†åƒµå°¸è¿›ç¨‹, æ‰€ä»¥ä¸èƒ½ç”¨ strace ç›´æ¥åˆ†æè¿™ä¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨.")]),s._v(" "),a("p",[s._v("è¿™ç§æƒ…å†µä¸‹, ç”¨äº† perf å·¥å…·, æ¥åˆ†æç³»ç»Ÿçš„ CPU æ—¶é’Ÿäº‹ä»¶, æœ€ç»ˆå‘ç°æ˜¯ç›´æ¥ I/O å¯¼è‡´çš„é—®é¢˜. è¿™æ—¶å†æ£€æŸ¥æºç ä¸­å¯¹åº”ä½ç½®çš„é—®é¢˜, å°±å¾ˆè½»æ¾äº†.")]),s._v(" "),a("p",[a("strong",[s._v("è€Œåƒµå°¸è¿›ç¨‹çš„é—®é¢˜ç›¸å¯¹å®¹æ˜“æ’æŸ¥, ä½¿ç”¨ pstree æ‰¾å‡ºçˆ¶è¿›ç¨‹å, å»æŸ¥çœ‹çˆ¶è¿›ç¨‹çš„ä»£ç , æ£€æŸ¥ wait() / waitpid() çš„è°ƒç”¨, æˆ–æ˜¯ SIGCHLD ä¿¡å·å¤„ç†å‡½æ•°çš„æ³¨å†Œå°±è¡Œäº†")]),s._v(".")]),s._v(" "),a("h4",{attrs:{id:"_09-åŸºç¡€ç¯‡-æ€ä¹ˆç†è§£linuxè½¯ä¸­æ–­"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_09-åŸºç¡€ç¯‡-æ€ä¹ˆç†è§£linuxè½¯ä¸­æ–­"}},[s._v("#")]),s._v(" 09-åŸºç¡€ç¯‡:æ€ä¹ˆç†è§£Linuxè½¯ä¸­æ–­?")]),s._v(" "),a("p",[s._v("ä¸Šä¸€æœŸç”¨ä¸€ä¸ªä¸å¯ä¸­æ–­è¿›ç¨‹çš„æ¡ˆä¾‹, å­¦ä¹ äº† "),a("strong",[s._v("iowait")]),s._v("(ä¹Ÿå°±æ˜¯ç­‰å¾… I/O çš„ CPU ä½¿ç”¨ç‡)å‡é«˜æ—¶çš„åˆ†ææ–¹æ³•. è¿™é‡Œè¦è®°ä½, è¿›ç¨‹çš„ä¸å¯ä¸­æ–­çŠ¶æ€æ˜¯ç³»ç»Ÿçš„ä¸€ç§ä¿æŠ¤æœºåˆ¶, å¯ä»¥ä¿è¯ç¡¬ä»¶çš„äº¤äº’è¿‡ç¨‹ä¸è¢«æ„å¤–æ‰“æ–­. æ‰€ä»¥, "),a("strong",[s._v("çŸ­æ—¶é—´çš„ä¸å¯ä¸­æ–­çŠ¶æ€æ˜¯å¾ˆæ­£å¸¸çš„")]),s._v(".")]),s._v(" "),a("p",[s._v("ä½†æ˜¯, å½“è¿›ç¨‹é•¿æ—¶é—´éƒ½å¤„äºä¸å¯ä¸­æ–­çŠ¶æ€æ—¶, å°±å¾—å½“å¿ƒäº†. è¿™æ—¶å¯ä»¥ä½¿ç”¨ dstat, pidstat ç­‰å·¥å…·, ç¡®è®¤æ˜¯ä¸æ˜¯ç£ç›˜ I/O çš„é—®é¢˜, è¿›è€Œæ’æŸ¥ç›¸å…³çš„è¿›ç¨‹å’Œç£ç›˜è®¾å¤‡. å…³äºç£ç›˜ I/O çš„æ€§èƒ½é—®é¢˜, æš‚ä¸”ä¸ç”¨ä¸“é—¨å»èƒŒ, ä¼šåœ¨åç»­çš„ I/O éƒ¨åˆ†è¯¦ç»†ä»‹ç», åˆ°æ—¶å€™ç†è§£äº†ä¹Ÿå°±è®°ä½äº†.")]),s._v(" "),a("p",[s._v("å…¶å®é™¤äº† iowait, "),a("mark",[a("strong",[s._v("è½¯ä¸­æ–­(softirq)CPU ä½¿ç”¨ç‡å‡é«˜ä¹Ÿæ˜¯æœ€å¸¸è§çš„ä¸€ç§æ€§èƒ½é—®é¢˜")])]),s._v(". æ¥ä¸‹æ¥çš„ä¸¤èŠ‚, å°±æ¥å­¦ä¹ è½¯ä¸­æ–­çš„å†…å®¹, è¿˜ä¼šä»¥æœ€å¸¸è§çš„åå‘ä»£ç†æœåŠ¡å™¨ Nginx çš„æ¡ˆä¾‹, æ¥åˆ†æè¿™ç§æƒ…å†µ.")]),s._v(" "),a("h5",{attrs:{id:"_1-ä»-å–å¤–å–-çœ‹ä¸­æ–­"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä»-å–å¤–å–-çœ‹ä¸­æ–­"}},[s._v("#")]),s._v(' 1.ä»"å–å¤–å–"çœ‹ä¸­æ–­')]),s._v(" "),a("p",[s._v("è¯´åˆ°ä¸­æ–­, "),a("strong",[s._v("ä¸­æ–­æ˜¯ç³»ç»Ÿç”¨æ¥å“åº”ç¡¬ä»¶è®¾å¤‡è¯·æ±‚çš„ä¸€ç§æœºåˆ¶, å®ƒä¼šæ‰“æ–­è¿›ç¨‹çš„æ­£å¸¸è°ƒåº¦å’Œæ‰§è¡Œ, ç„¶åè°ƒç”¨å†…æ ¸ä¸­çš„ä¸­æ–­å¤„ç†ç¨‹åºæ¥å“åº”è®¾å¤‡çš„è¯·æ±‚.")])]),s._v(" "),a("p",[s._v("ä¸ºä»€ä¹ˆè¦æœ‰ä¸­æ–­å‘¢? å¯ä»¥ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­, è®©ä½ æ„Ÿå—ä¸€ä¸‹ä¸­æ–­çš„é­…åŠ›.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚ä½ è®¢äº†ä¸€ä»½å¤–å–, ä½†æ˜¯ä¸ç¡®å®šå¤–å–ä»€ä¹ˆæ—¶å€™é€åˆ°, ä¹Ÿæ²¡æœ‰åˆ«çš„æ–¹æ³•äº†è§£å¤–å–çš„è¿›åº¦, ä½†é…é€å‘˜é€å¤–å–æ˜¯ä¸ç­‰äººçš„, åˆ°äº†è¿™å„¿æ²¡äººå–çš„è¯, å°±ç›´æ¥èµ°äººäº†. æ‰€ä»¥ä½ åªèƒ½è‹¦è‹¦ç­‰ç€, æ—¶ä¸æ—¶å»é—¨å£çœ‹çœ‹å¤–å–é€åˆ°æ²¡, è€Œä¸èƒ½å¹²å…¶ä»–äº‹æƒ….")]),s._v(" "),a("p",[s._v("ä¸è¿‡å¦‚æœåœ¨è®¢å¤–å–çš„æ—¶å€™å°±è·Ÿé…é€å‘˜çº¦å®šå¥½, è®©ä»–é€åˆ°åç»™ä½ æ‰“ä¸ªç”µè¯, é‚£å°±ä¸ç”¨è‹¦è‹¦ç­‰å¾…äº†, å°±å¯ä»¥å»å¿™åˆ«çš„äº‹æƒ…, ç›´åˆ°ç”µè¯ä¸€å“, æ¥ç”µè¯, å–å¤–å–å°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v('è¿™é‡Œçš„"æ‰“ç”µè¯", å…¶å®'),a("strong",[s._v("å°±æ˜¯ä¸€ä¸ªä¸­æ–­")]),s._v(". æ²¡æ¥åˆ°ç”µè¯çš„æ—¶å€™, ä½ å¯ä»¥åšå…¶ä»–çš„äº‹æƒ…; åªæœ‰æ¥åˆ°äº†ç”µè¯(ä¹Ÿå°±æ˜¯å‘ç”Ÿä¸­æ–­), ä½ æ‰è¦è¿›è¡Œå¦ä¸€ä¸ªåŠ¨ä½œ: å–å¤–å–.")]),s._v(" "),a("p",[s._v("è¿™ä¸ªä¾‹å­å°±å¯ä»¥å‘ç°, "),a("mark",[a("strong",[s._v("ä¸­æ–­å…¶å®æ˜¯ä¸€ç§å¼‚æ­¥çš„äº‹ä»¶å¤„ç†æœºåˆ¶, å¯ä»¥æé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›")])]),s._v(".")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("ç”±äºä¸­æ–­å¤„ç†ç¨‹åºä¼šæ‰“æ–­å…¶ä»–è¿›ç¨‹çš„è¿è¡Œ, æ‰€ä»¥ä¸ºäº†å‡å°‘å¯¹æ­£å¸¸è¿›ç¨‹è¿è¡Œè°ƒåº¦çš„å½±å“, ä¸­æ–­å¤„ç†ç¨‹åºå°±éœ€è¦å°½å¯èƒ½å¿«åœ°è¿è¡Œ. å¦‚æœä¸­æ–­æœ¬èº«è¦åšçš„äº‹æƒ…ä¸å¤š, é‚£ä¹ˆå¤„ç†èµ·æ¥ä¹Ÿä¸ä¼šæœ‰å¤ªå¤§é—®é¢˜; ä½†å¦‚æœä¸­æ–­è¦å¤„ç†çš„äº‹æƒ…å¾ˆå¤š, ä¸­æ–­æœåŠ¡ç¨‹åºå°±æœ‰å¯èƒ½è¦è¿è¡Œå¾ˆé•¿æ—¶é—´.")])])]),s._v(" "),a("p",[s._v("ç‰¹åˆ«æ˜¯, ä¸­æ–­å¤„ç†ç¨‹åºåœ¨å“åº”ä¸­æ–­æ—¶, è¿˜ä¼šä¸´æ—¶å…³é—­ä¸­æ–­. è¿™å°±ä¼šå¯¼è‡´ä¸Šä¸€æ¬¡ä¸­æ–­å¤„ç†å®Œæˆä¹‹å‰, å…¶ä»–ä¸­æ–­éƒ½ä¸èƒ½å“åº”, ä¹Ÿå°±æ˜¯è¯´"),a("strong",[s._v("ä¸­æ–­æœ‰å¯èƒ½ä¼šä¸¢å¤±")]),s._v(".")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆè¿˜æ˜¯ä»¥å–å¤–å–ä¸ºä¾‹. å‡å¦‚ä½ è®¢äº† 2 ä»½å¤–å–, ä¸€ä»½ä¸»é£Ÿå’Œä¸€ä»½é¥®æ–™, å¹¶ä¸”æ˜¯ç”± 2 ä¸ªä¸åŒçš„é…é€å‘˜æ¥é…é€. è¿™æ¬¡ä½ ä¸ç”¨æ—¶æ—¶ç­‰å¾…ç€, ä¸¤ä»½å¤–å–éƒ½çº¦å®šäº†ç”µè¯å–å¤–å–çš„æ–¹å¼. ä½†æ˜¯é—®é¢˜åˆæ¥äº†. å½“ç¬¬ä¸€ä»½å¤–å–é€åˆ°æ—¶, é…é€å‘˜ç»™ä½ æ‰“äº†ä¸ªé•¿é•¿çš„ç”µè¯, å•†é‡å‘ç¥¨çš„å¤„ç†æ–¹å¼. ä¸æ­¤åŒæ—¶, ç¬¬äºŒä¸ªé…é€å‘˜ä¹Ÿåˆ°äº†, ä¹Ÿæƒ³ç»™ä½ æ‰“ç”µè¯. ä½†æ˜¯å¾ˆæ˜æ˜¾, å› ä¸ºç”µè¯å çº¿(ä¹Ÿå°±æ˜¯å…³é—­äº†ä¸­æ–­å“åº”), ç¬¬äºŒä¸ªé…é€å‘˜çš„ç”µè¯æ˜¯æ‰“ä¸é€šçš„. æ‰€ä»¥ç¬¬äºŒä¸ªé…é€å‘˜å¾ˆå¯èƒ½è¯•å‡ æ¬¡åå°±èµ°æ‰äº†(ä¹Ÿå°±æ˜¯ä¸¢å¤±äº†ä¸€æ¬¡ä¸­æ–­).")]),s._v(" "),a("h5",{attrs:{id:"_2-è½¯ä¸­æ–­"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-è½¯ä¸­æ–­"}},[s._v("#")]),s._v(" 2.è½¯ä¸­æ–­")]),s._v(" "),a("p",[s._v('å¦‚æœå¼„æ¸…æ¥šäº† "å–å¤–å–" çš„æ¨¡å¼, é‚£å¯¹ç³»ç»Ÿçš„ä¸­æ–­æœºåˆ¶å°±å¾ˆå®¹æ˜“ç†è§£äº†. äº‹å®ä¸Š, ä¸ºäº†è§£å†³ä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œè¿‡é•¿å’Œä¸­æ–­ä¸¢å¤±çš„é—®é¢˜, '),a("strong",[s._v("Linux å°†ä¸­æ–­å¤„ç†è¿‡ç¨‹åˆ†æˆäº†ä¸¤ä¸ªé˜¶æ®µ")]),s._v(", ä¹Ÿå°±æ˜¯"),a("strong",[s._v("ä¸ŠåŠéƒ¨å’Œä¸‹åŠéƒ¨")]),s._v(":")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä¸ŠåŠéƒ¨ç”¨æ¥å¿«é€Ÿå¤„ç†ä¸­æ–­")]),s._v(", å®ƒåœ¨"),a("strong",[s._v("ä¸­æ–­ç¦æ­¢æ¨¡å¼")]),s._v("ä¸‹è¿è¡Œ, ä¸»è¦å¤„ç†è·Ÿç¡¬ä»¶ç´§å¯†ç›¸å…³çš„æˆ–æ—¶é—´æ•æ„Ÿçš„å·¥ä½œ.")]),s._v(" "),a("li",[a("strong",[s._v("ä¸‹åŠéƒ¨ç”¨æ¥å»¶è¿Ÿå¤„ç†ä¸ŠåŠéƒ¨æœªå®Œæˆçš„å·¥ä½œ, é€šå¸¸ä»¥å†…æ ¸çº¿ç¨‹çš„æ–¹å¼è¿è¡Œ")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ¯”å¦‚è¯´å‰é¢å–å¤–å–çš„ä¾‹å­, ä¸ŠåŠéƒ¨å°±æ˜¯æ¥å¬ç”µè¯, å‘Šè¯‰é…é€å‘˜ä½ å·²ç»çŸ¥é“äº†, å…¶ä»–äº‹å„¿è§é¢å†è¯´, ç„¶åç”µè¯å°±å¯ä»¥æŒ‚æ–­äº†; ä¸‹åŠéƒ¨æ‰æ˜¯å–å¤–å–çš„åŠ¨ä½œ, ä»¥åŠè§é¢åå•†é‡å‘ç¥¨å¤„ç†çš„åŠ¨ä½œ. è¿™æ ·, ç¬¬ä¸€ä¸ªé…é€å‘˜ä¸ä¼šå ç”¨å¤ªå¤šæ—¶é—´, å½“ç¬¬äºŒä¸ªé…é€å‘˜è¿‡æ¥æ—¶, ç…§æ ·èƒ½æ­£å¸¸æ‰“é€šç”µè¯.")]),s._v(" "),a("p",[s._v("é™¤äº†å–å¤–å–, å†ä¸¾ä¸ªæœ€å¸¸è§çš„ç½‘å¡æ¥æ”¶æ•°æ®åŒ…çš„ä¾‹å­, è®©ä½ æ›´å¥½åœ°ç†è§£.")]),s._v(" "),a("p",[s._v("ç½‘å¡æ¥æ”¶åˆ°æ•°æ®åŒ…å, ä¼šé€šè¿‡"),a("strong",[s._v("ç¡¬ä»¶ä¸­æ–­")]),s._v("çš„æ–¹å¼, é€šçŸ¥å†…æ ¸æœ‰æ–°çš„æ•°æ®åˆ°äº†. è¿™æ—¶å†…æ ¸å°±åº”è¯¥è°ƒç”¨ä¸­æ–­å¤„ç†ç¨‹åºæ¥å“åº”å®ƒ. å¯ä»¥å…ˆæƒ³ä¸€ä¸‹, è¿™ç§æƒ…å†µä¸‹çš„ä¸ŠåŠéƒ¨å’Œä¸‹åŠéƒ¨åˆ†åˆ«è´Ÿè´£ä»€ä¹ˆå·¥ä½œå‘¢?")]),s._v(" "),a("p",[a("strong",[s._v("å¯¹ä¸ŠåŠéƒ¨æ¥è¯´, æ—¢ç„¶æ˜¯å¿«é€Ÿå¤„ç†, å…¶å®å°±æ˜¯è¦æŠŠç½‘å¡çš„æ•°æ®è¯»åˆ°å†…å­˜ä¸­, ç„¶åæ›´æ–°ä¸€ä¸‹ç¡¬ä»¶å¯„å­˜å™¨çš„çŠ¶æ€(è¡¨ç¤ºæ•°æ®å·²ç»è¯»å¥½äº†), æœ€åå†å‘é€ä¸€ä¸ªè½¯ä¸­æ–­ä¿¡å·, é€šçŸ¥ä¸‹åŠéƒ¨åšè¿›ä¸€æ­¥çš„å¤„ç†.")])]),s._v(" "),a("p",[a("strong",[s._v("è€Œä¸‹åŠéƒ¨è¢«è½¯ä¸­æ–­ä¿¡å·å”¤é†’å, éœ€è¦ä»å†…å­˜ä¸­æ‰¾åˆ°ç½‘ç»œæ•°æ®, å†æŒ‰ç…§ç½‘ç»œåè®®æ ˆ, å¯¹æ•°æ®è¿›è¡Œé€å±‚è§£æå’Œå¤„ç†, ç›´åˆ°æŠŠå®ƒé€ç»™åº”ç”¨ç¨‹åº.")])]),s._v(" "),a("p",[s._v("æ‰€ä»¥, è¿™ä¸¤ä¸ªé˜¶æ®µä¹Ÿå¯ä»¥è¿™æ ·ç†è§£:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä¸ŠåŠéƒ¨ç›´æ¥å¤„ç†ç¡¬ä»¶è¯·æ±‚, ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ç¡¬ä¸­æ–­, ç‰¹ç‚¹æ˜¯å¿«é€Ÿæ‰§è¡Œ")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("è€Œä¸‹åŠéƒ¨åˆ™æ˜¯ç”±å†…æ ¸è§¦å‘, ä¹Ÿå°±æ˜¯å¸¸è¯´çš„è½¯ä¸­æ–­, ç‰¹ç‚¹æ˜¯å»¶è¿Ÿæ‰§è¡Œ")]),s._v(".")])]),s._v(" "),a("p",[s._v('å®é™…ä¸Š, ä¸ŠåŠéƒ¨ä¼šæ‰“æ–­ CPU æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡, ç„¶åç«‹å³æ‰§è¡Œä¸­æ–­å¤„ç†ç¨‹åº. è€Œä¸‹åŠéƒ¨ä»¥å†…æ ¸çº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œ, å¹¶ä¸”æ¯ä¸ª CPU éƒ½å¯¹åº”ä¸€ä¸ªè½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹, åå­—ä¸º "ksoftirqd/CPU ç¼–å·", æ¯”å¦‚è¯´, 0 å· CPU å¯¹åº”çš„è½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹çš„åå­—å°±æ˜¯ ksoftirqd/0.')]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„çš„æ˜¯, è½¯ä¸­æ–­ä¸åªåŒ…æ‹¬äº†åˆšåˆšæ‰€è®²çš„ç¡¬ä»¶è®¾å¤‡ä¸­æ–­å¤„ç†ç¨‹åºçš„ä¸‹åŠéƒ¨, ä¸€äº›å†…æ ¸è‡ªå®šä¹‰çš„äº‹ä»¶ä¹Ÿå±äºè½¯ä¸­æ–­, æ¯”å¦‚å†…æ ¸è°ƒåº¦å’Œ RCU é”(Read-Copy Update çš„ç¼©å†™, RCU æ˜¯ Linux å†…æ ¸ä¸­æœ€å¸¸ç”¨çš„é”ä¹‹ä¸€)ç­‰.")]),s._v(" "),a("p",[s._v("é‚£è¦æ€ä¹ˆçŸ¥é“ç³»ç»Ÿé‡Œæœ‰å“ªäº›è½¯ä¸­æ–­å‘¢?")]),s._v(" "),a("h5",{attrs:{id:"_3-æŸ¥çœ‹è½¯ä¸­æ–­å’Œå†…æ ¸çº¿ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æŸ¥çœ‹è½¯ä¸­æ–­å’Œå†…æ ¸çº¿ç¨‹"}},[s._v("#")]),s._v(" 3.æŸ¥çœ‹è½¯ä¸­æ–­å’Œå†…æ ¸çº¿ç¨‹")]),s._v(" "),a("p",[s._v("ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—, å‰é¢æåˆ°è¿‡çš„ "),a("strong",[s._v("proc æ–‡ä»¶ç³»ç»Ÿ. å®ƒæ˜¯ä¸€ç§å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´è¿›è¡Œé€šä¿¡çš„æœºåˆ¶, å¯ä»¥ç”¨æ¥æŸ¥çœ‹å†…æ ¸çš„æ•°æ®ç»“æ„, æˆ–è€…ç”¨æ¥åŠ¨æ€ä¿®æ”¹å†…æ ¸çš„é…ç½®")]),s._v(". å…¶ä¸­:")]),s._v(" "),a("ul",[a("li",[s._v("â€‹"),a("code",[s._v("/proc/softirqs")]),s._v("â€‹ æä¾›äº†"),a("strong",[s._v("è½¯ä¸­æ–­")]),s._v("çš„è¿è¡Œæƒ…å†µ;")]),s._v(" "),a("li",[s._v("â€‹"),a("code",[s._v("/proc/interrupts")]),s._v("â€‹ æä¾›äº†"),a("strong",[s._v("ç¡¬ä¸­æ–­")]),s._v("çš„è¿è¡Œæƒ…å†µ.")])]),s._v(" "),a("p",[s._v("è¿è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹ "),a("code",[s._v("/proc/softirqs")]),s._v("â€‹ æ–‡ä»¶çš„å†…å®¹, å°±å¯ä»¥çœ‹åˆ°å„ç§ç±»å‹è½¯ä¸­æ–­åœ¨ä¸åŒ CPU ä¸Šçš„ç´¯ç§¯è¿è¡Œæ¬¡æ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/softirqs\n                    CPU0       CPU1\n          HI:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n       TIMER:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("811613")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1972736")]),s._v("\n      NET_TX:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n      NET_RX:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1136736")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1506885")]),s._v("\n       BLOCK:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    IRQ_POLL:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     TASKLET:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("304787")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3691")]),s._v("\n       SCHED:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("689718")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1897539")]),s._v("\n     HRTIMER:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n         RCU:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1330771")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1354737")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("åœ¨æŸ¥çœ‹ /proc/softirqs æ–‡ä»¶å†…å®¹æ—¶, è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹è¿™ä¸¤ç‚¹.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€, è¦"),a("strong",[s._v("æ³¨æ„è½¯ä¸­æ–­çš„ç±»å‹")]),s._v(", ä¹Ÿå°±æ˜¯è¿™ä¸ªç•Œé¢ä¸­ç¬¬ä¸€åˆ—çš„å†…å®¹. ä»ç¬¬ä¸€åˆ—å¯ä»¥çœ‹åˆ°, è½¯ä¸­æ–­åŒ…æ‹¬äº† 10 ä¸ªç±»åˆ«, åˆ†åˆ«å¯¹åº”ä¸åŒçš„å·¥ä½œç±»å‹. æ¯”å¦‚ NET_RX è¡¨ç¤ºç½‘ç»œæ¥æ”¶ä¸­æ–­, è€Œ NET_TX è¡¨ç¤ºç½‘ç»œå‘é€ä¸­æ–­.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒ, è¦"),a("strong",[s._v("æ³¨æ„åŒä¸€ç§è½¯ä¸­æ–­åœ¨ä¸åŒ CPU ä¸Šçš„åˆ†å¸ƒæƒ…å†µ")]),s._v(", ä¹Ÿå°±æ˜¯åŒä¸€è¡Œçš„å†…å®¹. æ­£å¸¸æƒ…å†µä¸‹, åŒä¸€ç§ä¸­æ–­åœ¨ä¸åŒ CPU ä¸Šçš„ç´¯ç§¯æ¬¡æ•°åº”è¯¥å·®ä¸å¤š. æ¯”å¦‚è¿™ä¸ªç•Œé¢ä¸­, NET_RX åœ¨ CPU0 å’Œ CPU1 ä¸Šçš„ä¸­æ–­æ¬¡æ•°åŸºæœ¬æ˜¯åŒä¸€ä¸ªæ•°é‡çº§, ç›¸å·®ä¸å¤§.")]),s._v(" "),a("p",[s._v("ä¸è¿‡ä½ å¯èƒ½å‘ç°, TASKLET åœ¨ä¸åŒ CPU ä¸Šçš„åˆ†å¸ƒå¹¶ä¸å‡åŒ€. "),a("strong",[s._v("TASKLET æ˜¯æœ€å¸¸ç”¨çš„è½¯ä¸­æ–­å®ç°æœºåˆ¶, æ¯ä¸ª TASKLET åªè¿è¡Œä¸€æ¬¡å°±ä¼šç»“æŸ, å¹¶ä¸”åªåœ¨è°ƒç”¨å®ƒçš„å‡½æ•°æ‰€åœ¨çš„ CPU ä¸Šè¿è¡Œ")]),s._v(".")]),s._v(" "),a("p",[s._v("å› æ­¤, ä½¿ç”¨ TASKLET ç‰¹åˆ«ç®€ä¾¿, å½“ç„¶ä¹Ÿä¼šå­˜åœ¨ä¸€äº›é—®é¢˜, æ¯”å¦‚è¯´ç”±äºåªåœ¨ä¸€ä¸ª CPU ä¸Šè¿è¡Œå¯¼è‡´çš„è°ƒåº¦ä¸å‡è¡¡, å†æ¯”å¦‚å› ä¸ºä¸èƒ½åœ¨å¤šä¸ª CPU ä¸Šå¹¶è¡Œè¿è¡Œå¸¦æ¥äº†æ€§èƒ½é™åˆ¶.")]),s._v(" "),a("p",[s._v("å¦å¤–, åˆšåˆšæåˆ°è¿‡, "),a("strong",[s._v("è½¯ä¸­æ–­å®é™…ä¸Šæ˜¯ä»¥å†…æ ¸çº¿ç¨‹çš„æ–¹å¼è¿è¡Œçš„, æ¯ä¸ª CPU éƒ½å¯¹åº”ä¸€ä¸ªè½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹, è¿™ä¸ªè½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹å°±å«åš ksoftirqd/CPU ç¼–å·")]),s._v(". é‚£è¦æ€ä¹ˆæŸ¥çœ‹è¿™äº›çº¿ç¨‹çš„è¿è¡ŒçŠ¶å†µå‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®ç”¨ ps å‘½ä»¤å°±å¯ä»¥åšåˆ°, æ¯”å¦‚æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" softirq\nroot         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ?        S    Oct10   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ksoftirqd/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ?        S    Oct10   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ksoftirqd/1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æ³¨æ„, è¿™äº›çº¿ç¨‹çš„åå­—å¤–é¢éƒ½æœ‰ä¸­æ‹¬å·, è¿™è¯´æ˜ ps æ— æ³•è·å–å®ƒä»¬çš„å‘½ä»¤è¡Œå‚æ•°(cmline). ä¸€èˆ¬æ¥è¯´, ps çš„è¾“å‡ºä¸­, "),a("strong",[s._v("åå­—æ‹¬åœ¨ä¸­æ‹¬å·é‡Œçš„, ä¸€èˆ¬éƒ½æ˜¯å†…æ ¸çº¿ç¨‹")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-3"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[a("strong",[s._v("Linux ä¸­çš„ä¸­æ–­å¤„ç†ç¨‹åºåˆ†ä¸ºä¸ŠåŠéƒ¨å’Œä¸‹åŠéƒ¨:")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä¸ŠåŠéƒ¨å¯¹åº”ç¡¬ä»¶ä¸­æ–­, ç”¨æ¥å¿«é€Ÿå¤„ç†ä¸­æ–­.")])]),s._v(" "),a("li",[a("strong",[s._v("ä¸‹åŠéƒ¨å¯¹åº”è½¯ä¸­æ–­, ç”¨æ¥å¼‚æ­¥å¤„ç†ä¸ŠåŠéƒ¨æœªå®Œæˆçš„å·¥ä½œ.")])])]),s._v(" "),a("p",[s._v("Linux ä¸­çš„è½¯ä¸­æ–­åŒ…æ‹¬ç½‘ç»œæ”¶å‘, å®šæ—¶, è°ƒåº¦, RCU é”ç­‰å„ç§ç±»å‹, å¯ä»¥é€šè¿‡æŸ¥çœ‹ "),a("code",[s._v("/proc/softirqs")]),s._v("â€‹ æ¥è§‚å¯Ÿè½¯ä¸­æ–­çš„è¿è¡Œæƒ…å†µ.")]),s._v(" "),a("h4",{attrs:{id:"_10-æ¡ˆä¾‹ç¯‡-ç³»ç»Ÿçš„è½¯ä¸­æ–­cpuä½¿ç”¨ç‡å‡é«˜è¯¥æ€ä¹ˆåŠ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-æ¡ˆä¾‹ç¯‡-ç³»ç»Ÿçš„è½¯ä¸­æ–­cpuä½¿ç”¨ç‡å‡é«˜è¯¥æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 10-æ¡ˆä¾‹ç¯‡:ç³»ç»Ÿçš„è½¯ä¸­æ–­CPUä½¿ç”¨ç‡å‡é«˜è¯¥æ€ä¹ˆåŠ?")]),s._v(" "),a("p",[s._v("ä¸Šä¸€è®²ä»‹ç»äº†è½¯ä¸­æ–­çš„åŸºæœ¬åŸç†, å…ˆæ¥ç®€å•å¤ä¹ ä¸‹.")]),s._v(" "),a("p",[s._v("ä¸­æ–­æ˜¯ä¸€ç§å¼‚æ­¥çš„äº‹ä»¶å¤„ç†æœºåˆ¶, ç”¨æ¥æé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›. ä¸­æ–­äº‹ä»¶å‘ç”Ÿ, ä¼šè§¦å‘æ‰§è¡Œä¸­æ–­å¤„ç†ç¨‹åº, è€Œä¸­æ–­å¤„ç†ç¨‹åºè¢«åˆ†ä¸º"),a("strong",[s._v("ä¸ŠåŠéƒ¨å’Œä¸‹åŠéƒ¨")]),s._v("è¿™ä¸¤ä¸ªéƒ¨åˆ†.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä¸ŠåŠéƒ¨å¯¹åº”ç¡¬ä¸­æ–­, ç”¨æ¥å¿«é€Ÿå¤„ç†ä¸­æ–­")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("ä¸‹åŠéƒ¨å¯¹åº”è½¯ä¸­æ–­, ç”¨æ¥å¼‚æ­¥å¤„ç†ä¸ŠåŠéƒ¨æœªå®Œæˆçš„å·¥ä½œ")]),s._v(".")])]),s._v(" "),a("p",[s._v("Linux ä¸­çš„è½¯ä¸­æ–­åŒ…æ‹¬ç½‘ç»œæ”¶å‘, å®šæ—¶, è°ƒåº¦, RCU é”ç­‰å„ç§ç±»å‹, å¯ä»¥æŸ¥çœ‹ proc æ–‡ä»¶ç³»ç»Ÿä¸­çš„ /proc/softirqs , è§‚å¯Ÿè½¯ä¸­æ–­çš„è¿è¡Œæƒ…å†µ.")]),s._v(" "),a("p",[s._v("åœ¨ Linux ä¸­, "),a("mark",[a("strong",[s._v("æ¯ä¸ª CPU éƒ½å¯¹åº”ä¸€ä¸ªè½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹, åå­—æ˜¯ ksoftirqd/CPU ç¼–å·. å½“è½¯ä¸­æ–­äº‹ä»¶çš„é¢‘ç‡è¿‡é«˜æ—¶, å†…æ ¸çº¿ç¨‹ä¹Ÿä¼šå› ä¸º CPU ä½¿ç”¨ç‡è¿‡é«˜è€Œå¯¼è‡´è½¯ä¸­æ–­å¤„ç†ä¸åŠæ—¶, è¿›è€Œå¼•å‘ç½‘ç»œæ”¶å‘å»¶è¿Ÿ, è°ƒåº¦ç¼“æ…¢ç­‰æ€§èƒ½é—®é¢˜")])]),s._v(".")]),s._v(" "),a("p",[s._v("è½¯ä¸­æ–­ CPU ä½¿ç”¨ç‡è¿‡é«˜ä¹Ÿæ˜¯ä¸€ç§æœ€å¸¸è§çš„æ€§èƒ½é—®é¢˜. æœ¬èŠ‚å°±ç”¨æœ€å¸¸è§çš„åå‘ä»£ç†æœåŠ¡å™¨ Nginx çš„æ¡ˆä¾‹, æ•™ä½ å­¦ä¼šåˆ†æè¿™ç§æƒ…å†µ.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹")]),s._v(" "),a("h6",{attrs:{id:"_1-ä½ çš„å‡†å¤‡-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä½ çš„å‡†å¤‡-3"}},[s._v("#")]),s._v(" (1)ä½ çš„å‡†å¤‡")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥çš„æ¡ˆä¾‹åŸºäº Ubuntu 18.04, ä¹ŸåŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒæ˜¯è¿™æ ·çš„:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8 GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sysstat, sar , hping3, tcpdump ç­‰å·¥å…·, æ¯”å¦‚ apt-get install docker.io sysstat hping3 tcpdump.")])]),s._v(" "),a("p",[s._v("è¿™é‡Œåˆç”¨åˆ°äº†ä¸‰ä¸ªæ–°å·¥å…·, sar,  hping3 å’Œ tcpdump, å…ˆç®€å•ä»‹ç»ä¸€ä¸‹:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("sar æ˜¯ä¸€ä¸ªç³»ç»Ÿæ´»åŠ¨æŠ¥å‘Šå·¥å…·")]),s._v(", æ—¢å¯ä»¥å®æ—¶æŸ¥çœ‹ç³»ç»Ÿçš„å½“å‰æ´»åŠ¨, åˆå¯ä»¥é…ç½®ä¿å­˜å’ŒæŠ¥å‘Šå†å²ç»Ÿè®¡æ•°æ®.")]),s._v(" "),a("li",[a("strong",[s._v("hping3 æ˜¯ä¸€ä¸ªå¯ä»¥æ„é€  TCP/IP åè®®æ•°æ®åŒ…çš„å·¥å…·")]),s._v(", å¯ä»¥å¯¹ç³»ç»Ÿè¿›è¡Œå®‰å…¨å®¡è®¡, é˜²ç«å¢™æµ‹è¯•ç­‰.")]),s._v(" "),a("li",[a("strong",[s._v("tcpdump æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç½‘ç»œæŠ“åŒ…å·¥å…·")]),s._v(", å¸¸ç”¨æ¥åˆ†æå„ç§ç½‘ç»œé—®é¢˜.")])]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœº, ä¸‹å›¾æ˜¯å®ƒä»¬çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/240b3e59e4d14c3e6c62815209620501-20230731161933-65ftqm7.png",alt:""}})]),s._v(" "),a("p",[s._v('å¯ä»¥çœ‹åˆ°, å…¶ä¸­ä¸€å°è™šæ‹Ÿæœºè¿è¡Œ Nginx, ç”¨æ¥æ¨¡æ‹Ÿå¾…åˆ†æçš„ Web æœåŠ¡å™¨; è€Œå¦ä¸€å°å½“ä½œ Web æœåŠ¡å™¨çš„å®¢æˆ·ç«¯, ç”¨æ¥ç»™ Nginx å¢åŠ å‹åŠ›è¯·æ±‚. ä½¿ç”¨ä¸¤å°è™šæ‹Ÿæœºçš„ç›®çš„, æ˜¯ä¸ºäº†ç›¸äº’éš”ç¦», é¿å…"äº¤å‰æ„ŸæŸ“".')]),s._v(" "),a("h6",{attrs:{id:"_2-æ“ä½œå’Œåˆ†æ-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ“ä½œå’Œåˆ†æ-5"}},[s._v("#")]),s._v(" (2)æ“ä½œå’Œåˆ†æ")]),s._v(" "),a("p",[s._v("å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿è¡Œæ¡ˆä¾‹, ä¹Ÿå°±æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„ Nginx åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œ Nginx æœåŠ¡å¹¶å¯¹å¤–å¼€æ”¾ 80 ç«¯å£")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶å, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯, ä½¿ç”¨ curl è®¿é—® Nginx ç›‘å¬çš„ç«¯å£, ç¡®è®¤ Nginx æ­£å¸¸å¯åŠ¨. å‡è®¾ 192.168.0.30 æ˜¯ Nginx æ‰€åœ¨è™šæ‹Ÿæœºçš„ IP åœ°å€, è¿è¡Œ curl å‘½ä»¤ååº”è¯¥ä¼šçœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡ºç•Œé¢:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.30/\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Welcome to nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("æ¥ç€, è¿˜æ˜¯åœ¨ç¬¬äºŒä¸ªç»ˆç«¯, è¿è¡Œ hping3 å‘½ä»¤, æ¥æ¨¡æ‹Ÿ Nginx çš„å®¢æˆ·ç«¯è¯·æ±‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -S å‚æ•°è¡¨ç¤ºè®¾ç½® TCP åè®®çš„ SYN(åŒæ­¥åºåˆ—å·), -p è¡¨ç¤ºç›®çš„ç«¯å£ä¸º 80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i u100 è¡¨ç¤ºæ¯éš” 100 å¾®ç§’å‘é€ä¸€ä¸ªç½‘ç»œå¸§")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ³¨: å¦‚æœä½ åœ¨å®è·µè¿‡ç¨‹ä¸­ç°è±¡ä¸æ˜æ˜¾, å¯ä»¥å°è¯•æŠŠ 100 è°ƒå°, æ¯”å¦‚è°ƒæˆ 10 ç”šè‡³ 1")]),s._v("\n$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" u100 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç°åœ¨å†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯, ä½ åº”è¯¥å‘ç°äº†å¼‚å¸¸. æ˜¯ä¸æ˜¯æ„Ÿè§‰"),a("strong",[s._v("ç³»ç»Ÿå“åº”æ˜æ˜¾å˜æ…¢")]),s._v("äº†, å³ä¾¿åªæ˜¯åœ¨ç»ˆç«¯ä¸­æ•²å‡ ä¸ªå›è½¦, éƒ½å¾—å¾ˆä¹…æ‰èƒ½å¾—åˆ°å“åº”? è¿™ä¸ªæ—¶å€™åº”è¯¥æ€ä¹ˆåŠå‘¢?")]),s._v(" "),a("p",[s._v("è™½ç„¶åœ¨è¿è¡Œ hping3 å‘½ä»¤æ—¶, å°±å·²ç»å‘Šè¯‰ä½ , è¿™æ˜¯ä¸€ä¸ª SYN FLOOD æ”»å‡», ä½ è‚¯å®šä¹Ÿä¼šæƒ³åˆ°ä»ç½‘ç»œæ–¹é¢å…¥æ‰‹, æ¥åˆ†æè¿™ä¸ªé—®é¢˜. ä¸è¿‡, åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­, æ²¡äººç›´æ¥å‘Šè¯‰ä½ åŸå› .")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, å¯ä»¥æŠŠ hping3 æ¨¡æ‹Ÿ SYN FLOOD è¿™ä¸ªæ“ä½œæš‚æ—¶å¿˜æ‰, ç„¶åé‡æ–°ä»è§‚å¯Ÿåˆ°çš„é—®é¢˜å¼€å§‹, åˆ†æç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µ, é€æ­¥æ‰¾å‡ºé—®é¢˜çš„æ ¹æº.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, è¯¥ä»ä»€ä¹ˆåœ°æ–¹å…¥æ‰‹å‘¢? åˆšæ‰å‘ç°, ç®€å•çš„ SHELL å‘½ä»¤éƒ½æ˜æ˜¾å˜æ…¢äº†, "),a("strong",[s._v("å…ˆçœ‹çœ‹ç³»ç»Ÿçš„æ•´ä½“èµ„æºä½¿ç”¨æƒ…å†µ")]),s._v("åº”è¯¥æ˜¯ä¸ªä¸é”™çš„æ³¨æ„, æ¯”å¦‚æ‰§è¡Œä¸‹ top çœ‹çœ‹æ˜¯ä¸æ˜¯å‡ºç°äº† CPU çš„ç“¶é¢ˆ. åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œ top å‘½ä»¤, çœ‹ä¸€ä¸‹ç³»ç»Ÿæ•´ä½“çš„èµ„æºä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# top è¿è¡ŒåæŒ‰æ•°å­— 1 åˆ‡æ¢åˆ°æ˜¾ç¤ºæ‰€æœ‰ CPU")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":50:58 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" days, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":10,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("122")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("71")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.7")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("95.6")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":01.64 ksoftirqd/0\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":01.97 ksoftirqd/1\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2663")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("923480")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28292")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13996")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":58.66 docker-containe\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3699")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.13 kworker/u4:0\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3708")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44572")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4176")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3512")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.07 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("225384")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9136")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6724")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":23.25 systemd\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.03 kthreadd\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("è¿™é‡Œæœ‰æ²¡æœ‰å‘ç°å¼‚å¸¸çš„ç°è±¡? ä»ç¬¬ä¸€è¡Œå¼€å§‹, é€ä¸ªçœ‹ä¸€ä¸‹:")]),s._v(" "),a("ul",[a("li",[s._v("å¹³å‡è´Ÿè½½å…¨æ˜¯ 0, å°±ç»ªé˜Ÿåˆ—é‡Œé¢åªæœ‰ä¸€ä¸ªè¿›ç¨‹(1 running).")]),s._v(" "),a("li",[s._v("æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡éƒ½æŒºä½, æœ€é«˜çš„ CPU1 çš„ä½¿ç”¨ç‡ä¹Ÿåªæœ‰ 4.4%, å¹¶ä¸ç®—é«˜.")]),s._v(" "),a("li",[s._v("å†çœ‹è¿›ç¨‹åˆ—è¡¨, CPU ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹ä¹Ÿåªæœ‰ 0.3%, è¿˜æ˜¯ä¸é«˜å‘€.")])]),s._v(" "),a("p",[s._v("é‚£ä¸ºä»€ä¹ˆç³»ç»Ÿçš„å“åº”å˜æ…¢äº†å‘¢? æ—¢ç„¶æ¯ä¸ªæŒ‡æ ‡çš„æ•°å€¼éƒ½ä¸å¤§, é‚£å°±å†æ¥çœ‹çœ‹, è¿™äº›æŒ‡æ ‡å¯¹åº”çš„æ›´å…·ä½“çš„å«ä¹‰. æ¯•ç«Ÿ, å“ªæ€•æ˜¯åŒä¸€ä¸ªæŒ‡æ ‡, ç”¨åœ¨ç³»ç»Ÿçš„ä¸åŒéƒ¨ä½å’Œåœºæ™¯ä¸Š, éƒ½æœ‰å¯èƒ½å¯¹åº”ç€ä¸åŒçš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("ä»”ç»†çœ‹ top çš„è¾“å‡º, "),a("strong",[s._v("ä¸¤ä¸ª CPU çš„ä½¿ç”¨ç‡è™½ç„¶åˆ†åˆ«åªæœ‰ 3.3% å’Œ 4.4%, ä½†éƒ½ç”¨åœ¨äº†è½¯ä¸­æ–­ä¸Š; è€Œä»è¿›ç¨‹åˆ—è¡¨ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°, CPU ä½¿ç”¨ç‡æœ€é«˜çš„ä¹Ÿæ˜¯è½¯ä¸­æ–­è¿›ç¨‹ ksoftirqd")]),s._v(". çœ‹èµ·æ¥, è½¯ä¸­æ–­æœ‰ç‚¹å¯ç–‘äº†.")]),s._v(" "),a("p",[s._v("æ ¹æ®ä¸Šä¸€æœŸçš„å†…å®¹, æ—¢ç„¶è½¯ä¸­æ–­å¯èƒ½æœ‰é—®é¢˜, é‚£å…ˆè¦çŸ¥é“, ç©¶ç«Ÿæ˜¯å“ªç±»è½¯ä¸­æ–­çš„é—®é¢˜. åœä¸‹æ¥æƒ³æƒ³, ä¸Šä¸€èŠ‚ç”¨äº†ä»€ä¹ˆæ–¹æ³•, æ¥åˆ¤æ–­è½¯ä¸­æ–­ç±»å‹å‘¢? æ²¡é”™, è¿˜æ˜¯ proc æ–‡ä»¶ç³»ç»Ÿ. è§‚å¯Ÿ "),a("code",[s._v("/proc/softirqs")]),s._v("â€‹ æ–‡ä»¶çš„å†…å®¹, å°±èƒ½çŸ¥é“å„ç§"),a("strong",[s._v("è½¯ä¸­æ–­ç±»å‹çš„æ¬¡æ•°")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™é‡Œçš„å„ç±»è½¯ä¸­æ–­æ¬¡æ•°, åˆæ˜¯ä»€ä¹ˆæ—¶é—´æ®µé‡Œçš„æ¬¡æ•°å‘¢? å®ƒæ˜¯ç³»ç»Ÿè¿è¡Œä»¥æ¥çš„"),a("strong",[s._v("ç´¯ç§¯ä¸­æ–­æ¬¡æ•°")]),s._v(". æ‰€ä»¥ç›´æ¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹, å¾—åˆ°çš„åªæ˜¯ç´¯ç§¯ä¸­æ–­æ¬¡æ•°, å¯¹è¿™é‡Œçš„é—®é¢˜å¹¶æ²¡æœ‰ç›´æ¥å‚è€ƒæ„ä¹‰. å› ä¸ºè¿™äº›"),a("strong",[s._v("ä¸­æ–­æ¬¡æ•°çš„å˜åŒ–é€Ÿç‡")]),s._v("æ‰æ˜¯éœ€è¦å…³æ³¨çš„.")]),s._v(" "),a("p",[s._v("é‚£ä»€ä¹ˆå·¥å…·å¯ä»¥è§‚å¯Ÿå‘½ä»¤è¾“å‡ºçš„å˜åŒ–æƒ…å†µå‘¢? åœ¨å‰é¢æ¡ˆä¾‹ä¸­ç”¨è¿‡çš„ "),a("strong",[s._v("watch å‘½ä»¤, å°±å¯ä»¥å®šæœŸè¿è¡Œä¸€ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹è¾“å‡º")]),s._v("; å¦‚æœå†åŠ ä¸Š -d å‚æ•°, è¿˜å¯ä»¥é«˜äº®å‡ºå˜åŒ–çš„éƒ¨åˆ†, ä»é«˜äº®éƒ¨åˆ†å°±å¯ä»¥ç›´è§‚çœ‹å‡º, å“ªäº›å†…å®¹å˜åŒ–å¾—æ›´å¿«.")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯, è¿è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/softirqs\n                    CPU0       CPU1\n          HI:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n       TIMER:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1083906")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2368646")]),s._v("\n      NET_TX:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\n      NET_RX:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1550643")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1916776")]),s._v("\n       BLOCK:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    IRQ_POLL:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     TASKLET:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("333637")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3930")]),s._v("\n       SCHED:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("963675")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2293171")]),s._v("\n     HRTIMER:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n         RCU:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1542111")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1590625")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("é€šè¿‡ "),a("code",[s._v("/proc/softirqs")]),s._v("â€‹ æ–‡ä»¶å†…å®¹çš„å˜åŒ–æƒ…å†µ, å¯ä»¥å‘ç°, "),a("strong",[s._v("TIMER(å®šæ—¶ä¸­æ–­), NET_RX(ç½‘ç»œæ¥æ”¶), SCHED(å†…æ ¸è°ƒåº¦), RCU(RCU é”)")]),s._v(" ç­‰è¿™å‡ ä¸ªè½¯ä¸­æ–­éƒ½åœ¨ä¸åœå˜åŒ–.")]),s._v(" "),a("p",[s._v("å…¶ä¸­, NET_RX ä¹Ÿå°±æ˜¯ç½‘ç»œæ•°æ®åŒ…æ¥æ”¶è½¯ä¸­æ–­çš„å˜åŒ–é€Ÿç‡æœ€å¿«. è€Œå…¶ä»–å‡ ç§ç±»å‹çš„è½¯ä¸­æ–­, æ˜¯ä¿è¯ Linux è°ƒåº¦, æ—¶é’Ÿå’Œä¸´ç•ŒåŒºä¿æŠ¤è¿™äº›æ­£å¸¸å·¥ä½œæ‰€å¿…éœ€çš„, æ‰€ä»¥å®ƒä»¬æœ‰ä¸€å®šçš„å˜åŒ–å€’æ˜¯æ­£å¸¸çš„.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆæ¥ä¸‹æ¥, å°±ä»"),a("strong",[s._v("ç½‘ç»œæ¥æ”¶")]),s._v("çš„è½¯ä¸­æ–­ç€æ‰‹, ç»§ç»­åˆ†æ. æ—¢ç„¶æ˜¯ç½‘ç»œæ¥æ”¶çš„è½¯ä¸­æ–­, ç¬¬ä¸€æ­¥åº”è¯¥å°±æ˜¯è§‚å¯Ÿç³»ç»Ÿçš„ç½‘ç»œæ¥æ”¶æƒ…å†µ. è¿™é‡Œä½ å¯èƒ½æƒ³èµ·äº†å¾ˆå¤šç½‘ç»œå·¥å…·, ä¸è¿‡è¿™é‡Œæ¨èä½¿ç”¨ "),a("strong",[s._v("sar")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("sar å¯ä»¥ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿçš„ç½‘ç»œæ”¶å‘æƒ…å†µ, è¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯, ä¸ä»…å¯ä»¥è§‚å¯Ÿç½‘ç»œæ”¶å‘çš„ååé‡(BPS, æ¯ç§’æ”¶å‘çš„å­—èŠ‚æ•°), è¿˜å¯ä»¥è§‚å¯Ÿç½‘ç»œæ”¶å‘çš„ PPS, å³æ¯ç§’æ”¶å‘çš„ç½‘ç»œå¸§æ•°")]),s._v(".")]),s._v(" "),a("p",[s._v("åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ sar å‘½ä»¤, å¹¶æ·»åŠ  -n DEV å‚æ•°æ˜¾ç¤ºç½‘ç»œæ”¶å‘çš„æŠ¥å‘Š:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -n DEV è¡¨ç¤ºæ˜¾ç¤ºç½‘ç»œæ”¶å‘çš„æŠ¥å‘Š, é—´éš” 1 ç§’è¾“å‡ºä¸€ç»„æ•°æ®")]),s._v("\n$ sar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" DEV "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":03:46        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":03:47         eth0  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12607.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6304.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("664.86")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("358.11")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":03:47      docker0   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6302.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12604.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("270.79")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("664.66")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":03:47           lo      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":03:47    veth9f6bbcd   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6302.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12604.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("356.95")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("664.66")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("å¯¹äº sar çš„è¾“å‡ºç•Œé¢, å…ˆæ¥ç®€å•ä»‹ç»ä¸€ä¸‹, ä»å·¦å¾€å³ä¾æ¬¡æ˜¯:")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€åˆ—: è¡¨ç¤ºæŠ¥å‘Šçš„æ—¶é—´.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒåˆ—: IFACE è¡¨ç¤º"),a("strong",[s._v("ç½‘å¡")]),s._v(".")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰, å››åˆ—: rxpck/s å’Œ txpck/s åˆ†åˆ«è¡¨ç¤º"),a("strong",[s._v("æ¯ç§’æ¥æ”¶, å‘é€çš„ç½‘ç»œå¸§æ•°, ä¹Ÿå°±æ˜¯ PPS")]),s._v(".")]),s._v(" "),a("li",[s._v("ç¬¬äº”, å…­åˆ—: rxkB/s å’Œ txkB/s åˆ†åˆ«è¡¨ç¤º"),a("strong",[s._v("æ¯ç§’æ¥æ”¶, å‘é€çš„åƒå­—èŠ‚æ•°, ä¹Ÿå°±æ˜¯ BPS")]),s._v(".")]),s._v(" "),a("li",[s._v("åé¢çš„å…¶ä»–å‚æ•°åŸºæœ¬æ¥è¿‘ 0, æ˜¾ç„¶è·Ÿä»Šå¤©çš„é—®é¢˜æ²¡æœ‰ç›´æ¥å…³ç³», å¯ä»¥å…ˆå¿½ç•¥æ‰.")])]),s._v(" "),a("p",[s._v("å…·ä½“æ¥çœ‹è¾“å‡ºçš„å†…å®¹, å¯ä»¥å‘ç°:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å¯¹ç½‘å¡ eth0 æ¥è¯´, æ¯ç§’æ¥æ”¶çš„ç½‘ç»œå¸§æ•°æ¯”è¾ƒå¤§")]),s._v(", è¾¾åˆ°äº† 12607, è€Œå‘é€çš„ç½‘ç»œå¸§æ•°åˆ™æ¯”è¾ƒå°, åªæœ‰ 6304; æ¯ç§’æ¥æ”¶çš„åƒå­—èŠ‚æ•°åªæœ‰ 664 KB, è€Œå‘é€çš„åƒå­—èŠ‚æ•°æ›´å°, åªæœ‰ 358 KB.")]),s._v(" "),a("li",[s._v("docker0 å’Œ veth9f6bbcd çš„æ•°æ®è·Ÿ eth0 åŸºæœ¬ä¸€è‡´, åªæ˜¯å‘é€å’Œæ¥æ”¶ç›¸å, å‘é€çš„æ•°æ®è¾ƒå¤§è€Œæ¥æ”¶çš„æ•°æ®è¾ƒå°. è¿™æ˜¯ Linux å†…éƒ¨ç½‘æ¡¥è½¬å‘å¯¼è‡´çš„, æš‚ä¸”ä¸ç”¨æ·±ç©¶, åªè¦çŸ¥é“è¿™æ˜¯ç³»ç»ŸæŠŠ eth0 æ”¶åˆ°çš„åŒ…è½¬å‘ç»™ Nginx æœåŠ¡å³å¯. å…·ä½“å·¥ä½œåŸç†, ä¼šåœ¨åé¢çš„ç½‘ç»œéƒ¨åˆ†è¯¦ç»†ä»‹ç».")])]),s._v(" "),a("p",[s._v("ä»è¿™äº›æ•°æ®æœ‰æ²¡æœ‰å‘ç°ä»€ä¹ˆå¼‚å¸¸çš„åœ°æ–¹?")]),s._v(" "),a("p",[s._v("æ—¢ç„¶æ€€ç–‘æ˜¯ç½‘ç»œæ¥æ”¶ä¸­æ–­çš„é—®é¢˜, è¿˜æ˜¯é‡ç‚¹æ¥çœ‹ eth0: æ¥æ”¶çš„ PPS æ¯”è¾ƒå¤§, è¾¾åˆ° 12607, è€Œæ¥æ”¶çš„ BPS å´å¾ˆå°, åªæœ‰ 664 KB. ç›´è§‚æ¥çœ‹ç½‘ç»œå¸§åº”è¯¥éƒ½æ˜¯æ¯”è¾ƒå°çš„, ç¨å¾®è®¡ç®—ä¸€ä¸‹, 664*1024/12607 = 54 å­—èŠ‚, è¯´æ˜å¹³å‡æ¯ä¸ªç½‘ç»œå¸§åªæœ‰ 54 å­—èŠ‚, è¿™æ˜¾ç„¶æ˜¯å¾ˆå°çš„ç½‘ç»œå¸§, ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„å°åŒ…é—®é¢˜.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, æœ‰æ²¡æœ‰åŠæ³•çŸ¥é“è¿™æ˜¯ä¸€ä¸ª"),a("strong",[s._v("ä»€ä¹ˆæ ·çš„ç½‘ç»œå¸§")]),s._v(", ä»¥åŠä»å“ªé‡Œå‘è¿‡æ¥çš„å‘¢?")]),s._v(" "),a("p",[s._v("ä½¿ç”¨ tcpdump æŠ“å– eth0 ä¸Šçš„åŒ…å°±å¯ä»¥äº†. æˆ‘ä»¬äº‹å…ˆå·²ç»çŸ¥é“, Nginx ç›‘å¬åœ¨ 80 ç«¯å£, å®ƒæ‰€æä¾›çš„ HTTP æœåŠ¡æ˜¯åŸºäº TCP åè®®çš„, æ‰€ä»¥å¯ä»¥æŒ‡å®š TCP åè®®å’Œ 80 ç«¯å£ç²¾ç¡®æŠ“åŒ….")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ tcpdump å‘½ä»¤, é€šè¿‡ "),a("code",[s._v("-i eth0")]),s._v("â€‹ é€‰é¡¹æŒ‡å®šç½‘å¡ eth0, å¹¶é€šè¿‡ "),a("code",[s._v("tcp port 80")]),s._v("â€‹ é€‰é¡¹æŒ‡å®š TCP åè®®çš„ 80 ç«¯å£:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i eth0 åªæŠ“å– eth0 ç½‘å¡, -n ä¸è§£æåè®®åå’Œä¸»æœºå")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcp port 80 è¡¨ç¤ºåªæŠ“å– tcp åè®®å¹¶ä¸”ç«¯å£å·ä¸º 80 çš„ç½‘ç»œå¸§")]),s._v("\n$ tcpdump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" eth0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" tcp port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":11:32.678966 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2.18238 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30.80: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("458303614")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä» tcpdump çš„è¾“å‡ºä¸­, å¯ä»¥å‘ç°")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("192.168.0.2.18238 > 192.168.0.30.80")]),s._v(", è¡¨ç¤ºç½‘ç»œå¸§ä» 192.168.0.2 çš„ 18238 ç«¯å£å‘é€åˆ° 192.168.0.30 çš„ 80 ç«¯å£, ä¹Ÿå°±æ˜¯ä»è¿è¡Œ hping3 æœºå™¨çš„ 18238 ç«¯å£å‘é€ç½‘ç»œå¸§, ç›®çš„ä¸º Nginx æ‰€åœ¨æœºå™¨çš„ 80 ç«¯å£.")]),s._v(" "),a("li",[s._v("â€‹"),a("code",[s._v("Flags [S]")]),s._v("â€‹ åˆ™è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª SYN åŒ….")])]),s._v(" "),a("p",[s._v("å†åŠ ä¸Šå‰é¢ç”¨ sar å‘ç°çš„, PPS è¶…è¿‡ 12000 çš„ç°è±¡, ç°åœ¨å¯ä»¥ç¡®è®¤, è¿™å°±æ˜¯ä» 192.168.0.2 è¿™ä¸ªåœ°å€å‘é€è¿‡æ¥çš„ SYN FLOOD æ”»å‡».")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œå·²ç»åšäº†å…¨å¥—çš„æ€§èƒ½è¯Šæ–­å’Œåˆ†æ. ä»ç³»ç»Ÿçš„è½¯ä¸­æ–­ä½¿ç”¨ç‡é«˜è¿™ä¸ªç°è±¡å‡ºå‘, é€šè¿‡è§‚å¯Ÿ "),a("code",[s._v("/proc/softirqs")]),s._v("â€‹ æ–‡ä»¶çš„å˜åŒ–æƒ…å†µ, "),a("strong",[s._v("åˆ¤æ–­å‡ºè½¯ä¸­æ–­ç±»å‹æ˜¯ç½‘ç»œæ¥æ”¶ä¸­æ–­")]),s._v("; å†é€šè¿‡ sar å’Œ tcpdump , ç¡®è®¤è¿™æ˜¯ä¸€ä¸ª SYN FLOOD é—®é¢˜.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("SYN FLOOD é—®é¢˜æœ€ç®€å•çš„è§£å†³æ–¹æ³•, å°±æ˜¯ä»äº¤æ¢æœºæˆ–è€…ç¡¬ä»¶é˜²ç«å¢™ä¸­å°æ‰æ¥æº IP, è¿™æ · SYN FLOOD ç½‘ç»œå¸§å°±ä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨ä¸­")])]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_2-å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å°ç»“"}},[s._v("#")]),s._v(" 2.å°ç»“")]),s._v(" "),a("p",[s._v("è½¯ä¸­æ–­ CPU ä½¿ç”¨ç‡(softirq)å‡é«˜æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„æ€§èƒ½é—®é¢˜. è™½ç„¶è½¯ä¸­æ–­çš„ç±»å‹å¾ˆå¤š, "),a("strong",[s._v("ä½†å®é™…ç”Ÿäº§ä¸­é‡åˆ°çš„æ€§èƒ½ç“¶é¢ˆå¤§å¤šæ˜¯ç½‘ç»œæ”¶å‘ç±»å‹çš„è½¯ä¸­æ–­, ç‰¹åˆ«æ˜¯ç½‘ç»œæ¥æ”¶çš„è½¯ä¸­æ–­")]),s._v(". åœ¨ç¢°åˆ°è¿™ç±»é—®é¢˜æ—¶, å¯ä»¥å€Ÿç”¨ sar, tcpdump ç­‰å·¥å…·, åšè¿›ä¸€æ­¥åˆ†æ.")]),s._v(" "),a("h4",{attrs:{id:"_11-å¥—è·¯ç¯‡-å¦‚ä½•è¿…é€Ÿåˆ†æå‡ºç³»ç»Ÿcpuçš„ç“¶é¢ˆåœ¨å“ªé‡Œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-å¥—è·¯ç¯‡-å¦‚ä½•è¿…é€Ÿåˆ†æå‡ºç³»ç»Ÿcpuçš„ç“¶é¢ˆåœ¨å“ªé‡Œ"}},[s._v("#")]),s._v(" 11-å¥—è·¯ç¯‡:å¦‚ä½•è¿…é€Ÿåˆ†æå‡ºç³»ç»ŸCPUçš„ç“¶é¢ˆåœ¨å“ªé‡Œ?")]),s._v(" "),a("p",[s._v("å‰å‡ èŠ‚é‡Œ, æˆ‘é€šè¿‡å‡ ä¸ªæ¡ˆä¾‹, å¸¦ä½ åˆ†æäº†å„ç§å¸¸è§çš„ CPU æ€§èƒ½é—®é¢˜. é€šè¿‡è¿™äº›, æˆ‘ç›¸ä¿¡ä½ å¯¹ CPU çš„æ€§èƒ½åˆ†æå·²ç»ä¸å†é™Œç”Ÿå’Œææƒ§, èµ·ç æœ‰äº†åŸºæœ¬çš„æ€è·¯, ä¹Ÿäº†è§£äº†ä¸å°‘ CPU æ€§èƒ½çš„åˆ†æå·¥å…·.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, æˆ‘çŒœä½ å¯èƒ½ä¹Ÿç¢°åˆ°äº†ä¸€ä¸ªæˆ‘æ›¾æœ‰è¿‡çš„å›°æƒ‘:  CPU çš„æ€§èƒ½æŒ‡æ ‡é‚£ä¹ˆå¤š, CPU æ€§èƒ½åˆ†æå·¥å…·ä¹Ÿæ˜¯ä¸€æŠ“ä¸€å¤§æŠŠ, å¦‚æœç¦»å¼€ä¸“æ , æ¢æˆå®é™…çš„å·¥ä½œåœºæ™¯, æˆ‘åˆè¯¥è§‚å¯Ÿä»€ä¹ˆæŒ‡æ ‡, é€‰æ‹©å“ªä¸ªæ€§èƒ½å·¥å…·å‘¢?")]),s._v(" "),a("p",[s._v('ä¸è¦æ‹…å¿ƒ, ä»Šå¤©æˆ‘å°±ä»¥å¤šå¹´çš„æ€§èƒ½ä¼˜åŒ–ç»éªŒ, ç»™ä½ æ€»ç»“å‡ºä¸€ä¸ª"åˆå¿«åˆå‡†"çš„ç“¶é¢ˆå®šä½å¥—è·¯, å‘Šè¯‰ä½ åœ¨ä¸åŒåœºæ™¯ä¸‹, æŒ‡æ ‡å·¥å…·æ€ä¹ˆé€‰, æ€§èƒ½ç“¶é¢ˆæ€ä¹ˆæ‰¾.')]),s._v(" "),a("h5",{attrs:{id:"_1-cpuæ€§èƒ½æŒ‡æ ‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-cpuæ€§èƒ½æŒ‡æ ‡"}},[s._v("#")]),s._v(" 1.CPUæ€§èƒ½æŒ‡æ ‡")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸‹, æè¿° CPU çš„æ€§èƒ½æŒ‡æ ‡éƒ½æœ‰å“ªäº›. ä½ å¯ä»¥è‡ªå·±å…ˆæ‰¾å¼ çº¸, å‡­ç€è®°å¿†å†™ä¸€å†™; æˆ–è€…æ‰“å¼€å‰é¢çš„æ–‡ç« , è‡ªå·±æ€»ç»“ä¸€ä¸‹.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, "),a("strong",[s._v("æœ€å®¹æ˜“æƒ³åˆ°çš„åº”è¯¥æ˜¯ CPU ä½¿ç”¨ç‡")]),s._v(", è¿™ä¹Ÿæ˜¯å®é™…ç¯å¢ƒä¸­æœ€å¸¸è§çš„ä¸€ä¸ªæ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("p",[s._v("CPU ä½¿ç”¨ç‡æè¿°äº†éç©ºé—²æ—¶é—´å æ€» CPU æ—¶é—´çš„ç™¾åˆ†æ¯”, æ ¹æ® CPU ä¸Šè¿è¡Œä»»åŠ¡çš„ä¸åŒ, åˆè¢«åˆ†ä¸ºç”¨æˆ· CPU, ç³»ç»Ÿ CPU, ç­‰å¾… I/O CPU, è½¯ä¸­æ–­å’Œç¡¬ä¸­æ–­ç­‰.")]),s._v(" "),a("ul",[a("li",[s._v("ç”¨æˆ· CPU ä½¿ç”¨ç‡, åŒ…æ‹¬ç”¨æˆ·æ€ CPU ä½¿ç”¨ç‡(user)å’Œä½ä¼˜å…ˆçº§ç”¨æˆ·æ€ CPU ä½¿ç”¨ç‡(nice), è¡¨ç¤º CPU åœ¨ç”¨æˆ·æ€è¿è¡Œçš„æ—¶é—´ç™¾åˆ†æ¯”. ç”¨æˆ· CPU ä½¿ç”¨ç‡é«˜, é€šå¸¸è¯´æ˜æœ‰åº”ç”¨ç¨‹åºæ¯”è¾ƒç¹å¿™.")]),s._v(" "),a("li",[s._v("ç³»ç»Ÿ CPU ä½¿ç”¨ç‡, è¡¨ç¤º CPU åœ¨å†…æ ¸æ€è¿è¡Œçš„æ—¶é—´ç™¾åˆ†æ¯”(ä¸åŒ…æ‹¬ä¸­æ–­). ç³»ç»Ÿ CPU ä½¿ç”¨ç‡é«˜, è¯´æ˜å†…æ ¸æ¯”è¾ƒç¹å¿™.")]),s._v(" "),a("li",[s._v("ç­‰å¾… I/O çš„ CPU ä½¿ç”¨ç‡, é€šå¸¸ä¹Ÿç§°ä¸º iowait, è¡¨ç¤ºç­‰å¾… I/O çš„æ—¶é—´ç™¾åˆ†æ¯”. iowait é«˜, é€šå¸¸è¯´æ˜ç³»ç»Ÿä¸ç¡¬ä»¶è®¾å¤‡çš„ I/O äº¤äº’æ—¶é—´æ¯”è¾ƒé•¿.")]),s._v(" "),a("li",[s._v("è½¯ä¸­æ–­å’Œç¡¬ä¸­æ–­çš„ CPU ä½¿ç”¨ç‡, åˆ†åˆ«è¡¨ç¤ºå†…æ ¸è°ƒç”¨è½¯ä¸­æ–­å¤„ç†ç¨‹åº, ç¡¬ä¸­æ–­å¤„ç†ç¨‹åºçš„æ—¶é—´ç™¾åˆ†æ¯”. å®ƒä»¬çš„ä½¿ç”¨ç‡é«˜, é€šå¸¸è¯´æ˜ç³»ç»Ÿå‘ç”Ÿäº†å¤§é‡çš„ä¸­æ–­.")]),s._v(" "),a("li",[s._v("é™¤äº†ä¸Šé¢è¿™äº›, è¿˜æœ‰åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ä¼šç”¨åˆ°çš„çªƒå– CPU ä½¿ç”¨ç‡(steal)å’Œå®¢æˆ· CPU ä½¿ç”¨ç‡(guest), åˆ†åˆ«è¡¨ç¤ºè¢«å…¶ä»–è™šæ‹Ÿæœºå ç”¨çš„ CPU æ—¶é—´ç™¾åˆ†æ¯”, å’Œè¿è¡Œå®¢æˆ·è™šæ‹Ÿæœºçš„ CPU æ—¶é—´ç™¾åˆ†æ¯”.")])]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äºŒä¸ªæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„, åº”è¯¥æ˜¯å¹³å‡è´Ÿè½½(Load Average)")]),s._v(" , ä¹Ÿå°±æ˜¯ç³»ç»Ÿçš„å¹³å‡æ´»è·ƒè¿›ç¨‹æ•°. å®ƒååº”äº†ç³»ç»Ÿçš„æ•´ä½“è´Ÿè½½æƒ…å†µ, ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªæ•°å€¼, åˆ†åˆ«æŒ‡è¿‡å» 1 åˆ†é’Ÿ, è¿‡å» 5 åˆ†é’Ÿå’Œè¿‡å» 15 åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½.")]),s._v(" "),a("p",[s._v("ç†æƒ³æƒ…å†µä¸‹, å¹³å‡è´Ÿè½½ç­‰äºé€»è¾‘ CPU ä¸ªæ•°, è¿™è¡¨ç¤ºæ¯ä¸ª CPU éƒ½æ°å¥½è¢«å……åˆ†åˆ©ç”¨. å¦‚æœå¹³å‡è´Ÿè½½å¤§äºé€»è¾‘ CPU ä¸ªæ•°, å°±è¡¨ç¤ºè´Ÿè½½æ¯”è¾ƒé‡äº†.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸‰ä¸ª, ä¹Ÿæ˜¯åœ¨ä¸“æ å­¦ä¹ å‰ä½ ä¼°è®¡ä¸å¤ªä¼šæ³¨æ„åˆ°çš„, è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢")]),s._v(", åŒ…æ‹¬:")]),s._v(" "),a("ul",[a("li",[s._v("æ— æ³•è·å–èµ„æºè€Œå¯¼è‡´çš„è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢;")]),s._v(" "),a("li",[s._v("è¢«ç³»ç»Ÿå¼ºåˆ¶è°ƒåº¦å¯¼è‡´çš„éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢.")])]),s._v(" "),a("p",[s._v("ä¸Šä¸‹æ–‡åˆ‡æ¢, æœ¬èº«æ˜¯ä¿è¯ Linux æ­£å¸¸è¿è¡Œçš„ä¸€é¡¹æ ¸å¿ƒåŠŸèƒ½. ä½†è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢, ä¼šå°†åŸæœ¬è¿è¡Œè¿›ç¨‹çš„ CPU æ—¶é—´, æ¶ˆè€—åœ¨å¯„å­˜å™¨, å†…æ ¸æ ˆä»¥åŠè™šæ‹Ÿå†…å­˜ç­‰æ•°æ®çš„ä¿å­˜å’Œæ¢å¤ä¸Š, ç¼©çŸ­è¿›ç¨‹çœŸæ­£è¿è¡Œçš„æ—¶é—´, æˆä¸ºæ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("é™¤äº†ä¸Šé¢å‡ ç§, "),a("strong",[s._v("è¿˜æœ‰ä¸€ä¸ªæŒ‡æ ‡, CPU ç¼“å­˜çš„å‘½ä¸­ç‡")]),s._v(". ç”±äº CPU å‘å±•çš„é€Ÿåº¦è¿œå¿«äºå†…å­˜çš„å‘å±•, CPU çš„å¤„ç†é€Ÿåº¦å°±æ¯”å†…å­˜çš„è®¿é—®é€Ÿåº¦å¿«å¾—å¤š. è¿™æ ·, CPU åœ¨è®¿é—®å†…å­˜çš„æ—¶å€™, å…ä¸äº†è¦ç­‰å¾…å†…å­˜çš„å“åº”. ä¸ºäº†åè°ƒè¿™ä¸¤è€…å·¨å¤§çš„æ€§èƒ½å·®è·, CPU ç¼“å­˜(é€šå¸¸æ˜¯å¤šçº§ç¼“å­˜)å°±å‡ºç°äº†.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/d863118fd498575559fcf96e0eae4f5a-20230731161933-5x3whn2.png",alt:""}})]),s._v(" "),a("p",[s._v("å°±åƒä¸Šé¢è¿™å¼ å›¾æ˜¾ç¤ºçš„, CPU ç¼“å­˜çš„é€Ÿåº¦ä»‹äº CPU å’Œå†…å­˜ä¹‹é—´, ç¼“å­˜çš„æ˜¯çƒ­ç‚¹çš„å†…å­˜æ•°æ®. æ ¹æ®ä¸æ–­å¢é•¿çš„çƒ­ç‚¹æ•°æ®, è¿™äº›ç¼“å­˜æŒ‰ç…§å¤§å°ä¸åŒåˆ†ä¸º L1, L2, L3 ç­‰ä¸‰çº§ç¼“å­˜, å…¶ä¸­ L1 å’Œ L2 å¸¸ç”¨åœ¨å•æ ¸ä¸­,  L3 åˆ™ç”¨åœ¨å¤šæ ¸ä¸­.")]),s._v(" "),a("p",[s._v("ä» L1 åˆ° L3, ä¸‰çº§ç¼“å­˜çš„å¤§å°ä¾æ¬¡å¢å¤§, ç›¸åº”çš„, æ€§èƒ½ä¾æ¬¡é™ä½(å½“ç„¶æ¯”å†…å­˜è¿˜æ˜¯å¥½å¾—å¤š). è€Œå®ƒä»¬çš„å‘½ä¸­ç‡, è¡¡é‡çš„æ˜¯ CPU ç¼“å­˜çš„å¤ç”¨æƒ…å†µ, å‘½ä¸­ç‡è¶Šé«˜, åˆ™è¡¨ç¤ºæ€§èƒ½è¶Šå¥½.")]),s._v(" "),a("p",[s._v('è¿™äº›æŒ‡æ ‡éƒ½å¾ˆæœ‰ç”¨, éœ€è¦æˆ‘ä»¬ç†Ÿç»ƒæŒæ¡, æ‰€ä»¥æˆ‘æ€»ç»“æˆäº†ä¸€å¼ å›¾, å¸®ä½ åˆ†ç±»å’Œè®°å¿†. ä½ å¯ä»¥ä¿å­˜æ‰“å°ä¸‹æ¥, éšæ—¶æŸ¥çœ‹å¤ä¹ , ä¹Ÿå¯ä»¥å½“æˆ CPU æ€§èƒ½åˆ†æçš„"æŒ‡æ ‡ç­›é€‰"æ¸…å•.')]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/de210677c7d9d86fea1dbb903970f1bc-20230731161933-ecrs8oc.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_2-æ€§èƒ½å·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ€§èƒ½å·¥å…·"}},[s._v("#")]),s._v(" 2.æ€§èƒ½å·¥å…·")]),s._v(" "),a("p",[s._v("æŒæ¡äº† CPU çš„æ€§èƒ½æŒ‡æ ‡, è¿˜éœ€è¦çŸ¥é“æ€æ ·å»è·å–è¿™äº›æŒ‡æ ‡, ä¹Ÿå°±æ˜¯å·¥å…·çš„ä½¿ç”¨.")]),s._v(" "),a("p",[s._v("è¿˜è®°å¾—å‰é¢æ¡ˆä¾‹éƒ½ç”¨äº†å“ªäº›å·¥å…·å—? è¿™é‡Œä¹Ÿä¸€èµ·å›é¡¾ä¸€ä¸‹ CPU æ€§èƒ½å·¥å…·.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, å¹³å‡è´Ÿè½½çš„æ¡ˆä¾‹. å…ˆç”¨ uptime,  æŸ¥çœ‹äº†ç³»ç»Ÿçš„å¹³å‡è´Ÿè½½; è€Œåœ¨å¹³å‡è´Ÿè½½å‡é«˜å, åˆç”¨ mpstat å’Œ pidstat, åˆ†åˆ«è§‚å¯Ÿäº†æ¯ä¸ª CPU å’Œæ¯ä¸ªè¿›ç¨‹ CPU çš„ä½¿ç”¨æƒ…å†µ, è¿›è€Œæ‰¾å‡ºäº†å¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜çš„è¿›ç¨‹, ä¹Ÿå°±æ˜¯å‹æµ‹å·¥å…· stress.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒä¸ª, ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¡ˆä¾‹. å…ˆç”¨ vmstat æŸ¥çœ‹äº†ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°å’Œä¸­æ–­æ¬¡æ•°; ç„¶åé€šè¿‡ pidstat, è§‚å¯Ÿäº†è¿›ç¨‹çš„è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ; æœ€åé€šè¿‡ pidstat, è§‚å¯Ÿäº†çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ, æ‰¾å‡ºäº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°å¢å¤šçš„æ ¹æº, ä¹Ÿå°±æ˜¯åŸºå‡†æµ‹è¯•å·¥å…· sysbench.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸‰ä¸ª, è¿›ç¨‹ CPU ä½¿ç”¨ç‡å‡é«˜çš„æ¡ˆä¾‹. å…ˆç”¨ top æŸ¥çœ‹äº†ç³»ç»Ÿå’Œè¿›ç¨‹çš„ CPU ä½¿ç”¨æƒ…å†µ, å‘ç° CPU ä½¿ç”¨ç‡å‡é«˜çš„è¿›ç¨‹æ˜¯ php-fpm; å†ç”¨ perf top, è§‚å¯Ÿ php-fpm çš„è°ƒç”¨é“¾, æœ€ç»ˆæ‰¾å‡º CPU å‡é«˜çš„æ ¹æº, ä¹Ÿå°±æ˜¯åº“å‡½æ•° sqrt().")]),s._v(" "),a("p",[s._v("ç¬¬å››ä¸ª, ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡å‡é«˜çš„æ¡ˆä¾‹. å…ˆç”¨ top è§‚å¯Ÿåˆ°äº†ç³»ç»Ÿ CPU å‡é«˜, ä½†é€šè¿‡ top å’Œ pidstat, å´æ‰¾ä¸å‡ºé«˜ CPU ä½¿ç”¨ç‡çš„è¿›ç¨‹. äºæ˜¯, é‡æ–°å®¡è§† top çš„è¾“å‡º, åˆä» CPU ä½¿ç”¨ç‡ä¸é«˜ä½†å¤„äº Running çŠ¶æ€çš„è¿›ç¨‹å…¥æ‰‹, æ‰¾å‡ºäº†å¯ç–‘ä¹‹å¤„, æœ€ç»ˆé€šè¿‡ perf record å’Œ perf report, å‘ç°åŸæ¥æ˜¯çŸ­æ—¶è¿›ç¨‹åœ¨æ£é¬¼.")]),s._v(" "),a("p",[s._v("å¦å¤–, å¯¹äºçŸ­æ—¶è¿›ç¨‹, è¿˜ä»‹ç»äº†ä¸€ä¸ªä¸“é—¨çš„å·¥å…· execsnoop, å®ƒå¯ä»¥å®æ—¶ç›‘æ§è¿›ç¨‹è°ƒç”¨çš„å¤–éƒ¨å‘½ä»¤.")]),s._v(" "),a("p",[s._v("ç¬¬äº”ä¸ª, ä¸å¯ä¸­æ–­è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹çš„æ¡ˆä¾‹. å…ˆç”¨ top è§‚å¯Ÿåˆ°äº† iowait å‡é«˜çš„é—®é¢˜, å¹¶å‘ç°äº†å¤§é‡çš„ä¸å¯ä¸­æ–­è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹; æ¥ç€ç”¨ dstat å‘ç°æ˜¯è¿™æ˜¯ç”±ç£ç›˜è¯»å¯¼è‡´çš„, äºæ˜¯åˆé€šè¿‡ pidstat æ‰¾å‡ºäº†ç›¸å…³çš„è¿›ç¨‹. ä½†ç”¨ strace æŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿè°ƒç”¨å´å¤±è´¥äº†, æœ€ç»ˆè¿˜æ˜¯ç”¨ perf åˆ†æè¿›ç¨‹è°ƒç”¨é“¾, æ‰å‘ç°æ ¹æºåœ¨äºç£ç›˜ç›´æ¥ I/O .")]),s._v(" "),a("p",[s._v("æœ€åä¸€ä¸ª, è½¯ä¸­æ–­çš„æ¡ˆä¾‹. é€šè¿‡ top è§‚å¯Ÿåˆ°, ç³»ç»Ÿçš„è½¯ä¸­æ–­ CPU ä½¿ç”¨ç‡å‡é«˜; æ¥ç€æŸ¥çœ‹ "),a("code",[s._v("/proc/softirqs")]),s._v("â€‹, æ‰¾åˆ°äº†å‡ ç§å˜åŒ–é€Ÿç‡è¾ƒå¿«çš„è½¯ä¸­æ–­; ç„¶åé€šè¿‡ sar å‘½ä»¤, å‘ç°æ˜¯ç½‘ç»œå°åŒ…çš„é—®é¢˜, æœ€åå†ç”¨ tcpdump, æ‰¾å‡ºç½‘ç»œå¸§çš„ç±»å‹å’Œæ¥æº, ç¡®å®šæ˜¯ä¸€ä¸ª SYN FLOOD æ”»å‡»å¯¼è‡´çš„.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œ, ä¼°è®¡ä½ å·²ç»æ™•äº†å§, åŸæ¥çŸ­çŸ­å‡ ä¸ªæ¡ˆä¾‹, æˆ‘ä»¬å·²ç»ç”¨è¿‡åå‡ ç§ CPU æ€§èƒ½å·¥å…·äº†, è€Œä¸”æ¯ç§å·¥å…·çš„é€‚ç”¨åœºæ™¯è¿˜ä¸åŒå‘¢! è¿™ä¹ˆå¤šçš„å·¥å…·è¦æ€ä¹ˆåŒºåˆ†å‘¢? åœ¨å®é™…çš„æ€§èƒ½åˆ†æä¸­, åˆè¯¥æ€ä¹ˆé€‰æ‹©å‘¢?")]),s._v(" "),a("p",[s._v("æˆ‘çš„ç»éªŒæ˜¯, ä»ä¸¤ä¸ªä¸åŒçš„ç»´åº¦æ¥ç†è§£å®ƒä»¬, åšåˆ°æ´»å­¦æ´»ç”¨.")]),s._v(" "),a("h5",{attrs:{id:"_3-æ´»å­¦æ´»ç”¨-æŠŠæ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½å·¥å…·è”ç³»èµ·æ¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ´»å­¦æ´»ç”¨-æŠŠæ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½å·¥å…·è”ç³»èµ·æ¥"}},[s._v("#")]),s._v(" 3.æ´»å­¦æ´»ç”¨-æŠŠæ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½å·¥å…·è”ç³»èµ·æ¥")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸€ä¸ªç»´åº¦, ä» CPU çš„æ€§èƒ½æŒ‡æ ‡å‡ºå‘. ä¹Ÿå°±æ˜¯è¯´, å½“è¦æŸ¥çœ‹æŸä¸ªæ€§èƒ½æŒ‡æ ‡æ—¶, è¦æ¸…æ¥šçŸ¥é“å“ªäº›å·¥å…·å¯ä»¥åšåˆ°")]),s._v(".")]),s._v(" "),a("p",[s._v("æ ¹æ®ä¸åŒçš„æ€§èƒ½æŒ‡æ ‡, å¯¹æä¾›æŒ‡æ ‡çš„æ€§èƒ½å·¥å…·è¿›è¡Œåˆ†ç±»å’Œç†è§£. è¿™æ ·åœ¨å®é™…æ’æŸ¥æ€§èƒ½é—®é¢˜æ—¶, å°±å¯ä»¥æ¸…æ¥šçŸ¥é“, ä»€ä¹ˆå·¥å…·å¯ä»¥æä¾›ä½ æƒ³è¦çš„æŒ‡æ ‡, è€Œä¸æ˜¯æ¯«æ— æ ¹æ®åœ°æŒ¨ä¸ªå°è¯•, æ’è¿æ°”.")]),s._v(" "),a("p",[s._v("å…¶å®, æˆ‘åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­å·²ç»å¤šæ¬¡ç”¨åˆ°äº†è¿™ä¸ªæ€è·¯. æ¯”å¦‚ç”¨ top å‘ç°äº†è½¯ä¸­æ–­ CPU ä½¿ç”¨ç‡é«˜å, ä¸‹ä¸€æ­¥è‡ªç„¶å°±æƒ³çŸ¥é“å…·ä½“çš„è½¯ä¸­æ–­ç±»å‹. é‚£åœ¨å“ªé‡Œå¯ä»¥è§‚å¯Ÿå„ç±»è½¯ä¸­æ–­çš„è¿è¡Œæƒ…å†µå‘¢? å½“ç„¶æ˜¯ proc æ–‡ä»¶ç³»ç»Ÿä¸­çš„ /proc/softirqs è¿™ä¸ªæ–‡ä»¶.")]),s._v(" "),a("p",[s._v("ç´§æ¥ç€, æ¯”å¦‚è¯´, æˆ‘ä»¬æ‰¾åˆ°çš„è½¯ä¸­æ–­ç±»å‹æ˜¯ç½‘ç»œæ¥æ”¶, é‚£å°±è¦ç»§ç»­å¾€ç½‘ç»œæ¥æ”¶æ–¹å‘æ€è€ƒ. ç³»ç»Ÿçš„ç½‘ç»œæ¥æ”¶æƒ…å†µæ˜¯ä»€ä¹ˆæ ·çš„? ä»€ä¹ˆå·¥å…·å¯ä»¥æŸ¥åˆ°ç½‘ç»œæ¥æ”¶æƒ…å†µå‘¢? åœ¨æˆ‘ä»¬æ¡ˆä¾‹ä¸­, ç”¨çš„æ­£æ˜¯ dstat.")]),s._v(" "),a("p",[s._v('è™½ç„¶ä½ ä¸éœ€è¦æŠŠæ‰€æœ‰å·¥å…·èƒŒä¸‹æ¥, ä½†å¦‚æœèƒ½ç†è§£æ¯ä¸ªæŒ‡æ ‡å¯¹åº”çš„å·¥å…·çš„ç‰¹æ€§, ä¸€å®šæ›´é«˜æ•ˆ, æ›´çµæ´»åœ°ä½¿ç”¨. è¿™é‡Œ, æˆ‘æŠŠæä¾› CPU æ€§èƒ½æŒ‡æ ‡çš„å·¥å…·åšæˆäº†ä¸€ä¸ªè¡¨æ ¼, æ–¹ä¾¿ä½ æ¢³ç†å…³ç³»å’Œç†è§£è®°å¿†, å½“ç„¶, ä½ ä¹Ÿå¯ä»¥å½“æˆä¸€ä¸ª"æŒ‡æ ‡å·¥å…·"æŒ‡å—æ¥ä½¿ç”¨.')]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/77dae9f3f51e9a4e541cdaf24fdc9868-20230731161933-0eld9vv.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¸‹é¢å†æ¥çœ‹ç¬¬äºŒä¸ªç»´åº¦.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äºŒä¸ªç»´åº¦, ä»å·¥å…·å‡ºå‘. ä¹Ÿå°±æ˜¯å½“ä½ å·²ç»å®‰è£…äº†æŸä¸ªå·¥å…·å, è¦çŸ¥é“è¿™ä¸ªå·¥å…·èƒ½æä¾›å“ªäº›æŒ‡æ ‡")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™åœ¨å®é™…ç¯å¢ƒç‰¹åˆ«æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿæ˜¯éå¸¸é‡è¦çš„, å› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹, ä½ å¹¶æ²¡æœ‰æƒé™å®‰è£…æ–°çš„å·¥å…·åŒ…, åªèƒ½æœ€å¤§åŒ–åœ°åˆ©ç”¨å¥½ç³»ç»Ÿä¸­å·²ç»å®‰è£…å¥½çš„å·¥å…·, è¿™å°±éœ€è¦ä½ å¯¹å®ƒä»¬æœ‰è¶³å¤Ÿçš„äº†è§£.")]),s._v(" "),a("p",[s._v("å…·ä½“åˆ°æ¯ä¸ªå·¥å…·çš„ä½¿ç”¨æ–¹æ³•, ä¸€èˆ¬éƒ½æ”¯æŒä¸°å¯Œçš„é…ç½®é€‰é¡¹. ä¸è¿‡ä¸ç”¨æ‹…å¿ƒ, è¿™äº›é…ç½®é€‰é¡¹å¹¶ä¸ç”¨èƒŒä¸‹æ¥. ä½ åªè¦çŸ¥é“æœ‰å“ªäº›å·¥å…·, ä»¥åŠè¿™äº›å·¥å…·çš„åŸºæœ¬åŠŸèƒ½æ˜¯ä»€ä¹ˆå°±å¤Ÿäº†. çœŸæ­£è¦ç”¨åˆ°çš„æ—¶å€™,  é€šè¿‡ man å‘½ä»¤, æŸ¥å®ƒä»¬çš„ä½¿ç”¨æ‰‹å†Œå°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v('åŒæ ·çš„, æˆ‘ä¹Ÿå°†è¿™äº›å¸¸ç”¨å·¥å…·æ±‡æ€»æˆäº†ä¸€ä¸ªè¡¨æ ¼, æ–¹ä¾¿ä½ åŒºåˆ†å’Œç†è§£, è‡ªç„¶, ä½ ä¹Ÿå¯ä»¥å½“æˆä¸€ä¸ª"å·¥å…·æŒ‡æ ‡"æŒ‡å—ä½¿ç”¨, éœ€è¦æ—¶æŸ¥è¡¨å³å¯.')]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/6b9227212ea6ffea890b9209c3d32e66-20230731161933-io32wcw.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_4-å¦‚ä½•è¿…é€Ÿåˆ†æcpuçš„æ€§èƒ½ç“¶é¢ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å¦‚ä½•è¿…é€Ÿåˆ†æcpuçš„æ€§èƒ½ç“¶é¢ˆ"}},[s._v("#")]),s._v(" 4.å¦‚ä½•è¿…é€Ÿåˆ†æCPUçš„æ€§èƒ½ç“¶é¢ˆ")]),s._v(" "),a("p",[s._v("æˆ‘ç›¸ä¿¡åˆ°è¿™ä¸€æ­¥, ä½ å¯¹ CPU çš„æ€§èƒ½æŒ‡æ ‡å·²ç»éå¸¸ç†Ÿæ‚‰, ä¹Ÿæ¸…æ¥šæ¯ç§æ€§èƒ½æŒ‡æ ‡åˆ†åˆ«èƒ½ç”¨ä»€ä¹ˆå·¥å…·æ¥è·å–.")]),s._v(" "),a("p",[s._v("é‚£æ˜¯ä¸æ˜¯è¯´, æ¯æ¬¡ç¢°åˆ° CPU çš„æ€§èƒ½é—®é¢˜, ä½ éƒ½è¦æŠŠä¸Šé¢è¿™äº›å·¥å…·å…¨è·‘ä¸€é, ç„¶åå†æŠŠæ‰€æœ‰çš„ CPU æ€§èƒ½æŒ‡æ ‡å…¨åˆ†æä¸€éå‘¢?")]),s._v(" "),a("p",[s._v("ä½ ä¼°è®¡è§‰å¾—è¿™ç§ç®€å•æŸ¥æ‰¾çš„æ–¹å¼, å°±åƒæ˜¯åœ¨å‚»æ‰¾. ä¸è¿‡, åˆ«ç¬‘è¯, å› ä¸ºæœ€æ—©çš„æ—¶å€™æˆ‘å°±æ˜¯è¿™ä¹ˆåšçš„. æŠŠæ‰€æœ‰çš„æŒ‡æ ‡éƒ½æŸ¥å‡ºæ¥å†ç»Ÿä¸€åˆ†æ, å½“ç„¶æ˜¯å¯ä»¥çš„, ä¹Ÿå¾ˆå¯èƒ½æ‰¾åˆ°ç³»ç»Ÿçš„æ½œåœ¨ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("ä½†æ˜¯è¿™ç§æ–¹æ³•çš„æ•ˆç‡çœŸçš„å¤ªä½äº†! è€—æ—¶è€—åŠ›ä¸è¯´, åœ¨åºå¤§çš„æŒ‡æ ‡ä½“ç³»é¢å‰, ä½ ä¸€ä¸å°å¿ƒå¯èƒ½å°±å¿½ç•¥äº†æŸä¸ªç»†èŠ‚, å¯¼è‡´ç™½å¹²ä¸€åœº. æˆ‘å°±åƒè¿‡å¥½å¤šæ¬¡è¿™æ ·çš„è‹¦.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­, æˆ‘ä»¬é€šå¸¸éƒ½å¸Œæœ›å°½å¯èƒ½"),a("strong",[s._v("å¿«")]),s._v("åœ°å®šä½ç³»ç»Ÿçš„ç“¶é¢ˆ, ç„¶åå°½å¯èƒ½"),a("strong",[s._v("å¿«")]),s._v("åœ°ä¼˜åŒ–æ€§èƒ½, ä¹Ÿå°±æ˜¯è¦åˆå¿«åˆå‡†åœ°è§£å†³æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•, å¯ä»¥åˆå¿«åˆå‡†æ‰¾å‡ºç³»ç»Ÿç“¶é¢ˆå‘¢? ç­”æ¡ˆæ˜¯è‚¯å®šçš„.")]),s._v(" "),a("p",[s._v("è™½ç„¶ CPU çš„æ€§èƒ½æŒ‡æ ‡æ¯”è¾ƒå¤š, ä½†è¦çŸ¥é“, æ—¢ç„¶éƒ½æ˜¯æè¿°ç³»ç»Ÿçš„ CPU æ€§èƒ½, å®ƒä»¬å°±ä¸ä¼šæ˜¯å®Œå…¨å­¤ç«‹çš„, å¾ˆå¤šæŒ‡æ ‡é—´éƒ½æœ‰ä¸€å®šçš„å…³è”. "),a("strong",[s._v("æƒ³å¼„æ¸…æ¥šæ€§èƒ½æŒ‡æ ‡çš„å…³è”æ€§, å°±è¦é€šæ™“æ¯ç§æ€§èƒ½æŒ‡æ ‡çš„å·¥ä½œåŸç†")]),s._v(". è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨ä»‹ç»æ¯ä¸ªæ€§èƒ½æŒ‡æ ‡æ—¶, éƒ½è¦ç©¿æ’è®²è§£ç›¸å…³çš„ç³»ç»ŸåŸç†, å¸Œæœ›ä½ èƒ½è®°ä½è¿™ä¸€ç‚¹.")]),s._v(" "),a("p",[s._v("ä¸¾ä¸ªä¾‹å­, ç”¨æˆ· CPU ä½¿ç”¨ç‡é«˜, æˆ‘ä»¬åº”è¯¥å»æ’æŸ¥è¿›ç¨‹çš„ç”¨æˆ·æ€è€Œä¸æ˜¯å†…æ ¸æ€. å› ä¸ºç”¨æˆ· CPU ä½¿ç”¨ç‡åæ˜ çš„å°±æ˜¯ç”¨æˆ·æ€çš„ CPU ä½¿ç”¨æƒ…å†µ, è€Œå†…æ ¸æ€çš„ CPU ä½¿ç”¨æƒ…å†µåªä¼šåæ˜ åˆ°ç³»ç»Ÿ CPU ä½¿ç”¨ç‡ä¸Š.")]),s._v(" "),a("p",[s._v("ä½ çœ‹, æœ‰è¿™æ ·çš„åŸºæœ¬è®¤è¯†, æˆ‘ä»¬å°±å¯ä»¥ç¼©å°æ’æŸ¥çš„èŒƒå›´, çœæ—¶çœåŠ›.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ä¸ºäº†"),a("strong",[s._v("ç¼©å°æ’æŸ¥èŒƒå›´, æˆ‘é€šå¸¸ä¼šå…ˆè¿è¡Œå‡ ä¸ªæ”¯æŒæŒ‡æ ‡è¾ƒå¤šçš„å·¥å…·, å¦‚ top, vmstat å’Œ pidstat")]),s._v(" . ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸‰ä¸ªå·¥å…·å‘¢? ä»”ç»†çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾, ä½ å°±æ¸…æ¥šäº†.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/f2bf7129d971ae79d18198aba1e01f5b-20230731161933-710z5jb.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™å¼ å›¾é‡Œåˆ—å‡ºäº† top, vmstat å’Œ pidstat åˆ†åˆ«æä¾›çš„é‡è¦çš„ CPU æŒ‡æ ‡, å¹¶ç”¨è™šçº¿è¡¨ç¤ºå…³è”å…³ç³», å¯¹åº”å‡ºäº†æ€§èƒ½åˆ†æä¸‹ä¸€æ­¥çš„æ–¹å‘.")]),s._v(" "),a("p",[s._v("é€šè¿‡è¿™å¼ å›¾å¯ä»¥å‘ç°, è¿™ä¸‰ä¸ªå‘½ä»¤, å‡ ä¹åŒ…å«äº†æ‰€æœ‰é‡è¦çš„ CPU æ€§èƒ½æŒ‡æ ‡, æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("ä» top çš„è¾“å‡ºå¯ä»¥å¾—åˆ°å„ç§ CPU ä½¿ç”¨ç‡ä»¥åŠåƒµå°¸è¿›ç¨‹å’Œå¹³å‡è´Ÿè½½ç­‰ä¿¡æ¯.")]),s._v(" "),a("li",[s._v("ä» vmstat çš„è¾“å‡ºå¯ä»¥å¾—åˆ°ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°, ä¸­æ–­æ¬¡æ•°, è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹æ•°.")]),s._v(" "),a("li",[s._v("ä» pidstat çš„è¾“å‡ºå¯ä»¥å¾—åˆ°è¿›ç¨‹çš„ç”¨æˆ· CPU ä½¿ç”¨ç‡, ç³»ç»Ÿ CPU ä½¿ç”¨ç‡, ä»¥åŠè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ.")])]),s._v(" "),a("p",[s._v("å¦å¤–, è¿™ä¸‰ä¸ªå·¥å…·è¾“å‡ºçš„å¾ˆå¤šæŒ‡æ ‡æ˜¯ç›¸äº’å…³è”çš„, æ‰€ä»¥, æˆ‘ä¹Ÿç”¨è™šçº¿è¡¨ç¤ºäº†å®ƒä»¬çš„å…³è”å…³ç³», ä¸¾å‡ ä¸ªä¾‹å­ä½ å¯èƒ½ä¼šæ›´å®¹æ˜“ç†è§£.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ä¸ªä¾‹å­, pidstat è¾“å‡ºçš„è¿›ç¨‹ç”¨æˆ· CPU ä½¿ç”¨ç‡å‡é«˜, ä¼šå¯¼è‡´ top è¾“å‡ºçš„ç”¨æˆ· CPU ä½¿ç”¨ç‡å‡é«˜. æ‰€ä»¥, å½“å‘ç° top è¾“å‡ºçš„ç”¨æˆ· CPU ä½¿ç”¨ç‡æœ‰é—®é¢˜æ—¶, å¯ä»¥è·Ÿ pidstat çš„è¾“å‡ºåšå¯¹æ¯”, è§‚å¯Ÿæ˜¯å¦æ˜¯æŸä¸ªè¿›ç¨‹å¯¼è‡´çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("è€Œæ‰¾å‡ºå¯¼è‡´æ€§èƒ½é—®é¢˜çš„è¿›ç¨‹å, å°±è¦ç”¨è¿›ç¨‹åˆ†æå·¥å…·æ¥åˆ†æè¿›ç¨‹çš„è¡Œä¸º, æ¯”å¦‚ä½¿ç”¨ strace åˆ†æç³»ç»Ÿè°ƒç”¨æƒ…å†µ, ä»¥åŠä½¿ç”¨ perf åˆ†æè°ƒç”¨é“¾ä¸­å„çº§å‡½æ•°çš„æ‰§è¡Œæƒ…å†µ.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒä¸ªä¾‹å­, top è¾“å‡ºçš„å¹³å‡è´Ÿè½½å‡é«˜, å¯ä»¥è·Ÿ vmstat è¾“å‡ºçš„è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹æ•°åšå¯¹æ¯”, è§‚å¯Ÿæ˜¯å“ªç§è¿›ç¨‹å¯¼è‡´çš„è´Ÿè½½å‡é«˜.")]),s._v(" "),a("ul",[a("li",[s._v("å¦‚æœæ˜¯ä¸å¯ä¸­æ–­è¿›ç¨‹æ•°å¢å¤šäº†, é‚£ä¹ˆå°±éœ€è¦åš I/O çš„åˆ†æ, ä¹Ÿå°±æ˜¯ç”¨ dstat æˆ– sar ç­‰å·¥å…·, è¿›ä¸€æ­¥åˆ†æ I/O çš„æƒ…å†µ.")]),s._v(" "),a("li",[s._v("å¦‚æœæ˜¯è¿è¡ŒçŠ¶æ€è¿›ç¨‹æ•°å¢å¤šäº†, é‚£å°±éœ€è¦å›åˆ° top å’Œ pidstat, æ‰¾å‡ºè¿™äº›å¤„äºè¿è¡ŒçŠ¶æ€çš„åˆ°åº•æ˜¯ä»€ä¹ˆè¿›ç¨‹, ç„¶åå†ç”¨è¿›ç¨‹åˆ†æå·¥å…·, åšè¿›ä¸€æ­¥åˆ†æ.")])]),s._v(" "),a("p",[s._v("æœ€åä¸€ä¸ªä¾‹å­, å½“å‘ç° top è¾“å‡ºçš„è½¯ä¸­æ–­ CPU ä½¿ç”¨ç‡å‡é«˜æ—¶, å¯ä»¥æŸ¥çœ‹ /proc/softirqs æ–‡ä»¶ä¸­å„ç§ç±»å‹è½¯ä¸­æ–­çš„å˜åŒ–æƒ…å†µ, ç¡®å®šåˆ°åº•æ˜¯å“ªç§è½¯ä¸­æ–­å‡ºçš„é—®é¢˜. æ¯”å¦‚, å‘ç°æ˜¯ç½‘ç»œæ¥æ”¶ä¸­æ–­å¯¼è‡´çš„é—®é¢˜, é‚£å°±å¯ä»¥ç»§ç»­ç”¨ç½‘ç»œåˆ†æå·¥å…· sar å’Œ tcpdump æ¥åˆ†æ.")]),s._v(" "),a("p",[s._v("æ³¨æ„, æˆ‘åœ¨è¿™ä¸ªå›¾ä¸­åªåˆ—å‡ºäº†æœ€æ ¸å¿ƒçš„å‡ ä¸ªæ€§èƒ½å·¥å…·, å¹¶æ²¡æœ‰åˆ—å‡ºæ‰€æœ‰. è¿™ä¹ˆåš, ä¸€æ–¹é¢æ˜¯ä¸æƒ³ç”¨å¤§é‡çš„å·¥å…·åˆ—è¡¨å“åˆ°ä½ . åœ¨å­¦ä¹ ä¹‹åˆå°±æ¥è§¦æ‰€æœ‰æˆ–æ ¸å¿ƒæˆ–å°ä¼—çš„å·¥å…·, ä¸è§å¾—æ˜¯å¥½äº‹. å¦ä¸€æ–¹é¢, æ˜¯å¸Œæœ›ä½ èƒ½å…ˆæŠŠé‡å¿ƒæ”¾åœ¨æ ¸å¿ƒå·¥å…·ä¸Š, æ¯•ç«Ÿç†Ÿç»ƒæŒæ¡å®ƒä»¬, å°±å¯ä»¥è§£å†³å¤§å¤šæ•°é—®é¢˜.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ä½ å¯ä»¥ä¿å­˜ä¸‹è¿™å¼ å›¾, ä½œä¸º CPU æ€§èƒ½åˆ†æçš„æ€è·¯å›¾è°±. ä»æœ€æ ¸å¿ƒçš„è¿™å‡ ä¸ªå·¥å…·å¼€å§‹, é€šè¿‡æˆ‘æä¾›çš„é‚£äº›æ¡ˆä¾‹, è‡ªå·±åœ¨çœŸå®ç¯å¢ƒé‡Œå®è·µ, æ‹¿ä¸‹å®ƒä»¬.")]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“-3"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å›å¿†äº†å¸¸è§çš„ CPU æ€§èƒ½æŒ‡æ ‡, æ¢³ç†äº†å¸¸è§çš„ CPU æ€§èƒ½è§‚æµ‹å·¥å…·, æœ€åè¿˜æ€»ç»“äº†å¿«é€Ÿåˆ†æ CPU æ€§èƒ½é—®é¢˜çš„æ€è·¯.")]),s._v(" "),a("p",[s._v("è™½ç„¶ CPU çš„æ€§èƒ½æŒ‡æ ‡å¾ˆå¤š, ç›¸åº”çš„æ€§èƒ½åˆ†æå·¥å…·ä¹Ÿå¾ˆå¤š, ä½†ç†Ÿæ‚‰äº†å„ç§æŒ‡æ ‡çš„å«ä¹‰ä¹‹å, å°±ä¼šå‘ç°å®ƒä»¬å…¶å®éƒ½æœ‰ä¸€å®šçš„å…³è”. é¡ºç€è¿™ä¸ªæ€è·¯, æŒæ¡å¸¸ç”¨çš„åˆ†æå¥—è·¯å¹¶ä¸éš¾.")]),s._v(" "),a("h4",{attrs:{id:"_12-å¥—è·¯ç¯‡-cpuæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-å¥—è·¯ç¯‡-cpuæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯"}},[s._v("#")]),s._v(" 12-å¥—è·¯ç¯‡:CPUæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚ä¸€èµ·å›é¡¾äº†å¸¸è§çš„ CPU æ€§èƒ½æŒ‡æ ‡, æ¢³ç†äº†æ ¸å¿ƒçš„ CPU æ€§èƒ½è§‚æµ‹å·¥å…·, æœ€åè¿˜æ€»ç»“äº†å¿«é€Ÿåˆ†æ CPU æ€§èƒ½é—®é¢˜çš„æ€è·¯. è™½ç„¶ CPU çš„æ€§èƒ½æŒ‡æ ‡å¾ˆå¤š, ç›¸åº”çš„æ€§èƒ½åˆ†æå·¥å…·ä¹Ÿå¾ˆå¤š, ä½†ç†è§£äº†å„ç§æŒ‡æ ‡çš„å«ä¹‰å, ä½ å°±ä¼šå‘ç°å®ƒä»¬å…¶å®éƒ½æœ‰ä¸€å®šçš„å…³è”. é¡ºç€è¿™äº›å…³ç³»å¾€ä¸‹ç†è§£, å°±ä¼šå‘ç°, æŒæ¡è¿™äº›å¸¸ç”¨çš„ç“¶é¢ˆåˆ†æå¥—è·¯, å…¶å®å¹¶ä¸éš¾.")]),s._v(" "),a("p",[s._v("åœ¨æ‰¾åˆ° CPU çš„æ€§èƒ½ç“¶é¢ˆå, ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯ä¼˜åŒ–äº†, ä¹Ÿå°±æ˜¯æ‰¾å‡ºå……åˆ†åˆ©ç”¨ CPU çš„æ–¹æ³•, ä»¥ä¾¿å®Œæˆæ›´å¤šçš„å·¥ä½œ. æœ¬èŠ‚å°±æ¥è¯´è¯´, "),a("strong",[s._v("ä¼˜åŒ– CPU æ€§èƒ½é—®é¢˜çš„æ€è·¯å’Œæ³¨æ„äº‹é¡¹")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-æ€§èƒ½ä¼˜åŒ–æ–¹æ³•è®º"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ€§èƒ½ä¼˜åŒ–æ–¹æ³•è®º"}},[s._v("#")]),s._v(" 1.æ€§èƒ½ä¼˜åŒ–æ–¹æ³•è®º")]),s._v(" "),a("p",[s._v("åœ¨å†ç»åƒè¾›ä¸‡è‹¦, é€šè¿‡å„ç§æ€§èƒ½åˆ†ææ–¹æ³•, ç»ˆäºæ‰¾åˆ°å¼•å‘æ€§èƒ½é—®é¢˜çš„ç“¶é¢ˆå, æ˜¯ä¸æ˜¯ç«‹åˆ»å°±è¦å¼€å§‹ä¼˜åŒ–äº†å‘¢? åˆ«æ€¥, åŠ¨æ‰‹ä¹‹å‰, å¯ä»¥å…ˆçœ‹çœ‹ä¸‹é¢è¿™ä¸‰ä¸ªé—®é¢˜.")]),s._v(" "),a("ul",[a("li",[s._v("é¦–å…ˆ, "),a("strong",[s._v("æ—¢ç„¶è¦åšæ€§èƒ½ä¼˜åŒ–, é‚£è¦æ€ä¹ˆåˆ¤æ–­å®ƒæ˜¯ä¸æ˜¯æœ‰æ•ˆå‘¢? ç‰¹åˆ«æ˜¯ä¼˜åŒ–å, åˆ°åº•èƒ½æå‡å¤šå°‘æ€§èƒ½å‘¢")]),s._v("?")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, "),a("strong",[s._v("æ€§èƒ½é—®é¢˜é€šå¸¸ä¸æ˜¯ç‹¬ç«‹çš„, å¦‚æœæœ‰å¤šä¸ªæ€§èƒ½é—®é¢˜åŒæ—¶å‘ç”Ÿ, ä½ åº”è¯¥å…ˆä¼˜åŒ–å“ªä¸€ä¸ªå‘¢")]),s._v("?")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰, "),a("strong",[s._v("æå‡æ€§èƒ½çš„æ–¹æ³•å¹¶ä¸æ˜¯å”¯ä¸€çš„, å½“æœ‰å¤šç§æ–¹æ³•å¯ä»¥é€‰æ‹©æ—¶, ä¼šé€‰ç”¨å“ªä¸€ç§å‘¢? æ˜¯ä¸æ˜¯æ€»é€‰é‚£ä¸ªæœ€å¤§ç¨‹åº¦æå‡æ€§èƒ½çš„æ–¹æ³•å°±è¡Œäº†å‘¢")]),s._v("?")])]),s._v(" "),a("p",[s._v("å¦‚æœå¯ä»¥è½»æ¾å›ç­”è¿™ä¸‰ä¸ªé—®é¢˜, é‚£ä¹ˆäºŒè¯ä¸è¯´å°±å¯ä»¥å¼€å§‹ä¼˜åŒ–.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, åœ¨å‰é¢çš„ä¸å¯ä¸­æ–­è¿›ç¨‹æ¡ˆä¾‹ä¸­, é€šè¿‡æ€§èƒ½åˆ†æå‘ç°æ˜¯å› ä¸ºä¸€ä¸ªè¿›ç¨‹çš„"),a("strong",[s._v("ç›´æ¥ I/O")]),s._v(' , å¯¼è‡´äº† iowait é«˜è¾¾ 90%. é‚£æ˜¯ä¸æ˜¯ç”¨ "'),a("strong",[s._v("ç›´æ¥ I/O æ¢æˆç¼“å­˜ I/O")]),s._v('" çš„æ–¹æ³•, å°±å¯ä»¥ç«‹å³ä¼˜åŒ–äº†å‘¢?')]),s._v(" "),a("p",[s._v("æŒ‰ç…§ä¸Šé¢è®²çš„, å¯ä»¥å…ˆè‡ªå·±æ€è€ƒä¸‹é‚£ä¸‰ç‚¹. å¦‚æœä¸èƒ½ç¡®å®š, ä¸‹é¢ä¸€èµ·æ¥çœ‹çœ‹.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ä¸ªé—®é¢˜, ç›´æ¥ I/O æ¢æˆç¼“å­˜ I/O, å¯ä»¥æŠŠ iowait ä» 90% é™åˆ°æ¥è¿‘ 0, æ€§èƒ½æå‡å¾ˆæ˜æ˜¾.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒä¸ªé—®é¢˜, æ²¡æœ‰å‘ç°å…¶ä»–æ€§èƒ½é—®é¢˜, ç›´æ¥ I/O æ˜¯å”¯ä¸€çš„æ€§èƒ½ç“¶é¢ˆ, æ‰€ä»¥ä¸ç”¨æŒ‘é€‰ä¼˜åŒ–å¯¹è±¡.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰ä¸ªé—®é¢˜, ç¼“å­˜ I/O æ˜¯ç›®å‰ç”¨åˆ°çš„æœ€ç®€å•çš„ä¼˜åŒ–æ–¹æ³•, è€Œä¸”è¿™æ ·ä¼˜åŒ–å¹¶ä¸ä¼šå½±å“åº”ç”¨çš„åŠŸèƒ½.")])]),s._v(" "),a("p",[s._v("å¥½çš„, è¿™ä¸‰ä¸ªé—®é¢˜å¾ˆå®¹æ˜“å°±èƒ½å›ç­”, æ‰€ä»¥ç«‹å³ä¼˜åŒ–æ²¡æœ‰ä»»ä½•é—®é¢˜.")]),s._v(" "),a("p",[s._v("ä½†æ˜¯å¾ˆå¤šç°å®æƒ…å†µå¹¶ä¸åƒè¿™ä¸ªä¾‹å­é‚£ä¹ˆç®€å•. æ€§èƒ½è¯„ä¼°å¯èƒ½æœ‰å¤šé‡æŒ‡æ ‡, æ€§èƒ½é—®é¢˜å¯èƒ½ä¼šå¤šä¸ªåŒæ—¶å‘ç”Ÿ, è€Œä¸”, ä¼˜åŒ–æŸä¸€ä¸ªæŒ‡æ ‡çš„æ€§èƒ½, å¯èƒ½åˆå¯¼è‡´å…¶ä»–æŒ‡æ ‡æ€§èƒ½çš„ä¸‹é™. é‚£ä¹ˆ, é¢å¯¹è¿™ç§å¤æ‚çš„æƒ…å†µ, è¯¥æ€ä¹ˆåŠå‘¢?")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±æ¥æ·±å…¥åˆ†æè¿™ä¸‰ä¸ªé—®é¢˜.")]),s._v(" "),a("h6",{attrs:{id:"_1-æ€ä¹ˆè¯„ä¼°æ€§èƒ½ä¼˜åŒ–çš„æ•ˆæœ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ€ä¹ˆè¯„ä¼°æ€§èƒ½ä¼˜åŒ–çš„æ•ˆæœ"}},[s._v("#")]),s._v(" (1)æ€ä¹ˆè¯„ä¼°æ€§èƒ½ä¼˜åŒ–çš„æ•ˆæœ?")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜, æ€ä¹ˆè¯„ä¼°æ€§èƒ½ä¼˜åŒ–çš„æ•ˆæœ.")]),s._v(" "),a("p",[s._v("è§£å†³æ€§èƒ½é—®é¢˜çš„ç›®çš„, è‡ªç„¶æ˜¯æƒ³å¾—åˆ°ä¸€ä¸ªæ€§èƒ½æå‡çš„æ•ˆæœ. ä¸ºäº†è¯„ä¼°è¿™ä¸ªæ•ˆæœ, éœ€è¦"),a("strong",[s._v("å¯¹ç³»ç»Ÿçš„æ€§èƒ½æŒ‡æ ‡è¿›è¡Œé‡åŒ–, å¹¶ä¸”è¦åˆ†åˆ«æµ‹è¯•å‡ºä¼˜åŒ–å‰, åçš„æ€§èƒ½æŒ‡æ ‡, ç”¨å‰åæŒ‡æ ‡çš„å˜åŒ–æ¥å¯¹æ¯”å‘ˆç°æ•ˆæœ")]),s._v('. æˆ‘æŠŠè¿™ä¸ªæ–¹æ³•å«åšæ€§èƒ½è¯„ä¼° "ä¸‰æ­¥èµ°".')]),s._v(" "),a("ol",[a("li",[s._v("ç¡®å®šæ€§èƒ½çš„é‡åŒ–æŒ‡æ ‡.")]),s._v(" "),a("li",[s._v("æµ‹è¯•ä¼˜åŒ–å‰çš„æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("li",[s._v("æµ‹è¯•ä¼˜åŒ–åçš„æ€§èƒ½æŒ‡æ ‡.")])]),s._v(" "),a("p",[s._v("å…ˆçœ‹ç¬¬ä¸€æ­¥, æ€§èƒ½çš„é‡åŒ–æŒ‡æ ‡æœ‰å¾ˆå¤š, æ¯”å¦‚ CPU ä½¿ç”¨ç‡, åº”ç”¨ç¨‹åºçš„ååé‡, å®¢æˆ·ç«¯è¯·æ±‚çš„å»¶è¿Ÿç­‰, éƒ½å¯ä»¥è¯„ä¼°æ€§èƒ½. é‚£åº”è¯¥é€‰æ‹©ä»€ä¹ˆæŒ‡æ ‡æ¥è¯„ä¼°å‘¢?")]),s._v(" "),a("p",[s._v("å»ºè®®æ˜¯"),a("strong",[s._v("ä¸è¦å±€é™åœ¨å•ä¸€ç»´åº¦çš„æŒ‡æ ‡ä¸Š")]),s._v(", è‡³å°‘è¦ä»"),a("strong",[s._v("åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿèµ„æº")]),s._v("è¿™ä¸¤ä¸ªç»´åº¦, åˆ†åˆ«é€‰æ‹©ä¸åŒçš„æŒ‡æ ‡. æ¯”å¦‚, ä»¥ Web åº”ç”¨ä¸ºä¾‹:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("åº”ç”¨ç¨‹åº")]),s._v("çš„ç»´åº¦, å¯ä»¥ç”¨"),a("strong",[s._v("ååé‡å’Œè¯·æ±‚å»¶è¿Ÿ")]),s._v("æ¥è¯„ä¼°åº”ç”¨ç¨‹åºçš„æ€§èƒ½.")]),s._v(" "),a("li",[a("strong",[s._v("ç³»ç»Ÿèµ„æº")]),s._v("çš„ç»´åº¦, å¯ä»¥ç”¨ "),a("strong",[s._v("CPU ä½¿ç”¨ç‡")]),s._v("æ¥è¯„ä¼°ç³»ç»Ÿçš„ CPU ä½¿ç”¨æƒ…å†µ.")])]),s._v(" "),a("p",[s._v("ä¹‹æ‰€ä»¥ä»è¿™ä¸¤ä¸ªä¸åŒç»´åº¦é€‰æ‹©æŒ‡æ ‡, ä¸»è¦æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºå’Œç³»ç»Ÿèµ„æºè¿™ä¸¤è€…é—´ç›¸è¾…ç›¸æˆçš„å…³ç³».")]),s._v(" "),a("ul",[a("li",[s._v("å¥½çš„åº”ç”¨ç¨‹åºæ˜¯æ€§èƒ½ä¼˜åŒ–çš„æœ€ç»ˆç›®çš„å’Œç»“æœ, ç³»ç»Ÿä¼˜åŒ–æ€»æ˜¯ä¸ºåº”ç”¨ç¨‹åºæœåŠ¡çš„. æ‰€ä»¥, å¿…é¡»è¦ä½¿ç”¨åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡, æ¥è¯„ä¼°æ€§èƒ½ä¼˜åŒ–çš„æ•´ä½“æ•ˆæœ.")]),s._v(" "),a("li",[s._v("ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µæ˜¯å½±å“åº”ç”¨ç¨‹åºæ€§èƒ½çš„æ ¹æº. æ‰€ä»¥, éœ€è¦ç”¨ç³»ç»Ÿèµ„æºçš„æŒ‡æ ‡, æ¥è§‚å¯Ÿå’Œåˆ†æç“¶é¢ˆçš„æ¥æº.")])]),s._v(" "),a("p",[s._v("è‡³äºæ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ­¥éª¤, ä¸»è¦æ˜¯ä¸ºäº†å¯¹æ¯”ä¼˜åŒ–å‰åçš„æ€§èƒ½, æ›´ç›´è§‚åœ°å‘ˆç°æ•ˆæœ. å¦‚æœç¬¬ä¸€æ­¥, æ˜¯ä»ä¸¤ä¸ªä¸åŒç»´åº¦é€‰æ‹©äº†å¤šä¸ªæŒ‡æ ‡, é‚£ä¹ˆåœ¨æ€§èƒ½æµ‹è¯•æ—¶, å°±éœ€è¦è·å¾—è¿™äº›æŒ‡æ ‡çš„å…·ä½“æ•°å€¼.")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯ä»¥åˆšåˆšçš„ Web åº”ç”¨ä¸ºä¾‹, å¯¹åº”ä¸Šé¢æåˆ°çš„å‡ ä¸ªæŒ‡æ ‡, å¯ä»¥é€‰æ‹© ab ç­‰å·¥å…·, æµ‹è¯• Web åº”ç”¨çš„å¹¶å‘è¯·æ±‚æ•°å’Œå“åº”å»¶è¿Ÿ. è€Œæµ‹è¯•çš„åŒæ—¶, è¿˜å¯ä»¥ç”¨ vmstat, pidstat ç­‰æ€§èƒ½å·¥å…·, è§‚å¯Ÿç³»ç»Ÿå’Œè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡. è¿™æ ·å°±åŒæ—¶è·å¾—äº†åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿèµ„æºè¿™ä¸¤ä¸ªç»´åº¦çš„æŒ‡æ ‡æ•°å€¼.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, åœ¨è¿›è¡Œæ€§èƒ½æµ‹è¯•æ—¶, æœ‰ä¸¤ä¸ªç‰¹åˆ«é‡è¦çš„åœ°æ–¹éœ€è¦æ³¨æ„ä¸‹.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, "),a("strong",[s._v("è¦é¿å…æ€§èƒ½æµ‹è¯•å·¥å…·å¹²æ‰°åº”ç”¨ç¨‹åºçš„æ€§èƒ½")]),s._v(". é€šå¸¸, å¯¹ Web åº”ç”¨æ¥è¯´, æ€§èƒ½æµ‹è¯•å·¥å…·è·Ÿç›®æ ‡åº”ç”¨ç¨‹åºè¦åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œ. æ¯”å¦‚, åœ¨ä¹‹å‰çš„ Nginx æ¡ˆä¾‹ä¸­, æ¯æ¬¡éƒ½ä¼šå¼ºè°ƒè¦ç”¨ä¸¤å°è™šæ‹Ÿæœº, å…¶ä¸­ä¸€å°è¿è¡Œ Nginx æœåŠ¡, è€Œå¦ä¸€å°è¿è¡Œæ¨¡æ‹Ÿå®¢æˆ·ç«¯çš„å·¥å…·, å°±æ˜¯ä¸ºäº†é¿å…è¿™ä¸ªå½±å“.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, "),a("strong",[s._v("é¿å…å¤–éƒ¨ç¯å¢ƒçš„å˜åŒ–å½±å“æ€§èƒ½æŒ‡æ ‡çš„è¯„ä¼°")]),s._v(". è¿™è¦æ±‚ä¼˜åŒ–å‰, åçš„åº”ç”¨ç¨‹åº, éƒ½è¿è¡Œåœ¨ç›¸åŒé…ç½®çš„æœºå™¨ä¸Š, å¹¶ä¸”å®ƒä»¬çš„å¤–éƒ¨ä¾èµ–ä¹Ÿè¦å®Œå…¨ä¸€è‡´. æ¯”å¦‚è¿˜æ˜¯æ‹¿ Nginx æ¥è¯´, å°±å¯ä»¥è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Š, å¹¶ç”¨ç›¸åŒå‚æ•°çš„å®¢æˆ·ç«¯å·¥å…·æ¥è¿›è¡Œæ€§èƒ½æµ‹è¯•.")])]),s._v(" "),a("h6",{attrs:{id:"_2-å¤šä¸ªæ€§èƒ½é—®é¢˜åŒæ—¶å­˜åœ¨è¦æ€ä¹ˆé€‰æ‹©"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¤šä¸ªæ€§èƒ½é—®é¢˜åŒæ—¶å­˜åœ¨è¦æ€ä¹ˆé€‰æ‹©"}},[s._v("#")]),s._v(" (2)å¤šä¸ªæ€§èƒ½é—®é¢˜åŒæ—¶å­˜åœ¨è¦æ€ä¹ˆé€‰æ‹©?")]),s._v(" "),a("p",[s._v("å†æ¥çœ‹ç¬¬äºŒä¸ªé—®é¢˜, å¼€ç¯‡å°±è¯´è¿‡, ç³»ç»Ÿæ€§èƒ½æ€»æ˜¯ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«, æ‰€ä»¥æ€§èƒ½é—®é¢˜é€šå¸¸ä¹Ÿä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„. é‚£å½“å¤šä¸ªæ€§èƒ½é—®é¢˜åŒæ—¶å‘ç”Ÿçš„æ—¶å€™, åº”è¯¥å…ˆå»ä¼˜åŒ–å“ªä¸€ä¸ªå‘¢?")]),s._v(" "),a("p",[s._v('åœ¨æ€§èƒ½æµ‹è¯•çš„é¢†åŸŸ, æµä¼ å¾ˆå¹¿çš„ä¸€ä¸ªè¯´æ³•æ˜¯ "äºŒå…«åŸåˆ™", ä¹Ÿå°±æ˜¯è¯´ 80% çš„é—®é¢˜éƒ½æ˜¯ç”± 20% çš„ä»£ç å¯¼è‡´çš„. åªè¦æ‰¾å‡ºè¿™ 20% çš„ä½ç½®, å°±å¯ä»¥ä¼˜åŒ– 80% çš„æ€§èƒ½. æ‰€ä»¥, æˆ‘æƒ³è¡¨è¾¾çš„æ˜¯, '),a("strong",[s._v("å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ€§èƒ½é—®é¢˜éƒ½å€¼å¾—ä¼˜åŒ–")]),s._v(".")]),s._v(" "),a("p",[s._v("å»ºè®®æ˜¯, åŠ¨æ‰‹ä¼˜åŒ–ä¹‹å‰å…ˆåŠ¨è„‘, å…ˆæŠŠæ‰€æœ‰è¿™äº›æ€§èƒ½é—®é¢˜ç»™åˆ†æä¸€é, "),a("strong",[s._v("æ‰¾å‡ºæœ€é‡è¦çš„, å¯ä»¥æœ€å¤§ç¨‹åº¦æå‡æ€§èƒ½çš„é—®é¢˜")]),s._v(", ä»å®ƒå¼€å§‹ä¼˜åŒ–. è¿™æ ·çš„å¥½å¤„æ˜¯, ä¸ä»…æ€§èƒ½æå‡çš„æ”¶ç›Šæœ€å¤§, è€Œä¸”å¾ˆå¯èƒ½å…¶ä»–é—®é¢˜éƒ½ä¸ç”¨ä¼˜åŒ–, å°±å·²ç»æ»¡è¶³äº†æ€§èƒ½è¦æ±‚.")]),s._v(" "),a("p",[s._v("é‚£å…³é”®å°±åœ¨äº, æ€ä¹ˆåˆ¤æ–­å‡ºå“ªä¸ªæ€§èƒ½é—®é¢˜æœ€é‡è¦. è¿™å…¶å®è¿˜æ˜¯æ€§èƒ½åˆ†æè¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜, åªä¸è¿‡è¿™é‡Œè¦åˆ†æçš„å¯¹è±¡, ä»åŸæ¥çš„ä¸€ä¸ªé—®é¢˜, å˜æˆäº†å¤šä¸ªé—®é¢˜, æ€è·¯å…¶å®è¿˜æ˜¯ä¸€æ ·çš„.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ä¾ç„¶å¯ä»¥ç”¨å‰é¢è®²è¿‡çš„æ–¹æ³•æŒ¨ä¸ªåˆ†æ, åˆ†åˆ«æ‰¾å‡ºå®ƒä»¬çš„ç“¶é¢ˆ. åˆ†æå®Œæ‰€æœ‰é—®é¢˜å, å†æŒ‰ç…§å› æœç­‰å…³ç³», æ’é™¤æ‰æœ‰å› æœå…³è”çš„æ€§èƒ½é—®é¢˜. æœ€å, å†å¯¹å‰©ä¸‹çš„æ€§èƒ½é—®é¢˜è¿›è¡Œä¼˜åŒ–.")]),s._v(" "),a("p",[s._v("å¦‚æœå‰©ä¸‹çš„é—®é¢˜è¿˜æ˜¯å¥½å‡ ä¸ª, å°±å¾—åˆ†åˆ«è¿›è¡Œæ€§èƒ½æµ‹è¯•äº†. æ¯”è¾ƒä¸åŒçš„ä¼˜åŒ–æ•ˆæœå, é€‰æ‹©èƒ½æ˜æ˜¾æå‡æ€§èƒ½çš„é‚£ä¸ªé—®é¢˜è¿›è¡Œä¿®å¤. è¿™ä¸ªè¿‡ç¨‹é€šå¸¸ä¼šèŠ±è´¹è¾ƒå¤šçš„æ—¶é—´, è¿™é‡Œæ¨èä¸¤ä¸ªå¯ä»¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹çš„æ–¹æ³•.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, å¦‚æœå‘ç°æ˜¯ç³»ç»Ÿèµ„æºè¾¾åˆ°äº†ç“¶é¢ˆ, æ¯”å¦‚ CPU ä½¿ç”¨ç‡è¾¾åˆ°äº† 100%, é‚£ä¹ˆé¦–å…ˆä¼˜åŒ–çš„ä¸€å®šæ˜¯ç³»ç»Ÿèµ„æºä½¿ç”¨é—®é¢˜. å®Œæˆç³»ç»Ÿèµ„æºç“¶é¢ˆçš„ä¼˜åŒ–å, æ‰è¦è€ƒè™‘å…¶ä»–é—®é¢˜.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, é’ˆå¯¹ä¸åŒç±»å‹çš„æŒ‡æ ‡, é¦–å…ˆå»ä¼˜åŒ–é‚£äº›ç”±ç“¶é¢ˆå¯¼è‡´çš„, æ€§èƒ½æŒ‡æ ‡å˜åŒ–å¹…åº¦æœ€å¤§çš„é—®é¢˜. æ¯”å¦‚äº§ç”Ÿç“¶é¢ˆå, ç”¨æˆ· CPU ä½¿ç”¨ç‡å‡é«˜äº† 10%, è€Œç³»ç»Ÿ CPU ä½¿ç”¨ç‡å´å‡é«˜äº† 50%, è¿™ä¸ªæ—¶å€™å°±åº”è¯¥é¦–å…ˆä¼˜åŒ–ç³»ç»Ÿ CPU çš„ä½¿ç”¨.")])]),s._v(" "),a("h6",{attrs:{id:"_3-æœ‰å¤šç§ä¼˜åŒ–æ–¹æ³•æ—¶è¦å¦‚ä½•é€‰æ‹©"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æœ‰å¤šç§ä¼˜åŒ–æ–¹æ³•æ—¶è¦å¦‚ä½•é€‰æ‹©"}},[s._v("#")]),s._v(" (3)æœ‰å¤šç§ä¼˜åŒ–æ–¹æ³•æ—¶è¦å¦‚ä½•é€‰æ‹©?")]),s._v(" "),a("p",[s._v("æ¥ç€æ¥çœ‹ç¬¬ä¸‰ä¸ªé—®é¢˜, å½“å¤šç§æ–¹æ³•éƒ½å¯ç”¨æ—¶, åº”è¯¥é€‰æ‹©å“ªä¸€ç§å‘¢? æ˜¯ä¸æ˜¯æœ€å¤§æå‡æ€§èƒ½çš„æ–¹æ³•, ä¸€å®šæœ€å¥½å‘¢?")]),s._v(" "),a("p",[s._v("ä¸€èˆ¬æƒ…å†µä¸‹, å½“ç„¶æƒ³é€‰èƒ½æœ€å¤§æå‡æ€§èƒ½çš„æ–¹æ³•, è¿™å…¶å®ä¹Ÿæ˜¯æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡.")]),s._v(" "),a("p",[s._v("ä½†è¦æ³¨æ„, ç°å®æƒ…å†µè¦è€ƒè™‘çš„å› ç´ å´æ²¡é‚£ä¹ˆç®€å•. æœ€ç›´è§‚æ¥è¯´, "),a("strong",[s._v("æ€§èƒ½ä¼˜åŒ–å¹¶éæ²¡æœ‰æˆæœ¬")]),s._v(". æ€§èƒ½ä¼˜åŒ–é€šå¸¸ä¼šå¸¦æ¥å¤æ‚åº¦çš„æå‡, é™ä½ç¨‹åºçš„å¯ç»´æŠ¤æ€§, è¿˜å¯èƒ½åœ¨ä¼˜åŒ–ä¸€ä¸ªæŒ‡æ ‡æ—¶, å¼•å‘å…¶ä»–æŒ‡æ ‡çš„å¼‚å¸¸. ä¹Ÿå°±æ˜¯è¯´, å¾ˆå¯èƒ½ä¼˜åŒ–äº†ä¸€ä¸ªæŒ‡æ ‡, å¦ä¸€ä¸ªæŒ‡æ ‡çš„æ€§èƒ½å´å˜å·®äº†.")]),s._v(" "),a("p",[s._v("ä¸€ä¸ªå¾ˆå…¸å‹çš„ä¾‹å­æ˜¯å°†åœ¨ç½‘ç»œéƒ¨åˆ†è®²åˆ°çš„ "),a("strong",[s._v("DPDK")]),s._v("(Data Plane Development Kit). DPDK æ˜¯ä¸€ç§ä¼˜åŒ–ç½‘ç»œå¤„ç†é€Ÿåº¦çš„æ–¹æ³•, å®ƒé€šè¿‡ç»•å¼€å†…æ ¸ç½‘ç»œåè®®æ ˆçš„æ–¹æ³•, æå‡ç½‘ç»œçš„å¤„ç†èƒ½åŠ›. ä¸è¿‡å®ƒæœ‰ä¸€ä¸ªå¾ˆå…¸å‹çš„è¦æ±‚, å°±æ˜¯è¦ç‹¬å ä¸€ä¸ª CPU ä»¥åŠä¸€å®šæ•°é‡çš„å†…å­˜å¤§é¡µ, å¹¶ä¸”æ€»æ˜¯ä»¥ 100% çš„ CPU ä½¿ç”¨ç‡è¿è¡Œ. æ‰€ä»¥å¦‚æœ CPU æ ¸æ•°å¾ˆå°‘, å°±æœ‰ç‚¹å¾—ä¸å¿å¤±äº†.")]),s._v(" "),a("p",[s._v('æ‰€ä»¥, åœ¨è€ƒè™‘é€‰å“ªä¸ªæ€§èƒ½ä¼˜åŒ–æ–¹æ³•æ—¶, è¦ç»¼åˆå¤šæ–¹é¢çš„å› ç´ . åˆ‡è®°, ä¸è¦æƒ³ç€ "ä¸€æ­¥ç™»å¤©", è¯•å›¾ä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰é—®é¢˜; ä¹Ÿä¸è¦åªä¼š "æ‹¿æ¥ä¸»ä¹‰", æŠŠå…¶ä»–åº”ç”¨çš„ä¼˜åŒ–æ–¹æ³•åŸå°ä¸åŠ¨æ‹¿æ¥ç”¨, å´ä¸ç»è¿‡ä»»ä½•æ€è€ƒå’Œåˆ†æ.')]),s._v(" "),a("h5",{attrs:{id:"_2-cpuä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-cpuä¼˜åŒ–"}},[s._v("#")]),s._v(" 2.CPUä¼˜åŒ–")]),s._v(" "),a("p",[s._v("æ¸…æ¥šäº†æ€§èƒ½ä¼˜åŒ–æœ€åŸºæœ¬çš„ä¸‰ä¸ªé—®é¢˜å, æ¥ä¸‹æ¥ä»"),a("strong",[s._v("åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿ")]),s._v("çš„è§’åº¦, åˆ†åˆ«æ¥çœ‹çœ‹"),a("strong",[s._v("å¦‚ä½•æ‰èƒ½é™ä½ CPU ä½¿ç”¨ç‡, æé«˜ CPU çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›")]),s._v(".")]),s._v(" "),a("h6",{attrs:{id:"_1-åº”ç”¨ç¨‹åºä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-åº”ç”¨ç¨‹åºä¼˜åŒ–"}},[s._v("#")]),s._v(" (1)åº”ç”¨ç¨‹åºä¼˜åŒ–")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, ä»åº”ç”¨ç¨‹åºçš„è§’åº¦æ¥è¯´, é™ä½ CPU ä½¿ç”¨ç‡çš„æœ€å¥½æ–¹æ³•å½“ç„¶æ˜¯, æ’é™¤æ‰€æœ‰ä¸å¿…è¦çš„å·¥ä½œ, åªä¿ç•™æœ€æ ¸å¿ƒçš„é€»è¾‘. æ¯”å¦‚å‡å°‘å¾ªç¯çš„å±‚æ¬¡, å‡å°‘é€’å½’, å‡å°‘åŠ¨æ€å†…å­˜åˆ†é…ç­‰ç­‰.")]),s._v(" "),a("p",[s._v("é™¤æ­¤ä¹‹å¤–, åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¼˜åŒ–ä¹ŸåŒ…æ‹¬å¾ˆå¤šç§æ–¹æ³•, è¿™é‡Œåˆ—å‡ºäº†æœ€å¸¸è§çš„å‡ ç§, ä½ å¯ä»¥è®°ä¸‹æ¥.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç¼–è¯‘å™¨ä¼˜åŒ–")]),s._v(": å¾ˆå¤šç¼–è¯‘å™¨éƒ½ä¼šæä¾›ä¼˜åŒ–é€‰é¡¹, é€‚å½“å¼€å¯å®ƒä»¬, åœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ä»¥è·å¾—ç¼–è¯‘å™¨çš„å¸®åŠ©, æ¥æå‡æ€§èƒ½. æ¯”å¦‚, gcc å°±æä¾›äº†ä¼˜åŒ–é€‰é¡¹ -O2, å¼€å¯åä¼šè‡ªåŠ¨å¯¹åº”ç”¨ç¨‹åºçš„ä»£ç è¿›è¡Œä¼˜åŒ–.")]),s._v(" "),a("li",[a("strong",[s._v("ç®—æ³•ä¼˜åŒ–")]),s._v(": ä½¿ç”¨å¤æ‚åº¦æ›´ä½çš„ç®—æ³•, å¯ä»¥æ˜¾è‘—åŠ å¿«å¤„ç†é€Ÿåº¦. æ¯”å¦‚, åœ¨æ•°æ®æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹, å¯ä»¥ç”¨ O(nlogn) çš„æ’åºç®—æ³•(å¦‚å¿«æ’, å½’å¹¶æ’åºç­‰), ä»£æ›¿ O(n^2) çš„æ’åºç®—æ³•(å¦‚å†’æ³¡, æ’å…¥æ’åºç­‰).")]),s._v(" "),a("li",[a("strong",[s._v("å¼‚æ­¥å¤„ç†")]),s._v(": ä½¿ç”¨å¼‚æ­¥å¤„ç†, å¯ä»¥é¿å…ç¨‹åºå› ä¸ºç­‰å¾…æŸä¸ªèµ„æºè€Œä¸€ç›´é˜»å¡, ä»è€Œæå‡ç¨‹åºçš„å¹¶å‘å¤„ç†èƒ½åŠ›. æ¯”å¦‚, æŠŠè½®è¯¢æ›¿æ¢ä¸ºäº‹ä»¶é€šçŸ¥, å°±å¯ä»¥é¿å…è½®è¯¢è€—è´¹ CPU çš„é—®é¢˜.")]),s._v(" "),a("li",[a("strong",[s._v("å¤šçº¿ç¨‹ä»£æ›¿å¤šè¿›ç¨‹")]),s._v(": å‰é¢è®²è¿‡, ç›¸å¯¹äºè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢, çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¹¶ä¸åˆ‡æ¢è¿›ç¨‹åœ°å€ç©ºé—´, å› æ­¤å¯ä»¥é™ä½ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬.")]),s._v(" "),a("li",[a("strong",[s._v("å–„ç”¨ç¼“å­˜")]),s._v(": ç»å¸¸è®¿é—®çš„æ•°æ®æˆ–è€…è®¡ç®—è¿‡ç¨‹ä¸­çš„æ­¥éª¤, å¯ä»¥æ”¾åˆ°å†…å­˜ä¸­ç¼“å­˜èµ·æ¥, è¿™æ ·åœ¨ä¸‹æ¬¡ç”¨æ—¶å°±èƒ½ç›´æ¥ä»å†…å­˜ä¸­è·å–, åŠ å¿«ç¨‹åºçš„å¤„ç†é€Ÿåº¦.")])]),s._v(" "),a("h6",{attrs:{id:"_2-ç³»ç»Ÿä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç³»ç»Ÿä¼˜åŒ–"}},[s._v("#")]),s._v(" (2)ç³»ç»Ÿä¼˜åŒ–")]),s._v(" "),a("p",[s._v("ä»ç³»ç»Ÿçš„è§’åº¦æ¥è¯´, ä¼˜åŒ– CPU çš„è¿è¡Œ, ä¸€æ–¹é¢è¦"),a("strong",[s._v("å……åˆ†åˆ©ç”¨ CPU ç¼“å­˜çš„æœ¬åœ°æ€§")]),s._v(", åŠ é€Ÿç¼“å­˜è®¿é—®; å¦ä¸€æ–¹é¢, å°±æ˜¯è¦"),a("strong",[s._v("æ§åˆ¶è¿›ç¨‹çš„ CPU ä½¿ç”¨æƒ…å†µ, å‡å°‘è¿›ç¨‹é—´çš„ç›¸äº’å½±å“")]),s._v(".")]),s._v(" "),a("p",[s._v("å…·ä½“æ¥è¯´, ç³»ç»Ÿå±‚é¢çš„ CPU ä¼˜åŒ–æ–¹æ³•ä¹Ÿæœ‰ä¸å°‘, è¿™é‡ŒåŒæ ·åˆ—ä¸¾äº†æœ€å¸¸è§çš„ä¸€äº›æ–¹æ³•, æ–¹ä¾¿ä½ è®°å¿†å’Œä½¿ç”¨.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("CPU ç»‘å®š")]),s._v(": æŠŠè¿›ç¨‹ç»‘å®šåˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ª CPU ä¸Š, å¯ä»¥æé«˜ CPU ç¼“å­˜çš„å‘½ä¸­ç‡, å‡å°‘è·¨ CPU è°ƒåº¦å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜.")]),s._v(" "),a("li",[a("strong",[s._v("CPU ç‹¬å ")]),s._v(": è·Ÿ CPU ç»‘å®šç±»ä¼¼, è¿›ä¸€æ­¥å°† CPU åˆ†ç»„, å¹¶é€šè¿‡ CPU "),a("strong",[s._v("äº²å’Œæ€§")]),s._v("æœºåˆ¶ä¸ºå…¶åˆ†é…è¿›ç¨‹. è¿™æ ·, è¿™äº› CPU å°±ç”±æŒ‡å®šçš„è¿›ç¨‹ç‹¬å , æ¢å¥è¯è¯´, ä¸å…è®¸å…¶ä»–è¿›ç¨‹å†æ¥ä½¿ç”¨è¿™äº› CPU.")]),s._v(" "),a("li",[a("strong",[s._v("ä¼˜å…ˆçº§è°ƒæ•´")]),s._v(": ä½¿ç”¨ nice è°ƒæ•´è¿›ç¨‹çš„ä¼˜å…ˆçº§, æ­£å€¼è°ƒä½ä¼˜å…ˆçº§, è´Ÿå€¼è°ƒé«˜ä¼˜å…ˆçº§. åœ¨è¿™é‡Œ, é€‚å½“é™ä½éæ ¸å¿ƒåº”ç”¨çš„ä¼˜å…ˆçº§, "),a("strong",[s._v("å¢é«˜æ ¸å¿ƒåº”ç”¨çš„ä¼˜å…ˆçº§")]),s._v(", å¯ä»¥ç¡®ä¿æ ¸å¿ƒåº”ç”¨å¾—åˆ°ä¼˜å…ˆå¤„ç†.")]),s._v(" "),a("li",[a("strong",[s._v("ä¸ºè¿›ç¨‹è®¾ç½®èµ„æºé™åˆ¶")]),s._v(": ä½¿ç”¨ Linux cgroups æ¥"),a("strong",[s._v("è®¾ç½®è¿›ç¨‹çš„ CPU ä½¿ç”¨ä¸Šé™")]),s._v(", å¯ä»¥é˜²æ­¢ç”±äºæŸä¸ªåº”ç”¨è‡ªèº«çš„é—®é¢˜, è€Œè€—å°½ç³»ç»Ÿèµ„æº.")]),s._v(" "),a("li",[a("strong",[s._v("NUMA(Non-Uniform Memory Access)ä¼˜åŒ–")]),s._v(": æ”¯æŒ NUMA çš„å¤„ç†å™¨ä¼šè¢«åˆ’åˆ†ä¸ºå¤šä¸ª node, æ¯ä¸ª node éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ç©ºé—´. NUMA ä¼˜åŒ–, å…¶å®å°±æ˜¯è®© CPU å°½å¯èƒ½åªè®¿é—®æœ¬åœ°å†…å­˜.")]),s._v(" "),a("li",[a("strong",[s._v("ä¸­æ–­è´Ÿè½½å‡è¡¡")]),s._v(": æ— è®ºæ˜¯è½¯ä¸­æ–­è¿˜æ˜¯ç¡¬ä¸­æ–­, å®ƒä»¬çš„ä¸­æ–­å¤„ç†ç¨‹åºéƒ½å¯èƒ½ä¼šè€—è´¹å¤§é‡çš„ CPU. å¼€å¯ irqbalance æœåŠ¡æˆ–è€…é…ç½® smp_affinity, å°±å¯ä»¥"),a("strong",[s._v("æŠŠä¸­æ–­å¤„ç†è¿‡ç¨‹è‡ªåŠ¨è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ª CPU ä¸Š")]),s._v(".")])]),s._v(" "),a("h5",{attrs:{id:"_3-åƒä¸‡é¿å…è¿‡æ—©ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-åƒä¸‡é¿å…è¿‡æ—©ä¼˜åŒ–"}},[s._v("#")]),s._v(" 3.åƒä¸‡é¿å…è¿‡æ—©ä¼˜åŒ–")]),s._v(" "),a("p",[s._v('æŒæ¡ä¸Šé¢è¿™äº›ä¼˜åŒ–æ–¹æ³•å, æˆ‘ä¼°è®¡, å¾ˆå¤šäººå³ä½¿æ²¡å‘ç°æ€§èƒ½ç“¶é¢ˆ, ä¹Ÿä¼šå¿ä¸ä½æŠŠå„ç§å„æ ·çš„ä¼˜åŒ–æ–¹æ³•å¸¦åˆ°å®é™…çš„å¼€å‘ä¸­. ä¸è¿‡æœ‰å¥åè¨€, "'),a("strong",[s._v("è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº")]),s._v('", æˆ‘ä¹Ÿéå¸¸èµåŒè¿™ä¸€ç‚¹, è¿‡æ—©ä¼˜åŒ–ä¸å¯å–.')]),s._v(" "),a("p",[s._v("å› ä¸º, ä¸€æ–¹é¢, ä¼˜åŒ–ä¼šå¸¦æ¥å¤æ‚æ€§çš„æå‡, é™ä½å¯ç»´æŠ¤æ€§; å¦ä¸€æ–¹é¢, éœ€æ±‚ä¸æ˜¯ä¸€æˆä¸å˜çš„. é’ˆå¯¹å½“å‰æƒ…å†µè¿›è¡Œçš„ä¼˜åŒ–, å¾ˆå¯èƒ½å¹¶ä¸é€‚åº”å¿«é€Ÿå˜åŒ–çš„æ–°éœ€æ±‚. è¿™æ ·, åœ¨æ–°éœ€æ±‚å‡ºç°æ—¶, è¿™äº›å¤æ‚çš„ä¼˜åŒ–, åè€Œå¯èƒ½é˜»ç¢æ–°åŠŸèƒ½çš„å¼€å‘.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, æ€§èƒ½ä¼˜åŒ–æœ€å¥½æ˜¯é€æ­¥å®Œå–„, åŠ¨æ€è¿›è¡Œ, ä¸è¿½æ±‚ä¸€æ­¥åˆ°ä½, è€Œè¦é¦–å…ˆä¿è¯èƒ½æ»¡è¶³å½“å‰çš„æ€§èƒ½è¦æ±‚. å½“å‘ç°æ€§èƒ½ä¸æ»¡è¶³è¦æ±‚æˆ–è€…å‡ºç°æ€§èƒ½ç“¶é¢ˆæ—¶, å†æ ¹æ®æ€§èƒ½è¯„ä¼°çš„ç»“æœ, é€‰æ‹©æœ€é‡è¦çš„æ€§èƒ½é—®é¢˜è¿›è¡Œä¼˜åŒ–.")]),s._v(" "),a("h5",{attrs:{id:"_4-æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ€»ç»“"}},[s._v("#")]),s._v(" 4.æ€»ç»“")]),s._v(" "),a("p",[s._v('æœ¬èŠ‚æ¢³ç†äº†å¸¸è§çš„ CPU æ€§èƒ½ä¼˜åŒ–æ€è·¯å’Œä¼˜åŒ–æ–¹æ³•. å‘ç°æ€§èƒ½é—®é¢˜å, ä¸è¦æ€¥äºåŠ¨æ‰‹ä¼˜åŒ–, è€Œè¦å…ˆæ‰¾å‡ºæœ€é‡è¦çš„, å¯ä»¥è·å¾—æœ€å¤§æ€§èƒ½æå‡çš„é—®é¢˜, ç„¶åå†ä»åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿä¸¤ä¸ªæ–¹é¢å…¥æ‰‹ä¼˜åŒ–. è¿™æ ·ä¸ä»…å¯ä»¥è·å¾—æœ€å¤§çš„æ€§èƒ½æå‡, è€Œä¸”å¾ˆå¯èƒ½ä¸éœ€è¦ä¼˜åŒ–å…¶ä»–é—®é¢˜, å°±å·²ç»æ»¡è¶³äº†æ€§èƒ½è¦æ±‚. ä½†æ˜¯è®°ä½, ä¸€å®šè¦å¿ä½"æŠŠ CPU æ€§èƒ½ä¼˜åŒ–åˆ°æè‡´"çš„å†²åŠ¨, å› ä¸º CPU å¹¶ä¸æ˜¯å”¯ä¸€çš„æ€§èƒ½å› ç´ . åç»­è¿˜ä¼šä»‹ç»æ›´å¤šçš„æ€§èƒ½é—®é¢˜, æ¯”å¦‚å†…å­˜, ç½‘ç»œ, I/O ç”šè‡³æ˜¯æ¶æ„è®¾è®¡çš„é—®é¢˜. å¦‚æœä¸åšå…¨æ–¹ä½çš„åˆ†æå’Œæµ‹è¯•, åªæ˜¯å•çº¯åœ°æŠŠæŸä¸ªæŒ‡æ ‡æå‡åˆ°æè‡´, å¹¶ä¸ä¸€å®šèƒ½å¸¦æ¥æ•´ä½“çš„æ”¶ç›Š.')]),s._v(" "),a("h3",{attrs:{id:"å†…å­˜æ€§èƒ½ç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜æ€§èƒ½ç¯‡"}},[s._v("#")]),s._v(" å†…å­˜æ€§èƒ½ç¯‡")]),s._v(" "),a("h4",{attrs:{id:"_15-åŸºç¡€ç¯‡-linuxå†…å­˜æ˜¯æ€ä¹ˆå·¥ä½œçš„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-åŸºç¡€ç¯‡-linuxå†…å­˜æ˜¯æ€ä¹ˆå·¥ä½œçš„"}},[s._v("#")]),s._v(" 15-åŸºç¡€ç¯‡:Linuxå†…å­˜æ˜¯æ€ä¹ˆå·¥ä½œçš„?")]),s._v(" "),a("p",[s._v("å‰å‡ èŠ‚ä¸€èµ·å­¦ä¹ äº† CPU çš„æ€§èƒ½åŸç†å’Œä¼˜åŒ–æ–¹æ³•, æ¥ä¸‹æ¥å°†è¿›å…¥å¦ä¸€ä¸ªæ¿å—â€”â€”å†…å­˜.")]),s._v(" "),a("p",[s._v("åŒ CPU ç®¡ç†ä¸€æ ·, å†…å­˜ç®¡ç†ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿæœ€æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€. "),a("strong",[s._v("å†…å­˜ä¸»è¦ç”¨æ¥å­˜å‚¨ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„æŒ‡ä»¤, æ•°æ®, ç¼“å­˜ç­‰")]),s._v(". é‚£ä¹ˆ, Linux åˆ°åº•æ˜¯æ€ä¹ˆç®¡ç†å†…å­˜çš„å‘¢?")]),s._v(" "),a("h5",{attrs:{id:"_1-å†…å­˜æ˜ å°„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å†…å­˜æ˜ å°„"}},[s._v("#")]),s._v(" 1.å†…å­˜æ˜ å°„")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„æœºå™¨çš„å†…å­˜å®¹é‡, å…¶å®æŒ‡çš„æ˜¯"),a("strong",[s._v("ç‰©ç†å†…å­˜")]),s._v(". ç‰©ç†å†…å­˜ä¹Ÿç§°ä¸ºä¸»å­˜, å¤§å¤šæ•°è®¡ç®—æœºç”¨çš„ä¸»å­˜éƒ½æ˜¯åŠ¨æ€éšæœºè®¿é—®å†…å­˜(DRAM). åªæœ‰å†…æ ¸æ‰å¯ä»¥ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜. é‚£ä¹ˆ, è¿›ç¨‹è¦è®¿é—®å†…å­˜æ—¶, è¯¥æ€ä¹ˆåŠå‘¢?")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("Linux å†…æ ¸ç»™æ¯ä¸ªè¿›ç¨‹éƒ½æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´, å¹¶ä¸”è¿™ä¸ªåœ°å€ç©ºé—´æ˜¯è¿ç»­çš„. è¿™æ ·, è¿›ç¨‹å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®¿é—®å†…å­˜, æ›´ç¡®åˆ‡åœ°è¯´æ˜¯è®¿é—®è™šæ‹Ÿå†…å­˜")])]),s._v(".")]),s._v(" "),a("p",[s._v("è™šæ‹Ÿåœ°å€ç©ºé—´çš„å†…éƒ¨åˆè¢«åˆ†ä¸º"),a("mark",[a("strong",[s._v("å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´")])]),s._v("ä¸¤éƒ¨åˆ†, ä¸åŒå­—é•¿(ä¹Ÿå°±æ˜¯å•ä¸ª CPU æŒ‡ä»¤å¯ä»¥å¤„ç†æ•°æ®çš„æœ€å¤§é•¿åº¦)çš„å¤„ç†å™¨, åœ°å€ç©ºé—´çš„èŒƒå›´ä¹Ÿä¸åŒ. æ¯”å¦‚æœ€å¸¸è§çš„ 32 ä½å’Œ 64 ä½ç³»ç»Ÿ, ä¸‹é¢ç”»äº†ä¸¤å¼ å›¾æ¥åˆ†åˆ«è¡¨ç¤ºå®ƒä»¬çš„è™šæ‹Ÿåœ°å€ç©ºé—´, å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/3ff199022783c56041eba24df9ea8044-20230731161933-tgj4u9e.png",alt:""}})]),s._v(" "),a("p",[s._v("é€šè¿‡è¿™é‡Œå¯ä»¥çœ‹å‡º, 32 ä½ç³»ç»Ÿçš„å†…æ ¸ç©ºé—´å ç”¨ 1G, ä½äºæœ€é«˜å¤„, å‰©ä¸‹çš„ 3G æ˜¯ç”¨æˆ·ç©ºé—´. è€Œ 64 ä½ç³»ç»Ÿçš„å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´éƒ½æ˜¯ 128T, åˆ†åˆ«å æ®æ•´ä¸ªå†…å­˜ç©ºé—´çš„æœ€é«˜å’Œæœ€ä½å¤„, å‰©ä¸‹çš„ä¸­é—´éƒ¨åˆ†æ˜¯æœªå®šä¹‰çš„.")]),s._v(" "),a("p",[s._v("è¿˜è®°å¾—è¿›ç¨‹çš„ç”¨æˆ·æ€å’Œå†…æ ¸æ€å—? "),a("strong",[s._v("è¿›ç¨‹åœ¨ç”¨æˆ·æ€æ—¶, åªèƒ½è®¿é—®ç”¨æˆ·ç©ºé—´å†…å­˜; åªæœ‰è¿›å…¥å†…æ ¸æ€å, æ‰å¯ä»¥è®¿é—®å†…æ ¸ç©ºé—´å†…å­˜")]),s._v(". è™½ç„¶æ¯ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´éƒ½åŒ…å«äº†å†…æ ¸ç©ºé—´, ä½†è¿™äº›å†…æ ¸ç©ºé—´, å…¶å®å…³è”çš„éƒ½æ˜¯ç›¸åŒçš„ç‰©ç†å†…å­˜. è¿™æ ·, è¿›ç¨‹åˆ‡æ¢åˆ°å†…æ ¸æ€å, å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®¿é—®å†…æ ¸ç©ºé—´å†…å­˜.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶"),a("strong",[s._v("æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè¿™ä¹ˆå¤§çš„åœ°å€ç©ºé—´, é‚£ä¹ˆæ‰€æœ‰è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åŠ èµ·æ¥, è‡ªç„¶è¦æ¯”å®é™…çš„ç‰©ç†å†…å­˜å¤§å¾—å¤š")]),s._v(". æ‰€ä»¥, "),a("strong",[s._v("å¹¶ä¸æ˜¯æ‰€æœ‰çš„è™šæ‹Ÿå†…å­˜éƒ½ä¼šåˆ†é…ç‰©ç†å†…å­˜, åªæœ‰é‚£äº›å®é™…ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ‰åˆ†é…ç‰©ç†å†…å­˜, å¹¶ä¸”åˆ†é…åçš„ç‰©ç†å†…å­˜")]),s._v(", æ˜¯é€šè¿‡"),a("mark",[a("strong",[s._v("å†…å­˜æ˜ å°„")])]),s._v("æ¥ç®¡ç†çš„.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("å†…å­˜æ˜ å°„, å…¶å®å°±æ˜¯å°†è™šæ‹Ÿå†…å­˜åœ°å€æ˜ å°„åˆ°ç‰©ç†å†…å­˜åœ°å€. ä¸ºäº†å®Œæˆå†…å­˜æ˜ å°„, å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤äº†ä¸€å¼ é¡µè¡¨, è®°å½•è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»")])]),s._v(", å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/b9a42cf0c0121bec352f92572253285c-20230731161933-2cicorc.png",alt:""}})]),s._v(" "),a("p",[s._v("é¡µè¡¨å®é™…ä¸Šå­˜å‚¨åœ¨ CPU çš„å†…å­˜ç®¡ç†å•å…ƒ MMU ä¸­, è¿™æ ·æ­£å¸¸æƒ…å†µä¸‹, å¤„ç†å™¨å°±å¯ä»¥"),a("strong",[s._v("ç›´æ¥é€šè¿‡ç¡¬ä»¶, æ‰¾å‡ºè¦è®¿é—®çš„å†…å­˜")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("è€Œå½“è¿›ç¨‹è®¿é—®çš„è™šæ‹Ÿåœ°å€åœ¨é¡µè¡¨ä¸­æŸ¥ä¸åˆ°æ—¶, ç³»ç»Ÿä¼šäº§ç”Ÿä¸€ä¸ª")]),s._v("â€‹"),a("mark",[a("strong",[s._v("ç¼ºé¡µå¼‚å¸¸")])]),s._v("â€‹ "),a("strong",[s._v(", è¿›å…¥å†…æ ¸ç©ºé—´åˆ†é…ç‰©ç†å†…å­˜, æ›´æ–°è¿›ç¨‹é¡µè¡¨, æœ€åå†è¿”å›ç”¨æˆ·ç©ºé—´, æ¢å¤è¿›ç¨‹çš„è¿è¡Œ.")])]),s._v(" "),a("p",[s._v("å¦å¤–, å‰é¢åœ¨ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢çš„éƒ¨åˆ†æ›¾ç»æåˆ°, TLB(Translation Lookaside Buffer, è½¬è¯‘åå¤‡ç¼“å†²å™¨)ä¼šå½±å“ CPU çš„å†…å­˜è®¿é—®æ€§èƒ½, åœ¨è¿™é‡Œå…¶å®å°±å¯ä»¥å¾—åˆ°è§£é‡Š. "),a("strong",[s._v("TLB å…¶å®å°±æ˜¯ MMU ä¸­é¡µè¡¨çš„é«˜é€Ÿç¼“å­˜")]),s._v(". ç”±äºè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯ç‹¬ç«‹çš„, è€Œ TLB çš„è®¿é—®é€Ÿåº¦åˆæ¯” MMU å¿«å¾—å¤š, æ‰€ä»¥é€šè¿‡å‡å°‘è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢, å‡å°‘ TLB çš„åˆ·æ–°æ¬¡æ•°, å°±å¯ä»¥æé«˜ TLB ç¼“å­˜çš„ä½¿ç”¨ç‡, è¿›è€Œæé«˜ CPU çš„å†…å­˜è®¿é—®æ€§èƒ½.")]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, "),a("strong",[s._v("MMU å¹¶ä¸ä»¥å­—èŠ‚ä¸ºå•ä½æ¥ç®¡ç†å†…å­˜, è€Œæ˜¯")]),s._v("â€‹"),a("mark",[a("strong",[s._v("è§„å®šäº†ä¸€ä¸ªå†…å­˜æ˜ å°„çš„æœ€å°å•ä½, ä¹Ÿå°±æ˜¯é¡µ")])]),s._v("â€‹ "),a("strong",[s._v(", é€šå¸¸æ˜¯ 4 KB å¤§å°. è¿™æ ·, æ¯ä¸€æ¬¡å†…å­˜æ˜ å°„, éƒ½éœ€è¦å…³è” 4 KB æˆ–è€… 4KB æ•´æ•°å€çš„å†…å­˜ç©ºé—´")]),s._v(".")]),s._v(" "),a("p",[s._v("é¡µçš„å¤§å°åªæœ‰ 4 KB, å¯¼è‡´çš„å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯, "),a("strong",[s._v("æ•´ä¸ªé¡µè¡¨ä¼šå˜å¾—éå¸¸å¤§")]),s._v(". æ¯”æ–¹è¯´, ä»… 32 ä½ç³»ç»Ÿå°±éœ€è¦ 100 å¤šä¸‡ä¸ªé¡µè¡¨é¡¹(4GB/4KB), æ‰å¯ä»¥å®ç°æ•´ä¸ªåœ°å€ç©ºé—´çš„æ˜ å°„. ä¸ºäº†è§£å†³é¡µè¡¨é¡¹è¿‡å¤šçš„é—®é¢˜, Linux æä¾›äº†ä¸¤ç§æœºåˆ¶, ä¹Ÿå°±æ˜¯"),a("mark",[a("strong",[s._v("å¤šçº§é¡µè¡¨å’Œå¤§é¡µ")])]),s._v("(HugePage).")]),s._v(" "),a("p",[s._v("å¤šçº§é¡µè¡¨å°±æ˜¯æŠŠå†…å­˜åˆ†æˆåŒºå—æ¥ç®¡ç†, å°†åŸæ¥çš„æ˜ å°„å…³ç³»æ”¹æˆåŒºå—ç´¢å¼•å’ŒåŒºå—å†…çš„åç§». ç”±äºè™šæ‹Ÿå†…å­˜ç©ºé—´é€šå¸¸åªç”¨äº†å¾ˆå°‘ä¸€éƒ¨åˆ†, é‚£ä¹ˆå¤šçº§é¡µè¡¨å°±åªä¿å­˜è¿™äº›ä½¿ç”¨ä¸­çš„åŒºå—, è¿™æ ·å°±å¯ä»¥å¤§å¤§åœ°å‡å°‘é¡µè¡¨çš„é¡¹æ•°.")]),s._v(" "),a("p",[s._v("Linux ç”¨çš„æ­£æ˜¯"),a("mark",[a("strong",[s._v("å››çº§é¡µè¡¨")])]),s._v("æ¥ç®¡ç†å†…å­˜é¡µ, å¦‚ä¸‹å›¾æ‰€ç¤º, è™šæ‹Ÿåœ°å€è¢«åˆ†ä¸º 5 ä¸ªéƒ¨åˆ†, å‰ 4 ä¸ªè¡¨é¡¹ç”¨äºé€‰æ‹©é¡µ, è€Œæœ€åä¸€ä¸ªç´¢å¼•è¡¨ç¤ºé¡µå†…åç§».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1aaec21bc5fc808fb45798b5746626ec-20230731161933-fnxdkm2.png",alt:""}})]),s._v(" "),a("p",[s._v("å†çœ‹å¤§é¡µ, é¡¾åæ€ä¹‰, å°±æ˜¯æ¯”æ™®é€šé¡µæ›´å¤§çš„å†…å­˜å—, å¸¸è§çš„å¤§å°æœ‰ 2MB å’Œ 1GB. å¤§é¡µé€šå¸¸ç”¨åœ¨ä½¿ç”¨å¤§é‡å†…å­˜çš„è¿›ç¨‹ä¸Š, æ¯”å¦‚ Oracle, DPDK ç­‰.")]),s._v(" "),a("p",[s._v("é€šè¿‡è¿™äº›æœºåˆ¶, åœ¨é¡µè¡¨çš„æ˜ å°„ä¸‹, è¿›ç¨‹å°±å¯ä»¥é€šè¿‡è™šæ‹Ÿåœ°å€æ¥è®¿é—®ç‰©ç†å†…å­˜äº†. "),a("strong",[s._v("é‚£ä¹ˆå…·ä½“åˆ°ä¸€ä¸ª Linux è¿›ç¨‹ä¸­, è¿™äº›å†…å­˜åˆæ˜¯æ€ä¹ˆä½¿ç”¨çš„å‘¢")]),s._v("?")]),s._v(" "),a("h5",{attrs:{id:"_2-è™šæ‹Ÿå†…å­˜ç©ºé—´åˆ†å¸ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-è™šæ‹Ÿå†…å­˜ç©ºé—´åˆ†å¸ƒ"}},[s._v("#")]),s._v(" 2.è™šæ‹Ÿå†…å­˜ç©ºé—´åˆ†å¸ƒ")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, éœ€è¦è¿›ä¸€æ­¥"),a("strong",[s._v("äº†è§£è™šæ‹Ÿå†…å­˜ç©ºé—´çš„åˆ†å¸ƒæƒ…å†µ")]),s._v(". æœ€ä¸Šæ–¹çš„å†…æ ¸ç©ºé—´ä¸ç”¨å¤šè®², ä¸‹æ–¹çš„ç”¨æˆ·ç©ºé—´å†…å­˜, å…¶å®åˆè¢«åˆ†æˆäº†å¤šä¸ªä¸åŒçš„"),a("mark",[a("strong",[s._v("æ®µ")])]),s._v(". ä»¥ 32 ä½ç³»ç»Ÿä¸ºä¾‹, ä¸‹é¢ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºå®ƒä»¬çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/4d9da1e3a6f987ccc41792e0c279cdbe-20230731161933-l2ze4n5.png",alt:""}})]),s._v(" "),a("p",[s._v("é€šè¿‡è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°, ç”¨æˆ·ç©ºé—´å†…å­˜, ä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯"),a("strong",[s._v("äº”ç§ä¸åŒçš„å†…å­˜æ®µ")]),s._v(".")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("åªè¯»æ®µ")]),s._v(", åŒ…æ‹¬ä»£ç å’Œå¸¸é‡ç­‰.")]),s._v(" "),a("li",[a("strong",[s._v("æ•°æ®æ®µ")]),s._v(", åŒ…æ‹¬å…¨å±€å˜é‡ç­‰.")]),s._v(" "),a("li",[a("strong",[s._v("å †")]),s._v(", åŒ…æ‹¬åŠ¨æ€åˆ†é…çš„å†…å­˜, ä»ä½åœ°å€å¼€å§‹å‘ä¸Šå¢é•¿.")]),s._v(" "),a("li",[a("strong",[s._v("æ–‡ä»¶æ˜ å°„æ®µ")]),s._v(", åŒ…æ‹¬åŠ¨æ€åº“, å…±äº«å†…å­˜ç­‰, ä»é«˜åœ°å€å¼€å§‹å‘ä¸‹å¢é•¿.")]),s._v(" "),a("li",[a("strong",[s._v("æ ˆ")]),s._v(", åŒ…æ‹¬å±€éƒ¨å˜é‡å’Œå‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡ç­‰. æ ˆçš„å¤§å°æ˜¯å›ºå®šçš„, ä¸€èˆ¬æ˜¯ 8 MB.")])]),s._v(" "),a("p",[s._v("åœ¨è¿™äº”ä¸ªå†…å­˜æ®µä¸­, "),a("strong",[s._v("å †å’Œæ–‡ä»¶æ˜ å°„æ®µçš„å†…å­˜æ˜¯åŠ¨æ€åˆ†é…")]),s._v("çš„. æ¯”å¦‚è¯´, ä½¿ç”¨ C æ ‡å‡†åº“çš„ malloc() æˆ–è€… mmap(), å°±å¯ä»¥åˆ†åˆ«åœ¨å †å’Œæ–‡ä»¶æ˜ å°„æ®µåŠ¨æ€åˆ†é…å†…å­˜.")]),s._v(" "),a("p",[s._v("å…¶å® 64 ä½ç³»ç»Ÿçš„å†…å­˜åˆ†å¸ƒä¹Ÿç±»ä¼¼, åªä¸è¿‡å†…å­˜ç©ºé—´è¦å¤§å¾—å¤š. é‚£ä¹ˆæ›´é‡è¦çš„é—®é¢˜æ¥äº†, å†…å­˜ç©¶ç«Ÿæ˜¯æ€ä¹ˆåˆ†é…çš„å‘¢?")]),s._v(" "),a("h5",{attrs:{id:"_3-å†…å­˜åˆ†é…ä¸å›æ”¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å†…å­˜åˆ†é…ä¸å›æ”¶"}},[s._v("#")]),s._v(" 3.å†…å­˜åˆ†é…ä¸å›æ”¶")]),s._v(" "),a("p",[a("strong",[s._v("malloc()")]),s._v("  æ˜¯ C æ ‡å‡†åº“æä¾›çš„"),a("strong",[s._v("å†…å­˜åˆ†é…å‡½æ•°")]),s._v(", å¯¹åº”åˆ°ç³»ç»Ÿè°ƒç”¨ä¸Š, æœ‰ä¸¤ç§å®ç°æ–¹å¼, å³ "),a("strong",[s._v("brk() å’Œ mmap()")]),s._v(" .")]),s._v(" "),a("p",[a("strong",[s._v("å¯¹å°å—å†…å­˜(å°äº 128K), C æ ‡å‡†åº“ä½¿ç”¨ brk() æ¥åˆ†é…")]),s._v(", ä¹Ÿå°±æ˜¯é€šè¿‡ç§»åŠ¨å †é¡¶çš„ä½ç½®æ¥åˆ†é…å†…å­˜. è¿™äº›å†…å­˜é‡Šæ”¾åå¹¶ä¸ä¼šç«‹åˆ»å½’è¿˜ç³»ç»Ÿ, è€Œæ˜¯è¢«ç¼“å­˜èµ·æ¥, è¿™æ ·å°±å¯ä»¥é‡å¤ä½¿ç”¨.")]),s._v(" "),a("p",[a("strong",[s._v("è€Œå¤§å—å†…å­˜(å¤§äº 128K), åˆ™ç›´æ¥ä½¿ç”¨å†…å­˜æ˜ å°„ mmap() æ¥åˆ†é…")]),s._v(", ä¹Ÿå°±æ˜¯åœ¨æ–‡ä»¶æ˜ å°„æ®µæ‰¾ä¸€å—ç©ºé—²å†…å­˜åˆ†é…å‡ºå».")]),s._v(" "),a("p",[s._v("è¿™ä¸¤ç§æ–¹å¼, è‡ªç„¶å„æœ‰ä¼˜ç¼ºç‚¹.")]),s._v(" "),a("p",[s._v("brk() æ–¹å¼çš„ç¼“å­˜, å¯ä»¥å‡å°‘ç¼ºé¡µå¼‚å¸¸çš„å‘ç”Ÿ, æé«˜å†…å­˜è®¿é—®æ•ˆç‡. ä¸è¿‡, ç”±äºè¿™äº›å†…å­˜æ²¡æœ‰å½’è¿˜ç³»ç»Ÿ, åœ¨å†…å­˜å·¥ä½œç¹å¿™æ—¶, é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ä¼šé€ æˆ"),a("strong",[s._v("å†…å­˜ç¢ç‰‡")]),s._v(".")]),s._v(" "),a("p",[s._v("è€Œ mmap() æ–¹å¼åˆ†é…çš„å†…å­˜, ä¼šåœ¨é‡Šæ”¾æ—¶ç›´æ¥å½’è¿˜ç³»ç»Ÿ, æ‰€ä»¥æ¯æ¬¡ mmap éƒ½ä¼šå‘ç”Ÿç¼ºé¡µå¼‚å¸¸. åœ¨å†…å­˜å·¥ä½œç¹å¿™æ—¶, é¢‘ç¹çš„å†…å­˜åˆ†é…ä¼šå¯¼è‡´å¤§é‡çš„ç¼ºé¡µå¼‚å¸¸, ä½¿å†…æ ¸çš„ç®¡ç†è´Ÿæ‹…å¢å¤§. è¿™ä¹Ÿæ˜¯ malloc åªå¯¹å¤§å—å†…å­˜ä½¿ç”¨ mmap çš„åŸå› .")]),s._v(" "),a("p",[s._v("äº†è§£è¿™ä¸¤ç§è°ƒç”¨æ–¹å¼å, è¿˜éœ€è¦æ¸…æ¥šä¸€ç‚¹, é‚£å°±æ˜¯"),a("strong",[s._v("å½“è¿™ä¸¤ç§è°ƒç”¨å‘ç”Ÿå, å…¶å®å¹¶æ²¡æœ‰çœŸæ­£åˆ†é…å†…å­˜. è¿™äº›å†…å­˜, éƒ½åªåœ¨é¦–æ¬¡è®¿é—®æ—¶æ‰åˆ†é…, ä¹Ÿå°±æ˜¯é€šè¿‡ç¼ºé¡µå¼‚å¸¸è¿›å…¥å†…æ ¸ä¸­, å†ç”±å†…æ ¸æ¥åˆ†é…å†…å­˜")]),s._v(".")]),s._v(" "),a("p",[s._v("æ•´ä½“æ¥è¯´, Linux ä½¿ç”¨ä¼™ä¼´ç³»ç»Ÿæ¥ç®¡ç†å†…å­˜åˆ†é…. å‰é¢æåˆ°è¿‡, è¿™äº›å†…å­˜åœ¨ MMU ä¸­ä»¥é¡µä¸ºå•ä½è¿›è¡Œç®¡ç†, ä¼™ä¼´ç³»ç»Ÿä¹Ÿä¸€æ ·, ä»¥é¡µä¸ºå•ä½æ¥ç®¡ç†å†…å­˜, å¹¶ä¸”ä¼šé€šè¿‡ç›¸é‚»é¡µçš„åˆå¹¶, å‡å°‘å†…å­˜ç¢ç‰‡åŒ–(æ¯”å¦‚ brk æ–¹å¼é€ æˆçš„å†…å­˜ç¢ç‰‡).")]),s._v(" "),a("p",[s._v("ä½ å¯èƒ½ä¼šæƒ³åˆ°ä¸€ä¸ªé—®é¢˜, å¦‚æœé‡åˆ°æ¯”é¡µæ›´å°çš„å¯¹è±¡, æ¯”å¦‚ä¸åˆ° 1K çš„æ—¶å€™, è¯¥æ€ä¹ˆåˆ†é…å†…å­˜å‘¢? å®é™…ç³»ç»Ÿè¿è¡Œä¸­, ç¡®å®æœ‰"),a("strong",[s._v("å¤§é‡æ¯”é¡µè¿˜å°çš„å¯¹è±¡, å¦‚æœä¸ºå®ƒä»¬ä¹Ÿåˆ†é…å•ç‹¬çš„é¡µ, é‚£å°±å¤ªæµªè´¹å†…å­˜")]),s._v("äº†.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, åœ¨ç”¨æˆ·ç©ºé—´, malloc é€šè¿‡ brk() åˆ†é…çš„å†…å­˜, åœ¨é‡Šæ”¾æ—¶å¹¶ä¸ç«‹å³å½’è¿˜ç³»ç»Ÿ, è€Œæ˜¯ç¼“å­˜èµ·æ¥"),a("strong",[s._v("é‡å¤åˆ©ç”¨")]),s._v(". åœ¨å†…æ ¸ç©ºé—´, Linux åˆ™é€šè¿‡ slab åˆ†é…å™¨æ¥ç®¡ç†å°å†…å­˜. å¯ä»¥æŠŠ slab çœ‹æˆæ„å»ºåœ¨ä¼™ä¼´ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç¼“å­˜, ä¸»è¦ä½œç”¨å°±æ˜¯åˆ†é…å¹¶é‡Šæ”¾å†…æ ¸ä¸­çš„å°å¯¹è±¡.")]),s._v(" "),a("p",[s._v("å¯¹å†…å­˜æ¥è¯´, å¦‚æœåªåˆ†é…è€Œä¸é‡Šæ”¾, å°±ä¼šé€ æˆå†…å­˜æ³„æ¼, ç”šè‡³ä¼šè€—å°½ç³»ç»Ÿå†…å­˜. æ‰€ä»¥, åœ¨åº”ç”¨ç¨‹åºç”¨å®Œå†…å­˜å, è¿˜éœ€è¦"),a("strong",[s._v("è°ƒç”¨ free() æˆ– unmap(), æ¥é‡Šæ”¾è¿™äº›ä¸ç”¨çš„å†…å­˜")]),s._v(".")]),s._v(" "),a("p",[s._v("å½“ç„¶, ç³»ç»Ÿä¹Ÿä¸ä¼šä»»ç”±æŸä¸ªè¿›ç¨‹ç”¨å®Œæ‰€æœ‰å†…å­˜. åœ¨å‘ç°å†…å­˜ç´§å¼ æ—¶, "),a("strong",[s._v("ç³»ç»Ÿå°±ä¼šé€šè¿‡ä¸€ç³»åˆ—æœºåˆ¶æ¥å›æ”¶å†…å­˜")]),s._v(", æ¯”å¦‚ä¸‹é¢è¿™ä¸‰ç§æ–¹å¼:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å›æ”¶ç¼“å­˜")]),s._v(", æ¯”å¦‚ä½¿ç”¨ LRU(Least Recently Used)ç®—æ³•, å›æ”¶æœ€è¿‘ä½¿ç”¨æœ€å°‘çš„å†…å­˜é¡µé¢;")]),s._v(" "),a("li",[a("strong",[s._v("å›æ”¶ä¸å¸¸è®¿é—®çš„å†…å­˜")]),s._v(", æŠŠä¸å¸¸ç”¨çš„å†…å­˜é€šè¿‡äº¤æ¢åˆ†åŒºç›´æ¥å†™åˆ°ç£ç›˜ä¸­;")]),s._v(" "),a("li",[a("strong",[s._v("æ€æ­»è¿›ç¨‹")]),s._v(", å†…å­˜ç´§å¼ æ—¶ç³»ç»Ÿè¿˜ä¼šé€šè¿‡ OOM(Out of Memory), ç›´æ¥æ€æ‰å ç”¨å¤§é‡å†…å­˜çš„è¿›ç¨‹.")])]),s._v(" "),a("p",[s._v("å…¶ä¸­, ç¬¬äºŒç§æ–¹å¼å›æ”¶ä¸å¸¸è®¿é—®çš„å†…å­˜æ—¶, ä¼šç”¨åˆ°"),a("strong",[s._v("äº¤æ¢åˆ†åŒº")]),s._v("(ä»¥ä¸‹ç®€ç§° Swap). Swap å…¶å®å°±æ˜¯æŠŠä¸€å—ç£ç›˜ç©ºé—´å½“æˆå†…å­˜æ¥ç”¨. å®ƒå¯ä»¥æŠŠè¿›ç¨‹æš‚æ—¶ä¸ç”¨çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸­(è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º"),a("strong",[s._v("æ¢å‡º")]),s._v("), å½“è¿›ç¨‹è®¿é—®è¿™äº›å†…å­˜æ—¶, å†ä»ç£ç›˜è¯»å–è¿™äº›æ•°æ®åˆ°å†…å­˜ä¸­(è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º"),a("strong",[s._v("æ¢å…¥")]),s._v(").")]),s._v(" "),a("p",[s._v("æ‰€ä»¥å¯ä»¥å‘ç°, "),a("strong",[s._v("Swap æŠŠç³»ç»Ÿçš„å¯ç”¨å†…å­˜å˜å¤§äº†")]),s._v(". ä¸è¿‡è¦æ³¨æ„, é€šå¸¸åªåœ¨å†…å­˜ä¸è¶³æ—¶, æ‰ä¼šå‘ç”Ÿ Swap äº¤æ¢. å¹¶ä¸”ç”±äºç£ç›˜è¯»å†™çš„é€Ÿåº¦è¿œæ¯”å†…å­˜æ…¢, "),a("strong",[s._v("Swap ä¼šå¯¼è‡´ä¸¥é‡çš„å†…å­˜æ€§èƒ½é—®é¢˜")]),s._v(".")]),s._v(" "),a("p",[s._v("ç¬¬ä¸‰ç§æ–¹å¼æåˆ°çš„ OOM(Out of Memory), å…¶å®æ˜¯å†…æ ¸çš„ä¸€ç§ä¿æŠ¤æœºåˆ¶. å®ƒç›‘æ§è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ, å¹¶ä¸”ä½¿ç”¨ oom_score ä¸ºæ¯ä¸ªè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µè¿›è¡Œè¯„åˆ†:")]),s._v(" "),a("ul",[a("li",[s._v("ä¸€ä¸ªè¿›ç¨‹æ¶ˆè€—çš„å†…å­˜è¶Šå¤§, oom_score å°±è¶Šå¤§;")]),s._v(" "),a("li",[s._v("ä¸€ä¸ªè¿›ç¨‹è¿è¡Œå ç”¨çš„ CPU è¶Šå¤š, oom_score å°±è¶Šå°.")])]),s._v(" "),a("p",[s._v("è¿™æ ·, è¿›ç¨‹çš„ oom_score è¶Šå¤§, ä»£è¡¨æ¶ˆè€—çš„å†…å­˜è¶Šå¤š, ä¹Ÿå°±è¶Šå®¹æ˜“è¢« OOM æ€æ­», ä»è€Œå¯ä»¥æ›´å¥½ä¿æŠ¤ç³»ç»Ÿ.")]),s._v(" "),a("p",[s._v("å½“ç„¶, ä¸ºäº†å®é™…å·¥ä½œçš„éœ€è¦, ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ "),a("code",[s._v("/proc")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿ, æ‰‹åŠ¨è®¾ç½®è¿›ç¨‹çš„ oom_adj , ä»è€Œè°ƒæ•´è¿›ç¨‹çš„ oom_score. oom_adj çš„èŒƒå›´æ˜¯ [-17, 15], æ•°å€¼è¶Šå¤§, è¡¨ç¤ºè¿›ç¨‹è¶Šå®¹æ˜“è¢« OOM æ€æ­»; æ•°å€¼è¶Šå°, è¡¨ç¤ºè¿›ç¨‹è¶Šä¸å®¹æ˜“è¢« OOM æ€æ­», å…¶ä¸­ -17 è¡¨ç¤ºç¦æ­¢ OOM.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚ç”¨ä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥æŠŠ sshd è¿›ç¨‹çš„ oom_adj è°ƒå°ä¸º -16, è¿™æ ·, sshd è¿›ç¨‹å°±ä¸å®¹æ˜“è¢« OOM æ€æ­».")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("pidof sshd"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("/oom_adj\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"_4-å¦‚ä½•æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å¦‚ä½•æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ"}},[s._v("#")]),s._v(" 4.å¦‚ä½•æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ")]),s._v(" "),a("p",[s._v("é€šè¿‡äº†è§£å†…å­˜ç©ºé—´çš„åˆ†å¸ƒ, ä»¥åŠå†…å­˜çš„åˆ†é…å’Œå›æ”¶, å°±å¯¹å†…å­˜çš„å·¥ä½œåŸç†åº”è¯¥æœ‰äº†å¤§æ¦‚çš„è®¤è¯†. å½“ç„¶, ç³»ç»Ÿçš„å®é™…å·¥ä½œåŸç†æ›´åŠ å¤æ‚, ä¹Ÿä¼šæ¶‰åŠå…¶ä»–ä¸€äº›æœºåˆ¶, è¿™é‡Œåªè®²äº†æœ€ä¸»è¦çš„åŸç†. æŒæ¡äº†è¿™äº›, å¯ä»¥å¯¹å†…å­˜çš„è¿ä½œæœ‰ä¸€æ¡ä¸»çº¿è®¤è¯†, ä¸è‡³äºè„‘æµ·é‡Œåªæœ‰æœ¯è¯­åè¯çš„å †ç Œ.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆåœ¨äº†è§£å†…å­˜çš„å·¥ä½œåŸç†ä¹‹å, åˆè¯¥"),a("strong",[s._v("æ€ä¹ˆæŸ¥çœ‹ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ")]),s._v("å‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®å‰é¢ CPU å†…å®¹çš„å­¦ä¹ ä¸­, ä¹Ÿæåˆ°è¿‡ä¸€äº›ç›¸å…³å·¥å…·. åœ¨è¿™é‡Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„åº”è¯¥æ˜¯ free å·¥å…·. ä¸‹é¢æ˜¯ä¸€ä¸ª free çš„è¾“å‡ºç¤ºä¾‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ³¨æ„ä¸åŒç‰ˆæœ¬çš„ free è¾“å‡ºå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("\n              total        used        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169348")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("263524")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6875352")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("668")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1030472")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7611064")]),s._v("\nSwap:             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, free è¾“å‡ºçš„æ˜¯ä¸€ä¸ªè¡¨æ ¼, å…¶ä¸­çš„æ•°å€¼éƒ½é»˜è®¤ä»¥"),a("strong",[s._v("å­—èŠ‚")]),s._v("ä¸ºå•ä½. è¡¨æ ¼æ€»å…±æœ‰ä¸¤è¡Œå…­åˆ—, è¿™ä¸¤è¡Œåˆ†åˆ«æ˜¯"),a("strong",[s._v("ç‰©ç†å†…å­˜ Mem å’Œäº¤æ¢åˆ†åŒº Swap çš„ä½¿ç”¨æƒ…å†µ")]),s._v(", è€Œå…­åˆ—ä¸­, æ¯åˆ—æ•°æ®çš„å«ä¹‰åˆ†åˆ«ä¸º:")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€åˆ—, total æ˜¯"),a("strong",[s._v("æ€»å†…å­˜")]),s._v("å¤§å°;")]),s._v(" "),a("li",[s._v("ç¬¬äºŒåˆ—, used æ˜¯"),a("strong",[s._v("å·²ä½¿ç”¨å†…å­˜")]),s._v("çš„å¤§å°, åŒ…å«äº†å…±äº«å†…å­˜;")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰åˆ—, free æ˜¯"),a("strong",[s._v("æœªä½¿ç”¨å†…å­˜")]),s._v("çš„å¤§å°;")]),s._v(" "),a("li",[s._v("ç¬¬å››åˆ—, shared æ˜¯"),a("strong",[s._v("å…±äº«å†…å­˜")]),s._v("çš„å¤§å°;")]),s._v(" "),a("li",[s._v("ç¬¬äº”åˆ—, buff/cache æ˜¯"),a("strong",[s._v("ç¼“å­˜å’Œç¼“å†²åŒº")]),s._v("çš„å¤§å°;")]),s._v(" "),a("li",[s._v("æœ€åä¸€åˆ—, available æ˜¯"),a("strong",[s._v("æ–°è¿›ç¨‹å¯ç”¨å†…å­˜")]),s._v("çš„å¤§å°.")])]),s._v(" "),a("p",[s._v("è¿™é‡Œå°¤å…¶æ³¨æ„ä¸€ä¸‹, æœ€åä¸€åˆ—çš„å¯ç”¨å†…å­˜ available. available ä¸ä»…åŒ…å«æœªä½¿ç”¨å†…å­˜, è¿˜åŒ…æ‹¬äº†"),a("strong",[s._v("å¯å›æ”¶çš„ç¼“å­˜")]),s._v(", æ‰€ä»¥ä¸€èˆ¬ä¼šæ¯”æœªä½¿ç”¨å†…å­˜æ›´å¤§. ä¸è¿‡, å¹¶ä¸æ˜¯æ‰€æœ‰ç¼“å­˜éƒ½å¯ä»¥å›æ”¶, å› ä¸ºæœ‰äº›ç¼“å­˜å¯èƒ½æ­£åœ¨ä½¿ç”¨ä¸­.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, "),a("mark",[a("strong",[s._v("free æ˜¾ç¤ºçš„æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µ")])]),s._v(". å¦‚æœæƒ³"),a("mark",[a("strong",[s._v("æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ, å¯ä»¥ç”¨ top æˆ–è€… ps ç­‰å·¥å…·")])]),s._v(". æ¯”å¦‚, ä¸‹é¢æ˜¯ top çš„è¾“å‡ºç¤ºä¾‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‰ä¸‹ M åˆ‡æ¢åˆ°å†…å­˜æ’åº")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169348")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6871440")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("267096")]),s._v(" used,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1030812")]),s._v(" buff/cache\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7607492")]),s._v(" avail Mem\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("430")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("122360")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35588")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23748")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":32.17 systemd-journal\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1075")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("771860")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22744")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11368")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":38.89 snapd\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("170904")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17292")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9488")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.24 networkd-dispat\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78020")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9156")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6644")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":22.92 systemd\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12376")]),s._v(" azure     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("76632")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7456")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6420")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 systemd\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12374")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("107984")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7312")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6304")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.00 sshd\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("top è¾“å‡ºç•Œé¢çš„é¡¶ç«¯, ä¹Ÿæ˜¾ç¤ºäº†ç³»ç»Ÿæ•´ä½“çš„å†…å­˜ä½¿ç”¨æƒ…å†µ, è¿™äº›æ•°æ®è·Ÿ free ç±»ä¼¼, å°±ä¸å†é‡å¤è§£é‡Š. æ¥ç€çœ‹ä¸‹é¢çš„å†…å®¹, è·Ÿå†…å­˜ç›¸å…³çš„å‡ åˆ—æ•°æ®, æ¯”å¦‚ VIRT, RES, SHR ä»¥åŠ %MEM ç­‰.")]),s._v(" "),a("p",[s._v("è¿™äº›æ•°æ®, åŒ…å«äº†è¿›ç¨‹æœ€é‡è¦çš„å‡ ä¸ªå†…å­˜ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("VIRT æ˜¯è¿›ç¨‹è™šæ‹Ÿå†…å­˜çš„å¤§å°")]),s._v(", åªè¦æ˜¯è¿›ç¨‹ç”³è¯·è¿‡çš„å†…å­˜, å³ä¾¿è¿˜æ²¡æœ‰çœŸæ­£åˆ†é…ç‰©ç†å†…å­˜, ä¹Ÿä¼šè®¡ç®—åœ¨å†….")]),s._v(" "),a("li",[a("strong",[s._v("RES æ˜¯å¸¸é©»å†…å­˜çš„å¤§å°, ä¹Ÿå°±æ˜¯è¿›ç¨‹å®é™…ä½¿ç”¨çš„ç‰©ç†å†…å­˜å¤§å°")]),s._v(", ä½†ä¸åŒ…æ‹¬ Swap å’Œå…±äº«å†…å­˜.")]),s._v(" "),a("li",[a("strong",[s._v("SHR æ˜¯å…±äº«å†…å­˜çš„å¤§å°")]),s._v(", æ¯”å¦‚ä¸å…¶ä»–è¿›ç¨‹å…±åŒä½¿ç”¨çš„å…±äº«å†…å­˜, åŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ä»¥åŠç¨‹åºçš„ä»£ç æ®µç­‰.")]),s._v(" "),a("li",[a("strong",[s._v("%MEM æ˜¯è¿›ç¨‹ä½¿ç”¨ç‰©ç†å†…å­˜å ç³»ç»Ÿæ€»å†…å­˜çš„ç™¾åˆ†æ¯”")]),s._v(".")])]),s._v(" "),a("p",[s._v("é™¤äº†è¦è®¤è¯†è¿™äº›åŸºæœ¬ä¿¡æ¯, åœ¨æŸ¥çœ‹ top è¾“å‡ºæ—¶, è¿˜è¦æ³¨æ„ä¸¤ç‚¹.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, è™šæ‹Ÿå†…å­˜é€šå¸¸å¹¶ä¸ä¼šå…¨éƒ¨åˆ†é…ç‰©ç†å†…å­˜. ä»ä¸Šé¢çš„è¾“å‡º, å¯ä»¥å‘ç°æ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜éƒ½æ¯”å¸¸é©»å†…å­˜å¤§å¾—å¤š.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, å…±äº«å†…å­˜ SHR å¹¶ä¸ä¸€å®šæ˜¯å…±äº«çš„, æ¯”æ–¹è¯´, ç¨‹åºçš„ä»£ç æ®µ, éå…±äº«çš„åŠ¨æ€é“¾æ¥åº“, ä¹Ÿéƒ½ç®—åœ¨ SHR é‡Œ. å½“ç„¶, SHR ä¹ŸåŒ…æ‹¬äº†è¿›ç¨‹é—´çœŸæ­£å…±äº«çš„å†…å­˜. æ‰€ä»¥åœ¨è®¡ç®—å¤šä¸ªè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æ—¶, ä¸è¦æŠŠæ‰€æœ‰è¿›ç¨‹çš„ SHR ç›´æ¥ç›¸åŠ å¾—å‡ºç»“æœ.")])]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“-4"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¢³ç†äº† Linux å†…å­˜çš„å·¥ä½œåŸç†. "),a("strong",[s._v("å¯¹æ™®é€šè¿›ç¨‹æ¥è¯´, å®ƒèƒ½çœ‹åˆ°çš„å…¶å®æ˜¯å†…æ ¸æä¾›çš„è™šæ‹Ÿå†…å­˜, è¿™äº›è™šæ‹Ÿå†…å­˜è¿˜éœ€è¦é€šè¿‡é¡µè¡¨, ç”±ç³»ç»Ÿæ˜ å°„ä¸ºç‰©ç†å†…å­˜")]),s._v(".")]),s._v(" "),a("p",[s._v("å½“è¿›ç¨‹é€šè¿‡ malloc() ç”³è¯·å†…å­˜å, å†…å­˜å¹¶ä¸ä¼šç«‹å³åˆ†é…, è€Œæ˜¯åœ¨é¦–æ¬¡è®¿é—®æ—¶, æ‰é€šè¿‡ç¼ºé¡µå¼‚å¸¸é™·å…¥å†…æ ¸ä¸­åˆ†é…å†…å­˜.")]),s._v(" "),a("p",[s._v("ç”±äºè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ¯”ç‰©ç†å†…å­˜å¤§å¾ˆå¤š, Linux è¿˜æä¾›äº†ä¸€ç³»åˆ—çš„æœºåˆ¶, åº”å¯¹å†…å­˜ä¸è¶³çš„é—®é¢˜, æ¯”å¦‚ç¼“å­˜çš„å›æ”¶, äº¤æ¢åˆ†åŒº Swap ä»¥åŠ OOM ç­‰.")]),s._v(" "),a("p",[s._v("å½“éœ€è¦äº†è§£ç³»ç»Ÿæˆ–è€…è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µæ—¶, å¯ä»¥ç”¨ free å’Œ top, ps ç­‰æ€§èƒ½å·¥å…·. å®ƒä»¬éƒ½æ˜¯åˆ†ææ€§èƒ½é—®é¢˜æ—¶æœ€å¸¸ç”¨çš„æ€§èƒ½å·¥å…·.")]),s._v(" "),a("h4",{attrs:{id:"_16-åŸºç¡€ç¯‡-æ€ä¹ˆç†è§£å†…å­˜ä¸­çš„bufferå’Œcache"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-åŸºç¡€ç¯‡-æ€ä¹ˆç†è§£å†…å­˜ä¸­çš„bufferå’Œcache"}},[s._v("#")]),s._v(" 16-åŸºç¡€ç¯‡:æ€ä¹ˆç†è§£å†…å­˜ä¸­çš„Bufferå’ŒCache?")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚æ¢³ç†äº† Linux å†…å­˜ç®¡ç†çš„åŸºæœ¬åŸç†, å¹¶å­¦ä¼šäº†ç”¨ free å’Œ top ç­‰å·¥å…·, æ¥æŸ¥çœ‹ç³»ç»Ÿå’Œè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("å†…å­˜å’Œ CPU çš„å…³ç³»éå¸¸ç´§å¯†, è€Œå†…å­˜ç®¡ç†æœ¬èº«ä¹Ÿæ˜¯å¾ˆå¤æ‚çš„æœºåˆ¶, æ‰€ä»¥æ„Ÿè§‰çŸ¥è¯†å¾ˆç¡¬æ ¸, å¾ˆéš¾å•ƒ, éƒ½æ˜¯æ­£å¸¸çš„. ä½†è¿˜æ˜¯é‚£å¥è¯, åˆå­¦æ—¶ä¸ç”¨éå¾—ç†è§£æ‰€æœ‰å†…å®¹, ç»§ç»­å¾€åå­¦, å¤šç†è§£ç›¸å…³çš„æ¦‚å¿µå¹¶é…åˆä¸€å®šçš„å®è·µä¹‹å, å†å›å¤´å¤ä¹ å¾€å¾€ä¼šå®¹æ˜“ä¸å°‘. å½“ç„¶, åŸºæœ¬åŠŸä¸å®¹æ”¾å¼ƒ.")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å¼€å§‹ä¹‹å‰, å…ˆæ¥å›é¡¾ä¸€ä¸‹ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µ, æ¯”å¦‚ä¸‹é¢è¿™ä¸ª free è¾“å‡ºç•Œé¢:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ³¨æ„ä¸åŒç‰ˆæœ¬çš„ free è¾“å‡ºå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("\n              total        used        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169348")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("263524")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6875352")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("668")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1030472")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7611064")]),s._v("\nSwap:             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("æ˜¾ç„¶, è¿™ä¸ªç•Œé¢åŒ…å«äº†"),a("strong",[s._v("ç‰©ç†å†…å­˜ Mem å’Œäº¤æ¢åˆ†åŒº Swap çš„å…·ä½“ä½¿ç”¨æƒ…å†µ, æ¯”å¦‚æ€»å†…å­˜, å·²ç”¨å†…å­˜, ç¼“å­˜, å¯ç”¨å†…å­˜ç­‰. å…¶ä¸­ç¼“å­˜æ˜¯ Buffer å’Œ Cache ä¸¤éƒ¨åˆ†çš„æ€»å’Œ")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™é‡Œçš„å¤§éƒ¨åˆ†æŒ‡æ ‡éƒ½æ¯”è¾ƒå®¹æ˜“ç†è§£, ä½† Buffer å’Œ Cache å¯èƒ½ä¸å¤ªå¥½åŒºåˆ†. ä»å­—é¢ä¸Šæ¥è¯´, "),a("mark",[a("strong",[s._v("Buffer æ˜¯ç¼“å†²åŒº, è€Œ Cache æ˜¯ç¼“å­˜, ä¸¤è€…éƒ½æ˜¯æ•°æ®åœ¨å†…å­˜ä¸­çš„ä¸´æ—¶å­˜å‚¨")])]),s._v('. é‚£ä¹ˆ, ä½ çŸ¥é“è¿™ä¸¤ç§ "ä¸´æ—¶å­˜å‚¨" æœ‰ä»€ä¹ˆåŒºåˆ«å—?')]),s._v(" "),a("p",[s._v('æ³¨: ä»Šå¤©å†…å®¹æ¥ä¸‹æ¥çš„éƒ¨åˆ†, Buffer å’Œ Cache ä¼šéƒ½ç”¨è‹±æ–‡æ¥è¡¨ç¤º, é¿å…è·Ÿæ–‡ä¸­çš„ "ç¼“å­˜" ä¸€è¯æ··æ·†. è€Œæ–‡ä¸­çš„ "ç¼“å­˜", åˆ™é€šæŒ‡å†…å­˜ä¸­çš„ä¸´æ—¶å­˜å‚¨.')]),s._v(" "),a("h5",{attrs:{id:"_1-freeæ•°æ®çš„æ¥æº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-freeæ•°æ®çš„æ¥æº"}},[s._v("#")]),s._v(" 1.freeæ•°æ®çš„æ¥æº")]),s._v(" "),a("p",[s._v("åœ¨æ­£å¼è®²è§£ä¸¤ä¸ªæ¦‚å¿µå‰, å¯ä»¥å…ˆæƒ³æƒ³, æœ‰æ²¡æœ‰ä»€ä¹ˆé€”å¾„æ¥è¿›ä¸€æ­¥äº†è§£å®ƒä»¬? é™¤äº†ä¸­æ–‡ç¿»è¯‘ç›´æ¥å¾—åˆ°æ¦‚å¿µ, åˆ«å¿˜äº†, Buffer å’Œ Cache è¿˜æ˜¯ç”¨ free è·å¾—çš„æŒ‡æ ‡.")]),s._v(" "),a("p",[s._v("è¿˜è®°å¾—ä¹‹å‰è®²è¿‡çš„, ç¢°åˆ°çœ‹ä¸æ˜ç™½çš„æŒ‡æ ‡æ—¶è¯¥æ€ä¹ˆåŠå—? ä¸æ‡‚å°±å»æŸ¥æ‰‹å†Œ. ç”¨ man å‘½ä»¤æŸ¥è¯¢ free çš„æ–‡æ¡£, å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”æŒ‡æ ‡çš„è¯¦ç»†è¯´æ˜. æ¯”å¦‚æ‰§è¡Œ man free, å°±å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¸ªç•Œé¢.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("buffers\n              Memory used by kernel buffers "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Buffers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /proc/meminfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n       cache  Memory used by the page cache and slabs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Cached and SReclaimable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /proc/meminfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n       buff/cache\n              Sum of buffers and cache\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä» free çš„æ‰‹å†Œä¸­, å¯ä»¥çœ‹åˆ° buffer å’Œ cache çš„è¯´æ˜.")]),s._v(" "),a("ul",[a("li",[a("mark",[a("strong",[s._v("Buffers æ˜¯å†…æ ¸ç¼“å†²åŒºç”¨åˆ°çš„å†…å­˜")])]),s._v(", å¯¹åº”çš„æ˜¯  "),a("strong",[s._v("/proc/meminfo")]),s._v(" ä¸­çš„ Buffers å€¼.")]),s._v(" "),a("li",[a("mark",[a("strong",[s._v("Cache æ˜¯å†…æ ¸é¡µç¼“å­˜å’Œ Slab ç”¨åˆ°çš„å†…å­˜")])]),s._v(", å¯¹åº”çš„æ˜¯ "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹ ä¸­çš„ Cached ä¸ SReclaimable ä¹‹å’Œ.")])]),s._v(" "),a("p",[s._v("è¿™é‡Œçš„è¯´æ˜å‘Šè¯‰æˆ‘ä»¬, è¿™äº›æ•°å€¼éƒ½æ¥è‡ª "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹, ä½†æ›´å…·ä½“çš„ Buffers, Cached å’Œ SReclaimable çš„å«ä¹‰, è¿˜æ˜¯æ²¡æœ‰è¯´æ¸…æ¥š.")]),s._v(" "),a("p",[s._v("è¦å¼„æ˜ç™½å®ƒä»¬åˆ°åº•æ˜¯ä»€ä¹ˆ, æˆ‘ä¼°è®¡ä½ ç¬¬ä¸€ååº”å°±æ˜¯å»ç™¾åº¦æˆ–è€… Google ä¸€ä¸‹. è™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹, ç½‘ç»œæœç´¢èƒ½ç»™å‡ºä¸€ä¸ªç­”æ¡ˆ. ä½†æ˜¯, ä¸”ä¸è¯´ç­›é€‰ä¿¡æ¯èŠ±è´¹çš„æ—¶é—´ç²¾åŠ›, å¯¹ä½ æ¥è¯´, è¿™ä¸ªç­”æ¡ˆçš„å‡†ç¡®æ€§ä¹Ÿæ˜¯å¾ˆéš¾ä¿è¯çš„. è¦æ³¨æ„, ç½‘ä¸Šçš„ç»“è®ºå¯èƒ½æ˜¯å¯¹çš„, ä½†æ˜¯å¾ˆå¯èƒ½è·Ÿä½ çš„ç¯å¢ƒå¹¶ä¸åŒ¹é…. æœ€ç®€å•æ¥è¯´, åŒä¸€ä¸ªæŒ‡æ ‡çš„å…·ä½“å«ä¹‰, å°±å¯èƒ½å› ä¸ºå†…æ ¸ç‰ˆæœ¬, æ€§èƒ½å·¥å…·ç‰ˆæœ¬çš„ä¸åŒè€Œæœ‰æŒºå¤§å·®åˆ«. è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ, æˆ‘æ€»åœ¨ä¸“æ ä¸­å¼ºè°ƒé€šç”¨æ€è·¯å’Œæ–¹æ³•, è€Œä¸æ˜¯è®©ä½ æ­»è®°ç»“è®º. å¯¹äºæ¡ˆä¾‹å®è·µæ¥è¯´, æœºå™¨ç¯å¢ƒå°±æ˜¯çš„æœ€å¤§é™åˆ¶.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, æœ‰æ²¡æœ‰æ›´ç®€å•, æ›´å‡†ç¡®çš„æ–¹æ³•, æ¥æŸ¥è¯¢å®ƒä»¬çš„å«ä¹‰å‘¢?")]),s._v(" "),a("h5",{attrs:{id:"_2-procæ–‡ä»¶ç³»ç»Ÿ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-procæ–‡ä»¶ç³»ç»Ÿ"}},[s._v("#")]),s._v(" 2.procæ–‡ä»¶ç³»ç»Ÿ")]),s._v(" "),a("p",[s._v("å‰é¢ CPU æ€§èƒ½æ¨¡å—å°±æ›¾ç»æåˆ°è¿‡, "),a("code",[s._v("/proc")]),s._v("â€‹ æ˜¯ Linux å†…æ ¸"),a("strong",[s._v("æä¾›çš„ä¸€ç§ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ, æ˜¯ç”¨æˆ·è·Ÿå†…æ ¸äº¤äº’çš„æ¥å£")]),s._v(". æ¯”æ–¹è¯´, ç”¨æˆ·å¯ä»¥ä» "),a("code",[s._v("/proc")]),s._v("â€‹ ä¸­æŸ¥è¯¢å†…æ ¸çš„è¿è¡ŒçŠ¶æ€å’Œé…ç½®é€‰é¡¹, æŸ¥è¯¢è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€, ç»Ÿè®¡æ•°æ®ç­‰, å½“ç„¶, ä¹Ÿå¯ä»¥é€šè¿‡ "),a("code",[s._v("/proc")]),s._v("â€‹ æ¥ä¿®æ”¹å†…æ ¸çš„é…ç½®.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("proc æ–‡ä»¶ç³»ç»ŸåŒæ—¶ä¹Ÿæ˜¯å¾ˆå¤šæ€§èƒ½å·¥å…·çš„æœ€ç»ˆæ•°æ®æ¥æº")])]),s._v(". æ¯”å¦‚åˆšæ‰çœ‹åˆ°çš„ free, å°±æ˜¯é€šè¿‡è¯»å– "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹, å¾—åˆ°å†…å­˜çš„ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("ç»§ç»­è¯´å› "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹, æ—¢ç„¶ Buffers, Cached, SReclaimable è¿™å‡ ä¸ªæŒ‡æ ‡ä¸å®¹æ˜“ç†è§£, é‚£è¿˜å¾—ç»§ç»­æŸ¥ proc æ–‡ä»¶ç³»ç»Ÿ, è·å–å®ƒä»¬çš„è¯¦ç»†å®šä¹‰.")]),s._v(" "),a("p",[s._v("æ‰§è¡Œ man proc, å°±å¯ä»¥å¾—åˆ° proc æ–‡ä»¶ç³»ç»Ÿçš„è¯¦ç»†æ–‡æ¡£. æ³¨æ„è¿™ä¸ªæ–‡æ¡£æ¯”è¾ƒé•¿, æœ€å¥½æœç´¢ä¸€ä¸‹(æ¯”å¦‚æœç´¢ meminfo), ä»¥ä¾¿æ›´å¿«å®šä½åˆ°å†…å­˜éƒ¨åˆ†.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Buffers %lu\n    Relatively temporary storage "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" raw disk blocks that shouldn"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t get tremendously large (20MB or so).\n \nCached %lu\n   In-memory cache for files read from the disk (the page cache).  Doesn'")]),s._v("t include SwapCached.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nSReclaimable %lu "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since Linux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v(".19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    Part of Slab, that might be reclaimed, such as caches.\n  \nSUnreclaim %lu "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since Linux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v(".19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    Part of Slab, that cannot be reclaimed on memory pressure.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("é€šè¿‡è¿™ä¸ªæ–‡æ¡£å¯ä»¥çœ‹åˆ°:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Buffers æ˜¯å¯¹åŸå§‹ç£ç›˜å—çš„ä¸´æ—¶å­˜å‚¨, ä¹Ÿå°±æ˜¯ç”¨æ¥")]),s._v("â€‹"),a("mark",[a("strong",[s._v("ç¼“å­˜ç£ç›˜çš„æ•°æ®")])]),s._v("â€‹ "),a("strong",[s._v(", é€šå¸¸ä¸ä¼šç‰¹åˆ«å¤§(20MB å·¦å³). è¿™æ ·, å†…æ ¸å°±å¯ä»¥æŠŠåˆ†æ•£çš„å†™é›†ä¸­èµ·æ¥, ç»Ÿä¸€ä¼˜åŒ–ç£ç›˜çš„å†™å…¥, æ¯”å¦‚å¯ä»¥æŠŠå¤šæ¬¡å°çš„å†™åˆå¹¶æˆå•æ¬¡å¤§çš„å†™ç­‰ç­‰.")])]),s._v(" "),a("li",[a("strong",[s._v("Cached æ˜¯ä»ç£ç›˜è¯»å–æ–‡ä»¶çš„é¡µç¼“å­˜, ä¹Ÿå°±æ˜¯ç”¨æ¥")]),s._v("â€‹"),a("mark",[a("strong",[s._v("ç¼“å­˜ä»æ–‡ä»¶è¯»å–çš„æ•°æ®")])]),s._v("â€‹ "),a("strong",[s._v(". è¿™æ ·ä¸‹æ¬¡è®¿é—®è¿™äº›æ–‡ä»¶æ•°æ®æ—¶, å°±å¯ä»¥ç›´æ¥ä»å†…å­˜ä¸­å¿«é€Ÿè·å–, è€Œä¸éœ€è¦å†æ¬¡è®¿é—®ç¼“æ…¢çš„ç£ç›˜.")])]),s._v(" "),a("li",[s._v("SReclaimable æ˜¯ Slab çš„ä¸€éƒ¨åˆ†. Slab åŒ…æ‹¬ä¸¤éƒ¨åˆ†, å…¶ä¸­çš„å¯å›æ”¶éƒ¨åˆ†, ç”¨ SReclaimable è®°å½•; è€Œä¸å¯å›æ”¶éƒ¨åˆ†, ç”¨ SUnreclaim è®°å½•.")])]),s._v(" "),a("p",[s._v("è¿™é‡Œç»ˆäºæ‰¾åˆ°äº†è¿™ä¸‰ä¸ªæŒ‡æ ‡çš„è¯¦ç»†å®šä¹‰. ä¸è¿‡, çŸ¥é“è¿™ä¸ªå®šä¹‰å°±çœŸçš„ç†è§£äº†å—? è¿™é‡Œæä¸¤ä¸ªé—®é¢˜, æƒ³æƒ³èƒ½ä¸èƒ½å›ç­”å‡ºæ¥.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ä¸ªé—®é¢˜, Buffer çš„æ–‡æ¡£æ²¡æœ‰æåˆ°è¿™æ˜¯ç£ç›˜è¯»æ•°æ®è¿˜æ˜¯å†™æ•°æ®çš„ç¼“å­˜, è€Œåœ¨å¾ˆå¤šç½‘ç»œæœç´¢çš„ç»“æœä¸­éƒ½ä¼šæåˆ° Buffer åªæ˜¯å¯¹"),a("strong",[s._v("å°†è¦å†™å…¥ç£ç›˜æ•°æ®")]),s._v("çš„ç¼“å­˜. é‚£åè¿‡æ¥è¯´, å®ƒä¼šä¸ä¼šä¹Ÿç¼“å­˜ä»ç£ç›˜ä¸­è¯»å–çš„æ•°æ®å‘¢?")]),s._v(" "),a("li",[s._v("ç¬¬äºŒä¸ªé—®é¢˜, æ–‡æ¡£ä¸­æåˆ°, Cache æ˜¯å¯¹ä»æ–‡ä»¶è¯»å–æ•°æ®çš„ç¼“å­˜, é‚£ä¹ˆå®ƒæ˜¯ä¸æ˜¯ä¹Ÿä¼šç¼“å­˜å†™æ–‡ä»¶çš„æ•°æ®å‘¢?")])]),s._v(" "),a("p",[s._v("ä¸ºäº†è§£ç­”è¿™ä¸¤ä¸ªé—®é¢˜, æ¥ä¸‹æ¥å°†ç”¨å‡ ä¸ªæ¡ˆä¾‹æ¥å±•ç¤º Buffer å’Œ Cache åœ¨ä¸åŒåœºæ™¯ä¸‹çš„ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("h5",{attrs:{id:"_3-æ¡ˆä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¡ˆä¾‹"}},[s._v("#")]),s._v(" 3.æ¡ˆä¾‹")]),s._v(" "),a("h6",{attrs:{id:"_1-ä½ çš„å‡†å¤‡-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä½ çš„å‡†å¤‡-4"}},[s._v("#")]),s._v(" (1)ä½ çš„å‡†å¤‡")]),s._v(" "),a("p",[s._v("è·Ÿå‰é¢å®éªŒä¸€æ ·, ä»Šå¤©çš„æ¡ˆä¾‹ä¹Ÿæ˜¯åŸºäº Ubuntu 18.04, å½“ç„¶, å…¶ä»– Linux ç³»ç»Ÿä¹Ÿé€‚ç”¨. æ¡ˆä¾‹ç¯å¢ƒæ˜¯è¿™æ ·çš„.")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… sysstat åŒ…, å¦‚ apt install sysstat.")])]),s._v(" "),a("p",[s._v("ä¹‹æ‰€ä»¥è¦å®‰è£… sysstat, æ˜¯å› ä¸ºè¦ç”¨åˆ° vmstat æ¥è§‚å¯Ÿ Buffer å’Œ Cache çš„å˜åŒ–æƒ…å†µ. è™½ç„¶ä» "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹ é‡Œä¹Ÿå¯ä»¥è¯»åˆ°ç›¸åŒçš„ç»“æœ, ä½†æ¯•ç«Ÿè¿˜æ˜¯ vmstat çš„ç»“æœæ›´åŠ ç›´è§‚.")]),s._v(" "),a("p",[s._v("å¦å¤–, è¿™å‡ ä¸ªæ¡ˆä¾‹ä½¿ç”¨äº† dd æ¥æ¨¡æ‹Ÿç£ç›˜å’Œæ–‡ä»¶çš„ I/O, æ‰€ä»¥ä¹Ÿéœ€è¦è§‚æµ‹ I/O çš„å˜åŒ–æƒ…å†µ.")]),s._v(" "),a("p",[s._v("ä¸Šé¢çš„å·¥å…·å®‰è£…å®Œæˆå, å¯ä»¥æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯, è¿æ¥åˆ° Ubuntu æœºå™¨ä¸Š.")]),s._v(" "),a("h6",{attrs:{id:"_2-åœºæ™¯1-ç£ç›˜å’Œæ–‡ä»¶å†™æ¡ˆä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-åœºæ™¯1-ç£ç›˜å’Œæ–‡ä»¶å†™æ¡ˆä¾‹"}},[s._v("#")]),s._v(" (2)åœºæ™¯1:ç£ç›˜å’Œæ–‡ä»¶å†™æ¡ˆä¾‹")]),s._v(" "),a("p",[s._v("å…ˆæ¥æ¨¡æ‹Ÿç¬¬ä¸€ä¸ªåœºæ™¯. é¦–å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯, è¿è¡Œä¸‹é¢è¿™ä¸ª vmstat å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 1 ç§’è¾“å‡º 1 ç»„æ•°æ®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vmstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\nr  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7743608")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1112")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92168")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("152")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7743608")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1112")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92168")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è¾“å‡ºç•Œé¢é‡Œ, å†…å­˜éƒ¨åˆ†çš„ buff å’Œ cache, ä»¥åŠ io éƒ¨åˆ†çš„ bi å’Œ bo å°±æ˜¯è¦å…³æ³¨çš„é‡ç‚¹.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("buff å’Œ cache å°±æ˜¯å‰é¢çœ‹åˆ°çš„ Buffers å’Œ Cache, å•ä½æ˜¯ KB.")])]),s._v(" "),a("li",[a("strong",[s._v("bi å’Œ bo åˆ™åˆ†åˆ«è¡¨ç¤ºå—è®¾å¤‡è¯»å–å’Œå†™å…¥çš„å¤§å°, å•ä½ä¸ºå—/ç§’")]),s._v(". å› ä¸º Linux ä¸­å—çš„å¤§å°æ˜¯ 1KB, æ‰€ä»¥è¿™ä¸ªå•ä½ä¹Ÿå°±ç­‰ä»·äº KB/s.")])]),s._v(" "),a("p",[s._v("æ­£å¸¸æƒ…å†µä¸‹, ç©ºé—²ç³»ç»Ÿä¸­, åº”è¯¥çœ‹åˆ°çš„æ˜¯è¿™å‡ ä¸ªå€¼åœ¨å¤šæ¬¡ç»“æœä¸­ä¸€ç›´ä¿æŒä¸å˜.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, åˆ°ç¬¬äºŒä¸ªç»ˆç«¯æ‰§è¡Œ dd å‘½ä»¤, é€šè¿‡"),a("strong",[s._v("è¯»å–éšæœºè®¾å¤‡")]),s._v(", ç”Ÿæˆä¸€ä¸ª 500MB å¤§å°çš„æ–‡ä»¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/urandom "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/file "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶åå†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯, è§‚å¯Ÿ Buffer å’Œ Cache çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\nr  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7499460")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1344")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("230484")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("145")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7338088")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1752")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("390512")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("488")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("558")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7158872")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1752")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("568800")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("376")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6980308")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1752")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("747860")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("360")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6977448")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1752")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("752072")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("138")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6977440")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1760")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("752080")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("152")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("212")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6977216")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1768")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("752104")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("122880")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("234")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6977440")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1768")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("752108")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10240")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("196")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("é€šè¿‡è§‚å¯Ÿ vmstat çš„è¾“å‡º, å¯ä»¥å‘ç°, åœ¨ dd å‘½ä»¤è¿è¡Œæ—¶, "),a("strong",[s._v("Cache åœ¨ä¸åœåœ°å¢é•¿, è€Œ Buffer åŸºæœ¬ä¿æŒä¸å˜")]),s._v(".")]),s._v(" "),a("p",[s._v("å†è¿›ä¸€æ­¥è§‚å¯Ÿ I/O çš„æƒ…å†µ, ä¼šçœ‹åˆ°:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("åœ¨ Cache åˆšå¼€å§‹å¢é•¿æ—¶, å—è®¾å¤‡ I/O å¾ˆå°‘, bi åªå‡ºç°äº†ä¸€æ¬¡ 488 KB/s, bo åˆ™åªæœ‰ä¸€æ¬¡ 4KB. è€Œè¿‡ä¸€æ®µæ—¶é—´å, æ‰ä¼šå‡ºç°å¤§é‡çš„å—è®¾å¤‡å†™, æ¯”å¦‚ bo å˜æˆäº† 122880")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("å½“ dd å‘½ä»¤ç»“æŸå, Cache ä¸å†å¢é•¿, ä½†å—è®¾å¤‡å†™è¿˜ä¼šæŒç»­ä¸€æ®µæ—¶é—´, å¹¶ä¸”, å¤šæ¬¡ I/O å†™çš„ç»“æœåŠ èµ·æ¥, æ‰æ˜¯ dd è¦å†™çš„ 500M çš„æ•°æ®")]),s._v(".")])]),s._v(" "),a("p",[s._v("æŠŠè¿™ä¸ªç»“æœ, è·Ÿåˆšåˆšäº†è§£åˆ°çš„ Cache çš„å®šä¹‰åšä¸ªå¯¹æ¯”, ä½ å¯èƒ½ä¼šæœ‰ç‚¹æ™•ä¹. ä¸ºä»€ä¹ˆå‰é¢æ–‡æ¡£ä¸Šè¯´ Cache æ˜¯æ–‡ä»¶è¯»çš„é¡µç¼“å­˜, æ€ä¹ˆç°åœ¨å†™æ–‡ä»¶ä¹Ÿæœ‰å®ƒçš„ä»½?")]),s._v(" "),a("p",[s._v("è¿™ä¸ªç–‘é—®æš‚ä¸”å…ˆè®°ä¸‹æ¥, æ¥ç€å†æ¥çœ‹"),a("strong",[s._v("å¦ä¸€ä¸ªç£ç›˜å†™çš„æ¡ˆä¾‹")]),s._v(". ä¸¤ä¸ªæ¡ˆä¾‹ç»“æŸå, å†ç»Ÿä¸€è¿›è¡Œåˆ†æ.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, å¯¹äºæ¥ä¸‹æ¥çš„æ¡ˆä¾‹, å¿…é¡»å¼ºè°ƒä¸€ç‚¹: ä¸‹é¢çš„å‘½ä»¤å¯¹ç¯å¢ƒè¦æ±‚å¾ˆé«˜, éœ€è¦ç³»ç»Ÿé…ç½®å¤šå—ç£ç›˜, å¹¶ä¸”ç£ç›˜åˆ†åŒº "),a("code",[s._v("/dev/sdb1")]),s._v("â€‹ è¿˜è¦å¤„äºæœªä½¿ç”¨çŠ¶æ€. å¦‚æœåªæœ‰ä¸€å—ç£ç›˜, åƒä¸‡ä¸è¦å°è¯•, å¦åˆ™å°†ä¼šå¯¹ä½ çš„ç£ç›˜åˆ†åŒºé€ æˆæŸå. å¦‚æœç³»ç»Ÿç¬¦åˆæ ‡å‡†, å°±å¯ä»¥ç»§ç»­åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­, è¿è¡Œä¸‹é¢çš„å‘½ä»¤. æ¸…ç†ç¼“å­˜å, å‘ç£ç›˜åˆ†åŒº "),a("code",[s._v("/dev/sdb1")]),s._v("â€‹ å†™å…¥ 2GB çš„éšæœºæ•°æ®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é¦–å…ˆæ¸…ç†ç¼“å­˜")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/vm/drop_caches\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç„¶åè¿è¡Œ dd å‘½ä»¤å‘ç£ç›˜åˆ†åŒº /dev/sdb1 å†™å…¥ 2G æ•°æ®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/urandom "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sdb1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç„¶å, å†å›åˆ°ç»ˆç«¯ä¸€, è§‚å¯Ÿå†…å­˜å’Œ I/O çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7584780")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153592")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97436")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("684")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("423")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7418580")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("315384")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101668")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("144")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7253664")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("475844")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106208")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7093352")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("631800")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110520")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("223")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6930056")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("790520")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114980")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12804")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("168")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6757204")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("949240")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("119396")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("183804")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("191")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6591516")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1107960")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123840")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77316")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("232")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œä¼šçœ‹åˆ°, è™½ç„¶"),a("strong",[s._v("åŒæ˜¯å†™æ•°æ®, å†™ç£ç›˜è·Ÿå†™æ–‡ä»¶çš„ç°è±¡è¿˜æ˜¯ä¸åŒçš„. å†™ç£ç›˜æ—¶(ä¹Ÿå°±æ˜¯ bo å¤§äº 0 æ—¶), Buffer å’Œ Cache éƒ½åœ¨å¢é•¿, ä½†æ˜¾ç„¶ Buffer çš„å¢é•¿å¿«å¾—å¤š")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™è¯´æ˜, å†™ç£ç›˜ç”¨åˆ°äº†å¤§é‡çš„ Buffer, è¿™è·Ÿåœ¨æ–‡æ¡£ä¸­æŸ¥åˆ°çš„å®šä¹‰æ˜¯ä¸€æ ·çš„.")]),s._v(" "),a("p",[s._v("å¯¹æ¯”ä¸¤ä¸ªæ¡ˆä¾‹, å¯ä»¥å‘ç°, "),a("strong",[s._v("å†™æ–‡ä»¶æ—¶ä¼šç”¨åˆ° Cache ç¼“å­˜æ•°æ®, è€Œå†™ç£ç›˜åˆ™ä¼šç”¨åˆ° Buffer æ¥ç¼“å­˜æ•°æ®")]),s._v(". æ‰€ä»¥, å›åˆ°åˆšåˆšçš„é—®é¢˜, è™½ç„¶æ–‡æ¡£ä¸Šåªæåˆ°, "),a("strong",[s._v("Cache æ˜¯æ–‡ä»¶è¯»çš„ç¼“å­˜, ä½†å®é™…ä¸Š, Cache ä¹Ÿä¼šç¼“å­˜å†™æ–‡ä»¶æ—¶çš„æ•°æ®")]),s._v(".")]),s._v(" "),a("h6",{attrs:{id:"_3-åœºæ™¯2-ç£ç›˜å’Œæ–‡ä»¶è¯»æ¡ˆä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-åœºæ™¯2-ç£ç›˜å’Œæ–‡ä»¶è¯»æ¡ˆä¾‹"}},[s._v("#")]),s._v(" (3)åœºæ™¯2:ç£ç›˜å’Œæ–‡ä»¶è¯»æ¡ˆä¾‹")]),s._v(" "),a("p",[s._v("äº†è§£äº†ç£ç›˜å’Œæ–‡ä»¶å†™çš„æƒ…å†µ, å†åè¿‡æ¥æƒ³, ç£ç›˜å’Œæ–‡ä»¶è¯»çš„æ—¶å€™, åˆæ˜¯æ€æ ·çš„å‘¢?")]),s._v(" "),a("p",[s._v("å›åˆ°ç¬¬äºŒä¸ªç»ˆç«¯, è¿è¡Œä¸‹é¢çš„å‘½ä»¤. æ¸…ç†ç¼“å­˜å, ä»æ–‡ä»¶ "),a("code",[s._v("/tmp/file")]),s._v("â€‹ ä¸­, è¯»å–æ•°æ®å†™å…¥ç©ºè®¾å¤‡:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é¦–å…ˆæ¸…ç†ç¼“å­˜")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/vm/drop_caches\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œ dd å‘½ä»¤è¯»å–æ–‡ä»¶æ•°æ®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/file "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç„¶å, å†å›åˆ°ç»ˆç«¯ä¸€, è§‚å¯Ÿå†…å­˜å’Œ I/O çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7724164")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110844")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16576")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("360")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("76")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7691544")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("143472")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32640")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("439")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7658736")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176204")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32640")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("407")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7626052")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("208908")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32640")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("422")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ vmstat çš„è¾“å‡º, ä¼šå‘ç°"),a("mark",[a("strong",[s._v("è¯»å–æ–‡ä»¶")])]),s._v("â€‹"),a("strong",[s._v("æ—¶(ä¹Ÿå°±æ˜¯ bi å¤§äº 0 æ—¶), Buffer ä¿æŒä¸å˜, è€Œ Cache åˆ™åœ¨ä¸åœå¢é•¿")]),s._v('. è¿™è·ŸæŸ¥åˆ°çš„å®šä¹‰ "Cache æ˜¯å¯¹æ–‡ä»¶è¯»çš„é¡µç¼“å­˜" æ˜¯ä¸€è‡´çš„.')]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, ç£ç›˜è¯»åˆæ˜¯ä»€ä¹ˆæƒ…å†µå‘¢? å†è¿è¡Œç¬¬äºŒä¸ªæ¡ˆä¾‹æ¥çœ‹çœ‹.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, å›åˆ°ç¬¬äºŒä¸ªç»ˆç«¯, è¿è¡Œä¸‹é¢çš„å‘½ä»¤. æ¸…ç†ç¼“å­˜å, ä»ç£ç›˜åˆ†åŒº "),a("code",[s._v("/dev/sda1")]),s._v("â€‹ ä¸­è¯»å–æ•°æ®, å†™å…¥ç©ºè®¾å¤‡:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é¦–å…ˆæ¸…ç†ç¼“å­˜")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/vm/drop_caches\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œ dd å‘½ä»¤è¯»å–æ–‡ä»¶")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sda1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç„¶å, å†å›åˆ°ç»ˆç«¯ä¸€, è§‚å¯Ÿå†…å­˜å’Œ I/O çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7225880")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2716")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("608184")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("159")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7199420")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28644")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("608228")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25928")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("252")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7167092")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60900")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("608312")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32256")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("269")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7134416")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93572")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("608376")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32672")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7101484")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("126320")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("608480")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32748")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("414")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ vmstat çš„è¾“å‡º, ä¼šå‘ç°"),a("mark",[a("strong",[s._v("è¯»ç£ç›˜")])]),s._v("â€‹"),a("strong",[s._v("æ—¶(ä¹Ÿå°±æ˜¯ bi å¤§äº 0 æ—¶), Buffer å’Œ Cache éƒ½åœ¨å¢é•¿, ä½†æ˜¾ç„¶ Buffer çš„å¢é•¿å¿«å¾ˆå¤š. è¿™è¯´æ˜è¯»ç£ç›˜æ—¶, æ•°æ®ç¼“å­˜åˆ°äº† Buffer ä¸­")]),s._v(".")]),s._v(" "),a("p",[s._v("ç»è¿‡ä¸Šä¸€ä¸ªåœºæ™¯ä¸­ä¸¤ä¸ªæ¡ˆä¾‹çš„åˆ†æ, ä½ è‡ªå·±ä¹Ÿå¯ä»¥å¯¹æ¯”å¾—å‡ºè¿™ä¸ªç»“è®º: "),a("strong",[s._v("è¯»æ–‡ä»¶æ—¶æ•°æ®ä¼šç¼“å­˜åˆ° Cache ä¸­, è€Œè¯»ç£ç›˜æ—¶æ•°æ®ä¼šç¼“å­˜åˆ° Buffer ä¸­")]),s._v(".")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œä½ åº”è¯¥å‘ç°äº†, è™½ç„¶æ–‡æ¡£æä¾›äº†å¯¹ Buffer å’Œ Cache çš„è¯´æ˜, ä½†æ˜¯"),a("strong",[s._v("ä»ä¸èƒ½è¦†ç›–åˆ°æ‰€æœ‰çš„ç»†èŠ‚")]),s._v(". æ¯”å¦‚è¯´, æœ¬èŠ‚äº†è§£åˆ°çš„è¿™ä¸¤ç‚¹:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v('Buffer æ—¢å¯ä»¥ç”¨ä½œ"å°†è¦å†™å…¥ç£ç›˜æ•°æ®çš„ç¼“å­˜", ä¹Ÿå¯ä»¥ç”¨ä½œ"ä»ç£ç›˜è¯»å–æ•°æ®çš„ç¼“å­˜".')])]),s._v(" "),a("li",[a("strong",[s._v('Cache æ—¢å¯ä»¥ç”¨ä½œ"ä»æ–‡ä»¶è¯»å–æ•°æ®çš„é¡µç¼“å­˜", ä¹Ÿå¯ä»¥ç”¨ä½œ"å†™æ–‡ä»¶çš„é¡µç¼“å­˜".')])])]),s._v(" "),a("p",[s._v("è¿™æ ·å°±å›ç­”äº†æ¡ˆä¾‹å¼€å§‹å‰çš„ä¸¤ä¸ªé—®é¢˜.")]),s._v(" "),a("p",[s._v("ç®€å•æ¥è¯´, "),a("mark",[a("strong",[s._v("Buffer æ˜¯å¯¹ç£ç›˜æ•°æ®çš„ç¼“å­˜, è€Œ Cache æ˜¯æ–‡ä»¶æ•°æ®çš„ç¼“å­˜, å®ƒä»¬æ—¢ä¼šç”¨åœ¨è¯»è¯·æ±‚ä¸­, ä¹Ÿä¼šç”¨åœ¨å†™è¯·æ±‚ä¸­")])]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-4"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚ä¸€èµ·æ¢ç´¢äº†å†…å­˜æ€§èƒ½ä¸­ Buffer å’Œ Cache çš„è¯¦ç»†å«ä¹‰. "),a("strong",[s._v("Buffer å’Œ Cache åˆ†åˆ«ç¼“å­˜ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™æ•°æ®")]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä»å†™çš„è§’åº¦æ¥è¯´, ä¸ä»…å¯ä»¥ä¼˜åŒ–ç£ç›˜å’Œæ–‡ä»¶çš„å†™å…¥, å¯¹åº”ç”¨ç¨‹åºä¹Ÿæœ‰å¥½å¤„, åº”ç”¨ç¨‹åºå¯ä»¥åœ¨æ•°æ®çœŸæ­£è½ç›˜å‰, å°±è¿”å›å»åšå…¶ä»–å·¥ä½œ.")])]),s._v(" "),a("li",[a("strong",[s._v("ä»è¯»çš„è§’åº¦æ¥è¯´, æ—¢å¯ä»¥åŠ é€Ÿè¯»å–é‚£äº›éœ€è¦é¢‘ç¹è®¿é—®çš„æ•°æ®, ä¹Ÿé™ä½äº†é¢‘ç¹ I/O å¯¹ç£ç›˜çš„å‹åŠ›.")])])]),s._v(" "),a("p",[s._v("é™¤äº†æ¢ç´¢çš„å†…å®¹æœ¬èº«, è¿™ä¸ªæ¢ç´¢è¿‡ç¨‹å¯¹ä½ åº”è¯¥ä¹Ÿæœ‰æ‰€å¯å‘. åœ¨æ’æŸ¥æ€§èƒ½é—®é¢˜æ—¶, ç”±äºå„ç§èµ„æºçš„æ€§èƒ½æŒ‡æ ‡å¤ªå¤š, ä¸å¯èƒ½è®°ä½æ‰€æœ‰æŒ‡æ ‡çš„è¯¦ç»†å«ä¹‰. é‚£ä¹ˆå‡†ç¡®é«˜æ•ˆçš„æ‰‹æ®µâ€”â€”æŸ¥æ–‡æ¡£, å°±éå¸¸é‡è¦äº†.")]),s._v(" "),a("p",[s._v("ä¸€å®šè¦å…»æˆæŸ¥æ–‡æ¡£çš„ä¹ æƒ¯, å¹¶å­¦ä¼šè§£è¯»è¿™äº›æ€§èƒ½æŒ‡æ ‡çš„è¯¦ç»†å«ä¹‰. æ­¤å¤–, proc æ–‡ä»¶ç³»ç»Ÿä¹Ÿæ˜¯å¥½å¸®æ‰‹. å®ƒä¸ºæˆ‘ä»¬å‘ˆç°äº†ç³»ç»Ÿå†…éƒ¨çš„è¿è¡ŒçŠ¶æ€, åŒæ—¶ä¹Ÿæ˜¯å¾ˆå¤šæ€§èƒ½å·¥å…·çš„æ•°æ®æ¥æº, æ˜¯è¾…åŠ©æ’æŸ¥æ€§èƒ½é—®é¢˜çš„å¥½æ–¹æ³•.")]),s._v(" "),a("h4",{attrs:{id:"_17-æ¡ˆä¾‹ç¯‡-å¦‚ä½•åˆ©ç”¨ç³»ç»Ÿç¼“å­˜ä¼˜åŒ–ç¨‹åºçš„è¿è¡Œæ•ˆç‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_17-æ¡ˆä¾‹ç¯‡-å¦‚ä½•åˆ©ç”¨ç³»ç»Ÿç¼“å­˜ä¼˜åŒ–ç¨‹åºçš„è¿è¡Œæ•ˆç‡"}},[s._v("#")]),s._v(" 17-æ¡ˆä¾‹ç¯‡:å¦‚ä½•åˆ©ç”¨ç³»ç»Ÿç¼“å­˜ä¼˜åŒ–ç¨‹åºçš„è¿è¡Œæ•ˆç‡?")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚å­¦ä¹ äº†å†…å­˜æ€§èƒ½ä¸­ Buffer å’Œ Cache çš„æ¦‚å¿µ. ç®€å•å¤ä¹ ä¸€ä¸‹, "),a("strong",[s._v("Buffer å’Œ Cache çš„è®¾è®¡ç›®çš„, æ˜¯ä¸ºäº†æå‡ç³»ç»Ÿçš„ I/O æ€§èƒ½. å®ƒä»¬åˆ©ç”¨å†…å­˜, å……å½“èµ·æ…¢é€Ÿç£ç›˜ä¸å¿«é€Ÿ CPU ä¹‹é—´çš„æ¡¥æ¢, å¯ä»¥åŠ é€Ÿ I/O çš„è®¿é—®é€Ÿåº¦")]),s._v(".")]),s._v(" "),a("p",[s._v("æ—¢ç„¶ Buffer å’Œ Cache å¯¹ç³»ç»Ÿæ€§èƒ½æœ‰å¾ˆå¤§å½±å“, é‚£åœ¨è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­, "),a("strong",[s._v("èƒ½ä¸èƒ½åˆ©ç”¨è¿™ä¸€ç‚¹, æ¥ä¼˜åŒ– I/O æ€§èƒ½, æå‡åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆç‡")]),s._v("å‘¢? ç­”æ¡ˆè‡ªç„¶æ˜¯è‚¯å®šçš„. æœ¬èŠ‚å°±ç”¨å‡ ä¸ªæ¡ˆä¾‹å¸®åŠ©ç†è§£ç¼“å­˜çš„ä½œç”¨, å¹¶å­¦ä¹ å¦‚ä½•å……åˆ†åˆ©ç”¨è¿™äº›ç¼“å­˜æ¥æé«˜ç¨‹åºæ•ˆç‡.")]),s._v(" "),a("h5",{attrs:{id:"_1-ç¼“å­˜å‘½ä¸­ç‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç¼“å­˜å‘½ä¸­ç‡"}},[s._v("#")]),s._v(" 1.ç¼“å­˜å‘½ä¸­ç‡")]),s._v(" "),a("p",[s._v("åœ¨æ¡ˆä¾‹å¼€å§‹å‰, ä½ åº”è¯¥ä¹ æƒ¯æ€§åœ°å…ˆé—®è‡ªå·±ä¸€ä¸ªé—®é¢˜, ä½ æƒ³"),a("strong",[s._v("è¦åšæˆæŸä»¶äº‹æƒ…, ç»“æœåº”è¯¥æ€ä¹ˆè¯„ä¼°")]),s._v("? æ¯”å¦‚æƒ³åˆ©ç”¨ç¼“å­˜æ¥æå‡ç¨‹åºçš„è¿è¡Œæ•ˆç‡, åº”è¯¥æ€ä¹ˆè¯„ä¼°è¿™ä¸ªæ•ˆæœå‘¢? æ¢å¥è¯è¯´, æœ‰æ²¡æœ‰å“ªä¸ªæŒ‡æ ‡å¯ä»¥è¡¡é‡ç¼“å­˜ä½¿ç”¨çš„å¥½åå‘¢?")]),s._v(" "),a("p",[s._v("æˆ‘ä¼°è®¡ä½ å·²ç»æƒ³åˆ°äº†, "),a("strong",[s._v("ç¼“å­˜çš„å‘½ä¸­ç‡")]),s._v(". æ‰€è°“ç¼“å­˜å‘½ä¸­ç‡, æ˜¯æŒ‡ç›´æ¥é€šè¿‡ç¼“å­˜è·å–æ•°æ®çš„è¯·æ±‚æ¬¡æ•°, å æ‰€æœ‰æ•°æ®è¯·æ±‚æ¬¡æ•°çš„ç™¾åˆ†æ¯”.")]),s._v(" "),a("p",[s._v("**å‘½ä¸­ç‡è¶Šé«˜, è¡¨ç¤ºä½¿ç”¨ç¼“å­˜å¸¦æ¥çš„æ”¶ç›Šè¶Šé«˜, åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¹Ÿå°±è¶Šå¥½. **")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, ç¼“å­˜æ˜¯ç°åœ¨æ‰€æœ‰é«˜å¹¶å‘ç³»ç»Ÿå¿…éœ€çš„æ ¸å¿ƒæ¨¡å—, ä¸»è¦ä½œç”¨å°±æ˜¯æŠŠç»å¸¸è®¿é—®çš„æ•°æ®(ä¹Ÿå°±æ˜¯çƒ­ç‚¹æ•°æ®), æå‰è¯»å…¥åˆ°å†…å­˜ä¸­. è¿™æ ·, ä¸‹æ¬¡è®¿é—®æ—¶å°±å¯ä»¥ç›´æ¥ä»å†…å­˜è¯»å–æ•°æ®, è€Œä¸éœ€è¦ç»è¿‡ç¡¬ç›˜, ä»è€ŒåŠ å¿«åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦.")]),s._v(" "),a("p",[s._v("è¿™äº›ç‹¬ç«‹çš„ç¼“å­˜æ¨¡å—é€šå¸¸ä¼šæä¾›æŸ¥è¯¢æ¥å£, æ–¹ä¾¿éšæ—¶æŸ¥çœ‹ç¼“å­˜çš„å‘½ä¸­æƒ…å†µ. ä¸è¿‡ Linux ç³»ç»Ÿä¸­å¹¶æ²¡æœ‰ç›´æ¥æä¾›è¿™äº›æ¥å£, æ‰€ä»¥è¿™é‡Œè¦ä»‹ç»ä¸€ä¸‹, "),a("strong",[s._v("cachestat å’Œ cachetop æ­£æ˜¯æŸ¥çœ‹ç³»ç»Ÿç¼“å­˜å‘½ä¸­æƒ…å†µçš„å·¥å…·")]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("mark",[a("strong",[s._v("cachestat æä¾›äº†æ•´ä¸ªæ“ä½œç³»ç»Ÿç¼“å­˜çš„è¯»å†™å‘½ä¸­æƒ…å†µ.")])])]),s._v(" "),a("li",[a("mark",[a("strong",[s._v("cachetop æä¾›äº†æ¯ä¸ªè¿›ç¨‹çš„ç¼“å­˜å‘½ä¸­æƒ…å†µ.")])])])]),s._v(" "),a("p",[s._v("è¿™ä¸¤ä¸ªå·¥å…·éƒ½æ˜¯ "),a("a",{attrs:{href:"https://github.com/iovisor/bcc",target:"_blank",rel:"noopener noreferrer"}},[s._v("bcc"),a("OutboundLink")],1),s._v(" è½¯ä»¶åŒ…çš„ä¸€éƒ¨åˆ†, å®ƒä»¬åŸºäº Linux å†…æ ¸çš„ eBPF(extended Berkeley Packet Filters)æœºåˆ¶, æ¥è·Ÿè¸ªå†…æ ¸ä¸­ç®¡ç†çš„ç¼“å­˜, å¹¶è¾“å‡ºç¼“å­˜çš„ä½¿ç”¨å’Œå‘½ä¸­æƒ…å†µ.")]),s._v(" "),a("p",[s._v("è¿™é‡Œæ³¨æ„, eBPF çš„å·¥ä½œåŸç†ä¸æ˜¯æœ¬èŠ‚çš„é‡ç‚¹, è®°ä½è¿™ä¸ªåå­—å³å¯, åé¢è¿˜ä¼šè¯¦ç»†å­¦ä¹ . æœ¬èŠ‚è¦æŒæ¡çš„æ˜¯è¿™ä¸¤ä¸ªå·¥å…·çš„ä½¿ç”¨æ–¹æ³•. æ³¨æ„ä½¿ç”¨ cachestat å’Œ cachetop å‰, éœ€è¦å®‰è£… bcc è½¯ä»¶åŒ….")]),s._v(" "),a("p",[s._v("æ“ä½œå®Œè¿™äº›æ­¥éª¤, bcc æä¾›çš„æ‰€æœ‰å·¥å…·å°±éƒ½å®‰è£…åˆ° "),a("code",[s._v("/usr/share/bcc/tools")]),s._v("â€‹ è¿™ä¸ªç›®å½•ä¸­äº†. ä¸è¿‡è¿™é‡Œæé†’ä½ , bcc è½¯ä»¶åŒ…é»˜è®¤ä¸ä¼šæŠŠè¿™äº›å·¥å…·é…ç½®åˆ°ç³»ç»Ÿçš„ PATH è·¯å¾„ä¸­, æ‰€ä»¥å¾—è‡ªå·±æ‰‹åŠ¨é…ç½®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/share/bcc/tools\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("é…ç½®å®Œå°±å¯ä»¥è¿è¡Œ cachestat å’Œ cachetop å‘½ä»¤äº†. æ¯”å¦‚, ä¸‹é¢å°±æ˜¯ä¸€ä¸ª cachestat çš„è¿è¡Œç•Œé¢, å®ƒä»¥ 1 ç§’çš„æ—¶é—´é—´éš”, è¾“å‡ºäº† 3 ç»„ç¼“å­˜ç»Ÿè®¡æ•°æ®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ cachestat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n   TOTAL   MISSES     HITS  DIRTIES   BUFFERS_MB  CACHED_MB\n       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("279")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("279")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("279")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, cachestat çš„è¾“å‡ºå…¶å®æ˜¯ä¸€ä¸ªè¡¨æ ¼. æ¯è¡Œä»£è¡¨ä¸€ç»„æ•°æ®, è€Œæ¯ä¸€åˆ—ä»£è¡¨ä¸åŒçš„"),a("strong",[s._v("ç¼“å­˜ç»Ÿè®¡æŒ‡æ ‡")]),s._v(". è¿™äº›æŒ‡æ ‡ä»å·¦åˆ°å³ä¾æ¬¡è¡¨ç¤º:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("TOTAL, è¡¨ç¤ºæ€»çš„ I/O æ¬¡æ•°;")])]),s._v(" "),a("li",[a("strong",[s._v("MISSES, è¡¨ç¤ºç¼“å­˜æœªå‘½ä¸­çš„æ¬¡æ•°;")])]),s._v(" "),a("li",[a("strong",[s._v("HITS, è¡¨ç¤ºç¼“å­˜å‘½ä¸­çš„æ¬¡æ•°;")])]),s._v(" "),a("li",[a("strong",[s._v("DIRTIES, è¡¨ç¤ºæ–°å¢åˆ°ç¼“å­˜ä¸­çš„è„é¡µæ•°;")])]),s._v(" "),a("li",[a("strong",[s._v("BUFFERS_MB è¡¨ç¤º Buffers çš„å¤§å°, ä»¥ MB ä¸ºå•ä½;")])]),s._v(" "),a("li",[a("strong",[s._v("CACHED_MB è¡¨ç¤º Cache çš„å¤§å°, ä»¥ MB ä¸ºå•ä½.")])])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†æ¥çœ‹ä¸€ä¸ª cachetop çš„è¿è¡Œç•Œé¢:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$ cachetop\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("58")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" Buffers "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MB")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("258")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" Cached "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MB")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("347")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" Sort"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HITS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" Order"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ascending\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PID")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UID")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CMD")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HITS")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MISSES")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DIRTIES")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READ_HIT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WRITE_HIT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13029")]),s._v(" root     python                  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("å®ƒçš„è¾“å‡ºè·Ÿ top ç±»ä¼¼, é»˜è®¤æŒ‰ç…§"),a("strong",[s._v("ç¼“å­˜çš„å‘½ä¸­æ¬¡æ•°(HITS)æ’åº")]),s._v(", å±•ç¤ºäº†æ¯ä¸ªè¿›ç¨‹çš„ç¼“å­˜å‘½ä¸­æƒ…å†µ. å…·ä½“åˆ°æ¯ä¸€ä¸ªæŒ‡æ ‡, è¿™é‡Œçš„ HITS, MISSES å’Œ DIRTIES, è·Ÿ cachestat é‡Œçš„å«ä¹‰ä¸€æ ·, åˆ†åˆ«ä»£è¡¨é—´éš”æ—¶é—´å†…çš„ç¼“å­˜å‘½ä¸­æ¬¡æ•°, æœªå‘½ä¸­æ¬¡æ•°ä»¥åŠæ–°å¢åˆ°ç¼“å­˜ä¸­çš„è„é¡µæ•°.")]),s._v(" "),a("p",[s._v("è€Œ READ_HIT å’Œ WRITE_HIT, åˆ†åˆ«è¡¨ç¤º"),a("strong",[s._v("è¯»å’Œå†™çš„ç¼“å­˜å‘½ä¸­ç‡")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_2-æŒ‡å®šæ–‡ä»¶çš„ç¼“å­˜å¤§å°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æŒ‡å®šæ–‡ä»¶çš„ç¼“å­˜å¤§å°"}},[s._v("#")]),s._v(" 2.æŒ‡å®šæ–‡ä»¶çš„ç¼“å­˜å¤§å°")]),s._v(" "),a("p",[s._v("é™¤äº†ç¼“å­˜çš„å‘½ä¸­ç‡å¤–, è¿˜æœ‰ä¸€ä¸ªæŒ‡æ ‡ä½ å¯èƒ½ä¹Ÿä¼šå¾ˆæ„Ÿå…´è¶£, é‚£å°±æ˜¯"),a("strong",[s._v("æŒ‡å®šæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„ç¼“å­˜å¤§å°")]),s._v(". å¯ä»¥"),a("strong",[s._v("ä½¿ç”¨ pcstat è¿™ä¸ªå·¥å…·, æ¥æŸ¥çœ‹æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„ç¼“å­˜å¤§å°ä»¥åŠç¼“å­˜æ¯”ä¾‹")]),s._v(".")]),s._v(" "),a("p",[s._v("pcstat æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„å·¥å…·, æ‰€ä»¥å®‰è£…å®ƒä¹‹å‰, é¦–å…ˆåº”è¯¥å®‰è£… Go è¯­è¨€.")]),s._v(" "),a("p",[s._v("å®‰è£…å®Œ Go è¯­è¨€, å†è¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… pcstat:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GOPATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("go\n$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("go"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("$"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PATH")]),s._v("\n$ go "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" golang"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("unix\n$ go "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tobert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pcstat"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pcstat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("å…¨éƒ¨å®‰è£…å®Œæˆå, å°±å¯ä»¥è¿è¡Œ pcstat æ¥æŸ¥çœ‹æ–‡ä»¶çš„ç¼“å­˜æƒ…å†µäº†. æ¯”å¦‚, ä¸‹é¢å°±æ˜¯ä¸€ä¸ª pcstat è¿è¡Œçš„ç¤ºä¾‹, å®ƒå±•ç¤ºäº† "),a("code",[s._v("/bin/ls")]),s._v("â€‹ è¿™ä¸ªæ–‡ä»¶çš„ç¼“å­˜æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$ pcstat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ls\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Pages      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Cached    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Percent "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ls "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("133792")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("000.000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè¾“å‡ºä¸­, Cached å°±æ˜¯ "),a("code",[s._v("/bin/ls")]),s._v("â€‹ åœ¨ç¼“å­˜ä¸­çš„å¤§å°, è€Œ Percent åˆ™æ˜¯ç¼“å­˜çš„ç™¾åˆ†æ¯”. ä½ çœ‹åˆ°å®ƒä»¬éƒ½æ˜¯ 0, è¿™è¯´æ˜ "),a("code",[s._v("/bin/ls")]),s._v("â€‹ å¹¶ä¸åœ¨ç¼“å­˜ä¸­.")]),s._v(" "),a("p",[s._v("æ¥ç€, å¦‚æœæ‰§è¡Œä¸€ä¸‹ ls å‘½ä»¤, å†è¿è¡Œç›¸åŒçš„å‘½ä»¤æ¥æŸ¥çœ‹çš„è¯, å°±ä¼šå‘ç° "),a("code",[s._v("/bin/ls")]),s._v("â€‹ éƒ½åœ¨ç¼“å­˜ä¸­äº†:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$ ls\n$ pcstat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ls\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Pages      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Cached    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Percent "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ls "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("133792")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("çŸ¥é“äº†ç¼“å­˜ç›¸åº”çš„æŒ‡æ ‡å’ŒæŸ¥çœ‹ç³»ç»Ÿç¼“å­˜çš„æ–¹æ³•å, æ¥ä¸‹æ¥å°±è¿›å…¥ä»Šå¤©çš„æ­£å¼æ¡ˆä¾‹.")]),s._v(" "),a("p",[s._v("è·Ÿå‰é¢çš„æ¡ˆä¾‹ä¸€æ ·, ä»Šå¤©çš„æ¡ˆä¾‹ä¹Ÿæ˜¯åŸºäº Ubuntu 18.04, å½“ç„¶åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ.")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤å®‰è£… bcc å’Œ pcstat è½¯ä»¶åŒ…, å¹¶æŠŠè¿™äº›å·¥å…·çš„å®‰è£…è·¯å¾„æ·»åŠ åˆ°åˆ° PATH ç¯å¢ƒå˜é‡ä¸­.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… Docker è½¯ä»¶åŒ…, æ¯”å¦‚ apt-get install docker.io")])]),s._v(" "),a("h5",{attrs:{id:"_3-æ¡ˆä¾‹ä¸€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¡ˆä¾‹ä¸€"}},[s._v("#")]),s._v(" 3.æ¡ˆä¾‹ä¸€")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ä¸ªæ¡ˆä¾‹å…ˆæ¥çœ‹ä¸€ä¸‹ä¸Šä¸€èŠ‚æåˆ°çš„ dd å‘½ä»¤. dd ä½œä¸ºä¸€ä¸ªç£ç›˜å’Œæ–‡ä»¶çš„æ‹·è´å·¥å…·, ç»å¸¸è¢«æ‹¿æ¥æµ‹è¯•ç£ç›˜æˆ–è€…æ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™æ€§èƒ½. ä¸è¿‡, æ—¢ç„¶ç¼“å­˜ä¼šå½±å“åˆ°æ€§èƒ½, "),a("strong",[s._v("å¦‚æœç”¨ dd å¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå¤šæ¬¡è¯»å–æµ‹è¯•, æµ‹è¯•çš„ç»“æœä¼šæ€ä¹ˆæ ·å‘¢")]),s._v("?")]),s._v(" "),a("p",[s._v("æ¥åŠ¨æ‰‹è¯•è¯•. é¦–å…ˆæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯, è¿æ¥åˆ° Ubuntu æœºå™¨ä¸Š, ç¡®ä¿ bcc å·²ç»å®‰è£…é…ç½®æˆåŠŸ. ç„¶å, ä½¿ç”¨ dd å‘½ä»¤"),a("strong",[s._v("ç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶")]),s._v(", ç”¨äºåé¢çš„æ–‡ä»¶è¯»å–æµ‹è¯•:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”Ÿæˆä¸€ä¸ª 512MB çš„ä¸´æ—¶æ–‡ä»¶")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sda1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¸…ç†ç¼“å­˜")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/vm/drop_caches\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç»§ç»­åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯, è¿è¡Œ pcstat å‘½ä»¤, ç¡®è®¤åˆšåˆš"),a("strong",[s._v("ç”Ÿæˆçš„æ–‡ä»¶ä¸åœ¨ç¼“å­˜")]),s._v("ä¸­. å¦‚æœä¸€åˆ‡æ­£å¸¸, ä¼šçœ‹åˆ° Cached å’Œ Percent éƒ½æ˜¯ 0:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pcstat "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n+-------+----------------+------------+-----------+---------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Name  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Size "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Pages      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Cached    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Percent "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-------+----------------+------------+-----------+---------"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("536870912")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 000.000 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------+----------------+------------+-----------+---------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è¿˜æ˜¯åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­, ç°åœ¨è¿è¡Œ cachetop å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 5 ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®")]),s._v("\n$ cachetop "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("è¿™æ¬¡æ˜¯ç¬¬äºŒä¸ªç»ˆç«¯, è¿è¡Œ dd å‘½ä»¤æµ‹è¯•æ–‡ä»¶çš„"),a("strong",[s._v("è¯»å–é€Ÿåº¦")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("+0 records "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("+0 records out\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("536870912")]),s._v(" bytes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("537")]),s._v(" MB, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(" MiB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" copied, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.0509")]),s._v(" s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33.4")]),s._v(" MB/s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä» dd çš„ç»“æœå¯ä»¥çœ‹å‡º, è¿™ä¸ªæ–‡ä»¶çš„è¯»æ€§èƒ½æ˜¯ 33.4 MB/s. ç”±äºåœ¨ dd å‘½ä»¤è¿è¡Œå‰å·²ç»æ¸…ç†äº†ç¼“å­˜, æ‰€ä»¥ dd å‘½ä»¤è¯»å–æ•°æ®æ—¶, è‚¯å®šè¦"),a("strong",[s._v("é€šè¿‡æ–‡ä»¶ç³»ç»Ÿä»ç£ç›˜ä¸­è¯»å–")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€, dd æ‰€æœ‰çš„è¯»è¯·æ±‚éƒ½èƒ½ç›´æ¥å‘é€åˆ°ç£ç›˜å‘¢?")]),s._v(" "),a("p",[s._v("å†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯, æŸ¥çœ‹ cachetop ç•Œé¢çš„ç¼“å­˜å‘½ä¸­æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("PID      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3264")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37077")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37330")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49.8")]),s._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50.2")]),s._v("%\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä» cachetop çš„ç»“æœå¯ä»¥å‘ç°, "),a("strong",[s._v("å¹¶ä¸æ˜¯æ‰€æœ‰çš„è¯»éƒ½è½åˆ°äº†ç£ç›˜ä¸Š, äº‹å®ä¸Šè¯»è¯·æ±‚çš„ç¼“å­˜å‘½ä¸­ç‡åªæœ‰ 50%")]),s._v(" .")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, ç»§ç»­å°è¯•ç›¸åŒçš„æµ‹è¯•å‘½ä»¤. å…ˆåˆ‡æ¢åˆ°ç¬¬äºŒä¸ªç»ˆç«¯, å†æ¬¡æ‰§è¡Œåˆšæ‰çš„ dd å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("+0 records "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("+0 records out\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("536870912")]),s._v(" bytes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("537")]),s._v(" MB, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(" MiB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" copied, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.118415")]),s._v(" s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.5")]),s._v(" GB/s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("çœ‹åˆ°è¿™æ¬¡çš„ç»“æœ, æœ‰æ²¡æœ‰ç‚¹å°æƒŠè®¶? ç£ç›˜çš„è¯»æ€§èƒ½å±…ç„¶å˜æˆäº† "),a("strong",[s._v("4.5 GB/s")]),s._v(", æ¯”ç¬¬ä¸€æ¬¡çš„ç»“æœæ˜æ˜¾é«˜äº†å¤ªå¤š. ä¸ºä»€ä¹ˆè¿™æ¬¡çš„ç»“æœè¿™ä¹ˆå¥½å‘¢?")]),s._v(" "),a("p",[s._v("ä¸å¦¨å†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯, çœ‹çœ‹ cachetop çš„æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":45:22 Buffers MB: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" / Cached MB: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("719")]),s._v(" / Sort: HITS / Order: ascending\nPID      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32642")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v("                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131637")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ˜¾ç„¶, cachetop ä¹Ÿæœ‰äº†ä¸å°çš„å˜åŒ–. å¯ä»¥å‘ç°, è¿™æ¬¡çš„è¯»çš„ç¼“å­˜å‘½ä¸­ç‡æ˜¯ 100.0%, ä¹Ÿå°±æ˜¯è¯´"),a("strong",[s._v("è¿™æ¬¡çš„ dd å‘½ä»¤å…¨éƒ¨å‘½ä¸­äº†ç¼“å­˜, æ‰€ä»¥æ‰ä¼šçœ‹åˆ°é‚£ä¹ˆé«˜çš„æ€§èƒ½")]),s._v(".")]),s._v(" "),a("p",[s._v("ç„¶å, å›åˆ°ç¬¬äºŒä¸ªç»ˆç«¯, å†æ¬¡æ‰§è¡Œ pcstat æŸ¥çœ‹æ–‡ä»¶ file çš„ç¼“å­˜æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pcstat "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n+-------+----------------+------------+-----------+---------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Name  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Size "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Pages      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Cached    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Percent "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-------+----------------+------------+-----------+---------"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("536870912")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------+----------------+------------+-----------+---------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ä» pcstat çš„ç»“æœå¯ä»¥å‘ç°, "),a("strong",[s._v("æµ‹è¯•æ–‡ä»¶ file å·²ç»è¢«å…¨éƒ¨ç¼“å­˜äº†èµ·æ¥")]),s._v(", è¿™è·Ÿåˆšæ‰è§‚å¯Ÿåˆ°çš„ç¼“å­˜å‘½ä¸­ç‡ 100% æ˜¯ä¸€è‡´çš„.")]),s._v(" "),a("p",[s._v("è¿™ä¸¤æ¬¡ç»“æœè¯´æ˜, "),a("strong",[s._v("ç³»ç»Ÿç¼“å­˜å¯¹ç¬¬äºŒæ¬¡ dd æ“ä½œæœ‰æ˜æ˜¾çš„åŠ é€Ÿæ•ˆæœ, å¯ä»¥å¤§å¤§æé«˜æ–‡ä»¶è¯»å–çš„æ€§èƒ½")]),s._v(".")]),s._v(" "),a("p",[s._v("ä½†åŒæ—¶ä¹Ÿè¦æ³¨æ„, å¦‚æœæŠŠ dd å½“æˆæµ‹è¯•æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½çš„å·¥å…·, ç”±äºç¼“å­˜çš„å­˜åœ¨, å°±ä¼šå¯¼è‡´æµ‹è¯•ç»“æœä¸¥é‡å¤±çœŸ.")]),s._v(" "),a("h5",{attrs:{id:"_4-æ¡ˆä¾‹äºŒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ¡ˆä¾‹äºŒ"}},[s._v("#")]),s._v(" 4.æ¡ˆä¾‹äºŒ")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†æ¥çœ‹ä¸€ä¸ª"),a("strong",[s._v("æ–‡ä»¶è¯»å†™")]),s._v("çš„æ¡ˆä¾‹. è¿™ä¸ªæ¡ˆä¾‹ç±»ä¼¼äºå‰é¢å­¦è¿‡çš„ä¸å¯ä¸­æ–­çŠ¶æ€è¿›ç¨‹çš„ä¾‹å­. å®ƒçš„åŸºæœ¬åŠŸèƒ½æ¯”è¾ƒç®€å•, ä¹Ÿå°±æ˜¯æ¯ç§’ä»ç£ç›˜åˆ†åŒº "),a("code",[s._v("/dev/sda1")]),s._v("â€‹ ä¸­è¯»å– 32MB çš„æ•°æ®, å¹¶æ‰“å°å‡ºè¯»å–æ•°æ®èŠ±è´¹çš„æ—¶é—´.")]),s._v(" "),a("p",[s._v("ä¸ºäº†æ–¹ä¾¿è¿è¡Œæ¡ˆä¾‹, æˆ‘æŠŠå®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ª "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/tree/master/io-cached",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker é•œåƒ"),a("OutboundLink")],1),s._v(". è·Ÿå‰é¢æ¡ˆä¾‹ç±»ä¼¼, æˆ‘æä¾›äº†ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹, å¯ä»¥æ ¹æ®ç³»ç»Ÿé…ç½®, è‡ªè¡Œè°ƒæ•´ç£ç›˜åˆ†åŒºçš„è·¯å¾„ä»¥åŠ I/O çš„å¤§å°.")]),s._v(" "),a("ul",[a("li",[s._v("-d é€‰é¡¹, è®¾ç½®è¦è¯»å–çš„ç£ç›˜æˆ–åˆ†åŒºè·¯å¾„, é»˜è®¤æ˜¯æŸ¥æ‰¾å‰ç¼€ä¸º "),a("code",[s._v("/dev/sd")]),s._v("â€‹ æˆ–è€… "),a("code",[s._v("/dev/xvd")]),s._v("â€‹ çš„ç£ç›˜.")]),s._v(" "),a("li",[s._v("-s é€‰é¡¹, è®¾ç½®æ¯æ¬¡è¯»å–çš„æ•°æ®é‡å¤§å°, å•ä½ä¸ºå­—èŠ‚, é»˜è®¤ä¸º 33554432(ä¹Ÿå°±æ˜¯ 32MB).")])]),s._v(" "),a("p",[s._v("è¿™ä¸ªæ¡ˆä¾‹åŒæ ·éœ€è¦å¼€å¯ä¸¤ä¸ªç»ˆç«¯. åˆ†åˆ« SSH ç™»å½•åˆ°æœºå™¨ä¸Šå, å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ cachetop å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 5 ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®")]),s._v("\n$ cachetop "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ç€, å†åˆ°ç¬¬äºŒä¸ªç»ˆç«¯, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿è¡Œæ¡ˆä¾‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/app:io-direct\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ¡ˆä¾‹è¿è¡Œå, è¿˜éœ€è¦è¿è¡Œä¸‹é¢è¿™ä¸ªå‘½ä»¤, æ¥ç¡®è®¤æ¡ˆä¾‹å·²ç»æ­£å¸¸å¯åŠ¨. å¦‚æœä¸€åˆ‡æ­£å¸¸, åº”è¯¥å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs app\nReading data from disk /dev/sdb1 with buffer size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33554432")]),s._v("\nTime used: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.929935")]),s._v(" s to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33554432")]),s._v(" bytes\nTime used: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.949625")]),s._v(" s to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33554432")]),s._v(" bytes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°, æ¯è¯»å– 32 MB çš„æ•°æ®, å°±éœ€è¦èŠ± 0.9 ç§’. è¿™ä¸ªæ—¶é—´åˆç†å—? æˆ‘æƒ³ä½ ç¬¬ä¸€ååº”å°±æ˜¯, å¤ªæ…¢äº†å§. é‚£è¿™æ˜¯ä¸æ˜¯æ²¡ç”¨ç³»ç»Ÿç¼“å­˜å¯¼è‡´çš„å‘¢?")]),s._v(" "),a("p",[s._v("å†æ¥æ£€æŸ¥ä¸€ä¸‹. å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯, å…ˆçœ‹çœ‹ cachetop çš„è¾“å‡º, åœ¨è¿™é‡Œæ‰¾åˆ°æ¡ˆä¾‹è¿›ç¨‹ app çš„ç¼“å­˜ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":39:18 Buffers MB: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(" / Cached MB: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("281")]),s._v(" / Sort: HITS / Order: ascending\nPID      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21881")]),s._v(" root     app                  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("% \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè¾“å‡ºä¼¼ä¹æœ‰ç‚¹æ„æ€äº†. 1024 æ¬¡ç¼“å­˜å…¨éƒ¨å‘½ä¸­, "),a("strong",[s._v("è¯»çš„å‘½ä¸­ç‡æ˜¯ 100%, çœ‹èµ·æ¥å…¨éƒ¨çš„è¯»è¯·æ±‚éƒ½ç»è¿‡äº†ç³»ç»Ÿç¼“å­˜")]),s._v(". ä½†æ˜¯é—®é¢˜åˆæ¥äº†, å¦‚æœçœŸçš„éƒ½æ˜¯ç¼“å­˜ I/O, è¯»å–é€Ÿåº¦ä¸åº”è¯¥è¿™ä¹ˆæ…¢.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¯è¯´å›æ¥, æˆ‘ä»¬ä¼¼ä¹"),a("strong",[s._v("å¿½ç•¥äº†å¦ä¸€ä¸ªé‡è¦å› ç´ , æ¯ç§’å®é™…è¯»å–çš„æ•°æ®å¤§å°. HITS ä»£è¡¨ç¼“å­˜çš„å‘½ä¸­æ¬¡æ•°, é‚£ä¹ˆæ¯æ¬¡å‘½ä¸­èƒ½è¯»å–å¤šå°‘æ•°æ®å‘¢? è‡ªç„¶æ˜¯ä¸€é¡µ")]),s._v(".")]),s._v(" "),a("p",[s._v("å‰é¢è®²è¿‡, "),a("strong",[s._v("å†…å­˜ä»¥é¡µä¸ºå•ä½è¿›è¡Œç®¡ç†, è€Œæ¯ä¸ªé¡µçš„å¤§å°æ˜¯ 4KB")]),s._v(". æ‰€ä»¥, åœ¨ 5 ç§’çš„æ—¶é—´é—´éš”é‡Œ, å‘½ä¸­çš„ç¼“å­˜ä¸º 1024*4K/1024 = 4MB, å†é™¤ä»¥ 5 ç§’, å¯ä»¥å¾—åˆ°æ¯ç§’è¯»çš„ç¼“å­˜æ˜¯ 0.8MB, æ˜¾ç„¶è·Ÿæ¡ˆä¾‹åº”ç”¨çš„ 32 MB/s ç›¸å·®å¤ªå¤š.")]),s._v(" "),a("p",[s._v("è‡³äºä¸ºä»€ä¹ˆåªèƒ½çœ‹åˆ° 0.8 MB çš„ HITS, è¿™ä¸ªåé¢å†è§£é‡Š, è¿™é‡Œå…ˆçŸ¥é“æ€ä¹ˆæ ¹æ®ç»“æœæ¥åˆ†æå°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v("è¿™ä¹Ÿè¿›ä¸€æ­¥éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³, è¿™ä¸ªæ¡ˆä¾‹ä¼°è®¡æ²¡æœ‰å……åˆ†åˆ©ç”¨ç³»ç»Ÿç¼“å­˜. å…¶å®å‰é¢é‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜, å¦‚æœä¸ºç³»ç»Ÿè°ƒç”¨è®¾ç½®ç›´æ¥ I/O çš„æ ‡å¿—, å°±å¯ä»¥ç»•è¿‡ç³»ç»Ÿç¼“å­˜.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, è¦åˆ¤æ–­åº”ç”¨ç¨‹åºæ˜¯å¦ç”¨äº†ç›´æ¥ I/O, æœ€ç®€å•çš„æ–¹æ³•å½“ç„¶æ˜¯è§‚å¯Ÿå®ƒçš„"),a("strong",[s._v("ç³»ç»Ÿè°ƒç”¨")]),s._v(", æŸ¥æ‰¾åº”ç”¨ç¨‹åºåœ¨è°ƒç”¨å®ƒä»¬æ—¶çš„é€‰é¡¹. ä½¿ç”¨ä»€ä¹ˆå·¥å…·æ¥è§‚å¯Ÿç³»ç»Ÿè°ƒç”¨å‘¢? è‡ªç„¶è¿˜æ˜¯ "),a("strong",[s._v("strace")]),s._v(".")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯äºŒä¸­è¿è¡Œä¸‹é¢çš„ strace å‘½ä»¤, è§‚å¯Ÿæ¡ˆä¾‹åº”ç”¨çš„ç³»ç»Ÿè°ƒç”¨æƒ…å†µ. æ³¨æ„, è¿™é‡Œä½¿ç”¨äº† pgrep å‘½ä»¤æ¥æŸ¥æ‰¾æ¡ˆä¾‹è¿›ç¨‹çš„ PID å·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# strace -p $(pgrep app)")]),s._v("\nstrace: Process "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4988")]),s._v(" attached\nrestart_syscall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(". resuming interrupted nanosleep "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nopenat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AT_FDCWD, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/sdb1"')]),s._v(", O_RDONLY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("O_DIRECT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nmmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NULL, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33558528")]),s._v(", PROT_READ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("PROT_WRITE, MAP_PRIVATE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("MAP_ANONYMOUS, -1, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0x7f448d240000\nread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8vq'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\213"}},[s._v("\\213")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\314"}},[s._v("\\314")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\264"}},[s._v("\\264")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\373"}},[s._v("\\373")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\4"}},[s._v("\\4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\336"}},[s._v("\\336")]),s._v("K"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\224"}},[s._v("\\224")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\25"}},[s._v("\\25")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\371"}},[s._v("\\371")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\1"}},[s._v("\\1")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\252"}},[s._v("\\252")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\2"}},[s._v("\\2")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\262"}},[s._v("\\262")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\252"}},[s._v("\\252")]),s._v("q"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\221"}},[s._v("\\221")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("0"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\30"}},[s._v("\\30")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\225"}},[s._v("\\225")]),s._v("bD"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\252"}},[s._v("\\252")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\266"}},[s._v("\\266")]),s._v('@J"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33554432")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33554432")]),s._v("\nwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Time used: 0.948897 s to read 33"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("\nclose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä» strace çš„ç»“æœå¯ä»¥çœ‹åˆ°, æ¡ˆä¾‹åº”ç”¨è°ƒç”¨äº† openat æ¥æ‰“å¼€ç£ç›˜åˆ†åŒº "),a("code",[s._v("/dev/sdb1")]),s._v("â€‹, å¹¶ä¸”ä¼ å…¥çš„å‚æ•°ä¸º "),a("code",[s._v("O_RDONLY|O_DIRECT")]),s._v("â€‹(ä¸­é—´çš„ç«–çº¿è¡¨ç¤ºæˆ–).")]),s._v(" "),a("p",[s._v("O_RDONLY è¡¨ç¤ºä»¥åªè¯»æ–¹å¼æ‰“å¼€, è€Œ O_DIRECT åˆ™è¡¨ç¤ºä»¥ç›´æ¥è¯»å–çš„æ–¹å¼æ‰“å¼€, è¿™ä¼š"),a("strong",[s._v("ç»•è¿‡ç³»ç»Ÿçš„ç¼“å­˜")]),s._v(".")]),s._v(" "),a("p",[s._v("éªŒè¯äº†è¿™ä¸€ç‚¹, å°±å¾ˆå®¹æ˜“ç†è§£ä¸ºä»€ä¹ˆè¯» 32 MB çš„æ•°æ®å°±éƒ½è¦é‚£ä¹ˆä¹…äº†. "),a("strong",[s._v("ç›´æ¥ä»ç£ç›˜è¯»å†™çš„é€Ÿåº¦, è‡ªç„¶è¿œæ…¢äºå¯¹ç¼“å­˜çš„è¯»å†™. è¿™ä¹Ÿæ˜¯ç¼“å­˜å­˜åœ¨çš„æœ€å¤§æ„ä¹‰")]),s._v("äº†.")]),s._v(" "),a("p",[s._v("æ‰¾å‡ºé—®é¢˜å, è¿˜å¯ä»¥åœ¨å†çœ‹çœ‹æ¡ˆä¾‹åº”ç”¨çš„"),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/io-cached/app.c",target:"_blank",rel:"noopener noreferrer"}},[s._v("æºä»£ç "),a("OutboundLink")],1),s._v(", å†æ¬¡éªŒè¯ä¸€ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("int flags "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" O_RDONLY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" O_LARGEFILE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" O_DIRECT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \nint fd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("disk, flags, 0755"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ä¸Šé¢çš„ä»£ç , å¾ˆæ¸…æ¥šåœ°å‘Šè¯‰æˆ‘ä»¬: å®ƒæœç„¶ç”¨äº†ç›´æ¥ I/O.")]),s._v(" "),a("p",[s._v("æ‰¾å‡ºäº†ç£ç›˜è¯»å–ç¼“æ…¢çš„åŸå› , ä¼˜åŒ–ç£ç›˜è¯»çš„æ€§èƒ½è‡ªç„¶ä¸åœ¨è¯ä¸‹. ä¿®æ”¹æºä»£ç , åˆ é™¤ O_DIRECT é€‰é¡¹, "),a("strong",[s._v("è®©åº”ç”¨ç¨‹åºä½¿ç”¨ç¼“å­˜ I/O , è€Œä¸æ˜¯ç›´æ¥ I/O, å°±å¯ä»¥åŠ é€Ÿç£ç›˜è¯»å–é€Ÿåº¦")]),s._v(".")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/io-cached/app-cached.c",target:"_blank",rel:"noopener noreferrer"}},[s._v("app-cached.c"),a("OutboundLink")],1),s._v(" å°±æ˜¯ä¿®å¤åçš„æºç , æˆ‘ä¹ŸæŠŠå®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ªå®¹å™¨é•œåƒ. åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­, æŒ‰ Ctrl+C åœæ­¢åˆšæ‰çš„ strace å‘½ä»¤, è¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥å¯åŠ¨å®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ é™¤ä¸Šè¿°æ¡ˆä¾‹åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" app\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œä¿®å¤åçš„åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/app:io-cached\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("è¿˜æ˜¯ç¬¬äºŒä¸ªç»ˆç«¯, å†æ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æ–°åº”ç”¨çš„æ—¥å¿—, åº”è¯¥èƒ½çœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs app\nReading data from disk /dev/sdb1 with buffer size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33554432")]),s._v("\nTime used: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.037342")]),s._v(" s s to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33554432")]),s._v(" bytes\nTime used: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.029676")]),s._v(" s to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33554432")]),s._v(" bytes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç°åœ¨, æ¯æ¬¡åªéœ€è¦ 0.03 ç§’, å°±å¯ä»¥è¯»å– 32MB æ•°æ®, æ˜æ˜¾æ¯”ä¹‹å‰çš„ 0.9 ç§’å¿«å¤šäº†. æ‰€ä»¥, è¿™æ¬¡åº”è¯¥ç”¨äº†ç³»ç»Ÿç¼“å­˜.")]),s._v(" "),a("p",[s._v("å†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯, æŸ¥çœ‹ cachetop çš„è¾“å‡ºæ¥ç¡®è®¤ä¸€ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":40:08 Buffers MB: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(" / Cached MB: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("281")]),s._v(" / Sort: HITS / Order: ascending\nPID      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22106")]),s._v(" root     app                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40960")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æœç„¶, "),a("strong",[s._v("è¯»çš„å‘½ä¸­ç‡è¿˜æ˜¯ 100%, HITS (å³å‘½ä¸­æ•°)å´å˜æˆäº† 40960")]),s._v(", åŒæ ·çš„æ–¹æ³•è®¡ç®—ä¸€ä¸‹, æ¢ç®—æˆæ¯ç§’å­—èŠ‚æ•°æ­£å¥½æ˜¯ 32 MB(å³ 40960*4k/5/1024=32M).")]),s._v(" "),a("p",[s._v("è¿™ä¸ªæ¡ˆä¾‹è¯´æ˜, "),a("strong",[s._v("åœ¨è¿›è¡Œ I/O æ“ä½œæ—¶, å……åˆ†åˆ©ç”¨ç³»ç»Ÿç¼“å­˜å¯ä»¥æå¤§åœ°æå‡æ€§èƒ½")]),s._v(". ä½†åœ¨è§‚å¯Ÿç¼“å­˜å‘½ä¸­ç‡æ—¶, è¿˜è¦æ³¨æ„ç»“åˆåº”ç”¨ç¨‹åºå®é™…çš„ I/O å¤§å°, ç»¼åˆåˆ†æç¼“å­˜çš„ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("æ¡ˆä¾‹çš„æœ€å, å†å›åˆ°å¼€å§‹çš„é—®é¢˜, ä¸ºä»€ä¹ˆä¼˜åŒ–å‰, é€šè¿‡ cachetop åªèƒ½çœ‹åˆ°å¾ˆå°‘ä¸€éƒ¨åˆ†æ•°æ®çš„å…¨éƒ¨å‘½ä¸­, è€Œæ²¡æœ‰è§‚å¯Ÿåˆ°å¤§é‡æ•°æ®çš„æœªå‘½ä¸­æƒ…å†µå‘¢? è¿™æ˜¯å› ä¸º, "),a("strong",[s._v("cachetop å·¥å…·å¹¶ä¸æŠŠç›´æ¥ I/O ç®—è¿›æ¥")]),s._v(". è¿™ä¹Ÿåˆä¸€æ¬¡è¯´æ˜äº†, äº†è§£å·¥å…·åŸç†çš„é‡è¦.")]),s._v(" "),a("h5",{attrs:{id:"_5-æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ€»ç»“"}},[s._v("#")]),s._v(" 5.æ€»ç»“")]),s._v(" "),a("p",[s._v("Buffers å’Œ Cache å¯ä»¥æå¤§æå‡ç³»ç»Ÿçš„ I/O æ€§èƒ½. é€šå¸¸ç”¨ç¼“å­˜å‘½ä¸­ç‡æ¥è¡¡é‡ç¼“å­˜çš„ä½¿ç”¨æ•ˆç‡. å‘½ä¸­ç‡è¶Šé«˜, è¡¨ç¤ºç¼“å­˜è¢«åˆ©ç”¨å¾—è¶Šå……åˆ†, åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¹Ÿå°±è¶Šå¥½.")]),s._v(" "),a("p",[s._v("å¯ä»¥ç”¨ cachestat å’Œ cachetop è¿™ä¸¤ä¸ªå·¥å…·, è§‚å¯Ÿç³»ç»Ÿå’Œè¿›ç¨‹çš„ç¼“å­˜å‘½ä¸­æƒ…å†µ. å…¶ä¸­,")]),s._v(" "),a("ul",[a("li",[s._v("cachestat æä¾›äº†æ•´ä¸ªç³»ç»Ÿç¼“å­˜çš„è¯»å†™å‘½ä¸­æƒ…å†µ.")]),s._v(" "),a("li",[s._v("cachetop æä¾›äº†æ¯ä¸ªè¿›ç¨‹çš„ç¼“å­˜å‘½ä¸­æƒ…å†µ.")])]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, "),a("strong",[s._v("Buffers å’Œ Cache éƒ½æ˜¯æ“ä½œç³»ç»Ÿæ¥ç®¡ç†çš„, åº”ç”¨ç¨‹åºå¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶è¿™äº›ç¼“å­˜çš„å†…å®¹å’Œç”Ÿå‘½å‘¨æœŸ. æ‰€ä»¥, åœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­, ä¸€èˆ¬è¦ç”¨ä¸“é—¨çš„ç¼“å­˜ç»„ä»¶, æ¥è¿›ä¸€æ­¥æå‡æ€§èƒ½")]),s._v(". æ¯”å¦‚, ç¨‹åºå†…éƒ¨"),a("strong",[s._v("å¯ä»¥ä½¿ç”¨å †æˆ–è€…æ ˆæ˜ç¡®å£°æ˜å†…å­˜ç©ºé—´, æ¥å­˜å‚¨éœ€è¦ç¼“å­˜çš„æ•°æ®. å†æˆ–è€…, ä½¿ç”¨ Redis è¿™ç±»å¤–éƒ¨ç¼“å­˜æœåŠ¡, ä¼˜åŒ–æ•°æ®çš„è®¿é—®æ•ˆç‡")]),s._v(".")]),s._v(" "),a("h4",{attrs:{id:"_18-æ¡ˆä¾‹ç¯‡-å†…å­˜æ³„æ¼äº†è¯¥å¦‚ä½•å®šä½å’Œå¤„ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_18-æ¡ˆä¾‹ç¯‡-å†…å­˜æ³„æ¼äº†è¯¥å¦‚ä½•å®šä½å’Œå¤„ç†"}},[s._v("#")]),s._v(" 18-æ¡ˆä¾‹ç¯‡:å†…å­˜æ³„æ¼äº†è¯¥å¦‚ä½•å®šä½å’Œå¤„ç†?")]),s._v(" "),a("p",[s._v("é€šè¿‡å‰å‡ èŠ‚å¯¹å†…å­˜åŸºç¡€çš„å­¦ä¹ , å·²ç»çŸ¥é“"),a("strong",[s._v("å¯¹æ™®é€šè¿›ç¨‹æ¥è¯´, èƒ½çœ‹åˆ°çš„å…¶å®æ˜¯å†…æ ¸æä¾›çš„è™šæ‹Ÿå†…å­˜, è¿™äº›è™šæ‹Ÿå†…å­˜è¿˜éœ€è¦é€šè¿‡é¡µè¡¨, ç”±ç³»ç»Ÿæ˜ å°„ä¸ºç‰©ç†å†…å­˜")]),s._v(".")]),s._v(" "),a("p",[s._v("å½“è¿›ç¨‹é€šè¿‡ malloc() ç”³è¯·è™šæ‹Ÿå†…å­˜å, ç³»ç»Ÿå¹¶ä¸ä¼šç«‹å³ä¸ºå…¶åˆ†é…ç‰©ç†å†…å­˜, è€Œæ˜¯åœ¨é¦–æ¬¡è®¿é—®æ—¶, æ‰é€šè¿‡ç¼ºé¡µå¼‚å¸¸é™·å…¥å†…æ ¸ä¸­åˆ†é…å†…å­˜.")]),s._v(" "),a("p",[s._v("ä¸ºäº†åè°ƒ CPU ä¸ç£ç›˜é—´çš„æ€§èƒ½å·®å¼‚, Linux è¿˜ä¼šä½¿ç”¨ Cache å’Œ Buffer, åˆ†åˆ«æŠŠæ–‡ä»¶å’Œç£ç›˜è¯»å†™çš„æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­.")]),s._v(" "),a("p",[s._v("å¯¹åº”ç”¨ç¨‹åºæ¥è¯´, "),a("strong",[s._v("åŠ¨æ€å†…å­˜çš„åˆ†é…å’Œå›æ”¶, æ˜¯æ—¢æ ¸å¿ƒåˆå¤æ‚çš„ä¸€ä¸ªé€»è¾‘åŠŸèƒ½æ¨¡å—")]),s._v('. ç®¡ç†å†…å­˜çš„è¿‡ç¨‹ä¸­, ä¹Ÿå¾ˆå®¹æ˜“å‘ç”Ÿå„ç§å„æ ·çš„"äº‹æ•…", æ¯”å¦‚,')]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("æ²¡æ­£ç¡®å›æ”¶åˆ†é…åçš„å†…å­˜, å¯¼è‡´äº†æ³„æ¼.")])]),s._v(" "),a("li",[s._v("è®¿é—®çš„æ˜¯å·²åˆ†é…å†…å­˜è¾¹ç•Œå¤–çš„åœ°å€, å¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡º, ç­‰ç­‰.")])]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å°±æ¥çœ‹çœ‹, "),a("strong",[s._v("å†…å­˜æ³„æ¼åˆ°åº•æ˜¯æ€ä¹ˆå‘ç”Ÿçš„, ä»¥åŠå‘ç”Ÿå†…å­˜æ³„æ¼ä¹‹åè¯¥å¦‚ä½•æ’æŸ¥å’Œå®šä½")]),s._v(".")]),s._v(" "),a("p",[s._v("è¯´èµ·å†…å­˜æ³„æ¼, è¿™å°±è¦å…ˆä»å†…å­˜çš„åˆ†é…å’Œå›æ”¶è¯´èµ·äº†.")]),s._v(" "),a("h5",{attrs:{id:"_1-å†…å­˜çš„åˆ†é…å’Œå›æ”¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å†…å­˜çš„åˆ†é…å’Œå›æ”¶"}},[s._v("#")]),s._v(" 1.å†…å­˜çš„åˆ†é…å’Œå›æ”¶")]),s._v(" "),a("p",[s._v("å…ˆå›é¡¾ä¸€ä¸‹åº”ç”¨ç¨‹åºä¸­, éƒ½æœ‰å“ªäº›æ–¹æ³•æ¥åˆ†é…å†…å­˜? ç”¨å®Œå, åˆè¯¥æ€ä¹ˆé‡Šæ”¾è¿˜ç»™ç³»ç»Ÿå‘¢?")]),s._v(" "),a("p",[s._v("å‰é¢è®²è¿›ç¨‹çš„å†…å­˜ç©ºé—´æ—¶æåˆ°è¿‡, ç”¨æˆ·ç©ºé—´å†…å­˜åŒ…æ‹¬å¤šä¸ªä¸åŒçš„å†…å­˜æ®µ, æ¯”å¦‚åªè¯»æ®µ, æ•°æ®æ®µ, å †, æ ˆä»¥åŠæ–‡ä»¶æ˜ å°„æ®µç­‰. è¿™äº›å†…å­˜æ®µæ­£æ˜¯åº”ç”¨ç¨‹åºä½¿ç”¨å†…å­˜çš„åŸºæœ¬æ–¹å¼.")]),s._v(" "),a("p",[s._v("ä¸¾ä¸ªä¾‹å­, åœ¨ç¨‹åºä¸­å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å˜é‡, æ¯”å¦‚ä¸€ä¸ªæ•´æ•°æ•°ç»„ "),a("code",[s._v("int data[64]")]),s._v("â€‹, å°±å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥å­˜å‚¨ 64 ä¸ªæ•´æ•°çš„å†…å­˜æ®µ. ç”±äºè¿™æ˜¯ä¸€ä¸ª"),a("strong",[s._v("å±€éƒ¨å˜é‡")]),s._v(", å®ƒä¼šä»å†…å­˜ç©ºé—´çš„"),a("strong",[s._v("æ ˆ")]),s._v("ä¸­åˆ†é…å†…å­˜. "),a("strong",[s._v("æ ˆå†…å­˜ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œç®¡ç†. ä¸€æ—¦ç¨‹åºè¿è¡Œè¶…å‡ºäº†è¿™ä¸ªå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸ, æ ˆå†…å­˜å°±ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å›æ”¶, æ‰€ä»¥ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼çš„é—®é¢˜.")])]),s._v(" "),a("p",[s._v("å†æ¯”å¦‚, å¾ˆå¤šæ—¶å€™, äº‹å…ˆå¹¶ä¸çŸ¥é“æ•°æ®å¤§å°, æ‰€ä»¥å°±è¦"),a("strong",[s._v("ç”¨åˆ°æ ‡å‡†åº“å‡½æ•° malloc() åœ¨ç¨‹åºä¸­åŠ¨æ€åˆ†é…å†…å­˜")]),s._v(". è¿™æ—¶å€™, ç³»ç»Ÿå°±ä¼š"),a("strong",[s._v("ä»å†…å­˜ç©ºé—´çš„å †ä¸­åˆ†é…å†…å­˜")]),s._v(".")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("å †å†…å­˜ç”±åº”ç”¨ç¨‹åºè‡ªå·±æ¥åˆ†é…å’Œç®¡ç†. é™¤éç¨‹åºé€€å‡º, è¿™äº›å †å†…å­˜å¹¶ä¸ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾, è€Œæ˜¯éœ€è¦åº”ç”¨ç¨‹åºæ˜ç¡®è°ƒç”¨åº“å‡½æ•° free() æ¥é‡Šæ”¾å®ƒä»¬. å¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®é‡Šæ”¾å †å†…å­˜, å°±ä¼šé€ æˆå†…å­˜æ³„æ¼.")])])]),s._v(" "),a("p",[s._v("è¿™æ˜¯ä¸¤ä¸ªæ ˆå’Œå †çš„ä¾‹å­, é‚£ä¹ˆå…¶ä»–å†…å­˜æ®µæ˜¯å¦ä¹Ÿä¼šå¯¼è‡´å†…å­˜æ³„æ¼å‘¢? ç»è¿‡å‰é¢çš„å­¦ä¹ , è¿™ä¸ªé—®é¢˜å¹¶ä¸éš¾å›ç­”.")]),s._v(" "),a("ul",[a("li",[s._v("åªè¯»æ®µ, åŒ…æ‹¬ç¨‹åºçš„ä»£ç å’Œå¸¸é‡, ç”±äºæ˜¯åªè¯»çš„, ä¸ä¼šå†å»åˆ†é…æ–°çš„å†…å­˜, æ‰€ä»¥ä¹Ÿ"),a("strong",[s._v("ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼")]),s._v(".")]),s._v(" "),a("li",[s._v("æ•°æ®æ®µ, åŒ…æ‹¬å…¨å±€å˜é‡å’Œé™æ€å˜é‡, è¿™äº›å˜é‡åœ¨å®šä¹‰æ—¶å°±å·²ç»ç¡®å®šäº†å¤§å°, æ‰€ä»¥ä¹Ÿ"),a("strong",[s._v("ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼")]),s._v(".")]),s._v(" "),a("li",[s._v("æœ€åä¸€ä¸ªå†…å­˜æ˜ å°„æ®µ, åŒ…æ‹¬åŠ¨æ€é“¾æ¥åº“å’Œå…±äº«å†…å­˜, å…¶ä¸­"),a("strong",[s._v("å…±äº«å†…å­˜ç”±ç¨‹åºåŠ¨æ€åˆ†é…å’Œç®¡ç†")]),s._v(". æ‰€ä»¥, å¦‚æœç¨‹åºåœ¨åˆ†é…åå¿˜äº†å›æ”¶, å°±ä¼šå¯¼è‡´è·Ÿå †å†…å­˜ç±»ä¼¼çš„æ³„æ¼é—®é¢˜.")])]),s._v(" "),a("p",[a("strong",[s._v("å†…å­˜æ³„æ¼çš„å±å®³éå¸¸å¤§, è¿™äº›å¿˜è®°é‡Šæ”¾çš„å†…å­˜, ä¸ä»…åº”ç”¨ç¨‹åºè‡ªå·±ä¸èƒ½è®¿é—®, ç³»ç»Ÿä¹Ÿä¸èƒ½æŠŠå®ƒä»¬å†æ¬¡åˆ†é…ç»™å…¶ä»–åº”ç”¨")]),s._v(". å†…å­˜æ³„æ¼ä¸æ–­ç´¯ç§¯, ç”šè‡³ä¼šè€—å°½ç³»ç»Ÿå†…å­˜.")]),s._v(" "),a("p",[s._v("è™½ç„¶, ç³»ç»Ÿæœ€ç»ˆå¯ä»¥é€šè¿‡ OOM (Out of Memory)æœºåˆ¶æ€æ­»è¿›ç¨‹, ä½†è¿›ç¨‹åœ¨ OOM å‰, å¯èƒ½å·²ç»å¼•å‘äº†ä¸€è¿ä¸²çš„ååº”, å¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜. æ¯”å¦‚, å…¶ä»–éœ€è¦å†…å­˜çš„è¿›ç¨‹, å¯èƒ½æ— æ³•åˆ†é…æ–°çš„å†…å­˜; å†…å­˜ä¸è¶³, åˆä¼šè§¦å‘ç³»ç»Ÿçš„ç¼“å­˜å›æ”¶ä»¥åŠ SWAP æœºåˆ¶, ä»è€Œè¿›ä¸€æ­¥å¯¼è‡´ I/O çš„æ€§èƒ½é—®é¢˜ç­‰ç­‰.")]),s._v(" "),a("p",[a("strong",[s._v("å†…å­˜æ³„æ¼çš„å±å®³è¿™ä¹ˆå¤§, é‚£åº”è¯¥æ€ä¹ˆæ£€æµ‹è¿™ç§é—®é¢˜å‘¢? ç‰¹åˆ«æ˜¯, å¦‚æœå·²ç»å‘ç°äº†å†…å­˜æ³„æ¼, è¯¥å¦‚ä½•å®šä½å’Œå¤„ç†å‘¢.")])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±ç”¨ä¸€ä¸ªè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ¡ˆä¾‹, æ¥çœ‹çœ‹å†…å­˜æ³„æ¼é—®é¢˜çš„å®šä½å’Œå¤„ç†æ–¹æ³•.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹")]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹åŸºäº Ubuntu 18.04.")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… sysstat, Docker ä»¥åŠ bcc è½¯ä»¶åŒ…, æ¯”å¦‚:")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install sysstat docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" sysstat docker.io\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install bcc")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" apt-key adv "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--keyserver")]),s._v(" keyserver.ubuntu.com --recv-keys 4052245BD4284CDD\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb https://repo.iovisor.org/apt/bionic bionic main"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/apt/sources.list.d/iovisor.list\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" bcc-tools libbcc-examples linux-headers-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("å…¶ä¸­ sysstat è½¯ä»¶åŒ…ä¸­çš„ vmstat, å¯ä»¥è§‚å¯Ÿå†…å­˜çš„å˜åŒ–æƒ…å†µ; è€Œ Docker å¯ä»¥è¿è¡Œæ¡ˆä¾‹ç¨‹åº.")]),s._v(" "),a("p",[s._v("bcc è½¯ä»¶åŒ…å‰é¢ä¹Ÿä»‹ç»è¿‡, å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„ Linux æ€§èƒ½åˆ†æå·¥å…·, å¸¸ç”¨æ¥åŠ¨æ€è¿½è¸ªè¿›ç¨‹å’Œå†…æ ¸çš„è¡Œä¸º. æŒ‰ç…§ä¸Šé¢æ­¥éª¤å®‰è£…å®Œå, å®ƒæä¾›çš„æ‰€æœ‰å·¥å…·éƒ½ä½äº "),a("code",[s._v("/usr/share/bcc/tools")]),s._v("â€‹ è¿™ä¸ªç›®å½•ä¸­.")]),s._v(" "),a("p",[s._v("å®‰è£…å®Œæˆå, å†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œæ¡ˆä¾‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/app:mem-leak\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ¡ˆä¾‹æˆåŠŸè¿è¡Œå, éœ€è¦è¾“å…¥ä¸‹é¢çš„å‘½ä»¤, ç¡®è®¤æ¡ˆä¾‹åº”ç”¨å·²ç»æ­£å¸¸å¯åŠ¨. å¦‚æœä¸€åˆ‡æ­£å¸¸, åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¸ªç•Œé¢:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs app\n2th "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n3th "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n4th "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n5th "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n6th "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n7th "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä»è¾“å‡ºä¸­å¯ä»¥å‘ç°, è¿™ä¸ªæ¡ˆä¾‹ä¼šè¾“å‡ºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¸€ç³»åˆ—æ•°å€¼. å®é™…ä¸Š, è¿™äº›æ•°å€¼æ¯éš” 1 ç§’è¾“å‡ºä¸€æ¬¡.")]),s._v(" "),a("p",[s._v("çŸ¥é“äº†è¿™äº›, é‚£åº”è¯¥æ€ä¹ˆæ£€æŸ¥å†…å­˜æƒ…å†µ, åˆ¤æ–­æœ‰æ²¡æœ‰æ³„æ¼å‘ç”Ÿå‘¢? é¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯ top å·¥å…·, ä¸è¿‡, top è™½ç„¶èƒ½è§‚å¯Ÿç³»ç»Ÿå’Œè¿›ç¨‹çš„å†…å­˜å ç”¨æƒ…å†µ, ä½†ä»Šå¤©çš„æ¡ˆä¾‹å¹¶ä¸é€‚åˆ. "),a("mark",[a("strong",[s._v("å†…å­˜æ³„æ¼é—®é¢˜, æ›´åº”è¯¥å…³æ³¨å†…å­˜ä½¿ç”¨çš„å˜åŒ–è¶‹åŠ¿")])]),s._v(".")]),s._v(" "),a("p",[s._v("æ‰€ä»¥å¼€å¤´ä¹Ÿæåˆ°äº†, ä»Šå¤©æ¨èçš„æ˜¯å¦ä¸€ä¸ªè€ç†Ÿäºº, "),a("mark",[a("strong",[s._v("vmstat å·¥å…·")])]),s._v(".")]),s._v(" "),a("p",[s._v("è¿è¡Œä¸‹é¢çš„ vmstat, ç­‰å¾…ä¸€æ®µæ—¶é—´, è§‚å¯Ÿå†…å­˜çš„å˜åŒ–æƒ…å†µ. å¦‚æœå¿˜äº† vmstat é‡Œå„æŒ‡æ ‡çš„å«ä¹‰, è®°å¾—å¤ä¹ å‰é¢å†…å®¹, æˆ–è€…æ‰§è¡Œ man vmstat æŸ¥è¯¢.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯éš” 3 ç§’è¾“å‡ºä¸€ç»„æ•°æ®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vmstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\nr  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\nr  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6601824")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97620")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1098784")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6601700")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97620")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1098788")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("251")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6601320")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97620")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1098788")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("306")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6601452")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97628")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1098788")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("326")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6601328")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97628")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1098788")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("299")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6601080")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97628")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1098792")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("285")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("ä»è¾“å‡ºä¸­ä½ å¯ä»¥çœ‹åˆ°, å†…å­˜çš„ free åˆ—åœ¨ä¸åœçš„å˜åŒ–, å¹¶ä¸”æ˜¯ä¸‹é™è¶‹åŠ¿; è€Œ buffer å’Œ cache åŸºæœ¬ä¿æŒä¸å˜.")]),s._v(" "),a("p",[a("strong",[s._v("æœªä½¿ç”¨å†…å­˜åœ¨é€æ¸å‡å°, è€Œ buffer å’Œ cache åŸºæœ¬ä¸å˜, è¿™è¯´æ˜ç³»ç»Ÿä¸­ä½¿ç”¨çš„å†…å­˜ä¸€ç›´åœ¨å‡é«˜")]),s._v(". ä½†è¿™å¹¶ä¸èƒ½è¯´æ˜æœ‰å†…å­˜æ³„æ¼, å› ä¸ºåº”ç”¨ç¨‹åºè¿è¡Œä¸­éœ€è¦çš„å†…å­˜ä¹Ÿå¯èƒ½ä¼šå¢å¤§. æ¯”å¦‚è¯´, ç¨‹åºä¸­å¦‚æœç”¨äº†ä¸€ä¸ªåŠ¨æ€å¢é•¿çš„æ•°ç»„æ¥ç¼“å­˜è®¡ç®—ç»“æœ, å ç”¨å†…å­˜è‡ªç„¶ä¼šå¢é•¿.")]),s._v(" "),a("p",[s._v("é‚£æ€ä¹ˆç¡®å®šæ˜¯ä¸æ˜¯å†…å­˜æ³„æ¼å‘¢? æˆ–è€…æ¢å¥è¯è¯´, "),a("strong",[s._v("æœ‰æ²¡æœ‰ç®€å•æ–¹æ³•æ‰¾å‡ºè®©å†…å­˜å¢é•¿çš„è¿›ç¨‹, å¹¶å®šä½å¢é•¿å†…å­˜ç”¨åœ¨å“ªå„¿å‘¢")]),s._v("?")]),s._v(" "),a("p",[s._v("æ ¹æ®å‰é¢å†…å®¹, ä½ åº”è¯¥æƒ³åˆ°äº†"),a("strong",[s._v("ç”¨ top æˆ– ps æ¥è§‚å¯Ÿè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ, ç„¶åæ‰¾å‡ºå†…å­˜ä½¿ç”¨ä¸€ç›´å¢é•¿çš„è¿›ç¨‹, æœ€åå†é€šè¿‡ pmap æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜åˆ†å¸ƒ")]),s._v(". ä½†è¿™ç§æ–¹æ³•å¹¶ä¸å¤ªå¥½ç”¨, å› ä¸ºè¦åˆ¤æ–­å†…å­˜çš„å˜åŒ–æƒ…å†µ, è¿˜éœ€è¦å†™ä¸€ä¸ªè„šæœ¬, æ¥å¤„ç† top æˆ–è€… ps çš„è¾“å‡º.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("è¿™é‡Œä»‹ç»ä¸€ä¸ªä¸“é—¨ç”¨æ¥æ£€æµ‹å†…å­˜æ³„æ¼çš„å·¥å…· memleak. memleak å¯ä»¥è·Ÿè¸ªç³»ç»Ÿæˆ–æŒ‡å®šè¿›ç¨‹çš„å†…å­˜åˆ†é…, é‡Šæ”¾è¯·æ±‚, ç„¶åå®šæœŸè¾“å‡ºä¸€ä¸ªæœªé‡Šæ”¾å†…å­˜å’Œç›¸åº”è°ƒç”¨æ ˆçš„æ±‡æ€»æƒ…å†µ(é»˜è®¤ 5 ç§’)")])]),s._v(" .")]),s._v(" "),a("p",[s._v("å½“ç„¶, memleak æ˜¯ bcc è½¯ä»¶åŒ…ä¸­çš„ä¸€ä¸ªå·¥å…·, æ‰§è¡Œ "),a("code",[s._v("/usr/share/bcc/tools/memleak")]),s._v("â€‹ å°±å¯ä»¥è¿è¡Œå®ƒ. æ¯”å¦‚, è¿è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -a è¡¨ç¤ºæ˜¾ç¤ºæ¯ä¸ªå†…å­˜åˆ†é…è¯·æ±‚çš„å¤§å°ä»¥åŠåœ°å€")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p æŒ‡å®šæ¡ˆä¾‹åº”ç”¨çš„ PID å·")]),s._v("\n$ /usr/share/bcc/tools/memleak "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("pidof app"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\nWARNING: Couldn"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t find .text section in /app\nWARNING: BCC can'")]),s._v("t handle sym "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("look")]),s._v(" ups "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" /app\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f704732b0 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f704772d0 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f704712a0 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f704752c0 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v(" bytes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" allocations from stack\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        start_thread+0xdb "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("libpthread-2.27.so"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("ä» memleak çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°, æ¡ˆä¾‹åº”ç”¨åœ¨ä¸åœåœ°åˆ†é…å†…å­˜, å¹¶ä¸”è¿™äº›åˆ†é…çš„åœ°å€æ²¡æœ‰è¢«å›æ”¶.")]),s._v(" "),a("p",[s._v("è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜, "),a("code",[s._v("Couldnâ€™t find .text section in /app")]),s._v("â€‹, æ‰€ä»¥è°ƒç”¨æ ˆä¸èƒ½æ­£å¸¸è¾“å‡º, æœ€åçš„è°ƒç”¨æ ˆéƒ¨åˆ†åªèƒ½çœ‹åˆ° "),a("code",[s._v("[unknown]")]),s._v("â€‹ çš„æ ‡å¿—.")]),s._v(" "),a("p",[s._v("ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªé”™è¯¯å‘¢? å®é™…ä¸Š, è¿™æ˜¯ç”±äºæ¡ˆä¾‹åº”ç”¨è¿è¡Œåœ¨å®¹å™¨ä¸­å¯¼è‡´çš„. memleak å·¥å…·è¿è¡Œåœ¨å®¹å™¨ä¹‹å¤–, å¹¶ä¸èƒ½ç›´æ¥è®¿é—®è¿›ç¨‹è·¯å¾„ "),a("code",[s._v("/app")]),s._v("â€‹.")]),s._v(" "),a("p",[s._v("æ¯”æ–¹è¯´, åœ¨ç»ˆç«¯ä¸­ç›´æ¥è¿è¡Œ ls å‘½ä»¤, ä¼šå‘ç°è¿™ä¸ªè·¯å¾„çš„ç¡®ä¸å­˜åœ¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /app\nls: cannot access "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/app'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" No such "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æœ€ç®€å•çš„æ–¹æ³•, å°±æ˜¯åœ¨å®¹å™¨å¤–éƒ¨æ„å»ºç›¸åŒè·¯å¾„çš„æ–‡ä»¶ä»¥åŠä¾èµ–åº“. è¿™ä¸ªæ¡ˆä¾‹åªæœ‰ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶, æ‰€ä»¥åªè¦æŠŠæ¡ˆä¾‹åº”ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ° /app è·¯å¾„ä¸­, å°±å¯ä»¥ä¿®å¤è¿™ä¸ªé—®é¢˜.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤, æŠŠ app äºŒè¿›åˆ¶æ–‡ä»¶ä»å®¹å™¨ä¸­å¤åˆ¶å‡ºæ¥, ç„¶åé‡æ–°è¿è¡Œ memleak å·¥å…·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" app:/app /app\n$ /usr/share/bcc/tools/memleak "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("pidof app"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\nAttaching to pid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12512")]),s._v(", Ctrl+C to quit.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:00:41"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Top "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" stacks with outstanding allocations:\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f70863220 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f70861210 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f7085b1e0 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f7085f200 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7f8f7085d1f0 size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40960")]),s._v(" bytes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" allocations from stack\n        fibonacci+0x1f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        child+0x4f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        start_thread+0xdb "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("libpthread-2.27.so"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("è¿™ä¸€æ¬¡, ç»ˆäºçœ‹åˆ°äº†"),a("strong",[s._v("å†…å­˜åˆ†é…çš„è°ƒç”¨æ ˆ, åŸæ¥æ˜¯ fibonacci() å‡½æ•°åˆ†é…çš„å†…å­˜æ²¡é‡Šæ”¾")]),s._v(".")]),s._v(" "),a("p",[s._v("å®šä½äº†å†…å­˜æ³„æ¼çš„æ¥æº, ä¸‹ä¸€æ­¥è‡ªç„¶å°±åº”è¯¥æŸ¥çœ‹æºç , æƒ³åŠæ³•ä¿®å¤å®ƒ. ä¸€èµ·æ¥çœ‹æ¡ˆä¾‹åº”ç”¨çš„æºä»£ç  "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/mem-leak/app.c",target:"_blank",rel:"noopener noreferrer"}},[s._v("app.c"),a("OutboundLink")],1),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" app "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /app.c\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlong long *fibonacci"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("long long *n0, long long *n1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    // åˆ†é… "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" ä¸ªé•¿æ•´æ•°ç©ºé—´æ–¹ä¾¿è§‚æµ‹å†…å­˜çš„å˜åŒ–æƒ…å†µ\n    long long *v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("long long *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" calloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(", sizeof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("long long"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    *v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" *n0 + *n1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n \nvoid *child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("void *arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    long long n0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    long long n1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    long long *v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NULL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("int n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" n++"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fibonacci"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("n0, "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("n1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        n0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" n1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        n1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" *v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        printf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%dth => %lld'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", n, *v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("ä½ ä¼šå‘ç°, child() è°ƒç”¨äº† fibonacci() å‡½æ•°, ä½†å¹¶æ²¡æœ‰é‡Šæ”¾ fibonacci() è¿”å›çš„å†…å­˜. æ‰€ä»¥, æƒ³è¦ä¿®å¤æ³„æ¼é—®é¢˜, åœ¨ child() ä¸­"),a("strong",[s._v("åŠ ä¸€ä¸ªé‡Šæ”¾å‡½æ•°")]),s._v("å°±å¯ä»¥äº†, æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("child")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fibonacci")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("n0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("n1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        n0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" n1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        n1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%dth => %lld\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾å†…å­˜")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("è¿™é‡ŒæŠŠä¿®å¤åçš„ä»£ç æ”¾åˆ°äº† "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/mem-leak/app-fix.c",target:"_blank",rel:"noopener noreferrer"}},[s._v("app-fix.c"),a("OutboundLink")],1),s._v(", ä¹Ÿæ‰“åŒ…æˆäº†ä¸€ä¸ª Docker é•œåƒ. å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤, éªŒè¯ä¸€ä¸‹å†…å­˜æ³„æ¼æ˜¯å¦ä¿®å¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¸…ç†åŸæ¥çš„æ¡ˆä¾‹åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" app\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œä¿®å¤åçš„åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/app:mem-leak-fix\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡æ–°æ‰§è¡Œ memleak å·¥å…·æ£€æŸ¥å†…å­˜æ³„æ¼æƒ…å†µ")]),s._v("\n$ /usr/share/bcc/tools/memleak "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("pidof app"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\nAttaching to pid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18808")]),s._v(", Ctrl+C to quit.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":23:18"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Top "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" stacks with outstanding allocations:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":23:23"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Top "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" stacks with outstanding allocations:\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("ç°åœ¨å¯ä»¥çœ‹åˆ°, æ¡ˆä¾‹åº”ç”¨å·²ç»æ²¡æœ‰é—ç•™å†…å­˜, è¯æ˜ä¿®å¤å·¥ä½œæˆåŠŸå®Œæˆ.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-2"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æ€»ç»“ä¸€ä¸‹ä»Šå¤©çš„å†…å®¹.")]),s._v(" "),a("p",[s._v("åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®çš„ç”¨æˆ·å†…å­˜ç©ºé—´, ç”±åªè¯»æ®µ, æ•°æ®æ®µ, å †, æ ˆä»¥åŠæ–‡ä»¶æ˜ å°„æ®µç­‰ç»„æˆ. å…¶ä¸­, "),a("strong",[s._v("å †å†…å­˜å’Œå†…å­˜æ˜ å°„, éœ€è¦åº”ç”¨ç¨‹åºæ¥åŠ¨æ€ç®¡ç†å†…å­˜æ®µ, æ‰€ä»¥å¿…é¡»å°å¿ƒå¤„ç†")]),s._v(". ä¸ä»…è¦ä¼šç”¨æ ‡å‡†åº“å‡½æ•° "),a("code",[s._v("malloc()")]),s._v("â€‹ æ¥åŠ¨æ€åˆ†é…å†…å­˜, è¿˜è¦è®°å¾—åœ¨ç”¨å®Œå†…å­˜å, è°ƒç”¨åº“å‡½æ•° "),a("code",[s._v("free()")]),s._v("â€‹ æ¥é‡Šæ”¾å®ƒä»¬.")]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹æ¯”è¾ƒç®€å•, åªç”¨åŠ ä¸€ä¸ª free() è°ƒç”¨å°±èƒ½ä¿®å¤å†…å­˜æ³„æ¼. ä¸è¿‡, å®é™…åº”ç”¨ç¨‹åºå°±å¤æ‚å¤šäº†. æ¯”å¦‚è¯´,")]),s._v(" "),a("ul",[a("li",[s._v("malloc() å’Œ free() é€šå¸¸å¹¶ä¸æ˜¯æˆå¯¹å‡ºç°, è€Œæ˜¯éœ€è¦åœ¨æ¯ä¸ªå¼‚å¸¸å¤„ç†è·¯å¾„å’ŒæˆåŠŸè·¯å¾„ä¸Šéƒ½é‡Šæ”¾å†…å­˜.")]),s._v(" "),a("li",[s._v("åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­, ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ†é…çš„å†…å­˜, å¯èƒ½ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è®¿é—®å’Œé‡Šæ”¾.")]),s._v(" "),a("li",[s._v("æ›´å¤æ‚çš„æ˜¯, åœ¨ç¬¬ä¸‰æ–¹çš„åº“å‡½æ•°ä¸­, éšå¼åˆ†é…çš„å†…å­˜å¯èƒ½éœ€è¦åº”ç”¨ç¨‹åºæ˜¾å¼é‡Šæ”¾.")])]),s._v(" "),a("p",[s._v("æ‰€ä»¥, "),a("strong",[s._v("ä¸ºäº†é¿å…å†…å­˜æ³„æ¼, æœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯å…»æˆè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯, æ¯”å¦‚åˆ†é…å†…å­˜å, ä¸€å®šè¦å…ˆå†™å¥½å†…å­˜é‡Šæ”¾çš„ä»£ç , å†å»å¼€å‘å…¶ä»–é€»è¾‘. è¿˜æ˜¯é‚£å¥è¯, æœ‰å€Ÿæœ‰è¿˜, æ‰èƒ½é«˜æ•ˆè¿è½¬, å†å€Ÿä¸éš¾")]),s._v(".")]),s._v(" "),a("p",[s._v("å½“ç„¶, å¦‚æœå·²ç»å®Œæˆäº†å¼€å‘ä»»åŠ¡, è¿˜å¯ä»¥ç”¨ memleak å·¥å…·, æ£€æŸ¥åº”ç”¨ç¨‹åºçš„è¿è¡Œä¸­, å†…å­˜æ˜¯å¦æ³„æ¼. å¦‚æœå‘ç°äº†å†…å­˜æ³„æ¼æƒ…å†µ, å†æ ¹æ® memleak è¾“å‡ºçš„åº”ç”¨ç¨‹åºè°ƒç”¨æ ˆ, å®šä½å†…å­˜çš„åˆ†é…ä½ç½®, ä»è€Œé‡Šæ”¾ä¸å†è®¿é—®çš„å†…å­˜.")]),s._v(" "),a("h4",{attrs:{id:"_19-æ¡ˆä¾‹ç¯‡-ä¸ºä»€ä¹ˆç³»ç»Ÿçš„swapå˜é«˜äº†-ä¸Š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_19-æ¡ˆä¾‹ç¯‡-ä¸ºä»€ä¹ˆç³»ç»Ÿçš„swapå˜é«˜äº†-ä¸Š"}},[s._v("#")]),s._v(" 19-æ¡ˆä¾‹ç¯‡:ä¸ºä»€ä¹ˆç³»ç»Ÿçš„Swapå˜é«˜äº†(ä¸Š)")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚é€šè¿‡ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ¡ˆä¾‹, å­¦ä¹ äº†å†…å­˜æ³„æ¼çš„åˆ†æ. å¦‚æœåœ¨ç¨‹åºä¸­ç›´æ¥æˆ–é—´æ¥åœ°åˆ†é…äº†åŠ¨æ€å†…å­˜, ä¸€å®šè¦è®°å¾—é‡Šæ”¾æ‰å®ƒä»¬, å¦åˆ™å°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼, ä¸¥é‡æ—¶ç”šè‡³ä¼šè€—å°½ç³»ç»Ÿå†…å­˜.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, åè¿‡æ¥è®², "),a("strong",[s._v("å½“å‘ç”Ÿäº†å†…å­˜æ³„æ¼æ—¶, æˆ–è€…è¿è¡Œäº†å¤§å†…å­˜çš„åº”ç”¨ç¨‹åº, å¯¼è‡´ç³»ç»Ÿçš„å†…å­˜èµ„æºç´§å¼ æ—¶, ç³»ç»Ÿåˆä¼šå¦‚ä½•åº”å¯¹å‘¢")]),s._v("?")]),s._v(" "),a("p",[s._v("åœ¨å†…å­˜åŸºç¡€ç¯‡å·²ç»å­¦è¿‡, è¿™å…¶å®ä¼šå¯¼è‡´ä¸¤ç§å¯èƒ½ç»“æœ, "),a("strong",[s._v("å†…å­˜å›æ”¶å’Œ OOM æ€æ­»è¿›ç¨‹")]),s._v(".")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹åä¸€ä¸ªå¯èƒ½ç»“æœ, å†…å­˜èµ„æºç´§å¼ å¯¼è‡´çš„ OOM(Out Of Memory), ç›¸å¯¹å®¹æ˜“ç†è§£, æŒ‡çš„æ˜¯ç³»ç»Ÿæ€æ­»å ç”¨å¤§é‡å†…å­˜çš„è¿›ç¨‹, é‡Šæ”¾è¿™äº›å†…å­˜, å†åˆ†é…ç»™å…¶ä»–æ›´éœ€è¦çš„è¿›ç¨‹.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†çœ‹ç¬¬ä¸€ä¸ªå¯èƒ½çš„ç»“æœ, å†…å­˜å›æ”¶, ä¹Ÿå°±æ˜¯ç³»ç»Ÿé‡Šæ”¾æ‰å¯ä»¥å›æ”¶çš„å†…å­˜, æ¯”å¦‚å‰é¢è®²è¿‡çš„ç¼“å­˜å’Œç¼“å†²åŒº, å°±å±äºå¯å›æ”¶å†…å­˜. å®ƒä»¬åœ¨å†…å­˜ç®¡ç†ä¸­, é€šå¸¸è¢«å«åš"),a("mark",[a("strong",[s._v("æ–‡ä»¶é¡µ")])]),s._v("â€‹ "),a("strong",[s._v("(")]),s._v(" File-backed Page).")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("å¤§éƒ¨åˆ†æ–‡ä»¶é¡µ, éƒ½å¯ä»¥ç›´æ¥å›æ”¶, ä»¥åæœ‰éœ€è¦æ—¶, å†ä»ç£ç›˜é‡æ–°è¯»å–å°±å¯ä»¥äº†. è€Œé‚£äº›è¢«åº”ç”¨ç¨‹åºä¿®æ”¹è¿‡, å¹¶ä¸”æš‚æ—¶è¿˜æ²¡å†™å…¥ç£ç›˜çš„æ•°æ®(ä¹Ÿå°±æ˜¯è„é¡µ), å°±å¾—å…ˆå†™å…¥ç£ç›˜, ç„¶åæ‰èƒ½è¿›è¡Œå†…å­˜é‡Šæ”¾.")])])]),s._v(" "),a("p",[s._v("è¿™äº›"),a("strong",[s._v("è„é¡µ, ä¸€èˆ¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å†™å…¥ç£ç›˜")]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­, é€šè¿‡ç³»ç»Ÿè°ƒç”¨ fsync, æŠŠè„é¡µåŒæ­¥åˆ°ç£ç›˜ä¸­;")])]),s._v(" "),a("li",[a("strong",[s._v("ä¹Ÿå¯ä»¥äº¤ç»™ç³»ç»Ÿ, ç”±å†…æ ¸çº¿ç¨‹ pdflush è´Ÿè´£è¿™äº›è„é¡µçš„åˆ·æ–°.")])])]),s._v(" "),a("p",[s._v("é™¤äº†ç¼“å­˜å’Œç¼“å†²åŒº, é€šè¿‡å†…å­˜æ˜ å°„è·å–çš„æ–‡ä»¶æ˜ å°„é¡µ, ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„æ–‡ä»¶é¡µ. å®ƒä¹Ÿå¯ä»¥è¢«é‡Šæ”¾æ‰, ä¸‹æ¬¡å†è®¿é—®çš„æ—¶å€™, ä»æ–‡ä»¶é‡æ–°è¯»å–.")]),s._v(" "),a("p",[s._v("é™¤äº†æ–‡ä»¶é¡µå¤–, è¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„å†…å­˜å¯ä»¥å›æ”¶å‘¢? æ¯”å¦‚, "),a("strong",[s._v("åº”ç”¨ç¨‹åºåŠ¨æ€åˆ†é…çš„å †å†…å­˜")]),s._v(", ä¹Ÿå°±æ˜¯åœ¨å†…å­˜ç®¡ç†ä¸­è¯´åˆ°çš„"),a("strong",[s._v("åŒ¿åé¡µ")]),s._v("(Anonymous Page), æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å›æ”¶å‘¢?")]),s._v(" "),a("p",[s._v("è¿™äº›å†…å­˜è‡ªç„¶ä¸èƒ½ç›´æ¥é‡Šæ”¾. ä½†æ˜¯å¦‚æœè¿™äº›å†…å­˜åœ¨åˆ†é…åå¾ˆå°‘è¢«è®¿é—®, ä¼¼ä¹ä¹Ÿæ˜¯ä¸€ç§èµ„æºæµªè´¹. æ˜¯ä¸æ˜¯å¯ä»¥"),a("strong",[s._v("æŠŠå®ƒä»¬æš‚æ—¶å…ˆå­˜åœ¨ç£ç›˜é‡Œ, é‡Šæ”¾å†…å­˜ç»™å…¶ä»–æ›´éœ€è¦çš„è¿›ç¨‹")]),s._v("?")]),s._v(" "),a("p",[s._v("å…¶å®, è¿™æ­£æ˜¯ Linux çš„ Swap æœºåˆ¶. "),a("mark",[a("strong",[s._v("Swap æŠŠè¿™äº›ä¸å¸¸è®¿é—®çš„å†…å­˜å…ˆå†™åˆ°ç£ç›˜ä¸­, ç„¶åé‡Šæ”¾è¿™äº›å†…å­˜, ç»™å…¶ä»–æ›´éœ€è¦çš„è¿›ç¨‹ä½¿ç”¨. å†æ¬¡è®¿é—®è¿™äº›å†…å­˜æ—¶, é‡æ–°ä»ç£ç›˜è¯»å…¥å†…å­˜å°±å¯ä»¥äº†")])]),s._v(".")]),s._v(" "),a("p",[s._v("åœ¨å‰å‡ èŠ‚å·²ç»åˆ†åˆ«å­¦è¿‡ç¼“å­˜å’Œ OOM çš„åŸç†å’Œåˆ†æ. é‚£ Swap åˆæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢? å› ä¸ºå†…å®¹æ¯”è¾ƒå¤š, æ¥ä¸‹æ¥, å°†ç”¨ä¸¤èŠ‚æ¥æ¢ç´¢ Swap çš„å·¥ä½œåŸç†, ä»¥åŠ Swap å‡é«˜åçš„åˆ†ææ–¹æ³•.")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹çœ‹, Swap ç©¶ç«Ÿæ˜¯æ€ä¹ˆå·¥ä½œçš„.")]),s._v(" "),a("h5",{attrs:{id:"_1-swapåŸç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-swapåŸç†"}},[s._v("#")]),s._v(" 1.SwapåŸç†")]),s._v(" "),a("p",[s._v("å‰é¢æåˆ°, "),a("strong",[s._v("Swap è¯´ç™½äº†å°±æ˜¯æŠŠä¸€å—ç£ç›˜ç©ºé—´æˆ–è€…ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶(ä»¥ä¸‹è®²è§£ä»¥ç£ç›˜ä¸ºä¾‹), å½“æˆå†…å­˜æ¥ä½¿ç”¨")]),s._v(". å®ƒåŒ…æ‹¬"),a("strong",[s._v("æ¢å‡ºå’Œæ¢å…¥")]),s._v("ä¸¤ä¸ªè¿‡ç¨‹.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("æ‰€è°“æ¢å‡º, å°±æ˜¯æŠŠè¿›ç¨‹æš‚æ—¶ä¸ç”¨çš„å†…å­˜æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸­, å¹¶é‡Šæ”¾è¿™äº›æ•°æ®å ç”¨çš„å†…å­˜.")])]),s._v(" "),a("li",[a("strong",[s._v("è€Œæ¢å…¥, åˆ™æ˜¯åœ¨è¿›ç¨‹å†æ¬¡è®¿é—®è¿™äº›å†…å­˜çš„æ—¶å€™, æŠŠå®ƒä»¬ä»ç£ç›˜è¯»åˆ°å†…å­˜ä¸­æ¥.")])])]),s._v(" "),a("p",[s._v("æ‰€ä»¥ Swap å…¶å®æ˜¯æŠŠç³»ç»Ÿçš„å¯ç”¨å†…å­˜å˜å¤§äº†. è¿™æ ·, "),a("strong",[s._v("å³ä½¿æœåŠ¡å™¨çš„å†…å­˜ä¸è¶³, ä¹Ÿå¯ä»¥è¿è¡Œå¤§å†…å­˜çš„åº”ç”¨ç¨‹åº")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿˜è®°å¾—æˆ‘æœ€æ—©å­¦ä¹  Linux æ“ä½œç³»ç»Ÿæ—¶, å†…å­˜å®åœ¨å¤ªè´µäº†, ä¸€ä¸ªæ™®é€šå­¦ç”Ÿæ ¹æœ¬å°±ç”¨ä¸èµ·å¤§çš„å†…å­˜, é‚£ä¼šå„¿æˆ‘å°±æ˜¯å¼€å¯äº† Swap æ¥è¿è¡Œ Linux æ¡Œé¢. å½“ç„¶, ç°åœ¨çš„å†…å­˜ä¾¿å®œå¤šäº†, æœåŠ¡å™¨ä¸€èˆ¬ä¹Ÿä¼šé…ç½®å¾ˆå¤§çš„å†…å­˜, é‚£æ˜¯ä¸æ˜¯è¯´ Swap å°±æ²¡æœ‰ç”¨æ­¦ä¹‹åœ°äº†å‘¢?")]),s._v(" "),a("p",[s._v("å½“ç„¶ä¸æ˜¯. äº‹å®ä¸Š, å†…å­˜å†å¤§, å¯¹åº”ç”¨ç¨‹åºæ¥è¯´, ä¹Ÿæœ‰ä¸å¤Ÿç”¨çš„æ—¶å€™.")]),s._v(" "),a("p",[s._v("ä¸€ä¸ªå¾ˆå…¸å‹çš„åœºæ™¯å°±æ˜¯, å³ä½¿å†…å­˜ä¸è¶³æ—¶, æœ‰äº›åº”ç”¨ç¨‹åºä¹Ÿå¹¶ä¸æƒ³è¢« OOM æ€æ­», è€Œæ˜¯å¸Œæœ›èƒ½ç¼“ä¸€æ®µæ—¶é—´, ç­‰å¾…äººå·¥ä»‹å…¥, æˆ–è€…ç­‰ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾å…¶ä»–è¿›ç¨‹çš„å†…å­˜, å†åˆ†é…ç»™å®ƒ.")]),s._v(" "),a("p",[s._v("é™¤æ­¤ä¹‹å¤–, å¸¸è§çš„ç¬”è®°æœ¬ç”µè„‘çš„ä¼‘çœ å’Œå¿«é€Ÿå¼€æœºçš„åŠŸèƒ½, ä¹ŸåŸºäº Swap. ä¼‘çœ æ—¶, æŠŠç³»ç»Ÿçš„å†…å­˜å­˜å…¥ç£ç›˜, è¿™æ ·ç­‰åˆ°å†æ¬¡å¼€æœºæ—¶, åªè¦ä»ç£ç›˜ä¸­åŠ è½½å†…å­˜å°±å¯ä»¥. è¿™æ ·å°±çœå»äº†å¾ˆå¤šåº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–è¿‡ç¨‹, åŠ å¿«äº†å¼€æœºé€Ÿåº¦.")]),s._v(" "),a("p",[s._v("è¯è¯´å›æ¥, æ—¢ç„¶ Swap æ˜¯ä¸ºäº†å›æ”¶å†…å­˜, é‚£ä¹ˆ "),a("strong",[s._v("Linux åˆ°åº•åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦å›æ”¶å†…å­˜å‘¢")]),s._v("? å‰é¢ä¸€ç›´åœ¨è¯´å†…å­˜èµ„æºç´§å¼ , åˆè¯¥æ€ä¹ˆæ¥è¡¡é‡å†…å­˜æ˜¯ä¸æ˜¯ç´§å¼ å‘¢?")]),s._v(" "),a("p",[s._v("ä¸€ä¸ªæœ€å®¹æ˜“æƒ³åˆ°çš„åœºæ™¯å°±æ˜¯, "),a("strong",[s._v("æœ‰æ–°çš„å¤§å—å†…å­˜åˆ†é…è¯·æ±‚, ä½†æ˜¯å‰©ä½™å†…å­˜ä¸è¶³")]),s._v(". è¿™ä¸ªæ—¶å€™ç³»ç»Ÿå°±éœ€è¦å›æ”¶ä¸€éƒ¨åˆ†å†…å­˜(æ¯”å¦‚å‰é¢æåˆ°çš„ç¼“å­˜), è¿›è€Œå°½å¯èƒ½åœ°æ»¡è¶³æ–°å†…å­˜è¯·æ±‚. è¿™ä¸ªè¿‡ç¨‹é€šå¸¸è¢«ç§°ä¸º"),a("mark",[a("strong",[s._v("ç›´æ¥å†…å­˜å›æ”¶")])]),s._v(".")]),s._v(" "),a("p",[s._v("é™¤äº†ç›´æ¥å†…å­˜å›æ”¶, è¿˜æœ‰ä¸€ä¸ª"),a("strong",[s._v("ä¸“é—¨çš„å†…æ ¸çº¿ç¨‹ç”¨æ¥å®šæœŸå›æ”¶å†…å­˜")]),s._v(", ä¹Ÿå°±æ˜¯ "),a("strong",[s._v("kswapd0")]),s._v(". ä¸ºäº†è¡¡é‡å†…å­˜çš„ä½¿ç”¨æƒ…å†µ, kswapd0 å®šä¹‰äº†"),a("strong",[s._v("ä¸‰ä¸ªå†…å­˜é˜ˆå€¼(watermark, ä¹Ÿç§°ä¸ºæ°´ä½)")]),s._v(" , åˆ†åˆ«æ˜¯"),a("mark",[a("strong",[s._v("é¡µæœ€å°é˜ˆå€¼(pages_min), é¡µä½é˜ˆå€¼(pages_low)å’Œé¡µé«˜é˜ˆå€¼(pages_high)")])]),s._v(" . å‰©ä½™å†…å­˜, åˆ™ä½¿ç”¨ pages_free è¡¨ç¤º.")]),s._v(" "),a("p",[s._v("ä¸‹é¢ç”»äº†ä¸€å¼ å›¾è¡¨ç¤ºå®ƒä»¬çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/80e5896ff0f27cfaed9b56d6b283678e-20230731161933-nwmdiob.png",alt:""}})]),s._v(" "),a("p",[a("strong",[s._v("kswapd0 å®šæœŸæ‰«æå†…å­˜çš„ä½¿ç”¨æƒ…å†µ, å¹¶æ ¹æ®å‰©ä½™å†…å­˜è½åœ¨è¿™ä¸‰ä¸ªé˜ˆå€¼çš„ç©ºé—´ä½ç½®, è¿›è¡Œå†…å­˜çš„å›æ”¶æ“ä½œ")]),s._v(".")]),s._v(" "),a("ul",[a("li",[s._v("å‰©ä½™å†…å­˜å°äº"),a("strong",[s._v("é¡µæœ€å°é˜ˆå€¼")]),s._v(", è¯´æ˜è¿›ç¨‹å¯ç”¨å†…å­˜éƒ½è€—å°½äº†, åªæœ‰å†…æ ¸æ‰å¯ä»¥åˆ†é…å†…å­˜.")]),s._v(" "),a("li",[s._v("å‰©ä½™å†…å­˜è½åœ¨"),a("strong",[s._v("é¡µæœ€å°é˜ˆå€¼")]),s._v("å’Œ"),a("strong",[s._v("é¡µä½é˜ˆå€¼")]),s._v("ä¸­é—´, è¯´æ˜å†…å­˜å‹åŠ›æ¯”è¾ƒå¤§, å‰©ä½™å†…å­˜ä¸å¤šäº†. è¿™æ—¶ kswapd0 ä¼šæ‰§è¡Œå†…å­˜å›æ”¶, ç›´åˆ°å‰©ä½™å†…å­˜å¤§äºé«˜é˜ˆå€¼ä¸ºæ­¢.")]),s._v(" "),a("li",[s._v("å‰©ä½™å†…å­˜è½åœ¨"),a("strong",[s._v("é¡µä½é˜ˆå€¼")]),s._v("å’Œ"),a("strong",[s._v("é¡µé«˜é˜ˆå€¼")]),s._v("ä¸­é—´, è¯´æ˜å†…å­˜æœ‰ä¸€å®šå‹åŠ›, ä½†è¿˜å¯ä»¥æ»¡è¶³æ–°å†…å­˜è¯·æ±‚.")]),s._v(" "),a("li",[s._v("å‰©ä½™å†…å­˜å¤§äº"),a("strong",[s._v("é¡µé«˜é˜ˆå€¼")]),s._v(", è¯´æ˜å‰©ä½™å†…å­˜æ¯”è¾ƒå¤š, æ²¡æœ‰å†…å­˜å‹åŠ›.")])]),s._v(" "),a("p",[s._v("å¯ä»¥çœ‹åˆ°, ä¸€æ—¦å‰©ä½™å†…å­˜å°äºé¡µä½é˜ˆå€¼, å°±ä¼šè§¦å‘å†…å­˜çš„å›æ”¶. è¿™ä¸ªé¡µä½é˜ˆå€¼, å…¶å®å¯ä»¥é€šè¿‡å†…æ ¸é€‰é¡¹ "),a("code",[s._v("/proc/sys/vm/min_free_kbytes")]),s._v("â€‹ æ¥é—´æ¥è®¾ç½®. min_free_kbytes è®¾ç½®äº†é¡µæœ€å°é˜ˆå€¼, è€Œå…¶ä»–ä¸¤ä¸ªé˜ˆå€¼, éƒ½æ˜¯æ ¹æ®é¡µæœ€å°é˜ˆå€¼è®¡ç®—ç”Ÿæˆçš„, è®¡ç®—æ–¹æ³•å¦‚ä¸‹ :")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("pages_low "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pages_min"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\npages_high "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pages_min"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"_2-numaä¸swap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-numaä¸swap"}},[s._v("#")]),s._v(" 2.NUMAä¸Swap")]),s._v(" "),a("p",[s._v("å¾ˆå¤šæƒ…å†µä¸‹, ä½ æ˜æ˜å‘ç°äº† Swap å‡é«˜, å¯æ˜¯åœ¨åˆ†æç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æ—¶, å´å¾ˆå¯èƒ½å‘ç°, ç³»ç»Ÿå‰©ä½™å†…å­˜è¿˜å¤šç€å‘¢. "),a("strong",[s._v("ä¸ºä»€ä¹ˆå‰©ä½™å†…å­˜å¾ˆå¤šçš„æƒ…å†µä¸‹, ä¹Ÿä¼šå‘ç”Ÿ Swap å‘¢")]),s._v("?")]),s._v(" "),a("p",[s._v("çœ‹åˆ°ä¸Šé¢çš„æ ‡é¢˜, ä½ åº”è¯¥å·²ç»æƒ³åˆ°äº†, è¿™æ­£æ˜¯"),a("strong",[s._v("å¤„ç†å™¨çš„ NUMA (Non-Uniform Memory Access)æ¶æ„")]),s._v("å¯¼è‡´çš„.")]),s._v(" "),a("p",[s._v("å…³äº NUMA, å‰é¢ CPU æ¨¡å—ä¸­æ›¾ç®€å•æåˆ°è¿‡. åœ¨ NUMA æ¶æ„ä¸‹, å¤šä¸ªå¤„ç†å™¨è¢«åˆ’åˆ†åˆ°ä¸åŒ Node ä¸Š, ä¸”æ¯ä¸ª Node éƒ½æ‹¥æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ç©ºé—´.")]),s._v(" "),a("p",[s._v("è€ŒåŒä¸€ä¸ª Node å†…éƒ¨çš„å†…å­˜ç©ºé—´, å®é™…ä¸Šåˆå¯ä»¥è¿›ä¸€æ­¥åˆ†ä¸ºä¸åŒçš„å†…å­˜åŸŸ(Zone), æ¯”å¦‚ç›´æ¥å†…å­˜è®¿é—®åŒº(DMA), æ™®é€šå†…å­˜åŒº(NORMAL), ä¼ªå†…å­˜åŒº(MOVABLE)ç­‰, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/c7169bdd695c2cffa8ab21c5d0c5e801-20230731161933-a8if6oz.png",alt:""}})]),s._v(" "),a("p",[s._v("å…ˆä¸ç”¨ç‰¹åˆ«å…³æ³¨è¿™äº›å†…å­˜åŸŸçš„å…·ä½“å«ä¹‰, åªè¦ä¼šæŸ¥çœ‹é˜ˆå€¼çš„é…ç½®, ä»¥åŠç¼“å­˜, åŒ¿åé¡µçš„å®é™…ä½¿ç”¨æƒ…å†µå°±å¤Ÿäº†.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶ NUMA æ¶æ„ä¸‹çš„æ¯ä¸ª Node éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ç©ºé—´, é‚£ä¹ˆåœ¨åˆ†æå†…å­˜çš„ä½¿ç”¨æ—¶, ä¹Ÿåº”è¯¥"),a("strong",[s._v("é’ˆå¯¹æ¯ä¸ª Node å•ç‹¬åˆ†æ")]),s._v(".")]),s._v(" "),a("p",[s._v("å¯ä»¥é€šè¿‡ numactl å‘½ä»¤, æ¥æŸ¥çœ‹å¤„ç†å™¨åœ¨ Node çš„åˆ†å¸ƒæƒ…å†µ, ä»¥åŠæ¯ä¸ª Node çš„å†…å­˜ä½¿ç”¨æƒ…å†µ. æ¯”å¦‚, ä¸‹é¢å°±æ˜¯ä¸€ä¸ª numactl è¾“å‡ºçš„ç¤ºä¾‹:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ numactl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("hardware\navailable"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nodes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" cpus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7977")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MB")]),s._v("\nnode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4416")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MB")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è¿™ä¸ªç•Œé¢æ˜¾ç¤º, æˆ‘çš„ç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ª Node, ä¹Ÿå°±æ˜¯ Node 0, è€Œä¸”ç¼–å·ä¸º 0 å’Œ 1 çš„ä¸¤ä¸ª CPU,  éƒ½ä½äº Node 0 ä¸Š. å¦å¤–, Node 0 çš„å†…å­˜å¤§å°ä¸º 7977 MB, å‰©ä½™å†…å­˜ä¸º 4416 MB.")]),s._v(" "),a("p",[s._v("äº†è§£äº† NUNA çš„æ¶æ„å’Œ NUMA å†…å­˜çš„æŸ¥çœ‹æ–¹æ³•å, ä½ å¯èƒ½å°±è¦é—®äº†"),a("strong",[s._v("è¿™è·Ÿ Swap æœ‰ä»€ä¹ˆå…³ç³»")]),s._v("å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, å‰é¢æåˆ°çš„ä¸‰ä¸ªå†…å­˜é˜ˆå€¼(é¡µæœ€å°é˜ˆå€¼, é¡µä½é˜ˆå€¼å’Œé¡µé«˜é˜ˆå€¼), éƒ½å¯ä»¥é€šè¿‡å†…å­˜åŸŸåœ¨ proc æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ¥å£ "),a("code",[s._v("/proc/zoneinfo")]),s._v("â€‹ æ¥æŸ¥çœ‹.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä¸‹é¢å°±æ˜¯ä¸€ä¸ª "),a("code",[s._v("/proc/zoneinfo")]),s._v("â€‹ æ–‡ä»¶çš„å†…å®¹ç¤ºä¾‹:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ cat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("proc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zoneinfo\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" zone   "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Normal")]),s._v("\n pages free     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("227894")]),s._v("\n       min      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14896")]),s._v("\n       low      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18620")]),s._v("\n       high     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22344")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n     nr_free_pages "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("227894")]),s._v("\n     nr_zone_inactive_anon "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11082")]),s._v("\n     nr_zone_active_anon "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14024")]),s._v("\n     nr_zone_inactive_file "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("539024")]),s._v("\n     nr_zone_active_file "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("923986")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè¾“å‡ºä¸­æœ‰å¤§é‡æŒ‡æ ‡, ä¸‹é¢è§£é‡Šä¸€ä¸‹æ¯”è¾ƒé‡è¦çš„å‡ ä¸ª.")]),s._v(" "),a("ul",[a("li",[s._v("pages å¤„çš„ min, low, high, å°±æ˜¯ä¸Šé¢æåˆ°çš„ä¸‰ä¸ªå†…å­˜é˜ˆå€¼, è€Œ free æ˜¯å‰©ä½™å†…å­˜é¡µæ•°, å®ƒè·Ÿåé¢çš„ nr_free_pages ç›¸åŒ.")]),s._v(" "),a("li",[s._v("nr_zone_active_anon å’Œ nr_zone_inactive_anon, åˆ†åˆ«æ˜¯æ´»è·ƒå’Œéæ´»è·ƒçš„åŒ¿åé¡µæ•°.")]),s._v(" "),a("li",[s._v("nr_zone_active_file å’Œ nr_zone_inactive_file, åˆ†åˆ«æ˜¯æ´»è·ƒå’Œéæ´»è·ƒçš„æ–‡ä»¶é¡µæ•°.")])]),s._v(" "),a("p",[s._v("ä»è¿™ä¸ªè¾“å‡ºç»“æœå¯ä»¥å‘ç°, "),a("strong",[s._v("å‰©ä½™å†…å­˜è¿œå¤§äºé¡µé«˜é˜ˆå€¼, æ‰€ä»¥æ­¤æ—¶çš„ kswapd0 ä¸ä¼šå›æ”¶å†…å­˜")]),s._v(".")]),s._v(" "),a("p",[s._v("å½“ç„¶, æŸä¸ª Node å†…å­˜ä¸è¶³æ—¶, ç³»ç»Ÿå¯ä»¥ä»å…¶ä»– Node å¯»æ‰¾ç©ºé—²å†…å­˜, ä¹Ÿå¯ä»¥ä»æœ¬åœ°å†…å­˜ä¸­å›æ”¶å†…å­˜. å…·ä½“é€‰å“ªç§æ¨¡å¼, å¯ä»¥é€šè¿‡ "),a("code",[s._v("/proc/sys/vm/zone_reclaim_mode")]),s._v("â€‹ æ¥è°ƒæ•´. å®ƒæ”¯æŒä»¥ä¸‹å‡ ä¸ªé€‰é¡¹:")]),s._v(" "),a("ul",[a("li",[s._v("é»˜è®¤çš„ 0, ä¹Ÿå°±æ˜¯åˆšåˆšæåˆ°çš„æ¨¡å¼, è¡¨ç¤ºæ—¢å¯ä»¥ä»å…¶ä»– Node å¯»æ‰¾ç©ºé—²å†…å­˜, ä¹Ÿå¯ä»¥ä»æœ¬åœ°å›æ”¶å†…å­˜.")]),s._v(" "),a("li",[s._v("1, 2, 4 éƒ½è¡¨ç¤ºåªå›æ”¶æœ¬åœ°å†…å­˜, 2 è¡¨ç¤ºå¯ä»¥å›å†™è„æ•°æ®å›æ”¶å†…å­˜, 4 è¡¨ç¤ºå¯ä»¥ç”¨ Swap æ–¹å¼å›æ”¶å†…å­˜.")])]),s._v(" "),a("h5",{attrs:{id:"_3-swappiness"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-swappiness"}},[s._v("#")]),s._v(" 3.swappiness")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œå°±å¯ä»¥ç†è§£å†…å­˜å›æ”¶çš„æœºåˆ¶äº†. è¿™äº›"),a("strong",[s._v("å›æ”¶çš„å†…å­˜æ—¢åŒ…æ‹¬äº†æ–‡ä»¶é¡µ, åˆåŒ…æ‹¬äº†åŒ¿åé¡µ")]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("mark",[a("strong",[s._v("å¯¹æ–‡ä»¶é¡µçš„å›æ”¶, å½“ç„¶å°±æ˜¯ç›´æ¥å›æ”¶ç¼“å­˜, æˆ–è€…æŠŠè„é¡µå†™å›ç£ç›˜åå†å›æ”¶.")])])]),s._v(" "),a("li",[a("mark",[a("strong",[s._v("è€Œå¯¹åŒ¿åé¡µçš„å›æ”¶, å…¶å®å°±æ˜¯é€šè¿‡ Swap æœºåˆ¶, æŠŠå®ƒä»¬å†™å…¥ç£ç›˜åå†é‡Šæ”¾å†…å­˜.")])])])]),s._v(" "),a("p",[s._v("ä¸è¿‡, ä½ å¯èƒ½è¿˜æœ‰ä¸€ä¸ªé—®é¢˜. æ—¢ç„¶æœ‰ä¸¤ç§ä¸åŒçš„å†…å­˜å›æ”¶æœºåˆ¶, é‚£ä¹ˆåœ¨å®é™…å›æ”¶å†…å­˜æ—¶, åˆ°åº•è¯¥å…ˆå›æ”¶å“ªä¸€ç§å‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®, Linux æä¾›äº†ä¸€ä¸ª "),a("code",[s._v("/proc/sys/vm/swappiness")]),s._v("â€‹ é€‰é¡¹, ç”¨æ¥è°ƒæ•´ä½¿ç”¨ Swap çš„ç§¯æç¨‹åº¦.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("swappiness çš„èŒƒå›´æ˜¯ 0-100, æ•°å€¼è¶Šå¤§, è¶Šç§¯æä½¿ç”¨ Swap, ä¹Ÿå°±æ˜¯æ›´å€¾å‘äºå›æ”¶åŒ¿åé¡µ; æ•°å€¼è¶Šå°, è¶Šæ¶ˆæä½¿ç”¨ Swap, ä¹Ÿå°±æ˜¯æ›´å€¾å‘äºå›æ”¶æ–‡ä»¶é¡µ")])]),s._v(".")]),s._v(" "),a("p",[s._v("è™½ç„¶ swappiness çš„èŒƒå›´æ˜¯ 0-100, ä¸è¿‡è¦æ³¨æ„, è¿™å¹¶ä¸æ˜¯å†…å­˜çš„ç™¾åˆ†æ¯”, è€Œæ˜¯è°ƒæ•´ Swap ç§¯æç¨‹åº¦çš„æƒé‡, å³ä½¿æŠŠå®ƒè®¾ç½®æˆ 0, å½“"),a("strong",[s._v("å‰©ä½™å†…å­˜ + æ–‡ä»¶é¡µå°äºé¡µé«˜é˜ˆå€¼")]),s._v("æ—¶, è¿˜æ˜¯ä¼šå‘ç”Ÿ Swap.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-5"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("åœ¨å†…å­˜èµ„æºç´§å¼ æ—¶, Linux é€šè¿‡"),a("strong",[s._v("ç›´æ¥å†…å­˜å›æ”¶å’Œå®šæœŸæ‰«æçš„æ–¹å¼, æ¥é‡Šæ”¾æ–‡ä»¶é¡µå’ŒåŒ¿åé¡µ, ä»¥ä¾¿æŠŠå†…å­˜åˆ†é…ç»™æ›´éœ€è¦çš„è¿›ç¨‹ä½¿ç”¨")]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("æ–‡ä»¶é¡µçš„å›æ”¶æ¯”è¾ƒå®¹æ˜“ç†è§£, ç›´æ¥æ¸…ç©º, æˆ–è€…æŠŠè„æ•°æ®å†™å›ç£ç›˜åå†é‡Šæ”¾")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("è€Œå¯¹åŒ¿åé¡µçš„å›æ”¶, éœ€è¦é€šè¿‡ Swap æ¢å‡ºåˆ°ç£ç›˜ä¸­, ä¸‹æ¬¡è®¿é—®æ—¶, å†ä»ç£ç›˜æ¢å…¥åˆ°å†…å­˜ä¸­.")])])]),s._v(" "),a("p",[s._v("å¯ä»¥è®¾ç½® "),a("code",[s._v("/proc/sys/vm/min_free_kbytes")]),s._v("â€‹, æ¥è°ƒæ•´ç³»ç»Ÿå®šæœŸå›æ”¶å†…å­˜çš„é˜ˆå€¼(ä¹Ÿå°±æ˜¯é¡µä½é˜ˆå€¼), è¿˜å¯ä»¥è®¾ç½® "),a("code",[s._v("/proc/sys/vm/swappiness")]),s._v("â€‹, æ¥è°ƒæ•´æ–‡ä»¶é¡µå’ŒåŒ¿åé¡µçš„å›æ”¶å€¾å‘.")]),s._v(" "),a("p",[s._v("åœ¨ NUMA æ¶æ„ä¸‹, æ¯ä¸ª Node éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ç©ºé—´, è€Œå½“æœ¬åœ°å†…å­˜ä¸è¶³æ—¶, é»˜è®¤æ—¢å¯ä»¥ä»å…¶ä»– Node å¯»æ‰¾ç©ºé—²å†…å­˜, ä¹Ÿå¯ä»¥ä»æœ¬åœ°å†…å­˜å›æ”¶.")]),s._v(" "),a("p",[s._v("å¯ä»¥è®¾ç½® "),a("code",[s._v("/proc/sys/vm/zone_reclaim_mode")]),s._v("â€‹, æ¥è°ƒæ•´ NUMA æœ¬åœ°å†…å­˜çš„å›æ”¶ç­–ç•¥.")]),s._v(" "),a("h4",{attrs:{id:"_20-æ¡ˆä¾‹ç¯‡-ä¸ºä»€ä¹ˆç³»ç»Ÿçš„swapå˜é«˜äº†-ä¸‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_20-æ¡ˆä¾‹ç¯‡-ä¸ºä»€ä¹ˆç³»ç»Ÿçš„swapå˜é«˜äº†-ä¸‹"}},[s._v("#")]),s._v(" 20-æ¡ˆä¾‹ç¯‡:ä¸ºä»€ä¹ˆç³»ç»Ÿçš„Swapå˜é«˜äº†?(ä¸‹)")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚è¯¦ç»†å­¦ä¹ äº† Linux å†…å­˜å›æ”¶, ç‰¹åˆ«æ˜¯ Swap çš„åŸç†, é‚£ä¹ˆ, "),a("strong",[s._v("å½“ Swap ä½¿ç”¨å‡é«˜æ—¶, è¦å¦‚ä½•å®šä½å’Œåˆ†æå‘¢")]),s._v("? ä¸‹é¢, å°±æ¥çœ‹ä¸€ä¸ªç£ç›˜ I/O çš„æ¡ˆä¾‹, å®æˆ˜åˆ†æå’Œæ¼”ç»ƒ.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹-2"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹")]),s._v(" "),a("p",[s._v("ä¸‹é¢æ¡ˆä¾‹åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ.")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("éœ€è¦é¢„å…ˆå®‰è£… sysstat ç­‰å·¥å…·, å¦‚ apt install sysstat")])]),s._v(" "),a("p",[s._v("é¦–å…ˆæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯, åˆ†åˆ« SSH ç™»å½•åˆ°ä¸¤å°æœºå™¨ä¸Š, å¹¶å®‰è£…ä¸Šé¢æåˆ°çš„è¿™äº›å·¥å…·.")]),s._v(" "),a("p",[s._v("ç„¶å, åœ¨ç»ˆç«¯ä¸­è¿è¡Œ free å‘½ä»¤, æŸ¥çœ‹ Swap çš„ä½¿ç”¨æƒ…å†µ. æ¯”å¦‚, åœ¨æˆ‘çš„æœºå™¨ä¸­, è¾“å‡ºå¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ free\n             total        used        free      shared  buff"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cache   available\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mem")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169348")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("331668")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6715972")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("696")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1121708")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7522896")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Swap")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä»è¿™ä¸ª free è¾“å‡ºå¯ä»¥çœ‹åˆ°, Swap çš„å¤§å°æ˜¯ 0, è¿™è¯´æ˜æˆ‘çš„æœºå™¨æ²¡æœ‰é…ç½® Swap.")]),s._v(" "),a("p",[s._v("ä¸ºäº†ç»§ç»­ Swap çš„æ¡ˆä¾‹, å°±éœ€è¦å…ˆé…ç½®å¼€å¯ Swap. å¦‚æœä½ çš„ç¯å¢ƒä¸­å·²ç»å¼€å¯äº† Swap, é‚£å¯ä»¥ç•¥è¿‡ä¸‹é¢çš„å¼€å¯æ­¥éª¤, ç»§ç»­å¾€åèµ°.")]),s._v(" "),a("p",[s._v("è¦å¼€å¯ Swap, é¦–å…ˆè¦æ¸…æ¥š, Linux æœ¬èº«æ”¯æŒä¸¤ç§ç±»å‹çš„ Swap, å³ "),a("strong",[s._v("Swap åˆ†åŒºå’Œ Swap æ–‡ä»¶")]),s._v(". ä»¥ Swap æ–‡ä»¶ä¸ºä¾‹, åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¼€å¯ Swap, è¿™é‡Œé…ç½® Swap æ–‡ä»¶çš„å¤§å°ä¸º 8GB:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ›å»º Swap æ–‡ä»¶")]),s._v("\n$ fallocate "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" 8G /mnt/swapfile\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¿®æ”¹æƒé™åªæœ‰æ ¹ç”¨æˆ·å¯ä»¥è®¿é—®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /mnt/swapfile\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é…ç½® Swap æ–‡ä»¶")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkswap")]),s._v(" /mnt/swapfile\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¼€å¯ Swap")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" /mnt/swapfile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ç„¶å, å†æ‰§è¡Œ free å‘½ä»¤, ç¡®è®¤ Swap é…ç½®æˆåŠŸ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("\n             total        used        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169348")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("331668")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6715972")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("696")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1121708")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7522896")]),s._v("\nSwap:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8388604")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8388604")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç°åœ¨, free è¾“å‡ºä¸­, Swap ç©ºé—´ä»¥åŠå‰©ä½™ç©ºé—´éƒ½ä» 0 å˜æˆäº† 8GB, è¯´æ˜ Swap å·²ç»"),a("strong",[s._v("æ­£å¸¸å¼€å¯")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­, è¿è¡Œä¸‹é¢çš„ dd å‘½ä»¤, æ¨¡æ‹Ÿå¤§æ–‡ä»¶çš„è¯»å–:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å†™å…¥ç©ºè®¾å¤‡, å®é™…ä¸Šåªæœ‰ç£ç›˜çš„è¯»è¯·æ±‚")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sda1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1G "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ç€, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­è¿è¡Œ sar å‘½ä»¤, æŸ¥çœ‹å†…å­˜å„ä¸ªæŒ‡æ ‡çš„å˜åŒ–æƒ…å†µ. å¯ä»¥å¤šè§‚å¯Ÿä¸€ä¼šå„¿, æŸ¥çœ‹è¿™äº›æŒ‡æ ‡çš„å˜åŒ–æƒ…å†µ.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é—´éš” 1 ç§’è¾“å‡ºä¸€ç»„æ•°æ®")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -r è¡¨ç¤ºæ˜¾ç¤ºå†…å­˜ä½¿ç”¨æƒ…å†µ, -S è¡¨ç¤ºæ˜¾ç¤º Swap ä½¿ç”¨æƒ…å†µ")]),s._v("\n$ sar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n04:39:56    kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty\n04:39:57      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6249676")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6839824")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1919632")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23.50")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("740512")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67316")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1691736")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.22")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("815156")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("841868")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n \n04:39:56    kbswpfree kbswpused  %swpused  kbswpcad   %swpcad\n04:39:57      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8388604")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n \n04:39:57    kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty\n04:39:58      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6184472")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6807064")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1984836")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.30")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("772768")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67380")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1691736")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.22")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("847932")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("874224")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n \n04:39:57    kbswpfree kbswpused  %swpused  kbswpcad   %swpcad\n04:39:58      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8388604")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \n04:44:06    kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty\n04:44:07       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("152780")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6525716")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8016528")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.13")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6530440")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51316")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1691736")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.22")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("867124")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6869332")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n \n04:44:06    kbswpfree kbswpused  %swpused  kbswpcad   %swpcad\n04:44:07      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8384508")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.27")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, sar çš„è¾“å‡ºç»“æœæ˜¯ä¸¤ä¸ªè¡¨æ ¼, "),a("strong",[s._v("ç¬¬ä¸€ä¸ªè¡¨æ ¼è¡¨ç¤ºå†…å­˜çš„ä½¿ç”¨æƒ…å†µ, ç¬¬äºŒä¸ªè¡¨æ ¼è¡¨ç¤º Swap çš„ä½¿ç”¨æƒ…å†µ")]),s._v(". å…¶ä¸­, å„ä¸ªæŒ‡æ ‡åç§°å‰é¢çš„ kb å‰ç¼€, è¡¨ç¤ºè¿™äº›æŒ‡æ ‡çš„å•ä½æ˜¯ KB.")]),s._v(" "),a("p",[s._v("å»æ‰å‰ç¼€å, ä½ ä¼šå‘ç°, å¤§éƒ¨åˆ†æŒ‡æ ‡éƒ½å·²ç»è§è¿‡äº†, å‰©ä¸‹çš„å‡ ä¸ªæ–°å‡ºç°çš„æŒ‡æ ‡æ¥ç®€å•ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),a("ul",[a("li",[s._v("kbcommit, è¡¨ç¤ºå½“å‰"),a("strong",[s._v("ç³»ç»Ÿè´Ÿè½½éœ€è¦çš„å†…å­˜")]),s._v(". å®ƒå®é™…ä¸Šæ˜¯ä¸ºäº†ä¿è¯ç³»ç»Ÿå†…å­˜ä¸æº¢å‡º, å¯¹éœ€è¦å†…å­˜çš„ä¼°è®¡å€¼. %commit, å°±æ˜¯è¿™ä¸ªå€¼ç›¸å¯¹æ€»å†…å­˜çš„ç™¾åˆ†æ¯”.")]),s._v(" "),a("li",[s._v("kbactive, è¡¨ç¤º"),a("strong",[s._v("æ´»è·ƒå†…å­˜")]),s._v(", ä¹Ÿå°±æ˜¯æœ€è¿‘ä½¿ç”¨è¿‡çš„å†…å­˜, "),a("strong",[s._v("ä¸€èˆ¬ä¸ä¼šè¢«ç³»ç»Ÿå›æ”¶")]),s._v(".")]),s._v(" "),a("li",[s._v("kbinact, è¡¨ç¤º"),a("strong",[s._v("éæ´»è·ƒå†…å­˜")]),s._v(", ä¹Ÿå°±æ˜¯ä¸å¸¸è®¿é—®çš„å†…å­˜, "),a("strong",[s._v("æœ‰å¯èƒ½ä¼šè¢«ç³»ç»Ÿå›æ”¶")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ¸…æ¥šäº†ç•Œé¢æŒ‡æ ‡çš„å«ä¹‰å, å†ç»“åˆå…·ä½“æ•°å€¼, æ¥åˆ†æç›¸å…³çš„ç°è±¡. å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°, "),a("strong",[s._v("æ€»çš„å†…å­˜ä½¿ç”¨ç‡(%memused)åœ¨ä¸æ–­å¢é•¿, ä»å¼€å§‹çš„ 23% ä¸€ç›´é•¿åˆ°äº† 98%, å¹¶ä¸”ä¸»è¦å†…å­˜éƒ½è¢«ç¼“å†²åŒº(kbbuffers)å ç”¨")]),s._v(". å…·ä½“æ¥è¯´:")]),s._v(" "),a("ul",[a("li",[s._v("åˆšå¼€å§‹, å‰©ä½™å†…å­˜(kbmemfree)ä¸æ–­å‡å°‘, è€Œç¼“å†²åŒº(kbbuffers)åˆ™ä¸æ–­å¢å¤§, ç”±æ­¤å¯çŸ¥, å‰©ä½™å†…å­˜ä¸æ–­åˆ†é…ç»™äº†ç¼“å†²åŒº.")]),s._v(" "),a("li",[s._v("ä¸€æ®µæ—¶é—´å, å‰©ä½™å†…å­˜å·²ç»å¾ˆå°, "),a("strong",[s._v("è€Œç¼“å†²åŒºå ç”¨äº†å¤§éƒ¨åˆ†å†…å­˜")]),s._v(". è¿™æ—¶å€™, Swap çš„ä½¿ç”¨å¼€å§‹é€æ¸å¢å¤§, ç¼“å†²åŒºå’Œå‰©ä½™å†…å­˜åˆ™åªåœ¨å°èŒƒå›´å†…æ³¢åŠ¨.")])]),s._v(" "),a("p",[s._v("ä½ å¯èƒ½å›°æƒ‘äº†, ä¸ºä»€ä¹ˆç¼“å†²åŒºåœ¨ä¸åœå¢å¤§? è¿™åˆæ˜¯å“ªäº›è¿›ç¨‹å¯¼è‡´çš„å‘¢?")]),s._v(" "),a("p",[s._v("æ˜¾ç„¶è¿˜å¾—çœ‹çœ‹è¿›ç¨‹ç¼“å­˜çš„æƒ…å†µ. åœ¨å‰é¢ç¼“å­˜çš„æ¡ˆä¾‹ä¸­å­¦è¿‡, cachetop æ­£å¥½èƒ½æ»¡è¶³è¿™ä¸€ç‚¹. é‚£å°±æ¥ cachetop ä¸€ä¸‹.")]),s._v(" "),a("p",[s._v("åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­, æŒ‰ä¸‹ Ctrl+C åœæ­¢ sar å‘½ä»¤, ç„¶åè¿è¡Œä¸‹é¢çš„ cachetop å‘½ä»¤, è§‚å¯Ÿç¼“å­˜çš„ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ cachetop "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":28:28 Buffers MB: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6349")]),s._v(" / Cached MB: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87")]),s._v(" / Sort: HITS / Order: ascending\nPID      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18280")]),s._v(" root     python                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18279")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41088")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41022")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50.0")]),s._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50.0")]),s._v("%\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("é€šè¿‡ cachetop çš„è¾“å‡ºçœ‹åˆ°, dd è¿›ç¨‹çš„è¯»å†™è¯·æ±‚åªæœ‰ 50% çš„å‘½ä¸­ç‡, å¹¶ä¸”"),a("strong",[s._v("æœªå‘½ä¸­çš„ç¼“å­˜é¡µæ•°(MISSES)ä¸º 41022(å•ä½æ˜¯é¡µ)")]),s._v(" . è¿™è¯´æ˜, æ­£æ˜¯æ¡ˆä¾‹å¼€å§‹æ—¶è¿è¡Œçš„ dd, å¯¼è‡´äº†ç¼“å†²åŒºä½¿ç”¨å‡é«˜.")]),s._v(" "),a("p",[s._v("ä½ å¯èƒ½æ¥ç€ä¼šé—®, ä¸ºä»€ä¹ˆ Swap ä¹Ÿè·Ÿç€å‡é«˜äº†å‘¢? ç›´è§‚æ¥è¯´, ç¼“å†²åŒºå äº†ç³»ç»Ÿç»å¤§éƒ¨åˆ†å†…å­˜, è¿˜å±äºå¯å›æ”¶å†…å­˜, å†…å­˜ä¸å¤Ÿç”¨æ—¶, ä¸åº”è¯¥å…ˆå›æ”¶ç¼“å†²åŒºå—?")]),s._v(" "),a("p",[s._v("è¿™ç§æƒ…å†µ, è¿˜å¾—è¿›ä¸€æ­¥é€šè¿‡ "),a("code",[s._v("/proc/zoneinfo")]),s._v("â€‹ æ¥è§‚å¯Ÿå‰©ä½™å†…å­˜, å†…å­˜é˜ˆå€¼ä»¥åŠåŒ¿åé¡µå’Œæ–‡ä»¶é¡µçš„æ´»è·ƒæƒ…å†µ.")]),s._v(" "),a("p",[s._v("å¯ä»¥åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­, æŒ‰ä¸‹ Ctrl+C, åœæ­¢ cachetop å‘½ä»¤. ç„¶åè¿è¡Œä¸‹é¢çš„å‘½ä»¤, è§‚å¯Ÿ "),a("code",[s._v("/proc/zoneinfo")]),s._v("â€‹ ä¸­è¿™å‡ ä¸ªæŒ‡æ ‡çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d è¡¨ç¤ºé«˜äº®å˜åŒ–çš„å­—æ®µ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -A è¡¨ç¤ºä»…æ˜¾ç¤º Normal è¡Œä»¥åŠä¹‹åçš„ 15 è¡Œè¾“å‡º")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Normal'")]),s._v(" /proc/zoneinfo\nNode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", zone   Normal\n  pages "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21328")]),s._v("\n        min      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14896")]),s._v("\n        low      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18620")]),s._v("\n        high     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22344")]),s._v("\n        spanned  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1835008")]),s._v("\n        present  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1835008")]),s._v("\n        managed  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1796710")]),s._v("\n        protection: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      nr_free_pages "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21328")]),s._v("\n      nr_zone_inactive_anon "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79776")]),s._v("\n      nr_zone_active_anon "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("206854")]),s._v("\n      nr_zone_inactive_file "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("918561")]),s._v("\n      nr_zone_active_file "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("496695")]),s._v("\n      nr_zone_unevictable "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2251")]),s._v("\n      nr_zone_write_pending "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("å¯ä»¥å‘ç°, "),a("strong",[s._v("å‰©ä½™å†…å­˜(pages_free)åœ¨ä¸€ä¸ªå°èŒƒå›´å†…ä¸åœåœ°æ³¢åŠ¨. å½“å®ƒå°äºé¡µä½é˜ˆå€¼(pages_low) æ—¶, åˆä¼šçªç„¶å¢å¤§åˆ°ä¸€ä¸ªå¤§äºé¡µé«˜é˜ˆå€¼(pages_high)çš„å€¼")]),s._v(".")]),s._v(" "),a("p",[s._v("å†ç»“åˆåˆšåˆšç”¨ sar çœ‹åˆ°çš„å‰©ä½™å†…å­˜å’Œç¼“å†²åŒºçš„å˜åŒ–æƒ…å†µ, å¯ä»¥æ¨å¯¼å‡º, å‰©ä½™å†…å­˜å’Œç¼“å†²åŒºçš„æ³¢åŠ¨å˜åŒ–, æ­£æ˜¯"),a("strong",[s._v("ç”±äºå†…å­˜å›æ”¶å’Œç¼“å­˜å†æ¬¡åˆ†é…çš„å¾ªç¯å¾€å¤")]),s._v(".")]),s._v(" "),a("ul",[a("li",[s._v("å½“å‰©ä½™å†…å­˜å°äºé¡µä½é˜ˆå€¼æ—¶, ç³»ç»Ÿä¼šå›æ”¶ä¸€äº›ç¼“å­˜å’ŒåŒ¿åå†…å­˜, ä½¿å‰©ä½™å†…å­˜å¢å¤§. å…¶ä¸­, ç¼“å­˜çš„å›æ”¶å¯¼è‡´ sar ä¸­çš„ç¼“å†²åŒºå‡å°, è€ŒåŒ¿åå†…å­˜çš„å›æ”¶å¯¼è‡´äº† Swap çš„ä½¿ç”¨å¢å¤§.")]),s._v(" "),a("li",[s._v("ç´§æ¥ç€, ç”±äº dd è¿˜åœ¨ç»§ç»­, å‰©ä½™å†…å­˜åˆä¼šé‡æ–°åˆ†é…ç»™ç¼“å­˜, å¯¼è‡´å‰©ä½™å†…å­˜å‡å°‘, ç¼“å†²åŒºå¢å¤§.")])]),s._v(" "),a("p",[s._v("å…¶å®è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡, å¦‚æœå¤šæ¬¡è¿è¡Œ dd å’Œ sar, ä½ å¯èƒ½ä¼šå‘ç°, åœ¨å¤šæ¬¡çš„å¾ªç¯é‡å¤ä¸­, æœ‰æ—¶å€™æ˜¯ Swap ç”¨å¾—æ¯”è¾ƒå¤š, æœ‰æ—¶å€™ Swap å¾ˆå°‘, åè€Œç¼“å†²åŒºçš„æ³¢åŠ¨æ›´å¤§.")]),s._v(" "),a("p",[s._v("æ¢å¥è¯è¯´, "),a("strong",[s._v("ç³»ç»Ÿå›æ”¶å†…å­˜æ—¶, æœ‰æ—¶å€™ä¼šå›æ”¶æ›´å¤šçš„æ–‡ä»¶é¡µ, æœ‰æ—¶å€™åˆå›æ”¶äº†æ›´å¤šçš„åŒ¿åé¡µ")]),s._v(".")]),s._v(" "),a("p",[s._v("æ˜¾ç„¶, ç³»ç»Ÿå›æ”¶ä¸åŒç±»å‹å†…å­˜çš„å€¾å‘, ä¼¼ä¹ä¸é‚£ä¹ˆæ˜æ˜¾. ä½ åº”è¯¥æƒ³åˆ°äº†ä¸ŠèŠ‚è¯¾æåˆ°çš„ "),a("strong",[s._v("swappiness")]),s._v(", æ­£æ˜¯è°ƒæ•´ä¸åŒç±»å‹å†…å­˜å›æ”¶çš„é…ç½®é€‰é¡¹.")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­, æŒ‰ä¸‹ Ctrl+C åœæ­¢ watch å‘½ä»¤, ç„¶åè¿è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹ swappiness çš„é…ç½®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/vm/swappiness\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("swappiness æ˜¾ç¤ºçš„æ˜¯é»˜è®¤å€¼ 60, è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ä¸­å’Œçš„é…ç½®, æ‰€ä»¥ç³»ç»Ÿä¼šæ ¹æ®å®é™…è¿è¡Œæƒ…å†µ, é€‰æ‹©åˆé€‚çš„å›æ”¶ç±»å‹, æ¯”å¦‚å›æ”¶ä¸æ´»è·ƒçš„åŒ¿åé¡µ, æˆ–è€…ä¸æ´»è·ƒçš„æ–‡ä»¶é¡µ.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œå·²ç»æ‰¾å‡ºäº† Swap å‘ç”Ÿçš„æ ¹æº. å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯, åˆšæ‰çš„ Swap åˆ°åº•å½±å“äº†å“ªäº›åº”ç”¨ç¨‹åºå‘¢? æ¢å¥è¯è¯´, "),a("strong",[s._v("Swap æ¢å‡ºçš„æ˜¯å“ªäº›è¿›ç¨‹çš„å†…å­˜")]),s._v("?")]),s._v(" "),a("p",[s._v("è¿™é‡Œè¿˜æ˜¯æ¨è proc æ–‡ä»¶ç³»ç»Ÿ, ç”¨æ¥"),a("strong",[s._v("æŸ¥çœ‹è¿›ç¨‹ Swap æ¢å‡ºçš„è™šæ‹Ÿå†…å­˜å¤§å°")]),s._v(", å®ƒä¿å­˜åœ¨ "),a("code",[s._v("/proc/pid/status")]),s._v("â€‹ ä¸­çš„ VmSwap ä¸­(æ¨èæ‰§è¡Œ man proc æ¥æŸ¥è¯¢å…¶ä»–å­—æ®µçš„å«ä¹‰).")]),s._v(" "),a("p",[s._v("åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥æŸ¥çœ‹ä½¿ç”¨ Swap æœ€å¤šçš„è¿›ç¨‹.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‰ VmSwap ä½¿ç”¨é‡å¯¹è¿›ç¨‹æ’åº, è¾“å‡ºè¿›ç¨‹åç§°, è¿›ç¨‹ ID ä»¥åŠ SWAP ç”¨é‡")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /proc/*/status "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'/VmSwap|Name|^Pid/{printf $2 " " $3}END{ print ""}\'')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v("\ndockerd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2226")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10728")]),s._v(" kB\ndocker-containe "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2251")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8516")]),s._v(" kB\nsnapd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("936")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4020")]),s._v(" kB\nnetworkd-dispat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("911")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("836")]),s._v(" kB\npolkitd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1004")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" kB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°, ä½¿ç”¨ Swap æ¯”è¾ƒå¤šçš„æ˜¯ dockerd å’Œ docker-containe è¿›ç¨‹, æ‰€ä»¥"),a("strong",[s._v("å½“ dockerd å†æ¬¡è®¿é—®è¿™äº›æ¢å‡ºåˆ°ç£ç›˜çš„å†…å­˜æ—¶, ä¹Ÿä¼šæ¯”è¾ƒæ…¢")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™ä¹Ÿè¯´æ˜äº†ä¸€ç‚¹, è™½ç„¶ç¼“å­˜å±äºå¯å›æ”¶å†…å­˜, "),a("strong",[s._v("ä½†åœ¨ç±»ä¼¼å¤§æ–‡ä»¶æ‹·è´è¿™ç±»åœºæ™¯ä¸‹, ç³»ç»Ÿè¿˜æ˜¯ä¼šç”¨ Swap æœºåˆ¶æ¥å›æ”¶åŒ¿åå†…å­˜, è€Œä¸ä»…ä»…æ˜¯å›æ”¶å ç”¨ç»å¤§éƒ¨åˆ†å†…å­˜çš„æ–‡ä»¶é¡µ")]),s._v(".")]),s._v(" "),a("p",[s._v("æœ€å, å¦‚æœåœ¨ä¸€å¼€å§‹é…ç½®äº† Swap, ä¸è¦å¿˜è®°åœ¨æ¡ˆä¾‹ç»“æŸåå…³é—­. å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤, å…³é—­ Swap:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ swapoff "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å®é™…ä¸Š, å…³é—­ Swap åå†é‡æ–°æ‰“å¼€, ä¹Ÿæ˜¯ä¸€ç§"),a("strong",[s._v("å¸¸ç”¨çš„ Swap ç©ºé—´æ¸…ç†æ–¹æ³•")]),s._v(", æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ swapoff "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"_2-å°ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å°ç»“-2"}},[s._v("#")]),s._v(" 2.å°ç»“")]),s._v(" "),a("p",[s._v("åœ¨å†…å­˜èµ„æºç´§å¼ æ—¶, Linux ä¼šé€šè¿‡ Swap æŠŠä¸å¸¸è®¿é—®çš„åŒ¿åé¡µæ¢å‡ºåˆ°ç£ç›˜ä¸­, ä¸‹æ¬¡è®¿é—®çš„æ—¶å€™å†ä»ç£ç›˜æ¢å…¥åˆ°å†…å­˜ä¸­æ¥. å¯ä»¥è®¾ç½® "),a("code",[s._v("/proc/sys/vm/min_free_kbytes")]),s._v("â€‹, æ¥è°ƒæ•´ç³»ç»Ÿå®šæœŸ"),a("strong",[s._v("å›æ”¶å†…å­˜çš„é˜ˆå€¼")]),s._v("; ä¹Ÿå¯ä»¥è®¾ç½® "),a("code",[s._v("/proc/sys/vm/swappiness")]),s._v("â€‹, æ¥è°ƒæ•´æ–‡ä»¶é¡µå’ŒåŒ¿åé¡µçš„å›æ”¶å€¾å‘.")]),s._v(" "),a("p",[s._v("å½“ Swap å˜é«˜æ—¶, å¯ä»¥ç”¨ sar, "),a("code",[s._v("/proc/zoneinfo")]),s._v("â€‹, "),a("code",[s._v("/proc/pid/status")]),s._v("â€‹ ç­‰æ–¹æ³•, æŸ¥çœ‹ç³»ç»Ÿå’Œè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ, è¿›è€Œæ‰¾å‡º Swap å‡é«˜çš„æ ¹æºå’Œå—å½±å“çš„è¿›ç¨‹.")]),s._v(" "),a("p",[s._v("åè¿‡æ¥è¯´, é€šå¸¸é™ä½ Swap çš„ä½¿ç”¨, å¯ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½. è¦æ€ä¹ˆåšå‘¢? è¿™é‡Œä¹Ÿæ€»ç»“äº†å‡ ç§å¸¸è§çš„é™ä½æ–¹æ³•.")]),s._v(" "),a("ul",[a("li",[s._v("ç¦æ­¢ Swap, ç°åœ¨æœåŠ¡å™¨çš„å†…å­˜è¶³å¤Ÿå¤§, æ‰€ä»¥é™¤éæœ‰å¿…è¦, ç¦ç”¨ Swap å°±å¯ä»¥äº†. éšç€äº‘è®¡ç®—çš„æ™®åŠ, å¤§éƒ¨åˆ†äº‘å¹³å°ä¸­çš„è™šæ‹Ÿæœºéƒ½é»˜è®¤ç¦æ­¢ Swap.")]),s._v(" "),a("li",[s._v("å¦‚æœå®åœ¨éœ€è¦ç”¨åˆ° Swap, å¯ä»¥å°è¯•"),a("strong",[s._v("é™ä½ swappiness çš„å€¼, å‡å°‘å†…å­˜å›æ”¶æ—¶ Swap çš„ä½¿ç”¨å€¾å‘")]),s._v(".")]),s._v(" "),a("li",[s._v("å“åº”å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨, å¦‚æœå®ƒä»¬å¯èƒ½åœ¨å¼€å¯ Swap çš„æœåŠ¡å™¨ä¸­è¿è¡Œ, è¿˜å¯ä»¥"),a("strong",[s._v("ç”¨åº“å‡½æ•° mlock() æˆ–è€… mlockall() é”å®šå†…å­˜, é˜»æ­¢å®ƒä»¬çš„å†…å­˜æ¢å‡º")]),s._v(".")])]),s._v(" "),a("h4",{attrs:{id:"_21-å¥—è·¯ç¯‡-å¦‚ä½•-å¿«å‡†ç‹ -æ‰¾åˆ°ç³»ç»Ÿå†…å­˜çš„é—®é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_21-å¥—è·¯ç¯‡-å¦‚ä½•-å¿«å‡†ç‹ -æ‰¾åˆ°ç³»ç»Ÿå†…å­˜çš„é—®é¢˜"}},[s._v("#")]),s._v(' 21-å¥—è·¯ç¯‡:å¦‚ä½•"å¿«å‡†ç‹ "æ‰¾åˆ°ç³»ç»Ÿå†…å­˜çš„é—®é¢˜?')]),s._v(" "),a("p",[s._v("å‰å‡ èŠ‚, é€šè¿‡å‡ ä¸ªæ¡ˆä¾‹, åˆ†æäº†å„ç§å¸¸è§çš„å†…å­˜æ€§èƒ½é—®é¢˜. æˆ‘ç›¸ä¿¡é€šè¿‡å®ƒä»¬, ä½ å¯¹å†…å­˜çš„æ€§èƒ½åˆ†æå·²ç»æœ‰äº†åŸºæœ¬çš„æ€è·¯, ä¹Ÿç†Ÿæ‚‰äº†å¾ˆå¤šåˆ†æå†…å­˜æ€§èƒ½çš„å·¥å…·. ä½ è‚¯å®šä¼šæƒ³, "),a("strong",[s._v("æœ‰æ²¡æœ‰è¿…é€Ÿå®šä½å†…å­˜é—®é¢˜çš„æ–¹æ³•? å½“å®šä½å‡ºå†…å­˜çš„ç“¶é¢ˆå, åˆæœ‰å“ªäº›ä¼˜åŒ–å†…å­˜çš„æ€è·¯å‘¢")]),s._v("?")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å°±æ¥æ¢³ç†ä¸€ä¸‹, "),a("strong",[s._v("æ€æ ·å¯ä»¥å¿«é€Ÿå®šä½ç³»ç»Ÿå†…å­˜, å¹¶ä¸”æ€»ç»“äº†ç›¸å…³çš„è§£å†³æ€è·¯")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-å†…å­˜æ€§èƒ½æŒ‡æ ‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å†…å­˜æ€§èƒ½æŒ‡æ ‡"}},[s._v("#")]),s._v(" 1.å†…å­˜æ€§èƒ½æŒ‡æ ‡")]),s._v(" "),a("p",[s._v("ä¸ºäº†åˆ†æå†…å­˜çš„æ€§èƒ½ç“¶é¢ˆ, é¦–å…ˆè¦çŸ¥é“, "),a("strong",[s._v("æ€æ ·è¡¡é‡å†…å­˜çš„æ€§èƒ½, ä¹Ÿå°±æ˜¯æ€§èƒ½æŒ‡æ ‡é—®é¢˜")]),s._v(". å…ˆæ¥å›é¡¾ä¸€ä¸‹, å‰å‡ èŠ‚å­¦è¿‡çš„å†…å­˜æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, ä½ æœ€å®¹æ˜“æƒ³åˆ°çš„æ˜¯"),a("mark",[a("strong",[s._v("ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ")])]),s._v("â€‹ "),a("strong",[s._v(", æ¯”å¦‚å·²ç”¨å†…å­˜, å‰©ä½™å†…å­˜, å…±äº«å†…å­˜, å¯ç”¨å†…å­˜, ç¼“å­˜å’Œç¼“å†²åŒºçš„ç”¨é‡")]),s._v("ç­‰.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å·²ç”¨å†…å­˜å’Œå‰©ä½™å†…å­˜å¾ˆå®¹æ˜“ç†è§£, å°±æ˜¯å·²ç»ä½¿ç”¨å’Œè¿˜æœªä½¿ç”¨çš„å†…å­˜.")])]),s._v(" "),a("li",[a("strong",[s._v("å…±äº«å†…å­˜æ˜¯é€šè¿‡ tmpfs å®ç°çš„, æ‰€ä»¥å®ƒçš„å¤§å°ä¹Ÿå°±æ˜¯ tmpfs ä½¿ç”¨çš„å†…å­˜å¤§å°. tmpfs å…¶å®ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¼“å­˜.")])]),s._v(" "),a("li",[a("strong",[s._v("å¯ç”¨å†…å­˜æ˜¯æ–°è¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜, å®ƒåŒ…æ‹¬å‰©ä½™å†…å­˜å’Œå¯å›æ”¶ç¼“å­˜.")])]),s._v(" "),a("li",[a("strong",[s._v("ç¼“å­˜åŒ…æ‹¬ä¸¤éƒ¨åˆ†, ä¸€éƒ¨åˆ†æ˜¯ç£ç›˜è¯»å–æ–‡ä»¶çš„é¡µç¼“å­˜, ç”¨æ¥ç¼“å­˜ä»ç£ç›˜è¯»å–çš„æ•°æ®, å¯ä»¥åŠ å¿«ä»¥åå†æ¬¡è®¿é—®çš„é€Ÿåº¦. å¦ä¸€éƒ¨åˆ†, åˆ™æ˜¯ Slab åˆ†é…å™¨ä¸­çš„å¯å›æ”¶å†…å­˜.")])]),s._v(" "),a("li",[a("strong",[s._v("ç¼“å†²åŒºæ˜¯å¯¹åŸå§‹ç£ç›˜å—çš„ä¸´æ—¶å­˜å‚¨, ç”¨æ¥ç¼“å­˜å°†è¦å†™å…¥ç£ç›˜çš„æ•°æ®. è¿™æ ·, å†…æ ¸å°±å¯ä»¥æŠŠåˆ†æ•£çš„å†™é›†ä¸­èµ·æ¥, ç»Ÿä¸€ä¼˜åŒ–ç£ç›˜å†™å…¥.")])])]),s._v(" "),a("p",[s._v("ç¬¬äºŒç±»å¾ˆå®¹æ˜“æƒ³åˆ°çš„, åº”è¯¥æ˜¯"),a("mark",[a("strong",[s._v("è¿›ç¨‹å†…å­˜ä½¿ç”¨æƒ…å†µ")])]),s._v("â€‹ "),a("strong",[s._v(", æ¯”å¦‚è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜, å¸¸é©»å†…å­˜, å…±äº«å†…å­˜ä»¥åŠ Swap å†…å­˜")]),s._v("ç­‰.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("è™šæ‹Ÿå†…å­˜, åŒ…æ‹¬äº†è¿›ç¨‹ä»£ç æ®µ, æ•°æ®æ®µ, å…±äº«å†…å­˜, å·²ç»ç”³è¯·çš„å †å†…å­˜å’Œå·²ç»æ¢å‡ºçš„å†…å­˜ç­‰. è¿™é‡Œè¦æ³¨æ„, å·²ç»ç”³è¯·çš„å†…å­˜, å³ä½¿è¿˜æ²¡æœ‰åˆ†é…ç‰©ç†å†…å­˜, ä¹Ÿç®—ä½œè™šæ‹Ÿå†…å­˜.")])]),s._v(" "),a("li",[a("strong",[s._v("å¸¸é©»å†…å­˜æ˜¯è¿›ç¨‹å®é™…ä½¿ç”¨çš„ç‰©ç†å†…å­˜, ä¸è¿‡, å®ƒä¸åŒ…æ‹¬ Swap å’Œå…±äº«å†…å­˜.")])]),s._v(" "),a("li",[a("strong",[s._v("å…±äº«å†…å­˜, æ—¢åŒ…æ‹¬ä¸å…¶ä»–è¿›ç¨‹å…±åŒä½¿ç”¨çš„çœŸå®çš„å…±äº«å†…å­˜, è¿˜åŒ…æ‹¬äº†åŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ä»¥åŠç¨‹åºçš„ä»£ç æ®µç­‰.")])]),s._v(" "),a("li",[a("strong",[s._v("Swap å†…å­˜, æ˜¯æŒ‡é€šè¿‡ Swap æ¢å‡ºåˆ°ç£ç›˜çš„å†…å­˜.")])])]),s._v(" "),a("p",[s._v("å½“ç„¶, è¿™äº›æŒ‡æ ‡ä¸­, å¸¸é©»å†…å­˜ä¸€èˆ¬ä¼šæ¢ç®—æˆå ç³»ç»Ÿæ€»å†…å­˜çš„ç™¾åˆ†æ¯”, ä¹Ÿå°±æ˜¯è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ç‡.")]),s._v(" "),a("p",[s._v("é™¤äº†è¿™äº›å¾ˆå®¹æ˜“æƒ³åˆ°çš„æŒ‡æ ‡å¤–, æˆ‘è¿˜æƒ³å†å¼ºè°ƒä¸€ä¸‹, "),a("mark",[a("strong",[s._v("ç¼ºé¡µå¼‚å¸¸")])]),s._v("â€‹.")]),s._v(" "),a("p",[s._v("åœ¨å†…å­˜åˆ†é…çš„åŸç†ä¸­æ›¾ç»è®²åˆ°è¿‡, ç³»ç»Ÿè°ƒç”¨å†…å­˜åˆ†é…è¯·æ±‚å, å¹¶ä¸ä¼šç«‹åˆ»ä¸ºå…¶åˆ†é…ç‰©ç†å†…å­˜, è€Œæ˜¯åœ¨è¯·æ±‚é¦–æ¬¡è®¿é—®æ—¶, é€šè¿‡ç¼ºé¡µå¼‚å¸¸æ¥åˆ†é…. ç¼ºé¡µå¼‚å¸¸åˆåˆ†ä¸ºä¸‹é¢ä¸¤ç§åœºæ™¯.")]),s._v(" "),a("ul",[a("li",[s._v("å¯ä»¥ç›´æ¥ä»ç‰©ç†å†…å­˜ä¸­åˆ†é…æ—¶, è¢«ç§°ä¸º"),a("strong",[s._v("æ¬¡ç¼ºé¡µå¼‚å¸¸")]),s._v(".")]),s._v(" "),a("li",[s._v("éœ€è¦ç£ç›˜ I/O ä»‹å…¥(æ¯”å¦‚ Swap)æ—¶, è¢«ç§°ä¸º"),a("strong",[s._v("ä¸»ç¼ºé¡µå¼‚å¸¸")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ˜¾ç„¶, "),a("strong",[s._v("ä¸»ç¼ºé¡µå¼‚å¸¸å‡é«˜, å°±æ„å‘³ç€éœ€è¦ç£ç›˜ I/O, é‚£ä¹ˆå†…å­˜è®¿é—®ä¹Ÿä¼šæ…¢å¾ˆå¤š")]),s._v(".")]),s._v(" "),a("p",[s._v("é™¤äº†ç³»ç»Ÿå†…å­˜å’Œè¿›ç¨‹å†…å­˜, ç¬¬ä¸‰ç±»é‡è¦æŒ‡æ ‡å°±æ˜¯ "),a("mark",[a("strong",[s._v("Swap çš„ä½¿ç”¨æƒ…å†µ")])]),s._v("â€‹ "),a("strong",[s._v(", æ¯”å¦‚ Swap çš„å·²ç”¨ç©ºé—´, å‰©ä½™ç©ºé—´, æ¢å…¥é€Ÿåº¦å’Œæ¢å‡ºé€Ÿåº¦ç­‰")]),s._v(".")]),s._v(" "),a("ul",[a("li",[s._v("å·²ç”¨ç©ºé—´å’Œå‰©ä½™ç©ºé—´å¾ˆå¥½ç†è§£, å°±æ˜¯å­—é¢ä¸Šçš„æ„æ€, å·²ç»ä½¿ç”¨å’Œæ²¡æœ‰ä½¿ç”¨çš„å†…å­˜ç©ºé—´.")]),s._v(" "),a("li",[s._v("æ¢å…¥å’Œæ¢å‡ºé€Ÿåº¦, åˆ™è¡¨ç¤ºæ¯ç§’é’Ÿæ¢å…¥å’Œæ¢å‡ºå†…å­˜çš„å¤§å°.")])]),s._v(" "),a("p",[s._v("è¿™äº›å†…å­˜çš„æ€§èƒ½æŒ‡æ ‡éƒ½éœ€è¦ç†Ÿè®°å¹¶ä¸”ä¼šç”¨, ä¸‹é¢æŠŠå®ƒä»¬æ±‡æ€»æˆäº†ä¸€ä¸ªæ€ç»´å¯¼å›¾.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/23c2bc815734d77bce01be0f1545d64b-20230731161933-yzv2cgb.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_2-å†…å­˜æ€§èƒ½å·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†…å­˜æ€§èƒ½å·¥å…·"}},[s._v("#")]),s._v(" 2.å†…å­˜æ€§èƒ½å·¥å…·")]),s._v(" "),a("p",[s._v("äº†è§£äº†å†…å­˜çš„æ€§èƒ½æŒ‡æ ‡, è¿˜å¾—çŸ¥é“æ€ä¹ˆæ‰èƒ½è·å¾—è¿™äº›æŒ‡æ ‡, ä¹Ÿå°±æ˜¯ä¼šç”¨æ€§èƒ½å·¥å…·. è¿™é‡Œä¹Ÿç”¨åŒæ ·çš„æ–¹æ³•, å›é¡¾ä¸€ä¸‹å‰é¢æ¡ˆä¾‹ä¸­å·²ç»ç”¨åˆ°çš„å„ç§å†…å­˜æ€§èƒ½å·¥å…·.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, æ‰€æœ‰çš„æ¡ˆä¾‹ä¸­éƒ½ç”¨åˆ°äº† "),a("mark",[a("strong",[s._v("free")])]),s._v(". è¿™æ˜¯ä¸ªæœ€å¸¸ç”¨çš„å†…å­˜å·¥å…·, "),a("mark",[a("strong",[s._v("å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿçš„æ•´ä½“å†…å­˜å’Œ Swap ä½¿ç”¨æƒ…å†µ")])]),s._v(". ç›¸å¯¹åº”çš„, å¯ä»¥"),a("mark",[a("strong",[s._v("ç”¨ top æˆ– ps, æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ")])]),s._v(".")]),s._v(" "),a("p",[s._v("ç„¶å, åœ¨ç¼“å­˜å’Œç¼“å†²åŒºçš„åŸç†ç¯‡ä¸­, é€šè¿‡ "),a("mark",[a("strong",[s._v("proc æ–‡ä»¶ç³»ç»Ÿ")])]),s._v(", æ‰¾åˆ°äº†å†…å­˜æŒ‡æ ‡çš„æ¥æº; å¹¶é€šè¿‡ vmstat, åŠ¨æ€è§‚å¯Ÿäº†å†…å­˜çš„å˜åŒ–æƒ…å†µ. ä¸ free ç›¸æ¯”, "),a("strong",[s._v("vmstat é™¤äº†å¯ä»¥åŠ¨æ€æŸ¥çœ‹å†…å­˜å˜åŒ–, è¿˜å¯ä»¥åŒºåˆ†ç¼“å­˜å’Œç¼“å†²åŒº, Swap æ¢å…¥å’Œæ¢å‡ºçš„å†…å­˜å¤§å°")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ç€, åœ¨ç¼“å­˜å’Œç¼“å†²åŒºçš„æ¡ˆä¾‹ç¯‡ä¸­, ä¸ºäº†å¼„æ¸…æ¥šç¼“å­˜çš„å‘½ä¸­æƒ…å†µ, åˆ"),a("strong",[s._v("ç”¨äº† cachestat, æŸ¥çœ‹æ•´ä¸ªç³»ç»Ÿç¼“å­˜çš„è¯»å†™å‘½ä¸­æƒ…å†µ, å¹¶ç”¨ cachetop æ¥è§‚å¯Ÿæ¯ä¸ªè¿›ç¨‹ç¼“å­˜çš„è¯»å†™å‘½ä¸­æƒ…å†µ")]),s._v(".")]),s._v(" "),a("p",[s._v("å†æ¥ç€, åœ¨å†…å­˜æ³„æ¼çš„æ¡ˆä¾‹ä¸­, "),a("strong",[s._v("ç”¨ vmstat å‘ç°äº†å†…å­˜ä½¿ç”¨åœ¨ä¸æ–­å¢é•¿, åˆç”¨ memleak, ç¡®è®¤å‘ç”Ÿäº†å†…å­˜æ³„æ¼. é€šè¿‡ memleak ç»™å‡ºçš„å†…å­˜åˆ†é…æ ˆ, æ‰¾åˆ°äº†å†…å­˜æ³„æ¼çš„å¯ç–‘ä½ç½®")]),s._v(".")]),s._v(" "),a("p",[s._v("æœ€å, åœ¨ Swap çš„æ¡ˆä¾‹ä¸­, ç”¨ sar å‘ç°äº†ç¼“å†²åŒºå’Œ Swap å‡é«˜çš„é—®é¢˜. é€šè¿‡ cachetop, æ‰¾åˆ°äº†ç¼“å†²åŒºå‡é«˜çš„æ ¹æº; é€šè¿‡å¯¹æ¯”å‰©ä½™å†…å­˜è·Ÿ "),a("code",[s._v("/proc/zoneinfo")]),s._v("â€‹ çš„å†…å­˜é˜ˆ, å‘ç° Swap å‡é«˜æ˜¯å†…å­˜å›æ”¶å¯¼è‡´çš„. æ¡ˆä¾‹æœ€å, è¿˜é€šè¿‡ proc æ–‡ä»¶ç³»ç»Ÿ, æ‰¾å‡ºäº† Swap æ‰€å½±å“çš„è¿›ç¨‹.")]),s._v(" "),a("p",[s._v("æ€§èƒ½å·¥å…·æ€ä¹ˆé‚£ä¹ˆå¤šå‘€? å…¶å®åªè¦ç†è§£å†…å­˜çš„å·¥ä½œåŸç†, ç»“åˆæ€§èƒ½æŒ‡æ ‡æ¥è®°å¿†, æ‹¿ä¸‹å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å¹¶ä¸éš¾.")]),s._v(" "),a("h5",{attrs:{id:"_3-æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·çš„è”ç³»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·çš„è”ç³»"}},[s._v("#")]),s._v(" 3.æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·çš„è”ç³»")]),s._v(" "),a("p",[s._v("åŒ CPU æ€§èƒ½åˆ†æä¸€æ ·, æˆ‘çš„ç»éªŒæ˜¯ä¸¤ä¸ªä¸åŒç»´åº¦å‡ºå‘, æ•´ç†å’Œè®°å¿†.")]),s._v(" "),a("ul",[a("li",[s._v("ä»å†…å­˜æŒ‡æ ‡å‡ºå‘, æ›´å®¹æ˜“æŠŠå·¥å…·å’Œå†…å­˜çš„å·¥ä½œåŸç†å…³è”èµ·æ¥.")]),s._v(" "),a("li",[s._v("ä»æ€§èƒ½å·¥å…·å‡ºå‘, å¯ä»¥æ›´å¿«åœ°åˆ©ç”¨å·¥å…·, æ‰¾å‡ºæƒ³è§‚å¯Ÿçš„æ€§èƒ½æŒ‡æ ‡. ç‰¹åˆ«æ˜¯åœ¨å·¥å…·æœ‰é™çš„æƒ…å†µä¸‹, æ›´å¾—å……åˆ†åˆ©ç”¨æ‰‹å¤´çš„æ¯ä¸€ä¸ªå·¥å…·, æŒ–æ˜å‡ºæ›´å¤šçš„é—®é¢˜.")])]),s._v(" "),a("p",[s._v("åŒæ ·çš„, æ ¹æ®å†…å­˜æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·çš„å¯¹åº”å…³ç³», æˆ‘åšäº†ä¸¤ä¸ªè¡¨æ ¼, æ–¹ä¾¿ä½ æ¢³ç†å…³ç³»å’Œç†è§£è®°å¿†.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ä¸ªè¡¨æ ¼, "),a("mark",[a("strong",[s._v("ä»å†…å­˜æŒ‡æ ‡å‡ºå‘, åˆ—ä¸¾äº†å“ªäº›æ€§èƒ½å·¥å…·å¯ä»¥æä¾›è¿™äº›æŒ‡æ ‡")])]),s._v(". è¿™æ ·, åœ¨å®é™…æ’æŸ¥æ€§èƒ½é—®é¢˜æ—¶, å°±å¯ä»¥æ¸…æ¥šçŸ¥é“, ç©¶ç«Ÿè¦ç”¨ä»€ä¹ˆå·¥å…·æ¥è¾…åŠ©åˆ†æ, æä¾›ä½ æƒ³è¦çš„æŒ‡æ ‡.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/f08abb0b4e71dcbb8e9fd3c3e2112acd-20230731161933-zfehgeg.png",alt:""}})]),s._v(" "),a("p",[s._v("ç¬¬äºŒä¸ªè¡¨æ ¼, "),a("mark",[a("strong",[s._v("ä»æ€§èƒ½å·¥å…·å‡ºå‘, æ•´ç†äº†è¿™äº›å¸¸è§å·¥å…·èƒ½æä¾›çš„å†…å­˜æŒ‡æ ‡")])]),s._v(". æŒæ¡äº†è¿™ä¸ªè¡¨æ ¼, å¯ä»¥æœ€å¤§åŒ–åˆ©ç”¨å·²æœ‰çš„å·¥å…·, å°½å¯èƒ½å¤šåœ°æ‰¾åˆ°ä½ è¦çš„æŒ‡æ ‡.")]),s._v(" "),a("p",[s._v("è¿™äº›å·¥å…·çš„å…·ä½“ä½¿ç”¨æ–¹æ³•å¹¶ä¸ç”¨èƒŒ, åªè¦çŸ¥é“æœ‰å“ªäº›å¯ç”¨çš„å·¥å…·, ä»¥åŠè¿™äº›å·¥å…·æä¾›çš„åŸºæœ¬æŒ‡æ ‡. çœŸæ­£ç”¨åˆ°æ—¶,  man ä¸€ä¸‹æŸ¥å®ƒä»¬çš„ä½¿ç”¨æ‰‹å†Œå°±å¯ä»¥äº†.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/8a0d5ef1a561d58783d1e7ea55dcc531-20230731161933-ey2bj5z.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_4-å¦‚ä½•è¿…é€Ÿåˆ†æå†…å­˜çš„æ€§èƒ½ç“¶é¢ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å¦‚ä½•è¿…é€Ÿåˆ†æå†…å­˜çš„æ€§èƒ½ç“¶é¢ˆ"}},[s._v("#")]),s._v(" 4.å¦‚ä½•è¿…é€Ÿåˆ†æå†…å­˜çš„æ€§èƒ½ç“¶é¢ˆ")]),s._v(" "),a("p",[s._v("æˆ‘ç›¸ä¿¡åˆ°è¿™ä¸€æ­¥, ä½ å¯¹å†…å­˜çš„æ€§èƒ½æŒ‡æ ‡å·²ç»éå¸¸ç†Ÿæ‚‰, ä¹Ÿæ¸…æ¥šæ¯ç§æ€§èƒ½æŒ‡æ ‡åˆ†åˆ«èƒ½ç”¨ä»€ä¹ˆå·¥å…·æ¥è·å–. é‚£æ˜¯ä¸æ˜¯è¯´, æ¯æ¬¡ç¢°åˆ°å†…å­˜æ€§èƒ½é—®é¢˜, éƒ½è¦æŠŠä¸Šé¢è¿™äº›å·¥å…·å…¨è·‘ä¸€é, ç„¶åå†æŠŠæ‰€æœ‰å†…å­˜æ€§èƒ½æŒ‡æ ‡å…¨åˆ†æä¸€éå‘¢?")]),s._v(" "),a("p",[s._v("è‡ªç„¶ä¸æ˜¯. å‰é¢çš„ CPU æ€§èƒ½ç¯‡å°±è¯´è¿‡, ç®€å•æŸ¥æ‰¾æ³•, è™½ç„¶æ˜¯æœ‰ç”¨çš„, ä¹Ÿå¾ˆå¯èƒ½æ‰¾åˆ°æŸäº›ç³»ç»Ÿæ½œåœ¨ç“¶é¢ˆ. ä½†æ˜¯è¿™ç§æ–¹æ³•çš„ä½æ•ˆç‡å’Œå¤§å·¥ä½œé‡, è®©æˆ‘ä»¬é¦–å…ˆæ‹’ç»äº†è¿™ç§æ–¹æ³•.")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯é‚£å¥è¯, åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­, å¤§å®¶å¸Œæœ›çš„æ˜¯, å°½å¯èƒ½"),a("strong",[s._v("å¿«")]),s._v("åœ°å®šä½ç³»ç»Ÿç“¶é¢ˆ, ç„¶åå°½å¯èƒ½"),a("strong",[s._v("å¿«")]),s._v("åœ°ä¼˜åŒ–æ€§èƒ½, ä¹Ÿå°±æ˜¯è¦åˆå¿«åˆå‡†åœ°è§£å†³æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•, å¯ä»¥åˆå¿«åˆå‡†åœ°åˆ†æå‡ºç³»ç»Ÿçš„å†…å­˜é—®é¢˜å‘¢?")]),s._v(" "),a("p",[s._v("æ–¹æ³•å½“ç„¶æœ‰. è¿˜æ˜¯é‚£ä¸ªå…³é”®è¯, æ‰¾å…³è”. å…¶å®, è™½ç„¶å†…å­˜çš„æ€§èƒ½æŒ‡æ ‡å¾ˆå¤š, ä½†éƒ½æ˜¯ä¸ºäº†æè¿°å†…å­˜çš„åŸç†, æŒ‡æ ‡é—´è‡ªç„¶ä¸ä¼šå®Œå…¨å­¤ç«‹, ä¸€èˆ¬éƒ½ä¼šæœ‰å…³è”. å½“ç„¶, åè¿‡æ¥è¯´, è¿™äº›å…³è”ä¹Ÿæ­£æ˜¯æºäºç³»ç»Ÿçš„å†…å­˜åŸç†, è¿™ä¹Ÿæ˜¯æˆ‘æ€»å¼ºè°ƒåŸºç¡€åŸç†çš„é‡è¦æ€§, å¹¶åœ¨æ–‡ç« ä¸­ç©¿æ’è®²è§£.")]),s._v(" "),a("p",[s._v("ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­, å½“çœ‹åˆ°ç³»ç»Ÿçš„å‰©ä½™å†…å­˜å¾ˆä½æ—¶, æ˜¯ä¸æ˜¯å°±è¯´æ˜, è¿›ç¨‹ä¸€å®šä¸èƒ½ç”³è¯·åˆ†é…æ–°å†…å­˜äº†å‘¢? å½“ç„¶ä¸æ˜¯, å› ä¸ºè¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„å†…å­˜, é™¤äº†å‰©ä½™å†…å­˜, è¿˜åŒ…æ‹¬äº†å¯å›æ”¶çš„ç¼“å­˜å’Œç¼“å†²åŒº.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, "),a("strong",[s._v("ä¸ºäº†è¿…é€Ÿå®šä½å†…å­˜é—®é¢˜, æˆ‘é€šå¸¸ä¼šå…ˆè¿è¡Œå‡ ä¸ªè¦†ç›–é¢æ¯”è¾ƒå¤§çš„æ€§èƒ½å·¥å…·, æ¯”å¦‚ free, top, vmstat, pidstat ç­‰")]),s._v(".")]),s._v(" "),a("p",[s._v("å…·ä½“çš„åˆ†ææ€è·¯ä¸»è¦æœ‰è¿™å‡ æ­¥.")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("å…ˆç”¨ free å’Œ top, æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“çš„å†…å­˜ä½¿ç”¨æƒ…å†µ.")])]),s._v(" "),a("li",[a("strong",[s._v("å†ç”¨ vmstat å’Œ pidstat, æŸ¥çœ‹ä¸€æ®µæ—¶é—´çš„è¶‹åŠ¿, ä»è€Œåˆ¤æ–­å‡ºå†…å­˜é—®é¢˜çš„ç±»å‹")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("æœ€åè¿›è¡Œè¯¦ç»†åˆ†æ, æ¯”å¦‚å†…å­˜åˆ†é…åˆ†æ, ç¼“å­˜/ç¼“å†²åŒºåˆ†æ, å…·ä½“è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨åˆ†æç­‰")]),s._v(".")])]),s._v(" "),a("p",[s._v("åŒæ—¶ä¹ŸæŠŠè¿™ä¸ªåˆ†æè¿‡ç¨‹ç”»æˆäº†ä¸€å¼ æµç¨‹å›¾.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/b3279de7af55dd1b62320e43c8ea7705-20230731161933-c2r79l7.png",alt:""}})]),s._v(" "),a("p",[s._v("å›¾ä¸­åˆ—å‡ºäº†æœ€å¸¸ç”¨çš„å‡ ä¸ªå†…å­˜å·¥å…·, å’Œç›¸å…³çš„åˆ†ææµç¨‹. å…¶ä¸­, ç®­å¤´è¡¨ç¤ºåˆ†æçš„æ–¹å‘, ä¸¾å‡ ä¸ªä¾‹å­å¯èƒ½ä¼šæ›´å®¹æ˜“ç†è§£.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ä¸ªä¾‹å­, å½“é€šè¿‡ free, å‘ç°å¤§éƒ¨åˆ†å†…å­˜éƒ½è¢«ç¼“å­˜å ç”¨å, å¯ä»¥ä½¿ç”¨ vmstat æˆ–è€… sar è§‚å¯Ÿä¸€ä¸‹ç¼“å­˜çš„å˜åŒ–è¶‹åŠ¿, ç¡®è®¤ç¼“å­˜çš„ä½¿ç”¨æ˜¯å¦è¿˜åœ¨ç»§ç»­å¢å¤§. å¦‚æœç»§ç»­å¢å¤§, åˆ™è¯´æ˜å¯¼è‡´ç¼“å­˜å‡é«˜çš„è¿›ç¨‹è¿˜åœ¨è¿è¡Œ, é‚£å°±èƒ½ç”¨ç¼“å­˜/ç¼“å†²åŒºåˆ†æå·¥å…·(æ¯”å¦‚ cachetop, slabtop ç­‰), åˆ†æè¿™äº›ç¼“å­˜åˆ°åº•è¢«å“ªé‡Œå ç”¨.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒä¸ªä¾‹å­, å½“ free ä¸€ä¸‹, å‘ç°ç³»ç»Ÿå¯ç”¨å†…å­˜ä¸è¶³æ—¶, é¦–å…ˆè¦ç¡®è®¤å†…å­˜æ˜¯å¦è¢«ç¼“å­˜/ç¼“å†²åŒºå ç”¨. æ’é™¤ç¼“å­˜/ç¼“å†²åŒºå, å¯ä»¥ç»§ç»­ç”¨ pidstat æˆ–è€… top, å®šä½å ç”¨å†…å­˜æœ€å¤šçš„è¿›ç¨‹. æ‰¾å‡ºè¿›ç¨‹å, å†é€šè¿‡è¿›ç¨‹å†…å­˜ç©ºé—´å·¥å…·(æ¯”å¦‚ pmap), åˆ†æè¿›ç¨‹åœ°å€ç©ºé—´ä¸­å†…å­˜çš„ä½¿ç”¨æƒ…å†µå°±å¯ä»¥äº†.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰ä¸ªä¾‹å­, å½“é€šè¿‡ vmstat æˆ–è€… sar å‘ç°å†…å­˜åœ¨ä¸æ–­å¢é•¿å, å¯ä»¥åˆ†æä¸­æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼çš„é—®é¢˜. æ¯”å¦‚å¯ä»¥ä½¿ç”¨å†…å­˜åˆ†é…åˆ†æå·¥å…· memleak, æ£€æŸ¥æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼. å¦‚æœå­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜, memleak ä¼šä¸ºä½ è¾“å‡ºå†…å­˜æ³„æ¼çš„è¿›ç¨‹ä»¥åŠè°ƒç”¨å †æ ˆ.")])]),s._v(" "),a("p",[s._v("æ³¨æ„, è¿™ä¸ªå›¾é‡Œæ²¡æœ‰åˆ—å‡ºæ‰€æœ‰æ€§èƒ½å·¥å…·, åªç»™å‡ºäº†æœ€æ ¸å¿ƒçš„å‡ ä¸ª. è¿™ä¹ˆåš, ä¸€æ–¹é¢, ç¡®å®ä¸æƒ³è®©å¤§é‡çš„å·¥å…·åˆ—è¡¨å“åˆ°ä½ . å¦ä¸€æ–¹é¢, å¸Œæœ›ä½ èƒ½æŠŠé‡å¿ƒå…ˆæ”¾åœ¨æ ¸å¿ƒå·¥å…·ä¸Š, é€šè¿‡æ¡ˆä¾‹å’ŒçœŸå®ç¯å¢ƒçš„å®è·µ, æŒæ¡ä½¿ç”¨æ–¹æ³•å’Œåˆ†ææ€è·¯.")]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“-5"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å›é¡¾äº†å¸¸è§çš„å†…å­˜æ€§èƒ½æŒ‡æ ‡, æ¢³ç†äº†å¸¸è§çš„å†…å­˜æ€§èƒ½åˆ†æå·¥å…·, æœ€åè¿˜æ€»ç»“äº†å¿«é€Ÿåˆ†æå†…å­˜é—®é¢˜çš„æ€è·¯.")]),s._v(" "),a("p",[s._v("è™½ç„¶å†…å­˜çš„æ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½å·¥å…·éƒ½æŒºå¤š, ä½†ç†è§£äº†å†…å­˜ç®¡ç†çš„åŸºæœ¬åŸç†å, ä¼šå‘ç°å®ƒä»¬å…¶å®éƒ½æœ‰ä¸€å®šçš„å…³è”. æ¢³ç†å‡ºå®ƒä»¬çš„å…³ç³», æŒæ¡å†…å­˜åˆ†æçš„å¥—è·¯å¹¶ä¸éš¾.")]),s._v(" "),a("p",[s._v("æ‰¾åˆ°å†…å­˜é—®é¢˜çš„æ¥æºå, ä¸‹ä¸€æ­¥å°±æ˜¯ç›¸åº”çš„ä¼˜åŒ–å·¥ä½œäº†. åœ¨æˆ‘çœ‹æ¥, "),a("strong",[s._v("å†…å­˜è°ƒä¼˜æœ€é‡è¦çš„å°±æ˜¯, ä¿è¯åº”ç”¨ç¨‹åºçš„çƒ­ç‚¹æ•°æ®æ”¾åˆ°å†…å­˜ä¸­, å¹¶å°½é‡å‡å°‘æ¢é¡µå’Œäº¤æ¢")]),s._v(".")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("å¸¸è§çš„ä¼˜åŒ–æ€è·¯æœ‰è¿™ä¹ˆå‡ ç§.")])])]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("æœ€å¥½ç¦æ­¢ Swap")]),s._v(". å¦‚æœå¿…é¡»å¼€å¯ Swap, é™ä½ swappiness çš„å€¼, å‡å°‘å†…å­˜å›æ”¶æ—¶ Swap çš„ä½¿ç”¨å€¾å‘.")]),s._v(" "),a("li",[a("strong",[s._v("å‡å°‘å†…å­˜çš„åŠ¨æ€åˆ†é…")]),s._v(". æ¯”å¦‚, å¯ä»¥ä½¿ç”¨å†…å­˜æ± , å¤§é¡µ(HugePage)ç­‰.")]),s._v(" "),a("li",[a("strong",[s._v("å°½é‡ä½¿ç”¨ç¼“å­˜å’Œç¼“å†²åŒºæ¥è®¿é—®æ•°æ®")]),s._v(". æ¯”å¦‚, å¯ä»¥ä½¿ç”¨å †æ ˆæ˜ç¡®å£°æ˜å†…å­˜ç©ºé—´, æ¥å­˜å‚¨éœ€è¦ç¼“å­˜çš„æ•°æ®; æˆ–è€…ç”¨ Redis è¿™ç±»çš„å¤–éƒ¨ç¼“å­˜ç»„ä»¶, ä¼˜åŒ–æ•°æ®çš„è®¿é—®.")]),s._v(" "),a("li",[a("strong",[s._v("ä½¿ç”¨ cgroups ç­‰æ–¹å¼é™åˆ¶è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ")]),s._v(". è¿™æ ·, å¯ä»¥ç¡®ä¿ç³»ç»Ÿå†…å­˜ä¸ä¼šè¢«å¼‚å¸¸è¿›ç¨‹è€—å°½.")]),s._v(" "),a("li",[s._v("é€šè¿‡ "),a("code",[s._v("/proc/pid/oom_adj")]),s._v("â€‹, è°ƒæ•´æ ¸å¿ƒåº”ç”¨çš„ oom_score. è¿™æ ·, å¯ä»¥ä¿è¯å³ä½¿å†…å­˜ç´§å¼ , æ ¸å¿ƒåº”ç”¨ä¹Ÿä¸ä¼šè¢« OOM æ€æ­».")])]),s._v(" "),a("h3",{attrs:{id:"ioæ€§èƒ½ç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ioæ€§èƒ½ç¯‡"}},[s._v("#")]),s._v(" IOæ€§èƒ½ç¯‡")]),s._v(" "),a("h4",{attrs:{id:"_23-åŸºç¡€ç¯‡-linuxæ–‡ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆå·¥ä½œçš„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-åŸºç¡€ç¯‡-linuxæ–‡ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆå·¥ä½œçš„"}},[s._v("#")]),s._v(" 23-åŸºç¡€ç¯‡:Linuxæ–‡ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆå·¥ä½œçš„?")]),s._v(" "),a("p",[s._v("é€šè¿‡å‰é¢ CPU å’Œå†…å­˜æ¨¡å—çš„å­¦ä¹ , ç›¸ä¿¡ä½ å·²ç»æŒæ¡äº† CPU å’Œå†…å­˜çš„æ€§èƒ½åˆ†æä»¥åŠä¼˜åŒ–æ€è·¯. ä»è¿™ä¸€èŠ‚å¼€å§‹, å°†è¿›å…¥ä¸‹ä¸€ä¸ªé‡è¦æ¨¡å—--"),a("strong",[s._v("æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜çš„ I/O æ€§èƒ½")]),s._v(".")]),s._v(" "),a("p",[s._v("åŒ CPU, å†…å­˜ä¸€æ ·, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿçš„ç®¡ç†, ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿæœ€æ ¸å¿ƒçš„åŠŸèƒ½.")]),s._v(" "),a("ul",[a("li",[s._v("ç£ç›˜ä¸ºç³»ç»Ÿæä¾›äº†æœ€åŸºæœ¬çš„"),a("strong",[s._v("æŒä¹…åŒ–å­˜å‚¨")]),s._v(".")]),s._v(" "),a("li",[s._v("æ–‡ä»¶ç³»ç»Ÿåˆ™åœ¨ç£ç›˜çš„åŸºç¡€ä¸Š, æä¾›äº†ä¸€ä¸ªç”¨æ¥"),a("strong",[s._v("ç®¡ç†æ–‡ä»¶çš„æ ‘çŠ¶ç»“æ„")]),s._v(".")])]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢? åˆæœ‰å“ªäº›æŒ‡æ ‡å¯ä»¥è¡¡é‡å®ƒä»¬çš„æ€§èƒ½å‘¢? ä»Šå¤©å°±å…ˆæ¥çœ‹çœ‹, Linux æ–‡ä»¶ç³»ç»Ÿçš„å·¥ä½œåŸç†. ç£ç›˜çš„å·¥ä½œåŸç†, ä¸‹ä¸€èŠ‚å†æ¥å­¦ä¹ .")]),s._v(" "),a("h5",{attrs:{id:"_1-ç´¢å¼•èŠ‚ç‚¹å’Œç›®å½•é¡¹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç´¢å¼•èŠ‚ç‚¹å’Œç›®å½•é¡¹"}},[s._v("#")]),s._v(" 1.ç´¢å¼•èŠ‚ç‚¹å’Œç›®å½•é¡¹")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("æ–‡ä»¶ç³»ç»Ÿ, æœ¬èº«æ˜¯å¯¹å­˜å‚¨è®¾å¤‡ä¸Šçš„æ–‡ä»¶, è¿›è¡Œç»„ç»‡ç®¡ç†çš„æœºåˆ¶. ç»„ç»‡æ–¹å¼ä¸åŒ, å°±ä¼šå½¢æˆä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿ")])]),s._v(".")]),s._v(" "),a("p",[s._v("è¦è®°ä½æœ€é‡è¦çš„ä¸€ç‚¹, "),a("mark",[a("strong",[s._v("åœ¨ Linux ä¸­ä¸€åˆ‡çš†æ–‡ä»¶. ä¸ä»…æ™®é€šçš„æ–‡ä»¶å’Œç›®å½•, å°±è¿å—è®¾å¤‡, å¥—æ¥å­—, ç®¡é“ç­‰, ä¹Ÿéƒ½è¦é€šè¿‡ç»Ÿä¸€çš„æ–‡ä»¶ç³»ç»Ÿæ¥ç®¡ç†")])]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸ºäº†æ–¹ä¾¿ç®¡ç†, "),a("strong",[s._v("Linux æ–‡ä»¶ç³»ç»Ÿä¸ºæ¯ä¸ªæ–‡ä»¶éƒ½åˆ†é…ä¸¤ä¸ªæ•°æ®ç»“æ„, ç´¢å¼•èŠ‚ç‚¹(index node)å’Œç›®å½•é¡¹(directory entry). å®ƒä»¬ä¸»è¦ç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒä¿¡æ¯å’Œç›®å½•ç»“æ„")]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç´¢å¼•èŠ‚ç‚¹, ç®€ç§°ä¸º inode, ç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒæ•°æ®, æ¯”å¦‚ inode ç¼–å·, æ–‡ä»¶å¤§å°, è®¿é—®æƒé™, ä¿®æ”¹æ—¥æœŸ, æ•°æ®çš„ä½ç½®ç­‰. ç´¢å¼•èŠ‚ç‚¹å’Œæ–‡ä»¶ä¸€ä¸€å¯¹åº”, å®ƒè·Ÿæ–‡ä»¶å†…å®¹ä¸€æ ·, éƒ½ä¼šè¢«æŒä¹…åŒ–å­˜å‚¨åˆ°ç£ç›˜ä¸­. æ‰€ä»¥è®°ä½, ç´¢å¼•èŠ‚ç‚¹åŒæ ·å ç”¨ç£ç›˜ç©ºé—´.")])]),s._v(" "),a("li",[a("strong",[s._v("ç›®å½•é¡¹, ç®€ç§°ä¸º dentry, ç”¨æ¥è®°å½•æ–‡ä»¶çš„åå­—, ç´¢å¼•èŠ‚ç‚¹æŒ‡é’ˆä»¥åŠä¸å…¶ä»–ç›®å½•é¡¹çš„å…³è”å…³ç³». å¤šä¸ªå…³è”çš„ç›®å½•é¡¹, å°±æ„æˆäº†æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„. ä¸è¿‡, ä¸åŒäºç´¢å¼•èŠ‚ç‚¹, ç›®å½•é¡¹æ˜¯ç”±å†…æ ¸ç»´æŠ¤çš„ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„, æ‰€ä»¥é€šå¸¸ä¹Ÿè¢«å«åšç›®å½•é¡¹ç¼“å­˜.")])])]),s._v(" "),a("p",[s._v("æ¢å¥è¯è¯´, "),a("strong",[s._v("ç´¢å¼•èŠ‚ç‚¹æ˜¯æ¯ä¸ªæ–‡ä»¶çš„å”¯ä¸€æ ‡å¿—, è€Œç›®å½•é¡¹ç»´æŠ¤çš„æ­£æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„æ ‘çŠ¶ç»“æ„")]),s._v(". ç›®å½•é¡¹å’Œç´¢å¼•èŠ‚ç‚¹çš„å…³ç³»æ˜¯å¤šå¯¹ä¸€, ä½ å¯ä»¥ç®€å•ç†è§£ä¸º, ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªåˆ«å.")]),s._v(" "),a("p",[s._v("ä¸¾ä¸ªä¾‹å­, é€šè¿‡ç¡¬é“¾æ¥ä¸ºæ–‡ä»¶åˆ›å»ºçš„åˆ«å, å°±ä¼šå¯¹åº”ä¸åŒçš„ç›®å½•é¡¹, ä¸è¿‡è¿™äº›ç›®å½•é¡¹æœ¬è´¨ä¸Šè¿˜æ˜¯é“¾æ¥åŒä¸€ä¸ªæ–‡ä»¶, æ‰€ä»¥, å®ƒä»¬çš„"),a("strong",[s._v("ç´¢å¼•èŠ‚ç‚¹ç›¸åŒ")]),s._v(".")]),s._v(" "),a("p",[s._v("ç´¢å¼•èŠ‚ç‚¹å’Œç›®å½•é¡¹è®°å½•äº†æ–‡ä»¶çš„å…ƒæ•°æ®, ä»¥åŠæ–‡ä»¶é—´çš„ç›®å½•å…³ç³», é‚£ä¹ˆå…·ä½“æ¥è¯´, æ–‡ä»¶æ•°æ®åˆ°åº•æ˜¯æ€ä¹ˆå­˜å‚¨çš„å‘¢? æ˜¯ä¸æ˜¯ç›´æ¥å†™åˆ°ç£ç›˜ä¸­å°±å¥½äº†å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, ç£ç›˜è¯»å†™çš„æœ€å°å•ä½æ˜¯"),a("strong",[s._v("æ‰‡åŒº")]),s._v(", ç„¶è€Œæ‰‡åŒºåªæœ‰ 512B å¤§å°, å¦‚æœæ¯æ¬¡éƒ½è¯»å†™è¿™ä¹ˆå°çš„å•ä½, æ•ˆç‡ä¸€å®šå¾ˆä½. æ‰€ä»¥, æ–‡ä»¶ç³»ç»ŸåˆæŠŠè¿ç»­çš„æ‰‡åŒºç»„æˆäº†é€»è¾‘å—, ç„¶åæ¯æ¬¡éƒ½ä»¥é€»è¾‘å—ä¸ºæœ€å°å•å…ƒ, æ¥ç®¡ç†æ•°æ®. å¸¸è§çš„é€»è¾‘å—å¤§å°ä¸º 4KB, ä¹Ÿå°±æ˜¯ç”±è¿ç»­çš„ 8 ä¸ªæ‰‡åŒºç»„æˆ.")]),s._v(" "),a("p",[s._v("ä¸ºäº†å¸®åŠ©ç†è§£ç›®å½•é¡¹, ç´¢å¼•èŠ‚ç‚¹ä»¥åŠæ–‡ä»¶æ•°æ®çš„å…³ç³», ä¸‹é¢ç”»äº†ä¸€å¼ ç¤ºæ„å›¾. å¯ä»¥å¯¹ç…§ç€è¿™å¼ å›¾, æ¥å›å¿†åˆšåˆšè®²è¿‡çš„å†…å®¹, æŠŠçŸ¥è¯†å’Œç»†èŠ‚ä¸²è”èµ·æ¥.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2e086d2d47928559784acacdc4b448f3-20230731161933-ipwjko8.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦ä½ æ³¨æ„.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€, "),a("strong",[s._v("ç›®å½•é¡¹æœ¬èº«å°±æ˜¯ä¸€ä¸ªå†…å­˜ç¼“å­˜, è€Œç´¢å¼•èŠ‚ç‚¹åˆ™æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„æ•°æ®")]),s._v(". åœ¨å‰é¢çš„ Buffer å’Œ Cache åŸç†ä¸­, æ›¾ç»æåˆ°è¿‡, ä¸ºäº†åè°ƒæ…¢é€Ÿç£ç›˜ä¸å¿«é€Ÿ CPU çš„æ€§èƒ½å·®å¼‚, æ–‡ä»¶å†…å®¹ä¼šç¼“å­˜åˆ°é¡µç¼“å­˜ Cache ä¸­. é‚£ä¹ˆ, ä½ åº”è¯¥æƒ³åˆ°, "),a("strong",[s._v("è¿™äº›ç´¢å¼•èŠ‚ç‚¹è‡ªç„¶ä¹Ÿä¼šç¼“å­˜åˆ°å†…å­˜ä¸­, åŠ é€Ÿæ–‡ä»¶çš„è®¿é—®")]),s._v(".")]),s._v(" "),a("p",[s._v("ç¬¬äºŒ, "),a("strong",[s._v("ç£ç›˜åœ¨æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–æ—¶, ä¼šè¢«åˆ†æˆä¸‰ä¸ªå­˜å‚¨åŒºåŸŸ, è¶…çº§å—, ç´¢å¼•èŠ‚ç‚¹åŒºå’Œæ•°æ®å—åŒº")]),s._v(". å…¶ä¸­,")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("è¶…çº§å—, å­˜å‚¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€.")])]),s._v(" "),a("li",[a("strong",[s._v("ç´¢å¼•èŠ‚ç‚¹åŒº, ç”¨æ¥å­˜å‚¨ç´¢å¼•èŠ‚ç‚¹.")])]),s._v(" "),a("li",[a("strong",[s._v("æ•°æ®å—åŒº, åˆ™ç”¨æ¥å­˜å‚¨æ–‡ä»¶æ•°æ®.")])])]),s._v(" "),a("h5",{attrs:{id:"_2-è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"}},[s._v("#")]),s._v(" 2.è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("ç›®å½•é¡¹, ç´¢å¼•èŠ‚ç‚¹, é€»è¾‘å—ä»¥åŠè¶…çº§å—, æ„æˆäº† Linux æ–‡ä»¶ç³»ç»Ÿçš„å››å¤§åŸºæœ¬è¦ç´ ")])]),s._v(". ä¸è¿‡, ä¸ºäº†æ”¯æŒå„ç§ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿ, Linux å†…æ ¸åœ¨ç”¨æˆ·è¿›ç¨‹å’Œæ–‡ä»¶ç³»ç»Ÿçš„ä¸­é—´, åˆå¼•å…¥äº†ä¸€ä¸ªæŠ½è±¡å±‚, ä¹Ÿå°±æ˜¯"),a("mark",[a("strong",[s._v("è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ VFS")])]),s._v("(Virtual File System).")]),s._v(" "),a("p",[s._v("VFS å®šä¹‰äº†ä¸€ç»„"),a("strong",[s._v("æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒçš„æ•°æ®ç»“æ„å’Œæ ‡å‡†æ¥å£")]),s._v(". è¿™æ ·, ç”¨æˆ·è¿›ç¨‹å’Œå†…æ ¸ä¸­çš„å…¶ä»–å­ç³»ç»Ÿ, åªéœ€è¦è·Ÿ VFS æä¾›çš„ç»Ÿä¸€æ¥å£è¿›è¡Œäº¤äº’å°±å¯ä»¥äº†, è€Œä¸éœ€è¦å†å…³å¿ƒåº•å±‚å„ç§æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ç»†èŠ‚.")]),s._v(" "),a("p",[s._v("è¿™é‡Œç”»äº†ä¸€å¼  Linux æ–‡ä»¶ç³»ç»Ÿçš„æ¶æ„å›¾, å¯ä»¥æ›´å¥½åœ°ç†è§£ç³»ç»Ÿè°ƒç”¨, VFS, ç¼“å­˜, æ–‡ä»¶ç³»ç»Ÿä»¥åŠå—å­˜å‚¨ä¹‹é—´çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/9a3ceeff196551676acfa0a87b9ffd20-20230731161933-5n15ys6.png",alt:""}})]),s._v(" "),a("p",[s._v("é€šè¿‡è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°, åœ¨ VFS çš„ä¸‹æ–¹, "),a("strong",[s._v("Linux æ”¯æŒå„ç§å„æ ·çš„æ–‡ä»¶ç³»ç»Ÿ, å¦‚ Ext4, XFS, NFS ç­‰ç­‰")]),s._v(". æŒ‰ç…§å­˜å‚¨ä½ç½®çš„ä¸åŒ, è¿™äº›æ–‡ä»¶ç³»ç»Ÿå¯ä»¥åˆ†ä¸ºä¸‰ç±».")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç±»æ˜¯"),a("strong",[s._v("åŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿ")]),s._v(", ä¹Ÿå°±æ˜¯æŠŠæ•°æ®ç›´æ¥å­˜å‚¨åœ¨è®¡ç®—æœºæœ¬åœ°æŒ‚è½½çš„ç£ç›˜ä¸­. å¸¸è§çš„ Ext4, XFS, OverlayFS ç­‰, éƒ½æ˜¯è¿™ç±»æ–‡ä»¶ç³»ç»Ÿ.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç±»æ˜¯"),a("strong",[s._v("åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿ")]),s._v(", ä¹Ÿå°±æ˜¯å¸¸è¯´çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ. è¿™ç±»æ–‡ä»¶ç³»ç»Ÿ, ä¸éœ€è¦ä»»ä½•ç£ç›˜åˆ†é…å­˜å‚¨ç©ºé—´, ä½†ä¼šå ç”¨å†…å­˜. ç»å¸¸ç”¨åˆ°çš„  "),a("mark",[a("strong",[s._v("/proc æ–‡ä»¶ç³»ç»Ÿ, å…¶å®å°±æ˜¯ä¸€ç§æœ€å¸¸è§çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ")])]),s._v(". æ­¤å¤–,  "),a("strong",[s._v("/sys æ–‡ä»¶ç³»ç»Ÿä¹Ÿå±äºè¿™ä¸€ç±», ä¸»è¦å‘ç”¨æˆ·ç©ºé—´å¯¼å‡ºå±‚æ¬¡åŒ–çš„å†…æ ¸å¯¹è±¡")]),s._v(".")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰ç±»æ˜¯"),a("strong",[s._v("ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ")]),s._v(", ä¹Ÿå°±æ˜¯ç”¨æ¥è®¿é—®å…¶ä»–è®¡ç®—æœºæ•°æ®çš„æ–‡ä»¶ç³»ç»Ÿ, æ¯”å¦‚ "),a("strong",[s._v("NFS")]),s._v(", SMB, iSCSI ç­‰.")])]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("è¿™äº›æ–‡ä»¶ç³»ç»Ÿ, è¦å…ˆæŒ‚è½½åˆ° VFS ç›®å½•æ ‘ä¸­çš„æŸä¸ªå­ç›®å½•(ç§°ä¸ºæŒ‚è½½ç‚¹), ç„¶åæ‰èƒ½è®¿é—®å…¶ä¸­çš„æ–‡ä»¶")])]),s._v(". æ‹¿ç¬¬ä¸€ç±», ä¹Ÿå°±æ˜¯åŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿä¸ºä¾‹, åœ¨å®‰è£…ç³»ç»Ÿæ—¶, "),a("strong",[s._v("è¦å…ˆæŒ‚è½½ä¸€ä¸ªæ ¹ç›®å½•(/), åœ¨æ ¹ç›®å½•ä¸‹å†æŠŠå…¶ä»–æ–‡ä»¶ç³»ç»Ÿ(æ¯”å¦‚å…¶ä»–çš„ç£ç›˜åˆ†åŒº, /proc æ–‡ä»¶ç³»ç»Ÿ, /sys æ–‡ä»¶ç³»ç»Ÿ, NFS ç­‰)æŒ‚è½½è¿›æ¥")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_3-æ–‡ä»¶ç³»ç»Ÿi-o"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ–‡ä»¶ç³»ç»Ÿi-o"}},[s._v("#")]),s._v(" 3.æ–‡ä»¶ç³»ç»ŸI/O")]),s._v(" "),a("p",[s._v("æŠŠæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°æŒ‚è½½ç‚¹å, å°±èƒ½"),a("strong",[s._v("é€šè¿‡æŒ‚è½½ç‚¹, å†å»è®¿é—®å®ƒç®¡ç†çš„æ–‡ä»¶")]),s._v("äº†. "),a("strong",[s._v("VFS æä¾›äº†ä¸€ç»„æ ‡å‡†çš„æ–‡ä»¶è®¿é—®æ¥å£. è¿™äº›æ¥å£ä»¥ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼, æä¾›ç»™åº”ç”¨ç¨‹åºä½¿ç”¨")]),s._v(".")]),s._v(" "),a("p",[s._v("å°±æ‹¿ cat å‘½ä»¤æ¥è¯´, å®ƒé¦–å…ˆè°ƒç”¨ open(), æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶; ç„¶åè°ƒç”¨ read(), è¯»å–æ–‡ä»¶çš„å†…å®¹; æœ€åå†è°ƒç”¨ write(), æŠŠæ–‡ä»¶å†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°çš„æ ‡å‡†è¾“å‡ºä¸­:")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pathname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("mode_t")]),s._v(" mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ssize_t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("size_t")]),s._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ssize_t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("size_t")]),s._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æ–‡ä»¶è¯»å†™æ–¹å¼çš„å„ç§å·®å¼‚, å¯¼è‡´ I/O çš„åˆ†ç±»å¤šç§å¤šæ ·. æœ€å¸¸è§çš„æœ‰, ç¼“å†²ä¸éç¼“å†² I/O, ç›´æ¥ä¸éç›´æ¥ I/O, é˜»å¡ä¸éé˜»å¡ I/O, åŒæ­¥ä¸å¼‚æ­¥ I/O ç­‰.  æ¥ä¸‹æ¥, å°±è¯¦ç»†çœ‹è¿™å››ç§åˆ†ç±».")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç§, æ ¹æ®"),a("mark",[a("strong",[s._v("æ˜¯å¦åˆ©ç”¨æ ‡å‡†åº“ç¼“å­˜")])]),s._v(", å¯ä»¥æŠŠæ–‡ä»¶ I/O åˆ†ä¸º"),a("strong",[s._v("ç¼“å†² I/O ä¸éç¼“å†² I/O")]),s._v(".")]),s._v(" "),a("ul",[a("li",[s._v("ç¼“å†² I/O, æ˜¯æŒ‡"),a("strong",[s._v("åˆ©ç”¨æ ‡å‡†åº“ç¼“å­˜æ¥åŠ é€Ÿæ–‡ä»¶çš„è®¿é—®, è€Œæ ‡å‡†åº“å†…éƒ¨å†é€šè¿‡ç³»ç»Ÿè°ƒåº¦è®¿é—®æ–‡ä»¶")]),s._v(".")]),s._v(" "),a("li",[s._v("éç¼“å†² I/O, æ˜¯æŒ‡"),a("strong",[s._v("ç›´æ¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥è®¿é—®æ–‡ä»¶, ä¸å†ç»è¿‡æ ‡å‡†åº“ç¼“å­˜")]),s._v(".")])]),s._v(" "),a("p",[s._v('æ³¨æ„, è¿™é‡Œæ‰€è¯´çš„"ç¼“å†²", æ˜¯'),a("strong",[s._v("æŒ‡æ ‡å‡†åº“å†…éƒ¨å®ç°çš„ç¼“å­˜")]),s._v(". æ¯”æ–¹è¯´, ä½ å¯èƒ½è§åˆ°è¿‡, å¾ˆå¤šç¨‹åºé‡åˆ°æ¢è¡Œæ—¶æ‰çœŸæ­£è¾“å‡º, è€Œæ¢è¡Œå‰çš„å†…å®¹, å…¶å®å°±æ˜¯è¢«æ ‡å‡†åº“æš‚æ—¶ç¼“å­˜äº†èµ·æ¥.")]),s._v(" "),a("p",[s._v("æ— è®ºç¼“å†² I/O è¿˜æ˜¯éç¼“å†² I/O, å®ƒä»¬æœ€ç»ˆè¿˜æ˜¯è¦"),a("strong",[s._v("ç»è¿‡ç³»ç»Ÿè°ƒç”¨æ¥è®¿é—®æ–‡ä»¶")]),s._v(". è€Œæ ¹æ®ä¸Šä¸€èŠ‚å†…å®¹å¯ä»¥çŸ¥é“, ç³»ç»Ÿè°ƒç”¨å, è¿˜ä¼šé€šè¿‡é¡µç¼“å­˜, æ¥å‡å°‘ç£ç›˜çš„ I/O æ“ä½œ.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒ, æ ¹æ®"),a("mark",[a("strong",[s._v("æ˜¯å¦åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜")])]),s._v(", å¯ä»¥æŠŠæ–‡ä»¶ I/O åˆ†ä¸º"),a("strong",[s._v("ç›´æ¥ I/O ä¸éç›´æ¥ I/O")]),s._v(".")]),s._v(" "),a("ul",[a("li",[s._v("ç›´æ¥ I/O, æ˜¯æŒ‡"),a("strong",[s._v("è·³è¿‡æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜, ç›´æ¥è·Ÿæ–‡ä»¶ç³»ç»Ÿäº¤äº’æ¥è®¿é—®æ–‡ä»¶")]),s._v(".")]),s._v(" "),a("li",[s._v("éç›´æ¥ I/O æ­£å¥½ç›¸å, æ–‡ä»¶è¯»å†™æ—¶, "),a("strong",[s._v("å…ˆè¦ç»è¿‡ç³»ç»Ÿçš„é¡µç¼“å­˜, ç„¶åå†ç”±å†…æ ¸æˆ–é¢å¤–çš„ç³»ç»Ÿè°ƒç”¨, çœŸæ­£å†™å…¥ç£ç›˜")]),s._v(".")])]),s._v(" "),a("p",[s._v("æƒ³è¦å®ç°ç›´æ¥ I/O, éœ€è¦åœ¨ç³»ç»Ÿè°ƒç”¨ä¸­, æŒ‡å®š O_DIRECT æ ‡å¿—. å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡, é»˜è®¤çš„æ˜¯éç›´æ¥ I/O.")]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, ç›´æ¥ I/O, éç›´æ¥ I/O, æœ¬è´¨ä¸Šè¿˜æ˜¯"),a("strong",[s._v("å’Œæ–‡ä»¶ç³»ç»Ÿäº¤äº’")]),s._v(". å¦‚æœæ˜¯åœ¨æ•°æ®åº“ç­‰åœºæ™¯ä¸­, è¿˜ä¼šçœ‹åˆ°, è·³è¿‡æ–‡ä»¶ç³»ç»Ÿè¯»å†™ç£ç›˜çš„æƒ…å†µ, ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„"),a("strong",[s._v("è£¸ I/O")]),s._v(".")]),s._v(" "),a("p",[s._v("ç¬¬ä¸‰, æ ¹æ®"),a("mark",[a("strong",[s._v("åº”ç”¨ç¨‹åºæ˜¯å¦é˜»å¡è‡ªèº«è¿è¡Œ")])]),s._v(", å¯ä»¥æŠŠæ–‡ä»¶ I/O åˆ†ä¸º"),a("strong",[s._v("é˜»å¡ I/O å’Œéé˜»å¡ I/O")]),s._v(":")]),s._v(" "),a("ul",[a("li",[s._v("æ‰€è°“é˜»å¡ I/O, æ˜¯æŒ‡åº”ç”¨ç¨‹åºæ‰§è¡Œ I/O æ“ä½œå, å¦‚æœ"),a("strong",[s._v("æ²¡æœ‰è·å¾—å“åº”, å°±ä¼šé˜»å¡å½“å‰çº¿ç¨‹")]),s._v(", è‡ªç„¶å°±ä¸èƒ½æ‰§è¡Œå…¶ä»–ä»»åŠ¡.")]),s._v(" "),a("li",[s._v("æ‰€è°“éé˜»å¡ I/O, æ˜¯æŒ‡åº”ç”¨ç¨‹åºæ‰§è¡Œ I/O æ“ä½œå, "),a("strong",[s._v("ä¸ä¼šé˜»å¡å½“å‰çš„çº¿ç¨‹, å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡")]),s._v(", éšåå†é€šè¿‡è½®è¯¢æˆ–è€…äº‹ä»¶é€šçŸ¥çš„å½¢å¼, è·å–è°ƒç”¨çš„ç»“æœ.")])]),s._v(" "),a("p",[s._v("æ¯”æ–¹è¯´, è®¿é—®ç®¡é“æˆ–è€…ç½‘ç»œå¥—æ¥å­—æ—¶, è®¾ç½® O_NONBLOCK æ ‡å¿—, å°±è¡¨ç¤ºç”¨éé˜»å¡æ–¹å¼è®¿é—®; è€Œå¦‚æœä¸åšä»»ä½•è®¾ç½®, é»˜è®¤çš„å°±æ˜¯é˜»å¡è®¿é—®.")]),s._v(" "),a("p",[s._v("ç¬¬å››, æ ¹æ®"),a("mark",[a("strong",[s._v("æ˜¯å¦ç­‰å¾…å“åº”ç»“æœ")])]),s._v(", å¯ä»¥æŠŠæ–‡ä»¶ I/O åˆ†ä¸º"),a("strong",[s._v("åŒæ­¥å’Œå¼‚æ­¥ I/O")]),s._v(":")]),s._v(" "),a("ul",[a("li",[s._v("æ‰€è°“åŒæ­¥ I/O, æ˜¯æŒ‡"),a("strong",[s._v("åº”ç”¨ç¨‹åºæ‰§è¡Œ I/O æ“ä½œå, è¦ä¸€ç›´ç­‰åˆ°æ•´ä¸ª I/O å®Œæˆå, æ‰èƒ½è·å¾— I/O å“åº”")]),s._v(".")]),s._v(" "),a("li",[s._v("æ‰€è°“å¼‚æ­¥ I/O, æ˜¯æŒ‡"),a("strong",[s._v("åº”ç”¨ç¨‹åºæ‰§è¡Œ I/O æ“ä½œå, ä¸ç”¨ç­‰å¾…å®Œæˆå’Œå®Œæˆåçš„å“åº”, è€Œæ˜¯ç»§ç»­æ‰§è¡Œå°±å¯ä»¥")]),s._v(". ç­‰åˆ°è¿™æ¬¡ I/O å®Œæˆå, å“åº”ä¼šç”¨äº‹ä»¶é€šçŸ¥çš„æ–¹å¼, å‘Šè¯‰åº”ç”¨ç¨‹åº.")])]),s._v(" "),a("p",[s._v("ä¸¾ä¸ªä¾‹å­, åœ¨æ“ä½œæ–‡ä»¶æ—¶, å¦‚æœè®¾ç½®äº† O_SYNC æˆ–è€… O_DSYNC æ ‡å¿—, å°±ä»£è¡¨åŒæ­¥ I/O. å¦‚æœè®¾ç½®äº† O_DSYNC, å°±è¦ç­‰æ–‡ä»¶æ•°æ®å†™å…¥ç£ç›˜å, æ‰èƒ½è¿”å›; è€Œ O_SYNC, åˆ™æ˜¯åœ¨ O_DSYNC åŸºç¡€ä¸Š, è¦æ±‚æ–‡ä»¶å…ƒæ•°æ®ä¹Ÿè¦å†™å…¥ç£ç›˜å, æ‰èƒ½è¿”å›.")]),s._v(" "),a("p",[s._v("å†æ¯”å¦‚, "),a("strong",[s._v("åœ¨è®¿é—®ç®¡é“æˆ–è€…ç½‘ç»œå¥—æ¥å­—æ—¶, è®¾ç½®äº† O_ASYNC é€‰é¡¹å, ç›¸åº”çš„ I/O å°±æ˜¯å¼‚æ­¥ I/O")]),s._v(". è¿™æ ·, å†…æ ¸ä¼šå†é€šè¿‡ SIGIO æˆ–è€… SIGPOLL, æ¥é€šçŸ¥è¿›ç¨‹æ–‡ä»¶æ˜¯å¦å¯è¯»å†™.")]),s._v(" "),a("p",[s._v("ä½ å¯èƒ½å‘ç°äº†, è¿™é‡Œçš„å¥½å¤šæ¦‚å¿µä¹Ÿç»å¸¸å‡ºç°åœ¨ç½‘ç»œç¼–ç¨‹ä¸­. æ¯”å¦‚éé˜»å¡ I/O, é€šå¸¸ä¼šè·Ÿ select/poll é…åˆ, ç”¨åœ¨ç½‘ç»œå¥—æ¥å­—çš„ I/O ä¸­.")]),s._v(" "),a("p",[s._v('è¿™æ ·å°±åº”è¯¥å¯ä»¥ç†è§£, "'),a("mark",[a("strong",[s._v("Linux ä¸€åˆ‡çš†æ–‡ä»¶")])]),s._v('" çš„æ·±åˆ»å«ä¹‰. '),a("mark",[a("strong",[s._v("æ— è®ºæ˜¯æ™®é€šæ–‡ä»¶å’Œå—è®¾å¤‡, è¿˜æ˜¯ç½‘ç»œå¥—æ¥å­—å’Œç®¡é“ç­‰, å®ƒä»¬éƒ½é€šè¿‡ç»Ÿä¸€çš„ VFS æ¥å£æ¥è®¿é—®")])]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_4-æ€§èƒ½è§‚æµ‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ€§èƒ½è§‚æµ‹"}},[s._v("#")]),s._v(" 4.æ€§èƒ½è§‚æµ‹")]),s._v(" "),a("p",[s._v("å­¦äº†è¿™ä¹ˆå¤šæ–‡ä»¶ç³»ç»Ÿçš„åŸç†, ä½ ä¼°è®¡ä¹Ÿæ˜¯è¿«ä¸åŠå¾…æƒ³ä¸Šæ‰‹, è§‚å¯Ÿä¸€ä¸‹æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½æƒ…å†µäº†. æ¥ä¸‹æ¥, æ‰“å¼€ä¸€ä¸ªç»ˆç«¯, SSH ç™»å½•åˆ°æœåŠ¡å™¨ä¸Š, æ¥çœ‹çœ‹å¦‚ä½•è§‚æµ‹æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½.")]),s._v(" "),a("h6",{attrs:{id:"_1-å®¹é‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å®¹é‡"}},[s._v("#")]),s._v(" (1)å®¹é‡")]),s._v(" "),a("p",[s._v("å¯¹æ–‡ä»¶ç³»ç»Ÿæ¥è¯´, æœ€å¸¸è§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ç©ºé—´ä¸è¶³. "),a("strong",[s._v("ç”¨ df å‘½ä»¤, èƒ½æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ")]),s._v(". æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" /dev/sda1 \nFilesystem     1K-blocks    Used Available Use% Mounted on \n/dev/sda1       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30308240")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3167020")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27124836")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("% / \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, æ ¹æ–‡ä»¶ç³»ç»Ÿåªä½¿ç”¨äº† 11% çš„ç©ºé—´. è¿™é‡Œè¿˜è¦æ³¨æ„, æ€»ç©ºé—´ç”¨ 1K-blocks çš„æ•°é‡æ¥è¡¨ç¤º, å¯ä»¥ç»™ df åŠ ä¸Š -h é€‰é¡¹, ä»¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" /dev/sda1 \nFilesystem      Size  Used Avail Use% Mounted on \n/dev/sda1        29G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".1G   26G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("% / \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä¸è¿‡æœ‰æ—¶å€™, æ˜æ˜ä½ ç¢°åˆ°äº†ç©ºé—´ä¸è¶³çš„é—®é¢˜, å¯æ˜¯ç”¨ df æŸ¥çœ‹ç£ç›˜ç©ºé—´å, å´å‘ç°å‰©ä½™ç©ºé—´è¿˜æœ‰å¾ˆå¤š. è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢?")]),s._v(" "),a("p",[s._v("ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—, åˆšæ‰å¼ºè°ƒçš„ä¸€ä¸ªç»†èŠ‚. "),a("strong",[s._v("é™¤äº†æ–‡ä»¶æ•°æ®, ç´¢å¼•èŠ‚ç‚¹ä¹Ÿå ç”¨ç£ç›˜ç©ºé—´")]),s._v(". å¯ä»¥ç»™ df å‘½ä»¤åŠ ä¸Š -i å‚æ•°, æŸ¥çœ‹ç´¢å¼•èŠ‚ç‚¹çš„ä½¿ç”¨æƒ…å†µ, å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /dev/sda1 \nFilesystem      Inodes  IUsed   IFree IUse% Mounted on \n/dev/sda1      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3870720")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("157460")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3713260")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("% / \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ç´¢å¼•èŠ‚ç‚¹çš„å®¹é‡, (ä¹Ÿå°±æ˜¯ Inode ä¸ªæ•°)æ˜¯åœ¨æ ¼å¼åŒ–ç£ç›˜æ—¶è®¾å®šå¥½çš„, ä¸€èˆ¬ç”±æ ¼å¼åŒ–å·¥å…·è‡ªåŠ¨ç”Ÿæˆ. "),a("strong",[s._v("å½“å‘ç°ç´¢å¼•èŠ‚ç‚¹ç©ºé—´ä¸è¶³, ä½†ç£ç›˜ç©ºé—´å……è¶³æ—¶, å¾ˆå¯èƒ½å°±æ˜¯è¿‡å¤šå°æ–‡ä»¶å¯¼è‡´çš„")]),s._v(".")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ä¸€èˆ¬æ¥è¯´, åˆ é™¤è¿™äº›å°æ–‡ä»¶, æˆ–è€…æŠŠå®ƒä»¬ç§»åŠ¨åˆ°ç´¢å¼•èŠ‚ç‚¹å……è¶³çš„å…¶ä»–ç£ç›˜ä¸­, å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜.")]),s._v(" "),a("h6",{attrs:{id:"_2-ç¼“å­˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç¼“å­˜"}},[s._v("#")]),s._v(" (2)ç¼“å­˜")]),s._v(" "),a("p",[s._v("åœ¨å‰é¢ Cache æ¡ˆä¾‹ä¸­, å·²ç»ä»‹ç»è¿‡, å¯ä»¥"),a("strong",[s._v("ç”¨ free æˆ– vmstat, æ¥è§‚å¯Ÿé¡µç¼“å­˜çš„å¤§å°")]),s._v(". å¤ä¹ ä¸€ä¸‹, free è¾“å‡ºçš„ Cache, æ˜¯é¡µç¼“å­˜å’Œå¯å›æ”¶ Slab ç¼“å­˜çš„å’Œ, å¯ä»¥ä» "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹, ç›´æ¥å¾—åˆ°å®ƒä»¬çš„å¤§å°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/meminfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SReclaimable|Cached"')]),s._v(" \nCached:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("748316")]),s._v(" kB \nSwapCached:            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" kB \nSReclaimable:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("179508")]),s._v(" kB \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è¯è¯´å›æ¥, æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•é¡¹å’Œç´¢å¼•èŠ‚ç‚¹ç¼“å­˜, åˆè¯¥å¦‚ä½•è§‚å¯Ÿå‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, å†…æ ¸ä½¿ç”¨ Slab æœºåˆ¶, ç®¡ç†ç›®å½•é¡¹å’Œç´¢å¼•èŠ‚ç‚¹çš„ç¼“å­˜. "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹ åªç»™å‡ºäº† Slab çš„æ•´ä½“å¤§å°, å…·ä½“åˆ°æ¯ä¸€ç§ Slab ç¼“å­˜, è¿˜è¦æŸ¥çœ‹ "),a("code",[s._v("/proc/slabinfo")]),s._v("â€‹ è¿™ä¸ªæ–‡ä»¶.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, è¿è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥å¾—åˆ°"),a("strong",[s._v("æ‰€æœ‰ç›®å½•é¡¹å’Œå„ç§æ–‡ä»¶ç³»ç»Ÿç´¢å¼•èŠ‚ç‚¹çš„ç¼“å­˜æƒ…å†µ")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/slabinfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^#|dentry|inode'")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# name            <active_objs> <num_objs> <objsize> <objperslab> <pagesperslab> : tunables <limit> <batchcount> <sharedfactor> : slabdata <active_slabs> <num_slabs> <sharedavail> ")]),s._v("\nxfs_inode              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("960")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tunables    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" slabdata      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". \next4_inode_cache   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32104")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34590")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1088")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tunables    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" slabdata   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2306")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2306")]),s._v("      0hugetlbfs_inode_cache     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("624")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tunables    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" slabdata      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nsock_inode_cache    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1190")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1242")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("704")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tunables    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" slabdata     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nshmem_inode_cache   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1622")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2139")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("712")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tunables    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" slabdata     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nproc_inode_cache    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3560")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4080")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("680")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tunables    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" slabdata    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("340")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("340")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \ninode_cache        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25172")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25818")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("608")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tunables    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" slabdata   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1986")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1986")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \ndentry             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("76050")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("121296")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" tunables    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" slabdata   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5776")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5776")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("è¿™ä¸ªç•Œé¢ä¸­, dentry è¡Œè¡¨ç¤ºç›®å½•é¡¹ç¼“å­˜, inode_cache è¡Œ, è¡¨ç¤º VFS ç´¢å¼•èŠ‚ç‚¹ç¼“å­˜, å…¶ä½™çš„åˆ™æ˜¯å„ç§æ–‡ä»¶ç³»ç»Ÿçš„ç´¢å¼•èŠ‚ç‚¹ç¼“å­˜.")]),s._v(" "),a("p",[s._v("â€‹"),a("code",[s._v("/proc/slabinfo")]),s._v("â€‹ çš„åˆ—æ¯”è¾ƒå¤š, å…·ä½“å«ä¹‰å¯ä»¥æŸ¥è¯¢ man slabinfo. åœ¨å®é™…æ€§èƒ½åˆ†æä¸­, æ›´å¸¸ä½¿ç”¨ slabtop æ¥æ‰¾åˆ°å ç”¨å†…å­˜æœ€å¤šçš„ç¼“å­˜ç±»å‹.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä¸‹é¢å°±æ˜¯è¿è¡Œ slabtop å¾—åˆ°çš„ç»“æœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‰ä¸‹ c æŒ‰ç…§ç¼“å­˜å¤§å°æ’åº, æŒ‰ä¸‹ a æŒ‰ç…§æ´»è·ƒå¯¹è±¡æ•°æ’åº ")]),s._v("\n$ slabtop \nActive / Total Objects "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("% used"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("277970")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("358914")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77.4")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nActive / Total Slabs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("% used"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12414")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12414")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nActive / Total Caches "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("% used"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("135")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61.5")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nActive / Total Size "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("% used"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57816")]),s._v(".88K / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73307")]),s._v(".70K "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78.9")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nMinimum / Average / Maximum Object "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".01K / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".20K / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(".88K \n \n  OBJS ACTIVE  USE OBJ SIZE  SLABS OBJ/SLAB CACHE SIZE NAME \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("69804")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23094")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".19K   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3324")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("     13296K dentry \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16380")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15854")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".59K   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1260")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("     10080K inode_cache \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("58260")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55397")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".13K   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1942")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("      7768K kernfs_node_cache \n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("485")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("413")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".69K     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      3104K task_struct \n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1472")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1397")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".00K     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("      2944K kmalloc-2048 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("ä»è¿™ä¸ªç»“æœå¯ä»¥çœ‹åˆ°, åœ¨æˆ‘çš„ç³»ç»Ÿä¸­, ç›®å½•é¡¹å’Œç´¢å¼•èŠ‚ç‚¹å ç”¨äº†æœ€å¤šçš„ Slab ç¼“å­˜. ä¸è¿‡å®ƒä»¬å ç”¨çš„å†…å­˜å…¶å®å¹¶ä¸å¤§, åŠ èµ·æ¥ä¹Ÿåªæœ‰ 23MB å·¦å³.")]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“-6"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[a("strong",[s._v("æ–‡ä»¶ç³»ç»Ÿ, æ˜¯å¯¹å­˜å‚¨è®¾å¤‡ä¸Šçš„æ–‡ä»¶, è¿›è¡Œç»„ç»‡ç®¡ç†çš„ä¸€ç§æœºåˆ¶. ä¸ºäº†æ”¯æŒå„ç±»ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿ, Linux åœ¨å„ç§æ–‡ä»¶ç³»ç»Ÿå®ç°ä¸Š, æŠ½è±¡äº†ä¸€å±‚è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ(VFS).")])]),s._v(" "),a("p",[a("strong",[s._v("VFS å®šä¹‰äº†ä¸€ç»„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒçš„æ•°æ®ç»“æ„å’Œæ ‡å‡†æ¥å£. è¿™æ ·, ç”¨æˆ·è¿›ç¨‹å’Œå†…æ ¸ä¸­çš„å…¶ä»–å­ç³»ç»Ÿ, å°±åªéœ€è¦è·Ÿ VFS æä¾›çš„ç»Ÿä¸€æ¥å£è¿›è¡Œäº¤äº’.")])]),s._v(" "),a("p",[a("strong",[s._v("ä¸ºäº†é™ä½æ…¢é€Ÿç£ç›˜å¯¹æ€§èƒ½çš„å½±å“, æ–‡ä»¶ç³»ç»Ÿåˆé€šè¿‡é¡µç¼“å­˜, ç›®å½•é¡¹ç¼“å­˜ä»¥åŠç´¢å¼•èŠ‚ç‚¹ç¼“å­˜, ç¼“å’Œç£ç›˜å»¶è¿Ÿå¯¹åº”ç”¨ç¨‹åºçš„å½±å“.")])]),s._v(" "),a("h4",{attrs:{id:"_24-åŸºç¡€ç¯‡-linuxç£ç›˜i-oæ˜¯æ€ä¹ˆå·¥ä½œçš„-ä¸Š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_24-åŸºç¡€ç¯‡-linuxç£ç›˜i-oæ˜¯æ€ä¹ˆå·¥ä½œçš„-ä¸Š"}},[s._v("#")]),s._v(" 24-åŸºç¡€ç¯‡:Linuxç£ç›˜I/Oæ˜¯æ€ä¹ˆå·¥ä½œçš„(ä¸Š)")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚å­¦ä¹ äº† Linux æ–‡ä»¶ç³»ç»Ÿçš„å·¥ä½œåŸç†. ç®€å•å›é¡¾ä¸€ä¸‹, æ–‡ä»¶ç³»ç»Ÿæ˜¯å¯¹å­˜å‚¨è®¾å¤‡ä¸Šçš„æ–‡ä»¶, è¿›è¡Œç»„ç»‡ç®¡ç†çš„ä¸€ç§æœºåˆ¶. è€Œ Linux åœ¨å„ç§æ–‡ä»¶ç³»ç»Ÿå®ç°ä¸Š, åˆæŠ½è±¡äº†ä¸€å±‚è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ VFS, å®ƒå®šä¹‰äº†ä¸€ç»„, æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒçš„, æ•°æ®ç»“æ„å’Œæ ‡å‡†æ¥å£.")]),s._v(" "),a("p",[s._v("è¿™æ ·, "),a("strong",[s._v("å¯¹åº”ç”¨ç¨‹åºæ¥è¯´, åªéœ€è¦è·Ÿ VFS æä¾›çš„ç»Ÿä¸€æ¥å£äº¤äº’, è€Œä¸éœ€è¦å…³æ³¨æ–‡ä»¶ç³»ç»Ÿçš„å…·ä½“å®ç°; å¯¹å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿæ¥è¯´, åªéœ€è¦æŒ‰ç…§ VFS çš„æ ‡å‡†, å°±å¯ä»¥æ— ç¼æ”¯æŒå„ç§åº”ç”¨ç¨‹åº")]),s._v(".")]),s._v(" "),a("p",[s._v("VFS å†…éƒ¨åˆé€šè¿‡ç›®å½•é¡¹, ç´¢å¼•èŠ‚ç‚¹, é€»è¾‘å—ä»¥åŠè¶…çº§å—ç­‰æ•°æ®ç»“æ„, æ¥ç®¡ç†æ–‡ä»¶.")]),s._v(" "),a("ul",[a("li",[s._v("ç›®å½•é¡¹, è®°å½•äº†æ–‡ä»¶çš„åå­—, ä»¥åŠæ–‡ä»¶ä¸å…¶ä»–ç›®å½•é¡¹ä¹‹é—´çš„ç›®å½•å…³ç³».")]),s._v(" "),a("li",[s._v("ç´¢å¼•èŠ‚ç‚¹, è®°å½•äº†æ–‡ä»¶çš„å…ƒæ•°æ®.")]),s._v(" "),a("li",[s._v("é€»è¾‘å—, æ˜¯ç”±è¿ç»­ç£ç›˜æ‰‡åŒºæ„æˆçš„æœ€å°è¯»å†™å•å…ƒ, ç”¨æ¥å­˜å‚¨æ–‡ä»¶æ•°æ®.")]),s._v(" "),a("li",[s._v("è¶…çº§å—, ç”¨æ¥è®°å½•æ–‡ä»¶ç³»ç»Ÿæ•´ä½“çš„çŠ¶æ€, å¦‚ç´¢å¼•èŠ‚ç‚¹å’Œé€»è¾‘å—çš„ä½¿ç”¨æƒ…å†µç­‰.")])]),s._v(" "),a("p",[s._v("å…¶ä¸­, ç›®å½•é¡¹æ˜¯ä¸€ä¸ªå†…å­˜ç¼“å­˜; è€Œè¶…çº§å—, ç´¢å¼•èŠ‚ç‚¹å’Œé€»è¾‘å—, éƒ½æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„æŒä¹…åŒ–æ•°æ®.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, è¿›ä¸€æ­¥æƒ³, "),a("strong",[s._v("ç£ç›˜åˆæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢? åˆæœ‰å“ªäº›æŒ‡æ ‡å¯ä»¥ç”¨æ¥è¡¡é‡å®ƒçš„æ€§èƒ½å‘¢")]),s._v("? æ¥ä¸‹æ¥å°±ä¸€èµ·çœ‹çœ‹ Linux ç£ç›˜ I/O çš„å·¥ä½œåŸç†.")]),s._v(" "),a("h5",{attrs:{id:"_1-ç£ç›˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç£ç›˜"}},[s._v("#")]),s._v(" 1.ç£ç›˜")]),s._v(" "),a("p",[s._v("ç£ç›˜æ˜¯å¯ä»¥"),a("strong",[s._v("æŒä¹…åŒ–å­˜å‚¨")]),s._v("çš„è®¾å¤‡, æ ¹æ®å­˜å‚¨ä»‹è´¨çš„ä¸åŒ, å¸¸è§ç£ç›˜å¯ä»¥åˆ†ä¸ºä¸¤ç±»: æœºæ¢°ç£ç›˜å’Œå›ºæ€ç£ç›˜.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç±», æœºæ¢°ç£ç›˜, ä¹Ÿç§°ä¸ºç¡¬ç›˜é©±åŠ¨å™¨(Hard Disk Driver), é€šå¸¸ç¼©å†™ä¸º HDD. æœºæ¢°ç£ç›˜ä¸»è¦ç”±ç›˜ç‰‡å’Œè¯»å†™ç£å¤´ç»„æˆ, æ•°æ®å°±å­˜å‚¨åœ¨ç›˜ç‰‡çš„ç¯çŠ¶ç£é“ä¸­. åœ¨è¯»å†™æ•°æ®å‰, éœ€è¦ç§»åŠ¨è¯»å†™ç£å¤´, å®šä½åˆ°æ•°æ®æ‰€åœ¨çš„ç£é“, ç„¶åæ‰èƒ½è®¿é—®æ•°æ®. æ˜¾ç„¶, å¦‚æœ I/O è¯·æ±‚åˆšå¥½è¿ç»­, é‚£å°±ä¸éœ€è¦ç£é“å¯»å€, è‡ªç„¶å¯ä»¥è·å¾—æœ€ä½³æ€§èƒ½. è¿™å…¶å®å°±æ˜¯"),a("strong",[s._v("è¿ç»­ I/O")]),s._v(" çš„å·¥ä½œåŸç†. ä¸ä¹‹ç›¸å¯¹åº”çš„, å½“ç„¶å°±æ˜¯"),a("strong",[s._v("éšæœº I/O")]),s._v(", å®ƒéœ€è¦ä¸åœåœ°ç§»åŠ¨ç£å¤´, æ¥å®šä½æ•°æ®ä½ç½®, æ‰€ä»¥è¯»å†™é€Ÿåº¦å°±ä¼šæ¯”è¾ƒæ…¢.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒç±», å›ºæ€ç£ç›˜(Solid State Disk), é€šå¸¸ç¼©å†™ä¸º SSD, ç”±å›ºæ€ç”µå­å…ƒå™¨ä»¶ç»„æˆ. å›ºæ€ç£ç›˜ä¸éœ€è¦ç£é“å¯»å€, æ‰€ä»¥, ä¸ç®¡æ˜¯è¿ç»­ I/O, è¿˜æ˜¯éšæœº I/O çš„æ€§èƒ½, éƒ½æ¯”æœºæ¢°ç£ç›˜è¦å¥½å¾—å¤š.")]),s._v(" "),a("p",[s._v("å…¶å®, "),a("strong",[s._v("æ— è®ºæœºæ¢°ç£ç›˜, è¿˜æ˜¯å›ºæ€ç£ç›˜, ç›¸åŒç£ç›˜çš„éšæœº I/O éƒ½è¦æ¯”è¿ç»­ I/O æ…¢å¾ˆå¤š")]),s._v(", åŸå› ä¹Ÿå¾ˆæ˜æ˜¾.")]),s._v(" "),a("ul",[a("li",[s._v("å¯¹æœºæ¢°ç£ç›˜æ¥è¯´, åˆšåˆšæåˆ°è¿‡çš„, ç”±äºéšæœº I/O éœ€è¦æ›´å¤šçš„ç£å¤´å¯»é“å’Œç›˜ç‰‡æ—‹è½¬, å®ƒçš„æ€§èƒ½è‡ªç„¶è¦æ¯”è¿ç»­ I/O æ…¢.")]),s._v(" "),a("li",[s._v('è€Œå¯¹å›ºæ€ç£ç›˜æ¥è¯´, è™½ç„¶å®ƒçš„éšæœºæ€§èƒ½æ¯”æœºæ¢°ç¡¬ç›˜å¥½å¾ˆå¤š, ä½†åŒæ ·å­˜åœ¨ "'),a("strong",[s._v("å…ˆæ“¦é™¤å†å†™å…¥")]),s._v('" çš„é™åˆ¶. éšæœºè¯»å†™ä¼šå¯¼è‡´å¤§é‡çš„åƒåœ¾å›æ”¶, æ‰€ä»¥ç›¸å¯¹åº”çš„, éšæœº I/O çš„æ€§èƒ½æ¯”èµ·è¿ç»­ I/O æ¥, ä¹Ÿè¿˜æ˜¯å·®äº†å¾ˆå¤š.')]),s._v(" "),a("li",[s._v("æ­¤å¤–, è¿ç»­ I/O è¿˜å¯ä»¥é€šè¿‡"),a("strong",[s._v("é¢„è¯»")]),s._v("çš„æ–¹å¼, æ¥å‡å°‘ I/O è¯·æ±‚çš„æ¬¡æ•°, è¿™ä¹Ÿæ˜¯å…¶æ€§èƒ½ä¼˜å¼‚çš„ä¸€ä¸ªåŸå› . å¾ˆå¤šæ€§èƒ½ä¼˜åŒ–çš„æ–¹æ¡ˆ, ä¹Ÿéƒ½ä¼šä»è¿™ä¸ªè§’åº¦å‡ºå‘, æ¥ä¼˜åŒ– I/O æ€§èƒ½.")])]),s._v(" "),a("p",[s._v("æ­¤å¤–, æœºæ¢°ç£ç›˜å’Œå›ºæ€ç£ç›˜è¿˜åˆ†åˆ«æœ‰ä¸€ä¸ªæœ€å°çš„è¯»å†™å•ä½.")]),s._v(" "),a("ul",[a("li",[s._v("æœºæ¢°ç£ç›˜çš„æœ€å°è¯»å†™å•ä½æ˜¯"),a("strong",[s._v("æ‰‡åŒº")]),s._v(", ä¸€èˆ¬å¤§å°ä¸º 512 å­—èŠ‚.")]),s._v(" "),a("li",[s._v("è€Œå›ºæ€ç£ç›˜çš„æœ€å°è¯»å†™å•ä½æ˜¯"),a("strong",[s._v("é¡µ")]),s._v(", é€šå¸¸å¤§å°æ˜¯ 4KB, 8KB ç­‰.")])]),s._v(" "),a("p",[s._v("åœ¨ä¸Šä¸€èŠ‚ä¹Ÿæåˆ°è¿‡, å¦‚æœæ¯æ¬¡éƒ½è¯»å†™ 512 å­—èŠ‚è¿™ä¹ˆå°çš„å•ä½çš„è¯, æ•ˆç‡å¾ˆä½. æ‰€ä»¥, "),a("strong",[s._v("æ–‡ä»¶ç³»ç»Ÿä¼šæŠŠè¿ç»­çš„æ‰‡åŒºæˆ–é¡µ, ç»„æˆé€»è¾‘å—, ç„¶åä»¥é€»è¾‘å—ä½œä¸ºæœ€å°å•å…ƒæ¥ç®¡ç†æ•°æ®")]),s._v(". å¸¸è§çš„é€»è¾‘å—çš„å¤§å°æ˜¯ 4KB, ä¹Ÿå°±æ˜¯è¯´, è¿ç»­ 8 ä¸ªæ‰‡åŒº, æˆ–è€…å•ç‹¬çš„ä¸€ä¸ªé¡µ, éƒ½å¯ä»¥ç»„æˆä¸€ä¸ªé€»è¾‘å—.")]),s._v(" "),a("p",[s._v("é™¤äº†å¯ä»¥æŒ‰ç…§å­˜å‚¨ä»‹è´¨æ¥åˆ†ç±», å¦ä¸€ä¸ªå¸¸è§çš„åˆ†ç±»æ–¹æ³•, æ˜¯æŒ‰ç…§æ¥å£æ¥åˆ†ç±», æ¯”å¦‚å¯ä»¥æŠŠç¡¬ç›˜åˆ†ä¸º IDE(Integrated Drive Electronics), SCSI(Small Computer System Interface) , SAS(Serial Attached SCSI) , SATA(Serial ATA) , FC(Fibre Channel) ç­‰. ä¸åŒçš„æ¥å£, å¾€å¾€åˆ†é…ä¸åŒçš„è®¾å¤‡åç§°. æ¯”å¦‚, IDE è®¾å¤‡ä¼šåˆ†é…ä¸€ä¸ª hd å‰ç¼€çš„è®¾å¤‡å, SCSI å’Œ SATA è®¾å¤‡ä¼šåˆ†é…ä¸€ä¸ª "),a("strong",[s._v("sd å‰ç¼€")]),s._v("çš„è®¾å¤‡å. å¦‚æœæ˜¯å¤šå—åŒç±»å‹çš„ç£ç›˜, å°±ä¼šæŒ‰ç…§ a, b, c ç­‰çš„å­—æ¯é¡ºåºæ¥ç¼–å·.")]),s._v(" "),a("p",[s._v("é™¤äº†ç£ç›˜æœ¬èº«çš„åˆ†ç±»å¤–, å½“æŠŠç£ç›˜æ¥å…¥æœåŠ¡å™¨å, æŒ‰ç…§ä¸åŒçš„ä½¿ç”¨æ–¹å¼, åˆå¯ä»¥æŠŠå®ƒä»¬åˆ’åˆ†ä¸ºå¤šç§ä¸åŒçš„"),a("strong",[s._v("æ¶æ„")]),s._v(". æœ€ç®€å•çš„, å°±æ˜¯ç›´æ¥ä½œä¸ºç‹¬ç«‹ç£ç›˜è®¾å¤‡æ¥ä½¿ç”¨. è¿™äº›ç£ç›˜, å¾€å¾€è¿˜ä¼šæ ¹æ®éœ€è¦, åˆ’åˆ†ä¸ºä¸åŒçš„"),a("strong",[s._v("é€»è¾‘åˆ†åŒº")]),s._v(", æ¯ä¸ªåˆ†åŒºå†ç”¨æ•°å­—ç¼–å·. æ¯”å¦‚å‰é¢å¤šæ¬¡ç”¨åˆ°çš„ "),a("code",[s._v("/dev/sda")]),s._v("â€‹, è¿˜å¯ä»¥åˆ†æˆä¸¤ä¸ªåˆ†åŒº "),a("code",[s._v("/dev/sda1")]),s._v("â€‹ å’Œ "),a("code",[s._v("/dev/sda2")]),s._v("â€‹.")]),s._v(" "),a("p",[s._v("å¦ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æ¶æ„, æ˜¯æŠŠå¤šå—ç£ç›˜ç»„åˆæˆä¸€ä¸ªé€»è¾‘ç£ç›˜, æ„æˆå†—ä½™ç‹¬ç«‹"),a("strong",[s._v("ç£ç›˜é˜µåˆ—")]),s._v(", ä¹Ÿå°±æ˜¯ "),a("strong",[s._v("RAID")]),s._v("(Redundant Array of Independent Disks), ä»è€Œå¯ä»¥æé«˜æ•°æ®è®¿é—®çš„æ€§èƒ½, å¹¶ä¸”å¢å¼ºæ•°æ®å­˜å‚¨çš„å¯é æ€§.")]),s._v(" "),a("p",[s._v("æ ¹æ®å®¹é‡, æ€§èƒ½å’Œå¯é æ€§éœ€æ±‚çš„ä¸åŒ, RAID ä¸€èˆ¬å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªçº§åˆ«, å¦‚ RAID0, RAID1, RAID5, RAID10 ç­‰.")]),s._v(" "),a("ul",[a("li",[s._v("RAID0 æœ‰æœ€ä¼˜çš„è¯»å†™æ€§èƒ½, ä½†ä¸æä¾›æ•°æ®å†—ä½™çš„åŠŸèƒ½.")]),s._v(" "),a("li",[s._v("è€Œå…¶ä»–çº§åˆ«çš„ RAID, åœ¨æä¾›æ•°æ®å†—ä½™çš„åŸºç¡€ä¸Š, å¯¹è¯»å†™æ€§èƒ½ä¹Ÿæœ‰ä¸€å®šç¨‹åº¦çš„ä¼˜åŒ–.")])]),s._v(" "),a("p",[s._v("æœ€åä¸€ç§æ¶æ„, æ˜¯æŠŠè¿™äº›ç£ç›˜ç»„åˆæˆä¸€ä¸ªç½‘ç»œå­˜å‚¨é›†ç¾¤, å†é€šè¿‡ NFS, SMB, iSCSI ç­‰ç½‘ç»œå­˜å‚¨åè®®, æš´éœ²ç»™æœåŠ¡å™¨ä½¿ç”¨.")]),s._v(" "),a("p",[s._v("å…¶å®åœ¨ Linux ä¸­, "),a("strong",[s._v("ç£ç›˜å®é™…ä¸Šæ˜¯ä½œä¸ºä¸€ä¸ªå—è®¾å¤‡æ¥ç®¡ç†çš„")]),s._v(", ä¹Ÿå°±æ˜¯ä»¥å—ä¸ºå•ä½è¯»å†™æ•°æ®, å¹¶ä¸”æ”¯æŒéšæœºè¯»å†™. æ¯ä¸ªå—è®¾å¤‡éƒ½ä¼šè¢«èµ‹äºˆä¸¤ä¸ªè®¾å¤‡å·, åˆ†åˆ«æ˜¯ä¸», æ¬¡è®¾å¤‡å·. ä¸»è®¾å¤‡å·ç”¨åœ¨é©±åŠ¨ç¨‹åºä¸­, ç”¨æ¥åŒºåˆ†è®¾å¤‡ç±»å‹; è€Œæ¬¡è®¾å¤‡å·åˆ™æ˜¯ç”¨æ¥ç»™å¤šä¸ªåŒç±»è®¾å¤‡ç¼–å·.")]),s._v(" "),a("h5",{attrs:{id:"_2-é€šç”¨å—å±‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-é€šç”¨å—å±‚"}},[s._v("#")]),s._v(" 2.é€šç”¨å—å±‚")]),s._v(" "),a("p",[s._v("è·Ÿä¸Šä¸€èŠ‚è®²åˆ°çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ VFS ç±»ä¼¼, ä¸ºäº†å‡å°ä¸åŒå—è®¾å¤‡çš„å·®å¼‚å¸¦æ¥çš„å½±å“, "),a("mark",[a("strong",[s._v("Linux é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„é€šç”¨å—å±‚, æ¥ç®¡ç†å„ç§ä¸åŒçš„å—è®¾å¤‡. é€šç”¨å—å±‚, å…¶å®æ˜¯å¤„åœ¨æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜é©±åŠ¨ä¸­é—´çš„ä¸€ä¸ªå—è®¾å¤‡æŠ½è±¡å±‚")])]),s._v(".")]),s._v(" "),a("p",[s._v("å®ƒä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ä¸ªåŠŸèƒ½è·Ÿè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½ç±»ä¼¼. å‘ä¸Š, "),a("strong",[s._v("ä¸ºæ–‡ä»¶ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åº, æä¾›è®¿é—®å—è®¾å¤‡çš„æ ‡å‡†æ¥å£")]),s._v("; å‘ä¸‹, "),a("strong",[s._v("æŠŠå„ç§å¼‚æ„çš„ç£ç›˜è®¾å¤‡æŠ½è±¡ä¸ºç»Ÿä¸€çš„å—è®¾å¤‡, å¹¶æä¾›ç»Ÿä¸€æ¡†æ¶æ¥ç®¡ç†è¿™äº›è®¾å¤‡çš„é©±åŠ¨ç¨‹åº")]),s._v(".")]),s._v(" "),a("li",[s._v("ç¬¬äºŒä¸ªåŠŸèƒ½, "),a("strong",[s._v("é€šç”¨å—å±‚è¿˜ä¼šç»™æ–‡ä»¶ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºå‘æ¥çš„ I/O è¯·æ±‚æ’é˜Ÿ, å¹¶é€šè¿‡é‡æ–°æ’åº, è¯·æ±‚åˆå¹¶ç­‰æ–¹å¼, æé«˜ç£ç›˜è¯»å†™çš„æ•ˆç‡")]),s._v(".")])]),s._v(" "),a("p",[s._v("å…¶ä¸­, å¯¹ I/O è¯·æ±‚æ’åºçš„è¿‡ç¨‹, ä¹Ÿå°±æ˜¯å¤§å®¶ç†Ÿæ‚‰çš„ I/O è°ƒåº¦. äº‹å®ä¸Š, Linux å†…æ ¸æ”¯æŒå››ç§ I/O è°ƒåº¦ç®—æ³•, åˆ†åˆ«æ˜¯ NONE, NOOP, CFQ ä»¥åŠ DeadLine. è¿™é‡Œä¹Ÿåˆ†åˆ«ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§ NONE, æ›´ç¡®åˆ‡æ¥è¯´, å¹¶ä¸èƒ½ç®— I/O è°ƒåº¦ç®—æ³•. å› ä¸ºå®ƒå®Œå…¨ä¸ä½¿ç”¨ä»»ä½• I/O è°ƒåº¦å™¨, å¯¹æ–‡ä»¶ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„ I/O å…¶å®ä¸åšä»»ä½•å¤„ç†, å¸¸ç”¨åœ¨è™šæ‹Ÿæœºä¸­(æ­¤æ—¶ç£ç›˜ I/O è°ƒåº¦å®Œå…¨ç”±ç‰©ç†æœºè´Ÿè´£).")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§ NOOP, æ˜¯æœ€ç®€å•çš„ä¸€ç§ I/O è°ƒåº¦ç®—æ³•. å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå…ˆå…¥å…ˆå‡ºçš„é˜Ÿåˆ—, åªåšä¸€äº›æœ€åŸºæœ¬çš„è¯·æ±‚åˆå¹¶, å¸¸ç”¨äº SSD ç£ç›˜.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰ç§ CFQ(Completely Fair Scheduler), ä¹Ÿè¢«ç§°ä¸º"),a("strong",[s._v("å®Œå…¨å…¬å¹³è°ƒåº¦å™¨")]),s._v(", æ˜¯ç°åœ¨å¾ˆå¤šå‘è¡Œç‰ˆçš„é»˜è®¤ I/O è°ƒåº¦å™¨, å®ƒä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ª I/O è°ƒåº¦é˜Ÿåˆ—, å¹¶æŒ‰ç…§æ—¶é—´ç‰‡æ¥å‡åŒ€åˆ†å¸ƒæ¯ä¸ªè¿›ç¨‹çš„ I/O è¯·æ±‚. ç±»ä¼¼äºè¿›ç¨‹ CPU è°ƒåº¦, CFQ è¿˜æ”¯æŒè¿›ç¨‹ I/O çš„ä¼˜å…ˆçº§è°ƒåº¦, æ‰€ä»¥å®ƒé€‚ç”¨äºè¿è¡Œå¤§é‡è¿›ç¨‹çš„ç³»ç»Ÿ, åƒæ˜¯æ¡Œé¢ç¯å¢ƒ, å¤šåª’ä½“åº”ç”¨ç­‰.")]),s._v(" "),a("li",[s._v("æœ€åä¸€ç§ DeadLine è°ƒåº¦ç®—æ³•, åˆ†åˆ«ä¸ºè¯», å†™è¯·æ±‚åˆ›å»ºäº†ä¸åŒçš„ I/O é˜Ÿåˆ—, å¯ä»¥æé«˜æœºæ¢°ç£ç›˜çš„ååé‡, å¹¶ç¡®ä¿è¾¾åˆ°æœ€ç»ˆæœŸé™(deadline)çš„è¯·æ±‚è¢«ä¼˜å…ˆå¤„ç†. DeadLine è°ƒåº¦ç®—æ³•, å¤šç”¨åœ¨ I/O å‹åŠ›æ¯”è¾ƒé‡çš„åœºæ™¯, æ¯”å¦‚æ•°æ®åº“ç­‰.")])]),s._v(" "),a("h5",{attrs:{id:"_3-i-oæ ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-i-oæ ˆ"}},[s._v("#")]),s._v(" 3.I/Oæ ˆ")]),s._v(" "),a("p",[s._v("æ¸…æ¥šäº†ç£ç›˜å’Œé€šç”¨å—å±‚çš„å·¥ä½œåŸç†, å†ç»“åˆä¸Šä¸€èŠ‚è®²è¿‡çš„æ–‡ä»¶ç³»ç»ŸåŸç†, å°±å¯ä»¥"),a("strong",[s._v("æ•´ä½“æ¥çœ‹ Linux å­˜å‚¨ç³»ç»Ÿçš„ I/O åŸç†")]),s._v("äº†.")]),s._v(" "),a("p",[s._v("å¯ä»¥æŠŠ Linux å­˜å‚¨ç³»ç»Ÿçš„ I/O æ ˆ, ç”±ä¸Šåˆ°ä¸‹åˆ†ä¸ºä¸‰ä¸ªå±‚æ¬¡, åˆ†åˆ«æ˜¯"),a("mark",[a("strong",[s._v("æ–‡ä»¶ç³»ç»Ÿå±‚, é€šç”¨å—å±‚å’Œè®¾å¤‡å±‚")])]),s._v(". è¿™ä¸‰ä¸ª I/O å±‚çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º, è¿™å…¶å®ä¹Ÿæ˜¯ Linux å­˜å‚¨ç³»ç»Ÿçš„ I/O æ ˆå…¨æ™¯å›¾.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ad396b7db3b2655a951eabeee034b8f5-20230731161933-b5lmzox.png",alt:""}})]),s._v(" "),a("p",[s._v("æ ¹æ®è¿™å¼  I/O æ ˆçš„å…¨æ™¯å›¾, å¯ä»¥æ›´æ¸…æ¥šåœ°ç†è§£, å­˜å‚¨ç³»ç»Ÿ I/O çš„å·¥ä½œåŸç†.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("æ–‡ä»¶ç³»ç»Ÿå±‚, åŒ…æ‹¬è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿå’Œå…¶ä»–å„ç§æ–‡ä»¶ç³»ç»Ÿçš„å…·ä½“å®ç°. å®ƒä¸ºä¸Šå±‚çš„åº”ç”¨ç¨‹åº, æä¾›æ ‡å‡†çš„æ–‡ä»¶è®¿é—®æ¥å£; å¯¹ä¸‹ä¼šé€šè¿‡é€šç”¨å—å±‚, æ¥å­˜å‚¨å’Œç®¡ç†ç£ç›˜æ•°æ®.")])]),s._v(" "),a("li",[a("strong",[s._v("é€šç”¨å—å±‚, åŒ…æ‹¬å—è®¾å¤‡ I/O é˜Ÿåˆ—å’Œ I/O è°ƒåº¦å™¨. å®ƒä¼šå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ I/O è¯·æ±‚è¿›è¡Œæ’é˜Ÿ, å†é€šè¿‡é‡æ–°æ’åºå’Œè¯·æ±‚åˆå¹¶, ç„¶åæ‰è¦å‘é€ç»™ä¸‹ä¸€çº§çš„è®¾å¤‡å±‚.")])]),s._v(" "),a("li",[a("strong",[s._v("è®¾å¤‡å±‚, åŒ…æ‹¬å­˜å‚¨è®¾å¤‡å’Œç›¸åº”çš„é©±åŠ¨ç¨‹åº, è´Ÿè´£æœ€ç»ˆç‰©ç†è®¾å¤‡çš„ I/O æ“ä½œ.")])])]),s._v(" "),a("p",[s._v("å­˜å‚¨ç³»ç»Ÿçš„ I/O, é€šå¸¸æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€æ…¢çš„ä¸€ç¯. æ‰€ä»¥, Linux é€šè¿‡å¤šç§"),a("strong",[s._v("ç¼“å­˜æœºåˆ¶")]),s._v("æ¥ä¼˜åŒ– I/O æ•ˆç‡.")]),s._v(" "),a("p",[s._v("æ¯”æ–¹è¯´, ä¸ºäº†ä¼˜åŒ–æ–‡ä»¶è®¿é—®çš„æ€§èƒ½, ä¼šä½¿ç”¨é¡µç¼“å­˜, ç´¢å¼•èŠ‚ç‚¹ç¼“å­˜, ç›®å½•é¡¹ç¼“å­˜ç­‰å¤šç§ç¼“å­˜æœºåˆ¶, ä»¥å‡å°‘å¯¹ä¸‹å±‚å—è®¾å¤‡çš„ç›´æ¥è°ƒç”¨. åŒæ ·, ä¸ºäº†ä¼˜åŒ–å—è®¾å¤‡çš„è®¿é—®æ•ˆç‡, ä¼šä½¿ç”¨ç¼“å†²åŒº, æ¥ç¼“å­˜å—è®¾å¤‡çš„æ•°æ®.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-6"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¢³ç†äº† Linux ç£ç›˜ I/O çš„å·¥ä½œåŸç†, å¹¶äº†è§£äº†ç”±æ–‡ä»¶ç³»ç»Ÿå±‚, é€šç”¨å—å±‚å’Œè®¾å¤‡å±‚æ„æˆçš„ Linux å­˜å‚¨ç³»ç»Ÿ I/O æ ˆ.")]),s._v(" "),a("p",[s._v("å…¶ä¸­, "),a("strong",[s._v("é€šç”¨å—å±‚æ˜¯ Linux ç£ç›˜ I/O çš„æ ¸å¿ƒ. å‘ä¸Š, å®ƒä¸ºæ–‡ä»¶ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åº, æä¾›è®¿é—®äº†å—è®¾å¤‡çš„æ ‡å‡†æ¥å£; å‘ä¸‹, æŠŠå„ç§å¼‚æ„çš„ç£ç›˜è®¾å¤‡, æŠ½è±¡ä¸ºç»Ÿä¸€çš„å—è®¾å¤‡, å¹¶ä¼šå¯¹æ–‡ä»¶ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºå‘æ¥çš„ I/O è¯·æ±‚è¿›è¡Œé‡æ–°æ’åº, è¯·æ±‚åˆå¹¶ç­‰, æé«˜äº†ç£ç›˜è®¿é—®çš„æ•ˆç‡")]),s._v(".")]),s._v(" "),a("h4",{attrs:{id:"_25-åŸºç¡€ç¯‡-linuxç£ç›˜i-oæ˜¯æ€ä¹ˆå·¥ä½œçš„-ä¸‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25-åŸºç¡€ç¯‡-linuxç£ç›˜i-oæ˜¯æ€ä¹ˆå·¥ä½œçš„-ä¸‹"}},[s._v("#")]),s._v(" 25-åŸºç¡€ç¯‡:Linuxç£ç›˜I/Oæ˜¯æ€ä¹ˆå·¥ä½œçš„(ä¸‹)")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚å­¦ä¹ äº† Linux ç£ç›˜ I/O çš„å·¥ä½œåŸç†, å¹¶äº†è§£äº†ç”±æ–‡ä»¶ç³»ç»Ÿå±‚, é€šç”¨å—å±‚å’Œè®¾å¤‡å±‚æ„æˆçš„ Linux å­˜å‚¨ç³»ç»Ÿ I/O æ ˆ. æŒæ¡äº†ç£ç›˜ I/O çš„å·¥ä½œåŸç†, ä½ ä¼°è®¡è¿«ä¸åŠå¾…æƒ³çŸ¥é“, "),a("strong",[s._v("æ€ä¹ˆæ‰èƒ½è¡¡é‡ç£ç›˜çš„ I/O æ€§èƒ½")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹, "),a("strong",[s._v("ç£ç›˜çš„æ€§èƒ½æŒ‡æ ‡ä»¥åŠè§‚æµ‹è¿™äº›æŒ‡æ ‡çš„æ–¹æ³•")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-ç£ç›˜æ€§èƒ½æŒ‡æ ‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç£ç›˜æ€§èƒ½æŒ‡æ ‡"}},[s._v("#")]),s._v(" 1.ç£ç›˜æ€§èƒ½æŒ‡æ ‡")]),s._v(" "),a("p",[s._v("è¯´åˆ°ç£ç›˜æ€§èƒ½çš„è¡¡é‡æ ‡å‡†, å¿…é¡»è¦æåˆ°äº”ä¸ªå¸¸è§æŒ‡æ ‡, ä¹Ÿå°±æ˜¯ç»å¸¸ç”¨åˆ°çš„, "),a("mark",[a("strong",[s._v("ä½¿ç”¨ç‡, é¥±å’Œåº¦, IOPS, ååé‡ä»¥åŠå“åº”æ—¶é—´ç­‰. è¿™äº”ä¸ªæŒ‡æ ‡, æ˜¯è¡¡é‡ç£ç›˜æ€§èƒ½çš„åŸºæœ¬æŒ‡æ ‡")])]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä½¿ç”¨ç‡, æ˜¯æŒ‡ç£ç›˜å¤„ç† I/O çš„æ—¶é—´ç™¾åˆ†æ¯”")]),s._v(". è¿‡é«˜çš„ä½¿ç”¨ç‡(æ¯”å¦‚è¶…è¿‡ 80%), é€šå¸¸æ„å‘³ç€ç£ç›˜ I/O å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("li",[a("strong",[s._v("é¥±å’Œåº¦, æ˜¯æŒ‡ç£ç›˜å¤„ç† I/O çš„ç¹å¿™ç¨‹åº¦")]),s._v(". è¿‡é«˜çš„é¥±å’Œåº¦, æ„å‘³ç€ç£ç›˜å­˜åœ¨ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆ. å½“é¥±å’Œåº¦ä¸º 100% æ—¶, ç£ç›˜æ— æ³•æ¥å—æ–°çš„ I/O è¯·æ±‚.")]),s._v(" "),a("li",[a("strong",[s._v("IOPS(Input/Output Per Second), æ˜¯æŒ‡æ¯ç§’çš„ I/O è¯·æ±‚æ•°")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("ååé‡, æ˜¯æŒ‡æ¯ç§’çš„ I/O è¯·æ±‚å¤§å°")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("å“åº”æ—¶é—´, æ˜¯æŒ‡ I/O è¯·æ±‚ä»å‘å‡ºåˆ°æ”¶åˆ°å“åº”çš„é—´éš”æ—¶é—´")]),s._v(".")])]),s._v(" "),a("p",[s._v("è¿™é‡Œè¦æ³¨æ„çš„æ˜¯, ä½¿ç”¨ç‡åªè€ƒè™‘æœ‰æ²¡æœ‰ I/O, è€Œä¸è€ƒè™‘ I/O çš„å¤§å°. æ¢å¥è¯è¯´, å½“ä½¿ç”¨ç‡æ˜¯ 100% çš„æ—¶å€™, ç£ç›˜ä¾ç„¶æœ‰å¯èƒ½æ¥å—æ–°çš„ I/O è¯·æ±‚.")]),s._v(" "),a("p",[s._v("è¿™äº›æŒ‡æ ‡, å¾ˆå¯èƒ½æ˜¯ä½ ç»å¸¸æŒ‚åœ¨å˜´è¾¹çš„, ä¸€è®¨è®ºç£ç›˜æ€§èƒ½å¿…å®šæèµ·çš„å¯¹è±¡. ä¸è¿‡è¿˜æ˜¯è¦å¼ºè°ƒä¸€ç‚¹, ä¸è¦å­¤ç«‹åœ°å»æ¯”è¾ƒæŸä¸€æŒ‡æ ‡, è€Œè¦ç»“åˆè¯»å†™æ¯”ä¾‹, I/O ç±»å‹(éšæœºè¿˜æ˜¯è¿ç»­)ä»¥åŠ I/O çš„å¤§å°, ç»¼åˆæ¥åˆ†æ.")]),s._v(" "),a("p",[s._v("ä¸¾ä¸ªä¾‹å­, åœ¨æ•°æ®åº“, å¤§é‡å°æ–‡ä»¶ç­‰è¿™ç±»éšæœºè¯»å†™æ¯”è¾ƒå¤šçš„åœºæ™¯ä¸­, IOPS æ›´èƒ½åæ˜ ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½; è€Œåœ¨å¤šåª’ä½“ç­‰é¡ºåºè¯»å†™è¾ƒå¤šçš„åœºæ™¯ä¸­, ååé‡æ‰æ›´èƒ½åæ˜ ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½.")]),s._v(" "),a("p",[s._v("ä¸€èˆ¬æ¥è¯´, åœ¨ä¸ºåº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨é€‰å‹æ—¶, è¦å…ˆå¯¹ç£ç›˜çš„ I/O æ€§èƒ½è¿›è¡ŒåŸºå‡†æµ‹è¯•, ä»¥ä¾¿å¯ä»¥å‡†ç¡®è¯„ä¼°, ç£ç›˜æ€§èƒ½æ˜¯å¦å¯ä»¥æ»¡è¶³åº”ç”¨ç¨‹åºçš„éœ€æ±‚.")]),s._v(" "),a("p",[s._v("è¿™ä¸€æ–¹é¢, "),a("strong",[s._v("æ¨èç”¨æ€§èƒ½æµ‹è¯•å·¥å…· fio æ¥æµ‹è¯•ç£ç›˜çš„ IOPS, ååé‡ä»¥åŠå“åº”æ—¶é—´ç­‰æ ¸å¿ƒæŒ‡æ ‡")]),s._v(". ä½†è¿˜æ˜¯é‚£å¥è¯, å› åœ°åˆ¶å®œ, çµæ´»é€‰å–. åœ¨åŸºå‡†æµ‹è¯•æ—¶, ä¸€å®šè¦æ³¨æ„æ ¹æ®åº”ç”¨ç¨‹åº I/O çš„ç‰¹ç‚¹, æ¥å…·ä½“è¯„ä¼°æŒ‡æ ‡.")]),s._v(" "),a("p",[s._v("å½“ç„¶, è¿™å°±éœ€è¦æµ‹è¯•å‡ºä¸åŒ I/O å¤§å°(ä¸€èˆ¬æ˜¯ 512B è‡³ 1MB ä¸­é—´çš„è‹¥å¹²å€¼)åˆ†åˆ«åœ¨éšæœºè¯», é¡ºåºè¯», éšæœºå†™, é¡ºåºå†™ç­‰å„ç§åœºæ™¯ä¸‹çš„æ€§èƒ½æƒ…å†µ. ç”¨æ€§èƒ½å·¥å…·å¾—åˆ°çš„è¿™äº›æŒ‡æ ‡, å¯ä»¥ä½œä¸ºåç»­åˆ†æåº”ç”¨ç¨‹åºæ€§èƒ½çš„ä¾æ®. ä¸€æ—¦å‘ç”Ÿæ€§èƒ½é—®é¢˜, å°±å¯ä»¥æŠŠå®ƒä»¬ä½œä¸ºç£ç›˜æ€§èƒ½çš„æé™å€¼, è¿›è€Œè¯„ä¼°ç£ç›˜ I/O çš„ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("äº†è§£ç£ç›˜çš„æ€§èƒ½æŒ‡æ ‡, åªæ˜¯ I/O æ€§èƒ½æµ‹è¯•çš„ç¬¬ä¸€æ­¥. æ¥ä¸‹æ¥, åˆè¯¥ç”¨ä»€ä¹ˆæ–¹æ³•æ¥è§‚æµ‹å®ƒä»¬å‘¢? è¿™é‡Œä»‹ç»å‡ ä¸ª"),a("strong",[s._v("å¸¸ç”¨çš„ I/O æ€§èƒ½è§‚æµ‹æ–¹æ³•")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_2-ç£ç›˜i-oè§‚æµ‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç£ç›˜i-oè§‚æµ‹"}},[s._v("#")]),s._v(" 2.ç£ç›˜I/Oè§‚æµ‹")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ä¸ªè¦è§‚æµ‹çš„, æ˜¯"),a("strong",[s._v("æ¯å—ç£ç›˜çš„ä½¿ç”¨æƒ…å†µ")]),s._v(".")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("iostat æ˜¯æœ€å¸¸ç”¨çš„ç£ç›˜ I/O æ€§èƒ½è§‚æµ‹å·¥å…·, å®ƒæä¾›äº†æ¯ä¸ªç£ç›˜çš„ä½¿ç”¨ç‡, IOPS, ååé‡ç­‰å„ç§å¸¸è§çš„æ€§èƒ½æŒ‡æ ‡")])]),s._v(", å½“ç„¶, è¿™äº›æŒ‡æ ‡å®é™…ä¸Šæ¥è‡ª "),a("code",[s._v("/proc/diskstats")]),s._v("â€‹.")]),s._v(" "),a("p",[s._v("iostat çš„è¾“å‡ºç•Œé¢å¦‚ä¸‹.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d -x è¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰ç£ç›˜ I/O çš„æŒ‡æ ‡")]),s._v("\n$ iostat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util \nloop0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \nloop1            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \nsda              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \nsdb              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°, iostat æä¾›äº†éå¸¸ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡. ç¬¬ä¸€åˆ—çš„ Device è¡¨ç¤ºç£ç›˜è®¾å¤‡çš„åå­—, å…¶ä»–å„åˆ—æŒ‡æ ‡, è™½ç„¶æ•°é‡è¾ƒå¤š, ä½†æ˜¯æ¯ä¸ªæŒ‡æ ‡çš„å«ä¹‰éƒ½å¾ˆé‡è¦. ä¸ºäº†æ–¹ä¾¿ç†è§£, ä¸‹é¢æŠŠå®ƒä»¬æ€»ç»“æˆäº†ä¸€ä¸ªè¡¨æ ¼.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/74bec0113044f815bf800566c2fd0d87-20230731161933-k0o6q1t.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™äº›æŒ‡æ ‡ä¸­è¦æ³¨æ„:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("%util, å°±æ˜¯å‰é¢æåˆ°çš„ç£ç›˜ I/O ä½¿ç”¨ç‡;")])]),s._v(" "),a("li",[a("strong",[s._v("r/s+ w/s, å°±æ˜¯ IOPS;")])]),s._v(" "),a("li",[a("strong",[s._v("rkB/s+wkB/s, å°±æ˜¯ååé‡;")])]),s._v(" "),a("li",[a("strong",[s._v("r_await+w_await, å°±æ˜¯å“åº”æ—¶é—´.")])])]),s._v(" "),a("p",[s._v("åœ¨è§‚æµ‹æŒ‡æ ‡æ—¶, ä¹Ÿåˆ«å¿˜äº†ç»“åˆè¯·æ±‚çš„å¤§å°(rareq-sz å’Œ wareq-sz)ä¸€èµ·åˆ†æ.")]),s._v(" "),a("p",[s._v("ä½ å¯èƒ½æ³¨æ„åˆ°, ä» iostat å¹¶ä¸èƒ½ç›´æ¥å¾—åˆ°ç£ç›˜é¥±å’Œåº¦. äº‹å®ä¸Š, é¥±å’Œåº¦é€šå¸¸ä¹Ÿæ²¡æœ‰å…¶ä»–ç®€å•çš„è§‚æµ‹æ–¹æ³•, ä¸è¿‡, å¯ä»¥æŠŠè§‚æµ‹åˆ°çš„, å¹³å‡è¯·æ±‚é˜Ÿåˆ—é•¿åº¦æˆ–è€…è¯»å†™è¯·æ±‚å®Œæˆçš„ç­‰å¾…æ—¶é—´, è·ŸåŸºå‡†æµ‹è¯•çš„ç»“æœ(æ¯”å¦‚é€šè¿‡ fio)è¿›è¡Œå¯¹æ¯”, ç»¼åˆè¯„ä¼°ç£ç›˜çš„é¥±å’Œæƒ…å†µ.")]),s._v(" "),a("h5",{attrs:{id:"_3-è¿›ç¨‹i-oè§‚æµ‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-è¿›ç¨‹i-oè§‚æµ‹"}},[s._v("#")]),s._v(" 3.è¿›ç¨‹I/Oè§‚æµ‹")]),s._v(" "),a("p",[s._v("é™¤äº†æ¯å—ç£ç›˜çš„ I/O æƒ…å†µ, "),a("strong",[s._v("æ¯ä¸ªè¿›ç¨‹çš„ I/O æƒ…å†µä¹Ÿæ˜¯éœ€è¦å…³æ³¨çš„é‡ç‚¹")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸Šé¢æåˆ°çš„ iostat åªæä¾›"),a("strong",[s._v("ç£ç›˜æ•´ä½“")]),s._v("çš„ I/O æ€§èƒ½æ•°æ®, ç¼ºç‚¹åœ¨äº, å¹¶ä¸èƒ½çŸ¥é“å…·ä½“æ˜¯å“ªäº›è¿›ç¨‹åœ¨è¿›è¡Œç£ç›˜è¯»å†™. "),a("strong",[s._v("è¦è§‚å¯Ÿè¿›ç¨‹çš„ I/O æƒ…å†µ, è¿˜å¯ä»¥ä½¿ç”¨ pidstat å’Œ iotop è¿™ä¸¤ä¸ªå·¥å…·")]),s._v(".")]),s._v(" "),a("p",[s._v("pidstat æ˜¯è€æœ‹å‹äº†, è¿™é‡Œå°±ä¸å†å•°å—¦å®ƒçš„åŠŸèƒ½äº†. ç»™å®ƒåŠ ä¸Š -d å‚æ•°, å°±å¯ä»¥çœ‹åˆ°è¿›ç¨‹çš„ I/O æƒ…å†µ, å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":39:51      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":39:52      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("916")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  rsyslogd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä» pidstat çš„è¾“å‡ºèƒ½çœ‹åˆ°, å®ƒå¯ä»¥å®æ—¶æŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹çš„ I/O æƒ…å†µ, åŒ…æ‹¬ä¸‹é¢è¿™äº›å†…å®¹.")]),s._v(" "),a("ul",[a("li",[s._v("ç”¨æˆ· ID(UID)å’Œè¿›ç¨‹ ID(PID).")]),s._v(" "),a("li",[a("strong",[s._v("æ¯ç§’è¯»å–çš„æ•°æ®å¤§å°")]),s._v("(kB_rd/s), å•ä½æ˜¯ KB.")]),s._v(" "),a("li",[a("strong",[s._v("æ¯ç§’å‘å‡ºçš„å†™è¯·æ±‚æ•°æ®å¤§å°")]),s._v("(kB_wr/s), å•ä½æ˜¯ KB.")]),s._v(" "),a("li",[a("strong",[s._v("æ¯ç§’å–æ¶ˆçš„å†™è¯·æ±‚æ•°æ®å¤§å°")]),s._v("(kB_ccwr/s), å•ä½æ˜¯ KB.")]),s._v(" "),a("li",[s._v("å— I/O å»¶è¿Ÿ(iodelay), åŒ…æ‹¬ç­‰å¾…åŒæ­¥å— I/O å’Œæ¢å…¥å— I/O ç»“æŸçš„æ—¶é—´, å•ä½æ˜¯æ—¶é’Ÿå‘¨æœŸ.")])]),s._v(" "),a("p",[s._v("é™¤äº†å¯ä»¥ç”¨ pidstat å®æ—¶æŸ¥çœ‹, æ ¹æ® I/O å¤§å°å¯¹è¿›ç¨‹æ’åº, ä¹Ÿæ˜¯æ€§èƒ½åˆ†æä¸­ä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•. è¿™ä¸€ç‚¹, æˆ‘æ¨èå¦ä¸€ä¸ªå·¥å…· "),a("strong",[s._v("iotop")]),s._v(". å®ƒæ˜¯ä¸€ä¸ªç±»ä¼¼äº top çš„å·¥å…·, å¯ä»¥æŒ‰ç…§ I/O å¤§å°å¯¹è¿›ç¨‹æ’åº, ç„¶åæ‰¾åˆ° I/O è¾ƒå¤§çš„é‚£äº›è¿›ç¨‹.")]),s._v(" "),a("p",[s._v("iotop çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ iotop\nTotal DISK READ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" B/s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Total DISK WRITE "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.85")]),s._v(" K/s \nActual DISK READ:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" B/s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Actual DISK WRITE:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" B/s \n  TID  PRIO  "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("     DISK READ  DISK WRITE  SWAPIN     IO"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    COMMAND \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15055")]),s._v(" be/3 root        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" B/s    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.85")]),s._v(" K/s  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" %  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" % systemd-journald \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä»è¿™ä¸ªè¾“å‡ºå¯ä»¥çœ‹åˆ°, å‰ä¸¤è¡Œåˆ†åˆ«è¡¨ç¤º, è¿›ç¨‹çš„"),a("strong",[s._v("ç£ç›˜è¯»å†™å¤§å°æ€»æ•°å’Œç£ç›˜çœŸå®çš„è¯»å†™å¤§å°æ€»æ•°")]),s._v(". å› ä¸ºç¼“å­˜, ç¼“å†²åŒº, I/O åˆå¹¶ç­‰å› ç´ çš„å½±å“, å®ƒä»¬å¯èƒ½å¹¶ä¸ç›¸ç­‰.")]),s._v(" "),a("p",[s._v("å‰©ä¸‹çš„éƒ¨åˆ†, åˆ™æ˜¯ä»å„ä¸ªè§’åº¦æ¥åˆ†åˆ«è¡¨ç¤ºè¿›ç¨‹çš„ I/O æƒ…å†µ, åŒ…æ‹¬çº¿ç¨‹ ID, I/O ä¼˜å…ˆçº§, æ¯ç§’è¯»ç£ç›˜çš„å¤§å°, æ¯ç§’å†™ç£ç›˜çš„å¤§å°, æ¢å…¥å’Œç­‰å¾… I/O çš„æ—¶é’Ÿç™¾åˆ†æ¯”ç­‰.")]),s._v(" "),a("p",[s._v("è¿™ä¸¤ä¸ªå·¥å…·, æ˜¯åˆ†æç£ç›˜ I/O æ€§èƒ½æ—¶æœ€å¸¸ç”¨åˆ°çš„.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-7"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¢³ç†äº† Linux ç£ç›˜ I/O çš„æ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½å·¥å…·. é€šå¸¸ç”¨ "),a("strong",[s._v("IOPS, ååé‡, ä½¿ç”¨ç‡, é¥±å’Œåº¦ä»¥åŠå“åº”æ—¶é—´ç­‰å‡ ä¸ªæŒ‡æ ‡, æ¥è¯„ä¼°ç£ç›˜çš„ I/O æ€§èƒ½")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("å¯ä»¥ç”¨ iostat è·å¾—ç£ç›˜çš„ I/O æƒ…å†µ, ä¹Ÿå¯ä»¥ç”¨ pidstat, iotop ç­‰è§‚å¯Ÿè¿›ç¨‹çš„ I/O æƒ…å†µ")]),s._v(". ä¸è¿‡åœ¨åˆ†æè¿™äº›æ€§èƒ½æŒ‡æ ‡æ—¶, è¦æ³¨æ„ç»“åˆè¯»å†™æ¯”ä¾‹, I/O ç±»å‹ä»¥åŠ I/O å¤§å°ç­‰, è¿›è¡Œç»¼åˆåˆ†æ.")]),s._v(" "),a("h4",{attrs:{id:"_26-æ¡ˆä¾‹ç¯‡-å¦‚ä½•æ‰¾å‡ºç‹‚æ‰“æ—¥å¿—çš„-å†…é¬¼"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_26-æ¡ˆä¾‹ç¯‡-å¦‚ä½•æ‰¾å‡ºç‹‚æ‰“æ—¥å¿—çš„-å†…é¬¼"}},[s._v("#")]),s._v(' 26-æ¡ˆä¾‹ç¯‡:å¦‚ä½•æ‰¾å‡ºç‹‚æ‰“æ—¥å¿—çš„"å†…é¬¼"?')]),s._v(" "),a("p",[s._v("å‰ä¸¤èŠ‚å­¦äº†æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜çš„ I/O åŸç†, åœ¨ç¢°åˆ°"),a("strong",[s._v("æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜çš„ I/O é—®é¢˜æ—¶, å…·ä½“åº”è¯¥æ€ä¹ˆå®šä½å’Œåˆ†æ")]),s._v("å‘¢? æœ¬èŠ‚å°±ä»¥ä¸€ä¸ªæœ€å¸¸è§çš„åº”ç”¨ç¨‹åºè®°å½•å¤§é‡æ—¥å¿—çš„æ¡ˆä¾‹, æ¥åˆ†æè¿™ç§æƒ…å†µ.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹å‡†å¤‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹å‡†å¤‡"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sysstat ç­‰å·¥å…·, å¦‚ apt install docker.io sysstat")])]),s._v(" "),a("p",[s._v("è¿™ä¸ªæ¡ˆä¾‹æ˜¯ä¸€ä¸ªç”¨ Python å¼€å‘çš„å°åº”ç”¨, ä¸ºäº†æ–¹ä¾¿è¿è¡Œ, æˆ‘æŠŠå®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ª Docker é•œåƒ. è¿™æ ·, ä½ åªè¦è¿è¡Œ Docker å‘½ä»¤, å°±å¯ä»¥å¯åŠ¨å®ƒ.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, æ‰“å¼€ä¸€ä¸ªç»ˆç«¯, SSH ç™»å½•åˆ°æ¡ˆä¾‹æ‰€ç”¨çš„æœºå™¨ä¸­, å¹¶å®‰è£…ä¸Šè¿°å·¥å…·.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ-3"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, è¿è¡Œä»Šå¤©çš„ç›®æ ‡åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /tmp:/tmp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/logapp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶å, åœ¨ç»ˆç«¯ä¸­è¿è¡Œ ps å‘½ä»¤, ç¡®è®¤æ¡ˆä¾‹åº”ç”¨æ­£å¸¸å¯åŠ¨. å¦‚æœæ“ä½œæ— è¯¯, åº”è¯¥å¯ä»¥åœ¨ ps çš„è¾“å‡ºä¸­, çœ‹åˆ°ä¸€ä¸ª app.py çš„è¿›ç¨‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" /app.py \nroot     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":41 pts/0    00:00:02 python /app.py \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ç€æ¥çœ‹çœ‹ç³»ç»Ÿæœ‰æ²¡æœ‰æ€§èƒ½é—®é¢˜. è¦è§‚å¯Ÿå“ªäº›æ€§èƒ½æŒ‡æ ‡å‘¢? å‰é¢æ–‡ç« ä¸­, æˆ‘ä»¬çŸ¥é“ CPU, å†…å­˜å’Œç£ç›˜ I/O ç­‰ç³»ç»Ÿèµ„æº, å¾ˆå®¹æ˜“å‡ºç°èµ„æºç“¶é¢ˆ, è¿™å°±æ˜¯è§‚å¯Ÿçš„æ–¹å‘äº†. æ¥è§‚å¯Ÿä¸€ä¸‹è¿™äº›èµ„æºçš„ä½¿ç”¨æƒ…å†µ.")]),s._v(" "),a("p",[s._v("å½“ç„¶, åŠ¨æ‰‹ä¹‹å‰åº”è¯¥æƒ³æ¸…æ¥š, è¦ç”¨å“ªäº›å·¥å…·æ¥åš, ä»¥åŠå·¥å…·çš„ä½¿ç”¨é¡ºåºåˆæ˜¯æ€æ ·çš„. æˆ‘çš„æƒ³æ³•æ˜¯, "),a("strong",[s._v("å¯ä»¥å…ˆç”¨ top æ¥è§‚å¯Ÿ CPU å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µ; ç„¶åå†ç”¨ iostat æ¥è§‚å¯Ÿç£ç›˜çš„ I/O æƒ…å†µ")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œ top å‘½ä»¤, è§‚å¯Ÿ CPU å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‰ 1 åˆ‡æ¢åˆ°æ¯ä¸ª CPU çš„ä½¿ç”¨æƒ…å†µ ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":43:43 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" day,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":39,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" users,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.48")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.09")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.63")]),s._v(" \nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie \n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" id, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92.7")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st \n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92.3")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.3")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st \nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169308")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("747684")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("741336")]),s._v(" used,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6680288")]),s._v(" buff/cache \nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7113124")]),s._v(" avail Mem \n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("656108")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("355740")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5236")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":12.56 python \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1312")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("236532")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24116")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9648")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(":29.80 python3 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ top çš„è¾“å‡º, ä½ ä¼šå‘ç°, "),a("strong",[s._v("CPU0 çš„ä½¿ç”¨ç‡éå¸¸é«˜")]),s._v(", å®ƒçš„"),a("strong",[s._v("ç³»ç»Ÿ CPU ä½¿ç”¨ç‡(sys%)ä¸º 6%, è€Œ iowait è¶…è¿‡äº† 90%. è¿™è¯´æ˜ CPU0 ä¸Š, å¯èƒ½æ­£åœ¨è¿è¡Œ I/O å¯†é›†å‹çš„è¿›ç¨‹")]),s._v(". ä¸è¿‡, ç©¶ç«Ÿæ˜¯ä»€ä¹ˆåŸå› å‘¢? è¿™ä¸ªç–‘é—®å…ˆä¿ç•™ç€, å…ˆç»§ç»­çœ‹å®Œ.")]),s._v(" "),a("p",[s._v("æ¥ç€æ¥çœ‹, è¿›ç¨‹éƒ¨åˆ†çš„ CPU ä½¿ç”¨æƒ…å†µ. ä½ ä¼šå‘ç°, python è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡å·²ç»è¾¾åˆ°äº† 6%, è€Œå…¶ä½™è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡éƒ½æ¯”è¾ƒä½, ä¸è¶…è¿‡ 0.3%. çœ‹èµ·æ¥ python æ˜¯ä¸ªå¯ç–‘è¿›ç¨‹. è®°ä¸‹ python è¿›ç¨‹çš„ PID å· 18940, æˆ‘ä»¬ç¨ååˆ†æ.")]),s._v(" "),a("p",[s._v("æœ€åå†çœ‹"),a("strong",[s._v("å†…å­˜çš„ä½¿ç”¨æƒ…å†µ")]),s._v(", æ€»å†…å­˜ 8G, å‰©ä½™å†…å­˜åªæœ‰ 730 MB, è€Œ Buffer/Cache å ç”¨å†…å­˜é«˜è¾¾ 6GB ä¹‹å¤š, è¿™è¯´æ˜"),a("strong",[s._v("å†…å­˜ä¸»è¦è¢«ç¼“å­˜å ç”¨")]),s._v(". è™½ç„¶å¤§éƒ¨åˆ†ç¼“å­˜å¯å›æ”¶, è¿˜æ˜¯å¾—äº†è§£ä¸‹ç¼“å­˜çš„å»å¤„, ç¡®è®¤ç¼“å­˜ä½¿ç”¨éƒ½æ˜¯åˆç†çš„.")]),s._v(" "),a("p",[s._v("åˆ°è¿™ä¸€æ­¥, åŸºæœ¬å¯ä»¥åˆ¤æ–­å‡º, "),a("strong",[s._v("CPU ä½¿ç”¨ç‡ä¸­çš„ iowait æ˜¯ä¸€ä¸ªæ½œåœ¨ç“¶é¢ˆ, è€Œå†…å­˜éƒ¨åˆ†çš„ç¼“å­˜å æ¯”è¾ƒå¤§")]),s._v(", é‚£ç£ç›˜ I/O åˆæ˜¯æ€ä¹ˆæ ·çš„æƒ…å†µå‘¢?")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸­æŒ‰ Ctrl+C, åœæ­¢ top å‘½ä»¤, å†è¿è¡Œ iostat å‘½ä»¤, è§‚å¯Ÿ I/O çš„ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d è¡¨ç¤ºæ˜¾ç¤º I/O æ€§èƒ½æŒ‡æ ‡, -x è¡¨ç¤ºæ˜¾ç¤ºæ‰©å±•ç»Ÿè®¡(å³æ‰€æœ‰ I/O æŒ‡æ ‡) ")]),s._v("\n$ iostat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util \nloop0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \nsdb              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \nsda              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7270.44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1102.18")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.20")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ iostat çš„æœ€åä¸€åˆ—, ä½ ä¼šçœ‹åˆ°, "),a("strong",[s._v("ç£ç›˜ sda çš„ I/O ä½¿ç”¨ç‡å·²ç»é«˜è¾¾ 99%")]),s._v(" , å¾ˆå¯èƒ½å·²ç»æ¥è¿‘ I/O é¥±å’Œ.")]),s._v(" "),a("p",[s._v("å†çœ‹å‰é¢çš„å„ä¸ªæŒ‡æ ‡, æ¯ç§’å†™ç£ç›˜è¯·æ±‚æ•°æ˜¯ 64, å†™å¤§å°æ˜¯ 32 MB, å†™è¯·æ±‚çš„å“åº”æ—¶é—´ä¸º 7 ç§’, è€Œè¯·æ±‚é˜Ÿåˆ—é•¿åº¦åˆ™è¾¾åˆ°äº† 1100.")]),s._v(" "),a("p",[a("strong",[s._v("è¶…æ…¢çš„å“åº”æ—¶é—´å’Œç‰¹é•¿çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦, è¿›ä¸€æ­¥éªŒè¯äº† I/O å·²ç»é¥±å’Œçš„çŒœæƒ³")]),s._v(". æ­¤æ—¶, sda ç£ç›˜å·²ç»é‡åˆ°äº†ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œ, ä¹Ÿå°±å¯ä»¥ç†è§£, ä¸ºä»€ä¹ˆå‰é¢çœ‹åˆ°çš„ iowait é«˜è¾¾ 90% äº†, è¿™æ­£æ˜¯ç£ç›˜ sda çš„ I/O ç“¶é¢ˆå¯¼è‡´çš„. æ¥ä¸‹æ¥çš„é‡ç‚¹å°±æ˜¯åˆ†æ I/O æ€§èƒ½ç“¶é¢ˆçš„æ ¹æºäº†. é‚£è¦æ€ä¹ˆçŸ¥é“, è¿™äº› I/O è¯·æ±‚ç›¸å…³çš„è¿›ç¨‹å‘¢?")]),s._v(" "),a("p",[s._v("ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—, ä¸Šä¸€èŠ‚æ›¾æåˆ°è¿‡, å¯ä»¥"),a("strong",[s._v("ç”¨ pidstat æˆ–è€… iotop, è§‚å¯Ÿè¿›ç¨‹çš„ I/O æƒ…å†µ")]),s._v(". è¿™é‡Œå°±ç”¨ pidstat æ¥çœ‹ä¸€ä¸‹.")]),s._v(" "),a("p",[s._v("ä½¿ç”¨ pidstat åŠ ä¸Š -d å‚æ•°, å°±å¯ä»¥æ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„ I/O æƒ…å†µ. æ‰€ä»¥å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œå¦‚ä¸‹å‘½ä»¤æ¥è§‚å¯Ÿ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":08:35      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":08:36        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45816.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96")]),s._v("  python \n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":08:36      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":08:37        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("354")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("350")]),s._v("  jbd2/sda1-8 \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":08:37        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46000.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96")]),s._v("  python \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":08:37        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20065")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1503")]),s._v("  kworker/u4:2 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ä» pidstat çš„è¾“å‡ºå¯ä»¥å‘ç°, åªæœ‰ python è¿›ç¨‹çš„å†™æ¯”è¾ƒå¤§, è€Œä¸”æ¯ç§’å†™çš„æ•°æ®è¶…è¿‡ 45 MB, æ¯”ä¸Šé¢ iostat å‘ç°çš„ 32MB çš„ç»“æœè¿˜è¦å¤§. å¾ˆæ˜æ˜¾, æ­£æ˜¯ python è¿›ç¨‹å¯¼è‡´äº† I/O ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("å†å¾€ä¸‹çœ‹ iodelay é¡¹. è™½ç„¶åªæœ‰ python åœ¨å¤§é‡å†™æ•°æ®, ä½†ä½ åº”è¯¥æ³¨æ„åˆ°äº†, æœ‰ä¸¤ä¸ªè¿›ç¨‹ (kworker å’Œ jbd2) çš„å»¶è¿Ÿ, å±…ç„¶æ¯” python è¿›ç¨‹è¿˜å¤§å¾ˆå¤š.")]),s._v(" "),a("p",[s._v("è¿™å…¶ä¸­, kworker æ˜¯ä¸€ä¸ªå†…æ ¸çº¿ç¨‹, è€Œ jbd2 æ˜¯ ext4 æ–‡ä»¶ç³»ç»Ÿä¸­, ç”¨æ¥ä¿è¯æ•°æ®å®Œæ•´æ€§çš„å†…æ ¸çº¿ç¨‹. ä»–ä»¬éƒ½æ˜¯ä¿è¯æ–‡ä»¶ç³»ç»ŸåŸºæœ¬åŠŸèƒ½çš„å†…æ ¸çº¿ç¨‹, æ‰€ä»¥å…·ä½“ç»†èŠ‚æš‚æ—¶å°±ä¸ç”¨ç®¡äº†, åªéœ€è¦æ˜ç™½å®ƒä»¬å»¶è¿Ÿçš„æ ¹æºè¿˜æ˜¯å¤§é‡ I/O.")]),s._v(" "),a("p",[s._v("ç»¼åˆ pidstat çš„è¾“å‡ºæ¥çœ‹, è¿˜æ˜¯ python è¿›ç¨‹çš„å«Œç–‘æœ€å¤§. æ¥ä¸‹æ¥åˆ†æ python è¿›ç¨‹åˆ°åº•åœ¨å†™ä»€ä¹ˆ.")]),s._v(" "),a("p",[s._v("é¦–å…ˆç•™æ„ä¸€ä¸‹ python è¿›ç¨‹çš„ PID å·, 18940. çœ‹åˆ° 18940, ä½ æœ‰æ²¡æœ‰è§‰å¾—ç†Ÿæ‚‰? å…¶å®å‰é¢åœ¨ä½¿ç”¨ top æ—¶, å·²ç»è®°å½•è¿‡çš„ CPU ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹, ä¹Ÿæ­£æ˜¯å®ƒ. ä¸è¿‡, è™½ç„¶åœ¨ top ä¸­ä½¿ç”¨ç‡æœ€é«˜, ä¹Ÿä¸è¿‡æ˜¯ 6%, å¹¶ä¸ç®—é«˜. æ‰€ä»¥, ä»¥ I/O é—®é¢˜ä¸ºåˆ†ææ–¹å‘è¿˜æ˜¯æ­£ç¡®çš„.")]),s._v(" "),a("p",[s._v("çŸ¥é“äº†è¿›ç¨‹çš„ PID å·, å…·ä½“è¦æ€ä¹ˆæŸ¥çœ‹å†™çš„æƒ…å†µå‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®åœ¨ç³»ç»Ÿè°ƒç”¨çš„æ¡ˆä¾‹ä¸­è®²è¿‡, è¯»å†™æ–‡ä»¶å¿…é¡»é€šè¿‡"),a("strong",[s._v("ç³»ç»Ÿè°ƒç”¨")]),s._v("å®Œæˆ. è§‚å¯Ÿç³»ç»Ÿè°ƒç”¨æƒ…å†µ, å°±å¯ä»¥çŸ¥é“è¿›ç¨‹æ­£åœ¨å†™çš„æ–‡ä»¶. æƒ³èµ· "),a("strong",[s._v("strace")]),s._v(" äº†å—, å®ƒæ­£æ˜¯åˆ†æç³»ç»Ÿè°ƒç”¨æ—¶æœ€å¸¸ç”¨çš„å·¥å…·.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œ strace å‘½ä»¤, å¹¶é€šè¿‡ -p 18940 æŒ‡å®š python è¿›ç¨‹çš„ PID å·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" \nstrace: Process "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" attached \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nmmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NULL, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("314576896")]),s._v(", PROT_READ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("PROT_WRITE, MAP_PRIVATE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("MAP_ANONYMOUS, -1, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0x7f0f7aee9000 \nmmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NULL, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("314576896")]),s._v(", PROT_READ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("PROT_WRITE, MAP_PRIVATE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("MAP_ANONYMOUS, -1, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0x7f0f682e8000 \nwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2018-12-05 15:23:01,709 - __main"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("314572844")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("314572844")]),s._v(" \nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7f0f682e8000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("314576896")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7f0f7aee9000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("314576896")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nclose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nstat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/tmp/logtest.txt.1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("st_mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("S_IFREG"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("0644, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("st_size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("943718535")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("ä» write() ç³»ç»Ÿè°ƒç”¨ä¸Šå¯ä»¥çœ‹åˆ°, è¿›ç¨‹å‘æ–‡ä»¶æè¿°ç¬¦ç¼–å·ä¸º 3 çš„æ–‡ä»¶ä¸­, å†™å…¥äº† 300MB çš„æ•°æ®. çœ‹æ¥, å®ƒåº”è¯¥æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ–‡ä»¶. ä¸è¿‡, write() è°ƒç”¨ä¸­åªèƒ½çœ‹åˆ°æ–‡ä»¶çš„æè¿°ç¬¦ç¼–å·, æ–‡ä»¶åå’Œè·¯å¾„è¿˜æ˜¯æœªçŸ¥çš„.")]),s._v(" "),a("p",[s._v("å†è§‚å¯Ÿåé¢çš„ stat() è°ƒç”¨, å¯ä»¥çœ‹åˆ°, å®ƒæ­£åœ¨è·å– "),a("code",[s._v("/tmp/logtest.txt.1")]),s._v('â€‹ çš„çŠ¶æ€.  è¿™ç§ "ç‚¹ + æ•°å­—æ ¼å¼" çš„æ–‡ä»¶, åœ¨æ—¥å¿—å›æ»šä¸­éå¸¸å¸¸è§. å› æ­¤å¯ä»¥çŒœæµ‹, è¿™æ˜¯ç¬¬ä¸€ä¸ªæ—¥å¿—å›æ»šæ–‡ä»¶, è€Œæ­£åœ¨å†™çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„, åˆ™æ˜¯ '),a("code",[s._v("/tmp/logtest.txt")]),s._v("â€‹.")]),s._v(" "),a("p",[s._v("å½“ç„¶, è¿™åªæ˜¯çŒœæµ‹, è‡ªç„¶è¿˜éœ€è¦éªŒè¯. è¿™é‡Œå†ä»‹ç»ä¸€ä¸ªæ–°çš„å·¥å…· "),a("strong",[s._v("lsof")]),s._v(". å®ƒä¸“é—¨ç”¨æ¥"),a("mark",[a("strong",[s._v("æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€æ–‡ä»¶åˆ—è¡¨")])]),s._v(', ä¸è¿‡, è¿™é‡Œçš„ "æ–‡ä»¶" ä¸åªæœ‰æ™®é€šæ–‡ä»¶, è¿˜åŒ…æ‹¬äº†ç›®å½•, å—è®¾å¤‡, åŠ¨æ€åº“, ç½‘ç»œå¥—æ¥å­—ç­‰.')]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„ lsof å‘½ä»¤, çœ‹çœ‹è¿›ç¨‹ 18940 éƒ½æ‰“å¼€äº†å“ªäº›æ–‡ä»¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" \nCOMMAND   PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("   FD   TYPE DEVICE  SIZE/OFF    NODE NAME \npython  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" root  cwd    DIR   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,50")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1549389")]),s._v(" / \npython  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" root  rtd    DIR   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,50")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1549389")]),s._v(" / \nâ€¦ \npython  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" root    2u   CHR  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("136,0")]),s._v("       0t0       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" /dev/pts/0 \npython  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v(" root    3w   REG    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8,1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("117944320")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("303")]),s._v(" /tmp/logtest.txt \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè¾“å‡ºç•Œé¢ä¸­, æœ‰å‡ åˆ—ç®€å•ä»‹ç»ä¸€ä¸‹, "),a("strong",[s._v("FD è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦å·, TYPE è¡¨ç¤ºæ–‡ä»¶ç±»å‹, NAME è¡¨ç¤ºæ–‡ä»¶è·¯å¾„")]),s._v(". è¿™ä¹Ÿæ˜¯éœ€è¦å…³æ³¨çš„é‡ç‚¹.")]),s._v(" "),a("p",[s._v("å†çœ‹æœ€åä¸€è¡Œ, è¿™è¯´æ˜, è¿™ä¸ªè¿›ç¨‹æ‰“å¼€äº†æ–‡ä»¶ "),a("code",[s._v("/tmp/logtest.txt")]),s._v("â€‹, å¹¶ä¸”å®ƒçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ 3 å·, è€Œ 3 åé¢çš„ w, è¡¨ç¤º"),a("strong",[s._v("ä»¥å†™çš„æ–¹å¼")]),s._v("æ‰“å¼€.")]),s._v(" "),a("p",[s._v('è¿™è·Ÿåˆšæ‰ strace å®ŒçŒœæµ‹çš„ç»“æœä¸€è‡´, çœ‹æ¥è¿™å°±æ˜¯é—®é¢˜çš„æ ¹æº: è¿›ç¨‹ 18940 ä»¥æ¯æ¬¡ 300MB çš„é€Ÿåº¦, åœ¨"ç–¯ç‹‚"å†™æ—¥å¿—, è€Œæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„æ˜¯ '),a("code",[s._v("/tmp/logtest.txt")]),s._v("â€‹.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶æ‰¾å‡ºäº†é—®é¢˜æ ¹æº, æ¥ä¸‹æ¥æŒ‰ç…§æƒ¯ä¾‹, å°±è¯¥æŸ¥çœ‹æºä»£ç , ç„¶ååˆ†æä¸ºä»€ä¹ˆè¿™ä¸ªè¿›ç¨‹ä¼šç‹‚æ‰“æ—¥å¿—äº†.")]),s._v(" "),a("p",[s._v("å¯ä»¥è¿è¡Œ docker cp å‘½ä»¤, æŠŠæ¡ˆä¾‹åº”ç”¨çš„æºä»£ç æ‹·è´å‡ºæ¥, ç„¶åæŸ¥çœ‹å®ƒçš„å†…å®¹.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‹·è´æ¡ˆä¾‹åº”ç”¨æºä»£ç åˆ°å½“å‰ç›®å½•")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" app:/app.py "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" \n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹æ¡ˆä¾‹åº”ç”¨çš„æºä»£ç ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" app.py \n \nlogger "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logging.getLogger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nlogger.setLevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("level"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("logging.INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nrHandler "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" RotatingFileHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/tmp/logtest.txt"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxBytes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backupCount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nrHandler.setLevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logging.INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n \ndef write_log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'Write logs to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("' \n  message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" True: \n    logger.info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n    time.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'__main__'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" \n  msg_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" \n  write_log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("åˆ†æè¿™ä¸ªæºç , å¯ä»¥å‘ç°, å®ƒçš„æ—¥å¿—è·¯å¾„æ˜¯ "),a("code",[s._v("/tmp/logtest.txt")]),s._v("â€‹, é»˜è®¤è®°å½• INFO çº§åˆ«ä»¥ä¸Šçš„æ‰€æœ‰æ—¥å¿—, è€Œä¸”æ¯æ¬¡å†™æ—¥å¿—çš„å¤§å°æ˜¯ 300MB. è¿™è·Ÿä¸Šé¢çš„åˆ†æç»“æœæ˜¯ä¸€è‡´çš„.")]),s._v(" "),a("p",[s._v("ä¸€èˆ¬æ¥è¯´, ç”Ÿäº§ç³»ç»Ÿçš„åº”ç”¨ç¨‹åº, åº”è¯¥æœ‰åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«çš„åŠŸèƒ½. ç»§ç»­æŸ¥çœ‹æºç ,ä¼šå‘ç°, è¿™ä¸ªç¨‹åºä¹Ÿå¯ä»¥è°ƒæ•´æ—¥å¿—çº§åˆ«. å¦‚æœç»™å®ƒå‘é€ SIGUSR1 ä¿¡å·, å°±å¯ä»¥æŠŠæ—¥å¿—è°ƒæ•´ä¸º INFO çº§; å‘é€ SIGUSR2 ä¿¡å·, åˆ™ä¼šè°ƒæ•´ä¸º WARNING çº§:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("def set_logging_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("signal_num, frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'Set loging level to INFO when receives SIGUSR1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("' \n  logger.setLevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logging.INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n \ndef set_logging_warning"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("signal_num, frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'Set loging level to WARNING when receives SIGUSR2"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("' \n  logger.setLevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logging.WARNING"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n \nsignal.signal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("signal.SIGUSR1, set_logging_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nsignal.signal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("signal.SIGUSR2, set_logging_warning"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("æ ¹æ®æºç ä¸­çš„æ—¥å¿—è°ƒç”¨ logger.info(message), å¯ä»¥çŸ¥é“å®ƒçš„æ—¥å¿—æ˜¯ INFO çº§, è¿™ä¹Ÿæ­£æ˜¯å®ƒçš„é»˜è®¤çº§åˆ«. é‚£ä¹ˆ, åªè¦æŠŠé»˜è®¤çº§åˆ«è°ƒé«˜åˆ° WARNING çº§, æ—¥å¿—é—®é¢˜åº”è¯¥å°±è§£å†³äº†.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±æ¥æ£€æŸ¥ä¸€ä¸‹, åˆšåˆšçš„åˆ†æå¯¹ä¸å¯¹. åœ¨ç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„ kill å‘½ä»¤, ç»™è¿›ç¨‹ 18940 å‘é€ SIGUSR2 ä¿¡å·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-SIGUSR2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18940")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶å, å†æ‰§è¡Œ top å’Œ iostat è§‚å¯Ÿä¸€ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". \n%Cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.5")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ iostat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util \nloop0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \nsdb              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \nsda              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ top å’Œ iostat çš„è¾“å‡ºä¼šå‘ç°, ç¨ç­‰ä¸€æ®µæ—¶é—´å, iowait ä¼šå˜æˆ 0, è€Œ sda ç£ç›˜çš„ I/O ä½¿ç”¨ç‡ä¹Ÿä¼šé€æ¸å‡å°‘åˆ° 0.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œä¸ä»…å®šä½äº†ç‹‚æ‰“æ—¥å¿—çš„åº”ç”¨ç¨‹åº, å¹¶é€šè¿‡è°ƒé«˜æ—¥å¿—çº§åˆ«çš„æ–¹æ³•, å®Œç¾è§£å†³äº† I/O çš„æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-3"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æ— è®ºæ˜¯æ“ä½œç³»ç»Ÿ, è¿˜æ˜¯åº”ç”¨ç¨‹åº, éƒ½ä¼šè®°å½•å¤§é‡çš„è¿è¡Œæ—¥å¿—, ä»¥ä¾¿äº‹åæŸ¥çœ‹å†å²è®°å½•. è¿™äº›æ—¥å¿—ä¸€èˆ¬æŒ‰ç…§ä¸åŒçº§åˆ«æ¥å¼€å¯, æ¯”å¦‚, å¼€å‘ç¯å¢ƒé€šå¸¸æ‰“å¼€è°ƒè¯•çº§åˆ«çš„æ—¥å¿—, è€Œçº¿ä¸Šç¯å¢ƒåˆ™åªè®°å½•è­¦å‘Šå’Œé”™è¯¯æ—¥å¿—.")]),s._v(" "),a("p",[s._v("åœ¨æ’æŸ¥åº”ç”¨ç¨‹åºé—®é¢˜æ—¶, å¯èƒ½éœ€è¦, åœ¨çº¿ä¸Šç¯å¢ƒä¸´æ—¶å¼€å¯åº”ç”¨ç¨‹åºçš„è°ƒè¯•æ—¥å¿—. æœ‰æ—¶å€™, "),a("strong",[s._v("äº‹åä¸€ä¸å°å¿ƒå°±å¿˜äº†è°ƒå›å». æ²¡æŠŠçº¿ä¸Šçš„æ—¥å¿—è°ƒé«˜åˆ°è­¦å‘Šçº§åˆ«, å¯èƒ½ä¼šå¯¼è‡´ CPU ä½¿ç”¨ç‡, ç£ç›˜ I/O ç­‰ä¸€ç³»åˆ—çš„æ€§èƒ½é—®é¢˜, ä¸¥é‡æ—¶, ç”šè‡³ä¼šå½±å“åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å…¶ä»–åº”ç”¨ç¨‹åº")]),s._v(".")]),s._v(" "),a("p",[s._v('ä»Šå, åœ¨ç¢°åˆ°è¿™ç§"ç‹‚æ‰“æ—¥å¿—"çš„åœºæ™¯æ—¶, å¯ä»¥ç”¨ iostat, strace, lsof ç­‰å·¥å…·æ¥å®šä½ç‹‚æ‰“æ—¥å¿—çš„è¿›ç¨‹, æ‰¾å‡ºç›¸åº”çš„æ—¥å¿—æ–‡ä»¶, å†é€šè¿‡åº”ç”¨ç¨‹åºçš„æ¥å£, è°ƒæ•´æ—¥å¿—çº§åˆ«æ¥è§£å†³é—®é¢˜.')]),s._v(" "),a("h4",{attrs:{id:"_27-æ¡ˆä¾‹ç¯‡-ä¸ºä»€ä¹ˆæˆ‘çš„ç£ç›˜i-oå»¶è¿Ÿå¾ˆé«˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_27-æ¡ˆä¾‹ç¯‡-ä¸ºä»€ä¹ˆæˆ‘çš„ç£ç›˜i-oå»¶è¿Ÿå¾ˆé«˜"}},[s._v("#")]),s._v(" 27-æ¡ˆä¾‹ç¯‡:ä¸ºä»€ä¹ˆæˆ‘çš„ç£ç›˜I/Oå»¶è¿Ÿå¾ˆé«˜?")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å†æ¥çœ‹ä¸€ä¸ªæ–°çš„æ¡ˆä¾‹. è¿™æ¬¡æ¡ˆä¾‹æ˜¯ä¸€ä¸ªåŸºäº Python Flask æ¡†æ¶çš„ Web åº”ç”¨, å®ƒæä¾›äº†ä¸€ä¸ªæŸ¥è¯¢å•è¯çƒ­åº¦çš„ API, ä½†æ˜¯ API çš„å“åº”é€Ÿåº¦å¹¶ä¸è®©äººæ»¡æ„.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹å‡†å¤‡-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹å‡†å¤‡-2"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sysstat ç­‰å·¥å…·, å¦‚ apt install docker.io sysstat")])]),s._v(" "),a("p",[s._v("ä¸ºäº†æ–¹ä¾¿è¿è¡Œä»Šå¤©çš„æ¡ˆä¾‹, æˆ‘æŠŠå®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ª Docker é•œåƒ. è¿™æ ·å°±åªéœ€è¦è¿è¡Œ Docker å‘½ä»¤å°±å¯ä»¥å¯åŠ¨å®ƒ.")]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹éœ€è¦ä¸¤å°è™šæ‹Ÿæœº, å…¶ä¸­ä¸€å°æ˜¯æ¡ˆä¾‹åˆ†æçš„ç›®æ ‡æœºå™¨, è¿è¡Œ Flask åº”ç”¨, å®ƒçš„ IP åœ°å€æ˜¯ 192.168.0.10; è€Œå¦ä¸€å°ä½œä¸ºå®¢æˆ·ç«¯, è¯·æ±‚å•è¯çš„çƒ­åº¦. æˆ‘ç”»äº†ä¸€å¼ å›¾è¡¨ç¤ºå®ƒä»¬çš„å…³ç³», å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/83976f9ff6919586334cd2c9b29a7531-20230731161933-rs26vbg.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ-4"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, è¿è¡Œæœ¬æ¬¡æ¡ˆä¾‹è¦åˆ†æçš„ç›®æ ‡åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/word-pop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶å, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­è¿è¡Œ curl å‘½ä»¤, è®¿é—® http://192.168.0.10:1000/, ç¡®è®¤æ¡ˆä¾‹æ­£å¸¸å¯åŠ¨. åº”è¯¥å¯ä»¥åœ¨ curl çš„è¾“å‡ºç•Œé¢é‡Œ, çœ‹åˆ°ä¸€ä¸ª hello world çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/ \nhello world\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥, åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­, è®¿é—®æ¡ˆä¾‹åº”ç”¨çš„å•è¯çƒ­åº¦æ¥å£, ä¹Ÿå°±æ˜¯ http://192.168.0.10:1000/popularity/word.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:1000/popularity/word\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç¨ç­‰ä¸€ä¼šå„¿ä¼šå‘ç°, è¿™ä¸ªæ¥å£å±…ç„¶è¿™ä¹ˆé•¿æ—¶é—´éƒ½æ²¡å“åº”, ç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹å‘¢? å…ˆå›åˆ°ç»ˆç«¯ä¸€æ¥åˆ†æä¸€ä¸‹.")]),s._v(" "),a("p",[s._v("å…ˆè¯•è¯•åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯é‡Œ, éšä¾¿æ‰§è¡Œä¸€ä¸ªå‘½ä»¤, æ¯”å¦‚æ‰§è¡Œ df å‘½ä»¤, æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ç³»ç»Ÿçš„ä½¿ç”¨æƒ…å†µ. å¥‡æ€ªçš„æ˜¯, è¿™ä¹ˆç®€å•çš„å‘½ä»¤, å±…ç„¶ä¹Ÿè¦"),a("strong",[s._v("ç­‰å¥½ä¹…")]),s._v("æ‰æœ‰è¾“å‡º.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" \nFilesystem     1K-blocks    Used Available Use% Mounted on \nudev             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073376")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073376")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev \ntmpfs             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("816932")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1188")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("815744")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /run \n/dev/sda1       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30308240")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8713640")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21578216")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("% / \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("é€šè¿‡ df å¯ä»¥çŸ¥é“, ç³»ç»Ÿè¿˜æœ‰è¶³å¤Ÿå¤šçš„ç£ç›˜ç©ºé—´. é‚£ä¸ºä»€ä¹ˆå“åº”ä¼šå˜æ…¢å‘¢? "),a("strong",[s._v("çœ‹æ¥è¿˜æ˜¯å¾—è§‚å¯Ÿä¸€ä¸‹, ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µ, åƒæ˜¯ CPU, å†…å­˜å’Œç£ç›˜ I/O ç­‰çš„å…·ä½“ä½¿ç”¨æƒ…å†µ")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™é‡Œçš„æ€è·¯å…¶å®è·Ÿä¸Šä¸€ä¸ªæ¡ˆä¾‹æ¯”è¾ƒç±»ä¼¼, "),a("strong",[s._v("å¯ä»¥å…ˆç”¨ top æ¥è§‚å¯Ÿ CPU å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µ, ç„¶åå†ç”¨ iostat æ¥è§‚å¯Ÿç£ç›˜çš„ I/O æƒ…å†µ")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸ºäº†é¿å…åˆ†æè¿‡ç¨‹ä¸­ curl è¯·æ±‚çªç„¶ç»“æŸ, å›åˆ°ç»ˆç«¯äºŒ, æŒ‰ Ctrl+C åœæ­¢åˆšæ‰çš„åº”ç”¨ç¨‹åº; ç„¶å, æŠŠ curl å‘½ä»¤æ”¾åˆ°ä¸€ä¸ªå¾ªç¯é‡Œæ‰§è¡Œ; è¿™æ¬¡è¿˜è¦åŠ ä¸€ä¸ª time å‘½ä»¤, è§‚å¯Ÿæ¯æ¬¡çš„æ‰§è¡Œæ—¶é—´:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/popularity/word"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç»§ç»­å›åˆ°ç»ˆç«¯ä¸€æ¥åˆ†ææ€§èƒ½. åœ¨ç»ˆç«¯ä¸€ä¸­è¿è¡Œ top å‘½ä»¤, è§‚å¯Ÿ CPU å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":27:02 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":30,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.26")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.76")]),s._v(" \nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("129")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie \n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" id, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.4")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st \n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.4")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70.4")]),s._v(" id, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26.5")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st \nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169300")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3323248")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("436748")]),s._v(" used,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4409304")]),s._v(" buff/cache \nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7412556")]),s._v(" avail Mem \n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103304")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28824")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7276")]),s._v(" S  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":08.77 python \n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":09.22 ksoftirqd/1 \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1549")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("236712")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24480")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9864")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":31.38 python3 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ top çš„è¾“å‡ºå¯ä»¥å‘ç°, "),a("strong",[s._v("ä¸¤ä¸ª CPU çš„ iowait éƒ½éå¸¸é«˜")]),s._v(". ç‰¹åˆ«æ˜¯ CPU0, iowait å·²ç»é«˜è¾¾ 94 %, è€Œå‰©ä½™å†…å­˜è¿˜æœ‰ 3GB, çœ‹èµ·æ¥ä¹Ÿæ˜¯å……è¶³çš„.")]),s._v(" "),a("p",[s._v("å†å¾€ä¸‹çœ‹, è¿›ç¨‹éƒ¨åˆ†æœ‰ä¸€ä¸ª python è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ç¨å¾®æœ‰ç‚¹é«˜, è¾¾åˆ°äº† 14%. è™½ç„¶ 14% å¹¶ä¸èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ, ä¸è¿‡æœ‰ç‚¹å«Œç–‘--å¯èƒ½è·Ÿ iowait çš„å‡é«˜æœ‰å…³.")]),s._v(" "),a("p",[s._v("é‚£è¿™ä¸ª PID å·ä¸º 12280 çš„ python è¿›ç¨‹, åˆ°åº•æ˜¯ä¸æ˜¯æˆ‘ä»¬çš„æ¡ˆä¾‹åº”ç”¨å‘¢?")]),s._v(" "),a("p",[s._v("åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­, æŒ‰ä¸‹ Ctrl+C, åœæ­¢ top å‘½ä»¤; ç„¶åæ‰§è¡Œä¸‹é¢çš„ ps å‘½ä»¤, æŸ¥æ‰¾æ¡ˆä¾‹åº”ç”¨ "),a("a",{attrs:{href:"http://app.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("app.py"),a("OutboundLink")],1),s._v(" çš„ PID å·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" app.py \nroot     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12222")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96064")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23452")]),s._v(" pts/0    Ss+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":37   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 python /app.py \nroot     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102424")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27904")]),s._v(" pts/0    Sl+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":37   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":09 /usr/local/bin/python /app.py \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä» ps çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°, è¿™ä¸ª CPU ä½¿ç”¨ç‡è¾ƒé«˜çš„è¿›ç¨‹, æ­£æ˜¯æˆ‘ä»¬çš„æ¡ˆä¾‹åº”ç”¨. ä¸è¿‡å…ˆåˆ«ç€æ€¥åˆ†æ CPU é—®é¢˜, æ¯•ç«Ÿ iowait å·²ç»é«˜è¾¾ 94%, I/O é—®é¢˜æ‰æ˜¯éœ€è¦é¦–è¦è§£å†³çš„.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥åœ¨ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„ iostat å‘½ä»¤, å…¶ä¸­:")]),s._v(" "),a("ul",[a("li",[s._v("-d é€‰é¡¹æ˜¯æŒ‡æ˜¾ç¤ºå‡º I/O çš„æ€§èƒ½æŒ‡æ ‡;")]),s._v(" "),a("li",[s._v("-x é€‰é¡¹æ˜¯æŒ‡æ˜¾ç¤ºå‡ºæ‰©å±•ç»Ÿè®¡ä¿¡æ¯(å³æ˜¾ç¤ºæ‰€æœ‰ I/O æŒ‡æ ‡).")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ iostat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util \nloop0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" \nsda              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("71.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32912.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18118.31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("241.89")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("463.55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.86")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.40")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("å…·ä½“è§‚å¯Ÿ iostat çš„è¾“å‡º. å¯ä»¥å‘ç°, ç£ç›˜ sda çš„ "),a("strong",[s._v("I/O ä½¿ç”¨ç‡å·²ç»è¾¾åˆ° 98%")]),s._v(" , æ¥è¿‘é¥±å’Œäº†. è€Œä¸”, "),a("strong",[s._v("å†™è¯·æ±‚çš„å“åº”æ—¶é—´é«˜è¾¾ 18 ç§’, æ¯ç§’çš„å†™æ•°æ®ä¸º 32 MB")]),s._v(", æ˜¾ç„¶å†™ç£ç›˜ç¢°åˆ°äº†ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("é‚£è¦æ€ä¹ˆçŸ¥é“, è¿™äº› I/O è¯·æ±‚åˆ°åº•æ˜¯å“ªäº›è¿›ç¨‹å¯¼è‡´çš„å‘¢? å¯ä»¥ä½¿ç”¨ pidstat. åœ¨ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„ pidstat å‘½ä»¤, è§‚å¯Ÿè¿›ç¨‹çš„ I/O æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":39:14      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":39:15        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("335716.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  python \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä» pidstat çš„è¾“å‡º, å†æ¬¡çœ‹åˆ°äº† PID å·ä¸º 12280 çš„ç»“æœ. è¿™è¯´æ˜, æ­£æ˜¯æ¡ˆä¾‹åº”ç”¨å¼•å‘ I/O çš„æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("èµ°åˆ°è¿™ä¸€æ­¥, ä½ ä¼°è®¡è§‰å¾—, æ¥ä¸‹æ¥å°±å¾ˆç®€å•äº†, ä¸Šä¸€ä¸ªæ¡ˆä¾‹ä¸åˆšåˆšå­¦è¿‡å—? æ— éå°±æ˜¯, å…ˆç”¨ strace ç¡®è®¤å®ƒæ˜¯ä¸æ˜¯åœ¨å†™æ–‡ä»¶, å†ç”¨ lsof æ‰¾å‡ºæ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„æ–‡ä»¶å³å¯.")]),s._v(" "),a("p",[s._v("åˆ°åº•æ˜¯ä¸æ˜¯è¿™æ ·å‘¢? ä¸å¦¨æ¥è¯•è¯•. è¿˜æ˜¯åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„ strace å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v(" \nstrace: Process "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v(" attached \nselect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", NULL, NULL, NULL, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("tv_sec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tv_usec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("567708")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Timeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nstat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/lib/python3.7/importlib/_bootstrap.py"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("st_mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("S_IFREG"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("0644, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("st_size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39278")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nstat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/lib/python3.7/importlib/_bootstrap.py"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("st_mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("S_IFREG"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("0644, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("st_size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39278")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä» strace ä¸­, å¯ä»¥çœ‹åˆ°å¤§é‡çš„ stat ç³»ç»Ÿè°ƒç”¨, å¹¶ä¸”å¤§éƒ½ä¸º python çš„æ–‡ä»¶, ä½†è¯·æ³¨æ„, è¿™é‡Œ"),a("strong",[s._v("å¹¶æ²¡æœ‰ä»»ä½• write ç³»ç»Ÿè°ƒç”¨")]),s._v(".")]),s._v(" "),a("p",[s._v("ç”±äº strace çš„è¾“å‡ºæ¯”è¾ƒå¤š, å¯ä»¥ç”¨ grep, æ¥è¿‡æ»¤ä¸€ä¸‹ write, æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("é—æ†¾çš„æ˜¯, è¿™é‡Œä»ç„¶æ²¡æœ‰ä»»ä½•è¾“å‡º.")]),s._v(" "),a("p",[s._v("éš¾é“æ­¤æ—¶å·²ç»æ²¡æœ‰æ€§èƒ½é—®é¢˜äº†å—? é‡æ–°æ‰§è¡Œåˆšæ‰çš„ top å’Œ iostat å‘½ä»¤, ä¼šå‘ç°æ€§èƒ½é—®é¢˜ä»ç„¶å­˜åœ¨.")]),s._v(" "),a("p",[s._v("ä¸‹é¢åªå¥½ç»¼åˆ strace, pidstat å’Œ iostat è¿™ä¸‰ä¸ªç»“æœæ¥åˆ†æäº†. å¾ˆæ˜æ˜¾, ä½ åº”è¯¥å‘ç°äº†è¿™é‡Œçš„çŸ›ç›¾: iostat å·²ç»è¯æ˜ç£ç›˜ I/O æœ‰æ€§èƒ½ç“¶é¢ˆ, è€Œ pidstat ä¹Ÿè¯æ˜äº†, è¿™ä¸ªç“¶é¢ˆæ˜¯ç”± 12280 å·è¿›ç¨‹å¯¼è‡´çš„, ä½† strace è·Ÿè¸ªè¿™ä¸ªè¿›ç¨‹, å´æ²¡æœ‰æ‰¾åˆ°ä»»ä½• write ç³»ç»Ÿè°ƒç”¨.")]),s._v(" "),a("p",[s._v("è¿™å°±å¥‡æ€ªäº†. éš¾é“å› ä¸ºæ¡ˆä¾‹ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€æ˜¯ Python, è€Œ Python æ˜¯è§£é‡Šå‹çš„, æ‰€ä»¥æ‰¾ä¸åˆ°? è¿˜æ˜¯è¯´, å› ä¸ºæ¡ˆä¾‹è¿è¡Œåœ¨ Docker ä¸­å‘¢?")]),s._v(" "),a("p",[s._v("æ–‡ä»¶å†™, æ˜æ˜åº”è¯¥æœ‰ç›¸åº”çš„ write ç³»ç»Ÿè°ƒç”¨, ä½†ç”¨ç°æœ‰å·¥å…·å´æ‰¾ä¸åˆ°ç—•è¿¹, è¿™æ—¶å°±è¯¥æƒ³æƒ³æ¢å·¥å…·çš„é—®é¢˜äº†. æ€æ ·æ‰èƒ½çŸ¥é“å“ªé‡Œåœ¨å†™æ–‡ä»¶å‘¢?")]),s._v(" "),a("p",[s._v("è¿™é‡Œä»‹ç»ä¸€ä¸ªæ–°å·¥å…·, "),a("strong",[s._v("filetop")]),s._v(". å®ƒæ˜¯ bcc è½¯ä»¶åŒ…çš„ä¸€éƒ¨åˆ†, åŸºäº Linux å†…æ ¸çš„ eBPF(extended Berkeley Packet Filters)æœºåˆ¶, ä¸»è¦"),a("strong",[s._v("è·Ÿè¸ªå†…æ ¸ä¸­æ–‡ä»¶çš„è¯»å†™æƒ…å†µ, å¹¶è¾“å‡ºçº¿ç¨‹ ID(TID), è¯»å†™å¤§å°, è¯»å†™ç±»å‹ä»¥åŠæ–‡ä»¶åç§°")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±ç”¨è¿™ä¸ªå·¥å…·, è§‚å¯Ÿä¸€ä¸‹æ–‡ä»¶çš„è¯»å†™æƒ…å†µ. é¦–å…ˆ, åœ¨ç»ˆç«¯ä¸€ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ‡æ¢åˆ°å·¥å…·ç›®å½• ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/bcc/tools \n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -C é€‰é¡¹è¡¨ç¤ºè¾“å‡ºæ–°å†…å®¹æ—¶ä¸æ¸…ç©ºå±å¹• ")]),s._v("\n$ ./filetop "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" \n \nTID    COMM             READS  WRITES R_Kb    W_Kb    T FILE \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2832")]),s._v("    R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("669")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2490")]),s._v("    R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("667")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2685")]),s._v("    R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("671")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2392")]),s._v("    R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("670")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2050")]),s._v("    R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("672")]),s._v(".txt \n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \nTID    COMM             READS  WRITES R_Kb    W_Kb    T FILE \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5957")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("651")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5371")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("112")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4785")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("861")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4736")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("213")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("    python           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4443")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(".txt \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("ä½ ä¼šçœ‹åˆ°, filetop è¾“å‡ºäº† 8 åˆ—å†…å®¹, åˆ†åˆ«æ˜¯"),a("strong",[s._v("çº¿ç¨‹ ID, çº¿ç¨‹å‘½ä»¤è¡Œ, è¯»å†™æ¬¡æ•°, è¯»å†™çš„å¤§å°(å•ä½ KB), æ–‡ä»¶ç±»å‹ä»¥åŠè¯»å†™çš„æ–‡ä»¶åç§°")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™äº›å†…å®¹é‡Œ, å¯èƒ½ä¼šçœ‹åˆ°å¾ˆå¤šåŠ¨æ€é“¾æ¥åº“, ä¸è¿‡è¿™ä¸æ˜¯é‡ç‚¹, æš‚ä¸”å¿½ç•¥å³å¯. æˆ‘ä»¬çš„é‡ç‚¹, æ˜¯ä¸€ä¸ª python åº”ç”¨, æ‰€ä»¥è¦ç‰¹åˆ«å…³æ³¨ python ç›¸å…³çš„å†…å®¹.")]),s._v(" "),a("p",[s._v("å¤šè§‚å¯Ÿä¸€ä¼šå„¿å°±ä¼šå‘ç°, æ¯éš”ä¸€æ®µæ—¶é—´, çº¿ç¨‹å·ä¸º 514 çš„ python åº”ç”¨å°±ä¼šå…ˆå†™å…¥å¤§é‡çš„ txt æ–‡ä»¶, å†å¤§é‡åœ°è¯».")]),s._v(" "),a("p",[s._v("çº¿ç¨‹å·ä¸º 514 çš„çº¿ç¨‹, å±äºå“ªä¸ªè¿›ç¨‹å‘¢? å¯ä»¥ç”¨ ps å‘½ä»¤æŸ¥çœ‹. å…ˆåœ¨ç»ˆç«¯ä¸€ä¸­åœæ­¢ filetop; ç„¶å, è¿è¡Œä¸‹é¢çš„ ps å‘½ä»¤. è¿™ä¸ªè¾“å‡ºçš„ç¬¬äºŒåˆ—å†…å®¹, å°±æ˜¯æƒ³çŸ¥é“çš„è¿›ç¨‹å·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-efT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("\nroot     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14626")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":47 pts/0    00:00:05 /usr/local/bin/python /app.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("è¿™ä¸ªçº¿ç¨‹æ­£æ˜¯æ¡ˆä¾‹åº”ç”¨ 12280 çš„çº¿ç¨‹. ç»ˆäºå¯ä»¥å…ˆæ¾ä¸€å£æ°”, ä¸è¿‡è¿˜æ²¡å®Œ, filetop åªç»™å‡ºäº†æ–‡ä»¶åç§°, å´æ²¡æœ‰æ–‡ä»¶è·¯å¾„, è¿˜å¾—ç»§ç»­æ‰¾å•Š.")]),s._v(" "),a("p",[s._v("å†ä»‹ç»ä¸€ä¸ªå¥½ç”¨çš„å·¥å…·, "),a("strong",[s._v("opensnoop")]),s._v(". å®ƒåŒå±äº bcc è½¯ä»¶åŒ…, å¯ä»¥"),a("strong",[s._v("åŠ¨æ€è·Ÿè¸ªå†…æ ¸ä¸­çš„ open ç³»ç»Ÿè°ƒç”¨")]),s._v(". è¿™æ ·å°±å¯ä»¥æ‰¾å‡ºè¿™äº› txt æ–‡ä»¶çš„è·¯å¾„.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, åœ¨ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„ opensnoop å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ opensnoop \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v("  python              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /tmp/9046db9e-fe25-11e8-b13f-0242ac110002/650.txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v("  python              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /tmp/9046db9e-fe25-11e8-b13f-0242ac110002/651.txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v("  python              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /tmp/9046db9e-fe25-11e8-b13f-0242ac110002/652.txt \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è¿™æ¬¡, é€šè¿‡ opensnoop çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°, è¿™äº› txt è·¯å¾„ä½äº "),a("code",[s._v("/tmp")]),s._v("â€‹ ç›®å½•ä¸‹. è¿˜èƒ½çœ‹åˆ°, å®ƒæ‰“å¼€çš„æ–‡ä»¶æ•°é‡, æŒ‰ç…§æ•°å­—ç¼–å·, ä» 0.txt ä¾æ¬¡å¢å¤§åˆ° 999.txt, è¿™å¯è¿œå¤šäºå‰é¢ç”¨ filetop çœ‹åˆ°çš„æ•°é‡.")]),s._v(" "),a("p",[s._v("ç»¼åˆ filetop å’Œ opensnoop, å°±å¯ä»¥è¿›ä¸€æ­¥åˆ†æäº†. è¿™é‡Œå¯ä»¥å¤§èƒ†çŒœæµ‹, æ¡ˆä¾‹åº”ç”¨åœ¨å†™å…¥ 1000 ä¸ª txt æ–‡ä»¶å, åˆæŠŠè¿™äº›å†…å®¹è¯»åˆ°å†…å­˜ä¸­è¿›è¡Œå¤„ç†. æ¥æ£€æŸ¥ä¸€ä¸‹, è¿™ä¸ªç›®å½•ä¸­æ˜¯ä¸æ˜¯çœŸçš„æœ‰ 1000 ä¸ªæ–‡ä»¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /tmp/9046db9e-fe25-11e8-b13f-0242ac110002 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" \nls: cannot access "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tmp/9046db9e-fe25-11e8-b13f-0242ac110002'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" No such "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æ“ä½œåå´å‘ç°, ç›®å½•å±…ç„¶ä¸å­˜åœ¨äº†. æ€ä¹ˆå›äº‹å‘¢? å›åˆ° opensnoop å†è§‚å¯Ÿä¸€ä¼šå„¿:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ opensnoop \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v("  python              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /tmp/defee970-fe25-11e8-b13f-0242ac110002/261.txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v("  python              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /tmp/defee970-fe25-11e8-b13f-0242ac110002/840.txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12280")]),s._v("  python              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /tmp/defee970-fe25-11e8-b13f-0242ac110002/136.txt \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("åŸæ¥, è¿™æ—¶çš„è·¯å¾„å·²ç»å˜æˆäº†å¦ä¸€ä¸ªç›®å½•. è¿™è¯´æ˜, è¿™äº›ç›®å½•éƒ½æ˜¯åº”ç”¨ç¨‹åºåŠ¨æ€ç”Ÿæˆçš„, ç”¨å®Œå°±åˆ äº†.")]),s._v(" "),a("p",[s._v("ç»“åˆå‰é¢çš„æ‰€æœ‰åˆ†æ, åŸºæœ¬å¯ä»¥åˆ¤æ–­, æ¡ˆä¾‹åº”ç”¨ä¼šåŠ¨æ€ç”Ÿæˆä¸€æ‰¹æ–‡ä»¶, ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®, ç”¨å®Œå°±ä¼šåˆ é™¤å®ƒä»¬. ä½†ä¸å¹¸çš„æ˜¯, "),a("strong",[s._v("æ­£æ˜¯è¿™äº›æ–‡ä»¶è¯»å†™, å¼•å‘äº† I/O çš„æ€§èƒ½ç“¶é¢ˆ, å¯¼è‡´æ•´ä¸ªå¤„ç†è¿‡ç¨‹éå¸¸æ…¢")]),s._v(".")]),s._v(" "),a("p",[s._v("å½“ç„¶è¿˜éœ€è¦éªŒè¯è¿™ä¸ªçŒœæƒ³. è€åŠæ³•, è¿˜æ˜¯æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„æºç  "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/blob/master/io-latency/app.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("app.py"),a("OutboundLink")],1),s._v(",")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("@app.route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/popularity/<word>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \ndef word_popularity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("word"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n  dir_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tmp/{}'")]),s._v(".format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uuid.uuid1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" \n  count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n  sample_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" \n   \n  def save_to_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_name, content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n    with open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_name, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'w'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as f: \n    f.write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n \n  try: \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# initial directory firstly ")]),s._v("\n    os.mkdir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# save article to files ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n        file_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{}/{}.txt'")]),s._v(".format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir_path, i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        article "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" generate_article"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        save_to_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_name, article"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# count word popularity ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" root, dirs, files "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" os.walk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("file_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" files: \n            with open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{}/{}'")]),s._v(".format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir_path, file_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" as f: \n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" validate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("word, f.read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(": \n                    count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n    finally: \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# clean files ")]),s._v("\n        shutil.rmtree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir_path, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ignore_errors")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("True"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" jsonify"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'popularity'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" count / sample_size * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'word'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" word"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("æºç ä¸­å¯ä»¥çœ‹åˆ°, è¿™ä¸ªæ¡ˆä¾‹åº”ç”¨, åœ¨æ¯ä¸ªè¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ä¸­, éƒ½ä¼šç”Ÿæˆä¸€æ‰¹ä¸´æ—¶æ–‡ä»¶, ç„¶åè¯»å…¥å†…å­˜å¤„ç†, æœ€åå†æŠŠæ•´ä¸ªç›®å½•åˆ é™¤æ‰.")]),s._v(" "),a("p",[s._v("è¿™æ˜¯"),a("strong",[s._v("ä¸€ç§å¸¸è§çš„åˆ©ç”¨ç£ç›˜ç©ºé—´å¤„ç†å¤§é‡æ•°æ®çš„æŠ€å·§, ä¸è¿‡æœ¬æ¬¡æ¡ˆä¾‹ä¸­çš„ I/O è¯·æ±‚å¤ªé‡, å¯¼è‡´ç£ç›˜ I/O åˆ©ç”¨ç‡è¿‡é«˜")]),s._v(".")]),s._v(" "),a("p",[s._v("è¦è§£å†³è¿™ä¸€ç‚¹, å…¶å®å°±æ˜¯ç®—æ³•ä¼˜åŒ–é—®é¢˜äº†. æ¯”å¦‚åœ¨å†…å­˜å……è¶³æ—¶, å°±å¯ä»¥æŠŠæ‰€æœ‰æ•°æ®éƒ½æ”¾åˆ°å†…å­˜ä¸­å¤„ç†, è¿™æ ·å°±èƒ½é¿å… I/O çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-4"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚åˆ†æäº†ä¸€ä¸ªå“åº”è¿‡æ…¢çš„å•è¯çƒ­åº¦æ¡ˆä¾‹.")]),s._v(" "),a("p",[s._v("é¦–å…ˆç”¨ top, iostat, åˆ†æäº†ç³»ç»Ÿçš„ CPU å’Œç£ç›˜ä½¿ç”¨æƒ…å†µ. å‘ç°äº†ç£ç›˜ I/O ç“¶é¢ˆ, ä¹ŸçŸ¥é“äº†è¿™ä¸ªç“¶é¢ˆæ˜¯æ¡ˆä¾‹åº”ç”¨å¯¼è‡´çš„.")]),s._v(" "),a("p",[s._v("æ¥ç€, è¯•ç€ç…§æ¬ä¸Šä¸€èŠ‚æ¡ˆä¾‹çš„æ–¹æ³•, ç”¨ strace æ¥è§‚å¯Ÿè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨, ä¸è¿‡è¿™æ¬¡å¾ˆä¸èµ°è¿, æ²¡æ‰¾åˆ°ä»»ä½• write ç³»ç»Ÿè°ƒç”¨.")]),s._v(" "),a("p",[s._v("äºæ˜¯, åˆç”¨äº†æ–°çš„å·¥å…·, å€ŸåŠ©åŠ¨æ€è¿½è¸ªå·¥å…·åŒ… bcc ä¸­çš„ filetop å’Œ opensnoop, æ‰¾å‡ºäº†æ¡ˆä¾‹åº”ç”¨çš„é—®é¢˜, å‘ç°è¿™ä¸ªæ ¹æºæ˜¯å¤§é‡è¯»å†™ä¸´æ—¶æ–‡ä»¶.")]),s._v(" "),a("p",[s._v("æ‰¾å‡ºé—®é¢˜å, ä¼˜åŒ–æ–¹æ³•å°±ç›¸å¯¹æ¯”è¾ƒç®€å•äº†. å¦‚æœå†…å­˜å……è¶³æ—¶, æœ€ç®€å•çš„æ–¹æ³•, å°±æ˜¯æŠŠæ•°æ®éƒ½æ”¾åœ¨é€Ÿåº¦æ›´å¿«çš„å†…å­˜ä¸­, è¿™æ ·å°±æ²¡æœ‰ç£ç›˜ I/O çš„ç“¶é¢ˆäº†. å†è¿›ä¸€æ­¥, å¯ä»¥è¿˜å¯ä»¥åˆ©ç”¨ Trie æ ‘ç­‰å„ç§ç®—æ³•, è¿›ä¸€æ­¥ä¼˜åŒ–å•è¯å¤„ç†çš„æ•ˆç‡.")]),s._v(" "),a("h4",{attrs:{id:"_28-æ¡ˆä¾‹ç¯‡-ä¸€ä¸ªsqlæŸ¥è¯¢è¦15ç§’-è¿™æ˜¯æ€ä¹ˆå›äº‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_28-æ¡ˆä¾‹ç¯‡-ä¸€ä¸ªsqlæŸ¥è¯¢è¦15ç§’-è¿™æ˜¯æ€ä¹ˆå›äº‹"}},[s._v("#")]),s._v(" 28-æ¡ˆä¾‹ç¯‡:ä¸€ä¸ªSQLæŸ¥è¯¢è¦15ç§’,è¿™æ˜¯æ€ä¹ˆå›äº‹?")]),s._v(" "),a("p",[s._v("åœ¨å®é™…åº”ç”¨ä¸­, å¤§é‡æ•°æ®è‚¯å®šæ˜¯è¦å­˜å…¥æ•°æ®åº“çš„, è€Œä¸ä¼šç›´æ¥ç”¨æ–‡æœ¬æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨. ä¸è¿‡, æ•°æ®åº“ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„. "),a("strong",[s._v("å½“æ•°æ®åº“å‡ºç°æ€§èƒ½é—®é¢˜æ—¶, åˆè¯¥å¦‚ä½•åˆ†æå’Œå®šä½å®ƒçš„ç“¶é¢ˆå‘¢")]),s._v("?")]),s._v(" "),a("p",[s._v("ä»Šå¤©å°±æ¥ä¸€èµ·åˆ†æä¸€ä¸ªæ•°æ®åº“çš„æ¡ˆä¾‹. è¿™æ˜¯ä¸€ä¸ªåŸºäº Python Flask çš„å•†å“æœç´¢åº”ç”¨, å•†å“ä¿¡æ¯å­˜åœ¨ MySQL ä¸­. è¿™ä¸ªåº”ç”¨å¯ä»¥é€šè¿‡ MySQL æ¥å£, æ ¹æ®å®¢æˆ·ç«¯æä¾›çš„å•†å“åç§°, å»æ•°æ®åº“è¡¨ä¸­æŸ¥è¯¢å•†å“ä¿¡æ¯.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹å‡†å¤‡-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹å‡†å¤‡-3"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sysstat, git, make ç­‰å·¥å…·, å¦‚ apt install docker.io sysstat make git")])]),s._v(" "),a("p",[s._v("å…¶ä¸­, docker å’Œ sysstat å·²ç»ç”¨è¿‡å¾ˆå¤šæ¬¡, è¿™é‡Œä¸å†èµ˜è¿°; make æ˜¯ä¸€ä¸ªå¸¸ç”¨æ„å»ºå·¥å…·, è¿™é‡Œç”¨æ¥è¿è¡Œä»Šå¤©çš„æ¡ˆä¾‹.")]),s._v(" "),a("p",[s._v("æ¡ˆä¾‹æ€»å…±ç”±ä¸‰ä¸ªå®¹å™¨ç»„æˆ, åŒ…æ‹¬ä¸€ä¸ª MySQL æ•°æ®åº“åº”ç”¨, ä¸€ä¸ªå•†å“æœç´¢åº”ç”¨ä»¥åŠä¸€ä¸ªæ•°æ®å¤„ç†çš„åº”ç”¨. å…¶ä¸­, å•†å“æœç´¢åº”ç”¨ä»¥ HTTP çš„å½¢å¼æä¾›äº†ä¸€ä¸ªæ¥å£:")]),s._v(" "),a("ul",[a("li",[s._v("â€‹"),a("code",[s._v("/")]),s._v("â€‹: è¿”å› Index Page;")]),s._v(" "),a("li",[s._v("â€‹"),a("code",[s._v("/db/insert/products/")]),s._v("â€‹: æ’å…¥æŒ‡å®šæ•°é‡çš„å•†å“ä¿¡æ¯;")]),s._v(" "),a("li",[s._v("â€‹"),a("code",[s._v("/products/")]),s._v("â€‹: æŸ¥è¯¢æŒ‡å®šå•†å“çš„ä¿¡æ¯, å¹¶è¿”å›å¤„ç†æ—¶é—´.")])]),s._v(" "),a("p",[s._v("ç”±äºåº”ç”¨æ¯”è¾ƒå¤š, ä¸ºäº†æ–¹ä¾¿è¿è¡Œå®ƒä»¬, æˆ‘æŠŠå®ƒä»¬åŒæ ·æ‰“åŒ…æˆäº†å‡ ä¸ª Docker é•œåƒ, å¹¶æ¨é€åˆ°äº† Github ä¸Š. è¿™æ ·åªéœ€è¦è¿è¡Œå‡ æ¡å‘½ä»¤, å°±å¯ä»¥å¯åŠ¨äº†.")]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹éœ€è¦ä¸¤å°è™šæ‹Ÿæœº, å…¶ä¸­ä¸€å°ä½œä¸ºæ¡ˆä¾‹åˆ†æçš„ç›®æ ‡æœºå™¨, è¿è¡Œ Flask åº”ç”¨, å®ƒçš„ IP åœ°å€æ˜¯ 192.168.0.10; å¦ä¸€å°åˆ™æ˜¯ä½œä¸ºå®¢æˆ·ç«¯, è¯·æ±‚å•è¯çš„çƒ­åº¦. ä¸‹é¢ç”»äº†ä¸€å¼ å›¾è¡¨ç¤ºå®ƒä»¬çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/6c9bad4d1e112263d8b3459116aed056-20230731161933-tbjfe7d.png",alt:""}})]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯, åˆ†åˆ« SSH ç™»å½•åˆ°è¿™ä¸¤å°è™šæ‹Ÿæœºä¸­, å¹¶åœ¨ç¬¬ä¸€å°è™šæ‹Ÿæœºä¸­å®‰è£…ä¸Šè¿°å·¥å…·.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ-5"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢å‘½ä»¤, æ‹‰å–æœ¬æ¬¡æ¡ˆä¾‹æ‰€éœ€è„šæœ¬:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/feiskyer/linux-perf-examples\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" linux-perf-examples/mysql-slow\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ç€, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, è¿è¡Œæœ¬æ¬¡çš„ç›®æ ‡åº”ç”¨. æ­£å¸¸æƒ…å†µä¸‹, åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ³¨æ„ä¸‹é¢çš„éšæœºå­—ç¬¦ä¸²æ˜¯å®¹å™¨ ID, æ¯æ¬¡è¿è¡Œå‡ä¼šä¸åŒ, å¹¶ä¸”ä½ ä¸éœ€è¦å…³æ³¨å®ƒ, å› ä¸ºæˆ‘ä»¬åªä¼šç”¨åˆ°åå­—")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" run\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" 800m feisky/mysql:5.6\nWARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.\n4156780da5be0b9026bcf27a3fa56abc15b8408e358fa327f472bcc5add4453f\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dataservice "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" feisky/mysql-dataservice\nf724d0816d7e47c0b2b1ff701e9a39239cb9b5ce70f597764c793b68131122bb\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("container:mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/mysql-slow\n81d3392ba25bb8436f6151662a13ff6182b6bc6f2a559fc2e9d873cd07224ab6\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ç„¶å, å†è¿è¡Œ docker ps å‘½ä»¤, ç¡®è®¤ä¸‰ä¸ªå®¹å™¨éƒ½å¤„åœ¨è¿è¡Œ(Up)çŠ¶æ€:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                             NAMES\n9a4e3c580963        feisky/mysql-slow          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python /app.py"')]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v(" seconds                                         app\n2a47aab18082        feisky/mysql-dataservice   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python /dataserviceâ€¦"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(" seconds                                         dataservice\n4c3ff7b24748        feisky/mysql:5.6           "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.sâ€¦"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" seconds       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:10000-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("MySQL æ•°æ®åº“çš„å¯åŠ¨è¿‡ç¨‹, éœ€è¦åšä¸€äº›åˆå§‹åŒ–å·¥ä½œ, è¿™é€šå¸¸éœ€è¦èŠ±è´¹å‡ åˆ†é’Ÿæ—¶é—´. å¯ä»¥è¿è¡Œ docker logs å‘½ä»¤, æŸ¥çœ‹å®ƒçš„å¯åŠ¨è¿‡ç¨‹.")]),s._v(" "),a("p",[s._v("å½“çœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡ºæ—¶, è¯´æ˜ MySQL åˆå§‹åŒ–å®Œæˆ, å¯ä»¥æ¥æ”¶å¤–éƒ¨è¯·æ±‚äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" mysqld: ready "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" connections.\nVersion: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'5.6.42-log'")]),s._v("  socket: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/var/run/mysqld/mysqld.sock'")]),s._v("  port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("  MySQL Community Server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è€Œå•†å“æœç´¢åº”ç”¨åˆ™æ˜¯åœ¨ 10000 ç«¯å£ç›‘å¬. ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, ç¡®è®¤å®ƒä¹Ÿå·²ç»æ­£å¸¸è¿è¡Œ. å¦‚æœä¸€åˆ‡æ­£å¸¸, ä¼šçœ‹åˆ° Index Page çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://127.0.0.1:10000/\nIndex Page\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥, è¿è¡Œ make init å‘½ä»¤, åˆå§‹åŒ–æ•°æ®åº“, å¹¶æ’å…¥ 10000 æ¡å•†å“ä¿¡æ¯. è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒæ…¢, æ¯”å¦‚åœ¨æˆ‘çš„æœºå™¨ä¸­, å°±èŠ±äº†åå‡ åˆ†é’Ÿæ—¶é—´. è€å¿ƒç­‰å¾…ä¸€æ®µæ—¶é—´å, ä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" init\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uroot")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P3306")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" tables.sql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://127.0.0.1:10000/db/insert/products/10000\ninsert "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" lines\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ¥ç€åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªç»ˆç«¯, è®¿é—®ä¸€ä¸‹å•†å“æœç´¢çš„æ¥å£, çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°æƒ³è¦çš„å•†å“. æ‰§è¡Œå¦‚ä¸‹çš„ curl å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/products/geektime\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.364538192749023")]),s._v(" sec\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç¨ç­‰ä¸€ä¼šå„¿, ä½ ä¼šå‘ç°, è¿™ä¸ªæ¥å£è¿”å›çš„æ˜¯ç©ºæ•°æ®, è€Œä¸”å¤„ç†æ—¶é—´è¶…è¿‡ 15 ç§’. è¿™ä¹ˆæ…¢çš„å“åº”é€Ÿåº¦è®©äººæ— æ³•å¿å—, åˆ°åº•å‡ºäº†ä»€ä¹ˆé—®é¢˜å‘¢?")]),s._v(" "),a("p",[s._v("æ—¢ç„¶ä»Šå¤©ç”¨äº† MySQL, ä½ ä¼°è®¡ä¼šçŒœåˆ°æ˜¯"),a("strong",[s._v("æ…¢æŸ¥è¯¢")]),s._v("çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("ä¸è¿‡åˆ«æ€¥, åœ¨å…·ä½“åˆ†æå‰, ä¸ºäº†é¿å…åœ¨åˆ†æè¿‡ç¨‹ä¸­å®¢æˆ·ç«¯çš„è¯·æ±‚ç»“æŸ, æŠŠ curl å‘½ä»¤æ”¾åˆ°ä¸€ä¸ªå¾ªç¯é‡Œæ‰§è¡Œ. åŒæ—¶, ä¸ºäº†é¿å…ç»™ç³»ç»Ÿè¿‡å¤§å‹åŠ›, è®¾ç½®åœ¨æ¯æ¬¡æŸ¥è¯¢å, éƒ½å…ˆç­‰å¾… 5 ç§’, ç„¶åå†å¼€å§‹æ–°çš„è¯·æ±‚. æ‰€ä»¥å¯ä»¥åœ¨ç»ˆç«¯äºŒä¸­, ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/products/geektime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥, é‡æ–°å›åˆ°ç»ˆç«¯ä¸€ä¸­, åˆ†ææ¥å£å“åº”é€Ÿåº¦æ…¢çš„åŸå› . ä¸è¿‡, é‡å›ç»ˆç«¯ä¸€å, ä¼šå‘ç°ç³»ç»Ÿå“åº”ä¹Ÿæ˜æ˜¾å˜æ…¢äº†, éšä¾¿æ‰§è¡Œä¸€ä¸ªå‘½ä»¤, éƒ½å¾—åœé¡¿ä¸€ä¼šå„¿æ‰èƒ½çœ‹åˆ°è¾“å‡º.")]),s._v(" "),a("p",[s._v("è¿™è·Ÿä¸Šä¸€èŠ‚çš„ç°è±¡å¾ˆç±»ä¼¼, çœ‹æ¥è¿˜æ˜¯å¾—"),a("strong",[s._v("è§‚å¯Ÿä¸€ä¸‹ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µ, æ¯”å¦‚ CPU, å†…å­˜å’Œç£ç›˜ I/O ç­‰çš„æƒ…å†µ")]),s._v(".")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç»ˆç«¯ä¸€æ‰§è¡Œ top å‘½ä»¤, åˆ†æç³»ç»Ÿçš„ CPU ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":02:15 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" days,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":05,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.66")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.72")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.59")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.9")]),s._v(" id, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62.1")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84.7")]),s._v(" id, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.3")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169300")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7238472")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("546132")]),s._v(" used,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("384696")]),s._v(" buff/cache\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7316952")]),s._v(" avail Mem\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27458")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("999")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("833852")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57968")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13176")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":12.40 mysqld\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27617")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24348")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9216")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4692")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":04.40 python\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1549")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("236716")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24568")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9864")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(":46.57 python3\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22421")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":01.16 kworker/u\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ top çš„è¾“å‡º, å‘ç°ä¸¤ä¸ª "),a("strong",[s._v("CPU çš„ iowait éƒ½æ¯”è¾ƒé«˜")]),s._v(", ç‰¹åˆ«æ˜¯ CPU0, iowait å·²ç»è¶…è¿‡ 60%. è€Œå…·ä½“åˆ°å„ä¸ªè¿›ç¨‹, CPU ä½¿ç”¨ç‡å¹¶ä¸é«˜, æœ€é«˜çš„ä¹Ÿåªæœ‰ 1.7%.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶ CPU çš„å«Œç–‘ä¸å¤§, é‚£é—®é¢˜åº”è¯¥è¿˜æ˜¯å‡ºåœ¨äº† I/O ä¸Š. ä»ç„¶åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯, æ‰§è¡Œä¸‹é¢çš„ iostat å‘½ä»¤, çœ‹çœ‹æœ‰æ²¡æœ‰ I/O æ€§èƒ½é—®é¢˜:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ iostat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nsda            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("273.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32568.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.90")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.16")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("119.30")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.56")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.20")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("iostat çš„è¾“å‡ºä½ åº”è¯¥éå¸¸ç†Ÿæ‚‰. è§‚å¯Ÿè¿™ä¸ªç•Œé¢, å¯ä»¥å‘ç°, "),a("strong",[s._v("ç£ç›˜ sda æ¯ç§’çš„è¯»æ•°æ®ä¸º 32 MB,  è€Œ I/O ä½¿ç”¨ç‡é«˜è¾¾ 97%, æ¥è¿‘é¥±å’Œ")]),s._v(", è¿™è¯´æ˜ç£ç›˜ sda çš„è¯»å–ç¡®å®ç¢°åˆ°äº†æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("é‚£è¦æ€ä¹ˆçŸ¥é“, è¿™äº› I/O è¯·æ±‚åˆ°åº•æ˜¯å“ªäº›è¿›ç¨‹å¯¼è‡´çš„å‘¢? å½“ç„¶å¯ä»¥ä½¿ç”¨ pidstat. æ¥ä¸‹æ¥, åœ¨ç»ˆç«¯ä¸€ä¸­è¿è¡Œä¸‹é¢çš„ pidstat å‘½ä»¤, è§‚å¯Ÿè¿›ç¨‹çš„ I/O æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d é€‰é¡¹è¡¨ç¤ºå±•ç¤ºè¿›ç¨‹çš„ I/O æƒ…å†µ")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":04:11      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":04:12      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("999")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27458")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32640.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  mysqld\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":04:12        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27617")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  python\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":04:12        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27864")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  systemd-journal\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ä» pidstat çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°, PID ä¸º 27458 çš„ mysqld è¿›ç¨‹æ­£åœ¨è¿›è¡Œå¤§é‡çš„è¯», è€Œä¸”è¯»å–é€Ÿåº¦æ˜¯ 32 MB/s, è·Ÿåˆšæ‰ iostat çš„å‘ç°ä¸€è‡´. ä¸¤ä¸ªç»“æœä¸€å¯¹æ¯”, è‡ªç„¶å°±æ‰¾åˆ°äº†"),a("strong",[s._v("ç£ç›˜ I/O ç“¶é¢ˆçš„æ ¹æº, å³ mysqld è¿›ç¨‹")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™äº‹å„¿è¿˜æ²¡å®Œ. æˆ‘ä»¬è‡ªç„¶è¦æ€€ç–‘ä¸€ä¸‹, ä¸ºä»€ä¹ˆ mysqld ä¼šå»è¯»å–å¤§é‡çš„ç£ç›˜æ•°æ®å‘¢? æŒ‰ç…§å‰é¢çŒœæµ‹, è¿™æœ‰å¯èƒ½æ˜¯ä¸ªæ…¢æŸ¥è¯¢é—®é¢˜.")]),s._v(" "),a("p",[s._v("å¯æ˜¯, å›æƒ³ä¸€ä¸‹, æ…¢æŸ¥è¯¢çš„ç°è±¡å¤§å¤šæ˜¯ CPU ä½¿ç”¨ç‡é«˜(æ¯”å¦‚ 100% ), ä½†è¿™é‡Œçœ‹åˆ°çš„å´æ˜¯ I/O é—®é¢˜. çœ‹æ¥, è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå•çº¯çš„æ…¢æŸ¥è¯¢é—®é¢˜, æ‰€ä»¥æœ‰å¿…è¦åˆ†æä¸€ä¸‹ MySQL è¯»å–çš„æ•°æ®.")]),s._v(" "),a("p",[s._v("è¦åˆ†æè¿›ç¨‹çš„æ•°æ®è¯»å–, å½“ç„¶è¿˜è¦é ä¸Šä¸€èŠ‚ç”¨åˆ°è¿‡çš„ "),a("strong",[s._v("strace + lsof")]),s._v(" ç»„åˆ.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, è¿˜æ˜¯åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œ strace å‘½ä»¤, å¹¶ä¸”æŒ‡å®š mysqld çš„è¿›ç¨‹å· 27458. MySQL æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹çš„æ•°æ®åº“åº”ç”¨, ä¸ºäº†ä¸æ¼æ‰è¿™äº›çº¿ç¨‹çš„æ•°æ®è¯»å–æƒ…å†µ, è¦è®°å¾—åœ¨æ‰§è¡Œ stace å‘½ä»¤æ—¶, åŠ ä¸Š -f å‚æ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27458")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28014")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"934EiwT363aak7VtqF1mHGa4LL4Dhbks"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28014")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hSs7KBDepBqA6m4ce6i6iUfFTeG9Ot9z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20480")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20480")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28014")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NRhRjCSsLLBjTfdqiBRLvN9K6FRfqqLm"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28014")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AKgsik4BilLb7y6OkwQUjjqGeCTQTaRl"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24576")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24576")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28014")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hFMHx7FzUSqfFI22fQxWCpSnDmRjamaW"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28014")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ajUzLmKqivcDJSkiw7QWf2ETLgvQIpfC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20480")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20480")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿä¸€ä¼šå„¿ä¼šå‘ç°, çº¿ç¨‹ 28014 æ­£åœ¨è¯»å–å¤§é‡æ•°æ®, ä¸”è¯»å–æ–‡ä»¶çš„æè¿°ç¬¦ç¼–å·ä¸º 38. è¿™å„¿çš„ 38 åˆå¯¹åº”ç€å“ªä¸ªæ–‡ä»¶å‘¢? å¯ä»¥æ‰§è¡Œä¸‹é¢çš„ lsof å‘½ä»¤, å¹¶ä¸”æŒ‡å®šçº¿ç¨‹å· 28014, å…·ä½“æŸ¥çœ‹è¿™ä¸ªå¯ç–‘çº¿ç¨‹å’Œå¯ç–‘æ–‡ä»¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28014")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å¥‡æ€ªçš„æ˜¯, lsof å¹¶æ²¡æœ‰ç»™å‡ºä»»ä½•è¾“å‡º. å®é™…ä¸Š, å¦‚æœæŸ¥çœ‹ lsof å‘½ä»¤çš„è¿”å›å€¼, å°±ä¼šå‘ç°, è¿™ä¸ªå‘½ä»¤çš„"),a("strong",[s._v("æ‰§è¡Œå¤±è´¥")]),s._v("äº†.")]),s._v(" "),a("p",[s._v("åœ¨ SHELL ä¸­, ç‰¹æ®Šæ ‡é‡ "),a("code",[s._v("$?")]),s._v("â€‹ è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤é€€å‡ºæ—¶çš„è¿”å›å€¼. æŸ¥çœ‹è¿™ä¸ªç‰¹æ®Šæ ‡é‡, ä¼šå‘ç°å®ƒçš„è¿”å›å€¼æ˜¯ 1. å¯æ˜¯åˆ«å¿˜äº†, åœ¨ Linux ä¸­, è¿”å›å€¼ä¸º 0, æ‰è¡¨ç¤ºå‘½ä»¤æ‰§è¡ŒæˆåŠŸ. è¿”å›å€¼ä¸º 1, æ˜¾ç„¶è¡¨æ˜æ‰§è¡Œå¤±è´¥.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ä¸ºä»€ä¹ˆ lsof å‘½ä»¤æ‰§è¡Œå¤±è´¥äº†å‘¢? è¿™é‡Œå…ˆæš‚åœå¾€ä¸‹, è‡ªå·±å…ˆæ€è€ƒä¸€ä¸‹åŸå› . é‡åˆ°ç°è±¡è§£é‡Šä¸äº†, å…ˆå»æŸ¥æŸ¥å·¥å…·æ–‡æ¡£.")]),s._v(" "),a("p",[s._v('äº‹å®ä¸Š, é€šè¿‡æŸ¥è¯¢ lsof çš„æ–‡æ¡£, ä½ ä¼šå‘ç°, -p å‚æ•°éœ€è¦æŒ‡å®šè¿›ç¨‹å·, è€Œåˆšæ‰ä¼ å…¥çš„æ˜¯çº¿ç¨‹å·, æ‰€ä»¥ lsof å¤±è´¥äº†. å› æ­¤, ä»»ä½•ä¸€ä¸ªç»†èŠ‚éƒ½å¯èƒ½æˆä¸ºæ€§èƒ½åˆ†æçš„"æ‹¦è·¯è™".')]),s._v(" "),a("p",[s._v("å›è¿‡å¤´çœ‹, mysqld çš„è¿›ç¨‹å·æ˜¯ 27458, è€Œ 28014 åªæ˜¯å®ƒçš„ä¸€ä¸ªçº¿ç¨‹. è€Œä¸”, å¦‚æœè§‚å¯Ÿä¸€ä¸‹ mysqld è¿›ç¨‹çš„çº¿ç¨‹, ä¼šå‘ç° mysqld å…¶å®è¿˜æœ‰å¾ˆå¤šæ­£åœ¨è¿è¡Œçš„å…¶ä»–çº¿ç¨‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t è¡¨ç¤ºæ˜¾ç¤ºçº¿ç¨‹, -a è¡¨ç¤ºæ˜¾ç¤ºå‘½ä»¤è¡Œå‚æ•°")]),s._v("\n$ pstree "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27458")]),s._v("\nmysqld,27458 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log_bin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sync_binlog")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  â”œâ”€"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",27922\n  â”œâ”€"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",27923\n  â””â”€"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",28014\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("æ‰¾åˆ°äº†åŸå› , lsof çš„é—®é¢˜å°±å®¹æ˜“è§£å†³äº†. æŠŠçº¿ç¨‹å·æ¢æˆè¿›ç¨‹å·, ç»§ç»­æ‰§è¡Œ lsof å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27458")]),s._v("\nCOMMAND  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("   FD   TYPE DEVICE SIZE/OFF NODE NAME\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nâ€‹mysqld  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27458")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("999")]),s._v("   38u   REG    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8,1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512440000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2601895")]),s._v(" /var/lib/mysql/test/products.MYD\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è¿™æ¬¡å¾—åˆ°äº† lsof çš„è¾“å‡º. ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, mysqld è¿›ç¨‹ç¡®å®æ‰“å¼€äº†å¤§é‡æ–‡ä»¶, è€Œæ ¹æ®æ–‡ä»¶æè¿°ç¬¦(FD)çš„ç¼–å·å¯ä»¥çŸ¥é“, æè¿°ç¬¦ä¸º 38 çš„æ˜¯ä¸€ä¸ªè·¯å¾„ä¸º "),a("code",[s._v("/var/lib/mysql/test/products.MYD")]),s._v("â€‹ çš„æ–‡ä»¶. è¿™é‡Œæ³¨æ„, 38 åé¢çš„ u è¡¨ç¤º mysqld ä»¥è¯»å†™çš„æ–¹å¼è®¿é—®æ–‡ä»¶.")]),s._v(" "),a("p",[s._v("çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶, ç†Ÿæ‚‰ MySQL çš„ä½ å¯èƒ½ç¬‘äº†:")]),s._v(" "),a("ul",[a("li",[s._v("MYD æ–‡ä»¶, æ˜¯ MyISAM å¼•æ“ç”¨æ¥å­˜å‚¨"),a("strong",[s._v("è¡¨æ•°æ®")]),s._v("çš„æ–‡ä»¶;")]),s._v(" "),a("li",[s._v("æ–‡ä»¶åå°±æ˜¯æ•°æ®è¡¨çš„åå­—;")]),s._v(" "),a("li",[s._v("è€Œè¿™ä¸ªæ–‡ä»¶çš„çˆ¶ç›®å½•, ä¹Ÿå°±æ˜¯æ•°æ®åº“çš„åå­—.")])]),s._v(" "),a("p",[s._v("æ¢å¥è¯è¯´, è¿™ä¸ªæ–‡ä»¶å‘Šè¯‰æˆ‘ä»¬, mysqld åœ¨è¯»å–æ•°æ®åº“ test ä¸­çš„ products è¡¨.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹ mysqld åœ¨ç®¡ç†æ•°æ®åº“ test æ—¶çš„å­˜å‚¨æ–‡ä»¶. ä¸è¿‡è¦æ³¨æ„, ç”±äº MySQL è¿è¡Œåœ¨å®¹å™¨ä¸­, éœ€è¦é€šè¿‡ docker exec åˆ°å®¹å™¨ä¸­æŸ¥çœ‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mysql "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /var/lib/mysql/test/\ndb.opt    products.MYD  products.MYI  products.frm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥å‘ç°, "),a("code",[s._v("/var/lib/mysql/test/")]),s._v("â€‹ ç›®å½•ä¸­æœ‰å››ä¸ªæ–‡ä»¶, æ¯ä¸ªæ–‡ä»¶çš„ä½œç”¨åˆ†åˆ«æ˜¯:")]),s._v(" "),a("ul",[a("li",[s._v("MYD æ–‡ä»¶ç”¨æ¥å­˜å‚¨è¡¨çš„æ•°æ®;")]),s._v(" "),a("li",[s._v("MYI æ–‡ä»¶ç”¨æ¥å­˜å‚¨è¡¨çš„ç´¢å¼•;")]),s._v(" "),a("li",[s._v("frm æ–‡ä»¶ç”¨æ¥å­˜å‚¨è¡¨çš„å…ƒä¿¡æ¯(æ¯”å¦‚è¡¨ç»“æ„);")]),s._v(" "),a("li",[s._v("opt æ–‡ä»¶åˆ™ç”¨æ¥å­˜å‚¨æ•°æ®åº“çš„å…ƒä¿¡æ¯(æ¯”å¦‚å­—ç¬¦é›†, å­—ç¬¦æ ¡éªŒè§„åˆ™ç­‰).")])]),s._v(" "),a("p",[s._v("å½“ç„¶, çœ‹åˆ°è¿™äº›, ä½ å¯èƒ½è¿˜æœ‰ä¸€ä¸ªç–‘é—®, é‚£å°±æ˜¯, è¿™äº›æ–‡ä»¶åˆ°åº•æ˜¯ä¸æ˜¯ mysqld æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“æ–‡ä»¶å‘¢? æœ‰æ²¡æœ‰å¯èƒ½æ˜¯ä¸å†ä½¿ç”¨çš„æ—§æ•°æ®å‘¢? å…¶å®, è¿™ä¸ªå¾ˆå®¹æ˜“ç¡®è®¤, æŸ¥ä¸€ä¸‹ mysqld é…ç½®çš„æ•°æ®è·¯å¾„å³å¯.")]),s._v(" "),a("p",[s._v("å¯ä»¥åœ¨ç»ˆç«¯ä¸€ä¸­, ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'show global variables like \"%datadir%\";'")]),s._v("\n+---------------+-----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------+-----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" datadir       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" /var/lib/mysql/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------+-----------------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è¿™é‡Œå¯ä»¥çœ‹åˆ°, "),a("code",[s._v("/var/lib/mysql/")]),s._v("â€‹ ç¡®å®æ˜¯ mysqld æ­£åœ¨ä½¿ç”¨çš„æ•°æ®å­˜å‚¨ç›®å½•. åˆšæ‰åˆ†æå¾—å‡ºçš„æ•°æ®åº“ test å’Œæ•°æ®è¡¨ products, éƒ½æ˜¯æ­£åœ¨ä½¿ç”¨.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶å·²ç»æ‰¾å‡ºäº†æ•°æ®åº“å’Œè¡¨, æ¥ä¸‹æ¥è¦åšçš„, å°±æ˜¯å¼„æ¸…æ¥šæ•°æ®åº“ä¸­æ­£åœ¨æ‰§è¡Œä»€ä¹ˆæ ·çš„ SQL äº†. ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„ docker exec å‘½ä»¤, è¿›å…¥ MySQL çš„å‘½ä»¤è¡Œç•Œé¢:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mysql mysql\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nType "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'help;'")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\h'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" help. Type "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\c'")]),s._v(" to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("clear")]),s._v(" the current input statement.\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä¸‹ä¸€æ­¥åº”è¯¥å¯ä»¥æƒ³åˆ°, é‚£å°±æ˜¯åœ¨ MySQL å‘½ä»¤è¡Œç•Œé¢ä¸­, æ‰§è¡Œ show processlist å‘½ä»¤, æ¥æŸ¥çœ‹"),a("strong",[s._v("å½“å‰æ­£åœ¨æ‰§è¡Œçš„ SQL è¯­å¥")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ä¸ºäº†ä¿è¯ SQL è¯­å¥ä¸æˆªæ–­, è¿™é‡Œå¯ä»¥æ‰§è¡Œ show full processlist å‘½ä»¤. å¦‚æœä¸€åˆ‡æ­£å¸¸, åº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show full processlist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+----+------+-----------------+------+---------+------+--------------+-----------------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" User "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Host            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" db   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Command "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" State        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Info                                                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+------+-----------------+------+---------+------+--------------+-----------------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" localhost       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Query   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" init         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" show full processlist                               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:42262 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Query   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Sending data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from products where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("productName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'geektime'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+------+-----------------+------+---------+------+--------------+-----------------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè¾“å‡ºä¸­,")]),s._v(" "),a("ul",[a("li",[s._v("db è¡¨ç¤ºæ•°æ®åº“çš„åå­—;")]),s._v(" "),a("li",[s._v("Command è¡¨ç¤º SQL ç±»å‹;")]),s._v(" "),a("li",[s._v("Time è¡¨ç¤ºæ‰§è¡Œæ—¶é—´;")]),s._v(" "),a("li",[s._v("State è¡¨ç¤ºçŠ¶æ€;")]),s._v(" "),a("li",[s._v("è€Œ Info åˆ™åŒ…å«äº†å®Œæ•´çš„ SQL è¯­å¥.")])]),s._v(" "),a("p",[s._v("å¤šæ‰§è¡Œå‡ æ¬¡ show full processlist å‘½ä»¤, å¯çœ‹åˆ° "),a("code",[s._v("select * from products where productName='geektime'")]),s._v("â€‹ è¿™æ¡ SQL è¯­å¥çš„æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿.")]),s._v(" "),a("p",[s._v("å†å›å¿†ä¸€ä¸‹, æ¡ˆä¾‹å¼€å§‹æ—¶åœ¨ç»ˆç«¯äºŒæŸ¥è¯¢çš„äº§å“åç§° "),a("code",[s._v("http://192.168.0.10:10000/products/geektime")]),s._v("â€‹, å…¶ä¸­çš„ geektime ä¹Ÿç¬¦åˆè¿™æ¡æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶.")]),s._v(" "),a("p",[s._v("ä¸€èˆ¬ MySQL çš„æ…¢æŸ¥è¯¢é—®é¢˜, å¾ˆå¯èƒ½æ˜¯æ²¡æœ‰åˆ©ç”¨å¥½ç´¢å¼•å¯¼è‡´çš„, é‚£è¿™æ¡æŸ¥è¯¢è¯­å¥æ˜¯ä¸æ˜¯è¿™æ ·å‘¢? åˆè¯¥æ€ä¹ˆç¡®è®¤, æŸ¥è¯¢è¯­å¥æ˜¯å¦åˆ©ç”¨äº†ç´¢å¼•å‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®, MySQL å†…ç½®çš„ explain å‘½ä»¤, å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜. ç»§ç»­åœ¨ MySQL ç»ˆç«¯ä¸­, è¿è¡Œä¸‹é¢çš„ explain å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ‡æ¢åˆ° test åº“")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‰§è¡Œ explain å‘½ä»¤")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" explain "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from products where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("productName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'geektime'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+----+-------------+----------+------+---------------+------+---------+------+-------+-------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" select_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" table    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" possible_keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" key  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" key_len "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ref  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rows  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Extra       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+-------------+----------+------+---------------+------+---------+------+-------+-------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SIMPLE      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" products "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ALL  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Using where "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+-------------+----------+------+---------------+------+---------+------+-------+-------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿè¿™æ¬¡çš„è¾“å‡º. è¿™ä¸ªç•Œé¢ä¸­, æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å­—æ®µéœ€è¦æ³¨æ„, å°±ä»¥è¿™ä¸ªè¾“å‡ºä¸ºä¾‹, åˆ†åˆ«è§£é‡Šä¸€ä¸‹:")]),s._v(" "),a("ul",[a("li",[s._v("select_type è¡¨ç¤ºæŸ¥è¯¢ç±»å‹, è€Œè¿™é‡Œçš„ SIMPLE è¡¨ç¤ºæ­¤æŸ¥è¯¢ä¸åŒ…æ‹¬ UNION æŸ¥è¯¢æˆ–è€…å­æŸ¥è¯¢;")]),s._v(" "),a("li",[s._v("table è¡¨ç¤ºæ•°æ®è¡¨çš„åå­—, è¿™é‡Œæ˜¯ products;")]),s._v(" "),a("li",[s._v("type è¡¨ç¤ºæŸ¥è¯¢ç±»å‹, è¿™é‡Œçš„ ALL è¡¨ç¤ºå…¨è¡¨æŸ¥è¯¢, ä½†ç´¢å¼•æŸ¥è¯¢åº”è¯¥æ˜¯ index ç±»å‹æ‰å¯¹;")]),s._v(" "),a("li",[s._v("possible_keys è¡¨ç¤ºå¯èƒ½é€‰ç”¨çš„ç´¢å¼•, è¿™é‡Œæ˜¯ NULL;")]),s._v(" "),a("li",[s._v("key è¡¨ç¤ºç¡®åˆ‡ä¼šä½¿ç”¨çš„ç´¢å¼•, è¿™é‡Œä¹Ÿæ˜¯ NULL;")]),s._v(" "),a("li",[s._v("rows è¡¨ç¤ºæŸ¥è¯¢æ‰«æçš„è¡Œæ•°, è¿™é‡Œæ˜¯ 10000.")])]),s._v(" "),a("p",[s._v("æ ¹æ®è¿™äº›ä¿¡æ¯å¯ä»¥ç¡®å®š, è¿™æ¡æŸ¥è¯¢è¯­å¥å‹æ ¹å„¿æ²¡æœ‰ä½¿ç”¨ç´¢å¼•, æ‰€ä»¥æŸ¥è¯¢æ—¶, ä¼š"),a("strong",[s._v("æ‰«æå…¨è¡¨")]),s._v(", å¹¶ä¸”æ‰«æè¡Œæ•°é«˜è¾¾ 10000 è¡Œ. å“åº”é€Ÿåº¦é‚£ä¹ˆæ…¢ä¹Ÿå°±éš¾æ€ªäº†.")]),s._v(" "),a("p",[s._v("èµ°åˆ°è¿™ä¸€æ­¥, åº”è¯¥å¾ˆå®¹æ˜“æƒ³åˆ°ä¼˜åŒ–æ–¹æ³•, æ²¡æœ‰ç´¢å¼•é‚£å°±ç»™ productName å»ºç«‹ç´¢å¼•å°±å¯ä»¥äº†. å»ºå®Œç´¢å¼•ä¹‹å, è¯¥æ£€æŸ¥ä¸€ä¸‹æ€§èƒ½é—®é¢˜æ˜¯å¦å·²ç»è§£å†³äº†.")]),s._v(" "),a("p",[s._v("åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, æŸ¥çœ‹è¿˜åœ¨æ‰§è¡Œçš„ curl å‘½ä»¤çš„ç»“æœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Got data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.383180141448975")]),s._v(" sec\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.384996891021729")]),s._v(" sec\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0021054744720458984")]),s._v(" sec\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.003951072692871094")]),s._v(" sec\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ˜¾ç„¶, æŸ¥è¯¢æ—¶é—´å·²ç»ä» 15 ç§’ç¼©çŸ­åˆ°äº† 3 æ¯«ç§’. çœ‹æ¥, æ²¡æœ‰ç´¢å¼•æœç„¶å°±æ˜¯è¿™æ¬¡æ€§èƒ½é—®é¢˜çš„ç½ªé­ç¥¸é¦–, è§£å†³äº†ç´¢å¼•, å°±è§£å†³äº†æŸ¥è¯¢æ…¢çš„é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_3-æ¡ˆä¾‹æ€è€ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¡ˆä¾‹æ€è€ƒ"}},[s._v("#")]),s._v(" 3.æ¡ˆä¾‹æ€è€ƒ")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œ, å•†å“æœç´¢åº”ç”¨æŸ¥è¯¢æ…¢çš„é—®é¢˜å·²ç»å®Œç¾è§£å†³äº†. ä½†å¯¹äºè¿™ä¸ªæ¡ˆä¾‹, è¿˜æœ‰ä¸€ç‚¹æƒ³è¯´æ˜ä¸€ä¸‹.")]),s._v(" "),a("p",[s._v("ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—, æ¡ˆä¾‹å¼€å§‹æ—¶, å¯åŠ¨çš„å‡ ä¸ªå®¹å™¨åº”ç”¨. é™¤äº† MySQL å’Œå•†å“æœç´¢åº”ç”¨å¤–, è¿˜æœ‰ä¸€ä¸ª DataService åº”ç”¨. ä¸ºä»€ä¹ˆè¿™ä¸ªæ¡ˆä¾‹å¼€å§‹æ—¶, è¦è¿è¡Œä¸€ä¸ªçœ‹èµ·æ¥æ¯«ä¸ç›¸å…³çš„åº”ç”¨å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, DataService æ˜¯ä¸€ä¸ªä¸¥é‡å½±å“ MySQL æ€§èƒ½çš„å¹²æ‰°åº”ç”¨. æŠ›å¼€ä¸Šè¿°ç´¢å¼•ä¼˜åŒ–æ–¹æ³•ä¸è¯´, è¿™ä¸ªæ¡ˆä¾‹è¿˜æœ‰ä¸€ç§ä¼˜åŒ–æ–¹æ³•, ä¹Ÿå°±æ˜¯åœæ­¢ DataService åº”ç”¨. æ¥ä¸‹æ¥, å°±åˆ é™¤æ•°æ®åº“ç´¢å¼•, å›åˆ°åŸæ¥çš„çŠ¶æ€; ç„¶ååœæ­¢ DataService åº”ç”¨, çœ‹çœ‹ä¼˜åŒ–æ•ˆæœå¦‚ä½•.")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç»ˆç«¯äºŒä¸­åœæ­¢ curl å‘½ä»¤, ç„¶åå›åˆ°ç»ˆç«¯ä¸€ä¸­, åˆ é™¤ä¹‹å‰çš„ç´¢å¼•, æ¥ç€, åœ¨ç»ˆç«¯äºŒä¸­é‡æ–°è¿è¡Œ curl å‘½ä»¤. å½“ç„¶, è¿™æ¬¡ä½ ä¼šå‘ç°, å¤„ç†æ—¶é—´åˆå˜æ…¢äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/products/geektime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.884345054626465")]),s._v(" sec\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥, å†æ¬¡å›åˆ°ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, åœæ­¢ DataService åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœæ­¢ DataService åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" dataservice\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æœ€åå›åˆ°ç»ˆç«¯äºŒä¸­, è§‚å¯Ÿ curl çš„ç»“æœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Got data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.884345054626465")]),s._v(" sec\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.238174200057983")]),s._v(" sec\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.12604427337646484")]),s._v(" sec\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1101069450378418")]),s._v(" sec\nGot data: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("in "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.11235237121582031")]),s._v(" sec\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("æœç„¶, åœæ­¢ DataService å, å¤„ç†æ—¶é—´ä» 15 ç§’ç¼©çŸ­åˆ°äº† 0.1 ç§’, è™½ç„¶æ¯”ä¸ä¸Šå¢åŠ ç´¢å¼•åçš„ 3 æ¯«ç§’, ä½†ç›¸å¯¹äº 15 ç§’æ¥è¯´, ä¼˜åŒ–æ•ˆæœè¿˜æ˜¯éå¸¸æ˜æ˜¾çš„.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, è¿™ç§æƒ…å†µä¸‹, è¿˜æœ‰æ²¡æœ‰ I/O ç“¶é¢ˆäº†å‘¢?")]),s._v(" "),a("p",[s._v("åˆ‡æ¢åˆ°ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„ vmstat å‘½ä»¤(æ³¨æ„ä¸æ˜¯ iostat, ç¨åè§£é‡ŠåŸå› ), è§‚å¯Ÿ I/O çš„å˜åŒ–æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vmstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("   buff  cache   si   so    bi    bo   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("   cs us sy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" wa st\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6809304")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1368")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("856744")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32640")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("478")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6776620")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1368")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("889456")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32640")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("490")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6747540")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1368")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("918576")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29056")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("568")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6747540")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1368")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("918576")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("141")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6747160")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1368")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("918576")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("148")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, ç£ç›˜è¯»(bi)å’Œ iowait(wa)åˆšå¼€å§‹è¿˜æ˜¯æŒºå¤§çš„, ä½†æ²¡è¿‡å¤šä¹…, å°±éƒ½å˜æˆäº† 0. æ¢å¥è¯è¯´, I/O ç“¶é¢ˆæ¶ˆå¤±äº†.")]),s._v(" "),a("p",[s._v("è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? åŸå› å…ˆç•™ä¸ªæ‚¬å¿µ, ä½œä¸ºæœ¬èŠ‚çš„æ€è€ƒé¢˜.")]),s._v(" "),a("p",[s._v("å›è¿‡å¤´æ¥è§£é‡Šä¸€ä¸‹åˆšåˆšçš„æ“ä½œ, åœ¨æŸ¥çœ‹ I/O æƒ…å†µæ—¶, å¹¶æ²¡ç”¨ iostat å‘½ä»¤, è€Œæ˜¯ç”¨äº† vmstat. å…¶å®, ç›¸å¯¹äº iostat æ¥è¯´, vmstat å¯ä»¥åŒæ—¶æä¾› CPU, å†…å­˜å’Œ I/O çš„ä½¿ç”¨æƒ…å†µ. åœ¨æ€§èƒ½åˆ†æè¿‡ç¨‹ä¸­, èƒ½å¤Ÿç»¼åˆå¤šä¸ªæŒ‡æ ‡, å¹¶ç»“åˆç³»ç»Ÿçš„å·¥ä½œåŸç†è¿›è¡Œåˆ†æ, å¯¹è§£é‡Šæ€§èƒ½ç°è±¡é€šå¸¸ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„å¸®åŠ©.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-8"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚åˆ†æäº†ä¸€ä¸ªå•†å“æœç´¢çš„åº”ç”¨ç¨‹åº. å…ˆæ˜¯é€šè¿‡ top, iostat åˆ†æäº†ç³»ç»Ÿçš„ CPU å’Œç£ç›˜ä½¿ç”¨æƒ…å†µ, å‘ç°äº†ç£ç›˜çš„ I/O ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("æ¥ç€, å€ŸåŠ© pidstat, å‘ç°ç“¶é¢ˆæ˜¯ mysqld å¯¼è‡´çš„. ç´§æ¥ç€åˆé€šè¿‡ strace, lsof, æ‰¾å‡ºäº† mysqld æ­£åœ¨è¯»çš„æ–‡ä»¶. åŒæ—¶, æ ¹æ®æ–‡ä»¶çš„åå­—å’Œè·¯å¾„, æ‰¾å‡ºäº† mysqld æ­£åœ¨æ“ä½œçš„æ•°æ®åº“å’Œæ•°æ®è¡¨. ç»¼åˆè¿™äº›ä¿¡æ¯å¯ä»¥åˆ¤æ–­, è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰åˆ©ç”¨ç´¢å¼•å¯¼è‡´çš„æ…¢æŸ¥è¯¢é—®é¢˜.")]),s._v(" "),a("h4",{attrs:{id:"_29-æ¡ˆä¾‹ç¯‡-rediså“åº”ä¸¥é‡å»¶è¿Ÿ-å¦‚ä½•è§£å†³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_29-æ¡ˆä¾‹ç¯‡-rediså“åº”ä¸¥é‡å»¶è¿Ÿ-å¦‚ä½•è§£å†³"}},[s._v("#")]),s._v(" 29-æ¡ˆä¾‹ç¯‡:Rediså“åº”ä¸¥é‡å»¶è¿Ÿ,å¦‚ä½•è§£å†³?")]),s._v(" "),a("p",[s._v("Redis æ˜¯æœ€å¸¸ç”¨çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿä¹‹ä¸€, å¸¸ç”¨ä½œæ•°æ®åº“, é«˜é€Ÿç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—ä»£ç†ç­‰. Redis åŸºäºå†…å­˜æ¥å­˜å‚¨æ•°æ®, ä¸è¿‡, ä¸ºäº†ä¿è¯åœ¨æœåŠ¡å™¨å¼‚å¸¸æ—¶æ•°æ®ä¸ä¸¢å¤±, å¾ˆå¤šæƒ…å†µä¸‹, è¦ä¸ºå®ƒ"),a("strong",[s._v("é…ç½®æŒä¹…åŒ–, è€Œè¿™å°±å¯èƒ½ä¼šå¼•å‘ç£ç›˜ I/O çš„æ€§èƒ½é—®é¢˜")]),s._v(".")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¥åˆ†æä¸€ä¸ª"),a("strong",[s._v("åˆ©ç”¨ Redis ä½œä¸ºç¼“å­˜")]),s._v("çš„æ¡ˆä¾‹. è¿™åŒæ ·æ˜¯ä¸€ä¸ªåŸºäº Python Flask çš„åº”ç”¨ç¨‹åº, å®ƒæä¾›äº†ä¸€ä¸ªæŸ¥è¯¢ç¼“å­˜çš„æ¥å£, ä½†æ¥å£çš„å“åº”æ—¶é—´æ¯”è¾ƒé•¿, å¹¶ä¸èƒ½æ»¡è¶³çº¿ä¸Šç³»ç»Ÿçš„è¦æ±‚.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹å‡†å¤‡-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹å‡†å¤‡-4"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sysstat , git, make ç­‰å·¥å…·, å¦‚ apt install docker.io sysstat")])]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹ç”± Python åº”ç”¨ +Redis ä¸¤éƒ¨åˆ†ç»„æˆ. å…¶ä¸­, Python åº”ç”¨æ˜¯ä¸€ä¸ªåŸºäº Flask çš„åº”ç”¨, å®ƒä¼šåˆ©ç”¨ Redis , æ¥ç®¡ç†åº”ç”¨ç¨‹åºçš„ç¼“å­˜, å¹¶å¯¹å¤–æä¾›ä¸‰ä¸ª HTTP æ¥å£: â€‹")]),s._v(" "),a("ul",[a("li",[s._v("â€‹"),a("code",[s._v("/")]),s._v("â€‹: è¿”å› hello redis;")]),s._v(" "),a("li",[s._v("â€‹"),a("code",[s._v("/init/")]),s._v("â€‹: æ’å…¥æŒ‡å®šæ•°é‡çš„ç¼“å­˜æ•°æ®, å¦‚æœä¸æŒ‡å®šæ•°é‡, é»˜è®¤çš„æ˜¯ 5000 æ¡;")]),s._v(" "),a("li",[s._v("ç¼“å­˜çš„é”®æ ¼å¼ä¸º uuid:")]),s._v(" "),a("li",[s._v("ç¼“å­˜çš„å€¼ä¸º good, bad æˆ– normal ä¸‰è€…ä¹‹ä¸€")]),s._v(" "),a("li",[s._v("â€‹"),a("code",[s._v("/get_cache/<type_name>")]),s._v("â€‹: æŸ¥è¯¢æŒ‡å®šå€¼çš„ç¼“å­˜æ•°æ®, å¹¶è¿”å›å¤„ç†æ—¶é—´. å…¶ä¸­, type_name å‚æ•°åªæ”¯æŒ good, bad å’Œ normal(ä¹Ÿå°±æ˜¯æ‰¾å‡ºå…·æœ‰ç›¸åŒ value çš„ key åˆ—è¡¨).")])]),s._v(" "),a("p",[s._v("ç”±äºåº”ç”¨æ¯”è¾ƒå¤š, ä¸ºäº†æ–¹ä¾¿è¿è¡Œ, æˆ‘æŠŠå®ƒä»¬æ‰“åŒ…æˆäº†ä¸¤ä¸ª Docker é•œåƒ, å¹¶æ¨é€åˆ°äº† Github ä¸Š. è¿™æ ·å°±åªéœ€è¦è¿è¡Œå‡ æ¡å‘½ä»¤, å°±å¯ä»¥å¯åŠ¨äº†.")]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹éœ€è¦ä¸¤å°è™šæ‹Ÿæœº, å…¶ä¸­ä¸€å°ç”¨ä½œæ¡ˆä¾‹åˆ†æçš„ç›®æ ‡æœºå™¨, è¿è¡Œ Flask åº”ç”¨, å®ƒçš„ IP åœ°å€æ˜¯ 192.168.0.10; è€Œå¦ä¸€å°ä½œä¸ºå®¢æˆ·ç«¯, è¯·æ±‚ç¼“å­˜æŸ¥è¯¢æ¥å£. æˆ‘ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºå®ƒä»¬çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/4148c5d0616b65f23ca40f43214f44ac-20230731161933-hh7xza3.png",alt:""}})]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯, åˆ†åˆ« SSH ç™»å½•åˆ°è¿™ä¸¤å°è™šæ‹Ÿæœºä¸­, å¹¶åœ¨ç¬¬ä¸€å°è™šæ‹Ÿæœºä¸­å®‰è£…ä¸Šè¿°å·¥å…·.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ-6"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, è¿è¡Œæœ¬æ¬¡æ¡ˆä¾‹è¦åˆ†æçš„ç›®æ ‡åº”ç”¨. æ­£å¸¸æƒ…å†µä¸‹, åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ³¨æ„ä¸‹é¢çš„éšæœºå­—ç¬¦ä¸²æ˜¯å®¹å™¨ ID, æ¯æ¬¡è¿è¡Œå‡ä¼šä¸åŒ, å¹¶ä¸”ä½ ä¸éœ€è¦å…³æ³¨å®ƒ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(":80 feisky/redis-server\nec41cb9e4dd5cb7079e1d9f72b7cee7de67278dbd3bd0956b4c0846bff211803\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("container:redis "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/redis-app\n2c54eb252d0552448320d9155a2618b799a1e71d7289ec7277a61e72a9de5fd0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ç„¶å, å†è¿è¡Œ docker ps å‘½ä»¤, ç¡®è®¤ä¸¤ä¸ªå®¹å™¨éƒ½å¤„äºè¿è¡Œ(Up)çŠ¶æ€:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                             NAMES\n2c54eb252d05        feisky/redis-app      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python /app.py"')]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" seconds                                         app\nec41cb9e4dd5        feisky/redis-server   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.sâ€¦"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" seconds       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:10000-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä»Šå¤©çš„åº”ç”¨åœ¨ 10000 ç«¯å£ç›‘å¬, æ‰€ä»¥å¯ä»¥é€šè¿‡ http://192.168.0.10:10000, æ¥è®¿é—®å‰é¢æåˆ°çš„ä¸‰ä¸ªæ¥å£.")]),s._v(" "),a("p",[s._v("åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªç»ˆç«¯, ä½¿ç”¨ curl å·¥å…·, è®¿é—®åº”ç”¨é¦–é¡µ. å¦‚æœçœ‹åˆ° "),a("code",[s._v("hello redis")]),s._v("â€‹ çš„è¾“å‡º, è¯´æ˜åº”ç”¨æ­£å¸¸å¯åŠ¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/\nhello redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥, ç»§ç»­åœ¨ç»ˆç«¯äºŒä¸­, æ‰§è¡Œä¸‹é¢çš„ curl å‘½ä»¤, æ¥è°ƒç”¨åº”ç”¨çš„ "),a("code",[s._v("/init")]),s._v("â€‹ æ¥å£, åˆå§‹åŒ– Redis ç¼“å­˜, å¹¶ä¸”æ’å…¥ 5000 æ¡ç¼“å­˜ä¿¡æ¯. è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒæ…¢. è€å¿ƒç­‰ä¸€ä¼šå„¿å, ä¼šçœ‹åˆ°ä¸‹é¢è¿™è¡Œè¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¡ˆä¾‹æ’å…¥ 5000 æ¡æ•°æ®, åœ¨å®è·µæ—¶å¯ä»¥æ ¹æ®ç£ç›˜çš„ç±»å‹é€‚å½“è°ƒæ•´, æ¯”å¦‚ä½¿ç”¨ SSD æ—¶å¯ä»¥è°ƒå¤§, è€Œ HDD å¯ä»¥é€‚å½“è°ƒå°")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/init/5000\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elapsed_seconds"')]),s._v(":30.26814079284668,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keys_initialized"')]),s._v(":5000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤, è®¿é—®åº”ç”¨çš„ç¼“å­˜æŸ¥è¯¢æ¥å£. å¦‚æœä¸€åˆ‡æ­£å¸¸, ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/get_cache\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),s._v(":1677,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d97662fa-06ac-11e9-92c7-0242ac110002"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elapsed_seconds"')]),s._v(":10.545469760894775,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"good"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™ä¸ªæ¥å£è°ƒç”¨å±…ç„¶è¦èŠ± 10 ç§’! è¿™ä¹ˆé•¿çš„å“åº”æ—¶é—´, æ˜¾ç„¶ä¸èƒ½æ»¡è¶³å®é™…çš„åº”ç”¨éœ€æ±‚.")]),s._v(" "),a("p",[s._v("åˆ°åº•å‡ºäº†ä»€ä¹ˆé—®é¢˜å‘¢? è¿˜æ˜¯è¦ç”¨å‰é¢å­¦è¿‡çš„æ€§èƒ½å·¥å…·å’ŒåŸç†, æ¥æ‰¾åˆ°è¿™ä¸ªç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("ä¸è¿‡åˆ«æ€¥, åŒæ ·ä¸ºäº†é¿å…åˆ†æè¿‡ç¨‹ä¸­å®¢æˆ·ç«¯çš„è¯·æ±‚ç»“æŸ, åœ¨è¿›è¡Œæ€§èƒ½åˆ†æå‰, å…ˆè¦æŠŠ curl å‘½ä»¤æ”¾åˆ°ä¸€ä¸ªå¾ªç¯é‡Œæ¥æ‰§è¡Œ. å¯ä»¥åœ¨ç»ˆç«¯äºŒä¸­, ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.10:10000/get_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v('æ¥ä¸‹æ¥, å†é‡æ–°å›åˆ°ç»ˆç«¯ä¸€, æŸ¥æ‰¾æ¥å£å“åº”æ…¢çš„"ç—…å› ".')]),s._v(" "),a("p",[s._v("æœ€è¿‘å‡ ä¸ªæ¡ˆä¾‹çš„ç°è±¡éƒ½æ˜¯å“åº”å¾ˆæ…¢, è¿™ç§æƒ…å†µä¸‹è‡ªç„¶å…ˆä¼šæ€€ç–‘, æ˜¯ä¸æ˜¯ç³»ç»Ÿèµ„æºå‡ºç°äº†ç“¶é¢ˆ. æ‰€ä»¥, "),a("strong",[s._v("å…ˆè§‚å¯Ÿ CPU, å†…å­˜å’Œç£ç›˜ I/O ç­‰çš„ä½¿ç”¨æƒ…å†µè‚¯å®šä¸ä¼šé”™")]),s._v(".")]),s._v(" "),a("p",[s._v("å…ˆåœ¨ç»ˆç«¯ä¸€ä¸­æ‰§è¡Œ top å‘½ä»¤, åˆ†æç³»ç»Ÿçš„ CPU ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":46:18 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" days,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":49,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.36")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.36")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.04")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v(" id, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84.7")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.7")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169300")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7342244")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("432912")]),s._v(" used,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("394144")]),s._v(" buff/cache\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7478748")]),s._v(" avail Mem\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9181")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193004")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27304")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8716")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.6")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":07.15 python\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28352")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9760")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1860")]),s._v(" D   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":04.34 redis-server\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("368")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" D   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":33.88 jbd2/sda1-8\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("149")]),s._v(" root       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-20")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":10.63 kworker/0:1H\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1549")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("236716")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24576")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9864")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91")]),s._v(":37.30 python3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ top çš„è¾“å‡ºå¯ä»¥å‘ç°, CPU0 çš„ iowait æ¯”è¾ƒé«˜, å·²ç»è¾¾åˆ°äº† 84%; è€Œå„ä¸ªè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡éƒ½ä¸å¤ªé«˜, æœ€é«˜çš„ python å’Œ redis-server, ä¹Ÿåˆ†åˆ«åªæœ‰ 8% å’Œ 5%. å†çœ‹å†…å­˜, æ€»å†…å­˜ 8GB, å‰©ä½™å†…å­˜è¿˜æœ‰ 7GB å¤š, æ˜¾ç„¶å†…å­˜ä¹Ÿæ²¡å•¥é—®é¢˜.")]),s._v(" "),a("p",[s._v("ç»¼åˆ top çš„ä¿¡æ¯, æœ€æœ‰å«Œç–‘çš„å°±æ˜¯ "),a("strong",[s._v("iowait")]),s._v(". æ‰€ä»¥, æ¥ä¸‹æ¥è¿˜æ˜¯è¦ç»§ç»­åˆ†æ, æ˜¯ä¸æ˜¯ I/O é—®é¢˜.")]),s._v(" "),a("p",[s._v("è¿˜åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­åœæ­¢ top å‘½ä»¤; ç„¶å, æ‰§è¡Œä¸‹é¢çš„ iostat å‘½ä»¤, æŸ¥çœ‹æœ‰æ²¡æœ‰ I/O æ€§èƒ½é—®é¢˜:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ iostat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nsda              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("492.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2672.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26.35")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.76")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.43")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿ iostat çš„è¾“å‡ºå‘ç°, ç£ç›˜ sda æ¯ç§’çš„å†™æ•°æ®(wkB/s)ä¸º 2.5MB, I/O ä½¿ç”¨ç‡(%util)æ˜¯ 0. çœ‹æ¥, è™½ç„¶æœ‰äº› I/O æ“ä½œ, ä½†å¹¶æ²¡å¯¼è‡´ç£ç›˜çš„ I/O ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("æ’æŸ¥ä¸‹æ¥, CPU å’Œå†…å­˜ä½¿ç”¨æ²¡é—®é¢˜, I/O ä¹Ÿæ²¡æœ‰ç“¶é¢ˆ, æ¥ä¸‹æ¥å¥½åƒå°±æ²¡å•¥åˆ†ææ–¹å‘äº†?")]),s._v(" "),a("p",[s._v("ç¢°åˆ°è¿™ç§æƒ…å†µ, è¿˜æ˜¯é‚£å¥è¯, åæ€ä¸€ä¸‹, æ˜¯ä¸æ˜¯åˆæ¼æ‰ä»€ä¹ˆæœ‰ç”¨çº¿ç´¢äº†. å¯ä»¥å…ˆè‡ªå·±æ€è€ƒä¸€ä¸‹, ä»åˆ†æå¯¹è±¡(æ¡ˆä¾‹åº”ç”¨), ç³»ç»ŸåŸç†å’Œæ€§èƒ½å·¥å…·è¿™ä¸‰ä¸ªæ–¹å‘ä¸‹åŠŸå¤«, å›å¿†å®ƒä»¬çš„ç‰¹æ€§, æŸ¥æ‰¾ç°è±¡çš„å¼‚å¸¸, å†ç»§ç»­å¾€ä¸‹èµ°.")]),s._v(" "),a("p",[s._v("å›æƒ³ä¸€ä¸‹, ä»Šå¤©çš„æ¡ˆä¾‹é—®é¢˜æ˜¯ä» Redis ç¼“å­˜ä¸­æŸ¥è¯¢æ•°æ®æ…¢. "),a("strong",[s._v("å¯¹æŸ¥è¯¢æ¥è¯´, å¯¹åº”çš„ I/O åº”è¯¥æ˜¯ç£ç›˜çš„è¯»æ“ä½œ, ä½†åˆšæ‰ç”¨ iostat çœ‹åˆ°çš„å´æ˜¯å†™æ“ä½œ")]),s._v(". è™½è¯´ I/O æœ¬èº«å¹¶æ²¡æœ‰æ€§èƒ½ç“¶é¢ˆ, ä½†è¿™é‡Œçš„ç£ç›˜å†™ä¹Ÿæ˜¯æ¯”è¾ƒå¥‡æ€ªçš„. ä¸ºä»€ä¹ˆä¼šæœ‰ç£ç›˜å†™å‘¢? é‚£å°±å¾—çŸ¥é“, åˆ°åº•æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨å†™ç£ç›˜.")]),s._v(" "),a("p",[s._v("è¦çŸ¥é“ I/O è¯·æ±‚æ¥è‡ªå“ªäº›è¿›ç¨‹, è¿˜æ˜¯è¦é  pidstat. åœ¨ç»ˆç«¯ä¸€ä¸­è¿è¡Œä¸‹é¢çš„ pidstat å‘½ä»¤, è§‚å¯Ÿè¿›ç¨‹çš„ I/O æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":49:35      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":49:36        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("368")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86")]),s._v("  jbd2/sda1-8\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":49:36      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("636.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  redis-server\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä» pidstat çš„è¾“å‡º, å¯ä»¥çœ‹åˆ°, I/O æœ€å¤šçš„è¿›ç¨‹æ˜¯ PID ä¸º 9085 çš„ redis-server, å¹¶ä¸”å®ƒä¹Ÿåˆšå¥½æ˜¯åœ¨å†™ç£ç›˜. è¿™è¯´æ˜, ç¡®å®æ˜¯ redis-server åœ¨è¿›è¡Œç£ç›˜å†™.")]),s._v(" "),a("p",[s._v("å½“ç„¶, å…‰æ‰¾åˆ°è¯»å†™ç£ç›˜çš„è¿›ç¨‹è¿˜ä¸å¤Ÿ, è¿˜è¦å†ç”¨ strace+lsof ç»„åˆ, çœ‹çœ‹ redis-server åˆ°åº•åœ¨å†™ä»€ä¹ˆ.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, è¿˜æ˜¯åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œ strace å‘½ä»¤, å¹¶ä¸”æŒ‡å®š redis-server çš„è¿›ç¨‹å· 9085:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -f è¡¨ç¤ºè·Ÿè¸ªå­è¿›ç¨‹å’Œå­çº¿ç¨‹, -T è¡¨ç¤ºæ˜¾ç¤ºç³»ç»Ÿè°ƒç”¨çš„æ—¶é•¿, -tt è¡¨ç¤ºæ˜¾ç¤ºè·Ÿè¸ªæ—¶é—´")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-T")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.826131 epoll_pwait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("EPOLLIN, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("u32"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("u64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10128")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(", NULL, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00005")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("5")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.826301 read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*2'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("GET"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$41")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('uuid:5b2e76cc-"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00007")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.826477 read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", 0x7fff366a5747, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" EAGAIN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Resource temporarily unavailable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00006")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.826645 write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("bad"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.826907 epoll_pwait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("EPOLLIN, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("u32"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("u64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10128")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(", NULL, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00003")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.827030 read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*2'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("GET"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$41")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('uuid:55862ada-"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00004")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("4")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.827149 read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", 0x7fff366a5747, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" EAGAIN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Resource temporarily unavailable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00004")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.827285 write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("bad"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00014")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.827514 epoll_pwait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("EPOLLIN, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("u32"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("u64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10128")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(", NULL, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00004")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.827641 read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*2'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("GET"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$41")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('uuid:53522908-"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00004")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.827784 read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", 0x7fff366a5747, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" EAGAIN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Resource temporarily unavailable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00003")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("4")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.827945 write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("good"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00028")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.828339 epoll_pwait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("EPOLLIN, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("u32"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("u64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10128")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(", NULL, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00005")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("7")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.828486 read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*3'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("SADD"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("good"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$36")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('535"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00004")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.828623 read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", 0x7fff366a5747, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" EAGAIN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Resource temporarily unavailable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00005")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.828760 write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*3'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("SADD"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("good"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$36")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('535"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00006")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.828970 fdatasync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00541")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("5")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20:16.834493 write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":1'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00025")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿä¸€ä¼šå„¿, æœ‰æ²¡æœ‰å‘ç°ä»€ä¹ˆæœ‰è¶£çš„ç°è±¡?")]),s._v(" "),a("p",[s._v("äº‹å®ä¸Š, ä»ç³»ç»Ÿè°ƒç”¨æ¥çœ‹, "),a("strong",[s._v("epoll_pwait, read, write, fdatasync è¿™äº›ç³»ç»Ÿè°ƒç”¨éƒ½æ¯”è¾ƒé¢‘ç¹")]),s._v(". é‚£ä¹ˆ, åˆšæ‰è§‚å¯Ÿåˆ°çš„å†™ç£ç›˜, åº”è¯¥å°±æ˜¯ write æˆ–è€… fdatasync å¯¼è‡´çš„äº†.")]),s._v(" "),a("p",[s._v("æ¥ç€å†æ¥è¿è¡Œ lsof å‘½ä»¤, æ‰¾å‡ºè¿™äº›ç³»ç»Ÿè°ƒç”¨çš„æ“ä½œå¯¹è±¡:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v("\nredis-ser "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd-network    3r     FIFO   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,12")]),s._v("      0t0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15447970")]),s._v(" pipe\nredis-ser "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd-network    4w     FIFO   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,12")]),s._v("      0t0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15447970")]),s._v(" pipe\nredis-ser "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd-network    5u  a_inode   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,13")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10179")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("eventpoll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nredis-ser "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd-network    6u     sock    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,9")]),s._v("      0t0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15447972")]),s._v(" protocol: TCP\nredis-ser "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd-network    7w      REG    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8,1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8830146")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2838532")]),s._v(" /data/appendonly.aof\nredis-ser "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd-network    8u     sock    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,9")]),s._v("      0t0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15448709")]),s._v(" protocol: TCP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ç°åœ¨å¯ä»¥å‘ç°, æè¿°ç¬¦ç¼–å·ä¸º 3 çš„æ˜¯ä¸€ä¸ª pipe ç®¡é“, 5 å·æ˜¯ eventpoll, 7 å·æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶, è€Œ 8 å·æ˜¯ä¸€ä¸ª TCP socket.")]),s._v(" "),a("p",[s._v("ç»“åˆç£ç›˜å†™çš„ç°è±¡, å¯ä»¥çŸ¥é“, åªæœ‰ 7 å·æ™®é€šæ–‡ä»¶æ‰ä¼šäº§ç”Ÿç£ç›˜å†™, è€Œå®ƒæ“ä½œçš„æ–‡ä»¶è·¯å¾„æ˜¯ "),a("code",[s._v("/data/appendonly.aof")]),s._v("â€‹, ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨åŒ…æ‹¬ write å’Œ fdatasync.")]),s._v(" "),a("p",[s._v("å¦‚æœä½ å¯¹ Redis çš„æŒä¹…åŒ–é…ç½®æ¯”è¾ƒç†Ÿ, çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶è·¯å¾„ä»¥åŠ fdatasync çš„ç³»ç»Ÿè°ƒç”¨, åº”è¯¥èƒ½æƒ³åˆ°, è¿™å¯¹åº”ç€æ­£æ˜¯ "),a("strong",[s._v("Redis æŒä¹…åŒ–é…ç½®ä¸­çš„ appendonly å’Œ appendfsync é€‰é¡¹")]),s._v(". å¾ˆå¯èƒ½æ˜¯å› ä¸ºå®ƒä»¬çš„é…ç½®ä¸åˆç†, å¯¼è‡´ç£ç›˜å†™æ¯”è¾ƒå¤š. æ¥ä¸‹æ¥å°±éªŒè¯ä¸€ä¸‹è¿™ä¸ªçŒœæµ‹, å¯ä»¥é€šè¿‡ Redis çš„å‘½ä»¤è¡Œå·¥å…·, æŸ¥è¯¢è¿™ä¸¤ä¸ªé€‰é¡¹çš„é…ç½®.")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥è¯¢ appendonly å’Œ appendfsync çš„é…ç½®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis redis-cli config get "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'append*'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendfsync"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"always"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendonly"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yes"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä»è¿™ä¸ªç»“æœå¯ä»¥å‘ç°, appendfsync é…ç½®çš„æ˜¯ always, è€Œ appendonly é…ç½®çš„æ˜¯ yes.")]),s._v(" "),a("p",[s._v("Redis æä¾›äº†ä¸¤ç§æ•°æ®æŒä¹…åŒ–çš„æ–¹å¼, åˆ†åˆ«æ˜¯å¿«ç…§å’Œè¿½åŠ æ–‡ä»¶.")]),s._v(" "),a("p",[a("strong",[s._v("å¿«ç…§æ–¹å¼")]),s._v(", ä¼šæŒ‰ç…§æŒ‡å®šçš„æ—¶é—´é—´éš”, ç”Ÿæˆæ•°æ®çš„å¿«ç…§, å¹¶ä¸”ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­. ä¸ºäº†é¿å…é˜»å¡ä¸»è¿›ç¨‹, Redis è¿˜ä¼š fork å‡ºä¸€ä¸ªå­è¿›ç¨‹, æ¥è´Ÿè´£å¿«ç…§çš„ä¿å­˜. è¿™ç§æ–¹å¼çš„æ€§èƒ½å¥½, æ— è®ºæ˜¯å¤‡ä»½è¿˜æ˜¯æ¢å¤, éƒ½æ¯”è¿½åŠ æ–‡ä»¶å¥½å¾ˆå¤š. ä¸è¿‡, å®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾. åœ¨æ•°æ®é‡å¤§æ—¶, fork å­è¿›ç¨‹éœ€è¦ç”¨åˆ°æ¯”è¾ƒå¤§çš„å†…å­˜, ä¿å­˜æ•°æ®ä¹Ÿå¾ˆè€—æ—¶. æ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒé•¿çš„æ—¶é—´é—´éš”æ¥åº”å¯¹, æ¯”å¦‚è‡³å°‘ 5 åˆ†é’Ÿ. è¿™æ ·å¦‚æœå‘ç”Ÿæ•…éšœ, ä½ ä¸¢å¤±çš„å°±æ˜¯å‡ åˆ†é’Ÿçš„æ•°æ®.")]),s._v(" "),a("p",[a("strong",[s._v("è¿½åŠ æ–‡ä»¶")]),s._v(", åˆ™æ˜¯ç”¨åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ è®°å½•çš„æ–¹å¼, å¯¹ Redis å†™å…¥çš„æ•°æ®, ä¾æ¬¡è¿›è¡ŒæŒä¹…åŒ–, æ‰€ä»¥å®ƒçš„æŒä¹…åŒ–ä¹Ÿæ›´å®‰å…¨.  æ­¤å¤–, å®ƒè¿˜æä¾›äº†ä¸€ä¸ªç”¨ appendfsync é€‰é¡¹è®¾ç½® "),a("strong",[s._v("fsync çš„ç­–ç•¥")]),s._v(", ç¡®ä¿å†™å…¥çš„æ•°æ®éƒ½è½åˆ°ç£ç›˜ä¸­, å…·ä½“é€‰é¡¹åŒ…æ‹¬ always, everysec, no ç­‰.")]),s._v(" "),a("ul",[a("li",[s._v("always è¡¨ç¤º, æ¯ä¸ªæ“ä½œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ fsync, æ˜¯æœ€ä¸ºå®‰å…¨çš„æ–¹å¼;")]),s._v(" "),a("li",[s._v("everysec è¡¨ç¤º, æ¯ç§’é’Ÿè°ƒç”¨ä¸€æ¬¡ fsync , è¿™æ ·å¯ä»¥ä¿è¯å³ä½¿æ˜¯æœ€åæƒ…å†µä¸‹, ä¹Ÿåªä¸¢å¤± 1 ç§’çš„æ•°æ®;")]),s._v(" "),a("li",[s._v("è€Œ no è¡¨ç¤ºäº¤ç»™æ“ä½œç³»ç»Ÿæ¥å¤„ç†.")])]),s._v(" "),a("p",[s._v("å›å¿†ä¸€ä¸‹åˆšåˆšçœ‹åˆ°çš„é…ç½®, appendfsync é…ç½®çš„æ˜¯ always, æ„å‘³ç€æ¯æ¬¡å†™æ•°æ®æ—¶, éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ fsync, ä»è€Œé€ æˆæ¯”è¾ƒå¤§çš„ç£ç›˜ I/O å‹åŠ›.")]),s._v(" "),a("p",[s._v("å½“ç„¶, è¿˜å¯ä»¥ç”¨ strace, è§‚å¯Ÿè¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œæƒ…å†µ. æ¯”å¦‚é€šè¿‡ -e é€‰é¡¹æŒ‡å®š fdatasync å, å°±ä¼šå¾—åˆ°ä¸‹é¢çš„ç»“æœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-T")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" fdatasync\nstrace: Process "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" attached with "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" threads\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":22:52.013547 fdatasync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00711")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":22:52.022467 fdatasync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00857")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":22:52.032223 fdatasync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00676")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":22:52.139629 fdatasync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00818")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°, æ¯éš” 10ms å·¦å³, å°±ä¼šæœ‰ä¸€æ¬¡ fdatasync è°ƒç”¨, å¹¶ä¸”æ¯æ¬¡è°ƒç”¨æœ¬èº«ä¹Ÿè¦æ¶ˆè€— 7~8ms.")]),s._v(" "),a("p",[s._v("ä¸ç®¡å“ªç§æ–¹å¼, éƒ½å¯ä»¥éªŒè¯å‰é¢çš„çŒœæƒ³, é…ç½®ç¡®å®ä¸åˆç†. è¿™æ ·å°±æ‰¾å‡ºäº† Redis æ­£åœ¨è¿›è¡Œå†™å…¥çš„æ–‡ä»¶, ä¹ŸçŸ¥é“äº†äº§ç”Ÿå¤§é‡ I/O çš„åŸå› .")]),s._v(" "),a("p",[s._v("ä¸è¿‡, å›åˆ°æœ€åˆçš„ç–‘é—®, ä¸ºä»€ä¹ˆæŸ¥è¯¢æ—¶ä¼šæœ‰ç£ç›˜å†™å‘¢? æŒ‰ç†æ¥è¯´ä¸åº”è¯¥åªæœ‰æ•°æ®çš„è¯»å–å—? è¿™å°±éœ€è¦å†æ¥å®¡æŸ¥ä¸€ä¸‹ "),a("code",[s._v("strace -f -T -tt -p 9085")]),s._v("â€‹ çš„ç»“æœ.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*2'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("GET"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$41")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('uuid:53522908-"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("good"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*3'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("SADD"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("good"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$36")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('535"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*3'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("SADD"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("good"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$36")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('535"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":1'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ç»†å¿ƒçš„ä½ åº”è¯¥è®°å¾—, æ ¹æ® lsof çš„åˆ†æ, æ–‡ä»¶æè¿°ç¬¦ç¼–å·ä¸º 7 çš„æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ "),a("code",[s._v("/data/appendonly.aof")]),s._v('â€‹, è€Œç¼–å·ä¸º 8 çš„æ˜¯ TCP socket. è€Œè§‚å¯Ÿä¸Šé¢çš„å†…å®¹, 8 å·å¯¹åº”çš„ TCP è¯»å†™, æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ "è¯·æ±‚-å“åº”" æ ¼å¼, å³:')]),s._v(" "),a("ul",[a("li",[s._v("ä» socket è¯»å– GET uuid:53522908-... å, å“åº” good;")]),s._v(" "),a("li",[s._v("å†ä» socket è¯»å– SADD good 535... å, å“åº” 1.")])]),s._v(" "),a("p",[s._v("å¯¹ Redis æ¥è¯´, SADD æ˜¯ä¸€ä¸ªå†™æ“ä½œ, æ‰€ä»¥ Redis è¿˜ä¼šæŠŠå®ƒä¿å­˜åˆ°ç”¨äºæŒä¹…åŒ–çš„ appendonly.aof æ–‡ä»¶ä¸­.")]),s._v(" "),a("p",[s._v("è§‚å¯Ÿæ›´å¤šçš„ strace ç»“æœä¼šå‘ç°, æ¯å½“ GET è¿”å› good æ—¶, éšåéƒ½ä¼šæœ‰ä¸€ä¸ª SADD æ“ä½œ, è¿™ä¹Ÿå°±å¯¼è‡´äº†, æ˜æ˜æ˜¯æŸ¥è¯¢æ¥å£, Redis å´æœ‰å¤§é‡çš„ç£ç›˜å†™.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œå°±æ‰¾å‡ºäº† Redis å†™ç£ç›˜çš„åŸå› . ä¸è¿‡, åœ¨ä¸‹æœ€ç»ˆç»“è®ºå‰, è¿˜æ˜¯è¦ç¡®è®¤ä¸€ä¸‹, 8 å· TCP socket å¯¹åº”çš„ Redis å®¢æˆ·ç«¯, åˆ°åº•æ˜¯ä¸æ˜¯æˆ‘ä»¬çš„æ¡ˆä¾‹åº”ç”¨.")]),s._v(" "),a("p",[s._v("å¯ä»¥ç»™ lsof å‘½ä»¤åŠ ä¸Š -i é€‰é¡¹, æ‰¾å‡º TCP socket å¯¹åº”çš„ TCP è¿æ¥ä¿¡æ¯. ä¸è¿‡, ç”±äº Redis å’Œ Python åº”ç”¨éƒ½åœ¨å®¹å™¨ä¸­è¿è¡Œ, éœ€è¦è¿›å…¥å®¹å™¨çš„ç½‘ç»œå‘½åç©ºé—´å†…éƒ¨, æ‰èƒ½çœ‹åˆ°å®Œæ•´çš„ TCP è¿æ¥.")]),s._v(" "),a("p",[s._v("æ³¨æ„: ä¸‹é¢çš„å‘½ä»¤ç”¨åˆ°çš„ nsenter å·¥å…·, å¯ä»¥è¿›å…¥å®¹å™¨å‘½åç©ºé—´. å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰å®‰è£…, è¯·è¿è¡Œä¸‹é¢å‘½ä»¤å®‰è£… nsenter.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /usr/local/bin:/target jpetazzo/nsenter\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("è¿˜æ˜¯åœ¨ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”±äºè¿™ä¸¤ä¸ªå®¹å™¨å…±äº«åŒä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´, æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¿›å…¥ app çš„ç½‘ç»œå‘½åç©ºé—´å³å¯")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--format")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".State.Pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" app"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i è¡¨ç¤ºæ˜¾ç¤ºç½‘ç»œå¥—æ¥å­—ä¿¡æ¯")]),s._v("\n$ nsenter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--target")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--net")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v("\nCOMMAND    PID            "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("   FD   TYPE   DEVICE SIZE/OFF NODE NAME\nredis-ser "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd-network    6u  IPv4 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15447972")]),s._v("      0t0  TCP localhost:6379 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LISTEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nredis-ser "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9085")]),s._v(" systemd-network    8u  IPv4 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15448709")]),s._v("      0t0  TCP localhost:6379-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("localhost:32996 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ESTABLISHED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npython    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9181")]),s._v("            root    3u  IPv4 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15448677")]),s._v("      0t0  TCP *:http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LISTEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npython    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9181")]),s._v("            root    5u  IPv4 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15449632")]),s._v("      0t0  TCP localhost:32996-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("localhost:6379 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ESTABLISHED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("è¿™æ¬¡å¯ä»¥çœ‹åˆ°, redis-server çš„ 8 å·æ–‡ä»¶æè¿°ç¬¦, å¯¹åº” TCP è¿æ¥ "),a("code",[s._v("localhost:6379->localhost:32996")]),s._v("â€‹. å…¶ä¸­, localhost:6379 æ˜¯ redis-server è‡ªå·±çš„ç›‘å¬ç«¯å£, è‡ªç„¶ localhost:32996 å°±æ˜¯ redis çš„å®¢æˆ·ç«¯. å†è§‚å¯Ÿæœ€åä¸€è¡Œ, localhost:32996 å¯¹åº”çš„, æ­£æ˜¯ Python åº”ç”¨ç¨‹åº(è¿›ç¨‹å·ä¸º 9181).")]),s._v(" "),a("p",[s._v("å†ç»å„ç§æ³¢æŠ˜, æ€»ç®—æ‰¾å‡ºäº† Redis å“åº”å»¶è¿Ÿçš„æ½œåœ¨åŸå› . æ€»ç»“ä¸€ä¸‹, æ‰¾åˆ°ä¸¤ä¸ªé—®é¢˜.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ä¸ªé—®é¢˜, Redis é…ç½®çš„ appendfsync æ˜¯ always, è¿™å°±å¯¼è‡´ Redis æ¯æ¬¡çš„å†™æ“ä½œ, éƒ½ä¼šè§¦å‘ fdatasync ç³»ç»Ÿè°ƒç”¨. ä»Šå¤©çš„æ¡ˆä¾‹, æ²¡å¿…è¦ç”¨è¿™ä¹ˆé«˜é¢‘çš„åŒæ­¥å†™, ä½¿ç”¨é»˜è®¤çš„ 1s æ—¶é—´é—´éš”, å°±è¶³å¤Ÿäº†.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒä¸ªé—®é¢˜, Python åº”ç”¨åœ¨æŸ¥è¯¢æ¥å£ä¸­ä¼šè°ƒç”¨ Redis çš„ SADD å‘½ä»¤, è¿™å¾ˆå¯èƒ½æ˜¯ä¸åˆç†ä½¿ç”¨ç¼“å­˜å¯¼è‡´çš„.")]),s._v(" "),a("p",[s._v("å¯¹äºç¬¬ä¸€ä¸ªé…ç½®é—®é¢˜, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŠŠ appendfsync æ”¹æˆ everysec:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis redis-cli config "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" appendfsync everysec\nOK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ”¹å®Œå, åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­æŸ¥çœ‹, ä¼šå‘ç°, ç°åœ¨çš„è¯·æ±‚æ—¶é—´, å·²ç»ç¼©çŸ­åˆ°äº† 0.9s:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("., "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elapsed_seconds"')]),s._v(":0.9368953704833984,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"good"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("è€Œç¬¬äºŒä¸ªé—®é¢˜, å°±è¦æŸ¥çœ‹åº”ç”¨çš„æºç äº†. æŸ¥çœ‹æ¡ˆä¾‹åº”ç”¨çš„æºä»£ç :")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("def get_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'handler "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" /get_cache"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("key")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" redis_client.scan_iter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uuid:*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n        value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis_client.get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" type_name:\n            redis_client.sadd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type_name, key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redis_client.smembers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n    redis_client.delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" jsonify"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" type_name, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'count'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("æœç„¶, Python åº”ç”¨æŠŠ Redis å½“æˆä¸´æ—¶ç©ºé—´, ç”¨æ¥å­˜å‚¨æŸ¥è¯¢è¿‡ç¨‹ä¸­æ‰¾åˆ°çš„æ•°æ®. ä¸è¿‡è¿™äº›æ•°æ®æ”¾å†…å­˜ä¸­å°±å¯ä»¥äº†, å®Œå…¨æ²¡å¿…è¦å†é€šè¿‡ç½‘ç»œè°ƒç”¨å­˜å‚¨åˆ° Redis ä¸­.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-5"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚åˆ†æäº†ä¸€ä¸ª Redis ç¼“å­˜çš„æ¡ˆä¾‹. å…ˆç”¨ top, iostat , åˆ†æäº†ç³»ç»Ÿçš„ CPU , å†…å­˜å’Œç£ç›˜ä½¿ç”¨æƒ…å†µ, ä¸è¿‡å´å‘ç°, ç³»ç»Ÿèµ„æºå¹¶æ²¡æœ‰å‡ºç°ç“¶é¢ˆ. è¿™ä¸ªæ—¶å€™æƒ³è¦è¿›ä¸€æ­¥åˆ†æçš„è¯, è¯¥ä»å“ªä¸ªæ–¹å‘ç€æ‰‹å‘¢?")]),s._v(" "),a("p",[s._v("é€šè¿‡ä»Šå¤©çš„æ¡ˆä¾‹ä¼šå‘ç°, ä¸ºäº†è¿›ä¸€æ­¥åˆ†æ, å°±éœ€è¦å¯¹ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„å·¥ä½œåŸç†æœ‰ä¸€å®šçš„äº†è§£.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä»Šå¤©çš„æ¡ˆä¾‹ä¸­, è™½ç„¶ç£ç›˜ I/O å¹¶æ²¡æœ‰å‡ºç°ç“¶é¢ˆ, ä½†ä» Redis çš„åŸç†æ¥è¯´, æŸ¥è¯¢ç¼“å­˜æ—¶ä¸åº”è¯¥å‡ºç°å¤§é‡çš„ç£ç›˜ I/O å†™æ“ä½œ.")]),s._v(" "),a("p",[s._v("é¡ºç€è¿™ä¸ªæ€è·¯, å°±ç»§ç»­å€ŸåŠ© pidstat, strace, lsof, nsenter ç­‰ä¸€ç³»åˆ—çš„å·¥å…·, æ‰¾å‡ºäº†ä¸¤ä¸ªæ½œåœ¨é—®é¢˜, ä¸€ä¸ªæ˜¯ Redis çš„ä¸åˆç†é…ç½®, å¦ä¸€ä¸ªæ˜¯ Python åº”ç”¨å¯¹ Redis çš„æ»¥ç”¨. æ‰¾åˆ°ç“¶é¢ˆå, ç›¸åº”çš„ä¼˜åŒ–å·¥ä½œè‡ªç„¶å°±æ¯”è¾ƒè½»æ¾äº†.")]),s._v(" "),a("h4",{attrs:{id:"_30-å¥—è·¯ç¯‡-å¦‚ä½•è¿…é€Ÿåˆ†æå‡ºç³»ç»Ÿi-oçš„ç“¶é¢ˆåœ¨å“ªé‡Œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_30-å¥—è·¯ç¯‡-å¦‚ä½•è¿…é€Ÿåˆ†æå‡ºç³»ç»Ÿi-oçš„ç“¶é¢ˆåœ¨å“ªé‡Œ"}},[s._v("#")]),s._v(" 30-å¥—è·¯ç¯‡:å¦‚ä½•è¿…é€Ÿåˆ†æå‡ºç³»ç»ŸI/Oçš„ç“¶é¢ˆåœ¨å“ªé‡Œ?")]),s._v(" "),a("p",[s._v('æœ¬èŠ‚æ¥æ€»ç»“ä¸€ä¸‹, å¦‚ä½•"å¿«å‡†ç‹ "å®šä½ç³»ç»Ÿçš„ I/O ç“¶é¢ˆ; å¹¶ä¸”æ¢³ç†æ¸…æ¥š, åœ¨ä¸åŒåœºæ™¯ä¸‹, æŒ‡æ ‡å·¥å…·æ€ä¹ˆé€‰, æ€§èƒ½ç“¶é¢ˆåˆè¯¥å¦‚ä½•å®šä½.')]),s._v(" "),a("h5",{attrs:{id:"_1-æ€§èƒ½æŒ‡æ ‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ€§èƒ½æŒ‡æ ‡"}},[s._v("#")]),s._v(" 1.æ€§èƒ½æŒ‡æ ‡")]),s._v(" "),a("p",[s._v("å…ˆæ¥å›é¡¾ä¸€ä¸‹, æè¿° I/O çš„æ€§èƒ½æŒ‡æ ‡æœ‰å“ªäº›? å¯ä»¥å…ˆå›æƒ³ä¸€ä¸‹æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O çš„åŸç†, ç»“åˆä¸‹é¢è¿™å¼  Linux ç³»ç»Ÿçš„ I/O æ ˆå›¾, å‡­ç€è®°å¿†å’Œç†è§£è‡ªå·±å†™ä¸€å†™.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/718eb7d89ce098f493d77944019a65a7-20230731161933-mdm7ywc.png",alt:""}})]),s._v(" "),a("p",[s._v("å­¦äº†è¿™ä¹ˆä¹…çš„ I/O æ€§èƒ½çŸ¥è¯†, ä¸€è¯´èµ· I/O æŒ‡æ ‡, ä½ åº”è¯¥é¦–å…ˆä¼šæƒ³åˆ°åˆ†ç±»æè¿°. æˆ‘ä»¬è¦åŒºåˆ†å¼€æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜, åˆ†åˆ«ç”¨ä¸åŒæŒ‡æ ‡æ¥æè¿°å®ƒä»¬çš„æ€§èƒ½.")]),s._v(" "),a("h6",{attrs:{id:"_1-æ–‡ä»¶ç³»ç»Ÿi-oæ€§èƒ½æŒ‡æ ‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ–‡ä»¶ç³»ç»Ÿi-oæ€§èƒ½æŒ‡æ ‡"}},[s._v("#")]),s._v(" (1)æ–‡ä»¶ç³»ç»ŸI/Oæ€§èƒ½æŒ‡æ ‡")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„æƒ…å†µ.")]),s._v(" "),a("p",[a("strong",[s._v("é¦–å…ˆ, æœ€å®¹æ˜“æƒ³åˆ°çš„æ˜¯å­˜å‚¨ç©ºé—´çš„ä½¿ç”¨æƒ…å†µ, åŒ…æ‹¬å®¹é‡, ä½¿ç”¨é‡ä»¥åŠå‰©ä½™ç©ºé—´ç­‰")]),s._v(". ä¸€èˆ¬ç§°è¿™äº›ä¸ºç£ç›˜ç©ºé—´çš„ä½¿ç”¨é‡, å› ä¸ºæ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®æœ€ç»ˆè¿˜æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Š.")]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, è¿™äº›åªæ˜¯æ–‡ä»¶ç³»ç»Ÿå‘å¤–å±•ç¤ºçš„ç©ºé—´ä½¿ç”¨, è€Œéåœ¨ç£ç›˜ç©ºé—´çš„çœŸå®ç”¨é‡, å› ä¸ºæ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ä¹Ÿä¼šå ç”¨ç£ç›˜ç©ºé—´.")]),s._v(" "),a("p",[s._v("è€Œä¸”, å¦‚æœé…ç½®äº† RAID, ä»æ–‡ä»¶ç³»ç»Ÿçœ‹åˆ°çš„ä½¿ç”¨é‡è·Ÿå®é™…ç£ç›˜çš„å ç”¨ç©ºé—´, ä¹Ÿä¼šå› ä¸º RAID çº§åˆ«çš„ä¸åŒè€Œä¸ä¸€æ ·. æ¯”æ–¹é…ç½® RAID10 å, ä»æ–‡ä»¶ç³»ç»Ÿæœ€å¤šä¹Ÿåªèƒ½çœ‹åˆ°æ‰€æœ‰ç£ç›˜å®¹é‡çš„ä¸€åŠ.")]),s._v(" "),a("p",[s._v("é™¤äº†æ•°æ®æœ¬èº«çš„å­˜å‚¨ç©ºé—´, è¿˜æœ‰ä¸€ä¸ª"),a("strong",[s._v("å®¹æ˜“å¿½ç•¥çš„æ˜¯ç´¢å¼•èŠ‚ç‚¹çš„ä½¿ç”¨æƒ…å†µ, å®ƒä¹ŸåŒ…æ‹¬å®¹é‡, ä½¿ç”¨é‡ä»¥åŠå‰©ä½™é‡ç­‰ä¸‰ä¸ªæŒ‡æ ‡")]),s._v(". å¦‚æœæ–‡ä»¶ç³»ç»Ÿä¸­å­˜å‚¨è¿‡å¤šçš„å°æ–‡ä»¶, å°±å¯èƒ½ç¢°åˆ°ç´¢å¼•èŠ‚ç‚¹å®¹é‡å·²æ»¡çš„é—®é¢˜.")]),s._v(" "),a("p",[a("strong",[s._v("å…¶æ¬¡, åº”è¯¥æƒ³åˆ°çš„æ˜¯å‰é¢å¤šæ¬¡æåˆ°è¿‡çš„ç¼“å­˜ä½¿ç”¨æƒ…å†µ, åŒ…æ‹¬é¡µç¼“å­˜, ç›®å½•é¡¹ç¼“å­˜, ç´¢å¼•èŠ‚ç‚¹ç¼“å­˜ä»¥åŠå„ä¸ªå…·ä½“æ–‡ä»¶ç³»ç»Ÿ(å¦‚ ext4, XFS ç­‰)çš„ç¼“å­˜")]),s._v(". è¿™äº›ç¼“å­˜ä¼šä½¿ç”¨é€Ÿåº¦æ›´å¿«çš„å†…å­˜, ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ–‡ä»¶æ•°æ®æˆ–è€…æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®, ä»è€Œå¯ä»¥å‡å°‘è®¿é—®æ…¢é€Ÿç£ç›˜çš„æ¬¡æ•°.")]),s._v(" "),a("p",[s._v("é™¤äº†ä»¥ä¸Šè¿™ä¸¤ç‚¹, æ–‡ä»¶ I/O ä¹Ÿæ˜¯å¾ˆé‡è¦çš„æ€§èƒ½æŒ‡æ ‡, åŒ…æ‹¬ IOPS(åŒ…æ‹¬ r/s å’Œ w/s), å“åº”æ—¶é—´(å»¶è¿Ÿ)ä»¥åŠååé‡(B/s)ç­‰. åœ¨è€ƒå¯Ÿè¿™ç±»æŒ‡æ ‡æ—¶, é€šå¸¸è¿˜è¦è€ƒè™‘å®é™…æ–‡ä»¶çš„è¯»å†™æƒ…å†µ. æ¯”å¦‚, ç»“åˆæ–‡ä»¶å¤§å°, æ–‡ä»¶æ•°é‡, I/O ç±»å‹ç­‰, ç»¼åˆåˆ†ææ–‡ä»¶ I/O çš„æ€§èƒ½.")]),s._v(" "),a("p",[s._v("è¯šç„¶, è¿™äº›æ€§èƒ½æŒ‡æ ‡éå¸¸é‡è¦, ä½†ä¸å¹¸çš„æ˜¯, Linux æ–‡ä»¶ç³»ç»Ÿå¹¶æ²¡æä¾›, ç›´æ¥æŸ¥çœ‹è¿™äº›æŒ‡æ ‡çš„æ–¹æ³•. åªèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨, åŠ¨æ€è·Ÿè¸ªæˆ–è€…åŸºå‡†æµ‹è¯•ç­‰æ–¹æ³•, é—´æ¥è¿›è¡Œè§‚å¯Ÿ, è¯„ä¼°.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, å®é™…ä¸Š, è¿™äº›æŒ‡æ ‡åœ¨è€ƒå¯Ÿç£ç›˜æ€§èƒ½æ—¶æ›´å®¹æ˜“è§åˆ°, å› ä¸º Linux ä¸ºç£ç›˜æ€§èƒ½æä¾›äº†æ›´è¯¦ç»†çš„æ•°æ®.")]),s._v(" "),a("h6",{attrs:{id:"_2-ç£ç›˜i-oæ€§èƒ½æŒ‡æ ‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç£ç›˜i-oæ€§èƒ½æŒ‡æ ‡"}},[s._v("#")]),s._v(" (2)ç£ç›˜I/Oæ€§èƒ½æŒ‡æ ‡")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±æ¥å…·ä½“çœ‹çœ‹, "),a("strong",[s._v("å“ªäº›æ€§èƒ½æŒ‡æ ‡å¯ä»¥è¡¡é‡ç£ç›˜ I/O çš„æ€§èƒ½")]),s._v(".")]),s._v(" "),a("p",[s._v("åœ¨ç£ç›˜ I/O åŸç†çš„æ–‡ç« ä¸­, æ›¾æåˆ°è¿‡å››ä¸ªæ ¸å¿ƒçš„ç£ç›˜ I/O æŒ‡æ ‡.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä½¿ç”¨ç‡")]),s._v(", æ˜¯æŒ‡ç£ç›˜å¿™å¤„ç† I/O è¯·æ±‚çš„ç™¾åˆ†æ¯”. è¿‡é«˜çš„ä½¿ç”¨ç‡(æ¯”å¦‚è¶…è¿‡ 60%)é€šå¸¸æ„å‘³ç€ç£ç›˜ I/O å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("li",[a("strong",[s._v("IOPS")]),s._v("(Input/Output Per Second), æ˜¯æŒ‡æ¯ç§’çš„ I/O è¯·æ±‚æ•°.")]),s._v(" "),a("li",[a("strong",[s._v("ååé‡")]),s._v(", æ˜¯æŒ‡æ¯ç§’çš„ I/O è¯·æ±‚å¤§å°.")]),s._v(" "),a("li",[a("strong",[s._v("å“åº”æ—¶é—´")]),s._v(", æ˜¯æŒ‡ä»å‘å‡º I/O è¯·æ±‚åˆ°æ”¶åˆ°å“åº”çš„é—´éš”æ—¶é—´.")])]),s._v(" "),a("p",[s._v("è€ƒå¯Ÿè¿™äº›æŒ‡æ ‡æ—¶, ä¸€å®šè¦æ³¨æ„ç»¼åˆ I/O çš„å…·ä½“åœºæ™¯æ¥åˆ†æ, æ¯”å¦‚"),a("strong",[s._v("è¯»å†™ç±»å‹(é¡ºåºè¿˜æ˜¯éšæœº), è¯»å†™æ¯”ä¾‹, è¯»å†™å¤§å°, å­˜å‚¨ç±»å‹(æœ‰æ—  RAID ä»¥åŠ RAID çº§åˆ«, æœ¬åœ°å­˜å‚¨è¿˜æ˜¯ç½‘ç»œå­˜å‚¨)")]),s._v(" ç­‰. ä¸è¿‡, è¿™é‡Œæœ‰ä¸ªå¤§å¿Œ, å°±æ˜¯æŠŠä¸åŒåœºæ™¯çš„ I/O æ€§èƒ½æŒ‡æ ‡, ç›´æ¥è¿›è¡Œåˆ†æå¯¹æ¯”. è¿™æ˜¯å¾ˆå¸¸è§çš„ä¸€ä¸ªè¯¯åŒº, ä¸€å®šè¦é¿å….")]),s._v(" "),a("p",[s._v("é™¤äº†è¿™äº›æŒ‡æ ‡å¤–, åœ¨å‰é¢ Cache å’Œ Buffer åŸç†çš„æ–‡ç« ä¸­, æ›¾å¤šæ¬¡æåˆ°, "),a("strong",[s._v("ç¼“å†²åŒº(Buffer)")]),s._v(" ä¹Ÿæ˜¯è¦é‡ç‚¹æŒæ¡çš„æŒ‡æ ‡, å®ƒç»å¸¸å‡ºç°åœ¨å†…å­˜å’Œç£ç›˜é—®é¢˜çš„åˆ†æä¸­.")]),s._v(" "),a("p",[s._v("æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O çš„è¿™äº›æŒ‡æ ‡éƒ½å¾ˆæœ‰ç”¨, éœ€è¦ç†Ÿç»ƒæŒæ¡, ä¸‹é¢æ€»ç»“æˆäº†ä¸€å¼ å›¾, å¯ä»¥åˆ†ç±»å’Œè®°å¿†.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/42062990908f7ed3790f4d43b0680b90-20230731161933-lpggspe.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_2-æ€§èƒ½å·¥å…·-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ€§èƒ½å·¥å…·-2"}},[s._v("#")]),s._v(" 2.æ€§èƒ½å·¥å…·")]),s._v(" "),a("p",[s._v("æŒæ¡æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O çš„æ€§èƒ½æŒ‡æ ‡å, è¿˜è¦çŸ¥é“æ€æ ·å»è·å–è¿™äº›æŒ‡æ ‡, ä¹Ÿå°±æ˜¯ææ˜ç™½å·¥å…·çš„ä½¿ç”¨é—®é¢˜.")]),s._v(" "),a("p",[s._v("è¿˜è®°å¾—å‰é¢çš„åŸºç¡€ç¯‡å’Œæ¡ˆä¾‹ç¯‡ä¸­, éƒ½åˆ†åˆ«ç”¨äº†å“ªäº›å·¥å…·å—? ä¸‹é¢ä¸€èµ·å›é¡¾ä¸‹è¿™äº›å†…å®¹.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€, åœ¨æ–‡ä»¶ç³»ç»Ÿçš„åŸç†ä¸­, ä»‹ç»äº†"),a("strong",[s._v("æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿå®¹é‡çš„å·¥å…· df. å®ƒæ—¢å¯ä»¥æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿæ•°æ®çš„ç©ºé—´å®¹é‡, ä¹Ÿå¯ä»¥æŸ¥çœ‹ç´¢å¼•èŠ‚ç‚¹çš„å®¹é‡")]),s._v(". è‡³äºæ–‡ä»¶ç³»ç»Ÿç¼“å­˜, é€šè¿‡ "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹, "),a("code",[s._v("/proc/slabinfo")]),s._v("â€‹ ä»¥åŠ slabtop ç­‰å„ç§æ¥æº, è§‚å¯Ÿé¡µç¼“å­˜, ç›®å½•é¡¹ç¼“å­˜, ç´¢å¼•èŠ‚ç‚¹ç¼“å­˜ä»¥åŠå…·ä½“æ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜æƒ…å†µ.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒ, åœ¨ç£ç›˜ I/O çš„åŸç†ä¸­, åˆ†åˆ«"),a("strong",[s._v("ç”¨ iostat å’Œ pidstat è§‚å¯Ÿäº†ç£ç›˜å’Œè¿›ç¨‹çš„ I/O æƒ…å†µ")]),s._v(". å®ƒä»¬éƒ½æ˜¯æœ€å¸¸ç”¨çš„ I/O æ€§èƒ½åˆ†æå·¥å…·. "),a("strong",[s._v("é€šè¿‡ iostat, å¯ä»¥å¾—åˆ°ç£ç›˜çš„ I/O ä½¿ç”¨ç‡, ååé‡, å“åº”æ—¶é—´ä»¥åŠ IOPS ç­‰æ€§èƒ½æŒ‡æ ‡; è€Œé€šè¿‡ pidstat, åˆ™å¯ä»¥è§‚å¯Ÿåˆ°è¿›ç¨‹çš„ I/O ååé‡ä»¥åŠå—è®¾å¤‡ I/O çš„å»¶è¿Ÿç­‰")]),s._v(".")]),s._v(" "),a("p",[s._v("ç¬¬ä¸‰, åœ¨ç‹‚æ‰“æ—¥å¿—çš„æ¡ˆä¾‹ä¸­, å…ˆç”¨ top æŸ¥çœ‹ç³»ç»Ÿçš„ CPU ä½¿ç”¨æƒ…å†µ, å‘ç° iowait æ¯”è¾ƒé«˜; ç„¶å, åˆ"),a("strong",[s._v("ç”¨ iostat å‘ç°äº†ç£ç›˜çš„ I/O ä½¿ç”¨ç‡ç“¶é¢ˆ, å¹¶ç”¨ pidstat æ‰¾å‡ºäº†å¤§é‡ I/O çš„è¿›ç¨‹; æœ€å, é€šè¿‡ strace å’Œ lsof æ‰¾å‡ºäº†é—®é¢˜è¿›ç¨‹æ­£åœ¨è¯»å†™çš„æ–‡ä»¶")]),s._v(", å¹¶æœ€ç»ˆé”å®šæ€§èƒ½é—®é¢˜çš„æ¥æº--åŸæ¥æ˜¯è¿›ç¨‹åœ¨ç‹‚æ‰“æ—¥å¿—.")]),s._v(" "),a("p",[s._v("ç¬¬å››, åœ¨ç£ç›˜ I/O å»¶è¿Ÿçš„å•è¯çƒ­åº¦æ¡ˆä¾‹ä¸­, åŒæ ·å…ˆç”¨ top, iostat , å‘ç°ç£ç›˜æœ‰ I/O ç“¶é¢ˆ, å¹¶ç”¨ pidstat æ‰¾å‡ºäº†å¤§é‡ I/O çš„è¿›ç¨‹. å¯æ¥ä¸‹æ¥, æƒ³è¦ç…§æ¬ä¸Šæ¬¡æ“ä½œå°±å¤±è´¥äº†. åœ¨éšåçš„ strace å‘½ä»¤ä¸­, å±…ç„¶æ²¡çœ‹åˆ° write ç³»ç»Ÿè°ƒç”¨. äºæ˜¯å°±æ¢äº†ä¸€ä¸ªæ€è·¯, ç”¨æ–°å·¥å…· filetop å’Œ opensnoop , ä»å†…æ ¸ä¸­è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨, æœ€ç»ˆæ‰¾å‡ºç“¶é¢ˆçš„æ¥æº.")]),s._v(" "),a("p",[s._v("æœ€å, åœ¨ MySQL å’Œ Redis çš„æ¡ˆä¾‹ä¸­, åŒæ ·çš„æ€è·¯, å…ˆç”¨ top, iostat ä»¥åŠ pidstat, ç¡®å®šå¹¶æ‰¾å‡º I/O æ€§èƒ½é—®é¢˜çš„ç“¶é¢ˆæ¥æº, å®ƒä»¬æ­£æ˜¯ mysqld å’Œ redis-server. éšååˆç”¨ strace+lsof æ‰¾å‡ºäº†å®ƒä»¬æ­£åœ¨è¯»å†™çš„æ–‡ä»¶. å…³äº MySQL æ¡ˆä¾‹, æ ¹æ® mysqld æ­£åœ¨è¯»å†™çš„æ–‡ä»¶è·¯å¾„, å†ç»“åˆ MySQL æ•°æ®åº“å¼•æ“çš„åŸç†, ä¸ä»…æ‰¾å‡ºäº†æ•°æ®åº“å’Œæ•°æ®è¡¨çš„åç§°, è¿˜è¿›ä¸€æ­¥å‘ç°äº†æ…¢æŸ¥è¯¢çš„é—®é¢˜, æœ€ç»ˆé€šè¿‡ä¼˜åŒ–ç´¢å¼•è§£å†³äº†æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("è‡³äº Redis æ¡ˆä¾‹, æ ¹æ® redis-server è¯»å†™çš„æ–‡ä»¶, ä»¥åŠæ­£åœ¨è¿›è¡Œç½‘ç»œé€šä¿¡çš„ TCP Socket, å†ç»“åˆ Redis çš„å·¥ä½œåŸç†, å‘ç° Redis æŒä¹…åŒ–é€‰é¡¹é…ç½®æœ‰é—®é¢˜; ä» TCP Socket é€šä¿¡çš„æ•°æ®ä¸­, è¿˜å‘ç°äº†å®¢æˆ·ç«¯çš„ä¸åˆç†è¡Œä¸º. äºæ˜¯ä¿®æ”¹ Redis é…ç½®é€‰é¡¹, å¹¶ä¼˜åŒ–äº†å®¢æˆ·ç«¯ä½¿ç”¨ Redis çš„æ–¹å¼, ä»è€Œå‡å°‘ç½‘ç»œé€šä¿¡æ¬¡æ•°, è§£å†³æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("ä¸€ä¸‹å­å¤ä¹ äº†è¿™ä¹ˆå¤š, ä½ æ˜¯ä¸æ˜¯è§‰å¾—å¤´æ˜è„‘èƒ€, å†æ¬¡æƒ³æ„Ÿå¹æ€§èƒ½å·¥å…·çš„ç¹æ‚å‘€! å…¶å®, åªè¦æŠŠç›¸åº”çš„ç³»ç»Ÿå·¥ä½œåŸç†æ‹æ˜ç™½, å·¥å…·ä½¿ç”¨å¹¶ä¸éš¾.")]),s._v(" "),a("h5",{attrs:{id:"_3-æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·çš„è”ç³»-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·çš„è”ç³»-2"}},[s._v("#")]),s._v(" 3.æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·çš„è”ç³»")]),s._v(" "),a("p",[s._v("åŒå‰é¢ CPU å’Œå†…å­˜æ¿å—çš„å­¦ä¹ ä¸€æ ·, å»ºè®®"),a("strong",[s._v("ä»æŒ‡æ ‡å’Œå·¥å…·")]),s._v("ä¸¤ä¸ªä¸åŒç»´åº¦å‡ºå‘, æ•´ç†è®°å¿†.")]),s._v(" "),a("ul",[a("li",[s._v("ä» I/O æŒ‡æ ‡å‡ºå‘, æ›´å®¹æ˜“æŠŠæ€§èƒ½å·¥å…·åŒç³»ç»Ÿå·¥ä½œåŸç†å…³è”èµ·æ¥, å¯¹æ€§èƒ½é—®é¢˜æœ‰å®è§‚çš„è®¤è¯†å’ŒæŠŠæ¡.")]),s._v(" "),a("li",[s._v("è€Œä»æ€§èƒ½å·¥å…·å‡ºå‘, å¯ä»¥æ›´å¿«ä¸Šæ‰‹ä½¿ç”¨å·¥å…·, è¿…é€Ÿæ‰¾å‡ºæƒ³è§‚å¯Ÿçš„æ€§èƒ½æŒ‡æ ‡. ç‰¹åˆ«æ˜¯åœ¨å·¥å…·æœ‰é™çš„æƒ…å†µä¸‹, æ›´è¦å……åˆ†åˆ©ç”¨å¥½æ‰‹å¤´çš„æ¯ä¸€ä¸ªå·¥å…·, å°‘é‡å·¥å…·ä¹Ÿè¦å°½åŠ›æŒ–æ˜å‡ºå¤§é‡ä¿¡æ¯.")])]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸€ä¸ªç»´åº¦, ä»æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O çš„æ€§èƒ½æŒ‡æ ‡å‡ºå‘. æ¢å¥è¯è¯´, å½“æƒ³æŸ¥çœ‹æŸä¸ªæ€§èƒ½æŒ‡æ ‡æ—¶, è¦æ¸…æ¥šçŸ¥é“, å“ªäº›å·¥å…·å¯ä»¥åšåˆ°.")])]),s._v(" "),a("p",[s._v("æ ¹æ®ä¸åŒçš„æ€§èƒ½æŒ‡æ ‡, å¯¹æä¾›æŒ‡æ ‡çš„æ€§èƒ½å·¥å…·è¿›è¡Œåˆ†ç±»å’Œç†è§£. è¿™æ ·åœ¨å®é™…æ’æŸ¥æ€§èƒ½é—®é¢˜æ—¶, å°±å¯ä»¥æ¸…æ¥šçŸ¥é“, ä»€ä¹ˆå·¥å…·å¯ä»¥æä¾›æƒ³è¦çš„æŒ‡æ ‡, è€Œä¸æ˜¯æ¯«æ— æ ¹æ®åœ°æŒ¨ä¸ªå°è¯•, æ’è¿æ°”.")]),s._v(" "),a("p",[s._v("è™½ç„¶ä¸éœ€è¦æŠŠæ‰€æœ‰ç›¸å…³çš„å·¥å…·èƒŒä¸‹æ¥, ä½†å¦‚æœèƒ½è®°æ¸…æ¥šæ¯ä¸ªæŒ‡æ ‡å¯¹åº”çš„å·¥å…·ç‰¹æ€§, å®é™…æ“ä½œèµ·æ¥, ä¸€å®šèƒ½æ›´é«˜æ•ˆ, çµæ´». è¿™é‡ŒæŠŠ I/O æ€§èƒ½æŒ‡æ ‡çš„å·¥å…·åšæˆäº†ä¸€ä¸ªè¡¨æ ¼, æ–¹ä¾¿æ¢³ç†å…³ç³»å’Œç†è§£è®°å¿†.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/bd7029420118e1263365b11289c37518-20230731161933-bzuttwv.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¸‹é¢å†æ¥çœ‹ç¬¬äºŒä¸ªç»´åº¦.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äºŒä¸ªç»´åº¦, ä»å·¥å…·å‡ºå‘. ä¹Ÿå°±æ˜¯å½“å·²ç»å®‰è£…äº†æŸä¸ªå·¥å…·å, è¦çŸ¥é“è¿™ä¸ªå·¥å…·èƒ½æä¾›å“ªäº›æŒ‡æ ‡.")])]),s._v(" "),a("p",[s._v("è¿™åœ¨å®é™…ç¯å¢ƒä¸­, ç‰¹åˆ«æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿæ˜¯éå¸¸é‡è¦çš„. å› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹, ä½ å¹¶æ²¡æœ‰æƒé™å®‰è£…æ–°çš„å·¥å…·åŒ…, åªèƒ½æœ€å¤§åŒ–åœ°åˆ©ç”¨å¥½ç³»ç»Ÿå·²æœ‰çš„å·¥å…·, è€Œè¿™å°±éœ€è¦ä½ å¯¹å®ƒä»¬æœ‰è¶³å¤Ÿçš„äº†è§£. å…·ä½“åˆ°æ¯ä¸ªå·¥å…·çš„ä½¿ç”¨æ–¹æ³•, ä¸€èˆ¬éƒ½æ”¯æŒä¸°å¯Œçš„é…ç½®é€‰é¡¹. ä¸è¿‡ä¸ç”¨æ‹…å¿ƒ, è¿™äº›é…ç½®é€‰é¡¹å¹¶ä¸ç”¨èƒŒä¸‹æ¥. ä½ åªè¦çŸ¥é“æœ‰å“ªäº›å·¥å…·, ä»¥åŠè¿™äº›å·¥å…·çš„åŸºæœ¬åŠŸèƒ½æ˜¯ä»€ä¹ˆå°±å¤Ÿäº†. çœŸæ­£è¦ç”¨åˆ°çš„æ—¶å€™, é€šè¿‡ man å‘½ä»¤, æŸ¥å®ƒä»¬çš„ä½¿ç”¨æ‰‹å†Œå°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v("åŒæ ·çš„, ä¹Ÿå°†è¿™äº›å¸¸ç”¨å·¥å…·æ±‡æ€»æˆäº†ä¸€ä¸ªè¡¨æ ¼, æ–¹ä¾¿åŒºåˆ†å’Œç†è§£.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/aa14525940e72cf50b5d1e36d0fecc02-20230731161933-pahi0ao.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_4-å¦‚ä½•è¿…é€Ÿåˆ†æi-oçš„æ€§èƒ½ç“¶é¢ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å¦‚ä½•è¿…é€Ÿåˆ†æi-oçš„æ€§èƒ½ç“¶é¢ˆ"}},[s._v("#")]),s._v(" 4.å¦‚ä½•è¿…é€Ÿåˆ†æI/Oçš„æ€§èƒ½ç“¶é¢ˆ")]),s._v(" "),a("p",[s._v("æ¯”èµ·å‰ä¸¤ä¸ªæ¿å—, è™½ç„¶æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜çš„ I/O æ€§èƒ½æŒ‡æ ‡ä»æ¯”è¾ƒå¤š, ä½†æ ¸å¿ƒçš„æ€§èƒ½å·¥å…·, å…¶å®å°±æ˜¯é‚£ä¹ˆå‡ ä¸ª. ç†Ÿç»ƒæŒæ¡å®ƒä»¬, å†æ ¹æ®å®é™…ç³»ç»Ÿçš„ç°è±¡, å¹¶é…åˆç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„åŸç†, I/O æ€§èƒ½åˆ†æå°±å¾ˆæ¸…æ™°äº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ä¸ç®¡æ€ä¹ˆè¯´, å¦‚æœæ¯æ¬¡ä¸€ç¢°åˆ° I/O çš„æ€§èƒ½é—®é¢˜, å°±æŠŠä¸Šé¢æåˆ°çš„æ‰€æœ‰å·¥å…·è·‘ä¸€é, è‚¯å®šæ˜¯ä¸ç°å®çš„. åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­, éœ€è¦å°½å¯èƒ½"),a("strong",[s._v("å¿«")]),s._v("åœ°å®šä½ç³»ç»Ÿçš„ç“¶é¢ˆ, ç„¶åå°½å¯èƒ½"),a("strong",[s._v("å¿«")]),s._v("åœ°ä¼˜åŒ–æ€§èƒ½, ä¹Ÿå°±æ˜¯è¦åˆå¿«åˆå‡†åœ°è§£å†³æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•, å¯ä»¥åˆå¿«åˆå‡†åœ°æ‰¾å‡ºç³»ç»Ÿçš„ I/O ç“¶é¢ˆå‘¢? ç­”æ¡ˆæ˜¯è‚¯å®šçš„.")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯é‚£å¥è¯, "),a("mark",[a("strong",[s._v("æ‰¾å…³è”")])]),s._v(". å¤šç§æ€§èƒ½æŒ‡æ ‡é—´éƒ½æœ‰ä¸€å®šçš„å…³è”æ€§, ä¸è¦å®Œå…¨å­¤ç«‹çš„çœ‹å¾…ä»–ä»¬. "),a("strong",[s._v("æƒ³å¼„æ¸…æ¥šæ€§èƒ½æŒ‡æ ‡çš„å…³è”æ€§, å°±è¦é€šæ™“æ¯ç§æ€§èƒ½æŒ‡æ ‡çš„å·¥ä½œåŸç†")]),s._v(". è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ä»‹ç»æ¯ä¸ªæ€§èƒ½æŒ‡æ ‡æ—¶, éƒ½è¦ç©¿æ’è®²è§£ç›¸å…³çš„ç³»ç»ŸåŸç†.")]),s._v(" "),a("p",[s._v("ä»¥å‰é¢å‡ æœŸçš„æ¡ˆä¾‹ä¸ºä¾‹, å¦‚æœä»”ç»†å¯¹æ¯”å‰é¢çš„å‡ ä¸ªæ¡ˆä¾‹, ä» I/O å»¶è¿Ÿçš„æ¡ˆä¾‹åˆ° MySQL å’Œ Redis çš„æ¡ˆä¾‹, å°±ä¼šå‘ç°, è™½ç„¶è¿™äº›é—®é¢˜åƒå·®ä¸‡åˆ«, ä½†ä» I/O è§’åº¦æ¥åˆ†æ, æœ€å¼€å§‹çš„åˆ†ææ€è·¯åŸºæœ¬ä¸Šç±»ä¼¼, éƒ½æ˜¯:")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("å…ˆç”¨ iostat å‘ç°ç£ç›˜ I/O æ€§èƒ½ç“¶é¢ˆ;")])]),s._v(" "),a("li",[a("strong",[s._v("å†å€ŸåŠ© pidstat, å®šä½å‡ºå¯¼è‡´ç“¶é¢ˆçš„è¿›ç¨‹;")])]),s._v(" "),a("li",[a("strong",[s._v("éšååˆ†æè¿›ç¨‹çš„ I/O è¡Œä¸º;")])]),s._v(" "),a("li",[a("strong",[s._v("æœ€åç»“åˆåº”ç”¨ç¨‹åºçš„åŸç†, åˆ†æè¿™äº› I/O çš„æ¥æº.")])])]),s._v(" "),a("p",[a("strong",[s._v("æ‰€ä»¥, ä¸ºäº†ç¼©å°æ’æŸ¥èŒƒå›´, é€šå¸¸ä¼šå…ˆè¿è¡Œé‚£å‡ ä¸ªæ”¯æŒæŒ‡æ ‡è¾ƒå¤šçš„å·¥å…·, å¦‚ iostat, vmstat, pidstat ç­‰.")]),s._v("  ç„¶åå†æ ¹æ®è§‚å¯Ÿåˆ°çš„ç°è±¡, ç»“åˆç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„åŸç†, å¯»æ‰¾ä¸‹ä¸€æ­¥çš„åˆ†ææ–¹å‘. ä¸‹é¢æŠŠè¿™ä¸ªè¿‡ç¨‹ç”»æˆäº†ä¸€å¼ å›¾.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/86c905a3f71b9a5f9a1358d64d2327cb-20230731161933-55t6s4j.png",alt:""}})]),s._v(" "),a("p",[s._v("å›¾ä¸­åˆ—å‡ºäº†æœ€å¸¸ç”¨çš„å‡ ä¸ªæ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O æ€§èƒ½åˆ†æå·¥å…·, ä»¥åŠç›¸åº”çš„åˆ†ææµç¨‹, ç®­å¤´åˆ™è¡¨ç¤ºåˆ†ææ–¹å‘. è¿™å…¶ä¸­, iostat, vmstat, pidstat æ˜¯æœ€æ ¸å¿ƒçš„å‡ ä¸ªæ€§èƒ½å·¥å…·, å®ƒä»¬ä¹Ÿæä¾›äº†æœ€é‡è¦çš„ I/O æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("p",[s._v("è¿™ä¸ªå›¾ä¸­åªåˆ—å‡ºäº†æœ€æ ¸å¿ƒçš„å‡ ä¸ªæ€§èƒ½å·¥å…·, å¹¶æ²¡æœ‰åˆ—å‡ºå‰é¢è¡¨æ ¼ä¸­çš„æ‰€æœ‰å·¥å…·. è¿™ä¹ˆåš, ä¸€æ–¹é¢æ˜¯ä¸æƒ³ç”¨å¤§é‡çš„å·¥å…·åˆ—è¡¨å“åˆ°ä½ . åœ¨å­¦ä¹ ä¹‹åˆå°±æ¥è§¦æ‰€æœ‰æ ¸å¿ƒæˆ–å°ä¼—çš„å·¥å…·, ä¸è§å¾—æ˜¯å¥½äº‹. å¦ä¸€æ–¹é¢, ä¹Ÿæ˜¯å¸Œæœ›ä½ èƒ½å…ˆæŠŠé‡å¿ƒæ”¾åœ¨æ ¸å¿ƒå·¥å…·ä¸Š, æ¯•ç«Ÿç†Ÿç»ƒæŒæ¡å®ƒä»¬, å°±å¯ä»¥è§£å†³å¤§å¤šæ•°é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“-7"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å¤ä¹ äº†å¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O æ€§èƒ½æŒ‡æ ‡, æ¢³ç†äº†å¸¸è§çš„ I/O æ€§èƒ½è§‚æµ‹å·¥å…·, å¹¶å»ºç«‹äº†æ€§èƒ½æŒ‡æ ‡å’Œå·¥å…·çš„å…³è”. æœ€åè¿˜æ€»ç»“äº†å¿«é€Ÿåˆ†æ I/O æ€§èƒ½é—®é¢˜çš„æ€è·¯.")]),s._v(" "),a("h4",{attrs:{id:"_31-å¥—è·¯ç¯‡-ç£ç›˜i-oæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_31-å¥—è·¯ç¯‡-ç£ç›˜i-oæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯"}},[s._v("#")]),s._v(" 31-å¥—è·¯ç¯‡:ç£ç›˜I/Oæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚å›é¡¾äº†å¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O æ€§èƒ½æŒ‡æ ‡, æ¢³ç†äº†æ ¸å¿ƒçš„ I/O æ€§èƒ½è§‚æµ‹å·¥å…·, æœ€åè¿˜æ€»ç»“äº†å¿«é€Ÿåˆ†æ I/O æ€§èƒ½é—®é¢˜çš„æ€è·¯.")]),s._v(" "),a("p",[s._v("è™½ç„¶ I/O çš„æ€§èƒ½æŒ‡æ ‡å¾ˆå¤š, ç›¸åº”çš„æ€§èƒ½åˆ†æå·¥å…·ä¹Ÿæœ‰å¥½å‡ ä¸ª, ä½†ç†è§£äº†å„ç§æŒ‡æ ‡çš„å«ä¹‰å, å°±ä¼šå‘ç°å®ƒä»¬å…¶å®éƒ½æœ‰ä¸€å®šçš„å…³è”. é¡ºç€è¿™äº›å…³ç³»å¾€ä¸‹ç†è§£, å°±ä¼šå‘ç°æŒæ¡è¿™äº›å¸¸ç”¨çš„ç“¶é¢ˆåˆ†ææ€è·¯, å…¶å®å¹¶ä¸éš¾.")]),s._v(" "),a("p",[s._v("æ‰¾å‡ºäº† I/O çš„æ€§èƒ½ç“¶é¢ˆå, ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯ä¼˜åŒ–äº†, ä¹Ÿå°±æ˜¯"),a("strong",[s._v("å¦‚ä½•ä»¥æœ€å¿«çš„é€Ÿåº¦å®Œæˆ I/O æ“ä½œ, æˆ–è€…æ¢ä¸ªæ€è·¯, å‡å°‘ç”šè‡³é¿å…ç£ç›˜çš„ I/O æ“ä½œ")]),s._v(".")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å°±æ¥è¯´è¯´, "),a("strong",[s._v("ä¼˜åŒ– I/O æ€§èƒ½é—®é¢˜çš„æ€è·¯å’Œæ³¨æ„äº‹é¡¹")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-i-oåŸºå‡†æµ‹è¯•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-i-oåŸºå‡†æµ‹è¯•"}},[s._v("#")]),s._v(" 1.I/OåŸºå‡†æµ‹è¯•")]),s._v(" "),a("p",[s._v("æŒ‰ç…§æˆ‘çš„ä¹ æƒ¯, ä¼˜åŒ–ä¹‹å‰, æˆ‘ä¼šå…ˆé—®è‡ªå·±, I/O æ€§èƒ½"),a("mark",[a("strong",[s._v("ä¼˜åŒ–çš„ç›®æ ‡æ˜¯ä»€ä¹ˆ")])]),s._v("? æ¢å¥è¯è¯´, è¿™äº› I/O æ€§èƒ½æŒ‡æ ‡(æ¯”å¦‚ IOPS, ååé‡, å»¶è¿Ÿç­‰), è¦è¾¾åˆ°å¤šå°‘æ‰åˆé€‚å‘¢?")]),s._v(" "),a("p",[s._v("äº‹å®ä¸Š, I/O æ€§èƒ½æŒ‡æ ‡çš„å…·ä½“æ ‡å‡†, æ¯ä¸ªäººä¼°è®¡ä¼šæœ‰ä¸åŒçš„ç­”æ¡ˆ, å› ä¸ºæ¯ä¸ªäººçš„åº”ç”¨åœºæ™¯, ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿå’Œç‰©ç†ç£ç›˜ç­‰, éƒ½æœ‰å¯èƒ½ä¸ä¸€æ ·. ä¸ºäº†æ›´å®¢è§‚åˆç†åœ°è¯„ä¼°ä¼˜åŒ–æ•ˆæœ, "),a("strong",[s._v("é¦–å…ˆåº”è¯¥å¯¹ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿè¿›è¡ŒåŸºå‡†æµ‹è¯•, å¾—åˆ°æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç£ç›˜ I/O çš„æé™æ€§èƒ½")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("fio(Flexible I/O Tester)æ­£æ˜¯æœ€å¸¸ç”¨çš„æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·")]),s._v(". å®ƒæä¾›äº†å¤§é‡çš„å¯å®šåˆ¶åŒ–é€‰é¡¹, å¯ä»¥ç”¨æ¥æµ‹è¯•, è£¸ç›˜æˆ–è€…æ–‡ä»¶ç³»ç»Ÿåœ¨å„ç§åœºæ™¯ä¸‹çš„ I/O æ€§èƒ½, åŒ…æ‹¬äº†ä¸åŒå—å¤§å°, ä¸åŒ I/O å¼•æ“ä»¥åŠæ˜¯å¦ä½¿ç”¨ç¼“å­˜ç­‰åœºæ™¯.")]),s._v(" "),a("p",[s._v("fio çš„é€‰é¡¹éå¸¸å¤š, ä¸‹é¢ä¼šé€šè¿‡å‡ ä¸ªå¸¸è§åœºæ™¯çš„æµ‹è¯•æ–¹æ³•, ä»‹ç»ä¸€äº›æœ€å¸¸ç”¨çš„é€‰é¡¹. è¿™äº›å¸¸è§åœºæ™¯åŒ…æ‹¬éšæœºè¯», éšæœºå†™, é¡ºåºè¯»ä»¥åŠé¡ºåºå†™ç­‰, å¯ä»¥æ‰§è¡Œä¸‹é¢è¿™äº›å‘½ä»¤æ¥æµ‹è¯•:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# éšæœºè¯»")]),s._v("\nfio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("randread "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-direct")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-iodepth")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rw")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("randread "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ioengine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("libaio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4k "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1G "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-numjobs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-runtime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-group_reporting")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sdb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# éšæœºå†™")]),s._v("\nfio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("randwrite "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-direct")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-iodepth")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rw")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("randwrite "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ioengine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("libaio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4k "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1G "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-numjobs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-runtime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-group_reporting")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sd \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é¡ºåºè¯»")]),s._v("\nfio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("read "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-direct")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-iodepth")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rw")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("read "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ioengine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("libaio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4k "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1G "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-numjobs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-runtime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-group_reporting")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sdb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é¡ºåºå†™")]),s._v("\nfio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("write "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-direct")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-iodepth")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rw")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("write "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ioengine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("libaio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4k "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1G "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-numjobs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-runtime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-group_reporting")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sdb \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("åœ¨è¿™å…¶ä¸­, æœ‰å‡ ä¸ªå‚æ•°éœ€è¦é‡ç‚¹å…³æ³¨ä¸€ä¸‹.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("direct, è¡¨ç¤ºæ˜¯å¦è·³è¿‡ç³»ç»Ÿç¼“å­˜")]),s._v(". ä¸Šé¢ç¤ºä¾‹ä¸­è®¾ç½®çš„ 1, å°±è¡¨ç¤ºè·³è¿‡ç³»ç»Ÿç¼“å­˜.")]),s._v(" "),a("li",[a("strong",[s._v("iodepth, è¡¨ç¤ºä½¿ç”¨å¼‚æ­¥ I/O(asynchronous I/O, ç®€ç§° AIO)æ—¶, åŒæ—¶å‘å‡ºçš„ I/O è¯·æ±‚ä¸Šé™")]),s._v(". åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­è®¾ç½®çš„æ˜¯ 64.")]),s._v(" "),a("li",[a("strong",[s._v("rw, è¡¨ç¤º I/O æ¨¡å¼")]),s._v(". ç¤ºä¾‹ä¸­, read/write åˆ†åˆ«è¡¨ç¤ºé¡ºåºè¯»/å†™, è€Œ randread/randwrite åˆ™åˆ†åˆ«è¡¨ç¤ºéšæœºè¯»/å†™.")]),s._v(" "),a("li",[a("strong",[s._v("ioengine, è¡¨ç¤º I/O å¼•æ“, å®ƒæ”¯æŒåŒæ­¥(sync), å¼‚æ­¥(libaio), å†…å­˜æ˜ å°„(mmap), ç½‘ç»œ(net)ç­‰å„ç§ I/O å¼•æ“")]),s._v(". ä¸Šé¢ç¤ºä¾‹ä¸­è®¾ç½®çš„ libaio è¡¨ç¤ºä½¿ç”¨å¼‚æ­¥ I/O.")]),s._v(" "),a("li",[a("strong",[s._v("bs, è¡¨ç¤º I/O çš„å¤§å°")]),s._v(". ç¤ºä¾‹ä¸­è®¾ç½®æˆäº† 4K(è¿™ä¹Ÿæ˜¯é»˜è®¤å€¼).")]),s._v(" "),a("li",[a("strong",[s._v("filename, è¡¨ç¤ºæ–‡ä»¶è·¯å¾„")]),s._v(", å½“ç„¶, å®ƒå¯ä»¥æ˜¯ç£ç›˜è·¯å¾„(æµ‹è¯•ç£ç›˜æ€§èƒ½), ä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶è·¯å¾„(æµ‹è¯•æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½). ç¤ºä¾‹ä¸­å®ƒè®¾ç½®æˆäº†ç£ç›˜ "),a("code",[s._v("/dev/sdb")]),s._v("â€‹. ä¸è¿‡æ³¨æ„, ç”¨ç£ç›˜è·¯å¾„æµ‹è¯•å†™, ä¼šç ´åè¿™ä¸ªç£ç›˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿ, æ‰€ä»¥åœ¨ä½¿ç”¨å‰, ä¸€å®šè¦äº‹å…ˆåšå¥½æ•°æ®å¤‡ä»½.")])]),s._v(" "),a("p",[s._v("ä¸‹é¢å°±æ˜¯ä½¿ç”¨ fio æµ‹è¯•é¡ºåºè¯»çš„ä¸€ä¸ªæŠ¥å‘Šç¤ºä¾‹.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("read: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("g"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rw")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("read, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("R"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 4096B-4096B, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("W"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 4096B-4096B, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("T"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 4096B-4096B, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ioengine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("libaio, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("iodepth")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\nfio-3.1\nStarting "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" process\nJobs: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("R"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("r"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(".7MiB/s,w"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0KiB/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("r"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4280")]),s._v(",w"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" IOPS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("eta 00m:00s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nread: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("groupid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jobs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17966")]),s._v(": Sun Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" 08:31:48 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\n   read: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IOPS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4257")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BW")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(".6MiB/s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".4MB/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1024MiB/61568msec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    slat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("usec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2566")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("avg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.29")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.76")]),s._v("\n    clat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("usec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("228")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("407360")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("avg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15024.30")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20524.39")]),s._v("\n     lat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("usec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("243")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("407363")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("avg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15029.12")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20524.26")]),s._v("\n    clat percentiles "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("usec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("1.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("498")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("5.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1020")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("10.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1319")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("20.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1713")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("30.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1991")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("40.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2212")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("50.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2540")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("60.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2933")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("70.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5407")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("80.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44303")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("90.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45351")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("95.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45876")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("99.00th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46924")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("99.50th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46924")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("99.90th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48497")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("99.95th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49021")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("99.99th")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404751")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   bw "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("  KiB/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8208")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18832")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("per")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.85")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("avg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17005.35")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("998.94")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("samples")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n   iops        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2052")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4708")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("avg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4251.30")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("249.74")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("samples")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n  lat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("usec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("250")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("500")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.03")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("750")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.69")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.07")]),s._v("%\n  lat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.64")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37.58")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.08")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29.86")]),s._v("%\n  lat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("500")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v("%\n  cpu          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("usr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.02")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sys")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.97")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ctx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33312")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("majf")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minf")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("\n  IO depths    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("32")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%\n     submit    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("32")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%\n     complete  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("32")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%\n     issued rwt: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("total")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144,0")]),s._v(",0, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("short")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v(",0, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dropped")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v(",0\n     latency   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("window")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("percentile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("%, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("depth")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n \nRun status group "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("all "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n   READ: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bw")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(".6MiB/s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".4MB/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(".6MiB/s-16.6MiB/s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".4MB/s-17.4MB/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("io")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1024MiB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1074MB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61568")]),s._v("-61568msec\n \nDisk stats "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("read/write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n  sdb: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ios")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("261897")]),s._v("/0, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("merge")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/0, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ticks")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3912108")]),s._v("/0, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("in_queue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3474336")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("util")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90.09")]),s._v("% \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("è¿™ä¸ªæŠ¥å‘Šä¸­, éœ€è¦é‡ç‚¹å…³æ³¨çš„æ˜¯, slat, clat, lat, ä»¥åŠ bw å’Œ iops è¿™å‡ è¡Œ.")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹åˆšåˆšæåˆ°çš„å‰ä¸‰ä¸ªå‚æ•°. äº‹å®ä¸Š, "),a("strong",[s._v("slat, clat, lat éƒ½æ˜¯æŒ‡ I/O å»¶è¿Ÿ(latency)")]),s._v(" . ä¸åŒä¹‹å¤„åœ¨äº:")]),s._v(" "),a("ul",[a("li",[s._v("slat æ˜¯æŒ‡ä» I/O æäº¤åˆ°å®é™…æ‰§è¡Œ I/O çš„æ—¶é•¿(Submission latency);")]),s._v(" "),a("li",[s._v("clat æ˜¯æŒ‡ä» I/O æäº¤åˆ° I/O å®Œæˆçš„æ—¶é•¿(Completion latency);")]),s._v(" "),a("li",[s._v("lat æ˜¯æŒ‡ä» fio åˆ›å»º I/O åˆ° I/O å®Œæˆçš„æ€»æ—¶é•¿.")])]),s._v(" "),a("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, å¯¹åŒæ­¥ I/O æ¥è¯´, ç”±äº I/O æäº¤å’Œ I/O å®Œæˆæ˜¯ä¸€ä¸ªåŠ¨ä½œ, æ‰€ä»¥ slat å®é™…ä¸Šå°±æ˜¯ I/O å®Œæˆçš„æ—¶é—´, è€Œ clat æ˜¯ 0. è€Œä»ç¤ºä¾‹å¯ä»¥çœ‹åˆ°, ä½¿ç”¨å¼‚æ­¥ I/O(libaio)æ—¶, lat è¿‘ä¼¼ç­‰äº slat + clat ä¹‹å’Œ.")]),s._v(" "),a("p",[s._v("å†æ¥çœ‹ bw, å®ƒä»£è¡¨ååé‡. åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°, å¹³å‡ååé‡å¤§çº¦æ˜¯ 16 MB(17005 KiB/1024).")]),s._v(" "),a("p",[s._v("æœ€åçš„ iops, å…¶å®å°±æ˜¯æ¯ç§’ I/O çš„æ¬¡æ•°, ä¸Šé¢ç¤ºä¾‹ä¸­çš„å¹³å‡ IOPS ä¸º 4250.")]),s._v(" "),a("p",[s._v("é€šå¸¸æƒ…å†µä¸‹, åº”ç”¨ç¨‹åºçš„ I/O éƒ½æ˜¯è¯»å†™å¹¶è¡Œçš„, è€Œä¸”æ¯æ¬¡çš„ I/O å¤§å°ä¹Ÿä¸ä¸€å®šç›¸åŒ. æ‰€ä»¥, åˆšåˆšè¯´çš„è¿™å‡ ç§åœºæ™¯, å¹¶ä¸èƒ½ç²¾ç¡®æ¨¡æ‹Ÿåº”ç”¨ç¨‹åºçš„ I/O æ¨¡å¼. é‚£æ€ä¹ˆæ‰èƒ½ç²¾ç¡®æ¨¡æ‹Ÿåº”ç”¨ç¨‹åºçš„ I/O æ¨¡å¼å‘¢?")]),s._v(" "),a("p",[s._v("å¹¸è¿çš„æ˜¯, "),a("strong",[s._v("fio æ”¯æŒ I/O çš„é‡æ”¾")]),s._v(". å€ŸåŠ©å‰é¢æåˆ°è¿‡çš„ blktrace, å†é…åˆä¸Š fio, å°±å¯ä»¥å®ç°å¯¹åº”ç”¨ç¨‹åº I/O æ¨¡å¼çš„åŸºå‡†æµ‹è¯•. éœ€è¦å…ˆç”¨ blktrace, è®°å½•ç£ç›˜è®¾å¤‡çš„ I/O è®¿é—®æƒ…å†µ; ç„¶åä½¿ç”¨ fio, é‡æ”¾ blktrace çš„è®°å½•.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ“ä½œ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½¿ç”¨ blktrace è·Ÿè¸ªç£ç›˜ I/O, æ³¨æ„æŒ‡å®šåº”ç”¨ç¨‹åºæ­£åœ¨æ“ä½œçš„ç£ç›˜")]),s._v("\n$ blktrace /dev/sdb\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹ blktrace è®°å½•çš„ç»“æœ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nsdb.blktrace.0  sdb.blktrace.1\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å°†ç»“æœè½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶")]),s._v("\n$ blkparse sdb "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" sdb.bin\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½¿ç”¨ fio é‡æ”¾æ—¥å¿—")]),s._v("\n$ fio "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("replay "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sdb "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--direct")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--read_iolog")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sdb.bin \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("è¿™æ ·å°±é€šè¿‡ blktrace+fio çš„ç»„åˆä½¿ç”¨, å¾—åˆ°äº†"),a("strong",[s._v("åº”ç”¨ç¨‹åº I/O æ¨¡å¼çš„åŸºå‡†æµ‹è¯•æŠ¥å‘Š")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_2-i-oæ€§èƒ½ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-i-oæ€§èƒ½ä¼˜åŒ–"}},[s._v("#")]),s._v(" 2.I/Oæ€§èƒ½ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("å¾—åˆ° I/O åŸºå‡†æµ‹è¯•æŠ¥å‘Šå, å†ç”¨ä¸Šä¸€èŠ‚æ€»ç»“çš„æ€§èƒ½åˆ†æå¥—è·¯, æ‰¾å‡º I/O çš„æ€§èƒ½ç“¶é¢ˆå¹¶ä¼˜åŒ–, å°±æ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…äº†. å½“ç„¶, æƒ³è¦ä¼˜åŒ– I/O æ€§èƒ½, è‚¯å®šç¦»ä¸å¼€ Linux ç³»ç»Ÿçš„ I/O æ ˆå›¾çš„æ€è·¯è¾…åŠ©. å¯ä»¥ç»“åˆä¸‹é¢çš„ I/O æ ˆå›¾å†å›é¡¾ä¸€ä¸‹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/718eb7d89ce098f493d77944019a65a7-20230731161933-3soqp0i.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¸‹é¢å°±ä»"),a("mark",[a("strong",[s._v("åº”ç”¨ç¨‹åº, æ–‡ä»¶ç³»ç»Ÿä»¥åŠç£ç›˜è§’åº¦, åˆ†åˆ«çœ‹çœ‹ I/O æ€§èƒ½ä¼˜åŒ–çš„åŸºæœ¬æ€è·¯")])]),s._v(".")]),s._v(" "),a("h6",{attrs:{id:"_1-åº”ç”¨ç¨‹åºä¼˜åŒ–-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-åº”ç”¨ç¨‹åºä¼˜åŒ–-2"}},[s._v("#")]),s._v(" (1)åº”ç”¨ç¨‹åºä¼˜åŒ–")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ¥çœ‹ä¸€ä¸‹, "),a("strong",[s._v("ä»åº”ç”¨ç¨‹åºçš„è§’åº¦æœ‰å“ªäº›ä¼˜åŒ– I/O çš„æ€è·¯")]),s._v(".")]),s._v(" "),a("p",[s._v("åº”ç”¨ç¨‹åºå¤„äºæ•´ä¸ª I/O æ ˆçš„æœ€ä¸Šç«¯, å®ƒå¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨, æ¥è°ƒæ•´ I/O æ¨¡å¼(å¦‚é¡ºåºè¿˜æ˜¯éšæœº, åŒæ­¥è¿˜æ˜¯å¼‚æ­¥),  åŒæ—¶, å®ƒä¹Ÿæ˜¯ I/O æ•°æ®çš„æœ€ç»ˆæ¥æº. åœ¨æˆ‘çœ‹æ¥, å¯ä»¥æœ‰è¿™ä¹ˆå‡ ç§æ–¹å¼æ¥ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„ I/O æ€§èƒ½.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸€, å¯ä»¥ç”¨è¿½åŠ å†™ä»£æ›¿éšæœºå†™, å‡å°‘å¯»å€å¼€é”€, åŠ å¿« I/O å†™çš„é€Ÿåº¦")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äºŒ, å¯ä»¥å€ŸåŠ©ç¼“å­˜ I/O, å……åˆ†åˆ©ç”¨ç³»ç»Ÿç¼“å­˜, é™ä½å®é™… I/O çš„æ¬¡æ•°")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸‰, å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨æ„å»ºè‡ªå·±çš„ç¼“å­˜, æˆ–è€…ç”¨ Redis è¿™ç±»å¤–éƒ¨ç¼“å­˜ç³»ç»Ÿ")]),s._v(". è¿™æ ·, ä¸€æ–¹é¢èƒ½åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨, æ§åˆ¶ç¼“å­˜çš„æ•°æ®å’Œç”Ÿå‘½å‘¨æœŸ; å¦ä¸€æ–¹é¢, ä¹Ÿèƒ½é™ä½å…¶ä»–åº”ç”¨ç¨‹åºä½¿ç”¨ç¼“å­˜å¯¹è‡ªèº«çš„å½±å“. æ¯”å¦‚, åœ¨å‰é¢çš„ MySQL æ¡ˆä¾‹ä¸­å·²ç»è§è¯†è¿‡, åªæ˜¯å› ä¸ºä¸€ä¸ªå¹²æ‰°åº”ç”¨æ¸…ç†äº†ç³»ç»Ÿç¼“å­˜, å°±ä¼šå¯¼è‡´ MySQL æŸ¥è¯¢æœ‰æ•°ç™¾å€çš„æ€§èƒ½å·®è·(0.1s vs 15s). å†å¦‚, C æ ‡å‡†åº“æä¾›çš„ fopen, fread ç­‰åº“å‡½æ•°, éƒ½ä¼šåˆ©ç”¨æ ‡å‡†åº“çš„ç¼“å­˜, å‡å°‘ç£ç›˜çš„æ“ä½œ. è€Œç›´æ¥ä½¿ç”¨ open, read ç­‰ç³»ç»Ÿè°ƒç”¨æ—¶, å°±åªèƒ½åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„é¡µç¼“å­˜å’Œç¼“å†²åŒºç­‰, è€Œæ²¡æœ‰åº“å‡½æ•°çš„ç¼“å­˜å¯ç”¨.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬å››, åœ¨éœ€è¦é¢‘ç¹è¯»å†™åŒä¸€å—ç£ç›˜ç©ºé—´æ—¶, å¯ä»¥ç”¨ mmap ä»£æ›¿ read/write, å‡å°‘å†…å­˜çš„æ‹·è´æ¬¡æ•°")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äº”, åœ¨éœ€è¦åŒæ­¥å†™çš„åœºæ™¯ä¸­, å°½é‡å°†å†™è¯·æ±‚åˆå¹¶, è€Œä¸æ˜¯è®©æ¯ä¸ªè¯·æ±‚éƒ½åŒæ­¥å†™å…¥ç£ç›˜, å³å¯ä»¥ç”¨ fsync() å–ä»£ O_SYNC")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬å…­, åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºå…±äº«ç›¸åŒç£ç›˜æ—¶, ä¸ºäº†ä¿è¯ I/O ä¸è¢«æŸä¸ªåº”ç”¨å®Œå…¨å ç”¨, æ¨èä½¿ç”¨ cgroups çš„ I/O å­ç³»ç»Ÿ, æ¥é™åˆ¶è¿›ç¨‹/è¿›ç¨‹ç»„çš„ IOPS ä»¥åŠååé‡")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("æœ€å, åœ¨ä½¿ç”¨ CFQ è°ƒåº¦å™¨æ—¶, å¯ä»¥ç”¨ ionice æ¥è°ƒæ•´è¿›ç¨‹çš„ I/O è°ƒåº¦ä¼˜å…ˆçº§, ç‰¹åˆ«æ˜¯æé«˜æ ¸å¿ƒåº”ç”¨çš„ I/O ä¼˜å…ˆçº§")]),s._v(". ionice æ”¯æŒä¸‰ä¸ªä¼˜å…ˆçº§ç±»: Idle, Best-effort å’Œ Realtime. å…¶ä¸­, Best-effort å’Œ Realtime è¿˜åˆ†åˆ«æ”¯æŒ 0-7 çš„çº§åˆ«, æ•°å€¼è¶Šå°, åˆ™è¡¨ç¤ºä¼˜å…ˆçº§åˆ«è¶Šé«˜.")]),s._v(" "),a("h6",{attrs:{id:"_2-æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–"}},[s._v("#")]),s._v(" (2)æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–")]),s._v(" "),a("p",[s._v("åº”ç”¨ç¨‹åºè®¿é—®æ™®é€šæ–‡ä»¶æ—¶, å®é™…æ˜¯"),a("strong",[s._v("ç”±æ–‡ä»¶ç³»ç»Ÿé—´æ¥è´Ÿè´£, æ–‡ä»¶åœ¨ç£ç›˜ä¸­çš„è¯»å†™")]),s._v(". æ‰€ä»¥, è·Ÿæ–‡ä»¶ç³»ç»Ÿä¸­ç›¸å…³çš„ä¹Ÿæœ‰å¾ˆå¤šä¼˜åŒ– I/O æ€§èƒ½çš„æ–¹å¼.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸€, å¯ä»¥æ ¹æ®å®é™…è´Ÿè½½åœºæ™¯çš„ä¸åŒ, é€‰æ‹©æœ€é€‚åˆçš„æ–‡ä»¶ç³»ç»Ÿ")]),s._v(". æ¯”å¦‚ Ubuntu é»˜è®¤ä½¿ç”¨ ext4 æ–‡ä»¶ç³»ç»Ÿ, è€Œ CentOS 7 é»˜è®¤ä½¿ç”¨ xfs æ–‡ä»¶ç³»ç»Ÿ. ç›¸æ¯”äº ext4, xfs æ”¯æŒæ›´å¤§çš„ç£ç›˜åˆ†åŒºå’Œæ›´å¤§çš„æ–‡ä»¶æ•°é‡, å¦‚ xfs æ”¯æŒå¤§äº 16TB çš„ç£ç›˜. ä½†æ˜¯ xfs æ–‡ä»¶ç³»ç»Ÿçš„ç¼ºç‚¹åœ¨äºæ— æ³•æ”¶ç¼©, è€Œ ext4 åˆ™å¯ä»¥.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äºŒ, åœ¨é€‰å¥½æ–‡ä»¶ç³»ç»Ÿå, è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿçš„é…ç½®é€‰é¡¹, åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§(å¦‚ ext_attr, dir_index), æ—¥å¿—æ¨¡å¼(å¦‚ journal, ordered, writeback), æŒ‚è½½é€‰é¡¹(å¦‚ noatime)ç­‰ç­‰")]),s._v(". æ¯”å¦‚ä½¿ç”¨ tune2fs è¿™ä¸ªå·¥å…·, å¯ä»¥è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§(tune2fs ä¹Ÿå¸¸ç”¨æ¥æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿè¶…çº§å—çš„å†…å®¹). è€Œé€šè¿‡ "),a("code",[s._v("/etc/fstab")]),s._v("â€‹, æˆ–è€… mount å‘½ä»¤è¡Œå‚æ•°, å¯ä»¥è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿçš„æ—¥å¿—æ¨¡å¼å’ŒæŒ‚è½½é€‰é¡¹ç­‰.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸‰, å¯ä»¥ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜")]),s._v(". æ¯”å¦‚å¯ä»¥ä¼˜åŒ– pdflush è„é¡µçš„åˆ·æ–°é¢‘ç‡(æ¯”å¦‚è®¾ç½® dirty_expire_centisecs å’Œ dirty_writeback_centisecs)ä»¥åŠè„é¡µçš„é™é¢(æ¯”å¦‚è°ƒæ•´ dirty_background_ratio å’Œ dirty_ratio ç­‰). å†å¦‚è¿˜å¯ä»¥ä¼˜åŒ–å†…æ ¸å›æ”¶ç›®å½•é¡¹ç¼“å­˜å’Œç´¢å¼•èŠ‚ç‚¹ç¼“å­˜çš„å€¾å‘, å³è°ƒæ•´ vfs_cache_pressure("),a("code",[s._v("/proc/sys/vm/vfs_cache_pressure")]),s._v("â€‹, é»˜è®¤å€¼ 100), æ•°å€¼è¶Šå¤§, å°±è¡¨ç¤ºè¶Šå®¹æ˜“å›æ”¶.")]),s._v(" "),a("p",[s._v("æœ€"),a("strong",[s._v("å, åœ¨ä¸éœ€è¦æŒä¹…åŒ–æ—¶, è¿˜å¯ä»¥ç”¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿ tmpfs, ä»¥è·å¾—æ›´å¥½çš„ I/O æ€§èƒ½")]),s._v(". tmpfs æŠŠæ•°æ®ç›´æ¥ä¿å­˜åœ¨å†…å­˜ä¸­, è€Œä¸æ˜¯ç£ç›˜ä¸­. æ¯”å¦‚ "),a("code",[s._v("/dev/shm/")]),s._v("â€‹, å°±æ˜¯å¤§å¤šæ•° Linux é»˜è®¤é…ç½®çš„ä¸€ä¸ªå†…å­˜æ–‡ä»¶ç³»ç»Ÿ, å®ƒçš„å¤§å°é»˜è®¤ä¸ºæ€»å†…å­˜çš„ä¸€åŠ.")]),s._v(" "),a("h6",{attrs:{id:"_3-ç£ç›˜ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç£ç›˜ä¼˜åŒ–"}},[s._v("#")]),s._v(" (3)ç£ç›˜ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨, æœ€ç»ˆè¿˜æ˜¯è¦è½åˆ°å…·ä½“çš„ç‰©ç†ç£ç›˜ä¸­, åŒæ—¶ç£ç›˜ä¹Ÿæ˜¯æ•´ä¸ª I/O æ ˆçš„æœ€åº•å±‚. ä»ç£ç›˜è§’åº¦å‡ºå‘, è‡ªç„¶ä¹Ÿæœ‰å¾ˆå¤šæœ‰æ•ˆçš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸€, æœ€ç®€å•æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•, å°±æ˜¯æ¢ç”¨æ€§èƒ½æ›´å¥½çš„ç£ç›˜, æ¯”å¦‚ç”¨ SSD æ›¿ä»£ HDD")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äºŒ, å¯ä»¥ä½¿ç”¨ RAID , æŠŠå¤šå—ç£ç›˜ç»„åˆæˆä¸€ä¸ªé€»è¾‘ç£ç›˜, æ„æˆå†—ä½™ç‹¬ç«‹ç£ç›˜é˜µåˆ—")]),s._v(". è¿™æ ·åšæ—¢å¯ä»¥æé«˜æ•°æ®çš„å¯é æ€§, åˆå¯ä»¥æå‡æ•°æ®çš„è®¿é—®æ€§èƒ½.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸‰, é’ˆå¯¹ç£ç›˜å’Œåº”ç”¨ç¨‹åº I/O æ¨¡å¼çš„ç‰¹å¾, å¯ä»¥é€‰æ‹©æœ€é€‚åˆçš„ I/O è°ƒåº¦ç®—æ³•")]),s._v(". æ¯”æ–¹è¯´, SSD å’Œè™šæ‹Ÿæœºä¸­çš„ç£ç›˜, é€šå¸¸ç”¨çš„æ˜¯ noop è°ƒåº¦ç®—æ³•. è€Œæ•°æ®åº“åº”ç”¨æ›´æ¨èä½¿ç”¨ deadline ç®—æ³•.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬å››, å¯ä»¥å¯¹åº”ç”¨ç¨‹åºçš„æ•°æ®, è¿›è¡Œç£ç›˜çº§åˆ«çš„éš”ç¦»")]),s._v(". æ¯”å¦‚å¯ä»¥ä¸ºæ—¥å¿—, æ•°æ®åº“ç­‰ I/O å‹åŠ›æ¯”è¾ƒé‡çš„åº”ç”¨, é…ç½®å•ç‹¬çš„ç£ç›˜.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äº”, åœ¨é¡ºåºè¯»æ¯”è¾ƒå¤šçš„åœºæ™¯ä¸­, å¯ä»¥å¢å¤§ç£ç›˜çš„é¢„è¯»æ•°æ®")]),s._v(", æ¯”å¦‚å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹æ³•, è°ƒæ•´ "),a("code",[s._v("/dev/sdb")]),s._v("â€‹ çš„é¢„è¯»å¤§å°.")]),s._v(" "),a("ul",[a("li",[s._v("è°ƒæ•´å†…æ ¸é€‰é¡¹ "),a("code",[s._v("/sys/block/sdb/queue/read_ahead_kb")]),s._v("â€‹, é»˜è®¤å¤§å°æ˜¯ 128 KB, å•ä½ä¸º KB.")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ blockdev å·¥å…·è®¾ç½®, æ¯”å¦‚ "),a("code",[s._v("blockdev --setra 8192 /dev/sdb")]),s._v("â€‹, æ³¨æ„è¿™é‡Œçš„å•ä½æ˜¯ 512B(0.5KB), æ‰€ä»¥å®ƒçš„æ•°å€¼æ€»æ˜¯ read_ahead_kb çš„ä¸¤å€.")])]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬å…­, å¯ä»¥ä¼˜åŒ–å†…æ ¸å—è®¾å¤‡ I/O çš„é€‰é¡¹")]),s._v(". æ¯”å¦‚, å¯ä»¥è°ƒæ•´ç£ç›˜é˜Ÿåˆ—çš„é•¿åº¦ "),a("code",[s._v("/sys/block/sdb/queue/nr_requests")]),s._v("â€‹, é€‚å½“å¢å¤§é˜Ÿåˆ—é•¿åº¦, å¯ä»¥æå‡ç£ç›˜çš„ååé‡(å½“ç„¶ä¹Ÿä¼šå¯¼è‡´ I/O å»¶è¿Ÿå¢å¤§).")]),s._v(" "),a("p",[s._v("æœ€å, è¦æ³¨æ„, ç£ç›˜æœ¬èº«å‡ºç°ç¡¬ä»¶é”™è¯¯, ä¹Ÿä¼šå¯¼è‡´ I/O æ€§èƒ½æ€¥å‰§ä¸‹é™, æ‰€ä»¥å‘ç°ç£ç›˜æ€§èƒ½æ€¥å‰§ä¸‹é™æ—¶, è¿˜éœ€è¦ç¡®è®¤, ç£ç›˜æœ¬èº«æ˜¯ä¸æ˜¯å‡ºç°äº†ç¡¬ä»¶é”™è¯¯. æ¯”å¦‚å¯ä»¥æŸ¥çœ‹ dmesg ä¸­æ˜¯å¦æœ‰ç¡¬ä»¶ I/O æ•…éšœçš„æ—¥å¿—. è¿˜å¯ä»¥ä½¿ç”¨ badblocks, smartctl ç­‰å·¥å…·, æ£€æµ‹ç£ç›˜çš„ç¡¬ä»¶é—®é¢˜, æˆ–ç”¨ e2fsck ç­‰æ¥æ£€æµ‹æ–‡ä»¶ç³»ç»Ÿçš„é”™è¯¯. å¦‚æœå‘ç°é—®é¢˜, å¯ä»¥ä½¿ç”¨ fsck ç­‰å·¥å…·æ¥ä¿®å¤.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-6"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¢³ç†äº†å¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O çš„æ€§èƒ½ä¼˜åŒ–æ€è·¯å’Œæ–¹æ³•. å‘ç° I/O æ€§èƒ½é—®é¢˜å, ä¸è¦æ€¥äºåŠ¨æ‰‹ä¼˜åŒ–, è€Œè¦å…ˆæ‰¾å‡ºæœ€é‡è¦çš„, å¯ä»¥æœ€å¤§ç¨‹åº¦æå‡æ€§èƒ½çš„é—®é¢˜, ç„¶åå†ä» I/O æ ˆçš„ä¸åŒå±‚å…¥æ‰‹, è€ƒè™‘å…·ä½“çš„ä¼˜åŒ–æ–¹æ³•.")]),s._v(" "),a("p",[s._v("è®°ä½, "),a("strong",[s._v("ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿçš„ I/O, é€šå¸¸æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€æ…¢çš„ä¸€ä¸ªæ¨¡å—. æ‰€ä»¥åœ¨ä¼˜åŒ– I/O é—®é¢˜æ—¶, é™¤äº†å¯ä»¥ä¼˜åŒ– I/O çš„æ‰§è¡Œæµç¨‹, è¿˜å¯ä»¥å€ŸåŠ©æ›´å¿«çš„å†…å­˜, ç½‘ç»œ, CPU ç­‰, å‡å°‘ I/O è°ƒç”¨")]),s._v(".")]),s._v(" "),a("h3",{attrs:{id:"ç½‘ç»œæ€§èƒ½ç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘ç»œæ€§èƒ½ç¯‡"}},[s._v("#")]),s._v(" ç½‘ç»œæ€§èƒ½ç¯‡")]),s._v(" "),a("h4",{attrs:{id:"_33-å…³äºlinuxç½‘ç»œå¿…é¡»çŸ¥é“è¿™äº›-ä¸Š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_33-å…³äºlinuxç½‘ç»œå¿…é¡»çŸ¥é“è¿™äº›-ä¸Š"}},[s._v("#")]),s._v(" 33-å…³äºLinuxç½‘ç»œå¿…é¡»çŸ¥é“è¿™äº›(ä¸Š)")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°†è¿›å…¥ä¸‹ä¸€ä¸ªé‡è¦æ¨¡å—---"),a("strong",[s._v("Linux çš„ç½‘ç»œå­ç³»ç»Ÿ")]),s._v(". ç”±äºç½‘ç»œå¤„ç†çš„æµç¨‹æœ€å¤æ‚, å®ƒè·Ÿå‰é¢è®²åˆ°çš„è¿›ç¨‹è°ƒåº¦, ä¸­æ–­å¤„ç†, å†…å­˜ç®¡ç†ä»¥åŠ I/O ç­‰éƒ½å¯†ä¸å¯åˆ†, æ‰€ä»¥è¿™é‡ŒæŠŠç½‘ç»œæ¨¡å—ä½œä¸ºæœ€åä¸€ä¸ªèµ„æºæ¨¡å—æ¥è®²è§£.")]),s._v(" "),a("p",[s._v("åŒ CPU, å†…å­˜ä»¥åŠ I/O ä¸€æ ·, ç½‘ç»œä¹Ÿæ˜¯ Linux ç³»ç»Ÿæœ€æ ¸å¿ƒçš„åŠŸèƒ½. ç½‘ç»œæ˜¯ä¸€ç§æŠŠä¸åŒè®¡ç®—æœºæˆ–ç½‘ç»œè®¾å¤‡è¿æ¥åˆ°ä¸€èµ·çš„æŠ€æœ¯, å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼, ç‰¹åˆ«æ˜¯è·¨ç³»ç»Ÿçš„è¿›ç¨‹é—´é€šä¿¡, å¿…é¡»è¦é€šè¿‡ç½‘ç»œæ‰èƒ½è¿›è¡Œ. éšç€é«˜å¹¶å‘, åˆ†å¸ƒå¼, äº‘è®¡ç®—, å¾®æœåŠ¡ç­‰æŠ€æœ¯çš„æ™®åŠ, "),a("strong",[s._v("ç½‘ç»œçš„æ€§èƒ½ä¹Ÿå˜å¾—è¶Šæ¥è¶Šé‡è¦")]),s._v(".")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, "),a("strong",[s._v("Linux ç½‘ç»œåˆæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢? åˆæœ‰å“ªäº›æŒ‡æ ‡è¡¡é‡ç½‘ç»œçš„æ€§èƒ½å‘¢?")]),s._v("  æ¥ä¸‹æ¥å°†ä¸€èµ·å­¦ä¹  Linux ç½‘ç»œçš„å·¥ä½œåŸç†å’Œæ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("h5",{attrs:{id:"_1-ç½‘ç»œæ¨¡å‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç½‘ç»œæ¨¡å‹"}},[s._v("#")]),s._v(" 1.ç½‘ç»œæ¨¡å‹")]),s._v(" "),a("p",[s._v("è¯´åˆ°ç½‘ç»œ, å®¹æ˜“æƒ³èµ·ä¸ƒå±‚è´Ÿè½½å‡è¡¡, å››å±‚è´Ÿè½½å‡è¡¡, æˆ–è€…ä¸‰å±‚è®¾å¤‡, äºŒå±‚è®¾å¤‡ç­‰ç­‰. é‚£ä¹ˆ, è¿™é‡Œè¯´çš„äºŒå±‚, ä¸‰å±‚, å››å±‚, ä¸ƒå±‚åˆéƒ½æ˜¯ä»€ä¹ˆæ„æ€å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, è¿™äº›å±‚éƒ½æ¥è‡ªå›½é™…æ ‡å‡†åŒ–ç»„ç»‡åˆ¶å®šçš„"),a("strong",[s._v("å¼€æ”¾å¼ç³»ç»Ÿäº’è”é€šä¿¡å‚è€ƒæ¨¡å‹")]),s._v("(Open System Interconnection Reference Model), ç®€ç§°ä¸º "),a("strong",[s._v("OSI ç½‘ç»œæ¨¡å‹")]),s._v(". ä¸ºäº†è§£å†³ç½‘ç»œäº’è”ä¸­å¼‚æ„è®¾å¤‡çš„å…¼å®¹æ€§é—®é¢˜, å¹¶è§£è€¦å¤æ‚çš„ç½‘ç»œåŒ…å¤„ç†æµç¨‹, OSI æ¨¡å‹æŠŠç½‘ç»œäº’è”çš„æ¡†æ¶åˆ†ä¸ºåº”ç”¨å±‚, è¡¨ç¤ºå±‚, ä¼šè¯å±‚, ä¼ è¾“å±‚, ç½‘ç»œå±‚, æ•°æ®é“¾è·¯å±‚ä»¥åŠç‰©ç†å±‚ç­‰ä¸ƒå±‚, æ¯ä¸ªå±‚è´Ÿè´£ä¸åŒçš„åŠŸèƒ½. ä½†æ˜¯ OSI æ¨¡å‹è¿˜æ˜¯å¤ªå¤æ‚äº†, ä¹Ÿæ²¡èƒ½æä¾›ä¸€ä¸ªå¯å®ç°çš„æ–¹æ³•. æ‰€ä»¥, "),a("strong",[s._v("åœ¨ Linux ä¸­, å®é™…ä¸Šä½¿ç”¨çš„æ˜¯å¦ä¸€ä¸ªæ›´å®ç”¨çš„")]),s._v("â€‹"),a("mark",[a("strong",[s._v("å››å±‚æ¨¡å‹, å³ TCP/IP ç½‘ç»œæ¨¡å‹")])]),s._v(".")]),s._v(" "),a("p",[s._v("TCP/IP æ¨¡å‹, æŠŠç½‘ç»œäº’è”çš„æ¡†æ¶åˆ†ä¸º"),a("strong",[s._v("åº”ç”¨å±‚, ä¼ è¾“å±‚, ç½‘ç»œå±‚, ç½‘ç»œæ¥å£å±‚")]),s._v("ç­‰å››å±‚, å…¶ä¸­,")]),s._v(" "),a("ul",[a("li",[s._v("åº”ç”¨å±‚, è´Ÿè´£å‘ç”¨æˆ·æä¾›ä¸€ç»„åº”ç”¨ç¨‹åº, æ¯”å¦‚ HTTP, FTP, DNS ç­‰.")]),s._v(" "),a("li",[s._v("ä¼ è¾“å±‚, è´Ÿè´£ç«¯åˆ°ç«¯çš„é€šä¿¡, æ¯”å¦‚ TCP, UDP ç­‰.")]),s._v(" "),a("li",[s._v("ç½‘ç»œå±‚, è´Ÿè´£ç½‘ç»œåŒ…çš„å°è£…, å¯»å€å’Œè·¯ç”±, æ¯”å¦‚ IP, ICMP ç­‰.")]),s._v(" "),a("li",[s._v("ç½‘ç»œæ¥å£å±‚, è´Ÿè´£ç½‘ç»œåŒ…åœ¨ç‰©ç†ç½‘ç»œä¸­çš„ä¼ è¾“, æ¯”å¦‚ MAC å¯»å€, é”™è¯¯ä¾¦æµ‹ä»¥åŠé€šè¿‡ç½‘å¡ä¼ è¾“ç½‘ç»œå¸§ç­‰.")])]),s._v(" "),a("p",[s._v("ä¸ºäº†æ›´å½¢è±¡ç†è§£ TCP/IP ä¸ OSI æ¨¡å‹çš„å…³ç³», ä¸‹é¢ç”»äº†ä¸€å¼ å›¾, å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/c17ea403d632dcaf64a847b850b968b4-20230731161933-gmxr9pn.png",alt:""}})]),s._v(" "),a("p",[s._v("å½“ç„¶äº†, è™½è¯´ Linux å®é™…æŒ‰ç…§ TCP/IP æ¨¡å‹, å®ç°äº†ç½‘ç»œåè®®æ ˆ, ä½†åœ¨å¹³æ—¶çš„å­¦ä¹ äº¤æµä¸­, ä¹ æƒ¯ä¸Šè¿˜æ˜¯ç”¨ OSI ä¸ƒå±‚æ¨¡å‹æ¥æè¿°. æ¯”å¦‚, è¯´åˆ°ä¸ƒå±‚å’Œå››å±‚è´Ÿè½½å‡è¡¡, å¯¹åº”çš„åˆ†åˆ«æ˜¯ OSI æ¨¡å‹ä¸­çš„åº”ç”¨å±‚å’Œä¼ è¾“å±‚(è€Œå®ƒä»¬å¯¹åº”åˆ° TCP/IP æ¨¡å‹ä¸­, å®é™…ä¸Šæ˜¯å››å±‚å’Œä¸‰å±‚).")]),s._v(" "),a("h5",{attrs:{id:"_2-linuxç½‘ç»œæ ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-linuxç½‘ç»œæ ˆ"}},[s._v("#")]),s._v(" 2.Linuxç½‘ç»œæ ˆ")]),s._v(" "),a("p",[s._v("æœ‰äº† TCP/IP æ¨¡å‹å, åœ¨è¿›è¡Œç½‘ç»œä¼ è¾“æ—¶, æ•°æ®åŒ…å°±ä¼šæŒ‰ç…§åè®®æ ˆ, å¯¹ä¸Šä¸€å±‚å‘æ¥çš„æ•°æ®è¿›è¡Œé€å±‚å¤„ç†; ç„¶åå°è£…ä¸Šè¯¥å±‚çš„åè®®å¤´, å†å‘é€ç»™ä¸‹ä¸€å±‚.")]),s._v(" "),a("p",[s._v("å½“ç„¶, ç½‘ç»œåŒ…åœ¨æ¯ä¸€å±‚çš„å¤„ç†é€»è¾‘, éƒ½å–å†³äºå„å±‚é‡‡ç”¨çš„ç½‘ç»œåè®®. æ¯”å¦‚åœ¨åº”ç”¨å±‚, ä¸€ä¸ªæä¾› REST API çš„åº”ç”¨, å¯ä»¥ä½¿ç”¨ HTTP åè®®, æŠŠå®ƒéœ€è¦ä¼ è¾“çš„ JSON æ•°æ®å°è£…åˆ° HTTP åè®®ä¸­, ç„¶åå‘ä¸‹ä¼ é€’ç»™ TCP å±‚. è€Œå°è£…åšçš„äº‹æƒ…å°±å¾ˆç®€å•äº†, åªæ˜¯åœ¨åŸæ¥çš„è´Ÿè½½å‰å, å¢åŠ å›ºå®šæ ¼å¼çš„å…ƒæ•°æ®, åŸå§‹çš„è´Ÿè½½æ•°æ®å¹¶ä¸ä¼šè¢«ä¿®æ”¹.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä»¥é€šè¿‡ TCP åè®®é€šä¿¡çš„ç½‘ç»œåŒ…ä¸ºä¾‹, é€šè¿‡ä¸‹é¢è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°, åº”ç”¨ç¨‹åºæ•°æ®åœ¨æ¯ä¸ªå±‚çš„å°è£…æ ¼å¼.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/f346868d3d0db7df1f106b84756dd75b-20230731161933-8kjbbiu.png",alt:""}})]),s._v(" "),a("p",[s._v("å…¶ä¸­:")]),s._v(" "),a("ul",[a("li",[s._v("ä¼ è¾“å±‚åœ¨åº”ç”¨ç¨‹åºæ•°æ®å‰é¢å¢åŠ äº† TCP å¤´;")]),s._v(" "),a("li",[s._v("ç½‘ç»œå±‚åœ¨ TCP æ•°æ®åŒ…å‰å¢åŠ äº† IP å¤´;")]),s._v(" "),a("li",[s._v("è€Œç½‘ç»œæ¥å£å±‚, åˆåœ¨ IP æ•°æ®åŒ…å‰ååˆ†åˆ«å¢åŠ äº†å¸§å¤´å’Œå¸§å°¾.")])]),s._v(" "),a("p",[s._v("è¿™äº›æ–°å¢çš„å¤´éƒ¨å’Œå°¾éƒ¨, éƒ½æŒ‰ç…§ç‰¹å®šçš„"),a("strong",[s._v("åè®®æ ¼å¼å¡«å……")]),s._v(", æƒ³äº†è§£å…·ä½“æ ¼å¼, å¯ä»¥æŸ¥çœ‹åè®®çš„æ–‡æ¡£.")]),s._v(" "),a("p",[s._v("è¿™äº›æ–°å¢çš„å¤´éƒ¨å’Œå°¾éƒ¨, å¢åŠ äº†ç½‘ç»œåŒ…çš„å¤§å°, ä½†ç‰©ç†é“¾è·¯ä¸­å¹¶ä¸èƒ½ä¼ è¾“ä»»æ„å¤§å°çš„æ•°æ®åŒ…. "),a("strong",[s._v("ç½‘ç»œæ¥å£é…ç½®çš„æœ€å¤§ä¼ è¾“å•å…ƒ(MTU), å°±è§„å®šäº†æœ€å¤§çš„ IP åŒ…å¤§å°")]),s._v(". åœ¨æœ€å¸¸ç”¨çš„ä»¥å¤ªç½‘ä¸­, MTU é»˜è®¤å€¼æ˜¯ 1500(è¿™ä¹Ÿæ˜¯ Linux çš„é»˜è®¤å€¼). ä¸€æ—¦ç½‘ç»œåŒ…è¶…è¿‡ MTU çš„å¤§å°, å°±ä¼šåœ¨"),a("strong",[s._v("ç½‘ç»œå±‚åˆ†ç‰‡")]),s._v(", ä»¥ä¿è¯åˆ†ç‰‡åçš„ IP åŒ…ä¸å¤§äº MTU å€¼. æ˜¾ç„¶, MTU è¶Šå¤§, éœ€è¦çš„åˆ†åŒ…ä¹Ÿå°±è¶Šå°‘, è‡ªç„¶, ç½‘ç»œååèƒ½åŠ›å°±è¶Šå¥½.")]),s._v(" "),a("p",[s._v("ç†è§£äº† TCP/IP ç½‘ç»œæ¨¡å‹å’Œç½‘ç»œåŒ…çš„å°è£…åŸç†å, å¾ˆå®¹æ˜“èƒ½æƒ³åˆ°, Linux å†…æ ¸ä¸­çš„ç½‘ç»œæ ˆ, å…¶å®ä¹Ÿç±»ä¼¼äº TCP/IP çš„å››å±‚ç»“æ„. å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯ Linux é€šç”¨ IP ç½‘ç»œæ ˆçš„ç¤ºæ„å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/a8cbf1dce0262c391dc836f337a9ce2e-20230731161933-ckylkx7.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»ä¸Šåˆ°ä¸‹æ¥çœ‹è¿™ä¸ªç½‘ç»œæ ˆ, å¯ä»¥å‘ç°:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("æœ€ä¸Šå±‚çš„åº”ç”¨ç¨‹åº, éœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨, æ¥è·Ÿå¥—æ¥å­—æ¥å£è¿›è¡Œäº¤äº’")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("å¥—æ¥å­—çš„ä¸‹é¢, å°±æ˜¯ä¼ è¾“å±‚, ç½‘ç»œå±‚å’Œç½‘ç»œæ¥å£å±‚")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("æœ€åº•å±‚, åˆ™æ˜¯ç½‘å¡é©±åŠ¨ç¨‹åºä»¥åŠç‰©ç†ç½‘å¡è®¾å¤‡")]),s._v(".")])]),s._v(" "),a("p",[s._v("è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ç½‘å¡. ç½‘å¡æ˜¯å‘é€å’Œæ¥æ”¶ç½‘ç»œåŒ…çš„åŸºæœ¬è®¾å¤‡. åœ¨ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­, ç½‘å¡é€šè¿‡å†…æ ¸ä¸­çš„ç½‘å¡é©±åŠ¨ç¨‹åºæ³¨å†Œåˆ°ç³»ç»Ÿä¸­. è€Œåœ¨ç½‘ç»œæ”¶å‘è¿‡ç¨‹ä¸­, "),a("strong",[s._v("å†…æ ¸é€šè¿‡ä¸­æ–­è·Ÿç½‘å¡è¿›è¡Œäº¤äº’")]),s._v(". å†ç»“åˆå‰é¢æåˆ°çš„ Linux ç½‘ç»œæ ˆ, å¯ä»¥çœ‹å‡º, ç½‘ç»œåŒ…çš„å¤„ç†éå¸¸å¤æ‚. æ‰€ä»¥"),a("strong",[s._v("ç½‘å¡ç¡¬ä¸­æ–­åªå¤„ç†æœ€æ ¸å¿ƒçš„ç½‘å¡æ•°æ®è¯»å–æˆ–å‘é€, è€Œåè®®æ ˆä¸­çš„å¤§éƒ¨åˆ†é€»è¾‘, éƒ½ä¼šæ”¾åˆ°è½¯ä¸­æ–­ä¸­å¤„ç†")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_3-linuxç½‘ç»œæ”¶å‘æµç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-linuxç½‘ç»œæ”¶å‘æµç¨‹"}},[s._v("#")]),s._v(" 3.Linuxç½‘ç»œæ”¶å‘æµç¨‹")]),s._v(" "),a("p",[s._v("äº†è§£äº† Linux ç½‘ç»œæ ˆå, å†æ¥"),a("strong",[s._v("çœ‹çœ‹ Linux åˆ°åº•æ˜¯æ€ä¹ˆæ”¶å‘ç½‘ç»œåŒ…")]),s._v("çš„.")]),s._v(" "),a("p",[s._v("æ³¨æ„, ä»¥ä¸‹å†…å®¹éƒ½ä»¥ç‰©ç†ç½‘å¡ä¸ºä¾‹. äº‹å®ä¸Š, Linux è¿˜æ”¯æŒä¼—å¤šçš„"),a("strong",[s._v("è™šæ‹Ÿç½‘ç»œè®¾å¤‡")]),s._v(", è€Œå®ƒä»¬çš„ç½‘ç»œæ”¶å‘æµç¨‹ä¼šæœ‰ä¸€äº›å·®åˆ«.")]),s._v(" "),a("h6",{attrs:{id:"_1-ç½‘ç»œåŒ…çš„æ¥æ”¶æµç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç½‘ç»œåŒ…çš„æ¥æ”¶æµç¨‹"}},[s._v("#")]),s._v(" (1)ç½‘ç»œåŒ…çš„æ¥æ”¶æµç¨‹")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹"),a("strong",[s._v("ç½‘ç»œåŒ…çš„æ¥æ”¶")]),s._v("æµç¨‹.")]),s._v(" "),a("p",[a("strong",[s._v("å½“ä¸€ä¸ªç½‘ç»œå¸§åˆ°è¾¾ç½‘å¡å, ç½‘å¡ä¼šé€šè¿‡ DMA æ–¹å¼, æŠŠè¿™ä¸ªç½‘ç»œåŒ…æ”¾åˆ°æ”¶åŒ…é˜Ÿåˆ—ä¸­; ç„¶åé€šè¿‡ç¡¬ä¸­æ–­, å‘Šè¯‰ä¸­æ–­å¤„ç†ç¨‹åºå·²ç»æ”¶åˆ°äº†ç½‘ç»œåŒ…")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ç€, "),a("strong",[s._v("ç½‘å¡ä¸­æ–­å¤„ç†ç¨‹åºä¼šä¸ºç½‘ç»œå¸§åˆ†é…å†…æ ¸æ•°æ®ç»“æ„(sk_buff), å¹¶å°†å…¶æ‹·è´åˆ° sk_buff ç¼“å†²åŒºä¸­; ç„¶åå†é€šè¿‡è½¯ä¸­æ–­, é€šçŸ¥å†…æ ¸æ”¶åˆ°äº†æ–°çš„ç½‘ç»œå¸§")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, å†…æ ¸åè®®æ ˆä»ç¼“å†²åŒºä¸­å–å‡ºç½‘ç»œå¸§, å¹¶"),a("strong",[s._v("é€šè¿‡ç½‘ç»œåè®®æ ˆ, ä»ä¸‹åˆ°ä¸Šé€å±‚å¤„ç†è¿™ä¸ªç½‘ç»œå¸§")]),s._v(". æ¯”å¦‚,")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨é“¾è·¯å±‚æ£€æŸ¥æŠ¥æ–‡çš„åˆæ³•æ€§, æ‰¾å‡ºä¸Šå±‚åè®®çš„ç±»å‹(æ¯”å¦‚ IPv4 è¿˜æ˜¯ IPv6), å†å»æ‰å¸§å¤´, å¸§å°¾, ç„¶åäº¤ç»™ç½‘ç»œå±‚.")]),s._v(" "),a("li",[s._v("ç½‘ç»œå±‚å–å‡º IP å¤´, åˆ¤æ–­ç½‘ç»œåŒ…ä¸‹ä¸€æ­¥çš„èµ°å‘, æ¯”å¦‚æ˜¯äº¤ç»™ä¸Šå±‚å¤„ç†è¿˜æ˜¯è½¬å‘. å½“ç½‘ç»œå±‚ç¡®è®¤è¿™ä¸ªåŒ…æ˜¯è¦å‘é€åˆ°æœ¬æœºå, å°±ä¼šå–å‡ºä¸Šå±‚åè®®çš„ç±»å‹(æ¯”å¦‚ TCP è¿˜æ˜¯ UDP), å»æ‰ IP å¤´, å†äº¤ç»™ä¼ è¾“å±‚å¤„ç†.")]),s._v(" "),a("li",[s._v("ä¼ è¾“å±‚å–å‡º TCP å¤´æˆ–è€… UDP å¤´å, æ ¹æ® "),a("code",[s._v("<æº IP, æºç«¯å£, ç›®çš„ IP, ç›®çš„ç«¯å£>")]),s._v("â€‹ å››å…ƒç»„ä½œä¸ºæ ‡è¯†, æ‰¾å‡ºå¯¹åº”çš„ Socket, å¹¶æŠŠæ•°æ®æ‹·è´åˆ° Socket çš„æ¥æ”¶ç¼“å­˜ä¸­.")]),s._v(" "),a("li",[s._v("æœ€å, åº”ç”¨ç¨‹åºå°±å¯ä»¥ä½¿ç”¨ Socket æ¥å£, è¯»å–åˆ°æ–°æ¥æ”¶åˆ°çš„æ•°æ®äº†.")])]),s._v(" "),a("p",[s._v("ä¸ºäº†æ›´æ¸…æ™°è¡¨ç¤ºè¿™ä¸ªæµç¨‹, ä¸‹é¢ç”»äº†ä¸€å¼ å›¾, è¿™å¼ å›¾çš„å·¦åŠéƒ¨åˆ†è¡¨ç¤ºæ¥æ”¶æµç¨‹, è€Œå›¾ä¸­çš„ç²‰è‰²ç®­å¤´åˆ™è¡¨ç¤ºç½‘ç»œåŒ…çš„å¤„ç†è·¯å¾„.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/f94048a825eae20316ccf6e3c68a6550-20230731161933-5vc40b1.png",alt:""}})]),s._v(" "),a("h6",{attrs:{id:"_2-ç½‘ç»œåŒ…çš„å‘é€æµç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç½‘ç»œåŒ…çš„å‘é€æµç¨‹"}},[s._v("#")]),s._v(" (2)ç½‘ç»œåŒ…çš„å‘é€æµç¨‹")]),s._v(" "),a("p",[s._v("äº†è§£ç½‘ç»œåŒ…çš„æ¥æ”¶æµç¨‹å, å°±å¾ˆå®¹æ˜“ç†è§£ç½‘ç»œåŒ…çš„"),a("strong",[s._v("å‘é€æµç¨‹")]),s._v(". ç½‘ç»œåŒ…çš„å‘é€æµç¨‹å°±æ˜¯ä¸Šå›¾çš„å³åŠéƒ¨åˆ†, å¾ˆå®¹æ˜“å‘ç°, ç½‘ç»œåŒ…çš„å‘é€æ–¹å‘, æ­£å¥½è·Ÿæ¥æ”¶æ–¹å‘ç›¸å.")]),s._v(" "),a("ul",[a("li",[s._v("é¦–å…ˆ, åº”ç”¨ç¨‹åºè°ƒç”¨ Socket API(æ¯”å¦‚ sendmsg)å‘é€ç½‘ç»œåŒ…. ç”±äºè¿™æ˜¯ä¸€ä¸ª"),a("strong",[s._v("ç³»ç»Ÿè°ƒç”¨, æ‰€ä»¥ä¼šé™·å…¥åˆ°å†…æ ¸æ€çš„å¥—æ¥å­—å±‚ä¸­. å¥—æ¥å­—å±‚ä¼šæŠŠæ•°æ®åŒ…æ”¾åˆ° Socket å‘é€ç¼“å†²åŒºä¸­")]),s._v(".")]),s._v(" "),a("li",[s._v("æ¥ä¸‹æ¥, "),a("strong",[s._v("ç½‘ç»œåè®®æ ˆä» Socket å‘é€ç¼“å†²åŒºä¸­, å–å‡ºæ•°æ®åŒ…; å†æŒ‰ç…§ TCP/IP æ ˆ, ä»ä¸Šåˆ°ä¸‹é€å±‚å¤„ç†. æ¯”å¦‚, ä¼ è¾“å±‚å’Œç½‘ç»œå±‚, åˆ†åˆ«ä¸ºå…¶å¢åŠ  TCP å¤´å’Œ IP å¤´, æ‰§è¡Œè·¯ç”±æŸ¥æ‰¾ç¡®è®¤ä¸‹ä¸€è·³çš„ IP, å¹¶æŒ‰ç…§ MTU å¤§å°è¿›è¡Œåˆ†ç‰‡")]),s._v(".")]),s._v(" "),a("li",[s._v("åˆ†ç‰‡åçš„ç½‘ç»œåŒ…, å†é€åˆ°ç½‘ç»œæ¥å£å±‚, è¿›è¡Œç‰©ç†åœ°å€å¯»å€, ä»¥æ‰¾åˆ°ä¸‹ä¸€è·³çš„ MAC åœ°å€. ç„¶åæ·»åŠ å¸§å¤´å’Œå¸§å°¾, æ”¾åˆ°å‘åŒ…é˜Ÿåˆ—ä¸­. è¿™ä¸€åˆ‡å®Œæˆå, ä¼šæœ‰è½¯ä¸­æ–­é€šçŸ¥é©±åŠ¨ç¨‹åº: å‘åŒ…é˜Ÿåˆ—ä¸­æœ‰æ–°çš„ç½‘ç»œå¸§éœ€è¦å‘é€.")]),s._v(" "),a("li",[s._v("æœ€å, é©±åŠ¨ç¨‹åºé€šè¿‡ DMA, ä»å‘åŒ…é˜Ÿåˆ—ä¸­è¯»å‡ºç½‘ç»œå¸§, å¹¶é€šè¿‡ç‰©ç†ç½‘å¡æŠŠå®ƒå‘é€å‡ºå».")])]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-9"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¢³ç†äº† Linux ç½‘ç»œçš„å·¥ä½œåŸç†. å¤šå°æœåŠ¡å™¨é€šè¿‡ç½‘å¡, äº¤æ¢æœº, è·¯ç”±å™¨ç­‰ç½‘ç»œè®¾å¤‡è¿æ¥åˆ°ä¸€èµ·, æ„æˆäº†ç›¸äº’è¿æ¥çš„ç½‘ç»œ. ç”±äºç½‘ç»œè®¾å¤‡çš„å¼‚æ„æ€§å’Œç½‘ç»œåè®®çš„å¤æ‚æ€§, å›½é™…æ ‡å‡†åŒ–ç»„ç»‡å®šä¹‰äº†ä¸€ä¸ªä¸ƒå±‚çš„ OSI ç½‘ç»œæ¨¡å‹, ä½†æ˜¯è¿™ä¸ªæ¨¡å‹è¿‡äºå¤æ‚, å®é™…å·¥ä½œä¸­çš„äº‹å®æ ‡å‡†, æ˜¯æ›´ä¸ºå®ç”¨çš„ TCP/IP æ¨¡å‹.")]),s._v(" "),a("p",[s._v("TCP/IP æ¨¡å‹, æŠŠç½‘ç»œäº’è”çš„æ¡†æ¶, åˆ†ä¸ºåº”ç”¨å±‚, ä¼ è¾“å±‚, ç½‘ç»œå±‚, ç½‘ç»œæ¥å£å±‚ç­‰å››å±‚, è¿™ä¹Ÿæ˜¯ Linux ç½‘ç»œæ ˆæœ€æ ¸å¿ƒçš„æ„æˆéƒ¨åˆ†.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("åº”ç”¨ç¨‹åºé€šè¿‡å¥—æ¥å­—æ¥å£å‘é€æ•°æ®åŒ…, å…ˆè¦åœ¨ç½‘ç»œåè®®æ ˆä¸­ä»ä¸Šåˆ°ä¸‹è¿›è¡Œé€å±‚å¤„ç†, æœ€ç»ˆå†é€åˆ°ç½‘å¡å‘é€å‡ºå».")])]),s._v(" "),a("li",[a("strong",[s._v("è€Œæ¥æ”¶æ—¶, åŒæ ·å…ˆç»è¿‡ç½‘ç»œæ ˆä»ä¸‹åˆ°ä¸Šçš„é€å±‚å¤„ç†, æœ€ç»ˆæ‰ä¼šé€åˆ°åº”ç”¨ç¨‹åº.")])])]),s._v(" "),a("h4",{attrs:{id:"_34-å…³äºlinuxç½‘ç»œå¿…é¡»çŸ¥é“è¿™äº›-ä¸‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_34-å…³äºlinuxç½‘ç»œå¿…é¡»çŸ¥é“è¿™äº›-ä¸‹"}},[s._v("#")]),s._v(" 34-å…³äºLinuxç½‘ç»œå¿…é¡»çŸ¥é“è¿™äº›(ä¸‹)")]),s._v(" "),a("p",[s._v("äº†è§£ Linux ç½‘ç»œçš„åŸºæœ¬åŸç†å’Œæ”¶å‘æµç¨‹å, ä½ è‚¯å®šè¿«ä¸åŠå¾…æƒ³çŸ¥é“, å¦‚ä½•å»è§‚å¯Ÿç½‘ç»œçš„æ€§èƒ½æƒ…å†µ. å…·ä½“è€Œè¨€, "),a("strong",[s._v("å“ªäº›æŒ‡æ ‡å¯ä»¥ç”¨æ¥è¡¡é‡ Linux çš„ç½‘ç»œæ€§èƒ½å‘¢")]),s._v("?")]),s._v(" "),a("h5",{attrs:{id:"_1-æ€§èƒ½æŒ‡æ ‡-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ€§èƒ½æŒ‡æ ‡-2"}},[s._v("#")]),s._v(" 1.æ€§èƒ½æŒ‡æ ‡")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, é€šå¸¸ç”¨"),a("mark",[a("strong",[s._v("å¸¦å®½, ååé‡, å»¶æ—¶, PPS(Packet Per Second)ç­‰æŒ‡æ ‡è¡¡é‡ç½‘ç»œçš„æ€§èƒ½")])]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å¸¦å®½")]),s._v(", è¡¨ç¤ºé“¾è·¯çš„æœ€å¤§ä¼ è¾“é€Ÿç‡, å•ä½é€šå¸¸ä¸º b/s (æ¯”ç‰¹/ç§’).")]),s._v(" "),a("li",[a("strong",[s._v("ååé‡")]),s._v(", è¡¨ç¤º"),a("strong",[s._v("å•ä½æ—¶é—´å†…æˆåŠŸä¼ è¾“çš„æ•°æ®é‡")]),s._v(", å•ä½é€šå¸¸ä¸º b/s(æ¯”ç‰¹/ç§’)æˆ–è€… B/s(å­—èŠ‚/ç§’). ååé‡å—å¸¦å®½é™åˆ¶, è€Œååé‡/å¸¦å®½, ä¹Ÿå°±æ˜¯è¯¥ç½‘ç»œçš„ä½¿ç”¨ç‡.")]),s._v(" "),a("li",[a("strong",[s._v("å»¶æ—¶")]),s._v(", è¡¨ç¤ºä»ç½‘ç»œè¯·æ±‚å‘å‡ºå, ä¸€ç›´åˆ°æ”¶åˆ°è¿œç«¯å“åº”, æ‰€éœ€è¦çš„æ—¶é—´å»¶è¿Ÿ. åœ¨ä¸åŒåœºæ™¯ä¸­, è¿™ä¸€æŒ‡æ ‡å¯èƒ½ä¼šæœ‰ä¸åŒå«ä¹‰. æ¯”å¦‚å®ƒå¯ä»¥è¡¨ç¤ºå»ºç«‹è¿æ¥éœ€è¦çš„æ—¶é—´(æ¯”å¦‚ TCP æ¡æ‰‹å»¶æ—¶), æˆ–ä¸€ä¸ªæ•°æ®åŒ…å¾€è¿”æ‰€éœ€çš„æ—¶é—´(æ¯”å¦‚ RTT).")]),s._v(" "),a("li",[a("strong",[s._v("PPS")]),s._v(", æ˜¯ Packet Per Second(åŒ…/ç§’)çš„ç¼©å†™, è¡¨ç¤º"),a("strong",[s._v("ä»¥ç½‘ç»œåŒ…ä¸ºå•ä½çš„ä¼ è¾“é€Ÿç‡")]),s._v(". PPS é€šå¸¸ç”¨æ¥è¯„ä¼°ç½‘ç»œçš„è½¬å‘èƒ½åŠ›, æ¯”å¦‚ç¡¬ä»¶äº¤æ¢æœº, é€šå¸¸å¯ä»¥è¾¾åˆ°çº¿æ€§è½¬å‘(å³ PPS å¯ä»¥è¾¾åˆ°æˆ–è€…æ¥è¿‘ç†è®ºæœ€å¤§å€¼). è€ŒåŸºäº Linux æœåŠ¡å™¨çš„è½¬å‘, åˆ™å®¹æ˜“å—ç½‘ç»œåŒ…å¤§å°çš„å½±å“.")])]),s._v(" "),a("p",[s._v("é™¤äº†è¿™äº›æŒ‡æ ‡, "),a("strong",[s._v("ç½‘ç»œçš„å¯ç”¨æ€§")]),s._v("(ç½‘ç»œèƒ½å¦æ­£å¸¸é€šä¿¡), "),a("strong",[s._v("å¹¶å‘è¿æ¥æ•°")]),s._v("(TCP è¿æ¥æ•°é‡), "),a("strong",[s._v("ä¸¢åŒ…ç‡")]),s._v("(ä¸¢åŒ…ç™¾åˆ†æ¯”), "),a("strong",[s._v("é‡ä¼ ç‡")]),s._v("(é‡æ–°ä¼ è¾“çš„ç½‘ç»œåŒ…æ¯”ä¾‹)ç­‰ä¹Ÿæ˜¯å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("h5",{attrs:{id:"_2-ç½‘ç»œé…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç½‘ç»œé…ç½®"}},[s._v("#")]),s._v(" 2.ç½‘ç»œé…ç½®")]),s._v(" "),a("p",[s._v("åˆ†æç½‘ç»œé—®é¢˜çš„ç¬¬ä¸€æ­¥, é€šå¸¸æ˜¯æŸ¥çœ‹ç½‘ç»œæ¥å£çš„é…ç½®å’ŒçŠ¶æ€. å¯ä»¥ä½¿ç”¨ ifconfig æˆ–è€… ip å‘½ä»¤, æ¥æŸ¥çœ‹ç½‘ç»œçš„é…ç½®. ä¸ªäººæ›´æ¨èä½¿ç”¨ ip å·¥å…·, å› ä¸ºå®ƒæä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½å’Œæ›´æ˜“ç”¨çš„æ¥å£.")]),s._v(" "),a("p",[s._v("ifconfig å’Œ ip åˆ†åˆ«å±äºè½¯ä»¶åŒ… net-tools å’Œ iproute2, iproute2 æ˜¯ net-tools çš„ä¸‹ä¸€ä»£. é€šå¸¸æƒ…å†µä¸‹å®ƒä»¬ä¼šåœ¨å‘è¡Œç‰ˆä¸­é»˜è®¤å®‰è£…. ä½†å¦‚æœæ‰¾ä¸åˆ° ifconfig æˆ–è€… ip å‘½ä»¤, å¯ä»¥å®‰è£…è¿™ä¸¤ä¸ªè½¯ä»¶åŒ….")]),s._v(" "),a("p",[s._v("ä»¥ç½‘ç»œæ¥å£ eth0 ä¸ºä¾‹, å¯ä»¥è¿è¡Œä¸‹é¢çš„ä¸¤ä¸ªå‘½ä»¤, æŸ¥çœ‹å®ƒçš„é…ç½®å’ŒçŠ¶æ€:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" eth0\neth0: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n      inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.240")]),s._v(".0.30 netmask "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.240")]),s._v(".0.0 broadcast "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".255.255\n      inet6 fe80::20d:3aff:fe07:cf2a prefixlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" scopeid 0x2"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("link"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n      ether "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v(":0d:3a:07:cf:3a txqueuelen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      RX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40809142")]),s._v(" bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9542369803")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.5")]),s._v(" GB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      RX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" frame "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n      TX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32637401")]),s._v(" bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4815573306")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(" GB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      TX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" carrier "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" collisions "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nâ€‹\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" addr show dev eth0\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": eth0: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc mq state UP group default qlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  link/ether "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v(":0d:3a:07:cf:3a brd ff:ff:ff:ff:ff:ff\n  inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.240")]),s._v(".0.30/12 brd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".255.255 scope global eth0\n      valid_lft forever preferred_lft forever\n  inet6 fe80::20d:3aff:fe07:cf2a/64 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v("\n      valid_lft forever preferred_lft forever\n  RX: bytes packets errors dropped overrun mcast\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9542432350")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40809397")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193")]),s._v("\n  TX: bytes packets errors dropped carrier collsns\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4815625265")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32637658")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, ifconfig å’Œ ip å‘½ä»¤è¾“å‡ºçš„æŒ‡æ ‡åŸºæœ¬ç›¸åŒ, åªæ˜¯æ˜¾ç¤ºæ ¼å¼ç•¥å¾®ä¸åŒ. æ¯”å¦‚, å®ƒä»¬"),a("strong",[s._v("éƒ½åŒ…æ‹¬äº†ç½‘ç»œæ¥å£çš„çŠ¶æ€æ ‡å¿—, MTU å¤§å°, IP, å­ç½‘, MAC åœ°å€ä»¥åŠç½‘ç»œåŒ…æ”¶å‘çš„ç»Ÿè®¡ä¿¡æ¯")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™äº›å…·ä½“æŒ‡æ ‡çš„å«ä¹‰, åœ¨æ–‡æ¡£ä¸­éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜, ä¸è¿‡è¿™é‡Œæœ‰å‡ ä¸ª"),a("strong",[s._v("è·Ÿç½‘ç»œæ€§èƒ½å¯†åˆ‡ç›¸å…³çš„æŒ‡æ ‡")]),s._v(", éœ€è¦ç‰¹åˆ«å…³æ³¨ä¸€ä¸‹.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸€, ç½‘ç»œæ¥å£çš„çŠ¶æ€æ ‡å¿—")]),s._v(". ifconfig è¾“å‡ºä¸­çš„ RUNNING, æˆ– ip è¾“å‡ºä¸­çš„ LOWER_UP, éƒ½è¡¨ç¤ºç‰©ç†ç½‘ç»œæ˜¯è¿é€šçš„, å³ç½‘å¡å·²ç»è¿æ¥åˆ°äº†äº¤æ¢æœºæˆ–è€…è·¯ç”±å™¨ä¸­. å¦‚æœçœ‹ä¸åˆ°å®ƒä»¬, é€šå¸¸è¡¨ç¤ºç½‘çº¿è¢«æ‹”æ‰äº†.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äºŒ, MTU çš„å¤§å°")]),s._v(". MTU é»˜è®¤å¤§å°æ˜¯ 1500, æ ¹æ®ç½‘ç»œæ¶æ„çš„ä¸åŒ(æ¯”å¦‚æ˜¯å¦ä½¿ç”¨äº† VXLAN ç­‰å åŠ ç½‘ç»œ), å¯èƒ½éœ€è¦è°ƒå¤§æˆ–è€…è°ƒå° MTU çš„æ•°å€¼.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬ä¸‰, ç½‘ç»œæ¥å£çš„ IP åœ°å€, å­ç½‘ä»¥åŠ MAC åœ°å€")]),s._v(". è¿™äº›éƒ½æ˜¯ä¿éšœç½‘ç»œåŠŸèƒ½æ­£å¸¸å·¥ä½œæ‰€å¿…éœ€çš„, éœ€è¦ç¡®ä¿é…ç½®æ­£ç¡®.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬å››, ç½‘ç»œæ”¶å‘çš„å­—èŠ‚æ•°, åŒ…æ•°, é”™è¯¯æ•°ä»¥åŠä¸¢åŒ…æƒ…å†µ")]),s._v(", ç‰¹åˆ«æ˜¯ TX å’Œ RX éƒ¨åˆ†çš„ errors, dropped, overruns, carrier ä»¥åŠ collisions ç­‰æŒ‡æ ‡ä¸ä¸º 0 æ—¶, é€šå¸¸è¡¨ç¤ºå‡ºç°äº†ç½‘ç»œ I/O é—®é¢˜. å…¶ä¸­:")]),s._v(" "),a("ul",[a("li",[s._v("errors è¡¨ç¤ºå‘ç”Ÿé”™è¯¯çš„æ•°æ®åŒ…æ•°, æ¯”å¦‚æ ¡éªŒé”™è¯¯, å¸§åŒæ­¥é”™è¯¯ç­‰;")]),s._v(" "),a("li",[s._v("dropped è¡¨ç¤ºä¸¢å¼ƒçš„æ•°æ®åŒ…æ•°, å³æ•°æ®åŒ…å·²ç»æ”¶åˆ°äº† Ring Buffer, ä½†å› ä¸ºå†…å­˜ä¸è¶³ç­‰åŸå› ä¸¢åŒ…;")]),s._v(" "),a("li",[s._v("overruns è¡¨ç¤ºè¶…é™æ•°æ®åŒ…æ•°, å³ç½‘ç»œ I/O é€Ÿåº¦è¿‡å¿«, å¯¼è‡´ Ring Buffer ä¸­çš„æ•°æ®åŒ…æ¥ä¸åŠå¤„ç†(é˜Ÿåˆ—æ»¡)è€Œå¯¼è‡´çš„ä¸¢åŒ…;")]),s._v(" "),a("li",[s._v("carrier è¡¨ç¤ºå‘ç”Ÿ carrirer é”™è¯¯çš„æ•°æ®åŒ…æ•°, æ¯”å¦‚åŒå·¥æ¨¡å¼ä¸åŒ¹é…, ç‰©ç†ç”µç¼†å‡ºç°é—®é¢˜ç­‰;")]),s._v(" "),a("li",[s._v("collisions è¡¨ç¤ºç¢°æ’æ•°æ®åŒ…æ•°.")])]),s._v(" "),a("h5",{attrs:{id:"_3-å¥—æ¥å­—ä¿¡æ¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å¥—æ¥å­—ä¿¡æ¯"}},[s._v("#")]),s._v(" 3.å¥—æ¥å­—ä¿¡æ¯")]),s._v(" "),a("p",[s._v("ifconfig å’Œ ip åªæ˜¾ç¤ºäº†ç½‘ç»œæ¥å£æ”¶å‘æ•°æ®åŒ…çš„"),a("strong",[s._v("ç»Ÿè®¡ä¿¡æ¯")]),s._v(", ä½†åœ¨å®é™…çš„æ€§èƒ½é—®é¢˜ä¸­, ç½‘ç»œåè®®æ ˆä¸­çš„ç»Ÿè®¡ä¿¡æ¯, ä¹Ÿå¿…é¡»å…³æ³¨. å¯ä»¥"),a("strong",[s._v("ç”¨ netstat æˆ–è€… ss æ¥æŸ¥çœ‹å¥—æ¥å­—, ç½‘ç»œæ ˆ, ç½‘ç»œæ¥å£ä»¥åŠè·¯ç”±è¡¨çš„ä¿¡æ¯")]),s._v(". ä¸ªäººæ›´æ¨èä½¿ç”¨ ss æ¥æŸ¥è¯¢ç½‘ç»œçš„è¿æ¥ä¿¡æ¯, å› ä¸ºå®ƒæ¯” netstat æä¾›äº†æ›´å¥½çš„æ€§èƒ½(é€Ÿåº¦æ›´å¿«).")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥è¯¢å¥—æ¥å­—ä¿¡æ¯:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# head -n 3 è¡¨ç¤ºåªæ˜¾ç¤ºå‰é¢ 3 è¡Œ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -l è¡¨ç¤ºåªæ˜¾ç¤ºç›‘å¬å¥—æ¥å­—")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -n è¡¨ç¤ºæ˜¾ç¤ºæ•°å­—åœ°å€å’Œç«¯å£ (è€Œä¸æ˜¯åå­—)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p è¡¨ç¤ºæ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nlp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nActive Internet connections "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("only servers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.53:53           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("840")]),s._v("/systemd-resolve\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -l è¡¨ç¤ºåªæ˜¾ç¤ºç›‘å¬å¥—æ¥å­—")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t è¡¨ç¤ºåªæ˜¾ç¤º TCP å¥—æ¥å­—")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -n è¡¨ç¤ºæ˜¾ç¤ºæ•°å­—åœ°å€å’Œç«¯å£ (è€Œä¸æ˜¯åå­—)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p è¡¨ç¤ºæ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯")]),s._v("\n$ ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ltnp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nState    Recv-Q    Send-Q        Local Address:Port        Peer Address:Port\nLISTEN   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.53%lo:53               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*        users:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"systemd'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('resolve"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("840")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nLISTEN   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:22               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*        users:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"sshd"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1459")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("netstat å’Œ ss çš„è¾“å‡ºä¹Ÿæ˜¯ç±»ä¼¼çš„, éƒ½å±•ç¤ºäº†å¥—æ¥å­—çš„çŠ¶æ€, æ¥æ”¶é˜Ÿåˆ—, å‘é€é˜Ÿåˆ—, æœ¬åœ°åœ°å€, è¿œç«¯åœ°å€, è¿›ç¨‹ PID å’Œè¿›ç¨‹åç§°ç­‰.")]),s._v(" "),a("p",[s._v("å…¶ä¸­, æ¥æ”¶é˜Ÿåˆ—(Recv-Q)å’Œå‘é€é˜Ÿåˆ—(Send-Q)éœ€è¦ç‰¹åˆ«å…³æ³¨, å®ƒä»¬é€šå¸¸åº”è¯¥æ˜¯ 0. å½“"),a("strong",[s._v("å‘ç°å®ƒä»¬ä¸æ˜¯ 0 æ—¶, è¯´æ˜æœ‰ç½‘ç»œåŒ…çš„å †ç§¯å‘ç”Ÿ")]),s._v(". å½“ç„¶è¿˜è¦æ³¨æ„, åœ¨ä¸åŒå¥—æ¥å­—çŠ¶æ€ä¸‹, å®ƒä»¬çš„å«ä¹‰ä¸åŒ.")]),s._v(" "),a("p",[s._v("å½“å¥—æ¥å­—å¤„äºè¿æ¥çŠ¶æ€(Established)æ—¶,")]),s._v(" "),a("ul",[a("li",[s._v("Recv-Q è¡¨ç¤ºå¥—æ¥å­—ç¼“å†²è¿˜æ²¡æœ‰è¢«åº”ç”¨ç¨‹åºå–èµ°çš„å­—èŠ‚æ•°(å³æ¥æ”¶é˜Ÿåˆ—é•¿åº¦).")]),s._v(" "),a("li",[s._v("è€Œ Send-Q è¡¨ç¤ºè¿˜æ²¡æœ‰è¢«è¿œç«¯ä¸»æœºç¡®è®¤çš„å­—èŠ‚æ•°(å³å‘é€é˜Ÿåˆ—é•¿åº¦).")])]),s._v(" "),a("p",[s._v("å½“å¥—æ¥å­—å¤„äºç›‘å¬çŠ¶æ€(Listening)æ—¶,")]),s._v(" "),a("ul",[a("li",[s._v("Recv-Q è¡¨ç¤º syn backlog çš„å½“å‰å€¼.")]),s._v(" "),a("li",[s._v("è€Œ Send-Q è¡¨ç¤ºæœ€å¤§çš„ syn backlog å€¼.")])]),s._v(" "),a("p",[s._v("è€Œ syn backlog æ˜¯ TCP åè®®æ ˆä¸­çš„"),a("strong",[s._v("åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦")]),s._v(", ç›¸åº”çš„ä¹Ÿæœ‰ä¸€ä¸ªå…¨è¿æ¥é˜Ÿåˆ—(accept queue), å®ƒä»¬éƒ½æ˜¯ç»´æŠ¤ TCP çŠ¶æ€çš„é‡è¦æœºåˆ¶. æ‰€è°“"),a("strong",[s._v("åŠè¿æ¥")]),s._v(", å°±æ˜¯è¿˜æ²¡æœ‰å®Œæˆ TCP ä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥, è¿æ¥åªè¿›è¡Œäº†ä¸€åŠ, è€ŒæœåŠ¡å™¨æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ SYN åŒ…å, å°±ä¼šæŠŠè¿™ä¸ªè¿æ¥æ”¾åˆ°åŠè¿æ¥é˜Ÿåˆ—ä¸­, ç„¶åå†å‘å®¢æˆ·ç«¯å‘é€ SYN+ACK åŒ…. è€Œ"),a("strong",[s._v("å…¨è¿æ¥")]),s._v(", åˆ™æ˜¯æŒ‡æœåŠ¡å™¨æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ ACK, å®Œæˆäº† TCP ä¸‰æ¬¡æ¡æ‰‹, ç„¶åå°±ä¼šæŠŠè¿™ä¸ªè¿æ¥æŒªåˆ°å…¨è¿æ¥é˜Ÿåˆ—ä¸­. è¿™äº›å…¨è¿æ¥ä¸­çš„å¥—æ¥å­—, è¿˜éœ€è¦å†è¢« accept() ç³»ç»Ÿè°ƒç”¨å–èµ°, è¿™æ ·æœåŠ¡å™¨å°±å¯ä»¥å¼€å§‹çœŸæ­£å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚äº†.")]),s._v(" "),a("h5",{attrs:{id:"_4-åè®®æ ˆç»Ÿè®¡ä¿¡æ¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-åè®®æ ˆç»Ÿè®¡ä¿¡æ¯"}},[s._v("#")]),s._v(" 4.åè®®æ ˆç»Ÿè®¡ä¿¡æ¯")]),s._v(" "),a("p",[s._v("ç±»ä¼¼çš„, ä½¿ç”¨ netstat æˆ– ss, ä¹Ÿå¯ä»¥æŸ¥çœ‹åè®®æ ˆçš„ä¿¡æ¯:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nTcp:\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3244906")]),s._v(" active connection openings\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23143")]),s._v(" passive connection openings\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115732")]),s._v(" failed connection attempts\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2964")]),s._v(" connection resets received\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" connections established\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13025010")]),s._v(" segments received\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17606946")]),s._v(" segments sent out\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44438")]),s._v(" segments retransmitted\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" bad segments received\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5315")]),s._v(" resets sent\n    InCsumErrors: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \n$ ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\nTotal: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("186")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kernel "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1446")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTCP:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("estab "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", closed "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", orphaned "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", synrecv "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", timewait "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", ports "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n \nTransport Total     IP        IPv6\n*\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1446")]),s._v("      -         -\nRAW\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nUDP\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("è¿™äº›åè®®æ ˆçš„ç»Ÿè®¡ä¿¡æ¯éƒ½å¾ˆç›´è§‚. ss åªæ˜¾ç¤ºå·²ç»è¿æ¥, å…³é—­, å­¤å„¿å¥—æ¥å­—ç­‰ç®€è¦ç»Ÿè®¡, è€Œ netstat åˆ™æä¾›çš„æ˜¯æ›´è¯¦ç»†çš„ç½‘ç»œåè®®æ ˆä¿¡æ¯. æ¯”å¦‚, ä¸Šé¢ netstat çš„è¾“å‡ºç¤ºä¾‹, å°±å±•ç¤ºäº† TCP åè®®çš„ä¸»åŠ¨è¿æ¥, è¢«åŠ¨è¿æ¥, å¤±è´¥é‡è¯•, å‘é€å’Œæ¥æ”¶çš„åˆ†æ®µæ•°é‡ç­‰å„ç§ä¿¡æ¯.")]),s._v(" "),a("h5",{attrs:{id:"_5-ç½‘ç»œååå’Œpps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-ç½‘ç»œååå’Œpps"}},[s._v("#")]),s._v(" 5.ç½‘ç»œååå’ŒPPS")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†æ¥çœ‹çœ‹, å¦‚ä½•"),a("strong",[s._v("æŸ¥çœ‹ç³»ç»Ÿå½“å‰çš„ç½‘ç»œååé‡å’Œ PPS")]),s._v(". åœ¨è¿™é‡Œ, æ¨èä½¿ç”¨è€æœ‹å‹ sar, åœ¨å‰é¢çš„ CPU, å†…å­˜å’Œ I/O æ¨¡å—ä¸­, å‰é¢å·²ç»å¤šæ¬¡ç”¨åˆ°å®ƒ.")]),s._v(" "),a("p",[a("strong",[s._v("ç»™ sar å¢åŠ  -n å‚æ•°å°±å¯ä»¥æŸ¥çœ‹ç½‘ç»œçš„ç»Ÿè®¡ä¿¡æ¯")]),s._v(", æ¯”å¦‚ç½‘ç»œæ¥å£(DEV), ç½‘ç»œæ¥å£é”™è¯¯(EDEV), TCP, UDP, ICMP ç­‰ç­‰. æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥å¾—åˆ°ç½‘ç»œæ¥å£ç»Ÿè®¡ä¿¡æ¯:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ•°å­— 1 è¡¨ç¤ºæ¯éš” 1 ç§’è¾“å‡ºä¸€ç»„æ•°æ®")]),s._v("\n$ sar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" DEV "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nLinux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.15")]),s._v(".0-1035-azure "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \t01/06/19 \t_x86_64_\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CPU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":21:40        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":21:41         eth0     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.79")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.25")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":21:41      docker0      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":21:41           lo      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("è¿™å„¿è¾“å‡ºçš„æŒ‡æ ‡æ¯”è¾ƒå¤š, æ¥ç®€å•è§£é‡Šä¸‹å®ƒä»¬çš„å«ä¹‰.")]),s._v(" "),a("ul",[a("li",[s._v("rxpck/s å’Œ txpck/s åˆ†åˆ«æ˜¯"),a("strong",[s._v("æ¥æ”¶å’Œå‘é€çš„ PPS")]),s._v(", å•ä½ä¸ºåŒ…/ç§’.")]),s._v(" "),a("li",[s._v("rxkB/s å’Œ txkB/s åˆ†åˆ«æ˜¯"),a("strong",[s._v("æ¥æ”¶å’Œå‘é€çš„ååé‡")]),s._v(", å•ä½æ˜¯ KB/ç§’.")]),s._v(" "),a("li",[s._v("rxcmp/s å’Œ txcmp/s åˆ†åˆ«æ˜¯"),a("strong",[s._v("æ¥æ”¶å’Œå‘é€çš„å‹ç¼©æ•°æ®åŒ…æ•°")]),s._v(", å•ä½æ˜¯åŒ…/ç§’.")]),s._v(" "),a("li",[s._v("%ifutil æ˜¯ç½‘ç»œæ¥å£çš„ä½¿ç”¨ç‡, å³åŠåŒå·¥æ¨¡å¼ä¸‹ä¸º (rxkB/s+txkB/s)/Bandwidth, è€Œå…¨åŒå·¥æ¨¡å¼ä¸‹ä¸º max(rxkB/s, txkB/s)/Bandwidth.")])]),s._v(" "),a("p",[s._v("å…¶ä¸­, Bandwidth å¯ä»¥ç”¨ ethtool æ¥æŸ¥è¯¢, å®ƒçš„å•ä½é€šå¸¸æ˜¯ Gb/s æˆ–è€… Mb/s, ä¸è¿‡æ³¨æ„è¿™é‡Œå°å†™å­—æ¯ b, è¡¨ç¤ºæ¯”ç‰¹è€Œä¸æ˜¯å­—èŠ‚. é€šå¸¸æåˆ°çš„åƒå…†ç½‘å¡, ä¸‡å…†ç½‘å¡ç­‰, å•ä½ä¹Ÿéƒ½æ˜¯æ¯”ç‰¹. å¦‚ä¸‹å¯ä»¥çœ‹åˆ°, æˆ‘çš„ eth0 ç½‘å¡å°±æ˜¯ä¸€ä¸ªåƒå…†ç½‘å¡:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ ethtool eth0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Speed")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Speed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("Mb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"_6-è¿é€šæ€§å’Œå»¶æ—¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-è¿é€šæ€§å’Œå»¶æ—¶"}},[s._v("#")]),s._v(" 6.è¿é€šæ€§å’Œå»¶æ—¶")]),s._v(" "),a("p",[s._v("æœ€å"),a("strong",[s._v("é€šå¸¸ä½¿ç”¨ ping, æ¥æµ‹è¯•è¿œç¨‹ä¸»æœºçš„è¿é€šæ€§å’Œå»¶æ—¶, è€Œè¿™åŸºäº ICMP åè®®")]),s._v(". æ¯”å¦‚, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥æµ‹è¯•æœ¬æœºåˆ° 114.114.114.114 è¿™ä¸ª IP åœ°å€çš„è¿é€šæ€§å’Œå»¶æ—¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c3 è¡¨ç¤ºå‘é€ä¸‰æ¬¡ ICMP åŒ…ååœæ­¢")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\nPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("244")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("244")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("244")]),s._v(" ms\n \n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 2001ms\nrtt min/avg/max/mdev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("244.023")]),s._v("/244.070/244.105/0.034 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("ping çš„è¾“å‡º, å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€éƒ¨åˆ†, "),a("strong",[s._v("æ˜¯æ¯ä¸ª ICMP è¯·æ±‚çš„ä¿¡æ¯")]),s._v(", åŒ…æ‹¬ ICMP åºåˆ—å·(icmp_seq), TTL(ç”Ÿå­˜æ—¶é—´, æˆ–è€…è·³æ•°)ä»¥åŠå¾€è¿”å»¶æ—¶.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒéƒ¨åˆ†, åˆ™æ˜¯ä¸‰æ¬¡ ICMP è¯·æ±‚çš„æ±‡æ€».")])]),s._v(" "),a("p",[s._v("æ¯”å¦‚ä¸Šé¢çš„ç¤ºä¾‹æ˜¾ç¤º, å‘é€äº† 3 ä¸ªç½‘ç»œåŒ…, å¹¶ä¸”æ¥æ”¶åˆ° 3 ä¸ªå“åº”, æ²¡æœ‰ä¸¢åŒ…å‘ç”Ÿ, è¿™è¯´æ˜æµ‹è¯•ä¸»æœºåˆ° 114.114.114.114 æ˜¯è¿é€šçš„; å¹³å‡å¾€è¿”å»¶æ—¶(RTT)æ˜¯ 244ms, ä¹Ÿå°±æ˜¯ä»å‘é€ ICMP å¼€å§‹, åˆ°æ¥æ”¶åˆ° 114.114.114.114 å›å¤çš„ç¡®è®¤, æ€»å…±ç»å† 244ms.")]),s._v(" "),a("h5",{attrs:{id:"_7-å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-å°ç»“"}},[s._v("#")]),s._v(" 7.å°ç»“")]),s._v(" "),a("p",[s._v("é€šå¸¸ä½¿ç”¨å¸¦å®½, ååé‡, å»¶æ—¶ç­‰æŒ‡æ ‡, æ¥è¡¡é‡ç½‘ç»œçš„æ€§èƒ½; ç›¸åº”çš„, å¯ä»¥ç”¨ ifconfig, netstat, ss, sar, ping ç­‰å·¥å…·, æ¥æŸ¥çœ‹è¿™äº›ç½‘ç»œçš„æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("h4",{attrs:{id:"_35-åŸºç¡€ç¯‡-c10kå’Œc1000kå›é¡¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_35-åŸºç¡€ç¯‡-c10kå’Œc1000kå›é¡¾"}},[s._v("#")]),s._v(" 35-åŸºç¡€ç¯‡:C10Kå’ŒC1000Kå›é¡¾")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚ä¸»è¦æ¥å›é¡¾ä¸‹"),a("strong",[s._v("ç»å…¸çš„ C10K å’Œ C1000K é—®é¢˜")]),s._v(", ä»¥æ›´å¥½ç†è§£ Linux ç½‘ç»œçš„å·¥ä½œåŸç†, å¹¶è¿›ä¸€æ­¥åˆ†æ, å¦‚ä½•åšåˆ°å•æœºæ”¯æŒ C10M.")]),s._v(" "),a("p",[s._v("æ³¨æ„, "),a("strong",[s._v("C10K å’Œ C1000K çš„é¦–å­—æ¯ C æ˜¯ Client çš„ç¼©å†™. C10K å°±æ˜¯å•æœºåŒæ—¶å¤„ç† 1 ä¸‡ä¸ªè¯·æ±‚(å¹¶å‘è¿æ¥ 1 ä¸‡)çš„é—®é¢˜, è€Œ C1000K ä¹Ÿå°±æ˜¯å•æœºæ”¯æŒå¤„ç† 100 ä¸‡ä¸ªè¯·æ±‚(å¹¶å‘è¿æ¥ 100 ä¸‡)çš„é—®é¢˜")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-c10k"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-c10k"}},[s._v("#")]),s._v(" 1.C10K")]),s._v(" "),a("p",[s._v("C10K é—®é¢˜æœ€æ—©ç”± Dan Kegel åœ¨ 1999 å¹´æå‡º. é‚£æ—¶çš„æœåŠ¡å™¨è¿˜åªæ˜¯ 32 ä½ç³»ç»Ÿ, è¿è¡Œç€ Linux 2.2 ç‰ˆæœ¬(åæ¥åˆå‡çº§åˆ°äº† 2.4 å’Œ 2.6, è€Œ 2.6 æ‰æ”¯æŒ x86_64), åªé…ç½®äº†å¾ˆå°‘çš„å†…å­˜(2GB)å’Œåƒå…†ç½‘å¡.")]),s._v(" "),a("p",[s._v("æ€ä¹ˆåœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­æ”¯æŒå¹¶å‘ 1 ä¸‡çš„è¯·æ±‚å‘¢?")]),s._v(" "),a("p",[s._v("ä»èµ„æºä¸Šæ¥è¯´, å¯¹ 2GB å†…å­˜å’Œåƒå…†ç½‘å¡çš„æœåŠ¡å™¨æ¥è¯´, åŒæ—¶å¤„ç† 10000 ä¸ªè¯·æ±‚, åªè¦æ¯ä¸ªè¯·æ±‚å¤„ç†å ç”¨ä¸åˆ° 200KB(2GB/10000)çš„å†…å­˜å’Œ 100Kbit (1000Mbit/10000)çš„ç½‘ç»œå¸¦å®½å°±å¯ä»¥. æ‰€ä»¥, ç‰©ç†èµ„æºæ˜¯è¶³å¤Ÿçš„, æ¥ä¸‹æ¥è‡ªç„¶æ˜¯è½¯ä»¶çš„é—®é¢˜, ç‰¹åˆ«æ˜¯"),a("strong",[s._v("ç½‘ç»œçš„ I/O æ¨¡å‹é—®é¢˜")]),s._v(".")]),s._v(" "),a("p",[s._v("è¯´åˆ° I/O çš„æ¨¡å‹, åœ¨æ–‡ä»¶ç³»ç»Ÿçš„åŸç†ä¸­, æ›¾ç»ä»‹ç»è¿‡æ–‡ä»¶ I/O, å…¶å®ç½‘ç»œ I/O æ¨¡å‹ä¹Ÿç±»ä¼¼. åœ¨ C10K ä»¥å‰, Linux ä¸­ç½‘ç»œå¤„ç†éƒ½ç”¨åŒæ­¥é˜»å¡çš„æ–¹å¼, ä¹Ÿå°±æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½åˆ†é…ä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹. è¯·æ±‚æ•°åªæœ‰ 100 ä¸ªæ—¶, è¿™ç§æ–¹å¼è‡ªç„¶æ²¡é—®é¢˜, ä½†å¢åŠ åˆ° 10000 ä¸ªè¯·æ±‚æ—¶, 10000 ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹çš„è°ƒåº¦, ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹ƒè‡³å®ƒä»¬å ç”¨çš„å†…å­˜, éƒ½ä¼šæˆä¸ºç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶æ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹çš„æ–¹å¼ä¸åˆé€‚, é‚£ä¹ˆä¸ºäº†æ”¯æŒ 10000 ä¸ªå¹¶å‘è¯·æ±‚, è¿™é‡Œå°±æœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, "),a("strong",[s._v("æ€æ ·åœ¨ä¸€ä¸ªçº¿ç¨‹å†…å¤„ç†å¤šä¸ªè¯·æ±‚, ä¹Ÿå°±æ˜¯è¦åœ¨ä¸€ä¸ªçº¿ç¨‹å†…å“åº”å¤šä¸ªç½‘ç»œ I/O")]),s._v(". ä»¥å‰çš„åŒæ­¥é˜»å¡æ–¹å¼ä¸‹, ä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚, åˆ°è¿™é‡Œä¸å†é€‚ç”¨, æ˜¯ä¸æ˜¯å¯ä»¥ç”¨éé˜»å¡ I/O æˆ–è€…å¼‚æ­¥ I/O æ¥å¤„ç†å¤šä¸ªç½‘ç»œè¯·æ±‚å‘¢?")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, "),a("strong",[s._v("æ€ä¹ˆæ›´èŠ‚çœèµ„æºåœ°å¤„ç†å®¢æˆ·è¯·æ±‚, ä¹Ÿå°±æ˜¯è¦ç”¨æ›´å°‘çš„çº¿ç¨‹æ¥æœåŠ¡è¿™äº›è¯·æ±‚")]),s._v(". æ˜¯ä¸æ˜¯å¯ä»¥ç»§ç»­ç”¨åŸæ¥çš„ 100 ä¸ªæˆ–è€…æ›´å°‘çš„çº¿ç¨‹, æ¥æœåŠ¡ç°åœ¨çš„ 10000 ä¸ªè¯·æ±‚å‘¢?")])]),s._v(" "),a("p",[s._v("å½“ç„¶, äº‹å®ä¸Š, ç°åœ¨ C10K çš„é—®é¢˜æ—©å°±è§£å†³äº†, åœ¨ç»§ç»­å­¦ä¹ ä¸‹é¢çš„å†…å®¹å‰, å¯ä»¥å…ˆè‡ªå·±æ€è€ƒä¸€ä¸‹è¿™ä¸¤ä¸ªé—®é¢˜.")]),s._v(" "),a("h6",{attrs:{id:"_1-i-oæ¨¡å‹ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-i-oæ¨¡å‹ä¼˜åŒ–"}},[s._v("#")]),s._v(" (1)I/Oæ¨¡å‹ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("å¼‚æ­¥, éé˜»å¡ I/O çš„è§£å†³æ€è·¯, ä½ åº”è¯¥å¬è¯´è¿‡, å…¶å®å°±æ˜¯åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ç»å¸¸ç”¨åˆ°çš„ "),a("strong",[s._v("I/O å¤šè·¯å¤ç”¨")]),s._v("(I/O Multiplexing). I/O å¤šè·¯å¤ç”¨æ˜¯ä»€ä¹ˆæ„æ€å‘¢?")]),s._v(" "),a("p",[s._v("è¯¦ç»†äº†è§£å‰, å…ˆæ¥è®²"),a("strong",[s._v("ä¸¤ç§ I/O äº‹ä»¶é€šçŸ¥")]),s._v("çš„æ–¹å¼: "),a("mark",[a("strong",[s._v("æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘")])]),s._v(", å®ƒä»¬å¸¸ç”¨åœ¨å¥—æ¥å­—æ¥å£çš„æ–‡ä»¶æè¿°ç¬¦ä¸­.")]),s._v(" "),a("ul",[a("li",[a("mark",[a("strong",[s._v("æ°´å¹³è§¦å‘")])]),s._v(": "),a("strong",[s._v("åªè¦æ–‡ä»¶æè¿°ç¬¦å¯ä»¥éé˜»å¡åœ°æ‰§è¡Œ I/O, å°±ä¼šè§¦å‘é€šçŸ¥. ä¹Ÿå°±æ˜¯è¯´, åº”ç”¨ç¨‹åºå¯ä»¥éšæ—¶æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€, ç„¶åå†æ ¹æ®çŠ¶æ€, è¿›è¡Œ I/O æ“ä½œ")]),s._v(".")]),s._v(" "),a("li",[a("mark",[a("strong",[s._v("è¾¹ç¼˜è§¦å‘")])]),s._v(": "),a("strong",[s._v("åªæœ‰åœ¨æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜(ä¹Ÿå°±æ˜¯ I/O è¯·æ±‚è¾¾åˆ°)æ—¶, æ‰å‘é€ä¸€æ¬¡é€šçŸ¥. è¿™æ—¶å€™, åº”ç”¨ç¨‹åºéœ€è¦å°½å¯èƒ½å¤šåœ°æ‰§è¡Œ I/O, ç›´åˆ°æ— æ³•ç»§ç»­è¯»å†™, æ‰å¯ä»¥åœæ­¢. å¦‚æœ I/O æ²¡æ‰§è¡Œå®Œ, æˆ–è€…å› ä¸ºæŸç§åŸå› æ²¡æ¥å¾—åŠå¤„ç†, é‚£ä¹ˆè¿™æ¬¡é€šçŸ¥ä¹Ÿå°±ä¸¢å¤±äº†")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†å›è¿‡å¤´æ¥çœ‹ "),a("mark",[a("strong",[s._v("I/O å¤šè·¯å¤ç”¨çš„æ–¹æ³•. è¿™é‡Œå…¶å®æœ‰å¾ˆå¤šå®ç°æ–¹æ³•")])]),s._v(", ä¸‹é¢æ¥é€ä¸ªåˆ†æä¸€ä¸‹.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("ç¬¬ä¸€ç§, ä½¿ç”¨éé˜»å¡ I/O å’Œæ°´å¹³è§¦å‘é€šçŸ¥, æ¯”å¦‚ä½¿ç”¨ select æˆ–è€… poll")])]),s._v("â€‹ "),a("strong",[s._v(".")])]),s._v(" "),a("p",[s._v("æ ¹æ®åˆšæ‰æ°´å¹³è§¦å‘çš„åŸç†, select å’Œ poll éœ€è¦ä»æ–‡ä»¶æè¿°ç¬¦åˆ—è¡¨ä¸­, æ‰¾å‡ºå“ªäº›å¯ä»¥æ‰§è¡Œ I/O, ç„¶åè¿›è¡ŒçœŸæ­£çš„ç½‘ç»œ I/O è¯»å†™. ç”±äº I/O æ˜¯éé˜»å¡çš„, ä¸€ä¸ªçº¿ç¨‹ä¸­å°±å¯ä»¥åŒæ—¶ç›‘æ§ä¸€æ‰¹å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦, è¿™æ ·å°±è¾¾åˆ°äº†å•çº¿ç¨‹å¤„ç†å¤šè¯·æ±‚çš„ç›®çš„.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, è¿™ç§æ–¹å¼çš„æœ€å¤§ä¼˜ç‚¹, æ˜¯å¯¹åº”ç”¨ç¨‹åºæ¯”è¾ƒå‹å¥½, å®ƒçš„ API éå¸¸ç®€å•.")]),s._v(" "),a("p",[s._v("ä½†æ˜¯, åº”ç”¨è½¯ä»¶ä½¿ç”¨ select å’Œ poll æ—¶, éœ€è¦"),a("strong",[s._v("å¯¹è¿™äº›æ–‡ä»¶æè¿°ç¬¦åˆ—è¡¨è¿›è¡Œè½®è¯¢")]),s._v(", è¿™æ ·, è¯·æ±‚æ•°å¤šçš„æ—¶å€™å°±ä¼šæ¯”è¾ƒè€—æ—¶. å¹¶ä¸” select å’Œ poll è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é™åˆ¶.")]),s._v(" "),a("p",[s._v("select ä½¿ç”¨å›ºå®šé•¿åº¦çš„ä½ç›¸é‡, è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦çš„é›†åˆ, å› æ­¤ä¼šæœ‰"),a("strong",[s._v("æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶")]),s._v(". æ¯”å¦‚, åœ¨ 32 ä½ç³»ç»Ÿä¸­, é»˜è®¤é™åˆ¶æ˜¯ 1024. å¹¶ä¸”åœ¨ select å†…éƒ¨, æ£€æŸ¥å¥—æ¥å­—çŠ¶æ€æ˜¯ç”¨è½®è¯¢çš„æ–¹æ³•, å†åŠ ä¸Šåº”ç”¨è½¯ä»¶ä½¿ç”¨æ—¶çš„è½®è¯¢, å°±å˜æˆäº†ä¸€ä¸ª O(n^2) çš„å…³ç³».")]),s._v(" "),a("p",[s._v("è€Œ poll æ”¹è¿›äº† select çš„è¡¨ç¤ºæ–¹æ³•, æ¢æˆäº†ä¸€ä¸ªæ²¡æœ‰å›ºå®šé•¿åº¦çš„æ•°ç»„, è¿™æ ·å°±"),a("strong",[s._v("æ²¡æœ‰äº†æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶")]),s._v("(å½“ç„¶è¿˜ä¼šå—åˆ°ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦é™åˆ¶). ä½†åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨ poll æ—¶, åŒæ ·éœ€è¦å¯¹æ–‡ä»¶æè¿°ç¬¦åˆ—è¡¨è¿›è¡Œè½®è¯¢, è¿™æ ·å¤„ç†è€—æ—¶è·Ÿæè¿°ç¬¦æ•°é‡å°±æ˜¯ O(N) çš„å…³ç³».")]),s._v(" "),a("p",[s._v("é™¤æ­¤ä¹‹å¤–, åº”ç”¨ç¨‹åºæ¯æ¬¡è°ƒç”¨ select å’Œ poll æ—¶, è¿˜éœ€è¦æŠŠæ–‡ä»¶æè¿°ç¬¦çš„é›†åˆ, ä»ç”¨æˆ·ç©ºé—´ä¼ å…¥å†…æ ¸ç©ºé—´, ç”±å†…æ ¸ä¿®æ”¹å, å†ä¼ å‡ºåˆ°ç”¨æˆ·ç©ºé—´ä¸­. è¿™ä¸€æ¥ä¸€å›çš„å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´åˆ‡æ¢, ä¹Ÿå¢åŠ äº†å¤„ç†æˆæœ¬.")]),s._v(" "),a("p",[s._v("æœ‰æ²¡æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹å¼æ¥å¤„ç†å‘¢? ç­”æ¡ˆè‡ªç„¶æ˜¯è‚¯å®šçš„.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("ç¬¬äºŒç§, ä½¿ç”¨éé˜»å¡ I/O å’Œè¾¹ç¼˜è§¦å‘é€šçŸ¥, æ¯”å¦‚ epoll")])]),s._v(".")]),s._v(" "),a("p",[s._v("æ—¢ç„¶ select å’Œ poll æœ‰é‚£ä¹ˆå¤šçš„é—®é¢˜, å°±éœ€è¦ç»§ç»­å¯¹å…¶è¿›è¡Œä¼˜åŒ–, è€Œ epoll å°±å¾ˆå¥½åœ°è§£å†³äº†è¿™äº›é—®é¢˜.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("epoll ä½¿ç”¨çº¢é»‘æ ‘, åœ¨å†…æ ¸ä¸­ç®¡ç†æ–‡ä»¶æè¿°ç¬¦çš„é›†åˆ")]),s._v(", è¿™æ ·å°±ä¸éœ€è¦åº”ç”¨ç¨‹åºåœ¨æ¯æ¬¡æ“ä½œæ—¶éƒ½ä¼ å…¥, ä¼ å‡ºè¿™ä¸ªé›†åˆ.")]),s._v(" "),a("li",[a("strong",[s._v("epoll ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æœºåˆ¶, åªå…³æ³¨æœ‰ I/O äº‹ä»¶å‘ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦, ä¸éœ€è¦è½®è¯¢æ‰«ææ•´ä¸ªé›†åˆ")]),s._v(".")])]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, epoll æ˜¯åœ¨ Linux 2.6 ä¸­æ‰æ–°å¢çš„åŠŸèƒ½(2.4 è™½ç„¶ä¹Ÿæœ‰, ä½†åŠŸèƒ½ä¸å®Œå–„). ç”±äºè¾¹ç¼˜è§¦å‘åªåœ¨æ–‡ä»¶æè¿°ç¬¦å¯è¯»æˆ–å¯å†™äº‹ä»¶å‘ç”Ÿæ—¶æ‰é€šçŸ¥, é‚£ä¹ˆåº”ç”¨ç¨‹åºå°±éœ€è¦å°½å¯èƒ½å¤šåœ°æ‰§è¡Œ I/O, å¹¶è¦å¤„ç†æ›´å¤šçš„å¼‚å¸¸äº‹ä»¶.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("ç¬¬ä¸‰ç§, ä½¿ç”¨å¼‚æ­¥ I/O(Asynchronous I/O, ç®€ç§°ä¸º AIO)")])]),s._v(" . åœ¨å‰é¢æ–‡ä»¶ç³»ç»ŸåŸç†çš„å†…å®¹ä¸­, æ›¾ä»‹ç»è¿‡å¼‚æ­¥ I/O ä¸åŒæ­¥ I/O çš„åŒºåˆ«. å¼‚æ­¥ I/O å…è®¸åº”ç”¨ç¨‹åºåŒæ—¶å‘èµ·å¾ˆå¤š I/O æ“ä½œ, è€Œä¸ç”¨ç­‰å¾…è¿™äº›æ“ä½œå®Œæˆ. è€Œåœ¨ I/O å®Œæˆå, ç³»ç»Ÿä¼šç”¨äº‹ä»¶é€šçŸ¥(æ¯”å¦‚ä¿¡å·æˆ–è€…å›è°ƒå‡½æ•°)çš„æ–¹å¼, å‘Šè¯‰åº”ç”¨ç¨‹åº. è¿™æ—¶åº”ç”¨ç¨‹åºæ‰ä¼šå»æŸ¥è¯¢ I/O æ“ä½œçš„ç»“æœ. å¼‚æ­¥ I/O ä¹Ÿæ˜¯åˆ°äº† Linux 2.6 æ‰æ”¯æŒçš„åŠŸèƒ½, å¹¶ä¸”åœ¨å¾ˆé•¿æ—¶é—´é‡Œéƒ½å¤„äºä¸å®Œå–„çš„çŠ¶æ€, æ¯”å¦‚ glibc æä¾›çš„å¼‚æ­¥ I/O åº“, å°±ä¸€ç›´è¢«ç¤¾åŒºè¯Ÿç—…. åŒæ—¶, ç”±äºå¼‚æ­¥ I/O è·Ÿå¤§å®¶çš„ç›´è§‚é€»è¾‘ä¸å¤ªä¸€æ ·, æƒ³è¦ä½¿ç”¨çš„è¯, ä¸€å®šè¦"),a("strong",[s._v("å°å¿ƒè®¾è®¡")]),s._v(", å…¶ä½¿ç”¨éš¾åº¦æ¯”è¾ƒé«˜.")]),s._v(" "),a("h6",{attrs:{id:"_2-å·¥ä½œæ¨¡å‹ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å·¥ä½œæ¨¡å‹ä¼˜åŒ–"}},[s._v("#")]),s._v(" (2)å·¥ä½œæ¨¡å‹ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("äº†è§£äº† I/O æ¨¡å‹å, è¯·æ±‚å¤„ç†çš„ä¼˜åŒ–å°±æ¯”è¾ƒç›´è§‚äº†. ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨å, å°±å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªè¯·æ±‚, å…¶ä¸­åˆæœ‰ä¸‹é¢ä¸¤ç§ä¸åŒçš„å·¥ä½œæ¨¡å‹.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("ç¬¬ä¸€ç§, ä¸»è¿›ç¨‹ + å¤šä¸ª worker å­è¿›ç¨‹, è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ¨¡å‹")])]),s._v(". è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªé€šç”¨å·¥ä½œæ¨¡å¼å°±æ˜¯:")]),s._v(" "),a("ul",[a("li",[s._v("ä¸»è¿›ç¨‹æ‰§è¡Œ bind() + listen() å, åˆ›å»ºå¤šä¸ªå­è¿›ç¨‹;")]),s._v(" "),a("li",[s._v("ç„¶å, åœ¨æ¯ä¸ªå­è¿›ç¨‹ä¸­, éƒ½é€šè¿‡ accept() æˆ– epoll_wait() æ¥å¤„ç†ç›¸åŒçš„å¥—æ¥å­—.")])]),s._v(" "),a("p",[s._v("æ¯”å¦‚, æœ€å¸¸ç”¨çš„"),a("strong",[s._v("åå‘ä»£ç†æœåŠ¡å™¨ Nginx å°±æ˜¯è¿™ä¹ˆå·¥ä½œ")]),s._v("çš„. å®ƒä¹Ÿæ˜¯ç”±ä¸»è¿›ç¨‹å’Œå¤šä¸ª worker è¿›ç¨‹ç»„æˆ. ä¸»è¿›ç¨‹ä¸»è¦ç”¨æ¥åˆå§‹åŒ–å¥—æ¥å­—, å¹¶ç®¡ç†å­è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ; è€Œ worker è¿›ç¨‹, åˆ™è´Ÿè´£å®é™…çš„è¯·æ±‚å¤„ç†. ä¸‹é¢ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºè¿™ä¸ªå…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1af78daa535fe3042c114d87dce4022b-20230731161933-y58sp06.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™é‡Œè¦æ³¨æ„, accept() å’Œ epoll_wait() è°ƒç”¨, è¿˜å­˜åœ¨ä¸€ä¸ª"),a("strong",[s._v("æƒŠç¾¤")]),s._v("çš„é—®é¢˜. æ¢å¥è¯è¯´, å½“ç½‘ç»œ I/O äº‹ä»¶å‘ç”Ÿæ—¶, å¤šä¸ªè¿›ç¨‹è¢«åŒæ—¶å”¤é†’, ä½†å®é™…ä¸Šåªæœ‰ä¸€ä¸ªè¿›ç¨‹æ¥å“åº”è¿™ä¸ªäº‹ä»¶, å…¶ä»–è¢«å”¤é†’çš„è¿›ç¨‹éƒ½ä¼šé‡æ–°ä¼‘çœ .")]),s._v(" "),a("ul",[a("li",[s._v("å…¶ä¸­, accept() çš„æƒŠç¾¤é—®é¢˜, å·²ç»åœ¨ Linux 2.6 ä¸­è§£å†³äº†;")]),s._v(" "),a("li",[s._v("è€Œ epoll çš„é—®é¢˜, åˆ°äº† Linux 4.5 æ‰é€šè¿‡ EPOLLEXCLUSIVE è§£å†³.")])]),s._v(" "),a("p",[a("strong",[s._v("ä¸ºäº†é¿å…æƒŠç¾¤é—®é¢˜, Nginx åœ¨æ¯ä¸ª worker è¿›ç¨‹ä¸­, éƒ½å¢åŠ ä¸€ä¸ªäº†å…¨å±€é”(accept_mutex). è¿™äº› worker è¿›ç¨‹éœ€è¦é¦–å…ˆç«äº‰åˆ°é”, åªæœ‰ç«äº‰åˆ°é”çš„è¿›ç¨‹, æ‰ä¼šåŠ å…¥åˆ° epoll ä¸­, è¿™æ ·å°±ç¡®ä¿åªæœ‰ä¸€ä¸ª worker å­è¿›ç¨‹è¢«å”¤é†’.")])]),s._v(" "),a("p",[s._v("ä¸è¿‡, æ ¹æ®å‰é¢ CPU æ¨¡å—çš„å­¦ä¹ , ä½ åº”è¯¥è¿˜è®°å¾—, è¿›ç¨‹çš„ç®¡ç†, è°ƒåº¦, ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬éå¸¸é«˜. é‚£ä¸ºä»€ä¹ˆä½¿ç”¨å¤šè¿›ç¨‹æ¨¡å¼çš„ Nginx, å´å…·æœ‰éå¸¸å¥½çš„æ€§èƒ½å‘¢? è¿™é‡Œæœ€ä¸»è¦çš„ä¸€ä¸ªåŸå› å°±æ˜¯, "),a("strong",[s._v("è¿™äº› worker è¿›ç¨‹, å®é™…ä¸Šå¹¶ä¸éœ€è¦ç»å¸¸åˆ›å»ºå’Œé”€æ¯, è€Œæ˜¯åœ¨æ²¡ä»»åŠ¡æ—¶ä¼‘çœ , æœ‰ä»»åŠ¡æ—¶å”¤é†’. åªæœ‰åœ¨ worker ç”±äºæŸäº›å¼‚å¸¸é€€å‡ºæ—¶, ä¸»è¿›ç¨‹æ‰éœ€è¦åˆ›å»ºæ–°çš„è¿›ç¨‹æ¥ä»£æ›¿å®ƒ")]),s._v(".")]),s._v(" "),a("p",[s._v("å½“ç„¶, ä¹Ÿå¯ä»¥ç”¨çº¿ç¨‹ä»£æ›¿è¿›ç¨‹: ä¸»çº¿ç¨‹è´Ÿè´£å¥—æ¥å­—åˆå§‹åŒ–å’Œå­çº¿ç¨‹çŠ¶æ€çš„ç®¡ç†, è€Œå­çº¿ç¨‹åˆ™è´Ÿè´£å®é™…çš„è¯·æ±‚å¤„ç†. ç”±äºçº¿ç¨‹çš„è°ƒåº¦å’Œåˆ‡æ¢æˆæœ¬æ¯”è¾ƒä½, å®é™…ä¸Šå¯ä»¥è¿›ä¸€æ­¥æŠŠ epoll_wait() éƒ½æ”¾åˆ°ä¸»çº¿ç¨‹ä¸­, ä¿è¯æ¯æ¬¡äº‹ä»¶éƒ½åªå”¤é†’ä¸»çº¿ç¨‹, è€Œå­çº¿ç¨‹åªéœ€è¦è´Ÿè´£åç»­çš„è¯·æ±‚å¤„ç†.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("ç¬¬äºŒç§, ç›‘å¬åˆ°ç›¸åŒç«¯å£çš„å¤šè¿›ç¨‹æ¨¡å‹")])]),s._v(". åœ¨è¿™ç§æ–¹å¼ä¸‹, æ‰€æœ‰çš„è¿›ç¨‹éƒ½ç›‘å¬ç›¸åŒçš„æ¥å£, å¹¶ä¸”å¼€å¯ SO_REUSEPORT é€‰é¡¹, ç”±å†…æ ¸è´Ÿè´£å°†è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°è¿™äº›ç›‘å¬è¿›ç¨‹ä¸­å». è¿™ä¸€è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/0278095fe33dcd677f3decc1c9c0cc4d-20230731161933-bx0se6g.png",alt:""}})]),s._v(" "),a("p",[s._v("ç”±äºå†…æ ¸ç¡®ä¿äº†åªæœ‰ä¸€ä¸ªè¿›ç¨‹è¢«å”¤é†’, å°±ä¸ä¼šå‡ºç°æƒŠç¾¤é—®é¢˜äº†. æ¯”å¦‚, Nginx åœ¨ 1.9.1 ä¸­å°±å·²ç»æ”¯æŒäº†è¿™ç§æ¨¡å¼.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/8e993b807e76db9fd8a8700ebe54c8fa-20230731161933-3dresop.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, æƒ³è¦ä½¿ç”¨ SO_REUSEPORT é€‰é¡¹, éœ€è¦ç”¨ Linux 3.9 ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥.")]),s._v(" "),a("h5",{attrs:{id:"_2-c1000k"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-c1000k"}},[s._v("#")]),s._v(" 2.C1000K")]),s._v(" "),a("p",[s._v("åŸºäº I/O å¤šè·¯å¤ç”¨å’Œè¯·æ±‚å¤„ç†çš„ä¼˜åŒ–, C10K é—®é¢˜å¾ˆå®¹æ˜“å°±å¯ä»¥è§£å†³. ä¸è¿‡, éšç€æ‘©å°”å®šå¾‹å¸¦æ¥çš„æœåŠ¡å™¨æ€§èƒ½æå‡, ä»¥åŠäº’è”ç½‘çš„æ™®åŠ, æ–°å…´æœåŠ¡ä¼šå¯¹æ€§èƒ½æå‡ºæ›´é«˜çš„è¦æ±‚.")]),s._v(" "),a("p",[s._v("å¾ˆå¿«, åŸæ¥çš„ C10K å·²ç»ä¸èƒ½æ»¡è¶³éœ€æ±‚, æ‰€ä»¥åˆæœ‰äº† "),a("strong",[s._v("C100K å’Œ C1000K")]),s._v(", ä¹Ÿå°±æ˜¯å¹¶å‘ä»åŸæ¥çš„ 1 ä¸‡å¢åŠ åˆ° 10 ä¸‡, ä¹ƒè‡³ 100 ä¸‡. ä» 1 ä¸‡åˆ° 10 ä¸‡, å…¶å®è¿˜æ˜¯åŸºäº C10K çš„è¿™äº›ç†è®º, epoll é…åˆçº¿ç¨‹æ± , å†åŠ ä¸Š CPU, å†…å­˜å’Œç½‘ç»œæ¥å£çš„æ€§èƒ½å’Œå®¹é‡æå‡. å¤§éƒ¨åˆ†æƒ…å†µä¸‹, C100K å¾ˆè‡ªç„¶å°±å¯ä»¥è¾¾åˆ°.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, å†è¿›ä¸€æ­¥, C1000K æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“å°±å®ç°å‘¢? è¿™å…¶å®æ²¡æœ‰é‚£ä¹ˆç®€å•äº†.")]),s._v(" "),a("p",[s._v("é¦–å…ˆä»ç‰©ç†èµ„æºä½¿ç”¨ä¸Šæ¥è¯´, "),a("strong",[s._v("100 ä¸‡ä¸ªè¯·æ±‚éœ€è¦å¤§é‡çš„ç³»ç»Ÿèµ„æº")]),s._v(". æ¯”å¦‚,")]),s._v(" "),a("ul",[a("li",[s._v("å‡è®¾æ¯ä¸ªè¯·æ±‚éœ€è¦ 16KB å†…å­˜çš„è¯, é‚£ä¹ˆæ€»å…±å°±éœ€è¦å¤§çº¦ 15 GB å†…å­˜.")]),s._v(" "),a("li",[s._v("è€Œä»å¸¦å®½ä¸Šæ¥è¯´, å‡è®¾åªæœ‰ 20% æ´»è·ƒè¿æ¥, å³ä½¿æ¯ä¸ªè¿æ¥åªéœ€è¦ 1KB/s çš„ååé‡, æ€»å…±ä¹Ÿéœ€è¦ 1.6 Gb/s çš„ååé‡. åƒå…†ç½‘å¡æ˜¾ç„¶æ»¡è¶³ä¸äº†è¿™ä¹ˆå¤§çš„ååé‡, æ‰€ä»¥è¿˜éœ€è¦é…ç½®ä¸‡å…†ç½‘å¡, æˆ–è€…åŸºäºå¤šç½‘å¡ Bonding æ‰¿è½½æ›´å¤§çš„ååé‡.")])]),s._v(" "),a("p",[s._v("å…¶æ¬¡, ä»è½¯ä»¶èµ„æºä¸Šæ¥è¯´, "),a("strong",[s._v("å¤§é‡çš„è¿æ¥ä¹Ÿä¼šå ç”¨å¤§é‡çš„è½¯ä»¶èµ„æº, æ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡, è¿æ¥çŠ¶æ€çš„è·Ÿè¸ª(CONNTRACK), ç½‘ç»œåè®®æ ˆçš„ç¼“å­˜å¤§å°(æ¯”å¦‚å¥—æ¥å­—è¯»å†™ç¼“å­˜, TCP è¯»å†™ç¼“å­˜)")]),s._v(" ç­‰ç­‰.")]),s._v(" "),a("p",[s._v("æœ€å, "),a("strong",[s._v("å¤§é‡è¯·æ±‚å¸¦æ¥çš„ä¸­æ–­å¤„ç†")]),s._v(", ä¹Ÿä¼šå¸¦æ¥éå¸¸é«˜çš„å¤„ç†æˆæœ¬. è¿™æ ·å°±éœ€è¦å¤šé˜Ÿåˆ—ç½‘å¡, ä¸­æ–­è´Ÿè½½å‡è¡¡, CPU ç»‘å®š, RPS/RFS(è½¯ä¸­æ–­è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ª CPU æ ¸ä¸Š), ä»¥åŠå°†ç½‘ç»œåŒ…çš„å¤„ç†å¸è½½(Offload)åˆ°ç½‘ç»œè®¾å¤‡(å¦‚ TSO/GSO, LRO/GRO, VXLAN OFFLOAD)ç­‰å„ç§ç¡¬ä»¶å’Œè½¯ä»¶çš„ä¼˜åŒ–.")]),s._v(" "),a("p",[a("strong",[s._v("C1000K çš„è§£å†³æ–¹æ³•, æœ¬è´¨ä¸Šè¿˜æ˜¯æ„å»ºåœ¨ epoll çš„éé˜»å¡ I/O æ¨¡å‹ä¸Š. åªä¸è¿‡, é™¤äº† I/O æ¨¡å‹ä¹‹å¤–, è¿˜éœ€è¦ä»åº”ç”¨ç¨‹åºåˆ° Linux å†…æ ¸, å†åˆ° CPU, å†…å­˜å’Œç½‘ç»œç­‰å„ä¸ªå±‚æ¬¡çš„æ·±åº¦ä¼˜åŒ–, ç‰¹åˆ«æ˜¯éœ€è¦å€ŸåŠ©ç¡¬ä»¶, æ¥å¸è½½é‚£äº›åŸæ¥é€šè¿‡è½¯ä»¶å¤„ç†çš„å¤§é‡åŠŸèƒ½")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_3-c10m"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-c10m"}},[s._v("#")]),s._v(" 3.C10M")]),s._v(" "),a("p",[s._v("æ˜¾ç„¶, äººä»¬å¯¹äºæ€§èƒ½çš„è¦æ±‚æ˜¯æ— æ­¢å¢ƒçš„. å†è¿›ä¸€æ­¥, æœ‰æ²¡æœ‰å¯èƒ½åœ¨å•æœºä¸­, åŒæ—¶å¤„ç† 1000 ä¸‡çš„è¯·æ±‚å‘¢? è¿™ä¹Ÿå°±æ˜¯ C10M é—®é¢˜.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, åœ¨ C1000K é—®é¢˜ä¸­, å„ç§è½¯ä»¶, ç¡¬ä»¶çš„ä¼˜åŒ–å¾ˆå¯èƒ½éƒ½å·²ç»åšåˆ°å¤´äº†. ç‰¹åˆ«æ˜¯å½“å‡çº§å®Œç¡¬ä»¶(æ¯”å¦‚è¶³å¤Ÿå¤šçš„å†…å­˜, å¸¦å®½è¶³å¤Ÿå¤§çš„ç½‘å¡, æ›´å¤šçš„ç½‘ç»œåŠŸèƒ½å¸è½½ç­‰)å, å¯èƒ½ä¼šå‘ç°, æ— è®ºæ€ä¹ˆä¼˜åŒ–åº”ç”¨ç¨‹åºå’Œå†…æ ¸ä¸­çš„å„ç§ç½‘ç»œå‚æ•°, æƒ³å®ç° 1000 ä¸‡è¯·æ±‚çš„å¹¶å‘, éƒ½æ˜¯æå…¶å›°éš¾çš„.")]),s._v(" "),a("p",[s._v("ç©¶å…¶æ ¹æœ¬, "),a("strong",[s._v("è¿˜æ˜¯ Linux å†…æ ¸åè®®æ ˆåšäº†å¤ªå¤šå¤ªç¹é‡çš„å·¥ä½œ. ä»ç½‘å¡ä¸­æ–­å¸¦æ¥çš„ç¡¬ä¸­æ–­å¤„ç†ç¨‹åºå¼€å§‹, åˆ°è½¯ä¸­æ–­ä¸­çš„å„å±‚ç½‘ç»œåè®®å¤„ç†, æœ€åå†åˆ°åº”ç”¨ç¨‹åº, è¿™ä¸ªè·¯å¾„å®åœ¨æ˜¯å¤ªé•¿äº†, å°±ä¼šå¯¼è‡´ç½‘ç»œåŒ…çš„å¤„ç†ä¼˜åŒ–, åˆ°äº†ä¸€å®šç¨‹åº¦å, å°±æ— æ³•æ›´è¿›ä¸€æ­¥äº†")]),s._v(".")]),s._v(" "),a("p",[s._v("è¦è§£å†³è¿™ä¸ªé—®é¢˜, æœ€é‡è¦å°±æ˜¯"),a("strong",[s._v("è·³è¿‡å†…æ ¸åè®®æ ˆçš„å†—é•¿è·¯å¾„, æŠŠç½‘ç»œåŒ…ç›´æ¥é€åˆ°è¦å¤„ç†çš„åº”ç”¨ç¨‹åºé‚£é‡Œå»")]),s._v(". è¿™é‡Œæœ‰ä¸¤ç§å¸¸è§çš„æœºåˆ¶, "),a("strong",[s._v("DPDK å’Œ XDP")]),s._v(".")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç§æœºåˆ¶, DPDK, æ˜¯ç”¨æˆ·æ€ç½‘ç»œçš„æ ‡å‡†. å®ƒè·³è¿‡å†…æ ¸åè®®æ ˆ, ç›´æ¥ç”±ç”¨æˆ·æ€è¿›ç¨‹é€šè¿‡è½®è¯¢çš„æ–¹å¼, æ¥å¤„ç†ç½‘ç»œæ¥æ”¶.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/56b324aca34c040e1c95c266f2e338ee-20230731161933-8op4tm3.png",alt:""}})]),s._v(" "),a("p",[s._v("è¯´èµ·è½®è¯¢, ä½ è‚¯å®šä¼šä¸‹æ„è¯†è®¤ä¸ºå®ƒæ˜¯ä½æ•ˆçš„è±¡å¾, ä½†æ˜¯è¿›ä¸€æ­¥åé—®ä¸‹è‡ªå·±, å®ƒçš„ä½æ•ˆä¸»è¦ä½“ç°åœ¨å“ªé‡Œå‘¢? æ˜¯æŸ¥è¯¢æ—¶é—´æ˜æ˜¾å¤šäºå®é™…å·¥ä½œæ—¶é—´çš„æƒ…å†µä¸‹å§! é‚£ä¹ˆ, æ¢ä¸ªè§’åº¦æ¥æƒ³, å¦‚æœæ¯æ—¶æ¯åˆ»éƒ½æœ‰æ–°çš„ç½‘ç»œåŒ…éœ€è¦å¤„ç†, è½®è¯¢çš„ä¼˜åŠ¿å°±å¾ˆæ˜æ˜¾äº†. æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨ PPS éå¸¸é«˜çš„åœºæ™¯ä¸­, æŸ¥è¯¢æ—¶é—´æ¯”å®é™…å·¥ä½œæ—¶é—´å°‘äº†å¾ˆå¤š, ç»å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨å¤„ç†ç½‘ç»œåŒ…;")]),s._v(" "),a("li",[s._v("è€Œè·³è¿‡å†…æ ¸åè®®æ ˆå, å°±çœå»äº†ç¹æ‚çš„ç¡¬ä¸­æ–­, è½¯ä¸­æ–­å†åˆ° Linux ç½‘ç»œåè®®æ ˆé€å±‚å¤„ç†çš„è¿‡ç¨‹, åº”ç”¨ç¨‹åºå¯ä»¥é’ˆå¯¹åº”ç”¨çš„å®é™…åœºæ™¯, æœ‰é’ˆå¯¹æ€§åœ°ä¼˜åŒ–ç½‘ç»œåŒ…çš„å¤„ç†é€»è¾‘, è€Œä¸éœ€è¦å…³æ³¨æ‰€æœ‰çš„ç»†èŠ‚.")])]),s._v(" "),a("p",[s._v("æ­¤å¤–, DPDK è¿˜é€šè¿‡å¤§é¡µ, CPU ç»‘å®š, å†…å­˜å¯¹é½, æµæ°´çº¿å¹¶å‘ç­‰å¤šç§æœºåˆ¶, ä¼˜åŒ–ç½‘ç»œåŒ…çš„å¤„ç†æ•ˆç‡.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒç§æœºåˆ¶, "),a("strong",[s._v("XDP")]),s._v("(eXpress Data Path), åˆ™æ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ç§é«˜æ€§èƒ½ç½‘ç»œæ•°æ®è·¯å¾„. å®ƒå…è®¸ç½‘ç»œåŒ…, åœ¨è¿›å…¥å†…æ ¸åè®®æ ˆä¹‹å‰, å°±è¿›è¡Œå¤„ç†, ä¹Ÿå¯ä»¥å¸¦æ¥æ›´é«˜çš„æ€§èƒ½. XDP åº•å±‚è·Ÿä¹‹å‰ç”¨åˆ°çš„ bcc-tools ä¸€æ ·, éƒ½æ˜¯åŸºäº Linux å†…æ ¸çš„ eBPF æœºåˆ¶å®ç°çš„.")]),s._v(" "),a("p",[s._v("XDP çš„åŸç†å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/5fbd646b0becda35f05f59e4852fe11e-20230731161933-rjtyb1a.png",alt:""}})]),s._v(" "),a("p",[s._v("å¯ä»¥çœ‹åˆ°, XDP å¯¹å†…æ ¸çš„è¦æ±‚æ¯”è¾ƒé«˜, éœ€è¦çš„æ˜¯ Linux 4.8 ä»¥ä¸Šç‰ˆæœ¬, å¹¶ä¸”å®ƒä¹Ÿä¸æä¾›ç¼“å­˜é˜Ÿåˆ—. åŸºäº XDP çš„åº”ç”¨ç¨‹åºé€šå¸¸æ˜¯ä¸“ç”¨çš„ç½‘ç»œåº”ç”¨, å¸¸è§çš„æœ‰ IDS(å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ), DDoS é˜²å¾¡, "),a("a",{attrs:{href:"https://github.com/cilium/cilium",target:"_blank",rel:"noopener noreferrer"}},[s._v("cilium"),a("OutboundLink")],1),s._v(" å®¹å™¨ç½‘ç»œæ’ä»¶ç­‰.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-10"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å›é¡¾äº†ç»å…¸çš„ C10K é—®é¢˜, å¹¶è¿›ä¸€æ­¥å»¶ä¼¸åˆ°äº† C1000K å’Œ C10M é—®é¢˜.")]),s._v(" "),a("p",[a("strong",[s._v("C10K é—®é¢˜çš„æ ¹æº, ä¸€æ–¹é¢åœ¨äºç³»ç»Ÿæœ‰é™çš„èµ„æº; å¦ä¸€æ–¹é¢, ä¹Ÿæ˜¯æ›´é‡è¦çš„å› ç´ , æ˜¯åŒæ­¥é˜»å¡çš„ I/O æ¨¡å‹ä»¥åŠè½®è¯¢çš„å¥—æ¥å­—æ¥å£, é™åˆ¶äº†ç½‘ç»œäº‹ä»¶çš„å¤„ç†æ•ˆç‡")]),s._v(". Linux 2.6 ä¸­å¼•å…¥çš„ epoll , å®Œç¾è§£å†³äº† C10K çš„é—®é¢˜, ç°åœ¨çš„é«˜æ€§èƒ½ç½‘ç»œæ–¹æ¡ˆéƒ½åŸºäº epoll.")]),s._v(" "),a("p",[a("strong",[s._v("ä» C10K åˆ° C100K, å¯èƒ½åªéœ€è¦å¢åŠ ç³»ç»Ÿçš„ç‰©ç†èµ„æºå°±å¯ä»¥æ»¡è¶³; ä½†ä» C100K åˆ° C1000K, å°±ä¸ä»…ä»…æ˜¯å¢åŠ ç‰©ç†èµ„æºå°±èƒ½è§£å†³çš„é—®é¢˜äº†. è¿™å°±éœ€è¦å¤šæ–¹é¢çš„ä¼˜åŒ–å·¥ä½œäº†, ä»ç¡¬ä»¶çš„ä¸­æ–­å¤„ç†å’Œç½‘ç»œåŠŸèƒ½å¸è½½, åˆ°ç½‘ç»œåè®®æ ˆçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡, è¿æ¥çŠ¶æ€è·Ÿè¸ª, ç¼“å­˜é˜Ÿåˆ—ç­‰å†…æ ¸çš„ä¼˜åŒ–, å†åˆ°åº”ç”¨ç¨‹åºçš„å·¥ä½œæ¨¡å‹ä¼˜åŒ–, éƒ½æ˜¯è€ƒè™‘çš„é‡ç‚¹")]),s._v(".")]),s._v(" "),a("p",[s._v("å†è¿›ä¸€æ­¥, è¦å®ç° C10M, å°±"),a("strong",[s._v("ä¸åªæ˜¯å¢åŠ ç‰©ç†èµ„æº, æˆ–è€…ä¼˜åŒ–å†…æ ¸å’Œåº”ç”¨ç¨‹åºå¯ä»¥è§£å†³çš„é—®é¢˜äº†")]),s._v(". è¿™æ—¶å€™, å°±éœ€è¦ç”¨ XDP çš„æ–¹å¼, åœ¨å†…æ ¸åè®®æ ˆä¹‹å‰å¤„ç†ç½‘ç»œåŒ…; æˆ–è€…ç”¨ DPDK ç›´æ¥è·³è¿‡ç½‘ç»œåè®®æ ˆ, åœ¨ç”¨æˆ·ç©ºé—´é€šè¿‡è½®è¯¢çš„æ–¹å¼ç›´æ¥å¤„ç†ç½‘ç»œåŒ….")]),s._v(" "),a("p",[s._v("å½“ç„¶äº†, å®é™…ä¸Šåœ¨å¤§å¤šæ•°åœºæ™¯ä¸­, å¹¶ä¸éœ€è¦å•æœºå¹¶å‘ 1000 ä¸‡çš„è¯·æ±‚. é€šè¿‡è°ƒæ•´ç³»ç»Ÿæ¶æ„, æŠŠè¿™äº›è¯·æ±‚åˆ†å‘åˆ°å¤šå°æœåŠ¡å™¨ä¸­æ¥å¤„ç†, é€šå¸¸æ˜¯æ›´ç®€å•å’Œæ›´å®¹æ˜“æ‰©å±•çš„æ–¹æ¡ˆ.")]),s._v(" "),a("h4",{attrs:{id:"_36-å¥—è·¯ç¯‡-æ€ä¹ˆè¯„ä¼°ç³»ç»Ÿçš„ç½‘ç»œæ€§èƒ½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_36-å¥—è·¯ç¯‡-æ€ä¹ˆè¯„ä¼°ç³»ç»Ÿçš„ç½‘ç»œæ€§èƒ½"}},[s._v("#")]),s._v(" 36-å¥—è·¯ç¯‡:æ€ä¹ˆè¯„ä¼°ç³»ç»Ÿçš„ç½‘ç»œæ€§èƒ½?")]),s._v(" "),a("p",[s._v("åœ¨å¤§å¤šæ•°åœºæ™¯ä¸­, å¹¶ä¸éœ€è¦å•æœºå¹¶å‘ 1000 ä¸‡è¯·æ±‚. é€šè¿‡è°ƒæ•´ç³»ç»Ÿæ¶æ„, æŠŠè¯·æ±‚åˆ†å‘åˆ°å¤šå°æœåŠ¡å™¨ä¸­å¹¶è¡Œå¤„ç†, æ‰æ˜¯æ›´ç®€å•, æ‰©å±•æ€§æ›´å¥½çš„æ–¹æ¡ˆ.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™ç§æƒ…å†µä¸‹, å°±éœ€è¦"),a("strong",[s._v("è¯„ä¼°ç³»ç»Ÿçš„ç½‘ç»œæ€§èƒ½, ä»¥ä¾¿è€ƒå¯Ÿç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›, å¹¶ä¸ºå®¹é‡è§„åˆ’æä¾›åŸºå‡†æ•°æ®")]),s._v(". é‚£ä¹ˆ, åˆ°åº•è¯¥"),a("strong",[s._v("æ€ä¹ˆè¯„ä¼°ç½‘ç»œçš„æ€§èƒ½")]),s._v("å‘¢?")]),s._v(" "),a("h5",{attrs:{id:"_1-æ€§èƒ½æŒ‡æ ‡å›é¡¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ€§èƒ½æŒ‡æ ‡å›é¡¾"}},[s._v("#")]),s._v(" 1.æ€§èƒ½æŒ‡æ ‡å›é¡¾")]),s._v(" "),a("p",[s._v("åœ¨è¯„ä¼°ç½‘ç»œæ€§èƒ½å‰, å…ˆæ¥å›é¡¾ä¸€ä¸‹, è¡¡é‡ç½‘ç»œæ€§èƒ½çš„æŒ‡æ ‡. åœ¨ Linux ç½‘ç»œåŸºç¡€ç¯‡ä¸­æ›¾ç»è¯´åˆ°, "),a("strong",[s._v("å¸¦å®½, ååé‡, å»¶æ—¶, PPS ç­‰, éƒ½æ˜¯æœ€å¸¸ç”¨çš„ç½‘ç»œæ€§èƒ½æŒ‡æ ‡")]),s._v(".")]),s._v(" "),a("p",[s._v("è¿™å››ä¸ªæŒ‡æ ‡ä¸­, å¸¦å®½è·Ÿç‰©ç†ç½‘å¡é…ç½®æ˜¯ç›´æ¥å…³è”çš„. ä¸€èˆ¬æ¥è¯´, ç½‘å¡ç¡®å®šå, å¸¦å®½ä¹Ÿå°±ç¡®å®šäº†(å½“ç„¶, å®é™…å¸¦å®½ä¼šå—é™äºæ•´ä¸ªç½‘ç»œé“¾è·¯ä¸­æœ€å°çš„é‚£ä¸ªæ¨¡å—).")]),s._v(" "),a("p",[s._v('å¦å¤–, ä½ å¯èƒ½åœ¨å¾ˆå¤šåœ°æ–¹å¬è¯´è¿‡"ç½‘ç»œå¸¦å®½æµ‹è¯•", è¿™é‡Œæµ‹è¯•çš„å®é™…ä¸Šä¸æ˜¯å¸¦å®½, è€Œæ˜¯'),a("strong",[s._v("ç½‘ç»œååé‡")]),s._v(". Linux æœåŠ¡å™¨çš„ç½‘ç»œååé‡ä¸€èˆ¬ä¼šæ¯”å¸¦å®½å°, è€Œå¯¹äº¤æ¢æœºç­‰ä¸“é—¨çš„ç½‘ç»œè®¾å¤‡æ¥è¯´, ååé‡ä¸€èˆ¬ä¼šæ¥è¿‘å¸¦å®½.")]),s._v(" "),a("p",[s._v("æœ€åçš„ PPS, åˆ™æ˜¯ä»¥ç½‘ç»œåŒ…ä¸ºå•ä½çš„ç½‘ç»œä¼ è¾“é€Ÿç‡, é€šå¸¸ç”¨åœ¨éœ€è¦å¤§é‡è½¬å‘çš„åœºæ™¯ä¸­. è€Œå¯¹ TCP æˆ–è€… Web æœåŠ¡æ¥è¯´, æ›´å¤šä¼šç”¨å¹¶å‘è¿æ¥æ•°å’Œæ¯ç§’è¯·æ±‚æ•°(QPS, Query per Second)ç­‰æŒ‡æ ‡, å®ƒä»¬æ›´èƒ½ååº”å®é™…åº”ç”¨ç¨‹åºçš„æ€§èƒ½.")]),s._v(" "),a("h5",{attrs:{id:"_2-ç½‘ç»œåŸºå‡†æµ‹è¯•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç½‘ç»œåŸºå‡†æµ‹è¯•"}},[s._v("#")]),s._v(" 2.ç½‘ç»œåŸºå‡†æµ‹è¯•")]),s._v(" "),a("p",[s._v("ç†Ÿæ‚‰äº†ç½‘ç»œçš„æ€§èƒ½æŒ‡æ ‡å, æ¥ä¸‹æ¥å†æ¥çœ‹çœ‹, å¦‚ä½•é€šè¿‡æ€§èƒ½æµ‹è¯•æ¥ç¡®å®šè¿™äº›æŒ‡æ ‡çš„åŸºå‡†å€¼.")]),s._v(" "),a("p",[s._v("å¯ä»¥å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜. Linux ç½‘ç»œåŸºäº TCP/IP åè®®æ ˆ, è€Œä¸åŒåè®®å±‚çš„è¡Œä¸ºæ˜¾ç„¶ä¸åŒ. é‚£ä¹ˆæµ‹è¯•ä¹‹å‰, åº”è¯¥å¼„æ¸…æ¥š, è¦è¯„ä¼°çš„ç½‘ç»œæ€§èƒ½, ç©¶ç«Ÿå±äºåè®®æ ˆçš„å“ªä¸€å±‚? æ¢å¥è¯è¯´, "),a("strong",[s._v("åº”ç”¨ç¨‹åºåŸºäºåè®®æ ˆçš„å“ªä¸€å±‚å‘¢")]),s._v("?")]),s._v(" "),a("p",[s._v("æ ¹æ®å‰é¢å­¦è¿‡çš„ TCP/IP åè®®æ ˆçš„åŸç†, è¿™ä¸ªé—®é¢˜åº”è¯¥ä¸éš¾å›ç­”. æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("åŸºäº HTTP æˆ–è€… HTTPS çš„ Web åº”ç”¨ç¨‹åº, æ˜¾ç„¶å±äºåº”ç”¨å±‚, éœ€è¦æµ‹è¯• HTTP/HTTPS çš„æ€§èƒ½;")]),s._v(" "),a("li",[s._v("è€Œå¯¹å¤§å¤šæ•°æ¸¸æˆæœåŠ¡å™¨æ¥è¯´, ä¸ºäº†æ”¯æŒæ›´å¤§çš„åŒæ—¶åœ¨çº¿äººæ•°, é€šå¸¸ä¼šåŸºäº TCP æˆ– UDP, ä¸å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’, è¿™æ—¶å°±éœ€è¦æµ‹è¯• TCP/UDP çš„æ€§èƒ½;")]),s._v(" "),a("li",[s._v("å½“ç„¶, è¿˜æœ‰ä¸€äº›åœºæ™¯, æ˜¯æŠŠ Linux ä½œä¸ºä¸€ä¸ªè½¯äº¤æ¢æœºæˆ–è€…è·¯ç”±å™¨æ¥ç”¨çš„. è¿™ç§æƒ…å†µä¸‹, éœ€è¦å…³æ³¨ç½‘ç»œåŒ…çš„å¤„ç†èƒ½åŠ›(å³ PPS), é‡ç‚¹å…³æ³¨ç½‘ç»œå±‚çš„è½¬å‘æ€§èƒ½.")])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±ä»ä¸‹å¾€ä¸Š, äº†è§£ä¸åŒåè®®å±‚çš„ç½‘ç»œæ€§èƒ½æµ‹è¯•æ–¹æ³•. ä¸è¿‡è¦æ³¨æ„, ä½å±‚åè®®æ˜¯å…¶ä¸Šçš„å„å±‚ç½‘ç»œåè®®çš„åŸºç¡€. è‡ªç„¶, ä½å±‚åè®®çš„æ€§èƒ½, ä¹Ÿå°±å†³å®šäº†é«˜å±‚çš„ç½‘ç»œæ€§èƒ½.")]),s._v(" "),a("p",[s._v("æ³¨æ„, ä»¥ä¸‹æ‰€æœ‰çš„æµ‹è¯•æ–¹æ³•, éƒ½éœ€è¦ä¸¤å° Linux è™šæ‹Ÿæœº. å…¶ä¸­ä¸€å°, å¯ä»¥å½“ä½œå¾…æµ‹è¯•çš„ç›®æ ‡æœºå™¨; è€Œå¦ä¸€å°, åˆ™å¯ä»¥å½“ä½œæ­£åœ¨è¿è¡Œç½‘ç»œæœåŠ¡çš„å®¢æˆ·ç«¯, ç”¨æ¥è¿è¡Œæµ‹è¯•å·¥å…·.")]),s._v(" "),a("h5",{attrs:{id:"_3-å„åè®®å±‚çš„æ€§èƒ½æµ‹è¯•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å„åè®®å±‚çš„æ€§èƒ½æµ‹è¯•"}},[s._v("#")]),s._v(" 3.å„åè®®å±‚çš„æ€§èƒ½æµ‹è¯•")]),s._v(" "),a("h6",{attrs:{id:"_1-è½¬å‘æ€§èƒ½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-è½¬å‘æ€§èƒ½"}},[s._v("#")]),s._v(" (1)è½¬å‘æ€§èƒ½")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ¥çœ‹, "),a("strong",[s._v("ç½‘ç»œæ¥å£å±‚å’Œç½‘ç»œå±‚, å®ƒä»¬ä¸»è¦è´Ÿè´£ç½‘ç»œåŒ…çš„å°è£…, å¯»å€, è·¯ç”±ä»¥åŠå‘é€å’Œæ¥æ”¶")]),s._v(". åœ¨è¿™ä¸¤ä¸ªç½‘ç»œåè®®å±‚ä¸­, æ¯ç§’å¯å¤„ç†çš„ç½‘ç»œåŒ…æ•° PPS, å°±æ˜¯æœ€é‡è¦çš„æ€§èƒ½æŒ‡æ ‡. ç‰¹åˆ«æ˜¯ 64B å°åŒ…çš„å¤„ç†èƒ½åŠ›, å€¼å¾—ç‰¹åˆ«å…³æ³¨. é‚£ä¹ˆ, å¦‚ä½•æ¥æµ‹è¯•ç½‘ç»œåŒ…çš„å¤„ç†èƒ½åŠ›å‘¢?")]),s._v(" "),a("p",[s._v("è¯´åˆ°ç½‘ç»œåŒ…ç›¸å…³çš„æµ‹è¯•, ä½ å¯èƒ½ä¼šè§‰å¾—é™Œç”Ÿ. ä¸è¿‡, å…¶å®åœ¨ä¸“æ å¼€å¤´çš„ CPU æ€§èƒ½ç¯‡ä¸­, å°±æ¥è§¦è¿‡ä¸€ä¸ªç›¸å…³å·¥å…·, ä¹Ÿå°±æ˜¯è½¯ä¸­æ–­æ¡ˆä¾‹ä¸­çš„ "),a("strong",[s._v("hping3")]),s._v(". åœ¨é‚£ä¸ªæ¡ˆä¾‹ä¸­, hping3 ä½œä¸ºä¸€ä¸ª SYN æ”»å‡»çš„å·¥å…·æ¥ä½¿ç”¨. å®é™…ä¸Š, hping3 æ›´å¤šçš„ç”¨é€”, æ˜¯ä½œä¸ºä¸€ä¸ªæµ‹è¯•ç½‘ç»œåŒ…å¤„ç†èƒ½åŠ›çš„æ€§èƒ½å·¥å…·.")]),s._v(" "),a("p",[s._v("å†æ¥ä»‹ç»å¦ä¸€ä¸ªæ›´å¸¸ç”¨çš„å·¥å…·, Linux å†…æ ¸è‡ªå¸¦çš„é«˜æ€§èƒ½ç½‘ç»œæµ‹è¯•å·¥å…· pktgen. "),a("strong",[s._v("pktgen æ”¯æŒä¸°å¯Œçš„è‡ªå®šä¹‰é€‰é¡¹, æ–¹ä¾¿æ ¹æ®å®é™…éœ€è¦æ„é€ æ‰€éœ€ç½‘ç»œåŒ…, ä»è€Œæ›´å‡†ç¡®åœ°æµ‹è¯•å‡ºç›®æ ‡æœåŠ¡å™¨çš„æ€§èƒ½")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡, åœ¨ Linux ç³»ç»Ÿä¸­, å¹¶ä¸èƒ½ç›´æ¥æ‰¾åˆ° pktgen å‘½ä»¤. å› ä¸º pktgen ä½œä¸ºä¸€ä¸ª"),a("strong",[s._v("å†…æ ¸çº¿ç¨‹")]),s._v("æ¥è¿è¡Œ, éœ€è¦åŠ è½½ pktgen å†…æ ¸æ¨¡å—å, å†é€šè¿‡ "),a("code",[s._v("/proc")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿæ¥äº¤äº’. ä¸‹é¢å°±æ˜¯ pktgen å¯åŠ¨çš„ä¸¤ä¸ªå†…æ ¸çº¿ç¨‹å’Œ "),a("code",[s._v("/proc")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿçš„äº¤äº’æ–‡ä»¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ modprobe pktgen\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" pktgen "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v("\nroot     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26384")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 06:17 ?        00:00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kpktgend_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26385")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 06:17 ?        00:00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kpktgend_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /proc/net/pktgen/\nkpktgend_0  kpktgend_1  pgctrl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("pktgen åœ¨æ¯ä¸ª CPU ä¸Šå¯åŠ¨ä¸€ä¸ªå†…æ ¸çº¿ç¨‹, å¹¶å¯ä»¥é€šè¿‡ "),a("code",[s._v("/proc/net/pktgen")]),s._v("â€‹ ä¸‹é¢çš„åŒåæ–‡ä»¶, è·Ÿè¿™äº›çº¿ç¨‹äº¤äº’; è€Œ pgctrl åˆ™ä¸»è¦ç”¨æ¥æ§åˆ¶è¿™æ¬¡æµ‹è¯•çš„å¼€å¯å’Œåœæ­¢.")]),s._v(" "),a("p",[s._v("å¦‚æœ modprobe å‘½ä»¤æ‰§è¡Œå¤±è´¥, è¯´æ˜ä½ çš„å†…æ ¸æ²¡æœ‰é…ç½® CONFIG_NET_PKTGEN é€‰é¡¹. è¿™å°±éœ€è¦é…ç½® pktgen å†…æ ¸æ¨¡å—(å³ CONFIG_NET_PKTGEN=m)å, é‡æ–°ç¼–è¯‘å†…æ ¸, æ‰å¯ä»¥ä½¿ç”¨.")]),s._v(" "),a("p",[s._v("åœ¨ä½¿ç”¨ pktgen æµ‹è¯•ç½‘ç»œæ€§èƒ½æ—¶, éœ€è¦å…ˆç»™æ¯ä¸ªå†…æ ¸çº¿ç¨‹ kpktgend_X ä»¥åŠæµ‹è¯•ç½‘å¡, é…ç½® pktgen é€‰é¡¹, ç„¶åå†é€šè¿‡ pgctrl å¯åŠ¨æµ‹è¯•.")]),s._v(" "),a("p",[s._v("ä»¥å‘åŒ…æµ‹è¯•ä¸ºä¾‹, å‡è®¾å‘åŒ…æœºå™¨ä½¿ç”¨çš„ç½‘å¡æ˜¯ eth0, è€Œç›®æ ‡æœºå™¨çš„ IP åœ°å€ä¸º 192.168.0.30, MAC åœ°å€ä¸º 11:11:11:11:11:11.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/193d508cd4c156e8a7cbc73d1ef838f2-20230731161933-gcw0b5v.png",alt:""}})]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, å°±æ˜¯ä¸€ä¸ªå‘åŒ…æµ‹è¯•çš„ç¤ºä¾‹.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®šä¹‰ä¸€ä¸ªå·¥å…·å‡½æ•°, æ–¹ä¾¿åé¢é…ç½®å„ç§æµ‹è¯•é€‰é¡¹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("pgset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" result\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PGDEV")]),s._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" $PGDEV "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fgrep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Result: OK:"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$result")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PGDEV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fgrep")]),s._v(" Result:\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸º 0 å·çº¿ç¨‹ç»‘å®š eth0 ç½‘å¡")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PGDEV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/proc/net/pktgen/kpktgend_0\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rem_device_all"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¸…ç©ºç½‘å¡ç»‘å®š")]),s._v("\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add_device eth0"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ·»åŠ  eth0 ç½‘å¡")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é…ç½® eth0 ç½‘å¡çš„æµ‹è¯•é€‰é¡¹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PGDEV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/proc/net/pktgen/eth0\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count 1000000"')]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ€»å‘åŒ…æ•°é‡")]),s._v("\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delay 5000"')]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸åŒåŒ…ä¹‹é—´çš„å‘é€å»¶è¿Ÿ (å•ä½çº³ç§’)")]),s._v("\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clone_skb 0"')]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SKB åŒ…å¤åˆ¶")]),s._v("\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pkt_size 64"')]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç½‘ç»œåŒ…å¤§å°")]),s._v("\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dst 192.168.0.30"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç›®çš„ IP")]),s._v("\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dst_mac 11:11:11:11:11:11"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç›®çš„ MAC")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯åŠ¨æµ‹è¯•")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PGDEV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/proc/net/pktgen/pgctrl\npgset "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("ç¨ç­‰ä¸€ä¼šå„¿, æµ‹è¯•å®Œæˆå, ç»“æœå¯ä»¥ä» "),a("code",[s._v("/proc")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿä¸­è·å–. é€šè¿‡ä¸‹é¢ä»£ç æ®µä¸­çš„å†…å®¹, å¯ä»¥æŸ¥çœ‹åˆšæ‰çš„æµ‹è¯•æŠ¥å‘Š:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/net/pktgen/eth0\nParams: count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v("  min_pkt_size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  max_pkt_size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n     frags: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  delay: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  clone_skb: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  ifname: eth0\n     flows: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" flowlen: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nCurrent:\n     pkts-sofar: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v("  errors: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     started: 1534853256071us  stopped: 1534861576098us idle: 70673us\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nResult: OK: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8320027")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c8249354+d70673"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" usec, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("64byte,0frags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  120191pps 61Mb/sec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("61537792bps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" errors: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, æµ‹è¯•æŠ¥å‘Šä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€éƒ¨åˆ†çš„ Params æ˜¯æµ‹è¯•é€‰é¡¹;")]),s._v(" "),a("li",[s._v("ç¬¬äºŒéƒ¨åˆ†çš„ Current æ˜¯æµ‹è¯•è¿›åº¦, å…¶ä¸­,  packts so far(pkts-sofar)è¡¨ç¤ºå·²ç»å‘é€äº† 100 ä¸‡ä¸ªåŒ…, ä¹Ÿå°±è¡¨æ˜æµ‹è¯•å·²å®Œæˆ.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰éƒ¨åˆ†çš„ Result æ˜¯æµ‹è¯•ç»“æœ, åŒ…å«æµ‹è¯•æ‰€ç”¨æ—¶é—´, ç½‘ç»œåŒ…æ•°é‡å’Œåˆ†ç‰‡, PPS, ååé‡ä»¥åŠé”™è¯¯æ•°.")])]),s._v(" "),a("p",[s._v("æ ¹æ®ä¸Šé¢çš„ç»“æœå‘ç°, PPS ä¸º 12 ä¸‡, ååé‡ä¸º 61 Mb/s, æ²¡æœ‰å‘ç”Ÿé”™è¯¯. é‚£ä¹ˆ, 12 ä¸‡çš„ PPS å¥½ä¸å¥½å‘¢?")]),s._v(" "),a("p",[s._v("ä½œä¸ºå¯¹æ¯”, å¯ä»¥è®¡ç®—ä¸€ä¸‹åƒå…†äº¤æ¢æœºçš„ PPS. äº¤æ¢æœºå¯ä»¥è¾¾åˆ°çº¿é€Ÿ(æ»¡è´Ÿè½½æ—¶, æ— å·®é”™è½¬å‘), å®ƒçš„ PPS å°±æ˜¯ 1000Mbit é™¤ä»¥ä»¥å¤ªç½‘å¸§çš„å¤§å°, å³ 1000Mbps/((64+20)*8bit) = 1.5 Mpps(å…¶ä¸­, 20B ä¸ºä»¥å¤ªç½‘å¸§å‰å¯¼å’Œå¸§é—´è·çš„å¤§å°).")]),s._v(" "),a("p",[s._v("ä½ çœ‹, å³ä½¿æ˜¯åƒå…†äº¤æ¢æœºçš„ PPS, ä¹Ÿå¯ä»¥è¾¾åˆ° 150 ä¸‡ PPS, æ¯”æµ‹è¯•å¾—åˆ°çš„ 12 ä¸‡å¤§å¤šäº†. æ‰€ä»¥, çœ‹åˆ°è¿™ä¸ªæ•°å€¼å¹¶ä¸ç”¨æ‹…å¿ƒ, ç°åœ¨çš„å¤šæ ¸æœåŠ¡å™¨å’Œä¸‡å…†ç½‘å¡å·²ç»å¾ˆæ™®éäº†, ç¨åšä¼˜åŒ–å°±å¯ä»¥è¾¾åˆ°æ•°ç™¾ä¸‡çš„ PPS. è€Œä¸”, å¦‚æœç”¨äº†ä¸ŠèŠ‚è¯¾è®²åˆ°çš„ DPDK æˆ– XDP, è¿˜èƒ½è¾¾åˆ°åƒä¸‡æ•°é‡çº§.")]),s._v(" "),a("h6",{attrs:{id:"_2-tcp-udpæ€§èƒ½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-tcp-udpæ€§èƒ½"}},[s._v("#")]),s._v(" (2)TCP/UDPæ€§èƒ½")]),s._v(" "),a("p",[s._v("æŒæ¡äº† PPS çš„æµ‹è¯•æ–¹æ³•, æ¥ä¸‹æ¥å†æ¥çœ‹ TCP å’Œ UDP çš„æ€§èƒ½æµ‹è¯•æ–¹æ³•. è¯´åˆ° TCP å’Œ UDP çš„æµ‹è¯•, æˆ‘æƒ³ä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†, ç”šè‡³å¯èƒ½ä¸€ä¸‹å­å°±èƒ½æƒ³åˆ°ç›¸åº”çš„æµ‹è¯•å·¥å…·, æ¯”å¦‚ "),a("strong",[s._v("iperf æˆ–è€… netperf")]),s._v(".")]),s._v(" "),a("p",[s._v("ç‰¹åˆ«æ˜¯ç°åœ¨çš„äº‘è®¡ç®—æ—¶ä»£, åœ¨åˆšæ‹¿åˆ°ä¸€æ‰¹è™šæ‹Ÿæœºæ—¶, é¦–å…ˆè¦åšçš„, åº”è¯¥å°±æ˜¯ç”¨ iperf æµ‹è¯•ä¸€ä¸‹ç½‘ç»œæ€§èƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸ.")]),s._v(" "),a("p",[a("strong",[s._v("iperf å’Œ netperf éƒ½æ˜¯æœ€å¸¸ç”¨çš„ç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·, æµ‹è¯• TCP å’Œ UDP çš„ååé‡. å®ƒä»¬éƒ½ä»¥å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šä¿¡çš„æ–¹å¼, æµ‹è¯•ä¸€æ®µæ—¶é—´å†…çš„å¹³å‡ååé‡.")])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±ä»¥ iperf ä¸ºä¾‹, çœ‹ä¸€ä¸‹ TCP æ€§èƒ½çš„æµ‹è¯•æ–¹æ³•. ç›®å‰, iperf çš„æœ€æ–°ç‰ˆæœ¬ä¸º iperf3, å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iperf3\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CentOS")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iperf3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç„¶å, åœ¨ç›®æ ‡æœºå™¨ä¸Šå¯åŠ¨ iperf æœåŠ¡ç«¯:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -s è¡¨ç¤ºå¯åŠ¨æœåŠ¡ç«¯, -i è¡¨ç¤ºæ±‡æŠ¥é—´éš”, -p è¡¨ç¤ºç›‘å¬ç«¯å£")]),s._v("\n$ iperf3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ç€, åœ¨å¦ä¸€å°æœºå™¨ä¸Šè¿è¡Œ iperf å®¢æˆ·ç«¯, è¿è¡Œæµ‹è¯•:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c è¡¨ç¤ºå¯åŠ¨å®¢æˆ·ç«¯, 192.168.0.30 ä¸ºç›®æ ‡æœåŠ¡å™¨çš„ IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -b è¡¨ç¤ºç›®æ ‡å¸¦å®½ (å•ä½æ˜¯ bits/s)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t è¡¨ç¤ºæµ‹è¯•æ—¶é—´")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -P è¡¨ç¤ºå¹¶å‘æ•°, -p è¡¨ç¤ºç›®æ ‡æœåŠ¡å™¨ç›‘å¬ç«¯å£")]),s._v("\n$ iperf3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" 1G "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ç¨ç­‰ä¸€ä¼šå„¿(15 ç§’)æµ‹è¯•ç»“æŸå, å›åˆ°ç›®æ ‡æœåŠ¡å™¨, æŸ¥çœ‹ iperf çš„æŠ¥å‘Š:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Interval           Transfer     Bandwidth\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SUM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("-15.04  sec  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" Bytes  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" bits/sec                  sender\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SUM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("-15.04  sec  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.51")]),s._v(" GBytes   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("860")]),s._v(" Mbits/sec                  receiver\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æœ€åçš„ SUM è¡Œå°±æ˜¯æµ‹è¯•çš„æ±‡æ€»ç»“æœ, åŒ…æ‹¬æµ‹è¯•æ—¶é—´, æ•°æ®ä¼ è¾“é‡ä»¥åŠå¸¦å®½ç­‰. æŒ‰ç…§å‘é€å’Œæ¥æ”¶, è¿™ä¸€éƒ¨åˆ†åˆåˆ†ä¸ºäº† sender å’Œ receiver ä¸¤è¡Œ.")]),s._v(" "),a("p",[s._v("ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°, è¿™å°æœºå™¨ TCP æ¥æ”¶çš„å¸¦å®½(ååé‡)ä¸º 860 Mb/s, è·Ÿç›®æ ‡çš„ 1Gb/s ç›¸æ¯”, è¿˜æ˜¯æœ‰äº›å·®è·çš„.")]),s._v(" "),a("h6",{attrs:{id:"_3-httpæ€§èƒ½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-httpæ€§èƒ½"}},[s._v("#")]),s._v(" (3)HTTPæ€§èƒ½")]),s._v(" "),a("p",[s._v("ä»ä¼ è¾“å±‚å†å¾€ä¸Š, åˆ°äº†åº”ç”¨å±‚. æœ‰çš„åº”ç”¨ç¨‹åº, ä¼šç›´æ¥åŸºäº TCP æˆ– UDP æ„å»ºæœåŠ¡. å½“ç„¶, ä¹Ÿæœ‰å¤§é‡çš„åº”ç”¨, åŸºäº"),a("strong",[s._v("åº”ç”¨å±‚çš„åè®®")]),s._v("æ¥æ„å»ºæœåŠ¡, HTTP å°±æ˜¯æœ€å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨å±‚åè®®. æ¯”å¦‚, å¸¸ç”¨çš„ Apache, Nginx ç­‰å„ç§ Web æœåŠ¡, éƒ½æ˜¯åŸºäº HTTP.")]),s._v(" "),a("p",[s._v("è¦æµ‹è¯• HTTP çš„æ€§èƒ½, ä¹Ÿæœ‰å¤§é‡çš„å·¥å…·å¯ä»¥ä½¿ç”¨, æ¯”å¦‚ "),a("strong",[s._v("ab, webbench")]),s._v(" ç­‰, éƒ½æ˜¯å¸¸ç”¨çš„ HTTP å‹åŠ›æµ‹è¯•å·¥å…·. å…¶ä¸­, ab æ˜¯ Apache è‡ªå¸¦çš„ HTTP å‹æµ‹å·¥å…·, ä¸»è¦æµ‹è¯• HTTP æœåŠ¡çš„æ¯ç§’è¯·æ±‚æ•°, è¯·æ±‚å»¶è¿Ÿ, ååé‡ä»¥åŠè¯·æ±‚å»¶è¿Ÿçš„åˆ†å¸ƒæƒ…å†µç­‰.")]),s._v(" "),a("p",[s._v("è¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥å®‰è£… ab å·¥å…·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" apache2-utils\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CentOS")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" httpd-tools\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥, åœ¨ç›®æ ‡æœºå™¨ä¸Š, ä½¿ç”¨ Docker å¯åŠ¨ä¸€ä¸ª Nginx æœåŠ¡, ç„¶åç”¨ ab æ¥æµ‹è¯•å®ƒçš„æ€§èƒ½. é¦–å…ˆ, åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("è€Œåœ¨å¦ä¸€å°æœºå™¨ä¸Š, è¿è¡Œ ab å‘½ä»¤, æµ‹è¯• Nginx çš„æ€§èƒ½:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c è¡¨ç¤ºå¹¶å‘è¯·æ±‚æ•°ä¸º 1000, -n è¡¨ç¤ºæ€»çš„è¯·æ±‚æ•°ä¸º 10000")]),s._v("\n$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" http://192.168.0.30/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nServer Software:        nginx/1.15.8\nServer Hostname:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\nServer Port:            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1078.54")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("927.183")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.927")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("890.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received\n \nConnection Times "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              min  mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+/-sd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" median   max\nConnect:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("152.1")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1038")]),s._v("\nProcessing:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("207")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("843.0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9242")]),s._v("\nWaiting:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("207")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("843.0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9242")]),s._v("\nTotal:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("857.7")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9268")]),s._v("\n \nPercentage of the requests served within a certain "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("274")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("95")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1195")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2335")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4663")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9268")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("longest request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, ab çš„æµ‹è¯•ç»“æœåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†, åˆ†åˆ«æ˜¯"),a("strong",[s._v("è¯·æ±‚æ±‡æ€», è¿æ¥æ—¶é—´æ±‡æ€»è¿˜æœ‰è¯·æ±‚å»¶è¿Ÿæ±‡æ€»")]),s._v(". ä»¥ä¸Šé¢çš„ç»“æœä¸ºä¾‹å…·ä½“æ¥çœ‹. åœ¨è¯·æ±‚æ±‡æ€»éƒ¨åˆ†, å¯ä»¥çœ‹åˆ°:")]),s._v(" "),a("ul",[a("li",[s._v("Requests per second ä¸º 1074;")]),s._v(" "),a("li",[s._v("æ¯ä¸ªè¯·æ±‚çš„å»¶è¿Ÿ(Time per request)åˆ†ä¸ºä¸¤è¡Œ, ç¬¬ä¸€è¡Œçš„ 927 ms è¡¨ç¤ºå¹³å‡å»¶è¿Ÿ, åŒ…æ‹¬äº†çº¿ç¨‹è¿è¡Œçš„è°ƒåº¦æ—¶é—´å’Œç½‘ç»œè¯·æ±‚å“åº”æ—¶é—´, è€Œä¸‹ä¸€è¡Œçš„ 0.927ms , åˆ™è¡¨ç¤ºå®é™…è¯·æ±‚çš„å“åº”æ—¶é—´;")]),s._v(" "),a("li",[s._v("Transfer rate è¡¨ç¤ºååé‡(BPS)ä¸º 890 KB/s.")])]),s._v(" "),a("p",[s._v("è¿æ¥æ—¶é—´æ±‡æ€»éƒ¨åˆ†, åˆ™æ˜¯åˆ†åˆ«å±•ç¤ºäº†å»ºç«‹è¿æ¥, è¯·æ±‚, ç­‰å¾…ä»¥åŠæ±‡æ€»ç­‰çš„å„ç±»æ—¶é—´, åŒ…æ‹¬æœ€å°, æœ€å¤§, å¹³å‡ä»¥åŠä¸­å€¼å¤„ç†æ—¶é—´.")]),s._v(" "),a("p",[s._v("æœ€åçš„è¯·æ±‚å»¶è¿Ÿæ±‡æ€»éƒ¨åˆ†, åˆ™ç»™å‡ºäº†ä¸åŒæ—¶é—´æ®µå†…å¤„ç†è¯·æ±‚çš„ç™¾åˆ†æ¯”, æ¯”å¦‚, 90% çš„è¯·æ±‚, éƒ½å¯ä»¥åœ¨ 274ms å†…å®Œæˆ.")]),s._v(" "),a("h6",{attrs:{id:"_4-åº”ç”¨è´Ÿè½½æ€§èƒ½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-åº”ç”¨è´Ÿè½½æ€§èƒ½"}},[s._v("#")]),s._v(" (4)åº”ç”¨è´Ÿè½½æ€§èƒ½")]),s._v(" "),a("p",[s._v("å½“ç”¨ iperf æˆ–è€… ab ç­‰æµ‹è¯•å·¥å…·, å¾—åˆ° TCP, HTTP ç­‰çš„æ€§èƒ½æ•°æ®å, è¿™äº›æ•°æ®æ˜¯å¦å°±èƒ½è¡¨ç¤ºåº”ç”¨ç¨‹åºçš„å®é™…æ€§èƒ½å‘¢? ç­”æ¡ˆåº”è¯¥æ˜¯å¦å®šçš„.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä½ çš„åº”ç”¨ç¨‹åºåŸºäº HTTP åè®®, ä¸ºæœ€ç»ˆç”¨æˆ·æä¾›ä¸€ä¸ª Web æœåŠ¡. è¿™æ—¶ä½¿ç”¨ ab å·¥å…·, å¯ä»¥å¾—åˆ°æŸä¸ªé¡µé¢çš„è®¿é—®æ€§èƒ½, ä½†è¿™ä¸ªç»“æœè·Ÿç”¨æˆ·çš„å®é™…è¯·æ±‚, å¾ˆå¯èƒ½ä¸ä¸€è‡´. å› ä¸ºç”¨æˆ·è¯·æ±‚å¾€å¾€ä¼šé™„å¸¦ç€å„ç§å„ç§çš„è´Ÿè½½(payload), è€Œè¿™äº›è´Ÿè½½ä¼šå½±å“ Web åº”ç”¨ç¨‹åºå†…éƒ¨çš„å¤„ç†é€»è¾‘, ä»è€Œå½±å“æœ€ç»ˆæ€§èƒ½.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, ä¸ºäº†å¾—åˆ°åº”ç”¨ç¨‹åºçš„å®é™…æ€§èƒ½, å°±è¦æ±‚æ€§èƒ½å·¥å…·æœ¬èº«å¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·çš„è¯·æ±‚è´Ÿè½½, è€Œ iperf, ab è¿™ç±»å·¥å…·å°±æ— èƒ½ä¸ºåŠ›äº†. å¹¸è¿çš„æ˜¯, è¿˜å¯ä»¥ç”¨ "),a("strong",[s._v("wrk, TCPCopy, Jmeter æˆ–è€… LoadRunner")]),s._v(" ç­‰å®ç°è¿™ä¸ªç›®æ ‡.")]),s._v(" "),a("p",[s._v("ä»¥ wrk ä¸ºä¾‹, å®ƒæ˜¯ä¸€ä¸ª HTTP æ€§èƒ½æµ‹è¯•å·¥å…·, å†…ç½®äº† LuaJIT, æ–¹ä¾¿æ ¹æ®å®é™…éœ€æ±‚, ç”Ÿæˆæ‰€éœ€çš„è¯·æ±‚è´Ÿè½½, æˆ–è€…è‡ªå®šä¹‰å“åº”çš„å¤„ç†æ–¹æ³•.")]),s._v(" "),a("p",[s._v("wrk çš„å‘½ä»¤è¡Œå‚æ•°æ¯”è¾ƒç®€å•. æ¯”å¦‚å¯ä»¥ç”¨ wrk, æ¥é‡æ–°æµ‹ä¸€ä¸‹å‰é¢å·²ç»å¯åŠ¨çš„ Nginx çš„æ€§èƒ½.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c è¡¨ç¤ºå¹¶å‘è¿æ¥æ•° 1000, -t è¡¨ç¤ºçº¿ç¨‹æ•°ä¸º 2")]),s._v("\n$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http://192.168.0.30/\nRunning 10s "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" @ http://192.168.0.30/\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" threads and "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(".83ms  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("174")]),s._v(".06ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".99s    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("95.85")]),s._v("%\n    Req/Sec     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".87k   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("628.73")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".78k    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("69.00")]),s._v("%\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96954")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".06s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v(".59MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\n  Socket errors: connect "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("179")]),s._v("\nRequests/sec:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9641.31")]),s._v("\nTransfer/sec:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".82MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("è¿™é‡Œä½¿ç”¨ 2 ä¸ªçº¿ç¨‹, å¹¶å‘ 1000 è¿æ¥, é‡æ–°æµ‹è¯•äº† Nginx çš„æ€§èƒ½. å¯ä»¥çœ‹åˆ°, æ¯ç§’è¯·æ±‚æ•°ä¸º 9641, ååé‡ä¸º 7.82MB, å¹³å‡å»¶è¿Ÿä¸º 65ms, æ¯”å‰é¢ ab çš„æµ‹è¯•ç»“æœè¦å¥½å¾ˆå¤š. è¿™ä¹Ÿè¯´æ˜, æ€§èƒ½å·¥å…·æœ¬èº«çš„æ€§èƒ½, å¯¹æ€§èƒ½æµ‹è¯•ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„. ä¸åˆé€‚çš„æ€§èƒ½å·¥å…·, å¹¶ä¸èƒ½å‡†ç¡®æµ‹å‡ºåº”ç”¨ç¨‹åºçš„æœ€ä½³æ€§èƒ½.")]),s._v(" "),a("p",[s._v("å½“ç„¶ wrk æœ€å¤§çš„ä¼˜åŠ¿, æ˜¯å…¶å†…ç½®çš„ LuaJIT, å¯ä»¥ç”¨æ¥å®ç°å¤æ‚åœºæ™¯çš„æ€§èƒ½æµ‹è¯•. wrk åœ¨è°ƒç”¨ Lua è„šæœ¬æ—¶, å¯ä»¥å°† HTTP è¯·æ±‚åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ, å³ setup, running, done, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1bc969082f9fd873239a17fc01180265-20230731161933-jk6wlh3.png",alt:""}})]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å¯ä»¥åœ¨ setup é˜¶æ®µ, ä¸ºè¯·æ±‚è®¾ç½®è®¤è¯å‚æ•°(æ¥è‡ªäº wrk å®˜æ–¹"),a("a",{attrs:{href:"https://github.com/wg/wrk/blob/master/scripts/auth.lua",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç¤ºä¾‹"),a("OutboundLink")],1),s._v("):")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("-- example script that demonstrates response handling and\n-- retrieving an authentication token to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" on all future\n-- requests\n \ntoken "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nil\npath  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/authenticate"')]),s._v("\n \nrequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" wrk.format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),s._v(", path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nend\n \nresponse "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("status, headers, body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not token and status "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n      token "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Token"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      path  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/resource"')]),s._v("\n      wrk.headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Token"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" token\n   end\nend\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("è€Œåœ¨æ‰§è¡Œæµ‹è¯•æ—¶, é€šè¿‡ -s é€‰é¡¹, æ‰§è¡Œè„šæœ¬çš„è·¯å¾„:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" auth.lua http://192.168.0.30/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("wrk éœ€è¦ç”¨ Lua è„šæœ¬, æ¥æ„é€ è¯·æ±‚è´Ÿè½½. è¿™å¯¹äºå¤§éƒ¨åˆ†åœºæ™¯æ¥è¯´, å¯èƒ½å·²ç»è¶³å¤Ÿäº†. ä¸è¿‡, å®ƒçš„ç¼ºç‚¹ä¹Ÿæ­£æ˜¯, æ‰€æœ‰ä¸œè¥¿éƒ½éœ€è¦ä»£ç æ¥æ„é€ , å¹¶ä¸”å·¥å…·æœ¬èº«ä¸æä¾› GUI ç¯å¢ƒ.")]),s._v(" "),a("p",[s._v("åƒ Jmeter æˆ–è€… LoadRunner(å•†ä¸šäº§å“), åˆ™é’ˆå¯¹å¤æ‚åœºæ™¯æä¾›äº†è„šæœ¬å½•åˆ¶, å›æ”¾, GUI ç­‰æ›´ä¸°å¯Œçš„åŠŸèƒ½, ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ æ–¹ä¾¿.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-11"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-11"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æ€§èƒ½è¯„ä¼°æ˜¯ä¼˜åŒ–ç½‘ç»œæ€§èƒ½çš„å‰æ, åªæœ‰åœ¨å‘ç°ç½‘ç»œæ€§èƒ½ç“¶é¢ˆæ—¶, æ‰éœ€è¦è¿›è¡Œç½‘ç»œæ€§èƒ½ä¼˜åŒ–. æ ¹æ® TCP/IP åè®®æ ˆçš„åŸç†, ä¸åŒåè®®å±‚å…³æ³¨çš„æ€§èƒ½é‡ç‚¹ä¸å®Œå…¨ä¸€æ ·, ä¹Ÿå°±å¯¹åº”ä¸åŒçš„æ€§èƒ½æµ‹è¯•æ–¹æ³•. æ¯”å¦‚,")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨åº”ç”¨å±‚, å¯ä»¥ä½¿ç”¨ wrk, Jmeter ç­‰æ¨¡æ‹Ÿç”¨æˆ·çš„è´Ÿè½½, æµ‹è¯•åº”ç”¨ç¨‹åºçš„æ¯ç§’è¯·æ±‚æ•°, å¤„ç†å»¶è¿Ÿ, é”™è¯¯æ•°ç­‰;")]),s._v(" "),a("li",[s._v("è€Œåœ¨ä¼ è¾“å±‚, åˆ™å¯ä»¥ä½¿ç”¨ iperf ç­‰å·¥å…·, æµ‹è¯• TCP çš„ååæƒ…å†µ;")]),s._v(" "),a("li",[s._v("å†å‘ä¸‹, è¿˜å¯ä»¥ç”¨ Linux å†…æ ¸è‡ªå¸¦çš„ pktgen, æµ‹è¯•æœåŠ¡å™¨çš„ PPS.")])]),s._v(" "),a("p",[s._v("ç”±äºä½å±‚åè®®æ˜¯é«˜å±‚åè®®çš„åŸºç¡€. æ‰€ä»¥, ä¸€èˆ¬æƒ…å†µä¸‹, éœ€è¦"),a("strong",[s._v("ä»ä¸Šåˆ°ä¸‹")]),s._v("å¯¹æ¯ä¸ªåè®®å±‚è¿›è¡Œæ€§èƒ½æµ‹è¯•, ç„¶åæ ¹æ®æ€§èƒ½æµ‹è¯•çš„ç»“æœ, ç»“åˆ Linux ç½‘ç»œåè®®æ ˆçš„åŸç†, æ‰¾å‡ºå¯¼è‡´æ€§èƒ½ç“¶é¢ˆçš„æ ¹æº, è¿›è€Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½.")]),s._v(" "),a("h4",{attrs:{id:"_37-æ¡ˆä¾‹ç¯‡-dnsè§£ææ—¶å¿«æ—¶æ…¢è¯¥æ€ä¹ˆåŠ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_37-æ¡ˆä¾‹ç¯‡-dnsè§£ææ—¶å¿«æ—¶æ…¢è¯¥æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 37-æ¡ˆä¾‹ç¯‡:DNSè§£ææ—¶å¿«æ—¶æ…¢è¯¥æ€ä¹ˆåŠ?")]),s._v(" "),a("p",[s._v("DNS(Domain Name System), å³åŸŸåç³»ç»Ÿ, æ˜¯äº’è”ç½‘ä¸­æœ€åŸºç¡€çš„ä¸€é¡¹æœåŠ¡, ä¸»è¦æä¾›åŸŸåå’Œ IP åœ°å€ä¹‹é—´æ˜ å°„å…³ç³»çš„æŸ¥è¯¢æœåŠ¡. DNS ä¸ä»…æ–¹ä¾¿äº†äººä»¬è®¿é—®ä¸åŒçš„äº’è”ç½‘æœåŠ¡, æ›´ä¸ºå¾ˆå¤šåº”ç”¨æä¾›äº†, "),a("strong",[s._v("åŠ¨æ€æœåŠ¡å‘ç°å’Œå…¨å±€è´Ÿè½½å‡è¡¡(Global Server Load Balance, GSLB)çš„æœºåˆ¶")]),s._v(". è¿™æ ·, DNS å°±å¯ä»¥é€‰æ‹©ç¦»ç”¨æˆ·æœ€è¿‘çš„ IP æ¥æä¾›æœåŠ¡. å³ä½¿åç«¯æœåŠ¡çš„ IP åœ°å€å‘ç”Ÿå˜åŒ–, ç”¨æˆ·ä¾ç„¶å¯ä»¥ç”¨ç›¸åŒåŸŸåæ¥è®¿é—®.")]),s._v(" "),a("p",[s._v("DNS æ˜¾ç„¶æ˜¯å·¥ä½œä¸­åŸºç¡€è€Œé‡è¦çš„ä¸€ä¸ªç¯èŠ‚. "),a("strong",[s._v("é‚£ä¹ˆ DNS å‡ºç°é—®é¢˜æ—¶, åˆè¯¥å¦‚ä½•åˆ†æå’Œæ’æŸ¥å‘¢")]),s._v("?")]),s._v(" "),a("h5",{attrs:{id:"_1-åŸŸåä¸dnsè§£æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŸŸåä¸dnsè§£æ"}},[s._v("#")]),s._v(" 1.åŸŸåä¸DNSè§£æ")]),s._v(" "),a("p",[s._v("åŸŸåç”±ä¸€ä¸²ç”¨ç‚¹åˆ†å‰²å¼€çš„å­—ç¬¦ç»„æˆ, è¢«ç”¨ä½œäº’è”ç½‘ä¸­çš„æŸä¸€å°æˆ–æŸä¸€ç»„è®¡ç®—æœºçš„åç§°, ç›®çš„å°±æ˜¯ä¸ºäº†æ–¹ä¾¿è¯†åˆ«, äº’è”ç½‘ä¸­æä¾›å„ç§æœåŠ¡çš„ä¸»æœºä½ç½®. è¦æ³¨æ„, åŸŸåæ˜¯å…¨çƒå”¯ä¸€çš„, éœ€è¦é€šè¿‡ä¸“é—¨çš„åŸŸåæ³¨å†Œå•†æ‰å¯ä»¥ç”³è¯·æ³¨å†Œ. ä¸ºäº†ç»„ç»‡å…¨çƒäº’è”ç½‘ä¸­çš„ä¼—å¤šè®¡ç®—æœº, åŸŸååŒæ ·ç”¨ç‚¹æ¥åˆ†å¼€, å½¢æˆä¸€ä¸ªåˆ†å±‚çš„ç»“æ„. è€Œæ¯ä¸ªè¢«ç‚¹åˆ†å‰²å¼€çš„å­—ç¬¦ä¸², å°±æ„æˆäº†åŸŸåä¸­çš„ä¸€ä¸ªå±‚çº§, å¹¶ä¸”ä½ç½®è¶Šé å, å±‚çº§è¶Šé«˜.")]),s._v(" "),a("p",[s._v("ä»¥æå®¢æ—¶é—´çš„ç½‘ç«™ time.geekbang.org ä¸ºä¾‹, æ¥ç†è§£åŸŸåçš„å«ä¹‰. è¿™ä¸ªå­—ç¬¦ä¸²ä¸­, æœ€åé¢çš„ org æ˜¯é¡¶çº§åŸŸå, ä¸­é—´çš„ geekbang æ˜¯äºŒçº§åŸŸå, è€Œæœ€å·¦è¾¹çš„ time åˆ™æ˜¯ä¸‰çº§åŸŸå.")]),s._v(" "),a("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤º, æ³¨æ„ç‚¹(.)æ˜¯æ‰€æœ‰åŸŸåçš„æ ¹, ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰åŸŸåéƒ½ä»¥ç‚¹ä½œä¸ºåç¼€, ä¹Ÿå¯ä»¥ç†è§£ä¸º, åœ¨åŸŸåè§£æçš„è¿‡ç¨‹ä¸­, æ‰€æœ‰åŸŸåéƒ½ä»¥ç‚¹ç»“æŸ.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/fb3136fd28fa98182e42a71efe7ed0e0-20230731161933-t4jgabp.png",alt:""}})]),s._v(" "),a("p",[s._v("é€šè¿‡ç†è§£è¿™å‡ ä¸ªæ¦‚å¿µ, å¯ä»¥çœ‹å‡º, åŸŸåä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿è®©äººè®°ä½, "),a("strong",[s._v("è€Œ IP åœ°å€æ˜¯æœºå™¨é—´çš„é€šä¿¡çš„çœŸæ­£æœºåˆ¶")]),s._v(". æŠŠåŸŸåè½¬æ¢ä¸º IP åœ°å€çš„æœåŠ¡, ä¹Ÿå°±æ˜¯åŸŸåè§£ææœåŠ¡(DNS), è€Œå¯¹åº”çš„æœåŠ¡å™¨å°±æ˜¯åŸŸåæœåŠ¡å™¨, ç½‘ç»œåè®®åˆ™æ˜¯ DNS åè®®.")]),s._v(" "),a("p",[s._v("è¿™é‡Œæ³¨æ„, "),a("strong",[s._v("DNS åè®®åœ¨ TCP/IP æ ˆä¸­å±äºåº”ç”¨å±‚, ä¸è¿‡å®é™…ä¼ è¾“è¿˜æ˜¯åŸºäº UDP æˆ–è€… TCP åè®®(UDP å±…å¤š), å¹¶ä¸”åŸŸåæœåŠ¡å™¨ä¸€èˆ¬ç›‘å¬åœ¨ç«¯å£ 53 ä¸Š")]),s._v(".")]),s._v(" "),a("p",[s._v("æ—¢ç„¶åŸŸåä»¥åˆ†å±‚çš„ç»“æ„è¿›è¡Œç®¡ç†, ç›¸å¯¹åº”çš„, åŸŸåè§£æå…¶å®ä¹Ÿæ˜¯ç”¨é€’å½’çš„æ–¹å¼(ä»é¡¶çº§å¼€å§‹, ä»¥æ­¤ç±»æ¨), å‘é€ç»™æ¯ä¸ªå±‚çº§çš„åŸŸåæœåŠ¡å™¨, ç›´åˆ°å¾—åˆ°è§£æç»“æœ.")]),s._v(" "),a("p",[s._v("ä¸è¿‡ä¸è¦æ‹…å¿ƒ, é€’å½’æŸ¥è¯¢çš„è¿‡ç¨‹å¹¶ä¸éœ€è¦äº²è‡ªæ“ä½œ, DNS æœåŠ¡å™¨ä¼šæ›¿ä½ å®Œæˆ, è¦åšçš„åªæ˜¯é¢„å…ˆé…ç½®ä¸€ä¸ªå¯ç”¨çš„ DNS æœåŠ¡å™¨å°±å¯ä»¥äº†. é€šå¸¸æ¥è¯´, æ¯çº§ DNS æœåŠ¡å™¨, éƒ½ä¼šæœ‰æœ€è¿‘è§£æè®°å½•çš„ç¼“å­˜. å½“ç¼“å­˜å‘½ä¸­æ—¶, ç›´æ¥ç”¨ç¼“å­˜ä¸­çš„è®°å½•åº”ç­”å°±å¯ä»¥äº†. å¦‚æœç¼“å­˜è¿‡æœŸæˆ–è€…ä¸å­˜åœ¨, æ‰éœ€è¦ç”¨åˆšåˆšæåˆ°çš„é€’å½’æ–¹å¼æŸ¥è¯¢.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ç³»ç»Ÿç®¡ç†å‘˜åœ¨é…ç½® Linux ç³»ç»Ÿçš„ç½‘ç»œæ—¶, é™¤äº†éœ€è¦é…ç½® IP åœ°å€, è¿˜éœ€è¦ç»™å®ƒ"),a("strong",[s._v("é…ç½® DNS æœåŠ¡å™¨")]),s._v(", è¿™æ ·å®ƒæ‰å¯ä»¥é€šè¿‡åŸŸåæ¥è®¿é—®å¤–éƒ¨æœåŠ¡.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, æˆ‘çš„ç³»ç»Ÿé…ç½®çš„å°±æ˜¯ 114.114.114.114 è¿™ä¸ªåŸŸåæœåŠ¡å™¨. å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ¥æŸ¥è¯¢ä½ çš„ç³»ç»Ÿé…ç½®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/resolv.conf\nnameserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¦å¤–, DNS æœåŠ¡é€šè¿‡èµ„æºè®°å½•çš„æ–¹å¼, æ¥ç®¡ç†æ‰€æœ‰æ•°æ®, å®ƒæ”¯æŒ A, CNAME, MX, NS, PTR ç­‰å¤šç§ç±»å‹çš„è®°å½•. æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("A è®°å½•, ç”¨æ¥æŠŠåŸŸåè½¬æ¢æˆ IP åœ°å€;")]),s._v(" "),a("li",[s._v("CNAME è®°å½•, ç”¨æ¥åˆ›å»ºåˆ«å;")]),s._v(" "),a("li",[s._v("è€Œ NS è®°å½•, åˆ™è¡¨ç¤ºè¯¥åŸŸåå¯¹åº”çš„åŸŸåæœåŠ¡å™¨åœ°å€.")])]),s._v(" "),a("p",[s._v("ç®€å•æ¥è¯´, å½“è®¿é—®æŸä¸ªç½‘å€æ—¶, å°±éœ€è¦é€šè¿‡ DNS çš„ A è®°å½•, æŸ¥è¯¢è¯¥åŸŸåå¯¹åº”çš„ IP åœ°å€, ç„¶åå†é€šè¿‡è¯¥ IP æ¥è®¿é—® Web æœåŠ¡.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, è¿˜æ˜¯ä»¥æå®¢æ—¶é—´çš„ç½‘ç«™ time.geekbang.org ä¸ºä¾‹, æ‰§è¡Œä¸‹é¢çš„ "),a("strong",[s._v("nslookup å‘½ä»¤, å°±å¯ä»¥æŸ¥è¯¢åˆ°è¿™ä¸ªåŸŸåçš„ A è®°å½•, å¯ä»¥çœ‹åˆ°, å®ƒçš„ IP åœ°å€æ˜¯ 39.106.233.176")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nslookup")]),s._v(" time.geekbang.org\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åŸŸåæœåŠ¡å™¨åŠç«¯å£ä¿¡æ¯")]),s._v("\nServer:\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# éæƒå¨æŸ¥è¯¢ç»“æœ")]),s._v("\nNon-authoritative answer:\nName:\ttime.geekbang.org\nAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.106")]),s._v(".233.17\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("è¿™é‡Œè¦æ³¨æ„, ç”±äº 114.114.114.114 å¹¶ä¸æ˜¯ç›´æ¥ç®¡ç† time.geekbang.org çš„åŸŸåæœåŠ¡å™¨, æ‰€ä»¥æŸ¥è¯¢ç»“æœæ˜¯éæƒå¨çš„. ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤, åªèƒ½å¾—åˆ° 114.114.114.114 æŸ¥è¯¢çš„ç»“æœ.")]),s._v(" "),a("p",[s._v("å‰é¢è¿˜æåˆ°äº†, å¦‚æœæ²¡æœ‰å‘½ä¸­ç¼“å­˜, DNS æŸ¥è¯¢å®é™…ä¸Šæ˜¯ä¸€ä¸ªé€’å½’è¿‡ç¨‹, é‚£æœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥çŸ¥é“æ•´ä¸ªé€’å½’æŸ¥è¯¢çš„æ‰§è¡Œå‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®é™¤äº† nslookup, å¦å¤–ä¸€ä¸ªå¸¸ç”¨çš„ DNS è§£æå·¥å…· "),a("strong",[s._v("dig")]),s._v(", å°±"),a("strong",[s._v("æä¾›äº† trace åŠŸèƒ½, å¯ä»¥å±•ç¤ºé€’å½’æŸ¥è¯¢çš„æ•´ä¸ªè¿‡ç¨‹")]),s._v(". æ¯”å¦‚å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å¾—åˆ°æŸ¥è¯¢ç»“æœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# +trace è¡¨ç¤ºå¼€å¯è·Ÿè¸ªæŸ¥è¯¢")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# +nodnssec è¡¨ç¤ºç¦æ­¢ DNS å®‰å…¨æ‰©å±•")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" +trace +nodnssec time.geekbang.org\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" DiG "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.11")]),s._v(".3-1ubuntu1.3-Ubuntu "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" +trace +nodnssec time.geekbang.org\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" global options: +cmd\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\tm.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\ta.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\ti.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\td.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\tg.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\tl.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\tc.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\tb.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\th.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\te.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\tk.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\tj.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322086")]),s._v("\tIN\tNS\tf.root-servers.net.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Received "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("239")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(114.114.114.114) in 1340 ms")]),s._v("\n \norg.\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172800")]),s._v("\tIN\tNS\ta0.org.afilias-nst.info.\norg.\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172800")]),s._v("\tIN\tNS\ta2.org.afilias-nst.info.\norg.\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172800")]),s._v("\tIN\tNS\tb0.org.afilias-nst.org.\norg.\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172800")]),s._v("\tIN\tNS\tb2.org.afilias-nst.org.\norg.\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172800")]),s._v("\tIN\tNS\tc0.org.afilias-nst.info.\norg.\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172800")]),s._v("\tIN\tNS\td0.org.afilias-nst.org.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Received "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("448")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("198.97")]),s._v(".190.53"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(h.root-servers.net) in 708 ms")]),s._v("\n \ngeekbang.org.\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\tIN\tNS\tdns9.hichina.com.\ngeekbang.org.\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\tIN\tNS\tdns10.hichina.com.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Received "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("199.19")]),s._v(".54.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(b0.org.afilias-nst.org) in 1833 ms")]),s._v("\n \ntime.geekbang.org.\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\tIN\tA\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.106")]),s._v(".233.176\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Received "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140.205")]),s._v(".41.16"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(dns10.hichina.com) in 4 ms")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("p",[s._v("dig trace çš„è¾“å‡º, ä¸»è¦åŒ…æ‹¬å››éƒ¨åˆ†.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€éƒ¨åˆ†, æ˜¯ä» 114.114.114.114 æŸ¥åˆ°çš„ä¸€äº›æ ¹åŸŸåæœåŠ¡å™¨(.)çš„ NS è®°å½•.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒéƒ¨åˆ†, æ˜¯ä» NS è®°å½•ç»“æœä¸­é€‰ä¸€ä¸ª(h.root-servers.net), å¹¶æŸ¥è¯¢é¡¶çº§åŸŸå org. çš„ NS è®°å½•.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰éƒ¨åˆ†, æ˜¯ä» org. çš„ NS è®°å½•ä¸­é€‰æ‹©ä¸€ä¸ª(b0.org.afilias-nst.org), å¹¶æŸ¥è¯¢äºŒçº§åŸŸå geekbang.org. çš„ NS æœåŠ¡å™¨.")]),s._v(" "),a("li",[s._v("æœ€åä¸€éƒ¨åˆ†, å°±æ˜¯ä» geekbang.org. çš„ NS æœåŠ¡å™¨(dns10.hichina.com)æŸ¥è¯¢æœ€ç»ˆä¸»æœº time.geekbang.org. çš„ A è®°å½•.")])]),s._v(" "),a("p",[s._v("è¿™ä¸ªè¾“å‡ºé‡Œå±•ç¤ºçš„å„çº§åŸŸåçš„ NS è®°å½•, å…¶å®å°±æ˜¯"),a("strong",[s._v("å„çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€")]),s._v(", å¯ä»¥è®©ä½ æ›´æ¸…æ¥š DNS è§£æçš„è¿‡ç¨‹.  ä¸ºäº†å¸®ä½ æ›´ç›´è§‚ç†è§£é€’å½’æŸ¥è¯¢, æˆ‘æŠŠè¿™ä¸ªè¿‡ç¨‹æ•´ç†æˆäº†ä¸€å¼ æµç¨‹å›¾.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/75f5cadf4a2953e7f39f5b5cb0b37465-20230731161933-cf5owis.png",alt:""}})]),s._v(" "),a("p",[s._v("å½“ç„¶, ä¸ä»…ä»…æ˜¯å‘å¸ƒåˆ°äº’è”ç½‘çš„æœåŠ¡éœ€è¦åŸŸå, å¾ˆå¤šæ—¶å€™, ä¹Ÿå¸Œæœ›èƒ½å¯¹å±€åŸŸç½‘å†…éƒ¨çš„ä¸»æœºè¿›è¡ŒåŸŸåè§£æ(å³å†…ç½‘åŸŸå, å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ºä¸»æœºå). Linux ä¹Ÿæ”¯æŒè¿™ç§è¡Œä¸º.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, å¯ä»¥æŠŠä¸»æœºåå’Œ IP åœ°å€çš„æ˜ å°„å…³ç³», å†™å…¥æœ¬æœºçš„ "),a("code",[s._v("/etc/hosts")]),s._v("â€‹ æ–‡ä»¶ä¸­. è¿™æ ·æŒ‡å®šçš„ä¸»æœºåå°±å¯ä»¥åœ¨æœ¬åœ°ç›´æ¥æ‰¾åˆ°ç›®æ ‡ IP. æ¯”å¦‚å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ“ä½œ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/hosts\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1   localhost localhost.localdomain\n::1         localhost6 localhost6.localdomain6\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.100 domain.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æˆ–è€…, è¿˜å¯ä»¥åœ¨å†…ç½‘ä¸­, æ­å»ºè‡ªå®šä¹‰çš„ DNS æœåŠ¡å™¨, ä¸“é—¨ç”¨æ¥è§£æå†…ç½‘ä¸­çš„åŸŸå. è€Œå†…ç½‘ DNS æœåŠ¡å™¨, ä¸€èˆ¬è¿˜ä¼šè®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªä¸Šæ¸¸ DNS æœåŠ¡å™¨, ç”¨æ¥è§£æå¤–ç½‘çš„åŸŸå.")]),s._v(" "),a("p",[s._v("æ¸…æ¥šåŸŸåä¸ DNS è§£æçš„åŸºæœ¬åŸç†å, æ¥ä¸‹æ¥å°±æ¥çœ‹å‡ ä¸ªæ¡ˆä¾‹, å®æˆ˜åˆ†æ DNS è§£æå‡ºç°é—®é¢˜æ—¶, è¯¥å¦‚ä½•å®šä½.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹å‡†å¤‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹å‡†å¤‡"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker ç­‰å·¥å…·, å¦‚ apt install docker.io.")])]),s._v(" "),a("p",[s._v("å¯ä»¥å…ˆæ‰“å¼€ä¸€ä¸ªç»ˆç«¯, SSH ç™»å½•åˆ° Ubuntu æœºå™¨ä¸­, ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ‹‰å–æ¡ˆä¾‹ä¸­ä½¿ç”¨çš„ Docker é•œåƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull feisky/dnsutils\nUsing default tag: latest\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" feisky/dnsutils:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç„¶å, è¿è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹ä¸»æœºå½“å‰é…ç½®çš„ DNS æœåŠ¡å™¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/resolv.conf\nnameserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, æˆ‘è¿™å°ä¸»æœºé…ç½®çš„ DNS æœåŠ¡å™¨æ˜¯ 114.114.114.114.")]),s._v(" "),a("h5",{attrs:{id:"_3-æ¡ˆä¾‹åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¡ˆä¾‹åˆ†æ"}},[s._v("#")]),s._v(" 3.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("h6",{attrs:{id:"_1-æ¡ˆä¾‹1-dnsè§£æå¤±è´¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹1-dnsè§£æå¤±è´¥"}},[s._v("#")]),s._v(" (1)æ¡ˆä¾‹1:DNSè§£æå¤±è´¥")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤. å¦‚æœä¸€åˆ‡æ­£å¸¸, å°†å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿›å…¥æ¡ˆä¾‹ç¯å¢ƒçš„ SHELL ç»ˆç«¯ä¸­")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("mktemp"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(":/etc/resolv.conf feisky/dnsutils "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nroot@7e9ed6ed4974:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æ³¨æ„, è¿™å„¿ root åé¢çš„ 7e9ed6ed4974, æ˜¯ Docker ç”Ÿæˆå®¹å™¨çš„ ID å‰ç¼€, ä½ çš„ç¯å¢ƒä¸­å¾ˆå¯èƒ½æ˜¯ä¸åŒçš„ ID, æ‰€ä»¥ç›´æ¥å¿½ç•¥è¿™ä¸€é¡¹å°±å¯ä»¥äº†.")]),s._v(" "),a("blockquote",[a("p",[s._v("æ³¨æ„: ä¸‹é¢çš„ä»£ç æ®µä¸­, /# å¼€å¤´çš„å‘½ä»¤éƒ½è¡¨ç¤ºåœ¨å®¹å™¨å†…éƒ¨è¿è¡Œçš„å‘½ä»¤.")])]),s._v(" "),a("p",[s._v("æ¥ç€ç»§ç»­åœ¨å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œ DNS æŸ¥è¯¢å‘½ä»¤, è¿˜æ˜¯æŸ¥è¯¢ time.geekbang.org çš„ IP åœ°å€:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nslookup time.geekbang.org")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" connection timed out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" no servers could be reached\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¯ä»¥å‘ç°, è¿™ä¸ªå‘½ä»¤é˜»å¡å¾ˆä¹…å, è¿˜æ˜¯å¤±è´¥äº†, æŠ¥äº† connection timed out å’Œ no servers could be reached é”™è¯¯.")]),s._v(" "),a("p",[s._v("çœ‹åˆ°è¿™é‡Œ, ä¼°è®¡ä½ çš„ç¬¬ä¸€ååº”å°±æ˜¯ç½‘ç»œä¸é€šäº†, åˆ°åº•æ˜¯ä¸æ˜¯è¿™æ ·å‘¢? ç”¨ ping å·¥å…·æ£€æŸ¥è¯•è¯•. æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥æµ‹è¯•æœ¬åœ°åˆ° 114.114.114.114 çš„è¿é€šæ€§:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping -c3 114.114.114.114")]),s._v("\nPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.116")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.245")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.128")]),s._v(" ms\n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max/stddev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.116")]),s._v("/31.163/31.245/0.058 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè¾“å‡ºä¸­, å¯ä»¥çœ‹åˆ°"),a("strong",[s._v("ç½‘ç»œæ˜¯é€š")]),s._v("çš„. é‚£è¦æ€ä¹ˆçŸ¥é“ nslookup å‘½ä»¤å¤±è´¥çš„åŸå› å‘¢? è¿™é‡Œå…¶å®æœ‰å¾ˆå¤šæ–¹æ³•, æœ€ç®€å•çš„ä¸€ç§, å°±æ˜¯"),a("strong",[s._v("å¼€å¯ nslookup çš„è°ƒè¯•è¾“å‡º")]),s._v(", æŸ¥çœ‹æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„è¯¦ç»†æ­¥éª¤, æ’æŸ¥å…¶ä¸­æ˜¯å¦æœ‰å¼‚å¸¸.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å¯ä»¥ç»§ç»­åœ¨å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nslookup -debug time.geekbang.org")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Connection to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(127.0.0.1) for time.geekbang.org failed: connection refused.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Connection to ::1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(::1) for time.geekbang.org failed: address not available.")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä»è¿™æ¬¡çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°, nslookup è¿æ¥ç¯å›åœ°å€(127.0.0.1 å’Œ ::1)çš„ 53 ç«¯å£å¤±è´¥. è¿™é‡Œå°±æœ‰é—®é¢˜äº†, ä¸ºä»€ä¹ˆä¼šå»è¿æ¥ç¯å›åœ°å€, è€Œä¸æ˜¯å…ˆå‰çœ‹åˆ°çš„ 114.114.114.114 å‘¢?")]),s._v(" "),a("p",[s._v("ä½ å¯èƒ½å·²ç»æƒ³åˆ°äº†ç—‡ç»“æ‰€åœ¨--"),a("strong",[s._v("æœ‰å¯èƒ½æ˜¯å› ä¸ºå®¹å™¨ä¸­æ²¡æœ‰é…ç½® DNS æœåŠ¡å™¨")]),s._v(". é‚£å°±æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ç¡®è®¤ä¸€ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/resolv.conf")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æœç„¶, è¿™ä¸ªå‘½ä»¤æ²¡æœ‰ä»»ä½•è¾“å‡º, "),a("strong",[s._v("è¯´æ˜å®¹å™¨é‡Œçš„ç¡®æ²¡æœ‰é…ç½® DNS æœåŠ¡å™¨")]),s._v(". åˆ°è¿™ä¸€æ­¥, å¾ˆè‡ªç„¶çš„å°±çŸ¥é“äº†è§£å†³æ–¹æ³•. åœ¨ "),a("code",[s._v("/etc/resolv.conf")]),s._v("â€‹ æ–‡ä»¶ä¸­, é…ç½®ä¸Š DNS æœåŠ¡å™¨å°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v("å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, åœ¨é…ç½®å¥½ DNS æœåŠ¡å™¨å, é‡æ–°æ‰§è¡Œ nslookup å‘½ä»¤. ç°åœ¨å‘ç°, è¿™æ¬¡å¯ä»¥æ­£å¸¸è§£æäº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "nameserver 114.114.114.114" > /etc/resolv.conf')]),s._v("\n/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nslookup time.geekbang.org")]),s._v("\nServer:\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n \nNon-authoritative answer:\nName:\ttime.geekbang.org\nAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.106")]),s._v(".233.176\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("åˆ°è¿™é‡Œ, ç¬¬ä¸€ä¸ªæ¡ˆä¾‹å°±è½»æ¾è§£å†³äº†. æœ€å, åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ exit å‘½ä»¤é€€å‡ºå®¹å™¨, Docker å°±ä¼šè‡ªåŠ¨æ¸…ç†åˆšæ‰è¿è¡Œçš„å®¹å™¨.")]),s._v(" "),a("h6",{attrs:{id:"_2-æ¡ˆä¾‹2-dnsè§£æä¸ç¨³å®š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹2-dnsè§£æä¸ç¨³å®š"}},[s._v("#")]),s._v(" (2)æ¡ˆä¾‹2:DNSè§£æä¸ç¨³å®š")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†æ¥çœ‹ç¬¬äºŒä¸ªæ¡ˆä¾‹. æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨, å¹¶è¿›å…¥å®ƒçš„ç»ˆç«¯ä¸­:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" --cap-add"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NET_ADMIN "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dns")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8 feisky/dnsutils "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nroot@0cd3ee0c8ecb:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("è·Ÿä¸Šä¸€ä¸ªæ¡ˆä¾‹ä¸€æ ·, è¿˜æ˜¯è¿è¡Œ nslookup å‘½ä»¤, è§£æ time.geekbang.org çš„ IP åœ°å€. ä¸è¿‡, è¿™æ¬¡è¦åŠ ä¸€ä¸ª time å‘½ä»¤, è¾“å‡ºè§£ææ‰€ç”¨æ—¶é—´. å¦‚æœä¸€åˆ‡æ­£å¸¸, å¯èƒ½ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# time nslookup time.geekbang.org")]),s._v("\nServer:\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n \nNon-authoritative answer:\nName:\ttime.geekbang.org\nAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.106")]),s._v(".233.176\n \nreal\t0m10.349s\nuser\t0m0.004s\nsys\t0m0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™æ¬¡è§£æéå¸¸æ…¢, å±…ç„¶ç”¨äº† 10 ç§’. å¦‚æœå¤šæ¬¡è¿è¡Œä¸Šé¢çš„ nslookup å‘½ä»¤, å¯èƒ½å¶å°”è¿˜ä¼šç¢°åˆ°ä¸‹é¢è¿™ç§é”™è¯¯:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# time nslookup time.geekbang.org")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" connection timed out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" no servers could be reached\n \nreal\t0m15.011s\nuser\t0m0.006s\nsys\t0m0.006s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("æ¢å¥è¯è¯´, è·Ÿä¸Šä¸€ä¸ªæ¡ˆä¾‹ç±»ä¼¼, ä¹Ÿä¼šå‡ºç°è§£æå¤±è´¥çš„æƒ…å†µ. ç»¼åˆæ¥çœ‹, ç°åœ¨ DNS è§£æçš„ç»“æœä¸ä½†æ¯”è¾ƒæ…¢, è€Œä¸”è¿˜ä¼šå‘ç”Ÿè¶…æ—¶å¤±è´¥çš„æƒ…å†µ.")]),s._v(" "),a("p",[s._v("è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? ç¢°åˆ°è¿™ç§é—®é¢˜è¯¥æ€ä¹ˆå¤„ç†å‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®, æ ¹æ®å‰é¢çš„è®²è§£å¯ä»¥çŸ¥é“, DNS è§£æ, è¯´ç™½äº†å°±æ˜¯"),a("strong",[s._v("å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨äº¤äº’çš„è¿‡ç¨‹")]),s._v(", å¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹è¿˜ä½¿ç”¨äº† UDP åè®®.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, å¯¹äºæ•´ä¸ªæµç¨‹æ¥è¯´, è§£æç»“æœä¸ç¨³å®š, å°±æœ‰å¾ˆå¤šç§å¯èƒ½çš„æƒ…å†µäº†. æ¯”æ–¹è¯´:")]),s._v(" "),a("ul",[a("li",[s._v("DNS æœåŠ¡å™¨æœ¬èº«æœ‰é—®é¢˜, å“åº”æ…¢å¹¶ä¸”ä¸ç¨³å®š;")]),s._v(" "),a("li",[s._v("æˆ–è€…æ˜¯, å®¢æˆ·ç«¯åˆ° DNS æœåŠ¡å™¨çš„ç½‘ç»œå»¶è¿Ÿæ¯”è¾ƒå¤§;")]),s._v(" "),a("li",[s._v("å†æˆ–è€…, DNS è¯·æ±‚æˆ–è€…å“åº”åŒ…, åœ¨æŸäº›æƒ…å†µä¸‹è¢«é“¾è·¯ä¸­çš„ç½‘ç»œè®¾å¤‡å¼„ä¸¢äº†.")])]),s._v(" "),a("p",[s._v("æ ¹æ®ä¸Šé¢ nslookup çš„è¾“å‡º, å¯ä»¥çœ‹åˆ°, ç°åœ¨å®¢æˆ·ç«¯è¿æ¥çš„ DNS æ˜¯ 8.8.8.8, è¿™æ˜¯ Google æä¾›çš„ DNS æœåŠ¡. å¯¹ Google çš„ DNS æœåŠ¡å™¨å‡ºé—®é¢˜çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå°. åŸºæœ¬æ’é™¤äº† DNS æœåŠ¡å™¨çš„é—®é¢˜, é‚£æ˜¯ä¸æ˜¯ç¬¬äºŒç§å¯èƒ½, æœ¬æœºåˆ° DNS æœåŠ¡å™¨çš„å»¶è¿Ÿæ¯”è¾ƒå¤§å‘¢?")]),s._v(" "),a("p",[s._v("å‰é¢è®²è¿‡, ping å¯ä»¥ç”¨æ¥æµ‹è¯•æœåŠ¡å™¨çš„å»¶è¿Ÿ. æ¯”å¦‚å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping -c3 8.8.8.8")]),s._v("\nPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137.637")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("144.743")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("138.576")]),s._v(" ms\n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max/stddev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137.637")]),s._v("/140.319/144.743/3.152 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä» ping çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°, è¿™é‡Œçš„å»¶è¿Ÿå·²ç»è¾¾åˆ°äº† 140ms, è¿™ä¹Ÿå°±å¯ä»¥è§£é‡Š, ä¸ºä»€ä¹ˆè§£æè¿™ä¹ˆæ…¢äº†. å®é™…ä¸Š, å¦‚æœå¤šæ¬¡è¿è¡Œä¸Šé¢çš„ ping æµ‹è¯•, è¿˜ä¼šçœ‹åˆ°å¶å°”å‡ºç°çš„ä¸¢åŒ…ç°è±¡.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8\nPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134.032")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("431.458")]),s._v(" ms\n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("% packet loss\nround-trip min/avg/max/stddev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134.032")]),s._v("/282.745/431.458/148.713 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("è¿™ä¹Ÿè¿›ä¸€æ­¥è§£é‡Šäº†, ä¸ºä»€ä¹ˆ nslookup å¶å°”ä¼šå¤±è´¥, æ­£æ˜¯ç½‘ç»œé“¾è·¯ä¸­çš„ä¸¢åŒ…å¯¼è‡´çš„.")]),s._v(" "),a("p",[s._v("ç¢°åˆ°è¿™ç§é—®é¢˜è¯¥æ€ä¹ˆåŠå‘¢? æ˜¾ç„¶, æ—¢ç„¶å»¶è¿Ÿå¤ªå¤§, é‚£å°±æ¢ä¸€ä¸ªå»¶è¿Ÿæ›´å°çš„ DNS æœåŠ¡å™¨, æ¯”å¦‚ç”µä¿¡æä¾›çš„ 114.114.114.114.")]),s._v(" "),a("p",[s._v("é…ç½®ä¹‹å‰, å¯ä»¥å…ˆç”¨ ping æµ‹è¯•çœ‹çœ‹, å®ƒçš„å»¶è¿Ÿæ˜¯ä¸æ˜¯çœŸçš„æ¯” 8.8.8.8 å¥½. æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥çœ‹åˆ°, å®ƒçš„å»¶è¿Ÿåªæœ‰ 31ms:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping -c3 114.114.114.114")]),s._v("\nPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.130")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.302")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.250")]),s._v(" ms\n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max/stddev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.130")]),s._v("/31.227/31.302/0.072 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("è¿™ä¸ªç»“æœè¡¨æ˜, å»¶è¿Ÿçš„ç¡®å°äº†å¾ˆå¤š. ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ›´æ¢ DNS æœåŠ¡å™¨, ç„¶åå†æ¬¡æ‰§è¡Œ nslookup è§£æå‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo nameserver 114.114.114.114 > /etc/resolv.conf")]),s._v("\n/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# time nslookup time.geekbang.org")]),s._v("\nServer:\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n \nNon-authoritative answer:\nName:\ttime.geekbang.org\nAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.106")]),s._v(".233.176\n \nreal    0m0.064s\nuser    0m0.007s\nsys     0m0.006s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("å¯ä»¥å‘ç°, ç°åœ¨åªéœ€è¦ 64ms å°±å¯ä»¥å®Œæˆè§£æ, æ¯”åˆšæ‰çš„ 10s è¦å¥½å¾ˆå¤š.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œé—®é¢˜çœ‹ä¼¼å°±è§£å†³äº†. ä¸è¿‡, å¦‚æœå¤šæ¬¡è¿è¡Œ nslookup å‘½ä»¤, ä¼°è®¡å°±ä¸æ˜¯æ¯æ¬¡éƒ½æœ‰å¥½ç»“æœäº†. æ¯”å¦‚, åœ¨æˆ‘çš„æœºå™¨ä¸­, å°±ç»å¸¸éœ€è¦ 1s ç”šè‡³æ›´å¤šçš„æ—¶é—´.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# time nslookup time.geekbang.org")]),s._v("\nServer:\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n \nNon-authoritative answer:\nName:\ttime.geekbang.org\nAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.106")]),s._v(".233.176\n \nreal\t0m1.045s\nuser\t0m0.007s\nsys\t0m0.004s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("1s çš„ DNS è§£ææ—¶é—´è¿˜æ˜¯å¤ªé•¿äº†, å¯¹å¾ˆå¤šåº”ç”¨æ¥è¯´ä¹Ÿæ˜¯ä¸å¯æ¥å—çš„. é‚£è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢? æˆ‘æƒ³ä½ ä¸€å®šå·²ç»æƒ³åˆ°äº†, é‚£å°±æ˜¯"),a("strong",[s._v("ä½¿ç”¨ DNS ç¼“å­˜")]),s._v(". è¿™æ ·, åªæœ‰ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶éœ€è¦å» DNS æœåŠ¡å™¨è¯·æ±‚, ä»¥åçš„æŸ¥è¯¢, åªè¦ DNS è®°å½•ä¸è¿‡æœŸ, ä½¿ç”¨ç¼“å­˜ä¸­çš„è®°å½•å°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, å¤§å®¶ä½¿ç”¨çš„ä¸»æµ Linux å‘è¡Œç‰ˆ, é™¤äº†æœ€æ–°ç‰ˆæœ¬çš„ Ubuntu (å¦‚ 18.04 æˆ–è€…æ›´æ–°ç‰ˆæœ¬)å¤–, å…¶ä»–ç‰ˆæœ¬å¹¶æ²¡æœ‰è‡ªåŠ¨é…ç½® DNS ç¼“å­˜.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, æƒ³è¦ä¸ºç³»ç»Ÿå¼€å¯ DNS ç¼“å­˜, å°±éœ€è¦åšé¢å¤–çš„é…ç½®. æ¯”å¦‚, æœ€ç®€å•çš„æ–¹æ³•, å°±æ˜¯ä½¿ç”¨ "),a("strong",[s._v("dnsmasq")]),s._v(". dnsmasq æ˜¯æœ€å¸¸ç”¨çš„ DNS ç¼“å­˜æœåŠ¡ä¹‹ä¸€, è¿˜ç»å¸¸ä½œä¸º DHCP æœåŠ¡æ¥ä½¿ç”¨. å®ƒçš„å®‰è£…å’Œé…ç½®éƒ½æ¯”è¾ƒç®€å•, æ€§èƒ½ä¹Ÿå¯ä»¥æ»¡è¶³ç»å¤§å¤šæ•°åº”ç”¨ç¨‹åºå¯¹ DNS ç¼“å­˜çš„éœ€æ±‚.")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨åˆšæ‰çš„å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥å¯åŠ¨ dnsmasq:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/init.d/dnsmasq start")]),s._v("\n * Starting DNS forwarder and DHCP server dnsmasq                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" OK "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶å, ä¿®æ”¹ "),a("code",[s._v("/etc/resolv.conf")]),s._v("â€‹, å°† DNS æœåŠ¡å™¨æ”¹ä¸º dnsmasq çš„ç›‘å¬åœ°å€, è¿™å„¿æ˜¯ 127.0.0.1. æ¥ç€é‡æ–°æ‰§è¡Œå¤šæ¬¡ nslookup å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo nameserver 127.0.0.1 > /etc/resolv.conf")]),s._v("\n/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# time nslookup time.geekbang.org")]),s._v("\nServer:\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n \nNon-authoritative answer:\nName:\ttime.geekbang.org\nAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.106")]),s._v(".233.176\n \nreal\t0m0.492s\nuser\t0m0.007s\nsys\t0m0.006s\n \n/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# time nslookup time.geekbang.org")]),s._v("\nServer:\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n \nNon-authoritative answer:\nName:\ttime.geekbang.org\nAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.106")]),s._v(".233.176\n \nreal\t0m0.011s\nuser\t0m0.008s\nsys\t0m0.003s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("ç°åœ¨å¯ä»¥çœ‹åˆ°, åªæœ‰ç¬¬ä¸€æ¬¡çš„è§£æå¾ˆæ…¢, éœ€è¦ 0.5s, ä»¥åçš„æ¯æ¬¡è§£æéƒ½å¾ˆå¿«, åªéœ€è¦ 11ms. å¹¶ä¸”åé¢æ¯æ¬¡ DNS è§£æéœ€è¦çš„æ—¶é—´ä¹Ÿéƒ½å¾ˆç¨³å®š.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-12"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-12"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("DNS æ˜¯äº’è”ç½‘ä¸­æœ€åŸºç¡€çš„ä¸€é¡¹æœåŠ¡, æä¾›äº†åŸŸåå’Œ IP åœ°å€é—´æ˜ å°„å…³ç³»çš„æŸ¥è¯¢æœåŠ¡. å¾ˆå¤šåº”ç”¨ç¨‹åºåœ¨æœ€åˆå¼€å‘æ—¶, å¹¶æ²¡è€ƒè™‘ DNS è§£æçš„é—®é¢˜, åç»­å‡ºç°é—®é¢˜å, æ’æŸ¥å¥½å‡ å¤©æ‰èƒ½å‘ç°, å…¶å®æ˜¯ DNS è§£ææ…¢å¯¼è‡´çš„.")]),s._v(" "),a("p",[s._v("è¯•æƒ³, å‡å¦‚ä¸€ä¸ª Web æœåŠ¡çš„æ¥å£, æ¯æ¬¡éƒ½éœ€è¦ 1s æ—¶é—´æ¥ç­‰å¾… DNS è§£æ, é‚£ä¹ˆæ— è®ºæ€ä¹ˆä¼˜åŒ–åº”ç”¨ç¨‹åºçš„å†…åœ¨é€»è¾‘, å¯¹ç”¨æˆ·æ¥è¯´, è¿™ä¸ªæ¥å£çš„å“åº”éƒ½å¤ªæ…¢, å› ä¸ºå“åº”æ—¶é—´æ€»æ˜¯ä¼šå¤§äº 1 ç§’çš„.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, åœ¨åº”ç”¨ç¨‹åºçš„å¼€å‘è¿‡ç¨‹ä¸­, "),a("strong",[s._v("å¿…é¡»è€ƒè™‘åˆ° DNS è§£æå¯èƒ½å¸¦æ¥çš„æ€§èƒ½é—®é¢˜")]),s._v(", æŒæ¡å¸¸è§çš„ä¼˜åŒ–æ–¹æ³•. è¿™é‡Œæ€»ç»“äº†å‡ ç§å¸¸è§çš„ DNS ä¼˜åŒ–æ–¹æ³•.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å¯¹ DNS è§£æçš„ç»“æœè¿›è¡Œç¼“å­˜")]),s._v(". ç¼“å­˜æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•, ä½†è¦æ³¨æ„, ä¸€æ—¦ç¼“å­˜è¿‡æœŸ, è¿˜æ˜¯è¦å» DNS æœåŠ¡å™¨é‡æ–°è·å–æ–°è®°å½•. ä¸è¿‡è¿™å¯¹å¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºæ¥è¯´éƒ½æ˜¯å¯æ¥å—çš„.")]),s._v(" "),a("li",[a("strong",[s._v("å¯¹ DNS è§£æçš„ç»“æœè¿›è¡Œé¢„å–")]),s._v(". è¿™æ˜¯æµè§ˆå™¨ç­‰ Web åº”ç”¨ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•, ä¹Ÿå°±æ˜¯è¯´, ä¸ç­‰ç”¨æˆ·ç‚¹å‡»é¡µé¢ä¸Šçš„è¶…é“¾æ¥, æµè§ˆå™¨å°±ä¼šåœ¨åå°è‡ªåŠ¨è§£æåŸŸå, å¹¶æŠŠç»“æœç¼“å­˜èµ·æ¥.")]),s._v(" "),a("li",[a("strong",[s._v("ä½¿ç”¨ HTTPDNS å–ä»£å¸¸è§„çš„ DNS è§£æ")]),s._v(". è¿™æ˜¯å¾ˆå¤šç§»åŠ¨åº”ç”¨ä¼šé€‰æ‹©çš„æ–¹æ³•, ç‰¹åˆ«æ˜¯å¦‚ä»ŠåŸŸååŠ«æŒæ™®éå­˜åœ¨, ä½¿ç”¨ HTTP åè®®ç»•è¿‡é“¾è·¯ä¸­çš„ DNS æœåŠ¡å™¨, å°±å¯ä»¥é¿å…åŸŸååŠ«æŒçš„é—®é¢˜.")]),s._v(" "),a("li",[a("strong",[s._v("åŸºäº DNS çš„å…¨å±€è´Ÿè½½å‡è¡¡(GSLB)")]),s._v(" . è¿™ä¸ä»…ä¸ºæœåŠ¡æä¾›äº†è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨çš„åŠŸèƒ½, è¿˜å¯ä»¥æ ¹æ®ç”¨æˆ·çš„ä½ç½®, è¿”å›è·ç¦»æœ€è¿‘çš„ IP åœ°å€.")])]),s._v(" "),a("h4",{attrs:{id:"_38-æ¡ˆä¾‹ç¯‡-æ€ä¹ˆä½¿ç”¨tcpdumpå’Œwiresharkåˆ†æç½‘ç»œæµé‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_38-æ¡ˆä¾‹ç¯‡-æ€ä¹ˆä½¿ç”¨tcpdumpå’Œwiresharkåˆ†æç½‘ç»œæµé‡"}},[s._v("#")]),s._v(" 38-æ¡ˆä¾‹ç¯‡:æ€ä¹ˆä½¿ç”¨tcpdumpå’ŒWiresharkåˆ†æç½‘ç»œæµé‡?")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚å­¦ä¹ äº† DNS æ€§èƒ½é—®é¢˜çš„åˆ†æå’Œä¼˜åŒ–æ–¹æ³•. ç®€å•å›é¡¾ä¸€ä¸‹, DNS å¯ä»¥æä¾›åŸŸåå’Œ IP åœ°å€çš„æ˜ å°„å…³ç³», ä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„å…¨å±€è´Ÿè½½å‡è¡¡(GSLB)å®ç°æ–¹æ³•.")]),s._v(" "),a("p",[s._v("é€šå¸¸, éœ€è¦æš´éœ²åˆ°å…¬ç½‘çš„æœåŠ¡, éƒ½ä¼šç»‘å®šä¸€ä¸ªåŸŸå, æ—¢æ–¹ä¾¿äº†äººä»¬è®°å¿†, ä¹Ÿé¿å…äº†åå°æœåŠ¡ IP åœ°å€çš„å˜æ›´å½±å“åˆ°ç”¨æˆ·. ä¸è¿‡è¦æ³¨æ„, DNS è§£æå—åˆ°å„ç§ç½‘ç»œçŠ¶å†µçš„å½±å“, æ€§èƒ½å¯èƒ½ä¸ç¨³å®š. æ¯”å¦‚å…¬ç½‘å»¶è¿Ÿå¢å¤§, ç¼“å­˜è¿‡æœŸå¯¼è‡´è¦é‡æ–°å»ä¸Šæ¸¸æœåŠ¡å™¨è¯·æ±‚, æˆ–è€…æµé‡é«˜å³°æ—¶ DNS æœåŠ¡å™¨æ€§èƒ½ä¸è¶³ç­‰, éƒ½ä¼šå¯¼è‡´ DNS å“åº”çš„å»¶è¿Ÿå¢å¤§. æ­¤æ—¶, å¯ä»¥å€ŸåŠ© nslookup æˆ–è€… dig çš„è°ƒè¯•åŠŸèƒ½, åˆ†æ DNS çš„è§£æè¿‡ç¨‹, å†é…åˆ ping ç­‰å·¥å…·è°ƒè¯• DNS æœåŠ¡å™¨çš„å»¶è¿Ÿ, ä»è€Œå®šä½å‡ºæ€§èƒ½ç“¶é¢ˆ. é€šå¸¸å¯ä»¥ç”¨ç¼“å­˜, é¢„å–, HTTPDNS ç­‰æ–¹æ³•, ä¼˜åŒ– DNS çš„æ€§èƒ½.")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚ç”¨åˆ°çš„ ping, æ˜¯ä¸€ä¸ªæœ€å¸¸ç”¨çš„æµ‹è¯•æœåŠ¡å»¶è¿Ÿçš„å·¥å…·. å¾ˆå¤šæƒ…å†µä¸‹, ping å¯ä»¥å®šä½å‡ºå»¶è¿Ÿé—®é¢˜, ä¸è¿‡æœ‰æ—¶å€™,  ping æœ¬èº«ä¹Ÿä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜. è¿™æ—¶å°±éœ€è¦æŠ“å– ping å‘½ä»¤æ‰§è¡Œæ—¶æ”¶å‘çš„ç½‘ç»œåŒ…, ç„¶ååˆ†æè¿™äº›ç½‘ç»œåŒ…, è¿›è€Œæ‰¾å‡ºé—®é¢˜æ ¹æº.")]),s._v(" "),a("p",[a("strong",[s._v("tcpdump å’Œ Wireshark å°±æ˜¯æœ€å¸¸ç”¨çš„ç½‘ç»œæŠ“åŒ…å’Œåˆ†æå·¥å…·, æ›´æ˜¯åˆ†æç½‘ç»œæ€§èƒ½å¿…ä¸å¯å°‘çš„åˆ©å™¨")]),s._v(".")]),s._v(" "),a("ul",[a("li",[s._v("tcpdump ä»…æ”¯æŒå‘½ä»¤è¡Œæ ¼å¼ä½¿ç”¨, å¸¸ç”¨åœ¨æœåŠ¡å™¨ä¸­æŠ“å–å’Œåˆ†æç½‘ç»œåŒ….")]),s._v(" "),a("li",[s._v("Wireshark é™¤äº†å¯ä»¥æŠ“åŒ…å¤–, è¿˜æä¾›äº†å¼ºå¤§çš„å›¾å½¢ç•Œé¢å’Œæ±‡æ€»åˆ†æå·¥å…·, åœ¨åˆ†æå¤æ‚çš„ç½‘ç»œæƒ…æ™¯æ—¶, å°¤ä¸ºç®€å•å’Œå®ç”¨.")])]),s._v(" "),a("p",[s._v("å› è€Œ, åœ¨å®é™…åˆ†æç½‘ç»œæ€§èƒ½æ—¶, "),a("strong",[s._v("å…ˆç”¨ tcpdump æŠ“åŒ…, åç”¨ Wireshark åˆ†æ")]),s._v(", ä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹å‡†å¤‡-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹å‡†å¤‡-5"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒæ˜¯è¿™æ ·çš„:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… tcpdump, Wireshark ç­‰å·¥å…·.")])]),s._v(" "),a("p",[s._v("ç”±äº Wireshark çš„å›¾å½¢ç•Œé¢, å¹¶ä¸èƒ½é€šè¿‡ SSH ä½¿ç”¨, æ‰€ä»¥æ¨èåœ¨æœ¬åœ°æœºå™¨(æ¯”å¦‚ Windows)ä¸­å®‰è£….")]),s._v(" "),a("h5",{attrs:{id:"_2-å†æ¢ping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†æ¢ping"}},[s._v("#")]),s._v(" 2.å†æ¢ping")]),s._v(" "),a("p",[s._v("å‰é¢è®²è¿‡, ping æ˜¯ä¸€ç§æœ€å¸¸ç”¨çš„ç½‘ç»œå·¥å…·, å¸¸ç”¨æ¥æ¢æµ‹ç½‘ç»œä¸»æœºä¹‹é—´çš„è¿é€šæ€§ä»¥åŠå»¶è¿Ÿ. è™½ç„¶ ping æ¯”è¾ƒç®€å•, ä½†æœ‰æ—¶å€™ä¼šå‘ç°, ping å·¥å…·æœ¬èº«ä¹Ÿå¯èƒ½å‡ºç°å¼‚å¸¸, æ¯”å¦‚è¿è¡Œç¼“æ…¢, ä½†å®é™…ç½‘ç»œå»¶è¿Ÿå´å¹¶ä¸å¤§çš„æƒ…å†µ.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥æ‰“å¼€ä¸€ä¸ªç»ˆç«¯, SSH ç™»å½•åˆ°æ¡ˆä¾‹æœºå™¨ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ¥æµ‹è¯•æ¡ˆä¾‹æœºå™¨ä¸æå®¢é‚¦ç§‘æŠ€å®˜ç½‘çš„è¿é€šæ€§å’Œå»¶è¿Ÿ. å¦‚æœä¸€åˆ‡æ­£å¸¸, ä¼šçœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping 3 æ¬¡(é»˜è®¤æ¯æ¬¡å‘é€é—´éš” 1 ç§’)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å‡è®¾ DNS æœåŠ¡å™¨è¿˜æ˜¯ä¸Šä¸€æœŸé…ç½®çš„ 114.114.114.114")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c3")]),s._v(" geektime.org\nPING geektime.org "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36.8")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.1")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.2")]),s._v(" ms\n \n--- geektime.org "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 11049ms\nrtt min/avg/max/mdev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.146")]),s._v("/33.074/36.809/2.649 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, å‡å¦‚è¿è¡Œæ—¶å‘ç° ping å¾ˆå¿«å°±ç»“æŸäº†, é‚£å°±æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å†é‡è¯•ä¸€ä¸‹. è‡³äºè¿™æ¡å‘½ä»¤çš„å«ä¹‰, ç¨åå†åšè§£é‡Š.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç¦æ­¢æ¥æ”¶ä» DNS æœåŠ¡å™¨å‘é€è¿‡æ¥å¹¶åŒ…å« googleusercontent çš„åŒ…")]),s._v("\n$ iptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-I")]),s._v(" INPUT "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" udp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sport")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" string "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--string")]),s._v(" googleusercontent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--algo")]),s._v(" bm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" DROP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ ¹æ® ping çš„è¾“å‡ºå¯ä»¥å‘ç°, geektime.org è§£æåçš„ IP åœ°å€æ˜¯ 35.190.27.188, è€Œåä¸‰æ¬¡ ping è¯·æ±‚éƒ½å¾—åˆ°äº†å“åº”, å»¶è¿Ÿ(RTT)éƒ½æ˜¯ 30ms å¤šä¸€ç‚¹.")]),s._v(" "),a("p",[s._v("ä½†æ±‡æ€»çš„åœ°æ–¹, å°±æœ‰ç‚¹å„¿æ„æ€äº†. 3 æ¬¡å‘é€, æ”¶åˆ° 3 æ¬¡å“åº”, æ²¡æœ‰ä¸¢åŒ…, ä½†ä¸‰æ¬¡å‘é€å’Œæ¥å—çš„æ€»æ—¶é—´å±…ç„¶è¶…è¿‡äº† 11s(11049ms), è¿™å°±æœ‰äº›ä¸å¯æ€è®®äº†å§. ä¼šæƒ³èµ·ä¸Šä¸€èŠ‚çš„ DNS è§£æé—®é¢˜, ä½ å¯èƒ½ä¼šæ€€ç–‘, è¿™å¯èƒ½æ˜¯ DNS è§£æç¼“æ…¢çš„é—®é¢˜. ä½†åˆ°åº•æ˜¯ä¸æ˜¯å‘¢?")]),s._v(" "),a("p",[s._v("å†å›å»çœ‹ ping çš„è¾“å‡º, ä¸‰æ¬¡ ping è¯·æ±‚ä¸­, ç”¨çš„éƒ½æ˜¯ IP åœ°å€, è¯´æ˜ ping åªéœ€è¦åœ¨æœ€å¼€å§‹è¿è¡Œæ—¶, è§£æä¸€æ¬¡å¾—åˆ° IP, åé¢å°±å¯ä»¥åªç”¨ IP äº†.")]),s._v(" "),a("p",[s._v("å†ç”¨ nslookup è¯•è¯•. åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢çš„ nslookup å‘½ä»¤, æ³¨æ„è¿™æ¬¡åŒæ ·åŠ äº† time å‘½ä»¤, è¾“å‡º nslookup çš„æ‰§è¡Œæ—¶é—´:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nslookup")]),s._v(" geektime.org\nServer:\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n \nNon-authoritative answer:\nName:\tgeektime.org\nAddress: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188\n \nreal\t0m0.044s\nuser\t0m0.006s\nsys\t0m0.003s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, åŸŸåè§£æè¿˜æ˜¯å¾ˆå¿«çš„, åªéœ€è¦ 44ms, æ˜¾ç„¶æ¯” 11s çŸ­äº†å¾ˆå¤š.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œ, å†å¾€åè¯¥æ€ä¹ˆåˆ†æå‘¢? å…¶å®, "),a("strong",[s._v("è¿™æ—¶å€™å°±å¯ä»¥ç”¨ tcpdump æŠ“åŒ…, æŸ¥çœ‹ ping åœ¨æ”¶å‘å“ªäº›ç½‘ç»œåŒ…")]),s._v(".")]),s._v(" "),a("p",[s._v("å†æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯(ç»ˆç«¯äºŒ), SSH ç™»å½•æ¡ˆä¾‹æœºå™¨å, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ tcpdump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nn")]),s._v(" udp port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å½“ç„¶å¯ä»¥ç›´æ¥ç”¨ tcpdump ä¸åŠ ä»»ä½•å‚æ•°æ¥æŠ“åŒ…, ä½†é‚£æ ·çš„è¯, å°±å¯èƒ½æŠ“å–åˆ°å¾ˆå¤šä¸ç›¸å¹²çš„åŒ…. ç”±äºå·²ç»æ‰§è¡Œè¿‡ ping å‘½ä»¤, çŸ¥é“äº† geekbang.org çš„ IP åœ°å€æ˜¯ 35.190.27.188, ä¹ŸçŸ¥é“ ping å‘½ä»¤ä¼šæ‰§è¡Œ DNS æŸ¥è¯¢. æ‰€ä»¥, ä¸Šé¢è¿™æ¡å‘½ä»¤, å°±æ˜¯åŸºäºè¿™ä¸ªè§„åˆ™è¿›è¡Œè¿‡æ»¤.")]),s._v(" "),a("p",[s._v("æ¥å…·ä½“è§£é‡Šä¸€ä¸‹è¿™æ¡å‘½ä»¤.")]),s._v(" "),a("ul",[a("li",[s._v("-nn, è¡¨ç¤ºä¸è§£ææŠ“åŒ…ä¸­çš„åŸŸå(å³ä¸åå‘è§£æ), åè®®ä»¥åŠç«¯å£å·.")]),s._v(" "),a("li",[s._v("udp port 53, è¡¨ç¤ºåªæ˜¾ç¤º UDP åè®®çš„ç«¯å£å·(åŒ…æ‹¬æºç«¯å£å’Œç›®çš„ç«¯å£)ä¸º 53 çš„åŒ….")]),s._v(" "),a("li",[s._v("host 35.190.27.188, è¡¨ç¤ºåªæ˜¾ç¤º IP åœ°å€(åŒ…æ‹¬æºåœ°å€å’Œç›®çš„åœ°å€)ä¸º 35.190.27.188 çš„åŒ….")]),s._v(" "),a("li",[s._v('è¿™ä¸¤ä¸ªè¿‡æ»¤æ¡ä»¶ä¸­é—´çš„ "or", è¡¨ç¤ºæˆ–çš„å…³ç³», ä¹Ÿå°±æ˜¯è¯´, åªè¦æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä»»ä¸€ä¸ª, å°±å¯ä»¥å±•ç¤ºå‡ºæ¥.')])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å›åˆ°ç»ˆç«¯ä¸€, æ‰§è¡Œç›¸åŒçš„ ping å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c3")]),s._v(" geektime.org\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n--- geektime.org "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 11095ms\nrtt min/avg/max/mdev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.473")]),s._v("/81.572/81.757/0.130 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("å‘½ä»¤ç»“æŸå, å†å›åˆ°ç»ˆç«¯äºŒä¸­, æŸ¥çœ‹ tcpdump çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("tcpdump: verbose output suppressed, use "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-vv")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full protocol decode\nlistening on eth0, link-type EN10MB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", capture size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v(" bytes\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:31.100564 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4.56669 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114.53: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36909")]),s._v("+ A? geektime.org. "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:31.507699 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114.53 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4.56669: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36909")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/0/0 A "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:31.508164 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188: ICMP "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" request, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4356")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:31.539667 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4: ICMP "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" reply, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4356")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:31.539995 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4.60254 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114.53: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49932")]),s._v("+ PTR? "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("188.27")]),s._v(".190.35.in-addr.arpa. "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:36.545104 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4.60254 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114.53: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49932")]),s._v("+ PTR? "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("188.27")]),s._v(".190.35.in-addr.arpa. "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:41.551284 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188: ICMP "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" request, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4356")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:41.582363 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4: ICMP "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" reply, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4356")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:42.552506 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188: ICMP "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" request, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4356")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":02:42.583646 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".3.4: ICMP "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" reply, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4356")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("è¿™æ¬¡è¾“å‡ºä¸­, å‰ä¸¤è¡Œ, è¡¨ç¤º tcpdump çš„é€‰é¡¹ä»¥åŠæ¥å£çš„åŸºæœ¬ä¿¡æ¯; ä»ç¬¬ä¸‰è¡Œå¼€å§‹, å°±æ˜¯æŠ“å–åˆ°çš„ç½‘ç»œåŒ…çš„è¾“å‡º. è¿™äº›è¾“å‡ºçš„æ ¼å¼, éƒ½æ˜¯ "),a("code",[s._v("æ—¶é—´æˆ³ åè®® æºåœ°å€.æºç«¯å£ > ç›®çš„åœ°å€.ç›®çš„ç«¯å£ ç½‘ç»œåŒ…è¯¦ç»†ä¿¡æ¯")]),s._v("(è¿™æ˜¯æœ€åŸºæœ¬çš„æ ¼å¼, å¯ä»¥é€šè¿‡é€‰é¡¹å¢åŠ å…¶ä»–å­—æ®µ).")]),s._v(" "),a("p",[s._v("å‰é¢çš„å­—æ®µ, éƒ½æ¯”è¾ƒå¥½ç†è§£. ä½†ç½‘ç»œåŒ…çš„è¯¦ç»†ä¿¡æ¯, æœ¬èº«æ ¹æ®åè®®çš„ä¸åŒè€Œä¸åŒ. æ‰€ä»¥è¦ç†è§£è¿™äº›ç½‘ç»œåŒ…çš„è¯¦ç»†å«ä¹‰, å°±è¦å¯¹å¸¸ç”¨ç½‘ç»œåè®®çš„åŸºæœ¬æ ¼å¼ä»¥åŠäº¤äº’åŸç†, æœ‰åŸºæœ¬çš„äº†è§£. å½“ç„¶, å®é™…ä¸Š, è¿™äº›å†…å®¹éƒ½ä¼šè®°å½•åœ¨ IETF( äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„)å‘å¸ƒçš„ "),a("a",{attrs:{href:"https://tools.ietf.org/rfc/index",target:"_blank",rel:"noopener noreferrer"}},[s._v("RFC"),a("OutboundLink")],1),s._v("(è¯·æ±‚æ„è§ç¨¿)ä¸­.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ç¬¬ä¸€æ¡å°±è¡¨ç¤º, ä»æœ¬åœ° IP å‘é€åˆ° 114.114.114.114 çš„ A è®°å½•æŸ¥è¯¢è¯·æ±‚, å®ƒçš„æŠ¥æ–‡æ ¼å¼è®°å½•åœ¨ RFC1035 ä¸­, å¯ä»¥ç‚¹å‡»"),a("a",{attrs:{href:"https://www.ietf.org/rfc/rfc1035.txt",target:"_blank",rel:"noopener noreferrer"}},[s._v("è¿™é‡Œ"),a("OutboundLink")],1),s._v("æŸ¥çœ‹. åœ¨è¿™ä¸ª tcpdump çš„è¾“å‡ºä¸­,")]),s._v(" "),a("ul",[a("li",[s._v("36909+ è¡¨ç¤ºæŸ¥è¯¢æ ‡è¯†å€¼, å®ƒä¹Ÿä¼šå‡ºç°åœ¨å“åº”ä¸­, åŠ å·è¡¨ç¤ºå¯ç”¨é€’å½’æŸ¥è¯¢.")]),s._v(" "),a("li",[s._v("A? è¡¨ç¤ºæŸ¥è¯¢ A è®°å½•.")]),s._v(" "),a("li",[s._v("geektime.org. è¡¨ç¤ºå¾…æŸ¥è¯¢çš„åŸŸå.")]),s._v(" "),a("li",[s._v("30 è¡¨ç¤ºæŠ¥æ–‡é•¿åº¦.")])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥çš„ä¸€æ¡, åˆ™æ˜¯ä» 114.114.114.114 å‘é€å›æ¥çš„ DNS å“åº”â€”â€”åŸŸå geektime.org. çš„ A è®°å½•å€¼ä¸º 35.190.27.188.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸‰æ¡å’Œç¬¬å››æ¡, æ˜¯ ICMP echo request å’Œ ICMP echo reply, å“åº”åŒ…çš„æ—¶é—´æˆ³ 14:02:31.539667, å‡å»è¯·æ±‚åŒ…çš„æ—¶é—´æˆ³ 14:02:31.508164 , å°±å¯ä»¥å¾—åˆ°è¿™æ¬¡ ICMP æ‰€ç”¨æ—¶é—´ä¸º 30ms. è¿™çœ‹èµ·æ¥å¹¶æ²¡æœ‰é—®é¢˜.")]),s._v(" "),a("p",[s._v("ä½†éšåçš„ä¸¤æ¡åå‘åœ°å€"),a("strong",[s._v("è§£æ PTR è¯·æ±‚")]),s._v(", å°±æ¯”è¾ƒå¯ç–‘äº†. å› ä¸ºåªçœ‹åˆ°äº†è¯·æ±‚åŒ…, å´æ²¡æœ‰åº”ç­”åŒ…. ä»”ç»†è§‚å¯Ÿå®ƒä»¬çš„æ—¶é—´ä¼šå‘ç°, è¿™ä¸¤æ¡è®°å½•éƒ½æ˜¯å‘å‡ºå 5s æ‰å‡ºç°ä¸‹ä¸€ä¸ªç½‘ç»œåŒ…, ä¸¤æ¡ PTR è®°å½•å°±æ¶ˆè€—äº† 10s.")]),s._v(" "),a("p",[s._v("å†å¾€ä¸‹çœ‹, æœ€åçš„å››ä¸ªåŒ…, åˆ™æ˜¯ä¸¤æ¬¡æ­£å¸¸çš„ ICMP è¯·æ±‚å’Œå“åº”, æ ¹æ®æ—¶é—´æˆ³è®¡ç®—å…¶å»¶è¿Ÿ, ä¹Ÿæ˜¯ 30ms.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œ, å…¶å®ä¹Ÿå°±æ‰¾åˆ°äº† ping ç¼“æ…¢çš„æ ¹æº, "),a("strong",[s._v("æ­£æ˜¯ä¸¤æ¬¡ PTR è¯·æ±‚æ²¡æœ‰å¾—åˆ°å“åº”è€Œè¶…æ—¶å¯¼è‡´çš„. PTR åå‘åœ°å€è§£æçš„ç›®çš„, æ˜¯ä» IP åœ°å€åæŸ¥å‡ºåŸŸå")]),s._v(", ä½†äº‹å®ä¸Š, å¹¶éæ‰€æœ‰ IP åœ°å€éƒ½ä¼šå®šä¹‰ PTR è®°å½•, æ‰€ä»¥ PTR æŸ¥è¯¢å¾ˆå¯èƒ½ä¼šå¤±è´¥.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, åœ¨ä½¿ç”¨ ping æ—¶, å¦‚æœå‘ç°ç»“æœä¸­çš„å»¶è¿Ÿå¹¶ä¸å¤§, è€Œ ping å‘½ä»¤æœ¬èº«å´å¾ˆæ…¢, ä¸è¦æ…Œ, æœ‰å¯èƒ½æ˜¯èƒŒåçš„ PTR åœ¨æé¬¼.")]),s._v(" "),a("p",[s._v("çŸ¥é“é—®é¢˜å, è§£å†³èµ·æ¥å°±æ¯”è¾ƒç®€å•äº†, åªè¦ç¦æ­¢ PTR å°±å¯ä»¥. è¿˜æ˜¯è€è·¯å­, æ‰§è¡Œ man ping å‘½ä»¤, æŸ¥è¯¢ä½¿ç”¨æ‰‹å†Œ, å°±å¯ä»¥æ‰¾å‡ºç›¸åº”çš„æ–¹æ³•, å³åŠ ä¸Š -n é€‰é¡¹ç¦æ­¢åç§°è§£æ. æ¯”å¦‚å¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c3")]),s._v(" geektime.org\nPING geektime.org "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33.5")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.0")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32.8")]),s._v(" ms\n \n--- geektime.org "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 2002ms\nrtt min/avg/max/mdev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32.879")]),s._v("/35.160/39.030/2.755 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("å¯ä»¥å‘ç°, ç°åœ¨åªéœ€è¦ 2s å°±å¯ä»¥ç»“æŸ, æ¯”åˆšæ‰çš„ 11s å¯æ˜¯å¿«å¤šäº†. åˆ°è¿™é‡Œ, å°±ä¸€èµ·ä½¿ç”¨ tcpdump, è§£å†³äº†ä¸€ä¸ªæœ€å¸¸è§çš„ ping å·¥ä½œç¼“æ…¢çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("æ¡ˆä¾‹æœ€å, å¦‚æœåœ¨å¼€å§‹æ—¶, æ‰§è¡Œäº† iptables å‘½ä»¤, é‚£ä¹Ÿä¸è¦å¿˜äº†åˆ æ‰å®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ iptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" INPUT "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" udp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sport")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" string "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--string")]),s._v(" googleusercontent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--algo")]),s._v(" bm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" DROP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ä¸è¿‡, åˆ é™¤åä½ è‚¯å®šè¿˜æœ‰ç–‘é—®, æ˜æ˜æ¡ˆä¾‹è·Ÿ Google æ²¡å•¥å…³ç³», ä¸ºä»€ä¹ˆè¦æ ¹æ® googleusercontent, è¿™ä¸ªæ¯«ä¸ç›¸å…³çš„å­—ç¬¦ä¸²æ¥è¿‡æ»¤åŒ…å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, å¦‚æœæ¢ä¸€ä¸ª DNS æœåŠ¡å™¨, å°±å¯ä»¥ç”¨ PTR åæŸ¥åˆ° 35.190.27.188 æ‰€å¯¹åº”çš„åŸŸå:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nslookup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PTR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8\nServer:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8\nAddress:\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\nNon-authoritative answer:\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("188.27")]),s._v(".190.35.in-addr.arpa\tname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("188.27")]),s._v(".190.35.bc.googleusercontent.com.\nAuthoritative answers can be found from:\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è™½ç„¶æŸ¥åˆ°äº† PTR è®°å½•, ä½†ç»“æœå¹¶é geekbang.org, è€Œæ˜¯ 188.27.190.35.bc.googleusercontent.com. å…¶å®, è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ, æ¡ˆä¾‹å¼€å§‹æ—¶å°†åŒ…å« googleusercontent çš„ä¸¢å¼ƒå, ping å°±æ…¢äº†. å› ä¸º iptables, å®é™…ä¸Šæ˜¯æŠŠ PTR å“åº”ç»™ä¸¢äº†, æ‰€ä»¥ä¼šå¯¼è‡´ PTR è¯·æ±‚è¶…æ—¶.")]),s._v(" "),a("p",[s._v("tcpdump å¯ä»¥è¯´æ˜¯ç½‘ç»œæ€§èƒ½åˆ†ææœ€æœ‰æ•ˆçš„åˆ©å™¨. æ¥ä¸‹æ¥å†ä¸€èµ·çœ‹çœ‹ tcpdump çš„æ›´å¤šä½¿ç”¨æ–¹æ³•.")]),s._v(" "),a("h5",{attrs:{id:"_3-tcpdump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-tcpdump"}},[s._v("#")]),s._v(" 3.tcpdump")]),s._v(" "),a("p",[s._v("tcpdump ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ä¸ªç½‘ç»œåˆ†æå·¥å…·. å®ƒåŸºäº "),a("a",{attrs:{href:"https://www.tcpdump.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("libpcap"),a("OutboundLink")],1),s._v(", åˆ©ç”¨å†…æ ¸ä¸­çš„ AF_PACKET å¥—æ¥å­—, æŠ“å–ç½‘ç»œæ¥å£ä¸­ä¼ è¾“çš„ç½‘ç»œåŒ…; å¹¶æä¾›äº†å¼ºå¤§çš„è¿‡æ»¤è§„åˆ™, å¸®ä½ ä»å¤§é‡çš„ç½‘ç»œåŒ…ä¸­, æŒ‘å‡ºæœ€æƒ³å…³æ³¨çš„ä¿¡æ¯.")]),s._v(" "),a("p",[s._v("tcpdump å±•ç¤ºäº†æ¯ä¸ªç½‘ç»œåŒ…çš„è¯¦ç»†ç»†èŠ‚, è¿™å°±è¦æ±‚, åœ¨ä½¿ç”¨å‰å¿…é¡»è¦å¯¹ç½‘ç»œåè®®æœ‰åŸºæœ¬äº†è§£. è€Œè¦äº†è§£ç½‘ç»œåè®®çš„è¯¦ç»†è®¾è®¡å’Œå®ç°ç»†èŠ‚, "),a("a",{attrs:{href:"https://www.rfc-editor.org/rfc-index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("RFC"),a("OutboundLink")],1),s._v(" å½“ç„¶æ˜¯æœ€æƒå¨çš„èµ„æ–™.")]),s._v(" "),a("p",[s._v("å†å›åˆ° tcpdump å·¥å…·æœ¬èº«, å®ƒçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•, è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„, ä¹Ÿå°±æ˜¯ "),a("strong",[s._v("tcpdump")]),s._v(" "),a("strong",[s._v("é€‰é¡¹è¿‡æ»¤è¡¨è¾¾å¼")]),s._v(". å½“ç„¶é€‰é¡¹å’Œè¡¨è¾¾å¼çš„å¤–é¢éƒ½åŠ äº†ä¸­æ‹¬å·, è¡¨æ˜å®ƒä»¬éƒ½æ˜¯å¯é€‰çš„.")]),s._v(" "),a("p",[s._v("ä¸ºäº†å¸®ä½ æ›´å¿«ä¸Šæ‰‹ tcpdump çš„ä½¿ç”¨, è¿™é‡Œä¹Ÿæ•´ç†äº†ä¸€äº›æœ€å¸¸è§çš„ç”¨æ³•, å¹¶ä¸”ç»˜åˆ¶æˆäº†è¡¨æ ¼. é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å¸¸ç”¨çš„å‡ ä¸ªé€‰é¡¹. åœ¨ä¸Šé¢çš„ ping æ¡ˆä¾‹ä¸­, ç”¨è¿‡  "),a("strong",[s._v("-nn")]),s._v(" é€‰é¡¹, è¡¨ç¤ºä¸ç”¨å¯¹ IP åœ°å€å’Œç«¯å£å·è¿›è¡Œåç§°è§£æ. å…¶ä»–å¸¸ç”¨é€‰é¡¹, ç”¨ä¸‹é¢è¿™å¼ è¡¨æ ¼æ¥è§£é‡Š.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/303b6a5fcf0ac9efd4737bd6eb46379a-20230731161933-c74ymae.png",alt:""}})]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†æ¥çœ‹å¸¸ç”¨çš„è¿‡æ»¤è¡¨è¾¾å¼. åˆšåˆšç”¨è¿‡çš„æ˜¯ udp port 53 or host 35.190.27.188, è¡¨ç¤ºæŠ“å– DNS åè®®çš„è¯·æ±‚å’Œå“åº”åŒ…, ä»¥åŠæºåœ°å€æˆ–ç›®çš„åœ°å€ä¸º 35.190.27.188 çš„åŒ….")]),s._v(" "),a("p",[s._v("å…¶ä»–å¸¸ç”¨çš„è¿‡æ»¤é€‰é¡¹, ä¹Ÿæ•´ç†æˆäº†ä¸‹é¢è¿™ä¸ªè¡¨æ ¼.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/f535fd4d81f11403d291976c19e46a5d-20230731161933-6uhl5qz.png",alt:""}})]),s._v(" "),a("p",[s._v("æœ€å, å†æ¬¡å¼ºè°ƒ tcpdump çš„è¾“å‡ºæ ¼å¼, åœ¨å‰é¢å·²ç»ä»‹ç»äº†å®ƒçš„åŸºæœ¬æ ¼å¼:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("æ—¶é—´æˆ³ åè®® æºåœ°å€.æºç«¯å£ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ç›®çš„åœ°å€.ç›®çš„ç«¯å£ ç½‘ç»œåŒ…è¯¦ç»†ä¿¡æ¯\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å…¶ä¸­, ç½‘ç»œåŒ…çš„è¯¦ç»†ä¿¡æ¯å–å†³äºåè®®, ä¸åŒåè®®å±•ç¤ºçš„æ ¼å¼ä¹Ÿä¸åŒ. æ‰€ä»¥, æ›´è¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•, è¿˜æ˜¯éœ€è¦å»æŸ¥è¯¢ tcpdump çš„ "),a("a",{attrs:{href:"https://www.tcpdump.org/manpages/tcpdump.1.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("man"),a("OutboundLink")],1),s._v(" æ‰‹å†Œ(æ‰§è¡Œ man tcpdump ä¹Ÿå¯ä»¥å¾—åˆ°).")]),s._v(" "),a("p",[s._v("tcpdump è™½ç„¶åŠŸèƒ½å¼ºå¤§, å¯æ˜¯è¾“å‡ºæ ¼å¼å´å¹¶ä¸ç›´è§‚. ç‰¹åˆ«æ˜¯å½“ç³»ç»Ÿä¸­ç½‘ç»œåŒ…æ•°æ¯”è¾ƒå¤š(æ¯”å¦‚ PPS è¶…è¿‡å‡ åƒ)çš„æ—¶å€™, æƒ³ä» tcpdump æŠ“å–çš„ç½‘ç»œåŒ…ä¸­åˆ†æé—®é¢˜å°±å®åœ¨ä¸å®¹æ˜“.")]),s._v(" "),a("h5",{attrs:{id:"_4-wireshark"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-wireshark"}},[s._v("#")]),s._v(" 4.Wireshark")]),s._v(" "),a("p",[s._v("å¯¹æ¯”ä¹‹ä¸‹, Wireshark åˆ™é€šè¿‡å›¾å½¢ç•Œé¢, ä»¥åŠä¸€ç³»åˆ—çš„æ±‡æ€»åˆ†æå·¥å…·, æä¾›äº†æ›´å‹å¥½çš„ä½¿ç”¨ç•Œé¢, è®©ä½ å¯ä»¥ç”¨æ›´å¿«çš„é€Ÿåº¦, æ‘†å¹³ç½‘ç»œæ€§èƒ½é—®é¢˜. æ¥ä¸‹æ¥çœ‹çœ‹å®ƒ. Wireshark ä¹Ÿæ˜¯æœ€æµè¡Œçš„ä¸€ä¸ªç½‘ç»œåˆ†æå·¥å…·, å®ƒæœ€å¤§çš„å¥½å¤„å°±æ˜¯æä¾›äº†è·¨å¹³å°çš„å›¾å½¢ç•Œé¢. è·Ÿ tcpdump ç±»ä¼¼, Wireshark ä¹Ÿæä¾›äº†å¼ºå¤§çš„è¿‡æ»¤è§„åˆ™è¡¨è¾¾å¼, åŒæ—¶, è¿˜å†…ç½®äº†ä¸€ç³»åˆ—çš„æ±‡æ€»åˆ†æå·¥å…·.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, æ‹¿åˆšåˆšçš„ ping æ¡ˆä¾‹æ¥è¯´, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŠŠæŠ“å–çš„ç½‘ç»œåŒ…ä¿å­˜åˆ° ping.pcap æ–‡ä»¶ä¸­:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ tcpdump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nn")]),s._v(" udp port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.190")]),s._v(".27.188 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" ping.pcap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ¥ç€, æŠŠå®ƒæ‹·è´åˆ°ä½ å®‰è£…æœ‰ Wireshark çš„æœºå™¨ä¸­, æ¯”å¦‚å¯ä»¥ç”¨ scp æŠŠå®ƒæ‹·è´åˆ°æœ¬åœ°æ¥:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" host-ip/path/ping.pcap "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶å, å†ç”¨ Wireshark æ‰“å¼€å®ƒ. æ‰“å¼€åå°±å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¸ªç•Œé¢:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/52b1a9311c028ba8fe2eab6e8f335f3a-20230731161933-s5tqy6u.png",alt:""}})]),s._v(" "),a("p",[s._v("ä» Wireshark çš„ç•Œé¢é‡Œå¯ä»¥å‘ç°, å®ƒä¸ä»…ä»¥æ›´è§„æ•´çš„æ ¼å¼, å±•ç¤ºäº†å„ä¸ªç½‘ç»œåŒ…çš„å¤´éƒ¨ä¿¡æ¯; è¿˜ç”¨äº†ä¸åŒé¢œè‰², å±•ç¤º DNS å’Œ ICMP è¿™ä¸¤ç§ä¸åŒçš„åè®®. ä¹Ÿå¯ä»¥ä¸€çœ¼çœ‹å‡º, "),a("strong",[s._v("ä¸­é—´çš„ä¸¤æ¡ PTR æŸ¥è¯¢å¹¶æ²¡æœ‰å“åº”åŒ…")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ç€, åœ¨ç½‘ç»œåŒ…åˆ—è¡¨ä¸­é€‰æ‹©æŸä¸€ä¸ªç½‘ç»œåŒ…å, åœ¨å…¶ä¸‹æ–¹çš„ç½‘ç»œåŒ…è¯¦æƒ…ä¸­, è¿˜å¯ä»¥çœ‹åˆ°, è¿™ä¸ªåŒ…åœ¨åè®®æ ˆå„å±‚çš„è¯¦ç»†ä¿¡æ¯. æ¯”å¦‚, ä»¥ç¼–å·ä¸º 5 çš„ PTR åŒ…ä¸ºä¾‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/baaff2d6fd537d256f41e900fff8a8bd-20230731161933-sgcyh4u.png",alt:""}})]),s._v(" "),a("p",[s._v("å¯ä»¥çœ‹åˆ°, IP å±‚(Internet Protocol)çš„æºåœ°å€å’Œç›®çš„åœ°å€, ä¼ è¾“å±‚çš„ UDP åè®®(Uder Datagram Protocol), åº”ç”¨å±‚çš„ DNS åè®®(Domain Name System)çš„æ¦‚è¦ä¿¡æ¯.")]),s._v(" "),a("p",[s._v("ç»§ç»­ç‚¹å‡»æ¯å±‚å·¦è¾¹çš„ç®­å¤´, å°±å¯ä»¥çœ‹åˆ°è¯¥å±‚åè®®å¤´çš„æ‰€æœ‰ä¿¡æ¯. æ¯”å¦‚ç‚¹å‡» DNS å, å°±å¯ä»¥çœ‹åˆ° Transaction ID, Flags, Queries ç­‰ DNS åè®®å„ä¸ªå­—æ®µçš„æ•°å€¼ä»¥åŠå«ä¹‰.")]),s._v(" "),a("p",[s._v("å½“ç„¶, Wireshark çš„åŠŸèƒ½è¿œä¸æ­¢å¦‚æ­¤. æ¥ä¸‹æ¥çœ‹ä¸€ä¸ª HTTP çš„ä¾‹å­, å¹¶ç†è§£ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„å·¥ä½œåŸç†.")]),s._v(" "),a("p",[s._v("è¿™ä¸ªæ¡ˆä¾‹å°†è¦è®¿é—®çš„æ˜¯ "),a("code",[s._v("http://example.com/")]),s._v("â€‹. è¿›å…¥ç»ˆç«¯ä¸€, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, é¦–å…ˆæŸ¥å‡º example.com çš„ IP. ç„¶å, æ‰§è¡Œ tcpdump å‘½ä»¤, è¿‡æ»¤å¾—åˆ°çš„ IP åœ°å€, å¹¶å°†ç»“æœä¿å­˜åˆ° web.pcap ä¸­.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" +short example.com\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93.184")]),s._v(".216.34\n$ tcpdump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93.184")]),s._v(".216.34 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" web.pcap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("å®é™…ä¸Š, ä½ å¯ä»¥åœ¨ host è¡¨è¾¾å¼ä¸­, ç›´æ¥ä½¿ç”¨åŸŸå, å³ "),a("strong",[s._v("tcpdump -nn host example.com -w web.pcap")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, åˆ‡æ¢åˆ°ç»ˆç«¯äºŒ, æ‰§è¡Œä¸‹é¢çš„ curl å‘½ä»¤, è®¿é—® http://example.com:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://example.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æœ€åå†å›åˆ°ç»ˆç«¯ä¸€, æŒ‰ä¸‹ Ctrl+C åœæ­¢ tcpdump, å¹¶æŠŠå¾—åˆ°çš„ web.pcap æ‹·è´å‡ºæ¥.")]),s._v(" "),a("p",[s._v("ä½¿ç”¨ Wireshark æ‰“å¼€ web.pcap å, å°±å¯ä»¥åœ¨ Wireshark ä¸­, çœ‹åˆ°å¦‚ä¸‹çš„ç•Œé¢:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/cfe1d3c22b1ff4e552f4b36ff8ad1b98-20230731161933-98jh9r8.png",alt:""}})]),s._v(" "),a("p",[s._v("ç”±äº HTTP åŸºäº TCP, æ‰€ä»¥"),a("strong",[s._v("æœ€å…ˆçœ‹åˆ°çš„ä¸‰ä¸ªåŒ…, åˆ†åˆ«æ˜¯ TCP ä¸‰æ¬¡æ¡æ‰‹çš„åŒ…. æ¥ä¸‹æ¥, ä¸­é—´çš„æ‰æ˜¯ HTTP è¯·æ±‚å’Œå“åº”åŒ…, è€Œæœ€åçš„ä¸‰ä¸ªåŒ…, åˆ™æ˜¯ TCP è¿æ¥æ–­å¼€æ—¶çš„ä¸‰æ¬¡æŒ¥æ‰‹åŒ…")]),s._v(".")]),s._v(" "),a("p",[s._v("ä»èœå•æ ä¸­, ç‚¹å‡» Statistics -> Flow Graph, ç„¶ååœ¨å¼¹å‡ºçš„ç•Œé¢ä¸­çš„ Flow type é€‰æ‹© TCP Flows, å¯ä»¥æ›´æ¸…æ™°çš„çœ‹åˆ°, æ•´ä¸ªè¿‡ç¨‹ä¸­ TCP æµçš„æ‰§è¡Œè¿‡ç¨‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/33312592b0118acd1638ab5d27b84418-20230731161933-rnp8bkv.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™å…¶å®è·Ÿå„ç§æ•™ç¨‹ä¸Šè®²åˆ°çš„, TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹å¾ˆç±»ä¼¼, ä½œä¸ºå¯¹æ¯”, é€šå¸¸çœ‹åˆ°çš„ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„æµç¨‹, åŸºæœ¬æ˜¯è¿™æ ·çš„:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/image-20240310145859-j5i5438.png",alt:"image"}})]),s._v(" "),a("p",[s._v("ä¸è¿‡, å¯¹æ¯”è¿™ä¸¤å¼ å›¾ä¼šå‘ç°, è¿™é‡ŒæŠ“åˆ°çš„åŒ…è·Ÿä¸Šé¢çš„å››æ¬¡æŒ¥æ‰‹, å¹¶ä¸å®Œå…¨ä¸€æ ·, å®é™…æŒ¥æ‰‹è¿‡ç¨‹åªæœ‰ä¸‰ä¸ªåŒ…, è€Œä¸æ˜¯å››ä¸ª. å…¶å®, ä¹‹æ‰€ä»¥æœ‰ä¸‰ä¸ªåŒ…, "),a("strong",[s._v('æ˜¯å› ä¸ºæœåŠ¡å™¨ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ FIN å, æœåŠ¡å™¨ç«¯åŒæ—¶ä¹Ÿè¦å…³é—­è¿æ¥, è¿™æ ·å°±å¯ä»¥æŠŠ ACK å’Œ FIN åˆå¹¶åˆ°ä¸€èµ·å‘é€, èŠ‚çœäº†ä¸€ä¸ªåŒ…, å˜æˆäº†"ä¸‰æ¬¡æŒ¥æ‰‹"')]),s._v(" .")]),s._v(" "),a("p",[s._v("è€Œé€šå¸¸æƒ…å†µä¸‹, æœåŠ¡å™¨ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ FIN å, å¾ˆå¯èƒ½è¿˜æ²¡å‘é€å®Œæ•°æ®, æ‰€ä»¥å°±ä¼šå…ˆå›å¤å®¢æˆ·ç«¯ä¸€ä¸ª ACK åŒ…. ç¨ç­‰ä¸€ä¼šå„¿, å®Œæˆæ‰€æœ‰æ•°æ®åŒ…çš„å‘é€å, æ‰ä¼šå‘é€ FIN åŒ…. è¿™ä¹Ÿå°±æ˜¯å››æ¬¡æŒ¥æ‰‹äº†.")]),s._v(" "),a("p",[s._v("æŠ“åŒ…å, Wireshark ä¸­å°±ä¼šæ˜¾ç¤ºä¸‹é¢è¿™ä¸ªç•Œé¢:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/39dbc30d67d4e41efc3678c16af5577b-20230731161933-5o5hzwo.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“-8"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å­¦äº† tcpdump å’Œ Wireshark çš„ä½¿ç”¨æ–¹æ³•, å¹¶é€šè¿‡å‡ ä¸ªæ¡ˆä¾‹, å­¦ä¼šäº†å¦‚ä½•è¿ç”¨è¿™ä¸¤ä¸ªå·¥å…·æ¥åˆ†æç½‘ç»œçš„æ”¶å‘è¿‡ç¨‹, å¹¶æ‰¾å‡ºæ½œåœ¨çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, "),a("strong",[s._v("æ ¹æ® IP åœ°å€åæŸ¥åŸŸå, æ ¹æ®ç«¯å£å·åæŸ¥åè®®åç§°, æ˜¯å¾ˆå¤šç½‘ç»œå·¥å…·é»˜è®¤çš„è¡Œä¸º, è€Œè¿™å¾€å¾€ä¼šå¯¼è‡´æ€§èƒ½å·¥å…·çš„å·¥ä½œç¼“æ…¢")]),s._v(". æ‰€ä»¥, é€šå¸¸, ç½‘ç»œæ€§èƒ½å·¥å…·éƒ½ä¼šæä¾›ä¸€ä¸ªé€‰é¡¹(æ¯”å¦‚ -n æˆ–è€… -nn), æ¥ç¦æ­¢åç§°è§£æ.")]),s._v(" "),a("p",[s._v("åœ¨å·¥ä½œä¸­, å½“ç¢°åˆ°ç½‘ç»œæ€§èƒ½é—®é¢˜æ—¶, ä¸è¦å¿˜è®° tcpdump å’Œ Wireshark è¿™ä¸¤ä¸ªå¤§æ€å™¨. å¯ä»¥ç”¨å®ƒä»¬æŠ“å–å®é™…ä¼ è¾“çš„ç½‘ç»œåŒ…, å†æ’æŸ¥æ˜¯å¦æœ‰æ½œåœ¨çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("h4",{attrs:{id:"_39-æ¡ˆä¾‹ç¯‡-æ€ä¹ˆç¼“è§£ddosæ”»å‡»å¸¦æ¥çš„æ€§èƒ½ä¸‹é™é—®é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_39-æ¡ˆä¾‹ç¯‡-æ€ä¹ˆç¼“è§£ddosæ”»å‡»å¸¦æ¥çš„æ€§èƒ½ä¸‹é™é—®é¢˜"}},[s._v("#")]),s._v(" 39-æ¡ˆä¾‹ç¯‡:æ€ä¹ˆç¼“è§£DDoSæ”»å‡»å¸¦æ¥çš„æ€§èƒ½ä¸‹é™é—®é¢˜?")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¥çœ‹å¦å¤–ä¸€ä¸ªé—®é¢˜, "),a("strong",[s._v("æ€ä¹ˆç¼“è§£ DDoS(Distributed Denial of Service)å¸¦æ¥çš„æ€§èƒ½ä¸‹é™é—®é¢˜")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-ddosç®€ä»‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ddosç®€ä»‹"}},[s._v("#")]),s._v(" 1.DDoSç®€ä»‹")]),s._v(" "),a("p",[s._v("DDoS çš„å‰èº«æ˜¯ DoS(Denail of Service), å³æ‹’ç»æœåŠ¡æ”»å‡», æŒ‡åˆ©ç”¨å¤§é‡çš„åˆç†è¯·æ±‚, æ¥å ç”¨è¿‡å¤šçš„ç›®æ ‡èµ„æº, ä»è€Œä½¿ç›®æ ‡æœåŠ¡æ— æ³•å“åº”æ­£å¸¸è¯·æ±‚.")]),s._v(" "),a("p",[s._v("DDoS(Distributed Denial of Service) åˆ™æ˜¯åœ¨ DoS çš„åŸºç¡€ä¸Š, é‡‡ç”¨äº†"),a("strong",[s._v("åˆ†å¸ƒå¼æ¶æ„")]),s._v(", åˆ©ç”¨å¤šå°ä¸»æœºåŒæ—¶æ”»å‡»ç›®æ ‡ä¸»æœº. è¿™æ ·, å³ä½¿ç›®æ ‡æœåŠ¡éƒ¨ç½²äº†ç½‘ç»œé˜²å¾¡è®¾å¤‡, é¢å¯¹å¤§é‡ç½‘ç»œè¯·æ±‚æ—¶, è¿˜æ˜¯æ— åŠ›åº”å¯¹.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ç›®å‰å·²çŸ¥çš„æœ€å¤§æµé‡æ”»å‡», æ­£æ˜¯å»å¹´ Github é­å—çš„ DDoS æ”»å‡», å…¶å³°å€¼æµé‡å·²ç»è¾¾åˆ°äº† 1.35Tbps, PPS æ›´æ˜¯è¶…è¿‡äº† 1.2 äº¿(126.9 million).")]),s._v(" "),a("p",[s._v("ä»æ”»å‡»çš„åŸç†ä¸Šæ¥çœ‹, DDoS å¯ä»¥åˆ†ä¸ºä¸‹é¢å‡ ç§ç±»å‹.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§, è€—å°½å¸¦å®½. æ— è®ºæ˜¯æœåŠ¡å™¨è¿˜æ˜¯è·¯ç”±å™¨, äº¤æ¢æœºç­‰ç½‘ç»œè®¾å¤‡, å¸¦å®½éƒ½æœ‰å›ºå®šçš„ä¸Šé™. å¸¦å®½è€—å°½å, å°±ä¼šå‘ç”Ÿç½‘ç»œæ‹¥å µ, ä»è€Œæ— æ³•ä¼ è¾“å…¶ä»–æ­£å¸¸çš„ç½‘ç»œæŠ¥æ–‡.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§, è€—å°½æ“ä½œç³»ç»Ÿçš„èµ„æº. ç½‘ç»œæœåŠ¡çš„æ­£å¸¸è¿è¡Œ, éƒ½éœ€è¦ä¸€å®šçš„ç³»ç»Ÿèµ„æº, åƒæ˜¯ CPU, å†…å­˜ç­‰ç‰©ç†èµ„æº, ä»¥åŠè¿æ¥è¡¨ç­‰è½¯ä»¶èµ„æº. ä¸€æ—¦èµ„æºè€—å°½, ç³»ç»Ÿå°±ä¸èƒ½å¤„ç†å…¶ä»–æ­£å¸¸çš„ç½‘ç»œè¿æ¥.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰ç§, æ¶ˆè€—åº”ç”¨ç¨‹åºçš„è¿è¡Œèµ„æº. åº”ç”¨ç¨‹åºçš„è¿è¡Œ, é€šå¸¸è¿˜éœ€è¦è·Ÿå…¶ä»–çš„èµ„æºæˆ–ç³»ç»Ÿäº¤äº’. å¦‚æœåº”ç”¨ç¨‹åºä¸€ç›´å¿™äºå¤„ç†æ— æ•ˆè¯·æ±‚, ä¹Ÿä¼šå¯¼è‡´æ­£å¸¸è¯·æ±‚çš„å¤„ç†å˜æ…¢, ç”šè‡³å¾—ä¸åˆ°å“åº”.")])]),s._v(" "),a("p",[s._v("æ¯”å¦‚, æ„é€ å¤§é‡ä¸åŒçš„åŸŸåæ¥æ”»å‡» DNS æœåŠ¡å™¨, å°±ä¼šå¯¼è‡´ DNS æœåŠ¡å™¨ä¸åœæ‰§è¡Œè¿­ä»£æŸ¥è¯¢, å¹¶æ›´æ–°ç¼“å­˜. è¿™ä¼šæå¤§åœ°æ¶ˆè€— DNS æœåŠ¡å™¨çš„èµ„æº, ä½¿ DNS çš„å“åº”å˜æ…¢.")]),s._v(" "),a("p",[s._v("æ— è®ºæ˜¯å“ªä¸€ç§ç±»å‹çš„ DDoS, å±å®³éƒ½æ˜¯å·¨å¤§çš„. é‚£ä¹ˆ, "),a("strong",[s._v("å¦‚ä½•å‘ç°ç³»ç»Ÿé­å—äº† DDoS æ”»å‡», åˆè¯¥å¦‚ä½•åº”å¯¹è¿™ç§æ”»å‡»å‘¢")]),s._v("? æ¥ä¸‹æ¥å°±é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹, ä¸€èµ·æ¥çœ‹çœ‹è¿™äº›é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹å‡†å¤‡-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹å‡†å¤‡-2"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("ä¸‹é¢çš„æ¡ˆä¾‹ä»ç„¶åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒæ˜¯è¿™æ ·çš„:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, sar , hping3, tcpdump, curl ç­‰å·¥å…·, æ¯”å¦‚ apt-get install docker.io hping3 tcpdump curl.")])]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹ç”¨åˆ°ä¸‰å°è™šæ‹Ÿæœº, æˆ‘ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºå®ƒä»¬ä¹‹é—´çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/8c705700b67445e82671b9e38a6bf038-20230731161933-5awwian.png",alt:""}})]),s._v(" "),a("p",[s._v('å¯ä»¥çœ‹åˆ°, å…¶ä¸­ä¸€å°è™šæ‹Ÿæœºè¿è¡Œ Nginx, ç”¨æ¥æ¨¡æ‹Ÿå¾…åˆ†æçš„ Web æœåŠ¡å™¨; è€Œå¦å¤–ä¸¤å°ä½œä¸º Web æœåŠ¡å™¨çš„å®¢æˆ·ç«¯, å…¶ä¸­ä¸€å°ç”¨ä½œ DoS æ”»å‡», è€Œå¦ä¸€å°åˆ™æ˜¯æ­£å¸¸çš„å®¢æˆ·ç«¯. ä½¿ç”¨å¤šå°è™šæ‹Ÿæœºçš„ç›®çš„, è‡ªç„¶è¿˜æ˜¯ä¸ºäº†ç›¸äº’éš”ç¦», é¿å…"äº¤å‰æ„ŸæŸ“".')]),s._v(" "),a("p",[s._v("ç”±äºæ¡ˆä¾‹åªä½¿ç”¨äº†ä¸€å°æœºå™¨ä½œä¸ºæ”»å‡»æº, æ‰€ä»¥è¿™é‡Œçš„æ”»å‡», å®é™…ä¸Šè¿˜æ˜¯ä¼ ç»Ÿçš„ DoS, è€Œé DDoS.")]),s._v(" "),a("h5",{attrs:{id:"_3-æ¡ˆä¾‹åˆ†æ-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¡ˆä¾‹åˆ†æ-2"}},[s._v("#")]),s._v(" 3.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("é¦–å…ˆåœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿è¡Œæ¡ˆä¾‹, ä¹Ÿå°±æ˜¯å¯åŠ¨ä¸€ä¸ªæœ€åŸºæœ¬çš„ Nginx åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œ Nginx æœåŠ¡å¹¶å¯¹å¤–å¼€æ”¾ 80 ç«¯å£")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --network=host è¡¨ç¤ºä½¿ç”¨ä¸»æœºç½‘ç»œ(è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿åé¢æ’æŸ¥é—®é¢˜)")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ç„¶å, åœ¨ç»ˆç«¯äºŒå’Œç»ˆç«¯ä¸‰ä¸­, ä½¿ç”¨ curl è®¿é—® Nginx ç›‘å¬çš„ç«¯å£, ç¡®è®¤ Nginx æ­£å¸¸å¯åŠ¨. å‡è®¾ 192.168.0.30 æ˜¯ Nginx æ‰€åœ¨è™šæ‹Ÿæœºçš„ IP åœ°å€, é‚£ä¹ˆè¿è¡Œ curl å‘½ä»¤å, åº”è¯¥ä¼šçœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡ºç•Œé¢:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -w è¡¨ç¤ºåªè¾“å‡º HTTP çŠ¶æ€ç åŠæ€»æ—¶é—´, -o è¡¨ç¤ºå°†å“åº”é‡å®šå‘åˆ° /dev/null")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Http code: %{http_code}\\nTotal time:%{time_total}s\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /dev/null http://192.168.0.30/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHttp code: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\nTotal time:0.002s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°, æ­£å¸¸æƒ…å†µä¸‹, è®¿é—® Nginx åªéœ€è¦ 2ms(0.002s).")]),s._v(" "),a("p",[s._v("æ¥ç€, åœ¨ç»ˆç«¯äºŒä¸­, è¿è¡Œ hping3 å‘½ä»¤, æ¥æ¨¡æ‹Ÿ DoS æ”»å‡»:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -S å‚æ•°è¡¨ç¤ºè®¾ç½® TCP åè®®çš„ SYN(åŒæ­¥åºåˆ—å·), -p è¡¨ç¤ºç›®çš„ç«¯å£ä¸º 80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i u10 è¡¨ç¤ºæ¯éš” 10 å¾®ç§’å‘é€ä¸€ä¸ªç½‘ç»œå¸§")]),s._v("\n$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" u10 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ç°åœ¨, å†å›åˆ°ç»ˆç«¯ä¸€, å°±ä¼šå‘ç°, ç°åœ¨ä¸ç®¡æ‰§è¡Œä»€ä¹ˆå‘½ä»¤, éƒ½æ…¢äº†å¾ˆå¤š. ä¸è¿‡, åœ¨å®è·µæ—¶è¦æ³¨æ„:")]),s._v(" "),a("ul",[a("li",[s._v("å¦‚æœç°è±¡ä¸é‚£ä¹ˆæ˜æ˜¾, é‚£ä¹ˆè¯·å°è¯•æŠŠå‚æ•°é‡Œé¢çš„ u10 è°ƒå°(æ¯”å¦‚è°ƒæˆ u1), æˆ–è€…åŠ ä¸Š â€“flood é€‰é¡¹;")]),s._v(" "),a("li",[s._v("å¦‚æœç»ˆç«¯ä¸€å®Œå…¨æ²¡æœ‰å“åº”äº†, é‚£ä¹ˆè¯·é€‚å½“è°ƒå¤§ u10(æ¯”å¦‚è°ƒæˆ u30), å¦åˆ™åé¢å°±ä¸èƒ½é€šè¿‡ SSH æ“ä½œ VM1.")])]),s._v(" "),a("p",[s._v("ç„¶å, åˆ°ç»ˆç«¯ä¸‰ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ¨¡æ‹Ÿæ­£å¸¸å®¢æˆ·ç«¯çš„è¿æ¥:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --connect-timeout è¡¨ç¤ºè¿æ¥è¶…æ—¶æ—¶é—´")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Http code: %{http_code}\\nTotal time:%{time_total}s\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /dev/null --connect-timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" http://192.168.0.30\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHttp code: 000\nTotal time:10.001s\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Connection timed out after "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" milliseconds\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("å¯ä»¥å‘ç°, åœ¨ç»ˆç«¯ä¸‰ä¸­, æ­£å¸¸å®¢æˆ·ç«¯çš„è¿æ¥è¶…æ—¶äº†, å¹¶æ²¡æœ‰æ”¶åˆ° Nginx æœåŠ¡çš„å“åº”.")]),s._v(" "),a("p",[s._v("è¿™æ˜¯å‘ç”Ÿäº†ä»€ä¹ˆé—®é¢˜å‘¢? å†å›åˆ°ç»ˆç«¯ä¸€ä¸­, æ£€æŸ¥ç½‘ç»œçŠ¶å†µ. åº”è¯¥è¿˜è®°å¾—å¤šæ¬¡ç”¨è¿‡çš„ sar, å®ƒæ—¢å¯ä»¥è§‚å¯Ÿ PPS(æ¯ç§’æ”¶å‘çš„æŠ¥æ–‡æ•°), è¿˜å¯ä»¥è§‚å¯Ÿ BPS(æ¯ç§’æ”¶å‘çš„å­—èŠ‚æ•°).")]),s._v(" "),a("p",[s._v("å¯ä»¥å›åˆ°ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ sar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" DEV "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n08:55:49        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil\n08:55:50      docker0      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n08:55:50         eth0  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22274.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("629.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1174.64")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37.78")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v("\n08:55:50           lo      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä»è¿™æ¬¡ sar çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, ç½‘ç»œæ¥æ”¶çš„ PPS å·²ç»è¾¾åˆ°äº† 20000 å¤š, ä½†æ˜¯ BPS å´åªæœ‰ 1174 kB, è¿™æ ·æ¯ä¸ªåŒ…çš„å¤§å°å°±åªæœ‰ 54B(1174*1024/22274=54).")]),s._v(" "),a("p",[s._v("è¿™æ˜æ˜¾å°±æ˜¯ä¸ªå°åŒ…äº†, ä¸è¿‡å…·ä½“æ˜¯ä¸ªä»€ä¹ˆæ ·çš„åŒ…å‘¢? é‚£å°±ç”¨ tcpdump æŠ“åŒ…çœ‹çœ‹å§.")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„ tcpdump å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i eth0 åªæŠ“å– eth0 ç½‘å¡, -n ä¸è§£æåè®®åå’Œä¸»æœºå")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcp port 80 è¡¨ç¤ºåªæŠ“å– tcp åè®®å¹¶ä¸”ç«¯å£å·ä¸º 80 çš„ç½‘ç»œå¸§")]),s._v("\n$ tcpdump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" eth0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" tcp port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n09:15:48.287047 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2.27095 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1288268370")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n09:15:48.287050 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2.27131 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2084255254")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n09:15:48.287052 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2.27116 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("677393791")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n09:15:48.287055 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2.27141 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1276451587")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n09:15:48.287068 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2.27154 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1851495339")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè¾“å‡ºä¸­, Flags [S] è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª SYN åŒ…. "),a("strong",[s._v("å¤§é‡çš„ SYN åŒ…è¡¨æ˜, è¿™æ˜¯ä¸€ä¸ª SYN Flood æ”»å‡»")]),s._v(". å¦‚æœç”¨ä¸Šä¸€èŠ‚è®²è¿‡çš„ Wireshark æ¥è§‚å¯Ÿ, åˆ™å¯ä»¥æ›´ç›´è§‚åœ°çœ‹åˆ° SYN Flood çš„è¿‡ç¨‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/cd8e2219635c6d55cb2db851bbcaeaa8-20230731161933-lohxa9t.png",alt:""}})]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, "),a("strong",[s._v("SYN Flood æ­£æ˜¯äº’è”ç½‘ä¸­æœ€ç»å…¸çš„ DDoS æ”»å‡»æ–¹å¼")]),s._v(". ä»ä¸Šé¢è¿™ä¸ªå›¾, ä¹Ÿå¯ä»¥çœ‹åˆ°å®ƒçš„åŸç†:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å³å®¢æˆ·ç«¯æ„é€ å¤§é‡çš„ SYN åŒ…, è¯·æ±‚å»ºç«‹ TCP è¿æ¥")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("è€ŒæœåŠ¡å™¨æ”¶åˆ°åŒ…å, ä¼šå‘æº IP å‘é€ SYN+ACK æŠ¥æ–‡, å¹¶ç­‰å¾…ä¸‰æ¬¡æ¡æ‰‹çš„æœ€åä¸€æ¬¡ ACK æŠ¥æ–‡, ç›´åˆ°è¶…æ—¶")]),s._v(".")])]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("è¿™ç§ç­‰å¾…çŠ¶æ€çš„ TCP è¿æ¥, é€šå¸¸ä¹Ÿç§°ä¸ºåŠå¼€è¿æ¥. ç”±äºè¿æ¥è¡¨çš„å¤§å°æœ‰é™, å¤§é‡çš„åŠå¼€è¿æ¥å°±ä¼šå¯¼è‡´è¿æ¥è¡¨è¿…é€Ÿå æ»¡, ä»è€Œæ— æ³•å»ºç«‹æ–°çš„ TCP è¿æ¥")])]),s._v(".")]),s._v(" "),a("p",[s._v("å‚è€ƒä¸‹é¢è¿™å¼  TCP çŠ¶æ€å›¾èƒ½çœ‹åˆ°, æ­¤æ—¶æœåŠ¡å™¨ç«¯çš„ TCP è¿æ¥, ä¼šå¤„äº SYN_RECEIVED çŠ¶æ€:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/924a9bc699f3e746803cd71a1b5f2f8d-20230731161933-tf4ybiz.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™å…¶å®æç¤ºäº†æˆ‘ä»¬, æŸ¥çœ‹ TCP åŠå¼€è¿æ¥çš„æ–¹æ³•, å…³é”®åœ¨äº SYN_RECEIVED çŠ¶æ€çš„è¿æ¥. "),a("strong",[s._v("å¯ä»¥ä½¿ç”¨ netstat æ¥æŸ¥çœ‹æ‰€æœ‰è¿æ¥çš„çŠ¶æ€, ä¸è¿‡è¦æ³¨æ„, SYN_REVEIVED çš„çŠ¶æ€, é€šå¸¸è¢«ç¼©å†™ä¸º SYN_RECV")]),s._v(".")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„ netstat å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -n è¡¨ç¤ºä¸è§£æåå­—, -p è¡¨ç¤ºæ˜¾ç¤ºè¿æ¥æ‰€å±è¿›ç¨‹")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" SYN_REC\ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30:80          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2:12503      SYN_RECV    -\ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30:80          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2:13502      SYN_RECV    -\ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30:80          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2:15256      SYN_RECV    -\ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30:80          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2:18117      SYN_RECV    -\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä»ç»“æœä¸­, å¯ä»¥å‘ç°å¤§é‡ SYN_RECV çŠ¶æ€çš„è¿æ¥, å¹¶ä¸”æº IP åœ°å€ä¸º 192.168.0.2.")]),s._v(" "),a("p",[s._v("è¿›ä¸€æ­¥è¿˜å¯ä»¥é€šè¿‡ wc å·¥å…·, æ¥ç»Ÿè®¡æ‰€æœ‰ SYN_RECV çŠ¶æ€çš„è¿æ¥æ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" SYN_REC "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ‰¾å‡ºæº IP å, è¦è§£å†³ SYN æ”»å‡»çš„é—®é¢˜, åªè¦"),a("strong",[s._v("ä¸¢æ‰ç›¸å…³çš„åŒ…")]),s._v("å°±å¯ä»¥. è¿™æ—¶, iptables å¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡. å¯ä»¥åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„ iptables å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ iptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-I")]),s._v(" INPUT "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" REJECT\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶åå›åˆ°ç»ˆç«¯ä¸‰ä¸­, å†æ¬¡æ‰§è¡Œ curl å‘½ä»¤, æŸ¥çœ‹æ­£å¸¸ç”¨æˆ·è®¿é—® Nginx çš„æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Http code: %{http_code}\\nTotal time:%{time_total}s\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /dev/null --connect-timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" http://192.168.0.30\nHttp code: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\nTotal time:1.572171s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("å¯ä»¥å‘ç°, æ­£å¸¸ç”¨æˆ·ä¹Ÿå¯ä»¥è®¿é—® Nginx äº†, åªæ˜¯å“åº”æ¯”è¾ƒæ…¢, ä»åŸæ¥çš„ 2ms å˜æˆäº†ç°åœ¨çš„ 1.5s.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ä¸€èˆ¬æ¥è¯´, SYN Flood æ”»å‡»ä¸­çš„æº IP å¹¶ä¸æ˜¯å›ºå®šçš„. æ¯”å¦‚å¯ä»¥åœ¨ hping3 å‘½ä»¤ä¸­, åŠ å…¥ "),a("code",[s._v("--rand-source")]),s._v("â€‹ é€‰é¡¹, æ¥éšæœºåŒ–æº IP. ä¸è¿‡, è¿™æ—¶åˆšæ‰çš„æ–¹æ³•å°±ä¸é€‚ç”¨äº†.")]),s._v(" "),a("p",[s._v("å¹¸å¥½, è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ–¹æ³•, å®ç°ç±»ä¼¼çš„ç›®æ ‡. æ¯”å¦‚å¯ä»¥ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•, æ¥é™åˆ¶ syn åŒ…çš„é€Ÿç‡:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é™åˆ¶ syn å¹¶å‘æ•°ä¸ºæ¯ç§’ 1 æ¬¡")]),s._v("\n$ iptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" INPUT "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--syn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" limit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--limit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/s "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" ACCEPT\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é™åˆ¶å•ä¸ª IP åœ¨ 60 ç§’æ–°å»ºç«‹çš„è¿æ¥æ•°ä¸º 10")]),s._v("\n$ iptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-I")]),s._v(" INPUT "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dport")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--syn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" recent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" SYN_FLOOD "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--update")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--seconds")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--hitcount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" REJECT\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("åˆ°è¿™é‡Œå·²ç»åˆæ­¥é™åˆ¶äº† SYN Flood æ”»å‡». ä¸è¿‡è¿™è¿˜ä¸å¤Ÿ, å› ä¸ºæ¡ˆä¾‹è¿˜åªæ˜¯å•ä¸ªçš„æ”»å‡»æº.")]),s._v(" "),a("p",[s._v("å¦‚æœæ˜¯å¤šå°æœºå™¨åŒæ—¶å‘é€ SYN Flood, è¿™ç§æ–¹æ³•å¯èƒ½å°±ç›´æ¥æ— æ•ˆäº†. å› ä¸ºå¾ˆå¯èƒ½æ— æ³• SSH ç™»å½•(SSH ä¹Ÿæ˜¯åŸºäº TCP çš„)åˆ°æœºå™¨ä¸Šå», æ›´åˆ«ææ‰§è¡Œä¸Šè¿°æ‰€æœ‰çš„æ’æŸ¥å‘½ä»¤.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, è¿™è¿˜éœ€è¦"),a("strong",[s._v("äº‹å…ˆå¯¹ç³»ç»Ÿåšä¸€äº› TCP ä¼˜åŒ–")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, SYN Flood ä¼šå¯¼è‡´ SYN_RECV çŠ¶æ€çš„è¿æ¥æ€¥å‰§å¢å¤§. åœ¨ä¸Šé¢çš„ netstat å‘½ä»¤ä¸­, ä¹Ÿå¯ä»¥çœ‹åˆ° 190 å¤šä¸ªå¤„äºåŠå¼€çŠ¶æ€çš„è¿æ¥.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, åŠå¼€çŠ¶æ€çš„è¿æ¥æ•°æ˜¯æœ‰é™åˆ¶çš„, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥çœ‹åˆ°, é»˜è®¤çš„åŠè¿æ¥å®¹é‡åªæœ‰ 256:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.ipv4.tcp_max_syn_backlog\nnet.ipv4.tcp_max_syn_backlog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¢å¥è¯è¯´, SYN åŒ…æ•°å†ç¨å¾®å¢å¤§ä¸€äº›, å°±ä¸èƒ½ SSH ç™»å½•æœºå™¨äº†. æ‰€ä»¥, è¿˜åº”è¯¥"),a("strong",[s._v("å¢å¤§åŠè¿æ¥çš„å®¹é‡")]),s._v(", æ¯”å¦‚å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤, å°†å…¶å¢å¤§ä¸º 1024:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.ipv4.tcp_max_syn_backlog")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\nnet.ipv4.tcp_max_syn_backlog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¦å¤–, è¿æ¥æ¯ä¸ª SYN_RECV æ—¶, å¦‚æœå¤±è´¥çš„è¯, å†…æ ¸è¿˜ä¼šè‡ªåŠ¨é‡è¯•, å¹¶ä¸”é»˜è®¤çš„é‡è¯•æ¬¡æ•°æ˜¯ 5 æ¬¡. å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°†å…¶å‡å°ä¸º 1 æ¬¡:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.ipv4.tcp_synack_retries")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.ipv4.tcp_synack_retries "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("é™¤æ­¤ä¹‹å¤–, "),a("strong",[s._v("TCP SYN Cookies ä¹Ÿæ˜¯ä¸€ç§ä¸“é—¨é˜²å¾¡ SYN Flood æ”»å‡»çš„æ–¹æ³•")]),s._v(". SYN Cookies åŸºäºè¿æ¥ä¿¡æ¯(åŒ…æ‹¬æºåœ°å€, æºç«¯å£, ç›®çš„åœ°å€, ç›®çš„ç«¯å£ç­‰)ä»¥åŠä¸€ä¸ªåŠ å¯†ç§å­(å¦‚ç³»ç»Ÿå¯åŠ¨æ—¶é—´), è®¡ç®—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼(SHA1), è¿™ä¸ªå“ˆå¸Œå€¼ç§°ä¸º cookie.")]),s._v(" "),a("p",[s._v("ç„¶å, è¿™ä¸ª cookie å°±è¢«ç”¨ä½œåºåˆ—å·, æ¥åº”ç­” SYN+ACK åŒ…, å¹¶é‡Šæ”¾è¿æ¥çŠ¶æ€. å½“å®¢æˆ·ç«¯å‘é€å®Œä¸‰æ¬¡æ¡æ‰‹çš„æœ€åä¸€æ¬¡ ACK å, æœåŠ¡å™¨å°±ä¼šå†æ¬¡è®¡ç®—è¿™ä¸ªå“ˆå¸Œå€¼, ç¡®è®¤æ˜¯ä¸Šæ¬¡è¿”å›çš„ SYN+ACK çš„è¿”å›åŒ…, æ‰ä¼šè¿›å…¥ TCP çš„è¿æ¥çŠ¶æ€.")]),s._v(" "),a("p",[a("strong",[s._v("å› è€Œ, å¼€å¯ SYN Cookies å, å°±ä¸éœ€è¦ç»´æŠ¤åŠå¼€è¿æ¥çŠ¶æ€äº†, è¿›è€Œä¹Ÿå°±æ²¡æœ‰äº†åŠè¿æ¥æ•°çš„é™åˆ¶")]),s._v(".")]),s._v(" "),a("p",[s._v("æ³¨æ„, å¼€å¯ TCP syncookies å, å†…æ ¸é€‰é¡¹ net.ipv4.tcp_max_syn_backlog ä¹Ÿå°±æ— æ•ˆäº†.")]),s._v(" "),a("p",[s._v("å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤, å¼€å¯ TCP SYN Cookies:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.ipv4.tcp_syncookies")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.ipv4.tcp_syncookies "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ³¨æ„, ä¸Šè¿° sysctl å‘½ä»¤ä¿®æ”¹çš„é…ç½®éƒ½æ˜¯ä¸´æ—¶çš„, é‡å¯åè¿™äº›é…ç½®å°±ä¼šä¸¢å¤±. æ‰€ä»¥ä¸ºäº†ä¿è¯é…ç½®æŒä¹…åŒ–, è¿˜åº”è¯¥æŠŠè¿™äº›é…ç½®, å†™å…¥ "),a("code",[s._v("/etc/sysctl.conf")]),s._v("â€‹ æ–‡ä»¶ä¸­. æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/sysctl.conf\nnet.ipv4.tcp_syncookies "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.ipv4.tcp_synack_retries "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.ipv4.tcp_max_syn_backlog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä¸è¿‡è¦è®°å¾—, å†™å…¥ "),a("code",[s._v("/etc/sysctl.conf")]),s._v("â€‹ çš„é…ç½®, éœ€è¦æ‰§è¡Œ sysctl -p å‘½ä»¤å, æ‰ä¼šåŠ¨æ€ç”Ÿæ•ˆ.")]),s._v(" "),a("h5",{attrs:{id:"_4-ddosåˆ°åº•è¯¥æ€ä¹ˆé˜²å¾¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ddosåˆ°åº•è¯¥æ€ä¹ˆé˜²å¾¡"}},[s._v("#")]),s._v(" 4.DDoSåˆ°åº•è¯¥æ€ä¹ˆé˜²å¾¡")]),s._v(" "),a("p",[s._v('æœ¬èŠ‚çš„ä¸»é¢˜æ˜¯"ç¼“è§£", è€Œä¸æ˜¯"è§£å†³" DDoS é—®é¢˜. '),a("strong",[s._v("ä¸ºä»€ä¹ˆä¸æ˜¯è§£å†³ DDoS, è€Œåªæ˜¯ç¼“è§£å‘¢")]),s._v("? è€Œä¸”æ¡ˆä¾‹ä¸­çš„æ–¹æ³•, ä¹Ÿåªæ˜¯è®© Nginx æœåŠ¡è®¿é—®ä¸å†è¶…æ—¶, ä½†è®¿é—®å»¶è¿Ÿè¿˜æ˜¯æ¯”ä¸€å¼€å§‹æ—¶çš„ 2ms å¤§å¾—å¤š.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, å½“ DDoS æŠ¥æ–‡åˆ°è¾¾æœåŠ¡å™¨å, Linux æä¾›çš„æœºåˆ¶åªèƒ½ç¼“è§£, è€Œæ— æ³•å½»åº•è§£å†³. å³ä½¿åƒæ˜¯ SYN Flood è¿™æ ·çš„å°åŒ…æ”»å‡», å…¶å·¨å¤§çš„ PPS, ä¹Ÿä¼šå¯¼è‡´ Linux å†…æ ¸æ¶ˆè€—å¤§é‡èµ„æº, è¿›è€Œå¯¼è‡´å…¶ä»–ç½‘ç»œæŠ¥æ–‡çš„å¤„ç†ç¼“æ…¢.")]),s._v(" "),a("p",[s._v("è™½ç„¶å¯ä»¥è°ƒæ•´å†…æ ¸å‚æ•°, ç¼“è§£ DDoS å¸¦æ¥çš„æ€§èƒ½é—®é¢˜, å´ä¹Ÿä¼šåƒæ¡ˆä¾‹è¿™æ ·, æ— æ³•å½»åº•è§£å†³å®ƒ.")]),s._v(" "),a("p",[s._v("åœ¨ä¹‹å‰çš„ C10K, C100K æ–‡ç« ä¸­, ä¹Ÿæåˆ°è¿‡, Linux å†…æ ¸ä¸­å†—é•¿çš„åè®®æ ˆ, åœ¨ PPS å¾ˆå¤§æ—¶, å°±æ˜¯ä¸€ä¸ªå·¨å¤§çš„è´Ÿæ‹…. å¯¹ DDoS æ”»å‡»æ¥è¯´, ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†. æ‰€ä»¥, å½“æ—¶æåˆ°çš„ C10M çš„æ–¹æ³•, ç”¨åˆ°è¿™é‡ŒåŒæ ·é€‚åˆ. æ¯”å¦‚å¯ä»¥åŸºäº XDP æˆ–è€… DPDK, æ„å»º DDoS æ–¹æ¡ˆ, åœ¨å†…æ ¸ç½‘ç»œåè®®æ ˆå‰, æˆ–è€…è·³è¿‡å†…æ ¸åè®®æ ˆ, æ¥è¯†åˆ«å¹¶ä¸¢å¼ƒ DDoS æŠ¥æ–‡, é¿å… DDoS å¯¹ç³»ç»Ÿå…¶ä»–èµ„æºçš„æ¶ˆè€—.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, å¯¹äºæµé‡å‹çš„ DDoS æ¥è¯´, å½“æœåŠ¡å™¨çš„å¸¦å®½è¢«è€—å°½å, åœ¨æœåŠ¡å™¨å†…éƒ¨å¤„ç†å°±æ— èƒ½ä¸ºåŠ›äº†. è¿™æ—¶, "),a("strong",[s._v("åªèƒ½åœ¨æœåŠ¡å™¨å¤–éƒ¨çš„ç½‘ç»œè®¾å¤‡ä¸­, è®¾æ³•è¯†åˆ«å¹¶é˜»æ–­æµé‡(å½“ç„¶å‰ææ˜¯ç½‘ç»œè®¾å¤‡è¦èƒ½æ‰›ä½æµé‡æ”»å‡»)")]),s._v(" . æ¯”å¦‚, è´­ç½®ä¸“ä¸šçš„å…¥ä¾µæ£€æµ‹å’Œé˜²å¾¡è®¾å¤‡, é…ç½®æµé‡æ¸…æ´—è®¾å¤‡é˜»æ–­æ¶æ„æµé‡ç­‰.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶ DDoS è¿™ä¹ˆéš¾é˜²å¾¡, è¿™æ˜¯ä¸æ˜¯è¯´æ˜, Linux æœåŠ¡å™¨å†…éƒ¨å‹æ ¹å„¿å°±ä¸å…³æ³¨è¿™ä¸€ç‚¹, è€Œæ˜¯å…¨éƒ¨äº¤ç»™ä¸“ä¸šçš„ç½‘ç»œè®¾å¤‡æ¥å¤„ç†å‘¢?")]),s._v(" "),a("p",[s._v("å½“ç„¶ä¸æ˜¯, å› ä¸º DDoS å¹¶ä¸ä¸€å®šæ˜¯å› ä¸ºå¤§æµé‡æˆ–è€…å¤§ PPS, æœ‰æ—¶å€™æ…¢é€Ÿçš„è¯·æ±‚ä¹Ÿä¼šå¸¦æ¥å·¨å¤§çš„æ€§èƒ½ä¸‹é™(è¿™ç§æƒ…å†µç§°ä¸ºæ…¢é€Ÿ DDoS). æ¯”å¦‚, å¾ˆå¤šé’ˆå¯¹åº”ç”¨ç¨‹åºçš„æ”»å‡», éƒ½ä¼šä¼ªè£…æˆæ­£å¸¸ç”¨æˆ·æ¥è¯·æ±‚èµ„æº. è¿™ç§æƒ…å†µä¸‹, è¯·æ±‚æµé‡å¯èƒ½æœ¬èº«å¹¶ä¸å¤§, ä½†å“åº”æµé‡å´å¯èƒ½å¾ˆå¤§, å¹¶ä¸”åº”ç”¨ç¨‹åºå†…éƒ¨ä¹Ÿå¾ˆå¯èƒ½è¦è€—è´¹å¤§é‡èµ„æºå¤„ç†. è¿™æ—¶å°±éœ€è¦åº”ç”¨ç¨‹åºè€ƒè™‘è¯†åˆ«, å¹¶å°½æ—©æ‹’ç»æ‰è¿™äº›æ¶æ„æµé‡, æ¯”å¦‚åˆç†åˆ©ç”¨ç¼“å­˜, å¢åŠ  WAF(Web Application Firewall), ä½¿ç”¨ CDN ç­‰ç­‰.")]),s._v(" "),a("h5",{attrs:{id:"_5-å°ç»“-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-å°ç»“-9"}},[s._v("#")]),s._v(" 5.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å­¦ä¹ äº†åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡(DDoS)æ—¶çš„ç¼“è§£æ–¹æ³•. DDoS åˆ©ç”¨å¤§é‡çš„ä¼ªé€ è¯·æ±‚, ä½¿ç›®æ ‡æœåŠ¡è€—è´¹å¤§é‡èµ„æº, æ¥å¤„ç†è¿™äº›æ— æ•ˆè¯·æ±‚, è¿›è€Œæ— æ³•æ­£å¸¸å“åº”æ­£å¸¸çš„ç”¨æˆ·è¯·æ±‚.")]),s._v(" "),a("p",[s._v("ç”±äº DDoS çš„åˆ†å¸ƒå¼, å¤§æµé‡, éš¾è¿½è¸ªç­‰ç‰¹ç‚¹, ç›®å‰è¿˜æ²¡æœ‰æ–¹æ³•å¯ä»¥å®Œå…¨é˜²å¾¡ DDoS å¸¦æ¥çš„é—®é¢˜, åªèƒ½è®¾æ³•ç¼“è§£è¿™ä¸ªå½±å“. æ¯”å¦‚å¯ä»¥è´­ä¹°ä¸“ä¸šçš„æµé‡æ¸…æ´—è®¾å¤‡å’Œç½‘ç»œé˜²ç«å¢™, åœ¨ç½‘ç»œå…¥å£å¤„é˜»æ–­æ¶æ„æµé‡, åªä¿ç•™æ­£å¸¸æµé‡è¿›å…¥æ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨ä¸­.")]),s._v(" "),a("p",[s._v("åœ¨ Linux æœåŠ¡å™¨ä¸­, å¯ä»¥é€šè¿‡å†…æ ¸è°ƒä¼˜, DPDK, XDP ç­‰å¤šç§æ–¹æ³•, æ¥å¢å¤§æœåŠ¡å™¨çš„æŠ—æ”»å‡»èƒ½åŠ›, é™ä½ DDoS å¯¹æ­£å¸¸æœåŠ¡çš„å½±å“. è€Œåœ¨åº”ç”¨ç¨‹åºä¸­, å¯ä»¥åˆ©ç”¨å„çº§ç¼“å­˜, WAF, CDN ç­‰æ–¹å¼, ç¼“è§£ DDoS å¯¹åº”ç”¨ç¨‹åºçš„å½±å“.")]),s._v(" "),a("h4",{attrs:{id:"_40-æ¡ˆä¾‹ç¯‡-ç½‘ç»œè¯·æ±‚å»¶è¿Ÿå˜å¤§äº†è¯¥æ€ä¹ˆåŠ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_40-æ¡ˆä¾‹ç¯‡-ç½‘ç»œè¯·æ±‚å»¶è¿Ÿå˜å¤§äº†è¯¥æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 40-æ¡ˆä¾‹ç¯‡:ç½‘ç»œè¯·æ±‚å»¶è¿Ÿå˜å¤§äº†è¯¥æ€ä¹ˆåŠ?")]),s._v(" "),a("p",[s._v("è¿˜æœ‰ä¸å°‘å…¶ä»–åŸå› å¯¼è‡´çš„ç½‘ç»œå»¶è¿Ÿ, æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç½‘ç»œä¼ è¾“æ…¢")]),s._v(", å¯¼è‡´å»¶è¿Ÿ;")]),s._v(" "),a("li",[a("strong",[s._v("Linux å†…æ ¸åè®®æ ˆæŠ¥æ–‡å¤„ç†æ…¢")]),s._v(", å¯¼è‡´å»¶è¿Ÿ;")]),s._v(" "),a("li",[a("strong",[s._v("åº”ç”¨ç¨‹åºæ•°æ®å¤„ç†æ…¢")]),s._v(", å¯¼è‡´å»¶è¿Ÿç­‰ç­‰.")])]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, å½“ç¢°åˆ°è¿™äº›åŸå› çš„å»¶è¿Ÿæ—¶è¯¥æ€ä¹ˆåŠå‘¢? åˆè¯¥å¦‚ä½•å®šä½ç½‘ç»œå»¶è¿Ÿçš„æ ¹æºå‘¢?")]),s._v(" "),a("h5",{attrs:{id:"_1-ç½‘ç»œå»¶è¿Ÿ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç½‘ç»œå»¶è¿Ÿ"}},[s._v("#")]),s._v(" 1.ç½‘ç»œå»¶è¿Ÿ")]),s._v(" "),a("p",[s._v("æåˆ°"),a("strong",[s._v("ç½‘ç»œå»¶è¿Ÿ")]),s._v("æ—¶, ä½ å¯èƒ½è½»æ¾æƒ³èµ·å®ƒçš„å«ä¹‰--"),a("strong",[s._v("ç½‘ç»œæ•°æ®ä¼ è¾“æ‰€ç”¨çš„æ—¶é—´")]),s._v(". ä¸è¿‡è¦æ³¨æ„, è¿™ä¸ªæ—¶é—´å¯èƒ½æ˜¯å•å‘çš„, æŒ‡ä»æºåœ°å€å‘é€åˆ°ç›®çš„åœ°å€çš„å•ç¨‹æ—¶é—´; ä¹Ÿå¯èƒ½æ˜¯åŒå‘çš„, å³ä»æºåœ°å€å‘é€åˆ°ç›®çš„åœ°å€, ç„¶ååˆä»ç›®çš„åœ°å€å‘å›å“åº”, è¿™ä¸ªå¾€è¿”å…¨ç¨‹æ‰€ç”¨çš„æ—¶é—´.")]),s._v(" "),a("p",[s._v("é€šå¸¸æ›´å¸¸ç”¨çš„æ˜¯åŒå‘çš„å¾€è¿”é€šä¿¡å»¶è¿Ÿ, æ¯”å¦‚ ping æµ‹è¯•çš„ç»“æœ, å°±æ˜¯"),a("strong",[s._v("å¾€è¿”å»¶æ—¶ RTT(Round-Trip Time)")]),s._v(" .")]),s._v(" "),a("p",[s._v("é™¤äº†ç½‘ç»œå»¶è¿Ÿå¤–, å¦ä¸€ä¸ªå¸¸ç”¨çš„æŒ‡æ ‡æ˜¯"),a("strong",[s._v("åº”ç”¨ç¨‹åºå»¶è¿Ÿ")]),s._v(", å®ƒæ˜¯æŒ‡ä»åº”ç”¨ç¨‹åºæ¥æ”¶åˆ°è¯·æ±‚, å†åˆ°å‘å›å“åº”, å…¨ç¨‹æ‰€ç”¨çš„æ—¶é—´. é€šå¸¸, åº”ç”¨ç¨‹åºå»¶è¿Ÿä¹ŸæŒ‡çš„æ˜¯å¾€è¿”å»¶è¿Ÿ, æ˜¯ç½‘ç»œæ•°æ®ä¼ è¾“æ—¶é—´åŠ ä¸Šæ•°æ®å¤„ç†æ—¶é—´çš„å’Œ.")]),s._v(" "),a("p",[s._v("å¯ä»¥ç”¨ ping æ¥æµ‹è¯•ç½‘ç»œå»¶è¿Ÿ. ping åŸºäº ICMP åè®®, å®ƒé€šè¿‡è®¡ç®— ICMP å›æ˜¾å“åº”æŠ¥æ–‡ä¸ ICMP å›æ˜¾è¯·æ±‚æŠ¥æ–‡çš„æ—¶é—´å·®, æ¥è·å¾—å¾€è¿”å»¶æ—¶. è¿™ä¸ªè¿‡ç¨‹å¹¶ä¸éœ€è¦ç‰¹æ®Šè®¤è¯, å¸¸è¢«å¾ˆå¤šç½‘ç»œæ”»å‡»åˆ©ç”¨, æ¯”å¦‚ç«¯å£æ‰«æå·¥å…· nmap, ç»„åŒ…å·¥å…· hping3 ç­‰ç­‰.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ä¸ºäº†é¿å…è¿™äº›é—®é¢˜, å¾ˆå¤šç½‘ç»œæœåŠ¡ä¼š"),a("strong",[s._v("æŠŠ ICMP ç¦æ­¢æ‰")]),s._v(", è¿™ä¹Ÿå°±å¯¼è‡´æ— æ³•ç”¨ ping æ¥æµ‹è¯•ç½‘ç»œæœåŠ¡çš„å¯ç”¨æ€§å’Œå¾€è¿”å»¶æ—¶. è¿™æ—¶å¯ä»¥"),a("strong",[s._v("ç”¨ traceroute æˆ– hping3 çš„ TCP å’Œ UDP æ¨¡å¼, æ¥è·å–ç½‘ç»œå»¶è¿Ÿ")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä»¥ baidu.com ä¸ºä¾‹, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„ hping3 å‘½ä»¤, æµ‹è¯•æœºå™¨åˆ°ç™¾åº¦æœç´¢æœåŠ¡å™¨çš„ç½‘ç»œå»¶è¿Ÿ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c è¡¨ç¤ºå‘é€ 3 æ¬¡è¯·æ±‚, -S è¡¨ç¤ºè®¾ç½® TCP SYN, -p è¡¨ç¤ºç«¯å£å·ä¸º 80")]),s._v("\n$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" baidu.com\nHPING baidu.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eth0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.125")]),s._v(".115.110"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": S set, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" headers + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.125")]),s._v(".115.110 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47908")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.9")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.125")]),s._v(".115.110 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6788")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.9")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.125")]),s._v(".115.110 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37699")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.9")]),s._v(" ms\n \n--- baidu.com hping statistic ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.9")]),s._v("/20.9/20.9 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("ä» hping3 çš„ç»“æœä¸­å¯ä»¥çœ‹åˆ°, å¾€è¿”å»¶è¿Ÿ RTT ä¸º 20.9ms.")]),s._v(" "),a("p",[s._v("å½“ç„¶, ç”¨ traceroute, ä¹Ÿå¯ä»¥å¾—åˆ°ç±»ä¼¼ç»“æœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --tcp è¡¨ç¤ºä½¿ç”¨ TCP åè®®, -p è¡¨ç¤ºç«¯å£å·, -n è¡¨ç¤ºä¸å¯¹ç»“æœä¸­çš„ IP åœ°å€æ‰§è¡Œåå‘åŸŸåè§£æ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("traceroute")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tcp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" baidu.com\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("traceroute")]),s._v(" to baidu.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.125")]),s._v(".115.110"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" hops max, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" byte packets\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  * * *\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  * * *\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  * * *\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("  * * *\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  * * *\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("  * * *\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("  * * *\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("  * * *\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  * * *\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  * * *\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  * * *\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  * * *\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  * * *\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.125")]),s._v(".115.110  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.684")]),s._v(" ms *  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.798")]),s._v(" ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("traceroute ä¼šåœ¨è·¯ç”±çš„"),a("strong",[s._v("æ¯ä¸€è·³å‘é€ä¸‰ä¸ªåŒ…")]),s._v(", å¹¶åœ¨æ”¶åˆ°å“åº”å, è¾“å‡ºå¾€è¿”å»¶æ—¶. å¦‚æœæ— å“åº”æˆ–è€…å“åº”è¶…æ—¶(é»˜è®¤ 5s), å°±ä¼šè¾“å‡ºä¸€ä¸ªæ˜Ÿå·.")]),s._v(" "),a("p",[s._v("çŸ¥é“äº†åŸºäº TCP æµ‹è¯•ç½‘ç»œæœåŠ¡å»¶è¿Ÿçš„æ–¹æ³•å, æ¥ä¸‹æ¥å°±é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹, æ¥å­¦ä¹ "),a("strong",[s._v("ç½‘ç»œå»¶è¿Ÿå‡é«˜æ—¶çš„åˆ†ææ€è·¯")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹å‡†å¤‡-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹å‡†å¤‡-3"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("ä¸‹é¢çš„æ¡ˆä¾‹ä»ç„¶åŸºäº Ubuntu 18.04. æ¡ˆä¾‹ç¯å¢ƒæ˜¯è¿™æ ·çš„:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, hping3, tcpdump, curl, wrk, Wireshark ç­‰å·¥å…·, æ¯”å¦‚ apt-get install docker.io hping3 tcpdump curl.")])]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœº, æˆ‘ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºå®ƒä»¬çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/dff9d8ab6b0f9bcb56c7804198afb5ba-20230731161933-0ay43y0.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_3-æ¡ˆä¾‹åˆ†æ-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¡ˆä¾‹åˆ†æ-3"}},[s._v("#")]),s._v(" 3.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("ä¸ºäº†å¯¹æ¯”å¾—å‡ºå»¶è¿Ÿå¢å¤§çš„å½±å“, é¦–å…ˆæ¥è¿è¡Œä¸€ä¸ªæœ€ç®€å•çš„ Nginx, ä¹Ÿå°±æ˜¯ç”¨å®˜æ–¹çš„ Nginx é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨. åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, è¿è¡Œå®˜æ–¹ Nginx, å®ƒä¼šåœ¨ 80 ç«¯å£ç›‘å¬:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("good "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" nginx\nfb4ed7cb9177d10e270f8320a7fb64717eac3451114c9fab3c50e02be2e88ba2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, è¿è¡Œæ¡ˆä¾‹åº”ç”¨, å®ƒä¼šç›‘å¬ 8080 ç«¯å£:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx:latency\nb99bd136dcfd907747d9c803fdc0255e578bad6d66f4e9c32b826d75b6812724\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶ååœ¨ç»ˆç«¯äºŒä¸­æ‰§è¡Œ curl å‘½ä»¤, éªŒè¯ä¸¤ä¸ªå®¹å™¨å·²ç»æ­£å¸¸å¯åŠ¨. å¦‚æœä¸€åˆ‡æ­£å¸¸, å°†çœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 80 ç«¯å£æ­£å¸¸")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.30\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Thank you "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using nginx."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 8080 ç«¯å£æ­£å¸¸")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.30:8080\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Thank you "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using nginx."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("æ¥ç€å†ç”¨ä¸Šé¢æåˆ°çš„ hping3 æ¥æµ‹è¯•å®ƒä»¬çš„å»¶è¿Ÿ, çœ‹çœ‹æœ‰ä»€ä¹ˆåŒºåˆ«. è¿˜æ˜¯åœ¨ç»ˆç«¯äºŒ, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, åˆ†åˆ«æµ‹è¯•æ¡ˆä¾‹æœºå™¨ 80 ç«¯å£å’Œ 8080 ç«¯å£çš„å»¶è¿Ÿ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æµ‹è¯• 80 ç«¯å£å»¶è¿Ÿ")]),s._v("\n$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\nHPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eth0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": S set, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" headers + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.8")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.7")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.6")]),s._v(" ms\n \n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 hping statistic ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.6")]),s._v("/7.7/7.8 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æµ‹è¯• 8080 ç«¯å£å»¶è¿Ÿ")]),s._v("\n$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\nHPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eth0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": S set, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" headers + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.7")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.6")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.3")]),s._v(" ms\n \n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 hping statistic ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.3")]),s._v("/7.6/7.7 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("ä»è¿™ä¸ªè¾“å‡ºå¯ä»¥çœ‹åˆ°, ä¸¤ä¸ªç«¯å£çš„å»¶è¿Ÿå·®ä¸å¤š, éƒ½æ˜¯ 7ms. ä¸è¿‡è¿™åªæ˜¯å•ä¸ªè¯·æ±‚çš„æƒ…å†µ. æ¢æˆå¹¶å‘è¯·æ±‚çš„è¯, åˆä¼šæ€ä¹ˆæ ·å‘¢? æ¥ä¸‹æ¥å°±ç”¨ wrk è¯•è¯•.")]),s._v(" "),a("p",[s._v("è¿™æ¬¡åœ¨ç»ˆç«¯äºŒä¸­, æ‰§è¡Œä¸‹é¢çš„æ–°å‘½ä»¤, åˆ†åˆ«æµ‹è¯•æ¡ˆä¾‹æœºå™¨å¹¶å‘ 100 æ—¶, 80 ç«¯å£å’Œ 8080 ç«¯å£çš„æ€§èƒ½:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æµ‹è¯• 80 ç«¯å£æ€§èƒ½")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wrk --latency -c 100 -t 2 --timeout 2 http://192.168.0.30/")]),s._v("\nRunning 10s "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" @ http://192.168.0.30/\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" threads and "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".19ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".32ms "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("319")]),s._v(".61ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.80")]),s._v("%\n    Req/Sec     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".20k   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("426.80")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".25k    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85.50")]),s._v("%\n  Latency Distribution\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".78ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".22ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".14ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(".53ms\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123558")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".01s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(".15MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\nRequests/sec:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12340.91")]),s._v("\nTransfer/sec:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".00MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æµ‹è¯• 8080 ç«¯å£æ€§èƒ½")]),s._v("\n$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http://192.168.0.30:8080/\nRunning 10s "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" @ http://192.168.0.30:8080/\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" threads and "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(".60ms    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".41ms  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(".58ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.06")]),s._v("%\n    Req/Sec     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".15k   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120.29")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".92k    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88.50")]),s._v("%\n  Latency Distribution\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(".02ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(".33ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(".62ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(".88ms\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22853")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".01s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(".55MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\nRequests/sec:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2283.31")]),s._v("\nTransfer/sec:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".85MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("ä»ä¸Šé¢ä¸¤ä¸ªè¾“å‡ºå¯ä»¥çœ‹åˆ°, å®˜æ–¹ Nginx(ç›‘å¬åœ¨ 80 ç«¯å£)çš„å¹³å‡å»¶è¿Ÿæ˜¯ 9.19ms, è€Œæ¡ˆä¾‹ Nginx çš„å¹³å‡å»¶è¿Ÿ(ç›‘å¬åœ¨ 8080 ç«¯å£)åˆ™æ˜¯ 43.6ms. ä»å»¶è¿Ÿçš„åˆ†å¸ƒä¸Šæ¥çœ‹, å®˜æ–¹ Nginx 90% çš„è¯·æ±‚, éƒ½å¯ä»¥åœ¨ 9ms ä»¥å†…å®Œæˆ; è€Œæ¡ˆä¾‹ Nginx 50% çš„è¯·æ±‚, å°±å·²ç»è¾¾åˆ°äº† 44 ms.")]),s._v(" "),a("p",[s._v("å†ç»“åˆä¸Šé¢ hping3 çš„è¾“å‡º, å¾ˆå®¹æ˜“å‘ç°, æ¡ˆä¾‹ Nginx åœ¨å¹¶å‘è¯·æ±‚ä¸‹çš„å»¶è¿Ÿå¢å¤§äº†å¾ˆå¤š, è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢?")]),s._v(" "),a("p",[s._v("åˆ†ææ–¹æ³•æˆ‘æƒ³ä½ å·²ç»æƒ³åˆ°äº†, ä¸ŠèŠ‚è¯¾å­¦è¿‡çš„, "),a("strong",[s._v("ä½¿ç”¨ tcpdump æŠ“å–æ”¶å‘çš„ç½‘ç»œåŒ…, åˆ†æç½‘ç»œçš„æ”¶å‘è¿‡ç¨‹æœ‰æ²¡æœ‰é—®é¢˜")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„ tcpdump å‘½ä»¤, æŠ“å– 8080 ç«¯å£ä¸Šæ”¶å‘çš„ç½‘ç»œåŒ…, å¹¶ä¿å­˜åˆ° nginx.pcap æ–‡ä»¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ tcpdump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nn")]),s._v(" tcp port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" nginx.pcap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶ååˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, é‡æ–°æ‰§è¡Œ wrk å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æµ‹è¯• 8080 ç«¯å£æ€§èƒ½")]),s._v("\n$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http://192.168.0.30:8080/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å½“ wrk å‘½ä»¤ç»“æŸå, å†æ¬¡åˆ‡æ¢å›ç»ˆç«¯ä¸€, ç»“æŸ tcpdump å‘½ä»¤. å†æŠŠæŠ“å–åˆ°çš„ nginx.pcap, å¤åˆ¶åˆ°è£…æœ‰ Wireshark çš„æœºå™¨ä¸­(å¦‚æœ VM1 å·²ç»å¸¦æœ‰å›¾å½¢ç•Œé¢, é‚£ä¹ˆå¯ä»¥è·³è¿‡å¤åˆ¶æ­¥éª¤), å¹¶ç”¨ Wireshark æ‰“å¼€å®ƒ.")]),s._v(" "),a("p",[s._v('ç”±äºç½‘ç»œåŒ…çš„æ•°é‡æ¯”è¾ƒå¤š, å¯ä»¥å…ˆè¿‡æ»¤ä¸€ä¸‹. æ¯”å¦‚, åœ¨é€‰æ‹©ä¸€ä¸ªåŒ…å, å¯ä»¥å•å‡»å³é”®å¹¶é€‰æ‹© "Follow" -> "TCP Stream", å¦‚ä¸‹å›¾æ‰€ç¤º:')]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/e6fe86d36a068f0b4cddecebd3314a0a-20230731161933-i9mgzgs.png",alt:""}})]),s._v(" "),a("p",[s._v("ç„¶åå…³é—­å¼¹å‡ºæ¥çš„å¯¹è¯æ¡†, å›åˆ° Wireshark ä¸»çª—å£. è¿™æ—¶å€™ä¼šå‘ç° Wireshark å·²ç»è‡ªåŠ¨å¸®ä½ è®¾ç½®äº†ä¸€ä¸ªè¿‡æ»¤è¡¨è¾¾å¼ tcp.stream eq 24. å¦‚ä¸‹å›¾æ‰€ç¤º(å›¾ä¸­çœå»äº†æºå’Œç›®çš„ IP åœ°å€):")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/caf7e26663f78025b64351409dd6902b-20230731161933-mq1meec.png",alt:""}})]),s._v(" "),a("p",[s._v('ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª TCP è¿æ¥ä»ä¸‰æ¬¡æ¡æ‰‹å¼€å§‹çš„æ¯ä¸ªè¯·æ±‚å’Œå“åº”æƒ…å†µ. å½“ç„¶è¿™å¯èƒ½è¿˜ä¸å¤Ÿç›´è§‚, å¯ä»¥ç»§ç»­ç‚¹å‡»èœå•æ é‡Œçš„ Statics -> Flow Graph, é€‰ä¸­ "Limit to display filter" å¹¶è®¾ç½® Flow type ä¸º "TCP Flows":')]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/f2aba6f1196e316a3066f8c01c0888b7-20230731161933-mnr4xqn.png",alt:""}})]),s._v(" "),a("p",[s._v("æ³¨æ„, è¿™ä¸ªå›¾çš„"),a("strong",[s._v("å·¦è¾¹æ˜¯å®¢æˆ·ç«¯, è€Œå³è¾¹æ˜¯ Nginx æœåŠ¡å™¨")]),s._v(". é€šè¿‡è¿™ä¸ªå›¾å°±å¯ä»¥çœ‹å‡º, å‰é¢ä¸‰æ¬¡æ¡æ‰‹, ä»¥åŠç¬¬ä¸€æ¬¡ HTTP è¯·æ±‚å’Œå“åº”è¿˜æ˜¯æŒºå¿«çš„, ä½†"),a("strong",[s._v("ç¬¬äºŒæ¬¡ HTTP è¯·æ±‚å°±æ¯”è¾ƒæ…¢")]),s._v("äº†, ç‰¹åˆ«æ˜¯å®¢æˆ·ç«¯åœ¨æ”¶åˆ°æœåŠ¡å™¨ç¬¬ä¸€ä¸ªåˆ†ç»„å, 40ms åæ‰å‘å‡ºäº† ACK å“åº”(å›¾ä¸­è“è‰²è¡Œ).")]),s._v(" "),a("p",[s._v("çœ‹åˆ° 40ms è¿™ä¸ªå€¼, æœ‰æ²¡æœ‰æƒ³èµ·ä»€ä¹ˆä¸œè¥¿å‘¢? å®é™…ä¸Š, "),a("strong",[s._v("è¿™æ˜¯ TCP å»¶è¿Ÿç¡®è®¤(Delayed ACK)çš„æœ€å°è¶…æ—¶æ—¶é—´")]),s._v(".")]),s._v(" "),a("p",[s._v('è¿™é‡Œè§£é‡Šä¸€ä¸‹å»¶è¿Ÿç¡®è®¤. è¿™æ˜¯é’ˆå¯¹ TCP ACK çš„ä¸€ç§ä¼˜åŒ–æœºåˆ¶, ä¹Ÿå°±æ˜¯è¯´, ä¸ç”¨æ¯æ¬¡è¯·æ±‚éƒ½å‘é€ä¸€ä¸ª ACK, è€Œæ˜¯å…ˆç­‰ä¸€ä¼šå„¿(æ¯”å¦‚ 40ms), çœ‹çœ‹æœ‰æ²¡æœ‰"é¡ºé£è½¦". å¦‚æœè¿™æ®µæ—¶é—´å†…, æ­£å¥½æœ‰å…¶ä»–åŒ…éœ€è¦å‘é€, é‚£å°±æå¸¦ç€ ACK ä¸€èµ·å‘é€è¿‡å». å½“ç„¶, å¦‚æœä¸€ç›´ç­‰ä¸åˆ°å…¶ä»–åŒ…, é‚£å°±è¶…æ—¶åå•ç‹¬å‘é€ ACK.')]),s._v(" "),a("p",[s._v("å› ä¸ºæ¡ˆä¾‹ä¸­ 40ms å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ä¸Š, å°±æœ‰ç†ç”±æ€€ç–‘, æ˜¯å®¢æˆ·ç«¯"),a("strong",[s._v("å¼€å¯äº†å»¶è¿Ÿç¡®è®¤æœºåˆ¶")]),s._v(". è€Œè¿™å„¿çš„å®¢æˆ·ç«¯, å®é™…ä¸Šå°±æ˜¯å‰é¢è¿è¡Œçš„ wrk.")]),s._v(" "),a("p",[s._v("æŸ¥è¯¢ TCP æ–‡æ¡£(æ‰§è¡Œ man tcp), å°±ä¼šå‘ç°åªæœ‰ TCP å¥—æ¥å­—ä¸“é—¨è®¾ç½®äº† TCP_QUICKACK, æ‰ä¼šå¼€å¯å¿«é€Ÿç¡®è®¤æ¨¡å¼; å¦åˆ™, é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨çš„å°±æ˜¯å»¶è¿Ÿç¡®è®¤æœºåˆ¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("TCP_QUICKACK "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since Linux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.4")]),s._v(".4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              Enable  quickack mode "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" or disable quickack mode "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" cleared.  In quickack mode, acks are sent immeâ€\n              diately, rather than delayed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" needed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" accordance to normal TCP operation.  This flag is  not  permaâ€\n              nent,  it only enables a switch to or from quickack mode.  Subsequent operation of the TCP protocol will\n              once again enter/leave quickack mode depending on internal  protocol  processing  and  factors  such  as\n              delayed ack timeouts occurring and data transfer.  This option should not be used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" code intended to be\n              portable.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ä¸ºäº†éªŒè¯çŒœæƒ³, ç¡®è®¤ wrk çš„è¡Œä¸º, å¯ä»¥ç”¨ strace, æ¥è§‚å¯Ÿ wrk ä¸ºå¥—æ¥å­—è®¾ç½®äº†å“ªäº› TCP é€‰é¡¹.")]),s._v(" "),a("p",[s._v("å¯ä»¥åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http://192.168.0.30:8080/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nsetsockopt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(", SOL_TCP, TCP_NODELAY, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è¿™æ ·å¯ä»¥çœ‹åˆ°, wrk åªè®¾ç½®äº† TCP_NODELAY é€‰é¡¹, è€Œæ²¡æœ‰è®¾ç½® TCP_QUICKACK. è¿™è¯´æ˜ wrk é‡‡ç”¨çš„æ­£æ˜¯å»¶è¿Ÿç¡®è®¤, ä¹Ÿå°±è§£é‡Šäº†ä¸Šé¢è¿™ä¸ª 40ms çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, åˆ«å¿˜äº†, è¿™åªæ˜¯å®¢æˆ·ç«¯çš„è¡Œä¸º, æŒ‰ç†æ¥è¯´, Nginx æœåŠ¡å™¨ä¸åº”è¯¥å—åˆ°è¿™ä¸ªè¡Œä¸ºçš„å½±å“. é‚£æ˜¯ä¸æ˜¯åˆ†æç½‘ç»œåŒ…æ—¶, æ¼æ‰äº†ä»€ä¹ˆçº¿ç´¢å‘¢? å›åˆ° Wireshark é‡æ–°è§‚å¯Ÿä¸€ä¸‹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/c68925f12d475a2d79c972f0504cb3e5-20230731161933-craqsnf.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»”ç»†è§‚å¯Ÿ Wireshark çš„ç•Œé¢, å…¶ä¸­ 1173 å·åŒ…, å°±æ˜¯åˆšæ‰è¯´åˆ°çš„å»¶è¿Ÿ ACK åŒ…; ä¸‹ä¸€è¡Œçš„ 1175 åˆ™æ˜¯ Nginx å‘é€çš„ç¬¬äºŒä¸ªåˆ†ç»„åŒ…, å®ƒè·Ÿ 697 å·åŒ…ç»„åˆèµ·æ¥, æ„æˆä¸€ä¸ªå®Œæ•´çš„ HTTP å“åº”(ACK å·éƒ½æ˜¯ 85).")]),s._v(" "),a("p",[s._v("ç¬¬äºŒä¸ªåˆ†ç»„æ²¡è·Ÿå‰ä¸€ä¸ªåˆ†ç»„(697 å·)ä¸€èµ·å‘é€, è€Œæ˜¯ç­‰åˆ°å®¢æˆ·ç«¯å¯¹ç¬¬ä¸€ä¸ªåˆ†ç»„çš„ ACK å(1173 å·)æ‰å‘é€, è¿™çœ‹èµ·æ¥è·Ÿå»¶è¿Ÿç¡®è®¤æœ‰ç‚¹åƒ, åªä¸è¿‡è¿™å„¿ä¸å†æ˜¯ ACK, è€Œæ˜¯å‘é€æ•°æ®.")]),s._v(" "),a("p",[s._v("çœ‹åˆ°è¿™é‡Œ, æˆ‘ä¼°è®¡ä½ æƒ³èµ·äº†ä¸€ä¸ªä¸œè¥¿--Nagle ç®—æ³•(çº³æ ¼ç®—æ³•). è¿›ä¸€æ­¥åˆ†ææ¡ˆä¾‹å‰, å…ˆç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªç®—æ³•.")]),s._v(" "),a("p",[a("strong",[s._v("Nagle ç®—æ³•æ˜¯ TCP åè®®ä¸­ç”¨äºå‡å°‘å°åŒ…å‘é€æ•°é‡çš„ä¸€ç§ä¼˜åŒ–ç®—æ³•, ç›®çš„æ˜¯ä¸ºäº†æé«˜å®é™…å¸¦å®½çš„åˆ©ç”¨ç‡")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸¾ä¸ªä¾‹å­, å½“æœ‰æ•ˆè´Ÿè½½åªæœ‰ 1 å­—èŠ‚æ—¶, å†åŠ ä¸Š TCP å¤´éƒ¨å’Œ IP å¤´éƒ¨åˆ†åˆ«å ç”¨çš„ 20 å­—èŠ‚, æ•´ä¸ªç½‘ç»œåŒ…å°±æ˜¯ 41 å­—èŠ‚, è¿™æ ·å®é™…å¸¦å®½çš„åˆ©ç”¨ç‡åªæœ‰ 2.4%(1/41). å¾€å¤§äº†è¯´, å¦‚æœæ•´ä¸ªç½‘ç»œå¸¦å®½éƒ½è¢«è¿™ç§å°åŒ…å æ»¡, é‚£æ•´ä¸ªç½‘ç»œçš„æœ‰æ•ˆåˆ©ç”¨ç‡å°±å¤ªä½äº†.")]),s._v(" "),a("p",[s._v("Nagle ç®—æ³•æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜. å®ƒé€šè¿‡"),a("strong",[s._v("åˆå¹¶ TCP å°åŒ…, æé«˜ç½‘ç»œå¸¦å®½çš„åˆ©ç”¨ç‡")]),s._v(". Nagle ç®—æ³•è§„å®š, ä¸€ä¸ª TCP è¿æ¥ä¸Š, æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæœªè¢«ç¡®è®¤çš„æœªå®Œæˆåˆ†ç»„; åœ¨æ”¶åˆ°è¿™ä¸ªåˆ†ç»„çš„ ACK å‰, ä¸å‘é€å…¶ä»–åˆ†ç»„. è¿™äº›å°åˆ†ç»„ä¼šè¢«ç»„åˆèµ·æ¥, å¹¶åœ¨æ”¶åˆ° ACK å, ç”¨åŒä¸€ä¸ªåˆ†ç»„å‘é€å‡ºå».")]),s._v(" "),a("p",[s._v("æ˜¾ç„¶, Nagle ç®—æ³•æœ¬èº«çš„æƒ³æ³•è¿˜æ˜¯æŒºå¥½çš„, ä½†æ˜¯çŸ¥é“ Linux é»˜è®¤çš„å»¶è¿Ÿç¡®è®¤æœºåˆ¶å, åº”è¯¥å°±ä¸è¿™ä¹ˆæƒ³äº†. å› ä¸ºå®ƒä»¬"),a("strong",[s._v("ä¸€èµ·ä½¿ç”¨æ—¶, ç½‘ç»œå»¶è¿Ÿä¼šæ˜æ˜¾")]),s._v(". å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/5f81533adec2669c919c9be6db50186b-20230731161933-ngrxr21.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("å½“ Sever å‘é€äº†ç¬¬ä¸€ä¸ªåˆ†ç»„å, ç”±äº Client å¼€å¯äº†å»¶è¿Ÿç¡®è®¤, å°±éœ€è¦ç­‰å¾… 40ms åæ‰ä¼šå›å¤ ACK.")]),s._v(" "),a("li",[s._v("åŒæ—¶ç”±äº Server ç«¯å¼€å¯äº† Nagle, è€Œè¿™æ—¶è¿˜æ²¡æ”¶åˆ°ç¬¬ä¸€ä¸ªåˆ†ç»„çš„ ACK, Server ä¹Ÿä¼šåœ¨è¿™é‡Œä¸€ç›´ç­‰ç€.")]),s._v(" "),a("li",[s._v("ç›´åˆ° 40ms è¶…æ—¶å, Client æ‰ä¼šå›å¤ ACK, ç„¶å, Server æ‰ä¼šç»§ç»­å‘é€ç¬¬äºŒä¸ªåˆ†ç»„.")])]),s._v(" "),a("p",[s._v("æ—¢ç„¶å¯èƒ½æ˜¯ Nagle çš„é—®é¢˜, é‚£è¯¥æ€ä¹ˆçŸ¥é“, æ¡ˆä¾‹ Nginx æœ‰æ²¡æœ‰å¼€å¯ Nagle å‘¢?")]),s._v(" "),a("p",[s._v("æŸ¥è¯¢ tcp çš„æ–‡æ¡£å°±ä¼šçŸ¥é“, åªæœ‰è®¾ç½®äº† TCP_NODELAY å, Nagle ç®—æ³•æ‰ä¼šç¦ç”¨. æ‰€ä»¥åªéœ€è¦æŸ¥çœ‹ Nginx çš„ tcp_nodelay é€‰é¡¹å°±å¯ä»¥äº†.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("TCP_NODELAY\n              If set, disable the Nagle algorithm.  This means that segments are always sent as soon as possible, even\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" there is only a small amount of data.  When not set, data is buffered "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v("  there  is  a  sufficient\n              amount  to  send out, thereby avoiding the frequent sending of small packets, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" results "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" poor utiâ€\n              lization of the network.  This option is overridden by TCP_CORK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" however, setting this option forces  an\n              explicit flush of pending output, even "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" TCP_CORK is currently set.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("å›åˆ°ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹æ¡ˆä¾‹ Nginx çš„é…ç½®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/nginx/nginx.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" tcp_nodelay\n    tcp_nodelay    off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æœç„¶å¯ä»¥çœ‹åˆ°, æ¡ˆä¾‹ Nginx çš„ tcp_nodelay æ˜¯å…³é—­çš„, å°†å…¶è®¾ç½®ä¸º on, åº”è¯¥å°±å¯ä»¥è§£å†³äº†.")]),s._v(" "),a("p",[s._v("æ”¹å®Œå, é—®é¢˜æ˜¯å¦å°±è§£å†³äº†å‘¢? è‡ªç„¶éœ€è¦éªŒè¯ä¸€ä¸‹. ä¿®æ”¹åçš„åº”ç”¨å·²ç»æ‰“åŒ…åˆ°äº† Docker é•œåƒä¸­, åœ¨ç»ˆç«¯ä¸€ä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥å¯åŠ¨å®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ é™¤æ¡ˆä¾‹åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯åŠ¨ä¼˜åŒ–åçš„åº”ç”¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx:nodelay\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("æ¥ç€åˆ‡æ¢åˆ°ç»ˆç«¯äºŒ, é‡æ–°æ‰§è¡Œ wrk æµ‹è¯•å»¶è¿Ÿ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http://192.168.0.30:8080/\nRunning 10s "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" @ http://192.168.0.30:8080/\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" threads and "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".58ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(".98ms "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("350")]),s._v(".08ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.91")]),s._v("%\n    Req/Sec     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".22k   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("282.13")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".93k    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68.50")]),s._v("%\n  Latency Distribution\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".78ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".20ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".02ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(".14ms\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123990")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".01s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(".50MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\nRequests/sec:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12384.04")]),s._v("\nTransfer/sec:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".04MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("æœç„¶, ç°åœ¨å»¶è¿Ÿå·²ç»ç¼©çŸ­æˆäº† 9ms, è·Ÿæµ‹è¯•çš„å®˜æ–¹ Nginx é•œåƒæ˜¯ä¸€æ ·çš„(Nginx é»˜è®¤å°±æ˜¯å¼€å¯ tcp_nodelay çš„).")]),s._v(" "),a("p",[s._v("ä½œä¸ºå¯¹æ¯”, ç”¨ tcpdump æŠ“å–ä¼˜åŒ–åçš„ç½‘ç»œåŒ…(è¿™å„¿å®é™…ä¸ŠæŠ“å–çš„æ˜¯å®˜æ–¹ Nginx ç›‘å¬çš„ 80 ç«¯å£). å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç»“æœ:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/fb9b3b64fe3626b7d6357ca8e2ecbaba-20230731161933-ookurfb.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»å›¾ä¸­å¯ä»¥å‘ç°, ç”±äº Nginx ä¸ç”¨å†ç­‰ ACK, 536 å’Œ 540 ä¸¤ä¸ªåˆ†ç»„æ˜¯è¿ç»­å‘é€çš„; è€Œå®¢æˆ·ç«¯è™½ç„¶ä»å¼€å¯äº†å»¶è¿Ÿç¡®è®¤, ä½†è¿™æ—¶æ”¶åˆ°äº†ä¸¤ä¸ªéœ€è¦å›å¤ ACK çš„åŒ…, æ‰€ä»¥ä¹Ÿä¸ç”¨ç­‰ 40ms, å¯ä»¥ç›´æ¥åˆå¹¶å›å¤ ACK.")]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-13"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-13"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("ä»Šæœ¬èŠ‚å­¦ä¹ äº†ç½‘ç»œå»¶è¿Ÿå¢å¤§åçš„åˆ†ææ–¹æ³•. ç½‘ç»œå»¶è¿Ÿ, æ˜¯æœ€æ ¸å¿ƒçš„ç½‘ç»œæ€§èƒ½æŒ‡æ ‡. ç”±äºç½‘ç»œä¼ è¾“, ç½‘ç»œåŒ…å¤„ç†ç­‰å„ç§å› ç´ çš„å½±å“, ç½‘ç»œå»¶è¿Ÿä¸å¯é¿å…. ä½†è¿‡å¤§çš„ç½‘ç»œå»¶è¿Ÿ, ä¼šç›´æ¥å½±å“ç”¨æˆ·çš„ä½“éªŒ.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, "),a("strong",[s._v("åœ¨å‘ç°ç½‘ç»œå»¶è¿Ÿå¢å¤§å, å¯ä»¥ç”¨ traceroute, hping3, tcpdump, Wireshark, strace ç­‰å¤šç§å·¥å…·, æ¥å®šä½ç½‘ç»œä¸­çš„æ½œåœ¨é—®é¢˜")]),s._v(". æ¯”å¦‚,")]),s._v(" "),a("ul",[a("li",[s._v("ä½¿ç”¨ hping3 ä»¥åŠ wrk ç­‰å·¥å…·, ç¡®è®¤å•æ¬¡è¯·æ±‚å’Œå¹¶å‘è¯·æ±‚æƒ…å†µçš„ç½‘ç»œå»¶è¿Ÿæ˜¯å¦æ­£å¸¸.")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ traceroute, ç¡®è®¤è·¯ç”±æ˜¯å¦æ­£ç¡®, å¹¶æŸ¥çœ‹è·¯ç”±ä¸­æ¯ä¸€è·³ç½‘å…³çš„å»¶è¿Ÿ.")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ tcpdump å’Œ Wireshark, ç¡®è®¤ç½‘ç»œåŒ…çš„æ”¶å‘æ˜¯å¦æ­£å¸¸.")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ strace ç­‰, è§‚å¯Ÿåº”ç”¨ç¨‹åºå¯¹ç½‘ç»œå¥—æ¥å­—çš„è°ƒç”¨æƒ…å†µæ˜¯å¦æ­£å¸¸.")])]),s._v(" "),a("p",[s._v("è¿™æ ·å°±å¯ä»¥ä¾æ¬¡ä»è·¯ç”±, ç½‘ç»œåŒ…çš„æ”¶å‘, å†åˆ°åº”ç”¨ç¨‹åºç­‰, é€å±‚æ’æŸ¥, ç›´åˆ°å®šä½é—®é¢˜æ ¹æº.")]),s._v(" "),a("h4",{attrs:{id:"_41-æ¡ˆä¾‹ç¯‡-å¦‚ä½•ä¼˜åŒ–natæ€§èƒ½-ä¸Š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_41-æ¡ˆä¾‹ç¯‡-å¦‚ä½•ä¼˜åŒ–natæ€§èƒ½-ä¸Š"}},[s._v("#")]),s._v(" 41-æ¡ˆä¾‹ç¯‡:å¦‚ä½•ä¼˜åŒ–NATæ€§èƒ½?(ä¸Š)")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¥çœ‹çœ‹å¦ä¸€ä¸ªå¯èƒ½å¯¼è‡´ç½‘ç»œå»¶è¿Ÿçš„å› ç´ , å³"),a("strong",[s._v("ç½‘ç»œåœ°å€è½¬æ¢(Network Address Translation), ç¼©å†™ä¸º NAT")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸‹é¢å…ˆæ¥å­¦ä¹  NAT çš„å·¥ä½œåŸç†, å¹¶å¼„æ¸…æ¥šå¦‚ä½•ä¼˜åŒ– NAT å¸¦æ¥çš„æ½œåœ¨æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_1-natåŸç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-natåŸç†"}},[s._v("#")]),s._v(" 1.NATåŸç†")]),s._v(" "),a("p",[a("strong",[s._v("NAT æŠ€æœ¯å¯ä»¥é‡å†™ IP æ•°æ®åŒ…çš„æº IP æˆ–è€…ç›®çš„ IP, è¢«æ™®éåœ°ç”¨æ¥è§£å†³å…¬ç½‘ IP åœ°å€çŸ­ç¼ºçš„é—®é¢˜")]),s._v(". å®ƒçš„ä¸»è¦åŸç†å°±æ˜¯, ç½‘ç»œä¸­çš„å¤šå°ä¸»æœº, é€šè¿‡å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€, æ¥è®¿é—®å¤–ç½‘èµ„æº. åŒæ—¶ç”±äº NAT å±è”½äº†å†…ç½‘ç½‘ç»œ, è‡ªç„¶ä¹Ÿå°±ä¸ºå±€åŸŸç½‘ä¸­çš„æœºå™¨æä¾›äº†å®‰å…¨éš”ç¦».")]),s._v(" "),a("p",[s._v("æ—¢å¯ä»¥åœ¨æ”¯æŒç½‘ç»œåœ°å€è½¬æ¢çš„"),a("strong",[s._v("è·¯ç”±å™¨(ç§°ä¸º NAT ç½‘å…³)ä¸­é…ç½® NAT")]),s._v(', ä¹Ÿå¯ä»¥åœ¨ Linux æœåŠ¡å™¨ä¸­é…ç½® NAT. å¦‚æœé‡‡ç”¨ç¬¬äºŒç§æ–¹å¼, Linux æœåŠ¡å™¨å®é™…ä¸Šå……å½“çš„æ˜¯"è½¯"è·¯ç”±å™¨çš„è§’è‰².')]),s._v(" "),a("p",[s._v("NAT çš„ä¸»è¦ç›®çš„, æ˜¯"),a("strong",[s._v("å®ç°åœ°å€è½¬æ¢")]),s._v(". æ ¹æ®å®ç°æ–¹å¼çš„ä¸åŒ, NAT å¯ä»¥åˆ†ä¸ºä¸‰ç±»:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("é™æ€ NAT")]),s._v(", å³å†…ç½‘ IP ä¸å…¬ç½‘ IP æ˜¯ä¸€å¯¹ä¸€çš„æ°¸ä¹…æ˜ å°„å…³ç³»;")]),s._v(" "),a("li",[a("strong",[s._v("åŠ¨æ€ NAT")]),s._v(", å³å†…ç½‘ IP ä»å…¬ç½‘ IP æ± ä¸­, åŠ¨æ€é€‰æ‹©ä¸€ä¸ªè¿›è¡Œæ˜ å°„;")]),s._v(" "),a("li",[a("strong",[s._v("ç½‘ç»œåœ°å€ç«¯å£è½¬æ¢ NAPT(Network Address and Port Translation), å³æŠŠå†…ç½‘ IP æ˜ å°„åˆ°å…¬ç½‘ IP çš„ä¸åŒç«¯å£ä¸Š, è®©å¤šä¸ªå†…ç½‘ IP å¯ä»¥å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€")]),s._v(".")])]),s._v(" "),a("p",[s._v("NAPT æ˜¯ç›®å‰æœ€æµè¡Œçš„ NAT ç±»å‹, åœ¨ Linux ä¸­é…ç½®çš„ NAT ä¹Ÿæ˜¯è¿™ç§ç±»å‹. è€Œæ ¹æ®è½¬æ¢æ–¹å¼çš„ä¸åŒ, åˆå¯ä»¥æŠŠ NAPT åˆ†ä¸ºä¸‰ç±».")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç±»æ˜¯"),a("strong",[s._v("æºåœ°å€è½¬æ¢ SNAT, å³ç›®çš„åœ°å€ä¸å˜, åªæ›¿æ¢æº IP æˆ–æºç«¯å£")]),s._v(". SNAT ä¸»è¦ç”¨äº, å¤šä¸ªå†…ç½‘ IP å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP, æ¥è®¿é—®å¤–ç½‘èµ„æºçš„åœºæ™¯.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç±»æ˜¯"),a("strong",[s._v("ç›®çš„åœ°å€è½¬æ¢ DNAT, å³æº IP ä¿æŒä¸å˜, åªæ›¿æ¢ç›®çš„ IP æˆ–è€…ç›®çš„ç«¯å£")]),s._v(". DNAT ä¸»è¦é€šè¿‡å…¬ç½‘ IP çš„ä¸åŒç«¯å£å·, æ¥è®¿é—®å†…ç½‘çš„å¤šç§æœåŠ¡, åŒæ—¶ä¼šéšè—åç«¯æœåŠ¡å™¨çš„çœŸå® IP åœ°å€.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰ç±»æ˜¯"),a("mark",[a("strong",[s._v("åŒå‘åœ°å€è½¬æ¢, å³åŒæ—¶ä½¿ç”¨ SNAT å’Œ DNAT")])]),s._v(". å½“æ¥æ”¶åˆ°ç½‘ç»œåŒ…æ—¶, æ‰§è¡Œ DNAT, æŠŠç›®çš„ IP è½¬æ¢ä¸ºå†…ç½‘ IP; è€Œåœ¨å‘é€ç½‘ç»œåŒ…æ—¶, æ‰§è¡Œ SNAT, æŠŠæº IP æ›¿æ¢ä¸ºå¤–éƒ¨ IP.")])]),s._v(" "),a("p",[s._v("åŒå‘åœ°å€è½¬æ¢, å…¶å®å°±æ˜¯å¤–ç½‘ IP ä¸å†…ç½‘ IP çš„ä¸€å¯¹ä¸€æ˜ å°„å…³ç³», æ‰€ä»¥å¸¸ç”¨åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­, ä¸ºè™šæ‹Ÿæœºåˆ†é…æµ®åŠ¨çš„å…¬ç½‘ IP åœ°å€.")]),s._v(" "),a("p",[s._v("ä¸ºäº†å¸®åŠ©ç†è§£ NAPT, ä¸‹é¢ç”»äº†ä¸€å¼ å›¾. å‡è®¾:")]),s._v(" "),a("ul",[a("li",[s._v("æœ¬åœ°æœåŠ¡å™¨çš„å†…ç½‘ IP åœ°å€ä¸º 192.168.0.2;")]),s._v(" "),a("li",[s._v("NAT ç½‘å…³ä¸­çš„å…¬ç½‘ IP åœ°å€ä¸º 100.100.100.100;")]),s._v(" "),a("li",[s._v("è¦è®¿é—®çš„ç›®çš„æœåŠ¡å™¨ baidu.com çš„åœ°å€ä¸º 123.125.115.110.")])]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ SNAT å’Œ DNAT çš„è¿‡ç¨‹, å°±å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/d2adfddcba1393dd334b7643bdfdf0f5-20230731161933-s5m5ap2.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»å›¾ä¸­å¯ä»¥å‘ç°:")]),s._v(" "),a("ul",[a("li",[s._v("å½“æœåŠ¡å™¨è®¿é—® baidu.com æ—¶, "),a("strong",[s._v("NAT ç½‘å…³ä¼šæŠŠæºåœ°å€, ä»æœåŠ¡å™¨çš„å†…ç½‘ IP 192.168.0.2 æ›¿æ¢æˆå…¬ç½‘ IP åœ°å€ 100.100.100.100")]),s._v(", ç„¶åæ‰å‘é€ç»™ baidu.com;")]),s._v(" "),a("li",[s._v("å½“ baidu.com å‘å›å“åº”åŒ…æ—¶, "),a("strong",[s._v("NAT ç½‘å…³åˆä¼šæŠŠç›®çš„åœ°å€, ä»å…¬ç½‘ IP åœ°å€ 100.100.100.100 æ›¿æ¢æˆæœåŠ¡å™¨å†…ç½‘ IP 192.168.0.2, ç„¶åå†å‘é€ç»™å†…ç½‘ä¸­çš„æœåŠ¡å™¨")]),s._v(".")])]),s._v(" "),a("p",[s._v("äº†è§£äº† NAT çš„åŸç†å,å†æ¥çœ‹çœ‹, å¦‚ä½•åœ¨ Linux ä¸­å®ç° NAT çš„åŠŸèƒ½.")]),s._v(" "),a("h5",{attrs:{id:"_2-iptablesä¸nat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-iptablesä¸nat"}},[s._v("#")]),s._v(" 2.iptablesä¸NAT")]),s._v(" "),a("p",[s._v("Linux å†…æ ¸æä¾›çš„ Netfilter æ¡†æ¶, å…è®¸å¯¹ç½‘ç»œæ•°æ®åŒ…è¿›è¡Œä¿®æ”¹(æ¯”å¦‚ NAT)å’Œè¿‡æ»¤(æ¯”å¦‚é˜²ç«å¢™). åœ¨è¿™ä¸ªåŸºç¡€ä¸Š, iptables, ip6tables, ebtables ç­‰å·¥å…·, åˆæä¾›äº†æ›´æ˜“ç”¨çš„å‘½ä»¤è¡Œæ¥å£, ä»¥ä¾¿ç³»ç»Ÿç®¡ç†å‘˜é…ç½®å’Œç®¡ç† NAT, é˜²ç«å¢™çš„è§„åˆ™.")]),s._v(" "),a("p",[s._v("å…¶ä¸­, iptables å°±æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§é…ç½®å·¥å…·. è¦æŒæ¡ iptables çš„åŸç†å’Œä½¿ç”¨æ–¹æ³•, æœ€æ ¸å¿ƒçš„å°±æ˜¯å¼„æ¸…æ¥š, "),a("strong",[s._v("ç½‘ç»œæ•°æ®åŒ…é€šè¿‡ Netfilter æ—¶çš„å·¥ä½œæµå‘")]),s._v(", ä¸‹é¢è¿™å¼ å›¾å°±å±•ç¤ºäº†è¿™ä¸€è¿‡ç¨‹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/53775d581d392a66b5386276f761c874-20230731161933-h6w51rf.png",alt:""}})]),s._v(" "),a("p",[s._v("åœ¨è¿™å¼ å›¾ä¸­, ç»¿è‰²èƒŒæ™¯çš„æ–¹æ¡†, è¡¨ç¤ºè¡¨(table), ç”¨æ¥ç®¡ç†é“¾. "),a("strong",[s._v("Linux æ”¯æŒ 4 ç§è¡¨, åŒ…æ‹¬ filter(ç”¨äºè¿‡æ»¤), nat(ç”¨äº NAT), mangle(ç”¨äºä¿®æ”¹åˆ†ç»„æ•°æ®) å’Œ raw(ç”¨äºåŸå§‹æ•°æ®åŒ…)ç­‰")]),s._v(".")]),s._v(" "),a("p",[s._v("è·Ÿ table ä¸€èµ·çš„ç™½è‰²èƒŒæ™¯æ–¹æ¡†, åˆ™è¡¨ç¤ºé“¾(chain), ç”¨æ¥ç®¡ç†å…·ä½“çš„ iptables è§„åˆ™. æ¯ä¸ªè¡¨ä¸­å¯ä»¥åŒ…å«å¤šæ¡é“¾, æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("filter è¡¨ä¸­, å†…ç½® INPUT, OUTPUT å’Œ FORWARD é“¾;")]),s._v(" "),a("li",[s._v("nat è¡¨ä¸­, å†…ç½® PREROUTING, POSTROUTING, OUTPUT ç­‰.")])]),s._v(" "),a("p",[s._v("å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦, åˆ›å»ºä½ è‡ªå·±çš„é“¾.")]),s._v(" "),a("p",[s._v("ç°è‰²çš„ conntrack, è¡¨ç¤º"),a("strong",[s._v("è¿æ¥è·Ÿè¸ªæ¨¡å—")]),s._v(". å®ƒé€šè¿‡å†…æ ¸ä¸­çš„è¿æ¥è·Ÿè¸ªè¡¨(ä¹Ÿå°±æ˜¯å“ˆå¸Œè¡¨), è®°å½•ç½‘ç»œè¿æ¥çš„çŠ¶æ€, æ˜¯ iptables çŠ¶æ€è¿‡æ»¤(-m state)å’Œ NAT çš„å®ç°åŸºç¡€.")]),s._v(" "),a("p",[s._v("iptables çš„æ‰€æœ‰è§„åˆ™, å°±ä¼šæ”¾åˆ°è¿™äº›è¡¨å’Œé“¾ä¸­, å¹¶æŒ‰ç…§å›¾ä¸­"),a("strong",[s._v("é¡ºåºå’Œè§„åˆ™çš„ä¼˜å…ˆçº§é¡ºåºæ¥æ‰§è¡Œ")]),s._v(".")]),s._v(" "),a("p",[s._v("é’ˆå¯¹ä»Šå¤©çš„ä¸»é¢˜, è¦å®ç° NAT åŠŸèƒ½, ä¸»è¦æ˜¯"),a("strong",[s._v("åœ¨ nat è¡¨è¿›è¡Œæ“ä½œ")]),s._v(". è€Œ nat è¡¨å†…ç½®äº†ä¸‰ä¸ªé“¾:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("PREROUTING")]),s._v(", ç”¨äº"),a("strong",[s._v("è·¯ç”±åˆ¤æ–­å‰æ‰€æ‰§è¡Œçš„è§„åˆ™")]),s._v(", æ¯”å¦‚, å¯¹æ¥æ”¶åˆ°çš„æ•°æ®åŒ…è¿›è¡Œ DNAT.")]),s._v(" "),a("li",[a("strong",[s._v("POSTROUTING")]),s._v(", ç”¨äº"),a("strong",[s._v("è·¯ç”±åˆ¤æ–­åæ‰€æ‰§è¡Œçš„è§„åˆ™")]),s._v(", æ¯”å¦‚, å¯¹å‘é€æˆ–è½¬å‘çš„æ•°æ®åŒ…è¿›è¡Œ SNAT æˆ– MASQUERADE.")]),s._v(" "),a("li",[a("strong",[s._v("OUTPUT")]),s._v(", ç±»ä¼¼äº "),a("strong",[s._v("PREROUTING")]),s._v(", ä½†åªå¤„ç†ä»æœ¬æœºå‘é€å‡ºå»çš„åŒ….")])]),s._v(" "),a("p",[s._v("ç†Ÿæ‚‰ iptables ä¸­çš„è¡¨å’Œé“¾å, ç›¸åº”çš„ NAT è§„åˆ™å°±æ¯”è¾ƒç®€å•äº†. è¿˜æ˜¯ä»¥ NAPT çš„ä¸‰ä¸ªåˆ†ç±»ä¸ºä¾‹, æ¥å…·ä½“è§£è¯»ä¸€ä¸‹.")]),s._v(" "),a("h5",{attrs:{id:"_3-snat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-snat"}},[s._v("#")]),s._v(" 3.SNAT")]),s._v(" "),a("p",[s._v("æ ¹æ®åˆšæ‰å†…å®¹å¯ä»¥çŸ¥é“, "),a("strong",[s._v("SNAT éœ€è¦åœ¨ nat è¡¨çš„ POSTROUTING é“¾ä¸­é…ç½®")]),s._v(". å¸¸ç”¨ä¸¤ç§æ–¹å¼æ¥é…ç½®å®ƒ.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç§æ–¹æ³•, æ˜¯ä¸ºä¸€ä¸ªå­ç½‘ç»Ÿä¸€é…ç½® SNAT, å¹¶ç”± Linux é€‰æ‹©é»˜è®¤çš„å‡ºå£ IP. è¿™å®é™…ä¸Šå°±æ˜¯ç»å¸¸è¯´çš„ MASQUERADE:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ iptables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t nat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("POSTROUTING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MASQUERADE")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç¬¬äºŒç§æ–¹æ³•, æ˜¯ä¸ºå…·ä½“çš„ IP åœ°å€é…ç½® SNAT, å¹¶æŒ‡å®šè½¬æ¢åçš„æºåœ°å€:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ iptables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t nat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("POSTROUTING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SNAT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("source "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"_4-dnat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-dnat"}},[s._v("#")]),s._v(" 4.DNAT")]),s._v(" "),a("p",[s._v("å†æ¥çœ‹ DNAT, æ˜¾ç„¶ "),a("strong",[s._v("DNAT éœ€è¦åœ¨ nat è¡¨çš„ PREROUTING æˆ–è€… OUTPUT é“¾ä¸­é…ç½®")]),s._v(", å…¶ä¸­ PREROUTING é“¾æ›´å¸¸ç”¨ä¸€äº›(å› ä¸ºå®ƒè¿˜å¯ä»¥ç”¨äºè½¬å‘çš„åŒ…).")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ iptables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t nat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PREROUTING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DNAT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("destination "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"_5-åŒå‘åœ°å€è½¬æ¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-åŒå‘åœ°å€è½¬æ¢"}},[s._v("#")]),s._v(" 5.åŒå‘åœ°å€è½¬æ¢")]),s._v(" "),a("p",[a("strong",[s._v("åŒå‘åœ°å€è½¬æ¢, å°±æ˜¯åŒæ—¶æ·»åŠ  SNAT å’Œ DNAT è§„åˆ™, ä¸ºå…¬ç½‘ IP å’Œå†…ç½‘ IP å®ç°ä¸€å¯¹ä¸€çš„æ˜ å°„å…³ç³»")]),s._v(", å³:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ iptables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t nat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("POSTROUTING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SNAT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("source "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),s._v("\n$ iptables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t nat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PREROUTING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DNAT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("destination "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("åœ¨ä½¿ç”¨ iptables é…ç½® NAT è§„åˆ™æ—¶, Linux éœ€è¦è½¬å‘æ¥è‡ªå…¶ä»– IP çš„ç½‘ç»œåŒ…, æ‰€ä»¥åƒä¸‡ä¸è¦å¿˜è®°å¼€å¯ Linux çš„ IP è½¬å‘åŠŸèƒ½.")]),s._v(" "),a("p",[s._v("å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹è¿™ä¸€åŠŸèƒ½æ˜¯å¦å¼€å¯. å¦‚æœè¾“å‡ºçš„ç»“æœæ˜¯ 1, å°±è¡¨ç¤ºå·²ç»å¼€å¯äº† IP è½¬å‘:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.ipv4.ip_forward\nnet.ipv4.ip_forward "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¦‚æœè¿˜æ²¡å¼€å¯, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ‰‹åŠ¨å¼€å¯:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.ipv4.ip_forward")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.ipv4.ip_forward "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å½“ç„¶, ä¸ºäº†é¿å…é‡å¯åé…ç½®ä¸¢å¤±, ä¸è¦å¿˜è®°å°†é…ç½®å†™å…¥ "),a("code",[s._v("/etc/sysctl.conf")]),s._v("â€‹ æ–‡ä»¶ä¸­:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/sysctl.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ip_forward\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.ipv4.ip_forward")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"_6-å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-å°ç»“"}},[s._v("#")]),s._v(" 6.å°ç»“")]),s._v(" "),a("p",[s._v("NAT æŠ€æœ¯èƒ½å¤Ÿé‡å†™ IP æ•°æ®åŒ…çš„æº IP æˆ–ç›®çš„ IP, æ‰€ä»¥æ™®éç”¨æ¥è§£å†³å…¬ç½‘ IP åœ°å€çŸ­ç¼ºçš„é—®é¢˜. å®ƒå¯ä»¥è®©ç½‘ç»œä¸­çš„å¤šå°ä¸»æœº, é€šè¿‡å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€, æ¥è®¿é—®å¤–ç½‘èµ„æº. åŒæ—¶, ç”±äº NAT å±è”½äº†å†…ç½‘ç½‘ç»œ, ä¹Ÿä¸ºå±€åŸŸç½‘ä¸­æœºå™¨èµ·åˆ°å®‰å…¨éš”ç¦»çš„ä½œç”¨.")]),s._v(" "),a("p",[s._v("Linux ä¸­çš„ NAT, åŸºäºå†…æ ¸çš„è¿æ¥è·Ÿè¸ªæ¨¡å—å®ç°. æ‰€ä»¥, å®ƒç»´æŠ¤æ¯ä¸ªè¿æ¥çŠ¶æ€çš„åŒæ—¶, ä¹Ÿä¼šå¸¦æ¥å¾ˆé«˜çš„æ€§èƒ½æˆæœ¬. å…·ä½“ NAT æ€§èƒ½é—®é¢˜çš„åˆ†ææ–¹æ³•, å°†åœ¨ä¸‹èŠ‚è¯¾ç»§ç»­å­¦ä¹ .")]),s._v(" "),a("h4",{attrs:{id:"_42-æ¡ˆä¾‹ç¯‡-å¦‚ä½•ä¼˜åŒ–natæ€§èƒ½-ä¸‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_42-æ¡ˆä¾‹ç¯‡-å¦‚ä½•ä¼˜åŒ–natæ€§èƒ½-ä¸‹"}},[s._v("#")]),s._v(" 42-æ¡ˆä¾‹ç¯‡:å¦‚ä½•ä¼˜åŒ–NATæ€§èƒ½?(ä¸‹)")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚å­¦ä¹ äº† NAT çš„åŸç†, æ˜ç™½äº†å¦‚ä½•åœ¨ Linux ä¸­ç®¡ç† NAT è§„åˆ™.")]),s._v(" "),a("p",[s._v("Linux ä¸­çš„ NAT åŸºäºå†…æ ¸çš„è¿æ¥è·Ÿè¸ªæ¨¡å—å®ç°. æ‰€ä»¥, å®ƒç»´æŠ¤æ¯ä¸ªè¿æ¥çŠ¶æ€çš„åŒæ—¶, ä¹Ÿå¯¹ç½‘ç»œæ€§èƒ½æœ‰ä¸€å®šå½±å“. é‚£ä¹ˆ, "),a("strong",[s._v("ç¢°åˆ° NAT æ€§èƒ½é—®é¢˜æ—¶, åˆè¯¥æ€ä¹ˆåŠå‘¢")]),s._v("? æ¥ä¸‹æ¥å°±é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ¥å­¦ä¹  NAT æ€§èƒ½é—®é¢˜çš„åˆ†ææ€è·¯.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹å‡†å¤‡-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹å‡†å¤‡-6"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("ä¸‹é¢çš„æ¡ˆä¾‹ä»ç„¶åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æ¡ˆä¾‹ç¯å¢ƒæ˜¯è¿™æ ·çš„:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, tcpdump, curl, ab, SystemTap ç­‰å·¥å…·, æ¯”å¦‚")])]),s._v(" "),a("p",[s._v("è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ SystemTap. "),a("strong",[s._v("SystemTap æ˜¯ Linux çš„ä¸€ç§åŠ¨æ€è¿½è¸ªæ¡†æ¶, å®ƒæŠŠç”¨æˆ·æä¾›çš„è„šæœ¬, è½¬æ¢ä¸ºå†…æ ¸æ¨¡å—æ¥æ‰§è¡Œ, ç”¨æ¥ç›‘æµ‹å’Œè·Ÿè¸ªå†…æ ¸çš„è¡Œä¸º")]),s._v(". è¿™é‡Œåªè¦çŸ¥é“æ€ä¹ˆå®‰è£…å°±å¯ä»¥äº†:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ubuntu")]),s._v("\napt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("get install "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y systemtap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime systemtap\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configure")]),s._v(" ddebs source\nec\n \n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CentOS")]),s._v("\nyum install systemtap kernel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("devel yum"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("utils kernel\nstab"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prep\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹è¿˜æ˜¯å¸¸è§çš„ Nginx, å¹¶ä¸”ä¼šç”¨ ab ä½œä¸ºå®ƒçš„å®¢æˆ·ç«¯, è¿›è¡Œå‹åŠ›æµ‹è¯•. æ¡ˆä¾‹ä¸­æ€»å…±ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœº, æˆ‘ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºå®ƒä»¬çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/827b43c9b3dabf0b01d36ac47ea66ff2-20230731161933-5folo07.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ-7"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("ä¸ºäº†å¯¹æ¯” NAT å¸¦æ¥çš„æ€§èƒ½é—®é¢˜, é¦–å…ˆè¿è¡Œä¸€ä¸ªä¸ç”¨ NAT çš„ Nginx æœåŠ¡, å¹¶ç”¨ ab æµ‹è¯•å®ƒçš„æ€§èƒ½.")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å¯åŠ¨ Nginx, æ³¨æ„é€‰é¡¹ --network=host, è¡¨ç¤ºå®¹å™¨ä½¿ç”¨ Host ç½‘ç»œæ¨¡å¼, å³ä¸ä½¿ç”¨ NAT:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ docker run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostnet "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("privileged "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("network"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("itd feisky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶ååˆ°ç»ˆç«¯äºŒä¸­, æ‰§è¡Œ curl å‘½ä»¤, ç¡®è®¤ Nginx æ­£å¸¸å¯åŠ¨:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("$ curl http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".30")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("em"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thank")]),s._v(" you "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("<"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯äºŒä¸­, æ‰§è¡Œ ab å‘½ä»¤, å¯¹ Nginx è¿›è¡Œå‹åŠ›æµ‹è¯•. ä¸è¿‡åœ¨æµ‹è¯•å‰è¦æ³¨æ„, Linux é»˜è®¤å…è®¸æ‰“å¼€çš„æ–‡ä»¶æè¿°æ•°æ¯”è¾ƒå°, æ¯”å¦‚åœ¨æˆ‘çš„æœºå™¨ä¸­, è¿™ä¸ªå€¼åªæœ‰ 1024:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("# "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("files")]),s._v("\n$ ulimit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("æ‰€ä»¥æ‰§è¡Œ ab å‰, å…ˆè¦æŠŠè¿™ä¸ªé€‰é¡¹è°ƒå¤§, æ¯”å¦‚è°ƒæˆ 65536:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸´æ—¶å¢å¤§å½“å‰ä¼šè¯çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥, å†å»æ‰§è¡Œ ab å‘½ä»¤, è¿›è¡Œå‹åŠ›æµ‹è¯•:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c è¡¨ç¤ºå¹¶å‘è¯·æ±‚æ•°ä¸º 5000, -n è¡¨ç¤ºæ€»çš„è¯·æ±‚æ•°ä¸º 10 ä¸‡")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -r è¡¨ç¤ºå¥—æ¥å­—æ¥æ”¶é”™è¯¯æ—¶ä»ç„¶ç»§ç»­æ‰§è¡Œ, -s è¡¨ç¤ºè®¾ç½®æ¯ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ä¸º 2s")]),s._v("\n$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http://192.168.0.30/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6576.21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("760.317")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.152")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5390.19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received\n \nConnection Times "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              min  mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+/-sd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" median   max\nConnect:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("177")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("714.3")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7338")]),s._v("\nProcessing:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.8")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("961")]),s._v("\nWaiting:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.5")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("951")]),s._v("\nTotal:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("204")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("716.3")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7349")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("å…³äº ab è¾“å‡ºç•Œé¢çš„å«ä¹‰, å·²ç»åœ¨å‰é¢ä»‹ç»è¿‡. ä»è¿™æ¬¡çš„ç•Œé¢å¯ä»¥çœ‹å‡º:")]),s._v(" "),a("ul",[a("li",[s._v("æ¯ç§’è¯·æ±‚æ•°(Requests per second)ä¸º 6576;")]),s._v(" "),a("li",[s._v("æ¯ä¸ªè¯·æ±‚çš„å¹³å‡å»¶è¿Ÿ(Time per request)ä¸º 760ms;")]),s._v(" "),a("li",[s._v("å»ºç«‹è¿æ¥çš„å¹³å‡å»¶è¿Ÿ(Connect)ä¸º 177ms.")])]),s._v(" "),a("p",[s._v("è®°ä½è¿™å‡ ä¸ªæ•°å€¼, è¿™å°†æ˜¯æ¥ä¸‹æ¥æ¡ˆä¾‹çš„åŸºå‡†æŒ‡æ ‡.")]),s._v(" "),a("p",[s._v("æ¥ç€å›åˆ°ç»ˆç«¯ä¸€, åœæ­¢è¿™ä¸ªæœªä½¿ç”¨ NAT çš„ Nginx åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx-hostnet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å¯åŠ¨ä»Šå¤©çš„æ¡ˆä¾‹åº”ç”¨. æ¡ˆä¾‹åº”ç”¨ç›‘å¬åœ¨ 8080 ç«¯å£, å¹¶ä¸”ä½¿ç”¨äº† DNAT, æ¥å®ç° Host çš„ 8080 ç«¯å£, åˆ°å®¹å™¨çš„ 8080 ç«¯å£çš„æ˜ å°„å…³ç³»:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx:nat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Nginx å¯åŠ¨å, å¯ä»¥æ‰§è¡Œ iptables å‘½ä»¤, ç¡®è®¤ DNAT è§„åˆ™å·²ç»åˆ›å»º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ iptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nat\nChain PREROUTING "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\nDOCKER     all  --  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            ADDRTYPE match dst-type LOCAL\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n \nChain DOCKER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" references"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\nRETURN     all  --  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0\nDNAT       tcp  --  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            tcp dpt:8080 to:172.17.0.2:8080\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, åœ¨ PREROUTING é“¾ä¸­, ç›®çš„ä¸ºæœ¬åœ°çš„è¯·æ±‚, ä¼šè½¬åˆ° DOCKER é“¾; "),a("strong",[s._v("è€Œåœ¨ DOCKER é“¾ä¸­, ç›®çš„ç«¯å£ä¸º 8080 çš„ tcp è¯·æ±‚, ä¼šè¢« DNAT åˆ° 172.17.0.2 çš„ 8080 ç«¯å£")]),s._v(". å…¶ä¸­, 172.17.0.2 å°±æ˜¯ Nginx å®¹å™¨çš„ IP åœ°å€.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥,åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, æ‰§è¡Œ curl å‘½ä»¤, ç¡®è®¤ Nginx å·²ç»æ­£å¸¸å¯åŠ¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.30:8080/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Thank you "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using nginx."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ç„¶å, å†æ¬¡æ‰§è¡Œä¸Šè¿°çš„ ab å‘½ä»¤, ä¸è¿‡è¿™æ¬¡æ³¨æ„, è¦æŠŠè¯·æ±‚çš„ç«¯å£å·æ¢æˆ 8080:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c è¡¨ç¤ºå¹¶å‘è¯·æ±‚æ•°ä¸º 5000, -n è¡¨ç¤ºæ€»çš„è¯·æ±‚æ•°ä¸º 10 ä¸‡")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -r è¡¨ç¤ºå¥—æ¥å­—æ¥æ”¶é”™è¯¯æ—¶ä»ç„¶ç»§ç»­æ‰§è¡Œ, -s è¡¨ç¤ºè®¾ç½®æ¯ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ä¸º 2s")]),s._v("\n$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http://192.168.0.30:8080/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\napr_pollset_poll: The "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" specified has expired "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70007")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTotal of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5602")]),s._v(" requests completed\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("æœç„¶, åˆšæ‰æ­£å¸¸è¿è¡Œçš„ ab, ç°åœ¨å¤±è´¥äº†, è¿˜æŠ¥äº†è¿æ¥è¶…æ—¶çš„é”™è¯¯. è¿è¡Œ ab æ—¶çš„ -s å‚æ•°, è®¾ç½®äº†æ¯ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ä¸º 2s, è€Œä»è¾“å‡ºå¯ä»¥çœ‹åˆ°, è¿™æ¬¡åªå®Œæˆäº† 5602 ä¸ªè¯·æ±‚.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶æ˜¯ä¸ºäº†å¾—åˆ° ab çš„æµ‹è¯•ç»“æœ, ä¸å¦¨æŠŠè¶…æ—¶æ—¶é—´å»¶é•¿ä¸€ä¸‹è¯•è¯•, æ¯”å¦‚å»¶é•¿åˆ° 30s. å»¶è¿Ÿå¢å¤§æ„å‘³ç€è¦ç­‰æ›´é•¿æ—¶é—´, ä¸ºäº†å¿«ç‚¹å¾—åˆ°ç»“æœ, å¯ä»¥åŒæ—¶æŠŠæ€»æµ‹è¯•æ¬¡æ•°, ä¹Ÿå‡å°‘åˆ° 10000:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" http://192.168.0.30:8080/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("76.47")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65380.868")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.076")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44.79")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received\n \nConnection Times "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              min  mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+/-sd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" median   max\nConnect:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1300")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5578.0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65184")]),s._v("\nProcessing:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37916")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59283.2")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("130682")]),s._v("\nWaiting:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.7")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("414")]),s._v("\nTotal:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39216")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("58711.6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1021")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("130682")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("å†é‡æ–°çœ‹çœ‹ ab çš„è¾“å‡º, è¿™æ¬¡çš„ç»“æœæ˜¾ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æ¯ç§’è¯·æ±‚æ•°(Requests per second)ä¸º 76;")]),s._v(" "),a("li",[s._v("æ¯ä¸ªè¯·æ±‚çš„å»¶è¿Ÿ(Time per request)ä¸º 65s;")]),s._v(" "),a("li",[s._v("å»ºç«‹è¿æ¥çš„å»¶è¿Ÿ(Connect)ä¸º 1300ms.")])]),s._v(" "),a("p",[s._v("æ˜¾ç„¶, æ¯ä¸ªæŒ‡æ ‡éƒ½æ¯”å‰é¢å·®äº†å¾ˆå¤š.")]),s._v(" "),a("p",[s._v("åœ¨ä¸Šä¸€èŠ‚ä½¿ç”¨ tcpdump æŠ“åŒ…çš„æ–¹æ³•, æ‰¾å‡ºäº†å»¶è¿Ÿå¢å¤§çš„æ ¹æº. é‚£ä¹ˆä»Šå¤©çš„æ¡ˆä¾‹, ä»ç„¶å¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹æ³•å¯»æ‰¾çº¿ç´¢. ä¸è¿‡, ç°åœ¨æ¢ä¸ªæ€è·¯, å› ä¸ºä»Šå¤©å·²ç»äº‹å…ˆçŸ¥é“äº†é—®é¢˜çš„æ ¹æº--é‚£å°±æ˜¯ NAT.")]),s._v(" "),a("p",[s._v("å›å¿†ä¸€ä¸‹ Netfilter ä¸­, ç½‘ç»œåŒ…çš„æµå‘ä»¥åŠ NAT çš„åŸç†ä¼šå‘ç°, è¦ä¿è¯ NAT æ­£å¸¸å·¥ä½œ, å°±è‡³å°‘éœ€è¦ä¸¤ä¸ªæ­¥éª¤:")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, åˆ©ç”¨ Netfilter ä¸­çš„é’©å­å‡½æ•°(Hook), ä¿®æ”¹æºåœ°å€æˆ–è€…ç›®çš„åœ°å€.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, åˆ©ç”¨è¿æ¥è·Ÿè¸ªæ¨¡å— conntrack, å…³è”åŒä¸€ä¸ªè¿æ¥çš„è¯·æ±‚å’Œå“åº”.")])]),s._v(" "),a("p",[s._v("æ˜¯ä¸æ˜¯è¿™ä¸¤ä¸ªåœ°æ–¹å‡ºç°äº†é—®é¢˜å‘¢? ç”¨å‰é¢æåˆ°çš„åŠ¨æ€è¿½è¸ªå·¥å…· SystemTap æ¥è¯•è¯•.")]),s._v(" "),a("p",[s._v("ç”±äºä»Šå¤©æ¡ˆä¾‹æ˜¯åœ¨å‹æµ‹åœºæ™¯ä¸‹, å¹¶å‘è¯·æ±‚æ•°å¤§å¤§é™ä½, å¹¶ä¸”æ¸…æ¥šçŸ¥é“ NAT æ˜¯ç½ªé­ç¥¸é¦–. æ‰€ä»¥æœ‰ç†ç”±æ€€ç–‘, å†…æ ¸ä¸­å‘ç”Ÿäº†"),a("strong",[s._v("ä¸¢åŒ…ç°è±¡")]),s._v(".")]),s._v(" "),a("p",[s._v("å¯ä»¥å›åˆ°ç»ˆç«¯ä¸€ä¸­, åˆ›å»ºä¸€ä¸ª dropwatch.stp çš„è„šæœ¬æ–‡ä»¶, å¹¶å†™å…¥ä¸‹é¢çš„å†…å®¹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /usr/bin/env stap")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("############################################################")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dropwatch.stp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Author: Neil Horman <nhorman@redhat.com>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# An example script to mimic the behavior of the dropwatch utility")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://fedorahosted.org/dropwatch")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("############################################################")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Array to hold the list of drop points we find")]),s._v("\nglobal locations\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note when we turn the monitor on and off")]),s._v("\nprobe begin "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" printf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Monitoring for dropped packets'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nprobe end "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" printf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stopping dropped packet monitor'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# increment a drop counter for every location we drop at")]),s._v("\nprobe kernel.trace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kfree_skb"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" locations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Every 5 seconds report our drop locations")]),s._v("\nprobe timer.sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  printf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  foreach "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" locations-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    printf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%d packets dropped at %s'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(",\n           @count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("locations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("l"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", symname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  delete locations\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[s._v("è¿™ä¸ªè„šæœ¬, è·Ÿè¸ªå†…æ ¸å‡½æ•° kfree_skb() çš„è°ƒç”¨, å¹¶ç»Ÿè®¡ä¸¢åŒ…çš„ä½ç½®. æ–‡ä»¶ä¿å­˜å¥½å, æ‰§è¡Œä¸‹é¢çš„ stap å‘½ä»¤, å°±å¯ä»¥è¿è¡Œä¸¢åŒ…è·Ÿè¸ªè„šæœ¬. è¿™é‡Œçš„ stap, æ˜¯ SystemTap çš„å‘½ä»¤è¡Œå·¥å…·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ stap --all-modules dropwatch.stp\nMonitoring "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" dropped packets\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v('å½“çœ‹åˆ° probe begin è¾“å‡ºçš„ "Monitoring for dropped packets" æ—¶, è¡¨æ˜ SystemTap å·²ç»å°†è„šæœ¬ç¼–è¯‘ä¸ºå†…æ ¸æ¨¡å—, å¹¶å¯åŠ¨è¿è¡Œäº†.')]),s._v(" "),a("p",[s._v("æ¥ç€åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, å†æ¬¡æ‰§è¡Œ ab å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" http://192.168.0.30:8080/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶åå†æ¬¡å›åˆ°ç»ˆç«¯ä¸€ä¸­, è§‚å¯Ÿ stap å‘½ä»¤çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10031")]),s._v(" packets dropped at nf_hook_slow\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("676")]),s._v(" packets dropped at tcp_v4_rcv\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7284")]),s._v(" packets dropped at nf_hook_slow\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("268")]),s._v(" packets dropped at tcp_v4_rcv\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä¼šå‘ç°"),a("strong",[s._v("å¤§é‡ä¸¢åŒ…éƒ½å‘ç”Ÿåœ¨ nf_hook_slow ä½ç½®")]),s._v(". çœ‹åˆ°è¿™ä¸ªåå­—, åº”è¯¥èƒ½æƒ³åˆ°è¿™æ˜¯åœ¨ Netfilter Hook çš„é’©å­å‡½æ•°ä¸­, å‡ºç°ä¸¢åŒ…é—®é¢˜äº†. ä½†æ˜¯ä¸æ˜¯ NAT, è¿˜ä¸èƒ½ç¡®å®š. æ¥ä¸‹æ¥è¿˜å¾—å†è·Ÿè¸ª nf_hook_slow çš„æ‰§è¡Œè¿‡ç¨‹, è¿™ä¸€æ­¥å¯ä»¥é€šè¿‡ perf æ¥å®Œæˆ.")]),s._v(" "),a("p",[s._v("åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, å†æ¬¡æ‰§è¡Œ ab å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" http://192.168.0.30:8080/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶åå†æ¬¡åˆ‡æ¢å›ç»ˆç«¯ä¸€, æ‰§è¡Œ perf record å’Œ perf report å‘½ä»¤")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®°å½•ä¸€ä¼š(æ¯”å¦‚ 30s)åæŒ‰ Ctrl+C ç»“æŸ")]),s._v("\n$ perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¾“å‡ºæŠ¥å‘Š")]),s._v("\n$ perf report "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" graph,0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("åœ¨ perf report ç•Œé¢ä¸­, è¾“å…¥æŸ¥æ‰¾å‘½ä»¤ / ç„¶å, åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­, è¾“å…¥ nf_hook_slow; æœ€åå†å±•å¼€è°ƒç”¨æ ˆ, å°±å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™ä¸ªè°ƒç”¨å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/c43ce48261fc4a4b86998fed4c63395a-20230731161933-5556tk8.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»è¿™ä¸ªå›¾å¯ä»¥çœ‹åˆ°, "),a("strong",[s._v("nf_hook_slow è°ƒç”¨æœ€å¤šçš„æœ‰ä¸‰ä¸ªåœ°æ–¹, åˆ†åˆ«æ˜¯ ipv4_conntrack_in, br_nf_pre_routing ä»¥åŠ iptable_nat_ipv4_in")]),s._v(". æ¢è¨€ä¹‹, nf_hook_slow ä¸»è¦åœ¨æ‰§è¡Œä¸‰ä¸ªåŠ¨ä½œ.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, æ¥æ”¶ç½‘ç»œåŒ…æ—¶, åœ¨è¿æ¥è·Ÿè¸ªè¡¨ä¸­æŸ¥æ‰¾è¿æ¥, å¹¶ä¸ºæ–°çš„è¿æ¥åˆ†é…è·Ÿè¸ªå¯¹è±¡(Bucket).")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, åœ¨ Linux ç½‘æ¡¥ä¸­è½¬å‘åŒ…. è¿™æ˜¯å› ä¸ºæ¡ˆä¾‹ Nginx æ˜¯ä¸€ä¸ª Docker å®¹å™¨, è€Œå®¹å™¨çš„ç½‘ç»œé€šè¿‡ç½‘æ¡¥æ¥å®ç°;")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰, æ¥æ”¶ç½‘ç»œåŒ…æ—¶, æ‰§è¡Œ DNAT, å³æŠŠ 8080 ç«¯å£æ”¶åˆ°çš„åŒ…è½¬å‘ç»™å®¹å™¨.")])]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œ, å…¶å®å°±æ‰¾åˆ°äº†æ€§èƒ½ä¸‹é™çš„ä¸‰ä¸ªæ¥æº. è¿™ä¸‰ä¸ªæ¥æº, "),a("strong",[s._v("éƒ½æ˜¯ Linux çš„å†…æ ¸æœºåˆ¶")]),s._v(", æ‰€ä»¥æ¥ä¸‹æ¥çš„ä¼˜åŒ–, è‡ªç„¶ä¹Ÿæ˜¯è¦ä»å†…æ ¸å…¥æ‰‹.")]),s._v(" "),a("p",[s._v("æ ¹æ®ä»¥å‰å„ä¸ªèµ„æºæ¨¡å—çš„å†…å®¹å¯ä»¥çŸ¥é“, Linux å†…æ ¸ä¸ºç”¨æˆ·æä¾›äº†å¤§é‡çš„"),a("strong",[s._v("å¯é…ç½®é€‰é¡¹")]),s._v(", è¿™äº›é€‰é¡¹å¯ä»¥é€šè¿‡ proc æ–‡ä»¶ç³»ç»Ÿ, æˆ–è€… sys æ–‡ä»¶ç³»ç»Ÿ, æ¥æŸ¥çœ‹å’Œä¿®æ”¹. é™¤æ­¤ä¹‹å¤–, è¿˜å¯ä»¥ç”¨ sysctl è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·, æ¥æŸ¥çœ‹å’Œä¿®æ”¹å†…æ ¸é…ç½®.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä»Šå¤©çš„ä¸»é¢˜æ˜¯ DNAT, è€Œ DNAT çš„åŸºç¡€æ˜¯ conntrack, æ‰€ä»¥å¯ä»¥å…ˆçœ‹çœ‹, å†…æ ¸æä¾›äº†å“ªäº› conntrack çš„é…ç½®é€‰é¡¹.")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸€ä¸­, ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" conntrack\nnet.netfilter.nf_conntrack_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),s._v("\nnet.netfilter.nf_conntrack_max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nnet.netfilter.nf_conntrack_buckets "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\nnet.netfilter.nf_conntrack_tcp_timeout_syn_recv "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\nnet.netfilter.nf_conntrack_tcp_timeout_syn_sent "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v("\nnet.netfilter.nf_conntrack_tcp_timeout_time_wait "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿™é‡Œæœ€é‡è¦çš„ä¸‰ä¸ªæŒ‡æ ‡:")]),s._v(" "),a("ul",[a("li",[s._v("net.netfilter.nf_conntrack_count, è¡¨ç¤º"),a("strong",[s._v("å½“å‰è¿æ¥è·Ÿè¸ªæ•°")]),s._v(";")]),s._v(" "),a("li",[s._v("net.netfilter.nf_conntrack_max, è¡¨ç¤º"),a("strong",[s._v("æœ€å¤§è¿æ¥è·Ÿè¸ªæ•°")]),s._v(";")]),s._v(" "),a("li",[s._v("net.netfilter.nf_conntrack_buckets, è¡¨ç¤º"),a("strong",[s._v("è¿æ¥è·Ÿè¸ªè¡¨çš„å¤§å°")]),s._v(".")])]),s._v(" "),a("p",[s._v("å›æƒ³ä¸€ä¸‹å‰é¢çš„ ab å‘½ä»¤, å¹¶å‘è¯·æ±‚æ•°æ˜¯ 5000, è€Œè¯·æ±‚æ•°æ˜¯ 100000. æ˜¾ç„¶, è·Ÿè¸ªè¡¨è®¾ç½®æˆåªè®°å½• 1000 ä¸ªè¿æ¥, æ˜¯è¿œè¿œä¸å¤Ÿçš„.")]),s._v(" "),a("p",[s._v('å®é™…ä¸Š, å†…æ ¸åœ¨å·¥ä½œå¼‚å¸¸æ—¶, ä¼šæŠŠå¼‚å¸¸ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—ä¸­. æ¯”å¦‚å‰é¢çš„ ab æµ‹è¯•, å†…æ ¸å·²ç»åœ¨æ—¥å¿—ä¸­æŠ¥å‡ºäº† "nf_conntrack: table full" çš„é”™è¯¯. æ‰§è¡Œ dmesg å‘½ä»¤, å°±å¯ä»¥çœ‹åˆ°:')]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104235.156774")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" nf_conntrack: nf_conntrack: table full, dropping packet\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104243.800401")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" net_ratelimit: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3939")]),s._v(" callbacks suppressed\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104243.800401")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" nf_conntrack: nf_conntrack: table full, dropping packet\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104262.962157")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" nf_conntrack: nf_conntrack: table full, dropping packet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v('å…¶ä¸­, net_ratelimit è¡¨ç¤ºæœ‰å¤§é‡çš„æ—¥å¿—è¢«å‹ç¼©æ‰äº†, è¿™æ˜¯å†…æ ¸é¢„é˜²æ—¥å¿—æ”»å‡»çš„ä¸€ç§æªæ–½. è€Œå½“çœ‹åˆ° "nf_conntrack: table full" çš„é”™è¯¯æ—¶, å°±è¡¨æ˜ nf_conntrack_max å¤ªå°äº†.')]),s._v(" "),a("p",[s._v("é‚£æ˜¯ä¸æ˜¯, ç›´æ¥æŠŠè¿æ¥è·Ÿè¸ªè¡¨è°ƒå¤§å°±å¯ä»¥äº†å‘¢? è°ƒèŠ‚å‰å…ˆå¾—æ˜ç™½, è¿æ¥è·Ÿè¸ªè¡¨, å®é™…ä¸Šæ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªå“ˆå¸Œè¡¨. å¦‚æœè¿æ¥è·Ÿè¸ªæ•°è¿‡å¤§, ä¹Ÿä¼šè€—è´¹å¤§é‡å†…å­˜.")]),s._v(" "),a("p",[s._v("å…¶å®, ä¸Šé¢çœ‹åˆ°çš„ nf_conntrack_buckets, å°±æ˜¯å“ˆå¸Œè¡¨çš„å¤§å°. å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸€é¡¹, éƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨(ç§°ä¸º Bucket), è€Œé“¾è¡¨é•¿åº¦, å°±ç­‰äº nf_conntrack_max é™¤ä»¥ nf_conntrack_buckets.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚å¯ä»¥ä¼°ç®—ä¸€ä¸‹, ä¸Šè¿°é…ç½®çš„è¿æ¥è·Ÿè¸ªè¡¨å ç”¨çš„å†…å­˜å¤§å°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿æ¥è·Ÿè¸ªå¯¹è±¡å¤§å°ä¸º 376, é“¾è¡¨é¡¹å¤§å°ä¸º 16")]),s._v("\nnf_conntrack_max* è¿æ¥è·Ÿè¸ªå¯¹è±¡å¤§å° +nf_conntrack_buckets* é“¾è¡¨é¡¹å¤§å° \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("*376+65536*16 B\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(" MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥å°† nf_conntrack_max æ”¹å¤§ä¸€äº›, æ¯”å¦‚æ”¹æˆ 131072(å³ nf_conntrack_buckets çš„ 2 å€):")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.netfilter.nf_conntrack_max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.netfilter.nf_conntrack_buckets")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶åå†åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, é‡æ–°æ‰§è¡Œ ab å‘½ä»¤. æ³¨æ„, è¿™æ¬¡æŠŠè¶…æ—¶æ—¶é—´ä¹Ÿæ”¹å›åŸæ¥çš„ 2s:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" http://192.168.0.30:8080/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6315.99")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/sec] (mean)")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("791.641")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.158")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4985.15")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received\n \nConnection Times "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              min  mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+/-sd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" median   max\nConnect:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("355")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("793.7")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7352")]),s._v("\nProcessing:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("311")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("855.9")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14481")]),s._v("\nWaiting:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("292")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("851.5")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14481")]),s._v("\nTotal:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1216.3")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("148")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14645")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("æœç„¶, ç°åœ¨å¯ä»¥çœ‹åˆ°:")]),s._v(" "),a("ul",[a("li",[s._v("æ¯ç§’è¯·æ±‚æ•°(Requests per second)ä¸º 6315(ä¸ç”¨ NAT æ—¶ä¸º 6576);")]),s._v(" "),a("li",[s._v("æ¯ä¸ªè¯·æ±‚çš„å»¶è¿Ÿ(Time per request)ä¸º 791ms(ä¸ç”¨ NAT æ—¶ä¸º 760ms);")]),s._v(" "),a("li",[s._v("å»ºç«‹è¿æ¥çš„å»¶è¿Ÿ(Connect)ä¸º 355ms(ä¸ç”¨ NAT æ—¶ä¸º 177ms).")])]),s._v(" "),a("p",[s._v("è¿™ä¸ªç»“æœ, å·²ç»æ¯”åˆšæ‰çš„æµ‹è¯•å¥½äº†å¾ˆå¤š, ä¹Ÿå¾ˆæ¥è¿‘æœ€åˆä¸ç”¨ NAT æ—¶çš„åŸºå‡†ç»“æœäº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ä½ å¯èƒ½è¿˜æ˜¯å¾ˆå¥½å¥‡, è¿æ¥è·Ÿè¸ªè¡¨é‡Œ, åˆ°åº•éƒ½åŒ…å«äº†å“ªäº›ä¸œè¥¿? è¿™é‡Œçš„ä¸œè¥¿, åˆæ˜¯æ€ä¹ˆåˆ·æ–°çš„å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, å¯ä»¥"),a("strong",[s._v("ç”¨ conntrack å‘½ä»¤è¡Œå·¥å…·, æ¥æŸ¥çœ‹è¿æ¥è·Ÿè¸ªè¡¨çš„å†…å®¹")]),s._v(". æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -L è¡¨ç¤ºåˆ—è¡¨, -o è¡¨ç¤ºä»¥æ‰©å±•æ ¼å¼æ˜¾ç¤º")]),s._v("\n$ conntrack "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" extended "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v("\nipv4     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" tcp      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" TIME_WAIT "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dst")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.96 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51744")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dst")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51744")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ASSURED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mark")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nipv4     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" tcp      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" TIME_WAIT "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dst")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.96 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51524")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dst")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51524")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ASSURED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mark")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œå¯ä»¥å‘ç°, è¿æ¥è·Ÿè¸ªè¡¨é‡Œçš„å¯¹è±¡, åŒ…æ‹¬äº†"),a("strong",[s._v("åè®®, è¿æ¥çŠ¶æ€, æº IP, æºç«¯å£, ç›®çš„ IP, ç›®çš„ç«¯å£, è·Ÿè¸ªçŠ¶æ€ç­‰")]),s._v(". ç”±äºè¿™ä¸ªæ ¼å¼æ˜¯å›ºå®šçš„, æ‰€ä»¥å¯ä»¥ç”¨ awk, sort ç­‰å·¥å…·, å¯¹å…¶è¿›è¡Œç»Ÿè®¡åˆ†æ.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, è¿˜æ˜¯ä»¥ ab ä¸ºä¾‹. åœ¨ç»ˆç«¯äºŒå¯åŠ¨ ab å‘½ä»¤å, å†å›åˆ°ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»Ÿè®¡æ€»çš„è¿æ¥è·Ÿè¸ªæ•°")]),s._v("\n$ conntrack "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" extended "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14289")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»Ÿè®¡ TCP åè®®å„ä¸ªçŠ¶æ€çš„è¿æ¥è·Ÿè¸ªæ•°")]),s._v("\n$ conntrack "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" extended "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/^.*tcp.*$/ {sum[$6]++} END {for(i in sum) print i, sum[i]}'")]),s._v("\nSYN_RECV "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nCLOSE_WAIT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\nESTABLISHED "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2877")]),s._v("\nFIN_WAIT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nSYN_SENT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2113")]),s._v("\nTIME_WAIT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9283")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»Ÿè®¡å„ä¸ªæº IP çš„è¿æ¥è·Ÿè¸ªæ•°")]),s._v("\n$ conntrack "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" extended "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $7}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"="')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14116")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.96\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("è¿™é‡Œç»Ÿè®¡äº†æ€»è¿æ¥è·Ÿè¸ªæ•°, TCP åè®®å„ä¸ªçŠ¶æ€çš„è¿æ¥è·Ÿè¸ªæ•°, ä»¥åŠå„ä¸ªæº IP çš„è¿æ¥è·Ÿè¸ªæ•°. å¯ä»¥çœ‹åˆ°, å¤§éƒ¨åˆ† TCP çš„è¿æ¥è·Ÿè¸ª, éƒ½å¤„äº TIME_WAIT çŠ¶æ€, å¹¶ä¸”å®ƒä»¬å¤§éƒ½æ¥è‡ªäº 192.168.0.2 è¿™ä¸ª IP åœ°å€(ä¹Ÿå°±æ˜¯è¿è¡Œ ab å‘½ä»¤çš„ VM2).")]),s._v(" "),a("p",[s._v("è¿™äº›å¤„äº TIME_WAIT çš„è¿æ¥è·Ÿè¸ªè®°å½•, ä¼šåœ¨è¶…æ—¶åæ¸…ç†, è€Œé»˜è®¤çš„è¶…æ—¶æ—¶é—´æ˜¯ 120s, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.netfilter.nf_conntrack_tcp_timeout_time_wait\nnet.netfilter.nf_conntrack_tcp_timeout_time_wait "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ‰€ä»¥, å¦‚æœè¿æ¥æ•°éå¸¸å¤§, ç¡®å®ä¹Ÿåº”è¯¥è€ƒè™‘, é€‚å½“å‡å°è¶…æ—¶æ—¶é—´.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-7"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å­¦ä¹ äº†å¦‚ä½•æ’æŸ¥å’Œä¼˜åŒ– NAT å¸¦æ¥çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("ç”±äº NAT åŸºäº Linux å†…æ ¸çš„è¿æ¥è·Ÿè¸ªæœºåˆ¶æ¥å®ç°. æ‰€ä»¥åœ¨åˆ†æ NAT æ€§èƒ½é—®é¢˜æ—¶, å¯ä»¥å…ˆä» conntrack è§’åº¦æ¥åˆ†æ, æ¯”å¦‚ç”¨ systemtap, perf ç­‰, åˆ†æå†…æ ¸ä¸­ conntrack çš„è¡Œæ–‡; ç„¶åé€šè¿‡è°ƒæ•´ netfilter å†…æ ¸é€‰é¡¹çš„å‚æ•°, æ¥è¿›è¡Œä¼˜åŒ–.")]),s._v(" "),a("p",[s._v("å…¶å®, Linux è¿™ç§é€šè¿‡è¿æ¥è·Ÿè¸ªæœºåˆ¶å®ç°çš„ NAT, ä¹Ÿå¸¸è¢«ç§°ä¸º"),a("strong",[s._v("æœ‰çŠ¶æ€çš„ NAT")]),s._v(", è€Œç»´æŠ¤çŠ¶æ€, ä¹Ÿå¸¦æ¥äº†å¾ˆé«˜çš„æ€§èƒ½æˆæœ¬. æ‰€ä»¥, é™¤äº†è°ƒæ•´å†…æ ¸è¡Œä¸ºå¤–, åœ¨ä¸éœ€è¦çŠ¶æ€è·Ÿè¸ªçš„åœºæ™¯ä¸‹(æ¯”å¦‚åªéœ€è¦æŒ‰é¢„å®šçš„ IP å’Œç«¯å£è¿›è¡Œæ˜ å°„, è€Œä¸éœ€è¦åŠ¨æ€æ˜ å°„), ä¹Ÿå¯ä»¥ä½¿ç”¨æ— çŠ¶æ€çš„ NAT (æ¯”å¦‚ç”¨ tc æˆ–åŸºäº DPDK å¼€å‘), æ¥è¿›ä¸€æ­¥æå‡æ€§èƒ½.")]),s._v(" "),a("h4",{attrs:{id:"_43-å¥—è·¯ç¯‡-ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_43-å¥—è·¯ç¯‡-ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯"}},[s._v("#")]),s._v(" 43-å¥—è·¯ç¯‡:ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯")]),s._v(" "),a("p",[s._v("æ‰¾åˆ°ç½‘ç»œæ€§èƒ½ç“¶é¢ˆå, ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯ä¼˜åŒ–äº†, ä¹Ÿå°±æ˜¯"),a("strong",[s._v("å¦‚ä½•é™ä½ç½‘ç»œå»¶è¿Ÿ, å¹¶æé«˜ç½‘ç»œçš„ååé‡")]),s._v(". å­¦å®Œç›¸å…³åŸç†å’Œæ¡ˆä¾‹åå°±æ¥è®²è®², ä¼˜åŒ–ç½‘ç»œæ€§èƒ½é—®é¢˜çš„æ€è·¯å’Œä¸€äº›æ³¨æ„äº‹é¡¹.")]),s._v(" "),a("h5",{attrs:{id:"_1-ç¡®å®šä¼˜åŒ–ç›®æ ‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç¡®å®šä¼˜åŒ–ç›®æ ‡"}},[s._v("#")]),s._v(" 1.ç¡®å®šä¼˜åŒ–ç›®æ ‡")]),s._v(" "),a("p",[s._v("è·Ÿ CPU å’Œ I/O æ–¹é¢çš„æ€§èƒ½ä¼˜åŒ–ä¸€æ ·, ä¼˜åŒ–å‰è€ƒè™‘ä¸‹"),a("strong",[s._v("ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡")]),s._v("æ˜¯ä»€ä¹ˆ? æ¢å¥è¯è¯´, è§‚å¯Ÿåˆ°çš„ç½‘ç»œæ€§èƒ½æŒ‡æ ‡, è¦è¾¾åˆ°å¤šå°‘æ‰åˆé€‚å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, è™½ç„¶ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„æ•´ä½“ç›®æ ‡, æ˜¯"),a("strong",[s._v("é™ä½ç½‘ç»œå»¶è¿Ÿ(å¦‚ RTT)å’Œæé«˜ååé‡(å¦‚ BPS å’Œ PPS)")]),s._v(" , ä½†å…·ä½“åˆ°ä¸åŒåº”ç”¨ä¸­, æ¯ä¸ªæŒ‡æ ‡çš„ä¼˜åŒ–æ ‡å‡†å¯èƒ½ä¼šä¸åŒ, ä¼˜å…ˆçº§é¡ºåºä¹Ÿå¤§ç›¸å¾„åº­.")]),s._v(" "),a("p",[s._v("å°±æ‹¿ä¸Šä¸€èŠ‚æåˆ°çš„ NAT ç½‘å…³æ¥è¯´, ç”±äºå…¶ç›´æ¥å½±å“æ•´ä¸ªæ•°æ®ä¸­å¿ƒçš„ç½‘ç»œå‡ºå…¥æ€§èƒ½, æ‰€ä»¥ NAT ç½‘å…³é€šå¸¸éœ€è¦è¾¾åˆ°æˆ–æ¥è¿‘çº¿æ€§è½¬å‘, ä¹Ÿå°±æ˜¯è¯´, PPS æ˜¯æœ€ä¸»è¦çš„æ€§èƒ½ç›®æ ‡.")]),s._v(" "),a("p",[s._v("å†å¦‚, å¯¹äºæ•°æ®åº“, ç¼“å­˜ç­‰ç³»ç»Ÿ, å¿«é€Ÿå®Œæˆç½‘ç»œæ”¶å‘, å³ä½å»¶è¿Ÿ, æ˜¯ä¸»è¦çš„æ€§èƒ½ç›®æ ‡.")]),s._v(" "),a("p",[s._v("è€Œå¯¹äºç»å¸¸è®¿é—®çš„ Web æœåŠ¡æ¥è¯´, åˆ™éœ€è¦åŒæ—¶å…¼é¡¾ååé‡å’Œå»¶è¿Ÿ.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ä¸ºäº†æ›´å®¢è§‚åˆç†åœ°è¯„ä¼°ä¼˜åŒ–æ•ˆæœ, é¦–å…ˆåº”è¯¥æ˜ç¡®ä¼˜åŒ–çš„æ ‡å‡†, å³è¦å¯¹ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºè¿›è¡ŒåŸºå‡†æµ‹è¯•, å¾—åˆ°ç½‘ç»œåè®®æ ˆå„å±‚çš„åŸºå‡†æ€§èƒ½.")]),s._v(" "),a("p",[s._v("å‰é¢ä»‹ç»è¿‡ç½‘ç»œæ€§èƒ½æµ‹è¯•çš„æ–¹æ³•. ç®€å•å›é¡¾ä¸€ä¸‹, Linux ç½‘ç»œåè®®æ ˆ, æ˜¯éœ€è¦æŒæ¡çš„æ ¸å¿ƒåŸç†. å®ƒæ˜¯åŸºäº TCP/IP åè®®æ—çš„åˆ†å±‚ç»“æ„, æˆ‘ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºè¿™ä¸ªç»“æ„.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/a8cbf1dce0262c391dc836f337a9ce2e-20230731161933-6nynejz.png",alt:""}})]),s._v(" "),a("p",[s._v("æ˜ç™½äº†è¿™ä¸€ç‚¹, åœ¨è¿›è¡ŒåŸºå‡†æµ‹è¯•æ—¶, å°±å¯ä»¥æŒ‰ç…§åè®®æ ˆçš„æ¯ä¸€å±‚æ¥æµ‹è¯•. ç”±äºåº•å±‚æ˜¯å…¶ä¸Šæ–¹å„å±‚çš„åŸºç¡€, åº•å±‚æ€§èƒ½ä¹Ÿå°±å†³å®šäº†é«˜å±‚æ€§èƒ½. æ‰€ä»¥è¦æ¸…æ¥š, åº•å±‚æ€§èƒ½æŒ‡æ ‡, å…¶å®å°±æ˜¯å¯¹åº”é«˜å±‚çš„æé™æ€§èƒ½. ä¸‹é¢ä»ä¸‹åˆ°ä¸Šæ¥ç†è§£è¿™ä¸€ç‚¹.")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ˜¯ç½‘ç»œæ¥å£å±‚å’Œç½‘ç»œå±‚, å®ƒä»¬ä¸»è¦è´Ÿè´£ç½‘ç»œåŒ…çš„å°è£…, å¯»å€, è·¯ç”±, ä»¥åŠå‘é€å’Œæ¥æ”¶. "),a("strong",[s._v("æ¯ç§’å¯å¤„ç†çš„ç½‘ç»œåŒ…æ•° PPS, å°±æ˜¯å®ƒä»¬æœ€é‡è¦çš„æ€§èƒ½æŒ‡æ ‡(ç‰¹åˆ«æ˜¯åœ¨å°åŒ…çš„æƒ…å†µä¸‹)")]),s._v(" . å¯ä»¥ç”¨å†…æ ¸è‡ªå¸¦çš„å‘åŒ…å·¥å…· pktgen, æ¥æµ‹è¯• PPS çš„æ€§èƒ½.")]),s._v(" "),a("p",[s._v("å†å‘ä¸Šåˆ°ä¼ è¾“å±‚çš„ TCP å’Œ UDP, å®ƒä»¬ä¸»è¦è´Ÿè´£ç½‘ç»œä¼ è¾“. å¯¹å®ƒä»¬è€Œè¨€, "),a("strong",[s._v("ååé‡(BPS), è¿æ¥æ•°ä»¥åŠå»¶è¿Ÿ, å°±æ˜¯æœ€é‡è¦çš„æ€§èƒ½æŒ‡æ ‡")]),s._v(". å¯ä»¥ç”¨ iperf æˆ– netperf, æ¥æµ‹è¯•ä¼ è¾“å±‚çš„æ€§èƒ½. ä¸è¿‡è¦æ³¨æ„, ç½‘ç»œåŒ…çš„å¤§å°, ä¼šç›´æ¥å½±å“è¿™äº›æŒ‡æ ‡çš„å€¼. æ‰€ä»¥é€šå¸¸éœ€è¦æµ‹è¯•ä¸€ç³»åˆ—ä¸åŒå¤§å°ç½‘ç»œåŒ…çš„æ€§èƒ½.")]),s._v(" "),a("p",[s._v("æœ€å, å†å¾€ä¸Šåˆ°äº†åº”ç”¨å±‚, "),a("strong",[s._v("æœ€éœ€è¦å…³æ³¨çš„æ˜¯ååé‡(BPS), æ¯ç§’è¯·æ±‚æ•°ä»¥åŠå»¶è¿Ÿç­‰æŒ‡æ ‡")]),s._v(". å¯ä»¥ç”¨ wrk, ab ç­‰å·¥å…·, æ¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„æ€§èƒ½.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™é‡Œè¦æ³¨æ„çš„æ˜¯, æµ‹è¯•åœºæ™¯è¦å°½é‡æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒ, è¿™æ ·çš„æµ‹è¯•æ‰æ›´æœ‰ä»·å€¼. æ¯”å¦‚å¯ä»¥åˆ°ç”Ÿäº§ç¯å¢ƒä¸­, å½•åˆ¶å®é™…çš„è¯·æ±‚æƒ…å†µ, å†åˆ°æµ‹è¯•ä¸­å›æ”¾.")]),s._v(" "),a("p",[s._v("æ€»ä¹‹, æ ¹æ®è¿™äº›åŸºå‡†æŒ‡æ ‡, å†ç»“åˆå·²ç»è§‚å¯Ÿåˆ°çš„æ€§èƒ½ç“¶é¢ˆ, å°±å¯ä»¥æ˜ç¡®æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡.")]),s._v(" "),a("h5",{attrs:{id:"_2-ç½‘ç»œæ€§èƒ½å·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç½‘ç»œæ€§èƒ½å·¥å…·"}},[s._v("#")]),s._v(" 2.ç½‘ç»œæ€§èƒ½å·¥å…·")]),s._v(" "),a("p",[s._v("åŒå‰é¢å­¦ä¹ ä¸€æ ·, å»ºè®®ä»æŒ‡æ ‡å’Œå·¥å…·ä¸¤ä¸ªä¸åŒç»´åº¦å‡ºå‘, æ•´ç†è®°å¿†ç½‘ç»œç›¸å…³çš„æ€§èƒ½å·¥å…·.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ä¸ªç»´åº¦, ä»ç½‘ç»œ"),a("mark",[a("strong",[s._v("æ€§èƒ½æŒ‡æ ‡")])]),s._v("å‡ºå‘, æ›´å®¹æ˜“æŠŠæ€§èƒ½å·¥å…·åŒç³»ç»Ÿå·¥ä½œåŸç†å…³è”èµ·æ¥, å¯¹æ€§èƒ½é—®é¢˜æœ‰å®è§‚çš„è®¤è¯†å’ŒæŠŠæ¡. è¿™æ ·, å½“æƒ³æŸ¥çœ‹æŸä¸ªæ€§èƒ½æŒ‡æ ‡æ—¶, å°±èƒ½æ¸…æ¥šçŸ¥é“, å¯ä»¥ç”¨å“ªäº›å·¥å…·.")]),s._v(" "),a("p",[s._v("è¿™é‡ŒæŠŠæä¾›ç½‘ç»œæ€§èƒ½æŒ‡æ ‡çš„å·¥å…·, åšæˆäº†ä¸€ä¸ªè¡¨æ ¼, æ–¹ä¾¿ä½ æ¢³ç†å…³ç³»å’Œç†è§£è®°å¿†.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1fd4401b7a6f35cf6547982640e47cb8-20230731161933-svg3cjt.png",alt:""}})]),s._v(" "),a("p",[s._v("å†æ¥çœ‹ç¬¬äºŒä¸ªç»´åº¦, ä»"),a("mark",[a("strong",[s._v("æ€§èƒ½å·¥å…·")])]),s._v("å‡ºå‘. åŒæ ·çš„, ä¹Ÿå°†è¿™äº›å¸¸ç”¨å·¥å…·, æ±‡æ€»æˆäº†ä¸€ä¸ªè¡¨æ ¼.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/e50dbbe151a8be71a4269693511ce93d-20230731161933-3hyfv0p.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_3-ç½‘ç»œæ€§èƒ½ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç½‘ç»œæ€§èƒ½ä¼˜åŒ–"}},[s._v("#")]),s._v(" 3.ç½‘ç»œæ€§èƒ½ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("æ€»çš„æ¥è¯´, "),a("strong",[s._v("å…ˆè¦è·å¾—ç½‘ç»œåŸºå‡†æµ‹è¯•æŠ¥å‘Š, ç„¶åé€šè¿‡ç›¸å…³æ€§èƒ½å·¥å…·, å®šä½å‡ºç½‘ç»œæ€§èƒ½ç“¶é¢ˆ")]),s._v(". å†æ¥ä¸‹æ¥çš„ä¼˜åŒ–å·¥ä½œ, å°±æ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…äº†.")]),s._v(" "),a("p",[s._v("å½“ç„¶, è¿˜æ˜¯é‚£å¥è¯, è¦ä¼˜åŒ–ç½‘ç»œæ€§èƒ½, è‚¯å®šç¦»ä¸å¼€ Linux ç³»ç»Ÿçš„ç½‘ç»œåè®®æ ˆå’Œç½‘ç»œæ”¶å‘æµç¨‹çš„è¾…åŠ©. å¯ä»¥ç»“åˆä¸‹é¢è¿™å¼ å›¾å†å›å¿†ä¸€ä¸‹è¿™éƒ¨åˆ†çš„çŸ¥è¯†.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/553918d989c0cd114b3cc5bc2011e620-20230731161933-k10nqfv.png",alt:""}})]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±å¯ä»¥ä»"),a("strong",[s._v("åº”ç”¨ç¨‹åº, å¥—æ¥å­—, ä¼ è¾“å±‚, ç½‘ç»œå±‚ä»¥åŠé“¾è·¯å±‚")]),s._v("ç­‰å‡ ä¸ªè§’åº¦, åˆ†åˆ«æ¥çœ‹ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„åŸºæœ¬æ€è·¯.")]),s._v(" "),a("h6",{attrs:{id:"_1-åº”ç”¨ç¨‹åº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-åº”ç”¨ç¨‹åº"}},[s._v("#")]),s._v(" (1)åº”ç”¨ç¨‹åº")]),s._v(" "),a("p",[s._v("åº”ç”¨ç¨‹åº, é€šå¸¸é€šè¿‡å¥—æ¥å­—æ¥å£è¿›è¡Œç½‘ç»œæ“ä½œ. ç”±äºç½‘ç»œæ”¶å‘é€šå¸¸æ¯”è¾ƒè€—æ—¶, æ‰€ä»¥åº”ç”¨ç¨‹åºçš„ä¼˜åŒ–, ä¸»è¦å°±æ˜¯"),a("strong",[s._v("å¯¹ç½‘ç»œ I/O å’Œè¿›ç¨‹è‡ªèº«çš„å·¥ä½œæ¨¡å‹çš„ä¼˜åŒ–")]),s._v(".")]),s._v(" "),a("p",[s._v("ä»"),a("mark",[a("strong",[s._v("ç½‘ç»œ I/O çš„è§’åº¦")])]),s._v("æ¥è¯´, ä¸»è¦æœ‰ä¸‹é¢ä¸¤ç§ä¼˜åŒ–æ€è·¯.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§æ˜¯"),a("strong",[s._v("æœ€å¸¸ç”¨çš„ I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ epoll")]),s._v(", ä¸»è¦ç”¨æ¥å–ä»£ select å’Œ poll. è¿™å…¶å®æ˜¯è§£å†³ C10K é—®é¢˜çš„å…³é”®, ä¹Ÿæ˜¯ç›®å‰å¾ˆå¤šç½‘ç»œåº”ç”¨é»˜è®¤ä½¿ç”¨çš„æœºåˆ¶.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§æ˜¯"),a("strong",[s._v("ä½¿ç”¨å¼‚æ­¥ I/O")]),s._v("(Asynchronous I/O, AIO). AIO å…è®¸åº”ç”¨ç¨‹åºåŒæ—¶å‘èµ·å¾ˆå¤š I/O æ“ä½œ, è€Œä¸ç”¨ç­‰å¾…è¿™äº›æ“ä½œå®Œæˆ. ç­‰åˆ° I/O å®Œæˆå, ç³»ç»Ÿä¼šç”¨äº‹ä»¶é€šçŸ¥çš„æ–¹å¼, å‘Šè¯‰åº”ç”¨ç¨‹åºç»“æœ. ä¸è¿‡, AIO çš„ä½¿ç”¨æ¯”è¾ƒå¤æ‚, éœ€è¦å°å¿ƒå¤„ç†å¾ˆå¤šè¾¹ç¼˜æƒ…å†µ.")])]),s._v(" "),a("p",[s._v("è€Œä»"),a("mark",[a("strong",[s._v("è¿›ç¨‹çš„å·¥ä½œæ¨¡å‹")])]),s._v("æ¥è¯´, ä¹Ÿæœ‰ä¸¤ç§ä¸åŒçš„æ¨¡å‹ç”¨æ¥ä¼˜åŒ–.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§, "),a("strong",[s._v("ä¸»è¿›ç¨‹ + å¤šä¸ª worker å­è¿›ç¨‹")]),s._v(". å…¶ä¸­, ä¸»è¿›ç¨‹è´Ÿè´£ç®¡ç†ç½‘ç»œè¿æ¥, è€Œå­è¿›ç¨‹è´Ÿè´£å®é™…çš„ä¸šåŠ¡å¤„ç†. è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ¨¡å‹.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§, "),a("strong",[s._v("ç›‘å¬åˆ°ç›¸åŒç«¯å£çš„å¤šè¿›ç¨‹æ¨¡å‹")]),s._v(". åœ¨è¿™ç§æ¨¡å‹ä¸‹, æ‰€æœ‰è¿›ç¨‹éƒ½ä¼šç›‘å¬ç›¸åŒæ¥å£, å¹¶ä¸”å¼€å¯ SO_REUSEPORT é€‰é¡¹, ç”±å†…æ ¸è´Ÿè´£, æŠŠè¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°è¿™äº›ç›‘å¬è¿›ç¨‹ä¸­å».")])]),s._v(" "),a("p",[s._v("é™¤äº†ç½‘ç»œ I/O å’Œè¿›ç¨‹çš„å·¥ä½œæ¨¡å‹å¤–, "),a("mark",[a("strong",[s._v("åº”ç”¨å±‚çš„ç½‘ç»œåè®®ä¼˜åŒ–")])]),s._v(", ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ä¸€ç‚¹. ä¸‹é¢æ€»ç»“äº†å¸¸è§çš„å‡ ç§ä¼˜åŒ–æ–¹æ³•.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä½¿ç”¨é•¿è¿æ¥å–ä»£çŸ­è¿æ¥, å¯ä»¥æ˜¾è‘—é™ä½ TCP å»ºç«‹è¿æ¥çš„æˆæœ¬")]),s._v(". åœ¨æ¯ç§’è¯·æ±‚æ¬¡æ•°è¾ƒå¤šæ—¶, è¿™æ ·åšçš„æ•ˆæœéå¸¸æ˜æ˜¾.")]),s._v(" "),a("li",[a("strong",[s._v("ä½¿ç”¨å†…å­˜ç­‰æ–¹å¼, æ¥ç¼“å­˜ä¸å¸¸å˜åŒ–çš„æ•°æ®")]),s._v(", å¯ä»¥é™ä½ç½‘ç»œ I/O æ¬¡æ•°, åŒæ—¶åŠ å¿«åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦.")]),s._v(" "),a("li",[a("strong",[s._v("ä½¿ç”¨ Protocol Buffer ç­‰åºåˆ—åŒ–çš„æ–¹å¼")]),s._v(", å‹ç¼©ç½‘ç»œ I/O çš„æ•°æ®é‡, å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„åå.")]),s._v(" "),a("li",[a("strong",[s._v("ä½¿ç”¨ DNS ç¼“å­˜, é¢„å–, HTTPDNS ç­‰æ–¹å¼, å‡å°‘ DNS è§£æçš„å»¶è¿Ÿ")]),s._v(", ä¹Ÿå¯ä»¥æå‡ç½‘ç»œ I/O çš„æ•´ä½“é€Ÿåº¦.")])]),s._v(" "),a("h6",{attrs:{id:"_2-å¥—æ¥å­—"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¥—æ¥å­—"}},[s._v("#")]),s._v(" (2)å¥—æ¥å­—")]),s._v(" "),a("p",[s._v("å¥—æ¥å­—å¯ä»¥å±è”½æ‰ Linux å†…æ ¸ä¸­ä¸åŒåè®®çš„å·®å¼‚, ä¸ºåº”ç”¨ç¨‹åºæä¾›ç»Ÿä¸€çš„è®¿é—®æ¥å£. æ¯ä¸ªå¥—æ¥å­—, éƒ½æœ‰ä¸€ä¸ªè¯»å†™ç¼“å†²åŒº.")]),s._v(" "),a("ul",[a("li",[s._v("è¯»ç¼“å†²åŒº, ç¼“å­˜äº†è¿œç«¯å‘è¿‡æ¥çš„æ•°æ®. å¦‚æœè¯»ç¼“å†²åŒºå·²æ»¡, å°±ä¸èƒ½å†æ¥æ”¶æ–°çš„æ•°æ®.")]),s._v(" "),a("li",[s._v("å†™ç¼“å†²åŒº, ç¼“å­˜äº†è¦å‘å‡ºå»çš„æ•°æ®. å¦‚æœå†™ç¼“å†²åŒºå·²æ»¡, åº”ç”¨ç¨‹åºçš„å†™æ“ä½œå°±ä¼šè¢«é˜»å¡.")])]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ä¸ºäº†æé«˜ç½‘ç»œçš„ååé‡, é€šå¸¸éœ€è¦è°ƒæ•´è¿™äº›ç¼“å†²åŒºçš„å¤§å°. æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å¢å¤§æ¯ä¸ªå¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°")]),s._v(" net.core.optmem_max;")]),s._v(" "),a("li",[a("strong",[s._v("å¢å¤§å¥—æ¥å­—æ¥æ”¶ç¼“å†²åŒºå¤§å°")]),s._v(" net.core.rmem_max å’Œå‘é€ç¼“å†²åŒºå¤§å° net.core.wmem_max;")]),s._v(" "),a("li",[a("strong",[s._v("å¢å¤§ TCP æ¥æ”¶ç¼“å†²åŒºå¤§å°")]),s._v(" net.ipv4.tcp_rmem å’Œå‘é€ç¼“å†²åŒºå¤§å° net.ipv4.tcp_wmem.")])]),s._v(" "),a("p",[s._v("è‡³äºå¥—æ¥å­—çš„å†…æ ¸é€‰é¡¹, æˆ‘æŠŠå®ƒä»¬æ•´ç†æˆäº†ä¸€ä¸ªè¡¨æ ¼:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/5f62ebae236c0cf7d8668b537488afb8-20230731161933-k8hxpqt.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¸è¿‡æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„.")]),s._v(" "),a("ul",[a("li",[s._v("tcp_rmem å’Œ tcp_wmem çš„ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«æ˜¯ min, default, max, ç³»ç»Ÿä¼šæ ¹æ®è¿™äº›è®¾ç½®, è‡ªåŠ¨è°ƒæ•´ TCP æ¥æ”¶/å‘é€ç¼“å†²åŒºçš„å¤§å°.")]),s._v(" "),a("li",[s._v("udp_mem çš„ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«æ˜¯ min, pressure, max, ç³»ç»Ÿä¼šæ ¹æ®è¿™äº›è®¾ç½®, è‡ªåŠ¨è°ƒæ•´ UDP å‘é€ç¼“å†²åŒºçš„å¤§å°.")])]),s._v(" "),a("p",[s._v("å½“ç„¶, è¡¨æ ¼ä¸­çš„æ•°å€¼åªæä¾›å‚è€ƒä»·å€¼, å…·ä½“åº”è¯¥è®¾ç½®å¤šå°‘, è¿˜éœ€è¦æ ¹æ®å®é™…çš„ç½‘ç»œçŠ¶å†µæ¥ç¡®å®š. æ¯”å¦‚, å‘é€ç¼“å†²åŒºå¤§å°, ç†æƒ³æ•°å€¼æ˜¯"),a("strong",[s._v("ååé‡ * å»¶è¿Ÿ")]),s._v(", è¿™æ ·æ‰å¯ä»¥è¾¾åˆ°æœ€å¤§ç½‘ç»œåˆ©ç”¨ç‡.")]),s._v(" "),a("p",[s._v("é™¤æ­¤ä¹‹å¤–, å¥—æ¥å­—æ¥å£è¿˜æä¾›äº†ä¸€äº›é…ç½®é€‰é¡¹, ç”¨æ¥ä¿®æ”¹ç½‘ç»œè¿æ¥çš„è¡Œä¸º:")]),s._v(" "),a("ul",[a("li",[s._v("ä¸º TCP è¿æ¥è®¾ç½® TCP_NODELAY å, å°±å¯ä»¥ç¦ç”¨ Nagle ç®—æ³•;")]),s._v(" "),a("li",[s._v("ä¸º TCP è¿æ¥å¼€å¯ TCP_CORK å, å¯ä»¥è®©å°åŒ…èšåˆæˆå¤§åŒ…åå†å‘é€(æ³¨æ„ä¼šé˜»å¡å°åŒ…çš„å‘é€);")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ SO_SNDBUF å’Œ SO_RCVBUF, å¯ä»¥åˆ†åˆ«è°ƒæ•´å¥—æ¥å­—å‘é€ç¼“å†²åŒºå’Œæ¥æ”¶ç¼“å†²åŒºçš„å¤§å°.")])]),s._v(" "),a("h6",{attrs:{id:"_3-ä¼ è¾“å±‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¼ è¾“å±‚"}},[s._v("#")]),s._v(" (3)ä¼ è¾“å±‚")]),s._v(" "),a("p",[s._v("ä¼ è¾“å±‚æœ€é‡è¦çš„æ˜¯ TCP å’Œ UDP åè®®, æ‰€ä»¥è¿™å„¿çš„ä¼˜åŒ–, å…¶å®ä¸»è¦å°±æ˜¯å¯¹è¿™ä¸¤ç§åè®®çš„ä¼˜åŒ–.")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ¥çœ‹ TCP åè®®çš„ä¼˜åŒ–.")]),s._v(" "),a("p",[s._v("TCP æä¾›äº†é¢å‘è¿æ¥çš„å¯é ä¼ è¾“æœåŠ¡. è¦ä¼˜åŒ– TCP, é¦–å…ˆè¦æŒæ¡ TCP åè®®çš„åŸºæœ¬åŸç†, æ¯”å¦‚æµé‡æ§åˆ¶, æ…¢å¯åŠ¨, æ‹¥å¡é¿å…, å»¶è¿Ÿç¡®è®¤ä»¥åŠçŠ¶æ€æµå›¾(å¦‚ä¸‹å›¾æ‰€ç¤º)ç­‰.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/de4635aef2aaa36ac9664116ae860487-20230731161933-qstxgyz.png",alt:""}})]),s._v(" "),a("p",[s._v("å…³äºè¿™äº›åŸç†çš„ç»†èŠ‚å°±ä¸å†å±•å¼€è®²è§£äº†. æŒæ¡è¿™äº›åŸç†å, å°±å¯ä»¥åœ¨ä¸ç ´å TCP æ­£å¸¸å·¥ä½œçš„åŸºç¡€ä¸Š, å¯¹å®ƒè¿›è¡Œä¼˜åŒ–. ä¸‹é¢åˆ†å‡ ç±»æƒ…å†µè¯¦ç»†è¯´æ˜.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç±», "),a("strong",[s._v("åœ¨è¯·æ±‚æ•°æ¯”è¾ƒå¤§çš„åœºæ™¯ä¸‹, å¯èƒ½ä¼šçœ‹åˆ°å¤§é‡å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥, å®ƒä»¬ä¼šå ç”¨å¤§é‡å†…å­˜å’Œç«¯å£èµ„æº")]),s._v(". è¿™æ—¶å¯ä»¥ä¼˜åŒ–ä¸ TIME_WAIT çŠ¶æ€ç›¸å…³çš„å†…æ ¸é€‰é¡¹, æ¯”å¦‚é‡‡å–ä¸‹é¢å‡ ç§æªæ–½.")]),s._v(" "),a("ul",[a("li",[s._v("å¢å¤§å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥æ•°é‡ net.ipv4.tcp_max_tw_buckets, å¹¶å¢å¤§è¿æ¥è·Ÿè¸ªè¡¨çš„å¤§å° net.netfilter.nf_conntrack_max.")]),s._v(" "),a("li",[s._v("å‡å° net.ipv4.tcp_fin_timeout å’Œ net.netfilter.nf_conntrack_tcp_timeout_time_wait, è®©ç³»ç»Ÿå°½å¿«é‡Šæ”¾å®ƒä»¬æ‰€å ç”¨çš„èµ„æº.")]),s._v(" "),a("li",[s._v("å¼€å¯ç«¯å£å¤ç”¨ net.ipv4.tcp_tw_reuse. è¿™æ ·è¢« TIME_WAIT çŠ¶æ€å ç”¨çš„ç«¯å£, è¿˜èƒ½ç”¨åˆ°æ–°å»ºçš„è¿æ¥ä¸­.")]),s._v(" "),a("li",[s._v("å¢å¤§æœ¬åœ°ç«¯å£çš„èŒƒå›´ net.ipv4.ip_local_port_range. è¿™æ ·å°±å¯ä»¥æ”¯æŒæ›´å¤šè¿æ¥, æé«˜æ•´ä½“çš„å¹¶å‘èƒ½åŠ›.")]),s._v(" "),a("li",[s._v("å¢åŠ æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡. ä½ å¯ä»¥ä½¿ç”¨ fs.nr_open å’Œ fs.file-max, åˆ†åˆ«å¢å¤§è¿›ç¨‹å’Œç³»ç»Ÿçš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°; æˆ–åœ¨åº”ç”¨ç¨‹åºçš„ systemd é…ç½®æ–‡ä»¶ä¸­, é…ç½® LimitNOFILE, è®¾ç½®åº”ç”¨ç¨‹åºçš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°.")])]),s._v(" "),a("p",[s._v("ç¬¬äºŒç±», "),a("strong",[s._v("ä¸ºäº†ç¼“è§£ SYN FLOOD ç­‰, åˆ©ç”¨ TCP åè®®ç‰¹ç‚¹è¿›è¡Œæ”»å‡»è€Œå¼•å‘çš„æ€§èƒ½é—®é¢˜, å¯ä»¥è€ƒè™‘ä¼˜åŒ–ä¸ SYN çŠ¶æ€ç›¸å…³çš„å†…æ ¸é€‰é¡¹")]),s._v(", æ¯”å¦‚é‡‡å–ä¸‹é¢å‡ ç§æªæ–½.")]),s._v(" "),a("ul",[a("li",[s._v("å¢å¤§ TCP åŠè¿æ¥çš„æœ€å¤§æ•°é‡ net.ipv4.tcp_max_syn_backlog, æˆ–è€…å¼€å¯ TCP SYN Cookies net.ipv4.tcp_syncookies, æ¥ç»•å¼€åŠè¿æ¥æ•°é‡é™åˆ¶çš„é—®é¢˜(æ³¨æ„, è¿™ä¸¤ä¸ªé€‰é¡¹ä¸å¯åŒæ—¶ä½¿ç”¨).")]),s._v(" "),a("li",[s._v("å‡å°‘ SYN_RECV çŠ¶æ€çš„è¿æ¥é‡ä¼  SYN+ACK åŒ…çš„æ¬¡æ•° net.ipv4.tcp_synack_retries.")])]),s._v(" "),a("p",[s._v("ç¬¬ä¸‰ç±», åœ¨é•¿è¿æ¥çš„åœºæ™¯ä¸­, é€šå¸¸ä½¿ç”¨ Keepalive æ¥æ£€æµ‹ TCP è¿æ¥çš„çŠ¶æ€, ä»¥ä¾¿å¯¹ç«¯è¿æ¥æ–­å¼€å, å¯ä»¥è‡ªåŠ¨å›æ”¶. ä½†æ˜¯, ç³»ç»Ÿé»˜è®¤çš„ Keepalive æ¢æµ‹é—´éš”å’Œé‡è¯•æ¬¡æ•°, ä¸€èˆ¬éƒ½æ— æ³•æ»¡è¶³åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¦æ±‚. æ‰€ä»¥, è¿™æ—¶å€™éœ€è¦"),a("strong",[s._v("ä¼˜åŒ–ä¸ Keepalive ç›¸å…³çš„å†…æ ¸é€‰é¡¹")]),s._v(", æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("ç¼©çŸ­æœ€åä¸€æ¬¡æ•°æ®åŒ…åˆ° Keepalive æ¢æµ‹åŒ…çš„é—´éš”æ—¶é—´ net.ipv4.tcp_keepalive_time;")]),s._v(" "),a("li",[s._v("ç¼©çŸ­å‘é€ Keepalive æ¢æµ‹åŒ…çš„é—´éš”æ—¶é—´ net.ipv4.tcp_keepalive_intvl;")]),s._v(" "),a("li",[s._v("å‡å°‘ Keepalive æ¢æµ‹å¤±è´¥å, ä¸€ç›´åˆ°é€šçŸ¥åº”ç”¨ç¨‹åºå‰çš„é‡è¯•æ¬¡æ•° net.ipv4.tcp_keepalive_probes.")])]),s._v(" "),a("p",[s._v("è®²äº†è¿™ä¹ˆå¤š TCP ä¼˜åŒ–æ–¹æ³•, æˆ‘ä¹ŸæŠŠå®ƒä»¬æ•´ç†æˆäº†ä¸€ä¸ªè¡¨æ ¼, æ–¹ä¾¿ä½ åœ¨éœ€è¦æ—¶å‚è€ƒ(æ•°å€¼ä»…ä¾›å‚è€ƒ, å…·ä½“é…ç½®è¿˜è¦ç»“åˆå®é™…åœºæ™¯æ¥è°ƒæ•´):")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/6e6042d50fd83f75fbf5b693830be92d-20230731161933-ef6p9dr.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¼˜åŒ– TCP æ€§èƒ½æ—¶, è¿˜è¦æ³¨æ„, å¦‚æœåŒæ—¶ä½¿ç”¨ä¸åŒä¼˜åŒ–æ–¹æ³•, å¯èƒ½ä¼šäº§ç”Ÿå†²çª. æ¯”å¦‚, å°±åƒç½‘ç»œè¯·æ±‚å»¶è¿Ÿçš„æ¡ˆä¾‹ä¸­æ›¾ç»åˆ†æè¿‡çš„, æœåŠ¡å™¨ç«¯å¼€å¯ Nagle ç®—æ³•, è€Œå®¢æˆ·ç«¯å¼€å¯å»¶è¿Ÿç¡®è®¤æœºåˆ¶, å°±å¾ˆå®¹æ˜“å¯¼è‡´ç½‘ç»œå»¶è¿Ÿå¢å¤§.")]),s._v(" "),a("p",[s._v("å¦å¤–, åœ¨ä½¿ç”¨ NAT çš„æœåŠ¡å™¨ä¸Š, å¦‚æœå¼€å¯ net.ipv4.tcp_tw_recycle, å°±å¾ˆå®¹æ˜“å¯¼è‡´å„ç§è¿æ¥å¤±è´¥. å®é™…ä¸Š, ç”±äºå‘å¤ªå¤š, è¿™ä¸ªé€‰é¡¹åœ¨å†…æ ¸çš„ 4.1 ç‰ˆæœ¬ä¸­å·²ç»åˆ é™¤äº†.")]),s._v(" "),a("p",[s._v("è¯´å®Œ TCP, å†æ¥çœ‹ UDP çš„ä¼˜åŒ–.")]),s._v(" "),a("p",[s._v("UDP æä¾›äº†é¢å‘æ•°æ®æŠ¥çš„ç½‘ç»œåè®®, å®ƒä¸éœ€è¦ç½‘ç»œè¿æ¥, ä¹Ÿä¸æä¾›å¯é æ€§ä¿éšœ. æ‰€ä»¥ UDP ä¼˜åŒ–, ç›¸å¯¹äº TCP æ¥è¯´, è¦ç®€å•å¾—å¤š. è¿™é‡Œä¹Ÿæ€»ç»“äº†å¸¸è§çš„å‡ ç§ä¼˜åŒ–æ–¹æ¡ˆ.")]),s._v(" "),a("ul",[a("li",[s._v("è·Ÿä¸Šç¯‡å¥—æ¥å­—éƒ¨åˆ†æåˆ°çš„ä¸€æ ·, å¢å¤§å¥—æ¥å­—ç¼“å†²åŒºå¤§å°ä»¥åŠ UDP ç¼“å†²åŒºèŒƒå›´;")]),s._v(" "),a("li",[s._v("è·Ÿå‰é¢ TCP éƒ¨åˆ†æåˆ°çš„ä¸€æ ·, å¢å¤§æœ¬åœ°ç«¯å£å·çš„èŒƒå›´;")]),s._v(" "),a("li",[s._v("æ ¹æ® MTU å¤§å°, è°ƒæ•´ UDP æ•°æ®åŒ…çš„å¤§å°, å‡å°‘æˆ–è€…é¿å…åˆ†ç‰‡çš„å‘ç”Ÿ.")])]),s._v(" "),a("h6",{attrs:{id:"_4-ç½‘ç»œå±‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç½‘ç»œå±‚"}},[s._v("#")]),s._v(" (4)ç½‘ç»œå±‚")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥,å†æ¥çœ‹ç½‘ç»œå±‚çš„ä¼˜åŒ–. ç½‘ç»œå±‚, è´Ÿè´£ç½‘ç»œåŒ…çš„å°è£…, å¯»å€å’Œè·¯ç”±, åŒ…æ‹¬ IP, ICMP ç­‰å¸¸è§åè®®. åœ¨ç½‘ç»œå±‚, æœ€ä¸»è¦çš„ä¼˜åŒ–, å…¶å®å°±æ˜¯å¯¹è·¯ç”±, IP åˆ†ç‰‡ä»¥åŠ ICMP ç­‰è¿›è¡Œè°ƒä¼˜.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç§, "),a("strong",[s._v("ä»è·¯ç”±å’Œè½¬å‘çš„è§’åº¦å‡ºå‘")]),s._v(", å¯ä»¥è°ƒæ•´ä¸‹é¢çš„å†…æ ¸é€‰é¡¹.")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨éœ€è¦è½¬å‘çš„æœåŠ¡å™¨ä¸­, æ¯”å¦‚ç”¨ä½œ NAT ç½‘å…³çš„æœåŠ¡å™¨æˆ–è€…ä½¿ç”¨ Docker å®¹å™¨æ—¶, å¼€å¯ IP è½¬å‘, å³è®¾ç½® net.ipv4.ip_forward = 1.")]),s._v(" "),a("li",[s._v("è°ƒæ•´æ•°æ®åŒ…çš„ç”Ÿå­˜å‘¨æœŸ TTL, æ¯”å¦‚è®¾ç½® net.ipv4.ip_default_ttl = 64. æ³¨æ„å¢å¤§è¯¥å€¼ä¼šé™ä½ç³»ç»Ÿæ€§èƒ½.")]),s._v(" "),a("li",[s._v("å¼€å¯æ•°æ®åŒ…çš„åå‘åœ°å€æ ¡éªŒ, æ¯”å¦‚è®¾ç½® net.ipv4.conf.eth0.rp_filter = 1. è¿™æ ·å¯ä»¥é˜²æ­¢ IP æ¬ºéª—, å¹¶å‡å°‘ä¼ªé€  IP å¸¦æ¥çš„ DDoS é—®é¢˜.")])]),s._v(" "),a("p",[s._v("ç¬¬äºŒç§, "),a("strong",[s._v("ä»åˆ†ç‰‡çš„è§’åº¦å‡ºå‘")]),s._v(", æœ€ä¸»è¦çš„æ˜¯"),a("mark",[a("strong",[s._v("è°ƒæ•´ MTU(Maximum Transmission Unit)çš„å¤§å°")])]),s._v(". é€šå¸¸, MTU çš„å¤§å°åº”è¯¥æ ¹æ®ä»¥å¤ªç½‘çš„æ ‡å‡†æ¥è®¾ç½®. ä»¥å¤ªç½‘æ ‡å‡†è§„å®š, ä¸€ä¸ªç½‘ç»œå¸§æœ€å¤§ä¸º 1518B, é‚£ä¹ˆå»æ‰ä»¥å¤ªç½‘å¤´éƒ¨çš„ 18B å, å‰©ä½™çš„ 1500 å°±æ˜¯ä»¥å¤ªç½‘ MTU çš„å¤§å°. åœ¨ä½¿ç”¨ VXLAN, GRE ç­‰å åŠ ç½‘ç»œæŠ€æœ¯æ—¶, è¦æ³¨æ„, ç½‘ç»œå åŠ ä¼šä½¿åŸæ¥çš„ç½‘ç»œåŒ…å˜å¤§, å¯¼è‡´ MTU ä¹Ÿéœ€è¦è°ƒæ•´.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å°±ä»¥ VXLAN ä¸ºä¾‹, å®ƒåœ¨åŸæ¥æŠ¥æ–‡çš„åŸºç¡€ä¸Š, å¢åŠ äº† 14B çš„ä»¥å¤ªç½‘å¤´éƒ¨,  8B çš„ VXLAN å¤´éƒ¨, 8B çš„ UDP å¤´éƒ¨ä»¥åŠ 20B çš„ IP å¤´éƒ¨. æ¢å¥è¯è¯´, æ¯ä¸ªåŒ…æ¯”åŸæ¥å¢å¤§äº† 50B. æ‰€ä»¥, å°±éœ€è¦æŠŠäº¤æ¢æœº, è·¯ç”±å™¨ç­‰çš„ MTU, å¢å¤§åˆ° 1550, æˆ–è€…æŠŠ VXLAN å°åŒ…å‰(æ¯”å¦‚è™šæ‹ŸåŒ–ç¯å¢ƒä¸­çš„è™šæ‹Ÿç½‘å¡)çš„ MTU å‡å°ä¸º 1450. å¦å¤–, ç°åœ¨å¾ˆå¤šç½‘ç»œè®¾å¤‡éƒ½æ”¯æŒå·¨å¸§, å¦‚æœæ˜¯è¿™ç§ç¯å¢ƒ, è¿˜å¯ä»¥æŠŠ MTU è°ƒå¤§ä¸º 9000, ä»¥æé«˜ç½‘ç»œååé‡.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸‰ç§, "),a("strong",[s._v("ä» ICMP çš„è§’åº¦å‡ºå‘")]),s._v(", ä¸ºäº†é¿å… ICMP ä¸»æœºæ¢æµ‹, ICMP Flood ç­‰å„ç§ç½‘ç»œé—®é¢˜, å¯ä»¥é€šè¿‡å†…æ ¸é€‰é¡¹, æ¥"),a("strong",[s._v("é™åˆ¶ ICMP çš„è¡Œä¸º")]),s._v(".")]),s._v(" "),a("ul",[a("li",[s._v("æ¯”å¦‚, å¯ä»¥ç¦æ­¢ ICMP åè®®, å³è®¾ç½® net.ipv4.icmp_echo_ignore_all = 1. è¿™æ ·å¤–éƒ¨ä¸»æœºå°±æ— æ³•é€šè¿‡ ICMP æ¥æ¢æµ‹ä¸»æœº.")]),s._v(" "),a("li",[s._v("æˆ–è€…, è¿˜å¯ä»¥ç¦æ­¢å¹¿æ’­ ICMP, å³è®¾ç½® net.ipv4.icmp_echo_ignore_broadcasts = 1.")])]),s._v(" "),a("h6",{attrs:{id:"_5-é“¾è·¯å±‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-é“¾è·¯å±‚"}},[s._v("#")]),s._v(" (5)é“¾è·¯å±‚")]),s._v(" "),a("p",[s._v("æœ€åå†æ¥çœ‹é“¾è·¯å±‚çš„ä¼˜åŒ–æ–¹æ³•. é“¾è·¯å±‚è´Ÿè´£ç½‘ç»œåŒ…åœ¨ç‰©ç†ç½‘ç»œä¸­çš„ä¼ è¾“, æ¯”å¦‚ MAC å¯»å€, é”™è¯¯ä¾¦æµ‹ä»¥åŠé€šè¿‡ç½‘å¡ä¼ è¾“ç½‘ç»œå¸§ç­‰. è‡ªç„¶, é“¾è·¯å±‚çš„ä¼˜åŒ–, ä¹Ÿæ˜¯å›´ç»•è¿™äº›åŸºæœ¬åŠŸèƒ½è¿›è¡Œçš„. æ¥ä¸‹æ¥ä»ä¸åŒçš„å‡ ä¸ªæ–¹é¢åˆ†åˆ«æ¥çœ‹.")]),s._v(" "),a("p",[a("strong",[s._v("ç”±äºç½‘å¡æ”¶åŒ…åè°ƒç”¨çš„ä¸­æ–­å¤„ç†ç¨‹åº(ç‰¹åˆ«æ˜¯è½¯ä¸­æ–­), éœ€è¦æ¶ˆè€—å¤§é‡çš„ CPU. æ‰€ä»¥å°†è¿™äº›ä¸­æ–­å¤„ç†ç¨‹åºè°ƒåº¦åˆ°ä¸åŒçš„ CPU ä¸Šæ‰§è¡Œ, å°±å¯ä»¥æ˜¾è‘—æé«˜ç½‘ç»œååé‡")]),s._v(". è¿™é€šå¸¸å¯ä»¥é‡‡ç”¨ä¸‹é¢ä¸¤ç§æ–¹æ³•.")]),s._v(" "),a("ul",[a("li",[s._v("æ¯”å¦‚å¯ä»¥ä¸ºç½‘å¡ç¡¬ä¸­æ–­é…ç½® CPU äº²å’Œæ€§(smp_affinity), æˆ–è€…å¼€å¯ irqbalance æœåŠ¡.")]),s._v(" "),a("li",[s._v("å†å¦‚, å¯ä»¥å¼€å¯ "),a("strong",[s._v("RPS")]),s._v("(Receive Packet Steering)å’Œ "),a("strong",[s._v("RFS")]),s._v("(Receive Flow Steering), å°†åº”ç”¨ç¨‹åºå’Œè½¯ä¸­æ–­çš„å¤„ç†, è°ƒåº¦åˆ°ç›¸åŒ CPU ä¸Š, è¿™æ ·å°±å¯ä»¥å¢åŠ  CPU ç¼“å­˜å‘½ä¸­ç‡, å‡å°‘ç½‘ç»œå»¶è¿Ÿ.")])]),s._v(" "),a("p",[s._v("å¦å¤–, ç°åœ¨çš„ç½‘å¡éƒ½æœ‰å¾ˆä¸°å¯Œçš„åŠŸèƒ½, åŸæ¥åœ¨å†…æ ¸ä¸­é€šè¿‡è½¯ä»¶å¤„ç†çš„åŠŸèƒ½, å¯ä»¥å¸è½½åˆ°ç½‘å¡ä¸­, é€šè¿‡ç¡¬ä»¶æ¥æ‰§è¡Œ.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("TSO")]),s._v("(TCP Segmentation Offload)å’Œ "),a("strong",[s._v("UFO")]),s._v("(UDP Fragmentation Offload): åœ¨ TCP/UDP åè®®ä¸­ç›´æ¥å‘é€å¤§åŒ…; è€Œ TCP åŒ…çš„åˆ†æ®µ(æŒ‰ç…§ MSS åˆ†æ®µ)å’Œ UDP çš„åˆ†ç‰‡(æŒ‰ç…§ MTU åˆ†ç‰‡)åŠŸèƒ½, ç”±ç½‘å¡æ¥å®Œæˆ .")]),s._v(" "),a("li",[a("strong",[s._v("GSO")]),s._v("(Generic Segmentation Offload): åœ¨ç½‘å¡ä¸æ”¯æŒ TSO/UFO æ—¶, å°† TCP/UDP åŒ…çš„åˆ†æ®µ, å»¶è¿Ÿåˆ°è¿›å…¥ç½‘å¡å‰å†æ‰§è¡Œ. è¿™æ ·, ä¸ä»…å¯ä»¥å‡å°‘ CPU çš„æ¶ˆè€—, è¿˜å¯ä»¥åœ¨å‘ç”Ÿä¸¢åŒ…æ—¶åªé‡ä¼ åˆ†æ®µåçš„åŒ….")]),s._v(" "),a("li",[a("strong",[s._v("LRO")]),s._v("(Large Receive Offload): åœ¨æ¥æ”¶ TCP åˆ†æ®µåŒ…æ—¶, ç”±ç½‘å¡å°†å…¶ç»„è£…åˆå¹¶å, å†äº¤ç»™ä¸Šå±‚ç½‘ç»œå¤„ç†. ä¸è¿‡è¦æ³¨æ„, åœ¨éœ€è¦ IP è½¬å‘çš„æƒ…å†µä¸‹, ä¸èƒ½å¼€å¯ LRO, å› ä¸ºå¦‚æœå¤šä¸ªåŒ…çš„å¤´éƒ¨ä¿¡æ¯ä¸ä¸€è‡´, LRO åˆå¹¶ä¼šå¯¼è‡´ç½‘ç»œåŒ…çš„æ ¡éªŒé”™è¯¯.")]),s._v(" "),a("li",[a("strong",[s._v("GRO")]),s._v("(Generic Receive Offload): GRO ä¿®å¤äº† LRO çš„ç¼ºé™·, å¹¶ä¸”æ›´ä¸ºé€šç”¨, åŒæ—¶æ”¯æŒ TCP å’Œ UDP.")]),s._v(" "),a("li",[a("strong",[s._v("RSS")]),s._v("(Receive Side Scaling): ä¹Ÿç§°ä¸ºå¤šé˜Ÿåˆ—æ¥æ”¶, å®ƒåŸºäºç¡¬ä»¶çš„å¤šä¸ªæ¥æ”¶é˜Ÿåˆ—, æ¥åˆ†é…ç½‘ç»œæ¥æ”¶è¿›ç¨‹, è¿™æ ·å¯ä»¥è®©å¤šä¸ª CPU æ¥å¤„ç†æ¥æ”¶åˆ°çš„ç½‘ç»œåŒ….")]),s._v(" "),a("li",[a("strong",[s._v("VXLAN")]),s._v(" å¸è½½: ä¹Ÿå°±æ˜¯è®©ç½‘å¡æ¥å®Œæˆ VXLAN çš„ç»„åŒ…åŠŸèƒ½.")])]),s._v(" "),a("p",[s._v("æœ€å, å¯¹äº"),a("strong",[s._v("ç½‘ç»œæ¥å£æœ¬èº«")]),s._v(", ä¹Ÿæœ‰å¾ˆå¤šæ–¹æ³•, å¯ä»¥ä¼˜åŒ–ç½‘ç»œçš„ååé‡.")]),s._v(" "),a("ul",[a("li",[s._v("æ¯”å¦‚, å¯ä»¥å¼€å¯ç½‘ç»œæ¥å£çš„å¤šé˜Ÿåˆ—åŠŸèƒ½. è¿™æ ·æ¯ä¸ªé˜Ÿåˆ—å°±å¯ä»¥ç”¨ä¸åŒçš„ä¸­æ–­å·, è°ƒåº¦åˆ°ä¸åŒ CPU ä¸Šæ‰§è¡Œ, ä»è€Œæå‡ç½‘ç»œçš„ååé‡.")]),s._v(" "),a("li",[s._v("å†å¦‚, å¯ä»¥å¢å¤§ç½‘ç»œæ¥å£çš„ç¼“å†²åŒºå¤§å°, ä»¥åŠé˜Ÿåˆ—é•¿åº¦ç­‰, æå‡ç½‘ç»œä¼ è¾“çš„ååé‡(æ³¨æ„, è¿™å¯èƒ½å¯¼è‡´å»¶è¿Ÿå¢å¤§).")]),s._v(" "),a("li",[s._v("è¿˜å¯ä»¥ä½¿ç”¨ Traffic Control å·¥å…·, ä¸ºä¸åŒç½‘ç»œæµé‡é…ç½® QoS.")])]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œå°±ä»åº”ç”¨ç¨‹åº, å¥—æ¥å­—, ä¼ è¾“å±‚, ç½‘ç»œå±‚, å†åˆ°é“¾è·¯å±‚, åˆ†åˆ«ä»‹ç»äº†ç›¸åº”çš„ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ–¹æ³•. é€šè¿‡è¿™äº›æ–¹æ³•çš„ä¼˜åŒ–å, ç½‘ç»œæ€§èƒ½å°±å¯ä»¥æ»¡è¶³ç»å¤§éƒ¨åˆ†åœºæ™¯äº†.")]),s._v(" "),a("p",[s._v("æœ€å, åˆ«å¿˜äº†ä¸€ç§æé™åœºæ™¯. è¿˜è®°å¾—å­¦è¿‡çš„çš„ C10M é—®é¢˜å—? åœ¨"),a("strong",[s._v("å•æœºå¹¶å‘ 1000 ä¸‡çš„åœºæ™¯ä¸­, å¯¹ Linux ç½‘ç»œåè®®æ ˆè¿›è¡Œçš„å„ç§ä¼˜åŒ–ç­–ç•¥, åŸºæœ¬éƒ½æ²¡æœ‰å¤ªå¤§æ•ˆæœ. å› ä¸ºè¿™ç§æƒ…å†µä¸‹, ç½‘ç»œåè®®æ ˆçš„å†—é•¿æµç¨‹, å…¶å®æ‰æ˜¯æœ€ä¸»è¦çš„æ€§èƒ½è´Ÿæ‹…")]),s._v(". è¿™æ—¶, å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼æ¥ä¼˜åŒ–.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§, ä½¿ç”¨ DPDK æŠ€æœ¯, è·³è¿‡å†…æ ¸åè®®æ ˆ, ç›´æ¥ç”±ç”¨æˆ·æ€è¿›ç¨‹ç”¨è½®è¯¢çš„æ–¹å¼, æ¥å¤„ç†ç½‘ç»œè¯·æ±‚. åŒæ—¶, å†ç»“åˆå¤§é¡µ, CPU ç»‘å®š, å†…å­˜å¯¹é½, æµæ°´çº¿å¹¶å‘ç­‰å¤šç§æœºåˆ¶, ä¼˜åŒ–ç½‘ç»œåŒ…çš„å¤„ç†æ•ˆç‡.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§, ä½¿ç”¨å†…æ ¸è‡ªå¸¦çš„ XDP æŠ€æœ¯, åœ¨ç½‘ç»œåŒ…è¿›å…¥å†…æ ¸åè®®æ ˆå‰, å°±å¯¹å…¶è¿›è¡Œå¤„ç†, è¿™æ ·ä¹Ÿå¯ä»¥å®ç°å¾ˆå¥½çš„æ€§èƒ½.")])]),s._v(" "),a("h5",{attrs:{id:"_4-å°ç»“-14"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å°ç»“-14"}},[s._v("#")]),s._v(" 4.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¢³ç†äº†å¸¸è§çš„ Linux ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ–¹æ³•. åœ¨ä¼˜åŒ–ç½‘ç»œçš„æ€§èƒ½æ—¶, å¯ä»¥ç»“åˆ Linux ç³»ç»Ÿçš„ç½‘ç»œåè®®æ ˆå’Œç½‘ç»œæ”¶å‘æµç¨‹, "),a("strong",[s._v("ä»åº”ç”¨ç¨‹åº, å¥—æ¥å­—, ä¼ è¾“å±‚, ç½‘ç»œå±‚å†åˆ°é“¾è·¯å±‚ç­‰, å¯¹æ¯ä¸ªå±‚æ¬¡è¿›è¡Œé€å±‚ä¼˜åŒ–")]),s._v(".")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, åˆ†æå’Œå®šä½ç½‘ç»œç“¶é¢ˆä¹Ÿæ˜¯åŸºäºè¿™äº›ç½‘ç»œå±‚è¿›è¡Œçš„. è€Œå®šä½å‡ºç½‘ç»œæ€§èƒ½ç“¶é¢ˆå, å°±å¯ä»¥æ ¹æ®ç“¶é¢ˆæ‰€åœ¨çš„åè®®å±‚, è¿›è¡Œä¼˜åŒ–. å…·ä½“è€Œè¨€:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("åœ¨åº”ç”¨ç¨‹åºä¸­, ä¸»è¦æ˜¯ä¼˜åŒ– I/O æ¨¡å‹, å·¥ä½œæ¨¡å‹ä»¥åŠåº”ç”¨å±‚çš„ç½‘ç»œåè®®;")])]),s._v(" "),a("li",[a("strong",[s._v("åœ¨å¥—æ¥å­—å±‚ä¸­, ä¸»è¦æ˜¯ä¼˜åŒ–å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°;")])]),s._v(" "),a("li",[a("strong",[s._v("åœ¨ä¼ è¾“å±‚ä¸­, ä¸»è¦æ˜¯ä¼˜åŒ– TCP å’Œ UDP åè®®;")])]),s._v(" "),a("li",[a("strong",[s._v("åœ¨ç½‘ç»œå±‚ä¸­, ä¸»è¦æ˜¯ä¼˜åŒ–è·¯ç”±, è½¬å‘, åˆ†ç‰‡ä»¥åŠ ICMP åè®®;")])]),s._v(" "),a("li",[a("strong",[s._v("æœ€å, åœ¨é“¾è·¯å±‚ä¸­, ä¸»è¦æ˜¯ä¼˜åŒ–ç½‘ç»œåŒ…çš„æ”¶å‘, ç½‘ç»œåŠŸèƒ½å¸è½½ä»¥åŠç½‘å¡é€‰é¡¹.")])])]),s._v(" "),a("p",[s._v("å¦‚æœè¿™äº›æ–¹æ³•ä¾ç„¶ä¸èƒ½æ»¡è¶³è¦æ±‚, é‚£å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ DPDK ç­‰ç”¨æˆ·æ€æ–¹å¼, ç»•è¿‡å†…æ ¸åè®®æ ˆ; æˆ–è€…ä½¿ç”¨ XDP åœ¨ç½‘ç»œåŒ…è¿›å…¥å†…æ ¸åè®®æ ˆå‰è¿›è¡Œå¤„ç†.")]),s._v(" "),a("h3",{attrs:{id:"ç»¼åˆå®æˆ˜ç¯‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç»¼åˆå®æˆ˜ç¯‡"}},[s._v("#")]),s._v(" ç»¼åˆå®æˆ˜ç¯‡")]),s._v(" "),a("h4",{attrs:{id:"_46-æ¡ˆä¾‹ç¯‡-ä¸ºä»€ä¹ˆåº”ç”¨å®¹å™¨åŒ–å-å¯åŠ¨æ…¢äº†å¾ˆå¤š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_46-æ¡ˆä¾‹ç¯‡-ä¸ºä»€ä¹ˆåº”ç”¨å®¹å™¨åŒ–å-å¯åŠ¨æ…¢äº†å¾ˆå¤š"}},[s._v("#")]),s._v(" 46-æ¡ˆä¾‹ç¯‡:ä¸ºä»€ä¹ˆåº”ç”¨å®¹å™¨åŒ–å,å¯åŠ¨æ…¢äº†å¾ˆå¤š?")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°†è¿›å…¥æœ€åä¸€ä¸ªé‡è¦æ¨¡å—--ç»¼åˆå®æˆ˜ç¯‡.")]),s._v(" "),a("p",[s._v("éšç€ Kubernetes, Docker ç­‰æŠ€æœ¯çš„æ™®åŠ, è¶Šæ¥è¶Šå¤šçš„ä¼ä¸š, éƒ½å·²ç»èµ°ä¸Šäº†åº”ç”¨ç¨‹åºå®¹å™¨åŒ–çš„é“è·¯. æˆ‘ç›¸ä¿¡, ä½ åœ¨äº†è§£å­¦ä¹ è¿™äº›æŠ€æœ¯çš„åŒæ—¶, ä¸€å®šä¹Ÿå¬è¯´è¿‡ä¸å°‘, åŸºäº Docker çš„å¾®æœåŠ¡æ¶æ„å¸¦æ¥çš„å„ç§ä¼˜åŠ¿. ä¸è¿‡, ä»»ä½•æŠ€æœ¯éƒ½ä¸æ˜¯é“¶å¼¹. è¿™äº›æ–°æŠ€æœ¯, åœ¨å¸¦æ¥è¯¸å¤šä¾¿æ·åŠŸèƒ½ä¹‹å¤–, ä¹Ÿå¸¦æ¥äº†"),a("strong",[s._v("æ›´é«˜çš„å¤æ‚æ€§, æ¯”å¦‚æ€§èƒ½é™ä½, æ¶æ„å¤æ‚, æ’é”™å›°éš¾")]),s._v("ç­‰ç­‰.")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å°±"),a("strong",[s._v("é€šè¿‡ä¸€ä¸ª Tomcat æ¡ˆä¾‹æ¥çœ‹çœ‹å¦‚ä½•åˆ†æåº”ç”¨ç¨‹åºå®¹å™¨åŒ–åçš„æ€§èƒ½é—®é¢˜")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹å‡†å¤‡-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹å‡†å¤‡-7"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹åªéœ€è¦ä¸€å°è™šæ‹Ÿæœº. è¿˜æ˜¯åŸºäº Ubuntu 18.04. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, curl, jq, pidstat ç­‰å·¥å…·, å¦‚ apt install docker.io curl jq sysstat.")])]),s._v(" "),a("p",[s._v("å…¶ä¸­, jq å·¥å…·ä¸“é—¨ç”¨æ¥åœ¨å‘½ä»¤è¡Œä¸­å¤„ç† json. éœ€è¦æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯, ç™»å½•åˆ°åŒä¸€å°è™šæ‹Ÿæœºä¸­, å¹¶å®‰è£…ä¸Šè¿°å·¥å…·.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ-8"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v('ä»Šå¤©è¦åˆ†æçš„æ¡ˆä¾‹, æ˜¯ä¸€ä¸ª Tomcat åº”ç”¨. æ¡ˆä¾‹ä¹ŸåŸºäº Tomcat çš„å®˜æ–¹é•œåƒæ„å»º, å…¶æ ¸å¿ƒé€»è¾‘å¾ˆç®€å•, å°±æ˜¯åˆ†é…ä¸€ç‚¹å„¿å†…å­˜, å¹¶è¾“å‡º "Hello, world!".')]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("byte data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new byte"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("*1024*1024"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nout.println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello, wolrd!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ä¸ºäº†æ–¹ä¾¿è¿è¡Œ, æˆ‘å·²ç»å°†å®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ª "),a("a",{attrs:{href:"https://github.com/feiskyer/linux-perf-examples/tree/master/tomcat",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker é•œåƒ"),a("OutboundLink")],1),s._v(" feisky/tomcat:8, å¹¶æ¨é€åˆ°äº† Docker Hub ä¸­. å¯ä»¥ç›´æ¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥è¿è¡Œå®ƒ.")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å¯åŠ¨ Tomcat åº”ç”¨, å¹¶ç›‘å¬ 8080 ç«¯å£. å¦‚æœä¸€åˆ‡æ­£å¸¸, åº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -m è¡¨ç¤ºè®¾ç½®å†…å­˜ä¸º 512MB")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" tomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cpus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" 512M "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/tomcat:8\nUnable to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'feisky/tomcat:8'")]),s._v(" locally\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(": Pulling from feisky/tomcat\n741437d97401: Pull complete\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n22cd96a25579: Pull complete\nDigest: sha256:71871cff17b9043842c2ec99f370cc9f1de7bc121cd2c02d8e2092c6e268f7e2\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" feisky/tomcat:8\nWARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.\n2df259b752db334d96da26f19166d662a82283057411f6332f3cbdbcab452249\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("æ¥ç€åœ¨ç»ˆç«¯äºŒä¸­ä½¿ç”¨ curl, è®¿é—® Tomcat ç›‘å¬çš„ 8080 ç«¯å£, ç¡®è®¤æ¡ˆä¾‹å·²ç»æ­£å¸¸å¯åŠ¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:8080\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Recv failure: Connection reset by peer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v('ä¸è¿‡, å¾ˆä¸å¹¸, curl è¿”å›äº† "Connection reset by peer" çš„é”™è¯¯, è¯´æ˜ Tomcat æœåŠ¡, å¹¶ä¸èƒ½æ­£å¸¸å“åº”å®¢æˆ·ç«¯è¯·æ±‚.')]),s._v(" "),a("p",[s._v("æ˜¯ä¸æ˜¯ Tomcat å¯åŠ¨å‡ºé—®é¢˜äº†å‘¢? åˆ‡æ¢åˆ°ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œ docker logs å‘½ä»¤, æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—. è¿™é‡Œæ³¨æ„, éœ€è¦åŠ ä¸Š -f å‚æ•°, è¡¨ç¤ºè·Ÿè¸ªå®¹å™¨çš„æœ€æ–°æ—¥å¿—è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" tomcat\nUsing CATALINA_BASE:   /usr/local/tomcat\nUsing CATALINA_HOME:   /usr/local/tomcat\nUsing CATALINA_TMPDIR: /usr/local/tomcat/temp\nUsing JRE_HOME:        /docker-java-home/jre\nUsing CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ä»è¿™å„¿å¯ä»¥çœ‹åˆ°, Tomcat å®¹å™¨åªæ‰“å°äº†ç¯å¢ƒå˜é‡, è¿˜æ²¡æœ‰åº”ç”¨ç¨‹åºåˆå§‹åŒ–çš„æ—¥å¿—. ä¹Ÿå°±æ˜¯è¯´, Tomcat è¿˜åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­, è¿™æ—¶å€™å»è®¿é—®å®ƒ, å½“ç„¶æ²¡æœ‰å“åº”. ä¸ºäº†è§‚å¯Ÿ Tomcat çš„å¯åŠ¨è¿‡ç¨‹, åœ¨ç»ˆç«¯ä¸€ä¸­, ç»§ç»­ä¿ç•™ docker logs -f å‘½ä»¤, å¹¶åœ¨ç»ˆç«¯äºŒä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å¤šæ¬¡å°è¯•è®¿é—® Tomcat.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Recv failure: Connection reset by peer\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Recv failure: Connection reset by peer\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™å„¿ä¼šé˜»å¡ä¸€ä¼š")]),s._v("\nHello, wolrd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Empty reply from server\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Failed to connect to localhost port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(": Connection refused\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Failed to connect to localhost port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(": Connection refused\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v('è§‚å¯Ÿä¸€ä¼šå„¿, å¯ä»¥çœ‹åˆ°, ä¸€æ®µæ—¶é—´å, curl ç»ˆäºç»™å‡ºäº†æƒ³è¦çš„ç»“æœ "Hello, wolrd!". ä½†æ˜¯, éšååˆå‡ºç°äº† "Empty reply from server", å’Œä¸€ç›´æŒç»­çš„ "Connection refused" é”™è¯¯. æ¢å¥è¯è¯´, Tomcat å“åº”ä¸€æ¬¡è¯·æ±‚å, å°±å†ä¹Ÿä¸å“åº”äº†.')]),s._v(" "),a("p",[s._v("è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢? å›åˆ°ç»ˆç«¯ä¸€ä¸­, è§‚å¯Ÿ Tomcat çš„æ—¥å¿—, çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä»€ä¹ˆçº¿ç´¢.")]),s._v(" "),a("p",[s._v("ä»ç»ˆç«¯ä¸€ä¸­, åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":43:32.719 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost-startStop-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/usr/local/tomcat/webapps/docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":43:33.725 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost-startStop-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/usr/local/tomcat/webapps/docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" has finished "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,006")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":43:33.726 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost-startStop-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/usr/local/tomcat/webapps/manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":43:34.521 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost-startStop-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/usr/local/tomcat/webapps/manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" has finished "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("795")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":43:34.722 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http-nio-8080"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":43:35.319 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ajp-nio-8009"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":43:35.821 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.Catalina.start Server startup "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24096")]),s._v(" ms\nroot@ubuntu:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä»å†…å®¹ä¸Šå¯ä»¥çœ‹åˆ°, Tomcat åœ¨å¯åŠ¨ 24s åå®Œæˆåˆå§‹åŒ–, å¹¶ä¸”æ­£å¸¸å¯åŠ¨. ä»æ—¥å¿—ä¸Šæ¥çœ‹, æ²¡æœ‰ä»€ä¹ˆé—®é¢˜.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ç»†å¿ƒçš„ä½ è‚¯å®šæ³¨æ„åˆ°äº†æœ€åä¸€è¡Œ, æ˜æ˜¾æ˜¯"),a("strong",[s._v("å›åˆ°äº† Linux çš„ SHELL ç»ˆç«¯ä¸­")]),s._v(", è€Œæ²¡æœ‰ç»§ç»­ç­‰å¾… Docker è¾“å‡ºçš„å®¹å™¨æ—¥å¿—. è¾“å‡ºé‡æ–°å›åˆ° SHELL ç»ˆç«¯, é€šå¸¸è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤å·²ç»ç»“æŸ. è€Œä¸Šä¸€ä¸ªå‘½ä»¤, æ˜¯ docker logs -f å‘½ä»¤. é‚£ä¹ˆå®ƒçš„é€€å‡ºå°±åªæœ‰ä¸¤ç§å¯èƒ½äº†, è¦ä¹ˆæ˜¯å®¹å™¨é€€å‡ºäº†, è¦ä¹ˆå°±æ˜¯ dockerd è¿›ç¨‹é€€å‡ºäº†.")]),s._v(" "),a("p",[s._v("ç©¶ç«Ÿæ˜¯å“ªç§æƒ…å†µå‘¢? è¿™å°±éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤äº†. å¯ä»¥åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                            PORTS               NAMES\n0f2b3fcdd257        feisky/tomcat:8     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"catalina.sh run"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" minutes ago       Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" About a minute ago                       tomcat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("å®¹å™¨å¤„äº Exited çŠ¶æ€, è¯´æ˜æ˜¯ç¬¬ä¸€ç§æƒ…å†µ, å®¹å™¨å·²ç»é€€å‡º. ä¸è¿‡ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢? æ˜¾ç„¶, åœ¨å‰é¢å®¹å™¨çš„æ—¥å¿—é‡Œå¹¶æ²¡æœ‰å‘ç°çº¿ç´¢, é‚£å°±åªèƒ½ä» Docker æœ¬èº«å…¥æ‰‹äº†.")]),s._v(" "),a("p",[s._v("å¯ä»¥è°ƒç”¨ Docker çš„ API, æŸ¥è¯¢å®¹å™¨çš„çŠ¶æ€, é€€å‡ºç ä»¥åŠé”™è¯¯ä¿¡æ¯, ç„¶åç¡®å®šå®¹å™¨é€€å‡ºçš„åŸå› . è¿™äº›å¯ä»¥é€šè¿‡ docker inspect å‘½ä»¤æ¥å®Œæˆ, æ¯”å¦‚å¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, é€šè¿‡ -f é€‰é¡¹è®¾ç½®åªè¾“å‡ºå®¹å™¨çš„çŠ¶æ€:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ˜¾ç¤ºå®¹å™¨çŠ¶æ€, jq ç”¨æ¥æ ¼å¼åŒ– json è¾“å‡º")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect tomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{json .State}}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" jq\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Status"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exited"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Running"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Paused"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Restarting"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OOMKilled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Dead"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Pid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ExitCode"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("è¿™æ¬¡å¯ä»¥çœ‹åˆ°, å®¹å™¨å·²ç»å¤„äº exited çŠ¶æ€, OOMKilled æ˜¯ true, ExitCode æ˜¯ 137. è¿™å…¶ä¸­, OOMKilled è¡¨ç¤ºå®¹å™¨è¢« OOM æ€æ­»äº†.")]),s._v(" "),a("p",[s._v("å‰é¢æåˆ°è¿‡, "),a("strong",[s._v("OOM è¡¨ç¤ºå†…å­˜ä¸è¶³æ—¶, æŸäº›åº”ç”¨ä¼šè¢«ç³»ç»Ÿæ€æ­»")]),s._v(". å¯æ˜¯, ä¸ºä»€ä¹ˆå†…å­˜ä¼šä¸è¶³å‘¢? æˆ‘ä»¬çš„åº”ç”¨åˆ†é…äº† 256 MB çš„å†…å­˜, è€Œå®¹å™¨å¯åŠ¨æ—¶, æ˜æ˜é€šè¿‡ -m é€‰é¡¹, è®¾ç½®äº† 512 MB çš„å†…å­˜, æŒ‰è¯´åº”è¯¥æ˜¯è¶³å¤Ÿçš„.")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œ, ä¼°è®¡ä½ åº”è¯¥è¿˜è®°å¾—, å½“ OOM å‘ç”Ÿæ—¶, ç³»ç»Ÿä¼šæŠŠç›¸å…³çš„ OOM ä¿¡æ¯, è®°å½•åˆ°æ—¥å¿—ä¸­. æ‰€ä»¥å¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ dmesg å‘½ä»¤, æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—, å¹¶å®šä½ OOM ç›¸å…³çš„æ—¥å¿—:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106393")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" invoked oom-killer: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gfp_mask")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0x14000c0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GFP_KERNEL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nodemask")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("order")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("oom_score_adj")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106396")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cpuset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0f2b3fcdd2578165ea77266cdc7b1ad43e75877b0ac1889ecda30a78cb78bd53 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mems_allowed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106402")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" CPU: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27424")]),s._v(" Comm: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" Tainted: G  OE    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.15")]),s._v(".0-1037 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#39-Ubuntu")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Hardware name: Microsoft Corporation Virtual Machine/Virtual Machine, BIOS 090007  06/02/2017\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106405")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Call Trace:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106414")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  dump_stack+0x63/0x89\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106419")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  dump_header+0x71/0x285\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106422")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  oom_kill_process+0x220/0x440\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106424")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  out_of_memory+0x2d1/0x4f0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106429")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  mem_cgroup_out_of_memory+0x4b/0x80\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106432")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  mem_cgroup_oom_synchronize+0x2e8/0x320\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106435")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  ? mem_cgroup_css_online+0x40/0x40\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106437")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  pagefault_out_of_memory+0x36/0x7b\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  mm_fault_error+0x90/0x180\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106445")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  __do_page_fault+0x4a5/0x4d0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106448")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  do_page_fault+0x2e/0xe0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106454")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  ? page_fault+0x2f/0x50\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  page_fault+0x45/0x50\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106459")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RIP: 0033:0x7fa053e5a20d\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106460")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RSP: 002b:00007fa0060159e8 EFLAGS: 00010206\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106462")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RAX: 0000000000000000 RBX: 00007fa04c4b3000 RCX: 0000000009187440\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106463")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RDX: 00000000943aa440 RSI: 0000000000000000 RDI: 000000009b223000\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106464")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RBP: 00007fa006015a60 R08: 0000000002000002 R09: 00007fa053d0a8a1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106465")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" R10: 00007fa04c018b80 R11: 0000000000000206 R12: 0000000100000768\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106466")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" R13: 00007fa04c4b3000 R14: 0000000100000768 R15: 0000000010000000\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106468")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Task "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /docker/0f2b3fcdd2578165ea77266cdc7b1ad43e75877b0ac1889ecda30a78cb78bd53 killed as a result of limit of /docker/0f2b3fcdd2578165ea77266cdc7b1ad43e75877b0ac1889ecda30a78cb78bd53\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106478")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" memory: usage 524288kB, limit 524288kB, failcnt "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106480")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" memory+swap: usage 0kB, limit 9007199254740988kB, failcnt "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106481")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" kmem: usage 3708kB, limit 9007199254740988kB, failcnt "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106481")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Memory cgroup stats "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" /docker/0f2b3fcdd2578165ea77266cdc7b1ad43e75877b0ac1889ecda30a78cb78bd53: cache:0KB rss:520580KB rss_huge:450560KB shmem:0KB mapped_file:0KB dirty:0KB writeback:0KB inactive_anon:0KB active_anon:520580KB inactive_file:0KB active_file:0KB unevictable:0KB\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106494")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" pid "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   uid  tgid total_vm      rss pgtables_bytes swapents oom_score_adj name\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106571")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27281")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27281")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1153302")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134371")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1466368")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.106574")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Memory cgroup out of memory: Kill process "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27281")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" score "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1027")]),s._v(" or sacrifice child\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193038.148334")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Killed process "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27281")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" total-vm:4613208kB, anon-rss:517316kB, file-rss:20168kB, shmem-rss:0kB\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193039.607503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" oom_reaper: reaped process "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27281")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", now anon-rss:0kB, file-rss:0kB, shmem-rss:0kB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("p",[s._v("ä» dmesg çš„è¾“å‡º, å°±å¯ä»¥çœ‹åˆ°å¾ˆè¯¦ç»†çš„ OOM è®°å½•äº†. åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹é¢å‡ ä¸ªå…³é”®ç‚¹.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, è¢«æ€æ­»çš„æ˜¯ä¸€ä¸ª java è¿›ç¨‹. ä»å†…æ ¸è°ƒç”¨æ ˆä¸Šçš„ mem_cgroup_out_of_memory å¯ä»¥çœ‹å‡º, å®ƒæ˜¯å› ä¸º"),a("strong",[s._v("è¶…è¿‡ cgroup çš„å†…å­˜é™åˆ¶")]),s._v(", è€Œè¢« OOM æ€æ­»çš„.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, java è¿›ç¨‹æ˜¯åœ¨å®¹å™¨å†…è¿è¡Œçš„, è€Œå®¹å™¨å†…å­˜çš„ä½¿ç”¨é‡å’Œé™åˆ¶éƒ½æ˜¯ 512M(524288kB). ç›®å‰ä½¿ç”¨é‡å·²ç»è¾¾åˆ°äº†é™åˆ¶, æ‰€ä»¥ä¼šå¯¼è‡´ OOM.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰, è¢«æ€æ­»çš„è¿›ç¨‹, PID ä¸º 27281, è™šæ‹Ÿå†…å­˜ä¸º 4.3G(total-vm:4613208kB), åŒ¿åå†…å­˜ä¸º 505M(anon-rss:517316kB), é¡µå†…å­˜ä¸º 19M(20168kB). æ¢å¥è¯è¯´, "),a("strong",[s._v("åŒ¿åå†…å­˜æ˜¯ä¸»è¦çš„å†…å­˜å ç”¨")]),s._v(". è€Œä¸”, åŒ¿åå†…å­˜åŠ ä¸Šé¡µå†…å­˜, æ€»å…±æ˜¯ 524M, å·²ç»è¶…è¿‡äº† 512M çš„é™åˆ¶.")])]),s._v(" "),a("p",[s._v("ç»¼åˆè¿™å‡ ç‚¹, å¯ä»¥çœ‹å‡º, Tomcat å®¹å™¨çš„å†…å­˜ä¸»è¦ç”¨åœ¨äº†åŒ¿åå†…å­˜ä¸­, è€ŒåŒ¿åå†…å­˜, å…¶å®å°±æ˜¯ä¸»åŠ¨ç”³è¯·åˆ†é…çš„å †å†…å­˜.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ä¸ºä»€ä¹ˆ Tomcat ä¼šç”³è¯·è¿™ä¹ˆå¤šçš„å †å†…å­˜å‘¢? è¦çŸ¥é“, Tomcat æ˜¯åŸºäº Java å¼€å‘çš„, æ‰€ä»¥åº”è¯¥ä¸éš¾æƒ³åˆ°, è¿™å¾ˆå¯èƒ½æ˜¯ "),a("strong",[s._v("JVM å †å†…å­˜é…ç½®")]),s._v("çš„é—®é¢˜. JVM æ ¹æ®ç³»ç»Ÿçš„å†…å­˜æ€»é‡, æ¥è‡ªåŠ¨ç®¡ç†å †å†…å­˜, ä¸æ˜ç¡®é…ç½®çš„è¯, å †å†…å­˜çš„é»˜è®¤é™åˆ¶æ˜¯ç‰©ç†å†…å­˜çš„å››åˆ†ä¹‹ä¸€. ä¸è¿‡, å‰é¢å·²ç»é™åˆ¶äº†å®¹å™¨å†…å­˜ä¸º 512 M, java çš„å †å†…å­˜åˆ°åº•æ˜¯å¤šå°‘å‘¢?")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, é‡æ–°å¯åŠ¨ tomcat å®¹å™¨, å¹¶è°ƒç”¨ java å‘½ä»¤è¡Œæ¥æŸ¥çœ‹å †å†…å­˜å¤§å°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡æ–°å¯åŠ¨å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" tomcat\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" tomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cpus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" 512M "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/tomcat:8\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹å †å†…å­˜, æ³¨æ„å•ä½æ˜¯å­—èŠ‚")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" tomcat "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+PrintFlagsFinal")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" HeapSize\n    uintx ErgoHeapSizeLimit                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("product"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    uintx HeapSizePerGCThread                       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87241520")]),s._v("                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("product"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    uintx InitialHeapSize                          :"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("132120576")]),s._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("product"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    uintx LargePageHeapSizeThreshold                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217728")]),s._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("product"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    uintx MaxHeapSize                              :"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2092957696")]),s._v("                          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("product"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, åˆå§‹å †å†…å­˜çš„å¤§å°(InitialHeapSize)æ˜¯ 126MB, è€Œæœ€å¤§å †å†…å­˜åˆ™æ˜¯ 1.95GB, è¿™å¯æ¯”å®¹å™¨é™åˆ¶çš„ 512 MB å¤§å¤šäº†.")]),s._v(" "),a("p",[s._v("ä¹‹æ‰€ä»¥ä¼šè¿™ä¹ˆå¤§, å…¶å®æ˜¯å› ä¸º, "),a("strong",[s._v("å®¹å™¨å†…éƒ¨çœ‹ä¸åˆ° Docker ä¸ºå®ƒè®¾ç½®çš„å†…å­˜é™åˆ¶")]),s._v(". è™½ç„¶åœ¨å¯åŠ¨å®¹å™¨æ—¶, é€šè¿‡ -m 512M é€‰é¡¹, ç»™å®¹å™¨è®¾ç½®äº† 512M çš„å†…å­˜é™åˆ¶. ä½†å®é™…ä¸Š, ä»å®¹å™¨å†…éƒ¨çœ‹åˆ°çš„é™åˆ¶, å´å¹¶ä¸æ˜¯ 512M.")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸­, ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" tomcat "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v("\n              total        used        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7977")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("521")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1941")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5514")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7148")]),s._v("\nSwap:             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æœç„¶, "),a("strong",[s._v("å®¹å™¨å†…éƒ¨çœ‹åˆ°çš„å†…å­˜, ä»æ˜¯ä¸»æœºå†…å­˜")]),s._v(".")]),s._v(" "),a("p",[s._v("çŸ¥é“äº†é—®é¢˜æ ¹æº, è§£å†³æ–¹æ³•å°±å¾ˆç®€å•äº†, ç»™ JVM æ­£ç¡®é…ç½®å†…å­˜é™åˆ¶ä¸º 512M å°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, é€šè¿‡ç¯å¢ƒå˜é‡ "),a("code",[s._v("JAVA_OPTS='-Xmx512m -Xms512m'")]),s._v("â€‹, æŠŠ JVM çš„åˆå§‹å†…å­˜å’Œæœ€å¤§å†…å­˜éƒ½è®¾ä¸º 512MB:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ é™¤é—®é¢˜å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" tomcat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œæ–°çš„å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" tomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cpus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" 512M "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-Xmx512m -Xms512m'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/tomcat:8\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ¥ç€å†åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, é‡æ–°åœ¨å¾ªç¯ä¸­æ‰§è¡Œ curl å‘½ä»¤, æŸ¥çœ‹ Tomcat çš„å“åº”:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Recv failure: Connection reset by peer\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Recv failure: Connection reset by peer\nHello, wolrd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n \nHello, wolrd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n \nHello, wolrd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v('å¯ä»¥çœ‹åˆ°, åˆšå¼€å§‹æ—¶, æ˜¾ç¤ºçš„è¿˜æ˜¯ "Connection reset by peer" é”™è¯¯. ç¨ç­‰ä¸€ä¼šå„¿å, å°±æ˜¯è¿ç»­çš„ "Hello, wolrd!" è¾“å‡ºäº†. è¿™è¯´æ˜ Tomcat å·²ç»æ­£å¸¸å¯åŠ¨.')]),s._v(" "),a("p",[s._v("è¿™æ—¶åˆ‡æ¢å›ç»ˆç«¯ä¸€, æ‰§è¡Œ docker logs å‘½ä»¤, æŸ¥çœ‹ Tomcat å®¹å™¨çš„æ—¥å¿—:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" tomcat\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":52:00.823 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost-startStop-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/usr/local/tomcat/webapps/manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":52:01.422 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost-startStop-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/usr/local/tomcat/webapps/manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" has finished "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("598")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":52:01.920 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http-nio-8080"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":52:02.323 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ajp-nio-8009"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":52:02.523 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.Catalina.start Server startup "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22798")]),s._v(" ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("è¿™æ¬¡, Tomcat ä¹Ÿæ­£å¸¸å¯åŠ¨äº†. ä¸è¿‡, æœ€åä¸€è¡Œçš„å¯åŠ¨æ—¶é—´, ä¼¼ä¹æ¯”è¾ƒåˆºçœ¼. "),a("strong",[s._v("å¯åŠ¨è¿‡ç¨‹, å±…ç„¶éœ€è¦ 22 ç§’")]),s._v(", è¿™ä¹Ÿå¤ªæ…¢äº†å§.")]),s._v(" "),a("p",[s._v("ç”±äºè¿™ä¸ªæ—¶é—´æ˜¯èŠ±åœ¨å®¹å™¨å¯åŠ¨ä¸Šçš„, è¦æ’æŸ¥è¿™ä¸ªé—®é¢˜, å°±è¦é‡å¯å®¹å™¨, å¹¶å€ŸåŠ©æ€§èƒ½åˆ†æå·¥å…·æ¥åˆ†æå®¹å™¨è¿›ç¨‹. è‡³äºå·¥å…·çš„é€‰ç”¨, å›é¡¾ä¸€ä¸‹å‰é¢çš„æ¡ˆä¾‹, æˆ‘è§‰å¾—å¯ä»¥å…ˆç”¨ top çœ‹çœ‹.")]),s._v(" "),a("p",[s._v("åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, è¿è¡Œ top å‘½ä»¤; ç„¶åå†åˆ‡æ¢åˆ°ç»ˆç«¯ä¸€, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, é‡å¯å®¹å™¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ é™¤æ—§å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" tomcat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œæ–°å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" tomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cpus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" 512M "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-Xmx512m -Xms512m'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/tomcat:8\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ¥ç€, å†åˆ‡æ¢åˆ°ç»ˆç«¯äºŒ, è§‚å¯Ÿ top çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":57:18 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":50,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" users,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.6")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.0")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8169304")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2465984")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500812")]),s._v(" used,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5202508")]),s._v(" buff/cache\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7353652")]),s._v(" avail Mem\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29457")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2791736")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73704")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19164")]),s._v(" S  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":01.61 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v("                         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27349")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1121372")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96760")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39340")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":20.82 dockerd\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27376")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1031760")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43768")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21680")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":44.47 docker-containe              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29430")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7376")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3604")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3128")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.01 docker-containe\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78132")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9332")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6744")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":16.12 systemd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("ä» top çš„è¾“å‡ºå¯ä»¥å‘ç°,")]),s._v(" "),a("ul",[a("li",[s._v("ä»ç³»ç»Ÿæ•´ä½“æ¥çœ‹, ä¸¤ä¸ª CPU çš„ä½¿ç”¨ç‡åˆ†åˆ«æ˜¯ 3% å’Œ 5.7%, éƒ½ä¸ç®—é«˜, å¤§éƒ¨åˆ†è¿˜æ˜¯ç©ºé—²çš„; å¯ç”¨å†…å­˜è¿˜æœ‰ 7GB(7353652 avail Mem), ä¹Ÿéå¸¸å……è¶³.")]),s._v(" "),a("li",[s._v("å…·ä½“åˆ°è¿›ç¨‹ä¸Š, java è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ä¸º 10%, å†…å­˜ä½¿ç”¨ 0.9%, å…¶ä»–è¿›ç¨‹å°±éƒ½å¾ˆä½äº†.")])]),s._v(" "),a("p",[s._v("è¿™äº›æŒ‡æ ‡éƒ½ä¸ç®—é«˜, çœ‹èµ·æ¥éƒ½æ²¡å•¥é—®é¢˜. ä¸è¿‡, äº‹å®ç©¶ç«Ÿå¦‚ä½•å‘¢? è¿˜å¾—ç»§ç»­æ‰¾ä¸‹å». "),a("strong",[s._v("ç”±äº java è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡æœ€é«˜, æ‰€ä»¥è¦æŠŠå®ƒå½“æˆé‡ç‚¹, ç»§ç»­åˆ†æå…¶æ€§èƒ½æƒ…å†µ")]),s._v(".")]),s._v(" "),a("p",[s._v("è¯´åˆ°è¿›ç¨‹çš„æ€§èƒ½åˆ†æå·¥å…·, ä½ ä¸€å®šä¹Ÿæƒ³èµ·äº† pidstat. æ¥ä¸‹æ¥å°±ç”¨ pidstat å†æ¥åˆ†æä¸€ä¸‹. å›åˆ°ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œ pidstat å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t è¡¨ç¤ºæ˜¾ç¤ºçº¿ç¨‹, -p æŒ‡å®šè¿›ç¨‹å·")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29457")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:59      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("      TGID       TID    %usr %system  %guest   %wait    %CPU   CPU  Command\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29457")]),s._v("         -    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29457")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__java\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29458")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__java\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29491")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__java\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ç»“æœä¸­, å„ç§ CPU ä½¿ç”¨ç‡å…¨æ˜¯ 0, çœ‹èµ·æ¥ä¸å¯¹å‘€. å†æƒ³æƒ³æœ‰æ²¡æœ‰æ¼æ‰ä»€ä¹ˆçº¿ç´¢å‘¢? å¯¹äº†, è¿™æ—¶å€™å®¹å™¨å¯åŠ¨å·²ç»ç»“æŸäº†, åœ¨æ²¡æœ‰å®¢æˆ·ç«¯è¯·æ±‚çš„æƒ…å†µä¸‹, Tomcat æœ¬èº«å•¥ä¹Ÿä¸ç”¨åš, CPU ä½¿ç”¨ç‡å½“ç„¶æ˜¯ 0.")]),s._v(" "),a("p",[s._v("ä¸ºäº†åˆ†æå¯åŠ¨è¿‡ç¨‹ä¸­çš„é—®é¢˜, éœ€è¦å†æ¬¡é‡å¯å®¹å™¨. ç»§ç»­åœ¨ç»ˆç«¯ä¸€åœæ­¢ pidstat å‘½ä»¤; ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, é‡å¯å®¹å™¨. æˆåŠŸé‡å¯å, æ‹¿åˆ°æ–°çš„ PID, å†é‡æ–°è¿è¡Œ pidstat å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ é™¤æ—§å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" tomcat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œæ–°å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" tomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cpus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" 512M "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-Xmx512m -Xms512m'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/tomcat:8\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥è¯¢æ–°å®¹å™¨ä¸­è¿›ç¨‹çš„ Pid")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect tomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Pid}}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‰§è¡Œ pidstat")]),s._v("\n$ pidstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:28      "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("      TGID       TID    %usr %system  %guest   %wait    %CPU   CPU  Command\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:29        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29850")]),s._v("         -   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:29        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29850")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__java\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:29        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29897")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__java\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:29        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29905")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__java\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:29        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29906")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__java\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":59:29        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29908")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45.00")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("__java\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("ä»”ç»†è§‚å¯Ÿè¿™æ¬¡çš„è¾“å‡ºä¼šå‘ç°, è™½ç„¶ CPU ä½¿ç”¨ç‡(%CPU)å¾ˆä½, ä½†"),a("strong",[s._v("ç­‰å¾…è¿è¡Œçš„ä½¿ç”¨ç‡(%wait)å´éå¸¸é«˜")]),s._v(", æœ€é«˜ç”šè‡³å·²ç»è¾¾åˆ°äº† 97%. è¿™è¯´æ˜"),a("strong",[s._v("è¿™äº›çº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾…è°ƒåº¦")]),s._v(", è€Œä¸æ˜¯çœŸæ­£çš„è¿è¡Œ. æ³¨: å¦‚æœçœ‹ä¸åˆ° %wait æŒ‡æ ‡, è¯·å…ˆå‡çº§ sysstat åå†è¯•è¯•.")]),s._v(" "),a("p",[s._v("ä¸ºä»€ä¹ˆ CPU ä½¿ç”¨ç‡è¿™ä¹ˆä½, çº¿ç¨‹çš„å¤§éƒ¨åˆ†æ—¶é—´è¿˜è¦ç­‰å¾… CPU å‘¢? ç”±äºè¿™ä¸ªç°è±¡å›  Docker è€Œèµ·, è‡ªç„¶çš„, åº”è¯¥æƒ³åˆ°, è¿™å¯èƒ½æ˜¯"),a("strong",[s._v("å› ä¸º Docker ä¸ºå®¹å™¨è®¾ç½®äº†é™åˆ¶")]),s._v(".")]),s._v(" "),a("p",[s._v("å†å›é¡¾ä¸€ä¸‹, æ¡ˆä¾‹å¼€å§‹æ—¶å®¹å™¨çš„å¯åŠ¨å‘½ä»¤. ç”¨ "),a("code",[s._v("--cpus 0.1")]),s._v("â€‹ ä¸ºå®¹å™¨è®¾ç½®äº† 0.1 ä¸ª CPU çš„é™åˆ¶, ä¹Ÿå°±æ˜¯ 10% çš„ CPU. è¿™é‡Œä¹Ÿå°±å¯ä»¥è§£é‡Š, ä¸ºä»€ä¹ˆ java è¿›ç¨‹åªæœ‰ 10% çš„ CPU ä½¿ç”¨ç‡, ä¹Ÿä¼šå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾…äº†.")]),s._v(" "),a("p",[s._v("æ‰¾å‡ºåŸå› , æœ€åçš„ä¼˜åŒ–ä¹Ÿå°±ç®€å•äº†, æŠŠ CPU é™åˆ¶å¢å¤§å°±å¯ä»¥äº†. æ¯”å¦‚å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°† CPU é™åˆ¶å¢å¤§åˆ° 1; ç„¶åå†é‡å¯, å¹¶è§‚å¯Ÿå¯åŠ¨æ—¥å¿—:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ é™¤æ—§å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" tomcat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œæ–°å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" tomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cpus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" 512M "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-Xmx512m -Xms512m'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/tomcat:8\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹å®¹å™¨æ—¥å¿—")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" tomcat\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("-Feb-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":54:02.139 INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" org.apache.catalina.startup.Catalina.start Server startup "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2001")]),s._v(" ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ç°åœ¨å¯ä»¥çœ‹åˆ°, Tomcat çš„å¯åŠ¨è¿‡ç¨‹, åªéœ€è¦ 2 ç§’å°±å®Œæˆäº†, æœç„¶æ¯”å‰é¢çš„ 22 ç§’å¿«å¤šäº†.")]),s._v(" "),a("p",[s._v("è™½ç„¶é€šè¿‡å¢å¤§ CPU çš„é™åˆ¶, è§£å†³äº†è¿™ä¸ªé—®é¢˜. ä¸è¿‡å†ç¢°åˆ°ç±»ä¼¼é—®é¢˜, ä½ å¯èƒ½ä¼šè§‰å¾—è¿™ç§æ–¹æ³•å¤ªéº»çƒ¦äº†. å› ä¸ºè¦è®¾ç½®å®¹å™¨çš„èµ„æºé™åˆ¶, è¿˜éœ€è¦é¢„å…ˆè¯„ä¼°åº”ç”¨ç¨‹åºçš„æ€§èƒ½. æ˜¾ç„¶è¿˜æœ‰æ›´ç®€å•çš„æ–¹æ³•, æ¯”å¦‚è¯´ç›´æ¥å»æ‰é™åˆ¶, è®©å®¹å™¨è·‘å°±æ˜¯äº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™ç§ç®€å•æ–¹æ³•, å´å¾ˆå¯èƒ½å¸¦æ¥æ›´ä¸¥é‡çš„é—®é¢˜. "),a("strong",[s._v("æ²¡æœ‰èµ„æºé™åˆ¶, å°±æ„å‘³ç€å®¹å™¨å¯ä»¥å ç”¨æ•´ä¸ªç³»ç»Ÿçš„èµ„æº")]),s._v(". è¿™æ ·, ä¸€æ—¦ä»»ä½•åº”ç”¨ç¨‹åºå‘ç”Ÿå¼‚å¸¸, éƒ½æœ‰å¯èƒ½æ‹–å®æ•´å°æœºå™¨.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, è¿™ä¹Ÿæ˜¯åœ¨å„å¤§å®¹å™¨å¹³å°ä¸Šæœ€å¸¸è§çš„ä¸€ä¸ªé—®é¢˜. "),a("strong",[s._v("ä¸€å¼€å§‹å›¾çœäº‹ä¸è®¾é™, ä½†å½“å®¹å™¨æ•°é‡å¢é•¿ä¸Šæ¥çš„æ—¶å€™, å°±ä¼šç»å¸¸å‡ºç°å„ç§å¼‚å¸¸é—®é¢˜. æœ€ç»ˆæŸ¥ä¸‹æ¥, å¯èƒ½å°±æ˜¯å› ä¸ºæŸä¸ªåº”ç”¨èµ„æºä½¿ç”¨è¿‡é«˜, å¯¼è‡´æ•´å°æœºå™¨çŸ­æœŸå†…æ— æ³•å“åº”. åªæœ‰è®¾ç½®äº†èµ„æºé™åˆ¶, æ‰èƒ½ç¡®ä¿æœç»ç±»ä¼¼é—®é¢˜")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-8"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å­¦ä¹ äº†å¦‚ä½•åˆ†æå®¹å™¨åŒ–ååº”ç”¨ç¨‹åºæ€§èƒ½ä¸‹é™çš„é—®é¢˜. å¦‚æœåœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ Java åº”ç”¨, ä¸€å®šè¦ç¡®ä¿, åœ¨è®¾ç½®å®¹å™¨èµ„æºé™åˆ¶çš„åŒæ—¶, é…ç½®å¥½ JVM çš„èµ„æºé€‰é¡¹(æ¯”å¦‚å †å†…å­˜ç­‰). å½“ç„¶, å¦‚æœå¯ä»¥å‡çº§ Java ç‰ˆæœ¬, é‚£ä¹ˆå‡çº§åˆ° Java 10, å°±å¯ä»¥è‡ªåŠ¨è§£å†³ç±»ä¼¼é—®é¢˜äº†.")]),s._v(" "),a("p",[s._v("å½“ç¢°åˆ°å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºæ€§èƒ½æ—¶, ä¾ç„¶å¯ä»¥ä½¿ç”¨å‰é¢è®²è¿‡çš„å„ç§æ–¹æ³•æ¥åˆ†æå’Œå®šä½. åªä¸è¿‡è¦è®°å¾—, å®¹å™¨åŒ–åçš„æ€§èƒ½åˆ†æ, è·Ÿå‰é¢å†…å®¹ç¨å¾®æœ‰äº›åŒºåˆ«, æ¯”å¦‚ä¸‹é¢è¿™å‡ ç‚¹.")]),s._v(" "),a("ul",[a("li",[s._v("å®¹å™¨æœ¬èº«é€šè¿‡ cgroups è¿›è¡Œèµ„æºéš”ç¦», æ‰€ä»¥åœ¨åˆ†ææ—¶è¦è€ƒè™‘ cgroups å¯¹åº”ç”¨ç¨‹åºçš„å½±å“.")]),s._v(" "),a("li",[s._v("å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ, ç½‘ç»œåè®®æ ˆç­‰è·Ÿä¸»æœºéš”ç¦». è™½ç„¶åœ¨å®¹å™¨å¤–é¢, ä¹Ÿå¯ä»¥åˆ†æå®¹å™¨çš„è¡Œä¸º, ä¸è¿‡æœ‰æ—¶å€™, è¿›å…¥å®¹å™¨çš„å‘½åç©ºé—´å†…éƒ¨, å¯èƒ½æ›´ä¸ºæ–¹ä¾¿.")]),s._v(" "),a("li",[s._v("å®¹å™¨çš„è¿è¡Œå¯èƒ½è¿˜ä¼šä¾èµ–äºå…¶ä»–ç»„ä»¶, æ¯”å¦‚å„ç§ç½‘ç»œæ’ä»¶(æ¯”å¦‚ CNI), å­˜å‚¨æ’ä»¶(æ¯”å¦‚ CSI), è®¾å¤‡æ’ä»¶(æ¯”å¦‚ GPU)ç­‰, è®©å®¹å™¨çš„æ€§èƒ½åˆ†ææ›´åŠ å¤æ‚. å¦‚æœéœ€è¦åˆ†æå®¹å™¨æ€§èƒ½, åˆ«å¿˜äº†è€ƒè™‘å®ƒä»¬å¯¹æ€§èƒ½çš„å½±å“.")])]),s._v(" "),a("h4",{attrs:{id:"_47-æ¡ˆä¾‹ç¯‡-æœåŠ¡å™¨æ€»æ˜¯æ—¶ä¸æ—¶ä¸¢åŒ…è¯¥æ€ä¹ˆåŠ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_47-æ¡ˆä¾‹ç¯‡-æœåŠ¡å™¨æ€»æ˜¯æ—¶ä¸æ—¶ä¸¢åŒ…è¯¥æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 47-æ¡ˆä¾‹ç¯‡:æœåŠ¡å™¨æ€»æ˜¯æ—¶ä¸æ—¶ä¸¢åŒ…è¯¥æ€ä¹ˆåŠ?")]),s._v(" "),a("p",[s._v("æ‰€è°“ä¸¢åŒ…, æ˜¯æŒ‡åœ¨ç½‘ç»œæ•°æ®çš„æ”¶å‘è¿‡ç¨‹ä¸­, ç”±äºç§ç§åŸå› , æ•°æ®åŒ…è¿˜æ²¡ä¼ è¾“åˆ°åº”ç”¨ç¨‹åºä¸­, å°±è¢«ä¸¢å¼ƒäº†. è¿™äº›è¢«ä¸¢å¼ƒåŒ…çš„æ•°é‡, é™¤ä»¥æ€»çš„ä¼ è¾“åŒ…æ•°, ä¹Ÿå°±æ˜¯å¸¸è¯´çš„"),a("strong",[s._v("ä¸¢åŒ…ç‡")]),s._v(". ä¸¢åŒ…ç‡æ˜¯ç½‘ç»œæ€§èƒ½ä¸­æœ€æ ¸å¿ƒçš„æŒ‡æ ‡ä¹‹ä¸€. "),a("strong",[s._v("ä¸¢åŒ…é€šå¸¸ä¼šå¸¦æ¥ä¸¥é‡çš„æ€§èƒ½ä¸‹é™, ç‰¹åˆ«æ˜¯å¯¹ TCP æ¥è¯´, ä¸¢åŒ…é€šå¸¸æ„å‘³ç€ç½‘ç»œæ‹¥å¡å’Œé‡ä¼ , è¿›è€Œè¿˜ä¼šå¯¼è‡´ç½‘ç»œå»¶è¿Ÿå¢å¤§, ååé™ä½")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±ä»¥æœ€å¸¸ç”¨çš„åå‘ä»£ç†æœåŠ¡å™¨ Nginx ä¸ºä¾‹æ¥ä¸€èµ·çœ‹çœ‹, å¦‚ä½•åˆ†æç½‘ç»œä¸¢åŒ…çš„é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹å‡†å¤‡-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹å‡†å¤‡-8"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹éœ€è¦ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœº, è¿˜æ˜¯åŸºäº Ubuntu 18.04, åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿ. æˆ‘ä½¿ç”¨çš„æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, curl, hping3 ç­‰å·¥å…·, å¦‚ apt install docker.io curl hping3.")])]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹åˆ†æ-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹åˆ†æ-9"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("ä»Šå¤©è¦åˆ†æçš„æ¡ˆä¾‹æ˜¯ä¸€ä¸ª Nginx åº”ç”¨, å¦‚ä¸‹å›¾æ‰€ç¤º, hping3 å’Œ curl æ˜¯ Nginx çš„å®¢æˆ·ç«¯.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/eee6c075999a343c251795164687b31b-20230731161933-mtky64j.png",alt:""}})]),s._v(" "),a("p",[s._v("ä¸ºäº†æ–¹ä¾¿è¿è¡Œ, æˆ‘å·²ç»æŠŠå®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ª Docker é•œåƒ, å¹¶æ¨é€åˆ° Docker Hub ä¸­. å¯ä»¥ç›´æ¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥è¿è¡Œå®ƒ.")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸€ä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å¯åŠ¨ Nginx åº”ç”¨, å¹¶åœ¨ 80 ç«¯å£ç›‘å¬. å¦‚æœä¸€åˆ‡æ­£å¸¸, åº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--hostname")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx:drop\ndae0202cc27e5082b282a6aeeb1398fcec423c642e63322da2a97b9ebd7538e0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶å, æ‰§è¡Œ docker ps å‘½ä»¤, æŸ¥è¯¢å®¹å™¨çš„çŠ¶æ€, ä¼šå‘ç°å®¹å™¨å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€(Up)äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                NAMES\ndae0202cc27e        feisky/nginx:drop   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/start.sh"')]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago       Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä¸è¿‡, ä» docker ps çš„è¾“å‡º, åªèƒ½çŸ¥é“å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€, è‡³äº Nginx æ˜¯å¦å¯ä»¥æ­£å¸¸å¤„ç†å¤–éƒ¨è¯·æ±‚, è¿˜éœ€è¦è¿›ä¸€æ­¥çš„ç¡®è®¤.")]),s._v(" "),a("p",[s._v("æ¥ç€åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, æ‰§è¡Œä¸‹é¢çš„ hping3 å‘½ä»¤, è¿›ä¸€æ­¥éªŒè¯ Nginx æ˜¯ä¸æ˜¯çœŸçš„å¯ä»¥æ­£å¸¸è®¿é—®äº†. æ³¨æ„, è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ ping, æ˜¯å› ä¸º ping åŸºäº ICMP åè®®, è€Œ Nginx ä½¿ç”¨çš„æ˜¯ TCP åè®®.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -c è¡¨ç¤ºå‘é€ 10 ä¸ªè¯·æ±‚, -S è¡¨ç¤ºä½¿ç”¨ TCP SYN, -p æŒ‡å®šç«¯å£ä¸º 80")]),s._v("\n$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\nHPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eth0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": S set, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" headers + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.5")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.4")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3027.2")]),s._v(" ms\n \n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 hping statistic ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("% packet loss\nround-trip min/avg/max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v("/609.7/3027.2 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("ä» hping3 çš„è¾“å‡ºä¸­å¯ä»¥å‘ç°, å‘é€äº† 10 ä¸ªè¯·æ±‚åŒ…, å´åªæ”¶åˆ°äº† 5 ä¸ªå›å¤, 50% çš„åŒ…éƒ½ä¸¢äº†. å†è§‚å¯Ÿæ¯ä¸ªè¯·æ±‚çš„ RTT å¯ä»¥å‘ç°, RTT ä¹Ÿæœ‰éå¸¸å¤§çš„æ³¢åŠ¨å˜åŒ–, å°çš„æ—¶å€™åªæœ‰ 3ms, è€Œå¤§çš„æ—¶å€™åˆ™æœ‰ 3s.")]),s._v(" "),a("p",[s._v("æ ¹æ®è¿™äº›è¾“å‡º, åŸºæœ¬èƒ½åˆ¤æ–­, å·²ç»å‘ç”Ÿäº†"),a("strong",[s._v("ä¸¢åŒ…ç°è±¡")]),s._v(". å¯ä»¥çŒœæµ‹, 3s çš„ RTT å¾ˆå¯èƒ½æ˜¯å› ä¸ºä¸¢åŒ…åé‡ä¼ å¯¼è‡´çš„. é‚£åˆ°åº•æ˜¯å“ªé‡Œå‘ç”Ÿäº†ä¸¢åŒ…å‘¢?")]),s._v(" "),a("p",[s._v("æ’æŸ¥ä¹‹å‰, å¯ä»¥å›å¿†ä¸€ä¸‹ Linux çš„ç½‘ç»œæ”¶å‘æµç¨‹, å…ˆä»ç†è®ºä¸Šåˆ†æ, å“ªé‡Œæœ‰å¯èƒ½ä¼šå‘ç”Ÿä¸¢åŒ…. ä¸ºäº†å¸®ä½ ç†è§£ç½‘ç»œä¸¢åŒ…çš„åŸç†, æˆ‘ç”»äº†ä¸€å¼ å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/7b194e40fb35f34e975ce44a4a210e2e-20230731161933-g4c0jen.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»å›¾ä¸­å¯ä»¥çœ‹å‡º, "),a("strong",[s._v("å¯èƒ½å‘ç”Ÿä¸¢åŒ…çš„ä½ç½®, å®é™…ä¸Šè´¯ç©¿äº†æ•´ä¸ªç½‘ç»œåè®®æ ˆ. æ¢å¥è¯è¯´, å…¨ç¨‹éƒ½æœ‰ä¸¢åŒ…çš„å¯èƒ½")]),s._v(". æ¯”å¦‚ä»ä¸‹å¾€ä¸Šçœ‹:")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨ä¸¤å° VM è¿æ¥ä¹‹é—´, å¯èƒ½ä¼šå‘ç”Ÿä¼ è¾“å¤±è´¥çš„é”™è¯¯, æ¯”å¦‚ç½‘ç»œæ‹¥å¡, çº¿è·¯é”™è¯¯ç­‰;")]),s._v(" "),a("li",[s._v("åœ¨ç½‘å¡æ”¶åŒ…å, ç¯å½¢ç¼“å†²åŒºå¯èƒ½ä¼šå› ä¸ºæº¢å‡ºè€Œä¸¢åŒ…;")]),s._v(" "),a("li",[s._v("åœ¨é“¾è·¯å±‚, å¯èƒ½ä¼šå› ä¸ºç½‘ç»œå¸§æ ¡éªŒå¤±è´¥, QoS ç­‰è€Œä¸¢åŒ…;")]),s._v(" "),a("li",[s._v("åœ¨ IP å±‚, å¯èƒ½ä¼šå› ä¸ºè·¯ç”±å¤±è´¥, ç»„åŒ…å¤§å°è¶…è¿‡ MTU ç­‰è€Œä¸¢åŒ…;")]),s._v(" "),a("li",[s._v("åœ¨ä¼ è¾“å±‚, å¯èƒ½ä¼šå› ä¸ºç«¯å£æœªç›‘å¬, èµ„æºå ç”¨è¶…è¿‡å†…æ ¸é™åˆ¶ç­‰è€Œä¸¢åŒ…;")]),s._v(" "),a("li",[s._v("åœ¨å¥—æ¥å­—å±‚, å¯èƒ½ä¼šå› ä¸ºå¥—æ¥å­—ç¼“å†²åŒºæº¢å‡ºè€Œä¸¢åŒ…;")]),s._v(" "),a("li",[s._v("åœ¨åº”ç”¨å±‚, å¯èƒ½ä¼šå› ä¸ºåº”ç”¨ç¨‹åºå¼‚å¸¸è€Œä¸¢åŒ…;")]),s._v(" "),a("li",[s._v("æ­¤å¤–, å¦‚æœé…ç½®äº† iptables è§„åˆ™, è¿™äº›ç½‘ç»œåŒ…ä¹Ÿå¯èƒ½å› ä¸º iptables è¿‡æ»¤è§„åˆ™è€Œä¸¢åŒ….")])]),s._v(" "),a("p",[s._v("å½“ç„¶ä¸Šé¢è¿™äº›é—®é¢˜, è¿˜æœ‰å¯èƒ½åŒæ—¶å‘ç”Ÿåœ¨é€šä¿¡çš„ä¸¤å°æœºå™¨ä¸­. ä¸è¿‡, ç”±äºæ²¡å¯¹ VM2 åšä»»ä½•ä¿®æ”¹, å¹¶ä¸” VM2 ä¹Ÿåªè¿è¡Œäº†ä¸€ä¸ªæœ€ç®€å•çš„ hping3 å‘½ä»¤, è¿™å„¿ä¸å¦¨å‡è®¾å®ƒæ˜¯æ²¡æœ‰é—®é¢˜çš„.")]),s._v(" "),a("p",[s._v("ä¸ºäº†ç®€åŒ–æ•´ä¸ªæ’æŸ¥è¿‡ç¨‹, è¿˜å¯ä»¥è¿›ä¸€æ­¥å‡è®¾ VM1 çš„ç½‘ç»œå’Œå†…æ ¸é…ç½®ä¹Ÿæ²¡é—®é¢˜. è¿™æ ·ä¸€æ¥, æœ‰å¯èƒ½å‘ç”Ÿé—®é¢˜çš„ä½ç½®, å°±éƒ½åœ¨"),a("strong",[s._v("å®¹å™¨å†…éƒ¨")]),s._v("äº†.")]),s._v(" "),a("p",[s._v("ç°åœ¨åˆ‡æ¢å›ç»ˆç«¯ä¸€, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, è¿›å…¥å®¹å™¨çš„ç»ˆç«¯ä¸­:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nroot@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("åœ¨è¿™é‡Œç®€å•è¯´æ˜ä¸€ä¸‹, æ¥ä¸‹æ¥çš„æ‰€æœ‰åˆ†æ, å‰é¢å¸¦æœ‰ "),a("code",[s._v("root@nginx:/#")]),s._v("â€‹ çš„æ“ä½œ, éƒ½è¡¨ç¤ºåœ¨å®¹å™¨ä¸­è¿›è¡Œ.")]),s._v(" "),a("p",[s._v("å®é™…ç¯å¢ƒä¸­, å®¹å™¨å†…éƒ¨å’Œå¤–éƒ¨éƒ½æœ‰å¯èƒ½å‘ç”Ÿé—®é¢˜. ä¸è¿‡ä¸è¦æ‹…å¿ƒ, å®¹å™¨å†…, å¤–éƒ¨çš„åˆ†ææ­¥éª¤å’Œæ€è·¯éƒ½æ˜¯ä¸€æ ·çš„, åªä¸è¿‡è¦èŠ±æ›´å¤šçš„æ—¶é—´è€Œå·².")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥ä»åè®®æ ˆä¸­, "),a("strong",[s._v("é€å±‚æ’æŸ¥ä¸¢åŒ…é—®é¢˜")]),s._v(".")]),s._v(" "),a("h6",{attrs:{id:"_1-é“¾è·¯å±‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-é“¾è·¯å±‚"}},[s._v("#")]),s._v(" (1)é“¾è·¯å±‚")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ¥çœ‹æœ€åº•ä¸‹çš„é“¾è·¯å±‚. å½“ç¼“å†²åŒºæº¢å‡ºç­‰åŸå› å¯¼è‡´ç½‘å¡ä¸¢åŒ…æ—¶, "),a("strong",[s._v("Linux ä¼šåœ¨ç½‘å¡æ”¶å‘æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯ä¸­, è®°å½•ä¸‹æ”¶å‘é”™è¯¯çš„æ¬¡æ•°")]),s._v(".")]),s._v(" "),a("p",[s._v("å¯ä»¥é€šè¿‡ ethtool æˆ–è€… netstat æ¥æŸ¥çœ‹ç½‘å¡çš„ä¸¢åŒ…è®°å½•. æ¯”å¦‚å¯ä»¥åœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹ä¸¢åŒ…æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -i")]),s._v("\nKernel Interface table\nIface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg\neth0       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" BMRU\nlo       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" LRU\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("è¾“å‡ºä¸­çš„ RX-OK, RX-ERR, RX-DRP, RX-OVR, åˆ†åˆ«è¡¨ç¤ºæ¥æ”¶æ—¶çš„æ€»åŒ…æ•°, æ€»é”™è¯¯æ•°, è¿›å…¥ Ring Buffer åå› å…¶ä»–åŸå› (å¦‚å†…å­˜ä¸è¶³)å¯¼è‡´çš„ä¸¢åŒ…æ•°ä»¥åŠ Ring Buffer æº¢å‡ºå¯¼è‡´çš„ä¸¢åŒ…æ•°.")]),s._v(" "),a("p",[s._v("TX-OK, TX-ERR, TX-DRP, TX-OVR ä¹Ÿä»£è¡¨ç±»ä¼¼çš„å«ä¹‰, åªä¸è¿‡æ˜¯æŒ‡å‘é€æ—¶å¯¹åº”çš„å„ä¸ªæŒ‡æ ‡.")]),s._v(" "),a("p",[s._v("æ³¨æ„, ç”±äº Docker å®¹å™¨çš„è™šæ‹Ÿç½‘å¡, å®é™…ä¸Šæ˜¯ä¸€å¯¹ veth pair, ä¸€ç«¯æ¥å…¥å®¹å™¨ä¸­ç”¨ä½œ eth0, å¦ä¸€ç«¯åœ¨ä¸»æœºä¸­æ¥å…¥ docker0 ç½‘æ¡¥ä¸­. veth é©±åŠ¨å¹¶æ²¡æœ‰å®ç°ç½‘ç»œç»Ÿè®¡çš„åŠŸèƒ½, æ‰€ä»¥ä½¿ç”¨ ethtool -S å‘½ä»¤, æ— æ³•å¾—åˆ°ç½‘å¡æ”¶å‘æ•°æ®çš„æ±‡æ€»ä¿¡æ¯.")]),s._v(" "),a("p",[s._v("ä»è¿™ä¸ªè¾“å‡ºä¸­, æ²¡æœ‰å‘ç°ä»»ä½•é”™è¯¯, è¯´æ˜å®¹å™¨çš„è™šæ‹Ÿç½‘å¡æ²¡æœ‰ä¸¢åŒ…. ä¸è¿‡è¦æ³¨æ„, å¦‚æœç”¨ tc ç­‰å·¥å…·é…ç½®äº† QoS, é‚£ä¹ˆ tc è§„åˆ™å¯¼è‡´çš„ä¸¢åŒ…, å°±ä¸ä¼šåŒ…å«åœ¨ç½‘å¡çš„ç»Ÿè®¡ä¿¡æ¯ä¸­.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥æ¥ä¸‹æ¥è¿˜è¦æ£€æŸ¥ä¸€ä¸‹ eth0 ä¸Šæ˜¯å¦é…ç½®äº† tc è§„åˆ™, å¹¶æŸ¥çœ‹æœ‰æ²¡æœ‰ä¸¢åŒ…. ç»§ç»­å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„ tc å‘½ä»¤, ä¸è¿‡è¿™æ¬¡æ³¨æ„æ·»åŠ  -s é€‰é¡¹, ä»¥è¾“å‡ºç»Ÿè®¡ä¿¡æ¯:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tc -s qdisc show dev eth0")]),s._v("\nqdisc netem 800d: root refcnt "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" limit "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" loss "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("%\n Sent "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("432")]),s._v(" bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" pkt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(", overlimits "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" requeues "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n backlog 0b 0p requeues "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("ä» tc çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, eth0 ä¸Šé¢é…ç½®äº†ä¸€ä¸ªç½‘ç»œæ¨¡æ‹Ÿæ’é˜Ÿè§„åˆ™(qdisc netem), å¹¶ä¸”é…ç½®äº†ä¸¢åŒ…ç‡ä¸º 30%(loss 30%). å†çœ‹åé¢çš„ç»Ÿè®¡ä¿¡æ¯, å‘é€äº† 8 ä¸ªåŒ…, ä½†æ˜¯ä¸¢äº† 4 ä¸ª")]),s._v(".")]),s._v(" "),a("p",[s._v("çœ‹æ¥åº”è¯¥å°±æ˜¯è¿™é‡Œ, å¯¼è‡´ Nginx å›å¤çš„å“åº”åŒ…è¢« netem æ¨¡å—ç»™ä¸¢äº†.")]),s._v(" "),a("p",[s._v("æ—¢ç„¶å‘ç°äº†é—®é¢˜, è§£å†³æ–¹æ³•ä¹Ÿå°±å¾ˆç®€å•äº†, ç›´æ¥åˆ æ‰ netem æ¨¡å—å°±å¯ä»¥äº†. å¯ä»¥ç»§ç»­åœ¨å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, åˆ é™¤ tc ä¸­çš„ netem æ¨¡å—:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tc qdisc del dev eth0 root netem loss 30%")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("åˆ é™¤å, é—®é¢˜åˆ°åº•è§£å†³äº†æ²¡? åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, é‡æ–°æ‰§è¡Œåˆšæ‰çš„ hping3 å‘½ä»¤, çœ‹çœ‹ç°åœ¨è¿˜æœ‰æ²¡æœ‰é—®é¢˜:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\nHPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eth0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": S set, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" headers + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.9")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1003.8")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.6")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.4")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" ms\n \n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 hping statistic ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("% packet loss\nround-trip min/avg/max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v("/205.9/1003.8 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("ä¸å¹¸çš„æ˜¯, ä» hping3 çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, è·Ÿå‰é¢ç°è±¡ä¸€æ ·, è¿˜æ˜¯ 50% çš„ä¸¢åŒ…; RTT çš„æ³¢åŠ¨ä¹Ÿä»æ—§å¾ˆå¤§, ä» 3ms åˆ° 1s.")]),s._v(" "),a("p",[s._v("æ˜¾ç„¶, é—®é¢˜è¿˜æ˜¯æ²¡è§£å†³, ä¸¢åŒ…è¿˜åœ¨ç»§ç»­å‘ç”Ÿ. ä¸è¿‡, æ—¢ç„¶é“¾è·¯å±‚å·²ç»æ’æŸ¥å®Œäº†, å°±ç»§ç»­å‘ä¸Šå±‚åˆ†æ, çœ‹çœ‹ç½‘ç»œå±‚å’Œä¼ è¾“å±‚æœ‰æ²¡æœ‰é—®é¢˜.")]),s._v(" "),a("h6",{attrs:{id:"_2-ç½‘ç»œå±‚å’Œä¼ è¾“å±‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç½‘ç»œå±‚å’Œä¼ è¾“å±‚"}},[s._v("#")]),s._v(" (2)ç½‘ç»œå±‚å’Œä¼ è¾“å±‚")]),s._v(" "),a("p",[s._v("åœ¨ç½‘ç»œå±‚å’Œä¼ è¾“å±‚ä¸­, å¼•å‘ä¸¢åŒ…çš„å› ç´ éå¸¸å¤š. ä¸è¿‡å…¶å®æƒ³ç¡®è®¤æ˜¯å¦ä¸¢åŒ…, æ˜¯éå¸¸ç®€å•çš„äº‹, å› ä¸º Linux å·²ç»æä¾›äº†å„ä¸ªåè®®çš„æ”¶å‘æ±‡æ€»æƒ…å†µ.")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„ netstat -s å‘½ä»¤, å°±å¯ä»¥çœ‹åˆ°åè®®çš„æ”¶å‘æ±‡æ€», ä»¥åŠé”™è¯¯ä¿¡æ¯äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -s")]),s._v("\nIp:\n    Forwarding: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\t\t\t\t\t// å¼€å¯è½¬å‘\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" total packets received\t\t// æ€»æ”¶åŒ…æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" forwarded\t\t\t\t\t\t// è½¬å‘åŒ…æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" incoming packets discarded\t// æ¥æ”¶ä¸¢åŒ…æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" incoming packets delivered\t// æ¥æ”¶çš„æ•°æ®åŒ…æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" requests sent out\t\t\t// å‘å‡ºçš„æ•°æ®åŒ…æ•°\nIcmp:\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ICMP messages received\t\t// æ”¶åˆ°çš„ ICMP åŒ…æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" input ICMP message failed\t\t// æ”¶åˆ° ICMP å¤±è´¥æ•°\n    ICMP input histogram:\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ICMP messages sent\t\t\t//ICMP å‘é€æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ICMP messages failed\t\t\t//ICMP å¤±è´¥æ•°\n    ICMP output histogram:\nTcp:\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" active connection openings\t// ä¸»åŠ¨è¿æ¥æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" passive connection openings\t// è¢«åŠ¨è¿æ¥æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" failed connection attempts\t// å¤±è´¥è¿æ¥å°è¯•æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" connection resets received\t// æ¥æ”¶çš„è¿æ¥é‡ç½®æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" connections established\t\t// å»ºç«‹è¿æ¥æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" segments received\t\t\t// å·²æ¥æ”¶æŠ¥æ–‡æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" segments sent out\t\t\t// å·²å‘é€æŠ¥æ–‡æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" segments retransmitted\t\t// é‡ä¼ æŠ¥æ–‡æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bad segments received\t\t\t// é”™è¯¯æŠ¥æ–‡æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" resets sent\t\t\t\t\t// å‘å‡ºçš„è¿æ¥é‡ç½®æ•°\nUdp:\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets received\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nTcpExt:\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" resets received "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" embryonic SYN_RECV sockets\t// åŠè¿æ¥é‡ç½®æ•°\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packet headers predicted\n    TCPTimeouts: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\t\t// è¶…æ—¶æ•°\n    TCPSynRetrans: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\t//SYN é‡ä¼ æ•°\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("p",[a("strong",[s._v("netstat æ±‡æ€»äº† IP, ICMP, TCP, UDP ç­‰å„ç§åè®®çš„æ”¶å‘ç»Ÿè®¡ä¿¡æ¯")]),s._v(". ä¸è¿‡, æˆ‘ä»¬çš„ç›®çš„æ˜¯æ’æŸ¥ä¸¢åŒ…é—®é¢˜, æ‰€ä»¥è¿™é‡Œä¸»è¦è§‚å¯Ÿçš„æ˜¯"),a("strong",[s._v("é”™è¯¯æ•°, ä¸¢åŒ…æ•°ä»¥åŠé‡ä¼ æ•°")]),s._v(".")]),s._v(" "),a("p",[s._v("æ ¹æ®ä¸Šé¢çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°, "),a("strong",[s._v("åªæœ‰ TCP åè®®å‘ç”Ÿäº†ä¸¢åŒ…å’Œé‡ä¼ ")]),s._v(", åˆ†åˆ«æ˜¯:")]),s._v(" "),a("ul",[a("li",[s._v("11 æ¬¡è¿æ¥å¤±è´¥é‡è¯•(11 failed connection attempts)")]),s._v(" "),a("li",[s._v("4 æ¬¡é‡ä¼ (4 segments retransmitted)")]),s._v(" "),a("li",[s._v("11 æ¬¡åŠè¿æ¥é‡ç½®(11 resets received for embryonic SYN_RECV sockets)")]),s._v(" "),a("li",[s._v("4 æ¬¡ SYN é‡ä¼ (TCPSynRetrans)")]),s._v(" "),a("li",[s._v("7 æ¬¡è¶…æ—¶(TCPTimeouts)")])]),s._v(" "),a("p",[s._v("è¿™ä¸ªç»“æœå‘Šè¯‰æˆ‘ä»¬, TCP åè®®æœ‰å¤šæ¬¡è¶…æ—¶å’Œå¤±è´¥é‡è¯•, å¹¶ä¸”"),a("strong",[s._v("ä¸»è¦é”™è¯¯æ˜¯åŠè¿æ¥é‡ç½®")]),s._v(". æ¢å¥è¯è¯´, "),a("strong",[s._v("ä¸»è¦çš„å¤±è´¥, éƒ½æ˜¯ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è™½ç„¶åœ¨è¿™å„¿çœ‹åˆ°äº†è¿™ä¹ˆå¤šå¤±è´¥, ä½†å…·ä½“å¤±è´¥çš„æ ¹æºè¿˜æ˜¯æ— æ³•ç¡®å®š. æ‰€ä»¥è¿˜éœ€è¦ç»§ç»­é¡ºç€åè®®æ ˆæ¥åˆ†æ. æ¥ä¸‹æ¥çš„å‡ å±‚åˆè¯¥å¦‚ä½•åˆ†æå‘¢?")]),s._v(" "),a("h5",{attrs:{id:"_3-iptables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-iptables"}},[s._v("#")]),s._v(" 3.iptables")]),s._v(" "),a("p",[s._v("é¦–å…ˆè¦çŸ¥é“, é™¤äº†ç½‘ç»œå±‚å’Œä¼ è¾“å±‚çš„å„ç§åè®®, iptables å’Œå†…æ ¸çš„è¿æ¥è·Ÿè¸ªæœºåˆ¶ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…. æ‰€ä»¥è¿™ä¹Ÿæ˜¯å‘ç”Ÿä¸¢åŒ…é—®é¢˜æ—¶, å¿…é¡»è¦æ’æŸ¥çš„ä¸€ä¸ªå› ç´ .")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹çœ‹è¿æ¥è·Ÿè¸ª, å‰é¢å·²ç»è®²è¿‡è¿æ¥è·Ÿè¸ªçš„ä¼˜åŒ–æ€è·¯. "),a("strong",[s._v("è¦ç¡®è®¤æ˜¯ä¸æ˜¯è¿æ¥è·Ÿè¸ªå¯¼è‡´çš„é—®é¢˜, å…¶å®åªéœ€è¦å¯¹æ¯”å½“å‰çš„è¿æ¥è·Ÿè¸ªæ•°å’Œæœ€å¤§è¿æ¥è·Ÿè¸ªæ•°å³å¯")]),s._v(".")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ç”±äºè¿æ¥è·Ÿè¸ªåœ¨ Linux å†…æ ¸ä¸­æ˜¯å…¨å±€çš„(ä¸å±äºç½‘ç»œå‘½åç©ºé—´), éœ€è¦é€€å‡ºå®¹å™¨ç»ˆç«¯, å›åˆ°ä¸»æœºä¸­æ¥æŸ¥çœ‹.")]),s._v(" "),a("p",[s._v("å¯ä»¥åœ¨å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œ "),a("code",[s._v("exit;")]),s._v("â€‹ ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹è¿æ¥è·Ÿè¸ªæ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®¹å™¨ç»ˆç«¯ä¸­æ‰§è¡Œ exit")]),s._v("\nroot@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸»æœºç»ˆç«¯ä¸­æŸ¥è¯¢å†…æ ¸é…ç½®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.netfilter.nf_conntrack_max\nnet.netfilter.nf_conntrack_max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.netfilter.nf_conntrack_count\nnet.netfilter.nf_conntrack_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("182")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ä»è¿™å„¿å¯ä»¥çœ‹åˆ°, è¿æ¥è·Ÿè¸ªæ•°åªæœ‰ 182, è€Œæœ€å¤§è¿æ¥è·Ÿè¸ªæ•°åˆ™æ˜¯ 262144. æ˜¾ç„¶è¿™é‡Œçš„ä¸¢åŒ…, ä¸å¯èƒ½æ˜¯è¿æ¥è·Ÿè¸ªå¯¼è‡´çš„.")]),s._v(" "),a("p",[s._v("æ¥ç€å†æ¥çœ‹ iptables. å›é¡¾ä¸€ä¸‹ iptables çš„åŸç†, å®ƒåŸºäº Netfilter æ¡†æ¶, é€šè¿‡ä¸€ç³»åˆ—çš„è§„åˆ™, å¯¹ç½‘ç»œæ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤(å¦‚é˜²ç«å¢™)å’Œä¿®æ”¹(å¦‚ NAT). è¿™äº› iptables è§„åˆ™, ç»Ÿä¸€ç®¡ç†åœ¨ä¸€ç³»åˆ—çš„è¡¨ä¸­, åŒ…æ‹¬ filter(ç”¨äºè¿‡æ»¤), nat(ç”¨äº NAT), mangle(ç”¨äºä¿®æ”¹åˆ†ç»„æ•°æ®) å’Œ raw(ç”¨äºåŸå§‹æ•°æ®åŒ…)ç­‰. è€Œæ¯å¼ è¡¨åˆå¯ä»¥åŒ…æ‹¬ä¸€ç³»åˆ—çš„é“¾, ç”¨äºå¯¹ iptables è§„åˆ™è¿›è¡Œåˆ†ç»„ç®¡ç†.")]),s._v(" "),a("p",[a("strong",[s._v("å¯¹äºä¸¢åŒ…é—®é¢˜æ¥è¯´, æœ€å¤§çš„å¯èƒ½å°±æ˜¯è¢« filter è¡¨ä¸­çš„è§„åˆ™ç»™ä¸¢å¼ƒäº†")]),s._v(". è¦å¼„æ¸…æ¥šè¿™ä¸€ç‚¹, å°±éœ€è¦ç¡®è®¤, é‚£äº›ç›®æ ‡ä¸º DROP å’Œ REJECT ç­‰ä¼šå¼ƒåŒ…çš„è§„åˆ™, æœ‰æ²¡æœ‰è¢«æ‰§è¡Œåˆ°.")]),s._v(" "),a("p",[s._v("å¯ä»¥æŠŠæ‰€æœ‰çš„ iptables è§„åˆ™åˆ—å‡ºæ¥, æ ¹æ®æ”¶å‘åŒ…çš„ç‰¹ç‚¹, è·Ÿ iptables è§„åˆ™è¿›è¡ŒåŒ¹é…. ä¸è¿‡æ˜¾ç„¶, å¦‚æœ iptables è§„åˆ™æ¯”è¾ƒå¤š, è¿™æ ·åšçš„æ•ˆç‡å°±ä¼šå¾ˆä½. å½“ç„¶, æ›´ç®€å•çš„æ–¹æ³•, å°±æ˜¯ç›´æ¥æŸ¥è¯¢ DROP å’Œ REJECT ç­‰è§„åˆ™çš„ç»Ÿè®¡ä¿¡æ¯, çœ‹çœ‹æ˜¯å¦ä¸º 0. å¦‚æœç»Ÿè®¡å€¼ä¸æ˜¯ 0 , å†æŠŠç›¸å…³çš„è§„åˆ™æ‹å‡ºæ¥è¿›è¡Œåˆ†æ.")]),s._v(" "),a("p",[s._v("å¯ä»¥é€šè¿‡ iptables -nvL å‘½ä»¤, æŸ¥çœ‹å„æ¡è§„åˆ™çš„ç»Ÿè®¡ä¿¡æ¯. æ¯”å¦‚å¯ä»¥æ‰§è¡Œä¸‹é¢çš„ docker exec å‘½ä»¤, è¿›å…¥å®¹å™¨ç»ˆç«¯; ç„¶åå†æ‰§è¡Œä¸‹é¢çš„ iptables å‘½ä»¤, å°±å¯ä»¥çœ‹åˆ° filter è¡¨çš„ç»Ÿè®¡æ•°æ®äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨ä¸»æœºä¸­æ‰§è¡Œ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨å®¹å™¨ä¸­æ‰§è¡Œ")]),s._v("\nroot@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -t filter -nvL")]),s._v("\nChain INPUT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" packets, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("240")]),s._v(" DROP       all  --  *      *       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            statistic mode random probability "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29999999981")]),s._v("\n \nChain FORWARD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n \nChain OUTPUT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" packets, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("660")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("264")]),s._v(" DROP       all  --  *      *       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            statistic mode random probability "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29999999981")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("ä» iptables çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, ä¸¤æ¡ DROP è§„åˆ™çš„ç»Ÿè®¡æ•°å€¼ä¸æ˜¯ 0, å®ƒä»¬åˆ†åˆ«åœ¨ INPUT å’Œ OUTPUT é“¾ä¸­. è¿™ä¸¤æ¡è§„åˆ™å®é™…ä¸Šæ˜¯ä¸€æ ·çš„, æŒ‡çš„æ˜¯ä½¿ç”¨ statistic æ¨¡å—, è¿›è¡Œéšæœº 30% çš„ä¸¢åŒ….")]),s._v(" "),a("p",[s._v("å†è§‚å¯Ÿä¸€ä¸‹å®ƒä»¬çš„åŒ¹é…è§„åˆ™. "),a("code",[s._v("0.0.0.0/0")]),s._v('â€‹ è¡¨ç¤ºåŒ¹é…æ‰€æœ‰çš„æº IP å’Œç›®çš„ IP, ä¹Ÿå°±æ˜¯ä¼šå¯¹æ‰€æœ‰åŒ…éƒ½è¿›è¡Œéšæœº 30% çš„ä¸¢åŒ…. çœ‹èµ·æ¥è¿™åº”è¯¥å°±æ˜¯å¯¼è‡´éƒ¨åˆ†ä¸¢åŒ…çš„"ç½ªé­ç¥¸é¦–"äº†.')]),s._v(" "),a("p",[s._v("æ—¢ç„¶æ‰¾å‡ºäº†åŸå› , æ¥ä¸‹æ¥çš„ä¼˜åŒ–å°±æ¯”è¾ƒç®€å•äº†. æ¯”å¦‚æŠŠè¿™ä¸¤æ¡è§„åˆ™ç›´æ¥åˆ é™¤å°±å¯ä»¥äº†. å¯ä»¥åœ¨å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„ä¸¤æ¡ iptables å‘½ä»¤, åˆ é™¤è¿™ä¸¤æ¡ DROP è§„åˆ™:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -t filter -D INPUT -m statistic --mode random --probability 0.30 -j DROP")]),s._v("\nroot@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -t filter -D OUTPUT -m statistic --mode random --probability 0.30 -j DROP")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("åˆ é™¤å, é—®é¢˜æ˜¯å¦å°±è¢«è§£å†³äº†å‘¢? å¯ä»¥åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, é‡æ–°æ‰§è¡Œåˆšæ‰çš„ hping3 å‘½ä»¤, çœ‹çœ‹ç°åœ¨æ˜¯å¦æ­£å¸¸:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\nHPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eth0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": S set, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" headers + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.9")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.8")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.0")]),s._v(" ms\n \n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 hping statistic ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v("/7.9/15.0 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("è¿™æ¬¡è¾“å‡ºå¯ä»¥çœ‹åˆ°, ç°åœ¨å·²ç»æ²¡æœ‰ä¸¢åŒ…äº†, å¹¶ä¸”å»¶è¿Ÿçš„æ³¢åŠ¨å˜åŒ–ä¹Ÿå¾ˆå°. çœ‹æ¥ä¸¢åŒ…é—®é¢˜åº”è¯¥å·²ç»è§£å†³äº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, åˆ°ç›®å‰ä¸ºæ­¢, ä¸€ç›´ä½¿ç”¨çš„ hping3 å·¥å…·, åªèƒ½éªŒè¯æ¡ˆä¾‹ Nginx çš„ 80 ç«¯å£å¤„äºæ­£å¸¸ç›‘å¬çŠ¶æ€, å´è¿˜æ²¡æœ‰è®¿é—® Nginx çš„ HTTP æœåŠ¡. æ‰€ä»¥ä¸è¦åŒ†å¿™ä¸‹ç»“è®ºç»“æŸè¿™æ¬¡ä¼˜åŒ–, è¿˜éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤, Nginx èƒ½ä¸èƒ½æ­£å¸¸å“åº” HTTP è¯·æ±‚.")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯äºŒä¸­, æ‰§è¡Œå¦‚ä¸‹çš„ curl å‘½ä»¤, æ£€æŸ¥ Nginx å¯¹ HTTP è¯·æ±‚çš„å“åº”:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --max-time "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" http://192.168.0.30\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Operation timed out after "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" milliseconds with "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes received\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ä» curl çš„è¾“å‡ºä¸­å¯ä»¥å‘ç°, è¿™æ¬¡è¿æ¥è¶…æ—¶äº†. å¯æ˜¯, åˆšæ‰æ˜æ˜ç”¨ hping3 éªŒè¯äº†ç«¯å£æ­£å¸¸, ç°åœ¨å´å‘ç° HTTP è¿æ¥è¶…æ—¶, æ˜¯ä¸æ˜¯å› ä¸º Nginx çªç„¶å¼‚å¸¸é€€å‡ºäº†å‘¢?")]),s._v(" "),a("p",[s._v("ä¸å¦¨å†æ¬¡è¿è¡Œ hping3 æ¥ç¡®è®¤ä¸€ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\nHPING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eth0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": S set, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" headers + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.8")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.7")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" DF "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SA "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),s._v(" ms\n \n--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30 hping statistic ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),s._v("/6.4/7.8 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("å¥‡æ€ª, hping3 çš„ç»“æœæ˜¾ç¤º, Nginx çš„ 80 ç«¯å£ç¡®ç¡®å®å®è¿˜æ˜¯æ­£å¸¸çŠ¶æ€. è¿™è¯¥å¦‚ä½•æ˜¯å¥½å‘¢? åˆ«å¿˜äº†è¿˜æœ‰ä¸ªå¤§æ€å™¨--æŠ“åŒ…æ“ä½œ. çœ‹æ¥æœ‰å¿…è¦æŠ“åŒ…çœ‹çœ‹äº†.")]),s._v(" "),a("h5",{attrs:{id:"_4-tcpdump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-tcpdump"}},[s._v("#")]),s._v(" 4.tcpdump")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥åˆ‡æ¢å›ç»ˆç«¯ä¸€, åœ¨å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„ tcpdump å‘½ä»¤, æŠ“å– 80 ç«¯å£çš„åŒ…:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcpdump -i eth0 -nn port 80")]),s._v("\ntcpdump: verbose output suppressed, use "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-vv")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full protocol decode\nlistening on eth0, link-type EN10MB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", capture size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v(" bytes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ç„¶ååˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, å†æ¬¡æ‰§è¡Œå‰é¢çš„ curl å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --max-time "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" http://192.168.0.30/\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Operation timed out after "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" milliseconds with "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes received\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç­‰åˆ° curl å‘½ä»¤ç»“æŸå, å†æ¬¡åˆ‡æ¢å›ç»ˆç«¯ä¸€, æŸ¥çœ‹ tcpdump çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":40:00.589235 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".255.5.39058 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2.80: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("332257715")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29200")]),s._v(", options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mss "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1418")]),s._v(",sackOK,TS val "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("486800541")]),s._v(" ecr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",nop,wscale "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":40:00.589277 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2.80 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".255.5.39058: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1630206251")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("332257716")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4880")]),s._v(", options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mss "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(",sackOK,TS val "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2509376001")]),s._v(" ecr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("486800541")]),s._v(",nop,wscale "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":40:00.589894 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".255.5.39058 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2.80: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("229")]),s._v(", options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nop,nop,TS val "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("486800541")]),s._v(" ecr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2509376001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":40:03.589352 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".255.5.39058 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2.80: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("F."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("76")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("229")]),s._v(", options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nop,nop,TS val "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("486803541")]),s._v(" ecr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2509376001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":40:03.589417 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2.80 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".255.5.39058: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(", options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nop,nop,TS val "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2509379001")]),s._v(" ecr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("486800541")]),s._v(",nop,nop,sack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("76")]),s._v(":77"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ç»è¿‡è¿™ä¹ˆä¸€ç³»åˆ—çš„æ“ä½œ, ä» tcpdump çš„è¾“å‡ºä¸­å°±å¯ä»¥çœ‹åˆ°:")]),s._v(" "),a("ul",[a("li",[s._v("å‰ä¸‰ä¸ªåŒ…æ˜¯æ­£å¸¸çš„ TCP ä¸‰æ¬¡æ¡æ‰‹, è¿™æ²¡é—®é¢˜;")]),s._v(" "),a("li",[s._v("ä½†ç¬¬å››ä¸ªåŒ…å´æ˜¯åœ¨ 3 ç§’ä»¥åäº†, å¹¶ä¸”è¿˜æ˜¯å®¢æˆ·ç«¯(VM2)å‘é€è¿‡æ¥çš„ FIN åŒ…, ä¹Ÿå°±è¯´æ˜, å®¢æˆ·ç«¯çš„è¿æ¥å…³é—­äº†.")])]),s._v(" "),a("p",[s._v("æ ¹æ® curl è®¾ç½®çš„ 3 ç§’è¶…æ—¶é€‰é¡¹åº”è¯¥èƒ½çŒœåˆ°, è¿™æ˜¯å› ä¸º curl å‘½ä»¤è¶…æ—¶åé€€å‡ºäº†.")]),s._v(" "),a("p",[s._v("æŠŠè¿™ä¸€è¿‡ç¨‹, ç”¨ TCP äº¤äº’çš„æµç¨‹å›¾(å®é™…ä¸Šæ¥è‡ª Wireshark çš„ Flow Graph)æ¥è¡¨ç¤º, å¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹åˆ°ä¸Šé¢è¿™ä¸ªé—®é¢˜:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/04312399f881d2caa43cf5e19e884e6b-20230731161933-pv86bao.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™é‡Œæ¯”è¾ƒå¥‡æ€ªçš„æ˜¯, å¹¶æ²¡æœ‰æŠ“å–åˆ° curl å‘æ¥çš„ HTTP GET è¯·æ±‚. é‚£ç©¶ç«Ÿæ˜¯ç½‘å¡ä¸¢åŒ…äº†, è¿˜æ˜¯å®¢æˆ·ç«¯å‹æ ¹å„¿å°±æ²¡å‘è¿‡æ¥å‘¢?")]),s._v(" "),a("p",[s._v("å¯ä»¥é‡æ–°æ‰§è¡Œ netstat -i å‘½ä»¤, ç¡®è®¤ä¸€ä¸‹ç½‘å¡æœ‰æ²¡æœ‰ä¸¢åŒ…é—®é¢˜:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -i")]),s._v("\nKernel Interface table\nIface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg\neth0       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("157")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("344")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" BMRU\nlo       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" LRU\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä» netstat çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, æ¥æ”¶ä¸¢åŒ…æ•°(RX-DRP)æ˜¯ 344, æœç„¶æ˜¯åœ¨ç½‘å¡æ¥æ”¶æ—¶ä¸¢åŒ…äº†. ä¸è¿‡é—®é¢˜ä¹Ÿæ¥äº†, ä¸ºä»€ä¹ˆåˆšæ‰ç”¨ hping3 æ—¶ä¸ä¸¢åŒ…, ç°åœ¨æ¢æˆ GET å°±æ”¶ä¸åˆ°äº†å‘¢?")]),s._v(" "),a("p",[s._v("è¿˜æ˜¯é‚£å¥è¯, é‡åˆ°æä¸æ‡‚çš„ç°è±¡, ä¸å¦¨å…ˆå»æŸ¥æŸ¥å·¥å…·å’Œæ–¹æ³•çš„åŸç†. å¯ä»¥å¯¹æ¯”ä¸€ä¸‹è¿™ä¸¤ä¸ªå·¥å…·:")]),s._v(" "),a("ul",[a("li",[s._v("hping3 å®é™…ä¸Šåªå‘é€äº† SYN åŒ…;")]),s._v(" "),a("li",[s._v("è€Œ curl åœ¨å‘é€ SYN åŒ…å, è¿˜ä¼šå‘é€ HTTP GET è¯·æ±‚.")])]),s._v(" "),a("p",[s._v("HTTP GET æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª TCP åŒ…, ä½†è·Ÿ SYN åŒ…ç›¸æ¯”, å®ƒè¿˜æºå¸¦äº† HTTP GET çš„æ•°æ®. é‚£ä¹ˆé€šè¿‡è¿™ä¸ªå¯¹æ¯”åº”è¯¥æƒ³åˆ°äº†, è¿™"),a("strong",[s._v("å¯èƒ½æ˜¯ MTU é…ç½®é”™è¯¯å¯¼è‡´")]),s._v("çš„. ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®, ä»”ç»†è§‚å¯Ÿä¸Šé¢ netstat çš„è¾“å‡ºç•Œé¢, ç¬¬äºŒåˆ—æ­£æ˜¯æ¯ä¸ªç½‘å¡çš„ MTU å€¼. eth0 çš„ MTU åªæœ‰ 100, è€Œä»¥å¤ªç½‘çš„ MTU é»˜è®¤å€¼æ˜¯ 1500, è¿™ä¸ª 100 å°±æ˜¾å¾—å¤ªå°äº†.")]),s._v(" "),a("p",[s._v("å½“ç„¶, MTU é—®é¢˜æ˜¯å¾ˆå¥½è§£å†³çš„, æŠŠå®ƒæ”¹æˆ 1500 å°±å¯ä»¥äº†. ç»§ç»­åœ¨å®¹å™¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŠŠå®¹å™¨ eth0 çš„ MTU æ”¹æˆ 1500:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@nginx:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig eth0 mtu 1500")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ä¿®æ”¹å®Œæˆå, å†åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, å†æ¬¡æ‰§è¡Œ curl å‘½ä»¤, ç¡®è®¤é—®é¢˜æ˜¯å¦çœŸçš„è§£å†³äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --max-time "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" http://192.168.0.30/\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Thank you "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using nginx."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/em"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("éå¸¸ä¸å®¹æ˜“å‘€, è¿™æ¬¡ç»ˆäºçœ‹åˆ°äº†ç†Ÿæ‚‰çš„ Nginx å“åº”, è¯´æ˜ä¸¢åŒ…çš„é—®é¢˜ç»ˆäºå½»åº•è§£å†³äº†.")]),s._v(" "),a("h4",{attrs:{id:"_49-æ¡ˆä¾‹ç¯‡-å†…æ ¸çº¿ç¨‹cpuåˆ©ç”¨ç‡å¤ªé«˜è¯¥æ€ä¹ˆåŠ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_49-æ¡ˆä¾‹ç¯‡-å†…æ ¸çº¿ç¨‹cpuåˆ©ç”¨ç‡å¤ªé«˜è¯¥æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 49-æ¡ˆä¾‹ç¯‡:å†…æ ¸çº¿ç¨‹CPUåˆ©ç”¨ç‡å¤ªé«˜è¯¥æ€ä¹ˆåŠ?")]),s._v(" "),a("p",[s._v("å…¶å®, åœ¨æ’æŸ¥ç½‘ç»œé—®é¢˜æ—¶, æˆ‘ä»¬è¿˜ç»å¸¸ç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜, å°±æ˜¯"),a("strong",[s._v("å†…æ ¸çº¿ç¨‹çš„ CPU ä½¿ç”¨ç‡å¾ˆé«˜")]),s._v(". æ¯”å¦‚, åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸­, å†…æ ¸çº¿ç¨‹ ksoftirqd çš„ CPU ä½¿ç”¨ç‡é€šå¸¸å°±ä¼šæ¯”è¾ƒé«˜. å›é¡¾ä¸€ä¸‹å‰é¢å­¦è¿‡çš„ CPU å’Œç½‘ç»œæ¨¡å—, ä½ åº”è¯¥çŸ¥é“, è¿™æ˜¯"),a("strong",[s._v("ç½‘ç»œæ”¶å‘çš„è½¯ä¸­æ–­å¯¼è‡´")]),s._v("çš„. è€Œè¦åˆ†æ ksoftirqd è¿™ç±» CPU ä½¿ç”¨ç‡æ¯”è¾ƒé«˜çš„å†…æ ¸çº¿ç¨‹, å¦‚æœç”¨å‰é¢ä»‹ç»è¿‡çš„é‚£äº›åˆ†ææ–¹æ³•, ä¸€èˆ¬éœ€è¦å€ŸåŠ©äºå…¶ä»–æ€§èƒ½å·¥å…·, è¿›è¡Œè¾…åŠ©åˆ†æ. æ¯”å¦‚, è¿˜æ˜¯ä»¥ ksoftirqd ä¸ºä¾‹, å¦‚æœæ€€ç–‘æ˜¯ç½‘ç»œé—®é¢˜, å°±å¯ä»¥ç”¨ sar, tcpdump ç­‰åˆ†æç½‘ç»œæµé‡, è¿›ä¸€æ­¥ç¡®è®¤ç½‘ç»œé—®é¢˜çš„æ ¹æº.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, æ˜¾ç„¶è¿™ç§æ–¹æ³•åœ¨å®é™…æ“ä½œä¸­éœ€è¦æ­¥éª¤æ¯”è¾ƒå¤š, å¯èƒ½å¹¶ä¸ç®—å¿«æ·. ä½ è‚¯å®šä¹Ÿå¾ˆæƒ³çŸ¥é“, æœ‰æ²¡æœ‰å…¶ä»–æ›´ç®€å•çš„æ–¹æ³•, å¯ä»¥"),a("strong",[s._v("ç›´æ¥è§‚å¯Ÿå†…æ ¸çº¿ç¨‹çš„è¡Œä¸º, æ›´å¿«å®šä½ç“¶é¢ˆ")]),s._v("å‘¢?")]),s._v(" "),a("p",[s._v("ä»Šå¤©å°±ç»§ç»­ä»¥ ksoftirqd ä¸ºä¾‹æ¥çœ‹çœ‹, å¦‚ä½•åˆ†æå†…æ ¸çº¿ç¨‹çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_1-å†…æ ¸çº¿ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å†…æ ¸çº¿ç¨‹"}},[s._v("#")]),s._v(" 1.å†…æ ¸çº¿ç¨‹")]),s._v(" "),a("p",[s._v("æ—¢ç„¶è¦è®²å†…æ ¸çº¿ç¨‹çš„æ€§èƒ½é—®é¢˜, åœ¨æ¡ˆä¾‹å¼€å§‹ä¹‹å‰å°±å…ˆæ¥çœ‹çœ‹, æœ‰"),a("strong",[s._v("å“ªäº›å¸¸è§çš„å†…æ ¸çº¿ç¨‹")]),s._v(".")]),s._v(" "),a("p",[s._v('åœ¨ Linux ä¸­, ç”¨æˆ·æ€è¿›ç¨‹çš„ "ç¥–å…ˆ", éƒ½æ˜¯ PID å·ä¸º 1 çš„ '),a("strong",[s._v("init è¿›ç¨‹")]),s._v(". æ¯”å¦‚ç°åœ¨ä¸»æµçš„ Linux å‘è¡Œç‰ˆä¸­, "),a("strong",[s._v("init éƒ½æ˜¯ systemd è¿›ç¨‹; è€Œå…¶ä»–çš„ç”¨æˆ·æ€è¿›ç¨‹, ä¼šé€šè¿‡ systemd æ¥è¿›è¡Œç®¡ç†")]),s._v(".")]),s._v(" "),a("p",[s._v("ç¨å¾®æƒ³ä¸€ä¸‹ Linux ä¸­çš„å„ç§è¿›ç¨‹, é™¤äº†ç”¨æˆ·æ€è¿›ç¨‹å¤–, è¿˜æœ‰å¤§é‡çš„"),a("strong",[s._v("å†…æ ¸æ€çº¿ç¨‹")]),s._v(". æŒ‰è¯´å†…æ ¸æ€çš„çº¿ç¨‹, åº”è¯¥å…ˆäºç”¨æˆ·æ€è¿›ç¨‹å¯åŠ¨, å¯æ˜¯ systemd åªç®¡ç†ç”¨æˆ·æ€è¿›ç¨‹. é‚£ä¹ˆå†…æ ¸æ€çº¿ç¨‹åˆæ˜¯è°æ¥ç®¡ç†çš„å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, Linux åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­, æœ‰ä¸‰ä¸ªç‰¹æ®Šçš„è¿›ç¨‹, ä¹Ÿå°±æ˜¯ PID å·æœ€å°çš„ä¸‰ä¸ªè¿›ç¨‹.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("0 å·è¿›ç¨‹ä¸º idle è¿›ç¨‹, è¿™ä¹Ÿæ˜¯ç³»ç»Ÿåˆ›å»ºçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹, å®ƒåœ¨åˆå§‹åŒ– 1 å·å’Œ 2 å·è¿›ç¨‹å, æ¼”å˜ä¸ºç©ºé—²ä»»åŠ¡. å½“ CPU ä¸Šæ²¡æœ‰å…¶ä»–ä»»åŠ¡æ‰§è¡Œæ—¶, å°±ä¼šè¿è¡Œå®ƒ")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("1 å·è¿›ç¨‹ä¸º init è¿›ç¨‹, é€šå¸¸æ˜¯ systemd è¿›ç¨‹, åœ¨ç”¨æˆ·æ€è¿è¡Œ, ç”¨æ¥ç®¡ç†å…¶ä»–ç”¨æˆ·æ€è¿›ç¨‹")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("2 å·è¿›ç¨‹ä¸º kthreadd è¿›ç¨‹, åœ¨å†…æ ¸æ€è¿è¡Œ, ç”¨æ¥ç®¡ç†å†…æ ¸çº¿ç¨‹")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ‰€ä»¥è¦æŸ¥æ‰¾å†…æ ¸çº¿ç¨‹, åªéœ€è¦ä» 2 å·è¿›ç¨‹å¼€å§‹, æŸ¥æ‰¾å®ƒçš„å­å­™è¿›ç¨‹å³å¯. æ¯”å¦‚å¯ä»¥ä½¿ç”¨ ps å‘½ä»¤, æ¥æŸ¥æ‰¾ kthreadd çš„å­è¿›ç¨‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--ppid")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("         PID   "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PPID")]),s._v("  C STIME TTY          TIME CMD\nroot          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":02 ?        00:00:01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kthreadd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":02 ?        00:00:21 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ksoftirqd/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":02 ?        00:11:47 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("rcu_sched"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":02 ?        00:00:18 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("migration/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11094")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20 ?        00:00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kworker/1:0-eve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11647")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":27 ?        00:00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kworker/0:2-cgr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ä»ä¸Šé¢çš„è¾“å‡ºèƒ½å¤Ÿçœ‹åˆ°, å†…æ ¸çº¿ç¨‹çš„åç§°(CMD)éƒ½åœ¨ä¸­æ‹¬å·é‡Œ(è¿™ä¸€ç‚¹å‰é¢å†…å®¹ä¹Ÿæœ‰æåˆ°è¿‡). æ‰€ä»¥, æ›´ç®€å•çš„æ–¹æ³•, å°±æ˜¯ç›´æ¥æŸ¥æ‰¾åç§°åŒ…å«ä¸­æ‹¬å·çš„è¿›ç¨‹. æ¯”å¦‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\[.*\\]"')]),s._v("\nroot         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 08:14 ?        00:00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kthreadd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 08:14 ?        00:00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("rcu_gp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 08:14 ?        00:00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("rcu_par_gp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("äº†è§£å†…æ ¸çº¿ç¨‹çš„åŸºæœ¬åŠŸèƒ½, å¯¹æ’æŸ¥é—®é¢˜æœ‰éå¸¸å¤§çš„å¸®åŠ©. "),a("strong",[s._v("æ¯”å¦‚ ksoftirqd æ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†è½¯ä¸­æ–­çš„å†…æ ¸çº¿ç¨‹, å¹¶ä¸”æ¯ä¸ª CPU ä¸Šéƒ½æœ‰ä¸€ä¸ª")]),s._v(". å¦‚æœçŸ¥é“äº†è¿™ä¸€ç‚¹, é‚£ä¹ˆä»¥åé‡åˆ° ksoftirqd çš„ CPU ä½¿ç”¨é«˜çš„æƒ…å†µ, å°±ä¼šé¦–å…ˆ"),a("strong",[s._v("æ€€ç–‘æ˜¯è½¯ä¸­æ–­çš„é—®é¢˜")]),s._v(", ç„¶åä»è½¯ä¸­æ–­çš„è§’åº¦æ¥è¿›ä¸€æ­¥åˆ†æ.")]),s._v(" "),a("p",[s._v("å…¶å®, é™¤äº†åˆšæ‰çœ‹åˆ°çš„ kthreadd å’Œ ksoftirqd å¤–, è¿˜æœ‰å¾ˆå¤šå¸¸è§çš„å†…æ ¸çº¿ç¨‹, åœ¨æ€§èƒ½åˆ†æä¸­éƒ½ç»å¸¸ä¼šç¢°åˆ°, æ¯”å¦‚ä¸‹é¢è¿™å‡ ä¸ªå†…æ ¸çº¿ç¨‹.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("kswapd0")]),s._v(": ç”¨äºå†…å­˜å›æ”¶.")]),s._v(" "),a("li",[a("strong",[s._v("kworker")]),s._v(": ç”¨äºæ‰§è¡Œå†…æ ¸å·¥ä½œé˜Ÿåˆ—, åˆ†ä¸ºç»‘å®š CPU (åç§°æ ¼å¼ä¸º kworker/CPU86330)å’Œæœªç»‘å®š CPU(åç§°æ ¼å¼ä¸º kworker/uPOOL86330)ä¸¤ç±».")]),s._v(" "),a("li",[a("strong",[s._v("migration")]),s._v(": åœ¨è´Ÿè½½å‡è¡¡è¿‡ç¨‹ä¸­, æŠŠè¿›ç¨‹è¿ç§»åˆ° CPU ä¸Š. æ¯ä¸ª CPU éƒ½æœ‰ä¸€ä¸ª migration å†…æ ¸çº¿ç¨‹.")]),s._v(" "),a("li",[a("strong",[s._v("jbd2")]),s._v("/sda1-8: jbd æ˜¯ Journaling Block Device çš„ç¼©å†™, ç”¨æ¥ä¸ºæ–‡ä»¶ç³»ç»Ÿæä¾›æ—¥å¿—åŠŸèƒ½, ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§; åç§°ä¸­çš„ sda1-8, è¡¨ç¤ºç£ç›˜åˆ†åŒºåç§°å’Œè®¾å¤‡å·. æ¯ä¸ªä½¿ç”¨äº† ext4 æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜åˆ†åŒº, éƒ½ä¼šæœ‰ä¸€ä¸ª jbd2 å†…æ ¸çº¿ç¨‹.")]),s._v(" "),a("li",[a("strong",[s._v("pdflush")]),s._v(": ç”¨äºå°†å†…å­˜ä¸­çš„è„é¡µ(è¢«ä¿®æ”¹è¿‡, ä½†è¿˜æœªå†™å…¥ç£ç›˜çš„æ–‡ä»¶é¡µ)å†™å…¥ç£ç›˜(å·²ç»åœ¨ 3.10 ä¸­åˆå¹¶å…¥äº† kworker ä¸­).")])]),s._v(" "),a("p",[s._v("äº†è§£è¿™å‡ ä¸ªå®¹æ˜“å‘ç”Ÿæ€§èƒ½é—®é¢˜çš„å†…æ ¸çº¿ç¨‹, æœ‰åŠ©äºæ›´å¿«åœ°å®šä½æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ¡ˆä¾‹å‡†å¤‡-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¡ˆä¾‹å‡†å¤‡-4"}},[s._v("#")]),s._v(" 2.æ¡ˆä¾‹å‡†å¤‡")]),s._v(" "),a("p",[s._v("ä»Šå¤©çš„æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04. æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),a("ul",[a("li",[s._v("æœºå™¨é…ç½®: 2 CPU, 8GB å†…å­˜.")]),s._v(" "),a("li",[s._v("é¢„å…ˆå®‰è£… docker, perf, hping3, curl ç­‰å·¥å…·, å¦‚ apt install docker.io linux-tools-common hping3.")])]),s._v(" "),a("p",[s._v("æœ¬æ¬¡æ¡ˆä¾‹ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœº, æˆ‘ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºå®ƒä»¬çš„å…³ç³».")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/137cb3c594041b43f83436a853906d81-20230731161933-aifrppm.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_3-æ¡ˆä¾‹åˆ†æ-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¡ˆä¾‹åˆ†æ-4"}},[s._v("#")]),s._v(" 3.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("å®‰è£…å®Œæˆå, å…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿è¡Œæ¡ˆä¾‹, ä¹Ÿå°±æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„ Nginx åº”ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œ Nginx æœåŠ¡å¹¶å¯¹å¤–å¼€æ”¾ 80 ç«¯å£")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶ååœ¨ç¬¬äºŒä¸ªç»ˆç«¯, ä½¿ç”¨ curl è®¿é—® Nginx ç›‘å¬çš„ç«¯å£, ç¡®è®¤ Nginx æ­£å¸¸å¯åŠ¨. å‡è®¾ 192.168.0.30 æ˜¯ Nginx æ‰€åœ¨è™šæ‹Ÿæœºçš„ IP åœ°å€, è¿è¡Œ curl å‘½ä»¤å, åº”è¯¥ä¼šçœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡ºç•Œé¢:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.30/\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Welcome to nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("æ¥ç€è¿˜æ˜¯åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­, è¿è¡Œ hping3 å‘½ä»¤, æ¨¡æ‹Ÿ Nginx çš„å®¢æˆ·ç«¯è¯·æ±‚:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -S å‚æ•°è¡¨ç¤ºè®¾ç½® TCP åè®®çš„ SYN(åŒæ­¥åºåˆ—å·), -p è¡¨ç¤ºç›®çš„ç«¯å£ä¸º 80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i u10 è¡¨ç¤ºæ¯éš” 10 å¾®ç§’å‘é€ä¸€ä¸ªç½‘ç»œå¸§")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ³¨: å¦‚æœä½ åœ¨å®è·µè¿‡ç¨‹ä¸­ç°è±¡ä¸æ˜æ˜¾, å¯ä»¥å°è¯•æŠŠ 10 è°ƒå°, æ¯”å¦‚è°ƒæˆ 5 ç”šè‡³ 1")]),s._v("\n$ hping3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" u10 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.30\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç°åœ¨å†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯, åº”è¯¥å°±ä¼šå‘ç°å¼‚å¸¸--ç³»ç»Ÿçš„å“åº”æ˜æ˜¾å˜æ…¢äº†. ä¸å¦¨æ‰§è¡Œ top, è§‚å¯Ÿä¸€ä¸‹ç³»ç»Ÿå’Œè¿›ç¨‹çš„ CPU ä½¿ç”¨æƒ…å†µ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" - 08:31:43 up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" min,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v("\nTasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v(" total,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("69")]),s._v(" sleeping,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" zombie\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("66.8")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32.4")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" us,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65.2")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34.5")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8167040")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7234236")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("358976")]),s._v(" used,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("573828")]),s._v(" buff/cache\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7560460")]),s._v(" avail Mem\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.48 ksoftirqd/0\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.56 ksoftirqd/1\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2489")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("876896")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38408")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21520")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":01.50 docker-containe\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3008")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44536")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3936")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3304")]),s._v(" R   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.09 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78116")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6432")]),s._v(" S   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":11.77 systemd\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("ä» top çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, ä¸¤ä¸ª CPU çš„"),a("strong",[s._v("è½¯ä¸­æ–­ä½¿ç”¨ç‡éƒ½è¶…è¿‡äº† 30%")]),s._v(" ; è€Œ CPU ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹, æ­£å¥½æ˜¯è½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹ ksoftirqd/0 å’Œ ksoftirqd/1.")]),s._v(" "),a("p",[s._v("è™½ç„¶å·²ç»çŸ¥é“äº† ksoftirqd çš„åŸºæœ¬åŠŸèƒ½, å¯ä»¥çŒœæµ‹æ˜¯å› ä¸ºå¤§é‡ç½‘ç»œæ”¶å‘, å¼•èµ·äº† CPU ä½¿ç”¨ç‡å‡é«˜; ä½†å®ƒåˆ°åº•åœ¨æ‰§è¡Œä»€ä¹ˆé€»è¾‘, æˆ‘ä»¬å´å¹¶ä¸çŸ¥é“.")]),s._v(" "),a("p",[s._v("å¯¹äºæ™®é€šè¿›ç¨‹, è¦è§‚å¯Ÿå…¶è¡Œä¸ºæœ‰å¾ˆå¤šæ–¹æ³•, æ¯”å¦‚ strace, pstack, lsof ç­‰ç­‰. ä½†è¿™äº›å·¥å…·"),a("strong",[s._v("å¹¶ä¸é€‚åˆå†…æ ¸çº¿ç¨‹")]),s._v(", æ¯”å¦‚, å¦‚æœç”¨ pstack, æˆ–è€…é€šè¿‡ "),a("code",[s._v("/proc/pid/stack")]),s._v("â€‹ æŸ¥çœ‹ ksoftirqd/0(è¿›ç¨‹å·ä¸º 9)çš„è°ƒç”¨æ ˆæ—¶, åˆ†åˆ«å¯ä»¥å¾—åˆ°ä»¥ä¸‹è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ pstack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\nCould not attach to target "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(": Operation not permitted.\ndetach: No such process\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/9/stack\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" smpboot_thread_fn+0x166/0x170\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" kthread+0x121/0x140\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ret_from_fork+0x35/0x40\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 0xffffffffffffffff\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("æ˜¾ç„¶, pstack æŠ¥å‡ºçš„æ˜¯ä¸å…è®¸æŒ‚è½½è¿›ç¨‹çš„é”™è¯¯; è€Œ "),a("code",[s._v("/proc/9/stack")]),s._v("â€‹ æ–¹å¼è™½ç„¶æœ‰è¾“å‡º, ä½†è¾“å‡ºä¸­å¹¶æ²¡æœ‰è¯¦ç»†çš„è°ƒç”¨æ ˆæƒ…å†µ.")]),s._v(" "),a("p",[s._v("é‚£"),a("strong",[s._v("è¿˜æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•, æ¥è§‚å¯Ÿå†…æ ¸çº¿ç¨‹ ksoftirqd çš„è¡Œä¸º")]),s._v("å‘¢?")]),s._v(" "),a("p",[s._v("æ—¢ç„¶æ˜¯å†…æ ¸çº¿ç¨‹, è‡ªç„¶åº”è¯¥ç”¨åˆ°å†…æ ¸ä¸­æä¾›çš„æœºåˆ¶. "),a("strong",[s._v("perf å¯ä»¥å¯¹æŒ‡å®šçš„è¿›ç¨‹æˆ–è€…äº‹ä»¶è¿›è¡Œé‡‡æ ·, å¹¶ä¸”è¿˜å¯ä»¥ç”¨è°ƒç”¨æ ˆçš„å½¢å¼, è¾“å‡ºæ•´ä¸ªè°ƒç”¨é“¾ä¸Šçš„æ±‡æ€»ä¿¡æ¯")]),s._v(". ä¸å¦¨å°±ç”¨ perf, æ¥è¯•ç€åˆ†æä¸€ä¸‹è¿›ç¨‹å·ä¸º 9 çš„ ksoftirqd.")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„ perf record å‘½ä»¤; å¹¶æŒ‡å®šè¿›ç¨‹å· 9 , ä»¥ä¾¿è®°å½• ksoftirqd çš„è¡Œä¸º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡‡æ · 30s åé€€å‡º")]),s._v("\n$ perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç¨ç­‰ä¸€ä¼šå„¿, åœ¨ä¸Šè¿°å‘½ä»¤ç»“æŸå, ç»§ç»­æ‰§è¡Œ "),a("code",[s._v("perf report")]),s._v("â€‹ å‘½ä»¤, å°±å¯ä»¥å¾—åˆ° perf çš„æ±‡æ€»æŠ¥å‘Š. æŒ‰ä¸Šä¸‹æ–¹å‘é”®ä»¥åŠå›è½¦é”®, å±•å¼€æ¯”ä¾‹æœ€é«˜çš„ ksoftirqd å, å°±å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™ä¸ªè°ƒç”¨å…³ç³»é“¾å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/b0901d6304cc0709f9e2093755b7c95d-20230731161933-24gn6vb.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»è¿™ä¸ªå›¾ä¸­å¯ä»¥æ¸…æ¥šçœ‹åˆ° ksoftirqd æ‰§è¡Œæœ€å¤šçš„è°ƒç”¨è¿‡ç¨‹. è™½ç„¶ä½ å¯èƒ½ä¸å¤ªç†Ÿæ‚‰å†…æ ¸æºç , ä½†é€šè¿‡è¿™äº›å‡½æ•°, å¯ä»¥å¤§è‡´çœ‹å‡ºå®ƒçš„è°ƒç”¨æ ˆè¿‡ç¨‹.")]),s._v(" "),a("ul",[a("li",[s._v("net_rx_action å’Œ netif_receive_skb, è¡¨æ˜è¿™æ˜¯æ¥æ”¶ç½‘ç»œåŒ…(rx è¡¨ç¤º receive).")]),s._v(" "),a("li",[s._v("br_handle_frame , è¡¨æ˜ç½‘ç»œåŒ…ç»è¿‡äº†ç½‘æ¡¥(br è¡¨ç¤º bridge).")]),s._v(" "),a("li",[s._v("br_nf_pre_routing , è¡¨æ˜åœ¨ç½‘æ¡¥ä¸Šæ‰§è¡Œäº† netfilter çš„ PREROUTING(nf è¡¨ç¤º netfilter). PREROUTING ä¸»è¦ç”¨æ¥æ‰§è¡Œ DNAT, æ‰€ä»¥å¯ä»¥çŒœæµ‹è¿™é‡Œæœ‰ DNAT å‘ç”Ÿ.")]),s._v(" "),a("li",[s._v("br_pass_frame_up, è¡¨æ˜ç½‘æ¡¥å¤„ç†å, å†äº¤ç»™æ¡¥æ¥çš„å…¶ä»–æ¡¥æ¥ç½‘å¡è¿›ä¸€æ­¥å¤„ç†. æ¯”å¦‚, åœ¨æ–°çš„ç½‘å¡ä¸Šæ¥æ”¶ç½‘ç»œåŒ…, æ‰§è¡Œ netfilter è¿‡æ»¤è§„åˆ™ç­‰ç­‰.")])]),s._v(" "),a("p",[s._v("çŒœæµ‹å¯¹ä¸å¯¹å‘¢? å®é™…ä¸Š, æ¡ˆä¾‹æœ€å¼€å§‹"),a("strong",[s._v("ç”¨ Docker å¯åŠ¨äº†å®¹å™¨, è€Œ Docker ä¼šè‡ªåŠ¨ä¸ºå®¹å™¨åˆ›å»ºè™šæ‹Ÿç½‘å¡, æ¡¥æ¥åˆ° docker0 ç½‘æ¡¥å¹¶é…ç½® NAT è§„åˆ™")]),s._v(". è¿™ä¸€è¿‡ç¨‹, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/e18dc46a8269848228bb49e2b1173561-20230731161933-0o1pta4.png",alt:""}})]),s._v(" "),a("p",[s._v("å½“ç„¶äº†, å‰é¢ perf report ç•Œé¢çš„è°ƒç”¨é“¾è¿˜å¯ä»¥ç»§ç»­å±•å¼€. ä½†å¾ˆä¸å¹¸, æˆ‘çš„å±å¹•ä¸å¤Ÿå¤§, å¦‚æœå±•å¼€æ›´å¤šçš„å±‚çº§, æœ€åå‡ ä¸ªå±‚çº§ä¼šè¶…å‡ºå±å¹•èŒƒå›´. è¿™æ ·, å³ä½¿èƒ½çœ‹åˆ°å¤§éƒ¨åˆ†çš„è°ƒç”¨è¿‡ç¨‹, å´ä¹Ÿä¸èƒ½è¯´æ˜åé¢å±‚çº§å°±æ²¡é—®é¢˜.")]),s._v(" "),a("p",[s._v("é‚£æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•, æ¥"),a("strong",[s._v("æŸ¥çœ‹æ•´ä¸ªè°ƒç”¨æ ˆçš„ä¿¡æ¯")]),s._v("å‘¢?")]),s._v(" "),a("h5",{attrs:{id:"_4-ç«ç„°å›¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç«ç„°å›¾"}},[s._v("#")]),s._v(" 4.ç«ç„°å›¾")]),s._v(" "),a("p",[a("strong",[s._v("é’ˆå¯¹ perf æ±‡æ€»æ•°æ®çš„å±•ç¤ºé—®é¢˜")]),s._v(", Brendan Gragg å‘æ˜äº†"),a("a",{attrs:{href:"http://www.brendangregg.com/flamegraphs.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç«ç„°å›¾"),a("OutboundLink")],1),s._v(", é€šè¿‡çŸ¢é‡å›¾çš„å½¢å¼, æ›´ç›´è§‚å±•ç¤ºæ±‡æ€»ç»“æœ. ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªé’ˆå¯¹ mysql çš„ç«ç„°å›¾ç¤ºä¾‹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/9b28cd55c809afc13a0a1de64eccc9ea-20230731161933-a7b3hro.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™å¼ å›¾çœ‹èµ·æ¥åƒæ˜¯è·³åŠ¨çš„ç«ç„°, å› æ­¤ä¹Ÿå°±è¢«ç§°ä¸ºç«ç„°å›¾. è¦ç†è§£ç«ç„°å›¾, æœ€é‡è¦çš„æ˜¯åŒºåˆ†æ¸…æ¥šæ¨ªè½´å’Œçºµè½´çš„å«ä¹‰.")]),s._v(" "),a("ul",[a("li",[a("mark",[a("strong",[s._v("æ¨ªè½´è¡¨ç¤ºé‡‡æ ·æ•°å’Œé‡‡æ ·æ¯”ä¾‹")])]),s._v(". ä¸€ä¸ªå‡½æ•°"),a("strong",[s._v("å ç”¨çš„æ¨ªè½´è¶Šå®½, å°±ä»£è¡¨å®ƒçš„æ‰§è¡Œæ—¶é—´è¶Šé•¿")]),s._v(". åŒä¸€å±‚çš„å¤šä¸ªå‡½æ•°, åˆ™æ˜¯æŒ‰ç…§å­—æ¯æ¥æ’åº.")]),s._v(" "),a("li",[a("mark",[a("strong",[s._v("çºµè½´è¡¨ç¤ºè°ƒç”¨æ ˆ")])]),s._v(", ç”±"),a("strong",[s._v("ä¸‹å¾€ä¸Šæ ¹æ®è°ƒç”¨å…³ç³»é€ä¸ªå±•å¼€")]),s._v(". æ¢å¥è¯è¯´, ä¸Šä¸‹ç›¸é‚»çš„ä¸¤ä¸ªå‡½æ•°ä¸­, ä¸‹é¢çš„å‡½æ•°, æ˜¯ä¸Šé¢å‡½æ•°çš„çˆ¶å‡½æ•°. è¿™æ ·, è°ƒç”¨æ ˆè¶Šæ·±, çºµè½´å°±è¶Šé«˜.")])]),s._v(" "),a("p",[s._v("å›¾ä¸­çš„é¢œè‰², å¹¶æ²¡æœ‰ç‰¹æ®Šå«ä¹‰, åªæ˜¯ç”¨æ¥åŒºåˆ†ä¸åŒçš„å‡½æ•°. ç«ç„°å›¾æ˜¯åŠ¨æ€çš„çŸ¢é‡å›¾æ ¼å¼, æ‰€ä»¥å®ƒè¿˜æ”¯æŒä¸€äº›åŠ¨æ€ç‰¹æ€§. æ¯”å¦‚, é¼ æ ‡æ‚¬åœåˆ°æŸä¸ªå‡½æ•°ä¸Šæ—¶, å°±ä¼šè‡ªåŠ¨æ˜¾ç¤ºè¿™ä¸ªå‡½æ•°çš„é‡‡æ ·æ•°å’Œé‡‡æ ·æ¯”ä¾‹. è€Œå½“ç”¨é¼ æ ‡ç‚¹å‡»å‡½æ•°æ—¶, ç«ç„°å›¾å°±ä¼šæŠŠè¯¥å±‚åŠå…¶ä¸Šçš„å„å±‚æ”¾å¤§, æ–¹ä¾¿è§‚å¯Ÿè¿™äº›å¤„äºç«ç„°å›¾é¡¶éƒ¨çš„è°ƒç”¨æ ˆçš„ç»†èŠ‚.")]),s._v(" "),a("p",[s._v("ä¸Šé¢ mysql ç«ç„°å›¾çš„ç¤ºä¾‹, å°±è¡¨ç¤ºäº† CPU çš„ç¹å¿™æƒ…å†µ, è¿™ç§ç«ç„°å›¾ä¹Ÿè¢«ç§°ä¸º on-CPU ç«ç„°å›¾. å¦‚æœæ ¹æ®æ€§èƒ½åˆ†æçš„ç›®æ ‡æ¥åˆ’åˆ†, ç«ç„°å›¾å¯ä»¥åˆ†ä¸ºä¸‹é¢è¿™å‡ ç§.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("on-CPU ç«ç„°å›¾")]),s._v(": è¡¨ç¤º CPU çš„ç¹å¿™æƒ…å†µ, ç”¨åœ¨ CPU ä½¿ç”¨ç‡æ¯”è¾ƒé«˜çš„åœºæ™¯ä¸­.")]),s._v(" "),a("li",[a("strong",[s._v("off-CPU ç«ç„°å›¾")]),s._v(": è¡¨ç¤º CPU "),a("strong",[s._v("ç­‰å¾… I/O")]),s._v(", é”ç­‰å„ç§èµ„æºçš„é˜»å¡æƒ…å†µ.")]),s._v(" "),a("li",[a("strong",[s._v("å†…å­˜ç«ç„°å›¾")]),s._v(": è¡¨ç¤ºå†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾æƒ…å†µ.")]),s._v(" "),a("li",[a("strong",[s._v("çƒ­/å†·ç«ç„°å›¾")]),s._v(": è¡¨ç¤ºå°† on-CPU å’Œ off-CPU ç»“åˆåœ¨ä¸€èµ·ç»¼åˆå±•ç¤º.")]),s._v(" "),a("li",[a("strong",[s._v("å·®åˆ†ç«ç„°å›¾")]),s._v(": è¡¨ç¤ºä¸¤ä¸ªç«ç„°å›¾çš„å·®åˆ†æƒ…å†µ, çº¢è‰²è¡¨ç¤ºå¢é•¿, è“è‰²è¡¨ç¤ºè¡°å‡. å·®åˆ†ç«ç„°å›¾å¸¸ç”¨æ¥æ¯”è¾ƒä¸åŒåœºæ™¯å’Œä¸åŒæ—¶æœŸçš„ç«ç„°å›¾, ä»¥ä¾¿åˆ†æç³»ç»Ÿå˜åŒ–å‰åå¯¹æ€§èƒ½çš„å½±å“æƒ…å†µ.")])]),s._v(" "),a("p",[s._v("äº†è§£äº†ç«ç„°å›¾çš„å«ä¹‰å’ŒæŸ¥çœ‹æ–¹æ³•å, æ¥ä¸‹æ¥å†å›åˆ°æ¡ˆä¾‹, è¿ç”¨ç«ç„°å›¾æ¥è§‚å¯Ÿåˆšæ‰ perf record å¾—åˆ°çš„è®°å½•.")]),s._v(" "),a("h5",{attrs:{id:"_5-ç«ç„°å›¾åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-ç«ç„°å›¾åˆ†æ"}},[s._v("#")]),s._v(" 5.ç«ç„°å›¾åˆ†æ")]),s._v(" "),a("p",[s._v("é¦–å…ˆéœ€è¦ç”Ÿæˆç«ç„°å›¾. å…ˆä¸‹è½½å‡ ä¸ªèƒ½ä» perf record è®°å½•ç”Ÿæˆç«ç„°å›¾çš„å·¥å…·, è¿™äº›å·¥å…·éƒ½æ”¾åœ¨ "),a("a",{attrs:{href:"https://github.com/brendangregg/FlameGraph",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/brendangregg/FlameGraph"),a("OutboundLink")],1),s._v(" ä¸Šé¢. å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ä¸‹è½½:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/brendangregg/FlameGraph\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" FlameGraph\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å®‰è£…å¥½å·¥å…·å, è¦ç”Ÿæˆç«ç„°å›¾, å…¶å®ä¸»è¦éœ€è¦ä¸‰ä¸ªæ­¥éª¤:")]),s._v(" "),a("ol",[a("li",[s._v("æ‰§è¡Œ perf script, å°† perf record çš„è®°å½•è½¬æ¢æˆå¯è¯»çš„é‡‡æ ·è®°å½•;")]),s._v(" "),a("li",[s._v("æ‰§è¡Œ stackcollapse-perf.pl è„šæœ¬, åˆå¹¶è°ƒç”¨æ ˆä¿¡æ¯;")]),s._v(" "),a("li",[s._v("æ‰§è¡Œ flamegraph.pl è„šæœ¬, ç”Ÿæˆç«ç„°å›¾.")])]),s._v(" "),a("p",[s._v("ä¸è¿‡, åœ¨ Linux ä¸­, å¯ä»¥ä½¿ç”¨ç®¡é“, æ¥ç®€åŒ–è¿™ä¸‰ä¸ªæ­¥éª¤çš„æ‰§è¡Œè¿‡ç¨‹. å‡è®¾åˆšæ‰ç”¨ perf record ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„ä¸º "),a("code",[s._v("/root/perf.data")]),s._v("â€‹, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥ç›´æ¥ç”Ÿæˆç«ç„°å›¾:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf script "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /root/perf.data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ./stackcollapse-perf.pl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  ./flamegraph.pl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ksoftirqd.svg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ‰§è¡ŒæˆåŠŸå, ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ ksoftirqd.svg, å°±å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ç«ç„°å›¾äº†. å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/21cf81bc135a0276d9f23c778f1e69d3-20230731161933-8dziifh.png",alt:""}})]),s._v(" "),a("p",[s._v("æ ¹æ®åˆšåˆšè®²è¿‡çš„ç«ç„°å›¾åŸç†, è¿™ä¸ªå›¾åº”è¯¥ä»ä¸‹å¾€ä¸Šçœ‹, "),a("strong",[s._v("æ²¿ç€è°ƒç”¨æ ˆä¸­æœ€å®½çš„å‡½æ•°æ¥åˆ†ææ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„å‡½æ•°")]),s._v(". è¿™å„¿çœ‹åˆ°çš„ç»“æœ, å…¶å®è·Ÿåˆšæ‰çš„ perf report ç±»ä¼¼, ä½†ç›´è§‚äº†å¾ˆå¤š, ä¸­é—´è¿™ä¸€å›¢ç«, å¾ˆæ˜æ˜¾å°±æ˜¯æœ€éœ€è¦å…³æ³¨çš„åœ°æ–¹.")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬é¡ºç€è°ƒç”¨æ ˆç”±ä¸‹å¾€ä¸Šçœ‹(é¡ºç€å›¾ä¸­è“è‰²ç®­å¤´), å°±å¯ä»¥å¾—åˆ°è·Ÿåˆšæ‰ perf report ä¸­ä¸€æ ·çš„ç»“æœ:")]),s._v(" "),a("ul",[a("li",[s._v("æœ€å¼€å§‹, è¿˜æ˜¯ net_rx_action åˆ° netif_receive_skb å¤„ç†ç½‘ç»œæ”¶åŒ…;")]),s._v(" "),a("li",[s._v("ç„¶å br_handle_frame åˆ° br_nf_pre_routing åœ¨ç½‘æ¡¥ä¸­æ¥æ”¶å¹¶æ‰§è¡Œ netfilter é’©å­å‡½æ•°;")]),s._v(" "),a("li",[s._v("å†å‘ä¸Š br_pass_frame_up åˆ° netif_receive_skb ä»ç½‘æ¡¥è½¬åˆ°å…¶ä»–ç½‘ç»œè®¾å¤‡åˆä¸€æ¬¡æ¥æ”¶.")])]),s._v(" "),a("p",[s._v("ä¸è¿‡æœ€å, åˆ°äº† ip_forward è¿™é‡Œ, å·²ç»çœ‹ä¸æ¸…å‡½æ•°åç§°äº†. æ‰€ä»¥éœ€è¦ç‚¹å‡» ip_forward, å±•å¼€æœ€ä¸Šé¢è¿™ä¸€å—è°ƒç”¨æ ˆ:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/cb8b6519a17749d56081748304c48db3-20230731161933-n7a7im3.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™æ ·å°±å¯ä»¥è¿›ä¸€æ­¥çœ‹åˆ° ip_forward åçš„è¡Œä¸º, ä¹Ÿå°±æ˜¯æŠŠç½‘ç»œåŒ…å‘é€å‡ºå». æ ¹æ®è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹, å†ç»“åˆå‰é¢å­¦ä¹ çš„ç½‘ç»œæ”¶å‘å’Œ TCP/IP åè®®æ ˆåŸç†, è¿™ä¸ªæµç¨‹ä¸­çš„ç½‘ç»œæ¥æ”¶, ç½‘æ¡¥ä»¥åŠ netfilter è°ƒç”¨ç­‰, éƒ½æ˜¯å¯¼è‡´è½¯ä¸­æ–­ CPU å‡é«˜çš„é‡è¦å› ç´ , ä¹Ÿå°±æ˜¯å½±å“ç½‘ç»œæ€§èƒ½çš„æ½œåœ¨ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, å›æƒ³ä¸€ä¸‹ç½‘ç»œæ”¶å‘çš„æµç¨‹, ä½ å¯èƒ½ä¼šè§‰å¾—å®ƒç¼ºäº†å¥½å¤šæ­¥éª¤.")]),s._v(" "),a("p",[s._v('æ¯”å¦‚, è¿™ä¸ªå †æ ˆä¸­å¹¶æ²¡æœ‰ TCP ç›¸å…³çš„è°ƒç”¨, ä¹Ÿæ²¡æœ‰è¿æ¥è·Ÿè¸ª conntrack ç›¸å…³çš„å‡½æ•°. å®é™…ä¸Š, è¿™äº›æµç¨‹éƒ½åœ¨å…¶ä»–æ›´å°çš„ç«ç„°ä¸­, å¯ä»¥ç‚¹å‡»ä¸Šå›¾å·¦ä¸Šè§’çš„"Reset Zoom", å›åˆ°å®Œæ•´ç«ç„°å›¾ä¸­, å†å»æŸ¥çœ‹å…¶ä»–å°ç«ç„°çš„å †æ ˆ.')]),s._v(" "),a("p",[s._v("æ‰€ä»¥, "),a("strong",[s._v("åœ¨ç†è§£è¿™ä¸ªè°ƒç”¨æ ˆæ—¶è¦æ³¨æ„. ä»ä»»ä½•ä¸€ä¸ªç‚¹å‡ºå‘, çºµå‘æ¥çœ‹çš„æ•´ä¸ªè°ƒç”¨æ ˆ, å…¶å®åªæ˜¯æœ€é¡¶ç«¯é‚£ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨å †æ ˆ, è€Œéå®Œæ•´çš„å†…æ ¸ç½‘ç»œæ‰§è¡Œæµç¨‹")]),s._v(". å¦å¤–, æ•´ä¸ªç«ç„°å›¾ä¸åŒ…å«ä»»ä½•æ—¶é—´çš„å› ç´ , æ‰€ä»¥"),a("strong",[s._v("å¹¶ä¸èƒ½çœ‹å‡ºæ¨ªå‘å„ä¸ªå‡½æ•°çš„æ‰§è¡Œæ¬¡åº")]),s._v(".")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œå°±æ‰¾å‡ºäº†"),a("strong",[s._v("å†…æ ¸çº¿ç¨‹ ksoftirqd æ‰§è¡Œæœ€é¢‘ç¹çš„å‡½æ•°è°ƒç”¨å †æ ˆ, è€Œè¿™ä¸ªå †æ ˆä¸­çš„å„å±‚çº§å‡½æ•°, å°±æ˜¯æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆæ¥æº")]),s._v(". è¿™æ ·, åé¢æƒ³è¦è¿›ä¸€æ­¥åˆ†æ, ä¼˜åŒ–æ—¶ä¹Ÿå°±æœ‰äº†æ ¹æ®.")]),s._v(" "),a("h5",{attrs:{id:"_6-å°ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-å°ç»“-2"}},[s._v("#")]),s._v(" 6.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚é€šè¿‡ perf å’Œç«ç„°å›¾æ–¹æ³•, æ‰¾å‡ºäº†è½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹çš„çƒ­ç‚¹å‡½æ•°, å…¶å®ä¹Ÿå°±æ‰¾å‡ºäº†æ½œåœ¨çš„ç“¶é¢ˆå’Œä¼˜åŒ–æ–¹å‘. å…¶å®, å¦‚æœé‡åˆ°çš„æ˜¯å†…æ ¸çº¿ç¨‹çš„èµ„æºä½¿ç”¨å¼‚å¸¸, å¾ˆå¤šå¸¸ç”¨çš„è¿›ç¨‹çº§æ€§èƒ½å·¥å…·å¹¶ä¸èƒ½å¸®ä¸Šå¿™. è¿™æ—¶å°±å¯ä»¥ç”¨å†…æ ¸è‡ªå¸¦çš„ perf æ¥è§‚å¯Ÿå®ƒä»¬çš„è¡Œä¸º, æ‰¾å‡ºçƒ­ç‚¹å‡½æ•°, è¿›ä¸€æ­¥å®šä½æ€§èƒ½ç“¶. å½“ç„¶, perf äº§ç”Ÿçš„æ±‡æ€»æŠ¥å‘Šå¹¶ä¸å¤Ÿç›´è§‚, æ‰€ä»¥ä¹Ÿæ¨èç”¨ç«ç„°å›¾æ¥ååŠ©æ’æŸ¥.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, "),a("strong",[s._v("ç«ç„°å›¾æ–¹æ³•åŒæ ·é€‚ç”¨äºæ™®é€šè¿›ç¨‹. æ¯”å¦‚, åœ¨åˆ†æ Nginx, MySQL ç­‰å„ç§åº”ç”¨åœºæ™¯çš„æ€§èƒ½é—®é¢˜æ—¶, ç«ç„°å›¾ä¹Ÿèƒ½å¸®æ›´å¿«å®šä½çƒ­ç‚¹å‡½æ•°, æ‰¾å‡ºæ½œåœ¨æ€§èƒ½é—®é¢˜")]),s._v(".")]),s._v(" "),a("h4",{attrs:{id:"_50-æ¡ˆä¾‹ç¯‡-åŠ¨æ€è¿½è¸ªæ€ä¹ˆç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_50-æ¡ˆä¾‹ç¯‡-åŠ¨æ€è¿½è¸ªæ€ä¹ˆç”¨"}},[s._v("#")]),s._v(" 50-æ¡ˆä¾‹ç¯‡:åŠ¨æ€è¿½è¸ªæ€ä¹ˆç”¨?")]),s._v(" "),a("p",[s._v("å½“ç¢°åˆ°å†…æ ¸çº¿ç¨‹çš„èµ„æºä½¿ç”¨å¼‚å¸¸æ—¶, å¾ˆå¤šå¸¸ç”¨çš„è¿›ç¨‹çº§æ€§èƒ½å·¥å…·, å¹¶ä¸èƒ½ç›´æ¥ç”¨åˆ°å†…æ ¸çº¿ç¨‹ä¸Š. è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨å†…æ ¸è‡ªå¸¦çš„ perf æ¥è§‚å¯Ÿå®ƒä»¬çš„è¡Œä¸º, æ‰¾å‡ºçƒ­ç‚¹å‡½æ•°, è¿›ä¸€æ­¥å®šä½æ€§èƒ½ç“¶é¢ˆ. ä¸è¿‡, perf äº§ç”Ÿçš„æ±‡æ€»æŠ¥å‘Šå¹¶ä¸ç›´è§‚, æ‰€ä»¥é€šå¸¸ä¹Ÿæ¨èç”¨ç«ç„°å›¾æ¥ååŠ©æ’æŸ¥.")]),s._v(" "),a("p",[s._v("å…¶å®, ä½¿ç”¨ perf å¯¹ç³»ç»Ÿå†…æ ¸çº¿ç¨‹è¿›è¡Œåˆ†ææ—¶, å†…æ ¸çº¿ç¨‹ä¾ç„¶è¿˜åœ¨æ­£å¸¸è¿è¡Œä¸­, æ‰€ä»¥è¿™ç§æ–¹æ³•ä¹Ÿè¢«ç§°ä¸º"),a("strong",[s._v("åŠ¨æ€è¿½è¸ªæŠ€æœ¯")]),s._v(".")]),s._v(" "),a("p",[s._v("**åŠ¨æ€è¿½è¸ªæŠ€æœ¯, é€šè¿‡æ¢é’ˆæœºåˆ¶, æ¥é‡‡é›†å†…æ ¸æˆ–è€…åº”ç”¨ç¨‹åºçš„è¿è¡Œä¿¡æ¯, ä»è€Œå¯ä»¥ä¸ç”¨ä¿®æ”¹å†…æ ¸å’Œåº”ç”¨ç¨‹åºçš„ä»£ç , å°±è·å¾—ä¸°å¯Œçš„ä¿¡æ¯, å¸®ä½ åˆ†æ, å®šä½æƒ³è¦æ’æŸ¥çš„é—®é¢˜. **")]),s._v(" "),a("p",[s._v("ä»¥å¾€, åœ¨æ’æŸ¥å’Œè°ƒè¯•æ€§èƒ½é—®é¢˜æ—¶, å¾€å¾€éœ€è¦å…ˆä¸ºåº”ç”¨ç¨‹åºè®¾ç½®ä¸€ç³»åˆ—çš„æ–­ç‚¹(æ¯”å¦‚ä½¿ç”¨ GDB), ç„¶åä»¥æ‰‹åŠ¨æˆ–è€…è„šæœ¬(æ¯”å¦‚ GDB çš„ Python æ‰©å±•)çš„æ–¹å¼, åœ¨è¿™äº›æ–­ç‚¹å¤„åˆ†æåº”ç”¨ç¨‹åºçš„çŠ¶æ€. æˆ–è€…, å¢åŠ ä¸€ç³»åˆ—çš„æ—¥å¿—, ä»æ—¥å¿—ä¸­å¯»æ‰¾çº¿ç´¢. ä¸è¿‡, æ–­ç‚¹å¾€å¾€ä¼šä¸­æ–­åº”ç”¨çš„æ­£å¸¸è¿è¡Œ; è€Œå¢åŠ æ–°çš„æ—¥å¿—, å¾€å¾€éœ€è¦é‡æ–°ç¼–è¯‘å’Œéƒ¨ç½². è¿™äº›æ–¹æ³•è™½ç„¶åœ¨ä»Šå¤©ä¾ç„¶å¹¿æ³›ä½¿ç”¨, ä½†åœ¨æ’æŸ¥å¤æ‚çš„æ€§èƒ½é—®é¢˜æ—¶, å¾€å¾€è€—æ—¶è€—åŠ›, æ›´ä¼šå¯¹åº”ç”¨çš„æ­£å¸¸è¿è¡Œé€ æˆå·¨å¤§å½±å“. æ­¤å¤–, è¿™ç±»æ–¹å¼è¿˜æœ‰å¤§é‡çš„æ€§èƒ½é—®é¢˜. æ¯”å¦‚, å‡ºç°çš„æ¦‚ç‡å°, åªæœ‰çº¿ä¸Šç¯å¢ƒæ‰èƒ½ç¢°åˆ°. è¿™ç§éš¾ä»¥å¤ç°çš„é—®é¢˜, äº¦æ˜¯ä¸€ä¸ªå·¨å¤§æŒ‘æˆ˜.")]),s._v(" "),a("p",[s._v("è€ŒåŠ¨æ€è¿½è¸ªæŠ€æœ¯çš„å‡ºç°, å°±ä¸ºè¿™äº›é—®é¢˜æä¾›äº†å®Œç¾çš„æ–¹æ¡ˆ: å®ƒæ—¢ä¸éœ€è¦åœæ­¢æœåŠ¡, ä¹Ÿä¸éœ€è¦ä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä»£ç ; æ‰€æœ‰ä¸€åˆ‡è¿˜æŒ‰ç…§åŸæ¥çš„æ–¹å¼æ­£å¸¸è¿è¡Œæ—¶, å°±å¯ä»¥å¸®åŠ©åˆ†æå‡ºé—®é¢˜çš„æ ¹æº. åŒæ—¶, ç›¸æ¯”ä»¥å¾€çš„è¿›ç¨‹çº§è·Ÿè¸ªæ–¹æ³•(æ¯”å¦‚ ptrace), åŠ¨æ€è¿½è¸ªå¾€å¾€åªä¼šå¸¦æ¥å¾ˆå°çš„æ€§èƒ½æŸè€—(é€šå¸¸åœ¨ 5% æˆ–è€…æ›´å°‘).")]),s._v(" "),a("p",[s._v("æ—¢ç„¶åŠ¨æ€è¿½è¸ªæœ‰è¿™ä¹ˆå¤šå¥½å¤„, "),a("strong",[s._v("é‚£ä¹ˆéƒ½æœ‰å“ªäº›åŠ¨æ€è¿½è¸ªçš„æ–¹æ³•, åˆè¯¥å¦‚ä½•ä½¿ç”¨è¿™äº›åŠ¨æ€è¿½è¸ªæ–¹æ³•å‘¢")]),s._v("?")]),s._v(" "),a("h5",{attrs:{id:"_1-åŠ¨æ€è¿½è¸ª"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŠ¨æ€è¿½è¸ª"}},[s._v("#")]),s._v(" 1.åŠ¨æ€è¿½è¸ª")]),s._v(" "),a("p",[s._v("è¯´åˆ°åŠ¨æ€è¿½è¸ª(Dynamic Tracing), å°±ä¸å¾—ä¸ææºäº Solaris ç³»ç»Ÿçš„ DTrace. DTrace æ˜¯åŠ¨æ€è¿½è¸ªæŠ€æœ¯çš„é¼»ç¥–, å®ƒæä¾›äº†ä¸€ä¸ªé€šç”¨çš„è§‚æµ‹æ¡†æ¶, å¹¶å¯ä»¥ä½¿ç”¨ D è¯­è¨€è¿›è¡Œè‡ªç”±æ‰©å±•.")]),s._v(" "),a("p",[s._v("DTrace çš„å·¥ä½œåŸç†å¦‚ä¸‹å›¾æ‰€ç¤º. "),a("strong",[s._v("å®ƒçš„è¿è¡Œå¸¸é©»åœ¨å†…æ ¸ä¸­, ç”¨æˆ·å¯ä»¥é€šè¿‡ dtrace å‘½ä»¤, æŠŠ D è¯­è¨€ç¼–å†™çš„è¿½è¸ªè„šæœ¬, æäº¤åˆ°å†…æ ¸ä¸­çš„è¿è¡Œæ—¶æ¥æ‰§è¡Œ")]),s._v(". DTrace å¯ä»¥è·Ÿè¸ªç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„æ‰€æœ‰äº‹ä»¶, å¹¶é€šè¿‡ä¸€äº›åˆ—çš„ä¼˜åŒ–æªæ–½, ä¿è¯æœ€å°çš„æ€§èƒ½å¼€é”€.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/7ac9d9c01adc2f7cfa8132fc14dc5d6f-20230731161933-7da8gc0.png",alt:""}})]),s._v(" "),a("p",[s._v("è™½ç„¶ç›´åˆ°ä»Šå¤©, DTrace æœ¬èº«ä¾ç„¶æ— æ³•åœ¨ Linux ä¸­è¿è¡Œ, ä½†å®ƒåŒæ ·å¯¹ Linux åŠ¨æ€è¿½è¸ªäº§ç”Ÿäº†å·¨å¤§çš„å½±å“. å¾ˆå¤šå·¥ç¨‹å¸ˆéƒ½å°è¯•è¿‡æŠŠ DTrace ç§»æ¤åˆ° Linux ä¸­, è¿™å…¶ä¸­æœ€è‘—åçš„å°±æ˜¯ RedHat ä¸»æ¨çš„ SystemTap.")]),s._v(" "),a("p",[s._v("åŒ DTrace ä¸€æ ·, SystemTap ä¹Ÿå®šä¹‰äº†ä¸€ç§ç±»ä¼¼çš„è„šæœ¬è¯­è¨€, æ–¹ä¾¿ç”¨æˆ·æ ¹æ®éœ€è¦è‡ªç”±æ‰©å±•. ä¸è¿‡, ä¸åŒäº DTrace, SystemTap å¹¶æ²¡æœ‰å¸¸é©»å†…æ ¸çš„è¿è¡Œæ—¶, å®ƒéœ€è¦å…ˆæŠŠè„šæœ¬ç¼–è¯‘ä¸ºå†…æ ¸æ¨¡å—, ç„¶åå†æ’å…¥åˆ°å†…æ ¸ä¸­æ‰§è¡Œ. è¿™ä¹Ÿå¯¼è‡´ SystemTap å¯åŠ¨æ¯”è¾ƒç¼“æ…¢, å¹¶ä¸”ä¾èµ–äºå®Œæ•´çš„è°ƒè¯•ç¬¦å·è¡¨.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/664373d1f400286f4d622b6689c5b4e6-20230731161933-2lglg2v.png",alt:""}})]),s._v(" "),a("p",[s._v("æ€»çš„æ¥è¯´, ä¸ºäº†è¿½è¸ªå†…æ ¸æˆ–ç”¨æˆ·ç©ºé—´çš„äº‹ä»¶, "),a("strong",[s._v("Dtrace å’Œ SystemTap éƒ½ä¼šæŠŠç”¨æˆ·ä¼ å…¥çš„è¿½è¸ªå¤„ç†å‡½æ•°(ä¸€èˆ¬ç§°ä¸º Action), å…³è”åˆ°è¢«ç§°ä¸ºæ¢é’ˆçš„æ£€æµ‹ç‚¹ä¸Š. è¿™äº›æ¢é’ˆ, å®é™…ä¸Šä¹Ÿå°±æ˜¯å„ç§åŠ¨æ€è¿½è¸ªæŠ€æœ¯æ‰€ä¾èµ–çš„äº‹ä»¶æº")]),s._v(".")]),s._v(" "),a("h6",{attrs:{id:"_1-åŠ¨æ€è¿½è¸ªçš„äº‹ä»¶æº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŠ¨æ€è¿½è¸ªçš„äº‹ä»¶æº"}},[s._v("#")]),s._v(" (1)åŠ¨æ€è¿½è¸ªçš„äº‹ä»¶æº")]),s._v(" "),a("p",[s._v("æ ¹æ®äº‹ä»¶ç±»å‹çš„ä¸åŒ, "),a("strong",[s._v("åŠ¨æ€è¿½è¸ªæ‰€ä½¿ç”¨çš„äº‹ä»¶æº, å¯ä»¥åˆ†ä¸º")]),s._v("â€‹"),a("mark",[a("strong",[s._v("é™æ€æ¢é’ˆ, åŠ¨æ€æ¢é’ˆä»¥åŠç¡¬ä»¶äº‹ä»¶")])]),s._v("â€‹"),a("strong",[s._v("ç­‰ä¸‰ç±»")]),s._v(". å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/e5a0742e24f8db3bdac0c1831a8a6d12-20230731161933-t0owm0x.png",alt:""}})]),s._v(" "),a("p",[s._v("å…¶ä¸­, "),a("strong",[s._v("ç¡¬ä»¶äº‹ä»¶é€šå¸¸ç”±æ€§èƒ½ç›‘æ§è®¡æ•°å™¨ PMC(Performance Monitoring Counter)äº§ç”Ÿ")]),s._v(", åŒ…æ‹¬äº†å„ç§ç¡¬ä»¶çš„æ€§èƒ½æƒ…å†µ, æ¯”å¦‚ CPU çš„ç¼“å­˜, æŒ‡ä»¤å‘¨æœŸ, åˆ†æ”¯é¢„æµ‹ç­‰ç­‰.")]),s._v(" "),a("p",[a("strong",[s._v("é™æ€æ¢é’ˆ, æ˜¯æŒ‡äº‹å…ˆåœ¨ä»£ç ä¸­å®šä¹‰å¥½, å¹¶ç¼–è¯‘åˆ°åº”ç”¨ç¨‹åºæˆ–è€…å†…æ ¸ä¸­çš„æ¢é’ˆ")]),s._v(". è¿™äº›æ¢é’ˆåªæœ‰åœ¨å¼€å¯æ¢æµ‹åŠŸèƒ½æ—¶, æ‰ä¼šè¢«æ‰§è¡Œåˆ°; æœªå¼€å¯æ—¶å¹¶ä¸ä¼šæ‰§è¡Œ. å¸¸è§çš„é™æ€æ¢é’ˆåŒ…æ‹¬å†…æ ¸ä¸­çš„"),a("strong",[s._v("è·Ÿè¸ªç‚¹")]),s._v("(tracepoints)å’Œ "),a("strong",[s._v("USDT")]),s._v("(Userland Statically Defined Tracing)æ¢é’ˆ.")]),s._v(" "),a("ul",[a("li",[s._v("è·Ÿè¸ªç‚¹(tracepoints), å®é™…ä¸Šå°±æ˜¯åœ¨æºç ä¸­æ’å…¥çš„ä¸€äº›å¸¦æœ‰æ§åˆ¶æ¡ä»¶çš„æ¢æµ‹ç‚¹, è¿™äº›æ¢æµ‹ç‚¹å…è®¸äº‹åå†æ·»åŠ å¤„ç†å‡½æ•°. æ¯”å¦‚åœ¨å†…æ ¸ä¸­, æœ€å¸¸è§çš„é™æ€è·Ÿè¸ªæ–¹æ³•å°±æ˜¯ printk, å³è¾“å‡ºæ—¥å¿—. Linux å†…æ ¸å®šä¹‰äº†å¤§é‡çš„è·Ÿè¸ªç‚¹, å¯ä»¥é€šè¿‡å†…æ ¸ç¼–è¯‘é€‰é¡¹, æ¥å¼€å¯æˆ–è€…å…³é—­.")]),s._v(" "),a("li",[s._v("USDT æ¢é’ˆ, å…¨ç§°æ˜¯ç”¨æˆ·çº§é™æ€å®šä¹‰è·Ÿè¸ª, éœ€è¦åœ¨æºç ä¸­æ’å…¥ DTRACE_PROBE() ä»£ç , å¹¶ç¼–è¯‘åˆ°åº”ç”¨ç¨‹åºä¸­. ä¸è¿‡, ä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨ç¨‹åºå†…ç½®äº† USDT æ¢é’ˆ, æ¯”å¦‚ MySQL, PostgreSQL ç­‰.")])]),s._v(" "),a("p",[a("strong",[s._v("åŠ¨æ€æ¢é’ˆ, åˆ™æ˜¯æŒ‡æ²¡æœ‰äº‹å…ˆåœ¨ä»£ç ä¸­å®šä¹‰, ä½†å´å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ çš„æ¢é’ˆ")]),s._v(", æ¯”å¦‚å‡½æ•°çš„"),a("strong",[s._v("è°ƒç”¨å’Œè¿”å›")]),s._v("ç­‰. åŠ¨æ€æ¢é’ˆæ”¯æŒæŒ‰éœ€åœ¨å†…æ ¸æˆ–è€…åº”ç”¨ç¨‹åºä¸­æ·»åŠ æ¢æµ‹ç‚¹, å…·æœ‰æ›´é«˜çš„çµæ´»æ€§. å¸¸è§çš„åŠ¨æ€æ¢é’ˆæœ‰ä¸¤ç§, å³ç”¨äºå†…æ ¸æ€çš„ kprobes å’Œç”¨äºç”¨æˆ·æ€çš„ uprobes.")]),s._v(" "),a("ul",[a("li",[s._v("kprobes ç”¨æ¥è·Ÿè¸ªå†…æ ¸æ€çš„å‡½æ•°, åŒ…æ‹¬ç”¨äºå‡½æ•°è°ƒç”¨çš„ kprobe å’Œç”¨äºå‡½æ•°è¿”å›çš„ kretprobe.")]),s._v(" "),a("li",[s._v("uprobes ç”¨æ¥è·Ÿè¸ªç”¨æˆ·æ€çš„å‡½æ•°, åŒ…æ‹¬ç”¨äºå‡½æ•°è°ƒç”¨çš„ uprobe å’Œç”¨äºå‡½æ•°è¿”å›çš„ uretprobe.")])]),s._v(" "),a("blockquote",[a("p",[s._v("æ³¨æ„, kprobes éœ€è¦å†…æ ¸ç¼–è¯‘æ—¶å¼€å¯ CONFIG_KPROBE_EVENTS; è€Œ uprobes åˆ™éœ€è¦å†…æ ¸ç¼–è¯‘æ—¶å¼€å¯ CONFIG_UPROBE_EVENTS.")])]),s._v(" "),a("h6",{attrs:{id:"_2-åŠ¨æ€è¿½è¸ªæœºåˆ¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-åŠ¨æ€è¿½è¸ªæœºåˆ¶"}},[s._v("#")]),s._v(" (2)åŠ¨æ€è¿½è¸ªæœºåˆ¶")]),s._v(" "),a("p",[s._v("è€Œåœ¨è¿™äº›æ¢é’ˆçš„åŸºç¡€ä¸Š, Linux ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„åŠ¨æ€è¿½è¸ªæœºåˆ¶, æ¯”å¦‚ "),a("strong",[s._v("ftrace, perf, eBPF")]),s._v(" ç­‰.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ftrace")]),s._v(" æœ€æ—©ç”¨äºå‡½æ•°è·Ÿè¸ª, åæ¥åˆæ‰©å±•æ”¯æŒäº†å„ç§äº‹ä»¶è·Ÿè¸ªåŠŸèƒ½. ftrace çš„ä½¿ç”¨æ¥å£è·Ÿä¹‹å‰æåˆ°çš„ procfs ç±»ä¼¼, å®ƒé€šè¿‡ debugfs(4.1 ä»¥åä¹Ÿæ”¯æŒ tracefs), ä»¥æ™®é€šæ–‡ä»¶çš„å½¢å¼, å‘ç”¨æˆ·ç©ºé—´æä¾›è®¿é—®æ¥å£. è¿™æ ·, ä¸éœ€è¦é¢å¤–çš„å·¥å…·, å°±å¯ä»¥é€šè¿‡æŒ‚è½½ç‚¹(é€šå¸¸ä¸º "),a("code",[s._v("/sys/kernel/debug/tracing")]),s._v("â€‹ ç›®å½•)å†…çš„æ–‡ä»¶è¯»å†™, æ¥è·Ÿ ftrace äº¤äº’, è·Ÿè¸ªå†…æ ¸æˆ–è€…åº”ç”¨ç¨‹åºçš„è¿è¡Œäº‹ä»¶.")]),s._v(" "),a("li",[a("strong",[s._v("perf")]),s._v(" å…·æœ‰äº‹ä»¶è®°å½•å’Œåˆ†æåŠŸèƒ½, è¿™å®é™…ä¸Šåªæ˜¯ä¸€ç§æœ€ç®€å•çš„é™æ€è·Ÿè¸ªæœºåˆ¶. ä¹Ÿå¯ä»¥é€šè¿‡ perf æ¥è‡ªå®šä¹‰åŠ¨æ€äº‹ä»¶(perf probe), åªå…³æ³¨çœŸæ­£æ„Ÿå…´è¶£çš„äº‹ä»¶.")]),s._v(" "),a("li",[a("strong",[s._v("eBPF")]),s._v(" åˆ™åœ¨ BPF(Berkeley Packet Filter)çš„åŸºç¡€ä¸Šæ‰©å±•è€Œæ¥, ä¸ä»…æ”¯æŒäº‹ä»¶è·Ÿè¸ªæœºåˆ¶, è¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„ BPF ä»£ç (ä½¿ç”¨ C è¯­è¨€)æ¥è‡ªç”±æ‰©å±•. æ‰€ä»¥, eBPF å®é™…ä¸Šå°±æ˜¯å¸¸é©»äºå†…æ ¸çš„è¿è¡Œæ—¶, å¯ä»¥è¯´å°±æ˜¯ Linux ç‰ˆçš„ DTrace.")]),s._v(" "),a("li",[s._v("é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰å¾ˆå¤šå†…æ ¸å¤–çš„å·¥å…·, ä¹Ÿæä¾›äº†ä¸°å¯Œçš„åŠ¨æ€è¿½è¸ªåŠŸèƒ½. æœ€å¸¸è§çš„å°±æ˜¯å‰é¢æåˆ°çš„ "),a("strong",[s._v("SystemTap")]),s._v(", ä¹‹å‰å¤šæ¬¡ä½¿ç”¨è¿‡çš„ "),a("strong",[s._v("BCC")]),s._v("(BPF Compiler Collection), ä»¥åŠå¸¸ç”¨äºå®¹å™¨æ€§èƒ½åˆ†æçš„ "),a("strong",[s._v("sysdig")]),s._v(" ç­‰.")])]),s._v(" "),a("p",[s._v("è€Œåœ¨åˆ†æå¤§é‡äº‹ä»¶æ—¶, ä½¿ç”¨ç«ç„°å›¾å¯ä»¥å°†å¤§é‡æ•°æ®å¯è§†åŒ–å±•ç¤º, è®©ä½ æ›´ç›´è§‚å‘ç°æ½œåœ¨çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±é€šè¿‡å‡ ä¸ªä¾‹å­æ¥çœ‹çœ‹, è¦æ€ä¹ˆä½¿ç”¨è¿™äº›æœºåˆ¶, æ¥åŠ¨æ€è¿½è¸ªå†…æ ¸å’Œåº”ç”¨ç¨‹åºçš„æ‰§è¡Œæƒ…å†µ.")]),s._v(" "),a("h5",{attrs:{id:"_2-ftrace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ftrace"}},[s._v("#")]),s._v(" 2.ftrace")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹ ftrace. åˆšåˆšæåˆ°è¿‡, "),a("strong",[s._v("ftrace é€šè¿‡ debugfs(æˆ–è€… tracefs), ä¸ºç”¨æˆ·ç©ºé—´æä¾›æ¥å£")]),s._v(". æ‰€ä»¥ä½¿ç”¨ ftrace, å¾€å¾€æ˜¯ä»åˆ‡æ¢åˆ° debugfs çš„æŒ‚è½½ç‚¹å¼€å§‹.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /sys/kernel/debug/tracing\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREADME                      instances            set_ftrace_notrace  trace_marker_raw\navailable_events            kprobe_events        set_ftrace_pid      trace_options\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("å¦‚æœè¿™ä¸ªç›®å½•ä¸å­˜åœ¨, åˆ™è¯´æ˜ç³»ç»Ÿè¿˜æ²¡æœ‰æŒ‚è½½ debugfs, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŒ‚è½½å®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" debugfs nodev /sys/kernel/debug\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ftrace æä¾›äº†å¤šä¸ªè·Ÿè¸ªå™¨, ç”¨äºè·Ÿè¸ªä¸åŒç±»å‹çš„ä¿¡æ¯, æ¯”å¦‚å‡½æ•°è°ƒç”¨, ä¸­æ–­å…³é—­, è¿›ç¨‹è°ƒåº¦ç­‰. å…·ä½“æ”¯æŒçš„è·Ÿè¸ªå™¨å–å†³äºç³»ç»Ÿé…ç½®, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ¥æŸ¥è¯¢æ‰€æœ‰æ”¯æŒçš„è·Ÿè¸ªå™¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" available_tracers\nhwlat blk mmiotrace function_graph wakeup_dl wakeup_rt wakeup "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" nop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("è¿™å…¶ä¸­, function è¡¨ç¤ºè·Ÿè¸ªå‡½æ•°çš„æ‰§è¡Œ, function_graph åˆ™æ˜¯è·Ÿè¸ªå‡½æ•°çš„è°ƒç”¨å…³ç³», ä¹Ÿå°±æ˜¯ç”Ÿæˆç›´è§‚çš„è°ƒç”¨å…³ç³»å›¾. è¿™ä¾¿æ˜¯æœ€å¸¸ç”¨çš„ä¸¤ç§è·Ÿè¸ªå™¨.")]),s._v(" "),a("p",[s._v("é™¤äº†è·Ÿè¸ªå™¨å¤–, ä½¿ç”¨ ftrace å‰, è¿˜éœ€è¦ç¡®è®¤è·Ÿè¸ªç›®æ ‡, åŒ…æ‹¬å†…æ ¸å‡½æ•°å’Œå†…æ ¸äº‹ä»¶. å…¶ä¸­,")]),s._v(" "),a("ul",[a("li",[s._v("å‡½æ•°å°±æ˜¯å†…æ ¸ä¸­çš„å‡½æ•°å.")]),s._v(" "),a("li",[s._v("è€Œäº‹ä»¶, åˆ™æ˜¯å†…æ ¸æºç ä¸­é¢„å…ˆå®šä¹‰çš„è·Ÿè¸ªç‚¹.")])]),s._v(" "),a("p",[s._v("åŒæ ·åœ°, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ¥æŸ¥è¯¢æ”¯æŒçš„å‡½æ•°å’Œäº‹ä»¶:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$Â catÂ available_filter_functions\n$Â catÂ available_events\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ˜ç™½äº†è¿™äº›åŸºæœ¬ä¿¡æ¯, æ¥ä¸‹æ¥å°±ä»¥ ls å‘½ä»¤ä¸ºä¾‹çœ‹çœ‹ ftrace çš„ä½¿ç”¨æ–¹æ³•.")]),s._v(" "),a("p",[s._v("ä¸ºäº†åˆ—å‡ºæ–‡ä»¶, "),a("strong",[s._v("ls å‘½ä»¤ä¼šé€šè¿‡ open ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ç›®å½•æ–‡ä»¶, è€Œ open åœ¨å†…æ ¸ä¸­å¯¹åº”çš„å‡½æ•°åä¸º do_sys_open")]),s._v(".  æ‰€ä»¥è¦åšçš„ç¬¬ä¸€æ­¥, å°±æ˜¯æŠŠè¦è·Ÿè¸ªçš„å‡½æ•°è®¾ç½®ä¸º do_sys_open:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" do_sys_open "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" set_graph_function\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥, ç¬¬äºŒæ­¥, é…ç½®è·Ÿè¸ªé€‰é¡¹, å¼€å¯å‡½æ•°è°ƒç”¨è·Ÿè¸ª, å¹¶è·Ÿè¸ªè°ƒç”¨è¿›ç¨‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$Â echoÂ function_graphÂ >Â current_tracer\n$Â echoÂ funcgraph-procÂ >Â trace_options\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ Â·Â·Â·\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å¦‚æœè¿™ä¸ªç›®å½•ä¸å­˜åœ¨, åˆ™è¯´æ˜ç³»ç»Ÿè¿˜æ²¡æœ‰æŒ‚è½½ debugfs, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŒ‚è½½å®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" debugfs nodev /sys/kernel/debug\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("ftrace æä¾›äº†å¤šä¸ªè·Ÿè¸ªå™¨, ç”¨äºè·Ÿè¸ªä¸åŒç±»å‹çš„ä¿¡æ¯, æ¯”å¦‚å‡½æ•°è°ƒç”¨, ä¸­æ–­å…³é—­, è¿›ç¨‹è°ƒåº¦ç­‰")]),s._v(". å…·ä½“æ”¯æŒçš„è·Ÿè¸ªå™¨å–å†³äºç³»ç»Ÿé…ç½®, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ¥æŸ¥è¯¢æ‰€æœ‰æ”¯æŒçš„è·Ÿè¸ªå™¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" available_tracers\nhwlat blk mmiotrace function_graph wakeup_dl wakeup_rt wakeup "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" nop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("è¿™å…¶ä¸­ function è¡¨ç¤ºè·Ÿè¸ªå‡½æ•°çš„æ‰§è¡Œ, function_graph åˆ™æ˜¯è·Ÿè¸ªå‡½æ•°çš„è°ƒç”¨å…³ç³», ä¹Ÿå°±æ˜¯ç”Ÿæˆç›´è§‚çš„è°ƒç”¨å…³ç³»å›¾. è¿™ä¾¿æ˜¯æœ€å¸¸ç”¨çš„ä¸¤ç§è·Ÿè¸ªå™¨.")]),s._v(" "),a("p",[s._v("é™¤äº†è·Ÿè¸ªå™¨å¤–, ä½¿ç”¨ ftrace å‰, è¿˜éœ€è¦ç¡®è®¤è·Ÿè¸ªç›®æ ‡, åŒ…æ‹¬å†…æ ¸å‡½æ•°å’Œå†…æ ¸äº‹ä»¶. å…¶ä¸­,")]),s._v(" "),a("ul",[a("li",[s._v("å‡½æ•°å°±æ˜¯å†…æ ¸ä¸­çš„å‡½æ•°å.")]),s._v(" "),a("li",[s._v("è€Œäº‹ä»¶, åˆ™æ˜¯å†…æ ¸æºç ä¸­é¢„å…ˆå®šä¹‰çš„è·Ÿè¸ªç‚¹.")])]),s._v(" "),a("p",[s._v("åŒæ ·åœ°, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æ¥æŸ¥è¯¢æ”¯æŒçš„å‡½æ•°å’Œäº‹ä»¶:")]),s._v(" "),a("p",[s._v("$catÂ available_filter_functions$ cat available_events")]),s._v(" "),a("p",[s._v("æ˜ç™½äº†è¿™äº›åŸºæœ¬ä¿¡æ¯, æ¥ä¸‹æ¥, æˆ‘å°±ä»¥ ls å‘½ä»¤ä¸ºä¾‹, å¸¦ä½ ä¸€èµ·çœ‹çœ‹ ftrace çš„ä½¿ç”¨æ–¹æ³•.")]),s._v(" "),a("p",[s._v("ä¸ºäº†åˆ—å‡ºæ–‡ä»¶, ls å‘½ä»¤ä¼šé€šè¿‡ open ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ç›®å½•æ–‡ä»¶, è€Œ open åœ¨å†…æ ¸ä¸­å¯¹åº”çš„å‡½æ•°åä¸º do_sys_open.  æ‰€ä»¥, æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€æ­¥, å°±æ˜¯æŠŠè¦è·Ÿè¸ªçš„å‡½æ•°è®¾ç½®ä¸º do_sys_open:")]),s._v(" "),a("p",[s._v("$ echo do_sys_open > set_graph_function")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, ç¬¬äºŒæ­¥, é…ç½®è·Ÿè¸ªé€‰é¡¹, å¼€å¯å‡½æ•°è°ƒç”¨è·Ÿè¸ª, å¹¶è·Ÿè¸ªè°ƒç”¨è¿›ç¨‹:")]),s._v(" "),a("p",[s._v("$echoÂ function_graphÂ >Â current_tracer$Â echoÂ funcgraph-procÂ >Â trace_options")]),s._v(" "),a("p",[s._v("æ¥ç€, ç¬¬ä¸‰æ­¥, ä¹Ÿå°±æ˜¯å¼€å¯è·Ÿè¸ª:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" tracing_on\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç¬¬å››æ­¥, æ‰§è¡Œä¸€ä¸ª ls å‘½ä»¤å, å†å…³é—­è·Ÿè¸ª:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" tracing_on\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç¬¬äº”æ­¥, ä¹Ÿæ˜¯æœ€åä¸€æ­¥, æŸ¥çœ‹è·Ÿè¸ªç»“æœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" trace\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tracer: function_graph")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU  TASK/PID         DURATION                  FUNCTION CALLS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |     |    |           |   |                     |   |   |   |")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("do_sys_open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("getname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("getname_flags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("kmem_cache_alloc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("_cond_resched")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.049")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            rcu_all_qs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.791")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.041")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          should_failslab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.040")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          prefetch_freepointer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.039")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          memcg_kmem_put_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.895")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("__check_object_size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.067")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          __virt_addr_valid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.044")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          __check_heap_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.039")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          check_stack_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.790")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    ls-12276    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.325")]),s._v(" us    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("åœ¨æœ€åå¾—åˆ°çš„è¾“å‡ºä¸­:")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€åˆ—è¡¨ç¤ºè¿è¡Œçš„ CPU;")]),s._v(" "),a("li",[s._v("ç¬¬äºŒåˆ—æ˜¯ä»»åŠ¡åç§°å’Œè¿›ç¨‹ PID;")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰åˆ—æ˜¯å‡½æ•°æ‰§è¡Œå»¶è¿Ÿ;")]),s._v(" "),a("li",[s._v("æœ€åä¸€åˆ—, åˆ™æ˜¯å‡½æ•°è°ƒç”¨å…³ç³»å›¾.")])]),s._v(" "),a("p",[s._v("å¯ä»¥çœ‹åˆ°, "),a("strong",[s._v("å‡½æ•°è°ƒç”¨å›¾, é€šè¿‡ä¸åŒçº§åˆ«çš„ç¼©è¿›, ç›´è§‚å±•ç¤ºäº†å„å‡½æ•°é—´çš„è°ƒç”¨å…³ç³»")]),s._v(".")]),s._v(" "),a("p",[s._v("ä½ åº”è¯¥ä¹Ÿå‘ç°äº† ftrace çš„ä½¿ç”¨ç¼ºç‚¹--äº”ä¸ªæ­¥éª¤å®åœ¨æ˜¯éº»çƒ¦, ç”¨èµ·æ¥å¹¶ä¸æ–¹ä¾¿. ä¸è¿‡ä¸ç”¨æ‹…å¿ƒ, "),a("a",{attrs:{href:"https://git.kernel.org/pub/scm/utils/trace-cmd/trace-cmd.git/",target:"_blank",rel:"noopener noreferrer"}},[s._v("trace-cmd"),a("OutboundLink")],1),s._v(" å·²ç»æŠŠè¿™äº›æ­¥éª¤ç»™åŒ…è£…äº†èµ·æ¥. è¿™æ ·å°±å¯ä»¥åœ¨åŒä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·é‡Œ, å®Œæˆä¸Šè¿°æ‰€æœ‰è¿‡ç¨‹.")]),s._v(" "),a("p",[s._v("å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£… trace-cmd:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" trace-cmd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CentOS")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" trace-cmd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("å®‰è£…å¥½å, åŸæœ¬çš„äº”æ­¥è·Ÿè¸ªè¿‡ç¨‹, å°±å¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢è¿™ä¸¤æ­¥:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ trace-cmd record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" function_graph "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" do_sys_open "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" funcgraph-proc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n$ trace-cmd report\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075341")]),s._v(": funcgraph_entry:                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("do_sys_open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075363")]),s._v(": funcgraph_entry:                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("getname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075364")]),s._v(": funcgraph_entry:                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("getname_flags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075364")]),s._v(": funcgraph_entry:                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("kmem_cache_alloc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075365")]),s._v(": funcgraph_entry:                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("_cond_resched")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075365")]),s._v(": funcgraph_entry:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.074")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            rcu_all_qs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075366")]),s._v(": funcgraph_exit:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.143")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075366")]),s._v(": funcgraph_entry:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.064")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          should_failslab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075367")]),s._v(": funcgraph_entry:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.075")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          prefetch_freepointer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075368")]),s._v(": funcgraph_entry:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.085")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          memcg_kmem_put_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075369")]),s._v(": funcgraph_exit:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.447")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075369")]),s._v(": funcgraph_entry:                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("__check_object_size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075370")]),s._v(": funcgraph_entry:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.132")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          __virt_addr_valid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075370")]),s._v(": funcgraph_entry:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.093")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          __check_heap_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075371")]),s._v(": funcgraph_entry:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.059")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          check_stack_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075372")]),s._v(": funcgraph_exit:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.323")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075372")]),s._v(": funcgraph_exit:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.411")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n              ls-12418 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85558.075373")]),s._v(": funcgraph_exit:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.195")]),s._v(" us   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("ä½ ä¼šå‘ç°, trace-cmd çš„è¾“å‡º, è·Ÿä¸Šè¿° cat trace çš„è¾“å‡ºæ˜¯ç±»ä¼¼çš„.")]),s._v(" "),a("p",[s._v("é€šè¿‡è¿™ä¸ªä¾‹å­å¯ä»¥çŸ¥é“, "),a("strong",[s._v("å½“æƒ³è¦äº†è§£æŸä¸ªå†…æ ¸å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹æ—¶, ä½¿ç”¨ ftrace å°±å¯ä»¥è·Ÿè¸ªåˆ°å®ƒçš„æ‰§è¡Œè¿‡ç¨‹")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_3-perf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-perf"}},[s._v("#")]),s._v(" 3.perf")]),s._v(" "),a("p",[s._v("perf å·²ç»æ˜¯è€æœ‹å‹äº†. åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­, å¤šæ¬¡ç”¨åˆ°å®ƒæ¥æŸ¥æ‰¾åº”ç”¨ç¨‹åºæˆ–è€…å†…æ ¸ä¸­çš„çƒ­ç‚¹å‡½æ•°, ä»è€Œå®šä½æ€§èƒ½ç“¶é¢ˆ. è€Œåœ¨å†…æ ¸çº¿ç¨‹ CPU é«˜çš„æ¡ˆä¾‹ä¸­, è¿˜ä½¿ç”¨ç«ç„°å›¾åŠ¨æ€å±•ç¤º perf çš„äº‹ä»¶è®°å½•, ä»è€Œæ›´ç›´è§‚åœ°å‘ç°äº†é—®é¢˜.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, å‰é¢ä½¿ç”¨ "),a("code",[s._v("perf record/top")]),s._v("â€‹ æ—¶, éƒ½æ˜¯å…ˆå¯¹äº‹ä»¶è¿›è¡Œé‡‡æ ·, ç„¶åå†æ ¹æ®é‡‡æ ·æ•°, è¯„ä¼°å„ä¸ªå‡½æ•°çš„è°ƒç”¨é¢‘ç‡. å®é™…ä¸Š, perf çš„åŠŸèƒ½è¿œä¸æ­¢äºæ­¤. æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("perf å¯ä»¥ç”¨æ¥åˆ†æ CPU cache, CPU è¿ç§», åˆ†æ”¯é¢„æµ‹, æŒ‡ä»¤å‘¨æœŸç­‰å„ç§ç¡¬ä»¶äº‹ä»¶;")]),s._v(" "),a("li",[s._v("perf ä¹Ÿå¯ä»¥åªå¯¹æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡ŒåŠ¨æ€è¿½è¸ª.")])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥è¿˜æ˜¯ä»¥å†…æ ¸å‡½æ•° do_sys_open, ä»¥åŠç”¨æˆ·ç©ºé—´å‡½æ•° readline ä¸ºä¾‹, çœ‹ä¸€çœ‹ perf åŠ¨æ€è¿½è¸ªçš„ä½¿ç”¨æ–¹æ³•.")]),s._v(" "),a("p",[s._v("åŒ ftrace ä¸€æ ·, ä¹Ÿå¯ä»¥é€šè¿‡ perf list, æŸ¥è¯¢æ‰€æœ‰æ”¯æŒçš„äº‹ä»¶:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç„¶ååœ¨ perf çš„å„ä¸ªå­å‘½ä»¤ä¸­æ·»åŠ  --event é€‰é¡¹, è®¾ç½®è¿½è¸ªæ„Ÿå…´è¶£çš„äº‹ä»¶. å¦‚æœè¿™äº›é¢„å®šä¹‰çš„äº‹ä»¶ä¸æ»¡è¶³å®é™…éœ€è¦, è¿˜å¯ä»¥ä½¿ç”¨ perf probe æ¥åŠ¨æ€æ·»åŠ . è€Œä¸”é™¤äº†è¿½è¸ªå†…æ ¸äº‹ä»¶å¤–, "),a("strong",[s._v("perf è¿˜å¯ä»¥ç”¨æ¥è·Ÿè¸ªç”¨æˆ·ç©ºé—´çš„å‡½æ•°")]),s._v(".")]),s._v(" "),a("p",[s._v("å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ª perf ç¤ºä¾‹, "),a("strong",[s._v("å†…æ ¸å‡½æ•° do_sys_open çš„ä¾‹å­")]),s._v(". å¯ä»¥æ‰§è¡Œ perf probe å‘½ä»¤, æ·»åŠ  do_sys_open æ¢é’ˆ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--add")]),s._v(" do_sys_open\nAdded new event:\n  probe:do_sys_open    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("on do_sys_open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nYou can now use it "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" all perf tools, such as:\n    perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" probe:do_sys_open "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("æ¢é’ˆæ·»åŠ æˆåŠŸå, å°±å¯ä»¥åœ¨æ‰€æœ‰çš„ perf å­å‘½ä»¤ä¸­ä½¿ç”¨. æ¯”å¦‚, ä¸Šè¿°è¾“å‡ºå°±æ˜¯ä¸€ä¸ª perf record çš„ç¤ºä¾‹, æ‰§è¡Œå®ƒå°±å¯ä»¥å¯¹ 10s å†…çš„ do_sys_open è¿›è¡Œé‡‡æ ·:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" probe:do_sys_open "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" perf record: Woken up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("times")]),s._v(" to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" perf record: Captured and wrote "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.148")]),s._v(" MB perf.data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" samples"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è€Œé‡‡æ ·æˆåŠŸå, å°±å¯ä»¥æ‰§è¡Œ perf script æ¥æŸ¥çœ‹é‡‡æ ·ç»“æœäº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf script\n            perf "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12886")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89565.879875")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12889")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89565.880362")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12889")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89565.880382")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12889")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89565.880635")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12889")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89565.880669")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è¾“å‡ºä¸­åŒæ ·ä¹Ÿåˆ—å‡ºäº†è°ƒç”¨ do_sys_open çš„ä»»åŠ¡åç§°, è¿›ç¨‹ PID ä»¥åŠè¿è¡Œçš„ CPU ç­‰ä¿¡æ¯. ä¸è¿‡, å¯¹äº open ç³»ç»Ÿè°ƒç”¨æ¥è¯´, åªçŸ¥é“å®ƒè¢«è°ƒç”¨äº†å¹¶ä¸å¤Ÿ, éœ€è¦çŸ¥é“çš„æ˜¯, è¿›ç¨‹åˆ°åº•åœ¨æ‰“å¼€å“ªäº›æ–‡ä»¶. æ‰€ä»¥å®é™…åº”ç”¨ä¸­, è¿˜å¸Œæœ›è¿½è¸ªæ—¶èƒ½æ˜¾ç¤ºè¿™äº›å‡½æ•°çš„å‚æ•°.")]),s._v(" "),a("p",[s._v("å¯¹äºå†…æ ¸å‡½æ•°æ¥è¯´, å½“ç„¶å¯ä»¥å»æŸ¥çœ‹å†…æ ¸æºç , æ‰¾å‡ºå®ƒçš„æ‰€æœ‰å‚æ•°. ä¸è¿‡è¿˜æœ‰æ›´ç®€å•çš„æ–¹æ³•, é‚£å°±æ˜¯ç›´æ¥ä»è°ƒè¯•ç¬¦å·è¡¨ä¸­æŸ¥è¯¢. æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥çŸ¥é“ do_sys_open çš„æ‰€æœ‰å‚æ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v(" do_sys_open\nAvailable variables at do_sys_open\n        @"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("do_sys_open+"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n                char*   filename\n                int     dfd\n                int     flags\n                struct open_flags       "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("op")]),s._v("\n                umode_t mode\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä»è¿™å„¿å¯ä»¥çœ‹å‡º, å…³å¿ƒçš„æ–‡ä»¶è·¯å¾„, å°±æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆå‚æ•°(ä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²), å‚æ•°åç§°ä¸º filename. å¦‚æœè¿™ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥, å°±è¯´æ˜è°ƒè¯•ç¬¦å·è¡¨è¿˜æ²¡æœ‰å®‰è£…. é‚£ä¹ˆå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å®‰è£…è°ƒè¯•ä¿¡æ¯åé‡è¯•:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" linux-image-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-dbgsym\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CentOS")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--enablerepo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("base-debuginfo "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" kernel-debuginfo-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æ‰¾å‡ºå‚æ•°åç§°å’Œç±»å‹å, å°±å¯ä»¥æŠŠå‚æ•°åŠ åˆ°æ¢é’ˆä¸­äº†. ä¸è¿‡ç”±äºå·²ç»æ·»åŠ è¿‡åŒåæ¢é’ˆ, æ‰€ä»¥åœ¨è¿™æ¬¡æ·»åŠ å‰, éœ€è¦å…ˆæŠŠæ—§æ¢é’ˆç»™åˆ æ‰:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…ˆåˆ é™¤æ—§çš„æ¢é’ˆ")]),s._v("\nperf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--del")]),s._v(" probe:do_sys_open\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ·»åŠ å¸¦å‚æ•°çš„æ¢é’ˆ")]),s._v("\n$ perf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'do_sys_open filename:string'")]),s._v("\nAdded new event:\n  probe:do_sys_open    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("on do_sys_open with filename:string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nYou can now use it "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" all perf tools, such as:\n    perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" probe:do_sys_open "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("æ–°çš„æ¢é’ˆæ·»åŠ å, é‡æ–°æ‰§è¡Œ record å’Œ script å­å‘½ä»¤, é‡‡æ ·å¹¶æŸ¥çœ‹è®°å½•:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡æ–°é‡‡æ ·è®°å½•")]),s._v("\n$ perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" probe:do_sys_open "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹ç»“æœ")]),s._v("\n$ perf script\n            perf "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13593")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91846.053622")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("filename_string")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/proc/13596/status"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13596")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91846.053995")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("filename_string")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/ld.so.cache"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13596")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91846.054011")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("filename_string")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/lib/x86_64-linux-gnu/libselinux.so.1"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13596")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91846.054066")]),s._v(": probe:do_sys_open: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ffffffffa807b290"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("filename_string")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v('"/lib/x86_64-linux-gnu/libc.so.6â€\n              '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½¿ç”¨å®Œæˆåä¸è¦å¿˜è®°åˆ é™¤æ¢é’ˆ")]),s._v("\n$ perf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--del")]),s._v(" probe:do_sys_open\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("ç°åœ¨å°±å¯ä»¥çœ‹åˆ°æ¯æ¬¡è°ƒç”¨ open æ—¶æ‰“å¼€çš„æ–‡ä»¶äº†. ä¸è¿‡è¿™ä¸ªç»“æœæ˜¯ä¸æ˜¯çœ‹ç€å¾ˆç†Ÿæ‚‰å‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®, åœ¨ä½¿ç”¨ strace è·Ÿè¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨æ—¶, ä¹Ÿç»å¸¸ä¼šçœ‹åˆ°è¿™äº›åŠ¨æ€åº“çš„å½±å­. æ¯”å¦‚, ä½¿ç”¨ strace è·Ÿè¸ª ls æ—¶, å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç»“æœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\naccess"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/ld.so.nohwcap"')]),s._v(", F_OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" ENOENT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("No such "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\naccess"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/ld.so.preload"')]),s._v(", R_OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" ENOENT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("No such "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nopenat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AT_FDCWD, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/ld.so.cache"')]),s._v(", O_RDONLY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("O_CLOEXEC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\naccess"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/ld.so.nohwcap"')]),s._v(", F_OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" ENOENT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("No such "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nopenat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AT_FDCWD, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/lib/x86_64-linux-gnu/libselinux.so.1"')]),s._v(", O_RDONLY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("O_CLOEXEC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ä½ ä¼°è®¡åœ¨æƒ³, æ—¢ç„¶ strace ä¹Ÿèƒ½å¾—åˆ°ç±»ä¼¼ç»“æœ, æœ¬èº«åˆå®¹æ˜“æ“ä½œ, ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ perf å‘¢?")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, å¾ˆå¤šäººåªçœ‹åˆ°äº† strace ç®€å•æ˜“ç”¨çš„å¥½å¤„, å´å¿½ç•¥äº†å®ƒå¯¹è¿›ç¨‹æ€§èƒ½å¸¦æ¥çš„å½±å“. ä»åŸç†ä¸Šæ¥è¯´, "),a("strong",[s._v("strace åŸºäºç³»ç»Ÿè°ƒç”¨ ptrace å®ç°")]),s._v(", è¿™å°±å¸¦æ¥äº†ä¸¤ä¸ªé—®é¢˜.")]),s._v(" "),a("ul",[a("li",[s._v("ç”±äº ptrace æ˜¯ç³»ç»Ÿè°ƒç”¨, å°±éœ€è¦åœ¨å†…æ ¸æ€å’Œç”¨æˆ·æ€åˆ‡æ¢. å½“äº‹ä»¶æ•°é‡æ¯”è¾ƒå¤šæ—¶, ç¹å¿™çš„åˆ‡æ¢å¿…ç„¶ä¼š"),a("strong",[s._v("å½±å“åŸæœ‰æœåŠ¡çš„æ€§èƒ½")]),s._v(";")]),s._v(" "),a("li",[s._v("ptrace éœ€è¦å€ŸåŠ© SIGSTOP ä¿¡å·æŒ‚èµ·ç›®æ ‡è¿›ç¨‹. è¿™ç§ä¿¡å·æ§åˆ¶å’Œè¿›ç¨‹æŒ‚èµ·, ä¼šå½±å“ç›®æ ‡è¿›ç¨‹çš„è¡Œä¸º.")])]),s._v(" "),a("p",[s._v("æ‰€ä»¥, "),a("strong",[s._v("åœ¨æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨(æ¯”å¦‚æ•°æ®åº“)ä¸­, å¹¶ä¸æ¨èç”¨ strace (æˆ–è€…å…¶ä»–åŸºäº ptrace çš„æ€§èƒ½å·¥å…·)å»æ’æŸ¥å’Œè°ƒè¯•")]),s._v(". åœ¨ strace çš„å¯å‘ä¸‹, ç»“åˆå†…æ ¸ä¸­çš„ utrace æœºåˆ¶,  perf ä¹Ÿæä¾›äº†ä¸€ä¸ª trace å­å‘½ä»¤, æ˜¯å–ä»£ strace çš„é¦–é€‰å·¥å…·. ç›¸å¯¹äº ptrace æœºåˆ¶æ¥è¯´, perf trace åŸºäºå†…æ ¸äº‹ä»¶, è‡ªç„¶è¦æ¯”è¿›ç¨‹è·Ÿè¸ªçš„æ€§èƒ½å¥½å¾ˆå¤š.")]),s._v(" "),a("p",[s._v("perf trace çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤º, è·Ÿ strace å…¶å®å¾ˆåƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ perf trace "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n         ? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": ls/14234  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("continued"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": execve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.177")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.013")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": ls/14234 brk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("                                                                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0x555d96be7000\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.224")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": ls/14234 access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("filename: 0xad98082                                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" ENOENT No such "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.248")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.009")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": ls/14234 access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("filename: 0xad9add0, mode: R                                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v(" ENOENT No such "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.267")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.012")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": ls/14234 openat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dfd: CWD, filename: 0xad98428, flags: CLOEXEC                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.288")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.009")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": ls/14234 fstat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fd: "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("/usr/lib/locale/C.UTF-8/"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(", statbuf: 0x7ffd2015f230 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.305")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.011")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": ls/14234 mmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("len: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45560")]),s._v(", prot: READ, flags: PRIVATE, fd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0x7efe0af92000\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.324")]),s._v(" Dockerfile  test.sh\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.008")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": ls/14234 close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fd: "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("/usr/lib/locale/C.UTF-8/"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("ä¸è¿‡ perf trace è¿˜å¯ä»¥è¿›è¡Œç³»ç»Ÿçº§çš„ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ª(å³è·Ÿè¸ªæ‰€æœ‰è¿›ç¨‹), è€Œ strace åªèƒ½è·Ÿè¸ªç‰¹å®šçš„è¿›ç¨‹.")]),s._v(" "),a("p",[a("strong",[s._v("ç¬¬äºŒä¸ª perf çš„ä¾‹å­æ˜¯ç”¨æˆ·ç©ºé—´çš„åº“å‡½æ•°")]),s._v(". ä»¥ bash è°ƒç”¨çš„åº“å‡½æ•° readline ä¸ºä¾‹, ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•, å¯ä»¥è·Ÿè¸ªåº“å‡½æ•°çš„è°ƒç”¨(åŸºäº uprobes).")]),s._v(" "),a("p",[s._v("readline çš„ä½œç”¨, æ˜¯ä»ç»ˆç«¯ä¸­è¯»å–ç”¨æˆ·è¾“å…¥, å¹¶æŠŠè¿™äº›æ•°æ®è¿”å›è°ƒç”¨æ–¹. æ‰€ä»¥è·Ÿ open ç³»ç»Ÿè°ƒç”¨ä¸åŒçš„æ˜¯, æˆ‘ä»¬æ›´å…³æ³¨ readline çš„è°ƒç”¨ç»“æœ.")]),s._v(" "),a("p",[s._v("æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, é€šè¿‡ -x æŒ‡å®š bash äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„, å°±å¯ä»¥åŠ¨æ€è·Ÿè¸ªåº“å‡½æ•°. è¿™å…¶å®å°±æ˜¯è·Ÿè¸ªäº†æ‰€æœ‰ç”¨æˆ·åœ¨ bash ä¸­æ‰§è¡Œçš„å‘½ä»¤:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸º /bin/bash æ·»åŠ  readline æ¢é’ˆ")]),s._v("\n$ perf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" /bin/bash 'readline%return +0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$retval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":stringâ€™\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡‡æ ·è®°å½•")]),s._v("\n$ perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" probe_bash:readline__return "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹ç»“æœ")]),s._v("\n$ perf script\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13348")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93939.142576")]),s._v(": probe_bash:readline__return: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("5626ffac1610 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("- 5626ffa46739"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ls"')]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è·Ÿè¸ªå®Œæˆååˆ é™¤æ¢é’ˆ")]),s._v("\n$ perf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--del")]),s._v(" probe_bash:readline__return\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("å½“ç„¶, å¦‚æœä¸ç¡®å®šæ¢é’ˆæ ¼å¼, ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤, æŸ¥è¯¢æ‰€æœ‰æ”¯æŒçš„å‡½æ•°å’Œå‡½æ•°å‚æ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥è¯¢æ‰€æœ‰çš„å‡½æ•°")]),s._v("\n$ perf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" /bin/bash â€”funcs\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥è¯¢å‡½æ•°çš„å‚æ•°")]),s._v("\n$ perf probe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v(" readline\nAvailable variables at readline\n        @"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readline+"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n                char*   prompt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("è·Ÿå†…æ ¸å‡½æ•°ç±»ä¼¼, å¦‚æœæƒ³è¦æŸ¥çœ‹æ™®é€šåº”ç”¨çš„å‡½æ•°åç§°å’Œå‚æ•°, é‚£ä¹ˆåœ¨åº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­, åŒæ ·éœ€è¦åŒ…å«è°ƒè¯•ä¿¡æ¯.")]),s._v(" "),a("h5",{attrs:{id:"_4-ebpfå’Œbcc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ebpfå’Œbcc"}},[s._v("#")]),s._v(" 4.eBPFå’ŒBCC")]),s._v(" "),a("p",[s._v("ftrace å’Œ perf çš„åŠŸèƒ½å·²ç»æ¯”è¾ƒä¸°å¯Œäº†, ä¸è¿‡å®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„ç¼ºé™·, é‚£å°±æ˜¯ä¸å¤Ÿçµæ´», æ²¡æ³•åƒ DTrace é‚£æ ·é€šè¿‡è„šæœ¬è‡ªç”±æ‰©å±•.")]),s._v(" "),a("p",[s._v("è€Œ eBPF å°±æ˜¯ Linux ç‰ˆçš„ DTrace, å¯ä»¥é€šè¿‡ C è¯­è¨€è‡ªç”±æ‰©å±•(è¿™äº›æ‰©å±•é€šè¿‡ LLVM è½¬æ¢ä¸º BPF å­—èŠ‚ç å, åŠ è½½åˆ°å†…æ ¸ä¸­æ‰§è¡Œ). ä¸‹é¢è¿™å¼ å›¾, å°±è¡¨ç¤ºäº† eBPF è¿½è¸ªçš„å·¥ä½œåŸç†:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/a7b84179f2883c9d71828c171eb8969a-20230731161933-l2kl9rc.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°, eBPF çš„æ‰§è¡Œéœ€è¦ä¸‰æ­¥:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä»ç”¨æˆ·è·Ÿè¸ªç¨‹åºç”Ÿæˆ BPF å­—èŠ‚ç ")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("åŠ è½½åˆ°å†…æ ¸ä¸­è¿è¡Œ")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("å‘ç”¨æˆ·ç©ºé—´è¾“å‡ºç»“æœ")]),s._v(".")])]),s._v(" "),a("p",[s._v("æ‰€ä»¥, ä»ä½¿ç”¨ä¸Šæ¥è¯´, eBPF è¦æ¯” ftrace å’Œ perf éƒ½æ›´åŠ ç¹æ‚. å®é™…ä¸Š, åœ¨ eBPF æ‰§è¡Œè¿‡ç¨‹ä¸­, ç¼–è¯‘, åŠ è½½è¿˜æœ‰ maps ç­‰æ“ä½œ, å¯¹æ‰€æœ‰çš„è·Ÿè¸ªç¨‹åºæ¥è¯´éƒ½æ˜¯é€šç”¨çš„. æŠŠè¿™äº›è¿‡ç¨‹é€šè¿‡ Python æŠ½è±¡èµ·æ¥, ä¹Ÿå°±è¯ç”Ÿäº† "),a("strong",[s._v("BCC")]),s._v("(BPF Compiler Collection). BCC æŠŠ eBPF ä¸­çš„å„ç§äº‹ä»¶æº(æ¯”å¦‚ kprobe, uprobe, tracepoint ç­‰)å’Œæ•°æ®æ“ä½œ(ç§°ä¸º Maps), ä¹Ÿéƒ½è½¬æ¢æˆäº† Python æ¥å£(ä¹Ÿæ”¯æŒ lua). è¿™æ ·ä½¿ç”¨ BCC è¿›è¡ŒåŠ¨æ€è¿½è¸ªæ—¶, ç¼–å†™ç®€å•çš„è„šæœ¬å°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡è¦æ³¨æ„, å› ä¸ºéœ€è¦è·Ÿå†…æ ¸ä¸­çš„æ•°æ®ç»“æ„äº¤äº’, çœŸæ­£æ ¸å¿ƒçš„äº‹ä»¶å¤„ç†é€»è¾‘, è¿˜æ˜¯éœ€è¦ç”¨ C è¯­è¨€æ¥ç¼–å†™.")]),s._v(" "),a("p",[s._v("BCC çš„å®‰è£…æ–¹æ³•å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# REHL 7.6")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" bcc-tools\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å®‰è£…å, BCC ä¼šæŠŠæ‰€æœ‰ç¤ºä¾‹(åŒ…æ‹¬ Python å’Œ lua), æ”¾åˆ° "),a("code",[s._v("/usr/share/bcc/examples")]),s._v("â€‹ ç›®å½•ä¸­:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /usr/share/bcc/examples\nhello_world.py  lua  networking  tracing\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥è¿˜æ˜¯ä»¥ do_sys_open ä¸ºä¾‹æ¥çœ‹çœ‹, å¦‚ä½•ç”¨ eBPF å’Œ BCC å®ç°åŒæ ·çš„åŠ¨æ€è·Ÿè¸ª.")]),s._v(" "),a("p",[s._v("é€šå¸¸, å¯ä»¥æŠŠ BCC åº”ç”¨, æ‹†åˆ†ä¸ºä¸‹é¢è¿™å››ä¸ªæ­¥éª¤.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€, è·Ÿæ‰€æœ‰çš„ Python æ¨¡å—ä½¿ç”¨æ–¹æ³•ä¸€æ ·, åœ¨ä½¿ç”¨ä¹‹å‰, å…ˆå¯¼å…¥è¦ç”¨åˆ°çš„æ¨¡å—:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("from bcc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" BPF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç¬¬äºŒ, éœ€è¦"),a("strong",[s._v("å®šä¹‰äº‹ä»¶ä»¥åŠå¤„ç†äº‹ä»¶çš„å‡½æ•°")]),s._v(". è¿™ä¸ªå‡½æ•°éœ€è¦ç”¨ C è¯­è¨€æ¥ç¼–å†™, ä½œç”¨æ˜¯åˆå§‹åŒ–åˆšæ‰å¯¼å…¥çš„ BPF å¯¹è±¡. è¿™äº›ç”¨ C è¯­è¨€ç¼–å†™çš„å¤„ç†å‡½æ•°, è¦ä»¥å­—ç¬¦ä¸²çš„å½¢å¼é€åˆ° BPF æ¨¡å—ä¸­å¤„ç†:")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# define BPF program (""" is used for multi-line string).')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# '#' indicates comments for python, while '//' indicates comments for C.")]),s._v("\nprog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n#include <uapi/linux/ptrace.h>\n#include <uapi/linux/limits.h>\n#include <linux/sched.h>\n// define output data structure in C\nstruct data_t {\n    u32 pid;\n    u64 ts;\n    char comm[TASK_COMM_LEN];\n    char fname[NAME_MAX];\n};\nBPF_PERF_OUTPUT(events);\n \n// define the handler for do_sys_open.\n// ctx is required, while other params depends on traced function.\nint hello(struct pt_regs *ctx, int dfd, const char __user *filename, int flags){\n    struct data_t data = {};\n    data.pid = bpf_get_current_pid_tgid();\n    data.ts = bpf_ktime_get_ns();\n    if (bpf_get_current_comm(&data.comm, sizeof(data.comm)) == 0) {\n        bpf_probe_read(&data.fname, sizeof(data.fname), (void *)filename);\n    }\n    events.perf_submit(ctx, &data, sizeof(data));\n    return 0;\n}\n"""')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# load BPF program")]),s._v("\nb "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BPF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("text"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# attach the kprobe for do_sys_open, and set handler to hello")]),s._v("\nb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attach_kprobe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"do_sys_open"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fn_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("ç¬¬ä¸‰æ­¥, æ˜¯å®šä¹‰ä¸€ä¸ªè¾“å‡ºå‡½æ•°, å¹¶æŠŠè¾“å‡ºå‡½æ•°è·Ÿ BPF äº‹ä»¶ç»‘å®š:")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# process event")]),s._v("\nstart "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("print_event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" start\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# eventâ€™s type is data_t")]),s._v("\n    event "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"events"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" start "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            start "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ts\n    time_s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("float")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%-18.9f %-16s %-6d %-16s"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("comm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# loop with callback to print_event")]),s._v("\nb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"events"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("open_perf_buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("print_event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("æœ€åä¸€æ­¥, å°±æ˜¯"),a("strong",[s._v("æ‰§è¡Œäº‹ä»¶å¾ªç¯")]),s._v(", å¼€å§‹è¿½è¸ª do_sys_open çš„è°ƒç”¨:")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# print header")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%-18s %-16s %-6s %-16s"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TIME(s)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"COMM"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PID"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "FILEâ€'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start the event polling loop")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("perf_buffer_poll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" KeyboardInterrupt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("æŠŠä¸Šé¢å‡ ä¸ªæ­¥éª¤çš„ä»£ç , ä¿å­˜åˆ°æ–‡ä»¶ trace-open.py ä¸­, ç„¶åå°±å¯ä»¥ç”¨ Python æ¥è¿è¡Œäº†. å¦‚æœä¸€åˆ‡æ­£å¸¸, å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ python trace-open.py\nTIME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("            COMM             PID    FILE\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000000000")]),s._v("        irqbalance       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073")]),s._v("   /proc/interrupts\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000175401")]),s._v("        irqbalance       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073")]),s._v("   /proc/stat\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000258802")]),s._v("        irqbalance       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073")]),s._v("   /proc/irq/9/smp_affinity\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000290102")]),s._v("        irqbalance       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073")]),s._v("   /proc/irq/0/smp_affinity\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ä»è¾“å‡ºä¸­, å¯ä»¥çœ‹åˆ° irqbalance è¿›ç¨‹(ä½ çš„ç¯å¢ƒä¸­å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è¿›ç¨‹)æ­£åœ¨æ‰“å¼€å¾ˆå¤šæ–‡ä»¶, è€Œ irqbalance ä¾èµ–è¿™äº›æ–‡ä»¶ä¸­è¯»å–çš„å†…å®¹, æ¥æ‰§è¡Œä¸­æ–­è´Ÿè½½å‡è¡¡.")]),s._v(" "),a("p",[s._v("é€šè¿‡è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¹Ÿå¯ä»¥å‘ç°, eBPF å’Œ BCC çš„ä½¿ç”¨, å…¶å®æ¯” ftrace å’Œ perf æœ‰æ›´é«˜çš„é—¨æ§›. æƒ³ç”¨ BCC å¼€å‘è‡ªå·±çš„åŠ¨æ€è·Ÿè¸ªç¨‹åº, è‡³å°‘è¦ç†Ÿæ‚‰ C è¯­è¨€, Python è¯­è¨€, è¢«è·Ÿè¸ªäº‹ä»¶æˆ–å‡½æ•°çš„ç‰¹å¾(æ¯”å¦‚å†…æ ¸å‡½æ•°çš„å‚æ•°å’Œè¿”å›æ ¼å¼)ä»¥åŠ eBPF æä¾›çš„å„ç§æ•°æ®æ“ä½œæ–¹æ³•.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, å› ä¸ºå¼ºå¤§çš„çµæ´»æ€§, è™½ç„¶ eBPF åœ¨ä½¿ç”¨ä¸Šæœ‰ä¸€å®šçš„é—¨æ§›, å´ä¹Ÿæ— æ³•é˜»æ­¢å®ƒæˆä¸ºç›®å‰æœ€çƒ­é—¨, æœ€å—å…³æ³¨çš„åŠ¨æ€è¿½è¸ªæŠ€æœ¯.")]),s._v(" "),a("p",[s._v("å½“ç„¶, BCC è½¯ä»¶åŒ…ä¹Ÿå†…ç½®äº†å¾ˆå¤šå·²ç»å¼€å‘å¥½çš„å®ç”¨å·¥å…·, é»˜è®¤å®‰è£…åˆ° "),a("code",[s._v("/usr/share/bcc/tools/")]),s._v("â€‹ ç›®å½•ä¸­, å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/fbb794b3ef2a72806c89a5637ac88114-20230731161933-q72p34k.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™äº›å·¥å…·, ä¸€èˆ¬éƒ½å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨. è€Œåœ¨ç¼–å†™å…¶ä»–çš„åŠ¨æ€è¿½è¸ªè„šæœ¬æ—¶, å®ƒä»¬ä¹Ÿæ˜¯æœ€å¥½çš„å‚è€ƒèµ„æ–™. ä¸è¿‡, æœ‰ä¸€ç‚¹éœ€è¦ä½ ç‰¹åˆ«æ³¨æ„, å¾ˆå¤š eBPF çš„æ–°ç‰¹æ€§, éƒ½éœ€è¦æ¯”è¾ƒæ–°çš„å†…æ ¸ç‰ˆæœ¬(å¦‚ä¸‹å›¾æ‰€ç¤º). å¦‚æœæŸäº›å·¥å…·æ— æ³•è¿è¡Œ, å¾ˆå¯èƒ½å°±æ˜¯å› ä¸ºä½¿ç”¨äº†å½“å‰å†…æ ¸ä¸æ”¯æŒçš„ç‰¹æ€§.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ec2d0dd0f33df9623e04de90d1abbedb-20230731161933-mf0yx2z.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_5-sysdig"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-sysdig"}},[s._v("#")]),s._v(" 5.sysdig")]),s._v(" "),a("p",[a("strong",[s._v("sysdig")]),s._v(" åˆ™æ˜¯éšç€å®¹å™¨æŠ€æœ¯çš„æ™®åŠè€Œè¯ç”Ÿçš„, ä¸»è¦ç”¨äº"),a("strong",[s._v("å®¹å™¨çš„åŠ¨æ€è¿½è¸ª")]),s._v(". sysdig æ±‡é›†äº†ä¸€äº›åˆ—æ€§èƒ½å·¥å…·çš„ä¼˜åŠ¿, å¯ä»¥è¯´æ˜¯é›†ç™¾å®¶ä¹‹æ‰€é•¿. æˆ‘ä¹ æƒ¯ç”¨è¿™ä¸ªå…¬å¼æ¥è¡¨ç¤º sysdig çš„ç‰¹ç‚¹: "),a("strong",[s._v("sysdig = strace + tcpdump + htop + iftop + lsof + docker inspect")]),s._v(".")]),s._v(" "),a("p",[s._v("è€Œåœ¨æœ€æ–°çš„ç‰ˆæœ¬ä¸­(å†…æ ¸ç‰ˆæœ¬ >= 4.14), sysdig è¿˜å¯ä»¥é€šè¿‡ eBPF æ¥è¿›è¡Œæ‰©å±•, æ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨æ¥è¿½è¸ªå†…æ ¸ä¸­çš„å„ç§å‡½æ•°å’Œäº‹ä»¶.")]),s._v(" "),a("h5",{attrs:{id:"_6-å¦‚ä½•é€‰æ‹©è¿½è¸ªå·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-å¦‚ä½•é€‰æ‹©è¿½è¸ªå·¥å…·"}},[s._v("#")]),s._v(" 6.å¦‚ä½•é€‰æ‹©è¿½è¸ªå·¥å…·")]),s._v(" "),a("p",[s._v("è¿™ä¹ˆå¤šåŠ¨æ€è¿½è¸ªå·¥å…·, åœ¨å®é™…åœºæ™¯ä¸­åˆ°åº•è¯¥æ€ä¹ˆé€‰æ‹©å‘¢? è¿˜æ˜¯é‚£å¥è¯, "),a("strong",[s._v("å…·ä½“æ€§èƒ½å·¥å…·çš„é€‰æ‹©, å°±è¦ä»å…·ä½“çš„å·¥ä½œåŸç†æ¥å…¥æ‰‹")]),s._v(". æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨ä¸éœ€è¦å¾ˆé«˜çµæ´»æ€§çš„åœºæ™¯ä¸­, ä½¿ç”¨ perf å¯¹æ€§èƒ½äº‹ä»¶è¿›è¡Œé‡‡æ ·, ç„¶åå†é…åˆç«ç„°å›¾è¾…åŠ©åˆ†æ, å°±æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ–¹æ³•;")]),s._v(" "),a("li",[s._v("è€Œéœ€è¦å¯¹äº‹ä»¶æˆ–å‡½æ•°è°ƒç”¨è¿›è¡Œç»Ÿè®¡åˆ†æ(æ¯”å¦‚è§‚å¯Ÿä¸åŒå¤§å°çš„ I/O åˆ†å¸ƒ)æ—¶, å°±è¦ç”¨ SystemTap æˆ–è€… eBPF, é€šè¿‡ä¸€äº›è‡ªå®šä¹‰çš„è„šæœ¬æ¥è¿›è¡Œæ•°æ®å¤„ç†.")])]),s._v(" "),a("p",[s._v("åœ¨è¿™é‡Œä¹Ÿæ€»ç»“äº†å‡ ä¸ªå¸¸è§çš„åŠ¨æ€è¿½è¸ªä½¿ç”¨åœºæ™¯, å¹¶ä¸”åˆ†åˆ«æ¨èäº†é€‚åˆçš„å·¥å…·.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/77c55c47c016179708a71a4af8ca298a-20230731161933-bmxbp4z.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_7-å°ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-å°ç»“-2"}},[s._v("#")]),s._v(" 7.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å­¦ä¹ äº† perf, eBPF å’Œ BCC ç­‰åŠ¨æ€è¿½è¸ªæ–¹æ³•, å¹¶æ€»ç»“äº†ä¸åŒåœºæ™¯ä¸­å¦‚ä½•é€‰æ‹©åŠ¨æ€è¿½è¸ªæ–¹æ³•.")]),s._v(" "),a("p",[s._v("åœ¨ Linux ç³»ç»Ÿä¸­, å¸¸è§çš„"),a("strong",[s._v("åŠ¨æ€è¿½è¸ªæ–¹æ³•, åŒ…æ‹¬ ftrace, perf, eBPF ç­‰")]),s._v(". åœ¨å¤§å¤šæ•°æ€§èƒ½é—®é¢˜ä¸­, ä½¿ç”¨ perf é…åˆç«ç„°å›¾æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•. å¦‚æœè¿™æ»¡è¶³ä¸äº†ä½ çš„è¦æ±‚, é‚£ä¹ˆ:")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨æ–°ç‰ˆçš„å†…æ ¸ä¸­, eBPF å’Œ "),a("strong",[s._v("BCC")]),s._v(" æ˜¯æœ€çµæ´»çš„åŠ¨æ€è¿½è¸ªæ–¹æ³•;")])]),s._v(" "),a("p",[s._v("æ­¤å¤–, åœ¨ä½¿ç”¨åŠ¨æ€è¿½è¸ªæŠ€æœ¯æ—¶, ä¸ºäº†å¾—åˆ°åˆ†æç›®æ ‡çš„è¯¦ç»†ä¿¡æ¯, ä¸€èˆ¬éœ€è¦å†…æ ¸ä»¥åŠåº”ç”¨ç¨‹åºçš„è°ƒè¯•ç¬¦å·è¡¨. åŠ¨æ€è¿½è¸ªå®é™…ä¸Šä¹Ÿæ˜¯åœ¨è¿™äº›ç¬¦å·(åŒ…æ‹¬å‡½æ•°å’Œäº‹ä»¶)ä¸Šè¿›è¡Œçš„, æ‰€ä»¥æ˜“è¯»æ˜“ç†è§£çš„ç¬¦å·, æœ‰åŠ©äºåŠ å¿«åŠ¨æ€è¿½è¸ªçš„è¿‡ç¨‹.")]),s._v(" "),a("h4",{attrs:{id:"_52-æ¡ˆä¾‹ç¯‡-æœåŠ¡ååé‡ä¸‹é™å¾ˆå‰å®³è¯¥æ€ä¹ˆåˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_52-æ¡ˆä¾‹ç¯‡-æœåŠ¡ååé‡ä¸‹é™å¾ˆå‰å®³è¯¥æ€ä¹ˆåˆ†æ"}},[s._v("#")]),s._v(" 52-æ¡ˆä¾‹ç¯‡:æœåŠ¡ååé‡ä¸‹é™å¾ˆå‰å®³è¯¥æ€ä¹ˆåˆ†æ?")]),s._v(" "),a("p",[s._v("é™¤äº†å»¶è¿Ÿé—®é¢˜å¤–, ç½‘ç»œè¯·æ±‚çš„ååé‡ä¸‹é™, æ˜¯å¦ä¸€ä¸ªå¸¸è§çš„æ€§èƒ½é—®é¢˜. é‚£ä¹ˆé’ˆå¯¹è¿™ç§"),a("strong",[s._v("ååé‡ä¸‹é™é—®é¢˜, åˆè¯¥å¦‚ä½•è¿›è¡Œåˆ†æ")]),s._v("å‘¢? æ¥ä¸‹æ¥å°±ä»¥æœ€å¸¸ç”¨çš„åå‘ä»£ç†æœåŠ¡å™¨ Nginx ä¸ºä¾‹æ¥çœ‹çœ‹, å¦‚ä½•åˆ†ææœåŠ¡ååé‡ä¸‹é™çš„é—®é¢˜.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ¡ˆä¾‹åˆ†æ-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¡ˆä¾‹åˆ†æ-2"}},[s._v("#")]),s._v(" 1.æ¡ˆä¾‹åˆ†æ")]),s._v(" "),a("p",[s._v("ä»Šå¤©è¦åˆ†æçš„æ¡ˆä¾‹æ˜¯ä¸€ä¸ª Nginx + PHP åº”ç”¨, å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/f91f1713c3b5addad03feb18c92a95e4-20230731161933-u6z6mjy.png",alt:""}})]),s._v(" "),a("p",[s._v("å…¶ä¸­, wrk å’Œ curl æ˜¯ Nginx çš„å®¢æˆ·ç«¯, è€Œ PHP åº”ç”¨åˆ™æ˜¯ä¸€ä¸ªç®€å•çš„ Hello World:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("?php\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World!"')]),s._v("\n?"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä¸ºäº†æ–¹ä¾¿è¿è¡Œ, æˆ‘å·²ç»æŠŠæ¡ˆä¾‹åº”ç”¨æ‰“åŒ…æˆäº†ä¸¤ä¸ª Docker é•œåƒ, å¹¶æ¨é€åˆ° Docker Hub ä¸­. å¯ä»¥ç›´æ¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥è¿è¡Œå®ƒ.")]),s._v(" "),a("p",[s._v("åŒæ—¶, ä¸ºäº†åˆ†ææ–¹ä¾¿, è¿™ä¸¤ä¸ªå®¹å™¨éƒ½å°†"),a("strong",[s._v("è¿è¡Œåœ¨ host network æ¨¡å¼")]),s._v("ä¸­. è¿™æ ·å°±ä¸ç”¨åˆ‡æ¢åˆ°å®¹å™¨çš„ç½‘ç»œå‘½åç©ºé—´, è€Œå¯ä»¥ç›´æ¥è§‚å¯Ÿå®ƒä»¬çš„å¥—æ¥å­—çŠ¶æ€.")]),s._v(" "),a("p",[s._v("å…ˆåœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å¯åŠ¨ Nginx åº”ç”¨, å¹¶ç›‘å¬åœ¨ 80 ç«¯å£. å¦‚æœä¸€åˆ‡æ­£å¸¸, åº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡º:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx-tp\n6477c607c13b37943234755a14987ffb3a31c33a7f04f75bb1c190e710bce19e\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" phpfpm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/php-fpm-tp\n09e0255159f0c8a647e22cd68bd097bec7efc48b21e5d91618ff29b882fa7c1f\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ç„¶å, æ‰§è¡Œ docker ps å‘½ä»¤, æŸ¥è¯¢å®¹å™¨çš„çŠ¶æ€, ä¼šå‘ç°, å®¹å™¨å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€(Up)äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n09e0255159f0        feisky/php-fpm-tp   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"php-fpm -F --pid /oâ€¦"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" seconds                           phpfpm\n6477c607c13b        feisky/nginx-tp     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/init.sh"')]),s._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" seconds                           nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä¸è¿‡, ä» docker ps çš„è¾“å‡º, åªèƒ½çŸ¥é“å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€. è‡³äº Nginx èƒ½ä¸èƒ½æ­£å¸¸å¤„ç†å¤–éƒ¨çš„è¯·æ±‚, è¿˜éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤.")]),s._v(" "),a("p",[s._v('æ¥ç€, åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, æ‰§è¡Œä¸‹é¢çš„ curl å‘½ä»¤, è¿›ä¸€æ­¥éªŒè¯ Nginx èƒ½å¦æ­£å¸¸è®¿é—®. å¦‚æœçœ‹åˆ° "Hello World!" çš„è¾“å‡º, è¯´æ˜ Nginx+PHP çš„åº”ç”¨å·²ç»æ­£å¸¸å¯åŠ¨äº†:')]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.30\nHello World"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥å°±æ¥æµ‹è¯•ä¸€ä¸‹, æ¡ˆä¾‹ä¸­ Nginx çš„ååé‡.")]),s._v(" "),a("p",[s._v("ç»§ç»­åœ¨ç»ˆç«¯äºŒä¸­, æ‰§è¡Œ wrk å‘½ä»¤, æ¥æµ‹è¯• Nginx çš„æ€§èƒ½:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é»˜è®¤æµ‹è¯•æ—¶é—´ä¸º 10s, è¯·æ±‚è¶…æ—¶ 2s")]),s._v("\n$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" http://192.168.0.30\nRunning 10s "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" @ http://192.168.0.30\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" threads and "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(".82ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(".47ms "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("874")]),s._v(".96ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.43")]),s._v("%\n    Req/Sec   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("550.55")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".36k    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".70k    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93.10")]),s._v("%\n  Latency Distribution\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(".03ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(".90ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(".65ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("215")]),s._v(".03ms\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1910")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".10s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("573")]),s._v(".56KB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\n  Non-2xx or 3xx responses: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1910")]),s._v("\nRequests/sec:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("189.10")]),s._v("\nTransfer/sec:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(".78KB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("ä» wrk çš„ç»“æœä¸­, å¯ä»¥çœ‹åˆ°ååé‡(ä¹Ÿå°±æ˜¯æ¯ç§’è¯·æ±‚æ•°)åªæœ‰ 189, å¹¶ä¸”æ‰€æœ‰ 1910 ä¸ªè¯·æ±‚æ”¶åˆ°çš„éƒ½æ˜¯å¼‚å¸¸å“åº”(é 2xx æˆ– 3xx). è¿™äº›æ•°æ®æ˜¾ç„¶è¡¨æ˜, ååé‡å¤ªä½äº†, å¹¶ä¸”è¯·æ±‚å¤„ç†éƒ½å¤±è´¥äº†. è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢?")]),s._v(" "),a("p",[s._v("æ ¹æ® wrk è¾“å‡ºçš„ç»Ÿè®¡ç»“æœå¯ä»¥çœ‹åˆ°, æ€»å…±ä¼ è¾“çš„æ•°æ®é‡åªæœ‰ 573 KB, é‚£å°±è‚¯å®šä¸ä¼šæ˜¯å¸¦å®½å—é™å¯¼è‡´çš„. æ‰€ä»¥, åº”è¯¥ä»è¯·æ±‚æ•°çš„è§’åº¦æ¥åˆ†æ.")]),s._v(" "),a("p",[s._v("åˆ†æè¯·æ±‚æ•°, ç‰¹åˆ«æ˜¯ HTTP çš„è¯·æ±‚æ•°, æœ‰ä»€ä¹ˆå¥½æ€è·¯å—? å½“ç„¶å°±è¦"),a("strong",[s._v("ä» TCP è¿æ¥æ•°")]),s._v("å…¥æ‰‹.")]),s._v(" "),a("h6",{attrs:{id:"_1-è¿æ¥æ•°ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-è¿æ¥æ•°ä¼˜åŒ–"}},[s._v("#")]),s._v(" (1)è¿æ¥æ•°ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("è¦"),a("strong",[s._v("æŸ¥çœ‹ TCP è¿æ¥æ•°çš„æ±‡æ€»æƒ…å†µ, é¦–é€‰å·¥å…·è‡ªç„¶æ˜¯ ss å‘½ä»¤")]),s._v(". ä¸ºäº†è§‚å¯Ÿ wrk æµ‹è¯•æ—¶å‘ç”Ÿçš„é—®é¢˜, åœ¨ç»ˆç«¯äºŒä¸­å†æ¬¡å¯åŠ¨ wrk, å¹¶ä¸”æŠŠæ€»çš„æµ‹è¯•æ—¶é—´å»¶é•¿åˆ° 30 åˆ†é’Ÿ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æµ‹è¯•æ—¶é—´ 30 åˆ†é’Ÿ")]),s._v("\n$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1800")]),s._v(" http://192.168.0.30\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶å, å›åˆ°ç»ˆç«¯ä¸€ä¸­, è§‚å¯Ÿ TCP è¿æ¥æ•°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\nTotal: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("177")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kernel "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1565")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTCP:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1193")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("estab "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", closed "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1178")]),s._v(", orphaned "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", synrecv "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", timewait "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1178")]),s._v("/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", ports "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n \nTransport Total     IP        IPv6\n*\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1565")]),s._v("      -         -\nRAW\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nUDP\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nINET\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nFRAG\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("ä»è¿™é‡Œçœ‹å‡º, wrk å¹¶å‘ 1000 è¯·æ±‚æ—¶, "),a("strong",[s._v("å»ºç«‹è¿æ¥æ•°åªæœ‰ 5, è€Œ closed å’Œ timewait çŠ¶æ€çš„è¿æ¥åˆ™æœ‰ 1100 å¤š")]),s._v(". å…¶å®ä»è¿™å„¿å°±å¯ä»¥å‘ç°ä¸¤ä¸ªé—®é¢˜:")]),s._v(" "),a("ul",[a("li",[s._v("ä¸€ä¸ªæ˜¯å»ºç«‹è¿æ¥æ•°å¤ªå°‘äº†;")]),s._v(" "),a("li",[s._v("å¦ä¸€ä¸ªæ˜¯ "),a("strong",[s._v("timewait çŠ¶æ€")]),s._v("è¿æ¥å¤ªå¤šäº†.")])]),s._v(" "),a("p",[s._v("åˆ†æé—®é¢˜, è‡ªç„¶è¦å…ˆä»ç›¸å¯¹ç®€å•çš„ä¸‹æ‰‹. å…ˆæ¥çœ‹ç¬¬äºŒä¸ªå…³äº timewait çš„é—®é¢˜. åœ¨ä¹‹å‰çš„ NAT æ¡ˆä¾‹ä¸­, å·²ç»æåˆ°è¿‡, å†…æ ¸ä¸­çš„è¿æ¥è·Ÿè¸ªæ¨¡å—, æœ‰å¯èƒ½ä¼šå¯¼è‡´ timewait é—®é¢˜. ä»Šå¤©çš„æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Docker è¿è¡Œ, è€Œ Docker ä½¿ç”¨çš„ iptables, å°±ä¼šä½¿ç”¨è¿æ¥è·Ÿè¸ªæ¨¡å—æ¥ç®¡ç† NAT. é‚£ä¹ˆ, æ€ä¹ˆç¡®è®¤æ˜¯ä¸æ˜¯è¿æ¥è·Ÿè¸ªå¯¼è‡´çš„é—®é¢˜å‘¢?")]),s._v(" "),a("p",[s._v("å…¶å®æœ€ç®€å•çš„æ–¹æ³•, å°±æ˜¯"),a("strong",[s._v("é€šè¿‡ dmesg æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—")]),s._v(", å¦‚æœæœ‰è¿æ¥è·Ÿè¸ªå‡ºäº†é—®é¢˜, åº”è¯¥ä¼šçœ‹åˆ° nf_conntrack ç›¸å…³çš„æ—¥å¿—.")]),s._v(" "),a("p",[s._v("å¯ä»¥ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88356.354329")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" nf_conntrack: nf_conntrack: table full, dropping packet\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88356.354374")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" nf_conntrack: nf_conntrack: table full, dropping packet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä»æ—¥å¿—ä¸­, å¯ä»¥çœ‹åˆ° "),a("code",[s._v("nf_conntrack: table full, dropping packet")]),s._v("â€‹ çš„é”™è¯¯æ—¥å¿—. è¿™è¯´æ˜æ­£æ˜¯"),a("strong",[s._v("è¿æ¥è·Ÿè¸ª")]),s._v("å¯¼è‡´çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("è¿™ç§æƒ…å†µä¸‹, åº”è¯¥æƒ³èµ·å‰é¢å­¦è¿‡çš„ä¸¤ä¸ªå†…æ ¸é€‰é¡¹--è¿æ¥è·Ÿè¸ªæ•°çš„æœ€å¤§é™åˆ¶ nf_conntrack_max, ä»¥åŠå½“å‰çš„è¿æ¥è·Ÿè¸ªæ•° nf_conntrack_count. æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥æŸ¥è¯¢è¿™ä¸¤ä¸ªé€‰é¡¹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.netfilter.nf_conntrack_max\nnet.netfilter.nf_conntrack_max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.netfilter.nf_conntrack_count\nnet.netfilter.nf_conntrack_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è¿™æ¬¡çš„è¾“å‡ºä¸­, å¯ä»¥çœ‹åˆ°æœ€å¤§çš„è¿æ¥è·Ÿè¸ªé™åˆ¶åªæœ‰ 200, å¹¶ä¸”å…¨éƒ¨è¢«å ç”¨äº†. 200 çš„é™åˆ¶æ˜¾ç„¶å¤ªå°, ä¸è¿‡ç›¸åº”çš„ä¼˜åŒ–ä¹Ÿå¾ˆç®€å•, è°ƒå¤§å°±å¯ä»¥äº†.")]),s._v(" "),a("p",[s._v("æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°† nf_conntrack_max å¢å¤§:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å°†è¿æ¥è·Ÿè¸ªé™åˆ¶å¢å¤§åˆ° 1048576")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.netfilter.nf_conntrack_max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("è¿æ¥è·Ÿè¸ªé™åˆ¶å¢å¤§å, å¯¹ Nginx ååé‡çš„ä¼˜åŒ–æ•ˆæœå¦‚ä½•å‘¢? ä¸å¦¨å†æ¥æµ‹è¯•ä¸€ä¸‹. å¯ä»¥åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­ç„¶åæ‰§è¡Œä¸‹é¢çš„ wrk å‘½ä»¤, é‡æ–°æµ‹è¯• Nginx çš„æ€§èƒ½:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é»˜è®¤æµ‹è¯•æ—¶é—´ä¸º 10s, è¯·æ±‚è¶…æ—¶ 2s")]),s._v("\n$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" http://192.168.0.30\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54221")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".07s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(".16MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\n  Socket errors: connect "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v("\n  Non-2xx or 3xx responses: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45577")]),s._v("\nRequests/sec:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5382.21")]),s._v("\nTransfer/sec:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".50MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä» wrk çš„è¾“å‡ºä¸­, å¯ä»¥çœ‹åˆ°, è¿æ¥è·Ÿè¸ªçš„ä¼˜åŒ–æ•ˆæœéå¸¸å¥½, ååé‡å·²ç»ä»åˆšæ‰çš„ 189 å¢å¤§åˆ°äº† 5382. çœ‹èµ·æ¥æ€§èƒ½æå‡äº†å°†è¿‘ 30 å€,")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™æ˜¯ä¸æ˜¯å°±èƒ½è¯´æ˜å·²ç»æŠŠ Nginx çš„æ€§èƒ½ä¼˜åŒ–å¥½äº†å‘¢?")]),s._v(" "),a("p",[s._v("åˆ«æ€¥, å†æ¥çœ‹çœ‹ wrk æ±‡æŠ¥çš„å…¶ä»–æ•°æ®. æœç„¶, 10s å†…çš„æ€»è¯·æ±‚æ•°è™½ç„¶å¢å¤§åˆ°äº† 5 ä¸‡, ä½†æ˜¯"),a("strong",[s._v("æœ‰ 4 ä¸‡å¤šå“åº”å¼‚å¸¸")]),s._v(", è¯´ç™½äº†, çœŸæ­£æˆåŠŸçš„åªæœ‰ 8000 å¤šä¸ª(54221-45577=8644).")]),s._v(" "),a("p",[s._v("å¾ˆæ˜æ˜¾, å¤§éƒ¨åˆ†è¯·æ±‚çš„å“åº”éƒ½æ˜¯å¼‚å¸¸çš„. é‚£ä¹ˆè¯¥æ€ä¹ˆåˆ†æå“åº”å¼‚å¸¸çš„é—®é¢˜å‘¢?")]),s._v(" "),a("h6",{attrs:{id:"_2-å·¥ä½œè¿›ç¨‹ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å·¥ä½œè¿›ç¨‹ä¼˜åŒ–"}},[s._v("#")]),s._v(" (2)å·¥ä½œè¿›ç¨‹ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("ç”±äºè¿™äº›å“åº”å¹¶é Socket error, è¯´æ˜ Nginx å·²ç»æ”¶åˆ°äº†è¯·æ±‚, åªä¸è¿‡, å“åº”çš„çŠ¶æ€ç å¹¶ä¸æ˜¯æœŸæœ›çš„ 2xx (è¡¨ç¤ºæˆåŠŸ)æˆ– 3xx(è¡¨ç¤ºé‡å®šå‘). æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹, ææ¸…æ¥š Nginx çœŸæ­£çš„å“åº”å°±å¾ˆé‡è¦äº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡è¿™ä¹Ÿä¸éš¾, åˆ‡æ¢å›ç»ˆç«¯ä¸€, æ‰§è¡Œä¸‹é¢çš„ docker å‘½ä»¤, æŸ¥è¯¢ Nginx å®¹å™¨æ—¥å¿—å°±çŸ¥é“äº†:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("/Mar/2019:2243:27 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("499")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("/Mar/2019:22:43:27 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("499")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("/Mar/2019:22:43:27 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("499")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä» Nginx çš„æ—¥å¿—ä¸­, å¯ä»¥çœ‹åˆ°å“åº”çŠ¶æ€ç ä¸º 499.")]),s._v(" "),a("p",[a("mark",[a("strong",[s._v("499 å¹¶éæ ‡å‡†çš„ HTTP çŠ¶æ€ç , è€Œæ˜¯ç”± Nginx æ‰©å±•è€Œæ¥, è¡¨ç¤ºæœåŠ¡å™¨ç«¯è¿˜æ²¡æ¥å¾—åŠå“åº”æ—¶, å®¢æˆ·ç«¯å°±å·²ç»å…³é—­è¿æ¥äº†. æ¢å¥è¯è¯´, é—®é¢˜åœ¨äºæœåŠ¡å™¨ç«¯å¤„ç†å¤ªæ…¢, å®¢æˆ·ç«¯å› ä¸ºè¶…æ—¶(wrk è¶…æ—¶æ—¶é—´ä¸º 2s), ä¸»åŠ¨æ–­å¼€äº†è¿æ¥.")])])]),s._v(" "),a("p",[s._v("æ—¢ç„¶é—®é¢˜å‡ºåœ¨äº†æœåŠ¡å™¨ç«¯å¤„ç†æ…¢, è€Œæ¡ˆä¾‹æœ¬èº«æ˜¯ Nginx+PHP çš„åº”ç”¨, é‚£æ˜¯ä¸æ˜¯å¯ä»¥çŒœæµ‹, æ˜¯å› ä¸º PHP å¤„ç†è¿‡æ…¢å‘¢?  å¯ä»¥åœ¨ç»ˆç«¯ä¸­, æ‰§è¡Œä¸‹é¢çš„ docker å‘½ä»¤, æŸ¥è¯¢ PHP å®¹å™¨æ—¥å¿—:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs phpfpm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("-Mar-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":28:56"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" WARNING: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pool www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" server reached max_children setting "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", consider raising it\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("-Mar-2019 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":43:17"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" WARNING: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pool www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" server reached max_children setting "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", consider raising it\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä»è¿™ä¸ªæ—¥å¿—ä¸­, å¯ä»¥çœ‹åˆ°ä¸¤æ¡è­¦å‘Šä¿¡æ¯, server reached max_children setting (5), å¹¶å»ºè®®å¢å¤§ max_children.")]),s._v(" "),a("p",[s._v("max_children è¡¨ç¤º php-fpm å­è¿›ç¨‹çš„æœ€å¤§æ•°é‡, å½“ç„¶æ˜¯æ•°å€¼è¶Šå¤§, å¯ä»¥åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°å°±è¶Šå¤š. ä¸è¿‡ç”±äºè¿™æ˜¯è¿›ç¨‹é—®é¢˜, æ•°é‡å¢å¤§, ä¹Ÿä¼šå¯¼è‡´æ›´å¤šçš„å†…å­˜å’Œ CPU å ç”¨. æ‰€ä»¥è¿˜ä¸èƒ½è®¾ç½®å¾—è¿‡å¤§.")]),s._v(" "),a("p",[s._v("ä¸€èˆ¬æ¥è¯´, æ¯ä¸ª php-fpm å­è¿›ç¨‹å¯èƒ½ä¼šå ç”¨ 20 MB å·¦å³çš„å†…å­˜. æ‰€ä»¥å¯ä»¥æ ¹æ®å†…å­˜å’Œ CPU ä¸ªæ•°, ä¼°ç®—ä¸€ä¸ªåˆç†çš„å€¼. è¿™å„¿æŠŠå®ƒè®¾ç½®æˆäº† 20, å¹¶å°†ä¼˜åŒ–åçš„é…ç½®é‡æ–°æ‰“åŒ…æˆäº† Docker é•œåƒ. å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ‰§è¡Œå®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœæ­¢æ—§çš„å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx phpfpm\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½¿ç”¨æ–°é•œåƒå¯åŠ¨ Nginx å’Œ PHP")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx-tp:1\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" phpfpm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/php-fpm-tp:1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ç„¶ååˆ‡æ¢åˆ°ç»ˆç«¯äºŒ, å†æ¬¡æ‰§è¡Œä¸‹é¢çš„ wrk å‘½ä»¤, é‡æ–°æµ‹è¯• Nginx çš„æ€§èƒ½:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é»˜è®¤æµ‹è¯•æ—¶é—´ä¸º 10s, è¯·æ±‚è¶…æ—¶ 2s")]),s._v("\n$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" http://192.168.0.30\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47210")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".08s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".51MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\n  Socket errors: connect "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91")]),s._v("\n  Non-2xx or 3xx responses: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31692")]),s._v("\nRequests/sec:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4683.82")]),s._v("\nTransfer/sec:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".24MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("ä» wrk çš„è¾“å‡ºä¸­, å¯ä»¥çœ‹åˆ°, è™½ç„¶ååé‡åªæœ‰ 4683, æ¯”åˆšæ‰çš„ 5382 å°‘äº†ä¸€äº›; ä½†æ˜¯æµ‹è¯•æœŸé—´æˆåŠŸçš„è¯·æ±‚æ•°å´å¤šäº†ä¸å°‘, ä»åŸæ¥çš„ 8000, å¢é•¿åˆ°äº† 15000(47210-31692=15518).")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è™½ç„¶æ€§èƒ½æœ‰æ‰€æå‡, å¯ 4000 å¤šçš„ååé‡æ˜¾ç„¶è¿˜æ˜¯æ¯”è¾ƒå·®çš„, å¹¶ä¸”å¤§éƒ¨åˆ†è¯·æ±‚çš„å“åº”ä¾ç„¶è¿˜æ˜¯å¼‚å¸¸. æ¥ä¸‹æ¥, è¯¥æ€ä¹ˆå»è¿›ä¸€æ­¥æå‡ Nginx çš„ååé‡å‘¢?")]),s._v(" "),a("h6",{attrs:{id:"_3-å¥—æ¥å­—ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å¥—æ¥å­—ä¼˜åŒ–"}},[s._v("#")]),s._v(" (3)å¥—æ¥å­—ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("å›æƒ³ä¸€ä¸‹ç½‘ç»œæ€§èƒ½çš„åˆ†æå¥—è·¯, ä»¥åŠ Linux åè®®æ ˆçš„åŸç†, å¯ä»¥ä»"),a("strong",[s._v("å¥—æ¥å­—, TCP åè®®ç­‰é€å±‚åˆ†æ")]),s._v(". è€Œåˆ†æçš„ç¬¬ä¸€æ­¥, è‡ªç„¶è¿˜æ˜¯è¦è§‚å¯Ÿæœ‰æ²¡æœ‰å‘ç”Ÿä¸¢åŒ…ç°è±¡.")]),s._v(" "),a("p",[s._v("åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, é‡æ–°è¿è¡Œæµ‹è¯•, è¿™æ¬¡è¿˜æ˜¯è¦ç”¨ -d å‚æ•°å»¶é•¿æµ‹è¯•æ—¶é—´, ä»¥ä¾¿æ¨¡æ‹Ÿæ€§èƒ½ç“¶é¢ˆçš„ç°åœº:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æµ‹è¯•æ—¶é—´ 30 åˆ†é’Ÿ")]),s._v("\n$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1800")]),s._v(" http://192.168.0.30\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ç„¶åå›åˆ°ç»ˆç«¯ä¸€ä¸­, è§‚å¯Ÿæœ‰æ²¡æœ‰å‘ç”Ÿå¥—æ¥å­—çš„ä¸¢åŒ…ç°è±¡:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åªå…³æ³¨å¥—æ¥å­—ç»Ÿè®¡")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" socket\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(" resets received "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" embryonic SYN_RECV sockets\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("308582")]),s._v(" TCP sockets finished "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" fast timer\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" delayed acks further delayed because of locked socket\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("290566")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("times")]),s._v(" the listen queue of a socket overflowed\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("290566")]),s._v(" SYNs to LISTEN sockets dropped\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç¨ç­‰ä¸€ä¼š, å†æ¬¡è¿è¡Œ")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" socket\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(" resets received "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" embryonic SYN_RECV sockets\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("314722")]),s._v(" TCP sockets finished "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" fast timer\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" delayed acks further delayed because of locked socket\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("344440")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("times")]),s._v(" the listen queue of a socket overflowed\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("344440")]),s._v(" SYNs to LISTEN sockets dropped\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("æ ¹æ®ä¸¤æ¬¡ç»Ÿè®¡ç»“æœä¸­ socket overflowed å’Œ sockets dropped çš„å˜åŒ–, å¯ä»¥çœ‹åˆ°, "),a("strong",[s._v("æœ‰å¤§é‡çš„å¥—æ¥å­—ä¸¢åŒ…, å¹¶ä¸”ä¸¢åŒ…éƒ½æ˜¯å¥—æ¥å­—é˜Ÿåˆ—æº¢å‡ºå¯¼è‡´çš„")]),s._v(". æ‰€ä»¥, æ¥ä¸‹æ¥åº”è¯¥åˆ†æè¿æ¥é˜Ÿåˆ—çš„å¤§å°æ˜¯ä¸æ˜¯æœ‰å¼‚å¸¸.")]),s._v(" "),a("p",[s._v("å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥çœ‹å¥—æ¥å­—çš„é˜Ÿåˆ—å¤§å°:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ltnp")]),s._v("\nState     Recv-Q     Send-Q            Local Address:Port            Peer Address:Port\nLISTEN    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*         users:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10491")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10490")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10487")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nLISTEN    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                            *:9000                       *:*         users:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"php'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('fpm"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11084")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"php'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('fpm"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10529")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("è¿™æ¬¡å¯ä»¥çœ‹åˆ°, Nginx å’Œ php-fpm çš„ç›‘å¬é˜Ÿåˆ— (Send-Q)åªæœ‰ 10, è€Œ nginx çš„å½“å‰ç›‘å¬é˜Ÿåˆ—é•¿åº¦ (Recv-Q)å·²ç»è¾¾åˆ°äº†æœ€å¤§å€¼, php-fpm ä¹Ÿå·²ç»æ¥è¿‘äº†æœ€å¤§å€¼. å¾ˆæ˜æ˜¾, å¥—æ¥å­—ç›‘å¬é˜Ÿåˆ—çš„é•¿åº¦å¤ªå°äº†, éœ€è¦å¢å¤§.")]),s._v(" "),a("p",[s._v("å…³äºå¥—æ¥å­—ç›‘å¬é˜Ÿåˆ—é•¿åº¦çš„è®¾ç½®, æ—¢å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­, é€šè¿‡å¥—æ¥å­—æ¥å£è°ƒæ•´, ä¹Ÿæ”¯æŒé€šè¿‡å†…æ ¸é€‰é¡¹æ¥é…ç½®. ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, åˆ†åˆ«æŸ¥è¯¢ Nginx å’Œå†…æ ¸é€‰é¡¹å¯¹ç›‘å¬é˜Ÿåˆ—é•¿åº¦çš„é…ç½®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥è¯¢ nginx ç›‘å¬é˜Ÿåˆ—é•¿åº¦é…ç½®")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/nginx/nginx.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" backlog\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backlog")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥è¯¢ php-fpm ç›‘å¬é˜Ÿåˆ—é•¿åº¦")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" phpfpm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /opt/bitnami/php/etc/php-fpm.d/www.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" backlog\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Set listen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" backlog.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("listen.backlog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("511")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# somaxconn æ˜¯ç³»ç»Ÿçº§å¥—æ¥å­—ç›‘å¬é˜Ÿåˆ—ä¸Šé™")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.core.somaxconn\nnet.core.somaxconn "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, Nginx å’Œ somaxconn çš„é…ç½®éƒ½æ˜¯ 10, è€Œ php-fpm çš„é…ç½®ä¹Ÿåªæœ‰ 511, æ˜¾ç„¶éƒ½å¤ªå°äº†. é‚£ä¹ˆ, ä¼˜åŒ–æ–¹æ³•å°±æ˜¯å¢å¤§è¿™ä¸‰ä¸ªé…ç½®, æ¯”å¦‚å¯ä»¥æŠŠ Nginx å’Œ php-fpm çš„é˜Ÿåˆ—é•¿åº¦å¢å¤§åˆ° 8192, è€ŒæŠŠ somaxconn å¢å¤§åˆ° 65536.")]),s._v(" "),a("p",[s._v("åŒæ ·åœ°, ä¹ŸæŠŠè¿™äº›ä¼˜åŒ–åçš„ Nginx, é‡æ–°æ‰“åŒ…æˆäº†ä¸¤ä¸ª Docker é•œåƒ, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œå®ƒ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœæ­¢æ—§çš„å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx phpfpm\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½¿ç”¨æ–°é•œåƒå¯åŠ¨ Nginx å’Œ PHP")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx-tp:2\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" phpfpm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/php-fpm-tp:2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, é‡æ–°æµ‹è¯• Nginx çš„æ€§èƒ½:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" http://192.168.0.30\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62247")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".06s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(".25MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\n  Non-2xx or 3xx responses: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62247")]),s._v("\nRequests/sec:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6185.65")]),s._v("\nTransfer/sec:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".81MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ç°åœ¨çš„ååé‡å·²ç»å¢å¤§åˆ°äº† 6185, å¹¶ä¸”åœ¨æµ‹è¯•çš„æ—¶å€™, å¦‚æœåœ¨ç»ˆç«¯ä¸€ä¸­é‡æ–°æ‰§è¡Œ "),a("code",[s._v("netstat -s grep socket")]),s._v("â€‹, è¿˜ä¼šå‘ç°, ç°åœ¨å·²ç»æ²¡æœ‰å¥—æ¥å­—ä¸¢åŒ…é—®é¢˜äº†.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, è¿™æ¬¡ Nginx çš„å“åº”, å†ä¸€æ¬¡å…¨éƒ¨å¤±è´¥äº†, éƒ½æ˜¯ Non-2xx or 3xx. è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢? å†å»ç»ˆç«¯ä¸€ä¸­, æŸ¥çœ‹ Nginx æ—¥å¿—:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("/03/15 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":52:39 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("crit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#15: *999779 connect() to 127.0.0.1:9000 failed (99: Cannot assign requested address) while connecting to upstream, client: 192.168.0.2, server: localhost, request: "GET / HTTP/1.1", upstream: "fastcgi://127.0.0.1:9000", host: "192.168.0.30"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, Nginx æŠ¥å‡ºäº†æ— æ³•è¿æ¥ fastcgi çš„é”™è¯¯, é”™è¯¯æ¶ˆæ¯æ˜¯ Connect æ—¶, Cannot assign requested address. è¿™ä¸ªé”™è¯¯æ¶ˆæ¯å¯¹åº”çš„é”™è¯¯ä»£ç ä¸º EADDRNOTAVAIL, è¡¨ç¤º "),a("strong",[s._v("IP åœ°å€æˆ–è€…ç«¯å£å·ä¸å¯ç”¨")]),s._v(".")]),s._v(" "),a("p",[s._v("åœ¨è¿™é‡Œ, æ˜¾ç„¶åªèƒ½æ˜¯ç«¯å£å·çš„é—®é¢˜. æ¥ä¸‹æ¥å°±æ¥åˆ†æç«¯å£å·çš„æƒ…å†µ.")]),s._v(" "),a("h6",{attrs:{id:"_4-ç«¯å£å·ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç«¯å£å·ä¼˜åŒ–"}},[s._v("#")]),s._v(" (4)ç«¯å£å·ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("æ ¹æ®ç½‘ç»œå¥—æ¥å­—çš„åŸç†, å½“å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ç«¯æ—¶, éœ€è¦åˆ†é…ä¸€ä¸ª"),a("strong",[s._v("ä¸´æ—¶ç«¯å£å·")]),s._v(", è€Œ Nginx æ­£æ˜¯ PHP-FPM çš„å®¢æˆ·ç«¯. "),a("strong",[s._v("ç«¯å£å·çš„èŒƒå›´å¹¶ä¸æ˜¯æ— é™çš„, æœ€å¤šä¹Ÿåªæœ‰ 6 ä¸‡å¤š")]),s._v(".")]),s._v(" "),a("p",[s._v("æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, å°±å¯ä»¥æŸ¥è¯¢ç³»ç»Ÿé…ç½®çš„ä¸´æ—¶ç«¯å£å·èŒƒå›´:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.ipv4.ip_local_port_range\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.ipv4.ip_local_port_range")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20050")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v('å¯ä»¥çœ‹åˆ°, ä¸´æ—¶ç«¯å£çš„èŒƒå›´åªæœ‰ 50 ä¸ª, æ˜¾ç„¶å¤ªå°äº†. ä¼˜åŒ–æ–¹æ³•å¾ˆå®¹æ˜“æƒ³åˆ°, å¢å¤§è¿™ä¸ªèŒƒå›´å°±å¯ä»¥äº†. æ¯”å¦‚å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤, æŠŠç«¯å£å·èŒƒå›´æ‰©å±•ä¸º "10000 65535":')]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("net.ipv4.ip_local_port_range")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10000 65535"')]),s._v("\nnet.ipv4.ip_local_port_range "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ä¼˜åŒ–å®Œæˆå, å†æ¬¡åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, æµ‹è¯•æ€§èƒ½:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" http://192.168.0.30/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32308")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".07s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".71MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\n  Socket errors: connect "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2027")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("433")]),s._v("\n  Non-2xx or 3xx responses: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\nRequests/sec:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3208.58")]),s._v("\nTransfer/sec:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("682")]),s._v(".15KB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("è¿™æ¬¡, å¼‚å¸¸çš„å“åº”å°‘å¤šäº† , ä¸è¿‡ååé‡ä¹Ÿä¸‹é™åˆ°äº† 3208. å¹¶ä¸”è¿™æ¬¡è¿˜å‡ºç°äº†å¾ˆå¤š Socket read errors. æ˜¾ç„¶, è¿˜å¾—è¿›ä¸€æ­¥ä¼˜åŒ–.")]),s._v(" "),a("h6",{attrs:{id:"_5-ç«ç„°å›¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-ç«ç„°å›¾"}},[s._v("#")]),s._v(" (5)ç«ç„°å›¾")]),s._v(" "),a("p",[s._v("å‰é¢å·²ç»ä¼˜åŒ–äº†å¾ˆå¤šé…ç½®. è¿™äº›é…ç½®åœ¨ä¼˜åŒ–ç½‘ç»œçš„åŒæ—¶, å´ä¹Ÿä¼šå¸¦æ¥å…¶ä»–èµ„æºä½¿ç”¨çš„ä¸Šå‡. è¿™æ ·æ¥çœ‹, æ˜¯ä¸æ˜¯è¯´æ˜å…¶ä»–èµ„æºé‡åˆ°ç“¶é¢ˆäº†å‘¢?")]),s._v(" "),a("p",[s._v("ä¸å¦¨åœ¨ç»ˆç«¯äºŒä¸­é‡æ–°å¯åŠ¨é•¿æ—¶é—´æµ‹è¯•. ç„¶ååˆ‡æ¢å›ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œ top , è§‚å¯Ÿ CPU å’Œå†…å­˜çš„ä½¿ç”¨:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n%Cpu0  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.7")]),s._v(" us, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48.7")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.3")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n%Cpu1  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28.2")]),s._v(" us, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46.5")]),s._v(" sy,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(" id,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23.3")]),s._v(" si,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\nKiB Mem "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8167020")]),s._v(" total,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5867788")]),s._v(" free,   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("490400")]),s._v(" used,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1808832")]),s._v(" buff/cache\nKiB Swap:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" total,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" free,        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" used.  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7361172")]),s._v(" avail Mem\n \n  PID "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20379")]),s._v(" systemd+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38068")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8692")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2392")]),s._v(" R  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36.1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":28.86 nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20381")]),s._v(" systemd+  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38024")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8700")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2392")]),s._v(" S  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33.8")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":29.29 nginx\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1558")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1118172")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85868")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39044")]),s._v(" S  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32.8")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":55.79 dockerd\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20313")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11024")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5968")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3956")]),s._v(" S  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27.2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":22.78 docker-containe\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13730")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" I   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":10.07 kworker/u4:0-ev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("ä» top çš„ç»“æœä¸­å¯ä»¥çœ‹åˆ°, å¯ç”¨å†…å­˜è¿˜æ˜¯å¾ˆå……è¶³çš„, ä½†ç³»ç»Ÿ CPU "),a("strong",[s._v("ä½¿ç”¨ç‡(sy)æ¯”è¾ƒé«˜")]),s._v(", ä¸¤ä¸ª CPU çš„ç³»ç»Ÿ CPU ä½¿ç”¨ç‡éƒ½æ¥è¿‘ 50%, ä¸”ç©ºé—² CPU ä½¿ç”¨ç‡åªæœ‰ 2%. å†çœ‹è¿›ç¨‹éƒ¨åˆ†, CPU ä¸»è¦è¢«ä¸¤ä¸ª Nginx è¿›ç¨‹å’Œä¸¤ä¸ª docker ç›¸å…³çš„è¿›ç¨‹å ç”¨, ä½¿ç”¨ç‡éƒ½æ˜¯ 30% å·¦å³.")]),s._v(" "),a("p",[s._v("CPU ä½¿ç”¨ç‡ä¸Šå‡äº†, è¯¥æ€ä¹ˆè¿›è¡Œåˆ†æå‘¢? å¯ä»¥ä½¿ç”¨ perf, å†é…åˆå‰ä¸¤èŠ‚è®²è¿‡çš„ç«ç„°å›¾, å¾ˆå®¹æ˜“å°±èƒ½æ‰¾åˆ°ç³»ç»Ÿä¸­çš„çƒ­ç‚¹å‡½æ•°.")]),s._v(" "),a("p",[s._v("ä¿æŒç»ˆç«¯äºŒä¸­çš„ wrk ç»§ç»­è¿è¡Œ; åœ¨ç»ˆç«¯ä¸€ä¸­, æ‰§è¡Œ perf å’Œ flamegraph è„šæœ¬, ç”Ÿæˆç«ç„°å›¾:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‰§è¡Œ perf è®°å½•äº‹ä»¶")]),s._v("\n$ perf record "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ‡æ¢åˆ° FlameGraph å®‰è£…è·¯å¾„æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆç«ç„°å›¾")]),s._v("\n$ perf script "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" ~/perf.data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ./stackcollapse-perf.pl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ./flamegraph.pl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nginx.svg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ç„¶å, ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ç”Ÿæˆçš„ nginx.svg, å°±å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç«ç„°å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/345630d08d8e041c54a20562554244f5-20230731161933-tfljk8w.png",alt:""}})]),s._v(" "),a("p",[s._v("æ ¹æ®ç«ç„°å›¾åŸç†, è¿™ä¸ªå›¾åº”è¯¥ä»ä¸‹å¾€ä¸Š, æ²¿ç€è°ƒç”¨æ ˆä¸­æœ€å®½çš„å‡½æ•°, æ¥åˆ†ææ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„å‡½æ•°.")]),s._v(" "),a("p",[s._v("è¿™å„¿ä¸­é—´çš„ do_syscall_64, tcp_v4_connect, inet_hash_connect è¿™ä¸ªå †æ ˆ, å¾ˆæ˜æ˜¾å°±æ˜¯æœ€éœ€è¦å…³æ³¨çš„åœ°æ–¹. "),a("strong",[s._v("inet_hash_connect() æ˜¯ Linux å†…æ ¸ä¸­è´Ÿè´£åˆ†é…ä¸´æ—¶ç«¯å£å·çš„å‡½æ•°")]),s._v('. æ‰€ä»¥è¿™ä¸ªç“¶é¢ˆåº”è¯¥è¿˜åœ¨ä¸´æ—¶ç«¯å£çš„åˆ†é…ä¸Š. åœ¨ä¸Šä¸€æ­¥çš„ "ç«¯å£å·" ä¼˜åŒ–ä¸­, ä¸´æ—¶ç«¯å£å·çš„èŒƒå›´, å·²ç»ä¼˜åŒ–æˆäº† "10000 65535". è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„èŒƒå›´, é‚£ä¹ˆ, ç«¯å£å·çš„åˆ†é…ä¸ºä»€ä¹ˆåˆæˆäº†ç“¶é¢ˆå‘¢?')]),s._v(" "),a("p",[s._v("ä¸€æ—¶æƒ³ä¸åˆ°ä¹Ÿæ²¡å…³ç³», å¯ä»¥æš‚ä¸”æ”¾ä¸‹, å…ˆçœ‹çœ‹å…¶ä»–å› ç´ çš„å½±å“. å†é¡ºç€ inet_hash_connect å¾€å †æ ˆä¸Šé¢æŸ¥çœ‹, ä¸‹ä¸€ä¸ªçƒ­ç‚¹æ˜¯ "),a("code",[s._v("__init_check_established")]),s._v("â€‹ å‡½æ•°. è€Œè¿™ä¸ªå‡½æ•°çš„ç›®çš„, æ˜¯æ£€æŸ¥ç«¯å£å·æ˜¯å¦å¯ç”¨. ç»“åˆè¿™ä¸€ç‚¹, åº”è¯¥å¯ä»¥æƒ³åˆ°, å¦‚æœ"),a("strong",[s._v("æœ‰å¤§é‡è¿æ¥å ç”¨ç€ç«¯å£, é‚£ä¹ˆæ£€æŸ¥ç«¯å£å·å¯ç”¨çš„å‡½æ•°, ä¸å°±ä¼šæ¶ˆè€—æ›´å¤šçš„ CPU å—")]),s._v("?")]),s._v(" "),a("p",[s._v("å®é™…æ˜¯å¦å¦‚æ­¤å‘¢? å¯ä»¥ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­è¿è¡Œ ss å‘½ä»¤,  æŸ¥çœ‹è¿æ¥çŠ¶æ€ç»Ÿè®¡:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\nTCP:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32775")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("estab "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", closed "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v(", orphaned "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", synrecv "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", timewait "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v("/0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", ports "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è¿™å›å¯ä»¥çœ‹åˆ°, "),a("strong",[s._v("æœ‰å¤§é‡è¿æ¥(è¿™å„¿æ˜¯ 32768)å¤„äº timewait çŠ¶æ€, è€Œ timewait çŠ¶æ€çš„è¿æ¥, æœ¬èº«ä¼šç»§ç»­å ç”¨ç«¯å£å·")]),s._v(". å¦‚æœè¿™äº›ç«¯å£å·å¯ä»¥é‡ç”¨, é‚£ä¹ˆè‡ªç„¶å°±å¯ä»¥ç¼©çŸ­ "),a("code",[s._v("__init_check_established")]),s._v("â€‹ çš„è¿‡ç¨‹. è€Œ Linux å†…æ ¸ä¸­, æ°å¥½æœ‰ä¸€ä¸ª tcp_tw_reuse é€‰é¡¹, ç”¨æ¥æ§åˆ¶ç«¯å£å·çš„é‡ç”¨.")]),s._v(" "),a("p",[s._v("åœ¨ç»ˆç«¯ä¸€ä¸­, è¿è¡Œä¸‹é¢çš„å‘½ä»¤, æŸ¥è¯¢å®ƒçš„é…ç½®:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" net.ipv4.tcp_tw_reuse\nnet.ipv4.tcp_tw_reuse "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å¯ä»¥çœ‹åˆ°, tcp_tw_reuse æ˜¯ 0, ä¹Ÿå°±æ˜¯ç¦æ­¢çŠ¶æ€. å…¶å®çœ‹åˆ°è¿™é‡Œå°±èƒ½ç†è§£, ä¸ºä»€ä¹ˆä¸´æ—¶ç«¯å£å·çš„åˆ†é…ä¼šæ˜¯ç³»ç»Ÿè¿è¡Œçš„çƒ­ç‚¹äº†. å½“ç„¶, ä¼˜åŒ–æ–¹æ³•ä¹Ÿå¾ˆå®¹æ˜“, æŠŠå®ƒè®¾ç½®æˆ 1 å°±å¯ä»¥å¼€å¯äº†.")]),s._v(" "),a("p",[s._v("è¿™é‡ŒæŠŠä¼˜åŒ–åçš„åº”ç”¨, ä¹Ÿæ‰“åŒ…æˆäº†ä¸¤ä¸ª Docker é•œåƒ, å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœæ­¢æ—§çš„å®¹å™¨")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx phpfpm\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½¿ç”¨æ–°é•œåƒå¯åŠ¨ Nginx å’Œ PHP")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/nginx-tp:3\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" phpfpm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-itd")]),s._v(" feisky/php-fpm-tp:3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("å®¹å™¨å¯åŠ¨å, åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­, å†æ¬¡æµ‹è¯•ä¼˜åŒ–åçš„æ•ˆæœ:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ wrk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--latency")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" http://192.168.0.30/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52119")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".06s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".81MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("\n  Socket errors: connect "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("850")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nRequests/sec:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5180.48")]),s._v("\nTransfer/sec:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".07MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ç°åœ¨çš„ååé‡å·²ç»è¾¾åˆ°äº† 5000 å¤š, å¹¶ä¸”åªæœ‰å°‘é‡çš„ Socket errors, ä¹Ÿä¸å†æœ‰ Non-2xx or 3xx çš„å“åº”äº†. è¯´æ˜ä¸€åˆ‡ç»ˆäºæ­£å¸¸äº†.")]),s._v(" "),a("h5",{attrs:{id:"_2-å°ç»“-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å°ç»“-3"}},[s._v("#")]),s._v(" 2.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å­¦ä¹ äº†æœåŠ¡ååé‡ä¸‹é™åçš„åˆ†ææ–¹æ³•. å…¶å®, ä»è¿™ä¸ªæ¡ˆä¾‹å¯ä»¥çœ‹å‡º, æ€§èƒ½é—®é¢˜çš„åˆ†æ, æ€»æ˜¯ç¦»ä¸å¼€ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„åŸç†. å®é™…ä¸Š, åˆ†ææ€§èƒ½ç“¶é¢ˆ, æœ€æ ¸å¿ƒçš„ä¹Ÿæ­£æ˜¯æŒæ¡è¿ç”¨è¿™äº›åŸç†.")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("é¦–å…ˆ, åˆ©ç”¨å„ç§æ€§èƒ½å·¥å…·, æ”¶é›†æƒ³è¦çš„æ€§èƒ½æŒ‡æ ‡, ä»è€Œæ¸…æ¥šç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€;")])]),s._v(" "),a("li",[a("strong",[s._v("å…¶æ¬¡, æ‹¿ç›®å‰çŠ¶æ€è·Ÿç³»ç»ŸåŸç†è¿›è¡Œæ¯”è¾ƒ, ä¸ä¸€è‡´çš„åœ°æ–¹, å°±æ˜¯è¦é‡ç‚¹åˆ†æçš„å¯¹è±¡.")])])]),s._v(" "),a("p",[s._v("ä»è¿™ä¸ªè§’åº¦å‡ºå‘, å†è¿›ä¸€æ­¥å€ŸåŠ© perf, ç«ç„°å›¾, bcc ç­‰åŠ¨æ€è¿½è¸ªå·¥å…·, æ‰¾å‡ºçƒ­ç‚¹å‡½æ•°, å°±å¯ä»¥å®šä½ç“¶é¢ˆçš„æ¥æº, ç¡®å®šç›¸åº”çš„ä¼˜åŒ–æ–¹æ³•.")]),s._v(" "),a("h4",{attrs:{id:"_53-å¥—è·¯ç¯‡-ç³»ç»Ÿç›‘æ§çš„ç»¼åˆæ€è·¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_53-å¥—è·¯ç¯‡-ç³»ç»Ÿç›‘æ§çš„ç»¼åˆæ€è·¯"}},[s._v("#")]),s._v(" 53-å¥—è·¯ç¯‡:ç³»ç»Ÿç›‘æ§çš„ç»¼åˆæ€è·¯")]),s._v(" "),a("p",[s._v('å‰é¢ä»‹ç»äº†å¾ˆå¤šæ€§èƒ½åˆ†æçš„åŸç†, æ€è·¯ä»¥åŠç›¸å…³çš„å·¥å…·. ä¸è¿‡, åœ¨å®é™…çš„æ€§èƒ½åˆ†æä¸­, ä¸€ä¸ªå¾ˆå¸¸è§çš„ç°è±¡æ˜¯, æ˜æ˜å‘ç”Ÿäº†æ€§èƒ½ç“¶é¢ˆ, ä½†å½“ç™»å½•åˆ°æœåŠ¡å™¨ä¸­æƒ³è¦æ’æŸ¥çš„æ—¶å€™, å´å‘ç°ç“¶é¢ˆå·²ç»æ¶ˆå¤±äº†. æˆ–è€…è¯´, æ€§èƒ½é—®é¢˜æ€»æ˜¯æ—¶ä¸æ—¶åœ°å‘ç”Ÿ, ä½†å´å¾ˆéš¾æ‰¾å‡ºå‘ç”Ÿè§„å¾‹, ä¹Ÿå¾ˆéš¾é‡ç°. å½“é¢å¯¹è¿™æ ·çš„åœºæ™¯æ—¶, ä½ å¯èƒ½ä¼šå‘ç°, å‰é¢ä»‹ç»çš„å„ç§å·¥å…·, æ–¹æ³•éƒ½"å¤±æ•ˆ"äº†. ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºå®ƒä»¬éƒ½éœ€è¦åœ¨æ€§èƒ½é—®é¢˜å‘ç”Ÿçš„æ—¶åˆ»æ‰æœ‰æ•ˆ, è€Œåœ¨è¿™äº›äº‹ååˆ†æçš„åœºæ™¯ä¸­, å°±å¾ˆéš¾å‘æŒ¥å®ƒä»¬çš„å¨åŠ›äº†.')]),s._v(" "),a("p",[s._v("é‚£è¯¥æ€ä¹ˆåŠå‘¢? ç½®ä¹‹ä¸ç†å—? å…¶å®ä»¥å¾€, å¾ˆå¤šåº”ç”¨éƒ½æ˜¯ç­‰åˆ°ç”¨æˆ·æŠ±æ€¨å“åº”æ…¢äº†, æˆ–è€…ç³»ç»Ÿå´©æºƒäº†å, æ‰å‘ç°ç³»ç»Ÿæˆ–è€…åº”ç”¨ç¨‹åºçš„æ€§èƒ½å‡ºç°äº†é—®é¢˜. è™½ç„¶æœ€ç»ˆä¹Ÿèƒ½å‘ç°é—®é¢˜, ä½†æ˜¾ç„¶, è¿™ç§æ–¹æ³•æ˜¯ä¸å¯å–çš„, å› ä¸ºä¸¥é‡å½±å“äº†ç”¨æˆ·çš„ä½“éªŒ.")]),s._v(" "),a("p",[s._v("è€Œè¦è§£å†³è¿™ä¸ªé—®é¢˜, å°±è¦"),a("strong",[s._v("æ­å»ºç›‘æ§ç³»ç»Ÿ")]),s._v(", æŠŠç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µç›‘æ§èµ·æ¥, å¹¶å®šä¹‰ä¸€ç³»åˆ—çš„ç­–ç•¥, åœ¨å‘ç”Ÿé—®é¢˜æ—¶ç¬¬ä¸€æ—¶é—´å‘Šè­¦é€šçŸ¥. ä¸€ä¸ªå¥½çš„ç›‘æ§ç³»ç»Ÿ, ä¸ä»…å¯ä»¥å®æ—¶æš´éœ²ç³»ç»Ÿçš„å„ç§é—®é¢˜, æ›´å¯ä»¥æ ¹æ®è¿™äº›ç›‘æ§åˆ°çš„çŠ¶æ€, è‡ªåŠ¨åˆ†æå’Œå®šä½å¤§è‡´çš„ç“¶é¢ˆæ¥æº, ä»è€Œæ›´ç²¾ç¡®åœ°æŠŠé—®é¢˜æ±‡æŠ¥ç»™ç›¸å…³å›¢é˜Ÿå¤„ç†.")]),s._v(" "),a("p",[a("strong",[s._v("è¦åšå¥½ç›‘æ§, æœ€æ ¸å¿ƒçš„å°±æ˜¯å…¨é¢çš„, å¯é‡åŒ–çš„æŒ‡æ ‡, è¿™åŒ…æ‹¬ç³»ç»Ÿå’Œåº”ç”¨ä¸¤ä¸ªæ–¹é¢")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("ä»ç³»ç»Ÿæ¥è¯´, ç›‘æ§ç³»ç»Ÿè¦æ¶µç›–ç³»ç»Ÿçš„æ•´ä½“èµ„æºä½¿ç”¨æƒ…å†µ, æ¯”å¦‚å‰é¢è®²è¿‡çš„ CPU, å†…å­˜, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿ, ç½‘ç»œç­‰å„ç§ç³»ç»Ÿèµ„æº")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("è€Œä»åº”ç”¨ç¨‹åºæ¥è¯´, ç›‘æ§ç³»ç»Ÿè¦æ¶µç›–åº”ç”¨ç¨‹åºå†…éƒ¨çš„è¿è¡ŒçŠ¶æ€, è¿™æ—¢åŒ…æ‹¬è¿›ç¨‹çš„ CPU, ç£ç›˜ I/O ç­‰æ•´ä½“è¿è¡ŒçŠ¶å†µ, æ›´éœ€è¦åŒ…æ‹¬è¯¸å¦‚æ¥å£è°ƒç”¨è€—æ—¶, æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯, å†…éƒ¨å¯¹è±¡çš„å†…å­˜ä½¿ç”¨ç­‰åº”ç”¨ç¨‹åºå†…éƒ¨çš„è¿è¡ŒçŠ¶å†µ")]),s._v(".")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚å°±çœ‹çœ‹"),a("strong",[s._v("å¦‚ä½•å¯¹ Linux ç³»ç»Ÿè¿›è¡Œç›‘æ§. è€Œåœ¨ä¸‹ä¸€èŠ‚å°†ç»§ç»­è®²è§£åº”ç”¨ç¨‹åºç›‘æ§çš„æ€è·¯")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-useæ³•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-useæ³•"}},[s._v("#")]),s._v(" 1.USEæ³•")]),s._v(" "),a("p",[s._v("åœ¨å¼€å§‹ç›‘æ§ç³»ç»Ÿä¹‹å‰, ä½ è‚¯å®šæœ€æƒ³çŸ¥é“, æ€ä¹ˆæ‰èƒ½ç”¨ç®€æ´çš„æ–¹æ³•, æ¥æè¿°ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µ. å½“ç„¶å¯ä»¥ä½¿ç”¨ä¸“æ ä¸­å­¦åˆ°çš„å„ç§æ€§èƒ½å·¥å…·, æ¥åˆ†åˆ«æ”¶é›†å„ç§èµ„æºçš„ä½¿ç”¨æƒ…å†µ. ä¸è¿‡ä¸è¦å¿˜è®°, æ¯ç§èµ„æºçš„æ€§èƒ½æŒ‡æ ‡å¯éƒ½æœ‰å¾ˆå¤š, ä½¿ç”¨è¿‡å¤šæŒ‡æ ‡æœ¬èº«è€—æ—¶è€—åŠ›ä¸è¯´, ä¹Ÿä¸å®¹æ˜“ä¸ºå»ºç«‹èµ·ç³»ç»Ÿæ•´ä½“çš„è¿è¡ŒçŠ¶å†µ.")]),s._v(" "),a("p",[s._v("è¿™é‡Œä»‹ç»ä¸€ç§"),a("strong",[s._v("ä¸“é—¨ç”¨äºæ€§èƒ½ç›‘æ§çš„ USE")]),s._v("(Utilization Saturation and Errors)æ³•. USE æ³•æŠŠç³»ç»Ÿèµ„æºçš„æ€§èƒ½æŒ‡æ ‡, ç®€åŒ–æˆäº†ä¸‰ä¸ªç±»åˆ«, å³"),a("mark",[a("strong",[s._v("ä½¿ç”¨ç‡, é¥±å’Œåº¦ä»¥åŠé”™è¯¯æ•°")])]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä½¿ç”¨ç‡, è¡¨ç¤ºèµ„æºç”¨äºæœåŠ¡çš„æ—¶é—´æˆ–å®¹é‡ç™¾åˆ†æ¯”")]),s._v(". 100% çš„ä½¿ç”¨ç‡, è¡¨ç¤ºå®¹é‡å·²ç»ç”¨å°½æˆ–è€…å…¨éƒ¨æ—¶é—´éƒ½ç”¨äºæœåŠ¡.")]),s._v(" "),a("li",[a("strong",[s._v("é¥±å’Œåº¦, è¡¨ç¤ºèµ„æºçš„ç¹å¿™ç¨‹åº¦, é€šå¸¸ä¸ç­‰å¾…é˜Ÿåˆ—çš„é•¿åº¦ç›¸å…³")]),s._v(". 100% çš„é¥±å’Œåº¦, è¡¨ç¤ºèµ„æºæ— æ³•æ¥å—æ›´å¤šçš„è¯·æ±‚.")]),s._v(" "),a("li",[a("strong",[s._v("é”™è¯¯æ•°è¡¨ç¤ºå‘ç”Ÿé”™è¯¯çš„äº‹ä»¶ä¸ªæ•°")]),s._v(". é”™è¯¯æ•°è¶Šå¤š, è¡¨æ˜ç³»ç»Ÿçš„é—®é¢˜è¶Šä¸¥é‡.")])]),s._v(" "),a("p",[s._v("è¿™ä¸‰ä¸ªç±»åˆ«çš„æŒ‡æ ‡, æ¶µç›–äº†ç³»ç»Ÿèµ„æºçš„å¸¸è§æ€§èƒ½ç“¶é¢ˆ, æ‰€ä»¥å¸¸è¢«ç”¨æ¥å¿«é€Ÿå®šä½ç³»ç»Ÿèµ„æºçš„æ€§èƒ½ç“¶é¢ˆ. è¿™æ ·, æ— è®ºæ˜¯å¯¹ CPU, å†…å­˜, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿ, ç½‘ç»œç­‰ç¡¬ä»¶èµ„æº, è¿˜æ˜¯å¯¹æ–‡ä»¶æè¿°ç¬¦æ•°, è¿æ¥æ•°, è¿æ¥è·Ÿè¸ªæ•°ç­‰è½¯ä»¶èµ„æº, USE æ–¹æ³•éƒ½å¯ä»¥å¸®ä½ å¿«é€Ÿå®šä½å‡ºæ˜¯å“ªä¸€ç§ç³»ç»Ÿèµ„æºå‡ºç°äº†æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("æ¯ä¸€ç§ç³»ç»Ÿèµ„æº, åˆæœ‰å“ªäº›å¸¸è§çš„æ€§èƒ½æŒ‡æ ‡å‘¢? ä¸‹é¢æŠŠå¸¸è§çš„æ€§èƒ½æŒ‡æ ‡ç”»äº†ä¸€å¼ è¡¨æ ¼.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/163f13c72ebc2dfd98b6a3e8a10f7521-20230731161933-nyf2ke6.png",alt:""}})]),s._v(" "),a("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, USE æ–¹æ³•åªå…³æ³¨èƒ½ä½“ç°ç³»ç»Ÿèµ„æºæ€§èƒ½ç“¶é¢ˆçš„æ ¸å¿ƒæŒ‡æ ‡, ä½†è¿™å¹¶ä¸æ˜¯è¯´å…¶ä»–æŒ‡æ ‡ä¸é‡è¦. è¯¸å¦‚ç³»ç»Ÿæ—¥å¿—, è¿›ç¨‹èµ„æºä½¿ç”¨é‡, ç¼“å­˜ä½¿ç”¨é‡ç­‰å…¶ä»–å„ç±»æŒ‡æ ‡, ä¹Ÿéƒ½éœ€è¦ç›‘æ§èµ·æ¥. åªä¸è¿‡, å®ƒä»¬é€šå¸¸ç”¨ä½œè¾…åŠ©æ€§èƒ½åˆ†æ, è€Œ USE æ–¹æ³•çš„æŒ‡æ ‡, åˆ™ç›´æ¥è¡¨æ˜äº†ç³»ç»Ÿçš„èµ„æºç“¶é¢ˆ.")]),s._v(" "),a("h5",{attrs:{id:"_2-ç›‘æ§ç³»ç»Ÿ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç›‘æ§ç³»ç»Ÿ"}},[s._v("#")]),s._v(" 2.ç›‘æ§ç³»ç»Ÿ")]),s._v(" "),a("p",[s._v("æŒæ¡ USE æ–¹æ³•ä»¥åŠéœ€è¦ç›‘æ§çš„æ€§èƒ½æŒ‡æ ‡å, æ¥ä¸‹æ¥è¦åšçš„, å°±æ˜¯å»ºç«‹ç›‘æ§ç³»ç»Ÿ, æŠŠè¿™äº›æŒ‡æ ‡ä¿å­˜ä¸‹æ¥; ç„¶å, æ ¹æ®è¿™äº›ç›‘æ§åˆ°çš„çŠ¶æ€, è‡ªåŠ¨åˆ†æå’Œå®šä½å¤§è‡´çš„ç“¶é¢ˆæ¥æº; æœ€å, å†é€šè¿‡å‘Šè­¦ç³»ç»Ÿ, æŠŠé—®é¢˜åŠæ—¶æ±‡æŠ¥ç»™ç›¸å…³å›¢é˜Ÿå¤„ç†.")]),s._v(" "),a("p",[s._v("å¯ä»¥çœ‹å‡º, ä¸€ä¸ªå®Œæ•´çš„ç›‘æ§ç³»ç»Ÿé€šå¸¸ç”±"),a("strong",[s._v("æ•°æ®é‡‡é›†, æ•°æ®å­˜å‚¨, æ•°æ®æŸ¥è¯¢å’Œå¤„ç†, å‘Šè­¦ä»¥åŠå¯è§†åŒ–å±•ç¤ºç­‰å¤šä¸ªæ¨¡å—ç»„æˆ")]),s._v(". æ‰€ä»¥, è¦ä»å¤´æ­å»ºä¸€ä¸ªç›‘æ§ç³»ç»Ÿ, å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç³»ç»Ÿå·¥ç¨‹. ç°åœ¨å·²ç»æœ‰å¾ˆå¤šå¼€æºçš„ç›‘æ§å·¥å…·å¯ä»¥ç›´æ¥ä½¿ç”¨, æ¯”å¦‚æœ€å¸¸è§çš„ Zabbix, Nagios, "),a("strong",[s._v("Prometheus")]),s._v(" ç­‰ç­‰.")]),s._v(" "),a("p",[s._v("ä¸‹é¢å°±ä»¥ Prometheus ä¸ºä¾‹ä»‹ç»è¿™å‡ ä¸ªç»„ä»¶çš„åŸºæœ¬åŸç†. å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯ Prometheus çš„åŸºæœ¬æ¶æ„:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/645ddaea0b956970b9d6811128aa6c12-20230731161933-9qj6q8k.png",alt:""}})]),s._v(" "),a("p",[s._v("å…ˆçœ‹"),a("strong",[s._v("æ•°æ®é‡‡é›†æ¨¡å—")]),s._v(". æœ€å·¦è¾¹çš„ Prometheus targets å°±æ˜¯æ•°æ®é‡‡é›†çš„å¯¹è±¡, è€Œ Retrieval åˆ™è´Ÿè´£é‡‡é›†è¿™äº›æ•°æ®. ä»å›¾ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°, Prometheus "),a("strong",[s._v("åŒæ—¶æ”¯æŒ Push å’Œ Pull ä¸¤ç§æ•°æ®é‡‡é›†æ¨¡å¼")]),s._v(".")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Pull æ¨¡å¼, ç”±æœåŠ¡å™¨ç«¯çš„é‡‡é›†æ¨¡å—æ¥è§¦å‘é‡‡é›†")]),s._v(". åªè¦é‡‡é›†ç›®æ ‡æä¾›äº† HTTP æ¥å£, å°±å¯ä»¥è‡ªç”±æ¥å…¥(è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„é‡‡é›†æ¨¡å¼).")]),s._v(" "),a("li",[a("strong",[s._v("Push æ¨¡å¼, åˆ™æ˜¯ç”±å„ä¸ªé‡‡é›†ç›®æ ‡ä¸»åŠ¨å‘ Push Gateway(ç”¨äºé˜²æ­¢æ•°æ®ä¸¢å¤±)æ¨é€æŒ‡æ ‡, å†ç”±æœåŠ¡å™¨ç«¯ä» Gateway ä¸­æ‹‰å–è¿‡å»")]),s._v("(è¿™æ˜¯ç§»åŠ¨åº”ç”¨ä¸­æœ€å¸¸ç”¨çš„é‡‡é›†æ¨¡å¼).")])]),s._v(" "),a("p",[s._v("ç”±äºéœ€è¦ç›‘æ§çš„å¯¹è±¡é€šå¸¸éƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„, Prometheus è¿˜æä¾›äº†æœåŠ¡å‘ç°çš„æœºåˆ¶, å¯ä»¥è‡ªåŠ¨æ ¹æ®é¢„é…ç½®çš„è§„åˆ™, åŠ¨æ€å‘ç°éœ€è¦ç›‘æ§çš„å¯¹è±¡. è¿™åœ¨ Kubernetes ç­‰å®¹å™¨å¹³å°ä¸­éå¸¸æœ‰æ•ˆ.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒä¸ªæ˜¯"),a("strong",[s._v("æ•°æ®å­˜å‚¨æ¨¡å—")]),s._v(". ä¸ºäº†ä¿æŒç›‘æ§æ•°æ®çš„æŒä¹…åŒ–, å›¾ä¸­çš„ TSDB(Time series database)æ¨¡å—, è´Ÿè´£å°†é‡‡é›†åˆ°çš„æ•°æ®æŒä¹…åŒ–åˆ° SSD ç­‰ç£ç›˜è®¾å¤‡ä¸­. TSDB æ˜¯ä¸“é—¨ä¸ºæ—¶é—´åºåˆ—æ•°æ®è®¾è®¡çš„ä¸€ç§æ•°æ®åº“, ç‰¹ç‚¹æ˜¯ä»¥æ—¶é—´ä¸ºç´¢å¼•, æ•°æ®é‡å¤§å¹¶ä¸”ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸‰ä¸ªæ˜¯"),a("strong",[s._v("æ•°æ®æŸ¥è¯¢å’Œå¤„ç†æ¨¡å—")]),s._v(". åˆšæ‰æåˆ°çš„ TSDB, åœ¨å­˜å‚¨æ•°æ®çš„åŒæ—¶, å…¶å®è¿˜æä¾›äº†æ•°æ®æŸ¥è¯¢å’ŒåŸºæœ¬çš„æ•°æ®å¤„ç†åŠŸèƒ½, è€Œè¿™ä¹Ÿå°±æ˜¯ PromQL è¯­è¨€. PromQL æä¾›äº†ç®€æ´çš„æŸ¥è¯¢, è¿‡æ»¤åŠŸèƒ½, å¹¶ä¸”æ”¯æŒåŸºæœ¬çš„æ•°æ®å¤„ç†æ–¹æ³•, æ˜¯å‘Šè­¦ç³»ç»Ÿå’Œå¯è§†åŒ–å±•ç¤ºçš„åŸºç¡€.")]),s._v(" "),a("p",[s._v("ç¬¬å››ä¸ªæ˜¯"),a("strong",[s._v("å‘Šè­¦æ¨¡å—")]),s._v(". å³ä¸Šè§’çš„ AlertManager æä¾›äº†å‘Šè­¦çš„åŠŸèƒ½, åŒ…æ‹¬åŸºäº PromQL è¯­è¨€çš„è§¦å‘æ¡ä»¶, å‘Šè­¦è§„åˆ™çš„é…ç½®ç®¡ç†ä»¥åŠå‘Šè­¦çš„å‘é€ç­‰. ä¸è¿‡, è™½ç„¶å‘Šè­¦æ˜¯å¿…è¦çš„, ä½†è¿‡äºé¢‘ç¹çš„å‘Šè­¦æ˜¾ç„¶ä¹Ÿä¸å¯å–. æ‰€ä»¥, AlertManager è¿˜æ”¯æŒé€šè¿‡åˆ†ç»„, æŠ‘åˆ¶æˆ–è€…é™é»˜ç­‰å¤šç§æ–¹å¼æ¥èšåˆåŒç±»å‘Šè­¦, å¹¶å‡å°‘å‘Šè­¦æ•°é‡.")]),s._v(" "),a("p",[s._v("æœ€åä¸€ä¸ªæ˜¯"),a("strong",[s._v("å¯è§†åŒ–å±•ç¤ºæ¨¡å—")]),s._v(". Prometheus çš„ web UI æä¾›äº†ç®€å•çš„å¯è§†åŒ–ç•Œé¢, ç”¨äºæ‰§è¡Œ PromQL æŸ¥è¯¢è¯­å¥, ä½†ç»“æœçš„å±•ç¤ºæ¯”è¾ƒå•è°ƒ. ä¸è¿‡, ä¸€æ—¦é…åˆ Grafana, å°±å¯ä»¥æ„å»ºéå¸¸å¼ºå¤§çš„å›¾å½¢ç•Œé¢äº†.")]),s._v(" "),a("p",[s._v("ä»‹ç»å®Œäº†è¿™äº›ç»„ä»¶, æƒ³å¿…ä½ å¯¹æ¯ä¸ªæ¨¡å—éƒ½æœ‰äº†æ¯”è¾ƒæ¸…æ™°çš„è®¤è¯†. æ¥ä¸‹æ¥å†æ¥ç»§ç»­æ·±å…¥äº†è§£è¿™äº›ç»„ä»¶ç»“åˆèµ·æ¥çš„æ•´ä½“åŠŸèƒ½.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä»¥åˆšæ‰æåˆ°çš„ USE æ–¹æ³•ä¸ºä¾‹, ä½¿ç”¨ Prometheus, å¯ä»¥æ”¶é›† Linux æœåŠ¡å™¨çš„ CPU, å†…å­˜, ç£ç›˜, ç½‘ç»œç­‰å„ç±»èµ„æºçš„ä½¿ç”¨ç‡, é¥±å’Œåº¦å’Œé”™è¯¯æ•°æŒ‡æ ‡. ç„¶å, é€šè¿‡ Grafana ä»¥åŠ PromQL æŸ¥è¯¢è¯­å¥, å°±å¯ä»¥æŠŠå®ƒä»¬ä»¥å›¾å½¢ç•Œé¢çš„æ–¹å¼ç›´è§‚å±•ç¤ºå‡ºæ¥.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/16bb3faa572f905cc8bd0b30b8227dd1-20230731161933-1kmk5pt.png",alt:""}}),a("img",{attrs:{src:"/img/b1f2fe4b336f18605716bce2c1243e2d-20230731161933-92zzo81.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-9"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚ä¸€èµ·æ¢³ç†äº†ç³»ç»Ÿç›‘æ§çš„åŸºæœ¬æ€è·¯. "),a("mark",[a("strong",[s._v("ç³»ç»Ÿç›‘æ§çš„æ ¸å¿ƒæ˜¯èµ„æºçš„ä½¿ç”¨æƒ…å†µ, åŒ…æ‹¬ CPU, å†…å­˜, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿ, ç½‘ç»œç­‰ç¡¬ä»¶èµ„æº, ä»¥åŠæ–‡ä»¶æè¿°ç¬¦æ•°, è¿æ¥æ•°, è¿æ¥è·Ÿè¸ªæ•°ç­‰è½¯ä»¶èµ„æº. è€Œè¿™äº›èµ„æº, éƒ½å¯ä»¥é€šè¿‡ USE æ³•æ¥å»ºç«‹æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡")])]),s._v(".")]),s._v(" "),a("p",[s._v("USE æ³•æŠŠç³»ç»Ÿèµ„æºçš„æ€§èƒ½æŒ‡æ ‡, ç®€åŒ–æˆäº†ä¸‰ä¸ªç±»åˆ«, "),a("strong",[s._v("å³ä½¿ç”¨ç‡, é¥±å’Œåº¦ä»¥åŠé”™è¯¯æ•°")]),s._v(". è¿™ä¸‰è€…ä»»ä¸€ç±»åˆ«è¿‡é«˜æ—¶, éƒ½ä»£è¡¨ç›¸å¯¹åº”çš„ç³»ç»Ÿèµ„æºæœ‰å¯èƒ½å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ.")]),s._v(" "),a("p",[s._v("åŸºäº USE æ³•å»ºç«‹æ€§èƒ½æŒ‡æ ‡å, è¿˜éœ€è¦é€šè¿‡ä¸€å¥—å®Œæ•´çš„ç›‘æ§ç³»ç»Ÿ, æŠŠè¿™äº›æŒ‡æ ‡ä»é‡‡é›†, å­˜å‚¨, æŸ¥è¯¢, å¤„ç†, å†åˆ°å‘Šè­¦å’Œå¯è§†åŒ–å±•ç¤ºç­‰ä¸²è”èµ·æ¥. å¯ä»¥åŸºäº Zabbix, Prometheus ç­‰å„ç§å¼€æºçš„ç›‘æ§äº§å“, æ„å»ºè¿™å¥—ç›‘æ§ç³»ç»Ÿ. è¿™æ ·, ä¸ä»…å¯ä»¥å°†ç³»ç»Ÿèµ„æºçš„ç“¶é¢ˆå¿«é€Ÿæš´éœ²å‡ºæ¥, è¿˜å¯ä»¥å€ŸåŠ©ç›‘æ§çš„å†å², äº‹åè¿½æŸ¥å®šä½é—®é¢˜.")]),s._v(" "),a("h4",{attrs:{id:"_54-å¥—è·¯ç¯‡-åº”ç”¨ç›‘æ§çš„ä¸€èˆ¬æ€è·¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_54-å¥—è·¯ç¯‡-åº”ç”¨ç›‘æ§çš„ä¸€èˆ¬æ€è·¯"}},[s._v("#")]),s._v(" 54-å¥—è·¯ç¯‡:åº”ç”¨ç›‘æ§çš„ä¸€èˆ¬æ€è·¯")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ USE æ³•æ¥ç›‘æ§ç³»ç»Ÿçš„æ€§èƒ½, é™¤äº†ç³»ç»Ÿèµ„æºéœ€è¦ç›‘æ§ä¹‹å¤–, åº”ç”¨ç¨‹åºçš„æ€§èƒ½ç›‘æ§, å½“ç„¶ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„. æœ¬èŠ‚å°±çœ‹çœ‹å¦‚ä½•ç›‘æ§åº”ç”¨ç¨‹åºçš„æ€§èƒ½.")]),s._v(" "),a("h5",{attrs:{id:"_1-æŒ‡æ ‡ç›‘æ§"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æŒ‡æ ‡ç›‘æ§"}},[s._v("#")]),s._v(" 1.æŒ‡æ ‡ç›‘æ§")]),s._v(" "),a("p",[s._v("è·Ÿç³»ç»Ÿç›‘æ§ä¸€æ ·, åœ¨æ„å»ºåº”ç”¨ç¨‹åºçš„ç›‘æ§ç³»ç»Ÿä¹‹å‰, é¦–å…ˆä¹Ÿéœ€è¦ç¡®å®š, åˆ°åº•éœ€è¦ç›‘æ§å“ªäº›æŒ‡æ ‡. ç‰¹åˆ«æ˜¯è¦æ¸…æ¥š, æœ‰å“ªäº›æŒ‡æ ‡å¯ä»¥ç”¨æ¥å¿«é€Ÿç¡®è®¤åº”ç”¨ç¨‹åºçš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("å¯¹ç³»ç»Ÿèµ„æºçš„ç›‘æ§, USE æ³•ç®€å•æœ‰æ•ˆ, å´ä¸ä»£è¡¨å…¶é€‚åˆåº”ç”¨ç¨‹åºçš„ç›‘æ§. ä¸¾ä¸ªä¾‹å­, å³ä½¿åœ¨ CPU ä½¿ç”¨ç‡å¾ˆä½çš„æ—¶å€™, ä¹Ÿä¸èƒ½è¯´æ˜åº”ç”¨ç¨‹åºå°±æ²¡æœ‰æ€§èƒ½ç“¶é¢ˆ. å› ä¸ºåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå› ä¸ºé”æˆ–è€… RPC è°ƒç”¨ç­‰, å¯¼è‡´å“åº”ç¼“æ…¢.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, "),a("mark",[a("strong",[s._v("åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒæŒ‡æ ‡, ä¸å†æ˜¯èµ„æºçš„ä½¿ç”¨æƒ…å†µ, è€Œæ˜¯è¯·æ±‚æ•°, é”™è¯¯ç‡å’Œå“åº”æ—¶é—´")])]),s._v(". è¿™äº›æŒ‡æ ‡ä¸ä»…ç›´æ¥å…³ç³»åˆ°ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒ, è¿˜åæ˜ åº”ç”¨æ•´ä½“çš„å¯ç”¨æ€§å’Œå¯é æ€§.")]),s._v(" "),a("p",[s._v('æœ‰äº†è¯·æ±‚æ•°, é”™è¯¯ç‡å’Œå“åº”æ—¶é—´è¿™ä¸‰ä¸ªé»„é‡‘æŒ‡æ ‡ä¹‹å, å°±å¯ä»¥å¿«é€ŸçŸ¥é“åº”ç”¨æ˜¯å¦å‘ç”Ÿäº†æ€§èƒ½é—®é¢˜. ä½†åªæœ‰è¿™äº›æŒ‡æ ‡æ˜¾ç„¶è¿˜æ˜¯ä¸å¤Ÿçš„, å› ä¸ºå‘ç”Ÿæ€§èƒ½é—®é¢˜å, è¿˜å¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿå®šä½"æ€§èƒ½ç“¶é¢ˆåŒº". æ‰€ä»¥ ä¸‹é¢å‡ ç§æŒ‡æ ‡, ä¹Ÿæ˜¯ç›‘æ§åº”ç”¨ç¨‹åºæ—¶å¿…ä¸å¯å°‘çš„.')]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç¬¬ä¸€ä¸ª, æ˜¯åº”ç”¨è¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µ")]),s._v(", æ¯”å¦‚è¿›ç¨‹å ç”¨çš„ CPU, å†…å­˜, ç£ç›˜ I/O, ç½‘ç»œç­‰. ä½¿ç”¨è¿‡å¤šçš„ç³»ç»Ÿèµ„æº, å¯¼è‡´åº”ç”¨ç¨‹åºå“åº”ç¼“æ…¢æˆ–è€…é”™è¯¯æ•°å‡é«˜, æ˜¯ä¸€ä¸ªæœ€å¸¸è§çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("li",[a("strong",[s._v("ç¬¬äºŒä¸ª, æ˜¯åº”ç”¨ç¨‹åºä¹‹é—´è°ƒç”¨æƒ…å†µ")]),s._v(", æ¯”å¦‚è°ƒç”¨é¢‘ç‡, é”™è¯¯æ•°, å»¶æ—¶ç­‰. ç”±äºåº”ç”¨ç¨‹åºå¹¶ä¸æ˜¯å­¤ç«‹çš„, å¦‚æœå…¶ä¾èµ–çš„å…¶ä»–åº”ç”¨å‡ºç°äº†æ€§èƒ½é—®é¢˜, åº”ç”¨è‡ªèº«æ€§èƒ½ä¹Ÿä¼šå—åˆ°å½±å“.")]),s._v(" "),a("li",[a("strong",[s._v("ç¬¬ä¸‰ä¸ª, æ˜¯åº”ç”¨ç¨‹åºå†…éƒ¨æ ¸å¿ƒé€»è¾‘çš„è¿è¡Œæƒ…å†µ")]),s._v(", æ¯”å¦‚å…³é”®ç¯èŠ‚çš„è€—æ—¶ä»¥åŠæ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ç­‰. ç”±äºè¿™æ˜¯åº”ç”¨ç¨‹åºå†…éƒ¨çš„çŠ¶æ€, ä»å¤–éƒ¨é€šå¸¸æ— æ³•ç›´æ¥è·å–åˆ°è¯¦ç»†çš„æ€§èƒ½æ•°æ®. æ‰€ä»¥åº”ç”¨ç¨‹åºåœ¨è®¾è®¡å’Œå¼€å‘æ—¶, å°±åº”è¯¥æŠŠè¿™äº›æŒ‡æ ‡æä¾›å‡ºæ¥, ä»¥ä¾¿ç›‘æ§ç³»ç»Ÿå¯ä»¥äº†è§£å…¶å†…éƒ¨è¿è¡ŒçŠ¶æ€.")])]),s._v(" "),a("p",[s._v("æœ‰äº†åº”ç”¨è¿›ç¨‹çš„èµ„æºä½¿ç”¨æŒ‡æ ‡, å°±å¯ä»¥æŠŠç³»ç»Ÿèµ„æºçš„ç“¶é¢ˆè·Ÿåº”ç”¨ç¨‹åºå…³è”èµ·æ¥, ä»è€Œè¿…é€Ÿå®šä½å› ç³»ç»Ÿèµ„æºä¸è¶³è€Œå¯¼è‡´çš„æ€§èƒ½é—®é¢˜;")]),s._v(" "),a("ul",[a("li",[s._v("æœ‰äº†åº”ç”¨ç¨‹åºä¹‹é—´çš„è°ƒç”¨æŒ‡æ ‡, å¯ä»¥è¿…é€Ÿåˆ†æå‡ºä¸€ä¸ªè¯·æ±‚å¤„ç†çš„è°ƒç”¨é“¾ä¸­, åˆ°åº•å“ªä¸ªç»„ä»¶æ‰æ˜¯å¯¼è‡´æ€§èƒ½é—®é¢˜çš„ç½ªé­ç¥¸é¦–;")]),s._v(" "),a("li",[s._v("è€Œæœ‰äº†åº”ç”¨ç¨‹åºå†…éƒ¨æ ¸å¿ƒé€»è¾‘çš„è¿è¡Œæ€§èƒ½, å°±å¯ä»¥æ›´è¿›ä¸€æ­¥, ç›´æ¥è¿›å…¥åº”ç”¨ç¨‹åºçš„å†…éƒ¨, å®šä½åˆ°åº•æ˜¯å“ªä¸ªå¤„ç†ç¯èŠ‚çš„å‡½æ•°å¯¼è‡´äº†æ€§èƒ½é—®é¢˜.")])]),s._v(" "),a("p",[s._v("åŸºäºè¿™äº›æ€è·¯å°±å¯ä»¥æ„å»ºå‡ºæè¿°åº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶æ€çš„æ€§èƒ½æŒ‡æ ‡. å†å°†è¿™äº›æŒ‡æ ‡çº³å…¥ç›‘æ§ç³»ç»Ÿ(æ¯”å¦‚ Prometheus + Grafana)ä¸­, å°±å¯ä»¥è·Ÿç³»ç»Ÿç›‘æ§ä¸€æ ·, ä¸€æ–¹é¢é€šè¿‡å‘Šè­¦ç³»ç»Ÿ, æŠŠé—®é¢˜åŠæ—¶æ±‡æŠ¥ç»™ç›¸å…³å›¢é˜Ÿå¤„ç†; å¦ä¸€æ–¹é¢, é€šè¿‡ç›´è§‚çš„å›¾å½¢ç•Œé¢, åŠ¨æ€å±•ç¤ºåº”ç”¨ç¨‹åºçš„æ•´ä½“æ€§èƒ½.")]),s._v(" "),a("p",[s._v("é™¤æ­¤ä¹‹å¤–, "),a("strong",[s._v("ç”±äºä¸šåŠ¡ç³»ç»Ÿé€šå¸¸ä¼šæ¶‰åŠåˆ°ä¸€è¿ä¸²çš„å¤šä¸ªæœåŠ¡, å½¢æˆä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼è°ƒç”¨é“¾")]),s._v(". ä¸ºäº†è¿…é€Ÿå®šä½è¿™ç±»è·¨åº”ç”¨çš„æ€§èƒ½ç“¶é¢ˆ, è¿˜å¯ä»¥ä½¿ç”¨ Zipkin, Jaeger, Pinpoint ç­‰å„ç±»å¼€æºå·¥å…·, æ¥æ„å»º"),a("strong",[s._v("å…¨é“¾è·¯è·Ÿè¸ªç³»ç»Ÿ")]),s._v(".")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, ä¸‹å›¾å°±æ˜¯ä¸€ä¸ª Jaeger è°ƒç”¨é“¾è·Ÿè¸ªçš„ç¤ºä¾‹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1cb978774d13626bbb6f1b16b10ef9a6-20230731161933-ccx0ihp.png",alt:""}})]),s._v(" "),a("p",[s._v("å…¨é“¾è·¯è·Ÿè¸ªå¯ä»¥å¸®ä½ è¿…é€Ÿå®šä½å‡º, åœ¨ä¸€ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­, å“ªä¸ªç¯èŠ‚æ‰æ˜¯é—®é¢˜æ ¹æº. æ¯”å¦‚, ä»ä¸Šå›¾ä¸­å°±å¯ä»¥å¾ˆå®¹æ˜“çœ‹åˆ°, è¿™æ˜¯ Redis è¶…æ—¶å¯¼è‡´çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("å…¨é“¾è·¯è·Ÿè¸ªé™¤äº†å¯ä»¥å¸®åŠ©å¿«é€Ÿå®šä½è·¨åº”ç”¨çš„æ€§èƒ½é—®é¢˜å¤–, è¿˜å¯ä»¥ç”Ÿæˆçº¿ä¸Šç³»ç»Ÿçš„è°ƒç”¨æ‹“æ‰‘å›¾. è¿™äº›ç›´è§‚çš„æ‹“æ‰‘å›¾, åœ¨åˆ†æå¤æ‚ç³»ç»Ÿ(æ¯”å¦‚å¾®æœåŠ¡)æ—¶å°¤å…¶æœ‰æ•ˆ.")]),s._v(" "),a("h5",{attrs:{id:"_2-æ—¥å¿—ç›‘æ§"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ—¥å¿—ç›‘æ§"}},[s._v("#")]),s._v(" 2.æ—¥å¿—ç›‘æ§")]),s._v(" "),a("p",[s._v("æ€§èƒ½æŒ‡æ ‡çš„ç›‘æ§, å¯ä»¥è¿…é€Ÿå®šä½å‘ç”Ÿç“¶é¢ˆçš„ä½ç½®, ä¸è¿‡åªæœ‰æŒ‡æ ‡çš„è¯å¾€å¾€è¿˜ä¸å¤Ÿ. æ¯”å¦‚, åŒæ ·çš„ä¸€ä¸ªæ¥å£, å½“è¯·æ±‚ä¼ å…¥çš„å‚æ•°ä¸åŒæ—¶, å°±å¯èƒ½ä¼šå¯¼è‡´å®Œå…¨ä¸åŒçš„æ€§èƒ½é—®é¢˜. æ‰€ä»¥, é™¤äº†æŒ‡æ ‡å¤–, è¿˜éœ€è¦å¯¹è¿™äº›æŒ‡æ ‡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯è¿›è¡Œç›‘æ§, è€Œæ—¥å¿—æ­£æ˜¯è¿™äº›ä¸Šä¸‹æ–‡çš„æœ€ä½³æ¥æº.")]),s._v(" "),a("p",[s._v("å¯¹æ¯”æ¥çœ‹:")]),s._v(" "),a("ul",[a("li",[s._v("æŒ‡æ ‡æ˜¯ç‰¹å®šæ—¶é—´æ®µçš„æ•°å€¼å‹æµ‹é‡æ•°æ®, é€šå¸¸ä»¥æ—¶é—´åºåˆ—çš„æ–¹å¼å¤„ç†, é€‚åˆäºå®æ—¶ç›‘æ§.")]),s._v(" "),a("li",[s._v("è€Œæ—¥å¿—åˆ™å®Œå…¨ä¸åŒ, æ—¥å¿—éƒ½æ˜¯æŸä¸ªæ—¶é—´ç‚¹çš„å­—ç¬¦ä¸²æ¶ˆæ¯, é€šå¸¸éœ€è¦å¯¹æœç´¢å¼•æ“è¿›è¡Œç´¢å¼•å, æ‰èƒ½è¿›è¡ŒæŸ¥è¯¢å’Œæ±‡æ€»åˆ†æ.")])]),s._v(" "),a("p",[s._v("å¯¹æ—¥å¿—ç›‘æ§æ¥è¯´, æœ€ç»å…¸çš„æ–¹æ³•, å°±æ˜¯ä½¿ç”¨ ELK æŠ€æœ¯æ ˆ, å³ä½¿ç”¨ Elasticsearch, Logstash å’Œ Kibana è¿™ä¸‰ä¸ªç»„ä»¶çš„ç»„åˆ. å¦‚ä¸‹å›¾æ‰€ç¤º, å°±æ˜¯ä¸€ä¸ªç»å…¸çš„ ELK æ¶æ„å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/a8591f10e94ee4cd96a22114dcdb5c49-20230731161933-3lcfs7w.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™å…¶ä¸­:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Logstash")]),s._v(" è´Ÿè´£å¯¹ä»å„ä¸ªæ—¥å¿—æºé‡‡é›†æ—¥å¿—, ç„¶åè¿›è¡Œé¢„å¤„ç†, æœ€åå†æŠŠåˆæ­¥å¤„ç†è¿‡çš„æ—¥å¿—, å‘é€ç»™ Elasticsearch è¿›è¡Œç´¢å¼•.")]),s._v(" "),a("li",[a("strong",[s._v("Elasticsearch")]),s._v(" è´Ÿè´£å¯¹æ—¥å¿—è¿›è¡Œç´¢å¼•, å¹¶æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å…¨æ–‡æœç´¢å¼•æ“, è¿™æ ·å°±å¯ä»¥æ–¹ä¾¿ä½ ä»æ—¥å¿—ä¸­æ£€ç´¢éœ€è¦çš„æ•°æ®.")]),s._v(" "),a("li",[a("strong",[s._v("Kibana")]),s._v(" åˆ™è´Ÿè´£å¯¹æ—¥å¿—è¿›è¡Œå¯è§†åŒ–åˆ†æ, åŒ…æ‹¬æ—¥å¿—æœç´¢, å¤„ç†ä»¥åŠç»šä¸½çš„ä»ªè¡¨æ¿å±•ç¤ºç­‰.")])]),s._v(" "),a("p",[s._v("ä¸‹é¢è¿™å¼ å›¾, å°±æ˜¯ä¸€ä¸ª Kibana ä»ªè¡¨æ¿çš„ç¤ºä¾‹, å®ƒç›´è§‚å±•ç¤ºäº† Apache çš„è®¿é—®æ¦‚å†µ.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/dca793acab626fd7ffd5fac16eb675c2-20230731161933-dmw3idq.png",alt:""}})]),s._v(" "),a("p",[s._v("å€¼å¾—æ³¨æ„çš„æ˜¯, ELK æŠ€æœ¯æ ˆä¸­çš„ Logstash èµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§. æ‰€ä»¥, åœ¨èµ„æºç´§å¼ çš„ç¯å¢ƒä¸­, å¾€å¾€ä½¿ç”¨èµ„æºæ¶ˆè€—æ›´ä½çš„ "),a("strong",[s._v("Fluentd, æ¥æ›¿ä»£ Logstash(ä¹Ÿå°±æ˜¯æ‰€è°“çš„ EFK æŠ€æœ¯æ ˆ)")]),s._v(" .")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-10"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¢³ç†äº†åº”ç”¨ç¨‹åºç›‘æ§çš„åŸºæœ¬æ€è·¯. åº”ç”¨ç¨‹åºçš„ç›‘æ§, å¯ä»¥åˆ†ä¸ºæŒ‡æ ‡ç›‘æ§å’Œæ—¥å¿—ç›‘æ§ä¸¤å¤§éƒ¨åˆ†:")]),s._v(" "),a("ul",[a("li",[s._v("æŒ‡æ ‡ç›‘æ§ä¸»è¦æ˜¯å¯¹ä¸€å®šæ—¶é—´æ®µå†…æ€§èƒ½æŒ‡æ ‡è¿›è¡Œæµ‹é‡, ç„¶åå†é€šè¿‡æ—¶é—´åºåˆ—çš„æ–¹å¼, è¿›è¡Œå¤„ç†, å­˜å‚¨å’Œå‘Šè­¦.")]),s._v(" "),a("li",[s._v("æ—¥å¿—ç›‘æ§åˆ™å¯ä»¥æä¾›æ›´è¯¦ç»†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯, é€šå¸¸é€šè¿‡ ELK æŠ€æœ¯æ ˆæ¥è¿›è¡Œæ”¶é›†, ç´¢å¼•å’Œå›¾å½¢åŒ–å±•ç¤º.")])]),s._v(" "),a("p",[s._v("åœ¨è·¨å¤šä¸ªä¸åŒåº”ç”¨çš„å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸­, è¿˜å¯ä»¥æ„å»ºå…¨é“¾è·¯è·Ÿè¸ªç³»ç»Ÿ. è¿™æ ·å¯ä»¥åŠ¨æ€è·Ÿè¸ªè°ƒç”¨é“¾ä¸­å„ä¸ªç»„ä»¶çš„æ€§èƒ½, ç”Ÿæˆæ•´ä¸ªæµç¨‹çš„è°ƒç”¨æ‹“æ‰‘å›¾, ä»è€ŒåŠ å¿«å®šä½å¤æ‚åº”ç”¨çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("h4",{attrs:{id:"_55-å¥—è·¯ç¯‡-åˆ†ææ€§èƒ½é—®é¢˜çš„ä¸€èˆ¬æ­¥éª¤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_55-å¥—è·¯ç¯‡-åˆ†ææ€§èƒ½é—®é¢˜çš„ä¸€èˆ¬æ­¥éª¤"}},[s._v("#")]),s._v(" 55-å¥—è·¯ç¯‡:åˆ†ææ€§èƒ½é—®é¢˜çš„ä¸€èˆ¬æ­¥éª¤")]),s._v(" "),a("p",[s._v("ä¸Šä¸€èŠ‚å­¦ä¹ äº†, åº”ç”¨ç¨‹åºç›‘æ§çš„åŸºæœ¬æ€è·¯. ä¸è¿‡, å¦‚æœ"),a("strong",[s._v("æ”¶åˆ°ç›‘æ§ç³»ç»Ÿçš„å‘Šè­¦, å‘ç°ç³»ç»Ÿèµ„æºæˆ–è€…åº”ç”¨ç¨‹åºå‡ºç°æ€§èƒ½ç“¶é¢ˆ, åˆè¯¥å¦‚ä½•è¿›ä¸€æ­¥åˆ†æå®ƒçš„æ ¹æºå‘¢")]),s._v("? ä»Šå¤©å°±åˆ†åˆ«"),a("strong",[s._v("ä»ç³»ç»Ÿèµ„æºç“¶é¢ˆå’Œåº”ç”¨ç¨‹åºç“¶é¢ˆè¿™ä¸¤ä¸ªè§’åº¦æ¥çœ‹çœ‹, æ€§èƒ½åˆ†æçš„ä¸€èˆ¬æ­¥éª¤")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-ç³»ç»Ÿèµ„æºç“¶é¢ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç³»ç»Ÿèµ„æºç“¶é¢ˆ"}},[s._v("#")]),s._v(" 1.ç³»ç»Ÿèµ„æºç“¶é¢ˆ")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ¥çœ‹ç³»ç»Ÿèµ„æºçš„ç“¶é¢ˆ, è¿™ä¹Ÿæ˜¯æœ€ä¸ºå¸¸è§çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("åœ¨ç³»ç»Ÿç›‘æ§çš„ç»¼åˆæ€è·¯ç¯‡ä¸­æ›¾ç»ä»‹ç»è¿‡, ç³»ç»Ÿèµ„æºçš„ç“¶é¢ˆ, å¯ä»¥é€šè¿‡ USE æ³•, å³"),a("strong",[s._v("ä½¿ç”¨ç‡, é¥±å’Œåº¦ä»¥åŠé”™è¯¯æ•°è¿™ä¸‰ç±»æŒ‡æ ‡æ¥è¡¡é‡")]),s._v(". ç³»ç»Ÿçš„èµ„æº, å¯ä»¥åˆ†ä¸º"),a("strong",[s._v("ç¡¬ä»¶èµ„æºå’Œè½¯ä»¶èµ„æº")]),s._v("ä¸¤ç±».")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å¦‚ CPU, å†…å­˜, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿä»¥åŠç½‘ç»œç­‰, éƒ½æ˜¯æœ€å¸¸è§çš„ç¡¬ä»¶èµ„æº")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("è€Œæ–‡ä»¶æè¿°ç¬¦æ•°, è¿æ¥è·Ÿè¸ªæ•°, å¥—æ¥å­—ç¼“å†²åŒºå¤§å°ç­‰, åˆ™æ˜¯å…¸å‹çš„è½¯ä»¶èµ„æº")]),s._v(".")])]),s._v(" "),a("p",[s._v("è¿™æ ·, åœ¨æ”¶åˆ°ç›‘æ§ç³»ç»Ÿå‘Šè­¦æ—¶, å°±å¯ä»¥å¯¹ç…§è¿™äº›èµ„æºåˆ—è¡¨, å†æ ¹æ®æŒ‡æ ‡çš„ä¸åŒæ¥è¿›è¡Œå®šä½.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, ä¸“æ å‰å››å¤§æ¨¡å—çš„æ ¸å¿ƒ, æ­£æ˜¯å­¦ä¼šå»åˆ†æè¿™äº›èµ„æºç“¶é¢ˆå¯¼è‡´çš„æ€§èƒ½é—®é¢˜. æ‰€ä»¥å½“ç¢°åˆ°äº†ç³»ç»Ÿèµ„æºçš„æ€§èƒ½ç“¶é¢ˆæ—¶, å‰é¢æ¨¡å—çš„æ‰€æœ‰æ€è·¯, æ–¹æ³•ä»¥åŠå·¥å…·, éƒ½å®Œå…¨å¯ä»¥ç…§ç”¨.")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±ä» CPU æ€§èƒ½, å†…å­˜æ€§èƒ½, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿ I/O æ€§èƒ½ä»¥åŠç½‘ç»œæ€§èƒ½ç­‰å››ä¸ªæ–¹é¢, åœ¨å›é¡¾ä¸€ä¸‹å®ƒä»¬çš„åˆ†ææ­¥éª¤.")]),s._v(" "),a("h6",{attrs:{id:"_1-cpuæ€§èƒ½åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-cpuæ€§èƒ½åˆ†æ"}},[s._v("#")]),s._v(" (1)CPUæ€§èƒ½åˆ†æ")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç§æœ€å¸¸è§çš„ç³»ç»Ÿèµ„æºæ˜¯ CPU. å…³äº CPU çš„æ€§èƒ½åˆ†ææ–¹æ³•, å·²ç»æ•´ç†äº†ä¸€ä¸ªè¿…é€Ÿåˆ†æ CPU æ€§èƒ½ç“¶é¢ˆçš„æ€è·¯. è¿˜è®°å¾—è¿™å¼ å›¾å—? åˆ©ç”¨ top, vmstat, pidstat, strace ä»¥åŠ perf ç­‰å‡ ä¸ªæœ€å¸¸è§çš„å·¥å…·, è·å– CPU æ€§èƒ½æŒ‡æ ‡å, å†ç»“åˆè¿›ç¨‹ä¸ CPU çš„å·¥ä½œåŸç†, å°±å¯ä»¥è¿…é€Ÿå®šä½å‡º CPU æ€§èƒ½ç“¶é¢ˆçš„æ¥æº.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/9f7136a8a70a34f9a2dba73ed8d0471d-20230731161933-ure4v3h.png",alt:""}})]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, top, pidstat, vmstat è¿™ç±»å·¥å…·æ‰€æ±‡æŠ¥çš„ CPU æ€§èƒ½æŒ‡æ ‡, éƒ½æºè‡ª "),a("code",[s._v("/proc")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿ(æ¯”å¦‚ "),a("code",[s._v("/proc/loadavg")]),s._v("â€‹, "),a("code",[s._v("/proc/stat")]),s._v("â€‹, "),a("code",[s._v("/proc/softirqs")]),s._v("â€‹ ç­‰). è¿™äº›æŒ‡æ ‡, éƒ½åº”è¯¥é€šè¿‡ç›‘æ§ç³»ç»Ÿç›‘æ§èµ·æ¥. è™½ç„¶å¹¶éæ‰€æœ‰æŒ‡æ ‡éƒ½éœ€è¦æŠ¥è­¦, ä½†è¿™äº›æŒ‡æ ‡å´å¯ä»¥åŠ å¿«æ€§èƒ½é—®é¢˜çš„å®šä½åˆ†æ.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚è¯´, å½“æ”¶åˆ°ç³»ç»Ÿçš„ç”¨æˆ· CPU ä½¿ç”¨ç‡è¿‡é«˜å‘Šè­¦æ—¶, ä»ç›‘æ§ç³»ç»Ÿä¸­ç›´æ¥æŸ¥è¯¢åˆ°, å¯¼è‡´ CPU ä½¿ç”¨ç‡è¿‡é«˜çš„è¿›ç¨‹; ç„¶åå†ç™»å½•åˆ°è¿›ç¨‹æ‰€åœ¨çš„ Linux æœåŠ¡å™¨ä¸­, åˆ†æè¯¥è¿›ç¨‹çš„è¡Œä¸º.")]),s._v(" "),a("p",[s._v("å¯ä»¥ä½¿ç”¨ strace, æŸ¥çœ‹è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨æ±‡æ€»; ä¹Ÿå¯ä»¥ä½¿ç”¨ perf ç­‰å·¥å…·, æ‰¾å‡ºè¿›ç¨‹çš„çƒ­ç‚¹å‡½æ•°; ç”šè‡³è¿˜å¯ä»¥ä½¿ç”¨åŠ¨æ€è¿½è¸ªçš„æ–¹æ³•, æ¥è§‚å¯Ÿè¿›ç¨‹çš„å½“å‰æ‰§è¡Œè¿‡ç¨‹, ç›´åˆ°ç¡®å®šç“¶é¢ˆçš„æ ¹æº.")]),s._v(" "),a("h6",{attrs:{id:"_2-å†…å­˜æ€§èƒ½åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†…å­˜æ€§èƒ½åˆ†æ"}},[s._v("#")]),s._v(" (2)å†…å­˜æ€§èƒ½åˆ†æ")]),s._v(" "),a("p",[s._v("è¯´å®Œäº† CPU çš„æ€§èƒ½åˆ†æ, å†æ¥çœ‹çœ‹ç¬¬äºŒç§ç³»ç»Ÿèµ„æº, å³å†…å­˜. å…³äºå†…å­˜æ€§èƒ½çš„åˆ†ææ–¹æ³•, å‰é¢ä¹Ÿæ•´ç†äº†ä¸€ä¸ªå¿«é€Ÿåˆ†æçš„æ€è·¯. ä¸‹é¢è¿™å¼ å›¾, å°±æ˜¯ä¸€ä¸ªè¿…é€Ÿå®šä½å†…å­˜ç“¶é¢ˆçš„æµç¨‹. å¯ä»¥é€šè¿‡ free å’Œ vmstat è¾“å‡ºçš„æ€§èƒ½æŒ‡æ ‡, ç¡®è®¤å†…å­˜ç“¶é¢ˆ; ç„¶åå†æ ¹æ®å†…å­˜é—®é¢˜çš„ç±»å‹, è¿›ä¸€æ­¥åˆ†æå†…å­˜çš„ä½¿ç”¨, åˆ†é…, æ³„æ¼ä»¥åŠç¼“å­˜ç­‰, æœ€åæ‰¾å‡ºé—®é¢˜çš„æ¥æº.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1475e842190d3f18fb6e5bff1756a46c-20230731161933-yenci90.png",alt:""}})]),s._v(" "),a("p",[s._v("åŒ CPU æ€§èƒ½ä¸€æ ·, å¾ˆå¤šå†…å­˜çš„æ€§èƒ½æŒ‡æ ‡, ä¹Ÿæ¥æºäº "),a("code",[s._v("/proc")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿ(æ¯”å¦‚ "),a("code",[s._v("/proc/meminfo")]),s._v("â€‹, "),a("code",[s._v("/proc/slabinfo")]),s._v("â€‹ ç­‰), å®ƒä»¬ä¹Ÿéƒ½åº”è¯¥é€šè¿‡ç›‘æ§ç³»ç»Ÿç›‘æ§èµ·æ¥. è¿™æ ·, å½“æ”¶åˆ°å†…å­˜å‘Šè­¦æ—¶, å°±å¯ä»¥ä»ç›‘æ§ç³»ç»Ÿä¸­, ç›´æ¥å¾—åˆ°ä¸Šå›¾ä¸­çš„å„é¡¹æ€§èƒ½æŒ‡æ ‡, ä»è€ŒåŠ å¿«æ€§èƒ½é—®é¢˜çš„å®šä½è¿‡ç¨‹.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚è¯´, å½“æ”¶åˆ°å†…å­˜ä¸è¶³çš„å‘Šè­¦æ—¶, é¦–å…ˆå¯ä»¥ä»ç›‘æ§ç³»ç»Ÿä¸­. æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å‡ ä¸ªè¿›ç¨‹. ç„¶å, å†æ ¹æ®è¿™äº›è¿›ç¨‹çš„å†…å­˜å ç”¨å†å², è§‚å¯Ÿæ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜. ç¡®å®šå‡ºæœ€å¯ç–‘çš„è¿›ç¨‹å, å†ç™»å½•åˆ°è¿›ç¨‹æ‰€åœ¨çš„ Linux æœåŠ¡å™¨ä¸­, åˆ†æè¯¥è¿›ç¨‹çš„å†…å­˜ç©ºé—´æˆ–è€…å†…å­˜åˆ†é…, æœ€åå¼„æ¸…æ¥šè¿›ç¨‹ä¸ºä»€ä¹ˆä¼šå ç”¨å¤§é‡å†…å­˜.")]),s._v(" "),a("h6",{attrs:{id:"_3-ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿi-oæ€§èƒ½åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿi-oæ€§èƒ½åˆ†æ"}},[s._v("#")]),s._v(" (3)ç£ç›˜å’Œæ–‡ä»¶ç³»ç»ŸI/Oæ€§èƒ½åˆ†æ")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†æ¥çœ‹ç¬¬ä¸‰ç§ç³»ç»Ÿèµ„æº, å³ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿçš„ I/O. å…³äºç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿçš„ I/O æ€§èƒ½åˆ†ææ–¹æ³•, ä¹Ÿå·²ç»æ•´ç†äº†ä¸€ä¸ªå¿«é€Ÿåˆ†æçš„æ€è·¯.")]),s._v(" "),a("p",[s._v("çœ‹ä¸‹é¢è¿™å¼ å›¾. å½“ä½¿ç”¨ iostat, å‘ç°ç£ç›˜ I/O å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ(æ¯”å¦‚ I/O ä½¿ç”¨ç‡è¿‡é«˜, å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ç­‰å¾…é˜Ÿåˆ—é•¿åº¦çªç„¶å¢å¤§ç­‰)å, å¯ä»¥å†é€šè¿‡ pidstat, vmstat ç­‰, ç¡®è®¤ I/O çš„æ¥æº. æ¥ç€, å†æ ¹æ®æ¥æºçš„ä¸åŒ, è¿›ä¸€æ­¥åˆ†ææ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜çš„ä½¿ç”¨ç‡, ç¼“å­˜ä»¥åŠè¿›ç¨‹çš„ I/O ç­‰, ä»è€Œæªå‡º I/O é—®é¢˜çš„çœŸå‡¶.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/5e267df614c69627809f9ba80826b6de-20230731161933-xxa98ut.png",alt:""}})]),s._v(" "),a("p",[s._v("åŒ CPU å’Œå†…å­˜æ€§èƒ½ç±»ä¼¼, å¾ˆå¤šç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½æŒ‡æ ‡, ä¹Ÿæ¥æºäº "),a("code",[s._v("/pro")]),s._v("â€‹c å’Œ "),a("code",[s._v("/sys")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿ(æ¯”å¦‚ /"),a("code",[s._v("proc/diskstats")]),s._v("â€‹, "),a("code",[s._v("/sys/block/sda/stat")]),s._v("â€‹ ç­‰). è‡ªç„¶, å®ƒä»¬ä¹Ÿåº”è¯¥é€šè¿‡ç›‘æ§ç³»ç»Ÿç›‘æ§èµ·æ¥. è¿™æ ·å½“æ”¶åˆ° I/O æ€§èƒ½å‘Šè­¦æ—¶, å°±å¯ä»¥ä»ç›‘æ§ç³»ç»Ÿä¸­, ç›´æ¥å¾—åˆ°ä¸Šå›¾ä¸­çš„å„é¡¹æ€§èƒ½æŒ‡æ ‡, ä»è€ŒåŠ å¿«æ€§èƒ½å®šä½çš„è¿‡ç¨‹.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚è¯´, å½“å‘ç°æŸå—ç£ç›˜çš„ I/O ä½¿ç”¨ç‡ä¸º 100% æ—¶, é¦–å…ˆå¯ä»¥ä»ç›‘æ§ç³»ç»Ÿä¸­, æ‰¾å‡º I/O æœ€å¤šçš„è¿›ç¨‹. ç„¶å, å†ç™»å½•åˆ°è¿›ç¨‹æ‰€åœ¨çš„ Linux æœåŠ¡å™¨ä¸­, å€ŸåŠ© strace, lsof, perf ç­‰å·¥å…·, åˆ†æè¯¥è¿›ç¨‹çš„ I/O è¡Œä¸º. æœ€å, å†ç»“åˆåº”ç”¨ç¨‹åºçš„åŸç†, æ‰¾å‡ºå¤§é‡ I/O çš„åŸå› .")]),s._v(" "),a("h6",{attrs:{id:"_4-ç½‘ç»œæ€§èƒ½åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç½‘ç»œæ€§èƒ½åˆ†æ"}},[s._v("#")]),s._v(" (4)ç½‘ç»œæ€§èƒ½åˆ†æ")]),s._v(" "),a("p",[s._v("æœ€åçš„ç½‘ç»œæ€§èƒ½, å…¶å®åŒ…å«ä¸¤ç±»èµ„æº, å³ç½‘ç»œæ¥å£å’Œå†…æ ¸èµ„æº. å‰é¢æ›¾æåˆ°è¿‡, ç½‘ç»œæ€§èƒ½çš„åˆ†æ, è¦ä» Linux ç½‘ç»œåè®®æ ˆçš„åŸç†æ¥åˆ‡å…¥. ä¸‹é¢è¿™å¼ å›¾, å°±æ˜¯ Linux ç½‘ç»œåè®®æ ˆçš„åŸºæœ¬åŸç†, åŒ…æ‹¬åº”ç”¨å±‚, å¥—æœºå­—æ¥å£, ä¼ è¾“å±‚, ç½‘ç»œå±‚ä»¥åŠé“¾è·¯å±‚ç­‰.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/553918d989c0cd114b3cc5bc2011e620-20230731161933-6zjp6q3.png",alt:""}})]),s._v(" "),a("p",[s._v("è€Œè¦åˆ†æç½‘ç»œçš„æ€§èƒ½, è‡ªç„¶ä¹Ÿæ˜¯è¦ä»è¿™å‡ ä¸ªåè®®å±‚å…¥æ‰‹, é€šè¿‡ä½¿ç”¨ç‡, é¥±å’Œåº¦ä»¥åŠé”™è¯¯æ•°è¿™å‡ ç±»æ€§èƒ½æŒ‡æ ‡, è§‚å¯Ÿæ˜¯å¦å­˜åœ¨æ€§èƒ½é—®é¢˜. æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨é“¾è·¯å±‚, å¯ä»¥ä»ç½‘ç»œæ¥å£çš„ååé‡, ä¸¢åŒ…, é”™è¯¯ä»¥åŠè½¯ä¸­æ–­å’Œç½‘ç»œåŠŸèƒ½å¸è½½ç­‰è§’åº¦åˆ†æ;")]),s._v(" "),a("li",[s._v("åœ¨ç½‘ç»œå±‚, å¯ä»¥ä»è·¯ç”±, åˆ†ç‰‡, å åŠ ç½‘ç»œç­‰è§’åº¦è¿›è¡Œåˆ†æ;")]),s._v(" "),a("li",[s._v("åœ¨ä¼ è¾“å±‚, å¯ä»¥ä» TCP, UDP çš„åè®®åŸç†å‡ºå‘, ä»è¿æ¥æ•°, ååé‡, å»¶è¿Ÿ, é‡ä¼ ç­‰è§’åº¦è¿›è¡Œåˆ†æ;")]),s._v(" "),a("li",[s._v("åœ¨åº”ç”¨å±‚, å¯ä»¥ä»åº”ç”¨å±‚åè®®(å¦‚ HTTP å’Œ DNS), è¯·æ±‚æ•°(QPS), å¥—æ¥å­—ç¼“å­˜ç­‰è§’åº¦è¿›è¡Œåˆ†æ.")])]),s._v(" "),a("p",[s._v("åŒå‰é¢å‡ ç§èµ„æºç±»ä¼¼, ç½‘ç»œçš„æ€§èƒ½æŒ‡æ ‡ä¹Ÿéƒ½æ¥æºäºå†…æ ¸, åŒ…æ‹¬ "),a("code",[s._v("/proc")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿ(å¦‚ "),a("code",[s._v("/proc/net")]),s._v("â€‹), ç½‘ç»œæ¥å£ä»¥åŠ conntrack ç­‰å†…æ ¸æ¨¡å—. è¿™äº›æŒ‡æ ‡åŒæ ·éœ€è¦è¢«ç›‘æ§ç³»ç»Ÿç›‘æ§. è¿™æ ·, å½“æ”¶åˆ°ç½‘ç»œå‘Šè­¦æ—¶, å°±å¯ä»¥ä»ç›‘æ§ç³»ç»Ÿä¸­, æŸ¥è¯¢è¿™äº›åè®®å±‚çš„å„é¡¹æ€§èƒ½æŒ‡æ ‡, ä»è€Œæ›´å¿«å®šä½å‡ºæ€§èƒ½é—®é¢˜.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å½“æ”¶åˆ°ç½‘ç»œä¸é€šçš„å‘Šè­¦æ—¶, å°±å¯ä»¥ä»ç›‘æ§ç³»ç»Ÿä¸­, æŸ¥æ‰¾å„ä¸ªåè®®å±‚çš„ä¸¢åŒ…æŒ‡æ ‡, ç¡®è®¤ä¸¢åŒ…æ‰€åœ¨çš„åè®®å±‚. ç„¶å, ä»ç›‘æ§ç³»ç»Ÿçš„æ•°æ®ä¸­, ç¡®è®¤ç½‘ç»œå¸¦å®½, ç¼“å†²åŒº, è¿æ¥è·Ÿè¸ªæ•°ç­‰è½¯ç¡¬ä»¶, æ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ. æœ€åå†ç™»å½•åˆ°å‘ç”Ÿé—®é¢˜çš„ Linux æœåŠ¡å™¨ä¸­, å€ŸåŠ© netstat, tcpdump, bcc ç­‰å·¥å…·, åˆ†æç½‘ç»œçš„æ”¶å‘æ•°æ®, å¹¶ä¸”ç»“åˆå†…æ ¸ä¸­çš„ç½‘ç»œé€‰é¡¹ä»¥åŠ TCP ç­‰ç½‘ç»œåè®®çš„åŸç†, æ‰¾å‡ºé—®é¢˜çš„æ¥æº.")]),s._v(" "),a("h5",{attrs:{id:"_2-åº”ç”¨ç¨‹åºç“¶é¢ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-åº”ç”¨ç¨‹åºç“¶é¢ˆ"}},[s._v("#")]),s._v(" 2.åº”ç”¨ç¨‹åºç“¶é¢ˆ")]),s._v(" "),a("p",[s._v("é™¤äº†ä»¥ä¸Šè¿™äº›æ¥è‡ªç½‘ç»œèµ„æºçš„ç“¶é¢ˆå¤–, è¿˜æœ‰å¾ˆå¤šç“¶é¢ˆ, å…¶å®ç›´æ¥æ¥è‡ªåº”ç”¨ç¨‹åº. æ¯”å¦‚æœ€å…¸å‹çš„åº”ç”¨ç¨‹åºæ€§èƒ½é—®é¢˜, å°±æ˜¯ååé‡(å¹¶å‘è¯·æ±‚æ•°)ä¸‹é™, é”™è¯¯ç‡å‡é«˜ä»¥åŠå“åº”æ—¶é—´å¢å¤§.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, åœ¨æˆ‘çœ‹æ¥, è¿™äº›åº”ç”¨ç¨‹åºæ€§èƒ½é—®é¢˜è™½ç„¶å„ç§å„æ ·, ä½†å°±å…¶æœ¬è´¨æ¥æº, å®é™…ä¸Šåªæœ‰ä¸‰ç§, ä¹Ÿå°±æ˜¯"),a("strong",[s._v("èµ„æºç“¶é¢ˆ, ä¾èµ–æœåŠ¡ç“¶é¢ˆä»¥åŠåº”ç”¨è‡ªèº«çš„ç“¶é¢ˆ")]),s._v(".")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ç§"),a("strong",[s._v("èµ„æºç“¶é¢ˆ")]),s._v(", å…¶å®è¿˜æ˜¯æŒ‡åˆšæ‰æåˆ°çš„ CPU, å†…å­˜, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿ I/O, ç½‘ç»œä»¥åŠå†…æ ¸èµ„æºç­‰å„ç±»è½¯ç¡¬ä»¶èµ„æºå‡ºç°äº†ç“¶é¢ˆ, ä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºçš„è¿è¡Œå—é™. å¯¹äºè¿™ç§æƒ…å†µå°±å¯ä»¥ç”¨å‰é¢ç³»ç»Ÿèµ„æºç“¶é¢ˆæ¨¡å—æåˆ°çš„å„ç§æ–¹æ³•æ¥åˆ†æ.")]),s._v(" "),a("p",[s._v("ç¬¬äºŒç§"),a("strong",[s._v("ä¾èµ–æœåŠ¡çš„ç“¶é¢ˆ")]),s._v(", ä¹Ÿå°±æ˜¯è¯¸å¦‚æ•°æ®åº“, åˆ†å¸ƒå¼ç¼“å­˜, ä¸­é—´ä»¶ç­‰åº”ç”¨ç¨‹åº, ç›´æ¥æˆ–è€…é—´æ¥è°ƒç”¨çš„æœåŠ¡å‡ºç°äº†æ€§èƒ½é—®é¢˜, ä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºçš„å“åº”å˜æ…¢, æˆ–è€…é”™è¯¯ç‡å‡é«˜. è¿™è¯´ç™½äº†å°±æ˜¯è·¨åº”ç”¨çš„æ€§èƒ½é—®é¢˜, ä½¿ç”¨å…¨é“¾è·¯è·Ÿè¸ªç³»ç»Ÿ, å°±å¯ä»¥å¸®ä½ å¿«é€Ÿå®šä½è¿™ç±»é—®é¢˜çš„æ ¹æº.")]),s._v(" "),a("p",[s._v("æœ€åä¸€ç§, åº”ç”¨"),a("strong",[s._v("ç¨‹åºè‡ªèº«çš„æ€§èƒ½é—®é¢˜")]),s._v(", åŒ…æ‹¬äº†å¤šçº¿ç¨‹å¤„ç†ä¸å½“, æ­»é”, ä¸šåŠ¡ç®—æ³•çš„å¤æ‚åº¦è¿‡é«˜ç­‰ç­‰. å¯¹äºè¿™ç±»é—®é¢˜, åœ¨å‰é¢è®²è¿‡çš„åº”ç”¨ç¨‹åºæŒ‡æ ‡ç›‘æ§ä»¥åŠæ—¥å¿—ç›‘æ§ä¸­, è§‚å¯Ÿå…³é”®ç¯èŠ‚çš„è€—æ—¶å’Œå†…éƒ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯, å°±å¯ä»¥å¸®ä½ ç¼©å°é—®é¢˜çš„èŒƒå›´.")]),s._v(" "),a("p",[s._v("ä¸è¿‡, ç”±äºè¿™æ˜¯åº”ç”¨ç¨‹åºå†…éƒ¨çš„çŠ¶æ€, å¤–éƒ¨é€šå¸¸ä¸èƒ½ç›´æ¥è·å–è¯¦ç»†çš„æ€§èƒ½æ•°æ®, æ‰€ä»¥å°±éœ€è¦åº”ç”¨ç¨‹åºåœ¨è®¾è®¡å’Œå¼€å‘æ—¶, å°±æä¾›å‡ºè¿™äº›æŒ‡æ ‡, ä»¥ä¾¿ç›‘æ§ç³»ç»Ÿå¯ä»¥äº†è§£åº”ç”¨ç¨‹åºçš„å†…éƒ¨è¿è¡ŒçŠ¶æ€.")]),s._v(" "),a("p",[s._v("å¦‚æœè¿™äº›æ‰‹æ®µè¿‡åè¿˜æ˜¯æ— æ³•æ‰¾å‡ºç“¶é¢ˆ, è¿˜å¯ä»¥ç”¨ç³»ç»Ÿèµ„æºæ¨¡å—æåˆ°çš„å„ç±»è¿›ç¨‹åˆ†æå·¥å…·, æ¥è¿›è¡Œåˆ†æå®šä½. æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("ä½ å¯ä»¥ç”¨ strace, è§‚å¯Ÿç³»ç»Ÿè°ƒç”¨;")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ perf å’Œç«ç„°å›¾, åˆ†æçƒ­ç‚¹å‡½æ•°;")]),s._v(" "),a("li",[s._v("ç”šè‡³ä½¿ç”¨åŠ¨æ€è¿½è¸ªæŠ€æœ¯, æ¥åˆ†æè¿›ç¨‹çš„æ‰§è¡ŒçŠ¶æ€.")])]),s._v(" "),a("p",[s._v("å½“ç„¶, ç³»ç»Ÿèµ„æºå’Œåº”ç”¨ç¨‹åºæœ¬æ¥å°±æ˜¯ç›¸äº’å½±å“, ç›¸è¾…ç›¸æˆçš„ä¸€ä¸ªæ•´ä½“. å®é™…ä¸Š, å¾ˆå¤šèµ„æºç“¶é¢ˆ, ä¹Ÿæ˜¯åº”ç”¨ç¨‹åºè‡ªèº«è¿è¡Œå¯¼è‡´çš„. æ¯”å¦‚è¿›ç¨‹çš„å†…å­˜æ³„æ¼, ä¼šå¯¼è‡´ç³»ç»Ÿå†…å­˜ä¸è¶³; è¿›ç¨‹è¿‡å¤šçš„ I/O è¯·æ±‚, ä¼šæ‹–æ…¢æ•´ä¸ªç³»ç»Ÿçš„ I/O è¯·æ±‚ç­‰.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, å¾ˆå¤šæƒ…å†µä¸‹, èµ„æºç“¶é¢ˆå’Œåº”ç”¨è‡ªèº«ç“¶é¢ˆ, å…¶å®éƒ½æ˜¯åŒä¸€ä¸ªé—®é¢˜å¯¼è‡´çš„, å¹¶ä¸éœ€è¦é‡å¤åˆ†æ.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-11"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-11"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚ä»ç³»ç»Ÿèµ„æºç“¶é¢ˆå’Œåº”ç”¨ç¨‹åºç“¶é¢ˆè¿™ä¸¤ä¸ªè§’åº¦, æ¢³ç†äº†æ€§èƒ½é—®é¢˜åˆ†æçš„ä¸€èˆ¬æ­¥éª¤. ä»ç³»ç»Ÿèµ„æºç“¶é¢ˆçš„è§’åº¦æ¥è¯´, USE æ³•æ˜¯æœ€ä¸ºæœ‰æ•ˆçš„æ–¹æ³•, å³ä»ä½¿ç”¨ç‡, é¥±å’Œåº¦ä»¥åŠé”™è¯¯æ•°è¿™ä¸‰ä¸ªæ–¹é¢, æ¥åˆ†æ CPU, å†…å­˜, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿ I/O, ç½‘ç»œä»¥åŠå†…æ ¸èµ„æºé™åˆ¶ç­‰å„ç±»è½¯ç¡¬ä»¶èµ„æº.")]),s._v(" "),a("p",[s._v("ä»åº”ç”¨ç¨‹åºç“¶é¢ˆçš„è§’åº¦æ¥è¯´, "),a("strong",[s._v("å¯ä»¥æŠŠæ€§èƒ½é—®é¢˜çš„æ¥æº, åˆ†ä¸ºèµ„æºç“¶é¢ˆ, ä¾èµ–æœåŠ¡ç“¶é¢ˆä»¥åŠåº”ç”¨è‡ªèº«ç“¶é¢ˆè¿™ä¸‰ç±»")]),s._v(".")]),s._v(" "),a("ul",[a("li",[s._v("èµ„æºç“¶é¢ˆè·Ÿç³»ç»Ÿèµ„æºç“¶é¢ˆ, æœ¬è´¨æ˜¯ä¸€æ ·çš„.")]),s._v(" "),a("li",[s._v("ä¾èµ–æœåŠ¡ç“¶é¢ˆ, å¯ä»¥ä½¿ç”¨å…¨é“¾è·¯è·Ÿè¸ªç³»ç»Ÿè¿›è¡Œå®šä½.")]),s._v(" "),a("li",[s._v("è€Œåº”ç”¨è‡ªèº«çš„é—®é¢˜, å¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨, çƒ­ç‚¹å‡½æ•°, æˆ–è€…åº”ç”¨è‡ªèº«çš„æŒ‡æ ‡ç›‘æ§ä»¥åŠæ—¥å¿—ç›‘æ§ç­‰, è¿›è¡Œåˆ†æå®šä½.")])]),s._v(" "),a("p",[s._v("å€¼å¾—æ³¨æ„çš„æ˜¯, è™½ç„¶æˆ‘æŠŠç“¶é¢ˆåˆ†ä¸ºäº†ç³»ç»Ÿå’Œåº”ç”¨ä¸¤ä¸ªè§’åº¦, ä½†åœ¨å®é™…è¿è¡Œæ—¶, è¿™ä¸¤è€…å¾€å¾€æ˜¯ç›¸è¾…ç›¸æˆ, ç›¸äº’å½±å“çš„. "),a("strong",[s._v("ç³»ç»Ÿæ˜¯åº”ç”¨çš„è¿è¡Œç¯å¢ƒ, ç³»ç»Ÿçš„ç“¶é¢ˆä¼šå¯¼è‡´åº”ç”¨çš„æ€§èƒ½ä¸‹é™; è€Œåº”ç”¨çš„ä¸åˆç†è®¾è®¡, ä¹Ÿä¼šå¼•å‘ç³»ç»Ÿèµ„æºçš„ç“¶é¢ˆ")]),s._v(". åšæ€§èƒ½åˆ†æ, å°±æ˜¯è¦ç»“åˆåº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿçš„åŸç†, æªå‡ºå¼•å‘é—®é¢˜çš„çœŸå‡¶.")]),s._v(" "),a("h4",{attrs:{id:"_56-å¥—è·¯ç¯‡-ä¼˜åŒ–æ€§èƒ½é—®é¢˜çš„ä¸€èˆ¬æ–¹æ³•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_56-å¥—è·¯ç¯‡-ä¼˜åŒ–æ€§èƒ½é—®é¢˜çš„ä¸€èˆ¬æ–¹æ³•"}},[s._v("#")]),s._v(" 56-å¥—è·¯ç¯‡:ä¼˜åŒ–æ€§èƒ½é—®é¢˜çš„ä¸€èˆ¬æ–¹æ³•")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬åšæ€§èƒ½åˆ†æ, å°±æ˜¯è¦"),a("strong",[s._v("ç»“åˆåº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿçš„åŸç†")]),s._v(', æªå‡ºå¼•å‘é—®é¢˜çš„"çœŸå‡¶".')]),s._v(" "),a("p",[s._v("æ‰¾åˆ°æ€§èƒ½é—®é¢˜çš„æ¥æºå, æ•´ä¸ªä¼˜åŒ–å·¥ä½œå…¶å®ä¹Ÿå°±å®Œæˆäº†ä¸€å¤§åŠ, å› ä¸ºè¿™äº›ç“¶é¢ˆå·²ç»æŒ‡æ˜äº†ä¼˜åŒ–çš„æ–¹å‘. ä¸è¿‡, å¯¹äºæ€§èƒ½ä¼˜åŒ–æ¥è¯´, åˆæœ‰å“ªäº›å¸¸è§çš„æ–¹æ³•å‘¢?")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¥çœ‹çœ‹, æ€§èƒ½ä¼˜åŒ–çš„ä¸€èˆ¬æ–¹æ³•. "),a("strong",[s._v("åŒä¸Šä¸€èŠ‚çš„æ€§èƒ½åˆ†æä¸€æ ·, ä¹Ÿå¯ä»¥ä»ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åº, è¿™ä¸¤ä¸ªä¸åŒçš„è§’åº¦æ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–")]),s._v(".")]),s._v(" "),a("h5",{attrs:{id:"_1-ç³»ç»Ÿä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç³»ç»Ÿä¼˜åŒ–"}},[s._v("#")]),s._v(" 1.ç³»ç»Ÿä¼˜åŒ–")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ¥çœ‹ç³»ç»Ÿçš„ä¼˜åŒ–. åœ¨ä¸Šä¸€èŠ‚æ›¾ç»ä»‹ç»è¿‡, USE æ³•å¯ä»¥ç”¨æ¥åˆ†æç³»ç»Ÿè½¯ç¡¬ä»¶èµ„æºçš„ç“¶é¢ˆ, é‚£ä¹ˆç›¸å¯¹åº”çš„ä¼˜åŒ–æ–¹æ³•, å½“ç„¶ä¹Ÿæ˜¯ä»è¿™äº›èµ„æºç“¶é¢ˆå…¥æ‰‹.")]),s._v(" "),a("p",[s._v("å®é™…ä¸Š, é™¤äº†æœ€æ ¸å¿ƒçš„ç³»ç»Ÿèµ„æºç“¶é¢ˆåˆ†æä¹‹å¤–, ä¹Ÿå·²ç»åŒ…å«äº†è¿™äº›å¸¸è§èµ„æºç“¶é¢ˆçš„ä¼˜åŒ–æ–¹æ³•. æ¥ä¸‹æ¥, å°±ä» CPU æ€§èƒ½, å†…å­˜æ€§èƒ½, ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿ I/O æ€§èƒ½ä»¥åŠç½‘ç»œæ€§èƒ½ç­‰å››ä¸ªæ–¹é¢, å¸¦ä½ å›é¡¾ä¸€ä¸‹å®ƒä»¬çš„ä¼˜åŒ–æ–¹æ³•.")]),s._v(" "),a("h6",{attrs:{id:"_1-cpuä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-cpuä¼˜åŒ–"}},[s._v("#")]),s._v(" (1)CPUä¼˜åŒ–")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ¥çœ‹ CPU æ€§èƒ½çš„ä¼˜åŒ–æ–¹æ³•. åœ¨CPU æ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯ä¸­æ›¾ç»ä»‹ç»è¿‡, "),a("strong",[s._v("CPU æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒ, åœ¨äºæ’é™¤æ‰€æœ‰ä¸å¿…è¦çš„å·¥ä½œ, å……åˆ†åˆ©ç”¨ CPU ç¼“å­˜å¹¶å‡å°‘è¿›ç¨‹è°ƒåº¦å¯¹æ€§èƒ½çš„å½±å“.")])]),s._v(" "),a("p",[s._v("ä»è¿™å‡ ä¸ªæ–¹é¢å‡ºå‘, æˆ‘ç›¸ä¿¡ä½ å·²ç»æƒ³åˆ°äº†å¾ˆå¤šçš„ä¼˜åŒ–æ–¹æ³•. è¿™é‡Œä¸»è¦å¼ºè°ƒä¸€ä¸‹, æœ€å…¸å‹çš„ä¸‰ç§ä¼˜åŒ–æ–¹æ³•.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§, "),a("strong",[s._v("æŠŠè¿›ç¨‹ç»‘å®šåˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ª CPU ä¸Š, å……åˆ†åˆ©ç”¨ CPU ç¼“å­˜çš„æœ¬åœ°æ€§, å¹¶å‡å°‘è¿›ç¨‹é—´çš„ç›¸äº’å½±å“")]),s._v(".")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§, "),a("strong",[s._v("ä¸ºä¸­æ–­å¤„ç†ç¨‹åºå¼€å¯å¤š CPU è´Ÿè½½å‡è¡¡, ä»¥ä¾¿åœ¨å‘ç”Ÿå¤§é‡ä¸­æ–­æ—¶, å¯ä»¥å……åˆ†åˆ©ç”¨å¤š CPU çš„ä¼˜åŠ¿åˆ†æ‘Šè´Ÿè½½")]),s._v(".")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰ç§, "),a("strong",[s._v("ä½¿ç”¨ Cgroups ç­‰æ–¹æ³•, ä¸ºè¿›ç¨‹è®¾ç½®èµ„æºé™åˆ¶, é¿å…ä¸ªåˆ«è¿›ç¨‹æ¶ˆè€—è¿‡å¤šçš„ CPU. åŒæ—¶ä¸ºæ ¸å¿ƒåº”ç”¨ç¨‹åºè®¾ç½®æ›´é«˜çš„ä¼˜å…ˆçº§, å‡å°‘ä½ä¼˜å…ˆçº§ä»»åŠ¡çš„å½±å“")]),s._v(".")])]),s._v(" "),a("h6",{attrs:{id:"_2-å†…å­˜ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†…å­˜ä¼˜åŒ–"}},[s._v("#")]),s._v(" (2)å†…å­˜ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("è¯´å®Œäº† CPU çš„æ€§èƒ½ä¼˜åŒ–, å†æ¥çœ‹çœ‹æ€ä¹ˆä¼˜åŒ–å†…å­˜çš„æ€§èƒ½. åœ¨"),a("a",{attrs:{href:"https://time.geekbang.org/column/article/76460",target:"_blank",rel:"noopener noreferrer"}},[s._v('å¦‚ä½•"å¿«å‡†ç‹ "æ‰¾åˆ°ç³»ç»Ÿå†…å­˜çš„é—®é¢˜'),a("OutboundLink")],1),s._v("ä¸­, å‰é¢æ¢³ç†äº†å¸¸è§çš„ä¸€äº›å†…å­˜é—®é¢˜, æ¯”å¦‚å¯ç”¨å†…å­˜ä¸è¶³, å†…å­˜æ³„æ¼, Swap è¿‡å¤š, ç¼ºé¡µå¼‚å¸¸è¿‡å¤šä»¥åŠç¼“å­˜è¿‡å¤šç­‰ç­‰. æ‰€ä»¥, è¯´ç™½äº†, å†…å­˜æ€§èƒ½çš„ä¼˜åŒ–, ä¹Ÿå°±æ˜¯è¦è§£å†³è¿™äº›å†…å­˜ä½¿ç”¨çš„é—®é¢˜.")]),s._v(" "),a("p",[s._v("åœ¨æˆ‘çœ‹æ¥, å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹æ³•, æ¥ä¼˜åŒ–å†…å­˜çš„æ€§èƒ½.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§, "),a("strong",[s._v("é™¤éæœ‰å¿…è¦, Swap åº”è¯¥ç¦æ­¢æ‰")]),s._v(". è¿™æ ·å°±å¯ä»¥é¿å… Swap çš„é¢å¤– I/O å¸¦æ¥å†…å­˜è®¿é—®å˜æ…¢çš„é—®é¢˜.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§, "),a("strong",[s._v("ä½¿ç”¨ Cgroups ç­‰æ–¹æ³•, ä¸ºè¿›ç¨‹è®¾ç½®å†…å­˜é™åˆ¶")]),s._v(". è¿™æ ·å°±å¯ä»¥é¿å…ä¸ªåˆ«è¿›ç¨‹æ¶ˆè€—è¿‡å¤šå†…å­˜, è€Œå½±å“äº†å…¶ä»–è¿›ç¨‹. å¯¹äºæ ¸å¿ƒåº”ç”¨, è¿˜åº”è¯¥é™ä½ oom_score, é¿å…è¢« OOM æ€æ­».")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰ç§, "),a("strong",[s._v("ä½¿ç”¨å¤§é¡µ, å†…å­˜æ± ç­‰æ–¹æ³•, å‡å°‘å†…å­˜çš„åŠ¨æ€åˆ†é…, ä»è€Œå‡å°‘ç¼ºé¡µå¼‚å¸¸")]),s._v(".")])]),s._v(" "),a("h6",{attrs:{id:"_3-ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿi-oä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿi-oä¼˜åŒ–"}},[s._v("#")]),s._v(" (3)ç£ç›˜å’Œæ–‡ä»¶ç³»ç»ŸI/Oä¼˜åŒ–")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å†æ¥çœ‹ç¬¬ä¸‰ç±»ç³»ç»Ÿèµ„æº, å³ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿ I/O çš„ä¼˜åŒ–æ–¹æ³•. æœ‰ä¸‰ç§æœ€å…¸å‹çš„æ–¹æ³•.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€ç§, ä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹æ³•, é€šè¿‡ SSD æ›¿ä»£ HDD, æˆ–è€…ä½¿ç”¨ RAID ç­‰æ–¹æ³•, æå‡ I/O æ€§èƒ½.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒç§, "),a("strong",[s._v("é’ˆå¯¹ç£ç›˜å’Œåº”ç”¨ç¨‹åº I/O æ¨¡å¼çš„ç‰¹å¾, é€‰æ‹©æœ€é€‚åˆçš„ I/O è°ƒåº¦ç®—æ³•")]),s._v(". æ¯”å¦‚, SSD å’Œè™šæ‹Ÿæœºä¸­çš„ç£ç›˜, é€šå¸¸ç”¨çš„æ˜¯ noop è°ƒåº¦ç®—æ³•; è€Œæ•°æ®åº“åº”ç”¨, æ›´æ¨èä½¿ç”¨ deadline ç®—æ³•.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰, "),a("strong",[s._v("ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜çš„ç¼“å­˜, ç¼“å†²åŒº, æ¯”å¦‚ä¼˜åŒ–è„é¡µçš„åˆ·æ–°é¢‘ç‡, è„é¡µé™é¢, ä»¥åŠå†…æ ¸å›æ”¶ç›®å½•é¡¹ç¼“å­˜å’Œç´¢å¼•èŠ‚ç‚¹ç¼“å­˜çš„å€¾å‘ç­‰ç­‰")]),s._v(".")])]),s._v(" "),a("p",[s._v("é™¤æ­¤ä¹‹å¤–, ä½¿ç”¨ä¸åŒç£ç›˜éš”ç¦»ä¸åŒåº”ç”¨çš„æ•°æ®, ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿçš„é…ç½®é€‰é¡¹, ä¼˜åŒ–ç£ç›˜é¢„è¯», å¢å¤§ç£ç›˜é˜Ÿåˆ—é•¿åº¦ç­‰, ä¹Ÿéƒ½æ˜¯å¸¸ç”¨çš„ä¼˜åŒ–æ€è·¯.")]),s._v(" "),a("h6",{attrs:{id:"_4-ç½‘ç»œä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç½‘ç»œä¼˜åŒ–"}},[s._v("#")]),s._v(" (4)ç½‘ç»œä¼˜åŒ–")]),s._v(" "),a("p",[s._v("æœ€åä¸€ä¸ªæ˜¯ç½‘ç»œçš„æ€§èƒ½ä¼˜åŒ–. å‰é¢ä¹Ÿæ¢³ç†äº†ä¸€äº›å¸¸è§çš„ä¼˜åŒ–æ€è·¯. è¿™äº›ä¼˜åŒ–æ–¹æ³•éƒ½æ˜¯"),a("strong",[s._v("ä» Linux çš„ç½‘ç»œåè®®æ ˆå‡ºå‘, é’ˆå¯¹æ¯ä¸ªåè®®å±‚çš„å·¥ä½œåŸç†è¿›è¡Œä¼˜åŒ–")]),s._v(". è¿™é‡ŒåŒæ ·å¼ºè°ƒä¸€ä¸‹æœ€å…¸å‹çš„å‡ ç§ç½‘ç»œä¼˜åŒ–æ–¹æ³•.")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, "),a("strong",[s._v("ä»å†…æ ¸èµ„æºå’Œç½‘ç»œåè®®")]),s._v("çš„è§’åº¦æ¥è¯´, å¯ä»¥å¯¹å†…æ ¸é€‰é¡¹è¿›è¡Œä¼˜åŒ–, æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("å¯ä»¥å¢å¤§å¥—æ¥å­—ç¼“å†²åŒº, è¿æ¥è·Ÿè¸ªè¡¨, æœ€å¤§åŠè¿æ¥æ•°, æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°, æœ¬åœ°ç«¯å£èŒƒå›´ç­‰å†…æ ¸èµ„æºé…é¢")]),s._v(";")]),s._v(" "),a("li",[a("strong",[s._v("ä¹Ÿå¯ä»¥å‡å°‘ TIMEOUT è¶…æ—¶æ—¶é—´, SYN+ACK é‡ä¼ æ•°, Keepalive æ¢æµ‹æ—¶é—´ç­‰å¼‚å¸¸å¤„ç†å‚æ•°;")])]),s._v(" "),a("li",[a("strong",[s._v("è¿˜å¯ä»¥å¼€å¯ç«¯å£å¤ç”¨, åå‘åœ°å€æ ¡éªŒ, å¹¶è°ƒæ•´ MTU å¤§å°ç­‰é™ä½å†…æ ¸çš„è´Ÿæ‹….")])])]),s._v(" "),a("p",[s._v("è¿™äº›éƒ½æ˜¯å†…æ ¸é€‰é¡¹ä¼˜åŒ–çš„æœ€å¸¸è§æªæ–½.")]),s._v(" "),a("p",[s._v("å…¶æ¬¡, "),a("strong",[s._v("ä»ç½‘ç»œæ¥å£çš„è§’åº¦")]),s._v("æ¥è¯´, å¯ä»¥è€ƒè™‘å¯¹ç½‘ç»œæ¥å£çš„åŠŸèƒ½è¿›è¡Œä¼˜åŒ–, æ¯”å¦‚:")]),s._v(" "),a("ul",[a("li",[s._v("å¯ä»¥å°†åŸæ¥ CPU ä¸Šæ‰§è¡Œçš„å·¥ä½œ, å¸è½½åˆ°ç½‘å¡ä¸­æ‰§è¡Œ, å³å¼€å¯ç½‘å¡çš„ GRO, GSO, RSS, VXLAN ç­‰å¸è½½åŠŸèƒ½;")]),s._v(" "),a("li",[s._v("ä¹Ÿå¯ä»¥å¼€å¯ç½‘ç»œæ¥å£çš„å¤šé˜Ÿåˆ—åŠŸèƒ½, è¿™æ ·æ¯ä¸ªé˜Ÿåˆ—å°±å¯ä»¥ç”¨ä¸åŒçš„ä¸­æ–­å·, è°ƒåº¦åˆ°ä¸åŒ CPU ä¸Šæ‰§è¡Œ;")]),s._v(" "),a("li",[s._v("è¿˜å¯ä»¥å¢å¤§ç½‘ç»œæ¥å£çš„ç¼“å†²åŒºå¤§å°ä»¥åŠé˜Ÿåˆ—é•¿åº¦ç­‰, æå‡ç½‘ç»œä¼ è¾“çš„ååé‡.")])]),s._v(" "),a("p",[s._v("æœ€å, åœ¨æé™æ€§èƒ½æƒ…å†µ(æ¯”å¦‚ C10M)ä¸‹, å†…æ ¸çš„ç½‘ç»œåè®®æ ˆå¯èƒ½æ˜¯æœ€ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆ, æ‰€ä»¥ä¸€èˆ¬ä¼šè€ƒè™‘ç»•è¿‡å†…æ ¸åè®®æ ˆ.")]),s._v(" "),a("ul",[a("li",[s._v("å¯ä»¥ä½¿ç”¨ DPDK æŠ€æœ¯, è·³è¿‡å†…æ ¸åè®®æ ˆ, ç›´æ¥ç”±ç”¨æˆ·æ€è¿›ç¨‹ç”¨è½®è¯¢çš„æ–¹å¼, æ¥å¤„ç†ç½‘ç»œè¯·æ±‚. åŒæ—¶å†ç»“åˆå¤§é¡µ, CPU ç»‘å®š, å†…å­˜å¯¹é½, æµæ°´çº¿å¹¶å‘ç­‰å¤šç§æœºåˆ¶, ä¼˜åŒ–ç½‘ç»œåŒ…çš„å¤„ç†æ•ˆç‡.")]),s._v(" "),a("li",[s._v("è¿˜å¯ä»¥ä½¿ç”¨å†…æ ¸è‡ªå¸¦çš„ XDP æŠ€æœ¯, åœ¨ç½‘ç»œåŒ…è¿›å…¥å†…æ ¸åè®®æ ˆå‰, å°±å¯¹å…¶è¿›è¡Œå¤„ç†. è¿™æ ·ä¹Ÿå¯ä»¥è¾¾åˆ°ç›®çš„, è·å¾—å¾ˆå¥½çš„æ€§èƒ½.")])]),s._v(" "),a("h5",{attrs:{id:"_2-åº”ç”¨ç¨‹åºä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-åº”ç”¨ç¨‹åºä¼˜åŒ–"}},[s._v("#")]),s._v(" 2.åº”ç”¨ç¨‹åºä¼˜åŒ–")]),s._v(" "),a("p",[s._v("è¯´å®Œäº†ç³»ç»Ÿè½¯ç¡¬ä»¶èµ„æºçš„ä¼˜åŒ–, æ¥ä¸‹æ¥å†æ¥çœ‹çœ‹"),a("strong",[s._v("åº”ç”¨ç¨‹åºçš„ä¼˜åŒ–æ€è·¯")]),s._v(". è™½ç„¶ç³»ç»Ÿçš„è½¯ç¡¬ä»¶èµ„æº, æ˜¯ä¿è¯åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œçš„åŸºç¡€, ä½†è¦çŸ¥é“, "),a("strong",[s._v("æ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³ä½ç½®, è¿˜æ˜¯åº”ç”¨ç¨‹åºå†…éƒ¨")]),s._v(". ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢? ä¸¾ä¸¤ä¸ªä¾‹å­å°±æ˜ç™½äº†.")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€ä¸ªä¾‹å­, æ˜¯ç³»ç»Ÿ CPU ä½¿ç”¨ç‡(sys%)è¿‡é«˜çš„é—®é¢˜. æœ‰æ—¶å€™å‡ºç°é—®é¢˜, è™½ç„¶è¡¨é¢ç°è±¡æ˜¯ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¿‡é«˜, ä½†åˆ†æè¿‡å, å¾ˆå¯èƒ½ä¼šå‘ç°, åº”ç”¨ç¨‹åºçš„ä¸åˆç†ç³»ç»Ÿè°ƒç”¨æ‰æ˜¯ç½ªé­ç¥¸é¦–. è¿™ç§æƒ…å†µä¸‹, ä¼˜åŒ–åº”ç”¨ç¨‹åºå†…éƒ¨ç³»ç»Ÿè°ƒç”¨çš„é€»è¾‘, æ˜¾ç„¶è¦æ¯”ä¼˜åŒ–å†…æ ¸è¦ç®€å•ä¹Ÿæœ‰ç”¨å¾—å¤š.")]),s._v(" "),a("p",[s._v("å†æ¯”å¦‚è¯´, æ•°æ®åº“çš„ CPU ä½¿ç”¨ç‡é«˜, I/O å“åº”æ…¢, ä¹Ÿæ˜¯æœ€å¸¸è§çš„ä¸€ç§æ€§èƒ½é—®é¢˜. è¿™ç§é—®é¢˜, ä¸€èˆ¬æ¥è¯´, å¹¶ä¸æ˜¯å› ä¸ºæ•°æ®åº“æœ¬èº«æ€§èƒ½ä¸å¥½, è€Œæ˜¯åº”ç”¨ç¨‹åºä¸åˆç†çš„è¡¨ç»“æ„æˆ–è€… SQL æŸ¥è¯¢è¯­å¥å¯¼è‡´çš„. è¿™æ—¶å€™, ä¼˜åŒ–åº”ç”¨ç¨‹åºä¸­æ•°æ®åº“è¡¨ç»“æ„çš„é€»è¾‘æˆ–è€… SQL è¯­å¥, æ˜¾ç„¶è¦æ¯”ä¼˜åŒ–æ•°æ®åº“æœ¬èº«, èƒ½å¸¦æ¥æ›´å¤§çš„æ”¶ç›Š.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, åœ¨è§‚å¯Ÿæ€§èƒ½æŒ‡æ ‡æ—¶, åº”è¯¥å…ˆæŸ¥çœ‹"),a("strong",[s._v("åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´, ååé‡ä»¥åŠé”™è¯¯ç‡")]),s._v("ç­‰æŒ‡æ ‡, å› ä¸ºå®ƒä»¬æ‰æ˜¯æ€§èƒ½ä¼˜åŒ–è¦è§£å†³çš„ç»ˆæé—®é¢˜. ä»¥ç»ˆä¸ºå§‹, ä»è¿™äº›è§’åº¦å‡ºå‘, ä¸€å®šèƒ½æƒ³åˆ°å¾ˆå¤šä¼˜åŒ–æ–¹æ³•, è€Œæˆ‘æ¯”è¾ƒæ¨èä¸‹é¢å‡ ç§æ–¹æ³•.")]),s._v(" "),a("ul",[a("li",[s._v("ç¬¬ä¸€, "),a("strong",[s._v("ä» CPU ä½¿ç”¨çš„è§’åº¦æ¥è¯´, ç®€åŒ–ä»£ç , ä¼˜åŒ–ç®—æ³•, å¼‚æ­¥å¤„ç†ä»¥åŠç¼–è¯‘å™¨ä¼˜åŒ–ç­‰")]),s._v(", éƒ½æ˜¯å¸¸ç”¨çš„é™ä½ CPU ä½¿ç”¨ç‡çš„æ–¹æ³•, è¿™æ ·å¯ä»¥åˆ©ç”¨æœ‰é™çš„ CPU å¤„ç†æ›´å¤šçš„è¯·æ±‚.")]),s._v(" "),a("li",[s._v("ç¬¬äºŒ, "),a("strong",[s._v("ä»æ•°æ®è®¿é—®çš„è§’åº¦æ¥è¯´, ä½¿ç”¨ç¼“å­˜, å†™æ—¶å¤åˆ¶, å¢åŠ  I/O å°ºå¯¸ç­‰")]),s._v(", éƒ½æ˜¯å¸¸ç”¨çš„å‡å°‘ç£ç›˜ I/O çš„æ–¹æ³•, è¿™æ ·å¯ä»¥è·å¾—æ›´å¿«çš„æ•°æ®å¤„ç†é€Ÿåº¦.")]),s._v(" "),a("li",[s._v("ç¬¬ä¸‰, "),a("strong",[s._v("ä»å†…å­˜ç®¡ç†çš„è§’åº¦æ¥è¯´, ä½¿ç”¨å¤§é¡µ, å†…å­˜æ± ç­‰æ–¹æ³•, å¯ä»¥é¢„å…ˆåˆ†é…å†…å­˜, å‡å°‘å†…å­˜çš„åŠ¨æ€åˆ†é…")]),s._v(", ä»è€Œæ›´å¥½åœ°å†…å­˜è®¿é—®æ€§èƒ½.")]),s._v(" "),a("li",[s._v("ç¬¬å››, "),a("strong",[s._v("ä»ç½‘ç»œçš„è§’åº¦æ¥è¯´, ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨, é•¿è¿æ¥ä»£æ›¿çŸ­è¿æ¥, DNS ç¼“å­˜ç­‰æ–¹æ³•")]),s._v(", å¯ä»¥ä¼˜åŒ–ç½‘ç»œ I/O å¹¶å‡å°‘ç½‘ç»œè¯·æ±‚æ•°, ä»è€Œå‡å°‘ç½‘ç»œå»¶æ—¶å¸¦æ¥çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),a("li",[s._v("ç¬¬äº”, "),a("strong",[s._v("ä»è¿›ç¨‹çš„å·¥ä½œæ¨¡å‹æ¥è¯´, å¼‚æ­¥å¤„ç†, å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹ç­‰, å¯ä»¥å……åˆ†åˆ©ç”¨æ¯ä¸€ä¸ª CPU çš„å¤„ç†èƒ½åŠ›")]),s._v(", ä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„ååèƒ½åŠ›.")])]),s._v(" "),a("p",[s._v("é™¤æ­¤ä¹‹å¤–, è¿˜å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—, CDN, è´Ÿè½½å‡è¡¡ç­‰å„ç§æ–¹æ³•, æ¥ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„æ¶æ„, å°†åŸæ¥å•æœºè¦æ‰¿æ‹…çš„ä»»åŠ¡, è°ƒåº¦åˆ°å¤šå°æœåŠ¡å™¨ä¸­å¹¶è¡Œå¤„ç†. è¿™æ ·ä¹Ÿå¾€å¾€èƒ½è·å¾—æ›´å¥½çš„æ•´ä½“æ€§èƒ½.")]),s._v(" "),a("h5",{attrs:{id:"_3-å°ç»“-12"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å°ç»“-12"}},[s._v("#")]),s._v(" 3.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚ä»ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºè¿™ä¸¤ä¸ªè§’åº¦, æ¢³ç†äº†å¸¸è§çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•. è™½ç„¶æ€§èƒ½ä¼˜åŒ–çš„æ–¹æ³•å¾ˆå¤š, ä¸è¿‡è¿˜æ˜¯é‚£å¥è¯, "),a("strong",[s._v("ä¸€å®šè¦é¿å…è¿‡æ—©ä¼˜åŒ–")]),s._v(". æ€§èƒ½ä¼˜åŒ–å¾€å¾€ä¼šæé«˜å¤æ‚æ€§, è¿™ä¸€æ–¹é¢é™ä½äº†å¯ç»´æŠ¤æ€§, å¦ä¸€æ–¹é¢ä¹Ÿä¸ºé€‚åº”å¤æ‚å¤šå˜çš„æ–°éœ€æ±‚å¸¦æ¥éšœç¢.")]),s._v(" "),a("p",[s._v("æ‰€ä»¥, æ€§èƒ½ä¼˜åŒ–æœ€å¥½æ˜¯"),a("strong",[s._v("é€æ­¥å®Œå–„, åŠ¨æ€è¿›è¡Œ; ä¸è¿½æ±‚ä¸€æ­¥åˆ°ä½, è€Œè¦é¦–å…ˆä¿è¯, èƒ½æ»¡è¶³å½“å‰çš„æ€§èƒ½è¦æ±‚")]),s._v(". å‘ç°æ€§èƒ½ä¸æ»¡è¶³è¦æ±‚æˆ–è€…å‡ºç°æ€§èƒ½ç“¶é¢ˆå, å†æ ¹æ®æ€§èƒ½åˆ†æçš„ç»“æœ, é€‰æ‹©æœ€é‡è¦çš„æ€§èƒ½é—®é¢˜è¿›è¡Œä¼˜åŒ–.")]),s._v(" "),a("h4",{attrs:{id:"_57-å¥—è·¯ç¯‡-linuxæ€§èƒ½å·¥å…·é€ŸæŸ¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_57-å¥—è·¯ç¯‡-linuxæ€§èƒ½å·¥å…·é€ŸæŸ¥"}},[s._v("#")]),s._v(" 57-å¥—è·¯ç¯‡:Linuxæ€§èƒ½å·¥å…·é€ŸæŸ¥")]),s._v(" "),a("p",[s._v("å·¥æ¬²å–„å…¶äº‹, å¿…å…ˆåˆ©å…¶å™¨. åœ¨æ€§èƒ½åˆ†æå’Œä¼˜åŒ–æ—¶, å€ŸåŠ©åˆé€‚çš„æ€§èƒ½å·¥å…·, å¯ä»¥è®©æ•´ä¸ªè¿‡ç¨‹äº‹åŠåŠŸå€. æœ¬èŠ‚å°±æ¢³ç†ä¸€ä¸‹å¸¸ç”¨çš„æ€§èƒ½å·¥å…·.")]),s._v(" "),a("h5",{attrs:{id:"_1-æ€§èƒ½å·¥å…·é€ŸæŸ¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ€§èƒ½å·¥å…·é€ŸæŸ¥"}},[s._v("#")]),s._v(" 1.æ€§èƒ½å·¥å…·é€ŸæŸ¥")]),s._v(" "),a("p",[s._v("åœ¨æ¢³ç†æ€§èƒ½å·¥å…·ä¹‹å‰, é¦–å…ˆæä¸€ä¸ªé—®é¢˜, é‚£å°±æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹, æ‰éœ€è¦å»æŸ¥æ‰¾, æŒ‘é€‰æ€§èƒ½å·¥å…·å‘¢? å¯ä»¥å…ˆè‡ªå·±æƒ³ä¸€ä¸‹, å†ç»§ç»­ä¸‹é¢çš„å†…å®¹.")]),s._v(" "),a("p",[s._v('å…¶å®åœ¨æˆ‘çœ‹æ¥, åªæœ‰å½“æƒ³äº†è§£æŸä¸ªæ€§èƒ½æŒ‡æ ‡, å´ä¸çŸ¥é“è¯¥æ€ä¹ˆåŠçš„æ—¶å€™, æ‰ä¼šæƒ³åˆ°, "è¦æ˜¯æœ‰ä¸€ä¸ªæ€§èƒ½å·¥å…·é€ŸæŸ¥è¡¨å°±å¥½äº†" è¿™ä¸ªé—®é¢˜. å¦‚æœå·²çŸ¥ä¸€ä¸ªæ€§èƒ½å·¥å…·å¯ç”¨, æ›´å¤šä¼šå»æŸ¥çœ‹è¿™ä¸ªå·¥å…·çš„æ‰‹å†Œ, æ‰¾å‡ºå®ƒçš„åŠŸèƒ½, ç”¨æ³•ä»¥åŠæ³¨æ„äº‹é¡¹.')]),s._v(" "),a("p",[s._v("å…³äºå·¥å…·æ‰‹å†Œçš„æŸ¥çœ‹, man åº”è¯¥æ˜¯æœ€ç†Ÿæ‚‰çš„æ–¹æ³•, å‰é¢å¤šæ¬¡ä»‹ç»è¿‡. å®é™…ä¸Šé™¤äº† man ä¹‹å¤–, è¿˜æœ‰å¦å¤–ä¸€ä¸ªæŸ¥è¯¢å‘½ä»¤æ‰‹å†Œçš„æ–¹æ³•, ä¹Ÿå°±æ˜¯ info. info å¯ä»¥ç†è§£ä¸º man çš„è¯¦ç»†ç‰ˆæœ¬, æä¾›äº†è¯¸å¦‚èŠ‚ç‚¹è·³è½¬ç­‰æ›´å¼ºå¤§çš„åŠŸèƒ½. ç›¸å¯¹æ¥è¯´, man çš„è¾“å‡ºæ¯”è¾ƒç®€æ´, è€Œ info çš„è¾“å‡ºæ›´è¯¦ç»†. æ‰€ä»¥é€šå¸¸ä½¿ç”¨ man æ¥æŸ¥è¯¢å·¥å…·çš„ä½¿ç”¨æ–¹æ³•, åªæœ‰åœ¨ man çš„è¾“å‡ºä¸å¤ªå¥½ç†è§£æ—¶, æ‰ä¼šå†å»å‚è€ƒ info æ–‡æ¡£.")]),s._v(" "),a("p",[s._v("å½“ç„¶, è¦æŸ¥è¯¢æ‰‹å†Œ, å‰æä¸€å®šæ˜¯å·²çŸ¥å“ªä¸ªå·¥å…·å¯ç”¨. å¦‚æœè¿˜ä¸çŸ¥é“è¦ç”¨å“ªä¸ªå·¥å…·, å°±è¦æ ¹æ®æƒ³äº†è§£çš„æŒ‡æ ‡, å»æŸ¥æ‰¾æœ‰å“ªäº›å·¥å…·å¯ç”¨. è¿™å…¶ä¸­:")]),s._v(" "),a("ul",[a("li",[s._v("æœ‰äº›å·¥å…·ä¸éœ€è¦é¢å¤–å®‰è£…, å°±å¯ä»¥ç›´æ¥ä½¿ç”¨, æ¯”å¦‚å†…æ ¸çš„ "),a("code",[s._v("/proc")]),s._v("â€‹ æ–‡ä»¶ç³»ç»Ÿ;")]),s._v(" "),a("li",[s._v("è€Œæœ‰äº›å·¥å…·, åˆ™éœ€è¦å®‰è£…é¢å¤–çš„è½¯ä»¶åŒ…, æ¯”å¦‚ sar, pidstat, iostat ç­‰.")])]),s._v(" "),a("p",[a("strong",[s._v("æ‰€ä»¥, åœ¨é€‰æ‹©æ€§èƒ½å·¥å…·æ—¶, é™¤äº†è¦è€ƒè™‘æ€§èƒ½æŒ‡æ ‡è¿™ä¸ªç›®çš„å¤–, è¿˜è¦ç»“åˆå¾…åˆ†æçš„ç¯å¢ƒæ¥ç»¼åˆè€ƒè™‘")]),s._v(". æ¯”å¦‚, å®é™…ç¯å¢ƒæ˜¯å¦å…è®¸å®‰è£…è½¯ä»¶åŒ…, æ˜¯å¦éœ€è¦æ–°çš„å†…æ ¸ç‰ˆæœ¬ç­‰.")]),s._v(" "),a("p",[s._v("æ˜ç™½äº†å·¥å…·é€‰æ‹©çš„åŸºæœ¬åŸåˆ™å, æ¥çœ‹ Linux çš„æ€§èƒ½å·¥å…·. é¦–å…ˆè¿˜æ˜¯è¦æ¨èä¸‹é¢è¿™å¼ å›¾, ä¹Ÿå°±æ˜¯ Brendan Gregg æ•´ç†çš„æ€§èƒ½å·¥å…·è°±å›¾.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/4248fe4cb086c77ccb55e38833104e80-20230731161933-46pobuo.png",alt:""}})]),s._v(" "),a("p",[s._v("è¿™å¼ å›¾ä» Linux å†…æ ¸çš„å„ä¸ªå­ç³»ç»Ÿå‡ºå‘, æ±‡æ€»äº†å¯¹å„ä¸ªå­ç³»ç»Ÿè¿›è¡Œæ€§èƒ½åˆ†ææ—¶å¯ä»¥é€‰æ‹©çš„å·¥å…·. ä¸è¿‡, è™½ç„¶è¿™ä¸ªå›¾æ˜¯æ€§èƒ½åˆ†ææœ€å¥½çš„å‚è€ƒèµ„æ–™ä¹‹ä¸€, å®ƒå…¶å®è¿˜ä¸å¤Ÿå…·ä½“.")]),s._v(" "),a("p",[s._v("æ¯”å¦‚, å½“éœ€è¦æŸ¥çœ‹æŸä¸ªæ€§èƒ½æŒ‡æ ‡æ—¶, è¿™å¼ å›¾é‡Œå¯¹åº”çš„å­ç³»ç»Ÿéƒ¨åˆ†, å¯èƒ½æœ‰å¤šä¸ªæ€§èƒ½å·¥å…·å¯ä¾›é€‰æ‹©. ä½†å®é™…ä¸Š, å¹¶éæ‰€æœ‰è¿™äº›å·¥å…·éƒ½é€‚ç”¨, å…·ä½“è¦ç”¨å“ªä¸ª, è¿˜éœ€è¦å»æŸ¥æ‰¾æ¯ä¸ªå·¥å…·çš„æ‰‹å†Œ, å¯¹æ¯”åˆ†æåšå‡ºé€‰æ‹©.")]),s._v(" "),a("p",[s._v("é‚£ä¹ˆ, æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•æ¥ç†è§£è¿™äº›å·¥å…·å‘¢? "),a("strong",[s._v("å»ºè®®ä»æ€§èƒ½æŒ‡æ ‡å‡ºå‘, æ ¹æ®æ€§èƒ½æŒ‡æ ‡çš„ä¸åŒ, å°†æ€§èƒ½å·¥å…·åˆ’åˆ†ä¸ºä¸åŒç±»å‹")]),s._v(". æ¯”å¦‚, æœ€å¸¸è§çš„å°±æ˜¯å¯ä»¥æ ¹æ® CPU, å†…å­˜, ç£ç›˜ I/O ä»¥åŠç½‘ç»œçš„å„ç±»æ€§èƒ½æŒ‡æ ‡, å°†è¿™äº›å·¥å…·è¿›è¡Œåˆ†ç±».")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥å°±ä» CPU, å†…å­˜, ç£ç›˜ I/O ä»¥åŠç½‘ç»œç­‰å‡ ä¸ªè§’åº¦, æ¢³ç†è¿™äº›å¸¸è§çš„ Linux æ€§èƒ½å·¥å…·, ç‰¹åˆ«æ˜¯ä»æ€§èƒ½æŒ‡æ ‡çš„è§’åº¦å‡ºå‘, ç†æ¸…æ¥šåˆ°åº•æœ‰å“ªäº›å·¥å…·, å¯ä»¥ç”¨æ¥ç›‘æµ‹ç‰¹å®šçš„æ€§èƒ½æŒ‡æ ‡. è¿™äº›å·¥å…·, å®é™…ä¸Šè´¯ç©¿åœ¨ä¸“æ å„æ¨¡å—çš„å„ä¸ªæ¡ˆä¾‹ä¸­. ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹, æˆ‘å°†å®ƒä»¬éƒ½æ•´ç†æˆäº†è¡¨æ ¼, å¹¶å¢åŠ äº†æ¯ä¸ªå·¥å…·çš„ä½¿ç”¨åœºæ™¯.")]),s._v(" "),a("h5",{attrs:{id:"_2-cpuæ€§èƒ½å·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-cpuæ€§èƒ½å·¥å…·"}},[s._v("#")]),s._v(" 2.CPUæ€§èƒ½å·¥å…·")]),s._v(" "),a("p",[s._v("é¦–å…ˆ, ä» CPU çš„è§’åº¦æ¥è¯´, ä¸»è¦çš„æ€§èƒ½æŒ‡æ ‡å°±æ˜¯ CPU çš„ä½¿ç”¨ç‡, ä¸Šä¸‹æ–‡åˆ‡æ¢ä»¥åŠ CPU Cache çš„å‘½ä¸­ç‡ç­‰. ä¸‹é¢è¿™å¼ å›¾å°±åˆ—å‡ºäº†å¸¸è§çš„ CPU æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/b8346abdf495428ff42da99587a88161-20230731161933-czlgmn4.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»è¿™äº›æŒ‡æ ‡å‡ºå‘, å†æŠŠ CPU ä½¿ç”¨ç‡, åˆ’åˆ†ä¸º"),a("strong",[s._v("ç³»ç»Ÿå’Œè¿›ç¨‹")]),s._v("ä¸¤ä¸ªç»´åº¦, å°±å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™ä¸ª CPU æ€§èƒ½å·¥å…·é€ŸæŸ¥è¡¨. æ³¨æ„, å› ä¸ºæ¯ç§æ€§èƒ½æŒ‡æ ‡éƒ½å¯èƒ½å¯¹åº”å¤šç§å·¥å…·, æˆ‘åœ¨æ¯ä¸ªæŒ‡æ ‡çš„è¯´æ˜ä¸­, éƒ½å¸®ä½ æ€»ç»“äº†è¿™äº›å·¥å…·çš„ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/5a55218dc6c12ece6a2120ac6a6d6838-20230731161933-cif911u.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_3-å†…å­˜æ€§èƒ½å·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å†…å­˜æ€§èƒ½å·¥å…·"}},[s._v("#")]),s._v(" 3.å†…å­˜æ€§èƒ½å·¥å…·")]),s._v(" "),a("p",[s._v("æ¥ç€æ¥çœ‹å†…å­˜æ–¹é¢. ä»å†…å­˜çš„è§’åº¦æ¥è¯´, ä¸»è¦çš„æ€§èƒ½æŒ‡æ ‡, å°±æ˜¯"),a("strong",[s._v("ç³»ç»Ÿå†…å­˜çš„åˆ†é…å’Œä½¿ç”¨, è¿›ç¨‹å†…å­˜çš„åˆ†é…å’Œä½¿ç”¨ä»¥åŠ SWAP çš„ç”¨é‡")]),s._v(". ä¸‹é¢è¿™å¼ å›¾åˆ—å‡ºäº†å¸¸è§çš„å†…å­˜æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/71e9654dd6efb1c41fd3f70830a86653-20230731161933-sjgxvek.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»è¿™äº›æŒ‡æ ‡å‡ºå‘, å°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹è¡¨æ‰€ç¤ºçš„å†…å­˜æ€§èƒ½å·¥å…·é€ŸæŸ¥è¡¨. åŒ CPU æ€§èƒ½å·¥å…·ä¸€æ ·, è¿™å„¿ä¹Ÿæ¢³ç†äº†å¸¸è§å·¥å…·çš„ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/8757d07a3c282c6f7dbddfef22d1f7fa-20230731161933-k01nf79.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_4-ç£ç›˜i-oæ€§èƒ½å·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç£ç›˜i-oæ€§èƒ½å·¥å…·"}},[s._v("#")]),s._v(" 4.ç£ç›˜I/Oæ€§èƒ½å·¥å…·")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥, ä»æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O çš„è§’åº¦æ¥è¯´, ä¸»è¦æ€§èƒ½æŒ‡æ ‡, å°±æ˜¯"),a("strong",[s._v("æ–‡ä»¶ç³»ç»Ÿçš„ä½¿ç”¨, ç¼“å­˜å’Œç¼“å†²åŒºçš„ä½¿ç”¨, ä»¥åŠç£ç›˜ I/O çš„ä½¿ç”¨ç‡, ååé‡å’Œå»¶è¿Ÿ")]),s._v("ç­‰. ä¸‹é¢è¿™å¼ å›¾åˆ—å‡ºäº†å¸¸è§çš„ I/O æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1c600925b6b67f0d74015c73b851d6c8-20230731161933-ylxr3uw.png",alt:""}}),s._v("ä»è¿™äº›æŒ‡æ ‡å‡ºå‘, å°±å¯ä»¥å¾—åˆ°, ä¸‹é¢è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O æ€§èƒ½å·¥å…·é€ŸæŸ¥è¡¨. åŒ CPU å’Œå†…å­˜æ€§èƒ½å·¥å…·ä¸€æ ·, ä¹Ÿæ¢³ç†å‡ºäº†è¿™äº›å·¥å…·çš„ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/342108393d269b430cdea54da28eddbd-20230731161933-tf4npos.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_5-ç½‘ç»œæ€§èƒ½å·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-ç½‘ç»œæ€§èƒ½å·¥å…·"}},[s._v("#")]),s._v(" 5.ç½‘ç»œæ€§èƒ½å·¥å…·")]),s._v(" "),a("p",[s._v("æœ€å, ä»ç½‘ç»œçš„è§’åº¦æ¥è¯´, ä¸»è¦æ€§èƒ½æŒ‡æ ‡å°±æ˜¯"),a("strong",[s._v("ååé‡, å“åº”æ—¶é—´, è¿æ¥æ•°, ä¸¢åŒ…æ•°")]),s._v("ç­‰. æ ¹æ® TCP/IP ç½‘ç»œåè®®æ ˆçš„åŸç†, å¯ä»¥æŠŠè¿™äº›æ€§èƒ½æŒ‡æ ‡, è¿›ä¸€æ­¥ç»†åŒ–ä¸ºæ¯å±‚åè®®çš„å…·ä½“æŒ‡æ ‡. è¿™é‡ŒåŒæ ·ç”¨ä¸€å¼ å›¾, åˆ†åˆ«ä»é“¾è·¯å±‚, ç½‘ç»œå±‚, ä¼ è¾“å±‚å’Œåº”ç”¨å±‚, åˆ—å‡ºäº†å„å±‚çš„ä¸»è¦æŒ‡æ ‡.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/07722b385f540949c373d6a10b81fe5c-20230731161933-ltoh7a9.png",alt:""}})]),s._v(" "),a("p",[s._v("ä»è¿™äº›æŒ‡æ ‡å‡ºå‘å°±å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç½‘ç»œæ€§èƒ½å·¥å…·é€ŸæŸ¥è¡¨. åŒæ ·ä¹Ÿæ¢³ç†äº†å„ç§å·¥å…·çš„ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/495277fb4b902fa0d2bbfaf0154654c8-20230731161933-qc0ms7x.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_6-åŸºå‡†æµ‹è¯•å·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-åŸºå‡†æµ‹è¯•å·¥å…·"}},[s._v("#")]),s._v(" 6.åŸºå‡†æµ‹è¯•å·¥å…·")]),s._v(" "),a("p",[s._v("é™¤äº†æ€§èƒ½åˆ†æå¤–, å¾ˆå¤šæ—¶å€™è¿˜éœ€è¦"),a("strong",[s._v("å¯¹ç³»ç»Ÿæ€§èƒ½è¿›è¡ŒåŸºå‡†æµ‹è¯•")]),s._v(". æ¯”å¦‚,")]),s._v(" "),a("ul",[a("li",[s._v("åœ¨æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O æ¨¡å—ä¸­, ä½¿ç”¨ fio å·¥å…·, æµ‹è¯•äº†ç£ç›˜ I/O çš„æ€§èƒ½.")]),s._v(" "),a("li",[s._v("åœ¨ç½‘ç»œæ¨¡å—ä¸­, ä½¿ç”¨ iperf, pktgen ç­‰, æµ‹è¯•äº†ç½‘ç»œçš„æ€§èƒ½.")]),s._v(" "),a("li",[s._v("è€Œåœ¨å¾ˆå¤šåŸºäº Nginx çš„æ¡ˆä¾‹ä¸­, åˆ™ä½¿ç”¨ ab, wrk ç­‰, æµ‹è¯• Nginx åº”ç”¨çš„æ€§èƒ½.")])]),s._v(" "),a("p",[s._v("é™¤äº†ä¸“æ é‡Œä»‹ç»è¿‡çš„è¿™äº›å·¥å…·å¤–, å¯¹äº Linux çš„å„ä¸ªå­ç³»ç»Ÿæ¥è¯´, è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„åŸºå‡†æµ‹è¯•å·¥å…·å¯èƒ½ä¼šç”¨åˆ°. ä¸‹é¢è¿™å¼ å›¾æ˜¯ Brendan Gregg æ•´ç†çš„ Linux åŸºå‡†æµ‹è¯•å·¥å…·å›¾è°±.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/47f44dc6603fb74b3e7ccc48291c870c-20230731161933-qmdtit2.png",alt:""}})]),s._v(" "),a("h5",{attrs:{id:"_7-å°ç»“-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-å°ç»“-3"}},[s._v("#")]),s._v(" 7.å°ç»“")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚æ¢³ç†äº†å¸¸è§çš„æ€§èƒ½å·¥å…·, å¹¶ä» CPU, å†…å­˜, æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ I/O, ç½‘ç»œä»¥åŠåŸºå‡†æµ‹è¯•ç­‰ä¸åŒçš„è§’åº¦, æ±‡æ€»äº†å„ç±»æ€§èƒ½æŒ‡æ ‡æ‰€å¯¹åº”çš„æ€§èƒ½å·¥å…·é€ŸæŸ¥è¡¨.")]),s._v(" "),a("p",[s._v("å½“åˆ†ææ€§èƒ½é—®é¢˜æ—¶, å¤§çš„æ¥è¯´, ä¸»è¦æœ‰è¿™ä¹ˆä¸¤ä¸ªæ­¥éª¤:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ç¬¬ä¸€æ­¥, ä»æ€§èƒ½ç“¶é¢ˆå‡ºå‘, æ ¹æ®ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„è¿è¡ŒåŸç†, ç¡®è®¤å¾…åˆ†æçš„æ€§èƒ½æŒ‡æ ‡")]),s._v(".")]),s._v(" "),a("li",[a("strong",[s._v("ç¬¬äºŒæ­¥, æ ¹æ®è¿™äº›å›¾è¡¨, é€‰å‡ºæœ€åˆé€‚çš„æ€§èƒ½å·¥å…·, ç„¶åäº†è§£å¹¶ä½¿ç”¨å·¥å…·, ä»è€Œæ›´å¿«è§‚æµ‹åˆ°éœ€è¦çš„æ€§èƒ½æ•°æ®")]),s._v(".")])]),s._v(" "),a("p",[s._v("è™½ç„¶ Linux çš„æ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½å·¥å…·éƒ½æ¯”è¾ƒå¤š, ä½†ç†Ÿæ‚‰äº†å„æŒ‡æ ‡å«ä¹‰å, è‡ªç„¶å°±ä¼šå‘ç°è¿™äº›å·¥å…·åŒæ€§èƒ½æŒ‡æ ‡é—´çš„å…³è”. é¡ºç€è¿™ä¸ªæ€è·¯å¾€ä¸‹èµ°, æŒæ¡è¿™äº›å·¥å…·çš„é€‰ç”¨å…¶å®å¹¶ä¸éš¾.")]),s._v(" "),a("p",[s._v("å½“ç„¶, æ­£å¦‚å’±ä»¬ä¸“æ ä¸€ç›´å¼ºè°ƒçš„, ä¸è¦æŠŠæ€§èƒ½å·¥å…·å½“æˆæ€§èƒ½åˆ†æå’Œä¼˜åŒ–çš„å…¨éƒ¨.")]),s._v(" "),a("ul",[a("li",[s._v("ä¸€æ–¹é¢, æ€§èƒ½åˆ†æå’Œä¼˜åŒ–çš„æ ¸å¿ƒ, æ˜¯å¯¹ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºè¿è¡ŒåŸç†çš„æŒæ¡, è€Œæ€§èƒ½å·¥å…·åªæ˜¯è¾…åŠ©ä½ æ›´å¿«å®Œæˆè¿™ä¸ªè¿‡ç¨‹çš„å¸®æ‰‹.")]),s._v(" "),a("li",[s._v("å¦ä¸€æ–¹é¢, å®Œå–„çš„ç›‘æ§ç³»ç»Ÿ, å¯ä»¥æä¾›ç»å¤§éƒ¨åˆ†æ€§èƒ½åˆ†ææ‰€éœ€çš„åŸºå‡†æ•°æ®. ä»è¿™äº›æ•°æ®ä¸­, å¾ˆå¯èƒ½å°±èƒ½å¤§è‡´å®šä½å‡ºæ€§èƒ½ç“¶é¢ˆ, ä¹Ÿå°±ä¸ç”¨å†å»æ‰‹åŠ¨æ‰§è¡Œå„ç±»å·¥å…·äº†.")])]),s._v(" "),a("p",[s._v("â€")]),s._v(" "),a("p",[s._v("â€")]),s._v(" "),a("p",[s._v("â€")]),s._v(" "),a("p",[s._v("â€")])])}),[],!1,null,null,null);a.default=e.exports}}]);