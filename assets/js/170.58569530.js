(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{478:function(e,s,r){"use strict";r.r(s);var a=r(7),t=Object(a.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"_110-zookeeper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_110-zookeeper"}},[e._v("#")]),e._v(" 110.Zookeeper")]),e._v(" "),s("h3",{attrs:{id:"ä¸€-zookeeperåŸºç¡€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€-zookeeperåŸºç¡€"}},[e._v("#")]),e._v(" ä¸€.ZookeeperåŸºç¡€")]),e._v(" "),s("h4",{attrs:{id:"åŸºç¡€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€"}},[e._v("#")]),e._v(" åŸºç¡€")]),e._v(" "),s("p",[e._v("é¡¹ç›®ä»å•ä½“åˆ°"),s("strong",[e._v("åˆ†å¸ƒå¼")]),e._v("è½¬å˜ä¹‹å, ä¼šäº§ç”Ÿ"),s("strong",[e._v("å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ååŒ")]),e._v("çš„é—®é¢˜. å¦‚: æ¯å¤©çš„å®šæ—¶ä»»åŠ¡ç”±è°å“ªä¸ªèŠ‚ç‚¹æ¥æ‰§è¡Œ? RPC è°ƒç”¨æ—¶çš„"),s("strong",[e._v("æœåŠ¡å‘ç°")]),e._v("? å¦‚ä½•ä¿è¯å¹¶å‘è¯·æ±‚çš„"),s("strong",[e._v("å¹‚ç­‰")]),e._v("? è¿™äº›å¯ä»¥ç»Ÿä¸€å½’çº³ä¸º"),s("strong",[e._v("å¤šèŠ‚ç‚¹åè°ƒé—®é¢˜")]),e._v(", å¦‚æœé èŠ‚ç‚¹è‡ªèº«è¿›è¡Œåè°ƒæ˜¯ä¸å¯é çš„, æ€§èƒ½ä¸Šä¹Ÿä¸å¯å–. åº”è¯¥ç”±ä¸€ä¸ª"),s("mark",[s("strong",[e._v("ç‹¬ç«‹çš„æœåŠ¡åšåè°ƒå·¥ä½œ")])]),e._v(", å®ƒå¿…é¡»å¯é , è€Œä¸”ä¿è¯æ€§èƒ½.")]),e._v(" "),s("p",[e._v("ZK æ˜¯ç”¨äºåˆ†å¸ƒå¼åº”ç”¨çš„åè°ƒæœåŠ¡. "),s("strong",[e._v("åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ ZK çš„ API ç”¨äºåŒæ­¥, èŠ‚ç‚¹çŠ¶æ€, é…ç½®ç­‰ä¿¡æ¯, æœåŠ¡æ³¨å†Œç­‰ä¿¡æ¯")]),e._v(". å…¶è®¾è®¡ç›®æ ‡æ˜¯å°†å¤æ‚ä¸”å®¹æ˜“å‡ºé”™çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡å°è£…èµ·æ¥, æ„æˆä¸€ä¸ªé«˜æ•ˆå¯é çš„åŸè¯­é›†, å¹¶ä»¥ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„æ¥å£æä¾›ç»™ç”¨æˆ·ä½¿ç”¨.")]),e._v(" "),s("p",[e._v("ZK è™½ç„¶æ˜¯ä¸ªå¤§ç®¡å®¶, ä½†æ˜¯å®ƒä¸ä¼šç›´æ¥å‘å·æ–½ä»¤, è€Œæ˜¯"),s("mark",[s("strong",[e._v("åªæ˜¯å¯¹å„ä¸ªå®¢æˆ·çš„è¡Œä¸ºåšè®°å½•")])]),e._v(", ä¸ç„¶ ZK å°±æˆäº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„ç»“ç‚¹, å…¶å¯é æ€§ä¾ç„¶æœ‰é—®é¢˜.")]),e._v(" "),s("p",[s("strong",[e._v("ZK æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼")]),e._v("â€‹"),s("mark",[s("strong",[e._v("æ•°æ®ä¸€è‡´æ€§")])]),e._v("â€‹**è§£å†³æ–¹æ¡ˆ, åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åŸºäº ZK å®ç°è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…, è´Ÿè½½å‡è¡¡, å‘½åæœåŠ¡, åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥, é›†ç¾¤ç®¡ç†, Master é€‰ä¸¾, åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½. ** å…¶ä¸€è‡´æ€§æ˜¯é€šè¿‡åŸºäº "),s("strong",[e._v("Paxos")]),e._v(" ç®—æ³•çš„ "),s("strong",[e._v("ZAB åè®®")]),e._v("å®Œæˆçš„.")]),e._v(" "),s("p",[e._v("ZK ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¹Ÿæ»¡è¶³ CAP å®šç†, å…¶å®ç°ä¿è¯äº† "),s("mark",[s("strong",[e._v("CP")])]),e._v("(æ•°æ®ä¸€è‡´æ€§ä¸åˆ†åŒºå®¹é”™æ€§).")]),e._v(" "),s("h4",{attrs:{id:"éƒ¨ç½²ä¸å¸¸è§„é…ç½®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²ä¸å¸¸è§„é…ç½®"}},[e._v("#")]),e._v(" éƒ¨ç½²ä¸å¸¸è§„é…ç½®")]),e._v(" "),s("h5",{attrs:{id:"_1-å®‰è£…ä¸è¿è¡Œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å®‰è£…ä¸è¿è¡Œ"}},[e._v("#")]),e._v(" 1.å®‰è£…ä¸è¿è¡Œ")]),e._v(" "),s("p",[e._v("ZooKeeper åŸºäº Java å¼€å‘, è¿è¡Œä¾èµ– JVM ç¯å¢ƒ. "),s("strong",[e._v("é»˜è®¤ç«¯å£å·æ˜¯ 2181")]),e._v(".")]),e._v(" "),s("p",[e._v("ä¸‹è½½åœ°å€: "),s("a",{attrs:{href:"https://zookeeper.apache.org/releases.html#download",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://zookeeper.apache.org/releases.html#download"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("å…·ä½“éƒ¨ç½²æµç¨‹:")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ä¸‹è½½")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/current/apache-zookeeper-3.5.5-bin.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# è§£å‹")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-zxvf")]),e._v(" apache-zookeeper-3.5.5-bin.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# æ‹·è´é»˜è®¤é…ç½®")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("zookeeper_home"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("/conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" zoo_sample.cfg zoo.cfg\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# å¯åŠ¨")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("zookeeper_home"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("/bin/zkServer.sh\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("Zookeeper æœ‰"),s("strong",[e._v("é›†ç¾¤æ¨¡å¼")]),e._v("å’Œ"),s("strong",[e._v("å•æœºæ¨¡å¼")]),e._v("ç­‰ä¸¤ç§è¿è¡Œæ¨¡å¼, å•æœºæ¨¡å¼ä¸è¿‡å¤šä»‹ç».")]),e._v(" "),s("h5",{attrs:{id:"_2-é›†ç¾¤æ¨¡å¼ä¸é…ç½®æ–‡ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-é›†ç¾¤æ¨¡å¼ä¸é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 2.é›†ç¾¤æ¨¡å¼ä¸é…ç½®æ–‡ä»¶")]),e._v(" "),s("p",[e._v("é›†ç¾¤æ¨¡å¼ä¸‹ä¸€ä¸ªç®€å•çš„ zoo.cfg "),s("strong",[e._v("é…ç½®æ–‡ä»¶")]),e._v(".")]),e._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ZKä¸­çš„æ—¶é—´é…ç½®æœ€å°å•ä½(åŸºæœ¬å•ä½), å…¶ä»–æ—¶é—´é…ç½®ä»¥æ•´æ•°å€tickTimeè®¡ç®—, è¿™é‡Œæ˜¯2ç§’")]),e._v("\ntickTime=2000\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Leaderå…è®¸Followerå¯åŠ¨æ—¶åœ¨initLimitæ—¶é—´å†…å®Œæˆæ•°æ®åŒæ­¥, å®ƒè¡¨ç¤ºtickTimeæ—¶é—´å€æ•° å³:initLimit*tickTime, è¿™é‡Œæ˜¯20ç§’")]),e._v("\ninitLimit=10\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Leaderå‘é€å¿ƒè·³åŒ…ç»™é›†ç¾¤ä¸­æ‰€æœ‰Follower, è‹¥Followeråœ¨syncLimitæ—¶é—´å†…æ²¡æœ‰å“åº”, é‚£ä¹ˆLeaderå°±è®¤ä¸ºè¯¥Followerå·²ç»æŒ‚æ‰äº†, å³: syncLimit*tickTime, è¿™é‡Œä¸º10ç§’")]),e._v("\nsyncLimit=5\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# æ•°æ®å­˜å‚¨ç›®å½•")]),e._v("\ndataDir=/usr/local/zookeeper/data\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# å¯¹å®¢æˆ·ç«¯æä¾›çš„ç«¯å£å·")]),e._v("\nclientPort=2181\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# é…ç½®ZKçš„æ—¥å¿—ç›®å½•")]),e._v("\ndataLogDir=/usr/local/zookeeper/logs\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# å•ä¸ªå®¢æˆ·ç«¯ä¸Zookeeperæœ€å¤§å¹¶å‘è¿æ¥æ•°")]),e._v("\nmaxClientCnxns=60\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ä¿å­˜çš„æ•°æ®å¿«ç…§æ•°é‡, ä¹‹å¤–çš„å°†ä¼šè¢«æ¸…é™¤")]),e._v("\nautopurge.snapRetainCount=3\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# è‡ªåŠ¨è§¦å‘æ¸…é™¤ä»»åŠ¡æ—¶é—´é—´éš”, å°æ—¶ä¸ºå•ä½. é»˜è®¤ä¸º0, è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…é™¤. ")]),e._v("\nautopurge.purgeInterval=1\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ZKé›†ç¾¤èŠ‚ç‚¹é…ç½®, ç«¯å£å·2888ç”¨äºé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´æ•°æ®é€šä¿¡, ç«¯å£å·3888ç”¨äºé›†ç¾¤ä¸­Leaderé€‰ä¸¾")]),e._v("\nserver.1=192.168.123.100"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3888")]),e._v("\nserver.2=192.168.123.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3888")]),e._v("\nserver.3=192.168.123.102"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3888")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br")])]),s("p",[e._v("é›†ç¾¤æ¨¡å¼ä¸‹çš„å¤šä¸ªæœåŠ¡å™¨é…ç½®ä¸º:")]),e._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[e._v("server.id=host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("port\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("æ³¨æ„: å…¶ä¸­ id ç§°ä¸º "),s("strong",[e._v("Server ID")]),e._v(", æ ‡è¯†è¯¥æœºå™¨åœ¨é›†ç¾¤ä¸­çš„"),s("strong",[e._v("æœºå™¨åºå·")]),e._v("; åŒæ—¶éœ€è¦åœ¨æ•°æ®ç›®å½•(å³ dataDir å‚æ•°æŒ‡å®šçš„ç›®å½•)ä¸‹åˆ›å»ºä¸€ä¸ª "),s("mark",[s("strong",[e._v("myid")])]),e._v(" æ–‡ä»¶, è¯¥æ–‡ä»¶ä»…æœ‰"),s("strong",[e._v("ä¸€è¡Œå†…å®¹, å¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—")]),e._v(", å³å¯¹åº”äºæ¯å°æœºå™¨çš„ "),s("strong",[e._v("Server ID æ•°å­—")]),e._v(".")]),e._v(" "),s("p",[s("strong",[e._v("æ¯ä¸ªæœåŠ¡å™¨éƒ½éœ€è¦ä¸Šè¿°é…ç½®æ–‡ä»¶å’Œ myid æ–‡ä»¶")]),e._v(".")]),e._v(" "),s("h5",{attrs:{id:"_3-é›†ç¾¤éƒ¨ç½²ç¤ºä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-é›†ç¾¤éƒ¨ç½²ç¤ºä¾‹"}},[e._v("#")]),e._v(" 3.é›†ç¾¤éƒ¨ç½²ç¤ºä¾‹")]),e._v(" "),s("p",[e._v("é…ç½®è¯­æ³•:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("server.<èŠ‚ç‚¹ID>=<ip>:<æ•°æ®åŒæ­¥ç«¯å£>:<é€‰ä¸¾ç«¯å£>\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("**èŠ‚ç‚¹ ID: ** æœåŠ¡ id æ‰‹åŠ¨æŒ‡å®š 1 è‡³ 125 ä¹‹é—´çš„æ•°å­—, å¹¶å†™åˆ°å¯¹åº”æœåŠ¡èŠ‚ç‚¹çš„  "),s("strong",[e._v("{dataDir}/myid")]),e._v(" æ–‡ä»¶ä¸­.")]),e._v(" "),s("li",[s("strong",[e._v("IP åœ°å€: "),s("strong",[e._v("â€‹"),s("strong",[s("strong",[e._v("èŠ‚ç‚¹çš„è¿œç¨‹ IP åœ°å€. å„ç»“ç‚¹çš„ IP åœ°å€å¯ä»¥ç›¸åŒ, ä½†è¿™ç§æ˜¯")])]),e._v("â€‹")]),e._v("ä¼ªé›†ç¾¤")]),e._v(", æ³¨æ„ç”Ÿäº§ç¯å¢ƒä¸èƒ½è¿™ä¹ˆåš, å› ä¸ºä¸€å°æœºå™¨æ— æ³•å®ç°å®¹é”™.")]),e._v(" "),s("li",[s("strong",[e._v("æ•°æ®åŒæ­¥ç«¯å£: "),s("strong",[e._v("â€‹"),s("strong",[s("strong",[e._v("ä¸»ä»")])]),e._v("â€‹")]),e._v("åŒæ­¥æ•°æ®å¤åˆ¶ç«¯å£")]),e._v(", æ³¨æ„ä¼ªé›†ç¾¤æ—¶ç«¯å£å·ä¸èƒ½é‡å¤.")]),e._v(" "),s("li",[s("strong",[e._v("é€‰ä¸¾ç«¯å£: "),s("strong",[e._v("â€‹"),s("strong",[s("strong",[e._v("ä¸»ä»èŠ‚ç‚¹")])]),e._v("â€‹")]),e._v("é€‰ä¸¾ç«¯å£")]),e._v(", æ³¨æ„ä¼ªé›†ç¾¤æ—¶ç«¯å£å·ä¸èƒ½é‡å¤.")])]),e._v(" "),s("p",[s("strong",[e._v("é›†ç¾¤é…ç½®æµç¨‹:")])]),e._v(" "),s("ul",[s("li",[e._v("åˆ†åˆ«åˆ›å»º 3 ä¸ª data ç›®å½•ç”¨äºå­˜å‚¨å„èŠ‚ç‚¹æ•°æ®.")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" data\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" data/1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" data/3\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" data/3\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("ul",[s("li",[e._v("åˆ›å»º myid æ–‡ä»¶, å¹¶åˆ†åˆ«å†™å…¥ id å· 1,2,3.")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" data/1/myid\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" data/3/myid\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" data/2/myid\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("ul",[s("li",[e._v("ç¼–å†™é…ç½®æ–‡ä»¶.")])]),e._v(" "),s("p",[s("strong",[e._v("conf/zoo1.cfg")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2000")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("data/1\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2181")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# é›†ç¾¤é…ç½®")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2887:3887\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2888:3888\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.3")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2889:3889\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[s("strong",[e._v("conf/zoo2.cfg")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2000")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("data/2\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2182")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# é›†ç¾¤é…ç½®")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2887:3887\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2888:3888\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.3")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2889:3889\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[s("strong",[e._v("conf/zoo3.cfg")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2000")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("data/3\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2183")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# é›†ç¾¤é…ç½®")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2887:3887\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2888:3888\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("server.3")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2889:3889\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("ul",[s("li",[e._v("åˆ†åˆ«å¯åŠ¨ç»“ç‚¹, å¯åŠ¨æ—¶åˆ†åˆ«é€‰æ‹©é…ç½®æ–‡ä»¶å¯åŠ¨. å¦‚æœå½“å‰åªæœ‰ä¸€ä¸ªå¯åŠ¨, æ•´ä¸ªé›†ç¾¤æ˜¯ä¸å¯ç”¨çš„, åªæœ‰å¯åŠ¨è¶…è¿‡ä¸€åŠæ‰è¡Œ.")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./bin/zkServer.sh start conf/zoo1.cfg\n./bin/zkServer.sh start conf/zoo2.cfg\n./bin/zkServer.sh start conf/zoo3.cfg\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("ul",[s("li",[e._v("åˆ†åˆ«æŸ¥çœ‹çŠ¶æ€.")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./bin/zkServer.sh status conf/zoo1.cfg\nMode: follower\n./bin/zkServer.sh status conf/zoo2.cfg\nMode: leader\n./bin/zkServer.sh status conf/zoo3.cfg\nMode: follower\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("ul",[s("li",[e._v("åˆ†åˆ«è¿æ¥æŒ‡å®šèŠ‚ç‚¹: zkCli.sh ååŠ å‚æ•°  "),s("strong",[e._v("-server")]),e._v(" è¡¨ç¤ºè¿æ¥æŒ‡å®š IP ä¸ç«¯å£.")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./bin/zkCli.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-server")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2181\n./bin/zkCli.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-server")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2182\n./bin/zkCli.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-server")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:2183\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("ul",[s("li",[e._v("ä»»æ„èŠ‚ç‚¹ä¸­"),s("strong",[e._v("åˆ›å»ºæ•°æ®")]),e._v(", æŸ¥çœ‹å…¶å®ƒèŠ‚ç‚¹å·²ç»åŒæ­¥æˆåŠŸ.")])]),e._v(" "),s("p",[e._v("æ³¨æ„: -server å‚æ•°å"),s("strong",[e._v("åŒæ—¶è¿æ¥å¤šä¸ªæœåŠ¡èŠ‚ç‚¹")]),e._v(", å¹¶ç”¨é€—å·éš”å¼€ 127.0.0.1:2181, 127.0.0.1:2182.")]),e._v(" "),s("p",[e._v("é€šè¿‡ "),s("code",[e._v("./bin/zkServer.sh status <zooé…ç½®æ–‡ä»¶>")]),e._v("â€‹ å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°"),s("strong",[e._v("èŠ‚ç‚¹çŠ¶æ€")]),e._v(".")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./bin/zkServer.sh status conf/zoo1.cfg\nMode: follower\n./bin/zkServer.sh status conf/zoo2.cfg\nMode: leader\n./bin/zkServer.sh status conf/zoo3.cfg\nMode: follower\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("å¯ä»¥å‘ç°ä¸­é—´çš„ "),s("strong",[e._v("2182")]),e._v(" æ˜¯ "),s("strong",[e._v("leader")]),e._v(" çŠ¶æ€.")]),e._v(" "),s("h3",{attrs:{id:"äºŒ-zookeeperæ ¸å¿ƒåŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#äºŒ-zookeeperæ ¸å¿ƒåŸç†"}},[e._v("#")]),e._v(" äºŒ.ZooKeeperæ ¸å¿ƒåŸç†")]),e._v(" "),s("h4",{attrs:{id:"ç³»ç»Ÿæ¨¡å‹ğŸŒŸ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç³»ç»Ÿæ¨¡å‹ğŸŒŸ"}},[e._v("#")]),e._v(" ç³»ç»Ÿæ¨¡å‹ğŸŒŸ")]),e._v(" "),s("h5",{attrs:{id:"_1-æ•°æ®æ¨¡å‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ•°æ®æ¨¡å‹"}},[e._v("#")]),e._v(" 1.æ•°æ®æ¨¡å‹")]),e._v(" "),s("p",[e._v('ZooKeeper çš„è§†å›¾ç»“æ„å’Œ Unix æ–‡ä»¶ç³»ç»Ÿç±»ä¼¼, ä½†æ²¡æœ‰å¼•å…¥æ–‡ä»¶ç³»ç»Ÿä¸­ç›®å½•å’Œæ–‡ä»¶ç­‰ç›¸å…³æ¦‚å¿µ, è€Œæ˜¯ä½¿ç”¨äº†å…¶ç‰¹æœ‰çš„ "'),s("strong",[e._v("æ•°æ®ç»“ç‚¹")]),e._v('" æ¦‚å¿µ, ç§°ä¹‹ä¸º '),s("strong",[e._v("ZNode")]),e._v(".")]),e._v(" "),s("p",[s("strong",[e._v("ZNode")]),e._v(" æ˜¯ ZooKeeper ä¸­æ•°æ®çš„æœ€å°å•å…ƒ, ä¹Ÿç§°ä¸ºç»“ç‚¹. æ¯ä¸ª ZNode ä¸Šéƒ½å¯ä»¥ä¿å­˜æ•°æ®, åŒæ—¶è¿˜å¯ä»¥æŒ‚è½½"),s("strong",[e._v("å­ç»“ç‚¹")]),e._v(", å› æ­¤æ„æˆäº†ä¸€ä¸ªå±‚æ¬¡åŒ–çš„å‘½åç©ºé—´, å½¢æˆ"),s("strong",[e._v("ä¸€é¢—æ ‘")]),e._v(". ä¸è¿‡ ZNode æ²¡æœ‰ç›®å½•çš„æ¦‚å¿µ, ä¸èƒ½æ‰§è¡Œç±»ä¼¼ cd ä¹‹ç±»çš„å‘½ä»¤.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211221223925381.png",alt:""}})]),e._v(" "),s("h6",{attrs:{id:"_1-äº‹åŠ¡id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-äº‹åŠ¡id"}},[e._v("#")]),e._v(" (1)äº‹åŠ¡ID")]),e._v(" "),s("p",[e._v("åœ¨ ZooKeeper ä¸­, äº‹åŠ¡æ˜¯æŒ‡èƒ½å¤Ÿæ”¹å˜ ZooKeeper æœåŠ¡å™¨çŠ¶æ€çš„æ“ä½œ, ä¸€èˆ¬åŒ…æ‹¬æ•°æ®ç»“ç‚¹"),s("strong",[e._v("åˆ›å»ºä¸åˆ é™¤, æ•°æ®ç»“ç‚¹å†…å®¹æ›´æ–°")]),e._v("å’Œ"),s("strong",[e._v("å®¢æˆ·ç«¯ä¼šè¯åˆ›å»ºä¸å¤±æ•ˆ")]),e._v("ç­‰æ“ä½œ. å¯¹äºæ¯ä¸€ä¸ªäº‹åŠ¡è¯·æ±‚, ZooKeeper éƒ½ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ª"),s("strong",[e._v("å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ ID")]),e._v(", ç”¨ "),s("strong",[e._v("ZXID")]),e._v(" æ¥è¡¨ç¤º, é€šå¸¸æ˜¯ä¸€ä¸ª 64 ä½çš„æ•°å­—. æ¯ä¸€ä¸ª ZXID å¯¹åº”ä¸€æ¬¡"),s("strong",[e._v("æ›´æ–°")]),e._v("æ“ä½œ, ä»è¿™äº› ZXID ä¸­å¯ä»¥é—´æ¥åœ°è¯†åˆ«å‡º ZooKeeper å¤„ç†è¿™äº›æ›´æ–°æ“ä½œè¯·æ±‚çš„å…¨å±€é¡ºåº.")]),e._v(" "),s("h5",{attrs:{id:"_2-ç»“ç‚¹znode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç»“ç‚¹znode"}},[e._v("#")]),e._v(" 2.ç»“ç‚¹ZNode")]),e._v(" "),s("h6",{attrs:{id:"_1-ç»“ç‚¹ç±»å‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç»“ç‚¹ç±»å‹"}},[e._v("#")]),e._v(" (1)ç»“ç‚¹ç±»å‹")]),e._v(" "),s("p",[s("strong",[e._v("æ¯ä¸ªæ•°æ®ç»“ç‚¹éƒ½æœ‰å…¶ç”Ÿå‘½å‘¨æœŸ, è¿™å–å†³äºç»“ç‚¹ç±»å‹")]),e._v(". æ•°æ®ç»“ç‚¹å¯ä»¥æŒ‰ç…§ "),s("mark",[s("strong",[e._v("æŒä¹…ä¸å¦, é¡ºåºä¸å¦")])]),e._v(" åˆ†ä¸ºå››å¤§ç±».")]),e._v(" "),s("blockquote",[s("p",[s("mark",[s("strong",[e._v("æŒä¹…ç»“ç‚¹")])])])]),e._v(" "),s("p",[s("strong",[e._v("é»˜è®¤")]),e._v("ç»“ç‚¹ç±»å‹. æŒä¹…ç»“ç‚¹æŒ‡è¯¥æ•°æ®ç»“ç‚¹è¢«åˆ›å»ºå, å°±ä¼š"),s("strong",[e._v("ä¸€ç›´")]),e._v("å­˜åœ¨äº ZooKeeper æœåŠ¡å™¨ä¸Š, ç›´åˆ°æœ‰åˆ é™¤æ“ä½œæ¥ä¸»åŠ¨æ¸…é™¤è¿™ä¸ªç»“ç‚¹.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# é»˜è®¤åˆ›å»ºæŒä¹…ç»“ç‚¹")]),e._v("\ncreate /test "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"test"')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("blockquote",[s("p",[s("mark",[s("strong",[e._v("æŒä¹…é¡ºåºç»“ç‚¹")])])])]),e._v(" "),s("p",[e._v("æŒä¹…é¡ºåºç»“ç‚¹çš„åŸºæœ¬ç‰¹æ€§å’ŒæŒä¹…ç»“ç‚¹æ˜¯ä¸€è‡´çš„, é¢å¤–çš„ç‰¹æ€§è¡¨ç°åœ¨"),s("strong",[e._v("é¡ºåºæ€§")]),e._v("ä¸Š. åœ¨ Zookeeper ä¸­, æ¯ä¸ªçˆ¶ç»“ç‚¹éƒ½ä¼šä¸ºå®ƒçš„"),s("strong",[e._v("ç¬¬ä¸€çº§å­ç»“ç‚¹")]),e._v("ç»´æŠ¤ä¸€ä»½é¡ºåº, ç”¨äºè®°å½•ä¸‹"),s("strong",[e._v("æ¯ä¸ªå­ç»“ç‚¹åˆ›å»ºçš„å…ˆåé¡ºåº")]),e._v(". åœ¨åˆ›å»ºç»“ç‚¹è¿‡ç¨‹ä¸­, ZooKeeper ä¼šè‡ªåŠ¨ä¸ºç»™å®šç»“ç‚¹å(è·¯å¾„)åŠ ä¸Šä¸€ä¸ª"),s("strong",[e._v("æ•°å­—åç¼€")]),e._v(", ä½œä¸ºä¸€ä¸ªæ–°çš„, å®Œæ•´çš„ç»“ç‚¹å. é€‚åˆç”¨äº"),s("strong",[e._v("åˆ†å¸ƒå¼é€‰ä¸¾")]),e._v("ç­‰åœºæ™¯.")]),e._v(" "),s("p",[e._v("åˆ›å»ºæ—¶æ·»åŠ   "),s("strong",[e._v("-s")]),e._v(" å‚æ•°å³å¯.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# åˆ›å»ºåºå·ç»“ç‚¹")]),e._v("\ncreate "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-s")]),e._v(" /test\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# è¿”å›åˆ›å»ºçš„åŠ äº†åºå·çš„å®é™…è·¯å¾„")]),e._v("\nCreated /test0000000001\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# å†æ¬¡åˆ›å»ºä¸€ä¸ª")]),e._v("\ncreate "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-s")]),e._v(" /test\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# è¿”å›åˆ›å»ºçš„å®é™…è·¯å¾„2, åºå·å·²é€’å¢")]),e._v("\nCreated /test0000000002\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("blockquote",[s("p",[s("mark",[s("strong",[e._v("ä¸´æ—¶ç»“ç‚¹")])])])]),e._v(" "),s("p",[s("mark",[s("strong",[e._v("ä¸´æ—¶ç»“ç‚¹çš„ç”Ÿå‘½å‘¨æœŸå’Œå®¢æˆ·ç«¯ä¼šè¯ç»‘å®š, å¦‚æœå®¢æˆ·ç«¯ä¼šè¯å¤±æ•ˆæ–­å¼€è¿æ¥, é‚£ä¹ˆè¿™ä¸ªç»“ç‚¹å°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤å¹¶æ¸…ç†æ‰")])]),e._v(". æ³¨æ„, è¿™é‡ŒæŒ‡çš„æ˜¯å®¢æˆ·ç«¯ä¼šè¯å¤±æ•ˆ, è€Œé TCP è¿æ¥æ–­å¼€. å®ƒå¯ä»¥ç”¨äºåˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦è¿˜åœ¨è¿æ¥, å¦‚æœå·²ç»æ–­å¼€è¿æ¥, é‚£ä¹ˆç»“ç‚¹å°±ä¸åœ¨äº†. "),s("mark",[s("strong",[e._v("ä¸´æ—¶ç»“ç‚¹ä¸‹é¢ä¸èƒ½åŒ…å«å­ç»“ç‚¹")])]),e._v(", æ‰€ä»¥ä¸´æ—¶ç»“ç‚¹"),s("strong",[e._v("åªèƒ½åšå¶å­ç»“ç‚¹")]),e._v(". é€‚ç”¨äº"),s("strong",[e._v("å¿ƒè·³, æœåŠ¡å‘ç°ç­‰åœºæ™¯")]),e._v(".")]),e._v(" "),s("p",[e._v("åˆ›å»ºæ—¶æ·»åŠ å‚æ•°  "),s("strong",[e._v("-e")]),e._v(" å³å¯.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# åˆ›å»ºä¸´æ—¶ç»“ç‚¹, ä¼šè¯ç«¯å£è‡ªåŠ¨åˆ é™¤")]),e._v("\ncreate "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-e")]),e._v(" /temp "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"test"')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("blockquote",[s("p",[s("mark",[s("strong",[e._v("ä¸´æ—¶é¡ºåºç»“ç‚¹")])])])]),e._v(" "),s("p",[e._v("åŸºæœ¬ç‰¹æ€§å’Œä¸´æ—¶ç»“ç‚¹ä¹Ÿæ˜¯ä¸€è‡´çš„, åŒæ ·æ˜¯åœ¨ä¸´æ—¶ç»“ç‚¹çš„åŸºç¡€ä¸Šå¢åŠ äº†é¡ºåºçš„ç‰¹æ€§.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-e")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-s")]),e._v(" /temp/seq\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h6",{attrs:{id:"_2-ç»“ç‚¹æ•°æ®ä¸çŠ¶æ€ä¿¡æ¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç»“ç‚¹æ•°æ®ä¸çŠ¶æ€ä¿¡æ¯"}},[e._v("#")]),e._v(" (2)ç»“ç‚¹æ•°æ®ä¸çŠ¶æ€ä¿¡æ¯")]),e._v(" "),s("p",[e._v("ä¸€ä¸ª znode ç»“ç‚¹åŒ…å«å¦‚ä¸‹ä¿¡æ¯:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("path")]),e._v(": å”¯ä¸€è·¯å¾„. å¢åˆ æ”¹æŸ¥éƒ½æ˜¯åŸºäº PATH.")]),e._v(" "),s("li",[s("strong",[e._v("childNode")]),e._v(": å­ç»“ç‚¹åˆ—è¡¨.")]),e._v(" "),s("li",[s("strong",[e._v("type")]),e._v(": ç»“ç‚¹ç±»å‹.")]),e._v(" "),s("li",[s("strong",[e._v("data")]),e._v(": æ•°æ®å†…å®¹.")]),e._v(" "),s("li",[s("strong",[e._v("stat")]),e._v(": çŠ¶æ€å±æ€§.")])]),e._v(" "),s("p",[e._v("æ¯ä¸ªæ•°æ®ç»“ç‚¹é™¤äº†å­˜å‚¨æ•°æ®å†…å®¹, è¿˜å­˜å‚¨ç»“ç‚¹æœ¬èº«çš„ä¸€äº›"),s("strong",[e._v("çŠ¶æ€ä¿¡æ¯")]),e._v(". "),s("strong",[e._v("get å‘½ä»¤")]),e._v("å¯ä»¥è·å–ç»“ç‚¹ä¿¡æ¯, å¾—åˆ°ç»“æœçš„ç¬¬ä¸€è¡Œæ˜¯å½“å‰æ•°æ®ç»“ç‚¹çš„"),s("strong",[e._v("æ•°æ®å†…å®¹")]),e._v(", ç¬¬äºŒè¡Œå¼€å§‹å°±æ˜¯ç»“ç‚¹çš„"),s("strong",[e._v("çŠ¶æ€ä¿¡æ¯")]),e._v(". å…¸å‹çš„æœ‰:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("czxid")]),e._v(". å³ Created ZXID, è¡¨ç¤ºæ•°æ®ç»“ç‚¹"),s("strong",[e._v("è¢«åˆ›å»ºæ—¶çš„äº‹åŠ¡ ID")]),e._v(".")]),e._v(" "),s("li",[s("strong",[e._v("mzxid")]),e._v(". å³ Modified ZXID, è¡¨ç¤ºæ•°æ®ç»“ç‚¹"),s("strong",[e._v("æœ€åä¸€æ¬¡è¢«æ›´æ–°æ—¶çš„äº‹åŠ¡ ID")]),e._v(".")]),e._v(" "),s("li",[e._v("ctime. ç»“ç‚¹åˆ›å»ºæ—¶é—´.")]),e._v(" "),s("li",[e._v("mtime. ç»“ç‚¹æœ€åä¸€æ¬¡è¢«æ›´æ–°æ—¶é—´.")]),e._v(" "),s("li",[s("strong",[e._v("version")]),e._v(". æ•°æ®ç»“ç‚¹çš„ç‰ˆæœ¬å·.")]),e._v(" "),s("li",[s("strong",[e._v("cversion")]),e._v(". å­ç»“ç‚¹çš„ç‰ˆæœ¬å·.")]),e._v(" "),s("li",[s("strong",[e._v("aversion")]),e._v(". ç»“ç‚¹çš„ ACL ç‰ˆæœ¬å·(æƒé™ç‰ˆæœ¬å˜æ›´æ¬¡æ•°).")]),e._v(" "),s("li",[e._v("ephemeralOwner. åˆ›å»ºè¯¥ä¸´æ—¶ç»“ç‚¹çš„ä¼šè¯çš„ sessionID, å¦‚æœä¸ºæŒä¹…ç»“ç‚¹åˆ™æ­¤å±æ€§ä¸º 0.")]),e._v(" "),s("li",[e._v("numChildren. å­ç»“ç‚¹ä¸ªæ•°.")]),e._v(" "),s("li",[s("strong",[e._v("pzxid")]),e._v(". è¡¨ç¤ºè¯¥ç»“ç‚¹å­ç»“ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡ ID. åªæœ‰å­ç»“ç‚¹åˆ—è¡¨å˜æ›´ä¼šä¿®æ”¹ pzxid, å­ç»“ç‚¹å†…å®¹å˜åŒ–ä¸ä¼šå½±å“ pzxid.")])]),e._v(" "),s("p",[e._v("ä¾‹å­:")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("cZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" 0x385\nctime "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" Tue Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("24")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("17")]),e._v(":26:28 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("\nmZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" 0x385 \nmtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" Tue Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("24")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("17")]),e._v(":26:28 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2019")]),e._v("\npZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" 0x385\ncversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\ndataVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\naclVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\nephemeralOwner "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" 0x0\ndataLength "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("17")]),e._v("\nnumChildren "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("h5",{attrs:{id:"_3-ç»“ç‚¹ç‰ˆæœ¬-ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç»“ç‚¹ç‰ˆæœ¬-ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œ"}},[e._v("#")]),e._v(" 3.ç»“ç‚¹ç‰ˆæœ¬(ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œ)")]),e._v(" "),s("p",[e._v("æ¯ä¸ªæ•°æ®ç»“ç‚¹éƒ½æœ‰"),s("strong",[e._v("ä¸‰ç§ç±»å‹çš„ç‰ˆæœ¬ä¿¡æ¯")]),e._v(".")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("version")]),e._v(". æ•°æ®ç»“ç‚¹"),s("strong",[e._v("æ•°æ®å†…å®¹çš„ç‰ˆæœ¬å·")]),e._v(".")]),e._v(" "),s("li",[s("strong",[e._v("cversion")]),e._v(". å­ç»“ç‚¹çš„ç‰ˆæœ¬å·.")]),e._v(" "),s("li",[s("strong",[e._v("aversion")]),e._v(". å½“å‰ç»“ç‚¹çš„ ACL ç‰ˆæœ¬å·.")])]),e._v(" "),s("p",[e._v('è¿™é‡Œ "'),s("strong",[e._v("ç‰ˆæœ¬å·")]),e._v('" åˆ†åˆ«è¡¨ç¤ºå¯¹ç»“ç‚¹'),s("strong",[e._v("æ•°æ®å†…å®¹, å­ç»“ç‚¹åˆ—è¡¨, ç»“ç‚¹ ACL ä¿¡æ¯")]),e._v("çš„"),s("strong",[e._v("æ›´æ–°æ¬¡æ•°")]),e._v('. æ¯”å¦‚ä¸€ä¸ªæ•°æ®ç»“ç‚¹åˆ›å»ºå, å…¶ version å€¼ä¸º 0, è¡¨ç¤ºçš„å«ä¹‰æ˜¯ "å½“å‰ç»“ç‚¹è‡ªåˆ›å»ºå, è¢«æ›´æ–°è¿‡ 0 æ¬¡". å¦‚æœå¯¹æ•°æ®å†…å®¹è¿›è¡Œäº†æ›´æ–°, version å€¼å°±ä¼šå¢åŠ (åªè¦æ˜¯æ›´æ–°æ“ä½œ, å³ä½¿å†…å®¹ä¸å˜ä¹Ÿä¼šå¢åŠ , å› ä¸ºè¿™é‡Œå¼ºè°ƒçš„æ˜¯å˜æ›´æ¬¡æ•°).')]),e._v(" "),s("p",[e._v('ç‰ˆæœ¬åœ¨å®ç° "ä¹è§‚é”" åœºæ™¯ä¸‹ååˆ†æœ‰ç”¨. ä¹è§‚é”ä¸€èˆ¬åˆ†ä¸º: æ•°æ®è¯»å–, '),s("strong",[e._v("å†™å…¥æ ¡éªŒ")]),e._v('å’Œæ•°æ®å†™å…¥ç­‰æ­¥éª¤. æ¯”å¦‚ JDK çš„ CAS, å¯¹äºå€¼ V, æ¯æ¬¡æ›´æ–°å‰éƒ½ä¼šå¯¹æ¯”å…¶å€¼æ˜¯å¦æ˜¯é¢„æœŸå€¼ A, åªæœ‰ç¬¦åˆé¢„æœŸ, æ‰ä¼šå°† V åŸå­åŒ–ç­‰æ›´æ–°åˆ°æ–°å€¼ B. ZooKeeper ä¸­çš„ version å±æ€§æ­£æ˜¯ç”¨äºå®ç°ä¹è§‚é”æœºåˆ¶ä¸­çš„ "å†™å…¥æ ¡éªŒ" çš„.')]),e._v(" "),s("h5",{attrs:{id:"_4-watcherç›‘å¬-æ•°æ®å˜æ›´é€šçŸ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-watcherç›‘å¬-æ•°æ®å˜æ›´é€šçŸ¥"}},[e._v("#")]),e._v(" 4.Watcherç›‘å¬(æ•°æ®å˜æ›´é€šçŸ¥)")]),e._v(" "),s("h6",{attrs:{id:"_1-æ¦‚è¿°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¦‚è¿°"}},[e._v("#")]),e._v(" (1)æ¦‚è¿°")]),e._v(" "),s("p",[s("strong",[e._v("ZK é€šè¿‡ Watcher æœºåˆ¶æ¥å®ç°åˆ†å¸ƒå¼é€šçŸ¥åŠŸèƒ½")]),e._v(". ZK å…è®¸å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯"),s("strong",[e._v("æ³¨å†Œä¸€ä¸ª Watcher ç›‘å¬")]),e._v(", å½“æœåŠ¡ç«¯çš„ç‰¹å®šäº‹ä»¶è§¦å‘äº†è¿™ä¸ª Watcher, å°±ä¼šå‘"),s("strong",[e._v("æŒ‡å®šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªäº‹ä»¶é€šçŸ¥")]),e._v("æ¥å®ç°åˆ†å¸ƒå¼é€šçŸ¥åŠŸèƒ½. æ•´ä¸ª Watcher æ³¨å†Œä¸é€šçŸ¥è¿‡ç¨‹å¦‚ä¸‹å›¾.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211225163152279.png",alt:""}})]),e._v(" "),s("p",[e._v("å®¢æˆ·ç«¯åœ¨å‘ ZK æ³¨å†Œ Watcher çš„åŒæ—¶ä¹Ÿä¼šå°† Watcher å¯¹è±¡å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ "),s("strong",[e._v("WatcherManager")]),e._v(" ä¸­, å½“ ZooKeeper æœåŠ¡å™¨è§¦å‘ Watcher äº‹ä»¶å, ä¼šå‘å®¢æˆ·ç«¯å‘å‡ºé€šçŸ¥, å®¢æˆ·ç«¯çº¿ç¨‹ä» WatcherManager å–å‡ºå¯¹åº”çš„ Watcher å¯¹è±¡"),s("strong",[e._v("æ‰§è¡Œå›è°ƒé€»è¾‘")]),e._v("(æ‰§è¡Œ process() æ–¹æ³•).")]),e._v(" "),s("p",[s("strong",[e._v("å®¢æˆ·ç«¯")]),e._v("ä¼šè®°å½• "),s("strong",[e._v("Watcher ä¸æ•°æ®ç»“ç‚¹è·¯å¾„çš„æ˜ å°„å…³ç³»")]),e._v(". Watcher æ³¨å†Œå®Œæˆå, ä¼šè¢«ä¿å­˜åˆ° ZKWatcherManager å¯¹è±¡çš„ dataWatches å±æ€§ä¸­, å…¶æ•°æ®ç»“æ„ä¸º "),s("code",[e._v("Map<String, Set<Watcher>>")]),e._v("â€‹, ç”¨äºå°†æ•°æ®ç»“ç‚¹çš„è·¯å¾„å’Œ Watcher è¿›è¡Œæ˜ å°„åç®¡ç†èµ·æ¥.")]),e._v(" "),s("h6",{attrs:{id:"_2-watcherç‰¹æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-watcherç‰¹æ€§"}},[e._v("#")]),e._v(" (2)Watcherç‰¹æ€§")]),e._v(" "),s("blockquote",[s("p",[e._v("1.ä¸€æ¬¡æ€§")])]),e._v(" "),s("p",[e._v("æ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯, "),s("mark",[s("strong",[e._v("ä¸€æ—¦ä¸€ä¸ª Watcher è¢«è§¦å‘, Zookeeper éƒ½ä¼šå°†å…¶ä»ç›¸åº”çš„å­˜å‚¨ä¸­ç§»é™¤")])]),e._v(". å› æ­¤ä½¿ç”¨ Watcher æ—¶éœ€è¦è¿›è¡Œ"),s("mark",[s("strong",[e._v("åå¤æ³¨å†Œ")])]),e._v(". ä½¿ç”¨åç«‹å³å¤±æ•ˆå¯ä»¥å‡å°æœåŠ¡ç«¯å‹åŠ›, ä¸ç„¶éœ€è¦é€šçŸ¥çš„ç»“ç‚¹å¯èƒ½å¾ˆå¤š.")]),e._v(" "),s("blockquote",[s("p",[e._v("2.å®¢æˆ·ç«¯ä¸²è¡Œæ‰§è¡Œ")])]),e._v(" "),s("p",[e._v("å®¢æˆ·ç«¯ Watcher å›è°ƒæ˜¯ä¸€ä¸ª"),s("strong",[e._v("ä¸²è¡ŒåŒæ­¥")]),e._v("çš„è¿‡ç¨‹. è¿™ä¿è¯äº†é¡ºåº.")]),e._v(" "),s("blockquote",[s("p",[e._v("3.è½»é‡æ€§")])]),e._v(" "),s("p",[e._v("å½“æœåŠ¡ç«¯å‘ç”Ÿäº†äº‹ä»¶å, ä¼šé€šè¿‡ Watcher æœºåˆ¶ä»¥ "),s("strong",[e._v("WatchedEvent æ¶ˆæ¯")]),e._v("çš„æ–¹å¼å‘ŠçŸ¥å®¢æˆ·ç«¯å‘é€äº†äº‹ä»¶. WatchedEvent ä»…åŒ…å«äº†"),s("strong",[e._v("é€šçŸ¥çŠ¶æ€, äº‹ä»¶ç±»å‹å’Œç»“ç‚¹è·¯å¾„")]),e._v("ç­‰ä¸‰éƒ¨åˆ†å†…å®¹, "),s("mark",[s("strong",[e._v("ä¸åŒ…å«äº‹ä»¶çš„å…·ä½“å†…å®¹")])]),e._v(". ä¾‹å¦‚æŸä¸ªç»“ç‚¹çš„å­ç»“ç‚¹åˆ—è¡¨å‘ç”Ÿäº†å˜æ›´, ZooKeeper ä¼šé€šè¿‡ Watcher å‘ŠçŸ¥å®¢æˆ·ç«¯æ­¤äº‹, ä½†å®¢æˆ·ç«¯æ— æ³•ä»äº‹ä»¶ä¸­å¾—åˆ°æ•°æ®ç»“ç‚¹çš„åŸå§‹æ•°æ®å’Œå˜æ›´åçš„å­ç»“ç‚¹æ•°æ®, "),s("strong",[e._v("å®¢æˆ·ç«¯éœ€è¦")]),e._v("â€‹"),s("mark",[s("strong",[e._v("ä¸»åŠ¨")])]),e._v("â€‹"),s("strong",[e._v("é‡æ–°å»è·å–æ•°æ®")]),e._v(".")]),e._v(" "),s("h5",{attrs:{id:"_5-acl-æƒé™æ§åˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-acl-æƒé™æ§åˆ¶"}},[e._v("#")]),e._v(" 5.ACL(æƒé™æ§åˆ¶)")]),e._v(" "),s("p",[e._v("ZK é€šè¿‡ "),s("strong",[e._v("ACL(Access Control List) æƒé™æ§åˆ¶æœºåˆ¶")]),e._v("æ¥"),s("strong",[e._v("ä¿è¯æ•°æ®å®‰å…¨")]),e._v(". ACL å³"),s("strong",[e._v("è®¿é—®æ§åˆ¶åˆ—è¡¨")]),e._v(", å¯ä»¥é’ˆå¯¹ä»»æ„ç”¨æˆ·å’Œç»„è¿›è¡Œç»†ç²’åº¦çš„æƒé™æ§åˆ¶.")]),e._v(" "),s("p",[e._v('ACL åŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹, åˆ†åˆ«æ˜¯æƒé™æ¨¡å¼(Scheme), æˆæƒå¯¹è±¡(ID)ä¸æƒé™(Permission), é€šå¸¸é‡‡ç”¨ "'),s("code",[e._v("scheme : id : permission")]),e._v('â€‹" æ¥æ ‡è¯†ä¸€ä¸ª ACL ä¿¡æ¯.')]),e._v(" "),s("p",[e._v("æƒé™ä»…å¯¹å½“å‰ç»“ç‚¹æœ‰æ•ˆ, ä¸ä¼šè¢«å­ç»“ç‚¹ç»§æ‰¿.")]),e._v(" "),s("blockquote",[s("p",[e._v("æƒé™æ¨¡å¼(Scheme)")])]),e._v(" "),s("p",[e._v("æƒé™æ¨¡å¼ç”¨äºç¡®å®šæƒé™éªŒè¯æ—¶çš„æ£€éªŒç­–ç•¥. å¦‚:")]),e._v(" "),s("ul",[s("li",[e._v("IP: é€šè¿‡ IP åœ°å€è¿›è¡Œæƒé™æ§åˆ¶.")]),e._v(" "),s("li",[e._v('Digest: ç±»ä¼¼äº "username:password" çš„æ–¹å¼è¿›è¡Œæƒé™é…ç½®. '),s("strong",[e._v("ç”¨æˆ·å¯†ç ")]),e._v("è®¤è¯æ¨¡å¼, åªæœ‰åœ¨ä¼šè¯ä¸­æ·»åŠ äº†è®¤è¯æ‰å¯ä»¥é˜²é—®.")]),e._v(" "),s("li",[e._v("World: æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½æ“ä½œæ•°æ®.")]),e._v(" "),s("li",[e._v("Super: è¶…çº§ç”¨æˆ·.")])]),e._v(" "),s("blockquote",[s("p",[e._v("æˆæƒå¯¹è±¡(ID)")])]),e._v(" "),s("p",[e._v("æˆæƒå¯¹è±¡æŒ‡æƒé™èµ‹äºˆçš„ç”¨æˆ·æˆ–ä¸€ä¸ªæŒ‡å®šçš„å®ä½“, ä¾‹å¦‚æ˜¯ IP åœ°å€æˆ–æœºå™¨.")]),e._v(" "),s("blockquote",[s("p",[e._v("æƒé™(Permission)")])]),e._v(" "),s("p",[e._v("æƒé™æŒ‡é€šè¿‡æƒé™æ£€æŸ¥åå¯ä»¥æ‰§è¡Œçš„æ“ä½œ.")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("CREATE")]),e._v(". "),s("strong",[e._v("å­ç»“ç‚¹")]),e._v("åˆ›å»ºæƒé™. å…è®¸æˆæƒå¯¹è±¡åœ¨è¯¥ç»“ç‚¹ä¸‹åˆ›å»ºå­ç»“ç‚¹.")]),e._v(" "),s("li",[s("strong",[e._v("DELETE")]),e._v(". "),s("strong",[e._v("å­ç»“ç‚¹")]),e._v("åˆ é™¤æƒé™. å…è®¸æˆæƒå¯¹è±¡åˆ é™¤è¯¥æ•°æ®ç»“ç‚¹çš„å­ç»“ç‚¹.")]),e._v(" "),s("li",[s("strong",[e._v("READ")]),e._v(". æ•°æ®ç»“ç‚¹çš„è¯»å–æƒé™. å…è®¸æˆæƒå¯¹è±¡è®¿é—®è¯¥æ•°æ®ç»“ç‚¹å¹¶è¯»å–å…¶æ•°æ®å†…å®¹æˆ–å­ç»“ç‚¹åˆ—è¡¨.")]),e._v(" "),s("li",[s("strong",[e._v("WRITE")]),e._v(". æ•°æ®ç»“ç‚¹çš„æ›´æ–°æƒé™. å…è®¸æˆæƒå¯¹è±¡å¯¹è¯¥æ•°æ®ç»“ç‚¹è¿›è¡Œæ›´æ–°æ“ä½œ.")]),e._v(" "),s("li",[s("strong",[e._v("ADMIN")]),e._v(". æ•°æ®ç»“ç‚¹çš„ç®¡ç†æƒé™. å…è®¸æˆæƒå¯¹è±¡å¯¹è¯¥æ•°æ®ç»“ç‚¹è¿›è¡Œ ACL ç›¸å…³çš„è®¾ç½®.")])]),e._v(" "),s("h4",{attrs:{id:"zkå®¢æˆ·ç«¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zkå®¢æˆ·ç«¯"}},[e._v("#")]),e._v(" ZKå®¢æˆ·ç«¯")]),e._v(" "),s("h5",{attrs:{id:"_1-å®¢æˆ·ç«¯å‘½ä»¤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å®¢æˆ·ç«¯å‘½ä»¤"}},[e._v("#")]),e._v(" 1.å®¢æˆ·ç«¯å‘½ä»¤")]),e._v(" "),s("blockquote",[s("p",[e._v("åŸºæœ¬å‘½ä»¤åˆ—è¡¨")])]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("connect host:port")]),e._v(": é‡æ–°è¿æ¥æŒ‡å®š ZooKeeper æœåŠ¡.")]),e._v(" "),s("li",[s("strong",[e._v("create [-s] [-e] [-c] [-t ttl] path [data] [acl]")]),e._v(" : åˆ›å»ºç»“ç‚¹.")]),e._v(" "),s("li",[s("strong",[e._v("delete [-v version] path")]),e._v(": åˆ é™¤ç»“ç‚¹(ä¸èƒ½å­˜åœ¨å­ç»“ç‚¹).")]),e._v(" "),s("li",[s("strong",[e._v("deleteall path")]),e._v(": åˆ é™¤è·¯å¾„åŠæ‰€æœ‰å­ç»“ç‚¹.")]),e._v(" "),s("li",[s("strong",[e._v("setquota -n|-b val path")]),e._v(": è®¾ç½®ç»“ç‚¹é™é¢. -n å­ç»“ç‚¹æ•°, -b å­—èŠ‚æ•°.")]),e._v(" "),s("li",[s("strong",[e._v("listquota path")]),e._v(": æŸ¥çœ‹ç»“ç‚¹é™é¢.")]),e._v(" "),s("li",[s("strong",[e._v("delquota [-n|-b] path")]),e._v(": åˆ é™¤ç»“ç‚¹é™é¢.")]),e._v(" "),s("li",[s("strong",[e._v("get [-s] [-w] path")]),e._v(": æŸ¥çœ‹ç»“ç‚¹æ•°æ®. -s åŒ…å«ç»“ç‚¹çŠ¶æ€, -w æ·»åŠ ç›‘å¬.")]),e._v(" "),s("li",[s("strong",[e._v("ls [-s] [-w] [-R] path")]),e._v(": åˆ—å‡ºå­ç»“ç‚¹. -s çŠ¶æ€, -R é€’å½’æŸ¥çœ‹æ‰€æœ‰å­ç»“ç‚¹, -w æ·»åŠ ç›‘å¬.")]),e._v(" "),s("li",[s("strong",[e._v("setAcl [-s] [-v version] [-R] path acl")]),e._v(": ä¸ºç»“ç‚¹è®¾ç½® ACL æƒé™.")]),e._v(" "),s("li",[s("strong",[e._v("stat [-w] path")]),e._v(": æŸ¥çœ‹ç»“ç‚¹çŠ¶æ€. -w æ·»åŠ ç›‘å¬.")])]),e._v(" "),s("p",[s("strong",[e._v("node æ•°æ®çš„å¢åˆ æ”¹æŸ¥")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# åˆ—å‡ºå­ç»“ç‚¹ ")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" /\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# åˆ›å»ºç»“ç‚¹")]),e._v("\ncreate /student "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"nano"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# æŸ¥çœ‹ç»“ç‚¹")]),e._v("\nget /student\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# åˆ›å»ºå­ç»“ç‚¹ ")]),e._v("\ncreate /student/height "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"32"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# åˆ é™¤ç»“ç‚¹")]),e._v("\ndelete /student/height\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# åˆ é™¤æ‰€æœ‰ç»“ç‚¹åŒ…æ‹¬å­ç»“ç‚¹")]),e._v("\ndeleteall /student\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ä¿®æ”¹ç»“ç‚¹")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" /student "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"woman"')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br")])]),s("h5",{attrs:{id:"_2-javaå®¢æˆ·ç«¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-javaå®¢æˆ·ç«¯"}},[e._v("#")]),e._v(" 2.Javaå®¢æˆ·ç«¯")]),e._v(" "),s("p",[e._v("å¯ä»¥ä½¿ç”¨ Java å®¢æˆ·ç«¯è¿›è¡Œ ZK è®¿é—®ä¸æ“ä½œ. æ¯”å¦‚ ZkClient å’Œ Curator ç­‰.")]),e._v(" "),s("p",[e._v("ZooKeeper æä¾›çš„å®¢æˆ·ç«¯. ä¾èµ–:")]),e._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("org.apache.zookeeper"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("zookeeper"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("3.5.5"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[s("strong",[e._v("åˆå§‹è¿æ¥:")])]),e._v(" "),s("p",[e._v("å¸¸è§„çš„å®¢æˆ·ç«¯ç±»æ˜¯ org.apache.zookeeper."),s("strong",[e._v("ZooKeeper")]),e._v(", å®ä¾‹åŒ–è¯¥ç±»ä¹‹åå°†ä¼š"),s("strong",[e._v("è‡ªåŠ¨ä¸é›†ç¾¤å»ºç«‹è¿æ¥")]),e._v(".")]),e._v(" "),s("p",[s("strong",[e._v("ç›‘å¬ç»“ç‚¹")]),e._v(":")]),e._v(" "),s("p",[e._v("åœ¨ "),s("strong",[e._v("getData()")]),e._v("  ä¸ "),s("strong",[e._v("getChildren()")]),e._v("  ä¸¤ä¸ªæ–¹æ³•ä¸­å¯åˆ†åˆ«è®¾ç½®"),s("strong",[e._v("ç›‘å¬æ•°æ®å˜åŒ–å’Œå­ç»“ç‚¹å˜åŒ–")]),e._v(". é€šè¿‡"),s("strong",[e._v("è®¾ç½® watch ä¸º true")]),e._v(", å½“å‰äº‹ä»¶è§¦å‘æ—¶ä¼šè°ƒç”¨ zookeeper() æ„å»ºå‡½æ•°ä¸­ "),s("strong",[e._v("Watcher.process()")]),e._v("  æ–¹æ³•. ä¹Ÿå¯ä»¥æ·»åŠ  watcher å‚æ•°æ¥å®ç°"),s("strong",[e._v("è‡ªå®šä¹‰ç›‘å¬")]),e._v(". ä¸€èˆ¬é‡‡ç”¨åè€….")]),e._v(" "),s("p",[e._v("æ³¨æ„: æ‰€æœ‰çš„ç›‘å¬éƒ½æ˜¯"),s("strong",[e._v("ä¸€æ¬¡æ€§çš„, å¦‚æœè¦æŒç»­ç›‘å¬éœ€è¦è§¦å‘ååœ¨æ·»åŠ ä¸€æ¬¡ç›‘å¬")]),e._v(".")]),e._v(" "),s("h5",{attrs:{id:"_3-ä¼šè¯session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¼šè¯session"}},[e._v("#")]),e._v(" 3.ä¼šè¯Session")]),e._v(" "),s("p",[e._v("Session æŒ‡ ZK "),s("strong",[e._v("æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯")]),e._v("ä¼šè¯. ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ä¸ª "),s("strong",[e._v("TCP é•¿è¿æ¥")]),e._v(". å®¢æˆ·ç«¯å¯åŠ¨æ—¶, é¦–å…ˆä¼šä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ª TCP è¿æ¥, ä»ç¬¬ä¸€æ¬¡è¿æ¥å»ºç«‹å¼€å§‹, å®¢æˆ·ç«¯ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå¼€å§‹äº†. é€šè¿‡è¿™ä¸ªè¿æ¥, å®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡"),s("strong",[e._v("å¿ƒè·³æ£€æµ‹")]),e._v("ä¸æœåŠ¡å™¨ä¿æŒæœ‰æ•ˆçš„ä¼šè¯, ä¹Ÿèƒ½å¤Ÿå‘æœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶æ¥å—å“åº”, åŒæ—¶è¿˜èƒ½å¤Ÿé€šè¿‡è¯¥"),s("strong",[e._v("è¿æ¥æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„ Watch äº‹ä»¶é€šçŸ¥")]),e._v(".")]),e._v(" "),s("p",[e._v("Session çš„ sessionTimeout å‚æ•°ç”¨æ¥è®¾ç½®ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯çš„"),s("strong",[e._v("è¶…æ—¶æ—¶é—´")]),e._v(". å³ä½¿å› ä¸ºç½‘ç»œæ•…éšœæˆ–æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥ç­‰å„ç§åŸå› å¯¼è‡´å®¢æˆ·ç«¯è¿æ¥æ–­å¼€, åªè¦åœ¨ sessionTimeout æ—¶é—´å†…èƒ½å¤Ÿé‡æ–°è¿æ¥ä¸Šé›†ç¾¤ä¸­ä»»æ„ä¸€å°æœåŠ¡å™¨, é‚£ä¹ˆä¹‹å‰åˆ›å»ºçš„ä¼šè¯ä»ç„¶æœ‰æ•ˆ.")]),e._v(" "),s("p",[e._v("åœ¨ä¸ºå®¢æˆ·ç«¯åˆ›å»ºä¼šè¯ä¹‹å‰, æœåŠ¡ç«¯é¦–å…ˆä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½åˆ†é…ä¸€ä¸ª "),s("strong",[e._v("sessionID")]),e._v(". ç”±äº sessionID æ˜¯ Zookeeper ä¼šè¯çš„ä¸€ä¸ªé‡è¦æ ‡è¯†, è®¸å¤šä¸ä¼šè¯ç›¸å…³çš„è¿è¡Œæœºåˆ¶éƒ½æ˜¯åŸºäºè¿™ä¸ª sessionID çš„, å› æ­¤æ— è®ºæ˜¯å“ªå°æœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ†é…çš„ sessionID, éƒ½åŠ¡å¿…ä¿è¯"),s("strong",[e._v("å…¨å±€å”¯ä¸€")]),e._v(".")]),e._v(" "),s("p",[e._v("ä¼šè¯è¿˜æœ‰å¯¹åº”çš„"),s("strong",[e._v("äº‹ä»¶")]),e._v(", å¦‚ CONNECTION_LOSS(è¿æ¥ä¸¢å¤±äº‹ä»¶), SESSION_MOVED(ä¼šè¯è½¬ç§»äº‹ä»¶), SESSION_EXPIRED(ä¼šè¯è¶…æ—¶å¤±æ•ˆäº‹ä»¶).")]),e._v(" "),s("h5",{attrs:{id:"_4-å®¢æˆ·ç«¯ä¼šè¯åˆ›å»ºè¿‡ç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-å®¢æˆ·ç«¯ä¼šè¯åˆ›å»ºè¿‡ç¨‹"}},[e._v("#")]),e._v(" 4.å®¢æˆ·ç«¯ä¼šè¯åˆ›å»ºè¿‡ç¨‹")]),e._v(" "),s("p",[e._v("Zookeeper å®¢æˆ·ç«¯æ ¸å¿ƒç»„ä»¶å¦‚ä¸‹:")]),e._v(" "),s("ul",[s("li",[e._v("Zookeeper å®ä¾‹. å®¢æˆ·ç«¯çš„å…¥å£.")]),e._v(" "),s("li",[e._v("ClientWatchManage. å®¢æˆ·ç«¯çš„ Watcher ç®¡ç†å™¨.")]),e._v(" "),s("li",[e._v("HostProvider. å®¢æˆ·ç«¯åœ°å€åˆ—è¡¨ç®¡ç†å™¨.")]),e._v(" "),s("li",[s("strong",[e._v("ClientCnxn")]),e._v(". å®¢æˆ·ç«¯æ ¸å¿ƒçº¿ç¨‹, å…¶å†…éƒ¨åŒ…å« SendThread å’Œ EventThread ä¸¤ä¸ªçº¿ç¨‹. SendThread æ˜¯ä¸€ä¸ª IO çº¿ç¨‹, è´Ÿè´£ Zookeeper å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œ IO é€šä¿¡. EventThread æ˜¯ä¸€ä¸ªäº‹ä»¶çº¿ç¨‹, è´Ÿè´£å¯¹æœåŠ¡ç«¯çš„äº‹ä»¶è¿›è¡Œå¤„ç†.")])]),e._v(" "),s("p",[s("strong",[e._v("(1) åˆå§‹åŒ–é˜¶æ®µ")])]),e._v(" "),s("ul",[s("li",[e._v("åˆå§‹åŒ– Zookeeper å¯¹è±¡.")]),e._v(" "),s("li",[e._v("è®¾ç½®ä¼šè¯é»˜è®¤ Watcher.")]),e._v(" "),s("li",[e._v("æ„é€  Zookeeper æœåŠ¡å™¨åœ°å€åˆ—è¡¨ç®¡ç†å™¨ HostProvider.")]),e._v(" "),s("li",[e._v("åˆ›å»ºå¹¶åˆå§‹åŒ–å®¢æˆ·ç«¯ç½‘ç»œè¿æ¥å™¨ ClientCnxn. åˆ›å»º ClientCnxn çš„åŒæ—¶, è¿˜ä¼šåˆ›å»ºå®¢æˆ·ç«¯çš„ä¸¤ä¸ªæ ¸å¿ƒé˜Ÿåˆ—: outgoingQueue(å®¢æˆ·ç«¯è¯·æ±‚å‘é€é˜Ÿåˆ—)å’Œ pendingQueue(æœåŠ¡ç«¯å“åº”ç­‰å¾…é˜Ÿåˆ—).")]),e._v(" "),s("li",[e._v("åˆå§‹åŒ– SendThread å’Œ EventThread.")])]),e._v(" "),s("p",[s("strong",[e._v("(2) ä¼šè¯åˆ›å»ºé˜¶æ®µ")])]),e._v(" "),s("ul",[s("li",[e._v("å¯åŠ¨ SendThread å’Œ EventThread.")]),e._v(" "),s("li",[e._v("è·å–ä¸€ä¸ªæœåŠ¡å™¨åœ°å€.")]),e._v(" "),s("li",[e._v("åˆ›å»º TCP è¿æ¥. ClientCnxnSocket è´Ÿè´£ä¸æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª TCP é•¿è¿æ¥.")]),e._v(" "),s("li",[e._v("æ„é€  ConnectRequest è¯·æ±‚.")]),e._v(" "),s("li",[e._v("å‘é€è¯·æ±‚.")])]),e._v(" "),s("p",[s("strong",[e._v("(3) å“åº”å¤„ç†é˜¶æ®µ")])]),e._v(" "),s("ul",[s("li",[e._v("æ¥æ”¶æœåŠ¡ç«¯å“åº”.")]),e._v(" "),s("li",[e._v("å¤„ç† response.")]),e._v(" "),s("li",[e._v("æŸ¥è¯¢ Watcher.")]),e._v(" "),s("li",[e._v("å¤„ç†äº‹ä»¶. EventThread ä¸æ–­ä» waitingEvents é˜Ÿåˆ—ä¸­å–å‡ºå¾…å¤„ç†çš„ Watcher å¯¹è±¡, ç„¶åç›´æ¥è°ƒç”¨è¯¥å¯¹è±¡çš„ process æ–¹æ³•è¿›è¡Œäº‹ä»¶å›è°ƒ.")])]),e._v(" "),s("h4",{attrs:{id:"åºåˆ—åŒ–ä¸åè®®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åºåˆ—åŒ–ä¸åè®®"}},[e._v("#")]),e._v(" åºåˆ—åŒ–ä¸åè®®")]),e._v(" "),s("p",[e._v("Zookeeper å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼šè¿›è¡Œä¸€äº›åˆ—ç½‘ç»œæ•°æ®ä¼ è¾“, ZooKeeper ä½¿ç”¨ "),s("strong",[e._v("Jute")]),e._v(" åºåˆ—åŒ–ç»„ä»¶å®ç°é€šä¿¡æ•°æ®çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ“ä½œ.")]),e._v(" "),s("p",[e._v("Zookeeper è®¾è®¡äº†åŸºäº TCP/IP åè®®çš„ç‹¬æœ‰çš„"),s("strong",[e._v("åº”ç”¨å±‚é€šä¿¡åè®®")]),e._v(", å®ç°æ•°æ®çš„é«˜æ•ˆä¼ è¾“.")]),e._v(" "),s("h4",{attrs:{id:"æœåŠ¡å™¨å¯åŠ¨æµç¨‹åˆ†æ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡å™¨å¯åŠ¨æµç¨‹åˆ†æ"}},[e._v("#")]),e._v(" æœåŠ¡å™¨å¯åŠ¨æµç¨‹åˆ†æ")]),e._v(" "),s("p",[e._v("Zookeeper æœåŠ¡ç«¯æ•´ä½“æ¶æ„å¦‚ä¸‹:")]),e._v(" "),s("p",[e._v("â€‹"),s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220106231854447.png",alt:""}}),e._v("â€‹")]),e._v(" "),s("p",[e._v("Zookeeper æœåŠ¡å™¨çš„å¯åŠ¨å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªæ­¥éª¤:")]),e._v(" "),s("ol",[s("li",[e._v("é…ç½®æ–‡ä»¶è§£æ.")]),e._v(" "),s("li",[e._v("åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨.")]),e._v(" "),s("li",[e._v("åˆå§‹åŒ–ç½‘ç»œ IO ç®¡ç†å™¨.")]),e._v(" "),s("li",[e._v("æ•°æ®æ¢å¤.")]),e._v(" "),s("li",[e._v("å¯¹å¤–æœåŠ¡.")])]),e._v(" "),s("h5",{attrs:{id:"_1-å•æœºç‰ˆæœåŠ¡å™¨å¯åŠ¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å•æœºç‰ˆæœåŠ¡å™¨å¯åŠ¨"}},[e._v("#")]),e._v(" 1.å•æœºç‰ˆæœåŠ¡å™¨å¯åŠ¨")]),e._v(" "),s("p",[e._v("å•æœºç‰ˆæœåŠ¡å™¨çš„å¯åŠ¨å…¶æµç¨‹å›¾å¦‚ä¸‹.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220106232948829.png",alt:"image-20220106232948829"}})]),e._v(" "),s("p",[e._v("ä¸Šå›¾çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸º"),s("strong",[e._v("é¢„å¯åŠ¨")]),e._v("å’Œ"),s("strong",[e._v("åˆå§‹åŒ–")]),e._v("è¿‡ç¨‹.")]),e._v(" "),s("blockquote",[s("p",[e._v("(1)é¢„å¯åŠ¨")])]),e._v(" "),s("ol",[s("li",[e._v("ç»Ÿä¸€ç”± QuorumPeerMain ä½œä¸º"),s("strong",[e._v("å¯åŠ¨ç±»")]),e._v(". æ— è®ºå•æœºæˆ–é›†ç¾¤, åœ¨ zkServer.cmd å’Œ zkServer.sh ä¸­éƒ½é…ç½®äº† QuorumPeerMain ä½œä¸ºå¯åŠ¨å…¥å£ç±».")]),e._v(" "),s("li",[e._v("è§£æé…ç½®æ–‡ä»¶ zoo.cfg. zoo.cfg é…ç½®è¿è¡Œæ—¶åŸºæœ¬å‚æ•°, å¦‚ tickTime, dataDir, clientPort ç­‰.")]),e._v(" "),s("li",[e._v("åˆ›å»ºå¹¶å¯åŠ¨å†å²æ–‡ä»¶æ¸…ç†å™¨ DatadirCleanupManager. å¯¹äº‹åŠ¡æ—¥å¿—å’Œå¿«ç…§æ•°æ®æ–‡ä»¶è¿›è¡Œå®šæ—¶æ¸…ç†.")]),e._v(" "),s("li",[e._v("åˆ¤æ–­å½“å‰æ˜¯é›†ç¾¤è¿˜æ˜¯å•æœºæ¨¡å¼å¯åŠ¨. è‹¥æ˜¯å•æœºæ¨¡å¼, åˆ™å§”æ‰˜ç»™ ZooKeeperServerMain è¿›è¡Œå¯åŠ¨.")]),e._v(" "),s("li",[e._v("å†æ¬¡è§£æé…ç½®æ–‡ä»¶ zoo.cfg.")]),e._v(" "),s("li",[e._v("åˆ›å»ºæœåŠ¡å™¨å®ä¾‹ ZooKeeperServer. ZooKeeper æœåŠ¡å™¨é¦–å…ˆä¼šè¿›è¡ŒæœåŠ¡å™¨å®ä¾‹çš„åˆ›å»º, ç„¶åå¯¹è¯¥æœåŠ¡å™¨å®ä¾‹è¿›è¡Œåˆå§‹åŒ–, åŒ…æ‹¬è¿æ¥å™¨, å†…å­˜æ•°æ®åº“, è¯·æ±‚å¤„ç†å™¨ç­‰ç»„ä»¶çš„åˆå§‹åŒ–.")])]),e._v(" "),s("blockquote",[s("p",[e._v("(2)åˆå§‹åŒ–")])]),e._v(" "),s("ol",[s("li",[e._v("åˆ›å»ºæœåŠ¡å™¨ç»Ÿè®¡å™¨ ServerStats. ServerStats æ˜¯ Zookeeper æœåŠ¡å™¨è¿è¡Œæ—¶çš„ç»Ÿè®¡å™¨.")]),e._v(" "),s("li",[e._v("åˆ›å»º Zookeeper æ•°æ®ç®¡ç†å™¨ FileTxnSnapLog. FileTxnSnapLog æ˜¯ Zookeeper ä¸Šå±‚æœåŠ¡å™¨å’Œåº•å±‚æ•°æ®å­˜å‚¨ä¹‹é—´çš„å¯¹æ¥å±‚, æä¾›äº†ä¸€ç³»åˆ—æ“ä½œæ•°æ®æ–‡ä»¶çš„æ¥å£, å¦‚äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å’Œå¿«ç…§æ•°æ®æ–‡ä»¶. Zookeeper æ ¹æ® zoo.cfg æ–‡ä»¶ä¸­è§£æå‡ºçš„å¿«ç…§æ•°æ®ç›®å½• dataDir å’Œäº‹åŠ¡æ—¥å¿—ç›®å½• dataLogDir æ¥åˆ›å»º FileTxnSnapLog.")]),e._v(" "),s("li",[e._v("è®¾ç½®æœåŠ¡å™¨ tickTime å’Œä¼šè¯è¶…æ—¶æ—¶é—´é™åˆ¶.")]),e._v(" "),s("li",[e._v("åˆ›å»º ServerCnxnFactory. é€šè¿‡é…ç½®ç³»ç»Ÿå±æ€§ zookeper.serverCnxnFactory æ¥æŒ‡å®šä½¿ç”¨ Zookeeper è‡ªå·±å®ç°çš„ NIO è¿˜æ˜¯ä½¿ç”¨ Netty æ¡†æ¶ä½œä¸º Zookeeper æœåŠ¡ç«¯ç½‘ç»œè¿æ¥å·¥å‚.")]),e._v(" "),s("li",[e._v("åˆå§‹åŒ– ServerCnxnFactory. Zookeeper ä¼šåˆå§‹åŒ– Thread ä½œä¸º ServerCnxnFactory çš„ä¸»çº¿ç¨‹, ç„¶åå†åˆå§‹åŒ– NIO æœåŠ¡å™¨.")]),e._v(" "),s("li",[e._v("å¯åŠ¨ ServerCnxnFactory ä¸»çº¿ç¨‹. è¿›å…¥ Thread çš„ run æ–¹æ³•, æ­¤æ—¶æœåŠ¡ç«¯è¿˜ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚.")]),e._v(" "),s("li",[e._v("æ¢å¤æœ¬åœ°æ•°æ®. å¯åŠ¨æ—¶, éœ€è¦ä»æœ¬åœ°å¿«ç…§æ•°æ®æ–‡ä»¶å’Œäº‹åŠ¡æ—¥å¿—æ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤.")]),e._v(" "),s("li",[e._v("åˆ›å»ºå¹¶å¯åŠ¨ä¼šè¯ç®¡ç†å™¨. Zookeeper ä¼šåˆ›å»ºä¼šè¯ç®¡ç†å™¨ SessionTracker è¿›è¡Œä¼šè¯ç®¡ç†.")]),e._v(" "),s("li",[e._v("åˆå§‹åŒ– Zookeeper çš„è¯·æ±‚å¤„ç†é“¾. Zookeeper è¯·æ±‚å¤„ç†æ–¹å¼ä¸º"),s("strong",[e._v("è´£ä»»é“¾æ¨¡å¼")]),e._v("çš„å®ç°. ä¼šæœ‰å¤šä¸ªè¯·æ±‚å¤„ç†å™¨ä¾æ¬¡å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚, åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶, ä¼šå°†è¿™äº›è¯·æ±‚å¤„ç†å™¨ä¸²è”æˆä¸€ä¸ªè¯·æ±‚å¤„ç†é“¾.")]),e._v(" "),s("li",[e._v("æ³¨å†Œ JMX æœåŠ¡. Zookeeper ä¼šå°†æœåŠ¡å™¨è¿è¡Œæ—¶çš„ä¸€äº›ä¿¡æ¯ä»¥ JMX çš„æ–¹å¼æš´éœ²ç»™å¤–éƒ¨.")]),e._v(" "),s("li",[e._v("æ³¨å†Œ Zookeeper æœåŠ¡å™¨å®ä¾‹. å°† Zookeeper æœåŠ¡å™¨å®ä¾‹æ³¨å†Œç»™ ServerCnxnFactory, ä¹‹å Zookeeper å°±å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡.")])]),e._v(" "),s("p",[e._v("è‡³æ­¤, å•æœºç‰ˆçš„ Zookeeper æœåŠ¡å™¨å¯åŠ¨å®Œæ¯•.")]),e._v(" "),s("h5",{attrs:{id:"_2-é›†ç¾¤ç‰ˆæœåŠ¡å™¨å¯åŠ¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-é›†ç¾¤ç‰ˆæœåŠ¡å™¨å¯åŠ¨"}},[e._v("#")]),e._v(" 2.é›†ç¾¤ç‰ˆæœåŠ¡å™¨å¯åŠ¨")]),e._v(" "),s("p",[e._v("å•æœºå’Œé›†ç¾¤æœåŠ¡å™¨çš„å¯åŠ¨åœ¨å¾ˆå¤šåœ°æ–¹æ˜¯ä¸€è‡´çš„, å…¶æµç¨‹å›¾å¦‚ä¸‹.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220106233835547.png",alt:"image-20220106233835547"}})]),e._v(" "),s("p",[e._v("ä¸Šå›¾çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸º"),s("strong",[e._v("é¢„å¯åŠ¨, åˆå§‹åŒ–, Leaderé€‰ä¸¾, Leader ä¸ Follower å¯åŠ¨æœŸäº¤äº’è¿‡ç¨‹, Leader ä¸ Follower å¯åŠ¨")]),e._v("ç­‰è¿‡ç¨‹.")]),e._v(" "),s("blockquote",[s("p",[e._v("(1)é¢„å¯åŠ¨")])]),e._v(" "),s("ol",[s("li",[e._v("ç»Ÿä¸€ç”± QuorumPeerMain ä½œä¸ºå¯åŠ¨ç±».")]),e._v(" "),s("li",[e._v("è§£æé…ç½®æ–‡ä»¶ zoo.cfg.")]),e._v(" "),s("li",[e._v("åˆ›å»ºå¹¶å¯åŠ¨å†å²æ–‡ä»¶æ¸…ç†å™¨ DatadirCleanupFactory.")]),e._v(" "),s("li",[e._v("åˆ¤æ–­å½“å‰æ˜¯é›†ç¾¤è¿˜æ˜¯å•æœºæ¨¡å¼çš„å¯åŠ¨. åœ¨é›†ç¾¤æ¨¡å¼ä¸­, åœ¨ zoo.cfg æ–‡ä»¶ä¸­é…ç½®äº†å¤šä¸ªæœåŠ¡å™¨åœ°å€, å¯ä»¥é€‰æ‹©é›†ç¾¤å¯åŠ¨.")])]),e._v(" "),s("blockquote",[s("p",[e._v("(2)åˆå§‹åŒ–")])]),e._v(" "),s("ol",[s("li",[e._v("åˆ›å»º ServerCnxnFactory.")]),e._v(" "),s("li",[e._v("åˆå§‹åŒ– ServerCnxnFactory.")]),e._v(" "),s("li",[e._v("åˆ›å»º Zookeeper æ•°æ®ç®¡ç†å™¨ FileTxnSnapLog.")]),e._v(" "),s("li",[e._v("åˆ›å»º QuorumPeer å®ä¾‹. Quorum æ˜¯é›†ç¾¤æ¨¡å¼ä¸‹ç‰¹æœ‰çš„å¯¹è±¡, æ˜¯ Zookeeper æœåŠ¡å™¨å®ä¾‹(ZooKeeperServer)çš„æ‰˜ç®¡è€…, QuorumPeer ä»£è¡¨äº†é›†ç¾¤ä¸­çš„ä¸€å°æœºå™¨, åœ¨è¿è¡ŒæœŸé—´, QuorumPeer ä¼šä¸æ–­æ£€æµ‹å½“å‰æœåŠ¡å™¨å®ä¾‹çš„è¿è¡ŒçŠ¶æ€, åŒæ—¶æ ¹æ®æƒ…å†µå‘èµ· Leader é€‰ä¸¾.")]),e._v(" "),s("li",[e._v("åˆ›å»º"),s("strong",[e._v("å†…å­˜æ•°æ®åº“")]),e._v(" ZKDatabase. ZKDatabase è´Ÿè´£ç®¡ç† ZooKeeper çš„æ‰€æœ‰ä¼šè¯è®°å½•ä»¥åŠ DataTree å’Œäº‹åŠ¡æ—¥å¿—çš„å­˜å‚¨.")]),e._v(" "),s("li",[e._v("åˆå§‹åŒ– QuorumPeer. å°†æ ¸å¿ƒç»„ä»¶å¦‚ FileTxnSnapLog, ServerCnxnFactory, ZKDatabase æ³¨å†Œåˆ° QuorumPeer ä¸­, åŒæ—¶é…ç½® QuorumPeer çš„å‚æ•°, å¦‚æœåŠ¡å™¨åˆ—è¡¨åœ°å€, Leader é€‰ä¸¾ç®—æ³•å’Œä¼šè¯è¶…æ—¶æ—¶é—´é™åˆ¶ç­‰.")]),e._v(" "),s("li",[e._v("æ¢å¤æœ¬åœ°æ•°æ®.")]),e._v(" "),s("li",[e._v("å¯åŠ¨ ServerCnxnFactory ä¸»çº¿ç¨‹.")])]),e._v(" "),s("blockquote",[s("p",[e._v("(3)Leaderé€‰ä¸¾")])]),e._v(" "),s("ol",[s("li",[s("strong",[e._v("åˆå§‹åŒ– Leader é€‰ä¸¾")]),e._v(". é›†ç¾¤æ¨¡å¼ç‰¹æœ‰, Zookeeper é¦–å…ˆä¼šæ ¹æ®è‡ªèº«çš„æœåŠ¡å™¨ ID(SID), æœ€æ–°çš„ ZXID(lastLoggedZxid) å’Œå½“å‰çš„æœåŠ¡å™¨ epoch(currentEpoch) æ¥ç”Ÿæˆä¸€ä¸ª"),s("strong",[e._v("åˆå§‹åŒ–æŠ•ç¥¨")]),e._v(", åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­, æ¯ä¸ªæœåŠ¡å™¨éƒ½ä¼šç»™è‡ªå·±æŠ•ç¥¨. ç„¶åæ ¹æ® zoo.cfg é…ç½®åˆ›å»ºç›¸åº” Leader é€‰ä¸¾ç®—æ³•å®ç°, Zookeeper æä¾›ä¸‰ç§é»˜è®¤ç®—æ³•(LeaderElection, AuthFastLeaderElection, FastLeaderElection), å¯é€šè¿‡ zoo.cfg ä¸­çš„ electionAlg å±æ€§æ¥æŒ‡å®š. åœ¨åˆå§‹åŒ–é˜¶æ®µ, Zookeeper ä¼šåˆ›å»º Leader é€‰ä¸¾æ‰€éœ€çš„ç½‘ç»œ I/O å±‚ QuorumCnxManager, åŒæ—¶å¯åŠ¨å¯¹ Leader é€‰ä¸¾ç«¯å£çš„ç›‘å¬, ç­‰å¾…é›†ç¾¤ä¸­å…¶ä»–æœåŠ¡å™¨åˆ›å»ºè¿æ¥.")]),e._v(" "),s("li",[e._v("æ³¨å†Œ JMX æœåŠ¡.")]),e._v(" "),s("li",[e._v("æ£€æµ‹å½“å‰æœåŠ¡å™¨çŠ¶æ€. è¿è¡ŒæœŸé—´, QuorumPeer ä¼šä¸æ–­æ£€æµ‹å½“å‰æœåŠ¡å™¨çŠ¶æ€. æ­£å¸¸æƒ…å†µä¸‹, Zookeeper æœåŠ¡å™¨çš„çŠ¶æ€åœ¨ LOOKING, LEADING, FOLLOWING/OBSERVING ä¹‹é—´è¿›è¡Œåˆ‡æ¢. åœ¨å¯åŠ¨é˜¶æ®µ, QuorumPeer çš„åˆå§‹çŠ¶æ€æ˜¯ LOOKING, å› æ­¤å¼€å§‹è¿›è¡Œ Leader é€‰ä¸¾.")]),e._v(" "),s("li",[s("strong",[e._v("Leader é€‰ä¸¾")]),e._v(". é€šè¿‡æŠ•ç¥¨ç¡®å®š Leader, å…¶ä½™æœºå™¨ç§°ä¸º Follower å’Œ Observer. å…·ä½“ç®—æ³•åœ¨åé¢ä¼šç»™å‡º.")])]),e._v(" "),s("blockquote",[s("p",[e._v("(4)Leaderå’ŒFollowerå¯åŠ¨æœŸäº¤äº’è¿‡ç¨‹")])]),e._v(" "),s("ol",[s("li",[s("strong",[e._v("åˆ›å»º Leader æœåŠ¡å™¨å’Œ Follower æœåŠ¡å™¨")]),e._v(". å®Œæˆ Leader é€‰ä¸¾å, æ¯ä¸ªæœåŠ¡å™¨ä¼šæ ¹æ®è‡ªå·±æœåŠ¡å™¨çš„è§’è‰²åˆ›å»ºç›¸åº”çš„æœåŠ¡å™¨å®ä¾‹, å¹¶è¿›å…¥å„è‡ªè§’è‰²çš„ä¸»æµç¨‹.")]),e._v(" "),s("li",[e._v("Leader æœåŠ¡å™¨å¯åŠ¨ Follower æ¥æ”¶å™¨ LearnerCnxAcceptor. è¿è¡ŒæœŸé—´, Leader æœåŠ¡å™¨éœ€è¦å’Œæ‰€æœ‰å…¶ä½™çš„æœåŠ¡å™¨(ç»Ÿç§°ä¸º Learner)ä¿æŒè¿æ¥ä»¥ç¡®é›†ç¾¤çš„æœºå™¨å­˜æ´»æƒ…å†µ, LearnerCnxAcceptor è´Ÿè´£æ¥æ”¶æ‰€æœ‰é Leader æœåŠ¡å™¨çš„è¿æ¥è¯·æ±‚.")]),e._v(" "),s("li",[e._v("Leader æœåŠ¡å™¨å¼€å§‹å’Œ Leader å»ºç«‹è¿æ¥. æ‰€æœ‰ Learner ä¼šæ‰¾åˆ° Leader æœåŠ¡å™¨, å¹¶ä¸å…¶å»ºç«‹è¿æ¥.")]),e._v(" "),s("li",[e._v("Leader æœåŠ¡å™¨åˆ›å»º LearnerHandler. Leader æ¥æ”¶åˆ°æ¥è‡ªå…¶ä»–æœºå™¨è¿æ¥åˆ›å»ºè¯·æ±‚å, ä¼šåˆ›å»ºä¸€ä¸ª LearnerHandler å®ä¾‹, æ¯ä¸ª LearnerHandler å®ä¾‹éƒ½å¯¹åº”ä¸€ä¸ª Leader ä¸ Learner æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥, å…¶è´Ÿè´£ Leader å’Œ Learner æœåŠ¡å™¨ä¹‹é—´å‡ ä¹æ‰€æœ‰çš„æ¶ˆæ¯é€šä¿¡å’Œæ•°æ®åŒæ­¥.")]),e._v(" "),s("li",[e._v("å‘ Leader æ³¨å†Œ. Learner å®Œæˆå’Œ Leader çš„è¿æ¥å, ä¼šå‘ Leader è¿›è¡Œæ³¨å†Œ, å³å°† Learner æœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯(LearnerInfo), åŒ…æ‹¬ SID å’Œ ZXID, å‘é€ç»™ Leader æœåŠ¡å™¨.")]),e._v(" "),s("li",[e._v("Leader è§£æ Learner ä¿¡æ¯, è®¡ç®—æ–°çš„ epoch. Leader æ¥æ”¶åˆ° Learner æœåŠ¡å™¨åŸºæœ¬ä¿¡æ¯å, ä¼šè§£æå‡ºè¯¥ Learner çš„ SID å’Œ ZXID, ç„¶åæ ¹æ® ZXID è§£æå‡ºå¯¹åº”çš„ epoch_of_learner, å¹¶å’Œå½“å‰ Leader æœåŠ¡å™¨çš„ epoch_of_leader è¿›è¡Œæ¯”è¾ƒ, å¦‚æœè¯¥ Learner çš„ epoch_of_learner æ›´å¤§, åˆ™æ›´æ–° Leader çš„ epoch_of_leader = epoch_of_learner + 1. ç„¶å LearnHandler è¿›è¡Œç­‰å¾…, ç›´åˆ°è¿‡åŠ Learner å·²ç»å‘ Leader è¿›è¡Œäº†æ³¨å†Œ, åŒæ—¶æ›´æ–°äº† epoch_of_leader å, Leader å°±å¯ä»¥ç¡®å®šå½“å‰é›†ç¾¤çš„ epoch äº†.")]),e._v(" "),s("li",[e._v("å‘é€ Leader çŠ¶æ€. è®¡ç®—å‡ºæ–°çš„ epoch å, Leader ä¼šå°†è¯¥ä¿¡æ¯ä»¥ä¸€ä¸ª LEADERINFO æ¶ˆæ¯çš„å½¢å¼å‘é€ç»™ Learner, å¹¶ç­‰å¾… Learner çš„å“åº”.")]),e._v(" "),s("li",[e._v("Learner å‘é€ ACK æ¶ˆæ¯. Learner æ¥æ”¶åˆ° LEADERINFO å, ä¼šè§£æå‡º epoch å’Œ ZXID, ç„¶åå‘ Leader åé¦ˆä¸€ä¸ª ACKEPOCH å“åº”.")]),e._v(" "),s("li",[e._v("æ•°æ®åŒæ­¥. Leader æ”¶åˆ° Learner çš„ ACKEPOCH å, å³å¯è¿›è¡Œæ•°æ®åŒæ­¥.")]),e._v(" "),s("li",[e._v("å¯åŠ¨ Leader å’Œ Learner æœåŠ¡å™¨. å½“æœ‰è¿‡åŠ Learner å·²ç»å®Œæˆäº†æ•°æ®åŒæ­¥, é‚£ä¹ˆ Leader å’Œ Learner æœåŠ¡å™¨å®ä¾‹å°±å¯ä»¥å¯åŠ¨äº†.")])]),e._v(" "),s("blockquote",[s("p",[e._v("(5)Leaderå’ŒFollowerå¯åŠ¨")])]),e._v(" "),s("ol",[s("li",[e._v("åˆ›å»ºå¯åŠ¨ä¼šè¯ç®¡ç†å™¨.")]),e._v(" "),s("li",[e._v("åˆå§‹åŒ– Zookeeper è¯·æ±‚å¤„ç†é“¾, é›†ç¾¤æ¨¡å¼çš„æ¯ä¸ªå¤„ç†å™¨ä¹Ÿä¼šåœ¨å¯åŠ¨é˜¶æ®µä¸²è”è¯·æ±‚å¤„ç†é“¾.")]),e._v(" "),s("li",[e._v("æ³¨å†Œ JMX æœåŠ¡.")])]),e._v(" "),s("p",[e._v("è‡³æ­¤, é›†ç¾¤ç‰ˆçš„ Zookeeper æœåŠ¡å™¨å¯åŠ¨å®Œæ¯•.")]),e._v(" "),s("h4",{attrs:{id:"leaderé€‰ä¸¾ä¸zabåè®®ğŸŒŸ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#leaderé€‰ä¸¾ä¸zabåè®®ğŸŒŸ"}},[e._v("#")]),e._v(" Leaderé€‰ä¸¾ä¸ZABåè®®ğŸŒŸ")]),e._v(" "),s("h5",{attrs:{id:"_1-é›†ç¾¤ä¸æœåŠ¡å™¨è§’è‰²"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-é›†ç¾¤ä¸æœåŠ¡å™¨è§’è‰²"}},[e._v("#")]),e._v(" 1.é›†ç¾¤ä¸æœåŠ¡å™¨è§’è‰²")]),e._v(" "),s("p",[e._v("ZooKeeper æœåŠ¡å™¨é›†ç¾¤ä¸­æœ‰ "),s("strong",[e._v("Leader, Follower å’Œ Observer")]),e._v(" ä¸‰ç§ç±»å‹è§’è‰².")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220106234805740.png",alt:"image-20220106234805740"}})]),e._v(" "),s("p",[e._v("ZooKeeper é›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨é€šè¿‡ä¸€ä¸ª "),s("strong",[e._v("Leader é€‰ä¸¾è¿‡ç¨‹")]),e._v('æ¥é€‰å®šä¸€å° "Leader" æœºå™¨, Leader æ—¢å¯ä»¥'),s("strong",[e._v("ä¸ºå®¢æˆ·ç«¯æä¾›å†™æœåŠ¡åˆèƒ½æä¾›è¯»æœåŠ¡")]),e._v(". é™¤ Leader å¤–, Follower å’Œ Observer éƒ½åªèƒ½æä¾›"),s("strong",[e._v("è¯»æœåŠ¡")]),e._v('. Follower å’Œ Observer å”¯ä¸€çš„åŒºåˆ«åœ¨äº Observer æœºå™¨ä¸å‚ä¸ Leader çš„é€‰ä¸¾è¿‡ç¨‹, ä¹Ÿä¸å‚ä¸å†™æ“ä½œçš„ "'),s("strong",[e._v("è¿‡åŠå†™æˆåŠŸ")]),e._v('" ç­–ç•¥, å› æ­¤ Observer æœºå™¨å¯ä»¥åœ¨ä¸å½±å“å†™æ€§èƒ½çš„æƒ…å†µä¸‹æå‡é›†ç¾¤çš„è¯»æ€§èƒ½.')]),e._v(" "),s("h6",{attrs:{id:"_1-leader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-leader"}},[e._v("#")]),e._v(" (1)Leader")]),e._v(" "),s("p",[e._v("Leader æœåŠ¡å™¨æ˜¯ ZK é›†ç¾¤å·¥ä½œçš„æ ¸å¿ƒ, æ˜¯é›†ç¾¤ä¸­å”¯ä¸€çš„"),s("strong",[e._v("å†™è¯·æ±‚")]),e._v("å¤„ç†è€…, å…¶ä¸»è¦å·¥ä½œå¦‚ä¸‹:")]),e._v(" "),s("ul",[s("li",[e._v("äº‹åŠ¡è¯·æ±‚çš„å”¯ä¸€è°ƒåº¦å’Œå¤„ç†è€…, ä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§.")]),e._v(" "),s("li",[e._v("é›†ç¾¤å†…éƒ¨å„æœåŠ¡å™¨çš„è°ƒåº¦è€….")])]),e._v(" "),s("blockquote",[s("p",[e._v("è¯·æ±‚å¤„ç†é“¾")])]),e._v(" "),s("p",[e._v("Zookeeper "),s("strong",[e._v("ä½¿ç”¨è´£ä»»é“¾æ¥å¤„ç†æ¯ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚")]),e._v(", Leader æœåŠ¡å™¨çš„è¯·æ±‚"),s("strong",[e._v("å¤„ç†é“¾")]),e._v("å¦‚ä¸‹:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220107201550224.png",alt:"image-20220107201550224"}})]),e._v(" "),s("p",[e._v("å…¸å‹çš„å¤„ç†å™¨æœ‰:")]),e._v(" "),s("ul",[s("li",[e._v("PrepRequestProcessor. è¯·æ±‚é¢„å¤„ç†å™¨.")]),e._v(" "),s("li",[e._v("ProposalRequestProcessor. äº‹åŠ¡æŠ•ç¥¨å¤„ç†å™¨.")]),e._v(" "),s("li",[e._v("SyncRequestProcessor. äº‹åŠ¡æ—¥å¿—è®°å½•å¤„ç†å™¨.")])]),e._v(" "),s("blockquote",[s("p",[e._v("LearnerHandler")])]),e._v(" "),s("p",[e._v("ä¸ºäº†ä¿è¯æ•´ä¸ªé›†ç¾¤å†…éƒ¨çš„å®æ—¶é€šä¿¡, åŒæ—¶ä¸ºäº†ç¡®ä¿å¯ä»¥æ§åˆ¶æ‰€æœ‰çš„ Follower/Observer æœåŠ¡å™¨, Leader æœåŠ¡å™¨ä¼šä¸æ¯ä¸ª Follower/Observer æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ª "),s("strong",[e._v("TCP é•¿è¿æ¥")]),e._v(". åŒæ—¶ä¹Ÿä¼šä¸ºæ¯ä¸ª Follower/Observer æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªåä¸º LearnerHandler çš„å®ä½“. LearnerHandler æ˜¯ Learner æœåŠ¡å™¨çš„ç®¡ç†è€…, ä¸»è¦è´Ÿè´£ Follower/Observer æœåŠ¡å™¨å’Œ Leader æœåŠ¡å™¨ä¹‹é—´çš„ä¸€ç³»åˆ—ç½‘ç»œé€šä¿¡, åŒ…æ‹¬æ•°æ®åŒæ­¥, è¯·æ±‚è½¬å‘å’Œ Proposal æè®®çš„æŠ•ç¥¨ç­‰. Leader æœåŠ¡å™¨ä¸­ä¿å­˜äº†æ‰€æœ‰ Follower/Observer å¯¹åº”çš„LearnerHandler.")]),e._v(" "),s("h6",{attrs:{id:"_2-follower"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-follower"}},[e._v("#")]),e._v(" (2)Follower")]),e._v(" "),s("p",[e._v("Follower æ˜¯ ZooKeeper é›†ç¾¤ä¸­çš„"),s("strong",[e._v("è·Ÿéšè€…")]),e._v(", å…¶ä¸»è¦å·¥ä½œå¦‚ä¸‹:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡æ€§è¯·æ±‚(è¯»å–æ•°æ®), è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leader æœåŠ¡å™¨")]),e._v(".")]),e._v(" "),s("li",[e._v("å‚ä¸äº‹åŠ¡è¯·æ±‚ Proposal çš„æŠ•ç¥¨.")]),e._v(" "),s("li",[e._v("å‚ä¸ Leader é€‰ä¸¾æŠ•ç¥¨.")])]),e._v(" "),s("p",[e._v("Follower ä¹Ÿé‡‡ç”¨äº†"),s("strong",[e._v("è´£ä»»é“¾æ¨¡å¼")]),e._v("ç»„è£…çš„è¯·æ±‚å¤„ç†é“¾æ¥å¤„ç†æ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚, ç”±äºä¸éœ€è¦å¯¹äº‹åŠ¡è¯·æ±‚çš„æŠ•ç¥¨å¤„ç†, å› æ­¤ Follower çš„è¯·æ±‚å¤„ç†é“¾ç›¸å¯¹ç®€å•.")]),e._v(" "),s("h6",{attrs:{id:"_3-observer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-observer"}},[e._v("#")]),e._v(" (3)Observer")]),e._v(" "),s("p",[e._v("Observer å……å½“"),s("strong",[e._v("è§‚å¯Ÿè€…")]),e._v("è§’è‰², è§‚å¯Ÿ Zookeeper é›†ç¾¤çš„æœ€æ–°çŠ¶æ€å˜åŒ–å¹¶å°†è¿™äº›çŠ¶æ€åŒæ­¥è¿‡æ¥, å…¶å¯¹äºéäº‹åŠ¡è¯·æ±‚å¯ä»¥è¿›è¡Œç‹¬ç«‹å¤„ç†, å¯¹äºäº‹åŠ¡è¯·æ±‚, åˆ™ä¼šè½¬å‘ç»™ Leader æœåŠ¡å™¨è¿›è¡Œå¤„ç†. Observer ä¸ä¼šå‚ä¸ä»»ä½•å½¢å¼çš„æŠ•ç¥¨, åŒ…æ‹¬äº‹åŠ¡è¯·æ±‚ Proposal çš„æŠ•ç¥¨å’Œ Leader é€‰ä¸¾æŠ•ç¥¨.")]),e._v(" "),s("h5",{attrs:{id:"_2-zabåè®®ä¸leaderé€‰ä¸¾æ¦‚è¿°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-zabåè®®ä¸leaderé€‰ä¸¾æ¦‚è¿°"}},[e._v("#")]),e._v(" 2.ZABåè®®ä¸Leaderé€‰ä¸¾æ¦‚è¿°")]),e._v(" "),s("p",[s("mark",[s("strong",[e._v("ä¸ºè¾¾æˆé›†ç¾¤æ•°æ®ä¸€è‡´æ€§, ZooKeeper å¹¶æ²¡æœ‰å®Œå…¨é‡‡ç”¨ Paxos ç®—æ³•, è€Œæ˜¯ä½¿ç”¨ ZAB(ZooKeeper Atomic Broadcast åŸå­å¹¿æ’­)åè®®ä½œä¸ºå…¶ä¿è¯åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„æ ¸å¿ƒç®—æ³•")])]),e._v(". ZAB åè®®å¹¶ä¸åƒ Paxos ç®—æ³•é‚£æ ·æ˜¯ä¸€ç§é€šç”¨çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•, å®ƒæ˜¯ä¸€ç§"),s("strong",[e._v("ç‰¹åˆ«ä¸º Zookeeper è®¾è®¡çš„å´©æºƒå¯æ¢å¤çš„åŸå­æ¶ˆæ¯å¹¿æ’­ç®—æ³•")]),e._v(". åŸºäºè¯¥åè®®, ZooKeeper å®ç°äº†ä¸€ç§"),s("strong",[e._v("ä¸»å¤‡æ¨¡å¼")]),e._v("çš„ç³»ç»Ÿæ¶æ„æ¥ä¿æŒé›†ç¾¤ä¸­å„ä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§.")]),e._v(" "),s("p",[e._v("Leader é€‰ä¸¾æ˜¯ä¿è¯åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„å…³é”®æ‰€åœ¨. å½“ Zookeeper é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨å‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¹‹ä¸€æ—¶, éœ€è¦è¿›å…¥ Leader é€‰ä¸¾.")]),e._v(" "),s("ul",[s("li",[e._v("æœåŠ¡å™¨"),s("strong",[e._v("åˆå§‹åŒ–")]),e._v("å¯åŠ¨.")]),e._v(" "),s("li",[e._v("æœåŠ¡å™¨"),s("strong",[e._v("è¿è¡ŒæœŸé—´æ— æ³•å’Œ Leader ä¿æŒè¿æ¥")]),e._v(".")])]),e._v(" "),s("p",[e._v("ä¸‹é¢å°±ä¸¤ç§æƒ…å†µè¿›è¡Œåˆ†æè®²è§£.")]),e._v(" "),s("h6",{attrs:{id:"_1-æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸçš„leaderé€‰ä¸¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸçš„leaderé€‰ä¸¾"}},[e._v("#")]),e._v(" (1)æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸçš„Leaderé€‰ä¸¾")]),e._v(" "),s("p",[e._v("è¿›è¡Œé€‰ä¸¾è‡³å°‘éœ€è¦ 2 å°æœåŠ¡å™¨, è¿™é‡Œä»¥ 3 å°æœºå™¨çš„é›†ç¾¤ä¸ºä¾‹è¯´æ˜. åœ¨é›†ç¾¤åˆå§‹åŒ–é˜¶æ®µ, å½“æœåŠ¡å™¨ Server1 å¯åŠ¨æ—¶, å…¶å•ç‹¬æ— æ³•è¿›è¡Œå’Œå®Œæˆ Leader é€‰ä¸¾; å½“æœåŠ¡å™¨ Server2 å¯åŠ¨æ—¶, æ­¤æ—¶ä¸¤å°æœºå™¨å¯ä»¥ç›¸äº’é€šä¿¡, æ¯å°æœºå™¨éƒ½è¯•å›¾æ‰¾åˆ° Leader, äºæ˜¯è¿›å…¥ Leader é€‰ä¸¾è¿‡ç¨‹.")]),e._v(" "),s("p",[e._v("é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹:")]),e._v(" "),s("ol",[s("li",[s("p",[s("strong",[e._v("æ¯ä¸ª Server å‘å‡ºä¸€ä¸ªæŠ•ç¥¨")]),e._v(". ç”±äºæ˜¯åˆå§‹æƒ…å†µ, Server1 å’Œ Server2 éƒ½ä¼šå°†"),s("strong",[e._v("è‡ªå·±")]),e._v("ä½œä¸º Leader æœåŠ¡å™¨æ¥è¿›è¡ŒæŠ•ç¥¨, æ¯æ¬¡æŠ•ç¥¨ä¼šåŒ…å«æ‰€æ¨ä¸¾çš„æœåŠ¡å™¨çš„ myid å’Œ ZXID, ä½¿ç”¨  "),s("strong",[e._v("(myid, ZXID)")]),e._v("  æ¥è¡¨ç¤º, æ­¤æ—¶ Server1 çš„æŠ•ç¥¨ä¸º (1, 0), Server2 çš„æŠ•ç¥¨ä¸º (2, 0), ç„¶åå„è‡ªå°†è¿™ä¸ªæŠ•ç¥¨å‘ç»™é›†ç¾¤ä¸­å…¶ä»–æœºå™¨.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("æ¥å—æ¥è‡ªå„ä¸ªæœåŠ¡å™¨çš„æŠ•ç¥¨")]),e._v(". é›†ç¾¤çš„æ¯ä¸ªæœåŠ¡å™¨æ”¶åˆ°æŠ•ç¥¨å, é¦–å…ˆåˆ¤æ–­è¯¥æŠ•ç¥¨çš„æœ‰æ•ˆæ€§, å¦‚æ£€æŸ¥æ˜¯å¦æ˜¯æœ¬è½®æŠ•ç¥¨, æ˜¯å¦æ¥è‡ª LOOKING çŠ¶æ€çš„æœåŠ¡å™¨.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("å¤„ç†æŠ•ç¥¨")]),e._v(". é’ˆå¯¹æ¯ä¸€ä¸ªæŠ•ç¥¨, æœåŠ¡å™¨éƒ½éœ€è¦å°†åˆ«äººçš„æŠ•ç¥¨å’Œè‡ªå·±çš„æŠ•ç¥¨è¿›è¡Œ PK, PK è§„åˆ™å¦‚ä¸‹:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("ä¼˜å…ˆæ£€æŸ¥ ZXID")]),e._v(". ZXID æ¯”è¾ƒå¤§çš„æœåŠ¡å™¨ä¼˜å…ˆä½œä¸º Leader.")]),e._v(" "),s("li",[s("strong",[e._v("å¦‚æœ ZXID ç›¸åŒ, é‚£ä¹ˆå°±æ¯”è¾ƒ myid")]),e._v(". myid è¾ƒå¤§çš„æœåŠ¡å™¨ä½œä¸º Leader æœåŠ¡å™¨.")])]),e._v(" "),s("p",[e._v("å¯¹äº Server1 è€Œè¨€, å®ƒçš„æŠ•ç¥¨æ˜¯ (1, 0), æ¥æ”¶ Server2 çš„æŠ•ç¥¨ä¸º(2, 0), é¦–å…ˆä¼šæ¯”è¾ƒä¸¤è€…çš„ ZXID, å‡ä¸º 0, å†æ¯”è¾ƒ myid, æ­¤æ—¶ Server2 çš„ myid æœ€å¤§, äºæ˜¯æ›´æ–°è‡ªå·±çš„æŠ•ç¥¨ä¸º (2, 0), ç„¶åé‡æ–°æŠ•ç¥¨. å¯¹äº Server2 è€Œè¨€, å…¶æ— é¡»æ›´æ–°è‡ªå·±çš„æŠ•ç¥¨, åªæ˜¯å†æ¬¡å‘é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨å‘å‡ºä¸Šä¸€æ¬¡æŠ•ç¥¨ä¿¡æ¯å³å¯.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("ç»Ÿè®¡æŠ•ç¥¨")]),e._v(". æ¯æ¬¡æŠ•ç¥¨å, æœåŠ¡å™¨éƒ½ä¼šç»Ÿè®¡æŠ•ç¥¨ä¿¡æ¯, åˆ¤æ–­æ˜¯å¦å·²ç»æœ‰è¿‡åŠæœºå™¨æ¥å—åˆ°ç›¸åŒçš„æŠ•ç¥¨ä¿¡æ¯, å¯¹äº Server1, Server2 è€Œè¨€, éƒ½ç»Ÿè®¡å‡ºé›†ç¾¤ä¸­å·²ç»æœ‰ä¸¤å°æœºå™¨æ¥å—äº† (2, 0) çš„æŠ•ç¥¨ä¿¡æ¯, æ­¤æ—¶ä¾¿è®¤ä¸ºå·²ç»é€‰å‡ºäº† Leader.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("æ”¹å˜æœåŠ¡å™¨çŠ¶æ€")]),e._v(". ä¸€æ—¦ç¡®å®šäº† Leader, æ¯ä¸ªæœåŠ¡å™¨å°±ä¼šæ›´æ–°è‡ªå·±çš„çŠ¶æ€, å¦‚æœæ˜¯ Follower, é‚£ä¹ˆå°±å˜æ›´ä¸º FOLLOWING, å¦‚æœæ˜¯ Leader, å°±å˜æ›´ä¸º LEADING.")])])]),e._v(" "),s("h6",{attrs:{id:"_2-æœåŠ¡å™¨è¿è¡Œæ—¶æœŸçš„leaderé€‰ä¸¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-æœåŠ¡å™¨è¿è¡Œæ—¶æœŸçš„leaderé€‰ä¸¾"}},[e._v("#")]),e._v(" (2)æœåŠ¡å™¨è¿è¡Œæ—¶æœŸçš„Leaderé€‰ä¸¾")]),e._v(" "),s("p",[e._v("åœ¨ ZK è¿è¡ŒæœŸé—´, æœ‰é Leader æœåŠ¡å™¨å®•æœºæˆ–æ–°åŠ å…¥ä¹Ÿä¸ä¼šå½±å“ Leader, ä½†ä¸€æ—¦ Leader æœåŠ¡å™¨æŒ‚äº†, é‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°†"),s("strong",[e._v("æš‚åœ")]),e._v("å¯¹å¤–æœåŠ¡, è¿›å…¥æ–°ä¸€è½® Leader é€‰ä¸¾, å…¶è¿‡ç¨‹å’Œå¯åŠ¨æ—¶æœŸçš„é€‰ä¸¾è¿‡ç¨‹åŸºæœ¬ä¸€è‡´.")]),e._v(" "),s("p",[e._v("å‡è®¾æ­£åœ¨è¿è¡Œçš„æœ‰ Server1, Server2, Server3 ä¸‰å°æœåŠ¡å™¨, å½“å‰ Leader æ˜¯ Server2, è‹¥æŸä¸€æ—¶åˆ» Leader æŒ‚äº†, æ­¤æ—¶ä¾¿å¼€å§‹ Leader é€‰ä¸¾.")]),e._v(" "),s("p",[e._v("é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹:")]),e._v(" "),s("ol",[s("li",[s("strong",[e._v("å˜æ›´çŠ¶æ€")]),e._v(". Leader æŒ‚å, ä½™ä¸‹çš„é Observer æœåŠ¡å™¨éƒ½ä¼šå°†è‡ªå·±çš„çŠ¶æ€å˜æ›´ä¸º LOOKING, ç„¶åå¼€å§‹è¿›å…¥ Leader é€‰ä¸¾è¿‡ç¨‹.")]),e._v(" "),s("li",[s("strong",[e._v("æ¯ä¸ª Server å‘å‡ºä¸€ä¸ªæŠ•ç¥¨")]),e._v(". åœ¨è¿è¡ŒæœŸé—´, æ¯ä¸ªæœåŠ¡å™¨ä¸Šçš„ ZXID å¯èƒ½"),s("strong",[e._v("ä¸åŒ")]),e._v(", æ­¤æ—¶å‡å®š Server1 çš„ ZXID ä¸º 123, Server3 çš„ ZXID ä¸º 122; åœ¨ç¬¬ä¸€è½®æŠ•ç¥¨ä¸­, Server1 å’Œ Server3 éƒ½ä¼šæŠ•"),s("strong",[e._v("è‡ªå·±")]),e._v(", äº§ç”ŸæŠ•ç¥¨ (1, 123), (3, 122), ç„¶åå„è‡ªå°†æŠ•ç¥¨å‘é€ç»™é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨.")]),e._v(" "),s("li",[s("strong",[e._v("æ¥æ”¶æ¥è‡ªå„ä¸ªæœåŠ¡å™¨çš„æŠ•ç¥¨")]),e._v(". ä¸å¯åŠ¨æ—¶è¿‡ç¨‹ç›¸åŒ.")]),e._v(" "),s("li",[s("strong",[e._v("å¤„ç†æŠ•ç¥¨")]),e._v(". ä¸å¯åŠ¨æ—¶è¿‡ç¨‹ç›¸åŒ, æ­¤æ—¶ Server1 å°†ä¼šæˆä¸º Leader.")]),e._v(" "),s("li",[s("strong",[e._v("ç»Ÿè®¡æŠ•ç¥¨")]),e._v(". ä¸å¯åŠ¨æ—¶è¿‡ç¨‹ç›¸åŒ.")]),e._v(" "),s("li",[s("strong",[e._v("æ”¹å˜æœåŠ¡å™¨çš„çŠ¶æ€")]),e._v(". ä¸å¯åŠ¨æ—¶è¿‡ç¨‹ç›¸åŒ.")])]),e._v(" "),s("h5",{attrs:{id:"_3-leaderé€‰ä¸¾ç®—æ³•åˆ†æ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-leaderé€‰ä¸¾ç®—æ³•åˆ†æ"}},[e._v("#")]),e._v(" 3.Leaderé€‰ä¸¾ç®—æ³•åˆ†æ")]),e._v(" "),s("p",[e._v("åœ¨ 3.4.0 åçš„ ZK ç‰ˆæœ¬åªä¿ç•™äº† TCP ç‰ˆæœ¬çš„ "),s("strong",[e._v("FastLeaderElection")]),e._v(" é€‰ä¸¾ç®—æ³•.")]),e._v(" "),s("h6",{attrs:{id:"_1-æœ¯è¯­è§£é‡Š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-æœ¯è¯­è§£é‡Š"}},[e._v("#")]),e._v(" (1)æœ¯è¯­è§£é‡Š")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("SID(æœåŠ¡å™¨ID)")]),e._v(" : ä¸€ä¸ªæ•°å­—, æ ‡è¯† ZK é›†ç¾¤ä¸­çš„ä¸€å°æœºå™¨, æ¯å°æœºå™¨ä¸èƒ½é‡å¤. SID ä¸ "),s("strong",[e._v("myid")]),e._v(" çš„å€¼ä¸€è‡´.")]),e._v(" "),s("li",[s("strong",[e._v("ZXID(äº‹åŠ¡ID)")]),e._v(" : ZXID æ˜¯ä¸€ä¸ªäº‹åŠ¡ ID, ç”¨æ¥å”¯ä¸€æ ‡è¯†å› æ­¤æœåŠ¡å™¨çŠ¶æ€çš„å˜æ›´. åœ¨æŸä¸€ä¸ªæ—¶åˆ», é›†ç¾¤ä¸­æ¯å°æœºå™¨çš„ ZXID å€¼"),s("strong",[e._v("ä¸ä¸€å®šå®Œå…¨éƒ½ä¸€è‡´")]),e._v(".")]),e._v(" "),s("li",[s("strong",[e._v("Vote(æŠ•ç¥¨)")]),e._v(" : Leader é€‰ä¸¾éœ€é€šè¿‡æŠ•ç¥¨å®ç°, å½“é›†ç¾¤ä¸­çš„æœºå™¨å‘ç°è‡ªå·±æ— æ³•æ£€æµ‹åˆ° Leader æœºå™¨çš„æ—¶å€™, å°±ä¼šå¼€å§‹å°è¯•è¿›è¡ŒæŠ•ç¥¨.")]),e._v(" "),s("li",[s("strong",[e._v("Quorum(è¿‡åŠæ•°æœºå™¨")]),e._v("): ä¸€ä¸ªé‡è¯, é€šå¸¸æŒ‡è¿‡åŠæ•°çš„æœºå™¨.")])]),e._v(" "),s("h6",{attrs:{id:"_2-ç®—æ³•æµç¨‹åˆ†æ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç®—æ³•æµç¨‹åˆ†æ"}},[e._v("#")]),e._v(" (2)ç®—æ³•æµç¨‹åˆ†æ")]),e._v(" "),s("p",[e._v("å½“ä¸€å°æœºå™¨è¿›å…¥ Leader é€‰ä¸¾æ—¶, å½“å‰é›†ç¾¤å¯èƒ½ä¼šå¤„äºä»¥ä¸‹ä¸¤ç§çŠ¶æ€:")]),e._v(" "),s("ul",[s("li",[e._v("é›†ç¾¤ä¸­å·²ç»å­˜åœ¨ Leader.")]),e._v(" "),s("li",[e._v("é›†ç¾¤ä¸­ä¸å­˜åœ¨ Leader.")])]),e._v(" "),s("p",[e._v("å¯¹äº"),s("strong",[e._v("é›†ç¾¤ä¸­å·²ç»å­˜åœ¨ Leader")]),e._v(" è€Œè¨€, æ¯”å¦‚é›†ç¾¤åŠ å…¥æ–°æœºå™¨. è¿™ç§æƒ…å†µä¸‹æ–°æœºå™¨è¯•å›¾å»é€‰ä¸¾ Leader æ—¶, ä¼šè¢«å‘ŠçŸ¥å½“å‰æœåŠ¡å™¨çš„ Leader ä¿¡æ¯, å¯¹äºæ–°æœºå™¨è€Œè¨€, ä»…ä»…éœ€è¦å’Œ Leader æœºå™¨å»ºç«‹è¿æ¥å¹¶è¿›è¡ŒçŠ¶æ€åŒæ­¥å³å¯.")]),e._v(" "),s("p",[e._v("è€Œåœ¨"),s("strong",[e._v("é›†ç¾¤ä¸­ä¸å­˜åœ¨ Leader")]),e._v(" æƒ…å†µä¸‹åˆ™ä¼šç›¸å¯¹å¤æ‚, å…¶æ­¥éª¤å¦‚ä¸‹:")]),e._v(" "),s("blockquote",[s("p",[e._v("1.ç¬¬ä¸€æ¬¡æŠ•ç¥¨")])]),e._v(" "),s("p",[e._v("æ— è®ºå“ªç§æƒ…å†µå¯¼è‡´è¿›è¡Œ Leader é€‰ä¸¾, é›†ç¾¤çš„æ‰€æœ‰æœºå™¨éƒ½å¤„äº"),s("strong",[e._v("è¯•å›¾é€‰ä¸¾å‡ºä¸€ä¸ª Leader çš„çŠ¶æ€")]),e._v(", å³ "),s("strong",[e._v("LOOKING")]),e._v(" çŠ¶æ€, LOOKING æœºå™¨ä¼šå‘æ‰€æœ‰å…¶ä»–æœºå™¨å‘é€æ¶ˆæ¯, è¯¥æ¶ˆæ¯ç§°ä¸º"),s("strong",[e._v("æŠ•ç¥¨")]),e._v(". æŠ•ç¥¨ä¸­åŒ…å«äº† SID(æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†) å’Œ ZXID(äº‹åŠ¡ID),  "),s("strong",[e._v("(SID, ZXID) å½¢å¼æ¥æ ‡è¯†ä¸€æ¬¡æŠ•ç¥¨ä¿¡æ¯")]),e._v(".")]),e._v(" "),s("p",[e._v("å‡è®¾é›†ç¾¤ç”± 5 å°æœºå™¨ç»„æˆ, SID åˆ†åˆ«ä¸º 1, 2, 3, 4, 5, ZXID åˆ†åˆ«ä¸º 9, 9, 9, 8, 8, å¹¶ä¸”æ­¤æ—¶ SID ä¸º 2 çš„æœºå™¨æ˜¯ Leader æœºå™¨, æŸä¸€æ—¶åˆ», 1, 2 æ‰€åœ¨æœºå™¨å‡ºç°æ•…éšœ, å› æ­¤é›†ç¾¤å¼€å§‹è¿›è¡Œ Leader é€‰ä¸¾. åœ¨ç¬¬ä¸€æ¬¡æŠ•ç¥¨æ—¶, æ¯å°æœºå™¨éƒ½ä¼šå°†"),s("strong",[e._v("è‡ªå·±")]),e._v("ä½œä¸ºæŠ•ç¥¨å¯¹è±¡, äºæ˜¯ SID ä¸º 3, 4, 5 çš„æœºå™¨æŠ•ç¥¨æƒ…å†µåˆ†åˆ«ä¸º (3, 9), (4, 8), (5, 8).")]),e._v(" "),s("blockquote",[s("p",[e._v("2.å˜æ›´æŠ•ç¥¨")])]),e._v(" "),s("p",[e._v("æ¯å°æœºå™¨å‘å‡ºæŠ•ç¥¨å, ä¹Ÿä¼š"),s("strong",[e._v("æ”¶åˆ°")]),e._v("å…¶ä»–æœºå™¨çš„æŠ•ç¥¨, æ¯å°æœºå™¨ä¼šæ ¹æ®ä¸€å®šè§„åˆ™æ¥å¤„ç†æ”¶åˆ°çš„å…¶ä»–æœºå™¨çš„æŠ•ç¥¨, å¹¶ä»¥æ­¤æ¥å†³å®šæ˜¯å¦éœ€è¦å˜æ›´è‡ªå·±çš„æŠ•ç¥¨, è¿™ä¸ªè§„åˆ™ä¹Ÿæ˜¯æ•´ä¸ª Leader é€‰ä¸¾ç®—æ³•çš„æ ¸å¿ƒæ‰€åœ¨, å…¶æè¿°å¦‚ä¸‹:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("vote_sid")]),e._v(": æ¥æ”¶åˆ°çš„æŠ•ç¥¨ä¸­æ‰€æ¨ä¸¾ Leader æœåŠ¡å™¨çš„ SID.")]),e._v(" "),s("li",[s("strong",[e._v("vote_zxid")]),e._v(": æ¥æ”¶åˆ°çš„æŠ•ç¥¨ä¸­æ‰€æ¨ä¸¾ Leader æœåŠ¡å™¨çš„ ZXID.")]),e._v(" "),s("li",[s("strong",[e._v("self_sid")]),e._v(": å½“å‰æœåŠ¡å™¨è‡ªå·±çš„ SID.")]),e._v(" "),s("li",[s("strong",[e._v("self_zxid")]),e._v(": å½“å‰æœåŠ¡å™¨è‡ªå·±çš„ ZXID.")])]),e._v(" "),s("p",[e._v("æ¯æ¬¡å¯¹æ”¶åˆ°çš„æŠ•ç¥¨çš„å¤„ç†, éƒ½æ˜¯å¯¹  "),s("strong",[e._v("(vote_sid, vote_zxid)")]),e._v("  å’Œ  "),s("strong",[e._v("(self_sid, self_zxid)")]),e._v("  è¿›è¡Œå¯¹æ¯”çš„è¿‡ç¨‹.")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("è§„åˆ™ä¸€")]),e._v(": å¦‚æœ vote_zxid å¤§äº self_zxid, å°±è®¤å¯å½“å‰æ”¶åˆ°çš„æŠ•ç¥¨, å¹¶å†æ¬¡å°†è¯¥æŠ•ç¥¨å‘é€å‡ºå».")]),e._v(" "),s("li",[s("strong",[e._v("è§„åˆ™äºŒ")]),e._v(": å¦‚æœ vote_zxid å°äº self_zxid, é‚£ä¹ˆåšæŒè‡ªå·±çš„æŠ•ç¥¨, ä¸åšä»»ä½•å˜æ›´.")]),e._v(" "),s("li",[s("strong",[e._v("è§„åˆ™ä¸‰")]),e._v(": å¦‚æœ vote_zxid ç­‰äº self_zxid, é‚£ä¹ˆå°±å¯¹æ¯”ä¸¤è€…çš„ SID, å¦‚æœ vote_sid å¤§äº self_sid, é‚£ä¹ˆå°±è®¤å¯å½“å‰æ”¶åˆ°çš„æŠ•ç¥¨, å¹¶å†æ¬¡å°†è¯¥æŠ•ç¥¨å‘é€å‡ºå».")]),e._v(" "),s("li",[s("strong",[e._v("è§„åˆ™å››")]),e._v(": å¦‚æœ vote_zxid ç­‰äº self_zxid, å¹¶ä¸” vote_sid å°äº self_sid, é‚£ä¹ˆåšæŒè‡ªå·±çš„æŠ•ç¥¨, ä¸åšä»»ä½•å˜æ›´.")])]),e._v(" "),s("p",[e._v("ç®€è€Œè¨€ä¹‹å°±æ˜¯: "),s("mark",[s("strong",[e._v("ZXID å¤§çš„ä¼˜å…ˆ, ZXID ç›¸åŒæ—¶ SID å¤§çš„ä¼˜å…ˆ")])]),e._v(".")]),e._v(" "),s("p",[e._v("ç»“åˆä¸Šé¢è§„åˆ™, ç»™å‡ºä¸‹é¢çš„é›†ç¾¤å˜æ›´è¿‡ç¨‹.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220107210442583.png",alt:"image-20220107210442583"}})]),e._v(" "),s("blockquote",[s("p",[e._v("3.ç¡®å®šLeader")])]),e._v(" "),s("p",[e._v("ç»è¿‡ç¬¬äºŒè½®æŠ•ç¥¨å, é›†ç¾¤ä¸­çš„æ¯å°æœºå™¨éƒ½ä¼šå†æ¬¡æ¥æ”¶åˆ°å…¶ä»–æœºå™¨çš„æŠ•ç¥¨, ç„¶åå¼€å§‹ç»Ÿè®¡æŠ•ç¥¨, å¦‚æœä¸€å°æœºå™¨æ”¶åˆ°äº†"),s("strong",[e._v("è¶…è¿‡åŠæ•°")]),e._v("çš„ç›¸åŒæŠ•ç¥¨, é‚£ä¹ˆè¿™ä¸ªæŠ•ç¥¨å¯¹åº”çš„ SID æœºå™¨å³ä¸º Leader. æ­¤æ—¶ Server3 å°†æˆä¸º Leader.")]),e._v(" "),s("p",[e._v("ç”±ä¸Šé¢è§„åˆ™å¯çŸ¥, "),s("mark",[s("strong",[e._v("é€šå¸¸å“ªå°æœåŠ¡å™¨ä¸Šçš„æ•°æ®è¶Šæ–°(ZXID ä¼šè¶Šå¤§), å…¶æˆä¸º Leader çš„å¯èƒ½æ€§è¶Šå¤§, ä¹Ÿå°±è¶Šèƒ½å¤Ÿä¿è¯æ•°æ®çš„æ¢å¤. å¦‚æœ ZXID ç›¸åŒ, åˆ™ SID è¶Šå¤§æœºä¼šè¶Šå¤§")])]),e._v(".")]),e._v(" "),s("h5",{attrs:{id:"_4-leaderé€‰ä¸¾å®ç°ç»†èŠ‚"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-leaderé€‰ä¸¾å®ç°ç»†èŠ‚"}},[e._v("#")]),e._v(" 4.Leaderé€‰ä¸¾å®ç°ç»†èŠ‚")]),e._v(" "),s("h6",{attrs:{id:"_1-æœåŠ¡å™¨çŠ¶æ€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-æœåŠ¡å™¨çŠ¶æ€"}},[e._v("#")]),e._v(" (1)æœåŠ¡å™¨çŠ¶æ€")]),e._v(" "),s("p",[e._v("æœåŠ¡å™¨å…·æœ‰"),s("strong",[e._v("å››ç§çŠ¶æ€")]),e._v(", åˆ†åˆ«æ˜¯ LOOKING, FOLLOWING, LEADING, OBSERVING.")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("LOOKING")]),e._v(": å¯»æ‰¾ Leader çŠ¶æ€. å½“æœåŠ¡å™¨å¤„äºè¯¥çŠ¶æ€æ—¶, å®ƒä¼šè®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰ Leader, å› æ­¤éœ€è¦è¿›å…¥ Leader é€‰ä¸¾çŠ¶æ€.")]),e._v(" "),s("li",[s("strong",[e._v("FOLLOWING")]),e._v(": è·Ÿéšè€…çŠ¶æ€. è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Follower.")]),e._v(" "),s("li",[s("strong",[e._v("LEADING")]),e._v(": é¢†å¯¼è€…çŠ¶æ€. è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Leader.")]),e._v(" "),s("li",[s("strong",[e._v("OBSERVING")]),e._v(": è§‚å¯Ÿè€…çŠ¶æ€. è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Observer.")])]),e._v(" "),s("h6",{attrs:{id:"_2-æŠ•ç¥¨æ•°æ®ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-æŠ•ç¥¨æ•°æ®ç»“æ„"}},[e._v("#")]),e._v(" (2)æŠ•ç¥¨æ•°æ®ç»“æ„")]),e._v(" "),s("p",[e._v("æ¯ä¸ªæŠ•ç¥¨ä¸­åŒ…å«äº†ä¸¤ä¸ªæœ€åŸºæœ¬çš„ä¿¡æ¯, æ‰€æ¨ä¸¾æœåŠ¡å™¨çš„ "),s("strong",[e._v("SID å’Œ ZXID")]),e._v(", æŠ•ç¥¨(Vote) åœ¨ ZK ä¸­åŒ…å«å­—æ®µå¦‚ä¸‹:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("id")]),e._v(": è¢«æ¨ä¸¾çš„ Leader çš„ SID.")]),e._v(" "),s("li",[s("strong",[e._v("zxid")]),e._v(": è¢«æ¨ä¸¾çš„ Leader äº‹åŠ¡ ID.")]),e._v(" "),s("li",[s("strong",[e._v("electionEpoch")]),e._v(": é€»è¾‘æ—¶é’Ÿ, ç”¨æ¥åˆ¤æ–­å¤šä¸ªæŠ•ç¥¨æ˜¯å¦åœ¨"),s("strong",[e._v("åŒä¸€è½®é€‰ä¸¾å‘¨æœŸ")]),e._v("ä¸­, è¯¥å€¼åœ¨æœåŠ¡ç«¯æ˜¯ä¸€ä¸ªè‡ªå¢åºåˆ—, æ¯æ¬¡è¿›å…¥æ–°ä¸€è½®çš„æŠ•ç¥¨å, éƒ½ä¼šå¯¹è¯¥å€¼è¿›è¡ŒåŠ  1 æ“ä½œ.")]),e._v(" "),s("li",[s("strong",[e._v("peerEpoch")]),e._v(": è¢«æ¨ä¸¾çš„ Leader çš„ epoch.")]),e._v(" "),s("li",[s("strong",[e._v("state")]),e._v(": å½“å‰æœåŠ¡å™¨çš„çŠ¶æ€.")])]),e._v(" "),s("h6",{attrs:{id:"_3-quorumcnxmanager-ç½‘ç»œi-o"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-quorumcnxmanager-ç½‘ç»œi-o"}},[e._v("#")]),e._v(" (3)QuorumCnxManager(ç½‘ç»œI/O)")]),e._v(" "),s("p",[e._v("æ¯å°æœåŠ¡å™¨åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­, ä¼šå¯åŠ¨ä¸€ä¸ª QuorumPeerManager, è´Ÿè´£å„å°æœåŠ¡å™¨ä¹‹é—´çš„åº•å±‚ Leader é€‰ä¸¾è¿‡ç¨‹ä¸­çš„ç½‘ç»œé€šä¿¡.")]),e._v(" "),s("blockquote",[s("p",[e._v("1.æ¶ˆæ¯é˜Ÿåˆ—")])]),e._v(" "),s("p",[e._v("QuorumCnxManager å†…éƒ¨ç»´æŠ¤äº†ä¸€ç³»åˆ—çš„é˜Ÿåˆ—, ç”¨æ¥ä¿å­˜æ¥æ”¶åˆ°çš„, å¾…å‘é€çš„æ¶ˆæ¯ä»¥åŠæ¶ˆæ¯çš„å‘é€å™¨, é™¤æ¥æ”¶é˜Ÿåˆ—ä»¥å¤–, å…¶ä»–é˜Ÿåˆ—éƒ½æŒ‰ç…§ SID åˆ†ç»„å½¢æˆé˜Ÿåˆ—é›†åˆ, å¦‚ä¸€ä¸ªé›†ç¾¤ä¸­é™¤äº†è‡ªèº«è¿˜æœ‰ 3 å°æœºå™¨, é‚£ä¹ˆå°±ä¼šä¸ºè¿™ 3 å°æœºå™¨åˆ†åˆ«åˆ›å»ºä¸€ä¸ªå‘é€é˜Ÿåˆ—, äº’ä¸å¹²æ‰°.")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("recvQueue")]),e._v(": æ¶ˆæ¯æ¥æ”¶é˜Ÿåˆ—, ç”¨äºå­˜æ”¾é‚£äº›ä»å…¶ä»–æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¶ˆæ¯.")]),e._v(" "),s("li",[s("strong",[e._v("queueSendMap")]),e._v(": æ¶ˆæ¯å‘é€é˜Ÿåˆ—, ç”¨äºä¿å­˜é‚£äº›å¾…å‘é€çš„æ¶ˆæ¯, æŒ‰ç…§ SID è¿›è¡Œåˆ†ç»„.")]),e._v(" "),s("li",[s("strong",[e._v("senderWorkerMap")]),e._v(": å‘é€å™¨é›†åˆ, æ¯ä¸ª SenderWorker æ¶ˆæ¯å‘é€å™¨, éƒ½å¯¹åº”ä¸€å°è¿œç¨‹ ZK æœåŠ¡å™¨, è´Ÿè´£æ¶ˆæ¯çš„å‘é€, ä¹ŸæŒ‰ç…§ SID è¿›è¡Œåˆ†ç»„.")]),e._v(" "),s("li",[s("strong",[e._v("lastMessageSent")]),e._v(": æœ€è¿‘å‘é€è¿‡çš„æ¶ˆæ¯, ä¸ºæ¯ä¸ª SID ä¿ç•™æœ€è¿‘å‘é€è¿‡çš„ä¸€ä¸ªæ¶ˆæ¯.")])]),e._v(" "),s("blockquote",[s("p",[e._v("2.å»ºç«‹è¿æ¥")])]),e._v(" "),s("p",[e._v("ä¸ºäº†èƒ½å¤Ÿç›¸äº’æŠ•ç¥¨, ZK é›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨éƒ½éœ€è¦ä¸¤ä¸¤å»ºç«‹ç½‘ç»œè¿æ¥. QuorumCnxManager åœ¨å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ª ServerSocket æ¥ç›‘å¬ Leader é€‰ä¸¾çš„é€šä¿¡ç«¯å£(é»˜è®¤ä¸º 3888). å¼€å¯ç›‘å¬å, ZK èƒ½å¤Ÿä¸æ–­åœ°æ¥æ”¶åˆ°æ¥è‡ªå…¶ä»–æœåŠ¡å™¨çš„åˆ›å»ºè¿æ¥è¯·æ±‚, åœ¨æ¥æ”¶åˆ°å…¶ä»–æœåŠ¡å™¨çš„ TCP è¿æ¥è¯·æ±‚æ—¶, ä¼šè¿›è¡Œå¤„ç†. ä¸€æ—¦è¿æ¥å»ºç«‹, å°±ä¼šæ ¹æ®è¿œç¨‹æœåŠ¡å™¨çš„ SID æ¥åˆ›å»ºç›¸åº”çš„æ¶ˆæ¯å‘é€å™¨ SendWorker å’Œæ¶ˆæ¯æ¥æ”¶å™¨ RecvWorker, å¹¶å¯åŠ¨.")]),e._v(" "),s("blockquote",[s("p",[e._v("3.æ¶ˆæ¯æ¥æ”¶ä¸å‘é€")])]),e._v(" "),s("p",[s("strong",[e._v("æ¶ˆæ¯æ¥æ”¶")]),e._v(": ç”±æ¶ˆæ¯æ¥æ”¶å™¨ RecvWorker è´Ÿè´£, ç”±äº Zookeeper ä¸ºæ¯ä¸ªè¿œç¨‹æœåŠ¡å™¨éƒ½åˆ†é…ä¸€ä¸ªå•ç‹¬çš„ RecvWorker, å› æ­¤æ¯ä¸ª RecvWorker åªéœ€è¦ä¸æ–­åœ°ä»è¿™ä¸ª TCP è¿æ¥ä¸­è¯»å–æ¶ˆæ¯, å¹¶å°†å…¶ä¿å­˜åˆ° recvQueue é˜Ÿåˆ—ä¸­.")]),e._v(" "),s("p",[s("strong",[e._v("æ¶ˆæ¯å‘é€")]),e._v(": ç”±äº ZK ä¸ºæ¯ä¸ªè¿œç¨‹æœåŠ¡å™¨éƒ½åˆ†é…ä¸€ä¸ªå•ç‹¬çš„ SendWorker, å› æ­¤æ¯ä¸ª SendWorker åªéœ€è¦ä¸æ–­åœ°ä»å¯¹åº”çš„æ¶ˆæ¯å‘é€é˜Ÿåˆ—ä¸­è·å–å‡ºä¸€ä¸ªæ¶ˆæ¯å‘é€å³å¯, åŒæ—¶å°†è¿™ä¸ªæ¶ˆæ¯æ”¾å…¥ lastMessageSent ä¸­. åœ¨ SendWorker ä¸­, ä¸€æ—¦ Zookeeper å‘ç°é’ˆå¯¹å½“å‰æœåŠ¡å™¨çš„æ¶ˆæ¯å‘é€é˜Ÿåˆ—ä¸ºç©º, é‚£ä¹ˆæ­¤æ—¶éœ€è¦ä» lastMessageSent ä¸­å–å‡ºä¸€ä¸ªæœ€è¿‘å‘é€è¿‡çš„æ¶ˆæ¯æ¥è¿›è¡Œå†æ¬¡å‘é€, è¿™æ˜¯ä¸ºäº†è§£å†³æ¥æ”¶æ–¹åœ¨æ¶ˆæ¯æ¥æ”¶å‰æˆ–è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæœåŠ¡å™¨æŒ‚äº†, å¯¼è‡´æ¶ˆæ¯å°šæœªè¢«æ­£ç¡®å¤„ç†.")]),e._v(" "),s("h6",{attrs:{id:"_4-fastleaderelection-é€‰ä¸¾ç®—æ³•æ ¸å¿ƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-fastleaderelection-é€‰ä¸¾ç®—æ³•æ ¸å¿ƒ"}},[e._v("#")]),e._v(" (4)FastLeaderElection(é€‰ä¸¾ç®—æ³•æ ¸å¿ƒ)")]),e._v(" "),s("p",[e._v("å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µ:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("å¤–éƒ¨æŠ•ç¥¨")]),e._v(": ç‰¹æŒ‡å…¶ä»–æœåŠ¡å™¨å‘æ¥çš„æŠ•ç¥¨.")]),e._v(" "),s("li",[s("strong",[e._v("å†…éƒ¨æŠ•ç¥¨")]),e._v(": æœåŠ¡å™¨è‡ªèº«å½“å‰çš„æŠ•ç¥¨.")]),e._v(" "),s("li",[s("strong",[e._v("é€‰ä¸¾è½®æ¬¡")]),e._v(": Leader é€‰ä¸¾çš„è½®æ¬¡, å³ logicalclock.")]),e._v(" "),s("li",[s("strong",[e._v("PK")]),e._v(": å¯¹å†…éƒ¨æŠ•ç¥¨å’Œå¤–éƒ¨æŠ•ç¥¨è¿›è¡Œå¯¹æ¯”æ¥ç¡®å®šæ˜¯å¦éœ€è¦å˜æ›´å†…éƒ¨æŠ•ç¥¨.")])]),e._v(" "),s("blockquote",[s("p",[e._v("1.é€‰ç¥¨ç®¡ç†")])]),e._v(" "),s("p",[e._v("ä¸‹å›¾æ˜¯é€‰ç¥¨ç®¡ç†è¿‡ç¨‹ä¸­ç›¸å…³ç»„ä»¶ä¹‹é—´çš„åä½œå…³ç³».")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220107210956395.png",alt:""}})]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("sendqueue")]),e._v(": é€‰ç¥¨å‘é€é˜Ÿåˆ—, ç”¨äºä¿å­˜å¾…å‘é€çš„é€‰ç¥¨.")]),e._v(" "),s("li",[s("strong",[e._v("recvqueue")]),e._v(": é€‰ç¥¨æ¥æ”¶é˜Ÿåˆ—, ç”¨äºä¿å­˜æ¥æ”¶åˆ°çš„å¤–éƒ¨æŠ•ç¥¨.")]),e._v(" "),s("li",[s("strong",[e._v("WorkerReceiver")]),e._v(": é€‰ç¥¨æ¥æ”¶å™¨. å…¶ä¼šä¸æ–­åœ°ä» QuorumCnxManager ä¸­è·å–å…¶ä»–æœåŠ¡å™¨å‘æ¥çš„é€‰ä¸¾æ¶ˆæ¯, å¹¶å°†å…¶è½¬æ¢æˆä¸€ä¸ªé€‰ç¥¨, ç„¶åä¿å­˜åˆ° recvqueue ä¸­, åœ¨é€‰ç¥¨æ¥æ”¶è¿‡ç¨‹ä¸­, å¦‚æœå‘ç°è¯¥å¤–éƒ¨é€‰ç¥¨çš„é€‰ä¸¾è½®æ¬¡å°äºå½“å‰æœåŠ¡å™¨çš„, é‚£ä¹ˆå¿½ç•¥è¯¥å¤–éƒ¨æŠ•ç¥¨, åŒæ—¶ç«‹å³å‘é€è‡ªå·±çš„å†…éƒ¨æŠ•ç¥¨.")]),e._v(" "),s("li",[s("strong",[e._v("WorkerSender")]),e._v(": é€‰ç¥¨å‘é€å™¨, ä¸æ–­åœ°ä» sendqueue ä¸­è·å–å¾…å‘é€çš„é€‰ç¥¨, å¹¶å°†å…¶ä¼ é€’åˆ°åº•å±‚ QuorumCnxManager ä¸­.")])]),e._v(" "),s("blockquote",[s("p",[e._v("2.ç®—æ³•æ ¸å¿ƒ")])]),e._v(" "),s("p",[e._v("ä¸Šå›¾å±•ç¤ºäº† FastLeaderElection æ¨¡å—æ˜¯å¦‚ä½•ä¸åº•å±‚ç½‘ç»œ I/O è¿›è¡Œäº¤äº’çš„. Leader é€‰ä¸¾çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹:")]),e._v(" "),s("p",[e._v("(1) ** è‡ªå¢é€‰ä¸¾è½®æ¬¡**. Zookeeper è§„å®šæ‰€æœ‰æœ‰æ•ˆçš„æŠ•ç¥¨éƒ½å¿…é¡»åœ¨åŒä¸€è½®æ¬¡ä¸­, åœ¨å¼€å§‹æ–°ä¸€è½®æŠ•ç¥¨æ—¶, ä¼šé¦–å…ˆå¯¹ logicalclock è¿›è¡Œè‡ªå¢æ“ä½œ.")]),e._v(" "),s("p",[e._v("(2) ** åˆå§‹åŒ–é€‰ç¥¨**. åœ¨å¼€å§‹è¿›è¡Œæ–°ä¸€è½®æŠ•ç¥¨ä¹‹å‰, æ¯ä¸ªæœåŠ¡å™¨éƒ½ä¼šåˆå§‹åŒ–è‡ªèº«çš„é€‰ç¥¨, æ¯å°æœåŠ¡å™¨åœ¨åˆå§‹åŒ–é˜¶æ®µéƒ½ä¼šå°†è‡ªå·±æ¨ä¸¾ä¸º Leader.")]),e._v(" "),s("p",[e._v("(3) ** å‘é€åˆå§‹åŒ–é€‰ç¥¨**. å®Œæˆé€‰ç¥¨çš„åˆå§‹åŒ–å, æœåŠ¡å™¨å°±ä¼šå‘èµ·ç¬¬ä¸€æ¬¡æŠ•ç¥¨. ZK ä¼šå°†åˆšåˆšåˆå§‹åŒ–å¥½çš„é€‰ç¥¨æ”¾å…¥ sendqueue ä¸­, ç”±å‘é€å™¨ WorkerSender å‘é€å‡ºå».")]),e._v(" "),s("p",[e._v("(4) ** æ¥æ”¶å¤–éƒ¨æŠ•ç¥¨**. æ¯å°æœåŠ¡å™¨ä¼šä¸æ–­ä» recvqueue é˜Ÿåˆ—ä¸­è·å–å¤–éƒ¨é€‰ç¥¨.")]),e._v(" "),s("p",[e._v("(5) ** åˆ¤æ–­é€‰ä¸¾è½®æ¬¡**. åœ¨å‘é€å®Œåˆå§‹åŒ–é€‰ç¥¨ä¹‹å, æ¥ç€å¼€å§‹å¤„ç†å¤–éƒ¨æŠ•ç¥¨. åœ¨å¤„ç†å¤–éƒ¨æŠ•ç¥¨æ—¶, ä¼šæ ¹æ®"),s("strong",[e._v("é€‰ä¸¾è½®æ¬¡")]),e._v("æ¥è¿›è¡Œä¸åŒçš„å¤„ç†.")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("å¤–éƒ¨æŠ•ç¥¨çš„é€‰ä¸¾è½®æ¬¡å¤§äºå†…éƒ¨æŠ•ç¥¨")]),e._v(". è‹¥æœåŠ¡å™¨è‡ªèº«çš„é€‰ä¸¾è½®æ¬¡è½åäºè¯¥å¤–éƒ¨æŠ•ç¥¨å¯¹åº”æœåŠ¡å™¨çš„é€‰ä¸¾è½®æ¬¡, é‚£ä¹ˆå°±ä¼šç«‹å³"),s("strong",[e._v("æ›´æ–°è‡ªå·±çš„é€‰ä¸¾è½®æ¬¡")]),e._v("(logicalclock), å¹¶æ¸…ç©ºæ‰€æœ‰å·²ç»æ”¶åˆ°çš„æŠ•ç¥¨, ç„¶åä½¿ç”¨åˆå§‹åŒ–çš„æŠ•ç¥¨æ¥è¿›è¡Œ PK ä»¥ç¡®å®šæ˜¯å¦å˜æ›´å†…éƒ¨æŠ•ç¥¨. æœ€ç»ˆå†å°†å†…éƒ¨æŠ•ç¥¨å‘é€å‡ºå».")]),e._v(" "),s("li",[s("strong",[e._v("å¤–éƒ¨æŠ•ç¥¨çš„é€‰ä¸¾è½®æ¬¡å°äºå†…éƒ¨æŠ•ç¥¨")]),e._v(". è‹¥æœåŠ¡å™¨æ¥æ”¶çš„å¤–é€‰ç¥¨çš„é€‰ä¸¾è½®æ¬¡è½åäºè‡ªèº«çš„é€‰ä¸¾è½®æ¬¡, é‚£ä¹ˆ ZK å°±ä¼šç›´æ¥"),s("strong",[e._v("å¿½ç•¥è¯¥å¤–éƒ¨æŠ•ç¥¨")]),e._v(", ä¸åšä»»ä½•å¤„ç†, å¹¶è¿”å›æ­¥éª¤ 4.")]),e._v(" "),s("li",[s("strong",[e._v("å¤–éƒ¨æŠ•ç¥¨çš„é€‰ä¸¾è½®æ¬¡ç­‰äºå†…éƒ¨æŠ•ç¥¨")]),e._v(". æ­¤æ—¶å¯ä»¥å¼€å§‹è¿›è¡Œé€‰ç¥¨ PK.")])]),e._v(" "),s("p",[e._v("(6) ** é€‰ç¥¨PK**. åœ¨è¿›è¡Œé€‰ç¥¨ PK æ—¶, ç¬¦åˆä»»æ„ä¸€ä¸ªæ¡ä»¶å°±éœ€è¦å˜æ›´æŠ•ç¥¨.")]),e._v(" "),s("ul",[s("li",[e._v("è‹¥å¤–éƒ¨æŠ•ç¥¨ä¸­æ¨ä¸¾çš„ Leader æœåŠ¡å™¨çš„"),s("strong",[e._v("é€‰ä¸¾è½®æ¬¡")]),e._v("å¤§äºå†…éƒ¨æŠ•ç¥¨, é‚£ä¹ˆéœ€è¦å˜æ›´æŠ•ç¥¨.")]),e._v(" "),s("li",[e._v("è‹¥é€‰ä¸¾è½®æ¬¡ä¸€è‡´, é‚£ä¹ˆå°±å¯¹æ¯”ä¸¤è€…çš„ ZXID, è‹¥å¤–éƒ¨æŠ•ç¥¨çš„ ZXID å¤§, é‚£ä¹ˆéœ€è¦å˜æ›´æŠ•ç¥¨.")]),e._v(" "),s("li",[e._v("è‹¥ä¸¤è€…çš„ ZXID ä¸€è‡´, é‚£ä¹ˆå°±å¯¹æ¯”ä¸¤è€…çš„ SID, è‹¥å¤–éƒ¨æŠ•ç¥¨çš„ SID å¤§, é‚£ä¹ˆå°±éœ€è¦å˜æ›´æŠ•ç¥¨.")])]),e._v(" "),s("p",[e._v("(7) ** å˜æ›´æŠ•ç¥¨**. ç»è¿‡ PK å, è‹¥ç¡®å®šäº†å¤–éƒ¨æŠ•ç¥¨ä¼˜äºå†…éƒ¨æŠ•ç¥¨, é‚£ä¹ˆå°±å˜æ›´æŠ•ç¥¨, å³ä½¿ç”¨å¤–éƒ¨æŠ•ç¥¨çš„é€‰ç¥¨ä¿¡æ¯æ¥è¦†ç›–å†…éƒ¨æŠ•ç¥¨, å˜æ›´å®Œæˆå, å†æ¬¡å°†è¿™ä¸ªå˜æ›´åçš„å†…éƒ¨æŠ•ç¥¨å‘é€å‡ºå».")]),e._v(" "),s("p",[e._v("(8) ** é€‰ç¥¨å½’æ¡£**. æ— è®ºæ˜¯å¦å˜æ›´äº†æŠ•ç¥¨, éƒ½ä¼šå°†åˆšåˆšæ”¶åˆ°çš„é‚£ä»½å¤–éƒ¨æŠ•ç¥¨æ”¾å…¥é€‰ç¥¨é›†åˆ recvset ä¸­è¿›è¡Œå½’æ¡£. recvset ç”¨äºè®°å½•å½“å‰æœåŠ¡å™¨åœ¨æœ¬è½®æ¬¡çš„ Leader é€‰ä¸¾ä¸­æ”¶åˆ°çš„æ‰€æœ‰å¤–éƒ¨æŠ•ç¥¨ (æŒ‰ç…§æœåŠ¡é˜Ÿçš„ SID åŒºåˆ«, å¦‚ {(1, vote1), (2, vote2)...}).")]),e._v(" "),s("p",[e._v("(9) ** ç»Ÿè®¡æŠ•ç¥¨**. å®Œæˆé€‰ç¥¨å½’æ¡£å, å°±å¯ä»¥å¼€å§‹ç»Ÿè®¡æŠ•ç¥¨, ç»Ÿè®¡æŠ•ç¥¨æ˜¯ä¸ºäº†ç»Ÿè®¡é›†ç¾¤ä¸­æ˜¯å¦å·²ç»æœ‰è¿‡åŠçš„æœåŠ¡å™¨è®¤å¯äº†å½“å‰çš„å†…éƒ¨æŠ•ç¥¨, å¦‚æœç¡®å®šå·²ç»æœ‰è¿‡åŠæœåŠ¡å™¨è®¤å¯äº†è¯¥æŠ•ç¥¨, åˆ™ç»ˆæ­¢æŠ•ç¥¨. å¦åˆ™è¿”å›æ­¥éª¤ 4.")]),e._v(" "),s("p",[e._v("(10) ** æ›´æ–°æœåŠ¡å™¨çŠ¶æ€**. è‹¥å·²ç»ç¡®å®šå¯ä»¥ç»ˆæ­¢æŠ•ç¥¨, é‚£ä¹ˆå°±å¼€å§‹æ›´æ–°æœåŠ¡å™¨çŠ¶æ€, æœåŠ¡å™¨é¦–é€‰åˆ¤æ–­å½“å‰è¢«è¿‡åŠæœåŠ¡å™¨è®¤å¯çš„æŠ•ç¥¨æ‰€å¯¹åº”çš„ Leader æœåŠ¡å™¨æ˜¯å¦æ˜¯è‡ªå·±, è‹¥æ˜¯è‡ªå·±, åˆ™å°†è‡ªå·±çš„æœåŠ¡å™¨çŠ¶æ€æ›´æ–°ä¸º LEADING, è‹¥ä¸æ˜¯, åˆ™æ ¹æ®å…·ä½“æƒ…å†µæ¥ç¡®å®šè‡ªå·±æ˜¯ FOLLOWING æˆ–æ˜¯ OBSERVING.")]),e._v(" "),s("p",[e._v("ä»¥ä¸Š 10 ä¸ªæ­¥éª¤å°±æ˜¯ FastLeaderElection çš„æ ¸å¿ƒ, å…¶ä¸­æ­¥éª¤ 4-9 ä¼šç»è¿‡å‡ è½®å¾ªç¯, ç›´åˆ°æœ‰ Leader é€‰ä¸¾äº§ç”Ÿ.")]),e._v(" "),s("h5",{attrs:{id:"_5-æ•°æ®åŒæ­¥æœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ•°æ®åŒæ­¥æœºåˆ¶"}},[e._v("#")]),e._v(" 5.æ•°æ®åŒæ­¥æœºåˆ¶")]),e._v(" "),s("p",[e._v("ZK çš„æ•°æ®åŒæ­¥æ˜¯ä¸ºäº†ä¿è¯å„ç»“ç‚¹ä¸­çš„"),s("strong",[e._v("æ•°æ®ä¸€è‡´æ€§")]),e._v(", åŒæ­¥æ—¶æ¶‰åŠä¸¤ä¸ªæµç¨‹, ä¸€ä¸ªæ˜¯æ­£å¸¸çš„"),s("strong",[e._v("å®¢æˆ·ç«¯æ•°æ®æäº¤")]),e._v(", å¦ä¸€ä¸ªæ˜¯é›†ç¾¤æŸä¸ªç»“ç‚¹å®•æœºåœ¨æ¢å¤åçš„"),s("strong",[e._v("æ•°æ®åŒæ­¥")]),e._v(".")]),e._v(" "),s("p",[s("strong",[e._v("å®¢æˆ·ç«¯å†™å…¥è¯·æ±‚: å†™å…¥è¯·æ±‚çš„å¤§è‡³æµç¨‹æ˜¯, Leader æ¥æ”¶å®¢æˆ·ç«¯å†™è¯·æ±‚, å¹¶åŒæ­¥ç»™å„ä¸ªå­ç»“ç‚¹")]),e._v(". å¦‚ä¸‹å›¾:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220107211151215.png",alt:""}})]),e._v(" "),s("p",[e._v("ä½†å®é™…æƒ…å†µè¦å¤æ‚çš„å¤š, æ¯”å¦‚ client å¹¶ä¸çŸ¥é“å“ªä¸ªç»“ç‚¹æ˜¯ Leader, æœ‰å¯èƒ½å†™çš„è¯·æ±‚ä¼šå‘ç»™ Follower, ç”± Follower å†"),s("strong",[e._v("è½¬å‘")]),e._v("ç»™ Leader è¿›è¡Œ"),s("strong",[e._v("åŒæ­¥")]),e._v("å¤„ç†.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220107212056670.png",alt:""}})]),e._v(" "),s("p",[e._v("å®¢æˆ·ç«¯"),s("strong",[e._v("å†™å…¥æµç¨‹")]),e._v("è¯´æ˜:")]),e._v(" "),s("ol",[s("li",[e._v("client å‘ ZK ä¸­çš„ server å‘é€å†™è¯·æ±‚, å¦‚æœè¯¥ server ä¸æ˜¯ Leader, åˆ™ä¼šå°†è¯¥å†™"),s("strong",[e._v("è¯·æ±‚è½¬å‘")]),e._v("ç»™ Leader, Leader å°†è¯·æ±‚äº‹åŠ¡ä»¥ "),s("strong",[e._v("proposal")]),e._v(" å½¢å¼åˆ†å‘ç»™ Follower.")]),e._v(" "),s("li",[e._v("å½“ Follower æ”¶åˆ° Leader çš„ proposal æ—¶, æ ¹æ®æ¥æ”¶çš„"),s("strong",[e._v("å…ˆåé¡ºåº")]),e._v("å¤„ç† proposal.")]),e._v(" "),s("li",[e._v("å½“ Leader æ”¶åˆ° Follower é’ˆå¯¹æŸä¸ª proposal "),s("strong",[e._v("è¿‡åŠçš„ ack å")]),e._v(", åˆ™å‘èµ·"),s("strong",[e._v("äº‹åŠ¡æäº¤")]),e._v(", é‡æ–°å‘èµ·ä¸€ä¸ª "),s("strong",[e._v("commit")]),e._v(" çš„ proposal.")]),e._v(" "),s("li",[e._v("Follower æ”¶åˆ° commit çš„ proposal å, "),s("strong",[e._v("è®°å½•äº‹åŠ¡æäº¤")]),e._v(", å¹¶æŠŠæ•°æ®æ›´æ–°åˆ°"),s("strong",[e._v("å†…å­˜æ•°æ®åº“")]),e._v(".")]),e._v(" "),s("li",[e._v("å½“å†™æˆåŠŸå, åé¦ˆç»™ client.")])]),e._v(" "),s("p",[s("strong",[e._v("æœåŠ¡ç»“ç‚¹åˆå§‹åŒ–åŒæ­¥:")])]),e._v(" "),s("p",[e._v("åœ¨é›†ç¾¤è¿è¡Œè¿‡ç¨‹å½“ä¸­å¦‚æœæœ‰ä¸€ä¸ª Follower ç»“ç‚¹å®•æœº, ç”±äºå®•æœºç»“ç‚¹æ²¡è¿‡åŠ, é›†ç¾¤ä»ç„¶èƒ½æ­£å¸¸æœåŠ¡. å½“ Leader æ”¶åˆ°æ–°çš„å®¢æˆ·ç«¯è¯·æ±‚, æ­¤æ—¶æ— æ³•åŒæ­¥ç»™å®•æœºçš„ç»“ç‚¹. é€ æˆæ•°æ®ä¸ä¸€è‡´. ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜, å½“"),s("strong",[e._v("ç»“ç‚¹å¯åŠ¨")]),e._v("æ—¶, ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ‰¾å½“å‰çš„ Leader, æ¯”å¯¹æ•°æ®æ˜¯å¦ä¸€è‡´. å¦‚æœä¸ä¸€è‡´åˆ™å¼€å§‹"),s("strong",[e._v("åŒæ­¥")]),e._v(", åŒæ­¥å®Œæˆä¹‹ååœ¨è¿›è¡Œå¯¹å¤–æä¾›æœåŠ¡.")]),e._v(" "),s("p",[e._v("å¦‚ä½•æ¯”å¯¹ Leader çš„æ•°æ®"),s("strong",[e._v("ç‰ˆæœ¬")]),e._v("å‘¢, è¿™é‡Œé€šè¿‡ "),s("strong",[e._v("ZXID äº‹åŠ¡ ID")]),e._v(" æ¥ç¡®è®¤. æ¯” Leader ä½å°±éœ€è¦åŒæ­¥.")]),e._v(" "),s("p",[s("strong",[e._v("ZXID: "),s("strong",[e._v("â€‹"),s("strong",[s("strong",[e._v("ZXID æ˜¯ä¸€ä¸ªé•¿åº¦ 64 ä½çš„æ•°å­—, å…¶ä¸­ä½ 32 ä½æ˜¯æŒ‰ç…§æ•°å­—é€’å¢, "),s("strong",[s("strong",[e._v("â€‹")])])]),e._v("ä»»ä½•æ•°æ®çš„å˜æ›´")])])]),e._v("â€‹"),s("strong",[s("strong",[e._v("éƒ½ä¼šå¯¼è‡´ä½ 32 ä½çš„æ•°å­—ç®€å•åŠ  1. é«˜ 32 ä½æ˜¯ leader å‘¨æœŸç¼–å·, æ¯å½“é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„ Leader æ—¶, æ–°çš„ Leader å°±ä»æœ¬åœ°äº‹åŠ¡æ—¥å¿—ä¸­å–å‡º ZXID, ç„¶åè§£æå‡ºé«˜ 32 ä½çš„å‘¨æœŸç¼–å·, è¿›è¡Œ")])]),e._v("â€‹"),s("strong",[e._v("åŠ  1")]),e._v(", å†å°†"),s("strong",[e._v("ä½ 32 ä½çš„å…¨éƒ¨è®¾ç½®ä¸º 0")]),e._v(". è¿™æ ·å°±ä¿è¯æ¯æ¬¡"),s("strong",[e._v("æ–°é€‰ä¸¾ Leader å")]),e._v(" ZXID çš„"),s("strong",[e._v("å”¯ä¸€ä¸”é€’å¢")]),e._v(".")]),e._v(" "),s("h4",{attrs:{id:"æ•°æ®ä¸å­˜å‚¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®ä¸å­˜å‚¨"}},[e._v("#")]),e._v(" æ•°æ®ä¸å­˜å‚¨")]),e._v(" "),s("p",[e._v("ZK çš„æ•°æ®æ¨¡å‹æ˜¯æ ‘ç»“æ„, åœ¨"),s("strong",[e._v("å†…å­˜æ•°æ®åº“")]),e._v("å­˜å‚¨äº†æ•´æ£µæ ‘çš„å†…å®¹, åŒ…æ‹¬æ‰€æœ‰ç»“ç‚¹è·¯å¾„, ç»“ç‚¹æ•°æ®, ACL ä¿¡æ¯. ZK ä¼šå®šæ—¶å°†è¿™ä¸ªæ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Š. åœ¨ ZK æœåŠ¡å™¨å¯åŠ¨æœŸé—´, é¦–å…ˆä¼šè¿›è¡Œæ•°æ®åˆå§‹åŒ–å·¥ä½œ, å°†å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ•°æ®æ–‡ä»¶åŠ è½½åˆ°æœåŠ¡å™¨å†…å­˜ä¸­.")]),e._v(" "),s("h5",{attrs:{id:"_1-å†…å­˜æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å†…å­˜æ•°æ®"}},[e._v("#")]),e._v(" 1.å†…å­˜æ•°æ®")]),e._v(" "),s("p",[s("strong",[e._v("DataTree")]),e._v(" æ˜¯å†…å­˜æ•°æ®å­˜å‚¨çš„æ ¸å¿ƒ, æ˜¯ä¸€ä¸ªæ ‘ç»“æ„, "),s("strong",[e._v("ä»£è¡¨äº†å†…å­˜ä¸­ä¸€ä»½å®Œæ•´çš„æ•°æ®")]),e._v(". DataTree ä¸åŒ…å«ä»»ä½•ä¸ç½‘ç»œ, å®¢æˆ·ç«¯è¿æ¥åŠè¯·æ±‚å¤„ç†ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘, æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶.")]),e._v(" "),s("p",[s("strong",[e._v("DataNode æ˜¯æ•°æ®å­˜å‚¨çš„æœ€å°å•å…ƒ")]),e._v(", å…¶å†…éƒ¨é™¤äº†ä¿å­˜äº†ç»“ç‚¹çš„æ•°æ®å†…å®¹, ACL åˆ—è¡¨, ç»“ç‚¹çŠ¶æ€ä¹‹å¤–, è¿˜è®°å½•äº†çˆ¶ç»“ç‚¹çš„å¼•ç”¨å’Œå­ç»“ç‚¹åˆ—è¡¨ä¸¤ä¸ªå±æ€§, å…¶ä¹Ÿæä¾›äº†å¯¹å­ç»“ç‚¹åˆ—è¡¨è¿›è¡Œæ“ä½œçš„æ¥å£.")]),e._v(" "),s("p",[s("strong",[e._v("ZKDatabase")]),e._v(" æ˜¯ ZK çš„å†…å­˜æ•°æ®åº“, ç®¡ç† ZK çš„æ‰€æœ‰ä¼šè¯, DataTree å­˜å‚¨å’Œäº‹åŠ¡æ—¥å¿—. ZKDatabase ä¼šå®šæ—¶å‘ç£ç›˜ dump å¿«ç…§æ•°æ®, åŒæ—¶åœ¨ ZK å¯åŠ¨æ—¶, ä¼šé€šè¿‡ç£ç›˜çš„äº‹åŠ¡æ—¥å¿—å’Œå¿«ç…§æ–‡ä»¶"),s("strong",[e._v("æ¢å¤")]),e._v("æˆä¸€ä¸ªå®Œæ•´çš„å†…å­˜æ•°æ®åº“.")]),e._v(" "),s("h5",{attrs:{id:"_2-äº‹åŠ¡æ—¥å¿—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-äº‹åŠ¡æ—¥å¿—"}},[e._v("#")]),e._v(" 2.äº‹åŠ¡æ—¥å¿—")]),e._v(" "),s("p",[e._v("åœ¨é…ç½® ZK é›†ç¾¤æ—¶éœ€è¦é…ç½® dataDir ç›®å½•, å…¶ç”¨æ¥å­˜å‚¨äº‹åŠ¡æ—¥å¿—æ–‡ä»¶.")]),e._v(" "),s("h5",{attrs:{id:"_3-æ•°æ®å¿«ç…§-snapshot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ•°æ®å¿«ç…§-snapshot"}},[e._v("#")]),e._v(" 3.æ•°æ®å¿«ç…§(snapshot)")]),e._v(" "),s("p",[e._v("æ•°æ®å¿«ç…§æ˜¯ ZK æ•°æ®å­˜å‚¨ä¸­éå¸¸æ ¸å¿ƒçš„è¿è¡Œæœºåˆ¶, æ•°æ®å¿«ç…§ç”¨æ¥è®°å½• ZK æœåŠ¡å™¨ä¸ŠæŸä¸€æ—¶åˆ»çš„"),s("strong",[e._v("å…¨é‡")]),e._v("å†…å­˜æ•°æ®å†…å®¹, å¹¶å°†å…¶å†™å…¥æŒ‡å®šçš„"),s("strong",[e._v("ç£ç›˜")]),e._v("æ–‡ä»¶ä¸­.")]),e._v(" "),s("h3",{attrs:{id:"ä¸‰-zookeeperåº”ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰-zookeeperåº”ç”¨"}},[e._v("#")]),e._v(" ä¸‰.ZooKeeperåº”ç”¨")]),e._v(" "),s("p",[e._v("Zookeeper æ˜¯ä¸€ä¸ªå…¸å‹çš„å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„åˆ†å¸ƒå¼æ•°æ®ç®¡ç†ä¸åè°ƒæ¡†æ¶, åŸºäºåˆ†å¸ƒå¼çš„"),s("strong",[e._v("æ•°æ®å‘å¸ƒä¸è®¢é˜…")]),e._v("å¯ä»¥æœ‰è¯¸å¤šåº”ç”¨åœºæ™¯. å¯ä»¥ç”¨åœ¨"),s("strong",[e._v("åå­—æœåŠ¡, é…ç½®ç®¡ç†, é›†ç¾¤ç®¡ç†, é›†ç¾¤é€‰ä¸¾, åˆ†å¸ƒå¼é”, é˜Ÿåˆ—ç®¡ç†, æ¶ˆæ¯è®¢é˜…")]),e._v(" ç­‰åœºæ™¯.")]),e._v(" "),s("h4",{attrs:{id:"å‘½åæœåŠ¡-æ³¨å†Œä¸­å¿ƒğŸŒŸ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‘½åæœåŠ¡-æ³¨å†Œä¸­å¿ƒğŸŒŸ"}},[e._v("#")]),e._v(" å‘½åæœåŠ¡/æ³¨å†Œä¸­å¿ƒğŸŒŸ")]),e._v(" "),s("p",[e._v("å‘½åæœåŠ¡åŠŸèƒ½ä¸»è¦æ˜¯æ ¹æ®æŒ‡å®šåå­—æ¥è·å–èµ„æºæˆ–æœåŠ¡çš„åœ°å€, æä¾›è€…ç­‰ä¿¡æ¯, åˆ©ç”¨å…¶ znode å’Œ watcher æœºåˆ¶, å°†å…¶ä½œä¸ºåŠ¨æ€æ³¨å†Œå’Œè·å–æœåŠ¡ä¿¡æ¯çš„é…ç½®ä¸­å¿ƒ, ç»Ÿä¸€ç®¡ç†æœåŠ¡åç§°å’Œå…¶å¯¹åº”çš„æœåŠ¡å™¨åˆ—è¡¨ä¿¡æ¯, ç³»ç»Ÿèƒ½å¤Ÿå®æ—¶æ„ŸçŸ¥"),s("strong",[e._v("æœåŠ¡å™¨çš„çŠ¶æ€")]),e._v("(ä¸Šçº¿, ä¸‹çº¿, å®•æœº).")]),e._v(" "),s("p",[e._v("å› æ­¤ ZK å¯ä»¥ä½œä¸º"),s("strong",[e._v("æ³¨å†Œä¸­å¿ƒ")]),e._v(".")]),e._v(" "),s("h5",{attrs:{id:"_1-è´Ÿè½½å‡è¡¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-è´Ÿè½½å‡è¡¡"}},[e._v("#")]),e._v(" 1.è´Ÿè½½å‡è¡¡")]),e._v(" "),s("p",[e._v("è½®è¯¢æœåŠ¡æ³¨å†Œè¡¨, å°½å¯èƒ½å°†æœåŠ¡è¯·æ±‚å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰æ³¨å†Œæœ‰æ•ˆçš„æœåŠ¡å™¨ä¸Š.")]),e._v(" "),s("h5",{attrs:{id:"_2-å¥åº·æ£€æŸ¥-å¿ƒè·³ç›‘æµ‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¥åº·æ£€æŸ¥-å¿ƒè·³ç›‘æµ‹"}},[e._v("#")]),e._v(" 2.å¥åº·æ£€æŸ¥/å¿ƒè·³ç›‘æµ‹")]),e._v(" "),s("p",[e._v("åŠ¨æ€ç»´æŠ¤æœåŠ¡åœ°å€æ³¨å†Œè¡¨, åˆ©ç”¨å¿ƒè·³è¯·æ±‚å®æ—¶ç›‘æ§æ³¨å†ŒæœåŠ¡çŠ¶æ€, åˆ é™¤æ— æ•ˆæœåŠ¡èŠ‚ç‚¹, ç»´æŠ¤æœ‰æ•ˆçš„åœ°å€æ³¨å†Œè¡¨. å¯ä»¥è®©ä¸åŒçš„æœºå™¨éƒ½åœ¨ ZK çš„ä¸€ä¸ªæŒ‡å®šèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹. ä¸åŒæœºå™¨ä¹‹é—´å¯ä»¥æ ¹æ®è¿™ä¸ªä¸´æ—¶èŠ‚ç‚¹æ¥åˆ¤æ–­å¯¹åº”çš„å®¢æˆ·ç«¯æœºå™¨æ˜¯å¦å­˜æ´».")]),e._v(" "),s("h5",{attrs:{id:"_3-è°ƒç”¨ç›‘æ§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-è°ƒç”¨ç›‘æ§"}},[e._v("#")]),e._v(" 3.è°ƒç”¨ç›‘æ§")]),e._v(" "),s("p",[e._v("é€šè¿‡ç»Ÿè®¡æ³¨å†Œè¡¨å„ä¸ªå­èŠ‚ç‚¹è¢«"),s("strong",[e._v("è®¿é—®æ¬¡æ•°")]),e._v("æ¥ç›‘æ§æœåŠ¡è°ƒç”¨æƒ…å†µ.")]),e._v(" "),s("h5",{attrs:{id:"_4-åŠ¨æ€è·¯ç”±"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-åŠ¨æ€è·¯ç”±"}},[e._v("#")]),e._v(" 4.åŠ¨æ€è·¯ç”±")]),e._v(" "),s("p",[e._v("å¯ä»¥é€šè¿‡é…ç½®æ³¨å†Œè¡¨å‚æ•°, åœ¨ä¸ä¿®æ”¹æœåŠ¡ä»£ç çš„æƒ…å†µä¸‹, "),s("strong",[e._v("åŠ¨æ€æŒ‡å®šæœåŠ¡è®¿é—®çš„æœºå™¨")]),e._v(".")]),e._v(" "),s("h5",{attrs:{id:"_5-åŠ¨æ€é…ç½®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-åŠ¨æ€é…ç½®"}},[e._v("#")]),e._v(" 5.åŠ¨æ€é…ç½®")]),e._v(" "),s("p",[e._v("ä¸€èˆ¬å‘å¸ƒè®¢é˜…æœ‰ä¸¤ç§æ¨¡å¼: æ¨æ¨¡å¼å’Œæ‹‰æ¨¡å¼.")]),e._v(" "),s("ul",[s("li",[e._v("**æ¨æ¨¡å¼: ** æœåŠ¡ç«¯ä¸»åŠ¨å°†æ•°æ®æ›´æ–°å‘é€ç»™æ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯.")]),e._v(" "),s("li",[e._v("**æ‹‰æ¨¡å¼: ** å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¯·æ±‚ä»¥å®šæ—¶è½®è¯¢çš„æ–¹å¼è·å–æœ€æ–°æ•°æ®.")])]),e._v(" "),s("p",[e._v("å‘å¸ƒè€…å°†æ•°æ®å‘å¸ƒåˆ° ZK çš„ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ä¸Š, è®¢é˜…è€…è¿›è¡Œæ•°æ®è®¢é˜…ä»¥åŠ¨æ€è·å–æ•°æ®, ä»è€Œå®ç°é…ç½®ä¿¡æ¯çš„é›†ä¸­å¼ç®¡ç†ä¸æ•°æ®çš„åŠ¨æ€æ›´æ–°.")]),e._v(" "),s("p",[e._v("ZK é‡‡å–äº†æ¨æ‹‰ç»“åˆçš„æ¨¡å¼. "),s("strong",[e._v("å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æ³¨å†Œè‡ªå·±éœ€è¦å…³æ³¨çš„èŠ‚ç‚¹, ä¸€æ—¦èŠ‚ç‚¹çš„æ•°æ®å‘ç”Ÿå˜æ›´, é‚£ä¹ˆæœåŠ¡ç«¯å°±ä¼šå‘ç›¸åº”çš„å®¢æˆ·ç«¯å‘é€ Watcher äº‹ä»¶é€šçŸ¥. å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ªé€šçŸ¥ä¹‹å, éœ€è¦ä¸»åŠ¨åˆ°æœåŠ¡ç«¯è·å–æœ€æ–°çš„æ•°æ®")]),e._v(".")]),e._v(" "),s("p",[e._v("é…ç½®ä¸­å¿ƒçš„æ•°æ®æœ‰å‡ ä¸ªç‰¹ç‚¹:")]),e._v(" "),s("ul",[s("li",[e._v("æ•°æ®é‡è¾ƒå°.")]),e._v(" "),s("li",[e._v("æ•°æ®å†…å®¹å¯ä»¥åŠ¨æ€å˜åŒ–.")]),e._v(" "),s("li",[e._v("é›†ç¾¤å¤šä¸ªæœºå™¨å…±äº«é…ç½®ä¿¡æ¯.")])]),e._v(" "),s("p",[e._v("å¯ä»¥æŠŠæ•°æ®åº“çš„é…ç½®ä¿¡æ¯å­˜æ”¾åˆ° Zookeeper ä¸­, æœºå™¨åˆå§‹åŒ–çš„æ—¶å€™å»è¯»å–ä¸€æ¬¡æ•°æ®åº“é…ç½®ä¿¡æ¯, å¹¶åœ¨é…ç½®èŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€ä¸ªç›‘å¬æ•°æ®å˜æ›´çš„ Watcher ç›‘å¬. å¦‚æœé…ç½®ä¿¡æ¯æ”¹å˜, Zookeeper å¯ä»¥å‘ŠçŸ¥æœºå™¨é…ç½®ä¿¡æ¯å‘ç”Ÿå˜æ›´, æœºå™¨é‡æ–°æ‹‰å–é…ç½®ä¿¡æ¯å³å¯.")]),e._v(" "),s("h4",{attrs:{id:"åˆ†å¸ƒå¼é”ğŸŒŸ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†å¸ƒå¼é”ğŸŒŸ"}},[e._v("#")]),e._v(" åˆ†å¸ƒå¼é”ğŸŒŸ")]),e._v(" "),s("p",[e._v("åˆ†å¸ƒå¼é”æ˜¯æ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´åŒæ­¥è®¿é—®å…±äº«èµ„æºçš„ä¸€ç§æ–¹å¼.")]),e._v(" "),s("h5",{attrs:{id:"_1-æ’ä»–é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ’ä»–é”"}},[e._v("#")]),e._v(" 1.æ’ä»–é”")]),e._v(" "),s("p",[e._v("æ’ä»–é”(Exclusive Locks, ç®€ç§° X é”), åˆç§°ä¸º"),s("strong",[e._v("å†™é”æˆ–ç‹¬å é”")]),e._v(". å¦‚æœäº‹åŠ¡ T1 å¯¹æ•°æ®å¯¹è±¡ O1 åŠ ä¸Šäº†æ’ä»–é”, é‚£ä¹ˆæ•´ä¸ªåŠ é”æœŸé—´, åªå…è®¸äº‹åŠ¡ T1 å¯¹ O1 è¿›è¡Œè¯»å–å’Œæ“ä½œ, å…¶ä»–ä»»ä½•äº‹åŠ¡éƒ½ä¸èƒ½å†å¯¹è¿™ä¸ªæ•°æ®å¯¹è±¡è¿›è¡Œè¯»å†™æ“ä½œ, ç›´åˆ°äº‹åŠ¡é‡Šæ”¾äº†æ’ä»–é”.")]),e._v(" "),s("p",[e._v("æ’ä»–é”çš„æ ¸å¿ƒæ˜¯å¦‚ä½•ä¿è¯å½“å‰æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªäº‹åŠ¡è·å¾—é”, å¹¶ä¸”é”è¢«é‡Šæ”¾å, æ‰€æœ‰æ­£åœ¨è·å¾—é”çš„äº‹åŠ¡éƒ½èƒ½è¢«é€šçŸ¥åˆ°.")]),e._v(" "),s("h6",{attrs:{id:"_1-å®šä¹‰é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å®šä¹‰é”"}},[e._v("#")]),e._v(" (1)å®šä¹‰é”")]),e._v(" "),s("p",[e._v("ZK ä¸­é€šè¿‡"),s("strong",[e._v("æ•°æ®èŠ‚ç‚¹")]),e._v("æ¥è¡¨ç¤ºä¸€ä¸ªé”, ä¾‹å¦‚ /exclusive/lock èŠ‚ç‚¹å°±å¯ä»¥è¢«å®šä¹‰ä¸ºä¸€ä¸ªé”.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211120203357763-7638936.png",alt:""}})]),e._v(" "),s("h6",{attrs:{id:"_2-è·å–é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-è·å–é”"}},[e._v("#")]),e._v(" (2)è·å–é”")]),e._v(" "),s("p",[e._v("åœ¨éœ€è¦è·å–é”æ—¶, "),s("strong",[e._v("æ‰€æœ‰ç«äº‰çš„å®¢æˆ·ç«¯")]),e._v("éƒ½ä¼šè¯•å›¾è°ƒç”¨ "),s("strong",[e._v("create()")]),e._v("  æ¥å£, å°è¯•åœ¨ /exclusive èŠ‚ç‚¹ä¸‹åˆ›å»º"),s("mark",[s("strong",[e._v("ä¸´æ—¶å­èŠ‚ç‚¹")])]),e._v(" /exclusive/lock. ZK ä¿è¯æ‰€æœ‰å®¢æˆ·ç«¯æœ€ç»ˆåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½"),s("strong",[e._v("åˆ›å»ºæˆåŠŸ")]),e._v(", å°±å¯ä»¥è®¤ä¸ºè¯¥å®¢æˆ·ç«¯è·å–äº†é”. å…¶ä»–æ²¡è·å–é”çš„å®¢æˆ·ç«¯ä¼šåœ¨ /exclusive èŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€ä¸ªå­èŠ‚ç‚¹å˜æ›´çš„ "),s("strong",[e._v("Watcher ç›‘å¬")]),e._v(", ä»¥ä¾¿å®æ—¶ç›‘å¬åˆ° lock èŠ‚ç‚¹çš„å˜æ›´æƒ…å†µ.")]),e._v(" "),s("h6",{attrs:{id:"_3-é‡Šæ”¾é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-é‡Šæ”¾é”"}},[e._v("#")]),e._v(" (3)é‡Šæ”¾é”")]),e._v(" "),s("p",[e._v("ç”±äº /exclusive/lock æ˜¯ä¸€ä¸ª"),s("mark",[s("strong",[e._v("ä¸´æ—¶èŠ‚ç‚¹")])]),e._v(", å› æ­¤åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹, éƒ½å¯èƒ½é‡Šæ”¾é”.")]),e._v(" "),s("ul",[s("li",[e._v("å½“å‰è·å–é”çš„"),s("strong",[e._v("å®¢æˆ·ç«¯æœºå™¨å‘ç”Ÿå®•æœº, é‚£ä¹ˆæ­¤ä¸´æ—¶èŠ‚ç‚¹å°±ä¼šè¢«ç§»é™¤")]),e._v(".")]),e._v(" "),s("li",[e._v("æ­£å¸¸"),s("strong",[e._v("æ‰§è¡Œå®Œ")]),e._v("ä¸šåŠ¡é€»è¾‘å, å®¢æˆ·ç«¯ä¼šä¸»åŠ¨å°†è‡ªå·±åˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹"),s("strong",[e._v("åˆ é™¤")]),e._v(".")])]),e._v(" "),s("p",[e._v("æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ç§»é™¤äº† /exclusive/lock èŠ‚ç‚¹, Zookeeper éƒ½ä¼š"),s("strong",[e._v("é€šçŸ¥æ‰€æœ‰åœ¨ /exclusive èŠ‚ç‚¹ä¸Šæ³¨å†Œäº†å­èŠ‚ç‚¹å˜æ›´ Watcher ç›‘å¬çš„å®¢æˆ·ç«¯")]),e._v(", å®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥ä¹‹å, å°±ä¼šé‡æ–°å‘èµ·åˆ†å¸ƒå¼é”è·å–, å³"),s("strong",[e._v('é‡å¤ "è·å–é”"')]),e._v("  è¿‡ç¨‹.")]),e._v(" "),s("p",[e._v("æ•´ä¸ªæ’ä»–é”è·å–ä¸é‡Šæ”¾æµç¨‹å¦‚ä¸‹.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211120202211006-7638936.png",alt:"image-20211120202211006"}})]),e._v(" "),s("h5",{attrs:{id:"_2-å…±äº«é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å…±äº«é”"}},[e._v("#")]),e._v(" 2.å…±äº«é”")]),e._v(" "),s("p",[e._v("å…±äº«é”(Shared Locks, ç®€ç§° S é”), åˆç§°"),s("strong",[e._v("è¯»é”")]),e._v(". å¦‚æœäº‹åŠ¡ T1 å¯¹æ•°æ®å¯¹è±¡ O1 åŠ ä¸Šäº†"),s("strong",[e._v("å…±äº«é”")]),e._v(", é‚£ä¹ˆå½“å‰äº‹åŠ¡åªèƒ½å¯¹ O1 è¿›è¡Œ"),s("strong",[e._v("è¯»å–æ“ä½œ")]),e._v(", å…¶ä»–äº‹åŠ¡ä¹Ÿåªèƒ½å¯¹è¿™ä¸ªæ•°æ®å¯¹è±¡åŠ "),s("strong",[e._v("å…±äº«é”")]),e._v(", ç›´åˆ°è¯¥æ•°æ®å¯¹è±¡ä¸Šçš„"),s("strong",[e._v("æ‰€æœ‰å…±äº«é”éƒ½è¢«é‡Šæ”¾")]),e._v(".")]),e._v(" "),s("p",[e._v("å…±äº«é”ä¸æ’ä»–é”çš„æ ¹æœ¬åŒºåˆ«åœ¨äº, "),s("strong",[e._v("åŠ ä¸Šæ’ä»–é”å, æ•°æ®å¯¹è±¡åªå¯¹ä¸€ä¸ªäº‹åŠ¡å¯è§, è€ŒåŠ ä¸Šå…±äº«é”å, æ•°æ®å¯¹æ‰€æœ‰äº‹åŠ¡éƒ½å¯è§")]),e._v(".")]),e._v(" "),s("h6",{attrs:{id:"_1-å®šä¹‰é”-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å®šä¹‰é”-2"}},[e._v("#")]),e._v(" (1)å®šä¹‰é”")]),e._v(" "),s("p",[e._v("åŒæ ·é€šè¿‡ Zookeeper ä¸Šçš„æ•°æ®èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªé”, æ˜¯ä¸€ä¸ªç±»ä¼¼äº  "),s("strong",[e._v("/shared/[Hostname]-è¯·æ±‚ç±»å‹-åºå·")]),e._v(" çš„"),s("strong",[e._v("ä¸´æ—¶é¡ºåºèŠ‚ç‚¹")]),e._v(".")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211120203629801-7638936.png",alt:""}})]),e._v(" "),s("h6",{attrs:{id:"_2-è·å–é”-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-è·å–é”-2"}},[e._v("#")]),e._v(" (2)è·å–é”")]),e._v(" "),s("p",[e._v("åœ¨éœ€è¦è·å–å…±äº«é”æ—¶, æ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¼šåˆ° /shared è¿™ä¸ªèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ª"),s("mark",[s("strong",[e._v("ä¸´æ—¶é¡ºåºèŠ‚ç‚¹")])]),e._v(". å¦‚æœå½“å‰æ˜¯"),s("strong",[e._v("è¯»è¯·æ±‚")]),e._v(", é‚£ä¹ˆå°±åˆ›å»ºä¾‹å¦‚ "),s("code",[e._v("/shared/192.168.0.2-R-000000001")]),e._v("â€‹ çš„èŠ‚ç‚¹; å¦‚æœæ˜¯"),s("strong",[e._v("å†™è¯·æ±‚")]),e._v(", é‚£ä¹ˆå°±åˆ›å»ºä¾‹å¦‚ "),s("code",[e._v("/shared/192.168.0.2-W-000000001")]),e._v("â€‹ çš„èŠ‚ç‚¹.")]),e._v(" "),s("h6",{attrs:{id:"_3-åˆ¤æ–­è¯»å†™é¡ºåº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-åˆ¤æ–­è¯»å†™é¡ºåº"}},[e._v("#")]),e._v(" (3)åˆ¤æ–­è¯»å†™é¡ºåº")]),e._v(" "),s("p",[e._v("æ ¹æ®å…±äº«é”çš„å®šä¹‰, "),s("strong",[e._v("ä¸åŒçš„äº‹åŠ¡")]),e._v("éƒ½å¯ä»¥åŒæ—¶å¯¹åŒä¸€ä¸ªæ•°æ®å¯¹è±¡è¿›è¡Œ"),s("strong",[e._v("è¯»å–æ“ä½œ")]),e._v(", è€Œ"),s("strong",[e._v("æ›´æ–°æ“ä½œ")]),e._v("å¿…é¡»åœ¨å½“å‰æ²¡æœ‰ä»»ä½•äº‹åŠ¡è¿›è¡Œ"),s("strong",[e._v("è¯»å†™æ“ä½œ")]),e._v("çš„æƒ…å†µä¸‹è¿›è¡Œ. åŸºäºè¿™ä¸ªåŸåˆ™, é€šè¿‡ Zookeeper çš„èŠ‚ç‚¹å¯ä»¥ç¡®å®šåˆ†å¸ƒå¼è¯»å†™é¡ºåº, å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤:")]),e._v(" "),s("ul",[s("li",[e._v("åˆ›å»ºå®ŒèŠ‚ç‚¹å, è·å– /shared èŠ‚ç‚¹ä¸‹çš„"),s("strong",[e._v("æ‰€æœ‰å­èŠ‚ç‚¹, å¹¶å¯¹è¯¥èŠ‚ç‚¹æ³¨å†Œå­èŠ‚ç‚¹å˜æ›´çš„ Watcher ç›‘å¬")]),e._v(".")]),e._v(" "),s("li",[e._v("ç¡®å®šè‡ªå·±çš„èŠ‚ç‚¹åºå·åœ¨æ‰€æœ‰å­èŠ‚ç‚¹çš„é¡ºåº.")]),e._v(" "),s("li",[e._v("å¯¹äº"),s("strong",[e._v("è¯»è¯·æ±‚")]),e._v(". å¦‚æœæ²¡æœ‰æ¯”è‡ªå·±åºå·å°çš„å­èŠ‚ç‚¹, æˆ–æ˜¯æ‰€æœ‰æ¯”è‡ªå·±åºå·å°çš„å­èŠ‚ç‚¹éƒ½æ˜¯"),s("strong",[e._v("è¯»è¯·æ±‚")]),e._v(", é‚£ä¹ˆè¡¨æ˜è‡ªå·±å·²ç»æˆåŠŸ"),s("strong",[e._v("è·å–åˆ°äº†å…±äº«é”")]),e._v(", åŒæ—¶å¼€å§‹æ‰§è¡Œè¯»å–é€»è¾‘; å¦‚æœæ¯”è‡ªå·±åºå·å°çš„å­èŠ‚ç‚¹ä¸­æœ‰"),s("strong",[e._v("å†™è¯·æ±‚")]),e._v(", é‚£ä¹ˆéœ€è¦è¿›å…¥ç­‰å¾…. å¯¹äº"),s("strong",[e._v("å†™è¯·æ±‚")]),e._v(". å¦‚æœè‡ªå·±ä¸æ˜¯åºå·æœ€å°çš„å­èŠ‚ç‚¹, å°±éœ€è¦è¿›å…¥ç­‰å¾….")]),e._v(" "),s("li",[e._v("æ¥æ”¶åˆ° Watcher é€šçŸ¥å, é‡å¤æ­¥éª¤ 1.")])]),e._v(" "),s("h6",{attrs:{id:"_4-é‡Šæ”¾é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-é‡Šæ”¾é”"}},[e._v("#")]),e._v(" (4)é‡Šæ”¾é”")]),e._v(" "),s("p",[e._v("é‡Šæ”¾é”çš„é€»è¾‘å’Œæ’ä»–é”æ˜¯ä¸€è‡´çš„. æ•´ä¸ªå…±äº«é”çš„è·å–ä¸é‡Šæ”¾æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211219124304328-7638936.png",alt:"image-20211219124304328"}})]),e._v(" "),s("h5",{attrs:{id:"_3-ç¾Šç¾¤æ•ˆåº”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç¾Šç¾¤æ•ˆåº”"}},[e._v("#")]),e._v(" 3.ç¾Šç¾¤æ•ˆåº”")]),e._v(" "),s("p",[e._v("ä¸Šè¿°çš„å…±äº«é”è¿‡ç¨‹åŸºæœ¬èƒ½æ»¡è¶³ä¸€èˆ¬åˆ†å¸ƒå¼é›†ç¾¤ç«äº‰é”çš„éœ€æ±‚(ä¸€èˆ¬ 10 å°æœºå™¨ä»¥å†…). ä½†å¦‚æœ"),s("strong",[e._v("æœºå™¨è§„æ¨¡æ‰©å¤§")]),e._v('å, å°±ä¼šå­˜åœ¨é—®é¢˜. è¿™é‡Œé‡ç‚¹çœ‹çœ‹ "åˆ¤æ–­è¯»å†™é¡ºåº" çš„è¿‡ç¨‹. ä¸‹é¢æ˜¯ä¸€ä¸ª'),s("strong",[e._v("å…±äº«é”")]),e._v("çš„å®ä¾‹.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211219125047199-7638936.png",alt:""}})]),e._v(" "),s("p",[e._v("åˆ†æä¸€ä¸‹ä¸Šé¢çš„æƒ…å†µ.")]),e._v(" "),s("ul",[s("li",[e._v("host1 è¿™å°æœºå™¨é¦–å…ˆè¿›è¡Œè¯»æ“ä½œ, å®Œæˆè¯»æ“ä½œåå°†èŠ‚ç‚¹ host1-R-000000001 "),s("strong",[e._v("åˆ é™¤")]),e._v(".")]),e._v(" "),s("li",[e._v("å‰©ä¸‹çš„ 4 å°æœºå™¨"),s("strong",[e._v("éƒ½æ”¶åˆ°äº†è¿™ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤çš„é€šçŸ¥")]),e._v(". ç„¶å"),s("strong",[e._v("é‡æ–°ä» /shared èŠ‚ç‚¹ä¸Šè·å–ä¸€ä»½æœ€æ–°çš„å­èŠ‚ç‚¹åˆ—è¡¨")]),e._v(".")]),e._v(" "),s("li",[s("strong",[e._v("æ¯ä¸ªæœºå™¨åˆ¤æ–­è‡ªå·±çš„è¯»å†™é¡ºåº")]),e._v(". å…¶ä¸­ host2 è¿™ä¸ªæœºå™¨å‘ç°è‡ªå·±å·²ç»æ˜¯åºå·æœ€å°çš„æœºå™¨äº†, äºæ˜¯å¼€å§‹è¿›è¡Œå†™æ“ä½œ. å…¶ä»–æœºå™¨å‘ç°æ²¡æœ‰è½®åˆ°è‡ªå·±è¿›è¡Œè¯»æˆ–å†™æ“ä½œ, äºæ˜¯ç»§ç»­ç­‰å¾….")]),e._v(" "),s("li",[e._v("é‡å¤ä¸Šè¿°æµç¨‹...")])]),e._v(" "),s("p",[e._v("å¯ä»¥çœ‹åˆ°, host1 è¿™ä¸ªå®¢æˆ·ç«¯åœ¨ç§»é™¤è‡ªå·±çš„å…±äº«é”ä¹‹å, Zookeeper å‘é€äº†"),s("mark",[s("strong",[e._v("å­èŠ‚ç‚¹å˜æ›´ Watcher é€šçŸ¥ç»™æ‰€æœ‰æœºå™¨")])]),e._v(", è¿™ä¸ªé€šçŸ¥å®é™…ä¸Šä»…å¯¹ host2 æœºå™¨äº§ç”Ÿäº†å®é™…çš„å½±å“, å¯¹å…¶ä»–çš„å…¨éƒ¨æœºå™¨éƒ½æ²¡æœ‰ä»»ä½•ä½œç”¨.")]),e._v(" "),s("p",[e._v("ä¸Šè¿°è¿‡ç¨‹å¯ä»¥çœ‹åˆ°, åœ¨æ•´ä¸ªåˆ†å¸ƒå¼é”çš„ç«äº‰è¿‡ç¨‹ä¸­, "),s("mark",[s("strong",[e._v('å¤§é‡çš„ "Watcher é€šçŸ¥" å’Œ "å­ç»“ç‚¹åˆ—è¡¨è·å–" ä¸¤ä¸ªæ“ä½œé‡å¤è¿›è¡Œ')])]),e._v(". ä¸”å¤§å¤šæ•°è¿è¡Œçš„ç»“æœéƒ½æ˜¯åˆ¤æ–­å‡ºè‡ªå·±å¹¶éæ˜¯åºå·æœ€å°çš„ç»“ç‚¹, ä»è€Œç»§ç»­ç­‰å¾…ä¸‹ä¸€è½®é€šçŸ¥. "),s("strong",[e._v("å¦‚æœé›†ç¾¤è§„æ¨¡æ¯”è¾ƒå¤§, å°±ä¼šå¯¹ Zookeeper æœåŠ¡å™¨é€ æˆå·¨å¤§çš„æ€§èƒ½å½±å“å’Œç½‘ç»œå†²å‡»; è€Œä¸”å¦‚æœåŒä¸€æ—¶åˆ»æœ‰å¤šä¸ªç»“ç‚¹å¯¹åº”çš„å®¢æˆ·ç«¯å®Œæˆäº‹åŠ¡æˆ–æ˜¯äº‹åŠ¡ä¸­æ–­å¼•èµ·ç»“ç‚¹æ¶ˆå¤±, Zookeeper æœåŠ¡å™¨å°±ä¼šåœ¨çŸ­æ—¶é—´å†…å‘å…¶ä½™å®¢æˆ·ç«¯å‘é€å¤§é‡çš„äº‹ä»¶é€šçŸ¥")]),e._v(', è¿™å°±æ˜¯  **"**â€‹'),s("mark",[s("strong",[e._v("ç¾Šç¾¤æ•ˆåº”")])]),e._v("â€‹ "),s("strong",[e._v('"')]),e._v(" .")]),e._v(" "),s("p",[e._v("ä¸Šè¿°çš„ Zookeeper åˆ†å¸ƒå¼å…±äº«é”çš„å®ç°ä¸­å‡ºç°ç¾Šç¾¤æ•ˆåº”çš„"),s("strong",[e._v("æ ¹æºåœ¨äºæ²¡æœ‰æ‰¾å‡†å®¢æˆ·ç«¯çœŸæ­£çš„å…³æ³¨ç‚¹")]),e._v(". å‰è¿°çš„åˆ†å¸ƒå¼é”ç«äº‰è¿‡ç¨‹çš„æ ¸å¿ƒé€»è¾‘åœ¨äº, åˆ¤æ–­è‡ªå·±æ˜¯å¦æ˜¯æ‰€æœ‰å­èŠ‚ç‚¹ä¸­åºå·æœ€å°çš„. å› æ­¤å¾ˆå®¹æ˜“æƒ³åˆ°"),s("strong",[e._v("æ¯ä¸ªç»“ç‚¹å¯¹åº”çš„å®¢æˆ·ç«¯å…¶å®åªéœ€è¦å…³æ³¨æ¯”è‡ªå·±åºå·å°çš„é‚£ä¸ªç›¸å…³ç»“ç‚¹çš„å˜æ›´æƒ…å†µå°±å¯ä»¥äº†, è€Œä¸éœ€è¦å…³æ³¨å…¨å±€çš„å­åˆ—è¡¨å˜æ›´æƒ…å†µ")]),e._v(".")]),e._v(" "),s("h5",{attrs:{id:"_4-æ”¹è¿›åˆ†å¸ƒå¼é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ”¹è¿›åˆ†å¸ƒå¼é”"}},[e._v("#")]),e._v(" 4.æ”¹è¿›åˆ†å¸ƒå¼é”")]),e._v(" "),s("p",[e._v("å‰è¿°çš„å…±äº«é”å®ç°æ€è·¯æ˜¯å¯¹çš„, è¿™é‡Œçš„æ”¹è¿›ä¸»è¦åœ¨äº: "),s("mark",[s("strong",[e._v("æ¯ä¸ªé”ç«äº‰è€…, åªéœ€è¦å…³æ³¨ /shared ç»“ç‚¹ä¸‹åºå·æ¯”è‡ªå·±å°çš„é‚£ä¸ªç»“ç‚¹æ˜¯å¦å­˜åœ¨å³å¯")])]),e._v(". å¦‚ä¸‹å›¾æ‰€ç¤º.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211219131144732-7638936.png",alt:"image-20211219131144732"}})]),e._v(" "),s("p",[e._v("å…·ä½“æ­¥éª¤å¦‚ä¸‹:")]),e._v(" "),s("ol",[s("li",[e._v('å®¢æˆ·ç«¯è°ƒç”¨ create() æ–¹æ³•åˆ›å»ºä¸€ä¸ªç±»ä¼¼ä¸ " '),s("strong",[e._v("/shared/[Hostname]-è¯·æ±‚ç±»å‹-åºå·")]),e._v('" çš„ä¸´æ—¶é¡ºåºç»“ç‚¹.')]),e._v(" "),s("li",[e._v("å®¢æˆ·ç«¯è°ƒç”¨ getChildren() æ¥å£æ¥è·å–æ‰€æœ‰å·²ç»åˆ›å»ºçš„"),s("strong",[e._v("å­ç»“ç‚¹åˆ—è¡¨")]),e._v(". æ³¨æ„å¯¹æ¯”ä¹‹å‰çš„å®ç°: è¿™é‡Œ"),s("strong",[e._v("ä¸éœ€è¦æ³¨å†Œä»»ä½• Watcher")]),e._v(".")]),e._v(" "),s("li",[e._v("å¦‚æœæ— æ³•è·å–å…±äº«é”, é‚£ä¹ˆå°±è°ƒç”¨ exist() æ¥"),s("strong",[e._v("å‘æ¯”è‡ªå·±å°çš„é‚£ä¸ªç»“ç‚¹æ³¨å†Œ Watcher")]),e._v('. æ³¨æ„: è¿™é‡Œ "æ¯”è‡ªå·±å°çš„ç»“ç‚¹" å…·ä½“å¾—çœ‹æ˜¯è¯»è¯·æ±‚è¿˜æ˜¯å†™è¯·æ±‚.')])]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("è¯»è¯·æ±‚: å‘æ¯”è‡ªå·±åºå·å°çš„æœ€åä¸€ä¸ªå†™è¯·æ±‚ç»“ç‚¹æ³¨å†Œ Watcher ç›‘å¬.")])]),e._v(" "),s("li",[s("strong",[e._v("å†™è¯·æ±‚: å‘æ¯”è‡ªå·±åºå·å°çš„æœ€åä¸€ä¸ªç»“ç‚¹æ³¨å†Œ Watcher ç›‘å¬.")])])]),e._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[e._v("ç­‰å¾… Watcher é€šçŸ¥, ç»§ç»­è¿›å…¥æ­¥éª¤ 2.")])]),e._v(" "),s("p",[e._v("è¿™ä¸ªæ”¹è¿›è¿‡ç¨‹å…¶å®å°±æ˜¯å°½é‡å»"),s("strong",[e._v("ç¼©å°é”çš„èŒƒå›´")]),e._v(". å…·ä½“é€‰å“ªç§å®ç°å¯ä»¥æ ¹æ®"),s("strong",[e._v("å…·ä½“çš„åœºæ™¯é€‰æ‹©")]),e._v(". åœ¨é›†ç¾¤è§„æ¨¡ä¸å¤§, ç½‘ç»œèµ„æºä¸°å¯Œçš„æƒ…å†µä¸‹, é‡‡ç”¨ç¬¬ä¸€ç§å®ç°æ˜¯ç®€å•å®ç”¨çš„é€‰æ‹©; å¦‚æœé›†ç¾¤è¾¾åˆ°ä¸€å®šè§„æ¨¡, ä¸”å¸Œæœ›èƒ½ç²¾ç»†åŒ–çš„æ§åˆ¶åˆ†å¸ƒå¼é”, é‚£å¯ä»¥é‡‡ç”¨æ”¹è¿›ç‰ˆçš„åˆ†å¸ƒå¼é”å®ç°.")]),e._v(" "),s("h4",{attrs:{id:"æ¡†æ¶ä¸ç³»ç»Ÿåº”ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡†æ¶ä¸ç³»ç»Ÿåº”ç”¨"}},[e._v("#")]),e._v(" æ¡†æ¶ä¸ç³»ç»Ÿåº”ç”¨")]),e._v(" "),s("p",[e._v("ä»‹ç»ä¸‹ ZK åœ¨å„ç§æ¡†æ¶ä¸­çš„åº”ç”¨.")]),e._v(" "),s("blockquote",[s("p",[e._v("Hadoop")])]),e._v(" "),s("p",[e._v("Hadoop åˆ©ç”¨ Zookeeper å®ç° HA(High Availability).")]),e._v(" "),s("blockquote",[s("p",[e._v("HBase")])]),e._v(" "),s("p",[e._v("HBase åˆ©ç”¨ Zookeeper å®ç°æ•´ä¸ªç³»ç»Ÿçš„åˆ†å¸ƒå¼åè°ƒå·¥ä½œ.")]),e._v(" "),s("blockquote",[s("p",[e._v("Kafka")])]),e._v(" "),s("p",[e._v("Kafka ä½¿ç”¨ Zookeeper ä½œä¸ºæ³¨å†Œç³»ç»Ÿæ¥å¯¹æ•´ä¸ªé›†ç¾¤çš„ "),s("strong",[e._v("Broker æœåŠ¡å™¨")]),e._v('è¿›è¡Œç®¡ç†. åœ¨ Zookeeper ä¸Šä¼šæœ‰ä¸€ä¸ªä¸“é—¨ç”¨æ¥è¿›è¡Œ Broker æœåŠ¡å™¨åˆ—è¡¨è®°å½•çš„ç»“ç‚¹(è®°ä¸º Broker ç»“ç‚¹), å…¶è·¯å¾„ä¸º "/brokers/ids". æ¯ä¸ª Broker æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶, éƒ½ä¼šåˆ° Zookeeper ä¸Šè¿›è¡Œæ³¨å†Œ, å³åˆ° Broker ç»“ç‚¹ä¸‹åˆ›å»ºå±äºè‡ªå·±çš„ç»“ç‚¹, å…¶ç»“ç‚¹è·¯å¾„ä¸º "/brokers/ids/[0-N]".')]),e._v(" "),s("p",[e._v('åœ¨ Kafka ä¸­, ä½¿ç”¨ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ•°å­—(å¯ç§°ä¸º Broker ID)æ¥ä»£è¡¨æ¯ä¸€ä¸ª Broker æœåŠ¡å™¨, ä¸åŒçš„ Broker å¿…é¡»ä½¿ç”¨ä¸åŒçš„  Broker ID è¿›è¡Œæ³¨å†Œ, å¦‚ "/brokers/ids/1" å’Œ "/brokers/ids/2" åˆ†åˆ«ä»£è¡¨äº†ä¸¤ä¸ª Broker æœåŠ¡å™¨. åˆ›å»ºå®Œ Broker ç»“ç‚¹å, æ¯ä¸ª Broker ä¼šå°†è‡ªå·±çš„ IP åœ°å€å’Œç«¯å£ä¿¡æ¯å†™å…¥åˆ°è¯¥ç»“ç‚¹ä¸‹å».')]),e._v(" "),s("p",[e._v("Broker åˆ›å»ºçš„ç»“ç‚¹æ˜¯ä¸€ä¸ªä¸´æ—¶ç»“ç‚¹, ä¸€æ—¦è¿™ä¸ª Broker æœåŠ¡å™¨å®•æœºæˆ–è€…ä¸‹çº¿, å¯¹åº”çš„ Zookeeper ç»“ç‚¹ä¹Ÿä¼šåˆ é™¤. å› æ­¤å¯ä»¥é€šè¿‡ Zookeeper ä¸Š Broker ç»“ç‚¹çš„å˜åŒ–æƒ…å†µæ¥åŠ¨æ€è¡¨å¾ Broker æœåŠ¡å™¨çš„å¯ç”¨æ€§.")]),e._v(" "),s("p",[e._v("é™¤äº† Broker ä¹‹å¤–, Topic æ³¨å†Œä¹Ÿæ˜¯ç±»ä¼¼çš„é€»è¾‘.")]),e._v(" "),s("p",[e._v("å‚è€ƒ: Kafkaä¸Zookeeper.")]),e._v(" "),s("blockquote",[s("p",[e._v("Dubbo")])]),e._v(" "),s("p",[s("strong",[e._v("Zookeeper ä¸€ä¸ªæœ€å¸¸ç”¨çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯ç”¨äºæ‹…ä»»æœåŠ¡ç”Ÿäº§è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…çš„æ³¨å†Œä¸­å¿ƒ(æä¾›å‘å¸ƒè®¢é˜…æœåŠ¡). "),s("strong",[e._v("â€‹"),s("strong",[s("strong",[e._v("æœåŠ¡ç”Ÿäº§è€…å°†è‡ªå·±æä¾›çš„æœåŠ¡æ³¨å†Œåˆ° Zookeeper ä¸­å¿ƒ, æœåŠ¡çš„æ¶ˆè´¹è€…åœ¨è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„æ—¶å€™å…ˆåˆ° Zookeeper ä¸­æŸ¥æ‰¾æœåŠ¡, è·å–åˆ°æœåŠ¡ç”Ÿäº§è€…çš„è¯¦ç»†ä¿¡æ¯ä¹‹å, å†å»è°ƒç”¨æœåŠ¡ç”Ÿäº§è€…çš„å†…å®¹ä¸æ•°æ®. åœ¨ Dubbo ä¸­ Zookeeper å°±æ‹…ä»»äº†")])]),e._v("â€‹")]),e._v("æ³¨å†Œä¸­å¿ƒ")]),e._v("çš„è§’è‰².")]),e._v(" "),s("p",[e._v("åˆ†å¸ƒå¼æœåŠ¡èŠ‚ç‚¹å¾ˆå¤š, ä¸å¯èƒ½åœ¨å®¢æˆ·ç«¯æ‰‹åŠ¨é…ç½®, è¿™å°±éœ€è¦ä¸€ä¸ª"),s("strong",[e._v("ä¸­é—´æœåŠ¡")]),e._v(", ä¸“é—¨ç”¨äº"),s("strong",[e._v("å¸®åŠ©å®¢æˆ·ç«¯å‘ç°æœåŠ¡èŠ‚ç‚¹")]),e._v(", å°±æ˜¯"),s("strong",[e._v("æœåŠ¡å‘ç°")]),e._v(".")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220107212259512-7638936.png",alt:""}})]),e._v(" "),s("p",[e._v("ä¸€ä¸ªå®Œæ•´çš„"),s("strong",[e._v("æ³¨å†Œä¸­å¿ƒ")]),e._v("æ¶µç›–ä»¥ä¸‹åŠŸèƒ½ç‰¹æ€§:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("æœåŠ¡æ³¨å†Œ: "),s("strong",[e._v("â€‹"),s("strong",[s("strong",[e._v("æœåŠ¡ç«¯")])]),e._v("â€‹")]),e._v("ä¸Šçº¿æ—¶")]),e._v("å°†è‡ª"),s("strong",[e._v("æä¾›çš„æœåŠ¡æäº¤ç»™æ³¨å†Œä¸­å¿ƒ")]),e._v(".")]),e._v(" "),s("li",[s("strong",[e._v("æœåŠ¡æ³¨é”€: "),s("strong",[e._v("â€‹"),s("strong",[s("strong",[e._v("é€šçŸ¥å®¢æˆ·ç«¯æœåŠ¡ç«¯")])]),e._v("â€‹")]),e._v("ä¸‹çº¿")]),e._v(".")]),e._v(" "),s("li",[s("strong",[e._v("æœåŠ¡è®¢é˜…")]),e._v(": åŠ¨æ€å®æ—¶æ¥æ”¶æœåŠ¡"),s("strong",[e._v("å˜æ›´æ¶ˆæ¯")]),e._v(".")]),e._v(" "),s("li",[s("strong",[e._v("å¯é æ€§")]),e._v(": æ³¨å†ŒæœåŠ¡æœ¬èº«æ˜¯"),s("strong",[e._v("é›†ç¾¤")]),e._v("çš„, æ•°æ®"),s("strong",[e._v("å†—ä½™å­˜å‚¨")]),e._v(". é¿å…å•ç‚¹æ•…éšœ, åŠæ•°æ®ä¸¢å¤±.")]),e._v(" "),s("li",[s("strong",[e._v("å®¹é”™æ€§")]),e._v(": å½“æœåŠ¡æä¾›è€…å‡ºç°å®•æœº, æ–­ç”µç­‰æç«¯æƒ…å†µæ—¶, æ³¨å†Œä¸­å¿ƒèƒ½å¤Ÿ"),s("strong",[e._v("åŠ¨æ€æ„ŸçŸ¥")]),e._v("å¹¶é€šçŸ¥å®¢æˆ·ç«¯æœåŠ¡æä¾›è€…çš„çŠ¶æ€.")])]),e._v(" "),s("p",[e._v("Dubbo åŸºäº Zookeeper å®ç°æœåŠ¡"),s("strong",[e._v("æ³¨å†Œä¸­å¿ƒ")]),e._v(". æ‰€æœ‰æœåŠ¡æä¾›è€…åœ¨ Zookeeper ä¸Šåˆ›å»ºçš„ç»“ç‚¹éƒ½æ˜¯"),s("strong",[e._v("ä¸´æ—¶ç»“ç‚¹")]),e._v(", è¿™åˆ©ç”¨äº†ä¸´æ—¶ç»“ç‚¹çš„ç”Ÿå‘½å‘¨æœŸä¸å®¢æˆ·ç«¯ä¼šè¯ç›¸å…³çš„ç‰¹æ€§, å¯ä»¥è¡¨æ˜æœåŠ¡æä¾›è€…çš„åœ¨çº¿çŠ¶æ€.")]),e._v(" "),s("p",[s("strong",[e._v("Dubbo æ³¨å†Œä¸­å¿ƒå­˜å‚¨")]),e._v("ç»“æ„å¦‚ä¸‹:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220107214039226-7638936.png",alt:""}})]),e._v(" "),s("p",[s("strong",[e._v("èŠ‚ç‚¹è¯´æ˜")])]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("ç±»åˆ«")])]),e._v(" "),s("th",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("å±æ€§")])]),e._v(" "),s("th",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("è¯´æ˜")])])])]),e._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("Root")])]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("æŒä¹…èŠ‚ç‚¹")])]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v('æ ¹èŠ‚ç‚¹åç§°, é»˜è®¤æ˜¯ "dubbo"')])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("Service")])]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("æŒä¹…èŠ‚ç‚¹")])]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("æœåŠ¡åç§°")]),e._v(", å®Œæ•´çš„æœåŠ¡ç±»å")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("type")])]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("æŒä¹…èŠ‚ç‚¹")])]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("å¯é€‰å€¼: "),s("strong",[e._v("providers")]),e._v("(æä¾›è€…), "),s("strong",[e._v("consumers")]),e._v("(æ¶ˆè´¹è€…), "),s("strong",[e._v("configurators")]),e._v("(åŠ¨æ€é…ç½®), "),s("strong",[e._v("routers")])])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("URL")])]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("strong",[e._v("ä¸´æ—¶èŠ‚ç‚¹")])]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("URL åç§°: åŒ…å«æœåŠ¡æä¾›è€…çš„ IP ç«¯å£åŠé…ç½®ç­‰ä¿¡æ¯.")])])])]),e._v(" "),s("p",[e._v("â€")]),e._v(" "),s("p",[e._v("â€")]),e._v(" "),s("p",[e._v("â€")]),e._v(" "),s("p",[e._v("â€")]),e._v(" "),s("p",[e._v("â€")]),e._v(" "),s("p",[e._v("â€")]),e._v(" "),s("p",[e._v("â€")])])}),[],!1,null,null,null);s.default=t.exports}}]);