(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{467:function(t,s,_){"use strict";_.r(s);var v=_(7),r=Object(v.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_31-redisæŒä¹…åŒ–"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_31-redisæŒä¹…åŒ–"}},[t._v("#")]),t._v(" 31.RedisæŒä¹…åŒ–")]),t._v(" "),s("h4",{attrs:{id:"æŒä¹…åŒ–åŸºç¡€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŒä¹…åŒ–åŸºç¡€"}},[t._v("#")]),t._v(" æŒä¹…åŒ–åŸºç¡€")]),t._v(" "),s("p",[t._v("Redis æŒä¹…åŒ–æ–¹å¼: "),s("strong",[t._v("RDB, AOF, æ··åˆæŒä¹…åŒ–")]),t._v(".")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20200425182633664.png",alt:"image-20200425182633664"}})]),t._v(" "),s("ol",[s("li",[t._v("å®¢æˆ·ç«¯å‘æ•°æ®åº“"),s("strong",[t._v("å‘é€å†™å‘½ä»¤")]),t._v(".")]),t._v(" "),s("li",[t._v("æ•°æ®åº“"),s("strong",[t._v("æ¥æ”¶")]),t._v("åˆ°å®¢æˆ·ç«¯"),s("strong",[t._v("å†™è¯·æ±‚")]),t._v(".")]),t._v(" "),s("li",[t._v("æ•°æ®åº“"),s("strong",[t._v("è°ƒç”¨ç³»ç»Ÿ API")]),t._v("å°†æ•°æ®å†™å…¥ç£ç›˜(æ•°æ®åœ¨å†…æ ¸ç¼“å†²åŒºä¸­).")]),t._v(" "),s("li",[t._v("æ“ä½œç³»ç»Ÿå°†"),s("strong",[t._v("å†™ç¼“å†²åŒº")]),t._v("ä¼ è¾“åˆ°"),s("strong",[t._v("ç£ç›˜æ§æ§åˆ¶å™¨")]),t._v("(æ•°æ®åœ¨ç£ç›˜ç¼“å­˜ä¸­).")]),t._v(" "),s("li",[t._v("æ“ä½œç³»ç»Ÿçš„ç£ç›˜æ§åˆ¶å™¨å°†æ•°æ®å†™å…¥å®é™…çš„ç‰©ç†åª’ä»‹ä¸­(æ•°æ®åœ¨ç£ç›˜ä¸­).")])]),t._v(" "),s("p",[s("strong",[t._v("æ³¨æ„")]),t._v(": ä¸Šé¢çš„è¿‡ç¨‹å…¶å®æ˜¯ "),s("strong",[t._v("æåº¦ç²¾ç®€")]),t._v(" çš„, åœ¨å®é™…çš„æ“ä½œç³»ç»Ÿä¸­, "),s("strong",[t._v("ç¼“å­˜")]),t._v("å’Œ"),s("strong",[t._v("ç¼“å†²åŒº")]),t._v("ä¼šæ¯”è¿™å¤šå¾—å¤š.")]),t._v(" "),s("h4",{attrs:{id:"rdbæŒä¹…åŒ–ğŸŒŸ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rdbæŒä¹…åŒ–ğŸŒŸ"}},[t._v("#")]),t._v(" RDBæŒä¹…åŒ–ğŸŒŸ")]),t._v(" "),s("p",[t._v("RDB æŒä¹…åŒ–æ˜¯æŠŠå½“å‰è¿›ç¨‹çš„"),s("strong",[t._v("å…¨éƒ¨æ•°æ®ç”Ÿæˆå¿«ç…§")]),t._v("ä¿å­˜åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹. åœ¨é»˜è®¤æƒ…å†µä¸‹, Redis å°†å†…å­˜æ•°æ®åº“å¿«ç…§ä¿å­˜åœ¨åå­—ä¸º dump.rdb çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­.")]),t._v(" "),s("h5",{attrs:{id:"_1-è§¦å‘æœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-è§¦å‘æœºåˆ¶"}},[t._v("#")]),t._v(" 1.è§¦å‘æœºåˆ¶")]),t._v(" "),s("p",[t._v("è§¦å‘ RDB æŒä¹…åŒ–è¿‡ç¨‹åˆ†ä¸º"),s("strong",[t._v("æ‰‹åŠ¨è§¦å‘")]),t._v("å’Œ"),s("strong",[t._v("è‡ªåŠ¨è§¦å‘")]),t._v(".")]),t._v(" "),s("h6",{attrs:{id:"_1-æ‰‹åŠ¨è§¦å‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ‰‹åŠ¨è§¦å‘"}},[t._v("#")]),t._v(" (1)æ‰‹åŠ¨è§¦å‘")]),t._v(" "),s("p",[s("strong",[t._v("æ‰‹åŠ¨è§¦å‘")]),t._v("ä½¿ç”¨ "),s("strong",[t._v("bgsave")]),t._v(" å‘½ä»¤. Redis è¿›ç¨‹æ‰§è¡Œ "),s("strong",[t._v("fork")]),t._v(" æ“ä½œåˆ›å»º"),s("strong",[t._v("å­è¿›ç¨‹")]),t._v(", RDB æŒä¹…åŒ–è¿‡ç¨‹ç”±"),s("strong",[t._v("å­è¿›ç¨‹è´Ÿè´£")]),t._v(", å®Œæˆåè‡ªåŠ¨ç»“æŸ. "),s("strong",[t._v("é˜»å¡åªå‘ç”Ÿåœ¨ fork åˆ›å»ºå­è¿›ç¨‹çš„é˜¶æ®µ, ä¸€èˆ¬æ—¶é—´å¾ˆçŸ­")]),t._v(", ç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨. æ³¨: bg å°±æ˜¯ background åå°æ‰§è¡Œçš„æ„æ€.")]),t._v(" "),s("p",[t._v("bgsave æ˜¯å¼‚æ­¥æ‰§è¡Œçš„, ä¸é˜»å¡å…¶ä»–å‘½ä»¤.")]),t._v(" "),s("h6",{attrs:{id:"_2-è‡ªåŠ¨è§¦å‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-è‡ªåŠ¨è§¦å‘"}},[t._v("#")]),t._v(" (2)è‡ªåŠ¨è§¦å‘")]),t._v(" "),s("p",[t._v("è‡ªåŠ¨è§¦å‘çš„åœºæ™¯å¦‚ä¸‹:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("save m n")]),t._v(" è¡¨ç¤ºå¦‚æœåœ¨ m ç§’å†…æ•°æ®é›†å­˜åœ¨ n æ¬¡ä¿®æ”¹æ—¶, "),s("strong",[t._v("è‡ªåŠ¨è§¦å‘ bgsave")]),t._v('. æ¯”å¦‚ save 60 1000 è¡¨ç¤º Redis åœ¨æ»¡è¶³ "60 ç§’å†…æœ‰è‡³å°‘æœ‰ 1000 ä¸ªé”®è¢«æ”¹åŠ¨" è¿™ä¸€æ¡ä»¶æ—¶, è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡æ•°æ®é›†. é…ç½®è‡ªåŠ¨ç”Ÿæˆ rdb æ–‡ä»¶åå°ä½¿ç”¨çš„æ˜¯ bgsave æ–¹å¼.')]),t._v(" "),s("li",[t._v("å¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œ"),s("strong",[t._v("å…¨é‡å¤åˆ¶")]),t._v("æ“ä½œ, ä¸»èŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œ bgsave ç”Ÿæˆ RDB æ–‡ä»¶å¹¶å‘é€ç»™ä»èŠ‚ç‚¹.")]),t._v(" "),s("li",[t._v("æ‰§è¡Œ debug reload å‘½ä»¤é‡æ–°åŠ è½½ Redis æ—¶, ä¹Ÿä¼šè‡ªåŠ¨è§¦å‘ save æ“ä½œ.")]),t._v(" "),s("li",[t._v("é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œ shutdown å‘½ä»¤æ—¶, å¦‚æœæ²¡æœ‰å¼€å¯ AOF, åˆ™è‡ªåŠ¨æ‰§è¡Œ bgsave.")])]),t._v(" "),s("h5",{attrs:{id:"_2-å·¥ä½œæµç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å·¥ä½œæµç¨‹"}},[t._v("#")]),t._v(" 2.å·¥ä½œæµç¨‹")]),t._v(" "),s("h6",{attrs:{id:"_1-bgsaveæµç¨‹ä¸å†™æ—¶å¤åˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-bgsaveæµç¨‹ä¸å†™æ—¶å¤åˆ¶"}},[t._v("#")]),t._v(" (1)bgsaveæµç¨‹ä¸å†™æ—¶å¤åˆ¶")]),t._v(" "),s("p",[t._v("Redis å€ŸåŠ©æ“ä½œç³»ç»Ÿæä¾›çš„"),s("strong",[t._v("å†™æ—¶å¤åˆ¶æŠ€æœ¯")]),t._v("(Copy-On-Write, COW), åœ¨ç”Ÿæˆå¿«ç…§çš„åŒæ—¶, ä¾ç„¶å¯ä»¥æ­£å¸¸å¤„ç†å†™å‘½ä»¤. ç®€å•æ¥è¯´, "),s("strong",[t._v("bgsave å­è¿›ç¨‹æ˜¯ç”±ä¸»çº¿ç¨‹ fork ç”Ÿæˆçš„, å¯ä»¥å…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®")]),t._v(". bgsave å­è¿›ç¨‹è¿è¡Œå, å¼€å§‹è¯»å–ä¸»çº¿ç¨‹çš„å†…å­˜æ•°æ®, å¹¶æŠŠå®ƒä»¬å†™å…¥ RDB æ–‡ä»¶. æ­¤æ—¶, å¦‚æœä¸»çº¿ç¨‹å¯¹è¿™äº›æ•°æ®ä¹Ÿéƒ½æ˜¯è¯»æ“ä½œ, é‚£ä¹ˆä¸»çº¿ç¨‹å’Œ bgsave å­è¿›ç¨‹ç›¸äº’ä¸å½±å“. ä½†å¦‚æœä¸»çº¿ç¨‹è¦ä¿®æ”¹ä¸€å—æ•°æ®, é‚£è¿™å—æ•°æ®å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½, ç”Ÿæˆè¯¥æ•°æ®çš„å‰¯æœ¬. ç„¶å bgsave å­è¿›ç¨‹ä¼šæŠŠè¿™ä¸ªå‰¯æœ¬æ•°æ®å†™å…¥ RDB æ–‡ä»¶, è€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, ä¸»çº¿ç¨‹ä»ç„¶å¯ä»¥ç›´æ¥ä¿®æ”¹åŸæ¥çš„æ•°æ®.")]),t._v(" "),s("p",[s("strong",[t._v("bgsave")]),t._v(" æ˜¯ä¸»æµçš„è§¦å‘ RDB æŒä¹…åŒ–çš„æ–¹å¼, æµç¨‹å¦‚ä¸‹.")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220522212958905.png",alt:""}})]),t._v(" "),s("p",[t._v("(1) Redis çˆ¶è¿›ç¨‹é¦–å…ˆåˆ¤æ–­: å½“å‰"),s("strong",[t._v("æ˜¯å¦æ­£åœ¨æ‰§è¡Œ")]),t._v(" save æˆ– bgsave/bgrewriteaof çš„å­è¿›ç¨‹, å¦‚æœåœ¨æ‰§è¡Œåˆ™ bgsave å‘½ä»¤"),s("strong",[t._v("ç›´æ¥è¿”å›")]),t._v(". bgsave/bgrewriteaof çš„å­è¿›ç¨‹"),s("strong",[t._v("ä¸èƒ½åŒæ—¶æ‰§è¡Œ")]),t._v(", ä¸»è¦æ˜¯åŸºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘: ä¸¤ä¸ªå¹¶å‘çš„å­è¿›ç¨‹åŒæ—¶æ‰§è¡Œå¤§é‡çš„ç£ç›˜å†™æ“ä½œ, å¯èƒ½å¼•èµ·ä¸¥é‡çš„æ€§èƒ½é—®é¢˜.")]),t._v(" "),s("p",[t._v("(2) çˆ¶è¿›ç¨‹æ‰§è¡Œ "),s("strong",[t._v("fork")]),t._v(" æ“ä½œ"),s("strong",[t._v("åˆ›å»ºå­è¿›ç¨‹")]),t._v(", è¿™ä¸ªè¿‡ç¨‹ä¸­"),s("strong",[t._v("çˆ¶è¿›ç¨‹æ˜¯é˜»å¡")]),t._v("çš„, Redis ä¸èƒ½æ‰§è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„ä»»ä½•å‘½ä»¤, ä½†è¿™ä¸ªé˜»å¡æ—¶é—´"),s("strong",[t._v("å¾ˆçŸ­")]),t._v(".")]),t._v(" "),s("p",[t._v("(3) çˆ¶è¿›ç¨‹ fork åˆ›å»ºå®Œå­è¿›ç¨‹å, "),s("strong",[t._v("bgsave å‘½ä»¤")]),t._v('è¿”å› "Background saving started" ä¿¡æ¯å¹¶'),s("strong",[t._v("ä¸å†é˜»å¡")]),t._v("çˆ¶è¿›ç¨‹, å¹¶å¯ä»¥å“åº”å…¶ä»–å‘½ä»¤.")]),t._v(" "),s("p",[t._v("(4) å­è¿›ç¨‹"),s("strong",[t._v("åˆ›å»º RDB")]),t._v(" æ–‡ä»¶, æ ¹æ®"),s("strong",[t._v("çˆ¶è¿›ç¨‹å†…å­˜å¿«ç…§ç”Ÿæˆä¸´æ—¶å¿«ç…§æ–‡ä»¶")]),t._v(", å®Œæˆåå¯¹"),s("strong",[t._v("åŸæœ‰æ–‡ä»¶")]),t._v("è¿›è¡Œ"),s("strong",[t._v("åŸå­æ›¿æ¢")]),t._v(".")]),t._v(" "),s("p",[t._v("(5) å­è¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆ, çˆ¶è¿›ç¨‹"),s("strong",[t._v("æ›´æ–°ç»Ÿè®¡ä¿¡æ¯")]),t._v(".")]),t._v(" "),s("h6",{attrs:{id:"_2-å†™æ—¶å¤åˆ¶æœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†™æ—¶å¤åˆ¶æœºåˆ¶"}},[t._v("#")]),t._v(" (2)å†™æ—¶å¤åˆ¶æœºåˆ¶")]),t._v(" "),s("p",[t._v('RBD ä¹Ÿå« "'),s("strong",[t._v("å¿«ç…§")]),t._v('" æŒä¹…åŒ–. æ“ä½œç³»ç»Ÿå¤šè¿›ç¨‹å†™æ—¶å¤åˆ¶ '),s("strong",[t._v("COW(Copy On Write) æœºåˆ¶")]),t._v(" ååˆ†é‡è¦. "),s("strong",[t._v("Redis")]),t._v(" åœ¨æŒä¹…åŒ–æ—¶ä¼šè°ƒç”¨å‡½æ•° "),s("strong",[t._v("fork()")]),t._v("  äº§ç”Ÿä¸€ä¸ª"),s("strong",[t._v("å­è¿›ç¨‹")]),t._v(", ç®€å•ç†è§£ä¹Ÿå°±æ˜¯åŸºäºå½“å‰è¿›ç¨‹"),s("strong",[t._v("å¤åˆ¶")]),t._v("äº†ä¸€ä¸ªè¿›ç¨‹, ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼š"),s("strong",[t._v("å…±äº«")]),t._v("å†…å­˜é‡Œé¢çš„ä»£ç å—å’Œæ•°æ®æ®µ:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20200425182803920.png",alt:"image-20200425182803920"}})]),t._v(" "),s("p",[t._v("æ‰€ä»¥"),s("strong",[t._v("å¿«ç…§æŒä¹…åŒ–")]),t._v("å¯ä»¥å®Œå…¨äº¤ç»™"),s("strong",[t._v("å­è¿›ç¨‹")]),t._v("æ¥å¤„ç†, "),s("strong",[t._v("çˆ¶è¿›ç¨‹")]),t._v("åˆ™ç»§ç»­"),s("strong",[t._v("å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚")]),t._v(". "),s("strong",[t._v("å­è¿›ç¨‹")]),t._v("åšæ•°æ®æŒä¹…åŒ–, å®ƒ"),s("strong",[t._v("ä¸ä¼šä¿®æ”¹ç°æœ‰çš„å†…å­˜æ•°æ®ç»“æ„")]),t._v(", å®ƒåªæ˜¯å¯¹æ•°æ®ç»“æ„è¿›è¡Œ"),s("strong",[t._v("éå†è¯»å–")]),t._v(", ç„¶ååºåˆ—åŒ–å†™åˆ°ç£ç›˜ä¸­. ä½†"),s("strong",[t._v("çˆ¶è¿›ç¨‹")]),t._v("ä¸ä¸€æ ·, å®ƒå¿…é¡»æŒç»­æœåŠ¡å®¢æˆ·ç«¯è¯·æ±‚, ç„¶åå¯¹"),s("strong",[t._v("å†…å­˜æ•°æ®ç»“æ„è¿›è¡Œä¸é—´æ–­çš„ä¿®æ”¹")]),t._v(".")]),t._v(" "),s("p",[t._v("è¿™æ—¶å€™å°±ä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ "),s("strong",[t._v("Copy On Write æœºåˆ¶")]),t._v("æ¥è¿›è¡Œ"),s("strong",[t._v("æ•°æ®æ®µé¡µé¢")]),t._v("çš„"),s("strong",[t._v("åˆ†ç¦»")]),t._v(". æ•°æ®æ®µæ˜¯ç”±å¾ˆå¤šæ“ä½œç³»ç»Ÿçš„é¡µé¢ç»„åˆè€Œæˆ, å½“çˆ¶è¿›ç¨‹å¯¹å…¶ä¸­ä¸€ä¸ªé¡µé¢çš„æ•°æ®è¿›è¡Œ"),s("strong",[t._v("ä¿®æ”¹")]),t._v("æ—¶, ä¼šå°†"),s("strong",[t._v("è¢«å…±äº«çš„é¡µé¢å¤åˆ¶ä¸€ä»½åˆ†ç¦»")]),t._v("å‡ºæ¥, ç„¶å"),s("strong",[t._v("å¯¹è¿™ä¸ªå¤åˆ¶çš„é¡µé¢è¿›è¡Œä¿®æ”¹")]),t._v(". è¿™æ—¶"),s("strong",[t._v("å­è¿›ç¨‹")]),t._v("ç›¸åº”çš„é¡µé¢æ˜¯"),s("strong",[t._v("æ²¡æœ‰å˜åŒ–çš„")]),t._v(", è¿˜æ˜¯è¿›ç¨‹äº§ç”Ÿæ—¶"),s("strong",[t._v("é‚£ä¸€ç¬é—´")]),t._v("çš„æ•°æ®.")]),t._v(" "),s("p",[t._v("å­è¿›ç¨‹å› ä¸ºæ•°æ®æ²¡æœ‰å˜åŒ–, å®ƒèƒ½çœ‹åˆ°çš„"),s("strong",[t._v("å†…å­˜é‡Œçš„æ•°æ®åœ¨è¿›ç¨‹äº§ç”Ÿçš„ä¸€ç¬é—´å°±å‡å›º")]),t._v("äº†, å†ä¹Ÿä¸ä¼šæ”¹å˜, è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ "),s("strong",[t._v("Redis")]),t._v(" çš„æŒä¹…åŒ–"),s("strong",[t._v("å«ã€Œå¿«ç…§ã€çš„åŸå› ")]),t._v("!! æ¥ä¸‹æ¥å­è¿›ç¨‹å°±å¯ä»¥éå¸¸å®‰å¿ƒçš„éå†æ•°æ®äº†è¿›è¡Œåºåˆ—åŒ–å†™ç£ç›˜äº†.")]),t._v(" "),s("h5",{attrs:{id:"_3-rdbæ–‡ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-rdbæ–‡ä»¶"}},[t._v("#")]),t._v(" 3.RDBæ–‡ä»¶")]),t._v(" "),s("p",[t._v("RDB æ–‡ä»¶æ˜¯ç»è¿‡"),s("strong",[t._v("å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶")]),t._v(", Redis é»˜è®¤é‡‡ç”¨ "),s("strong",[t._v("LZF ç®—æ³•")]),t._v("å¯¹ç”Ÿæˆçš„ RDB æ–‡ä»¶åš"),s("strong",[t._v("å‹ç¼©å¤„ç†")]),t._v(", å‹ç¼©åçš„æ–‡ä»¶"),s("strong",[t._v("è¿œè¿œå°äº")]),t._v("å†…å­˜å¤§å°. RDB æ–‡ä»¶ä¿å­˜åœ¨ dir é…ç½®æŒ‡å®šçš„ç›®å½•ä¸‹, æ–‡ä»¶åé€šè¿‡ dbfilename é…ç½®.")]),t._v(" "),s("h5",{attrs:{id:"_4-rdbä¼˜ç¼ºç‚¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-rdbä¼˜ç¼ºç‚¹"}},[t._v("#")]),t._v(" 4.RDBä¼˜ç¼ºç‚¹")]),t._v(" "),s("p",[s("strong",[t._v("(1)ä¼˜ç‚¹")])]),t._v(" "),s("p",[t._v("RDB æ–‡ä»¶æ˜¯ç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶, æ¶ˆè€—"),s("strong",[t._v("ç©ºé—´å°‘")]),t._v(". RDB æ–‡ä»¶ä»£è¡¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„"),s("strong",[t._v("æ•°æ®å¿«ç…§")]),t._v(", æ‰€ä»¥éå¸¸é€‚åˆäº"),s("strong",[t._v("å¤‡ä»½, å…¨é‡å¤åˆ¶")]),t._v("ç­‰åœºæ™¯. Redis "),s("strong",[t._v("åŠ è½½ RDB æ–‡ä»¶æ¢å¤æ•°æ®çš„é€Ÿåº¦è¿œè¿œå¿«äº")]),t._v(" AOF æ–¹å¼.")]),t._v(" "),s("p",[s("strong",[t._v("(2)ç¼ºç‚¹")])]),t._v(" "),s("p",[t._v("RDB æŒä¹…åŒ–çš„æ˜¯å†…å­˜å¿«ç…§, æ•°æ®é‡è¾ƒå¤§, æ‰€ä»¥ RDB å±äº"),s("strong",[t._v("é‡é‡çº§æ“ä½œ")]),t._v(", ä¸èƒ½é¢‘ç¹æ‰§è¡Œ, å› æ­¤"),s("mark",[s("strong",[t._v("æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–, ç§’çº§æŒä¹…åŒ–")])]),t._v(". ä¸€èˆ¬ç”¨äº"),s("strong",[t._v("æ•°æ®å†·å¤‡å’Œå¤åˆ¶ä¼ è¾“")]),t._v(". RDB æ˜¯ç”¨ç‰¹å®šçš„äºŒè¿›åˆ¶æ ¼å¼å­˜å‚¨, ä¼šå‡ºç°å¤šç‰ˆæœ¬çš„æ ¼å¼, å¯¼è‡´æ–°è€ç‰ˆæœ¬ä¸å…¼å®¹.")]),t._v(" "),s("h4",{attrs:{id:"aofæŒä¹…åŒ–ğŸŒŸ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aofæŒä¹…åŒ–ğŸŒŸ"}},[t._v("#")]),t._v(" AOFæŒä¹…åŒ–ğŸŒŸ")]),t._v(" "),s("p",[t._v("ç”±äº RDB ä¸é€‚åˆå®æ—¶æŒä¹…åŒ–, æ‰€ä»¥ Redis æä¾›äº† AOF æŒä¹…åŒ–æ–¹å¼. "),s("strong",[t._v("AOF(Append Only File) æŒä¹…åŒ–")]),t._v(", æ˜¯"),s("mark",[s("strong",[t._v("å°† Redis æ‰§è¡Œçš„æ¯æ¬¡å†™å‘½ä»¤è®°å½•åˆ°å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶(appendonly.aof)ä¸­, å…ˆå†™å…¥ os cache, æ¯éš”ä¸€æ®µæ—¶é—´ fsync åˆ°ç£ç›˜, å½“ Redis é‡å¯æ—¶å†æ¬¡æ‰§è¡Œ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®")])]),t._v(". ä¸ RDB ç›¸æ¯”, AOF çš„"),s("strong",[t._v("å®æ—¶æ€§æ›´å¥½")]),t._v(", å› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–æ–¹æ¡ˆ.")]),t._v(" "),s("h5",{attrs:{id:"_1-é…ç½®æ–¹å¼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-é…ç½®æ–¹å¼"}},[t._v("#")]),t._v(" 1.é…ç½®æ–¹å¼")]),t._v(" "),s("p",[t._v("é…ç½®æ–‡ä»¶é…ç½®å¼€å¯ AOF: "),s("strong",[t._v("appendonly yes")]),t._v(".")]),t._v(" "),s("p",[t._v("æ–‡ä»¶åé…ç½®: "),s("strong",[t._v("appendfilename")]),t._v(". é»˜è®¤ appendonly.aof.")]),t._v(" "),s("p",[t._v("ä¿å­˜è·¯å¾„: "),s("strong",[t._v("dir")]),t._v(".")]),t._v(" "),s("p",[t._v("ç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥: "),s("strong",[t._v("appendfsync")]),t._v(" å‚æ•°é…ç½®.")]),t._v(" "),s("p",[t._v("å¼€å¯é…ç½®å, æ¯å½“ Redis æ‰§è¡Œä¸€ä¸ª"),s("strong",[t._v("æ”¹å˜æ•°æ®é›†çš„å‘½ä»¤")]),t._v("æ—¶(æ¯”å¦‚ SET), è¿™ä¸ªå‘½ä»¤å°±ä¼šè¢«è¿½åŠ åˆ° AOF æ–‡ä»¶çš„æœ«å°¾. è¿™æ ·çš„è¯, å½“ Redis é‡æ–°å¯åŠ¨æ—¶, ç¨‹åºå°±å¯ä»¥é€šè¿‡é‡æ–°æ‰§è¡Œ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥è¾¾åˆ°"),s("strong",[t._v("é‡å»ºæ•°æ®é›†")]),t._v("çš„ç›®çš„.")]),t._v(" "),s("h5",{attrs:{id:"_2-aofæ–‡ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-aofæ–‡ä»¶"}},[t._v("#")]),t._v(" 2.AOFæ–‡ä»¶")]),t._v(" "),s("p",[t._v('é…ç½®ä½¿ç”¨ AOF å, æ‰§è¡Œå‘½ä»¤ "set nano 666", åˆ™ aof æ–‡ä»¶é‡Œä¼šè®°å½•å¦‚ä¸‹æ•°æ®.')]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\nset\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\nnano\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("666")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("è¿™æ˜¯ä¸€ç§ "),s("strong",[t._v("resp åè®®æ ¼å¼æ•°æ®")]),t._v(", æ˜Ÿå·åé¢çš„æ•°å­—ä»£è¡¨å‘½ä»¤æœ‰å¤šå°‘ä¸ªå‚æ•°, $ å·åé¢çš„æ•°å­—ä»£è¡¨è¿™ä¸ªå‚æ•°æœ‰å‡ ä¸ªå­—ç¬¦. æ³¨æ„, å¦‚æœæ‰§è¡Œå¸¦è¿‡æœŸæ—¶é—´çš„ set å‘½ä»¤, aof æ–‡ä»¶é‡Œè®°å½•çš„æ˜¯å¹¶ä¸æ˜¯æ‰§è¡Œçš„åŸå§‹å‘½ä»¤, è€Œæ˜¯è®°å½• key è¿‡æœŸçš„æ—¶é—´æˆ³.")]),t._v(" "),s("p",[t._v('æ¯”å¦‚æ‰§è¡Œ "set nano 888 ex 1000", å¯¹åº” aof æ–‡ä»¶é‡Œè®°å½•å¦‚ä¸‹.')]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\nset\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\nnano\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("888")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PEXPIREAT")]),t._v("\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\nnano\n$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1604249786301")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("h5",{attrs:{id:"_3-å·¥ä½œæµç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-å·¥ä½œæµç¨‹"}},[t._v("#")]),t._v(" 3.å·¥ä½œæµç¨‹")]),t._v(" "),s("p",[t._v("AOF å·¥ä½œæµç¨‹å¦‚ä¸‹: å‘½ä»¤å†™å…¥, æ–‡ä»¶åŒæ­¥, æ–‡ä»¶é‡å†™, é‡å¯åŠ è½½.")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220522213407811.png",alt:""}})]),t._v(" "),s("h6",{attrs:{id:"_1-å‘½ä»¤å†™å…¥ç¼“å†²åŒº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å‘½ä»¤å†™å…¥ç¼“å†²åŒº"}},[t._v("#")]),t._v(" (1)å‘½ä»¤å†™å…¥ç¼“å†²åŒº")]),t._v(" "),s("p",[t._v("å‘½ä»¤éƒ½æ˜¯"),s("strong",[t._v("æ–‡æœ¬åè®®æ ¼å¼")]),t._v("å†™å…¥ AOF æ–‡ä»¶çš„, è¿™æ ·å¯ä»¥æé«˜å…¼å®¹æ€§åŒæ—¶é¿å…äºŒæ¬¡å¤„ç†çš„å¼€é”€, ä¸”"),s("strong",[t._v("å¯è¯»æ€§")]),t._v("æ›´å¥½.")]),t._v(" "),s("p",[t._v("å¦‚æœæ¯æ¡æŒ‡ä»¤éƒ½ç›´æ¥å†™å…¥ç¡¬ç›˜, é‚£å¼€é”€å¤ªå¤§äº†, å½“å¯¹ AOF æ—¥å¿—æ–‡ä»¶è¿›è¡Œå†™æ“ä½œæ—¶, "),s("strong",[t._v("æ‰€æœ‰å†™å‘½ä»¤éƒ½æ˜¯å…ˆè¿½åŠ åˆ° aod_buf(ç¼“å†²åŒº)ä¸­, ä¹‹åå†…æ ¸ä¼šæ ¹æ®ä¸€å®šçš„åŒæ­¥ç­–ç•¥å°†ç¼“å†²åŒºçš„å‘½ä»¤åˆ·åˆ°ç£ç›˜ä¸­")]),t._v(". Redis å¯ä»¥æä¾›å¤šç§ç¼“å†²åŒºåŒæ­¥ç­–ç•¥, å¦‚ä¸‹.")]),t._v(" "),s("h6",{attrs:{id:"_2-ç¼“å­˜åŒºåŒæ­¥åˆ·ç›˜ç­–ç•¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç¼“å­˜åŒºåŒæ­¥åˆ·ç›˜ç­–ç•¥"}},[t._v("#")]),t._v(" (2)ç¼“å­˜åŒºåŒæ­¥åˆ·ç›˜ç­–ç•¥")]),t._v(" "),s("p",[t._v("æœ‰å¤šç§ AOF ç¼“å†²åŒº"),s("strong",[t._v("åŒæ­¥æ–‡ä»¶çš„ç­–ç•¥")]),t._v(", ä¹Ÿå°±æ˜¯é…ç½® Redis å¤šä¹…æ‰å°†æ•°æ® fsync åˆ°ç£ç›˜ä¸€æ¬¡, ç”± "),s("strong",[t._v("appendfsync")]),t._v(" å‚æ•°é…ç½®, å¯é…ç½®å€¼å¦‚ä¸‹.")]),t._v(" "),s("p",[t._v("æ¨è(å¹¶ä¸”ä¹Ÿæ˜¯é»˜è®¤)çš„æªæ–½ä¸º "),s("mark",[s("strong",[t._v("everysec")])]),t._v(", è¿™ç§ç­–ç•¥å¯ä»¥å…¼é¡¾é€Ÿåº¦å’Œå®‰å…¨æ€§.")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("åŒæ­¥ç­–ç•¥å¯é…ç½®å€¼")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("è¯´æ˜")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("always")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å‘½ä»¤å†™å…¥ "),s("strong",[t._v("aof_buf")]),t._v(" å"),s("strong",[t._v("ç«‹å³è°ƒç”¨ç³»ç»Ÿ")]),t._v(" "),s("strong",[t._v("fsync æ“ä½œ")]),t._v("åŒæ­¥åˆ° AOF æ–‡ä»¶, fsync å®Œæˆåçº¿ç¨‹è¿”å›. è¿™æ ·"),s("strong",[t._v("æ¯æ¬¡æœ‰å†™å‘½ä»¤éƒ½è¦åŒæ­¥")]),t._v("åˆ° AOF æ–‡ä»¶, ç¡¬ç›˜ IO æˆä¸ºæ€§èƒ½ç“¶é¢ˆ, æ­¤æ—¶åªèƒ½æ”¯æŒå¤§çº¦"),s("strong",[t._v("å‡ ç™¾")]),t._v(" TPS å†™å…¥, åˆ«ç”¨!!!")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("no")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å‘½ä»¤å†™å…¥ "),s("strong",[t._v("aof_buf")]),t._v(" åè°ƒç”¨ç³»ç»Ÿ "),s("strong",[t._v("write æ“ä½œ")]),t._v(", ä¸å¯¹ AOF æ–‡ä»¶åš "),s("strong",[t._v("fsync åŒæ­¥")]),t._v("; åŒæ­¥"),s("strong",[t._v("ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£")]),t._v(", é€šå¸¸åŒæ­¥å‘¨æœŸä¸º "),s("strong",[t._v("30 ç§’")]),t._v(". æ–‡ä»¶åŒæ­¥çš„æ—¶é—´"),s("strong",[t._v("ä¸å¯æ§")]),t._v(", ä¸”ç¼“å†²åŒºä¸­å †ç§¯çš„æ•°æ®ä¼šå¾ˆå¤š, æ•°æ®å®‰å…¨æ€§"),s("strong",[t._v("æ— æ³•ä¿è¯")]),t._v(".")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("mark",[s("strong",[t._v("everysec")])])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å‘½ä»¤å†™å…¥ "),s("strong",[t._v("aof_buf")]),t._v(" åè°ƒç”¨ç³»ç»Ÿ "),s("strong",[t._v("write æ“ä½œ")]),t._v(", write å®Œæˆåçº¿ç¨‹"),s("strong",[t._v("è¿”å›")]),t._v("; "),s("strong",[t._v("fsync åŒæ­¥æ–‡ä»¶")]),t._v("æ“ä½œç”±"),s("strong",[t._v("ä¸“é—¨çš„çº¿ç¨‹æ¯ç§’è°ƒç”¨ä¸€æ¬¡")]),t._v(". å®ƒæ˜¯å‰è¿°ä¸¤ç§ç­–ç•¥çš„æŠ˜ä¸­, æ˜¯æ€§èƒ½å’Œæ•°æ®å®‰å…¨æ€§çš„å¹³è¡¡, å› æ­¤æ˜¯ Redis çš„"),s("strong",[t._v("é»˜è®¤æ¨èé…ç½®")]),t._v(". ç†è®ºä¸Šæ¥è¯´ç³»ç»Ÿå®•æœºä¸¢å¤±çš„æ•°æ®ä¹Ÿåœ¨ "),s("strong",[t._v("2 ç§’")]),t._v("ä¹‹å†…(ä¸æ˜¯ 1 ç§’).")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("å…³äºç³»ç»Ÿè°ƒç”¨writeä¸fsync")])]),t._v(" "),s("p",[s("strong",[t._v("write ç³»ç»Ÿè°ƒç”¨ä¼šè§¦å‘å»¶è¿Ÿå†™æœºåˆ¶")]),t._v(". Linux åœ¨å†…æ ¸æä¾›é¡µç¼“å†²åŒºæ¥æé«˜ç¡¬ç›˜ IO æ€§èƒ½. write æ“ä½œåœ¨"),s("strong",[t._v("å†™å…¥ç³»ç»Ÿç¼“å†²åŒºåç›´æ¥è¿”å›")]),t._v(". åŒæ­¥ç¡¬ç›˜æ“ä½œ"),s("strong",[t._v("ä¾èµ–äºç³»ç»Ÿè°ƒåº¦æœºåˆ¶")]),t._v(". åŒæ­¥æ–‡ä»¶ä¹‹å‰, å¦‚æœç³»ç»Ÿå®•æœº, é‚£ä¹ˆç¼“å†²åŒºå†…çš„æ•°æ®å°±ä¼šä¸¢å¤±.")]),t._v(" "),s("p",[s("strong",[t._v("fsync ç³»ç»Ÿè°ƒç”¨")]),t._v("é’ˆå¯¹å•ä¸ªæ–‡ä»¶æ“ä½œ(æ¯”å¦‚ AOF æ–‡ä»¶), å°†"),s("strong",[t._v("é˜»å¡")]),t._v("ç›´åˆ°æ•°æ®å†™å…¥ç¡¬ç›˜åè¿”å›, åš"),s("strong",[t._v("å¼ºåˆ¶ç¡¬ç›˜åŒæ­¥")]),t._v(", ä¿è¯æ•°æ®æŒä¹…åŒ–, ä½†æ˜¯å¼€é”€æ›´å¤§.")]),t._v(" "),s("h6",{attrs:{id:"_3-aofæ–‡ä»¶é‡å†™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-aofæ–‡ä»¶é‡å†™"}},[t._v("#")]),t._v(" (3)AOFæ–‡ä»¶é‡å†™")]),t._v(" "),s("p",[t._v("Redis æœåŠ¡å™¨æ‰§è¡Œçš„"),s("strong",[t._v("å†™å‘½ä»¤")]),t._v("éšæ—¶é—´è¶Šæ¥è¶Šå¤š, AOF æ–‡ä»¶ä¹Ÿä¼š"),s("strong",[t._v("è¶Šæ¥è¶Šå¤§, å¹¶ä¸”å¾ˆå¤šå‘½ä»¤å¯èƒ½æ˜¯æ²¡ç”¨çš„")]),t._v("; è¿‡å¤§çš„ AOF æ–‡ä»¶ä¸ä»…ä¼šå½±å“æœåŠ¡å™¨çš„æ­£å¸¸è¿è¡Œ, ä¹Ÿä¼šå¯¼è‡´æ•°æ®æ¢å¤éœ€è¦çš„æ—¶é—´è¿‡é•¿. "),s("strong",[t._v("æ‰€ä»¥ AOF ä¼šå®šæœŸæ ¹æ®å†…å­˜çš„æœ€æ–°æ•°æ®ç”Ÿæˆæ–°çš„ AOF æ–‡ä»¶")]),t._v(".")]),t._v(" "),s("p",[t._v("æ¯”å¦‚æ‰§è¡Œäº†å¦‚ä¸‹å‡ æ¡å‘½ä»¤:")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" incr readcount\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" incr readcount\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" incr readcount\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" incr readcount\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:637"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("9")]),t._v(">")]),t._v(" incr readcount\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[t._v("è¿™é‡Œ AOF ä¼šè®°å½•äº”æ¬¡å˜æ›´å‘½ä»¤, å¯¹å…¶è¿›è¡Œé‡å†™(å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ bgrewriteaof å‘½ä»¤)å AOF æ–‡ä»¶é‡Œå˜æˆ:")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("*3\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$3")]),t._v("\nSET\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v("\nreadcount\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("ä¹Ÿå°±æ˜¯ç›´æ¥å°† readcount è®¾ç½®ä¸º 5.")]),t._v(" "),s("blockquote",[s("p",[t._v("AOFæŒä¹…åŒ–æ–¹å¼ä¸ºä»€ä¹ˆè¦æ–‡ä»¶é‡å†™?")])]),t._v(" "),s("p",[s("strong",[t._v("AOF é‡å†™")]),t._v("æ˜¯æŒ‡"),s("strong",[t._v("å®šæœŸé‡å†™ AOF æ–‡ä»¶")]),t._v(", "),s("strong",[t._v("å‡å°äº† AOF æ–‡ä»¶çš„ä½“ç§¯")]),t._v(". ç”±äºé‡å†™å AOF æ‰§è¡Œçš„å‘½ä»¤å‡å°‘äº†, æ–‡ä»¶é‡å†™æ—¢å¯ä»¥å‡å°‘æ–‡ä»¶å ç”¨çš„ç©ºé—´, ä¹Ÿå¯ä»¥"),s("strong",[t._v("åŠ å¿«åŠ è½½æ¢å¤çš„é€Ÿåº¦")]),t._v(".")]),t._v(" "),s("blockquote",[s("p",[t._v("æ–‡ä»¶é‡å†™ä¸ºä»€ä¹ˆèƒ½å‹ç¼©AOFæ–‡ä»¶?")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("è¿‡æœŸ")]),t._v("çš„æ•°æ®ä¸éœ€è¦å†å†™å…¥æ–‡ä»¶.")]),t._v(" "),s("li",[s("strong",[t._v("æ— æ•ˆçš„å‘½ä»¤")]),t._v("ä¸å†å†™å…¥æ–‡ä»¶: å¦‚æœ‰äº›æ•°æ®è¢«é‡å¤è®¾å€¼(set mykey v1, set mykey v2), æœ‰äº›æ•°æ®è¢«åˆ é™¤äº†(sadd myset v1, del myset)ç­‰.")]),t._v(" "),s("li",[t._v("å¤šæ¡å‘½ä»¤å¯ä»¥"),s("strong",[t._v("åˆå¹¶ä¸ºä¸€ä¸ª")]),t._v(": å¦‚ sadd myset v1, sadd myset v2, sadd myset v3 å¯ä»¥åˆå¹¶ä¸º sadd myset v1 v2 v3.")])]),t._v(" "),s("p",[t._v("éœ€è¦æ³¨æ„, "),s("strong",[t._v("AOF é‡å†™")]),t._v("æ˜¯æŠŠ Redis "),s("strong",[t._v("è¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸ºå†™å‘½ä»¤")]),t._v(", åŒæ­¥åˆ°æ–°çš„ AOF æ–‡ä»¶; "),s("strong",[t._v("ä¸ä¼šå¯¹æ—§çš„")]),t._v(" AOF æ–‡ä»¶è¿›è¡Œä»»ä½•è¯»å†™æ“ä½œ!")]),t._v(" "),s("blockquote",[s("p",[t._v("AOFé‡å†™ä½•æ—¶è¿›è¡Œ? è§¦å‘æœºåˆ¶?")])]),t._v(" "),s("p",[s("strong",[t._v("(1)")]),t._v(" "),s("strong",[t._v("æ‰‹åŠ¨è§¦å‘")]),t._v(": ç›´æ¥è°ƒç”¨ "),s("strong",[t._v("bgrewriteaof")]),t._v(" å‘½ä»¤. è¯¥å‘½ä»¤çš„æ‰§è¡Œä¸ bgsave æœ‰äº›ç±»ä¼¼: éƒ½æ˜¯ fork å­è¿›ç¨‹è¿›è¡Œå…·ä½“çš„å·¥ä½œ, ä¸”éƒ½åªæœ‰åœ¨ fork æ—¶é˜»å¡.")]),t._v(" "),s("p",[s("strong",[t._v("(2) è‡ªåŠ¨è§¦å‘")]),t._v(": æ ¹æ® "),s("strong",[t._v("auto-aof-rewrite-min-size")]),t._v(" å’Œ "),s("strong",[t._v("auto-aof-rewrite-percentage")]),t._v(" é…ç½®, ä»¥åŠ aof_current_size å’Œ aof_base_size çŠ¶æ€ç¡®å®šè§¦å‘æ—¶æœº.")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("auto-aof-rewrite-min-size")]),t._v(": æ‰§è¡Œ AOF "),s("strong",[t._v("é‡å†™æ—¶")]),t._v(", æ–‡ä»¶çš„"),s("strong",[t._v("æœ€å°ä½“ç§¯")]),t._v(", é»˜è®¤å€¼ä¸º 64MB.")]),t._v(" "),s("li",[t._v("auto-aof-rewrite-percentage: æ‰§è¡Œ AOF é‡å†™æ—¶, "),s("strong",[t._v("å½“å‰")]),t._v(" AOF å¤§å°(å³ aof_current_size)å’Œä¸Šä¸€æ¬¡é‡å†™æ—¶ AOF å¤§å°(aof_base_size)çš„"),s("strong",[t._v("æ¯”å€¼")]),t._v('. æ¯”å¦‚ "auto-aof-rewrite-percentage 100" è¡¨ç¤º aof æ–‡ä»¶è‡ªä¸Šä¸€æ¬¡é‡å†™åæ–‡ä»¶å¤§å°å¢é•¿äº† 100% åˆ™å†æ¬¡è§¦å‘é‡å†™.')])]),t._v(" "),s("p",[t._v("åªæœ‰å½“ auto-aof-rewrite-min-size å’Œ auto-aof-rewrite-percentage ä¸¤ä¸ªå‚æ•°"),s("strong",[t._v("åŒæ—¶æ»¡è¶³")]),t._v("æ—¶, æ‰ä¼šè‡ªåŠ¨è§¦å‘ AOF é‡å†™, è¿™æ ·ä¹Ÿä¼šæ‰§è¡Œ "),s("strong",[t._v("bgrewriteaof")]),t._v(" æ“ä½œ.")]),t._v(" "),s("blockquote",[s("p",[t._v("AOFé‡å†™æµç¨‹")])]),t._v(" "),s("p",[t._v("AOF é‡å†™æµç¨‹ä¹Ÿå°±æ˜¯æ‰§è¡Œ "),s("strong",[t._v("bgrewriteaof")]),t._v(" çš„æµç¨‹, å¦‚ä¸‹å›¾.")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220522213612372.png",alt:""}})]),t._v(" "),s("p",[t._v("(1) Redis çˆ¶è¿›ç¨‹é¦–å…ˆåˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨"),s("strong",[t._v("æ­£åœ¨æ‰§è¡Œ")]),t._v(" bgsave/bgrewriteaof çš„å­è¿›ç¨‹, å¦‚æœå­˜åœ¨åˆ™ bgrewriteaof å‘½ä»¤"),s("strong",[t._v("ç›´æ¥è¿”å›")]),t._v("; å¦‚æœå­˜åœ¨ bgsave å‘½ä»¤åˆ™ç­‰ bgsave æ‰§è¡Œå®Œæˆåå†æ‰§è¡Œ, è¿™ä¸ªä¸»è¦æ˜¯åŸºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘.")]),t._v(" "),s("p",[t._v("(2) çˆ¶è¿›ç¨‹æ‰§è¡Œ "),s("strong",[t._v("fork æ“ä½œ")]),t._v("åˆ›å»º"),s("strong",[t._v("å­è¿›ç¨‹")]),t._v(", è¿™ä¸ªè¿‡ç¨‹ä¸­"),s("strong",[t._v("çˆ¶è¿›ç¨‹æ˜¯é˜»å¡")]),t._v("çš„, ä»…è¿™ä¸€æ®µæ—¶é—´.")]),t._v(" "),s("p",[t._v("(3) çˆ¶è¿›ç¨‹ fork å, "),s("strong",[t._v("bgrewriteaof å‘½ä»¤è¿”å›")]),t._v(' "Background append only file rewrite started" ä¿¡æ¯å¹¶'),s("strong",[t._v("ä¸å†é˜»å¡")]),t._v("çˆ¶è¿›ç¨‹, ç„¶åå¯ä»¥ç»§ç»­å“åº”å…¶ä»–å‘½ä»¤. Redis çš„æ‰€æœ‰å†™å‘½ä»¤"),s("strong",[t._v("ä¾ç„¶å†™å…¥ AOF ç¼“å†²åŒº")]),t._v(", å¹¶æ ¹æ® appendfsync ç­–ç•¥åŒæ­¥åˆ°ç¡¬ç›˜, ä¿è¯åŸæœ‰ AOF æœºåˆ¶çš„æ­£ç¡®.")]),t._v(" "),s("p",[t._v("(4) ç”±äº fork æ“ä½œä½¿ç”¨"),s("mark",[s("strong",[t._v("å†™æ—¶å¤åˆ¶æŠ€æœ¯")])]),t._v(", å­è¿›ç¨‹åªèƒ½"),s("strong",[t._v("å…±äº« fork æ“ä½œæ—¶")]),t._v("çš„å†…å­˜æ•°æ®. ç”±äºçˆ¶è¿›ç¨‹"),s("strong",[t._v("ä¾ç„¶åœ¨å“åº”å‘½ä»¤")]),t._v(", å› æ­¤ Redis ä½¿ç”¨ "),s("strong",[t._v("AOF é‡å†™ç¼“å†²åŒº")]),t._v("(å›¾ä¸­çš„ aof_rewrite_buf)ä¿å­˜è¿™éƒ¨åˆ†æ•°æ®, é˜²æ­¢"),s("strong",[t._v("æ–° AOF æ–‡ä»¶ç”ŸæˆæœŸé—´ä¸¢å¤±è¿™éƒ¨åˆ†æ•°æ®")]),t._v(". ä¹Ÿå°±æ˜¯è¯´, bgrewriteaof æ‰§è¡ŒæœŸé—´, Redis çš„"),s("strong",[t._v("å†™å‘½ä»¤åŒæ—¶è¿½åŠ ")]),t._v("åˆ° aof_buf å’Œ aof_rewirte_buf ä¸¤ä¸ªç¼“å†²åŒº. ç¼“å†²åŒºä¸“é—¨ç”¨äºä¿å­˜"),s("strong",[t._v("åœ¨é‡å†™æœŸé—´æ“ä½œæ•°æ®å¸¦æ¥çš„å˜åŒ–")]),t._v(".")]),t._v(" "),s("p",[t._v("(5) å­è¿›ç¨‹æ ¹æ®"),s("strong",[t._v("å†…å­˜å¿«ç…§")]),t._v(", æŒ‰ç…§å‘½ä»¤åˆå¹¶è§„åˆ™å†™å…¥åˆ°"),s("strong",[t._v("æ–°çš„ AOF")]),t._v(" æ–‡ä»¶. å­è¿›ç¨‹å†™å®Œæ–°çš„ AOF æ–‡ä»¶å, å‘çˆ¶è¿›ç¨‹å‘ä¿¡å·, çˆ¶è¿›ç¨‹æ›´æ–°"),s("strong",[t._v("ç»Ÿè®¡ä¿¡æ¯")]),t._v(", å…·ä½“å¯ä»¥é€šè¿‡ "),s("strong",[t._v("info persistence")]),t._v(" æŸ¥çœ‹.")]),t._v(" "),s("p",[t._v("(6) çˆ¶è¿›ç¨‹æŠŠ AOF "),s("strong",[t._v("é‡å†™ç¼“å†²åŒº(aof_rewrite_buf)")]),t._v("  çš„æ•°æ®å†™å…¥åˆ°"),s("strong",[t._v("æ–°çš„")]),t._v(" AOF æ–‡ä»¶, è¿™æ ·å°±ä¿è¯äº†æ–° AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€å’ŒæœåŠ¡å™¨"),s("strong",[t._v("å½“å‰çŠ¶æ€ä¸€è‡´")]),t._v(".")]),t._v(" "),s("p",[t._v("(7) ä½¿ç”¨æ–°çš„ AOF æ–‡ä»¶"),s("strong",[t._v("æ›¿æ¢")]),t._v("è€æ–‡ä»¶, å®Œæˆ AOF é‡å†™.")]),t._v(" "),s("p",[t._v("æ•´ä¸ªè¿‡ç¨‹ä¸ä¼šå¯¹æ­£å¸¸å‘½ä»¤å¤„ç†æœ‰å¤ªå¤šå½±å“.")]),t._v(" "),s("h6",{attrs:{id:"_4-é‡å¯åŠ è½½"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-é‡å¯åŠ è½½"}},[t._v("#")]),t._v(" (4)é‡å¯åŠ è½½")]),t._v(" "),s("p",[t._v("å½“ AOF "),s("strong",[t._v("å¼€å¯")]),t._v("æ—¶, Redis å¯åŠ¨æ—¶ä¼š"),s("strong",[t._v("ä¼˜å…ˆè½½å…¥ AOF æ–‡ä»¶")]),t._v("æ¥æ¢å¤æ•°æ®; åªæœ‰å½“ "),s("strong",[t._v("AOF å…³é—­")]),t._v("æ—¶, æ‰ä¼šè½½å…¥ "),s("strong",[t._v("RDB")]),t._v(" æ–‡ä»¶æ¢å¤æ•°æ®.")]),t._v(" "),s("p",[s("strong",[t._v("æ–‡ä»¶æ ¡éªŒæœºåˆ¶")]),t._v(": å¦‚æœ"),s("strong",[t._v("åŠ è½½æŸå")]),t._v("çš„ AOF æ–‡ä»¶æ—¶ä¼š"),s("strong",[t._v("æ‹’ç»å¯åŠ¨")]),t._v(", å¹¶æ‰“å°æ—¥å¿—.")]),t._v(" "),s("h5",{attrs:{id:"_4-rdbä¸aofçš„å¯¹æ¯”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-rdbä¸aofçš„å¯¹æ¯”"}},[t._v("#")]),t._v(" 4.RDBä¸AOFçš„å¯¹æ¯”")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("å‘½ä»¤")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("RDB")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("AOF")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯åŠ¨ä¼˜å…ˆçº§")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("ä½")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("é«˜")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("strong",[t._v("æ–‡ä»¶ä½“ç§¯")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å°")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¤§")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("strong",[t._v("æ¢å¤é€Ÿåº¦")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¿«")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("æ…¢(éœ€è¦é‡æ”¾æ‰€æœ‰å‘½ä»¤)")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("æ•°æ®å®‰å…¨æ€§")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å®¹æ˜“ä¸¢æ•°æ®")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("æ ¹æ®ç­–ç•¥å†³å®š")])])])]),t._v(" "),s("p",[t._v("ç”Ÿäº§ç¯å¢ƒå¯ä»¥éƒ½å¯ç”¨, Redis å¯åŠ¨æ—¶å¦‚æœæ—¢æœ‰ RDB æ–‡ä»¶åˆæœ‰ AOF æ–‡ä»¶åˆ™ä¼˜å…ˆé€‰æ‹© AOF æ–‡ä»¶æ¢å¤æ•°æ®, å› ä¸º AOF ä¸€èˆ¬æ¥è¯´æ•°æ®æ›´å…¨ä¸€ç‚¹.")]),t._v(" "),s("h4",{attrs:{id:"æ··åˆæŒä¹…åŒ–"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ··åˆæŒä¹…åŒ–"}},[t._v("#")]),t._v(" æ··åˆæŒä¹…åŒ–")]),t._v(" "),s("p",[t._v("é‡å¯ Redis æ—¶, å¾ˆå°‘ä½¿ç”¨ RDB æ¥æ¢å¤å†…å­˜çŠ¶æ€, å› ä¸ºä¼šä¸¢å¤±å¤§é‡æ•°æ®. é€šå¸¸ä½¿ç”¨ "),s("strong",[t._v("AOF æ—¥å¿—é‡æ”¾")]),t._v(", ä½†æ˜¯é‡æ”¾ AOF æ—¥å¿—æ€§èƒ½ç›¸å¯¹ RDB æ¥è¯´è¦"),s("strong",[t._v("æ…¢å¾ˆå¤š")]),t._v(", è¿™æ ·åœ¨ Redis å®ä¾‹å¾ˆå¤§çš„æƒ…å†µä¸‹, å¯åŠ¨éœ€è¦èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´.")]),t._v(" "),s("p",[s("strong",[t._v("Redis 4.0")]),t._v(" ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜, æ–°å¢äº†ä¸€ä¸ªæ–°çš„æŒä¹…åŒ–é€‰é¡¹: "),s("strong",[t._v("æ··åˆæŒä¹…åŒ–")]),t._v(". å°† RDB æ–‡ä»¶çš„å†…å®¹å’Œå¢é‡çš„ AOF æ—¥å¿—æ–‡ä»¶"),s("strong",[t._v("å­˜åœ¨ä¸€èµ·")]),t._v(". è¿™é‡Œçš„ AOF æ—¥å¿—ä¸å†æ˜¯å…¨é‡çš„æ—¥å¿—, è€Œæ˜¯"),s("strong",[t._v("è‡ªæŒä¹…åŒ–å¼€å§‹åˆ°æŒä¹…åŒ–ç»“æŸ")]),t._v("çš„è¿™æ®µæ—¶é—´å‘ç”Ÿçš„"),s("strong",[t._v("å¢é‡ AOF æ—¥å¿—")]),t._v(", é€šå¸¸è¿™éƒ¨åˆ† AOF æ—¥å¿—å¾ˆå°:")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/image-20240106100908-qvhzogn.png",alt:"image"}})]),t._v(" "),s("p",[t._v("äºæ˜¯åœ¨ Redis é‡å¯çš„æ—¶å€™, å¯ä»¥"),s("strong",[t._v("å…ˆåŠ è½½ RDB çš„å†…å®¹, ç„¶åå†é‡æ”¾å¢é‡çš„ AOF æ—¥å¿—")]),t._v("å°±å¯ä»¥å®Œå…¨æ›¿ä»£ä¹‹å‰çš„ AOF å…¨é‡æ–‡ä»¶é‡æ”¾, "),s("strong",[t._v("é‡å¯æ•ˆç‡å› æ­¤å¤§å¹…å¾—åˆ°æå‡")]),t._v(".")]),t._v(" "),s("p",[t._v("é€šè¿‡å¦‚ä¸‹é…ç½®å¯ä»¥å¼€å¯æ··åˆæŒä¹…åŒ–(å¿…é¡»å…ˆå¼€å¯ AOF, å› ä¸ºæ··åˆæŒä¹…åŒ–æœ¬è´¨ä¸Šæ¥è¯´å…¶å®æ˜¯ AOF çš„ä¼˜åŒ–):")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# aof-use-rdb-preamble yes")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("å¦‚æœå¼€å¯äº†æ··åˆæŒä¹…åŒ–, AOF åœ¨é‡å†™æ—¶, ä¸å†æ˜¯å•çº¯å°†å†…å­˜æ•°æ®è½¬æ¢ä¸º RESP å‘½ä»¤å†™å…¥ AOF æ–‡ä»¶, è€Œæ˜¯å°†é‡å†™è¿™ä¸€åˆ»"),s("strong",[t._v("ä¹‹å‰çš„å†…å­˜åš RDB å¿«ç…§å¤„ç†")]),t._v(", å¹¶ä¸”å°† RDB å¿«ç…§å†…å®¹å’Œå¢é‡çš„ AOF ä¿®æ”¹å†…å­˜æ•°æ®çš„å‘½ä»¤å­˜åœ¨ä¸€èµ·, éƒ½å†™å…¥æ–°çš„ AOF æ–‡ä»¶, æ–°çš„æ–‡ä»¶ä¸€å¼€å§‹ä¸å« appendonly.aof, ç­‰åˆ°é‡å†™å®Œæ–°çš„ AOF æ–‡ä»¶æ‰ä¼šè¿›è¡Œæ”¹å, è¦†ç›–åŸæœ‰çš„ AOF æ–‡ä»¶, å®Œæˆæ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶çš„æ›¿æ¢.")]),t._v(" "),s("h4",{attrs:{id:"æŒä¹…åŒ–çš„é—®é¢˜ä¸ä¼˜åŒ–ğŸŒŸ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŒä¹…åŒ–çš„é—®é¢˜ä¸ä¼˜åŒ–ğŸŒŸ"}},[t._v("#")]),t._v(" æŒä¹…åŒ–çš„é—®é¢˜ä¸ä¼˜åŒ–ğŸŒŸ")]),t._v(" "),s("p",[t._v("æŒä¹…åŒ–é˜»å¡ä¸»çº¿ç¨‹åœºæ™¯ä¸»è¦æœ‰: "),s("strong",[t._v("fork é˜»å¡å’Œ AOF è¿½åŠ é˜»å¡")]),t._v(". "),s("strong",[t._v("fork é˜»å¡æ—¶é—´è·Ÿå†…å­˜å’Œç³»ç»Ÿæœ‰å…³, AOF è¿½åŠ é˜»å¡è¯´æ˜ç³»ç»Ÿç¡¬ç›˜èµ„æºç´§å¼ .")])]),t._v(" "),s("h5",{attrs:{id:"_1-forkæ“ä½œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-forkæ“ä½œ"}},[t._v("#")]),t._v(" 1.forkæ“ä½œ")]),t._v(" "),s("p",[t._v("å½“ Redis åš RDB æˆ– AOF é‡å†™æ—¶, å¿…ä¸å¯å°‘çš„æ“ä½œå°±æ˜¯æ‰§è¡Œ "),s("strong",[t._v("fork ç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºå­è¿›ç¨‹")]),t._v(", ä½†è¿™æ˜¯ä¸€ä¸ª"),s("strong",[t._v("é‡é‡çº§æ“ä½œ")]),t._v(". è™½ç„¶ fork åˆ›å»ºçš„å­è¿›ç¨‹ä¸éœ€è¦æ‹·è´çˆ¶è¿›ç¨‹çš„ç‰©ç†ç©ºé—´, ä½†æ˜¯ä¼š"),s("strong",[t._v("å¤åˆ¶çˆ¶è¿›ç¨‹çš„ç©ºé—´å†…å­˜é¡µè¡¨")]),t._v("(é¡µè¡¨ç›¸å½“äºå†…å­˜çš„ç´¢å¼•, ç›®å½•). æ‰€ä»¥ fork æ“ä½œè€—æ—¶ä¸"),s("strong",[t._v("è¿›ç¨‹æ€»å†…å­˜é‡")]),t._v("æ¯æ¯ç›¸å…³. "),s("strong",[t._v("çˆ¶è¿›ç¨‹")]),t._v("çš„æ•°æ®ç©ºé—´è¶Šå¤§, å†…å­˜é¡µè¡¨è¶Šå¤§, fork æ—¶å¤åˆ¶"),s("strong",[t._v("è€—æ—¶ä¹Ÿä¼šè¶Šå¤š")]),t._v(".")]),t._v(" "),s("blockquote",[s("p",[t._v("å¦‚ä½•æ”¹å–„forkæ“ä½œçš„è€—æ—¶?")])]),t._v(" "),s("ul",[s("li",[t._v("æ§åˆ¶ Redis å®ä¾‹"),s("strong",[t._v("æœ€å¤§å¯ç”¨å†…å­˜")]),t._v(", fork è€—æ—¶ä¸å†…å­˜é‡æˆæ­£æ¯”. çº¿ä¸Šå»ºè®®ä¸€ä¸ª Redis å®ä¾‹å†…å­˜æ§åˆ¶åœ¨ 10GB ä¹‹å†….")]),t._v(" "),s("li",[t._v("åˆç†é…ç½® Linux å†…å­˜åˆ†é…ç­–ç•¥, é¿å…"),s("strong",[t._v("ç‰©ç†å†…å­˜ä¸è¶³")]),t._v("å¯¼è‡´ fork å¤±è´¥.")]),t._v(" "),s("li",[t._v("é™ä½ fork æ“ä½œé¢‘ç‡, å¦‚å¯ç”¨é€‚å½“æ”¾å®½ AOF è‡ªåŠ¨è§¦å‘æ—¶æœº.")])]),t._v(" "),s("h5",{attrs:{id:"_2-å­è¿›ç¨‹å¼€é”€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å­è¿›ç¨‹å¼€é”€"}},[t._v("#")]),t._v(" 2.å­è¿›ç¨‹å¼€é”€")]),t._v(" "),s("p",[t._v("éœ€è¦é‡ç‚¹å…³æ³¨.")]),t._v(" "),s("ul",[s("li",[t._v("CPU: å°½é‡ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œ.")]),t._v(" "),s("li",[t._v("å†…å­˜: é¿å…åœ¨å¤§é‡å†™å…¥æ—¶åšå­è¿›ç¨‹"),s("strong",[t._v("é‡å†™")]),t._v("æ“ä½œ, è¿™æ ·å°†å¯¼è‡´çˆ¶è¿›ç¨‹ç»´æŠ¤å¤§é‡é¡µå‰¯æœ¬, é€ æˆå†…å­˜æ¶ˆè€—.")]),t._v(" "),s("li",[t._v("ç¡¬ç›˜: ä¸è¦å’Œå…¶ä»–é«˜ç¡¬ç›˜è´Ÿè½½çš„æœåŠ¡éƒ¨ç½²åˆ°ä¸€èµ·, å¦‚å­˜å‚¨æœåŠ¡, æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ç­‰.")])]),t._v(" "),s("h5",{attrs:{id:"_3-aofè¿½åŠ é˜»å¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-aofè¿½åŠ é˜»å¡"}},[t._v("#")]),t._v(" 3.AOFè¿½åŠ é˜»å¡")]),t._v(" "),s("p",[t._v("AOF æŒä¹…åŒ–æ—¶ "),s("strong",[t._v("everysec")]),t._v(" æ˜¯å¸¸ç”¨çš„åŒæ­¥ç¡¬ç›˜ç­–ç•¥. Redis ä½¿ç”¨"),s("strong",[t._v("å¦ä¸€æ¡çº¿ç¨‹æ¯ç§’æ‰§è¡Œ fsync åŒæ­¥ç¡¬ç›˜")]),t._v(". å½“ç³»ç»Ÿèµ„æº"),s("strong",[t._v("ç¹å¿™")]),t._v("æ—¶, ä¼šé€ æˆ Redis "),s("strong",[t._v("ä¸»çº¿ç¨‹é˜»å¡")]),t._v(".")]),t._v(" "),s("p",[t._v("æ³¨æ„: "),s("strong",[t._v("everysec")]),t._v(" é…ç½®"),s("strong",[t._v("æœ€å¤šå¯èƒ½ä¸¢å¤± 2 ç§’")]),t._v("å†…çš„æ•°æ®, ä¸æ˜¯ 1 ç§’. å¦‚æœç³»ç»Ÿ fsync ç¼“æ…¢, å°†ä¼šå¯¼è‡´ Redis çº¿ç¨‹é˜»å¡å½±å“æ•ˆç‡.")]),t._v(" "),s("h4",{attrs:{id:"redisæ•°æ®å¤‡ä»½ç­–ç•¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redisæ•°æ®å¤‡ä»½ç­–ç•¥"}},[t._v("#")]),t._v(" Redisæ•°æ®å¤‡ä»½ç­–ç•¥")]),t._v(" "),s("ol",[s("li",[t._v("å†™ crontab å®šæ—¶è°ƒåº¦è„šæœ¬, æ¯å°æ—¶éƒ½ copy ä¸€ä»½ rdb æˆ– aof çš„å¤‡ä»½åˆ°ä¸€ä¸ªç›®å½•ä¸­å», ä»…ä»…ä¿ç•™æœ€è¿‘ 48 å°æ—¶çš„å¤‡ä»½.")]),t._v(" "),s("li",[t._v("æ¯å¤©éƒ½ä¿ç•™ä¸€ä»½å½“æ—¥çš„æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªç›®å½•ä¸­å», å¯ä»¥ä¿ç•™æœ€è¿‘ 1 ä¸ªæœˆçš„å¤‡ä»½.")]),t._v(" "),s("li",[t._v("æ¯æ¬¡ copy å¤‡ä»½çš„æ—¶å€™, éƒ½æŠŠå¤ªæ—§çš„å¤‡ä»½ç»™åˆ äº†.")]),t._v(" "),s("li",[t._v("æ¯å¤©æ™šä¸Šå°†å½“å‰æœºå™¨ä¸Šçš„å¤‡ä»½å¤åˆ¶ä¸€ä»½åˆ°å…¶ä»–æœºå™¨ä¸Š, ä»¥é˜²æœºå™¨æŸå.")])]),t._v(" "),s("p",[t._v("â€")]),t._v(" "),s("p",[t._v("â€")]),t._v(" "),s("h4",{attrs:{id:"å‚è€ƒèµ„æ–™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒèµ„æ–™"}},[t._v("#")]),t._v(" å‚è€ƒèµ„æ–™")]),t._v(" "),s("ul",[s("li",[t._v("ã€ŠRediså¼€å‘ä¸è¿ç»´ã€‹")])])])}),[],!1,null,null,null);s.default=r.exports}}]);