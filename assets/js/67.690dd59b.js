(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{402:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_400-javaå¹¶å‘ç¼–ç¨‹å®æˆ˜-æå®¢æ—¶é—´-ğŸŒ¸"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_400-javaå¹¶å‘ç¼–ç¨‹å®æˆ˜-æå®¢æ—¶é—´-ğŸŒ¸"}},[s._v("#")]),s._v(" 400.Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜(æå®¢æ—¶é—´)ğŸŒ¸")]),s._v(" "),t("h3",{attrs:{id:"å¼€ç¯‡è¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼€ç¯‡è¯"}},[s._v("#")]),s._v(" å¼€ç¯‡è¯")]),s._v(" "),t("h4",{attrs:{id:"å¼€ç¯‡è¯-ä½ ä¸ºä»€ä¹ˆéœ€è¦å­¦ä¹ å¹¶å‘ç¼–ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼€ç¯‡è¯-ä½ ä¸ºä»€ä¹ˆéœ€è¦å­¦ä¹ å¹¶å‘ç¼–ç¨‹"}},[s._v("#")]),s._v(" å¼€ç¯‡è¯-ä½ ä¸ºä»€ä¹ˆéœ€è¦å­¦ä¹ å¹¶å‘ç¼–ç¨‹?")]),s._v(" "),t("p",[s._v("ä½ å¥½, æˆ‘æ˜¯ç‹å®ä»¤, èµ„æ·±æ¶æ„å¸ˆ, ç›®å‰ä»äº‹ç”µå•†æ¶æ„çš„è®¾è®¡å·¥ä½œ. ä»æ¯•ä¸šåˆ°ç°åœ¨, æˆ‘å‰å‰ååå†™äº† 15 å¹´çš„ç¨‹åº, åˆšæ¯•ä¸šçš„æ—¶å€™ä»äº‹è¯åˆ¸ä¸šåŠ¡çš„å¼€å‘, å¼€å‘è¯­è¨€æ˜¯ C/C++, ä¹‹åä»äº‹ ERP äº§å“çš„ç ”å‘, å¼€å‘è¯­è¨€ä¸»è¦æ˜¯ C# å’Œ Java, æœ€è¿‘å‡ å¹´ä¸»è¦æ˜¯ä»äº‹ Java å¼€å‘å¹³å°å’ŒåŸºç¡€ä¸­é—´ä»¶çš„è®¾è®¡å¼€å‘å·¥ä½œ.")]),s._v(" "),t("p",[s._v("è¿˜è®°å¾—æ¯•ä¸šåæˆ‘æ¥è§¦çš„ç¬¬ä¸€ä¸ªé¡¹ç›®æ˜¯è¯åˆ¸ç›¸å…³çš„, å›½å¤–çš„åŒäº‹ç”¨ C è¯­è¨€å†™äº†ä¸€ä¸ªå†…å­˜æ•°æ®åº“, ä»£ç å†™å¾—æä¸ºç®€ç»ƒä¼˜ç¾, æˆ‘å½“æ—¶æ€€ç€æ— æ¯”å´‡æ•¬çš„å¿ƒæƒ…æŠŠä»£ç çœ‹äº†åˆçœ‹, çœ‹å®Œæ„Ÿè§‰å—ç›ŠåŒªæµ…. ä¸è¿‡å…´å¥‹ä¹‹ä½™, æˆ‘ä¹Ÿæœ‰äº›ç„¦è™‘, å› ä¸ºå…¶ä¸­ä¸€å—å¹¶å‘ç›¸å…³çš„ä»£ç , æˆ‘çœ‹å¾—æ˜¯äº‘é‡Œé›¾é‡Œ, æ€»æ„Ÿè§‰è‡ªå·±æ²¡æœ‰æ‚Ÿé€.")]),s._v(" "),t("p",[s._v('æˆ‘ä¸‹æ„è¯†åœ°å‘Šè¯‰è‡ªå·±è¯´è¿™å—çš„çŸ¥è¯†ç§¯ç´¯è¿˜ä¸å¤Ÿ, æ‰€ä»¥è¦å‹¤å­¦è‹¦ç»ƒ. ä½ å¯çŸ¥é“, 15 å¹´å‰ç›¸å…³çš„å­¦ä¹ èµ„æ–™å¹¶ä¸å¤š, æˆ‘çš„å¸ˆå‚…å‘æˆ‘æ¨èäº†ã€Šæ“ä½œç³»ç»ŸåŸç†ã€‹è¿™æœ¬æ•™æ, ä»–è¯´: "å¹¶å‘ç¼–ç¨‹æœ€æ—©çš„åº”ç”¨é¢†åŸŸå°±æ˜¯æ“ä½œç³»ç»Ÿçš„å®ç°, ä½ æŠŠè¿™æœ¬ä¹¦çœ‹æ‡‚äº†, å¹¶å‘çš„é—®é¢˜è‡ªç„¶å°±è§£å†³äº†." ä½†æ˜¯ç†è®ºå’Œå®è·µä¹‹é—´æ€»æ˜¯æœ‰é¸¿æ²Ÿçš„, ä¹‹åå¥½å¤šå¹´, æœ€è®©æˆ‘æ„Ÿåˆ°æ— åŠ©çš„è¿˜æ˜¯å¤„ç†å¹¶å‘ç›¸å…³çš„é—®é¢˜.')]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹çš„æŒæ¡è¿‡ç¨‹å¹¶ä¸å®¹æ˜“. æˆ‘ç›¸ä¿¡ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, ä½ ä¹Ÿå¬åˆ«äººæ€»ç»“è¿‡å¹¶å‘ç¼–ç¨‹çš„ç¬¬ä¸€åŸåˆ™, é‚£å°±æ˜¯ä¸è¦å†™å¹¶å‘ç¨‹åº. è¿™ä¸ªåŸåˆ™åœ¨æˆ‘åˆšæ¯•ä¸šçš„é‚£å‡ å¹´æ›¾ç»æ˜¯è¡Œå¾—é€šçš„, é‚£ä¸ªæ—¶å€™å¤šæ ¸æœåŠ¡å™¨è¿˜æ˜¯ä¸€ç§å¥¢ä¾ˆå“, ç³»ç»Ÿçš„å¹¶å‘é‡ä¹Ÿå¾ˆä½, å€ŸåŠ©æ•°æ®åº“å’Œç±»ä¼¼ Tomcat è¿™ç§ä¸­é—´ä»¶, æˆ‘ä»¬åŸºæœ¬ä¸Šä¸ç”¨å†™å¹¶å‘ç¨‹åº. æˆ–è€…è¯´, å¹¶å‘é—®é¢˜åŸºæœ¬ä¸Šéƒ½è¢«ä¸­é—´ä»¶å’Œæ•°æ®åº“è§£å†³äº†.")]),s._v(" "),t("p",[s._v("**ä½†æ˜¯æœ€è¿‘å‡ å¹´, å¹¶å‘ç¼–ç¨‹å·²ç»æ…¢æ…¢æˆä¸ºä¸€é¡¹å¿…å¤‡æŠ€èƒ½. **")]),s._v(" "),t("p",[s._v("è¿™ä¸»è¦æ˜¯ç¡¬ä»¶çš„é©±åŠ¨ä»¥åŠå›½å†…äº’è”ç½‘è¡Œä¸šçš„é£é€Ÿå‘å±•å†³å®šçš„, ç°åœ¨ 64 æ ¸çš„æœåŠ¡å™¨å·²ç»é£å…¥å¯»å¸¸ç™¾å§“å®¶, å¤§å‹äº’è”ç½‘å‚å•†çš„ç³»ç»Ÿå¹¶å‘é‡è½»æ¾è¿‡ç™¾ä¸‡, ä¼ ç»Ÿçš„ä¸­é—´ä»¶å’Œæ•°æ®åº“å·²ç»ä¸èƒ½ä¸ºæˆ‘ä»¬é®é£æŒ¡é›¨, åè€Œæˆäº†ç“¶é¢ˆæ‰€åœ¨.")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹æœ€è¿‘å‡ å¹´æˆä¸ºéå¸¸çƒ­é—¨çš„é¢†åŸŸ, äººæ‰ç¨€ç¼º. ä½†ä¸æ­¤åŒæ—¶, å…³äºå¹¶å‘ç¼–ç¨‹çš„ä¹¦ç±ä¹Ÿæ¸æ¸ä¸°å¯Œèµ·æ¥äº†. æ‰€ä»¥å½“æå®¢æ—¶é—´å›¢é˜Ÿå’Œæˆ‘èŠè¿™ä¸ªä¸“æ çš„æ—¶å€™, æˆ‘çš„ç¬¬ä¸€ä¸ªç–‘é—®å°±æ˜¯ç›®å‰å¸‚é¢ä¸Šå·²ç»æœ‰å¾ˆå¤šè¿™æ–¹é¢çš„å›¾ä¹¦äº†, è€Œä¸”å¾ˆå¤šéƒ½éå¸¸ä¼˜ç§€, æ˜¯å¦è¿˜æœ‰å¿…è¦æä¸€ä¸ªè¿™æ ·çš„ä¸“æ .")]),s._v(" "),t("p",[s._v("ä½†æ˜¯æ·±å…¥æƒ³è¿‡ä¹‹å, æˆ‘åšå®šäº†å†™ä½œçš„ä¿¡å¿ƒ. è¿™äº›å¹´æ¥è§¦çš„å¤§éƒ¨åˆ†åŒå­¦, éƒ½æ˜¯å·¥ä½œå‡ å¹´åå¾ˆå¤šæŠ€æœ¯çªé£çŒ›è¿›, å´åªæœ‰å¹¶å‘ç¼–ç¨‹æˆä¸ºç“¶é¢ˆ, è™½ç„¶å¹¶å‘ç›¸å…³çš„ç±»åº“ä»–ä»¬ä¹Ÿç†Ÿæ‚‰, å´æ€»æ˜¯å†™ä¸å‡ºæ­£ç¡®, é«˜æ•ˆçš„å¹¶å‘ç¨‹åº, åŸå› åœ¨å“ªé‡Œ? æˆ‘å‘ç°å¾ˆå¤šäººæ˜¯å› ä¸ºæŸä¸ªåœ°æ–¹æœ‰äº†ç›²ç‚¹, å¿½ç•¥äº†ä¸€äº›ç»†èŠ‚, ä½†æ°æ°æ˜¯è¿™äº›ç»†èŠ‚å†³å®šäº†ç¨‹åºçš„æ­£ç¡®æ€§å’Œæ•ˆç‡.")]),s._v(" "),t("p",[s._v('è€Œè¿™ä¸ªç›²ç‚¹æœ‰æ—¶å€™æ¶‰åŠå¯¹æ“ä½œç³»ç»Ÿçš„ç†è§£, æœ‰æ—¶å€™åˆæ¶‰åŠä¸€ç‚¹ç¡¬ä»¶çŸ¥è¯†, éå¸¸å¤æ‚, å¦‚æœè¦æ¨èç›¸å…³å›¾ä¹¦, å¯èƒ½è¦æ¨èå¥½å‡ æœ¬, è¿™å°±æœ‰ç‚¹ "å¤§ç‚®æ‰“èšŠå­" çš„æ„Ÿè§‰äº†, æ•ˆç‡å¾ˆå·®. åŒæ—¶å›¾ä¹¦æ›´è¿½æ±‚ä¸¥è°¨æ€§, å´ä¹Ÿå› æ­¤å¤±æ‰äº†å½¢è±¡æ€§, æ‰€ä»¥é˜…è¯»çš„è¿‡ç¨‹ä¹Ÿç¡®å®æœ‰ç‚¹è‰°è¾›.')]),s._v(" "),t("p",[s._v("æˆ‘æƒ³, å¦‚æœèƒ½å¤ŸæŠŠè¿™äº›é—®é¢˜è§£å†³, é‚£ä¹ˆåšè¿™ä¸ªäº‹æƒ…åº”è¯¥æ˜¯æœ‰æ„ä¹‰çš„.")]),s._v(" "),t("p",[s._v("ä¾‹å¦‚, Java é‡Œ synchronized, wait()/notify() ç›¸å…³çš„çŸ¥è¯†å¾ˆçç¢, çœ‹æ‡‚éš¾, ä¼šç”¨æ›´éš¾. ä½†å®é™…ä¸Š synchronized, wait(), notify() ä¸è¿‡æ˜¯æ“ä½œç³»ç»Ÿé¢†åŸŸé‡Œ"),t("strong",[s._v("ç®¡ç¨‹æ¨¡å‹")]),s._v("çš„ä¸€ç§å®ç°è€Œå·², Java SDK å¹¶å‘åŒ…é‡Œçš„æ¡ä»¶å˜é‡ Condition ä¹Ÿæ˜¯ç®¡ç¨‹é‡Œçš„æ¦‚å¿µ, synchronized, wait()/notify(), æ¡ä»¶å˜é‡è¿™äº›çŸ¥è¯†å¦‚æœå•ç‹¬ç†è§£, è‡ªç„¶æ˜¯ç®¡ä¸­çª¥è±¹. ä½†æ˜¯å¦‚æœç«™åœ¨ç®¡ç¨‹è¿™ä¸ªç†è®ºæ¨¡å‹çš„é«˜åº¦, å°±ä¼šå‘ç°è¿™äº›çŸ¥è¯†åŸæ¥è¿™ä¹ˆç®€å•, åŒæ—¶ç”¨èµ·æ¥ä¹Ÿå°±å¾—å¿ƒåº”æ‰‹äº†.")]),s._v(" "),t("p",[s._v("ç®¡ç¨‹ä½œä¸ºä¸€ç§è§£å†³å¹¶å‘é—®é¢˜çš„æ¨¡å‹, æ˜¯ç»§ä¿¡å·é‡æ¨¡å‹ä¹‹åçš„ä¸€é¡¹é‡å¤§åˆ›æ–°, å®ƒä¸ä¿¡å·é‡åœ¨é€»è¾‘ä¸Šæ˜¯ç­‰ä»·çš„(å¯ä»¥ç”¨ç®¡ç¨‹å®ç°ä¿¡å·é‡, ä¹Ÿå¯ä»¥ç”¨ä¿¡å·é‡å®ç°ç®¡ç¨‹), ä½†æ˜¯ç›¸æ¯”ä¹‹ä¸‹ç®¡ç¨‹æ›´æ˜“ç”¨. è€Œä¸”, å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒç®¡ç¨‹, ææ‡‚ç®¡ç¨‹, å¯¹å­¦ä¹ å…¶ä»–å¾ˆå¤šè¯­è¨€çš„å¹¶å‘ç¼–ç¨‹æœ‰å¾ˆå¤§å¸®åŠ©. ç„¶è€Œ, å¾ˆå¤šäººæ€¥äºå­¦ä¹  Java å¹¶å‘ç¼–ç¨‹æŠ€æœ¯, å´å¿½ç•¥äº†æŠ€æœ¯èƒŒåçš„ç†è®ºå’Œæ¨¡å‹, è€Œç†è®ºå’Œæ¨¡å‹å´å¾€å¾€æ¯”å…·ä½“çš„æŠ€æœ¯æ›´ä¸ºé‡è¦.")]),s._v(" "),t("p",[s._v("æ­¤å¤–, Java ç»è¿‡è¿™äº›å¹´çš„å‘å±•, Java SDK å¹¶å‘åŒ…æä¾›äº†éå¸¸ä¸°å¯Œçš„åŠŸèƒ½, å¯¹äºåˆå­¦è€…æ¥è¯´å¯è°“æ˜¯çœ¼èŠ±ç¼­ä¹±, å¥½å¤šäººè§‰å¾—æ— ä»ä¸‹æ‰‹. ä½†æ˜¯, Java SDK å¹¶å‘åŒ…ä¹ƒæ˜¯å¹¶å‘å¤§å¸ˆ Doug Lea å‡ºå“, å ªç§°ç»å…¸, å®ƒå†…éƒ¨ä¸€å®šæ˜¯æœ‰ç« å¯å¾ªçš„. é‚£å®ƒçš„ç« æ³•åœ¨å“ªé‡Œå‘¢?")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("å…¶å®å¹¶å‘ç¼–ç¨‹å¯ä»¥æ€»ç»“ä¸ºä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜: åˆ†å·¥, åŒæ­¥, äº’æ–¥")])]),s._v("â€‹ "),t("strong",[s._v(".")])]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("æ‰€è°“åˆ†å·¥æŒ‡çš„æ˜¯å¦‚ä½•é«˜æ•ˆåœ°æ‹†è§£ä»»åŠ¡å¹¶åˆ†é…ç»™çº¿ç¨‹, è€ŒåŒæ­¥æŒ‡çš„æ˜¯çº¿ç¨‹ä¹‹é—´å¦‚ä½•åä½œ, äº’æ–¥åˆ™æ˜¯ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº")])]),s._v(". Java SDK å¹¶å‘åŒ…å¾ˆå¤§éƒ¨åˆ†å†…å®¹éƒ½æ˜¯æŒ‰ç…§è¿™ä¸‰ä¸ªç»´åº¦ç»„ç»‡çš„, ä¾‹å¦‚ Fork/Join æ¡†æ¶å°±æ˜¯ä¸€ç§åˆ†å·¥æ¨¡å¼, CountDownLatch å°±æ˜¯ä¸€ç§å…¸å‹çš„åŒæ­¥æ–¹å¼, è€Œå¯é‡å…¥é”åˆ™æ˜¯ä¸€ç§äº’æ–¥æ‰‹æ®µ.")]),s._v(" "),t("p",[s._v("å½“æŠŠå¹¶å‘ç¼–ç¨‹æ ¸å¿ƒçš„é—®é¢˜ææ¸…æ¥š, å†å›è¿‡å¤´æ¥çœ‹ Java SDK å¹¶å‘åŒ…, ä½ ä¼šæ„Ÿè§‰è±ç„¶å¼€æœ—, å®ƒä¸è¿‡æ˜¯"),t("strong",[s._v("é’ˆå¯¹å¹¶å‘é—®é¢˜å¼€å‘å‡ºæ¥çš„å·¥å…·")]),s._v("è€Œå·².")]),s._v(" "),t("p",[s._v("è€Œä¸”è¿™ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯è·¨è¯­è¨€çš„, å¦‚æœè¦å­¦ä¹ å…¶ä»–è¯­è¨€çš„å¹¶å‘ç¼–ç¨‹ç±»åº“, å®Œå…¨å¯ä»¥é¡ºç€è¿™ä¸‰ä¸ªé—®é¢˜æŒ‰å›¾ç´¢éª¥. Java SDK å¹¶å‘åŒ…å…¶ä½™çš„ä¸€éƒ¨åˆ†åˆ™æ˜¯å¹¶å‘å®¹å™¨å’ŒåŸå­ç±», è¿™äº›æ¯”è¾ƒå®¹æ˜“ç†è§£, å±äºè¾…åŠ©å·¥å…·, å…¶ä»–è¯­è¨€é‡ŒåŸºæœ¬éƒ½èƒ½æ‰¾åˆ°å¯¹åº”çš„.")]),s._v(" "),t("p",[s._v("**æ‰€ä»¥, ä½ è¯´å¹¶å‘ç¼–ç¨‹éš¾å­¦å—? **")]),s._v(" "),t("p",[s._v("é¦–å…ˆ, éš¾æ˜¯è‚¯å®šçš„. å› ä¸ºè¿™å…¶ä¸­æ¶‰åŠæ“ä½œç³»ç»Ÿ, CPU, å†…å­˜ç­‰ç­‰å¤šæ–¹é¢çš„çŸ¥è¯†, å¦‚æœä½ ç¼ºå°‘æŸä¸€å—, é‚£ç†è§£èµ·æ¥è‡ªç„¶å›°éš¾. å…¶æ¬¡, éš¾ä¸éš¾å­¦ä¹Ÿå¯èƒ½å› äººè€Œå¼‚, å°±æˆ‘çš„ç»éªŒæ¥çœ‹, å¾ˆå¤šäººåœ¨å­¦ä¹ å¹¶å‘ç¼–ç¨‹çš„æ—¶å€™, æ€»æ˜¯å–œæ¬¢ä»ç‚¹å‡ºå‘, å¸Œæœ›èƒ½ä»ç‚¹é‡Œæ‰¾åˆ°è§„å¾‹æˆ–è€…æœ¬è´¨, æœ€åå´æŠŠè‡ªå·±ç»•æ™•äº†.")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹å¹¶ä¸æ˜¯ Java ç‰¹æœ‰çš„è¯­è¨€ç‰¹æ€§, å®ƒæ˜¯ä¸€ä¸ªé€šç”¨ä¸”æ—©å·²æˆç†Ÿçš„é¢†åŸŸ. Java åªæ˜¯æ ¹æ®è‡ªèº«æƒ…å†µåšäº†å®ç°ç½¢äº†, å½“ä½ ç†è§£æˆ–å­¦ä¹ å¹¶å‘ç¼–ç¨‹çš„æ—¶å€™, å¦‚æœèƒ½å¤Ÿç«™åœ¨è¾ƒé«˜å±‚é¢, ç³»ç»Ÿä¸”æœ‰ä½“ç³»åœ°æ€è€ƒé—®é¢˜, é‚£å°±ä¼šå®¹æ˜“å¾ˆå¤š.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, æˆ‘å¸Œæœ›è¿™ä¸ªä¸“æ æ›´å¤šåœ°è°ˆåŠé—®é¢˜èƒŒåçš„æœ¬è´¨, é—®é¢˜çš„èµ·æº, åŒæ—¶ç«™åœ¨ç†è®º, æ¨¡å‹çš„è§’åº¦è®²è§£ Java å¹¶å‘, è®©ä½ çš„çŸ¥è¯†æ›´æˆä½“ç³», èä¼šè´¯é€š. æœ€ç»ˆè®©ä½ èƒ½å¤Ÿå¾—å¿ƒåº”æ‰‹åœ°è§£å†³å„ç§å¹¶å‘éš¾é¢˜, åŒæ—¶å°†è¿™äº›çŸ¥è¯†ç”¨äºå…¶ä»–ç¼–ç¨‹è¯­è¨€, è®©ä½ çš„ä¸€åˆ†è¾›åŠ³ä¸‰åˆ†æ”¶è·.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ˜¯è¿™ä¸ªä¸“æ çš„ç›®å½•, ä½ å¯ä»¥å¿«é€Ÿäº†è§£ä¸‹æ•´ä¸ªä¸“æ çš„çŸ¥è¯†ç»“æ„ä½“ç³».")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/67857bd7fdbb63a3c7864a47244f9425-20230731162452-6d9qt3o.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("å½“ç„¶è¦åšæŒä¸‹å», ä¸èƒ½ä¸‰å¤©æ‰“é±¼ä¸¤å¤©æ™’ç½‘, å› ä¸ºæ»´æ°´ç©¿çŸ³éä¸€æ—¥ä¹‹åŠŸ.")])]),s._v(" "),t("p",[s._v('å¾ˆå¤šäººéƒ½è¯´å­¦ä¹ æ˜¯åäººæ€§çš„, å¼€å§‹å®¹æ˜“, ä½†æ˜¯é•¿ä¹…çš„åšæŒå´å¾ˆéš¾. è¿™ä¸ªæˆ‘ä¹Ÿè®¤åŒ, æˆ‘é¢è¯•çš„æ—¶å€™, å°±ç»å¸¸é—®å€™é€‰äººä¸€ä¸ªé—®é¢˜: "å·¥ä½œä¸­, æœ‰æ²¡æœ‰ä¸€ä»¶äº‹ä½ è‡ªå·±åšæŒäº†å¾ˆä¹…, å¹¶ä¸”ä»ä¸­è·ç›Š?" å¦‚æœå€™é€‰äººèƒ½å¤Ÿå›ç­”å‡ºæ¥, é‚£ä¼šæ˜¯æ•´ä¸ªé¢è¯•çš„åŠ åˆ†é¡¹, å› ä¸ºæˆ‘è§‰å¾—, åšæŒçœŸæ˜¯ä¸€ä¸ªå¯è´µçš„å“è´¨, ä¸€ä»¶äº‹æƒ…, æœ‰çš„äººä¸‰åˆ†çƒ­åº¦, è€Œæœ‰çš„äºº, ä¸€åšå°±èƒ½åšä¸€å¹´, æˆ–è€…æ›´ä¹…. æ”¾é•¿åˆ°æ—¶é—´çš„ç»´åº¦é‡Œçœ‹, è¿™ä¸¤ç§äºº, æœ€åçš„æˆå°±ç»å¯¹æ˜¯æŒ‡æ•°çº§çš„å·®è·.')]),s._v(" "),t("h4",{attrs:{id:"å­¦ä¹ æ”»ç•¥-å¦‚ä½•æ‰èƒ½å­¦å¥½å¹¶å‘ç¼–ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å­¦ä¹ æ”»ç•¥-å¦‚ä½•æ‰èƒ½å­¦å¥½å¹¶å‘ç¼–ç¨‹"}},[s._v("#")]),s._v(" å­¦ä¹ æ”»ç•¥-å¦‚ä½•æ‰èƒ½å­¦å¥½å¹¶å‘ç¼–ç¨‹?")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹å¹¶ä¸æ˜¯ä¸€é—¨ç›¸å¯¹ç‹¬ç«‹çš„å­¦ç§‘, è€Œæ˜¯ä¸€ä¸ªç»¼åˆå­¦ç§‘. å¹¶å‘ç¼–ç¨‹ç›¸å…³çš„æ¦‚å¿µå’ŒæŠ€æœ¯çœ‹ä¸Šéå¸¸é›¶æ•£, ç›¸å…³åº¦ä¹Ÿå¾ˆä½, æ€»ç»™ä½ ä¸€ç§è¿™æ ·çš„æ„Ÿè§‰: æˆ‘å·²ç»å­¦ä¹ å¾ˆå¤šç›¸å…³æŠ€æœ¯äº†, å¯è¿˜æ˜¯æä¸å®šå¹¶å‘ç¼–ç¨‹. é‚£å¦‚ä½•æ‰èƒ½å­¦ä¹ å¥½å¹¶å‘ç¼–ç¨‹å‘¢?")]),s._v(" "),t("p",[s._v('å…¶å®å¾ˆç®€å•, åªè¦ä½ èƒ½ä»ä¸¤ä¸ªæ–¹é¢çªç ´ä¸€ä¸‹å°±å¯ä»¥äº†. ä¸€ä¸ªæ˜¯ "è·³å‡ºæ¥çœ‹å…¨æ™¯", å¦ä¸€ä¸ªæ˜¯ "é’»è¿›å»çœ‹æœ¬è´¨".')]),s._v(" "),t("h5",{attrs:{id:"è·³å‡ºæ¥çœ‹å…¨æ™¯ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è·³å‡ºæ¥çœ‹å…¨æ™¯ğŸ€"}},[s._v("#")]),s._v(" è·³å‡ºæ¥çœ‹å…¨æ™¯ğŸ€")]),s._v(" "),t("p",[s._v('å…ˆè¯´"è·³å‡ºæ¥". å­¦ä¹ æœ€å¿Œè®³çš„å°±æ˜¯ "ç›²äººæ‘¸è±¡", åªçœ‹åˆ°å±€éƒ¨, è€Œæ²¡æœ‰çœ‹åˆ°å…¨å±€. æ‰€ä»¥éœ€è¦ä»ä¸€ä¸ªä¸ªå•ä¸€çš„çŸ¥è¯†å’ŒæŠ€æœ¯ä¸­ "è·³å‡ºæ¥", é«˜å±‹å»ºç“´åœ°çœ‹å¹¶å‘ç¼–ç¨‹. å½“ç„¶, è¿™'),t("strong",[s._v("é¦–è¦ä¹‹äº‹å°±æ˜¯éœ€è¦å»ºç«‹èµ·ä¸€å¼ å…¨æ™¯å›¾")]),s._v(".")]),s._v(" "),t("p",[s._v('ä¸è¿‡, å¹¶å‘ç¼–ç¨‹ç›¸å…³çš„çŸ¥è¯†å’ŒæŠ€æœ¯è¿˜çœŸæ˜¯é”™ç»¼å¤æ‚, æ—¶è‡³ä»Šæ—¥ä¹Ÿè¿˜æ²¡æœ‰ä¸€å¼ æ™®éè®¤å¯çš„å…¨æ™¯å›¾, ä¹Ÿè®¸è¿™æ­£æ˜¯å¾ˆå¤šäººåœ¨å¹¶å‘ç¼–ç¨‹æ–¹é¢éš¾ä»¥çªç ´çš„åŸå› . å¥½åœ¨ç»è¿‡å¤šå¹´æ‘¸çˆ¬æ»šæ‰“, æˆ‘å·²ç»"å‹¾å‹’"å‡ºäº†ä¸€å¼ å…¨æ™¯å›¾, ä¸ä¸€å®šç§‘å­¦, ä½†æ˜¯åœ¨æŸç§ç¨‹åº¦ä¸Šå®ƒè¿˜æ˜¯å¯ä»¥æŒ‡å¯¼ä½ å­¦å¥½å¹¶å‘ç¼–ç¨‹çš„.')]),s._v(" "),t("p",[s._v("åœ¨æˆ‘çœ‹æ¥, å¹¶å‘ç¼–ç¨‹é¢†åŸŸå¯ä»¥æŠ½è±¡æˆ"),t("strong",[s._v("ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜: åˆ†å·¥, åŒæ­¥å’Œäº’æ–¥")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_1-åˆ†å·¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-åˆ†å·¥"}},[s._v("#")]),s._v(" (1)åˆ†å·¥")]),s._v(" "),t("p",[t("strong",[s._v("æ‰€è°“åˆ†å·¥, ç±»ä¼¼äºç°å®ä¸­ä¸€ä¸ªç»„ç»‡å®Œæˆä¸€ä¸ªé¡¹ç›®, é¡¹ç›®ç»ç†è¦æ‹†åˆ†ä»»åŠ¡, å®‰æ’åˆé€‚çš„æˆå‘˜å»å®Œæˆ")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨å¹¶å‘ç¼–ç¨‹é¢†åŸŸ, ä½ å°±æ˜¯é¡¹ç›®ç»ç†, "),t("strong",[s._v("çº¿ç¨‹å°±æ˜¯é¡¹ç›®ç»„æˆå‘˜")]),s._v(". ä»»åŠ¡åˆ†è§£å’Œåˆ†å·¥å¯¹äºé¡¹ç›®æˆè´¥éå¸¸å…³é”®, ä¸è¿‡åœ¨å¹¶å‘é¢†åŸŸé‡Œ, åˆ†å·¥æ›´é‡è¦, å®ƒç›´æ¥å†³å®šäº†å¹¶å‘ç¨‹åºçš„æ€§èƒ½. åœ¨ç°å®ä¸–ç•Œé‡Œ, åˆ†å·¥æ˜¯å¾ˆå¤æ‚çš„.")]),s._v(" "),t("p",[s._v("æ—¢ç„¶åˆ†å·¥å¾ˆé‡è¦åˆå¾ˆå¤æ‚, é‚£ä¸€å®šæœ‰å‰è¾ˆåŠªåŠ›å°è¯•è§£å†³è¿‡, å¹¶ä¸”ä¹Ÿä¸€å®šæœ‰æˆæœ. çš„ç¡®, åœ¨å¹¶å‘ç¼–ç¨‹é¢†åŸŸè¿™æ–¹é¢çš„æˆæœè¿˜æ˜¯å¾ˆä¸°ç¡•çš„. Java SDK å¹¶å‘åŒ…é‡Œçš„ "),t("strong",[s._v("Executor, Fork/Join, Future æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ç§åˆ†å·¥æ–¹æ³•")]),s._v(". é™¤æ­¤ä¹‹å¤–, å¹¶å‘ç¼–ç¨‹é¢†åŸŸè¿˜æ€»ç»“äº†ä¸€äº›è®¾è®¡æ¨¡å¼, åŸºæœ¬ä¸Šéƒ½æ˜¯å’Œåˆ†å·¥æ–¹æ³•ç›¸å…³çš„, ä¾‹å¦‚ç”Ÿäº§è€…-æ¶ˆè´¹è€…, Thread-Per-Message, Worker Thread æ¨¡å¼ç­‰éƒ½æ˜¯ç”¨æ¥æŒ‡å¯¼å¦‚ä½•åˆ†å·¥çš„.")]),s._v(" "),t("p",[s._v("å­¦ä¹ è¿™éƒ¨åˆ†å†…å®¹, æœ€ä½³çš„æ–¹å¼å°±æ˜¯å’Œç°å®ä¸–ç•Œåšå¯¹æ¯”. ä¾‹å¦‚ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼, å¯ä»¥ç±»æ¯”ä¸€ä¸‹é¤é¦†é‡Œçš„å¤§å¨å’ŒæœåŠ¡å‘˜, å¤§å¨å°±æ˜¯ç”Ÿäº§è€…, è´Ÿè´£åšèœ, åšå®Œæ”¾åˆ°å‡ºèœå£, è€ŒæœåŠ¡å‘˜å°±æ˜¯æ¶ˆè´¹è€…, æŠŠåšå¥½çš„èœç»™ä½ ç«¯è¿‡æ¥. ä¸è¿‡, æˆ‘ä»¬ç»å¸¸ä¼šå‘ç°, å‡ºèœå£æœ‰æ—¶å€™ä¸€ä¸‹å­å‡ºäº†å¥½å‡ ä¸ªèœ, æœåŠ¡å‘˜æ˜¯å¯ä»¥æŠŠè¿™ä¸€æ‰¹èœåŒæ—¶ç«¯ç»™ä½ çš„. å…¶å®è¿™å°±æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¸€ä¸ªä¼˜ç‚¹, ç”Ÿäº§è€…ä¸€ä¸ªä¸€ä¸ªåœ°ç”Ÿäº§æ•°æ®, è€Œæ¶ˆè´¹è€…å¯ä»¥æ‰¹å¤„ç†, è¿™æ ·å°±æé«˜äº†æ€§èƒ½.")]),s._v(" "),t("h6",{attrs:{id:"_2-åŒæ­¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-åŒæ­¥"}},[s._v("#")]),s._v(" (2)åŒæ­¥")]),s._v(" "),t("p",[s._v("åˆ†å¥½å·¥ä¹‹å, å°±æ˜¯å…·ä½“æ‰§è¡Œäº†. åœ¨é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹ä¸­, ä»»åŠ¡ä¹‹é—´æ˜¯æœ‰ä¾èµ–çš„, ä¸€ä¸ªä»»åŠ¡ç»“æŸå, ä¾èµ–å®ƒçš„åç»­ä»»åŠ¡å°±å¯ä»¥å¼€å·¥äº†, åç»­å·¥ä½œæ€ä¹ˆçŸ¥é“å¯ä»¥å¼€å·¥äº†å‘¢? è¿™ä¸ªå°±æ˜¯é æ²Ÿé€šåä½œäº†, è¿™æ˜¯ä¸€é¡¹å¾ˆé‡è¦çš„å·¥ä½œ.")]),s._v(" "),t("p",[s._v("åœ¨"),t("strong",[s._v("å¹¶å‘ç¼–ç¨‹é¢†åŸŸé‡Œçš„åŒæ­¥, ä¸»è¦æŒ‡çš„å°±æ˜¯çº¿ç¨‹é—´çš„åä½œ")]),s._v(", æœ¬è´¨ä¸Šå’Œç°å®ç”Ÿæ´»ä¸­çš„åä½œæ²¡åŒºåˆ«, ä¸è¿‡æ˜¯"),t("strong",[s._v("ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œäº†ä¸€ä¸ªä»»åŠ¡, å¦‚ä½•é€šçŸ¥æ‰§è¡Œåç»­ä»»åŠ¡çš„çº¿ç¨‹å¼€å·¥")]),s._v("è€Œå·².")]),s._v(" "),t("p",[s._v("åä½œä¸€èˆ¬æ˜¯å’Œåˆ†å·¥ç›¸å…³çš„. Java SDK å¹¶å‘åŒ…é‡Œçš„ Executor, Fork/Join, Future æœ¬è´¨ä¸Šéƒ½æ˜¯åˆ†å·¥æ–¹æ³•, ä½†åŒæ—¶ä¹Ÿèƒ½è§£å†³çº¿ç¨‹åä½œçš„é—®é¢˜. ä¾‹å¦‚, ç”¨ Future å¯ä»¥å‘èµ·ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨, å½“ä¸»çº¿ç¨‹é€šè¿‡ get() æ–¹æ³•å–ç»“æœæ—¶, ä¸»çº¿ç¨‹å°±ä¼šç­‰å¾…, å½“å¼‚æ­¥æ‰§è¡Œçš„ç»“æœè¿”å›æ—¶, get() æ–¹æ³•å°±è‡ªåŠ¨è¿”å›äº†. ä¸»çº¿ç¨‹å’Œå¼‚æ­¥çº¿ç¨‹ä¹‹é—´çš„åä½œ, Future å·¥å…·ç±»å·²ç»å¸®æˆ‘ä»¬è§£å†³äº†. é™¤æ­¤ä¹‹å¤–, Java SDK é‡Œæä¾›çš„ CountDownLatch, CyclicBarrier, Phaser, Exchanger ä¹Ÿéƒ½æ˜¯ç”¨æ¥è§£å†³çº¿ç¨‹åä½œé—®é¢˜çš„.")]),s._v(" "),t("p",[s._v("ä¸è¿‡è¿˜æœ‰å¾ˆå¤šåœºæ™¯, æ˜¯éœ€è¦è‡ªå·±æ¥å¤„ç†çº¿ç¨‹ä¹‹é—´çš„åä½œçš„.")]),s._v(" "),t("p",[s._v("å·¥ä½œä¸­é‡åˆ°çš„çº¿ç¨‹åä½œé—®é¢˜, åŸºæœ¬ä¸Šéƒ½å¯ä»¥æè¿°ä¸ºè¿™æ ·çš„ä¸€ä¸ªé—®é¢˜: "),t("mark",[t("strong",[s._v("å½“æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶, çº¿ç¨‹éœ€è¦ç­‰å¾…, å½“æŸä¸ªæ¡ä»¶æ»¡è¶³æ—¶, çº¿ç¨‹éœ€è¦è¢«å”¤é†’æ‰§è¡Œ")])]),s._v('. ä¾‹å¦‚, åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹é‡Œ, ä¹Ÿæœ‰ç±»ä¼¼çš„æè¿°, "å½“é˜Ÿåˆ—æ»¡æ—¶, ç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…, å½“é˜Ÿåˆ—ä¸æ»¡æ—¶, ç”Ÿäº§è€…çº¿ç¨‹éœ€è¦è¢«å”¤é†’æ‰§è¡Œ; å½“é˜Ÿåˆ—ç©ºæ—¶, æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…, å½“é˜Ÿåˆ—ä¸ç©ºæ—¶, æ¶ˆè´¹è€…çº¿ç¨‹éœ€è¦è¢«å”¤é†’æ‰§è¡Œ."')]),s._v(" "),t("p",[s._v("åœ¨ Java å¹¶å‘ç¼–ç¨‹é¢†åŸŸ, è§£å†³åä½œé—®é¢˜çš„æ ¸å¿ƒæŠ€æœ¯æ˜¯"),t("strong",[s._v("ç®¡ç¨‹")]),s._v(", ä¸Šé¢æåˆ°çš„"),t("strong",[s._v("æ‰€æœ‰çº¿ç¨‹åä½œæŠ€æœ¯åº•å±‚éƒ½æ˜¯åˆ©ç”¨ç®¡ç¨‹è§£å†³")]),s._v("çš„. ç®¡ç¨‹æ˜¯ä¸€ç§è§£å†³å¹¶å‘é—®é¢˜çš„é€šç”¨æ¨¡å‹, é™¤äº†èƒ½è§£å†³çº¿ç¨‹åä½œé—®é¢˜, è¿˜èƒ½è§£å†³ä¸‹é¢å°†è¦ä»‹ç»çš„äº’æ–¥é—®é¢˜. å¯ä»¥è¿™ä¹ˆè¯´, "),t("strong",[s._v("ç®¡ç¨‹æ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¯´, è¿™éƒ¨åˆ†å†…å®¹å…³é”®æ˜¯ç†è§£ç®¡ç¨‹æ¨¡å‹, å­¦å¥½å®ƒå°±å¯ä»¥è§£å†³æ‰€æœ‰é—®é¢˜. å…¶æ¬¡æ˜¯äº†è§£ Java SDK å¹¶å‘åŒ…æä¾›çš„å‡ ä¸ªçº¿ç¨‹åä½œçš„å·¥å…·ç±»çš„åº”ç”¨åœºæ™¯, ç”¨å¥½å®ƒä»¬å¯ä»¥å¦¥å¦¥åœ°æé«˜å·¥ä½œæ•ˆç‡.")]),s._v(" "),t("h6",{attrs:{id:"_3-äº’æ–¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-äº’æ–¥"}},[s._v("#")]),s._v(" (3)äº’æ–¥")]),s._v(" "),t("p",[s._v('åˆ†å·¥, åŒæ­¥ä¸»è¦å¼ºè°ƒçš„æ˜¯æ€§èƒ½, ä½†å¹¶å‘ç¨‹åºé‡Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯å…³äºæ­£ç¡®æ€§çš„, ç”¨ä¸“ä¸šæœ¯è¯­å« "'),t("strong",[s._v("çº¿ç¨‹å®‰å…¨")]),s._v('". å¹¶å‘ç¨‹åºé‡Œ, å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡çš„æ—¶å€™, ç»“æœæ˜¯ä¸ç¡®å®šçš„. ä¸ç¡®å®š, åˆ™æ„å‘³ç€å¯èƒ½æ­£ç¡®, ä¹Ÿå¯èƒ½é”™è¯¯, äº‹å…ˆæ˜¯ä¸çŸ¥é“çš„. è€Œ'),t("strong",[s._v("å¯¼è‡´ä¸ç¡®å®šçš„ä¸»è¦æºå¤´æ˜¯å¯è§æ€§é—®é¢˜, æœ‰åºæ€§é—®é¢˜å’ŒåŸå­æ€§é—®é¢˜, ä¸ºäº†è§£å†³è¿™ä¸‰ä¸ªé—®é¢˜, Java è¯­è¨€å¼•å…¥äº†å†…å­˜æ¨¡å‹, å†…å­˜æ¨¡å‹æä¾›äº†ä¸€ç³»åˆ—çš„è§„åˆ™, åˆ©ç”¨è¿™äº›è§„åˆ™, å¯ä»¥é¿å…å¯è§æ€§é—®é¢˜, æœ‰åºæ€§é—®é¢˜, ä½†æ˜¯è¿˜ä¸è¶³ä»¥å®Œå…¨è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜. è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆè¿˜æ˜¯äº’æ–¥")]),s._v(".")]),s._v(" "),t("p",[s._v("**æ‰€è°“äº’æ–¥, æŒ‡çš„æ˜¯åŒä¸€æ—¶åˆ», åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«å˜é‡. **")]),s._v(" "),t("p",[s._v("å®ç°äº’æ–¥çš„æ ¸å¿ƒæŠ€æœ¯å°±æ˜¯"),t("strong",[s._v("é”")]),s._v(", Java è¯­è¨€é‡Œ synchronized, SDK é‡Œçš„å„ç§ Lock éƒ½èƒ½è§£å†³"),t("strong",[s._v("äº’æ–¥é—®é¢˜")]),s._v(". è™½è¯´é”è§£å†³äº†å®‰å…¨æ€§é—®é¢˜, ä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†æ€§èƒ½é—®é¢˜, é‚£å¦‚ä½•ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶åˆå°½é‡æé«˜æ€§èƒ½å‘¢? å¯ä»¥åˆ†åœºæ™¯ä¼˜åŒ–, Java SDK é‡Œæä¾›çš„ ReadWriteLock, StampedLock å°±å¯ä»¥ä¼˜åŒ–è¯»å¤šå†™å°‘åœºæ™¯ä¸‹é”çš„æ€§èƒ½. è¿˜å¯ä»¥ä½¿ç”¨æ— é”çš„æ•°æ®ç»“æ„, ä¾‹å¦‚ Java SDK é‡Œæä¾›çš„åŸå­ç±»éƒ½æ˜¯åŸºäºæ— é”æŠ€æœ¯å®ç°çš„.")]),s._v(" "),t("p",[s._v("é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ–¹æ¡ˆ, åŸç†æ˜¯ä¸å…±äº«å˜é‡æˆ–è€…å˜é‡åªå…è®¸è¯». è¿™æ–¹é¢, Java æä¾›äº† ThreadLocal å’Œ final å…³é”®å­—, è¿˜æœ‰ä¸€ç§ Copy-on-write çš„æ¨¡å¼.")]),s._v(" "),t("p",[s._v("ä½¿ç”¨é”é™¤äº†è¦æ³¨æ„æ€§èƒ½é—®é¢˜å¤–, è¿˜éœ€è¦æ³¨æ„æ­»é”é—®é¢˜.")]),s._v(" "),t("p",[s._v("è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒå¤æ‚, å¾€å¾€è¿˜æ˜¯è·¨é¢†åŸŸçš„, ä¾‹å¦‚è¦ç†è§£å¯è§æ€§, å°±éœ€è¦äº†è§£ä¸€äº› CPU å’Œç¼“å­˜çš„çŸ¥è¯†; è¦ç†è§£åŸå­æ€§, å°±éœ€è¦ç†è§£ä¸€äº›æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†; å¾ˆå¤šæ— é”ç®—æ³•çš„å®ç°å¾€å¾€ä¹Ÿéœ€è¦ç†è§£ CPU ç¼“å­˜. è¿™éƒ¨åˆ†å†…å®¹çš„å­¦ä¹ , éœ€è¦åšè§ˆç¾¤ä¹¦, åœ¨å¤§è„‘é‡Œå»ºç«‹èµ· CPU, å†…å­˜, I/O æ‰§è¡Œçš„æ¨¡æ‹Ÿå™¨. è¿™æ ·é‡åˆ°é—®é¢˜å°±èƒ½å¾—å¿ƒåº”æ‰‹äº†.")]),s._v(" "),t("p",[s._v("è·³å‡ºæ¥, çœ‹å…¨æ™¯, å¯ä»¥è®©ä½ çš„çŸ¥è¯†æˆä½“ç³», æ‰€å­¦çŸ¥è¯†ä¹Ÿèæ±‡è´¯é€šèµ·æ¥, ç”±ç‚¹æˆçº¿, ç”±çº¿åŠé¢, ç”»å‡ºè‡ªå·±çš„çŸ¥è¯†å…¨æ™¯å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/81c879aa2ecdeec399e68bf1c1cc29a9-20230731162452-u0yie62.png",alt:"",title:"å¹¶å‘ç¼–ç¨‹å…¨æ™¯å›¾ä¹‹æ€ç»´å¯¼å›¾"}})]),s._v(" "),t("h5",{attrs:{id:"_2-é’»è¿›å»çœ‹æœ¬è´¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-é’»è¿›å»çœ‹æœ¬è´¨"}},[s._v("#")]),s._v(" 2.é’»è¿›å»çœ‹æœ¬è´¨")]),s._v(" "),t("p",[s._v("ä½†æ˜¯å…‰è·³å‡ºæ¥è¿˜ä¸å¤Ÿ, è¿˜éœ€è¦ä¸‹ä¸€æ­¥, å°±æ˜¯"),t("strong",[s._v("åœ¨æŸä¸ªé—®é¢˜ä¸Šé’»è¿›å», æ·±å…¥ç†è§£, æ‰¾åˆ°æœ¬è´¨")]),s._v(".")]),s._v(" "),t("p",[s._v("å°±æ‹¿æˆ‘ä¸ªäººæ¥è¯´, æˆ‘å·²ç»çƒ¦é€äº†å»è®²è¿°æˆ–è¢«è®²è¿°ä¸€å †æ¦‚å¿µå’Œç»“è®º, è€Œä¸åˆ†æè¿™äº›æ¦‚å¿µå’Œç»“è®ºæ˜¯æ€ä¹ˆæ¥çš„, ä»¥åŠå®ƒä»¬æ˜¯ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜çš„. åœ¨å¤§å­¦é‡Œ, è¿™æ ·çš„æ•™æå¾ˆæµè¡Œ, ç›´æ¥å¯¼è‡´äº†èŠ¸èŠ¸å­¦å­æˆç»©å¾ˆé«˜, ä½†è§£å†³é—®é¢˜çš„èƒ½åŠ›å¾ˆå·®. å…¶å®, çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶, æ‰ç®—çœŸçš„å­¦æ˜ç™½äº†.")]),s._v(" "),t("p",[s._v("æˆ‘å±äºç†è®ºæ´¾, "),t("strong",[s._v("æˆ‘è®¤ä¸ºå·¥ç¨‹ä¸Šçš„è§£å†³æ–¹æ¡ˆ, ä¸€å®šè¦æœ‰ç†è®ºåšåŸºç¡€")]),s._v('. æ‰€ä»¥åœ¨å­¦ä¹ å¹¶å‘ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­, æˆ‘éƒ½ä¼šæ¢ç´¢å®ƒèƒŒåçš„ç†è®ºæ˜¯ä»€ä¹ˆ. æ¯”å¦‚, å½“çœ‹åˆ° Java SDK é‡Œé¢çš„æ¡ä»¶å˜é‡ Condition çš„æ—¶å€™, æˆ‘ä¼šä¸‹æ„è¯†åœ°é—®, "å®ƒæ˜¯ä»å“ªå„¿æ¥çš„? æ˜¯ Java çš„ç‰¹æœ‰æ¦‚å¿µ, è¿˜æ˜¯ä¸€ä¸ªé€šç”¨çš„ç¼–ç¨‹æ¦‚å¿µ?" å½“æˆ‘çŸ¥é“å®ƒæ¥è‡ªç®¡ç¨‹çš„æ—¶å€™, æˆ‘åˆä¼šé—®, "ç®¡ç¨‹è¢«æå‡ºçš„èƒŒæ™¯å’Œè§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆ?" è¿™æ ·ä¸€è·¯æ¢ç´¢ä¸‹æ¥, å¯ä»¥å‘ç° Java è¯­è¨€é‡Œçš„å¹¶å‘æŠ€æœ¯åŸºæœ¬éƒ½æ˜¯æœ‰ç†è®ºåŸºç¡€çš„, å¹¶ä¸”è¿™äº›ç†è®ºåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€é‡Œä¹Ÿæœ‰ç±»ä¼¼çš„å®ç°. æ‰€ä»¥æˆ‘è®¤ä¸º, æŠ€æœ¯çš„æœ¬è´¨æ˜¯èƒŒåçš„ç†è®ºæ¨¡å‹.')]),s._v(" "),t("h3",{attrs:{id:"å¹¶å‘ç†è®ºåŸºç¡€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹¶å‘ç†è®ºåŸºç¡€"}},[s._v("#")]),s._v(" å¹¶å‘ç†è®ºåŸºç¡€")]),s._v(" "),t("h4",{attrs:{id:"_01-å¯è§æ€§-åŸå­æ€§å’Œæœ‰åºæ€§é—®é¢˜-å¹¶å‘ç¼–ç¨‹bugçš„æºå¤´ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-å¯è§æ€§-åŸå­æ€§å’Œæœ‰åºæ€§é—®é¢˜-å¹¶å‘ç¼–ç¨‹bugçš„æºå¤´ğŸ€"}},[s._v("#")]),s._v(" 01-å¯è§æ€§,åŸå­æ€§å’Œæœ‰åºæ€§é—®é¢˜:å¹¶å‘ç¼–ç¨‹Bugçš„æºå¤´ğŸ€")]),s._v(" "),t("p",[s._v('ç¼–å†™æ­£ç¡®çš„å¹¶å‘ç¨‹åºæ˜¯ä¸€ä»¶æå›°éš¾çš„äº‹æƒ…, å¹¶å‘ç¨‹åºçš„ Bug å¾€å¾€ä¼šè¯¡å¼‚åœ°å‡ºç°, ç„¶ååˆè¯¡å¼‚åœ°æ¶ˆå¤±, å¾ˆéš¾é‡ç°, ä¹Ÿå¾ˆéš¾è¿½è¸ª, å¾ˆå¤šæ—¶å€™éƒ½è®©äººå¾ˆæŠ“ç‹‚. ä½†è¦å¿«é€Ÿè€Œåˆç²¾å‡†åœ°è§£å†³ "å¹¶å‘" ç±»çš„ç–‘éš¾æ‚ç—‡, å°±è¦ç†è§£è¿™ä»¶äº‹æƒ…çš„æœ¬è´¨, è¿½æœ¬æº¯æº, æ·±å…¥åˆ†æè¿™äº› Bug çš„æºå¤´åœ¨å“ªé‡Œ.')]),s._v(" "),t("p",[t("strong",[s._v("é‚£ä¸ºä»€ä¹ˆå¹¶å‘ç¼–ç¨‹å®¹æ˜“å‡ºé—®é¢˜å‘¢? å®ƒæ˜¯æ€ä¹ˆå‡ºé—®é¢˜çš„? ä»Šå¤©å°±é‡ç‚¹èŠèŠè¿™äº› Bug çš„æºå¤´")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å¹¶å‘ç¨‹åºå¹•åçš„æ•…äº‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹¶å‘ç¨‹åºå¹•åçš„æ•…äº‹"}},[s._v("#")]),s._v(" å¹¶å‘ç¨‹åºå¹•åçš„æ•…äº‹")]),s._v(" "),t("p",[s._v("è¿™äº›å¹´ CPU, å†…å­˜, I/O è®¾å¤‡éƒ½åœ¨ä¸æ–­è¿­ä»£, ä¸æ–­æœç€æ›´å¿«çš„æ–¹å‘åŠªåŠ›. ä½†åœ¨è¿™ä¸ªå¿«é€Ÿå‘å±•çš„è¿‡ç¨‹ä¸­, æœ‰ä¸€ä¸ª"),t("strong",[s._v("æ ¸å¿ƒçŸ›ç›¾ä¸€ç›´å­˜åœ¨, å°±æ˜¯è¿™ä¸‰è€…çš„é€Ÿåº¦å·®å¼‚")]),s._v(". CPU å’Œå†…å­˜çš„é€Ÿåº¦å·®å¼‚å¯ä»¥å½¢è±¡åœ°æè¿°ä¸º: CPU æ˜¯å¤©ä¸Šä¸€å¤©, å†…å­˜æ˜¯åœ°ä¸Šä¸€å¹´(å‡è®¾ CPU æ‰§è¡Œä¸€æ¡æ™®é€šæŒ‡ä»¤éœ€è¦ä¸€å¤©, é‚£ä¹ˆ CPU è¯»å†™å†…å­˜å¾—ç­‰å¾…ä¸€å¹´çš„æ—¶é—´). å†…å­˜å’Œ I/O è®¾å¤‡çš„é€Ÿåº¦å·®å¼‚å°±æ›´å¤§äº†, å†…å­˜æ˜¯å¤©ä¸Šä¸€å¤©, I/O è®¾å¤‡æ˜¯åœ°ä¸Šåå¹´.")]),s._v(" "),t("p",[s._v("ç¨‹åºé‡Œå¤§éƒ¨åˆ†è¯­å¥éƒ½è¦è®¿é—®å†…å­˜, æœ‰äº›è¿˜è¦è®¿é—® I/O, æ ¹æ®æœ¨æ¡¶ç†è®º(ä¸€åªæ°´æ¡¶èƒ½è£…å¤šå°‘æ°´å–å†³äºå®ƒæœ€çŸ­çš„é‚£å—æœ¨æ¿), ç¨‹åºæ•´ä½“çš„æ€§èƒ½å–å†³äºæœ€æ…¢çš„æ“ä½œâ€”â€”è¯»å†™ I/O è®¾å¤‡, ä¹Ÿå°±æ˜¯è¯´å•æ–¹é¢æé«˜ CPU æ€§èƒ½æ˜¯æ— æ•ˆçš„.")]),s._v(" "),t("p",[s._v("ä¸ºäº†åˆç†åˆ©ç”¨ CPU çš„é«˜æ€§èƒ½, å¹³è¡¡è¿™ä¸‰è€…çš„é€Ÿåº¦å·®å¼‚, è®¡ç®—æœºä½“ç³»æœºæ„, æ“ä½œç³»ç»Ÿ, ç¼–è¯‘ç¨‹åºéƒ½åšå‡ºäº†è´¡çŒ®, ä¸»è¦ä½“ç°ä¸º:")]),s._v(" "),t("ol",[t("li",[s._v("CPU å¢åŠ äº†"),t("strong",[s._v("ç¼“å­˜")]),s._v(", ä»¥å‡è¡¡ä¸å†…å­˜çš„é€Ÿåº¦å·®å¼‚;")]),s._v(" "),t("li",[s._v("æ“ä½œç³»ç»Ÿå¢åŠ äº†è¿›ç¨‹, çº¿ç¨‹, ä»¥åˆ†æ—¶å¤ç”¨ CPU, è¿›è€Œå‡è¡¡ CPU ä¸ I/O è®¾å¤‡çš„é€Ÿåº¦å·®å¼‚;")]),s._v(" "),t("li",[s._v("ç¼–è¯‘ç¨‹åºä¼˜åŒ–æŒ‡ä»¤æ‰§è¡Œæ¬¡åº, ä½¿å¾—ç¼“å­˜èƒ½å¤Ÿå¾—åˆ°æ›´åŠ åˆç†åœ°åˆ©ç”¨.")])]),s._v(" "),t("p",[s._v("ç°åœ¨å‡ ä¹æ‰€æœ‰çš„ç¨‹åºéƒ½é»˜é»˜åœ°äº«å—ç€è¿™äº›æˆæœ, ä½†æ˜¯å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤, å¹¶å‘ç¨‹åºå¾ˆå¤šè¯¡å¼‚é—®é¢˜çš„æ ¹æºä¹Ÿåœ¨è¿™é‡Œ.")]),s._v(" "),t("h5",{attrs:{id:"æºå¤´ä¹‹ä¸€-ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æºå¤´ä¹‹ä¸€-ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜"}},[s._v("#")]),s._v(" æºå¤´ä¹‹ä¸€:ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜")]),s._v(" "),t("p",[s._v("åœ¨å•æ ¸æ—¶ä»£, æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯åœ¨ä¸€é¢— CPU ä¸Šæ‰§è¡Œ, CPU ç¼“å­˜ä¸å†…å­˜çš„æ•°æ®ä¸€è‡´æ€§å®¹æ˜“è§£å†³. å› ä¸ºæ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯æ“ä½œåŒä¸€ä¸ª CPU çš„ç¼“å­˜, ä¸€ä¸ªçº¿ç¨‹å¯¹ç¼“å­˜çš„å†™, å¯¹å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ¥è¯´ä¸€å®šæ˜¯å¯è§çš„. ä¾‹å¦‚åœ¨ä¸‹é¢çš„å›¾ä¸­, çº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½æ˜¯æ“ä½œåŒä¸€ä¸ª CPU é‡Œé¢çš„ç¼“å­˜, æ‰€ä»¥çº¿ç¨‹ A æ›´æ–°äº†å˜é‡ V çš„å€¼, é‚£ä¹ˆçº¿ç¨‹ B ä¹‹åå†è®¿é—®å˜é‡ V, å¾—åˆ°çš„ä¸€å®šæ˜¯ V çš„æœ€æ–°å€¼(çº¿ç¨‹ A å†™è¿‡çš„å€¼).")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/18d87850b677c4757c55ad21cf53a7bb-20230731162452-bvs7820.png",alt:"",title:"CPU ç¼“å­˜ä¸å†…å­˜çš„å…³ç³»å›¾"}})]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹, å¦å¤–ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°, ç§°ä¸ºå¯è§æ€§")])]),s._v(".")]),s._v(" "),t("p",[s._v("å¤šæ ¸æ—¶ä»£, æ¯é¢— CPU éƒ½æœ‰è‡ªå·±çš„ç¼“å­˜, è¿™æ—¶ CPU ç¼“å­˜ä¸å†…å­˜çš„æ•°æ®ä¸€è‡´æ€§å°±æ²¡é‚£ä¹ˆå®¹æ˜“è§£å†³äº†, å½“å¤šä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„ CPU ä¸Šæ‰§è¡Œæ—¶, è¿™äº›"),t("strong",[s._v("çº¿ç¨‹æ“ä½œçš„æ˜¯ä¸åŒçš„ CPU ç¼“å­˜")]),s._v(". æ¯”å¦‚ä¸‹å›¾ä¸­, çº¿ç¨‹ A æ“ä½œçš„æ˜¯ CPU-1 ä¸Šçš„ç¼“å­˜, "),t("strong",[s._v("è€Œçº¿ç¨‹ B æ“ä½œçš„æ˜¯ CPU-2 ä¸Šçš„ç¼“å­˜, å¾ˆæ˜æ˜¾, è¿™ä¸ªæ—¶å€™çº¿ç¨‹ A å¯¹å˜é‡ V çš„æ“ä½œå¯¹äºçº¿ç¨‹ B è€Œè¨€å°±ä¸å…·å¤‡å¯è§æ€§äº†")]),s._v('. è¿™ä¸ªå°±å±äºç¡¬ä»¶ç¨‹åºå‘˜ç»™è½¯ä»¶ç¨‹åºå‘˜æŒ–çš„ "å‘".')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3c022480823a6143f35d0f474b8e95c5-20230731162452-mu0n1m6.png",alt:"",title:"å¤šæ ¸ CPU çš„ç¼“å­˜ä¸å†…å­˜å…³ç³»å›¾"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢å†ç”¨ä¸€æ®µä»£ç æ¥éªŒè¯ä¸€ä¸‹å¤šæ ¸åœºæ™¯ä¸‹çš„å¯è§æ€§é—®é¢˜. ä¸‹é¢çš„ä»£ç , æ¯æ‰§è¡Œä¸€æ¬¡ add10K() æ–¹æ³•, éƒ½ä¼šå¾ªç¯ 10000 æ¬¡ "),t("code",[s._v("count += 1")]),s._v("â€‹ æ“ä½œ. åœ¨ calc() æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹, æ¯ä¸ªçº¿ç¨‹è°ƒç”¨ä¸€æ¬¡ add10K() æ–¹æ³•. æƒ³ä¸€æƒ³æ‰§è¡Œ calc() æ–¹æ³•å¾—åˆ°çš„ç»“æœåº”è¯¥æ˜¯å¤šå°‘å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add10K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" idx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("idx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("calc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),s._v(" test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹, æ‰§è¡Œ add() æ“ä½œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" th1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add10K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" th2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add10K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹")]),s._v("\n        th1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        th2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œç»“æŸ")]),s._v("\n        th1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        th2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[s._v("ç›´è§‰æ¥çœ‹åº”è¯¥æ˜¯ 20000, å› ä¸ºåœ¨å•çº¿ç¨‹é‡Œè°ƒç”¨ä¸¤æ¬¡ add10K() æ–¹æ³•, count çš„å€¼å°±æ˜¯ 20000, ä½†å®é™…ä¸Š calc() çš„æ‰§è¡Œç»“æœæ˜¯ä¸ª 10000 åˆ° 20000 ä¹‹é—´çš„"),t("strong",[s._v("éšæœºæ•°")]),s._v(". ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("å‡è®¾çº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶å¼€å§‹æ‰§è¡Œ, é‚£ä¹ˆ"),t("strong",[s._v("ç¬¬ä¸€æ¬¡éƒ½ä¼šå°† count = 0 è¯»åˆ°å„è‡ªçš„ CPU ç¼“å­˜é‡Œ, æ‰§è¡Œå®Œ count+=1 ä¹‹å, å„è‡ª CPU ç¼“å­˜é‡Œçš„å€¼éƒ½æ˜¯ 1, åŒæ—¶å†™å…¥å†…å­˜å, ä¼šå‘ç°å†…å­˜ä¸­æ˜¯ 1, è€Œä¸æ˜¯æœŸæœ›çš„ 2")]),s._v(". ä¹‹åç”±äºå„è‡ªçš„ CPU ç¼“å­˜é‡Œéƒ½æœ‰äº† count çš„å€¼, "),t("mark",[t("strong",[s._v("ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯åŸºäº CPU ç¼“å­˜é‡Œçš„ count å€¼æ¥è®¡ç®—, æ‰€ä»¥å¯¼è‡´æœ€ç»ˆ count çš„å€¼éƒ½æ˜¯å°äº 20000 çš„. è¿™å°±æ˜¯ç¼“å­˜çš„å¯è§æ€§é—®é¢˜")])]),s._v(".")]),s._v(" "),t("p",[s._v("å¾ªç¯ 10000 æ¬¡ "),t("code",[s._v("count += 1")]),s._v("â€‹ æ“ä½œå¦‚æœæ”¹ä¸ºå¾ªç¯ 1 äº¿æ¬¡, å°±ä¼šå‘ç°æ•ˆæœæ›´æ˜æ˜¾, æœ€ç»ˆ count çš„å€¼æ¥è¿‘ 1 äº¿, è€Œä¸æ˜¯ 2 äº¿. å¦‚æœå¾ªç¯ 10000 æ¬¡, count çš„å€¼æ¥è¿‘ 20000, åŸå› æ˜¯"),t("strong",[s._v("ä¸¤ä¸ªçº¿ç¨‹ä¸æ˜¯åŒæ—¶å¯åŠ¨çš„, æœ‰ä¸€ä¸ªæ—¶å·®")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ae4dca1e38c9f70ff196d9b26f63920b-20230731162452-h85x6d4.png",alt:"",title:"å˜é‡ count åœ¨ CPU ç¼“å­˜å’Œå†…å­˜çš„åˆ†å¸ƒå›¾"}})]),s._v(" "),t("h5",{attrs:{id:"æºå¤´ä¹‹äºŒ-çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æºå¤´ä¹‹äºŒ-çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§é—®é¢˜"}},[s._v("#")]),s._v(" æºå¤´ä¹‹äºŒ:çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§é—®é¢˜")]),s._v(" "),t("p",[s._v("ç”±äº IO å¤ªæ…¢, æ—©æœŸçš„æ“ä½œç³»ç»Ÿå°±å‘æ˜äº†å¤šè¿›ç¨‹, å³ä¾¿åœ¨å•æ ¸çš„ CPU ä¸Šä¹Ÿå¯ä»¥ä¸€è¾¹å¬ç€æ­Œ, ä¸€è¾¹å†™ Bug, è¿™ä¸ªå°±æ˜¯å¤šè¿›ç¨‹çš„åŠŸåŠ³.")]),s._v(" "),t("p",[s._v('æ“ä½œç³»ç»Ÿå…è®¸æŸä¸ªè¿›ç¨‹æ‰§è¡Œä¸€å°æ®µæ—¶é—´, ä¾‹å¦‚ 50 æ¯«ç§’, è¿‡äº† 50 æ¯«ç§’æ“ä½œç³»ç»Ÿå°±ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œ(ç§°ä¸º"ä»»åŠ¡åˆ‡æ¢"), è¿™ä¸ª 50 æ¯«ç§’ç§°ä¸º "'),t("strong",[s._v("æ—¶é—´ç‰‡")]),s._v('".')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/87f461dfb05e073219f70c60ec02fb7d-20230731162452-4xpy8nf.png",alt:"",title:"çº¿ç¨‹åˆ‡æ¢ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v('åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…, å¦‚æœä¸€ä¸ªè¿›ç¨‹è¿›è¡Œä¸€ä¸ª IO æ“ä½œ, ä¾‹å¦‚è¯»ä¸ªæ–‡ä»¶, è¿™ä¸ªæ—¶å€™è¯¥è¿›ç¨‹å¯ä»¥æŠŠè‡ªå·±æ ‡è®°ä¸º "ä¼‘çœ çŠ¶æ€" å¹¶å‡ºè®© CPU çš„ä½¿ç”¨æƒ, å¾…æ–‡ä»¶è¯»è¿›å†…å­˜, æ“ä½œç³»ç»Ÿä¼šæŠŠè¿™ä¸ªä¼‘çœ çš„è¿›ç¨‹å”¤é†’, å”¤é†’åçš„è¿›ç¨‹å°±æœ‰æœºä¼šé‡æ–°è·å¾— CPU çš„ä½¿ç”¨æƒäº†.')]),s._v(" "),t("p",[s._v("è¿™é‡Œçš„è¿›ç¨‹åœ¨ç­‰å¾… IO æ—¶ä¹‹æ‰€ä»¥ä¼šé‡Šæ”¾ CPU ä½¿ç”¨æƒ, æ˜¯ä¸ºäº†è®© CPU åœ¨è¿™æ®µç­‰å¾…æ—¶é—´é‡Œå¯ä»¥åšåˆ«çš„äº‹æƒ…, è¿™æ ·ä¸€æ¥ CPU çš„ä½¿ç”¨ç‡å°±ä¸Šæ¥äº†; æ­¤å¤–, å¦‚æœè¿™æ—¶æœ‰å¦å¤–ä¸€ä¸ªè¿›ç¨‹ä¹Ÿè¯»æ–‡ä»¶, è¯»æ–‡ä»¶çš„æ“ä½œå°±ä¼šæ’é˜Ÿ, ç£ç›˜é©±åŠ¨åœ¨å®Œæˆä¸€ä¸ªè¿›ç¨‹çš„è¯»æ“ä½œå, å‘ç°æœ‰æ’é˜Ÿçš„ä»»åŠ¡, å°±ä¼šç«‹å³å¯åŠ¨ä¸‹ä¸€ä¸ªè¯»æ“ä½œ, è¿™æ · IO çš„ä½¿ç”¨ç‡ä¹Ÿä¸Šæ¥äº†.")]),s._v(" "),t("p",[s._v("æ˜¯ä¸æ˜¯å¾ˆç®€å•çš„é€»è¾‘? ä½†æ˜¯, è™½ç„¶çœ‹ä¼¼ç®€å•, æ”¯æŒå¤šè¿›ç¨‹åˆ†æ—¶å¤ç”¨åœ¨æ“ä½œç³»ç»Ÿçš„å‘å±•å²ä¸Šå´å…·æœ‰é‡Œç¨‹ç¢‘æ„ä¹‰, Unix å°±æ˜¯å› ä¸ºè§£å†³äº†è¿™ä¸ªé—®é¢˜è€Œåå™ªå¤©ä¸‹çš„.")]),s._v(" "),t("p",[s._v('æ—©æœŸçš„æ“ä½œç³»ç»ŸåŸºäºè¿›ç¨‹æ¥è°ƒåº¦ CPU, ä¸åŒè¿›ç¨‹é—´æ˜¯ä¸å…±äº«å†…å­˜ç©ºé—´çš„, æ‰€ä»¥è¿›ç¨‹è¦åšä»»åŠ¡åˆ‡æ¢å°±è¦åˆ‡æ¢å†…å­˜æ˜ å°„åœ°å€, è€Œä¸€ä¸ªè¿›ç¨‹åˆ›å»ºçš„æ‰€æœ‰çº¿ç¨‹, éƒ½æ˜¯å…±äº«ä¸€ä¸ªå†…å­˜ç©ºé—´çš„, æ‰€ä»¥çº¿ç¨‹åšä»»åŠ¡åˆ‡æ¢æˆæœ¬å°±å¾ˆä½äº†. ç°ä»£çš„æ“ä½œç³»ç»Ÿéƒ½åŸºäºæ›´è½»é‡çš„çº¿ç¨‹æ¥è°ƒåº¦, ç°åœ¨æåˆ°çš„ "ä»»åŠ¡åˆ‡æ¢" éƒ½æ˜¯æŒ‡ "çº¿ç¨‹åˆ‡æ¢".')]),s._v(" "),t("p",[s._v("Java å¹¶å‘ç¨‹åºéƒ½æ˜¯åŸºäºå¤šçº¿ç¨‹çš„, è‡ªç„¶ä¹Ÿä¼šæ¶‰åŠåˆ°ä»»åŠ¡åˆ‡æ¢, ä¹Ÿè®¸ä½ æƒ³ä¸åˆ°, ä»»åŠ¡åˆ‡æ¢ç«Ÿç„¶ä¹Ÿæ˜¯å¹¶å‘ç¼–ç¨‹é‡Œè¯¡å¼‚ Bug çš„æºå¤´ä¹‹ä¸€. "),t("strong",[s._v("ä»»åŠ¡åˆ‡æ¢çš„æ—¶æœºå¤§å¤šæ•°æ˜¯åœ¨æ—¶é—´ç‰‡ç»“æŸçš„æ—¶å€™")]),s._v(", ç°åœ¨åŸºæœ¬éƒ½ä½¿ç”¨é«˜çº§è¯­è¨€ç¼–ç¨‹, é«˜çº§è¯­è¨€é‡Œä¸€æ¡è¯­å¥å¾€å¾€éœ€è¦å¤šæ¡ CPU æŒ‡ä»¤å®Œæˆ, ä¾‹å¦‚ä¸Šé¢ä»£ç ä¸­çš„ "),t("code",[s._v("count += 1")]),s._v("â€‹, è‡³å°‘éœ€è¦"),t("strong",[s._v("ä¸‰æ¡ CPU æŒ‡ä»¤")]),s._v(".")]),s._v(" "),t("ul",[t("li",[s._v("æŒ‡ä»¤ 1: é¦–å…ˆéœ€è¦"),t("strong",[s._v("æŠŠå˜é‡ count ä»å†…å­˜åŠ è½½åˆ° CPU çš„å¯„å­˜å™¨")]),s._v(";")]),s._v(" "),t("li",[s._v("æŒ‡ä»¤ 2: ä¹‹ååœ¨"),t("strong",[s._v("å¯„å­˜å™¨ä¸­æ‰§è¡Œ +1 æ“ä½œ")]),s._v(";")]),s._v(" "),t("li",[s._v("æŒ‡ä»¤ 3: æœ€å"),t("strong",[s._v("å°†ç»“æœå†™å…¥å†…å­˜(ç¼“å­˜æœºåˆ¶å¯¼è‡´å¯èƒ½å†™å…¥çš„æ˜¯ CPU ç¼“å­˜è€Œä¸æ˜¯å†…å­˜)")]),s._v(" .")])]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("æ“ä½œç³»ç»Ÿåšä»»åŠ¡åˆ‡æ¢, å¯ä»¥å‘ç”Ÿåœ¨ä»»ä½•ä¸€æ¡ CPU æŒ‡ä»¤æ‰§è¡Œå®Œ, æ˜¯çš„, æ˜¯ CPU æŒ‡ä»¤, è€Œä¸æ˜¯é«˜çº§è¯­è¨€é‡Œçš„ä¸€æ¡è¯­å¥")])]),s._v(". å¯¹äºä¸Šé¢çš„ä¸‰æ¡æŒ‡ä»¤æ¥è¯´, å‡è®¾ count = 0, å¦‚æœçº¿ç¨‹ A åœ¨æŒ‡ä»¤ 1 æ‰§è¡Œå®Œååšçº¿ç¨‹åˆ‡æ¢, çº¿ç¨‹ A å’Œçº¿ç¨‹ B æŒ‰ç…§ä¸‹å›¾çš„åºåˆ—æ‰§è¡Œ, é‚£ä¹ˆä¼šå‘ç°ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº† count += 1 çš„æ“ä½œ, ä½†æ˜¯å¾—åˆ°çš„ç»“æœä¸æ˜¯æœŸæœ›çš„ 2, è€Œæ˜¯ 1.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/370c361a07bb676fab7ddb7bd521495f-20230731162452-4jvgxvv.png",alt:"",title:"éåŸå­æ“ä½œçš„æ‰§è¡Œè·¯å¾„ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("æœ‰äººæ½œæ„è¯†é‡Œé¢è§‰å¾— count+=1 è¿™ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“, å°±åƒä¸€ä¸ªåŸå­ä¸€æ ·, çº¿ç¨‹çš„åˆ‡æ¢å¯ä»¥å‘ç”Ÿåœ¨ count+=1 ä¹‹å‰, ä¹Ÿå¯ä»¥å‘ç”Ÿåœ¨ count+=1 ä¹‹å, ä½†å°±æ˜¯ä¸ä¼šå‘ç”Ÿåœ¨ä¸­é—´. "),t("mark",[t("strong",[s._v("æˆ‘ä»¬æŠŠä¸€ä¸ªæˆ–è€…å¤šä¸ªæ“ä½œåœ¨ CPU æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸è¢«ä¸­æ–­çš„ç‰¹æ€§ç§°ä¸ºåŸå­æ€§. CPU èƒ½ä¿è¯çš„åŸå­æ“ä½œæ˜¯ CPU æŒ‡ä»¤çº§åˆ«çš„, è€Œä¸æ˜¯é«˜çº§è¯­è¨€çš„æ“ä½œç¬¦, è¿™æ˜¯è¿èƒŒå¤§å®¶ç›´è§‰çš„åœ°æ–¹. å› æ­¤, å¾ˆå¤šæ—¶å€™éœ€è¦åœ¨é«˜çº§è¯­è¨€å±‚é¢ä¿è¯æ“ä½œçš„åŸå­æ€§")])]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æºå¤´ä¹‹ä¸‰-ç¼–è¯‘ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æºå¤´ä¹‹ä¸‰-ç¼–è¯‘ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜"}},[s._v("#")]),s._v(" æºå¤´ä¹‹ä¸‰:ç¼–è¯‘ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜")]),s._v(" "),t("p",[s._v("é‚£å¹¶å‘ç¼–ç¨‹é‡Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–æœ‰è¿ç›´è§‰å®¹æ˜“å¯¼è‡´è¯¡å¼‚ Bug çš„æŠ€æœ¯å‘¢? è¿˜æœ‰, å°±æ˜¯æœ‰åºæ€§. é¡¾åæ€ä¹‰, "),t("strong",[s._v('æœ‰åºæ€§æŒ‡çš„æ˜¯ç¨‹åºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ. ç¼–è¯‘å™¨ä¸ºäº†ä¼˜åŒ–æ€§èƒ½, æœ‰æ—¶å€™ä¼šæ”¹å˜ç¨‹åºä¸­è¯­å¥çš„å…ˆåé¡ºåº. ** ä¾‹å¦‚ç¨‹åºä¸­: "a=6; b=7;" ç¼–è¯‘å™¨ä¼˜åŒ–åå¯èƒ½å˜æˆ "b=7; a=6;", åœ¨è¿™ä¸ªä¾‹å­ä¸­, ç¼–è¯‘å™¨è°ƒæ•´äº†è¯­å¥çš„é¡ºåº, ä½†æ˜¯')]),s._v("ä¸å½±å“ç¨‹åºçš„æœ€ç»ˆç»“æœ**. ä¸è¿‡æœ‰æ—¶å€™ç¼–è¯‘å™¨åŠè§£é‡Šå™¨çš„ä¼˜åŒ–å¯èƒ½å¯¼è‡´æ„æƒ³ä¸åˆ°çš„ Bug.")]),s._v(" "),t("p",[s._v("åœ¨ Java é¢†åŸŸä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹å°±æ˜¯åˆ©ç”¨"),t("strong",[s._v("åŒé‡æ£€æŸ¥åˆ›å»ºå•ä¾‹å¯¹è±¡")]),s._v(", ä¾‹å¦‚ä¸‹é¢çš„ä»£ç : åœ¨è·å–å®ä¾‹ getInstance() çš„æ–¹æ³•ä¸­, é¦–å…ˆåˆ¤æ–­ instance æ˜¯å¦ä¸ºç©º, å¦‚æœä¸ºç©º, åˆ™é”å®š Singleton.class å¹¶å†æ¬¡æ£€æŸ¥ instance æ˜¯å¦ä¸ºç©º, å¦‚æœè¿˜ä¸ºç©ºåˆ™åˆ›å»º Singleton çš„ä¸€ä¸ªå®ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    instance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ A, B åŒæ—¶è°ƒç”¨ getInstance() æ–¹æ³•, ä»–ä»¬ä¼šåŒæ—¶å‘ç° "),t("code",[s._v("instance <mark> null")]),s._v("â€‹, äºæ˜¯åŒæ—¶å¯¹ Singleton.class åŠ é”, æ­¤æ—¶ JVM ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸåŠ é”æˆåŠŸ(å‡è®¾æ˜¯çº¿ç¨‹ A), å¦å¤–ä¸€ä¸ªçº¿ç¨‹åˆ™ä¼šå¤„äºç­‰å¾…çŠ¶æ€(å‡è®¾æ˜¯çº¿ç¨‹ B); çº¿ç¨‹ A ä¼šåˆ›å»ºä¸€ä¸ª Singleton å®ä¾‹, ä¹‹åé‡Šæ”¾é”, é”é‡Šæ”¾å, çº¿ç¨‹ B è¢«å”¤é†’, çº¿ç¨‹ B å†æ¬¡å°è¯•åŠ é”, æ­¤æ—¶æ˜¯å¯ä»¥åŠ é”æˆåŠŸçš„, åŠ é”æˆåŠŸå, çº¿ç¨‹ B æ£€æŸ¥ "),t("code",[s._v("instance </mark> null")]),s._v("â€‹ æ—¶ä¼šå‘ç°, å·²ç»åˆ›å»ºè¿‡ Singleton å®ä¾‹äº†, æ‰€ä»¥çº¿ç¨‹ B ä¸ä¼šå†åˆ›å»ºä¸€ä¸ª Singleton å®ä¾‹.")]),s._v(" "),t("p",[s._v("è¿™çœ‹ä¸Šå»ä¸€åˆ‡éƒ½å¾ˆå®Œç¾, æ— æ‡ˆå¯å‡», ä½†å®é™…ä¸Šè¿™ä¸ª getInstance() æ–¹æ³•å¹¶ä¸å®Œç¾. é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢? å‡ºåœ¨ new æ“ä½œä¸Š, ç›´è§‰ä¸Šæ¥è¯´ new æ“ä½œåº”è¯¥æ˜¯:")]),s._v(" "),t("ol",[t("li",[s._v("åˆ†é…ä¸€å—å†…å­˜ M;")]),s._v(" "),t("li",[s._v("åœ¨å†…å­˜ M ä¸Šåˆå§‹åŒ– Singleton å¯¹è±¡;")]),s._v(" "),t("li",[s._v("ç„¶å M çš„åœ°å€èµ‹å€¼ç»™ instance å˜é‡.")])]),s._v(" "),t("p",[s._v("ä½†æ˜¯å®é™…ä¸Šä¼˜åŒ–åçš„æ‰§è¡Œè·¯å¾„å´æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("åˆ†é…ä¸€å—å†…å­˜ M;")])]),s._v(" "),t("li",[t("strong",[s._v("å°† M çš„åœ°å€èµ‹å€¼ç»™ instance å˜é‡;")])]),s._v(" "),t("li",[t("strong",[s._v("æœ€ååœ¨å†…å­˜ M ä¸Šåˆå§‹åŒ– Singleton å¯¹è±¡.")])])]),s._v(" "),t("p",[s._v("ä¼˜åŒ–åä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢? å‡è®¾çº¿ç¨‹ A å…ˆæ‰§è¡Œ getInstance() æ–¹æ³•, å½“æ‰§è¡Œå®ŒæŒ‡ä»¤ 2 æ—¶æ°å¥½å‘ç”Ÿäº†çº¿ç¨‹åˆ‡æ¢, åˆ‡æ¢åˆ°äº†çº¿ç¨‹ B ä¸Š; å¦‚æœæ­¤æ—¶çº¿ç¨‹ B ä¹Ÿæ‰§è¡Œ getInstance() æ–¹æ³•, é‚£ä¹ˆçº¿ç¨‹ B åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªåˆ¤æ–­æ—¶ä¼šå‘ç° "),t("code",[s._v("instance != null")]),s._v("â€‹ , æ‰€ä»¥ç›´æ¥è¿”å› instance, è€Œæ­¤æ—¶çš„ instance æ˜¯æ²¡æœ‰åˆå§‹åŒ–è¿‡çš„, å¦‚æœè¿™ä¸ªæ—¶å€™è®¿é—® instance çš„æˆå‘˜å˜é‡å°±å¯èƒ½"),t("strong",[s._v("è§¦å‘ç©ºæŒ‡é’ˆå¼‚å¸¸")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f4bb30d80d60516da1d62ade65c38e85-20230731162452-l36ihqx.png",alt:"",title:"åŒé‡æ£€æŸ¥åˆ›å»ºå•ä¾‹çš„å¼‚å¸¸æ‰§è¡Œè·¯å¾„"}})]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v('è¦å†™å¥½å¹¶å‘ç¨‹åº, é¦–å…ˆè¦çŸ¥é“å¹¶å‘ç¨‹åºçš„é—®é¢˜åœ¨å“ªé‡Œ, åªæœ‰ç¡®å®šäº† "é¶å­", æ‰æœ‰å¯èƒ½æŠŠé—®é¢˜è§£å†³, æ¯•ç«Ÿæ‰€æœ‰çš„è§£å†³æ–¹æ¡ˆéƒ½æ˜¯é’ˆå¯¹é—®é¢˜çš„. å¹¶å‘ç¨‹åºç»å¸¸å‡ºç°çš„è¯¡å¼‚é—®é¢˜çœ‹ä¸Šå»éå¸¸æ— å˜å¤´, ä½†æ˜¯æ·±ç©¶çš„è¯, æ— å¤–ä¹å°±æ˜¯ç›´è§‰æ¬ºéª—äº†æˆ‘ä»¬, '),t("strong",[s._v("åªè¦èƒ½å¤Ÿæ·±åˆ»ç†è§£å¯è§æ€§, åŸå­æ€§, æœ‰åºæ€§åœ¨å¹¶å‘åœºæ™¯ä¸‹çš„åŸç†, å¾ˆå¤šå¹¶å‘ Bug éƒ½æ˜¯å¯ä»¥ç†è§£, å¯ä»¥è¯Šæ–­çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ä»‹ç»å¯è§æ€§, åŸå­æ€§, æœ‰åºæ€§çš„æ—¶å€™, ç‰¹æ„æåˆ°"),t("strong",[s._v("ç¼“å­˜")]),s._v("å¯¼è‡´çš„å¯è§æ€§é—®é¢˜, "),t("strong",[s._v("çº¿ç¨‹åˆ‡æ¢")]),s._v("å¸¦æ¥çš„åŸå­æ€§é—®é¢˜, "),t("strong",[s._v("ç¼–è¯‘ä¼˜åŒ–")]),s._v("å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜, å…¶å®ç¼“å­˜, çº¿ç¨‹, ç¼–è¯‘ä¼˜åŒ–çš„ç›®çš„å’Œå†™å¹¶å‘ç¨‹åºçš„ç›®çš„æ˜¯ç›¸åŒçš„, éƒ½æ˜¯æé«˜ç¨‹åºæ€§èƒ½. ä½†æ˜¯æŠ€æœ¯åœ¨è§£å†³ä¸€ä¸ªé—®é¢˜çš„åŒæ—¶, å¿…ç„¶ä¼šå¸¦æ¥å¦å¤–ä¸€ä¸ªé—®é¢˜, æ‰€ä»¥"),t("strong",[s._v("åœ¨é‡‡ç”¨ä¸€é¡¹æŠ€æœ¯çš„åŒæ—¶, ä¸€å®šè¦æ¸…æ¥šå®ƒå¸¦æ¥çš„é—®é¢˜æ˜¯ä»€ä¹ˆ, ä»¥åŠå¦‚ä½•è§„é¿")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_02-javaå†…å­˜æ¨¡å‹-javaå¦‚ä½•è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_02-javaå†…å­˜æ¨¡å‹-javaå¦‚ä½•è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ğŸ€"}},[s._v("#")]),s._v(" 02-Javaå†…å­˜æ¨¡å‹:Javaå¦‚ä½•è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ğŸ€")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚è®²åˆ°åœ¨å¹¶å‘åœºæ™¯ä¸­, å› "),t("strong",[s._v("å¯è§æ€§, åŸå­æ€§, æœ‰åºæ€§")]),s._v("å¯¼è‡´çš„é—®é¢˜å¸¸å¸¸ä¼šè¿èƒŒå¤§å®¶çš„ç›´è§‰, ä»è€Œæˆä¸ºå¹¶å‘ç¼–ç¨‹çš„ Bug ä¹‹æº. è¿™ä¸‰è€…åœ¨ç¼–ç¨‹é¢†åŸŸå±äº"),t("strong",[s._v("å…±æ€§é—®é¢˜")]),s._v(", æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€éƒ½ä¼šé‡åˆ°, Java åœ¨è¯ç”Ÿä¹‹åˆå°±æ”¯æŒå¤šçº¿ç¨‹, è‡ªç„¶ä¹Ÿæœ‰é’ˆå¯¹è¿™ä¸‰è€…çš„æŠ€æœ¯æ–¹æ¡ˆ, è€Œä¸”åœ¨ç¼–ç¨‹è¯­è¨€é¢†åŸŸå¤„äºé¢†å…ˆåœ°ä½. ç†è§£ Java è§£å†³å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ, å¯¹äºç†è§£å…¶ä»–è¯­è¨€çš„è§£å†³æ–¹æ¡ˆæœ‰è§¦ç±»æ—é€šçš„æ•ˆæœ.")]),s._v(" "),t("p",[s._v("é‚£å°±å…ˆæ¥èŠèŠå¦‚ä½•è§£å†³å…¶ä¸­çš„"),t("strong",[s._v("å¯è§æ€§å’Œæœ‰åºæ€§")]),s._v("å¯¼è‡´çš„é—®é¢˜, è¿™ä¹Ÿå°±å¼•å‡ºæ¥äº†ä»Šå¤©çš„ä¸»è§’--"),t("strong",[s._v("Java å†…å­˜æ¨¡å‹")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ä»€ä¹ˆæ˜¯javaå†…å­˜æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯javaå†…å­˜æ¨¡å‹"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹?")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°, "),t("mark",[t("strong",[s._v("å¯¼è‡´å¯è§æ€§çš„åŸå› æ˜¯ç¼“å­˜, å¯¼è‡´æœ‰åºæ€§çš„åŸå› æ˜¯ç¼–è¯‘ä¼˜åŒ–,")])]),s._v("  é‚£è§£å†³å¯è§æ€§, æœ‰åºæ€§æœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯"),t("mark",[t("strong",[s._v("ç¦ç”¨ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–")])]),s._v(", ä½†æ˜¯è¿™æ ·é—®é¢˜è™½ç„¶è§£å†³äº†, é‚£ç¨‹åºçš„æ€§èƒ½å¯å°±å ªå¿§äº†.")]),s._v(" "),t("p",[s._v("åˆç†çš„æ–¹æ¡ˆåº”è¯¥æ˜¯"),t("strong",[s._v("æŒ‰éœ€ç¦ç”¨ç¼“å­˜ä»¥åŠç¼–è¯‘ä¼˜åŒ–")]),s._v('. å¦‚ä½•åšåˆ° "æŒ‰éœ€ç¦ç”¨" å‘¢? å¯¹äºå¹¶å‘ç¨‹åº, ä½•æ—¶ç¦ç”¨ç¼“å­˜ä»¥åŠç¼–è¯‘ä¼˜åŒ–åªæœ‰ç¨‹åºå‘˜çŸ¥é“, é‚£'),t("strong",[s._v('æ‰€è°“ "æŒ‰éœ€ç¦ç”¨" å…¶å®å°±æ˜¯æŒ‡æŒ‰ç…§ç¨‹åºå‘˜çš„è¦æ±‚æ¥ç¦ç”¨')]),s._v(". æ‰€ä»¥ä¸ºäº†è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜, "),t("strong",[s._v("åªéœ€è¦æä¾›ç»™ç¨‹åºå‘˜æŒ‰éœ€ç¦ç”¨ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–çš„æ–¹æ³•å³å¯")]),s._v(".")]),s._v(" "),t("p",[s._v("Java å†…å­˜æ¨¡å‹æ˜¯ä¸ªå¾ˆå¤æ‚çš„è§„èŒƒ, å¯ä»¥ä»ä¸åŒçš„è§†è§’æ¥è§£è¯», ç«™åœ¨ç¨‹åºå‘˜çš„è§†è§’, æœ¬è´¨ä¸Šå¯ä»¥ç†è§£ä¸º, "),t("mark",[t("strong",[s._v("Java å†…å­˜æ¨¡å‹è§„èŒƒäº† JVM å¦‚ä½•æä¾›æŒ‰éœ€ç¦ç”¨ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–çš„æ–¹æ³•")])]),s._v(". å…·ä½“æ¥è¯´, è¿™äº›æ–¹æ³•åŒ…æ‹¬ "),t("strong",[s._v("volatile")]),s._v(", "),t("strong",[s._v("synchronized")]),s._v(" å’Œ "),t("strong",[s._v("final")]),s._v(" ä¸‰ä¸ªå…³é”®å­—, ä»¥åŠå…­é¡¹ "),t("strong",[s._v("Happens-Before è§„åˆ™")]),s._v(", è¿™ä¹Ÿæ­£æ˜¯æœ¬èŠ‚çš„é‡ç‚¹å†…å®¹.")]),s._v(" "),t("h5",{attrs:{id:"ä½¿ç”¨volatileçš„å›°æƒ‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨volatileçš„å›°æƒ‘"}},[s._v("#")]),s._v(" ä½¿ç”¨volatileçš„å›°æƒ‘")]),s._v(" "),t("p",[s._v("volatile å…³é”®å­—å¹¶ä¸æ˜¯ Java çš„ç‰¹äº§, å¤è€çš„ C è¯­è¨€é‡Œä¹Ÿæœ‰, å®ƒæœ€åŸå§‹çš„æ„ä¹‰å°±æ˜¯ç¦ç”¨ CPU ç¼“å­˜.")]),s._v(" "),t("p",[s._v("ä¾‹å¦‚, å£°æ˜ä¸€ä¸ª volatile å˜é‡ "),t("code",[s._v("volatile int x = 0")]),s._v("â€‹, å®ƒè¡¨è¾¾çš„æ˜¯: "),t("strong",[s._v("å‘Šè¯‰ç¼–è¯‘å™¨, å¯¹è¿™ä¸ªå˜é‡çš„è¯»å†™, ä¸èƒ½ä½¿ç”¨ CPU ç¼“å­˜, å¿…é¡»ä»å†…å­˜ä¸­è¯»å–æˆ–è€…å†™å…¥")]),s._v(". è¿™ä¸ªè¯­ä¹‰çœ‹ä¸Šå»ç›¸å½“æ˜ç¡®, ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™å´ä¼šå¸¦æ¥å›°æƒ‘.")]),s._v(" "),t("p",[s._v('ä¾‹å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç , å‡è®¾çº¿ç¨‹ A æ‰§è¡Œ writer() æ–¹æ³•, æŒ‰ç…§ volatile è¯­ä¹‰, ä¼šæŠŠå˜é‡ "v=true" å†™å…¥å†…å­˜; å‡è®¾çº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•, åŒæ ·æŒ‰ç…§ volatile è¯­ä¹‰, çº¿ç¨‹ B ä¼šä»å†…å­˜ä¸­è¯»å–å˜é‡ v, å¦‚æœçº¿ç¨‹ B çœ‹åˆ° "v == true" æ—¶, é‚£ä¹ˆçº¿ç¨‹ B çœ‹åˆ°çš„å˜é‡ x æ˜¯å¤šå°‘å‘¢?')]),s._v(" "),t("p",[s._v("ç›´è§‰ä¸Šçœ‹, åº”è¯¥æ˜¯ 42, é‚£å®é™…åº”è¯¥æ˜¯å¤šå°‘å‘¢? è¿™ä¸ªè¦çœ‹ Java çš„ç‰ˆæœ¬, å¦‚æœåœ¨ä½äº 1.5 ç‰ˆæœ¬ä¸Šè¿è¡Œ, x å¯èƒ½æ˜¯ 42, ä¹Ÿæœ‰å¯èƒ½æ˜¯ 0; "),t("strong",[s._v("å¦‚æœåœ¨ 1.5 ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸Šè¿è¡Œ, x å°±æ˜¯ç­‰äº 42")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¥ä¸‹ä»£ç æ¥æºäºã€å‚è€ƒ 1ã€‘")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VolatileExample")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("writer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œ x ä¼šæ˜¯å¤šå°‘å‘¢? ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("åˆ†æä¸€ä¸‹, ä¸ºä»€ä¹ˆ 1.5 ä»¥å‰çš„ç‰ˆæœ¬ä¼šå‡ºç° x = 0 çš„æƒ…å†µå‘¢? æˆ‘ç›¸ä¿¡ä½ ä¸€å®šæƒ³åˆ°äº†, "),t("strong",[s._v("å˜é‡ x å¯èƒ½è¢« CPU ç¼“å­˜è€Œå¯¼è‡´å¯è§æ€§é—®é¢˜")]),s._v(". è¿™ä¸ªé—®é¢˜åœ¨ 1.5 ç‰ˆæœ¬å·²ç»è¢«åœ†æ»¡è§£å†³äº†. Java å†…å­˜æ¨¡å‹åœ¨ 1.5 ç‰ˆæœ¬å¯¹ volatile è¯­ä¹‰è¿›è¡Œäº†å¢å¼º. æ€ä¹ˆå¢å¼ºçš„å‘¢? ç­”æ¡ˆæ˜¯ä¸€é¡¹ "),t("strong",[s._v("Happens-Before è§„åˆ™")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"happens-beforeè§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#happens-beforeè§„åˆ™"}},[s._v("#")]),s._v(" Happens-Beforeè§„åˆ™")]),s._v(" "),t("p",[s._v('å¦‚ä½•ç†è§£ Happens-Before å‘¢? å¦‚æœæœ›æ–‡ç”Ÿä¹‰(å¾ˆå¤šç½‘æ–‡ä¹Ÿéƒ½çˆ±æŒ‰å­—é¢æ„æ€ç¿»è¯‘æˆ"å…ˆè¡Œå‘ç”Ÿ"), é‚£å°±å—è¾•åŒ—è¾™äº†, Happens-Before å¹¶ä¸æ˜¯è¯´å‰é¢ä¸€ä¸ªæ“ä½œå‘ç”Ÿåœ¨åç»­æ“ä½œçš„å‰é¢, å®ƒçœŸæ­£è¦è¡¨è¾¾çš„æ˜¯: '),t("mark",[t("strong",[s._v("å‰é¢ä¸€ä¸ªæ“ä½œçš„ç»“æœå¯¹åç»­æ“ä½œæ˜¯å¯è§çš„")])]),s._v('. å°±åƒæœ‰å¿ƒçµæ„Ÿåº”çš„ä¸¤ä¸ªäºº, è™½ç„¶è¿œéš”åƒé‡Œ, ä¸€ä¸ªäººå¿ƒä¹‹æ‰€æƒ³, å¦ä¸€ä¸ªäººéƒ½çœ‹å¾—åˆ°. Happens-Before è§„åˆ™å°±æ˜¯è¦ä¿è¯çº¿ç¨‹ä¹‹é—´çš„è¿™ç§ "å¿ƒçµæ„Ÿåº”". æ‰€ä»¥æ¯”è¾ƒæ­£å¼çš„è¯´æ³•æ˜¯: '),t("strong",[s._v("Happens-Before çº¦æŸäº†ç¼–è¯‘å™¨çš„ä¼˜åŒ–è¡Œä¸º, è™½å…è®¸ç¼–è¯‘å™¨ä¼˜åŒ–, ä½†æ˜¯è¦æ±‚ç¼–è¯‘å™¨ä¼˜åŒ–åä¸€å®šéµå®ˆ Happens-Before è§„åˆ™")]),s._v(".")]),s._v(" "),t("p",[s._v("Happens-Before è§„åˆ™åº”è¯¥æ˜¯ Java å†…å­˜æ¨¡å‹é‡Œé¢æœ€æ™¦æ¶©çš„å†…å®¹äº†, å’Œç¨‹åºå‘˜ç›¸å…³çš„è§„åˆ™ä¸€å…±æœ‰å¦‚ä¸‹å…­é¡¹, "),t("strong",[s._v("éƒ½æ˜¯å…³äºå¯è§æ€§")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("æ°å¥½å‰é¢ç¤ºä¾‹ä»£ç æ¶‰åŠåˆ°è¿™å…­é¡¹è§„åˆ™ä¸­çš„å‰ä¸‰é¡¹, ä¸ºä¾¿äºç†è§£, ä¹Ÿä¼šåˆ†æä¸Šé¢çš„ç¤ºä¾‹ä»£ç , æ¥çœ‹çœ‹è§„åˆ™ 1, 2 å’Œ 3 åˆ°åº•è¯¥å¦‚ä½•ç†è§£. è‡³äºå…¶ä»–ä¸‰é¡¹, ä¹Ÿä¼šç»“åˆå…¶ä»–ä¾‹å­ä½œä»¥è¯´æ˜.")]),s._v(" "),t("h6",{attrs:{id:"_1-ç¨‹åºçš„é¡ºåºæ€§è§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç¨‹åºçš„é¡ºåºæ€§è§„åˆ™"}},[s._v("#")]),s._v(" (1)ç¨‹åºçš„é¡ºåºæ€§è§„åˆ™")]),s._v(" "),t("p",[s._v("è¿™æ¡è§„åˆ™æ˜¯"),t("strong",[s._v("æŒ‡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­, æŒ‰ç…§ç¨‹åºé¡ºåº, å‰é¢çš„æ“ä½œ Happens-Before äºåç»­çš„ä»»æ„æ“ä½œ")]),s._v('. è¿™è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„, æ¯”å¦‚åˆšæ‰é‚£æ®µç¤ºä¾‹ä»£ç , æŒ‰ç…§ç¨‹åºçš„é¡ºåº, ä»£ç  "x = 42;" Happens-Before äºä»£ç  "v = true;", è¿™å°±æ˜¯è§„åˆ™ 1 çš„å†…å®¹, ä¹Ÿæ¯”è¾ƒç¬¦åˆå•çº¿ç¨‹é‡Œé¢çš„æ€ç»´: '),t("mark",[t("strong",[s._v("ç¨‹åºå‰é¢å¯¹æŸä¸ªå˜é‡çš„ä¿®æ”¹ä¸€å®šæ˜¯å¯¹åç»­æ“ä½œå¯è§çš„")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸ºæ–¹ä¾¿æŸ¥çœ‹, è¿™é‡Œå°†é‚£æ®µç¤ºä¾‹ä»£ç æ”¾è¿™é‡Œ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¥ä¸‹ä»£ç æ¥æºäºã€å‚è€ƒ 1ã€‘")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VolatileExample")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("writer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œ x ä¼šæ˜¯å¤šå°‘å‘¢? ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h6",{attrs:{id:"_2-volatileå˜é‡è§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-volatileå˜é‡è§„åˆ™"}},[s._v("#")]),s._v(" (2)volatileå˜é‡è§„åˆ™")]),s._v(" "),t("p",[s._v("è¿™æ¡è§„åˆ™æ˜¯æŒ‡"),t("strong",[s._v("å¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œ, Happens-Before äºåç»­å¯¹è¿™ä¸ª volatile å˜é‡çš„è¯»æ“ä½œ")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªå°±æœ‰ç‚¹è´¹è§£äº†, å¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œç›¸å¯¹äºåç»­å¯¹è¿™ä¸ª volatile å˜é‡çš„è¯»æ“ä½œå¯è§, è¿™æ€ä¹ˆçœ‹éƒ½æ˜¯ç¦ç”¨ç¼“å­˜çš„æ„æ€å•Š, è²Œä¼¼å’Œ 1.5 ç‰ˆæœ¬ä»¥å‰çš„è¯­ä¹‰æ²¡æœ‰å˜åŒ–å•Š? å¦‚æœå•çœ‹è¿™ä¸ªè§„åˆ™, çš„ç¡®æ˜¯è¿™æ ·, ä½†æ˜¯å¦‚æœå…³è”ä¸€ä¸‹è§„åˆ™ 3, å°±æœ‰ç‚¹ä¸ä¸€æ ·çš„æ„Ÿè§‰äº†.")]),s._v(" "),t("h6",{attrs:{id:"_3-ä¼ é€’æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¼ é€’æ€§"}},[s._v("#")]),s._v(" (3)ä¼ é€’æ€§")]),s._v(" "),t("p",[s._v("è¿™æ¡è§„åˆ™æ˜¯æŒ‡"),t("strong",[s._v("å¦‚æœ A Happens-Before B, ä¸” B Happens-Before C, é‚£ä¹ˆ A Happens-Before C")]),s._v(".")]),s._v(" "),t("p",[s._v("å°†è§„åˆ™ 3 çš„ä¼ é€’æ€§åº”ç”¨åˆ°ä¸Šé¢çš„ä¾‹å­ä¸­, ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢? å¯ä»¥çœ‹ä¸‹é¢çš„å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/23a76954d4683a18877e907d51017937-20230731162452-vxswniq.png",alt:"",title:"ç¤ºä¾‹ä»£ç ä¸­çš„ä¼ é€’æ€§è§„åˆ™"}})]),s._v(" "),t("p",[s._v("ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°:")]),s._v(" "),t("ol",[t("li",[s._v('"x=42" Happens-Before å†™å˜é‡ "v=true" , è¿™æ˜¯'),t("strong",[s._v("è§„åˆ™ 1")]),s._v(" çš„å†…å®¹;")]),s._v(" "),t("li",[s._v('å†™å˜é‡ "v=true" Happens-Before è¯»å˜é‡ "v=true", è¿™æ˜¯'),t("strong",[s._v("è§„åˆ™ 2")]),s._v(" çš„å†…å®¹ .")])]),s._v(" "),t("p",[s._v('å†æ ¹æ®è¿™ä¸ªä¼ é€’æ€§è§„åˆ™, å°±èƒ½å¾—åˆ°ç»“æœ: "x=42" Happens-Before è¯»å˜é‡ "v=true". è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢?')]),s._v(" "),t("p",[s._v("å¦‚æœ"),t("strong",[s._v('çº¿ç¨‹ B è¯»åˆ°äº† "v=true", é‚£ä¹ˆçº¿ç¨‹ A è®¾ç½®çš„ "x=42" å¯¹çº¿ç¨‹ B æ˜¯å¯è§çš„')]),s._v('. ä¹Ÿå°±æ˜¯è¯´, çº¿ç¨‹ B èƒ½çœ‹åˆ° "x == 42", æœ‰æ²¡æœ‰ä¸€ç§æç„¶å¤§æ‚Ÿçš„æ„Ÿè§‰? è¿™å°±æ˜¯ 1.5 ç‰ˆæœ¬å¯¹ volatile è¯­ä¹‰çš„å¢å¼º, '),t("strong",[s._v("è¿™ä¸ªå¢å¼ºæ„ä¹‰é‡å¤§, 1.5 ç‰ˆæœ¬çš„å¹¶å‘å·¥å…·åŒ…(java.util.concurrent)å°±æ˜¯é  volatile è¯­ä¹‰æ¥æå®šå¯è§æ€§çš„")]),s._v(", è¿™ä¸ªåœ¨åé¢ä¼šè¯¦ç»†ä»‹ç».")]),s._v(" "),t("h6",{attrs:{id:"_4-ç®¡ç¨‹ä¸­é”çš„è§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç®¡ç¨‹ä¸­é”çš„è§„åˆ™"}},[s._v("#")]),s._v(" (4)ç®¡ç¨‹ä¸­é”çš„è§„åˆ™")]),s._v(" "),t("p",[s._v("è¿™æ¡è§„åˆ™æ˜¯æŒ‡"),t("strong",[s._v("å¯¹ä¸€ä¸ªé”çš„è§£é” Happens-Before äºåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”")]),s._v(".")]),s._v(" "),t("p",[s._v('è¦ç†è§£è¿™ä¸ªè§„åˆ™, å°±é¦–å…ˆè¦äº†è§£ "ç®¡ç¨‹æŒ‡çš„æ˜¯ä»€ä¹ˆ". '),t("strong",[s._v("ç®¡ç¨‹")]),s._v("æ˜¯ä¸€ç§é€šç”¨çš„åŒæ­¥åŸè¯­, "),t("strong",[s._v("åœ¨ Java ä¸­æŒ‡çš„å°±æ˜¯ synchronized, synchronized æ˜¯ Java é‡Œå¯¹ç®¡ç¨‹çš„å®ç°")]),s._v(".")]),s._v(" "),t("p",[s._v("ç®¡ç¨‹ä¸­çš„é”åœ¨ Java é‡Œæ˜¯éšå¼å®ç°çš„, ä¾‹å¦‚ä¸‹é¢çš„ä»£ç , åœ¨è¿›å…¥åŒæ­¥å—ä¹‹å‰, ä¼šè‡ªåŠ¨åŠ é”, è€Œåœ¨ä»£ç å—æ‰§è¡Œå®Œä¼šè‡ªåŠ¨é‡Šæ”¾é”, åŠ é”ä»¥åŠé‡Šæ”¾é”éƒ½æ˜¯ç¼–è¯‘å™¨å®ç°çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤å¤„è‡ªåŠ¨åŠ é”")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// x æ˜¯å…±äº«å˜é‡, åˆå§‹å€¼ =10")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤å¤„è‡ªåŠ¨è§£é”")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("æ‰€ä»¥ç»“åˆè§„åˆ™ 4, å¯ä»¥è¿™æ ·ç†è§£: å‡è®¾ x çš„åˆå§‹å€¼æ˜¯ 10, çº¿ç¨‹ A æ‰§è¡Œå®Œä»£ç å—å x çš„å€¼ä¼šå˜æˆ 12(æ‰§è¡Œå®Œè‡ªåŠ¨é‡Šæ”¾é”), çº¿ç¨‹ B è¿›å…¥ä»£ç å—æ—¶, èƒ½å¤Ÿçœ‹åˆ°çº¿ç¨‹ A å¯¹ x çš„å†™æ“ä½œ, ä¹Ÿå°±æ˜¯çº¿ç¨‹ B èƒ½å¤Ÿçœ‹åˆ° x==12. è¿™ä¸ªä¹Ÿæ˜¯ç¬¦åˆç›´è§‰çš„, åº”è¯¥ä¸éš¾ç†è§£.")]),s._v(" "),t("h6",{attrs:{id:"_5-çº¿ç¨‹start-è§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-çº¿ç¨‹start-è§„åˆ™"}},[s._v("#")]),s._v(" (5)çº¿ç¨‹start()è§„åˆ™")]),s._v(" "),t("p",[s._v("è¿™æ¡æ˜¯å…³äºçº¿ç¨‹å¯åŠ¨çš„. å®ƒæ˜¯"),t("strong",[s._v("æŒ‡ä¸»çº¿ç¨‹ A å¯åŠ¨å­çº¿ç¨‹ B å, å­çº¿ç¨‹ B èƒ½å¤Ÿçœ‹åˆ°ä¸»çº¿ç¨‹åœ¨å¯åŠ¨å­çº¿ç¨‹ B å‰çš„æ“ä½œ")]),s._v(".  æ¢å¥è¯è¯´å°±æ˜¯, "),t("strong",[s._v("å¦‚æœçº¿ç¨‹ A è°ƒç”¨çº¿ç¨‹ B çš„ start() æ–¹æ³•(å³åœ¨çº¿ç¨‹ A ä¸­å¯åŠ¨çº¿ç¨‹ B), é‚£ä¹ˆè¯¥ start() æ“ä½œ Happens-Before äºçº¿ç¨‹ B ä¸­çš„ä»»æ„æ“ä½œ")]),s._v(". å…·ä½“å¯å‚è€ƒä¸‹é¢ç¤ºä¾‹ä»£ç .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸»çº¿ç¨‹è°ƒç”¨ B.start() ä¹‹å‰")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰€æœ‰å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹, æ­¤å¤„çš†å¯è§")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤ä¾‹ä¸­, var==77")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤å¤„å¯¹å…±äº«å˜é‡ var ä¿®æ”¹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸»çº¿ç¨‹å¯åŠ¨å­çº¿ç¨‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h6",{attrs:{id:"_6-çº¿ç¨‹join-è§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-çº¿ç¨‹join-è§„åˆ™"}},[s._v("#")]),s._v(" (6)çº¿ç¨‹join()è§„åˆ™")]),s._v(" "),t("p",[s._v("è¿™æ¡æ˜¯å…³äº"),t("strong",[s._v("çº¿ç¨‹ç­‰å¾…")]),s._v('çš„. å®ƒæ˜¯æŒ‡ä¸»çº¿ç¨‹ A ç­‰å¾…å­çº¿ç¨‹ B å®Œæˆ(ä¸»çº¿ç¨‹ A é€šè¿‡è°ƒç”¨å­çº¿ç¨‹ B çš„ join() æ–¹æ³•å®ç°), å½“å­çº¿ç¨‹ B å®Œæˆå(ä¸»çº¿ç¨‹ A ä¸­ join() æ–¹æ³•è¿”å›), ä¸»çº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°å­çº¿ç¨‹çš„æ“ä½œ. å½“ç„¶æ‰€è°“çš„ "çœ‹åˆ°", æŒ‡çš„æ˜¯å¯¹'),t("strong",[s._v("å…±äº«å˜é‡")]),s._v("çš„æ“ä½œ.")]),s._v(" "),t("p",[s._v("æ¢å¥è¯è¯´å°±æ˜¯, "),t("strong",[s._v("å¦‚æœåœ¨çº¿ç¨‹ A ä¸­, è°ƒç”¨çº¿ç¨‹ B çš„ join() å¹¶æˆåŠŸè¿”å›, é‚£ä¹ˆçº¿ç¨‹ B ä¸­çš„ä»»æ„æ“ä½œ Happens-Before äºè¯¥ join() æ“ä½œçš„è¿”å›")]),s._v(". å…·ä½“å¯å‚è€ƒä¸‹é¢ç¤ºä¾‹ä»£ç .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤å¤„å¯¹å…±äº«å˜é‡ var ä¿®æ”¹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¾‹å¦‚æ­¤å¤„å¯¹å…±äº«å˜é‡ä¿®æ”¹, ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ™è¿™ä¸ªä¿®æ”¹ç»“æœå¯¹çº¿ç¨‹ B å¯è§")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸»çº¿ç¨‹å¯åŠ¨å­çº¿ç¨‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å­çº¿ç¨‹æ‰€æœ‰å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ B.join() ä¹‹åçš†å¯è§")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤ä¾‹ä¸­, var==66")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h5",{attrs:{id:"è¢«å¿½è§†çš„final"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¢«å¿½è§†çš„final"}},[s._v("#")]),s._v(" è¢«å¿½è§†çš„final")]),s._v(" "),t("p",[s._v("å‰é¢è®² volatile ä¸ºçš„æ˜¯ç¦ç”¨ç¼“å­˜ä»¥åŠç¼–è¯‘ä¼˜åŒ–, ä¸‹é¢å†ä»å¦å¤–ä¸€ä¸ªæ–¹é¢æ¥çœ‹, æœ‰æ²¡æœ‰åŠæ³•å‘Šè¯‰ç¼–è¯‘å™¨ä¼˜åŒ–å¾—æ›´å¥½ä¸€ç‚¹å‘¢? è¿™ä¸ªå¯ä»¥æœ‰, å°±æ˜¯ "),t("strong",[s._v("final å…³é”®å­—")]),s._v(".")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("final ä¿®é¥°å˜é‡æ—¶, åˆè¡·æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨: è¿™ä¸ªå˜é‡ç”Ÿè€Œä¸å˜, å¯ä»¥ä½¿åŠ²å„¿ä¼˜åŒ–")])]),s._v("â€‹ "),t("strong",[s._v(".")]),s._v("  Java ç¼–è¯‘å™¨åœ¨ 1.5 ä»¥å‰çš„ç‰ˆæœ¬çš„ç¡®ä¼˜åŒ–å¾—å¾ˆåŠªåŠ›, ä»¥è‡³äºéƒ½ä¼˜åŒ–é”™äº†.")]),s._v(" "),t("p",[s._v('é—®é¢˜ç±»ä¼¼äºå‰é¢æåˆ°çš„åˆ©ç”¨åŒé‡æ£€æŸ¥æ–¹æ³•åˆ›å»ºå•ä¾‹, æ„é€ å‡½æ•°çš„é”™è¯¯é‡æ’å¯¼è‡´çº¿ç¨‹å¯èƒ½çœ‹åˆ° final å˜é‡çš„å€¼ä¼šå˜åŒ–.  åœ¨ 1.5 ä»¥å Java å†…å­˜æ¨¡å‹å¯¹ final ç±»å‹å˜é‡çš„é‡æ’è¿›è¡Œäº†çº¦æŸ. ç°åœ¨åªè¦æä¾›æ­£ç¡®æ„é€ å‡½æ•°æ²¡æœ‰ "é€¸å‡º", å°±ä¸ä¼šå‡ºé—®é¢˜äº†.')]),s._v(" "),t("p",[s._v('"é€¸å‡º" æœ‰ç‚¹æŠ½è±¡, è¿˜æ˜¯ä¸¾ä¸ªä¾‹å­, åœ¨ä¸‹é¢ä¾‹å­ä¸­, åœ¨æ„é€ å‡½æ•°é‡Œé¢å°† this èµ‹å€¼ç»™äº†å…¨å±€å˜é‡ global.obj, è¿™å°±æ˜¯ "é€¸å‡º", çº¿ç¨‹é€šè¿‡ global.obj è¯»å– x æ˜¯æœ‰å¯èƒ½è¯»åˆ° 0 çš„. å› æ­¤ä¸€å®šè¦é¿å… "é€¸å‡º".')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¥ä¸‹ä»£ç æ¥æºäºã€å‚è€ƒ 1ã€‘")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”™è¯¯çš„æ„é€ å‡½æ•°")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalFieldExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤å¤„å°±æ˜¯è®² this é€¸å‡º")]),s._v("\n    global"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-2"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Java çš„å†…å­˜æ¨¡å‹æ˜¯å¹¶å‘ç¼–ç¨‹é¢†åŸŸçš„ä¸€æ¬¡é‡è¦åˆ›æ–°, ä¹‹å C++, C#, Golang ç­‰é«˜çº§è¯­è¨€éƒ½å¼€å§‹æ”¯æŒå†…å­˜æ¨¡å‹. Java å†…å­˜æ¨¡å‹é‡Œé¢, æœ€æ™¦æ¶©çš„éƒ¨åˆ†å°±æ˜¯ Happens-Before è§„åˆ™äº†, Happens-Before è§„åˆ™æœ€åˆæ˜¯åœ¨ä¸€ç¯‡å«åš"),t("strong",[s._v("Time, Clocks, and the Ordering of Events in a Distributed System")]),s._v(" çš„è®ºæ–‡ä¸­æå‡ºæ¥çš„, åœ¨è¿™ç¯‡è®ºæ–‡ä¸­, Happens-Before çš„è¯­ä¹‰æ˜¯ä¸€ç§å› æœå…³ç³». åœ¨ç°å®ä¸–ç•Œé‡Œ, "),t("mark",[t("strong",[s._v("å¦‚æœ A äº‹ä»¶æ˜¯å¯¼è‡´ B äº‹ä»¶çš„èµ·å› , é‚£ä¹ˆ A äº‹ä»¶ä¸€å®šæ˜¯å…ˆäº(Happens-Before)B äº‹ä»¶å‘ç”Ÿçš„, è¿™ä¸ªå°±æ˜¯ Happens-Before è¯­ä¹‰çš„ç°å®ç†è§£")])]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ Java è¯­è¨€é‡Œé¢, "),t("strong",[s._v("Happens-Before çš„è¯­ä¹‰æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å¯è§æ€§, A Happens-Before B æ„å‘³ç€ A äº‹ä»¶å¯¹ B äº‹ä»¶æ¥è¯´æ˜¯å¯è§çš„, æ— è®º A äº‹ä»¶å’Œ B äº‹ä»¶æ˜¯å¦å‘ç”Ÿåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œ. ä¾‹å¦‚ A äº‹ä»¶å‘ç”Ÿåœ¨çº¿ç¨‹ 1 ä¸Š, B äº‹ä»¶å‘ç”Ÿåœ¨çº¿ç¨‹ 2 ä¸Š, Happens-Before è§„åˆ™ä¿è¯çº¿ç¨‹ 2 ä¸Šä¹Ÿèƒ½çœ‹åˆ° A äº‹ä»¶çš„å‘ç”Ÿ")]),s._v(".")]),s._v(" "),t("p",[s._v("Java å†…å­˜æ¨¡å‹ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†, ä¸€éƒ¨åˆ†é¢å‘ç¼–å†™å¹¶å‘ç¨‹åºçš„åº”ç”¨å¼€å‘äººå‘˜, å¦ä¸€éƒ¨åˆ†æ˜¯é¢å‘ JVM çš„å®ç°äººå‘˜çš„, ä¸€èˆ¬å¯ä»¥é‡ç‚¹å…³æ³¨å‰è€…, ä¹Ÿå°±æ˜¯å’Œç¼–å†™å¹¶å‘ç¨‹åºç›¸å…³çš„éƒ¨åˆ†, è¿™éƒ¨åˆ†å†…å®¹çš„æ ¸å¿ƒå°±æ˜¯ Happens-Before è§„åˆ™.")]),s._v(" "),t("h5",{attrs:{id:"å‚è€ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[s._v("#")]),s._v(" å‚è€ƒ")]),s._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("JSR 133 (Java Memory Model) FAQ"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://ifeve.com/jmm-faq/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Java å†…å­˜æ¨¡å‹ FAQ"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.cs.umd.edu/~pugh/java/memoryModel/jsr133.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("JSR-133: Java^(TM) Memory Model and Thread Specification"),t("OutboundLink")],1)])]),s._v(" "),t("h4",{attrs:{id:"_03-äº’æ–¥é”-ä¸Š-è§£å†³åŸå­æ€§é—®é¢˜ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_03-äº’æ–¥é”-ä¸Š-è§£å†³åŸå­æ€§é—®é¢˜ğŸ€"}},[s._v("#")]),s._v(" 03-äº’æ–¥é”(ä¸Š):è§£å†³åŸå­æ€§é—®é¢˜ğŸ€")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°, "),t("strong",[s._v('ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ“ä½œåœ¨ CPU æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸è¢«ä¸­æ–­çš„ç‰¹æ€§, ç§°ä¸º "åŸå­æ€§"')]),s._v(" . ç†è§£è¿™ä¸ªç‰¹æ€§æœ‰åŠ©äºåˆ†æå¹¶å‘ç¼–ç¨‹ Bug å‡ºç°çš„åŸå› , ä¾‹å¦‚åˆ©ç”¨å®ƒå¯ä»¥åˆ†æå‡º long å‹å˜é‡åœ¨ 32 ä½æœºå™¨ä¸Šè¯»å†™å¯èƒ½å‡ºç°çš„è¯¡å¼‚ Bug, æ˜æ˜å·²ç»æŠŠå˜é‡æˆåŠŸå†™å…¥å†…å­˜, é‡æ–°è¯»å‡ºæ¥å´ä¸æ˜¯è‡ªå·±å†™å…¥çš„.")]),s._v(" "),t("p",[s._v("**é‚£åŸå­æ€§é—®é¢˜åˆ°åº•è¯¥å¦‚ä½•è§£å†³å‘¢? **")]),s._v(" "),t("p",[s._v("åŸå­æ€§é—®é¢˜çš„æºå¤´æ˜¯"),t("strong",[s._v("çº¿ç¨‹åˆ‡æ¢")]),s._v(", å¦‚æœèƒ½å¤Ÿ"),t("strong",[s._v("ç¦ç”¨çº¿ç¨‹åˆ‡æ¢")]),s._v("é‚£ä¸å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜äº†å—? è€Œæ“ä½œç³»ç»Ÿåšçº¿ç¨‹åˆ‡æ¢æ˜¯ä¾èµ– CPU ä¸­æ–­çš„, æ‰€ä»¥"),t("strong",[s._v("ç¦æ­¢ CPU å‘ç”Ÿä¸­æ–­å°±èƒ½å¤Ÿç¦æ­¢çº¿ç¨‹åˆ‡æ¢")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨æ—©æœŸå•æ ¸ CPU æ—¶ä»£, è¿™ä¸ªæ–¹æ¡ˆçš„ç¡®æ˜¯å¯è¡Œçš„, è€Œä¸”ä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨æ¡ˆä¾‹, ä½†æ˜¯å¹¶ä¸é€‚åˆå¤šæ ¸åœºæ™¯. è¿™é‡Œä»¥ 32 ä½ CPU ä¸Šæ‰§è¡Œ long å‹å˜é‡çš„å†™æ“ä½œä¸ºä¾‹æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜, long å‹å˜é‡æ˜¯ 64 ä½, åœ¨ 32 ä½ CPU ä¸Šæ‰§è¡Œå†™æ“ä½œä¼šè¢«"),t("strong",[s._v("æ‹†åˆ†æˆä¸¤æ¬¡å†™æ“ä½œ")]),s._v("(å†™é«˜ 32 ä½å’Œå†™ä½ 32 ä½, å¦‚ä¸‹å›¾æ‰€ç¤º).")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/65c4982ab38a640f67f0ee4bceb8f14a-20230731162452-dvcz737.png",alt:""}})]),s._v(" "),t("p",[s._v("åœ¨å•æ ¸ CPU åœºæ™¯ä¸‹, åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ, ç¦æ­¢ CPU ä¸­æ–­, æ„å‘³ç€æ“ä½œç³»ç»Ÿä¸ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹, ä¹Ÿå°±æ˜¯ç¦æ­¢äº†çº¿ç¨‹åˆ‡æ¢, è·å¾— CPU ä½¿ç”¨æƒçš„çº¿ç¨‹å°±å¯ä»¥ä¸é—´æ–­åœ°æ‰§è¡Œ, æ‰€ä»¥ä¸¤æ¬¡å†™æ“ä½œä¸€å®šæ˜¯: è¦ä¹ˆéƒ½è¢«æ‰§è¡Œ, è¦ä¹ˆéƒ½æ²¡æœ‰è¢«æ‰§è¡Œ, å…·æœ‰åŸå­æ€§.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯"),t("strong",[s._v("åœ¨å¤šæ ¸åœºæ™¯")]),s._v("ä¸‹, åŒä¸€æ—¶åˆ», æœ‰å¯èƒ½æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åœ¨æ‰§è¡Œ, ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåœ¨ CPU-1 ä¸Š, ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåœ¨ CPU-2 ä¸Š, æ­¤æ—¶ç¦æ­¢ CPU ä¸­æ–­, "),t("strong",[s._v("åªèƒ½ä¿è¯ CPU ä¸Šçš„çº¿ç¨‹è¿ç»­æ‰§è¡Œ, å¹¶ä¸èƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ")]),s._v(", å¦‚æœè¿™ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å†™ long å‹å˜é‡é«˜ 32 ä½çš„è¯, é‚£å°±æœ‰å¯èƒ½å‡ºç°å¼€å¤´æåŠçš„è¯¡å¼‚ Bug äº†.")]),s._v(" "),t("p",[s._v('"'),t("strong",[s._v("åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ")]),s._v('" è¿™ä¸ªæ¡ä»¶éå¸¸é‡è¦, è¿™ç§°ä¸º'),t("strong",[s._v("äº’æ–¥")]),s._v(". å¦‚æœèƒ½å¤Ÿ"),t("strong",[s._v("ä¿è¯å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹æ˜¯äº’æ–¥")]),s._v("çš„, é‚£æ— è®ºæ˜¯å•æ ¸ CPU è¿˜æ˜¯å¤šæ ¸ CPU, å°±éƒ½èƒ½ä¿è¯"),t("strong",[s._v("åŸå­æ€§")]),s._v("äº†.")]),s._v(" "),t("h5",{attrs:{id:"ç®€æ˜“é”æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç®€æ˜“é”æ¨¡å‹"}},[s._v("#")]),s._v(" ç®€æ˜“é”æ¨¡å‹")]),s._v(" "),t("p",[s._v("å½“è°ˆåˆ°äº’æ–¥, ç›¸ä¿¡ä½ ä¸€å®šæƒ³åˆ°äº†é‚£ä¸ªæ€æ‰‹çº§è§£å†³æ–¹æ¡ˆ: "),t("strong",[s._v("é”")]),s._v(". åŒæ—¶å¤§è„‘ä¸­è¿˜ä¼šå‡ºç°ä»¥ä¸‹æ¨¡å‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c32f1f9b70962824332da0201d509193-20230731162452-sqb50su.png",alt:"",title:"ç®€æ˜“é”æ¨¡å‹"}})]),s._v(" "),t("p",[s._v("ä¸€æ®µ"),t("strong",[s._v("éœ€è¦äº’æ–¥æ‰§è¡Œçš„ä»£ç ")]),s._v("ä¸€èˆ¬ç§°ä¸º"),t("strong",[s._v("ä¸´ç•ŒåŒº")]),s._v(". çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰, é¦–å…ˆå°è¯•åŠ é” lock(), å¦‚æœæˆåŠŸ, åˆ™è¿›å…¥ä¸´ç•ŒåŒº, æ­¤æ—¶ç§°è¿™ä¸ªçº¿ç¨‹æŒæœ‰é”; å¦åˆ™å°±ç­‰å¾…, ç›´åˆ°æŒæœ‰é”çš„çº¿ç¨‹è§£é”; æŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œå®Œä¸´ç•ŒåŒºçš„ä»£ç å, æ‰§è¡Œè§£é” unlock().")]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹éå¸¸åƒåŠå…¬å®¤é‡Œé«˜å³°æœŸæŠ¢å å‘ä½, æ¯ä¸ªäººéƒ½æ˜¯è¿›å‘é”é—¨(åŠ é”), å‡ºå‘å¼€é—¨(è§£é”), å¦‚å•è¿™ä¸ªäº‹å°±æ˜¯ä¸´ç•ŒåŒº. å¾ˆé•¿æ—¶é—´é‡Œ, æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆç†è§£çš„. è¿™æ ·ç†è§£æœ¬èº«æ²¡æœ‰é—®é¢˜, ä½†å´å¾ˆå®¹æ˜“å¿½è§†ä¸¤ä¸ªéå¸¸éå¸¸é‡è¦çš„ç‚¹: "),t("strong",[s._v("æˆ‘ä»¬é”çš„æ˜¯ä»€ä¹ˆ? æˆ‘ä»¬ä¿æŠ¤çš„åˆæ˜¯ä»€ä¹ˆ?")])]),s._v(" "),t("h5",{attrs:{id:"æ”¹è¿›åçš„é”æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ”¹è¿›åçš„é”æ¨¡å‹"}},[s._v("#")]),s._v(" æ”¹è¿›åçš„é”æ¨¡å‹")]),s._v(" "),t("p",[s._v("åœ¨ç°å®ä¸–ç•Œé‡Œ, "),t("strong",[s._v("é”å’Œé”è¦ä¿æŠ¤çš„èµ„æºæ˜¯æœ‰å¯¹åº”å…³ç³»çš„")]),s._v(", æ¯”å¦‚ä½ ç”¨ä½ å®¶çš„é”ä¿æŠ¤ä½ å®¶çš„ä¸œè¥¿, æˆ‘ç”¨æˆ‘å®¶çš„é”ä¿æŠ¤æˆ‘å®¶çš„ä¸œè¥¿. åœ¨å¹¶å‘ç¼–ç¨‹ä¸–ç•Œé‡Œ, "),t("strong",[s._v("é”å’Œèµ„æº")]),s._v("ä¹Ÿåº”è¯¥æœ‰è¿™ä¸ªå…³ç³», ä½†è¿™ä¸ªå…³ç³»åœ¨ä¸Šé¢çš„æ¨¡å‹ä¸­æ˜¯æ²¡æœ‰ä½“ç°çš„, æ‰€ä»¥éœ€è¦å®Œå–„ä¸€ä¸‹è¿™ä¸ªæ¨¡å‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/670687e46d10a0192ea89ae11a1dd5d1-20230731162452-l6qzldz.png",alt:"",title:"æ”¹è¿›åçš„é”æ¨¡å‹"}})]),s._v(" "),t("p",[s._v("é¦–å…ˆ, "),t("strong",[s._v("è¦æŠŠä¸´ç•ŒåŒºè¦ä¿æŠ¤çš„èµ„æºæ ‡æ³¨å‡ºæ¥")]),s._v(", å¦‚å›¾ä¸­ä¸´ç•ŒåŒºé‡Œå¢åŠ äº†ä¸€ä¸ªå…ƒç´ : "),t("strong",[s._v("å—ä¿æŠ¤çš„èµ„æº R")]),s._v("; å…¶æ¬¡, "),t("strong",[s._v("è¦ä¿æŠ¤èµ„æº R å°±å¾—ä¸ºå®ƒåˆ›å»ºä¸€æŠŠé” LR")]),s._v("; æœ€å, "),t("strong",[s._v("é’ˆå¯¹è¿™æŠŠé” LR, è¿˜éœ€åœ¨è¿›å‡ºä¸´ç•ŒåŒºæ—¶æ·»ä¸ŠåŠ é”æ“ä½œå’Œè§£é”æ“ä½œ")]),s._v(". å¦å¤–, åœ¨é” LR å’Œå—ä¿æŠ¤èµ„æºä¹‹é—´, ç‰¹åœ°ç”¨ä¸€æ¡çº¿åšäº†å…³è”, è¿™ä¸ªå…³è”å…³ç³»éå¸¸é‡è¦. "),t("strong",[s._v("å¾ˆå¤šå¹¶å‘ Bug çš„å‡ºç°éƒ½æ˜¯å› ä¸ºæŠŠå®ƒå¿½ç•¥äº†, ç„¶åå°±å‡ºç°äº†ç±»ä¼¼é”è‡ªå®¶é—¨æ¥ä¿æŠ¤ä»–å®¶èµ„äº§çš„äº‹æƒ…")]),s._v(", è¿™æ ·çš„ Bug éå¸¸ä¸å¥½è¯Šæ–­, å› ä¸ºæ½œæ„è¯†é‡Œå¯èƒ½è®¤ä¸ºå·²ç»æ­£ç¡®åŠ é”äº†.")]),s._v(" "),t("h5",{attrs:{id:"java-è¯­è¨€æä¾›çš„é”æŠ€æœ¯-synchronized"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-è¯­è¨€æä¾›çš„é”æŠ€æœ¯-synchronized"}},[s._v("#")]),s._v(" Java è¯­è¨€æä¾›çš„é”æŠ€æœ¯:synchronized")]),s._v(" "),t("p",[s._v("é”æ˜¯ä¸€ç§é€šç”¨çš„æŠ€æœ¯æ–¹æ¡ˆ, Java è¯­è¨€æä¾›çš„ "),t("strong",[s._v("synchronized")]),s._v(" å…³é”®å­—, å°±æ˜¯é”çš„ä¸€ç§"),t("strong",[s._v("å®ç°")]),s._v(". synchronized å…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°æ–¹æ³•, ä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°ä»£ç å—, å®ƒçš„ä½¿ç”¨ç¤ºä¾‹åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("X")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿®é¥°éé™æ€æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸´ç•ŒåŒº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿®é¥°é™æ€æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸´ç•ŒåŒº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿®é¥°ä»£ç å—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("baz")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸´ç•ŒåŒº")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("çœ‹å®Œä¹‹åä½ å¯èƒ½ä¼šè§‰å¾—æœ‰ç‚¹å¥‡æ€ª, è¿™ä¸ªå’Œæˆ‘ä¸Šé¢æåˆ°çš„æ¨¡å‹æœ‰ç‚¹å¯¹ä¸ä¸Šå·å•Š, åŠ é” lock() å’Œè§£é” unlock() åœ¨å“ªé‡Œå‘¢? å…¶å®è¿™ä¸¤ä¸ªæ“ä½œéƒ½æ˜¯æœ‰çš„, åªæ˜¯"),t("strong",[s._v("è¿™ä¸¤ä¸ªæ“ä½œæ˜¯è¢« Java é»˜é»˜åŠ ä¸Šçš„, Java ç¼–è¯‘å™¨ä¼šåœ¨ synchronized ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—å‰åè‡ªåŠ¨åŠ ä¸ŠåŠ é” lock() å’Œè§£é” unlock()")]),s._v(" , è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯åŠ é” lock() å’Œè§£é” unlock() ä¸€å®šæ˜¯æˆå¯¹å‡ºç°çš„, æ¯•ç«Ÿå¿˜è®°è§£é” unlock() å¯æ˜¯ä¸ªè‡´å‘½çš„ Bug(æ„å‘³ç€å…¶ä»–çº¿ç¨‹åªèƒ½æ­»ç­‰ä¸‹å»äº†).")]),s._v(" "),t("p",[s._v("é‚£ synchronized é‡Œçš„åŠ é” lock() å’Œè§£é” unlock() "),t("strong",[s._v("é”å®šçš„å¯¹è±¡")]),s._v("åœ¨å“ªé‡Œå‘¢? ä¸Šé¢çš„ä»£ç åªæœ‰ä¿®é¥°ä»£ç å—çš„æ—¶å€™, é”å®šäº†ä¸€ä¸ª obj å¯¹è±¡, é‚£ä¿®é¥°æ–¹æ³•çš„æ—¶å€™é”å®šçš„æ˜¯ä»€ä¹ˆå‘¢? è¿™ä¸ªä¹Ÿæ˜¯ Java çš„ä¸€æ¡éšå¼è§„åˆ™:")]),s._v(" "),t("blockquote",[t("p",[s._v("å½“ä¿®é¥°é™æ€æ–¹æ³•çš„æ—¶å€™, é”å®šçš„æ˜¯å½“å‰ç±»çš„ Class å¯¹è±¡, åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å°±æ˜¯ Class X;\nå½“ä¿®é¥°éé™æ€æ–¹æ³•çš„æ—¶å€™, é”å®šçš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ this.")])]),s._v(" "),t("p",[s._v("å¯¹äºä¸Šé¢çš„ä¾‹å­, synchronized ä¿®é¥°é™æ€æ–¹æ³•ç›¸å½“äº:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("X")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿®é¥°é™æ€æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("X")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸´ç•ŒåŒº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä¿®é¥°éé™æ€æ–¹æ³•, ç›¸å½“äº:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("X")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿®é¥°éé™æ€æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸´ç•ŒåŒº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"ç”¨synchronizedè§£å†³count-1é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨synchronizedè§£å†³count-1é—®é¢˜"}},[s._v("#")]),s._v(" ç”¨synchronizedè§£å†³count+=1é—®é¢˜")]),s._v(" "),t("p",[s._v("å›æƒ³ä¸€ä¸‹æåˆ°è¿‡çš„ count+=1 å­˜åœ¨çš„å¹¶å‘é—®é¢˜, ç°åœ¨å¯ä»¥å°è¯•ç”¨ synchronized æ¥æ”¹ä¸€æ”¹, ä»£ç å¦‚ä¸‹æ‰€ç¤º. SafeCalc è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªæ–¹æ³•: ä¸€ä¸ªæ˜¯ get() æ–¹æ³•, ç”¨æ¥è·å¾— value çš„å€¼; å¦ä¸€ä¸ªæ˜¯ addOne() æ–¹æ³•, ç”¨æ¥ç»™ value åŠ  1, å¹¶ä¸” addOne() æ–¹æ³•ç”¨ synchronized ä¿®é¥°. é‚£ä¹ˆä½¿ç”¨çš„è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰æ²¡æœ‰å¹¶å‘é—®é¢˜å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeCalc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("å…ˆæ¥çœ‹çœ‹ addOne() æ–¹æ³•, é¦–å…ˆå¯ä»¥è‚¯å®š, è¢« synchronized ä¿®é¥°å, æ— è®ºæ˜¯å•æ ¸ CPU è¿˜æ˜¯å¤šæ ¸ CPU, åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œ addOne() æ–¹æ³•, æ‰€ä»¥ä¸€å®šèƒ½ä¿è¯åŸå­æ“ä½œ, é‚£"),t("strong",[s._v("æ˜¯å¦æœ‰å¯è§æ€§é—®é¢˜")]),s._v("å‘¢? è¦å›ç­”è¿™é—®é¢˜, å°±è¦é‡æ¸©ä¸€ä¸‹ä¸Šä¸€èŠ‚æåˆ°çš„"),t("strong",[s._v("ç®¡ç¨‹ä¸­é”çš„è§„åˆ™")]),s._v(".")]),s._v(" "),t("blockquote",[t("p",[s._v("ç®¡ç¨‹ä¸­é”çš„è§„åˆ™: å¯¹ä¸€ä¸ªé”çš„è§£é” Happens-Before äºåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”.")])]),s._v(" "),t("p",[t("strong",[s._v("ç®¡ç¨‹, å°±æ˜¯è¿™é‡Œçš„ synchronized")]),s._v("(è‡³äºä¸ºä»€ä¹ˆå«ç®¡ç¨‹, åé¢ä¼šä»‹ç»), synchronized ä¿®é¥°çš„ä¸´ç•ŒåŒºæ˜¯"),t("strong",[s._v("äº’æ–¥")]),s._v('çš„, ä¹Ÿå°±æ˜¯è¯´åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºçš„ä»£ç ; è€Œæ‰€è°“ "å¯¹ä¸€ä¸ªé”è§£é” Happens-Before åç»­å¯¹è¿™ä¸ªé”çš„åŠ é”", æŒ‡çš„æ˜¯**å‰ä¸€ä¸ªçº¿ç¨‹çš„è§£é”æ“ä½œå¯¹åä¸€ä¸ªçº¿ç¨‹çš„åŠ é”æ“ä½œå¯è§, ç»¼åˆ Happens-Before çš„ä¼ é€’æ€§åŸåˆ™, å°±èƒ½çŸ¥é“å‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºä¿®æ”¹çš„å…±äº«å˜é‡(è¯¥æ“ä½œåœ¨è§£é”ä¹‹å‰), å¯¹åç»­è¿›å…¥ä¸´ç•ŒåŒº(è¯¥æ“ä½œåœ¨åŠ é”ä¹‹å)çš„çº¿ç¨‹æ˜¯å¯è§çš„. æ‰€ä»¥, è¿™é‡Œå¯è§æ€§é—®é¢˜å°±å·²ç»è§£å†³äº†. **')]),s._v(" "),t("p",[s._v("æŒ‰ç…§è¿™ä¸ªè§„åˆ™, å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ addOne() æ–¹æ³•, "),t("strong",[s._v("å¯è§æ€§æ˜¯å¯ä»¥ä¿è¯")]),s._v("çš„, ä¹Ÿå°±è¯´å¦‚æœæœ‰ 1000 ä¸ªçº¿ç¨‹æ‰§è¡Œ addOne() æ–¹æ³•, æœ€ç»ˆç»“æœä¸€å®šæ˜¯ value çš„å€¼å¢åŠ äº† 1000. é—®é¢˜ç»ˆäºè§£å†³äº†!")]),s._v(" "),t("p",[s._v("ä½†ä¹Ÿè®¸, ä½ ä¸€ä¸å°å¿ƒå°±å¿½è§†äº† get() æ–¹æ³•. æ‰§è¡Œ addOne() æ–¹æ³•å, value çš„å€¼å¯¹ get() æ–¹æ³•æ˜¯å¯è§çš„å—? è¿™ä¸ªå¯è§æ€§æ˜¯"),t("strong",[s._v("æ²¡æ³•ä¿è¯")]),s._v("çš„. "),t("strong",[s._v("ç®¡ç¨‹ä¸­é”çš„è§„åˆ™, æ˜¯åªä¿è¯åç»­å¯¹è¿™ä¸ªé”çš„åŠ é”çš„å¯è§æ€§")]),s._v(", è€Œ get() æ–¹æ³•å¹¶æ²¡æœ‰åŠ é”æ“ä½œ, æ‰€ä»¥å¯è§æ€§æ²¡æ³•ä¿è¯. é‚£å¦‚ä½•è§£å†³å‘¢? å¾ˆç®€å•, å°±æ˜¯ get() æ–¹æ³•ä¹Ÿ synchronized ä¸€ä¸‹, å®Œæ•´çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeCalc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä»£ç è½¬æ¢ä¸ºæåˆ°çš„é”æ¨¡å‹, å°±æ˜¯ä¸‹å›¾è¿™æ ·. get() æ–¹æ³•å’Œ addOne() æ–¹æ³•éƒ½éœ€è¦è®¿é—® value è¿™ä¸ªå—ä¿æŠ¤çš„èµ„æº, è¿™ä¸ªèµ„æº"),t("strong",[s._v("ç”¨ this è¿™æŠŠé”")]),s._v("æ¥ä¿æŠ¤. çº¿ç¨‹è¦è¿›å…¥ä¸´ç•ŒåŒº get() å’Œ addOne(), å¿…é¡»å…ˆè·å¾— this è¿™æŠŠé”, è¿™æ · get() å’Œ addOne() ä¹Ÿæ˜¯äº’æ–¥çš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1968c7229a80d117d55346f1ad6fb8fe-20230731162452-9sc3zn2.png",alt:"",title:"ä¿æŠ¤ä¸´ç•ŒåŒº get() å’Œ addOne() çš„ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v('è¿™ä¸ªæ¨¡å‹æ›´åƒç°å®ä¸–ç•Œé‡Œé¢çƒèµ›é—¨ç¥¨çš„ç®¡ç†, ä¸€ä¸ªåº§ä½åªå…è®¸ä¸€ä¸ªäººä½¿ç”¨, è¿™ä¸ªåº§ä½å°±æ˜¯ "å—ä¿æŠ¤èµ„æº", çƒåœºçš„å…¥å£å°±æ˜¯ Java ç±»é‡Œçš„æ–¹æ³•, è€Œé—¨ç¥¨å°±æ˜¯ç”¨æ¥ä¿æŠ¤èµ„æºçš„ "é”", Java é‡Œçš„æ£€ç¥¨å·¥ä½œæ˜¯ç”± synchronized è§£å†³çš„.')]),s._v(" "),t("h5",{attrs:{id:"é”å’Œå—ä¿æŠ¤èµ„æºçš„å…³ç³»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é”å’Œå—ä¿æŠ¤èµ„æºçš„å…³ç³»"}},[s._v("#")]),s._v(" é”å’Œå—ä¿æŠ¤èµ„æºçš„å…³ç³»")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°, å—ä¿æŠ¤èµ„æºå’Œé”ä¹‹é—´çš„å…³è”å…³ç³»éå¸¸é‡è¦, ä»–ä»¬çš„å…³ç³»æ˜¯æ€æ ·çš„å‘¢? ä¸€ä¸ªåˆç†çš„å…³ç³»æ˜¯: "),t("mark",[t("strong",[s._v("å—ä¿æŠ¤èµ„æºå’Œé”ä¹‹é—´çš„å…³è”å…³ç³»æ˜¯ N:1 çš„å…³ç³»")])]),s._v('. è¿˜æ‹¿å‰é¢çƒèµ›é—¨ç¥¨çš„ç®¡ç†æ¥ç±»æ¯”, å°±æ˜¯ä¸€ä¸ªåº§ä½, åªèƒ½ç”¨ä¸€å¼ ç¥¨æ¥ä¿æŠ¤, å¦‚æœå¤šå‘äº†é‡å¤çš„ç¥¨, é‚£å°±è¦æ‰“æ¶äº†. ç°å®ä¸–ç•Œé‡Œ, å¯ä»¥ç”¨å¤šæŠŠé”æ¥ä¿æŠ¤åŒä¸€ä¸ªèµ„æº, ä½†åœ¨å¹¶å‘é¢†åŸŸæ˜¯ä¸è¡Œçš„, å¹¶å‘é¢†åŸŸçš„é”å’Œç°å®ä¸–ç•Œçš„é”ä¸æ˜¯å®Œå…¨åŒ¹é…çš„. ä¸è¿‡å€’æ˜¯å¯ä»¥ç”¨åŒä¸€æŠŠé”æ¥ä¿æŠ¤å¤šä¸ªèµ„æº, è¿™ä¸ªå¯¹åº”åˆ°ç°å®ä¸–ç•Œå°±æ˜¯æ‰€è°“çš„ "åŒ…åœº" äº†.')]),s._v(" "),t("p",[s._v("ä¸Šé¢é‚£ä¸ªä¾‹å­ç¨ä½œæ”¹åŠ¨, æŠŠ value æ”¹æˆé™æ€å˜é‡, æŠŠ addOne() æ–¹æ³•æ”¹æˆé™æ€æ–¹æ³•, æ­¤æ—¶ get() æ–¹æ³•å’Œ addOne() æ–¹æ³•æ˜¯å¦å­˜åœ¨å¹¶å‘é—®é¢˜å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeCalc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("å¦‚æœä»”ç»†è§‚å¯Ÿ, å°±ä¼šå‘ç°æ”¹åŠ¨åçš„ä»£ç æ˜¯"),t("strong",[s._v("ç”¨ä¸¤ä¸ªé”ä¿æŠ¤ä¸€ä¸ªèµ„æº")]),s._v(". è¿™ä¸ªå—ä¿æŠ¤çš„èµ„æºå°±æ˜¯é™æ€å˜é‡ value, ä¸¤ä¸ªé”åˆ†åˆ«æ˜¯ this å’Œ SafeCalc.class. å¯ä»¥ç”¨ä¸‹é¢è¿™å¹…å›¾æ¥å½¢è±¡æè¿°è¿™ä¸ªå…³ç³». "),t("strong",[s._v("ç”±äºä¸´ç•ŒåŒº get() å’Œ addOne() æ˜¯ç”¨ä¸¤ä¸ªé”ä¿æŠ¤çš„, å› æ­¤è¿™ä¸¤ä¸ªä¸´ç•ŒåŒºæ²¡æœ‰äº’æ–¥å…³ç³», ä¸´ç•ŒåŒº addOne() å¯¹ value çš„ä¿®æ”¹å¯¹ä¸´ç•ŒåŒº get() ä¹Ÿæ²¡æœ‰å¯è§æ€§ä¿è¯, è¿™å°±å¯¼è‡´å¹¶å‘é—®é¢˜äº†")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a160200b55c66e18fcd9c27fbccfeb1c-20230731162452-sm76891.png",alt:"",title:"ä¸¤æŠŠé”ä¿æŠ¤ä¸€ä¸ªèµ„æºçš„ç¤ºæ„å›¾"}})]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-3"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("äº’æ–¥é”, åœ¨å¹¶å‘é¢†åŸŸçš„çŸ¥ååº¦æé«˜, åªè¦æœ‰äº†å¹¶å‘é—®é¢˜, å¤§å®¶é¦–å…ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯åŠ é”, å› ä¸ºå¤§å®¶éƒ½çŸ¥é“, åŠ é”èƒ½å¤Ÿä¿è¯æ‰§è¡Œä¸´ç•ŒåŒºä»£ç çš„äº’æ–¥æ€§. è¿™æ ·ç†è§£è™½ç„¶æ­£ç¡®, ä½†æ˜¯å´ä¸èƒ½å¤ŸæŒ‡å¯¼ä½ çœŸæ­£ç”¨å¥½äº’æ–¥é”. ä¸´ç•ŒåŒºçš„ä»£ç æ˜¯æ“ä½œå—ä¿æŠ¤èµ„æºçš„è·¯å¾„, ç±»ä¼¼äºçƒåœºçš„å…¥å£, å…¥å£ä¸€å®šè¦æ£€ç¥¨, ä¹Ÿå°±æ˜¯è¦åŠ é”, ä½†ä¸æ˜¯éšä¾¿ä¸€æŠŠé”éƒ½èƒ½æœ‰æ•ˆ. æ‰€ä»¥"),t("strong",[s._v("å¿…é¡»æ·±å…¥åˆ†æé”å®šçš„å¯¹è±¡å’Œå—ä¿æŠ¤èµ„æºçš„å…³ç³», ç»¼åˆè€ƒè™‘å—ä¿æŠ¤èµ„æºçš„è®¿é—®è·¯å¾„, å¤šæ–¹é¢è€ƒé‡æ‰èƒ½ç”¨å¥½äº’æ–¥é”")]),s._v(".")]),s._v(" "),t("p",[s._v("synchronized æ˜¯ Java åœ¨è¯­è¨€å±‚é¢æä¾›çš„äº’æ–¥åŸè¯­, å…¶å® Java é‡Œé¢è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç±»å‹çš„é”, ä½†ä½œä¸ºäº’æ–¥é”, åŸç†éƒ½æ˜¯ç›¸é€šçš„: é”, ä¸€å®šæœ‰ä¸€ä¸ªè¦é”å®šçš„å¯¹è±¡, è‡³äºè¿™ä¸ªé”å®šçš„å¯¹è±¡è¦ä¿æŠ¤çš„èµ„æºä»¥åŠåœ¨å“ªé‡ŒåŠ é”/è§£é”, å°±å±äºè®¾è®¡å±‚é¢çš„äº‹æƒ…äº†.")]),s._v(" "),t("h4",{attrs:{id:"_04-äº’æ–¥é”-ä¸‹-å¦‚ä½•ç”¨ä¸€æŠŠé”ä¿æŠ¤å¤šä¸ªèµ„æº-ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_04-äº’æ–¥é”-ä¸‹-å¦‚ä½•ç”¨ä¸€æŠŠé”ä¿æŠ¤å¤šä¸ªèµ„æº-ğŸ€"}},[s._v("#")]),s._v(" 04-äº’æ–¥é”(ä¸‹):å¦‚ä½•ç”¨ä¸€æŠŠé”ä¿æŠ¤å¤šä¸ªèµ„æº?ğŸ€")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚æåˆ°"),t("strong",[s._v("å—ä¿æŠ¤èµ„æºå’Œé”ä¹‹é—´åˆç†çš„å…³è”å…³ç³»åº”è¯¥æ˜¯ N:1 çš„å…³ç³»")]),s._v(', ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨ä¸€æŠŠé”æ¥ä¿æŠ¤å¤šä¸ªèµ„æº, ä½†æ˜¯ä¸èƒ½ç”¨å¤šæŠŠé”æ¥ä¿æŠ¤ä¸€ä¸ªèµ„æº, å¹¶ä¸”ä¹Ÿé‡ç‚¹å¼ºè°ƒäº† "ä¸èƒ½ç”¨å¤šæŠŠé”æ¥ä¿æŠ¤ä¸€ä¸ªèµ„æº" è¿™ä¸ªé—®é¢˜. è€Œè‡³äº'),t("strong",[s._v("å¦‚ä½•ä¿æŠ¤å¤šä¸ªèµ„æº")]),s._v(", ä»Šå¤©å°±æ¥èŠèŠ. å½“è¦ä¿æŠ¤å¤šä¸ªèµ„æºæ—¶, "),t("strong",[s._v("é¦–å…ˆè¦åŒºåˆ†è¿™äº›èµ„æºæ˜¯å¦å­˜åœ¨å…³è”å…³ç³»")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ä¿æŠ¤æ²¡æœ‰å…³è”å…³ç³»çš„å¤šä¸ªèµ„æº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¿æŠ¤æ²¡æœ‰å…³è”å…³ç³»çš„å¤šä¸ªèµ„æº"}},[s._v("#")]),s._v(" ä¿æŠ¤æ²¡æœ‰å…³è”å…³ç³»çš„å¤šä¸ªèµ„æº")]),s._v(" "),t("p",[s._v("åœ¨ç°å®ä¸–ç•Œé‡Œ, çƒåœºçš„åº§ä½å’Œç”µå½±é™¢çš„åº§ä½å°±æ˜¯æ²¡æœ‰å…³è”å…³ç³»çš„, è¿™ç§åœºæ™¯éå¸¸å®¹æ˜“è§£å†³, é‚£å°±æ˜¯çƒèµ›æœ‰çƒèµ›çš„é—¨ç¥¨, ç”µå½±é™¢æœ‰ç”µå½±é™¢çš„é—¨ç¥¨, å„è‡ªç®¡ç†å„è‡ªçš„.")]),s._v(" "),t("p",[s._v("åŒæ ·è¿™å¯¹åº”åˆ°ç¼–ç¨‹é¢†åŸŸ, ä¹Ÿå¾ˆå®¹æ˜“è§£å†³. ä¾‹å¦‚, é“¶è¡Œä¸šåŠ¡ä¸­æœ‰é’ˆå¯¹è´¦æˆ·ä½™é¢(ä½™é¢æ˜¯ä¸€ç§èµ„æº)çš„å–æ¬¾æ“ä½œ, ä¹Ÿæœ‰é’ˆå¯¹è´¦æˆ·å¯†ç (å¯†ç ä¹Ÿæ˜¯ä¸€ç§èµ„æº)çš„æ›´æ”¹æ“ä½œ, å¯ä»¥ä¸ºè´¦æˆ·ä½™é¢å’Œè´¦æˆ·å¯†ç åˆ†é…ä¸åŒçš„é”æ¥è§£å†³å¹¶å‘é—®é¢˜, è¿™ä¸ªè¿˜æ˜¯å¾ˆç®€å•çš„.")]),s._v(" "),t("p",[s._v("ç›¸å…³çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹, è´¦æˆ·ç±» Account æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡, åˆ†åˆ«æ˜¯è´¦æˆ·ä½™é¢ balance å’Œè´¦æˆ·å¯†ç  password. å–æ¬¾ withdraw() å’ŒæŸ¥çœ‹ä½™é¢ getBalance() æ“ä½œä¼šè®¿é—®è´¦æˆ·ä½™é¢ balance, æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª final å¯¹è±¡ "),t("strong",[s._v("balLock")]),s._v(" ä½œä¸ºé”(ç±»æ¯”çƒèµ›é—¨ç¥¨); è€Œæ›´æ”¹å¯†ç  updatePassword() å’ŒæŸ¥çœ‹å¯†ç  getPassword() æ“ä½œä¼šä¿®æ”¹è´¦æˆ·å¯†ç  password, æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª final å¯¹è±¡ "),t("strong",[s._v("pwLock")]),s._v(" ä½œä¸ºé”(ç±»æ¯”ç”µå½±ç¥¨). ä¸åŒçš„èµ„æºç”¨ä¸åŒçš„é”ä¿æŠ¤, å„è‡ªç®¡å„è‡ªçš„, å¾ˆç®€å•.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”: ä¿æŠ¤è´¦æˆ·ä½™é¢")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" balLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è´¦æˆ·ä½™é¢  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”: ä¿æŠ¤è´¦æˆ·å¯†ç ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" pwLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è´¦æˆ·å¯†ç ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å–æ¬¾")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("withdraw")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("balLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥çœ‹ä½™é¢")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBalance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("balLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ›´æ”¹å¯†ç ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("updatePassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" pw"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pwLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pw"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥çœ‹å¯†ç ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pwLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("p",[s._v("å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸€æŠŠäº’æ–¥é”æ¥ä¿æŠ¤å¤šä¸ªèµ„æº, ä¾‹å¦‚å¯ä»¥ç”¨ this è¿™ä¸€æŠŠé”æ¥ç®¡ç†è´¦æˆ·ç±»é‡Œ"),t("strong",[s._v("æ‰€æœ‰çš„èµ„æº")]),s._v(": è´¦æˆ·ä½™é¢å’Œç”¨æˆ·å¯†ç . å…·ä½“å®ç°å¾ˆç®€å•, ç¤ºä¾‹ç¨‹åºä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½å¢åŠ åŒæ­¥å…³é”®å­— synchronized å°±å¯ä»¥äº†, è¿™é‡Œå°±ä¸ä¸€ä¸€å±•ç¤ºäº†.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯"),t("strong",[s._v("ç”¨ä¸€æŠŠé”æœ‰ä¸ªé—®é¢˜, å°±æ˜¯æ€§èƒ½å¤ªå·®")]),s._v(", ä¼šå¯¼è‡´å–æ¬¾, æŸ¥çœ‹ä½™é¢, ä¿®æ”¹å¯†ç , æŸ¥çœ‹å¯†ç è¿™å››ä¸ªæ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„. è€Œç”¨ä¸¤æŠŠé”, å–æ¬¾å’Œä¿®æ”¹å¯†ç æ˜¯å¯ä»¥å¹¶è¡Œçš„. "),t("strong",[s._v("ç”¨ä¸åŒçš„é”å¯¹å—ä¿æŠ¤èµ„æºè¿›è¡Œç²¾ç»†åŒ–ç®¡ç†, èƒ½å¤Ÿæå‡æ€§èƒ½")]),s._v(". è¿™ç§é”è¿˜æœ‰ä¸ªåå­—, å«"),t("strong",[s._v("ç»†ç²’åº¦é”")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ä¿æŠ¤æœ‰å…³è”å…³ç³»çš„å¤šä¸ªèµ„æº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¿æŠ¤æœ‰å…³è”å…³ç³»çš„å¤šä¸ªèµ„æº"}},[s._v("#")]),s._v(" ä¿æŠ¤æœ‰å…³è”å…³ç³»çš„å¤šä¸ªèµ„æº")]),s._v(" "),t("p",[s._v("å¦‚æœå¤šä¸ªèµ„æºæ˜¯"),t("strong",[s._v("æœ‰å…³è”å…³ç³»")]),s._v("çš„, é‚£è¿™ä¸ªé—®é¢˜å°±æœ‰ç‚¹å¤æ‚äº†. ä¾‹å¦‚é“¶è¡Œä¸šåŠ¡é‡Œé¢çš„è½¬è´¦æ“ä½œ, è´¦æˆ· A å‡å°‘ 100 å…ƒ, è´¦æˆ· B å¢åŠ  100 å…ƒ. è¿™ä¸¤ä¸ªè´¦æˆ·å°±æ˜¯æœ‰å…³è”å…³ç³»çš„. é‚£å¯¹äºåƒè½¬è´¦è¿™ç§æœ‰å…³è”å…³ç³»çš„æ“ä½œ, åº”è¯¥æ€ä¹ˆå»è§£å†³å‘¢? å…ˆæŠŠè¿™ä¸ªé—®é¢˜ä»£ç åŒ–. å…ˆå£°æ˜ä¸€ä¸ªè´¦æˆ·ç±»: Account, è¯¥ç±»æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ä½™é¢: balance, è¿˜æœ‰ä¸€ä¸ªç”¨äºè½¬è´¦çš„æ–¹æ³•: transfer(), ç„¶åæ€ä¹ˆä¿è¯è½¬è´¦æ“ä½œ transfer() æ²¡æœ‰å¹¶å‘é—®é¢˜å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("ç›¸ä¿¡ä½ çš„ç›´è§‰ä¼šå‘Šè¯‰ä½ è¿™æ ·çš„è§£å†³æ–¹æ¡ˆ: ç”¨æˆ· synchronized å…³é”®å­—ä¿®é¥°ä¸€ä¸‹ transfer() æ–¹æ³•å°±å¯ä»¥äº†, äºæ˜¯ä½ å¾ˆå¿«å°±å®Œæˆäº†ç›¸å…³çš„ä»£ç , å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("åœ¨è¿™æ®µä»£ç ä¸­, "),t("strong",[s._v("ä¸´ç•ŒåŒºå†…æœ‰ä¸¤ä¸ªèµ„æº")]),s._v(", åˆ†åˆ«æ˜¯è½¬å‡ºè´¦æˆ·çš„ä½™é¢ this.balance å’Œè½¬å…¥è´¦æˆ·çš„ä½™é¢ target.balance, å¹¶ä¸”ç”¨çš„æ˜¯ä¸€æŠŠé” this, ç¬¦åˆå‰é¢æåˆ°çš„, å¤šä¸ªèµ„æºå¯ä»¥ç”¨ä¸€æŠŠé”æ¥ä¿æŠ¤, è¿™çœ‹ä¸Šå»å®Œå…¨æ­£ç¡®å‘€. çœŸçš„æ˜¯è¿™æ ·å—? å¯æƒœ, è¿™ä¸ªæ–¹æ¡ˆä»…ä»…æ˜¯çœ‹ä¼¼æ­£ç¡®, ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("é—®é¢˜å°±å‡ºåœ¨ this è¿™æŠŠé”ä¸Š, "),t("strong",[s._v("this è¿™æŠŠé”å¯ä»¥ä¿æŠ¤è‡ªå·±çš„ä½™é¢ this.balance, å´ä¿æŠ¤ä¸äº†åˆ«äººçš„ä½™é¢ target.balance")]),s._v(", å°±åƒä½ ä¸èƒ½ç”¨è‡ªå®¶çš„é”æ¥ä¿æŠ¤åˆ«äººå®¶çš„èµ„äº§, ä¹Ÿä¸èƒ½ç”¨è‡ªå·±çš„ç¥¨æ¥ä¿æŠ¤åˆ«äººçš„åº§ä½ä¸€æ ·.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0fbd63fec759e409f45ca4982f82a014-20230731162452-daob240.png",alt:"",title:"ç”¨é” this ä¿æŠ¤ this.balance å’Œ target.balance çš„ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢å…·ä½“åˆ†æä¸€ä¸‹, å‡è®¾æœ‰ A, B, C ä¸‰ä¸ªè´¦æˆ·, ä½™é¢éƒ½æ˜¯ 200 å…ƒ, ç”¨ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œä¸¤ä¸ªè½¬è´¦æ“ä½œ: è´¦æˆ· A è½¬ç»™è´¦æˆ· B 100 å…ƒ, è´¦æˆ· B è½¬ç»™è´¦æˆ· C 100 å…ƒ, æœ€åæœŸæœ›çš„ç»“æœåº”è¯¥æ˜¯è´¦æˆ· A çš„ä½™é¢æ˜¯ 100 å…ƒ, è´¦æˆ· B çš„ä½™é¢æ˜¯ 200 å…ƒ,  è´¦æˆ· C çš„ä½™é¢æ˜¯ 300 å…ƒ.")]),s._v(" "),t("p",[s._v("å‡è®¾çº¿ç¨‹ 1 æ‰§è¡Œè´¦æˆ· A è½¬è´¦æˆ· B çš„æ“ä½œ, çº¿ç¨‹ 2 æ‰§è¡Œè´¦æˆ· B è½¬è´¦æˆ· C çš„æ“ä½œ. è¿™ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«"),t("strong",[s._v("åœ¨ä¸¤é¢— CPU ä¸ŠåŒæ—¶æ‰§è¡Œ")]),s._v(", é‚£å®ƒä»¬æ˜¯äº’æ–¥çš„å—? "),t("strong",[s._v("å®é™…ä¸Šå¹¶ä¸æ˜¯. å› ä¸ºçº¿ç¨‹ 1 é”å®šçš„æ˜¯è´¦æˆ· A çš„å®ä¾‹(A.this), è€Œçº¿ç¨‹ 2 é”å®šçš„æ˜¯è´¦æˆ· B çš„å®ä¾‹(B.this), æ‰€ä»¥è¿™ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒº transfer()")]),s._v(" . åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºçš„ç»“æœæ˜¯ä»€ä¹ˆå‘¢? çº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 éƒ½ä¼šè¯»åˆ°è´¦æˆ· B çš„ä½™é¢ä¸º 200, å¯¼è‡´æœ€ç»ˆè´¦æˆ· B çš„ä½™é¢å¯èƒ½æ˜¯ 300(çº¿ç¨‹ 1 åäºçº¿ç¨‹ 2 å†™ B.balance, çº¿ç¨‹ 2 å†™çš„ B.balance å€¼è¢«çº¿ç¨‹ 1 è¦†ç›–), å¯èƒ½æ˜¯ 100(çº¿ç¨‹ 1 å…ˆäºçº¿ç¨‹ 2 å†™ B.balance, çº¿ç¨‹ 1 å†™çš„ B.balance å€¼è¢«çº¿ç¨‹ 2 è¦†ç›–), å°±æ˜¯ä¸å¯èƒ½æ˜¯ 200.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/647b7a28f42f45d85b236588f66b3f98-20230731162452-58pr1ra.png",alt:"",title:"å¹¶å‘è½¬è´¦ç¤ºæ„å›¾"}})]),s._v(" "),t("h5",{attrs:{id:"ä½¿ç”¨é”çš„æ­£ç¡®å§¿åŠ¿"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨é”çš„æ­£ç¡®å§¿åŠ¿"}},[s._v("#")]),s._v(" ä½¿ç”¨é”çš„æ­£ç¡®å§¿åŠ¿")]),s._v(" "),t("p",[s._v('åœ¨ä¸Šä¸€èŠ‚æåˆ°ç”¨åŒä¸€æŠŠé”æ¥ä¿æŠ¤å¤šä¸ªèµ„æº, ä¹Ÿå°±æ˜¯ç°å®ä¸–ç•Œçš„ "åŒ…åœº", é‚£åœ¨ç¼–ç¨‹é¢†åŸŸåº”è¯¥æ€ä¹ˆ "åŒ…åœº" å‘¢? å¾ˆç®€å•, åªè¦'),t("strong",[s._v("é”èƒ½è¦†ç›–æ‰€æœ‰å—ä¿æŠ¤èµ„æº")]),s._v("å°±å¯ä»¥äº†. åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, "),t("strong",[s._v("this æ˜¯å¯¹è±¡çº§åˆ«çš„é”, æ‰€ä»¥ A å¯¹è±¡å’Œ B å¯¹è±¡éƒ½æœ‰è‡ªå·±çš„é”, å¦‚ä½•è®© A å¯¹è±¡å’Œ B å¯¹è±¡å…±äº«ä¸€æŠŠé”å‘¢")]),s._v("?")]),s._v(" "),t("p",[s._v("å…¶å®æ–¹æ¡ˆè¿˜æŒºå¤šçš„, "),t("strong",[s._v("æ¯”å¦‚å¯ä»¥è®©æ‰€æœ‰å¯¹è±¡éƒ½æŒæœ‰ä¸€ä¸ªå”¯ä¸€æ€§çš„å¯¹è±¡")]),s._v(", è¿™ä¸ªå¯¹è±¡åœ¨åˆ›å»º Account æ—¶ä¼ å…¥. æ–¹æ¡ˆæœ‰äº†, å®Œæˆä»£ç å°±ç®€å•äº†. ç¤ºä¾‹ä»£ç å¦‚ä¸‹, æŠŠ Account é»˜è®¤æ„é€ å‡½æ•°å˜ä¸º private, åŒæ—¶å¢åŠ ä¸€ä¸ªå¸¦ Object lock å‚æ•°çš„æ„é€ å‡½æ•°, "),t("strong",[s._v("åˆ›å»º Account å¯¹è±¡æ—¶, ä¼ å…¥ç›¸åŒçš„ lock, è¿™æ ·æ‰€æœ‰çš„ Account å¯¹è±¡éƒ½ä¼šå…±äº«è¿™ä¸ª lock äº†")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º Account æ—¶ä¼ å…¥åŒä¸€ä¸ª lock å¯¹è±¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤å¤„æ£€æŸ¥æ‰€æœ‰å¯¹è±¡å…±äº«çš„é”")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("è¿™ä¸ªåŠæ³•ç¡®å®èƒ½è§£å†³é—®é¢˜, ä½†æ˜¯æœ‰ç‚¹å°ç‘•ç–µ, å®ƒè¦æ±‚åœ¨åˆ›å»º Account å¯¹è±¡çš„æ—¶å€™å¿…é¡»ä¼ å…¥åŒä¸€ä¸ªå¯¹è±¡, å¦‚æœåˆ›å»º Account å¯¹è±¡æ—¶, ä¼ å…¥çš„ lock ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡, é‚£å¯å°±æƒ¨äº†, ä¼šå‡ºç°é”è‡ªå®¶é—¨æ¥ä¿æŠ¤ä»–å®¶èµ„äº§çš„è’å”äº‹. åœ¨çœŸå®çš„é¡¹ç›®åœºæ™¯ä¸­, åˆ›å»º Account å¯¹è±¡çš„ä»£ç å¾ˆå¯èƒ½åˆ†æ•£åœ¨å¤šä¸ªå·¥ç¨‹ä¸­, ä¼ å…¥å…±äº«çš„ lock çœŸçš„å¾ˆéš¾.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, ä¸Šé¢çš„æ–¹æ¡ˆç¼ºä¹å®è·µçš„å¯è¡Œæ€§, éœ€è¦æ›´å¥½çš„æ–¹æ¡ˆ. è¿˜çœŸæœ‰, å°±æ˜¯"),t("strong",[s._v("ç”¨ Account.class ä½œä¸ºå…±äº«çš„é”")]),s._v(". "),t("strong",[s._v("Account.class è¿™ä¸ªç±»å¯¹è±¡æ˜¯æ‰€æœ‰ Account å¯¹è±¡å…±äº«çš„, è€Œä¸”è¿™ä¸ªå¯¹è±¡æ˜¯ Java è™šæ‹Ÿæœºåœ¨åŠ è½½ Account ç±»çš„æ—¶å€™åˆ›å»ºçš„, æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå®ƒçš„å”¯ä¸€æ€§")]),s._v(". ä½¿ç”¨ Account.class ä½œä¸ºå…±äº«çš„é”, å°±æ— éœ€åœ¨åˆ›å»º Account å¯¹è±¡æ—¶ä¼ å…¥äº†, ä»£ç æ›´ç®€å•.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("ä¸‹é¢è¿™å¹…å›¾å¾ˆç›´è§‚åœ°å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å…±äº«çš„é” Account.class æ¥ä¿æŠ¤ä¸åŒå¯¹è±¡çš„ä¸´ç•ŒåŒº.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7764244d5b6e4075a875b4e8bf4b6155-20230731162452-m030zup.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-4"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("ç›¸ä¿¡ä½ çœ‹å®Œæœ¬èŠ‚å, å¯¹å¦‚ä½•"),t("strong",[s._v("ä¿æŠ¤å¤šä¸ªèµ„æº")]),s._v("å·²ç»å¾ˆæœ‰å¿ƒå¾—äº†, å…³é”®æ˜¯è¦åˆ†æå¤šä¸ªèµ„æºä¹‹é—´çš„å…³ç³». "),t("strong",[s._v("å¦‚æœèµ„æºä¹‹é—´æ²¡æœ‰å…³ç³», å¾ˆå¥½å¤„ç†, æ¯ä¸ªèµ„æºä¸€æŠŠé”å°±å¯ä»¥äº†. å¦‚æœèµ„æºä¹‹é—´æœ‰å…³è”å…³ç³», å°±è¦é€‰æ‹©ä¸€ä¸ªç²’åº¦æ›´å¤§çš„é”, è¿™ä¸ªé”åº”è¯¥èƒ½å¤Ÿè¦†ç›–æ‰€æœ‰ç›¸å…³çš„èµ„æº")]),s._v(". é™¤æ­¤ä¹‹å¤–, è¿˜è¦æ¢³ç†å‡ºæœ‰å“ªäº›è®¿é—®è·¯å¾„, æ‰€æœ‰çš„è®¿é—®è·¯å¾„éƒ½è¦è®¾ç½®åˆé€‚çš„é”, è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç±»æ¯”ä¸€ä¸‹é—¨ç¥¨ç®¡ç†.")]),s._v(" "),t("p",[s._v('å†å¼•ç”³ä¸€ä¸‹ä¸Šé¢æåˆ°çš„å…³è”å…³ç³», å…³è”å…³ç³»å¦‚æœç”¨æ›´å…·ä½“, æ›´ä¸“ä¸šçš„è¯­è¨€æ¥æè¿°çš„è¯, å…¶å®æ˜¯ä¸€ç§ "åŸå­æ€§" ç‰¹å¾, å‰é¢æåˆ°çš„åŸå­æ€§, ä¸»è¦æ˜¯é¢å‘ CPU æŒ‡ä»¤çš„, è½¬è´¦æ“ä½œçš„åŸå­æ€§åˆ™æ˜¯å±äºæ˜¯é¢å‘é«˜çº§è¯­è¨€çš„, ä¸è¿‡å®ƒä»¬æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„.')]),s._v(" "),t("p",[t("strong",[s._v('"åŸå­æ€§" çš„æœ¬è´¨')]),s._v("æ˜¯ä»€ä¹ˆ? å…¶å®ä¸æ˜¯ä¸å¯åˆ†å‰², ä¸å¯åˆ†å‰²åªæ˜¯å¤–åœ¨è¡¨ç°, å…¶æœ¬è´¨æ˜¯å¤šä¸ªèµ„æºé—´æœ‰ä¸€è‡´æ€§çš„è¦æ±‚, "),t("strong",[s._v("æ“ä½œçš„ä¸­é—´çŠ¶æ€å¯¹å¤–ä¸å¯è§")]),s._v(". ä¾‹å¦‚, åœ¨ 32 ä½çš„æœºå™¨ä¸Šå†™ long å‹å˜é‡æœ‰ä¸­é—´çŠ¶æ€(åªå†™äº† 64 ä½ä¸­çš„ 32 ä½), åœ¨é“¶è¡Œè½¬è´¦çš„æ“ä½œä¸­ä¹Ÿæœ‰ä¸­é—´çŠ¶æ€(è´¦æˆ· A å‡å°‘äº† 100, è´¦æˆ· B è¿˜æ²¡æ¥å¾—åŠå‘ç”Ÿå˜åŒ–). æ‰€ä»¥"),t("strong",[s._v("è§£å†³åŸå­æ€§é—®é¢˜, æ˜¯è¦ä¿è¯ä¸­é—´çŠ¶æ€å¯¹å¤–ä¸å¯è§")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_05-ä¸€ä¸å°å¿ƒå°±æ­»é”äº†æ€ä¹ˆåŠ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_05-ä¸€ä¸å°å¿ƒå°±æ­»é”äº†æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 05-ä¸€ä¸å°å¿ƒå°±æ­»é”äº†æ€ä¹ˆåŠ?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚ç”¨ Account.class ä½œä¸ºäº’æ–¥é”, æ¥è§£å†³é“¶è¡Œä¸šåŠ¡é‡Œé¢çš„è½¬è´¦é—®é¢˜, è™½ç„¶è¿™ä¸ªæ–¹æ¡ˆä¸å­˜åœ¨å¹¶å‘é—®é¢˜, ä½†æ˜¯æ‰€æœ‰è´¦æˆ·çš„è½¬è´¦æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„, ä¾‹å¦‚è´¦æˆ· A è½¬è´¦æˆ· B, è´¦æˆ· C è½¬è´¦æˆ· D è¿™ä¸¤ä¸ªè½¬è´¦æ“ä½œç°å®ä¸–ç•Œé‡Œæ˜¯å¯ä»¥å¹¶è¡Œçš„, ä½†æ˜¯åœ¨è¿™ä¸ªæ–¹æ¡ˆé‡Œå´è¢«ä¸²è¡ŒåŒ–äº†, è¿™æ ·çš„è¯, æ€§èƒ½å¤ªå·®.")]),s._v(" "),t("p",[s._v("é‚£ä¸‹é¢å°±å°è¯•ç€æŠŠæ€§èƒ½æå‡ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"å‘ç°å®ä¸–ç•Œè¦ç­”æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘ç°å®ä¸–ç•Œè¦ç­”æ¡ˆ"}},[s._v("#")]),s._v(" å‘ç°å®ä¸–ç•Œè¦ç­”æ¡ˆ")]),s._v(" "),t("p",[s._v("ç°å®ä¸–ç•Œé‡Œ, è´¦æˆ·è½¬è´¦æ“ä½œæ˜¯æ”¯æŒå¹¶å‘çš„, è€Œä¸”ç»å¯¹æ˜¯çœŸæ­£çš„å¹¶è¡Œ, é“¶è¡Œæ‰€æœ‰çš„çª—å£éƒ½å¯ä»¥åšè½¬è´¦æ“ä½œ. åªè¦èƒ½ä»¿ç…§ç°å®ä¸–ç•Œåšè½¬è´¦æ“ä½œ, ä¸²è¡Œçš„é—®é¢˜å°±è§£å†³äº†.")]),s._v(" "),t("p",[s._v("è¯•æƒ³åœ¨å¤ä»£, æ²¡æœ‰ä¿¡æ¯åŒ–, è´¦æˆ·çš„å­˜åœ¨å½¢å¼çœŸçš„å°±æ˜¯ä¸€ä¸ªè´¦æœ¬, è€Œä¸”æ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ªè´¦æœ¬, è¿™äº›è´¦æœ¬éƒ½ç»Ÿä¸€å­˜æ”¾åœ¨æ–‡ä»¶æ¶ä¸Š. é“¶è¡ŒæŸœå‘˜åœ¨åšè½¬è´¦æ—¶, è¦å»æ–‡ä»¶æ¶ä¸ŠæŠŠè½¬å‡ºè´¦æœ¬å’Œè½¬å…¥è´¦æœ¬éƒ½æ‹¿åˆ°æ‰‹, ç„¶ååšè½¬è´¦. è¿™ä¸ªæŸœå‘˜åœ¨æ‹¿è´¦æœ¬çš„æ—¶å€™å¯èƒ½é‡åˆ°ä»¥ä¸‹ä¸‰ç§æƒ…å†µ:")]),s._v(" "),t("ol",[t("li",[s._v("æ–‡ä»¶æ¶ä¸Šæ°å¥½æœ‰è½¬å‡ºè´¦æœ¬å’Œè½¬å…¥è´¦æœ¬, é‚£å°±åŒæ—¶æ‹¿èµ°;")]),s._v(" "),t("li",[s._v("å¦‚æœæ–‡ä»¶æ¶ä¸Šåªæœ‰è½¬å‡ºè´¦æœ¬å’Œè½¬å…¥è´¦æœ¬ä¹‹ä¸€, é‚£è¿™ä¸ªæŸœå‘˜å°±å…ˆæŠŠæ–‡ä»¶æ¶ä¸Šæœ‰çš„è´¦æœ¬æ‹¿åˆ°æ‰‹, åŒæ—¶ç­‰ç€å…¶ä»–æŸœå‘˜æŠŠå¦å¤–ä¸€ä¸ªè´¦æœ¬é€å›æ¥;")]),s._v(" "),t("li",[s._v("è½¬å‡ºè´¦æœ¬å’Œè½¬å…¥è´¦æœ¬éƒ½æ²¡æœ‰, é‚£è¿™ä¸ªæŸœå‘˜å°±ç­‰ç€ä¸¤ä¸ªè´¦æœ¬éƒ½è¢«é€å›æ¥.")])]),s._v(" "),t("p",[s._v("ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹åœ¨ç¼–ç¨‹çš„ä¸–ç•Œé‡Œæ€ä¹ˆå®ç°å‘¢? å…¶å®ç”¨"),t("strong",[s._v("ä¸¤æŠŠé”")]),s._v("å°±å®ç°äº†, è½¬å‡ºè´¦æœ¬ä¸€æŠŠ, è½¬å…¥è´¦æœ¬å¦ä¸€æŠŠ. åœ¨ transfer() æ–¹æ³•å†…éƒ¨, "),t("strong",[s._v("é¦–å…ˆå°è¯•é”å®šè½¬å‡ºè´¦æˆ· this(å…ˆæŠŠè½¬å‡ºè´¦æœ¬æ‹¿åˆ°æ‰‹), ç„¶åå°è¯•é”å®šè½¬å…¥è´¦æˆ· target(å†æŠŠè½¬å…¥è´¦æœ¬æ‹¿åˆ°æ‰‹), åªæœ‰å½“ä¸¤è€…éƒ½æˆåŠŸæ—¶, æ‰æ‰§è¡Œè½¬è´¦æ“ä½œ")]),s._v(". è¿™ä¸ªé€»è¾‘å¯ä»¥å›¾å½¢åŒ–ä¸ºä¸‹å›¾è¿™ä¸ªæ ·å­.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/475fb68fa271caf742f652fc35c07ed5-20230731162452-p48fiba.png",alt:"",title:"ä¸¤ä¸ªè½¬è´¦æ“ä½œå¹¶è¡Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("è€Œè‡³äºè¯¦ç»†çš„ä»£ç å®ç°, å¦‚ä¸‹æ‰€ç¤º. ç»è¿‡è¿™æ ·çš„ä¼˜åŒ–å, è´¦æˆ· A è½¬è´¦æˆ· B å’Œè´¦æˆ· C è½¬è´¦æˆ· D è¿™ä¸¤ä¸ªè½¬è´¦æ“ä½œå°±å¯ä»¥å¹¶è¡Œäº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”å®šè½¬å‡ºè´¦æˆ·")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”å®šè½¬å…¥è´¦æˆ·")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h5",{attrs:{id:"æ²¡æœ‰å…è´¹çš„åˆé¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ²¡æœ‰å…è´¹çš„åˆé¤"}},[s._v("#")]),s._v(" æ²¡æœ‰å…è´¹çš„åˆé¤")]),s._v(" "),t("p",[s._v("ä¸Šé¢çš„å®ç°çœ‹ä¸Šå»å¾ˆå®Œç¾, å¹¶ä¸”ä¹Ÿç®—æ˜¯å°†é”ç”¨å¾—å‡ºç¥å…¥åŒ–äº†. ç›¸å¯¹äºç”¨ Account.class ä½œä¸ºäº’æ–¥é”, é”å®šçš„èŒƒå›´å¤ªå¤§, è€Œé”å®šä¸¤ä¸ªè´¦æˆ·èŒƒå›´å°±å°å¤šäº†, è¿™æ ·çš„é”, ä¸Šä¸€èŠ‚ä»‹ç»è¿‡, å«"),t("strong",[s._v("ç»†ç²’åº¦é”")]),s._v(". "),t("strong",[s._v("ä½¿ç”¨ç»†ç²’åº¦é”å¯ä»¥æé«˜å¹¶è¡Œåº¦, æ˜¯æ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µ")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ—¶å€™å¯èƒ½ä½ å·²ç»å¼€å§‹è­¦è§‰äº†, ä½¿ç”¨ç»†ç²’åº¦é”è¿™ä¹ˆç®€å•, æœ‰è¿™æ ·çš„å¥½äº‹, æ˜¯ä¸æ˜¯ä¹Ÿè¦ä»˜å‡ºç‚¹ä»€ä¹ˆä»£ä»·å•Š? ç¼–å†™å¹¶å‘ç¨‹åºå°±éœ€è¦è¿™æ ·æ—¶æ—¶åˆ»åˆ»ä¿æŒè°¨æ….")]),s._v(" "),t("p",[s._v("**çš„ç¡®, ä½¿ç”¨ç»†ç²’åº¦é”æ˜¯æœ‰ä»£ä»·çš„, è¿™ä¸ªä»£ä»·å°±æ˜¯å¯èƒ½ä¼šå¯¼è‡´æ­»é”. **")]),s._v(" "),t("p",[s._v("åœ¨è¯¦ç»†ä»‹ç»æ­»é”ä¹‹å‰, å…ˆçœ‹çœ‹ç°å®ä¸–ç•Œé‡Œçš„ä¸€ç§ç‰¹æ®Šåœºæ™¯. å¦‚æœæœ‰å®¢æˆ·æ‰¾æŸœå‘˜å¼ ä¸‰åšä¸ªè½¬è´¦ä¸šåŠ¡: è´¦æˆ· A è½¬è´¦æˆ· B 100 å…ƒ, æ­¤æ—¶å¦ä¸€ä¸ªå®¢æˆ·æ‰¾æŸœå‘˜æå››ä¹Ÿåšä¸ªè½¬è´¦ä¸šåŠ¡: è´¦æˆ· B è½¬è´¦æˆ· A 100 å…ƒ, äºæ˜¯å¼ ä¸‰å’Œæå››åŒæ—¶éƒ½å»æ–‡ä»¶æ¶ä¸Šæ‹¿è´¦æœ¬, è¿™æ—¶å€™æœ‰å¯èƒ½å‡‘å·§å¼ ä¸‰æ‹¿åˆ°äº†è´¦æœ¬ A, æå››æ‹¿åˆ°äº†è´¦æœ¬ B. å¼ ä¸‰æ‹¿åˆ°è´¦æœ¬ A åå°±ç­‰ç€è´¦æœ¬ B(è´¦æœ¬ B å·²ç»è¢«æå››æ‹¿èµ°), è€Œæå››æ‹¿åˆ°è´¦æœ¬ B åå°±ç­‰ç€è´¦æœ¬ A(è´¦æœ¬ A å·²ç»è¢«å¼ ä¸‰æ‹¿èµ°), ä»–ä»¬è¦ç­‰å¤šä¹…å‘¢? ä»–ä»¬ä¼šæ°¸è¿œç­‰å¾…ä¸‹å»...å› ä¸ºå¼ ä¸‰ä¸ä¼šæŠŠè´¦æœ¬ A é€å›å», æå››ä¹Ÿä¸ä¼šæŠŠè´¦æœ¬ B é€å›å». å§‘ä¸”ç§°ä¸ºæ­»ç­‰å§.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/30b4a32e6934315dc480e53a1ff44398-20230731162452-8t6r9x6.png",alt:"",title:'è½¬è´¦ä¸šåŠ¡ä¸­çš„"æ­»ç­‰"'}})]),s._v(" "),t("p",[s._v("ç°å®ä¸–ç•Œé‡Œçš„æ­»ç­‰, å°±æ˜¯ç¼–ç¨‹é¢†åŸŸçš„æ­»é”äº†. "),t("strong",[s._v("æ­»é”")]),s._v("çš„ä¸€ä¸ªæ¯”è¾ƒä¸“ä¸šçš„å®šä¹‰æ˜¯: "),t("strong",[s._v('ä¸€ç»„äº’ç›¸ç«äº‰èµ„æºçš„çº¿ç¨‹å› äº’ç›¸ç­‰å¾…, å¯¼è‡´ "æ°¸ä¹…" é˜»å¡çš„ç°è±¡')]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸Šé¢è½¬è´¦çš„ä»£ç æ˜¯æ€ä¹ˆå‘ç”Ÿæ­»é”çš„å‘¢? å‡è®¾çº¿ç¨‹ T1 æ‰§è¡Œè´¦æˆ· A è½¬è´¦æˆ· B çš„æ“ä½œ, è´¦æˆ· A.transfer(è´¦æˆ· B); åŒæ—¶çº¿ç¨‹ T2 æ‰§è¡Œè´¦æˆ· B è½¬è´¦æˆ· A çš„æ“ä½œ, è´¦æˆ· B.transfer(è´¦æˆ· A). å½“ T1 å’Œ T2 åŒæ—¶æ‰§è¡Œå®Œ â‘  å¤„çš„ä»£ç æ—¶, T1 è·å¾—äº†è´¦æˆ· A çš„é”(å¯¹äº T1, this æ˜¯è´¦æˆ· A), è€Œ T2 è·å¾—äº†è´¦æˆ· B çš„é”(å¯¹äº T2, this æ˜¯è´¦æˆ· B). ä¹‹å T1 å’Œ T2 åœ¨æ‰§è¡Œ â‘¡ å¤„çš„ä»£ç æ—¶, T1 è¯•å›¾è·å–è´¦æˆ· B çš„é”æ—¶, å‘ç°è´¦æˆ· B å·²ç»è¢«é”å®š(è¢« T2 é”å®š), æ‰€ä»¥ T1 å¼€å§‹ç­‰å¾…; T2 åˆ™è¯•å›¾è·å–è´¦æˆ· A çš„é”æ—¶, å‘ç°è´¦æˆ· A å·²ç»è¢«é”å®š(è¢« T1 é”å®š), æ‰€ä»¥ T2 ä¹Ÿå¼€å§‹ç­‰å¾…. äºæ˜¯ T1 å’Œ T2 ä¼šæ— æœŸé™åœ°ç­‰å¾…ä¸‹å», ä¹Ÿå°±æ˜¯æ‰€è¯´çš„æ­»é”äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”å®šè½¬å‡ºè´¦æˆ·")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”å®šè½¬å…¥è´¦æˆ·")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¡")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v('å…³äºè¿™ç§ç°è±¡, è¿˜å¯ä»¥å€ŸåŠ©èµ„æºåˆ†é…å›¾æ¥å¯è§†åŒ–é”çš„å ç”¨æƒ…å†µ(èµ„æºåˆ†é…å›¾æ˜¯ä¸ªæœ‰å‘å›¾, å®ƒå¯ä»¥æè¿°èµ„æºå’Œçº¿ç¨‹çš„çŠ¶æ€). å…¶ä¸­, èµ„æºç”¨æ–¹å½¢èŠ‚ç‚¹è¡¨ç¤º, çº¿ç¨‹ç”¨åœ†å½¢èŠ‚ç‚¹è¡¨ç¤º; èµ„æºä¸­çš„ç‚¹æŒ‡å‘çº¿ç¨‹çš„è¾¹è¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—è¯¥èµ„æº, çº¿ç¨‹æŒ‡å‘èµ„æºçš„è¾¹åˆ™è¡¨ç¤ºçº¿ç¨‹è¯·æ±‚èµ„æº, ä½†å°šæœªå¾—åˆ°. è½¬è´¦å‘ç”Ÿæ­»é”æ—¶çš„èµ„æºåˆ†é…å›¾å°±å¦‚ä¸‹å›¾æ‰€ç¤º, ä¸€ä¸ª"å„æ®å±±å¤´æ­»ç­‰"çš„å°´å°¬å±€é¢.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/aab899af7f3db5c9f2fbea66c1af5c17-20230731162452-ke733iy.png",alt:"",title:"è½¬è´¦å‘ç”Ÿæ­»é”æ—¶çš„èµ„æºåˆ†é…å›¾"}})]),s._v(" "),t("h5",{attrs:{id:"å¦‚ä½•é¢„é˜²æ­»é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•é¢„é˜²æ­»é”"}},[s._v("#")]),s._v(" å¦‚ä½•é¢„é˜²æ­»é”")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¨‹åºä¸€æ—¦æ­»é”, ä¸€èˆ¬æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ–¹æ³•, å¾ˆå¤šæ—¶å€™åªèƒ½é‡å¯åº”ç”¨. å› æ­¤, "),t("strong",[s._v("è§£å†³æ­»é”é—®é¢˜æœ€å¥½çš„åŠæ³•è¿˜æ˜¯è§„é¿æ­»é”")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£å¦‚ä½•é¿å…æ­»é”å‘¢? è¦é¿å…æ­»é”å°±éœ€è¦åˆ†ææ­»é”å‘ç”Ÿçš„æ¡ä»¶, åªæœ‰ä»¥ä¸‹è¿™"),t("strong",[s._v("å››ä¸ªæ¡ä»¶éƒ½å‘ç”Ÿ")]),s._v("æ—¶æ‰ä¼šå‡ºç°æ­»é”:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("äº’æ–¥")]),s._v(", å…±äº«èµ„æº X å’Œ Y åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å ç”¨;")]),s._v(" "),t("li",[t("strong",[s._v("å æœ‰ä¸”ç­‰å¾…")]),s._v(", çº¿ç¨‹ T1 å·²ç»å–å¾—å…±äº«èµ„æº X, åœ¨ç­‰å¾…å…±äº«èµ„æº Y çš„æ—¶å€™, ä¸é‡Šæ”¾å…±äº«èµ„æº X;")]),s._v(" "),t("li",[t("strong",[s._v("ä¸å¯æŠ¢å ")]),s._v(", å…¶ä»–çº¿ç¨‹ä¸èƒ½å¼ºè¡ŒæŠ¢å çº¿ç¨‹ T1 å æœ‰çš„èµ„æº;")]),s._v(" "),t("li",[t("strong",[s._v("å¾ªç¯ç­‰å¾…")]),s._v(", çº¿ç¨‹ T1 ç­‰å¾…çº¿ç¨‹ T2 å æœ‰çš„èµ„æº, çº¿ç¨‹ T2 ç­‰å¾…çº¿ç¨‹ T1 å æœ‰çš„èµ„æº, å°±æ˜¯å¾ªç¯ç­‰å¾….")])]),s._v(" "),t("p",[s._v("åè¿‡æ¥åˆ†æ, "),t("strong",[s._v("ä¹Ÿå°±æ˜¯è¯´åªè¦ç ´åå…¶ä¸­ä¸€ä¸ª, å°±å¯ä»¥æˆåŠŸé¿å…æ­»é”çš„å‘ç”Ÿ")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶ä¸­, äº’æ–¥è¿™ä¸ªæ¡ä»¶æ²¡æœ‰åŠæ³•ç ´å, å› ä¸ºç”¨é”ä¸ºçš„å°±æ˜¯äº’æ–¥. ä¸è¿‡å…¶ä»–ä¸‰ä¸ªæ¡ä»¶éƒ½æ˜¯æœ‰åŠæ³•ç ´åæ‰çš„, åˆ°åº•å¦‚ä½•åšå‘¢?")]),s._v(" "),t("ol",[t("li",[s._v('å¯¹äº "å ç”¨ä¸”ç­‰å¾…" è¿™ä¸ªæ¡ä»¶, å¯ä»¥'),t("strong",[s._v("ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰çš„èµ„æº")]),s._v(", è¿™æ ·å°±ä¸å­˜åœ¨ç­‰å¾…äº†.")]),s._v(" "),t("li",[s._v('å¯¹äº "ä¸å¯æŠ¢å " è¿™ä¸ªæ¡ä»¶, å ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶, '),t("strong",[s._v("å¦‚æœç”³è¯·ä¸åˆ°, å¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æº")]),s._v(", è¿™æ ·ä¸å¯æŠ¢å è¿™ä¸ªæ¡ä»¶å°±ç ´åæ‰äº†.")]),s._v(" "),t("li",[s._v('å¯¹äº "å¾ªç¯ç­‰å¾…" è¿™ä¸ªæ¡ä»¶, å¯ä»¥'),t("strong",[s._v("é æŒ‰åºç”³è¯·èµ„æºæ¥é¢„é˜²")]),s._v(". æ‰€è°“æŒ‰åºç”³è¯·, æ˜¯æŒ‡èµ„æºæ˜¯æœ‰çº¿æ€§é¡ºåºçš„, ç”³è¯·çš„æ—¶å€™å¯ä»¥å…ˆç”³è¯·èµ„æºåºå·å°çš„, å†ç”³è¯·èµ„æºåºå·å¤§çš„, è¿™æ ·çº¿æ€§åŒ–åè‡ªç„¶å°±ä¸å­˜åœ¨å¾ªç¯äº†.")])]),s._v(" "),t("p",[s._v("å·²ç»ä»ç†è®ºä¸Šè§£å†³äº†å¦‚ä½•é¢„é˜²æ­»é”, é‚£å…·ä½“å¦‚ä½•ä½“ç°åœ¨ä»£ç ä¸Šå‘¢? ä¸‹é¢å°±æ¥å°è¯•ç”¨ä»£ç å®è·µä¸€ä¸‹è¿™äº›ç†è®º.")]),s._v(" "),t("h6",{attrs:{id:"_1-ç ´åå ç”¨ä¸”ç­‰å¾…æ¡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç ´åå ç”¨ä¸”ç­‰å¾…æ¡ä»¶"}},[s._v("#")]),s._v(" (1)ç ´åå ç”¨ä¸”ç­‰å¾…æ¡ä»¶")]),s._v(" "),t("p",[s._v("ä»ç†è®ºä¸Šè®², è¦ç ´åè¿™ä¸ªæ¡ä»¶, å¯ä»¥ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰èµ„æº. åœ¨ç°å®ä¸–ç•Œé‡Œ, å°±æ‹¿å‰é¢æåˆ°çš„è½¬è´¦æ“ä½œæ¥è®², å®ƒéœ€è¦çš„"),t("strong",[s._v("èµ„æºæœ‰ä¸¤ä¸ª, ä¸€ä¸ªæ˜¯è½¬å‡ºè´¦æˆ·, å¦ä¸€ä¸ªæ˜¯è½¬å…¥è´¦æˆ·")]),s._v(", å½“è¿™ä¸¤ä¸ªè´¦æˆ·åŒæ—¶è¢«ç”³è¯·æ—¶, è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢?")]),s._v(" "),t("p",[s._v('å¯ä»¥å¢åŠ ä¸€ä¸ªè´¦æœ¬ç®¡ç†å‘˜, ç„¶ååªå…è®¸è´¦æœ¬ç®¡ç†å‘˜ä»æ–‡ä»¶æ¶ä¸Šæ‹¿è´¦æœ¬, ä¹Ÿå°±æ˜¯è¯´æŸœå‘˜ä¸èƒ½ç›´æ¥åœ¨æ–‡ä»¶æ¶ä¸Šæ‹¿è´¦æœ¬, å¿…é¡»é€šè¿‡è´¦æœ¬ç®¡ç†å‘˜æ‰èƒ½æ‹¿åˆ°æƒ³è¦çš„è´¦æœ¬. ä¾‹å¦‚, å¼ ä¸‰åŒæ—¶ç”³è¯·è´¦æœ¬ A å’Œ B, è´¦æœ¬ç®¡ç†å‘˜å¦‚æœå‘ç°æ–‡ä»¶æ¶ä¸Šåªæœ‰è´¦æœ¬ A, è¿™ä¸ªæ—¶å€™è´¦æœ¬ç®¡ç†å‘˜æ˜¯ä¸ä¼šæŠŠè´¦æœ¬ A æ‹¿ä¸‹æ¥ç»™å¼ ä¸‰çš„, åªæœ‰è´¦æœ¬ A å’Œ B éƒ½åœ¨çš„æ—¶å€™æ‰ä¼šç»™å¼ ä¸‰. è¿™æ ·å°±ä¿è¯äº† "ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰èµ„æº".')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b373b4cbefc412942fde6e4861a1a071-20230731162452-8srj682.png",alt:"",title:"é€šè¿‡è´¦æœ¬ç®¡ç†å‘˜æ‹¿è´¦æœ¬"}})]),s._v(" "),t("p",[s._v('å¯¹åº”åˆ°ç¼–ç¨‹é¢†åŸŸ, "åŒæ—¶ç”³è¯·" è¿™ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªä¸´ç•ŒåŒº, ä¹Ÿéœ€è¦ä¸€ä¸ªè§’è‰²(Java é‡Œé¢çš„ç±»)æ¥ç®¡ç†è¿™ä¸ªä¸´ç•ŒåŒº, å°±æŠŠè¿™ä¸ªè§’è‰²å®šä¸º '),t("strong",[s._v("Allocator")]),s._v(". å®ƒæœ‰ä¸¤ä¸ªé‡è¦åŠŸèƒ½, åˆ†åˆ«æ˜¯: "),t("strong",[s._v("åŒæ—¶ç”³è¯·èµ„æº apply() å’ŒåŒæ—¶é‡Šæ”¾èµ„æº free()")]),s._v(" . è´¦æˆ· Account ç±»é‡Œé¢æŒæœ‰ä¸€ä¸ª Allocator çš„å•ä¾‹(å¿…é¡»æ˜¯å•ä¾‹, åªèƒ½ç”±ä¸€ä¸ªäººæ¥åˆ†é…èµ„æº). å½“è´¦æˆ· Account åœ¨æ‰§è¡Œè½¬è´¦æ“ä½œçš„æ—¶å€™, é¦–å…ˆå‘ Allocator åŒæ—¶ç”³è¯·è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·è¿™ä¸¤ä¸ªèµ„æº, æˆåŠŸåå†é”å®šè¿™ä¸¤ä¸ªèµ„æº; å½“è½¬è´¦æ“ä½œæ‰§è¡Œå®Œ, é‡Šæ”¾é”ä¹‹å, éœ€é€šçŸ¥ Allocator åŒæ—¶é‡Šæ”¾è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·è¿™ä¸¤ä¸ªèµ„æº. å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Allocator")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" als "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰èµ„æº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½’è¿˜èµ„æº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// actr åº”è¯¥ä¸ºå•ä¾‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Allocator")]),s._v(" actr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸€æ¬¡æ€§ç”³è¯·è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·, ç›´åˆ°æˆåŠŸ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("actr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”å®šè½¬å‡ºè´¦æˆ·")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”å®šè½¬å…¥è´¦æˆ·")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            actr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("h6",{attrs:{id:"_2-ç ´åä¸å¯æŠ¢å æ¡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç ´åä¸å¯æŠ¢å æ¡ä»¶"}},[s._v("#")]),s._v(" (2)ç ´åä¸å¯æŠ¢å æ¡ä»¶")]),s._v(" "),t("p",[s._v("ç ´åä¸å¯æŠ¢å æ¡ä»¶çœ‹ä¸Šå»å¾ˆç®€å•, "),t("strong",[s._v("æ ¸å¿ƒæ˜¯è¦èƒ½å¤Ÿä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æº, è¿™ä¸€ç‚¹ synchronized æ˜¯åšä¸åˆ°çš„")]),s._v(". åŸå› æ˜¯ synchronized ç”³è¯·èµ„æºçš„æ—¶å€™, å¦‚æœç”³è¯·ä¸åˆ°, çº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†, è€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€, å•¥éƒ½å¹²ä¸äº†, ä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æº.")]),s._v(" "),t("p",[s._v('ä½ å¯èƒ½ä¼šè´¨ç–‘, "Java ä½œä¸ºæ’è¡Œæ¦œç¬¬ä¸€çš„è¯­è¨€, è¿™éƒ½è§£å†³ä¸äº†?" ä½ çš„æ€€ç–‘å¾ˆæœ‰é“ç†, Java åœ¨è¯­è¨€å±‚æ¬¡ç¡®å®æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜, ä¸è¿‡åœ¨ SDK å±‚é¢è¿˜æ˜¯è§£å†³äº†çš„, java.util.concurrent è¿™ä¸ªåŒ…ä¸‹é¢æä¾›çš„ '),t("strong",[s._v("Lock")]),s._v(" æ˜¯å¯ä»¥è½»æ¾è§£å†³è¿™ä¸ªé—®é¢˜çš„. å…³äºè¿™ä¸ªè¯é¢˜, åé¢ä¼šè¯¦ç»†è®².")]),s._v(" "),t("h6",{attrs:{id:"_3-ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶"}},[s._v("#")]),s._v(" (3)ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶")]),s._v(" "),t("p",[s._v("ç ´åè¿™ä¸ªæ¡ä»¶, éœ€è¦"),t("strong",[s._v("å¯¹èµ„æºè¿›è¡Œæ’åº, ç„¶åæŒ‰åºç”³è¯·èµ„æº")]),s._v('. è¿™ä¸ªå®ç°éå¸¸ç®€å•, å‡è®¾æ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸åŒçš„å±æ€§ id, è¿™ä¸ª id å¯ä»¥ä½œä¸ºæ’åºå­—æ®µ, ç”³è¯·çš„æ—¶å€™, å¯ä»¥æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ¥ç”³è¯·. æ¯”å¦‚ä¸‹é¢ä»£ç ä¸­, â‘ ~â‘¥ å¤„çš„ä»£ç å¯¹è½¬å‡ºè´¦æˆ·(this)å’Œè½¬å…¥è´¦æˆ·(target)æ’åº, ç„¶åæŒ‰ç…§åºå·ä»å°åˆ°å¤§çš„é¡ºåºé”å®šè´¦æˆ·. è¿™æ ·å°±ä¸å­˜åœ¨ "å¾ªç¯" ç­‰å¾…äº†.')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" left "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" right "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¢")]),s._v("\n            left "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘£")]),s._v("\n            right "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¤")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¥")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”å®šåºå·å°çš„è´¦æˆ·")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("left"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”å®šåºå·å¤§çš„è´¦æˆ·")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("right"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-5"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("å½“åœ¨ç¼–ç¨‹ä¸–ç•Œé‡Œé‡åˆ°é—®é¢˜æ—¶, åº”ä¸å±€é™äºå½“ä¸‹, å¯ä»¥æ¢ä¸ªæ€è·¯, å‘ç°å®ä¸–ç•Œè¦ç­”æ¡ˆ, "),t("strong",[s._v("åˆ©ç”¨ç°å®ä¸–ç•Œçš„æ¨¡å‹æ¥æ„æ€è§£å†³æ–¹æ¡ˆ")]),s._v(", è¿™æ ·å¾€å¾€èƒ½å¤Ÿè®©æ–¹æ¡ˆæ›´å®¹æ˜“ç†è§£, ä¹Ÿæ›´èƒ½å¤Ÿçœ‹æ¸…æ¥šé—®é¢˜çš„æœ¬è´¨. ä½†æ˜¯ç°å®ä¸–ç•Œçš„æ¨¡å‹æœ‰äº›ç»†èŠ‚å¾€å¾€ä¼šè¢«å¿½è§†. å› ä¸ºåœ¨ç°å®ä¸–ç•Œé‡Œ, äººå¤ªæ™ºèƒ½äº†, ä»¥è‡´æœ‰äº›ç»†èŠ‚å®åœ¨æ˜¯æ˜¾å¾—å¤ªä¸é‡è¦äº†. åœ¨è½¬è´¦çš„æ¨¡å‹ä¸­, ä¸ºä»€ä¹ˆä¼šå¿½è§†æ­»é”é—®é¢˜å‘¢? åŸå› ä¸»è¦æ˜¯åœ¨ç°å®ä¸–ç•Œ, å¤§å®¶ä¼šäº¤æµ, å¹¶ä¸”ä¼šå¾ˆæ™ºèƒ½åœ°äº¤æµ. è€Œç¼–ç¨‹ä¸–ç•Œé‡Œ, ä¸¤ä¸ªçº¿ç¨‹æ˜¯ä¸ä¼šæ™ºèƒ½åœ°äº¤æµçš„. æ‰€ä»¥åœ¨åˆ©ç”¨ç°å®æ¨¡å‹å»ºæ¨¡çš„æ—¶å€™, è¿˜è¦ä»”ç»†å¯¹æ¯”ç°å®ä¸–ç•Œå’Œç¼–ç¨‹ä¸–ç•Œé‡Œçš„å„è§’è‰²ä¹‹é—´çš„å·®å¼‚.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä¸»è¦è®²äº†"),t("strong",[s._v("ç”¨ç»†ç²’åº¦é”æ¥é”å®šå¤šä¸ªèµ„æºæ—¶, è¦æ³¨æ„æ­»é”çš„é—®é¢˜")]),s._v(". è¿™ä¸ªå°±éœ€è¦èƒ½æŠŠå®ƒå¼ºåŒ–ä¸ºä¸€ä¸ªæ€ç»´å®šåŠ¿, é‡åˆ°è¿™ç§åœºæ™¯, é©¬ä¸Šæƒ³åˆ°å¯èƒ½å­˜åœ¨æ­»é”é—®é¢˜. å½“çŸ¥é“é£é™©ä¹‹å, æ‰æœ‰æœºä¼šè°ˆå¦‚ä½•é¢„é˜²å’Œé¿å…, å› æ­¤, "),t("strong",[s._v("è¯†åˆ«å‡ºé£é™©å¾ˆé‡è¦")]),s._v(".")]),s._v(" "),t("p",[s._v("é¢„é˜²æ­»é”ä¸»è¦æ˜¯ç ´åä¸‰ä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ª, æœ‰äº†è¿™ä¸ªæ€è·¯å, å®ç°å°±ç®€å•äº†. ä½†ä»éœ€æ³¨æ„çš„æ˜¯, æœ‰æ—¶å€™é¢„é˜²æ­»é”æˆæœ¬ä¹Ÿæ˜¯å¾ˆé«˜çš„. ä¾‹å¦‚ä¸Šé¢è½¬è´¦é‚£ä¸ªä¾‹å­, ç ´åå ç”¨ä¸”ç­‰å¾…æ¡ä»¶çš„æˆæœ¬å°±æ¯”ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶çš„æˆæœ¬é«˜, ç ´åå ç”¨ä¸”ç­‰å¾…æ¡ä»¶, ä¹Ÿæ˜¯é”äº†æ‰€æœ‰çš„è´¦æˆ·, è€Œä¸”è¿˜æ˜¯ç”¨äº†æ­»å¾ªç¯ "),t("code",[s._v("while(!actr.apply(this, target));")]),s._v("â€‹ æ–¹æ³•, ä¸è¿‡å¥½åœ¨ apply() è¿™ä¸ªæ–¹æ³•åŸºæœ¬ä¸è€—æ—¶. åœ¨è½¬è´¦è¿™ä¸ªä¾‹å­ä¸­, ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶å°±æ˜¯æˆæœ¬æœ€ä½çš„ä¸€ä¸ªæ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥åœ¨é€‰æ‹©å…·ä½“æ–¹æ¡ˆçš„æ—¶å€™, è¿˜éœ€è¦"),t("strong",[s._v("è¯„ä¼°ä¸€ä¸‹æ“ä½œæˆæœ¬, ä»ä¸­é€‰æ‹©ä¸€ä¸ªæˆæœ¬æœ€ä½çš„æ–¹æ¡ˆ")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_06-ç”¨-ç­‰å¾…-é€šçŸ¥-æœºåˆ¶ä¼˜åŒ–å¾ªç¯ç­‰å¾…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_06-ç”¨-ç­‰å¾…-é€šçŸ¥-æœºåˆ¶ä¼˜åŒ–å¾ªç¯ç­‰å¾…"}},[s._v("#")]),s._v(' 06-ç”¨"ç­‰å¾…-é€šçŸ¥"æœºåˆ¶ä¼˜åŒ–å¾ªç¯ç­‰å¾…')]),s._v(" "),t("p",[s._v("ç”±ä¸Šä¸€èŠ‚ä½ åº”è¯¥å·²ç»çŸ¥é“, åœ¨"),t("strong",[s._v("ç ´åå ç”¨ä¸”ç­‰å¾…æ¡ä»¶")]),s._v("çš„æ—¶å€™, å¦‚æœè½¬å‡ºè´¦æœ¬å’Œè½¬å…¥è´¦æœ¬ä¸æ»¡è¶³åŒæ—¶åœ¨æ–‡ä»¶æ¶ä¸Šè¿™ä¸ªæ¡ä»¶, å°±ç”¨æ­»å¾ªç¯çš„æ–¹å¼æ¥å¾ªç¯ç­‰å¾…, æ ¸å¿ƒä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸€æ¬¡æ€§ç”³è¯·è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·, ç›´åˆ°æˆåŠŸ ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("actr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å¦‚æœ apply() æ“ä½œè€—æ—¶éå¸¸çŸ­, è€Œä¸”å¹¶å‘å†²çªé‡ä¹Ÿä¸å¤§æ—¶, è¿™ä¸ªæ–¹æ¡ˆè¿˜æŒºä¸é”™çš„, å› ä¸ºè¿™ç§åœºæ™¯ä¸‹, "),t("strong",[s._v("å¾ªç¯")]),s._v("ä¸Šå‡ æ¬¡æˆ–è€…å‡ åæ¬¡å°±èƒ½ä¸€æ¬¡æ€§è·å–è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·äº†. ä½†æ˜¯å¦‚æœ apply() æ“ä½œè€—æ—¶é•¿, æˆ–è€…å¹¶å‘å†²çªé‡å¤§çš„æ—¶å€™, å¾ªç¯ç­‰å¾…è¿™ç§æ–¹æ¡ˆå°±ä¸é€‚ç”¨äº†, å› ä¸ºåœ¨è¿™ç§åœºæ™¯ä¸‹, å¯èƒ½è¦å¾ªç¯ä¸Šä¸‡æ¬¡æ‰èƒ½è·å–åˆ°é”, "),t("strong",[s._v("å¤ªæ¶ˆè€— CPU äº†")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶å®åœ¨è¿™ç§åœºæ™¯ä¸‹, æœ€å¥½çš„æ–¹æ¡ˆåº”è¯¥æ˜¯: å¦‚æœçº¿ç¨‹è¦æ±‚çš„æ¡ä»¶(è½¬å‡ºè´¦æœ¬å’Œè½¬å…¥è´¦æœ¬åŒåœ¨æ–‡ä»¶æ¶ä¸Š)ä¸æ»¡è¶³, åˆ™"),t("strong",[s._v("çº¿ç¨‹é˜»å¡è‡ªå·±")]),s._v(", è¿›å…¥"),t("strong",[s._v("ç­‰å¾…")]),s._v("çŠ¶æ€; å½“çº¿ç¨‹è¦æ±‚çš„æ¡ä»¶(è½¬å‡ºè´¦æœ¬å’Œè½¬å…¥è´¦æœ¬åŒåœ¨æ–‡ä»¶æ¶ä¸Š)æ»¡è¶³å, "),t("strong",[s._v("é€šçŸ¥")]),s._v("ç­‰å¾…çš„çº¿ç¨‹é‡æ–°æ‰§è¡Œ. å…¶ä¸­, "),t("strong",[s._v("ä½¿ç”¨çº¿ç¨‹é˜»å¡çš„æ–¹å¼å°±èƒ½é¿å…å¾ªç¯ç­‰å¾…æ¶ˆè€— CPU çš„é—®é¢˜, è€Œä¸æ˜¯ä½¿ç”¨æ­»å¾ªç¯ä¸€ç›´æµªè´¹ CPU")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ Java è¯­è¨€æ˜¯å¦æ”¯æŒè¿™ç§"),t("strong",[s._v("ç­‰å¾…-é€šçŸ¥æœºåˆ¶")]),s._v("å‘¢? ç­”æ¡ˆæ˜¯: ä¸€å®šæ”¯æŒ(æ¯•ç«Ÿå æ®æ’è¡Œæ¦œç¬¬ä¸€é‚£ä¹ˆä¹…). ä¸‹é¢å°±æ¥çœ‹çœ‹ Java è¯­è¨€æ˜¯å¦‚ä½•æ”¯æŒ"),t("strong",[s._v("ç­‰å¾…-é€šçŸ¥æœºåˆ¶")]),s._v("çš„.")]),s._v(" "),t("h5",{attrs:{id:"å®Œç¾çš„å°±åŒ»æµç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®Œç¾çš„å°±åŒ»æµç¨‹"}},[s._v("#")]),s._v(" å®Œç¾çš„å°±åŒ»æµç¨‹")]),s._v(" "),t("p",[s._v("åœ¨ä»‹ç» Java è¯­è¨€å¦‚ä½•æ”¯æŒ ç­‰å¾…-é€šçŸ¥æœºåˆ¶ ä¹‹å‰, å…ˆçœ‹ä¸€ä¸ªç°å®ä¸–ç•Œé‡Œé¢çš„å°±åŒ»æµç¨‹, å› ä¸ºå®ƒæœ‰ç€å®Œå–„çš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶, æ‰€ä»¥å¯¹æ¯”å°±åŒ»æµç¨‹, æˆ‘ä»¬å°±èƒ½æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨å¹¶å‘ç¼–ç¨‹ä¸­çš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶.")]),s._v(" "),t("p",[s._v("å°±åŒ»æµç¨‹åŸºæœ¬ä¸Šæ˜¯è¿™æ ·:")]),s._v(" "),t("ol",[t("li",[s._v("æ‚£è€…å…ˆå»æŒ‚å·, ç„¶ååˆ°å°±è¯Šé—¨å£åˆ†è¯Š, ç­‰å¾…å«å·;")]),s._v(" "),t("li",[s._v("å½“å«åˆ°è‡ªå·±çš„å·æ—¶, æ‚£è€…å°±å¯ä»¥æ‰¾å¤§å¤«å°±è¯Šäº†;")]),s._v(" "),t("li",[s._v("å°±è¯Šè¿‡ç¨‹ä¸­, å¤§å¤«å¯èƒ½ä¼šè®©æ‚£è€…å»åšæ£€æŸ¥, åŒæ—¶å«ä¸‹ä¸€ä½æ‚£è€…;")]),s._v(" "),t("li",[s._v("å½“æ‚£è€…åšå®Œæ£€æŸ¥å, æ‹¿æ£€æµ‹æŠ¥å‘Šé‡æ–°åˆ†è¯Š, ç­‰å¾…å«å·;")]),s._v(" "),t("li",[s._v("å½“å¤§å¤«å†æ¬¡å«åˆ°è‡ªå·±çš„å·æ—¶, æ‚£è€…å†å»æ‰¾å¤§å¤«å°±è¯Š.")])]),s._v(" "),t("p",[s._v('æˆ–è®¸ä½ å·²ç»å‘ç°äº†, è¿™ä¸ªæœ‰ç€å®Œç¾ç­‰å¾…-é€šçŸ¥æœºåˆ¶çš„å°±åŒ»æµç¨‹, ä¸ä»…èƒ½å¤Ÿä¿è¯åŒä¸€æ—¶åˆ»å¤§å¤«åªä¸ºä¸€ä¸ªæ‚£è€…æœåŠ¡, è€Œä¸”è¿˜èƒ½å¤Ÿä¿è¯å¤§å¤«å’Œæ‚£è€…çš„æ•ˆç‡. ä¸æ­¤åŒæ—¶ä½ å¯èƒ½ä¹Ÿä¼šæœ‰ç–‘é—®, "è¿™ä¸ªå°±åŒ»æµç¨‹å¾ˆå¤æ‚å‘€, å‰é¢æè¿°çš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶ç›¸è¾ƒè€Œè¨€æ˜¯ä¸æ˜¯å¤ªç®€å•äº†?" é‚£è¿™ä¸ªå¤æ‚åº¦æ˜¯å¦æ˜¯å¿…é¡»çš„å‘¢? è¿™ä¸ªæ˜¯å¿…é¡»çš„, æˆ‘ä»¬ä¸èƒ½å¿½è§†ç­‰å¾…-é€šçŸ¥æœºåˆ¶ä¸­çš„ä¸€äº›ç»†èŠ‚.')]),s._v(" "),t("p",[s._v("ä¸‹é¢æ¥å¯¹æ¯”çœ‹ä¸€ä¸‹å‰é¢éƒ½å¿½è§†äº†å“ªäº›ç»†èŠ‚.")]),s._v(" "),t("ol",[t("li",[s._v("æ‚£è€…åˆ°å°±è¯Šé—¨å£åˆ†è¯Š, ç±»ä¼¼äºçº¿ç¨‹è¦"),t("strong",[s._v("å»è·å–äº’æ–¥é”")]),s._v("; å½“æ‚£è€…è¢«å«åˆ°æ—¶, ç±»ä¼¼çº¿ç¨‹å·²ç»"),t("strong",[s._v("è·å–åˆ°é”")]),s._v("äº†.")]),s._v(" "),t("li",[s._v("å¤§å¤«è®©æ‚£è€…å»åšæ£€æŸ¥(ç¼ºä¹æ£€æµ‹æŠ¥å‘Šä¸èƒ½è¯Šæ–­ç—…å› ), ç±»ä¼¼äºçº¿ç¨‹è¦æ±‚çš„"),t("strong",[s._v("æ¡ä»¶æ²¡æœ‰æ»¡è¶³")]),s._v(".")]),s._v(" "),t("li",[s._v("æ‚£è€…å»åšæ£€æŸ¥, ç±»ä¼¼äºçº¿ç¨‹è¿›å…¥"),t("strong",[s._v("ç­‰å¾…çŠ¶æ€")]),s._v("; ç„¶å"),t("strong",[s._v("å¤§å¤«å«ä¸‹ä¸€ä¸ªæ‚£è€…, è¿™ä¸ªæ­¥éª¤åœ¨å‰é¢çš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶ä¸­å¿½è§†äº†, è¿™ä¸ªæ­¥éª¤å¯¹åº”åˆ°ç¨‹åºé‡Œ, æœ¬è´¨æ˜¯çº¿ç¨‹é‡Šæ”¾æŒæœ‰çš„äº’æ–¥é”")]),s._v(".")]),s._v(" "),t("li",[s._v("æ‚£è€…åšå®Œæ£€æŸ¥, ç±»ä¼¼äºçº¿ç¨‹è¦æ±‚çš„"),t("strong",[s._v("æ¡ä»¶å·²ç»æ»¡è¶³")]),s._v("; "),t("strong",[s._v("æ‚£è€…æ‹¿æ£€æµ‹æŠ¥å‘Šé‡æ–°åˆ†è¯Š, ç±»ä¼¼äºçº¿ç¨‹éœ€è¦é‡æ–°è·å–äº’æ–¥é”, è¿™ä¸ªæ­¥éª¤åœ¨å‰é¢çš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶ä¸­ä¹Ÿå¿½è§†äº†")]),s._v(".")])]),s._v(" "),t("p",[s._v("æ‰€ä»¥åŠ ä¸Šè¿™äº›è‡³å…³é‡è¦çš„ç»†èŠ‚, ç»¼åˆä¸€ä¸‹, å°±å¯ä»¥å¾—å‡º"),t("mark",[t("strong",[s._v("ä¸€ä¸ªå®Œæ•´çš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶: çº¿ç¨‹é¦–å…ˆè·å–äº’æ–¥é”, å½“çº¿ç¨‹è¦æ±‚çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶, é‡Šæ”¾äº’æ–¥é”, è¿›å…¥ç­‰å¾…çŠ¶æ€; å½“è¦æ±‚çš„æ¡ä»¶æ»¡è¶³æ—¶, é€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹, é‡æ–°è·å–äº’æ–¥é”")])]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ç”¨synchronizedå®ç°ç­‰å¾…-é€šçŸ¥æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨synchronizedå®ç°ç­‰å¾…-é€šçŸ¥æœºåˆ¶"}},[s._v("#")]),s._v(" ç”¨synchronizedå®ç°ç­‰å¾…-é€šçŸ¥æœºåˆ¶")]),s._v(" "),t("p",[s._v("åœ¨ Java é‡Œ, ç­‰å¾…-é€šçŸ¥æœºåˆ¶å¯ä»¥æœ‰å¤šç§å®ç°æ–¹å¼, æ¯”å¦‚ Java è¯­è¨€å†…ç½®çš„ "),t("strong",[s._v("synchronized é…åˆ wait(), notify(), notifyAll()")]),s._v("  è¿™ä¸‰ä¸ªæ–¹æ³•å°±èƒ½è½»æ¾å®ç°.")]),s._v(" "),t("p",[s._v("å¦‚ä½•ç”¨ synchronized å®ç°äº’æ–¥é”, ä½ åº”è¯¥å·²ç»å¾ˆç†Ÿæ‚‰äº†. åœ¨ä¸‹é¢è¿™ä¸ªå›¾é‡Œ, å·¦è¾¹æœ‰ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—, åŒä¸€æ—¶åˆ», åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ synchronized ä¿æŠ¤çš„ä¸´ç•ŒåŒº(è¿™ä¸ªä¸´ç•ŒåŒºå¯ä»¥çœ‹ä½œå¤§å¤«çš„è¯Šå®¤), å½“æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºå, å…¶ä»–çº¿ç¨‹å°±åªèƒ½è¿›å…¥å›¾ä¸­å·¦è¾¹çš„ç­‰å¾…é˜Ÿåˆ—é‡Œç­‰å¾…(ç›¸å½“äºæ‚£è€…åˆ†è¯Šç­‰å¾…). **è¿™ä¸ªç­‰å¾…é˜Ÿåˆ—å’Œäº’æ–¥é”æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³», æ¯ä¸ªäº’æ–¥é”éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ç­‰å¾…é˜Ÿåˆ—. **")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/9196583fbadda6b514449ea9220a3b81-20230731162452-4p49khp.png",alt:"",title:"wait() æ“ä½œå·¥ä½œåŸç†å›¾"}})]),s._v(" "),t("p",[s._v("åœ¨å¹¶å‘ç¨‹åºä¸­, å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºå, ç”±äºæŸäº›æ¡ä»¶ä¸æ»¡è¶³, éœ€è¦è¿›å…¥"),t("strong",[s._v("ç­‰å¾…çŠ¶æ€")]),s._v(", Java å¯¹è±¡çš„ wait() æ–¹æ³•å°±èƒ½å¤Ÿæ»¡è¶³è¿™ç§éœ€æ±‚. å¦‚ä¸Šå›¾æ‰€ç¤º, å½“è°ƒç”¨ wait() æ–¹æ³•å, "),t("strong",[s._v("å½“å‰çº¿ç¨‹å°±ä¼šè¢«é˜»å¡")]),s._v(", å¹¶ä¸”è¿›å…¥åˆ°å³è¾¹çš„ç­‰å¾…é˜Ÿåˆ—ä¸­, "),t("strong",[s._v("è¿™ä¸ªç­‰å¾…é˜Ÿåˆ—ä¹Ÿæ˜¯äº’æ–¥é”çš„ç­‰å¾…é˜Ÿåˆ—")]),s._v(". çº¿ç¨‹åœ¨è¿›å…¥ç­‰å¾…é˜Ÿåˆ—çš„åŒæ—¶, "),t("strong",[s._v("ä¼šé‡Šæ”¾æŒæœ‰çš„äº’æ–¥é”")]),s._v(", çº¿ç¨‹é‡Šæ”¾é”å, å…¶ä»–çº¿ç¨‹å°±æœ‰æœºä¼šè·å¾—é”, å¹¶è¿›å…¥ä¸´ç•ŒåŒºäº†.")]),s._v(" "),t("p",[s._v("é‚£çº¿ç¨‹è¦æ±‚çš„æ¡ä»¶æ»¡è¶³æ—¶, è¯¥æ€ä¹ˆé€šçŸ¥è¿™ä¸ªç­‰å¾…çš„çº¿ç¨‹å‘¢? å¾ˆç®€å•, å°±æ˜¯ Java å¯¹è±¡çš„ notify() å’Œ notifyAll() æ–¹æ³•. ä¸‹é¢è¿™ä¸ªå›¾é‡Œå¤§è‡´æè¿°äº†è¿™ä¸ªè¿‡ç¨‹, å½“æ¡ä»¶æ»¡è¶³æ—¶è°ƒç”¨ notify(), ä¼šé€šçŸ¥ç­‰å¾…é˜Ÿåˆ—("),t("strong",[s._v("äº’æ–¥é”çš„ç­‰å¾…é˜Ÿåˆ—")]),s._v(")ä¸­çš„çº¿ç¨‹, å‘Šè¯‰å®ƒ"),t("strong",[s._v("æ¡ä»¶æ›¾ç»æ»¡è¶³è¿‡")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/16e8842d3499830a59c03f38f75f0885-20230731162452-nl0nzcb.png",alt:"",title:"notify() æ“ä½œå·¥ä½œåŸç†å›¾"}})]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆè¯´æ˜¯æ›¾ç»æ»¡è¶³è¿‡å‘¢? å› ä¸º"),t("strong",[s._v("notify() åªèƒ½ä¿è¯åœ¨é€šçŸ¥æ—¶é—´ç‚¹, æ¡ä»¶æ˜¯æ»¡è¶³çš„")]),s._v(". è€Œè¢«é€šçŸ¥çº¿ç¨‹çš„"),t("strong",[s._v("æ‰§è¡Œæ—¶é—´ç‚¹å’Œé€šçŸ¥çš„æ—¶é—´ç‚¹")]),s._v("åŸºæœ¬ä¸Šä¸ä¼šé‡åˆ, æ‰€ä»¥å½“çº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™, å¾ˆå¯èƒ½æ¡ä»¶å·²ç»ä¸æ»¡è¶³äº†(ä¿ä¸é½æœ‰å…¶ä»–çº¿ç¨‹æ’é˜Ÿ). è¿™ä¸€ç‚¹éœ€è¦æ ¼å¤–æ³¨æ„.")]),s._v(" "),t("p",[s._v("é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹, è¢«é€šçŸ¥çš„çº¿ç¨‹è¦æƒ³é‡æ–°æ‰§è¡Œ, "),t("strong",[s._v("ä»ç„¶éœ€è¦è·å–åˆ°äº’æ–¥é”")]),s._v("(å› ä¸ºæ›¾ç»è·å–çš„é”åœ¨è°ƒç”¨ wait() æ—¶å·²ç»"),t("strong",[s._v("é‡Šæ”¾")]),s._v("äº†).")]),s._v(" "),t("p",[s._v("ä¸Šé¢ä¸€ç›´å¼ºè°ƒ wait(), notify(), notifyAll() æ–¹æ³•æ“ä½œçš„ç­‰å¾…é˜Ÿåˆ—æ˜¯äº’æ–¥é”çš„ç­‰å¾…é˜Ÿåˆ—, æ‰€ä»¥"),t("strong",[s._v("å¦‚æœ synchronized é”å®šçš„æ˜¯ this, é‚£ä¹ˆå¯¹åº”çš„ä¸€å®šæ˜¯ this.wait(), this.notify(), this.notifyAll(); å¦‚æœ synchronized é”å®šçš„æ˜¯ target, é‚£ä¹ˆå¯¹åº”çš„ä¸€å®šæ˜¯ target.wait(), target.notify(), target.notifyAll()")]),s._v(" . è€Œä¸” wait(), notify(), notifyAll() è¿™ä¸‰ä¸ªæ–¹æ³•èƒ½å¤Ÿè¢«è°ƒç”¨çš„"),t("strong",[s._v("å‰ææ˜¯å·²ç»è·å–äº†ç›¸åº”çš„äº’æ–¥é”")]),s._v(", æ‰€ä»¥ä¼šå‘ç° wait(), notify(), notifyAll() éƒ½æ˜¯åœ¨ synchronized{} å†…éƒ¨è¢«è°ƒç”¨çš„. å¦‚æœåœ¨ synchronized{} å¤–éƒ¨è°ƒç”¨, æˆ–è€…é”å®šçš„ this, è€Œç”¨ target.wait() è°ƒç”¨çš„è¯, JVM ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸: "),t("code",[s._v("java.lang.IllegalMonitorStateException")]),s._v("â€‹.")]),s._v(" "),t("h5",{attrs:{id:"å°è¯•ç‰›åˆ€-ä¸€ä¸ªæ›´å¥½åœ°èµ„æºåˆ†é…å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°è¯•ç‰›åˆ€-ä¸€ä¸ªæ›´å¥½åœ°èµ„æºåˆ†é…å™¨"}},[s._v("#")]),s._v(" å°è¯•ç‰›åˆ€:ä¸€ä¸ªæ›´å¥½åœ°èµ„æºåˆ†é…å™¨")]),s._v(" "),t("p",[s._v("ç­‰å¾…-é€šçŸ¥æœºåˆ¶çš„åŸºæœ¬åŸç†ææ¸…æ¥šå, å°±æ¥çœ‹çœ‹å®ƒå¦‚ä½•è§£å†³ä¸€æ¬¡æ€§ç”³è¯·è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·çš„é—®é¢˜å§. åœ¨è¿™ä¸ªç­‰å¾…-é€šçŸ¥æœºåˆ¶ä¸­, éœ€è¦è€ƒè™‘ä»¥ä¸‹å››ä¸ªè¦ç´ .")]),s._v(" "),t("ol",[t("li",[s._v("äº’æ–¥é”: å‰é¢æåˆ° Allocator éœ€è¦æ˜¯å•ä¾‹çš„, æ‰€ä»¥å¯ä»¥"),t("strong",[s._v("ç”¨ this ä½œä¸ºäº’æ–¥é”")]),s._v(".")]),s._v(" "),t("li",[s._v("çº¿ç¨‹è¦æ±‚çš„æ¡ä»¶: è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·"),t("strong",[s._v("éƒ½æ²¡æœ‰è¢«åˆ†é…è¿‡")]),s._v(".")]),s._v(" "),t("li",[s._v("ä½•æ—¶ç­‰å¾…: çº¿ç¨‹è¦æ±‚çš„"),t("strong",[s._v("æ¡ä»¶ä¸æ»¡è¶³å°±ç­‰å¾…")]),s._v(".")]),s._v(" "),t("li",[s._v("ä½•æ—¶é€šçŸ¥: å½“æœ‰çº¿ç¨‹é‡Šæ”¾è´¦æˆ·æ—¶å°±é€šçŸ¥.")])]),s._v(" "),t("p",[s._v("å°†ä¸Šé¢å‡ ä¸ªé—®é¢˜è€ƒè™‘æ¸…æ¥š, å¯ä»¥å¿«é€Ÿå®Œæˆä¸‹é¢çš„ä»£ç . éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨äº†:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("æ¡ä»¶ä¸æ»¡è¶³"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("åˆ©ç”¨è¿™ç§èŒƒå¼å¯ä»¥è§£å†³ä¸Šé¢æåˆ°çš„"),t("strong",[s._v("æ¡ä»¶æ›¾ç»æ»¡è¶³è¿‡")]),s._v("è¿™ä¸ªé—®é¢˜. å› ä¸ºå½“ wait() è¿”å›æ—¶, æœ‰å¯èƒ½æ¡ä»¶å·²ç»å‘ç”Ÿå˜åŒ–äº†, æ›¾ç»æ¡ä»¶æ»¡è¶³, ä½†æ˜¯ç°åœ¨å·²ç»ä¸æ»¡è¶³äº†, æ‰€ä»¥"),t("strong",[s._v("è¦é‡æ–°æ£€éªŒæ¡ä»¶æ˜¯å¦æ»¡è¶³")]),s._v('. èŒƒå¼, æ„å‘³ç€æ˜¯ç»å…¸åšæ³•, æ‰€ä»¥æ²¡æœ‰ç‰¹æ®Šç†ç”±ä¸è¦å°è¯•æ¢ä¸ªå†™æ³•. åé¢åœ¨ä»‹ç»"ç®¡ç¨‹"çš„æ—¶å€™, ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸ªç»å…¸åšæ³•çš„å‰ä¸–ä»Šç”Ÿ.')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Allocator")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰èµ„æº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»å…¸å†™æ³•")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿›è¡Œç­‰å¾…")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å”¤é†’åä¼šç»§ç»­è¿›å…¥åˆ°whileä¸­å†æ¬¡åˆ¤æ–­æ¡ä»¶æ˜¯å¦æ»¡è¶³ ä¸æ»¡è¶³åˆ™ç»§ç»­ç­‰å¾…")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ»¡è¶³æ¡ä»¶: è·å¾—èµ„æº")]),s._v("\n        als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½’è¿˜èµ„æº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        als"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("notifyAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h5",{attrs:{id:"å°½é‡ä½¿ç”¨notifyall"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°½é‡ä½¿ç”¨notifyall"}},[s._v("#")]),s._v(" å°½é‡ä½¿ç”¨notifyAll()")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šé¢çš„ä»£ç ä¸­, ç”¨çš„æ˜¯ notifyAll() æ¥å®ç°é€šçŸ¥æœºåˆ¶, ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ notify() å‘¢? è¿™äºŒè€…æ˜¯æœ‰åŒºåˆ«çš„, "),t("strong",[s._v("notify() æ˜¯ä¼šéšæœºåœ°é€šçŸ¥ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹, è€Œ notifyAll() ä¼šé€šçŸ¥ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹")]),s._v(". ä»æ„Ÿè§‰ä¸Šæ¥è®², åº”è¯¥æ˜¯ notify() æ›´å¥½ä¸€äº›, å› ä¸ºå³ä¾¿é€šçŸ¥æ‰€æœ‰çº¿ç¨‹, ä¹Ÿåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒº. ä½†é‚£æ‰€è°“çš„æ„Ÿè§‰å¾€å¾€éƒ½è•´è—ç€é£é™©, å®é™…ä¸Šä½¿ç”¨ notify() ä¹Ÿå¾ˆæœ‰é£é™©, "),t("strong",[s._v("å®ƒçš„é£é™©åœ¨äºå¯èƒ½å¯¼è‡´æŸäº›çº¿ç¨‹æ°¸è¿œä¸ä¼šè¢«é€šçŸ¥åˆ°")]),s._v(".")]),s._v(" "),t("p",[s._v("å‡è®¾æœ‰èµ„æº A, B, C, D, çº¿ç¨‹ 1 ç”³è¯·åˆ°äº† AB, çº¿ç¨‹ 2 ç”³è¯·åˆ°äº† CD, æ­¤æ—¶çº¿ç¨‹ 3 ç”³è¯· AB, ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—(AB åˆ†é…ç»™çº¿ç¨‹ 1, çº¿ç¨‹ 3 è¦æ±‚çš„æ¡ä»¶ä¸æ»¡è¶³), çº¿ç¨‹ 4 ç”³è¯· CD ä¹Ÿä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—. å†å‡è®¾ä¹‹åçº¿ç¨‹ 1 å½’è¿˜äº†èµ„æº AB, å¦‚æœä½¿ç”¨ notify() æ¥é€šçŸ¥ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹, æœ‰å¯èƒ½è¢«é€šçŸ¥çš„æ˜¯çº¿ç¨‹ 4, ä½†çº¿ç¨‹ 4 ç”³è¯·çš„æ˜¯ CD, æ‰€ä»¥æ­¤æ—¶çº¿ç¨‹ 4 è¿˜æ˜¯ä¼šç»§ç»­ç­‰å¾…, è€ŒçœŸæ­£è¯¥å”¤é†’çš„çº¿ç¨‹ 3 å°±å†ä¹Ÿæ²¡æœ‰æœºä¼šè¢«å”¤é†’äº†.")]),s._v(" "),t("p",[t("strong",[s._v("æ‰€ä»¥é™¤éç»è¿‡æ·±æ€ç†Ÿè™‘, å¦åˆ™å°½é‡ä½¿ç”¨ notifyAll()")]),s._v(" .")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-6"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("ç­‰å¾…-é€šçŸ¥æœºåˆ¶æ˜¯ä¸€ç§éå¸¸æ™®éçš„çº¿ç¨‹é—´åä½œçš„æ–¹å¼. å·¥ä½œä¸­ç»å¸¸çœ‹åˆ°æœ‰åŒå­¦ä½¿ç”¨è½®è¯¢çš„æ–¹å¼æ¥ç­‰å¾…æŸä¸ªçŠ¶æ€, å…¶å®å¾ˆå¤šæƒ…å†µä¸‹éƒ½å¯ä»¥ç”¨ä»Šå¤©ä»‹ç»çš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶æ¥ä¼˜åŒ–. Java è¯­è¨€å†…ç½®çš„ "),t("strong",[s._v("synchronized é…åˆ wait(), notify(), notifyAll() è¿™ä¸‰ä¸ªæ–¹æ³•å¯ä»¥å¿«é€Ÿå®ç°è¿™ç§æœºåˆ¶")]),s._v(", ä½†æ˜¯å®ƒä»¬çš„ä½¿ç”¨çœ‹ä¸Šå»è¿˜æ˜¯æœ‰ç‚¹å¤æ‚, æ‰€ä»¥éœ€è¦è®¤çœŸç†è§£ç­‰å¾…é˜Ÿåˆ—å’Œ wait(), notify(), notifyAll() çš„å…³ç³». æœ€å¥½ç”¨ç°å®ä¸–ç•Œåšä¸ªç±»æ¯”, è¿™æ ·æœ‰åŠ©äºä½ çš„ç†è§£.")]),s._v(" "),t("h4",{attrs:{id:"_07-å®‰å…¨æ€§-æ´»è·ƒæ€§ä»¥åŠæ€§èƒ½é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_07-å®‰å…¨æ€§-æ´»è·ƒæ€§ä»¥åŠæ€§èƒ½é—®é¢˜"}},[s._v("#")]),s._v(" 07-å®‰å…¨æ€§,æ´»è·ƒæ€§ä»¥åŠæ€§èƒ½é—®é¢˜")]),s._v(" "),t("p",[s._v("é€šè¿‡å‰é¢å…­èŠ‚å¼€å¯äº†ä¸€ä¸ªç®€å•çš„å¹¶å‘æ—…ç¨‹, ç›¸ä¿¡ç°åœ¨ä½ å¯¹å¹¶å‘ç¼–ç¨‹éœ€è¦æ³¨æ„çš„é—®é¢˜å·²ç»æœ‰äº†æ›´æ·±å…¥çš„ç†è§£, è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¿›æ­¥, æ­£æ‰€è°“åªæœ‰å‘ç°é—®é¢˜, æ‰èƒ½è§£å†³é—®é¢˜. ä½†æ˜¯å‰é¢å…­ç¯‡æ–‡ç« çš„çŸ¥è¯†ç‚¹å¯èƒ½è¿˜æ˜¯æœ‰ç‚¹åˆ†æ•£, æ‰€ä»¥æ˜¯æ—¶å€™å°†å…¶æ€»ç»“ä¸€ä¸‹äº†.")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜æœ‰å¾ˆå¤š, å¾ˆåº†å¹¸å‰äººå·²ç»æ€»ç»“è¿‡äº†, ä¸»è¦æœ‰ä¸‰ä¸ªæ–¹é¢, åˆ†åˆ«æ˜¯: "),t("strong",[s._v("å®‰å…¨æ€§é—®é¢˜, æ´»è·ƒæ€§é—®é¢˜å’Œæ€§èƒ½é—®é¢˜")]),s._v(". ä¸‹é¢å°±æ¥ä¸€ä¸€ä»‹ç»è¿™äº›é—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"å®‰å…¨æ€§é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨æ€§é—®é¢˜"}},[s._v("#")]),s._v(" å®‰å…¨æ€§é—®é¢˜")]),s._v(" "),t("p",[s._v("ç›¸ä¿¡ä½ ä¸€å®šå¬è¯´è¿‡ç±»ä¼¼è¿™æ ·çš„æè¿°: è¿™ä¸ªæ–¹æ³•ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„, è¿™ä¸ªç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„, ç­‰ç­‰.")]),s._v(" "),t("p",[s._v("é‚£ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨å‘¢? å…¶å®æœ¬è´¨ä¸Šå°±æ˜¯"),t("strong",[s._v("æ­£ç¡®æ€§")]),s._v(", è€Œæ­£ç¡®æ€§çš„å«ä¹‰å°±æ˜¯"),t("strong",[s._v("ç¨‹åºæŒ‰ç…§è‡ªå·±æœŸæœ›çš„æ‰§è¡Œ")]),s._v(". é‚£å¦‚ä½•æ‰èƒ½å†™å‡ºçº¿ç¨‹å®‰å…¨çš„ç¨‹åºå‘¢? å‰é¢å·²ç»ä»‹ç»äº†å¹¶å‘ Bug çš„ä¸‰ä¸ªä¸»è¦æºå¤´: "),t("strong",[s._v("åŸå­æ€§é—®é¢˜, å¯è§æ€§é—®é¢˜å’Œæœ‰åºæ€§é—®é¢˜")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, ç†è®ºä¸Šçº¿ç¨‹å®‰å…¨çš„ç¨‹åº, å°±è¦é¿å…å‡ºç°åŸå­æ€§é—®é¢˜, å¯è§æ€§é—®é¢˜å’Œæœ‰åºæ€§é—®é¢˜.")]),s._v(" "),t("p",[s._v("é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰çš„ä»£ç éƒ½éœ€è¦è®¤çœŸåˆ†æä¸€éæ˜¯å¦å­˜åœ¨è¿™ä¸‰ä¸ªé—®é¢˜å‘¢? å½“ç„¶ä¸æ˜¯, å…¶å®åªæœ‰ä¸€ç§æƒ…å†µéœ€è¦: "),t("mark",[t("strong",[s._v("å­˜åœ¨å…±äº«æ•°æ®å¹¶ä¸”è¯¥æ•°æ®ä¼šå‘ç”Ÿå˜åŒ–, é€šä¿—åœ°è®²å°±æ˜¯æœ‰å¤šä¸ªçº¿ç¨‹ä¼šåŒæ—¶è¯»å†™åŒä¸€æ•°æ®")])]),s._v(". é‚£å¦‚æœèƒ½å¤Ÿåšåˆ°"),t("strong",[s._v("ä¸å…±äº«æ•°æ®æˆ–è€…æ•°æ®çŠ¶æ€ä¸å‘ç”Ÿå˜åŒ–, ä¸å°±èƒ½å¤Ÿä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§")]),s._v("äº†å˜›. æœ‰ä¸å°‘æŠ€æœ¯æ–¹æ¡ˆéƒ½æ˜¯åŸºäºè¿™ä¸ªç†è®ºçš„, ä¾‹å¦‚"),t("strong",[s._v("çº¿ç¨‹æœ¬åœ°å­˜å‚¨(Thread Local Storage, TLS), ä¸å˜æ¨¡å¼")]),s._v("ç­‰ç­‰, åé¢ä¼šè¯¦ç»†ä»‹ç»ç›¸å…³çš„æŠ€æœ¯æ–¹æ¡ˆæ˜¯å¦‚ä½•åœ¨ Java è¯­è¨€ä¸­å®ç°çš„.")]),s._v(" "),t("p",[s._v("ä½†ç°å®ç”Ÿæ´»ä¸­, "),t("strong",[s._v("å¿…é¡»å…±äº«ä¼šå‘ç”Ÿå˜åŒ–çš„æ•°æ®")]),s._v(", è¿™æ ·çš„åº”ç”¨åœºæ™¯è¿˜æ˜¯å¾ˆå¤šçš„.")]),s._v(" "),t("p",[s._v("å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€æ•°æ®, å¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šå†™è¿™ä¸ªæ•°æ®çš„æ—¶å€™, å¦‚æœä¸é‡‡å–é˜²æŠ¤æªæ–½, é‚£ä¹ˆå°±ä¼šå¯¼è‡´å¹¶å‘ Bug, å¯¹æ­¤è¿˜æœ‰ä¸€ä¸ªä¸“ä¸šçš„æœ¯è¯­, å«åš"),t("strong",[s._v("æ•°æ®ç«äº‰")]),s._v("(Data Race). æ¯”å¦‚, å‰é¢çš„ add10K() çš„æ–¹æ³•, å½“å¤šä¸ªçº¿ç¨‹è°ƒç”¨æ—¶å€™å°±ä¼šå‘ç”Ÿ"),t("strong",[s._v("æ•°æ®ç«äº‰")]),s._v(", å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add10K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" idx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("idx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("é‚£æ˜¯ä¸æ˜¯åœ¨è®¿é—®æ•°æ®çš„åœ°æ–¹, åŠ ä¸ªé”ä¿æŠ¤ä¸€ä¸‹å°±èƒ½è§£å†³æ‰€æœ‰çš„å¹¶å‘é—®é¢˜äº†å‘¢? æ˜¾ç„¶æ²¡æœ‰è¿™ä¹ˆç®€å•. ä¾‹å¦‚, å¯¹äºä¸Šé¢ç¤ºä¾‹, ç¨ä½œä¿®æ”¹, å¢åŠ ä¸¤ä¸ªè¢« synchronized ä¿®é¥°çš„ get() å’Œ set() æ–¹æ³•,  add10K() æ–¹æ³•é‡Œé¢é€šè¿‡ get() å’Œ set() æ–¹æ³•æ¥è®¿é—® value å˜é‡, ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤º. å¯¹äºä¿®æ”¹åçš„ä»£ç , æ‰€æœ‰è®¿é—®å…±äº«å˜é‡ value çš„åœ°æ–¹, éƒ½å¢åŠ äº†äº’æ–¥é”, æ­¤æ—¶æ˜¯ä¸å­˜åœ¨æ•°æ®ç«äº‰çš„. ä½†å¾ˆæ˜¾ç„¶ä¿®æ”¹åçš„ add10K() æ–¹æ³•"),t("strong",[s._v("å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add10K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" idx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("idx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("å‡è®¾ count=0, å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ get() æ–¹æ³•æ—¶, get() æ–¹æ³•ä¼šè¿”å›ç›¸åŒçš„å€¼ 0, ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œ get()+1 æ“ä½œ, ç»“æœéƒ½æ˜¯ 1, ä¹‹åä¸¤ä¸ªçº¿ç¨‹å†å°†ç»“æœ 1 å†™å…¥äº†å†…å­˜. ä½ æœ¬æ¥æœŸæœ›çš„æ˜¯ 2, è€Œç»“æœå´æ˜¯ 1.")]),s._v(" "),t("p",[s._v("è¿™ç§é—®é¢˜, æœ‰ä¸ªå®˜æ–¹çš„ç§°å‘¼, å«"),t("strong",[s._v("ç«æ€æ¡ä»¶")]),s._v("(Race Condition). æ‰€è°“"),t("strong",[s._v("ç«æ€æ¡ä»¶, æŒ‡çš„æ˜¯ç¨‹åºçš„æ‰§è¡Œç»“æœä¾èµ–çº¿ç¨‹æ‰§è¡Œçš„é¡ºåº")]),s._v(". ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­, å¦‚æœ"),t("strong",[s._v("ä¸¤ä¸ªçº¿ç¨‹å®Œå…¨åŒæ—¶æ‰§è¡Œ")]),s._v(", é‚£ä¹ˆç»“æœæ˜¯ 1; å¦‚æœä¸¤ä¸ªçº¿ç¨‹æ˜¯å‰åæ‰§è¡Œ, é‚£ä¹ˆç»“æœå°±æ˜¯ 2. åœ¨å¹¶å‘ç¯å¢ƒé‡Œ, çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„, å¦‚æœç¨‹åºå­˜åœ¨ç«æ€æ¡ä»¶é—®é¢˜, é‚£å°±æ„å‘³ç€ç¨‹åºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸ç¡®å®šçš„, è€Œæ‰§è¡Œç»“æœä¸ç¡®å®šè¿™å¯æ˜¯ä¸ªå¤§ Bug.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å†ç»“åˆä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ä¸‹"),t("strong",[s._v("ç«æ€æ¡ä»¶")]),s._v(", å°±æ˜¯å‰é¢æ–‡ç« ä¸­æåˆ°çš„è½¬è´¦æ“ä½œ. è½¬è´¦æ“ä½œé‡Œé¢æœ‰ä¸ªåˆ¤æ–­æ¡ä»¶--è½¬å‡ºé‡‘é¢ä¸èƒ½å¤§äºè´¦æˆ·ä½™é¢, ä½†åœ¨å¹¶å‘ç¯å¢ƒé‡Œé¢, å¦‚æœä¸åŠ æ§åˆ¶, å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªè´¦å·æ‰§è¡Œè½¬å‡ºæ“ä½œæ—¶, å°±æœ‰å¯èƒ½å‡ºç°è¶…é¢è½¬å‡ºé—®é¢˜. å‡è®¾è´¦æˆ· A æœ‰ä½™é¢ 200, çº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 éƒ½è¦ä»è´¦æˆ· A è½¬å‡º 150, åœ¨ä¸‹é¢çš„ä»£ç é‡Œ, æœ‰å¯èƒ½çº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 åŒæ—¶æ‰§è¡Œåˆ°ç¬¬ 6 è¡Œ, è¿™æ ·çº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 éƒ½ä¼šå‘ç°è½¬å‡ºé‡‘é¢ 150 å°äºè´¦æˆ·ä½™é¢ 200, äºæ˜¯å°±ä¼šå‘ç”Ÿè¶…é¢è½¬å‡ºçš„æƒ…å†µ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("æ‰€ä»¥ä¹Ÿå¯ä»¥æŒ‰ç…§ä¸‹é¢è¿™æ ·æ¥ç†è§£"),t("strong",[s._v("ç«æ€æ¡ä»¶")]),s._v(". åœ¨å¹¶å‘åœºæ™¯ä¸­, ç¨‹åºçš„æ‰§è¡Œä¾èµ–äºæŸä¸ªçŠ¶æ€å˜é‡, ä¹Ÿå°±æ˜¯ç±»ä¼¼äºä¸‹é¢è¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("çŠ¶æ€å˜é‡ æ»¡è¶³ æ‰§è¡Œæ¡ä»¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    æ‰§è¡Œæ“ä½œ\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("å½“æŸä¸ªçº¿ç¨‹å‘ç°çŠ¶æ€å˜é‡æ»¡è¶³æ‰§è¡Œæ¡ä»¶å, å¼€å§‹æ‰§è¡Œæ“ä½œ; å¯æ˜¯å°±åœ¨è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œæ“ä½œçš„æ—¶å€™, å…¶ä»–çº¿ç¨‹åŒæ—¶ä¿®æ”¹äº†çŠ¶æ€å˜é‡, å¯¼è‡´çŠ¶æ€å˜é‡ä¸æ»¡è¶³æ‰§è¡Œæ¡ä»¶äº†")]),s._v(". å½“ç„¶å¾ˆå¤šåœºæ™¯ä¸‹, è¿™ä¸ªæ¡ä»¶ä¸æ˜¯æ˜¾å¼çš„, ä¾‹å¦‚å‰é¢ addOne çš„ä¾‹å­ä¸­, set(get() + 1) è¿™ä¸ªå¤åˆæ“ä½œ, å…¶å®å°±éšå¼ä¾èµ– get() çš„ç»“æœ.")]),s._v(" "),t("p",[s._v("é‚£é¢å¯¹æ•°æ®ç«äº‰å’Œç«æ€æ¡ä»¶é—®é¢˜, åˆè¯¥å¦‚ä½•ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§å‘¢? å…¶å®è¿™ä¸¤ç±»é—®é¢˜, éƒ½å¯ä»¥ç”¨"),t("strong",[s._v("äº’æ–¥")]),s._v("è¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆ, è€Œå®ç°"),t("strong",[s._v("äº’æ–¥")]),s._v("çš„æ–¹æ¡ˆæœ‰å¾ˆå¤š, CPU æä¾›äº†ç›¸å…³çš„äº’æ–¥æŒ‡ä»¤, æ“ä½œç³»ç»Ÿ, ç¼–ç¨‹è¯­è¨€ä¹Ÿä¼šæä¾›ç›¸å…³çš„ API. ä»é€»è¾‘ä¸Šæ¥çœ‹, å¯ä»¥ç»Ÿä¸€å½’ä¸º: "),t("strong",[s._v("é”")]),s._v(". å‰é¢å‡ ç« ä¹Ÿç²—ç•¥åœ°ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨é”, ç›¸ä¿¡ä½ å·²ç»èƒ¸ä¸­æœ‰ä¸˜å£‘äº†.")]),s._v(" "),t("h5",{attrs:{id:"æ´»è·ƒæ€§é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ´»è·ƒæ€§é—®é¢˜"}},[s._v("#")]),s._v(" æ´»è·ƒæ€§é—®é¢˜")]),s._v(" "),t("p",[s._v('æ‰€è°“æ´»è·ƒæ€§é—®é¢˜, æŒ‡çš„æ˜¯æŸä¸ªæ“ä½œæ— æ³•æ‰§è¡Œä¸‹å». å¸¸è§çš„ "æ­»é”" å°±æ˜¯ä¸€ç§å…¸å‹çš„æ´»è·ƒæ€§é—®é¢˜, å½“ç„¶'),t("strong",[s._v('é™¤äº†æ­»é”å¤–, è¿˜æœ‰ä¸¤ç§æƒ…å†µ, åˆ†åˆ«æ˜¯ "æ´»é”" å’Œ "é¥¥é¥¿"')]),s._v(" .")]),s._v(" "),t("p",[s._v('å‘ç”Ÿ "æ­»é”" åçº¿ç¨‹ä¼šäº’ç›¸ç­‰å¾…, è€Œä¸”ä¼šä¸€ç›´ç­‰å¾…ä¸‹å», åœ¨æŠ€æœ¯ä¸Šçš„è¡¨ç°å½¢å¼æ˜¯çº¿ç¨‹æ°¸ä¹…åœ° "é˜»å¡" äº†. ä½†'),t("strong",[s._v('æœ‰æ—¶çº¿ç¨‹è™½ç„¶æ²¡æœ‰å‘ç”Ÿé˜»å¡, ä½†ä»ç„¶ä¼šå­˜åœ¨æ‰§è¡Œä¸ä¸‹å»çš„æƒ…å†µ, è¿™å°±æ˜¯æ‰€è°“çš„ "æ´»é”"')]),s._v(' . å¯ä»¥ç±»æ¯”ç°å®ä¸–ç•Œé‡Œçš„ä¾‹å­, è·¯äººç”²ä»å·¦æ‰‹è¾¹å‡ºé—¨, è·¯äººä¹™ä»å³æ‰‹è¾¹è¿›é—¨, ä¸¤äººä¸ºäº†ä¸ç›¸æ’, äº’ç›¸è°¦è®©, è·¯äººç”²è®©è·¯èµ°å³æ‰‹è¾¹, è·¯äººä¹™ä¹Ÿè®©è·¯èµ°å·¦æ‰‹è¾¹, ç»“æœæ˜¯ä¸¤äººåˆç›¸æ’äº†. è¿™ç§æƒ…å†µ, åŸºæœ¬ä¸Šè°¦è®©å‡ æ¬¡å°±è§£å†³äº†, å› ä¸ºäººä¼šäº¤æµå•Š. å¯æ˜¯å¦‚æœè¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ç¼–ç¨‹ä¸–ç•Œäº†, å°±æœ‰å¯èƒ½ä¼šä¸€ç›´æ²¡å®Œæ²¡äº†åœ° "è°¦è®©" ä¸‹å», æˆä¸ºæ²¡æœ‰å‘ç”Ÿé˜»å¡ä½†ä¾ç„¶æ‰§è¡Œä¸ä¸‹å»çš„ "æ´»é”".')]),s._v(" "),t("p",[s._v('è§£å†³ "'),t("strong",[s._v("æ´»é”")]),s._v('" çš„æ–¹æ¡ˆå¾ˆç®€å•, è°¦è®©æ—¶, '),t("strong",[s._v("å°è¯•ç­‰å¾…ä¸€ä¸ªéšæœºçš„æ—¶é—´")]),s._v('å°±å¯ä»¥äº†. ä¾‹å¦‚ä¸Šé¢çš„é‚£ä¸ªä¾‹å­, è·¯äººç”²èµ°å·¦æ‰‹è¾¹å‘ç°å‰é¢æœ‰äºº, å¹¶ä¸æ˜¯ç«‹åˆ»æ¢åˆ°å³æ‰‹è¾¹, è€Œæ˜¯ç­‰å¾…ä¸€ä¸ªéšæœºçš„æ—¶é—´å, å†æ¢åˆ°å³æ‰‹è¾¹; åŒæ ·, è·¯äººä¹™ä¹Ÿä¸æ˜¯ç«‹åˆ»åˆ‡æ¢è·¯çº¿, ä¹Ÿæ˜¯ç­‰å¾…ä¸€ä¸ªéšæœºçš„æ—¶é—´å†åˆ‡æ¢. ç”±äºè·¯äººç”²å’Œè·¯äººä¹™ç­‰å¾…çš„æ—¶é—´æ˜¯éšæœºçš„, æ‰€ä»¥åŒæ—¶ç›¸æ’åå†æ¬¡ç›¸æ’çš„æ¦‚ç‡å°±å¾ˆä½äº†. "ç­‰å¾…ä¸€ä¸ªéšæœºæ—¶é—´" çš„æ–¹æ¡ˆè™½ç„¶å¾ˆç®€å•, å´éå¸¸æœ‰æ•ˆ, Raft è¿™æ ·çŸ¥åçš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ä¸­ä¹Ÿç”¨åˆ°äº†å®ƒ.')]),s._v(" "),t("p",[s._v('é‚£ "'),t("strong",[s._v("é¥¥é¥¿")]),s._v('" è¯¥æ€ä¹ˆå»ç†è§£å‘¢? '),t("strong",[s._v('æ‰€è°“ "é¥¥é¥¿" æŒ‡çš„æ˜¯çº¿ç¨‹å› æ— æ³•è®¿é—®æ‰€éœ€èµ„æºè€Œæ— æ³•æ‰§è¡Œä¸‹å»çš„æƒ…å†µ')]),s._v('. "ä¸æ‚£å¯¡, è€Œæ‚£ä¸å‡", å¦‚æœçº¿ç¨‹ä¼˜å…ˆçº§ "ä¸å‡", åœ¨ CPU ç¹å¿™çš„æƒ…å†µä¸‹, ä¼˜å…ˆçº§ä½çš„çº¿ç¨‹å¾—åˆ°æ‰§è¡Œçš„æœºä¼šå¾ˆå°, å°±å¯èƒ½å‘ç”Ÿçº¿ç¨‹ "é¥¥é¥¿"; æŒæœ‰é”çš„çº¿ç¨‹, å¦‚æœæ‰§è¡Œçš„æ—¶é—´è¿‡é•¿, ä¹Ÿå¯èƒ½å¯¼è‡´ "é¥¿æ­»" é—®é¢˜.')]),s._v(" "),t("p",[s._v('è§£å†³ "'),t("strong",[s._v("é¥¥é¥¿")]),s._v('" é—®é¢˜çš„æ–¹æ¡ˆå¾ˆç®€å•, æœ‰ä¸‰ç§æ–¹æ¡ˆ: '),t("strong",[s._v("ä¸€æ˜¯ä¿è¯èµ„æºå……è¶³, äºŒæ˜¯å…¬å¹³åœ°åˆ†é…èµ„æº, ä¸‰å°±æ˜¯é¿å…æŒæœ‰é”çš„çº¿ç¨‹é•¿æ—¶é—´æ‰§è¡Œ")]),s._v(". è¿™ä¸‰ä¸ªæ–¹æ¡ˆä¸­, æ–¹æ¡ˆä¸€å’Œæ–¹æ¡ˆä¸‰çš„é€‚ç”¨åœºæ™¯æ¯”è¾ƒæœ‰é™, å› ä¸ºå¾ˆå¤šåœºæ™¯ä¸‹, èµ„æºçš„ç¨€ç¼ºæ€§æ˜¯æ²¡åŠæ³•è§£å†³çš„, æŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ä¹Ÿå¾ˆéš¾ç¼©çŸ­. å€’æ˜¯æ–¹æ¡ˆäºŒçš„é€‚ç”¨åœºæ™¯ç›¸å¯¹æ¥è¯´æ›´å¤šä¸€äº›.")]),s._v(" "),t("p",[s._v("é‚£å¦‚ä½•å…¬å¹³åœ°åˆ†é…èµ„æºå‘¢? åœ¨å¹¶å‘ç¼–ç¨‹é‡Œ, ä¸»è¦æ˜¯"),t("strong",[s._v("ä½¿ç”¨å…¬å¹³é”")]),s._v(". æ‰€è°“å…¬å¹³é”, æ˜¯ä¸€ç§"),t("strong",[s._v("å…ˆæ¥ååˆ°")]),s._v("çš„æ–¹æ¡ˆ, çº¿ç¨‹çš„ç­‰å¾…æ˜¯æœ‰é¡ºåºçš„, æ’åœ¨ç­‰å¾…é˜Ÿåˆ—å‰é¢çš„çº¿ç¨‹ä¼šä¼˜å…ˆè·å¾—èµ„æº.")]),s._v(" "),t("h5",{attrs:{id:"æ€§èƒ½é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€§èƒ½é—®é¢˜"}},[s._v("#")]),s._v(" æ€§èƒ½é—®é¢˜")]),s._v(" "),t("p",[s._v('ä½¿ç”¨ "é”" è¦éå¸¸å°å¿ƒ, ä½†æ˜¯å¦‚æœå°å¿ƒè¿‡åº¦, ä¹Ÿå¯èƒ½å‡º "æ€§èƒ½é—®é¢˜".  '),t("strong",[s._v('"é”" çš„è¿‡åº¦ä½¿ç”¨å¯èƒ½å¯¼è‡´ä¸²è¡ŒåŒ–çš„èŒƒå›´è¿‡å¤§, è¿™æ ·å°±ä¸èƒ½å¤Ÿå‘æŒ¥å¤šçº¿ç¨‹çš„ä¼˜åŠ¿äº†, è€Œä¹‹æ‰€ä»¥ä½¿ç”¨å¤šçº¿ç¨‹æå¹¶å‘ç¨‹åº, ä¸ºçš„å°±æ˜¯æå‡æ€§èƒ½')]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥è¦å°½é‡å‡å°‘ä¸²è¡Œ, é‚£ä¸²è¡Œå¯¹æ€§èƒ½çš„å½±å“æ˜¯æ€ä¹ˆæ ·çš„å‘¢? å‡è®¾ä¸²è¡Œç™¾åˆ†æ¯”æ˜¯ 5%, ç”¨å¤šæ ¸å¤šçº¿ç¨‹ç›¸æ¯”å•æ ¸å•çº¿ç¨‹èƒ½æé€Ÿå¤šå°‘å‘¢?")]),s._v(" "),t("p",[s._v("æœ‰ä¸ªé˜¿å§†è¾¾å°”(Amdahl)å®šå¾‹, ä»£è¡¨äº†å¤„ç†å™¨å¹¶è¡Œè¿ç®—ä¹‹åæ•ˆç‡æå‡çš„èƒ½åŠ›, å®ƒæ­£å¥½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜, å…·ä½“å…¬å¼å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20240122234830-lqb7i9a.png",alt:"image"}})]),s._v(" "),t("p",[s._v("å…¬å¼é‡Œçš„ n å¯ä»¥ç†è§£ä¸º CPU çš„æ ¸æ•°, p å¯ä»¥ç†è§£ä¸ºå¹¶è¡Œç™¾åˆ†æ¯”, é‚£ (1-p) å°±æ˜¯ä¸²è¡Œç™¾åˆ†æ¯”äº†, ä¹Ÿå°±æ˜¯å‡è®¾çš„ 5%. å†å‡è®¾ CPU çš„æ ¸æ•°(ä¹Ÿå°±æ˜¯ n)æ— ç©·å¤§, é‚£åŠ é€Ÿæ¯” S çš„æé™å°±æ˜¯ 20. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("å¦‚æœä¸²è¡Œç‡æ˜¯ 5%, é‚£ä¹ˆæ— è®ºé‡‡ç”¨ä»€ä¹ˆæŠ€æœ¯, æœ€é«˜ä¹Ÿå°±åªèƒ½æé«˜ 20 å€çš„æ€§èƒ½")]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ä½¿ç”¨é”çš„æ—¶å€™ä¸€å®šè¦å…³æ³¨å¯¹æ€§èƒ½çš„å½±å“. é‚£æ€ä¹ˆæ‰èƒ½é¿å…é”å¸¦æ¥çš„æ€§èƒ½é—®é¢˜å‘¢? è¿™ä¸ªé—®é¢˜å¾ˆå¤æ‚, "),t("strong",[s._v("Java SDK å¹¶å‘åŒ…é‡Œä¹‹æ‰€ä»¥æœ‰é‚£ä¹ˆå¤šä¸œè¥¿, æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› å°±æ˜¯è¦æå‡åœ¨æŸä¸ªç‰¹å®šé¢†åŸŸçš„æ€§èƒ½")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸è¿‡ä»æ–¹æ¡ˆå±‚é¢, å¯ä»¥è¿™æ ·æ¥è§£å†³è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€, æ—¢ç„¶ä½¿ç”¨é”ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜, é‚£æœ€å¥½çš„æ–¹æ¡ˆè‡ªç„¶å°±æ˜¯"),t("strong",[s._v("ä½¿ç”¨æ— é”çš„ç®—æ³•å’Œæ•°æ®ç»“æ„")]),s._v("äº†. åœ¨è¿™æ–¹é¢æœ‰å¾ˆå¤šç›¸å…³çš„æŠ€æœ¯, ä¾‹å¦‚çº¿ç¨‹æœ¬åœ°å­˜å‚¨ (Thread Local Storage, TLS), å†™å…¥æ—¶å¤åˆ¶ (Copy-on-write), ä¹è§‚é”ç­‰; Java å¹¶å‘åŒ…é‡Œé¢çš„åŸå­ç±»ä¹Ÿæ˜¯ä¸€ç§æ— é”çš„æ•°æ®ç»“æ„; Disruptor åˆ™æ˜¯ä¸€ä¸ªæ— é”çš„å†…å­˜é˜Ÿåˆ—, æ€§èƒ½éƒ½éå¸¸å¥½.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒ, "),t("strong",[s._v("å‡å°‘é”æŒæœ‰çš„æ—¶é—´")]),s._v(". äº’æ–¥é”æœ¬è´¨ä¸Šæ˜¯å°†å¹¶è¡Œçš„ç¨‹åºä¸²è¡ŒåŒ–, æ‰€ä»¥è¦å¢åŠ å¹¶è¡Œåº¦, ä¸€å®šè¦å‡å°‘æŒæœ‰é”çš„æ—¶é—´. è¿™ä¸ªæ–¹æ¡ˆå…·ä½“çš„å®ç°æŠ€æœ¯ä¹Ÿæœ‰å¾ˆå¤š, ä¾‹å¦‚ä½¿ç”¨ç»†ç²’åº¦çš„é”, ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯ Java å¹¶å‘åŒ…é‡Œçš„ ConcurrentHashMap, å®ƒä½¿ç”¨äº†æ‰€è°“"),t("strong",[s._v("åˆ†æ®µé”")]),s._v("çš„æŠ€æœ¯; è¿˜å¯ä»¥ä½¿ç”¨è¯»å†™é”, ä¹Ÿå°±æ˜¯è¯»æ˜¯æ— é”çš„, åªæœ‰å†™çš„æ—¶å€™æ‰ä¼šäº’æ–¥.")]),s._v(" "),t("p",[s._v("æ€§èƒ½æ–¹é¢çš„åº¦é‡æŒ‡æ ‡æœ‰å¾ˆå¤š, æˆ‘è§‰å¾—æœ‰ä¸‰ä¸ªæŒ‡æ ‡éå¸¸é‡è¦, å°±æ˜¯: "),t("mark",[t("strong",[s._v("ååé‡, å»¶è¿Ÿå’Œå¹¶å‘é‡")])]),s._v(".")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ååé‡")]),s._v(": æŒ‡çš„æ˜¯å•ä½æ—¶é—´å†…èƒ½å¤„ç†çš„è¯·æ±‚æ•°é‡. ååé‡è¶Šé«˜, è¯´æ˜æ€§èƒ½è¶Šå¥½.")]),s._v(" "),t("li",[t("strong",[s._v("å»¶è¿Ÿ")]),s._v(": æŒ‡çš„æ˜¯ä»å‘å‡ºè¯·æ±‚åˆ°æ”¶åˆ°å“åº”çš„æ—¶é—´. å»¶è¿Ÿè¶Šå°, è¯´æ˜æ€§èƒ½è¶Šå¥½.")]),s._v(" "),t("li",[t("strong",[s._v("å¹¶å‘é‡")]),s._v(": æŒ‡çš„æ˜¯èƒ½åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°é‡, ä¸€èˆ¬æ¥è¯´éšç€å¹¶å‘é‡çš„å¢åŠ , å»¶è¿Ÿä¹Ÿä¼šå¢åŠ . æ‰€ä»¥å»¶è¿Ÿè¿™ä¸ªæŒ‡æ ‡, ä¸€èˆ¬éƒ½ä¼šæ˜¯åŸºäºå¹¶å‘é‡æ¥è¯´çš„. ä¾‹å¦‚å¹¶å‘é‡æ˜¯ 1000 çš„æ—¶å€™, å»¶è¿Ÿæ˜¯ 50 æ¯«ç§’.")])]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-7"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹æ˜¯ä¸€ä¸ªå¤æ‚çš„æŠ€æœ¯é¢†åŸŸ, å¾®è§‚ä¸Šæ¶‰åŠåˆ°åŸå­æ€§é—®é¢˜, å¯è§æ€§é—®é¢˜å’Œæœ‰åºæ€§é—®é¢˜, å®è§‚åˆ™è¡¨ç°ä¸ºå®‰å…¨æ€§, æ´»è·ƒæ€§ä»¥åŠæ€§èƒ½é—®é¢˜.")]),s._v(" "),t("p",[s._v("åœ¨è®¾è®¡å¹¶å‘ç¨‹åºçš„æ—¶å€™, ä¸»è¦æ˜¯ä»å®è§‚å‡ºå‘, ä¹Ÿå°±æ˜¯è¦é‡ç‚¹å…³æ³¨å®ƒçš„"),t("strong",[s._v("å®‰å…¨æ€§, æ´»è·ƒæ€§ä»¥åŠæ€§èƒ½")]),s._v(". å®‰å…¨æ€§æ–¹é¢è¦æ³¨æ„æ•°æ®ç«äº‰å’Œç«æ€æ¡ä»¶, æ´»è·ƒæ€§æ–¹é¢éœ€è¦æ³¨æ„æ­»é”, æ´»é”, é¥¥é¥¿ç­‰é—®é¢˜, æ€§èƒ½æ–¹é¢è™½ç„¶ä»‹ç»äº†ä¸¤ä¸ªæ–¹æ¡ˆ, ä½†æ˜¯é‡åˆ°å…·ä½“é—®é¢˜, è¿˜æ˜¯è¦å…·ä½“åˆ†æ, æ ¹æ®ç‰¹å®šçš„åœºæ™¯é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„å’Œç®—æ³•.")]),s._v(" "),t("h4",{attrs:{id:"_08-ç®¡ç¨‹-å¹¶å‘ç¼–ç¨‹çš„ä¸‡èƒ½é’¥åŒ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_08-ç®¡ç¨‹-å¹¶å‘ç¼–ç¨‹çš„ä¸‡èƒ½é’¥åŒ™"}},[s._v("#")]),s._v(" 08-ç®¡ç¨‹:å¹¶å‘ç¼–ç¨‹çš„ä¸‡èƒ½é’¥åŒ™")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹è¿™ä¸ªæŠ€æœ¯é¢†åŸŸå·²ç»å‘å±•äº†åŠä¸ªä¸–çºªäº†, ç›¸å…³çš„ç†è®ºå’ŒæŠ€æœ¯çº·ç¹å¤æ‚. é‚£æœ‰æ²¡æœ‰ä¸€ç§æ ¸å¿ƒæŠ€æœ¯å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è§£å†³å¹¶å‘é—®é¢˜å‘¢? è¿™ä¸ªé—®é¢˜å¦‚æœè®©æˆ‘é€‰æ‹©, æˆ‘ä¸€å®šä¼šé€‰æ‹©"),t("strong",[s._v("ç®¡ç¨‹")]),s._v("æŠ€æœ¯. Java è¯­è¨€åœ¨ 1.5 ä¹‹å‰, æä¾›çš„å”¯ä¸€çš„å¹¶å‘åŸè¯­å°±æ˜¯ç®¡ç¨‹, è€Œä¸” 1.5 ä¹‹åæä¾›çš„ SDK å¹¶å‘åŒ…, ä¹Ÿæ˜¯"),t("strong",[s._v("ä»¥ç®¡ç¨‹æŠ€æœ¯ä¸ºåŸºç¡€")]),s._v("çš„. é™¤æ­¤ä¹‹å¤–, C/C++, C# ç­‰é«˜çº§è¯­è¨€ä¹Ÿéƒ½æ”¯æŒç®¡ç¨‹.")]),s._v(" "),t("p",[s._v("å¯ä»¥è¿™ä¹ˆè¯´, "),t("strong",[s._v("ç®¡ç¨‹å°±æ˜¯ä¸€æŠŠè§£å†³å¹¶å‘é—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ä»€ä¹ˆæ˜¯ç®¡ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯ç®¡ç¨‹"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯ç®¡ç¨‹")]),s._v(" "),t("p",[s._v("ä¸çŸ¥é“ä½ æ˜¯å¦æ›¾æ€è€ƒè¿‡è¿™ä¸ªé—®é¢˜: ä¸ºä»€ä¹ˆ Java åœ¨ 1.5 ä¹‹å‰ä»…ä»…æä¾›äº† synchronized å…³é”®å­—åŠ wait(), notify(), notifyAll() è¿™ä¸‰ä¸ªçœ‹ä¼¼ä»å¤©è€Œé™çš„æ–¹æ³•? åœ¨åˆšæ¥è§¦ Java çš„æ—¶å€™, æˆ‘ä»¥ä¸ºå®ƒä¼šæä¾›ä¿¡å·é‡è¿™ç§ç¼–ç¨‹åŸè¯­, å› ä¸ºæ“ä½œç³»ç»ŸåŸç†è¯¾ç¨‹å‘Šè¯‰æˆ‘, ç”¨ä¿¡å·é‡èƒ½è§£å†³æ‰€æœ‰å¹¶å‘é—®é¢˜, ç»“æœæˆ‘å‘ç°ä¸æ˜¯. åæ¥æˆ‘æ‰¾åˆ°äº†åŸå› : "),t("strong",[s._v("Java é‡‡ç”¨çš„æ˜¯ç®¡ç¨‹æŠ€æœ¯, synchronized å…³é”®å­—åŠ wait(), notify(), notifyAll() è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯ç®¡ç¨‹çš„ç»„æˆéƒ¨åˆ†. è€Œç®¡ç¨‹å’Œä¿¡å·é‡æ˜¯ç­‰ä»·çš„, æ‰€è°“ç­‰ä»·æŒ‡çš„æ˜¯ç”¨ç®¡ç¨‹èƒ½å¤Ÿå®ç°ä¿¡å·é‡, ä¹Ÿèƒ½ç”¨ä¿¡å·é‡å®ç°ç®¡ç¨‹. ä½†æ˜¯ç®¡ç¨‹æ›´å®¹æ˜“ä½¿ç”¨, æ‰€ä»¥ Java é€‰æ‹©äº†ç®¡ç¨‹")]),s._v(".")]),s._v(" "),t("p",[s._v('ç®¡ç¨‹, å¯¹åº”çš„è‹±æ–‡æ˜¯ Monitor, å¾ˆå¤š Java é¢†åŸŸçš„åŒå­¦éƒ½å–œæ¬¢å°†å…¶ç¿»è¯‘æˆ"ç›‘è§†å™¨", è¿™æ˜¯ç›´è¯‘. æ“ä½œç³»ç»Ÿé¢†åŸŸä¸€èˆ¬éƒ½ç¿»è¯‘æˆ "ç®¡ç¨‹", è¿™ä¸ªæ˜¯æ„è¯‘, è€Œæˆ‘ä¹Ÿæ›´å€¾å‘äºä½¿ç”¨ "ç®¡ç¨‹".')]),s._v(" "),t("p",[s._v("æ‰€è°“"),t("mark",[t("strong",[s._v("ç®¡ç¨‹, æŒ‡çš„æ˜¯ç®¡ç†å…±äº«å˜é‡ä»¥åŠå¯¹å…±äº«å˜é‡çš„æ“ä½œè¿‡ç¨‹, è®©å®ƒä»¬æ”¯æŒå¹¶å‘")])]),s._v(". ç¿»è¯‘ä¸º Java é¢†åŸŸçš„è¯­è¨€, å°±æ˜¯ç®¡ç†ç±»çš„æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•, è®©è¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„. é‚£ç®¡ç¨‹æ˜¯æ€ä¹ˆç®¡çš„å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"mesaæ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mesaæ¨¡å‹"}},[s._v("#")]),s._v(" MESAæ¨¡å‹")]),s._v(" "),t("p",[s._v("åœ¨ç®¡ç¨‹çš„å‘å±•å²ä¸Š, å…ˆåå‡ºç°è¿‡ä¸‰ç§ä¸åŒçš„ç®¡ç¨‹æ¨¡å‹, åˆ†åˆ«æ˜¯: Hasen æ¨¡å‹, Hoare æ¨¡å‹å’Œ MESA æ¨¡å‹. å…¶ä¸­, ç°åœ¨å¹¿æ³›åº”ç”¨çš„æ˜¯ MESA æ¨¡å‹, å¹¶ä¸” Java ç®¡ç¨‹çš„å®ç°å‚è€ƒçš„ä¹Ÿæ˜¯ MESA æ¨¡å‹. æ‰€ä»¥é‡ç‚¹ä»‹ç»ä¸€ä¸‹ MESA æ¨¡å‹.")]),s._v(" "),t("p",[s._v("åœ¨å¹¶å‘ç¼–ç¨‹é¢†åŸŸ, æœ‰ä¸¤å¤§æ ¸å¿ƒé—®é¢˜: ä¸€ä¸ªæ˜¯"),t("strong",[s._v("äº’æ–¥")]),s._v(", å³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº; å¦ä¸€ä¸ªæ˜¯"),t("strong",[s._v("åŒæ­¥")]),s._v(", å³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡, åä½œ. "),t("strong",[s._v("è¿™ä¸¤å¤§é—®é¢˜, ç®¡ç¨‹éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹çœ‹ç®¡ç¨‹æ˜¯å¦‚ä½•è§£å†³"),t("strong",[s._v("äº’æ–¥")]),s._v("é—®é¢˜çš„.")]),s._v(" "),t("p",[t("strong",[s._v("ç®¡ç¨‹è§£å†³äº’æ–¥é—®é¢˜çš„æ€è·¯å¾ˆç®€å•, å°±æ˜¯å°†å…±äº«å˜é‡åŠå…¶å¯¹å…±äº«å˜é‡çš„æ“ä½œç»Ÿä¸€å°è£…èµ·æ¥")]),s._v(". åœ¨ä¸‹å›¾ä¸­, ç®¡ç¨‹ X å°†å…±äº«å˜é‡ queue è¿™ä¸ªé˜Ÿåˆ—å’Œç›¸å…³çš„æ“ä½œå…¥é˜Ÿ enq(), å‡ºé˜Ÿ deq() éƒ½å°è£…èµ·æ¥äº†; çº¿ç¨‹ A å’Œçº¿ç¨‹ B å¦‚æœæƒ³è®¿é—®å…±äº«å˜é‡ queue, åªèƒ½é€šè¿‡è°ƒç”¨ç®¡ç¨‹æä¾›çš„ enq(), deq() æ–¹æ³•æ¥å®ç°; enq(), deq() ä¿è¯äº’æ–¥æ€§, "),t("strong",[s._v("åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ç®¡ç¨‹")]),s._v(". ä¸çŸ¥ä½ æœ‰æ²¡æœ‰å‘ç°, ç®¡ç¨‹æ¨¡å‹å’Œé¢å‘å¯¹è±¡é«˜åº¦å¥‘åˆçš„. ä¼°è®¡è¿™ä¹Ÿæ˜¯ Java é€‰æ‹©ç®¡ç¨‹çš„åŸå› å§. åœ¨å‰é¢ä»‹ç»çš„äº’æ–¥é”ç”¨æ³•, å…¶èƒŒåçš„æ¨¡å‹å…¶å®å°±æ˜¯å®ƒ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d764ad186dc9985a0693087aa0ddbcf7-20230731162452-nrzl9qe.png",alt:"",title:"ç®¡ç¨‹æ¨¡å‹çš„ä»£ç åŒ–è¯­ä¹‰"}})]),s._v(" "),t("p",[s._v("é‚£ç®¡ç¨‹å¦‚ä½•è§£å†³çº¿ç¨‹é—´çš„"),t("strong",[s._v("åŒæ­¥")]),s._v("é—®é¢˜å‘¢?")]),s._v(" "),t("p",[s._v("è¿™ä¸ªå°±æ¯”è¾ƒå¤æ‚äº†, ä¸è¿‡å¯ä»¥å€Ÿé‰´ä¸€ä¸‹æ›¾ç»æåˆ°è¿‡çš„å°±åŒ»æµç¨‹, å®ƒå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿåœ°ç†è§£è¿™ä¸ªé—®é¢˜. ä¸ºè¿›ä¸€æ­¥ä¾¿äºç†è§£, ä¸‹é¢å±•ç¤ºäº†ä¸€å¹… MESA ç®¡ç¨‹æ¨¡å‹ç¤ºæ„å›¾, å®ƒ"),t("strong",[s._v("è¯¦ç»†æè¿°äº† MESA æ¨¡å‹çš„ä¸»è¦ç»„æˆéƒ¨åˆ†")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨"),t("strong",[s._v("ç®¡ç¨‹æ¨¡å‹é‡Œ, å…±äº«å˜é‡å’Œå¯¹å…±äº«å˜é‡çš„æ“ä½œæ˜¯è¢«å°è£…èµ·æ¥çš„, å›¾ä¸­æœ€å¤–å±‚çš„æ¡†å°±ä»£è¡¨å°è£…")]),s._v("çš„æ„æ€. æ¡†çš„ä¸Šé¢åªæœ‰ä¸€ä¸ªå…¥å£, å¹¶ä¸”åœ¨å…¥å£æ—è¾¹è¿˜æœ‰ä¸€ä¸ªå…¥å£ç­‰å¾…é˜Ÿåˆ—. "),t("strong",[s._v("å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯•å›¾è¿›å…¥ç®¡ç¨‹å†…éƒ¨æ—¶, åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥, å…¶ä»–çº¿ç¨‹åˆ™åœ¨å…¥å£ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…")]),s._v(". è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼å°±åŒ»æµç¨‹çš„åˆ†è¯Š, åªå…è®¸ä¸€ä¸ªæ‚£è€…å°±è¯Š, å…¶ä»–æ‚£è€…éƒ½åœ¨é—¨å£ç­‰å¾….")]),s._v(" "),t("p",[s._v("ç®¡ç¨‹é‡Œè¿˜å¼•å…¥äº†æ¡ä»¶å˜é‡çš„æ¦‚å¿µ, è€Œä¸”"),t("strong",[s._v("æ¯ä¸ªæ¡ä»¶å˜é‡éƒ½å¯¹åº”æœ‰ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—")]),s._v(", å¦‚ä¸‹å›¾, æ¡ä»¶å˜é‡ A å’Œæ¡ä»¶å˜é‡ B åˆ†åˆ«éƒ½æœ‰è‡ªå·±çš„ç­‰å¾…é˜Ÿåˆ—.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/59734caf26e3bc9ab207d0976b709c6f-20230731162452-xap4nv0.png",alt:"",title:"MESA ç®¡ç¨‹æ¨¡å‹"}})]),s._v(" "),t("p",[s._v("é‚£æ¡ä»¶å˜é‡å’Œç­‰å¾…é˜Ÿåˆ—çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢? å…¶å®å°±æ˜¯"),t("strong",[s._v("è§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜")]),s._v(". ä¹Ÿå¯ä»¥ç»“åˆä¸Šé¢æåˆ°çš„å…¥é˜Ÿå‡ºé˜Ÿä¾‹å­åŠ æ·±ä¸€ä¸‹ç†è§£.")]),s._v(" "),t("p",[s._v("å‡è®¾æœ‰ä¸ªçº¿ç¨‹ T1 æ‰§è¡Œå‡ºé˜Ÿæ“ä½œ, ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯æ‰§è¡Œ"),t("strong",[s._v("å‡ºé˜Ÿ")]),s._v("æ“ä½œ, æœ‰ä¸ªå‰ææ¡ä»¶, å°±æ˜¯é˜Ÿåˆ—ä¸èƒ½æ˜¯ç©ºçš„, è€Œé˜Ÿåˆ—ä¸ç©ºè¿™ä¸ªå‰ææ¡ä»¶å°±æ˜¯ç®¡ç¨‹é‡Œçš„æ¡ä»¶å˜é‡. å¦‚æœçº¿ç¨‹ T1 è¿›å…¥ç®¡ç¨‹åæ°å¥½å‘ç°é˜Ÿåˆ—æ˜¯ç©ºçš„, é‚£æ€ä¹ˆåŠå‘¢? ç­‰å¾…å•Š, å»å“ªé‡Œç­‰å‘¢? å°±"),t("strong",[s._v("å»æ¡ä»¶å˜é‡å¯¹åº”çš„ç­‰å¾…é˜Ÿåˆ—é‡Œé¢")]),s._v('ç­‰. æ­¤æ—¶çº¿ç¨‹ T1 å°±å» "é˜Ÿåˆ—ä¸ç©º" è¿™ä¸ªæ¡ä»¶å˜é‡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…. è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºå¤§å¤«å‘ç°ä½ è¦å»éªŒä¸ªè¡€, äºæ˜¯ç»™ä½ å¼€äº†ä¸ªéªŒè¡€çš„å•å­, ä½ å°±å»éªŒè¡€çš„é˜Ÿä¼é‡Œæ’é˜Ÿ. çº¿ç¨‹ T1 è¿›å…¥æ¡ä»¶å˜é‡çš„ç­‰å¾…é˜Ÿåˆ—å, æ˜¯å…è®¸å…¶ä»–çº¿ç¨‹è¿›å…¥ç®¡ç¨‹çš„. è¿™å’Œå»éªŒè¡€çš„æ—¶å€™, åŒ»ç”Ÿå¯ä»¥ç»™å…¶ä»–æ‚£è€…è¯Šæ²», é“ç†éƒ½æ˜¯ä¸€æ ·çš„.')]),s._v(" "),t("p",[s._v('å†å‡è®¾ä¹‹åå¦å¤–ä¸€ä¸ªçº¿ç¨‹ T2 æ‰§è¡Œå…¥é˜Ÿæ“ä½œ, å…¥é˜Ÿæ“ä½œæ‰§è¡ŒæˆåŠŸä¹‹å, "'),t("strong",[s._v("é˜Ÿåˆ—ä¸ç©º")]),s._v('" è¿™ä¸ªæ¡ä»¶å¯¹äºçº¿ç¨‹ T1 æ¥è¯´å·²ç»æ»¡è¶³äº†, æ­¤æ—¶çº¿ç¨‹ T2 è¦é€šçŸ¥ T1, å‘Šè¯‰å®ƒéœ€è¦çš„æ¡ä»¶å·²ç»æ»¡è¶³äº†. å½“çº¿ç¨‹ T1 å¾—åˆ°é€šçŸ¥å, ä¼šä»ç­‰å¾…é˜Ÿåˆ—é‡Œé¢å‡ºæ¥, ä½†æ˜¯å‡ºæ¥ä¹‹åä¸æ˜¯é©¬ä¸Šæ‰§è¡Œ, è€Œæ˜¯é‡æ–°è¿›å…¥åˆ°å…¥å£ç­‰å¾…é˜Ÿåˆ—é‡Œé¢. è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼ä½ éªŒè¡€å®Œ, å›æ¥æ‰¾å¤§å¤«, éœ€è¦é‡æ–°åˆ†è¯Š.')]),s._v(" "),t("p",[s._v('æ¡ä»¶å˜é‡åŠå…¶ç­‰å¾…é˜Ÿåˆ—è®²æ¸…æ¥šäº†, ä¸‹é¢å†è¯´è¯´ wait(), notify(), notifyAll() è¿™ä¸‰ä¸ªæ“ä½œ. å‰é¢æåˆ°çº¿ç¨‹ T1 å‘ç° "é˜Ÿåˆ—ä¸ç©º" è¿™ä¸ªæ¡ä»¶ä¸æ»¡è¶³, éœ€è¦è¿›åˆ°å¯¹åº”çš„ç­‰å¾…é˜Ÿåˆ—é‡Œç­‰å¾…. è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯'),t("strong",[s._v("é€šè¿‡è°ƒç”¨ wait() æ¥å®ç°")]),s._v('çš„. å¦‚æœç”¨å¯¹è±¡ A ä»£è¡¨ "é˜Ÿåˆ—ä¸ç©º" è¿™ä¸ªæ¡ä»¶, é‚£ä¹ˆçº¿ç¨‹ T1 éœ€è¦è°ƒç”¨ A.wait(). åŒç†å½“ "é˜Ÿåˆ—ä¸ç©º" è¿™ä¸ªæ¡ä»¶æ»¡è¶³æ—¶, çº¿ç¨‹ T2 éœ€è¦è°ƒç”¨ A.notify() æ¥é€šçŸ¥ A ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹, æ­¤æ—¶è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢åªæœ‰çº¿ç¨‹ T1. è‡³äº notifyAll() è¿™ä¸ªæ–¹æ³•, å®ƒå¯ä»¥é€šçŸ¥ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹.')]),s._v(" "),t("p",[s._v("è¿™é‡Œè¿˜æ˜¯æ¥ä¸€æ®µä»£ç å†æ¬¡è¯´æ˜ä¸€ä¸‹. ä¸‹é¢çš„ä»£ç å®ç°çš„æ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—, "),t("strong",[s._v("é˜»å¡é˜Ÿåˆ—æœ‰ä¸¤ä¸ªæ“ä½œåˆ†åˆ«æ˜¯å…¥é˜Ÿå’Œå‡ºé˜Ÿ")]),s._v(", è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯å…ˆè·å–äº’æ–¥é”, ç±»æ¯”ç®¡ç¨‹æ¨¡å‹ä¸­çš„å…¥å£.")]),s._v(" "),t("ol",[t("li",[s._v("å¯¹äºå…¥é˜Ÿæ“ä½œ, å¦‚æœé˜Ÿåˆ—å·²æ»¡, å°±éœ€è¦ç­‰å¾…ç›´åˆ°é˜Ÿåˆ—ä¸æ»¡, æ‰€ä»¥è¿™é‡Œç”¨äº† "),t("code",[s._v("notFull.await();")]),s._v("â€‹.")]),s._v(" "),t("li",[s._v("å¯¹äºå‡ºé˜Ÿæ“ä½œ, å¦‚æœé˜Ÿåˆ—ä¸ºç©º, å°±éœ€è¦ç­‰å¾…ç›´åˆ°é˜Ÿåˆ—ä¸ç©º, æ‰€ä»¥å°±ç”¨äº† "),t("code",[s._v("notEmpty.await();")]),s._v("â€‹.")]),s._v(" "),t("li",[s._v("å¦‚æœå…¥é˜ŸæˆåŠŸ, é‚£ä¹ˆé˜Ÿåˆ—å°±ä¸ç©ºäº†, å°±éœ€è¦é€šçŸ¥æ¡ä»¶å˜é‡: é˜Ÿåˆ—ä¸ç©º "),t("code",[s._v("notEmpty")]),s._v("â€‹ å¯¹åº”çš„ç­‰å¾…é˜Ÿåˆ—.")]),s._v(" "),t("li",[s._v("å¦‚æœå‡ºé˜ŸæˆåŠŸ, é‚£å°±é˜Ÿåˆ—å°±ä¸æ»¡äº†, å°±éœ€è¦é€šçŸ¥æ¡ä»¶å˜é‡: é˜Ÿåˆ—ä¸æ»¡ "),t("code",[s._v("notFull")]),s._v("â€‹ å¯¹åº”çš„ç­‰å¾…é˜Ÿåˆ—.")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockedQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¡ä»¶å˜é‡: é˜Ÿåˆ—ä¸æ»¡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Condition")]),s._v(" notFull "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCondition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¡ä»¶å˜é‡: é˜Ÿåˆ—ä¸ç©º  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Condition")]),s._v(" notEmpty "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCondition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…¥é˜Ÿ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("enq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("é˜Ÿåˆ—å·²æ»¡"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…é˜Ÿåˆ—ä¸æ»¡ ")]),s._v("\n                notFull"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å…¥é˜Ÿæ“ä½œ...")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…¥é˜Ÿå, é€šçŸ¥å¯å‡ºé˜Ÿ")]),s._v("\n            notEmpty"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‡ºé˜Ÿ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("deq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("é˜Ÿåˆ—å·²ç©º"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…é˜Ÿåˆ—ä¸ç©º")]),s._v("\n                notEmpty"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å‡ºé˜Ÿæ“ä½œ...")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‡ºé˜Ÿå, é€šçŸ¥å¯å…¥é˜Ÿ")]),s._v("\n            notFull"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("p",[s._v("åœ¨è¿™æ®µç¤ºä¾‹ä»£ç ä¸­, ç”¨äº† Java å¹¶å‘åŒ…é‡Œé¢çš„ Lock å’Œ Condition, å¦‚æœä½ çœ‹ç€åƒåŠ›, ä¹Ÿæ²¡å…³ç³», åé¢è¿˜ä¼šè¯¦ç»†ä»‹ç», è¿™ä¸ªä¾‹å­åªæ˜¯å…ˆè®©ä½ æ˜ç™½æ¡ä»¶å˜é‡åŠå…¶ç­‰å¾…é˜Ÿåˆ—æ˜¯æ€ä¹ˆå›äº‹. éœ€è¦æ³¨æ„çš„æ˜¯: "),t("strong",[s._v("await() å’Œå‰é¢æåˆ°çš„ wait() è¯­ä¹‰æ˜¯ä¸€æ ·çš„; signal() å’Œå‰é¢æåˆ°çš„ notify() è¯­ä¹‰æ˜¯ä¸€æ ·çš„")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"wait-çš„æ­£ç¡®å§¿åŠ¿"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wait-çš„æ­£ç¡®å§¿åŠ¿"}},[s._v("#")]),s._v(" wait()çš„æ­£ç¡®å§¿åŠ¿")]),s._v(" "),t("p",[s._v("ä½†æ˜¯æœ‰ä¸€ç‚¹, éœ€è¦å†æ¬¡æé†’, å¯¹äº MESA ç®¡ç¨‹æ¥è¯´, "),t("strong",[s._v("æœ‰ä¸€ä¸ªç¼–ç¨‹èŒƒå¼, å°±æ˜¯éœ€è¦åœ¨ä¸€ä¸ª while å¾ªç¯é‡Œé¢è°ƒç”¨ wait(). è¿™ä¸ªæ˜¯ MESA ç®¡ç¨‹ç‰¹æœ‰çš„")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("æ¡ä»¶ä¸æ»¡è¶³"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("Hasen æ¨¡å‹, Hoare æ¨¡å‹å’Œ MESA æ¨¡å‹çš„ä¸€ä¸ª"),t("strong",[s._v("æ ¸å¿ƒåŒºåˆ«å°±æ˜¯å½“æ¡ä»¶æ»¡è¶³å, å¦‚ä½•é€šçŸ¥ç›¸å…³çº¿ç¨‹")]),s._v(". ç®¡ç¨‹è¦æ±‚åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ, é‚£å½“çº¿ç¨‹ T2 çš„æ“ä½œä½¿çº¿ç¨‹ T1 ç­‰å¾…çš„æ¡ä»¶æ»¡è¶³æ—¶, T1 å’Œ T2 ç©¶ç«Ÿè°å¯ä»¥æ‰§è¡Œå‘¢?")]),s._v(" "),t("ol",[t("li",[s._v("Hasen æ¨¡å‹é‡Œé¢, è¦æ±‚ notify() æ”¾åœ¨ä»£ç çš„æœ€å, è¿™æ · T2 é€šçŸ¥å®Œ T1 å, T2 å°±ç»“æŸäº†, ç„¶å T1 å†æ‰§è¡Œ, è¿™æ ·å°±èƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ.")]),s._v(" "),t("li",[s._v("Hoare æ¨¡å‹é‡Œé¢, T2 é€šçŸ¥å®Œ T1 å, T2 é˜»å¡, T1 é©¬ä¸Šæ‰§è¡Œ; ç­‰ T1 æ‰§è¡Œå®Œ, å†å”¤é†’ T2, ä¹Ÿèƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ. ä½†æ˜¯ç›¸æ¯” Hasen æ¨¡å‹, T2 å¤šäº†ä¸€æ¬¡é˜»å¡å”¤é†’æ“ä½œ.")]),s._v(" "),t("li",[s._v("MESA ç®¡ç¨‹é‡Œé¢, "),t("strong",[s._v("T2 é€šçŸ¥å®Œ T1 å, T2 è¿˜æ˜¯ä¼šæ¥ç€æ‰§è¡Œ, T1 å¹¶ä¸ç«‹å³æ‰§è¡Œ, ä»…ä»…æ˜¯ä»æ¡ä»¶å˜é‡çš„ç­‰å¾…é˜Ÿåˆ—è¿›åˆ°å…¥å£ç­‰å¾…é˜Ÿåˆ—é‡Œé¢. è¿™æ ·åšçš„å¥½å¤„æ˜¯ notify() ä¸ç”¨æ”¾åˆ°ä»£ç çš„æœ€å, T2 ä¹Ÿæ²¡æœ‰å¤šä½™çš„é˜»å¡å”¤é†’æ“ä½œ. ä½†æ˜¯ä¹Ÿæœ‰ä¸ªå‰¯ä½œç”¨, å°±æ˜¯å½“ T1 å†æ¬¡æ‰§è¡Œçš„æ—¶å€™, å¯èƒ½æ›¾ç»æ»¡è¶³çš„æ¡ä»¶, ç°åœ¨å·²ç»ä¸æ»¡è¶³äº†, æ‰€ä»¥éœ€è¦ä»¥å¾ªç¯æ–¹å¼æ£€éªŒæ¡ä»¶å˜é‡")]),s._v(".")])]),s._v(" "),t("h5",{attrs:{id:"notify-ä½•æ—¶å¯ä»¥ä½¿ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#notify-ä½•æ—¶å¯ä»¥ä½¿ç”¨"}},[s._v("#")]),s._v(" notify()ä½•æ—¶å¯ä»¥ä½¿ç”¨")]),s._v(" "),t("p",[s._v("è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹, å°±æ˜¯ notify() å’Œ notifyAll() çš„ä½¿ç”¨, å‰é¢æ›¾ç»ä»‹ç»è¿‡, "),t("strong",[s._v("é™¤éç»è¿‡æ·±æ€ç†Ÿè™‘, å¦åˆ™å°½é‡ä½¿ç”¨ notifyAll()")]),s._v(" . é‚£ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨ notify() å‘¢? éœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("æ‰€æœ‰ç­‰å¾…çº¿ç¨‹æ‹¥æœ‰ç›¸åŒçš„ç­‰å¾…æ¡ä»¶")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("æ‰€æœ‰ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’å, æ‰§è¡Œç›¸åŒçš„æ“ä½œ")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("åªéœ€è¦å”¤é†’ä¸€ä¸ªçº¿ç¨‹")]),s._v(".")])]),s._v(" "),t("p",[s._v('æ¯”å¦‚ä¸Šé¢é˜»å¡é˜Ÿåˆ—çš„ä¾‹å­ä¸­, å¯¹äº "é˜Ÿåˆ—ä¸æ»¡" è¿™ä¸ªæ¡ä»¶å˜é‡, å…¶é˜»å¡é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹éƒ½æ˜¯åœ¨ç­‰å¾… "é˜Ÿåˆ—ä¸æ»¡" è¿™ä¸ªæ¡ä»¶, åæ˜ åœ¨ä»£ç é‡Œå°±æ˜¯ä¸‹é¢è¿™ 3 è¡Œä»£ç . å¯¹æ‰€æœ‰ç­‰å¾…çº¿ç¨‹æ¥è¯´, éƒ½æ˜¯æ‰§è¡Œè¿™ 3 è¡Œä»£ç , '),t("strong",[s._v("é‡ç‚¹æ˜¯ while é‡Œé¢çš„ç­‰å¾…æ¡ä»¶æ˜¯å®Œå…¨ç›¸åŒçš„")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("é˜Ÿåˆ—å·²æ»¡"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…é˜Ÿåˆ—ä¸æ»¡")]),s._v("\n    notFull"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("æ‰€æœ‰ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’åæ‰§è¡Œçš„æ“ä½œä¹Ÿæ˜¯ç›¸åŒçš„, éƒ½æ˜¯ä¸‹é¢è¿™å‡ è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å…¥é˜Ÿæ“ä½œ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…¥é˜Ÿå, é€šçŸ¥å¯å‡ºé˜Ÿ")]),s._v("\nnotEmpty"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("åŒæ—¶ä¹Ÿæ»¡è¶³ç¬¬ 3 æ¡, åªéœ€è¦å”¤é†’ä¸€ä¸ªçº¿ç¨‹. æ‰€ä»¥ä¸Šé¢é˜»å¡é˜Ÿåˆ—çš„ä»£ç , ä½¿ç”¨ signal() æ˜¯å¯ä»¥çš„.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-8"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Java å‚è€ƒäº† MESA æ¨¡å‹, è¯­è¨€å†…ç½®çš„ç®¡ç¨‹(synchronized)å¯¹ MESA æ¨¡å‹è¿›è¡Œäº†ç²¾ç®€. MESA æ¨¡å‹ä¸­, æ¡ä»¶å˜é‡å¯ä»¥æœ‰å¤šä¸ª, Java è¯­è¨€å†…ç½®çš„ç®¡ç¨‹é‡Œåªæœ‰ä¸€ä¸ªæ¡ä»¶å˜é‡. å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e78da693aa84c350e12e80c9ffe1153d-20230731162452-w8cznx5.png",alt:"",title:"Java ä¸­çš„ç®¡ç¨‹ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("Java å†…ç½®çš„ç®¡ç¨‹æ–¹æ¡ˆ(synchronized)ä½¿ç”¨ç®€å•, synchronized å…³é”®å­—ä¿®é¥°çš„ä»£ç å—, åœ¨ç¼–è¯‘æœŸä¼šè‡ªåŠ¨ç”Ÿæˆç›¸å…³åŠ é”å’Œè§£é”çš„ä»£ç , ä½†æ˜¯ä»…æ”¯æŒä¸€ä¸ªæ¡ä»¶å˜é‡; è€Œ Java SDK å¹¶å‘åŒ…å®ç°çš„ç®¡ç¨‹æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡, ä¸è¿‡å¹¶å‘åŒ…é‡Œçš„é”, éœ€è¦å¼€å‘äººå‘˜è‡ªå·±è¿›è¡ŒåŠ é”å’Œè§£é”æ“ä½œ.")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹é‡Œä¸¤å¤§æ ¸å¿ƒé—®é¢˜â€”â€”äº’æ–¥å’ŒåŒæ­¥, éƒ½å¯ä»¥ç”±ç®¡ç¨‹æ¥å¸®ä½ è§£å†³. å­¦å¥½ç®¡ç¨‹, ç†è®ºä¸Šæ‰€æœ‰çš„å¹¶å‘é—®é¢˜ä½ éƒ½å¯ä»¥è§£å†³, å¹¶ä¸”å¾ˆå¤šå¹¶å‘å·¥å…·ç±»åº•å±‚éƒ½æ˜¯ç®¡ç¨‹å®ç°çš„, æ‰€ä»¥å­¦å¥½ç®¡ç¨‹, å°±æ˜¯ç›¸å½“äºæŒæ¡äº†ä¸€æŠŠå¹¶å‘ç¼–ç¨‹çš„ä¸‡èƒ½é’¥åŒ™.")]),s._v(" "),t("h4",{attrs:{id:"_09-javaçº¿ç¨‹-ä¸Š-javaçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_09-javaçº¿ç¨‹-ä¸Š-javaçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸğŸ€"}},[s._v("#")]),s._v(" 09-Javaçº¿ç¨‹(ä¸Š):Javaçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸğŸ€")]),s._v(" "),t("p",[s._v("åœ¨ Java é¢†åŸŸ, å®ç°å¹¶å‘ç¨‹åºçš„ä¸»è¦æ‰‹æ®µå°±æ˜¯å¤šçº¿ç¨‹. çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿé‡Œçš„ä¸€ä¸ªæ¦‚å¿µ, è™½ç„¶å„ç§ä¸åŒçš„å¼€å‘è¯­è¨€å¦‚ Java, C# ç­‰éƒ½å¯¹å…¶è¿›è¡Œäº†å°è£…, ä½†æ˜¯ä¸‡å˜ä¸ç¦»æ“ä½œç³»ç»Ÿ. "),t("strong",[s._v("Java è¯­è¨€é‡Œçš„çº¿ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹, å®ƒä»¬æ˜¯ä¸€ä¸€å¯¹åº”çš„")]),s._v(".")]),s._v(" "),t("p",[s._v('åœ¨æ“ä½œç³»ç»Ÿå±‚é¢, çº¿ç¨‹ä¹Ÿæœ‰ "ç”Ÿè€ç—…æ­»", ä¸“ä¸šçš„è¯´æ³•å«æœ‰'),t("strong",[s._v("ç”Ÿå‘½å‘¨æœŸ")]),s._v(". å¯¹äºæœ‰ç”Ÿå‘½å‘¨æœŸçš„äº‹ç‰©, è¦å­¦å¥½å®ƒ, æ€è·¯éå¸¸ç®€å•, åªè¦èƒ½ææ‡‚"),t("strong",[s._v("ç”Ÿå‘½å‘¨æœŸä¸­å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€è½¬æ¢æœºåˆ¶")]),s._v("å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("è™½ç„¶ä¸åŒçš„å¼€å‘è¯­è¨€å¯¹äºæ“ä½œç³»ç»Ÿçº¿ç¨‹è¿›è¡Œäº†ä¸åŒçš„å°è£…, ä½†æ˜¯å¯¹äºçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸè¿™éƒ¨åˆ†, åŸºæœ¬ä¸Šæ˜¯é›·åŒçš„. æ‰€ä»¥, å¯ä»¥å…ˆæ¥äº†è§£ä¸€ä¸‹"),t("strong",[s._v("é€šç”¨çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸæ¨¡å‹")]),s._v(", è¿™éƒ¨åˆ†å†…å®¹ä¹Ÿé€‚ç”¨äºå¾ˆå¤šå…¶ä»–ç¼–ç¨‹è¯­è¨€; ç„¶åå†è¯¦ç»†æœ‰é’ˆå¯¹æ€§åœ°å­¦ä¹ ä¸€ä¸‹ Java ä¸­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ.")]),s._v(" "),t("h5",{attrs:{id:"é€šç”¨çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é€šç”¨çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ"}},[s._v("#")]),s._v(" é€šç”¨çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ")]),s._v(" "),t("p",[s._v('é€šç”¨çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸåŸºæœ¬ä¸Šå¯ä»¥ç”¨ä¸‹å›¾è¿™ä¸ª "äº”æ€æ¨¡å‹" æ¥æè¿°. è¿™äº”æ€åˆ†åˆ«æ˜¯: '),t("strong",[s._v("åˆå§‹çŠ¶æ€, å¯è¿è¡ŒçŠ¶æ€, è¿è¡ŒçŠ¶æ€, ä¼‘çœ çŠ¶æ€")]),s._v("å’Œ"),t("strong",[s._v("ç»ˆæ­¢çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/92df4e90e0a21aa654639d64c6c1ca02-20230731162452-eku2agl.png",alt:"",title:"é€šç”¨çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾-äº”æ€æ¨¡å‹"}})]),s._v(" "),t("p",[s._v('è¿™ "äº”æ€æ¨¡å‹" çš„è¯¦ç»†æƒ…å†µå¦‚ä¸‹æ‰€ç¤º.')]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("åˆå§‹çŠ¶æ€: ** æŒ‡çš„æ˜¯çº¿ç¨‹å·²ç»è¢«åˆ›å»º, ä½†æ˜¯è¿˜")]),s._v("ä¸å…è®¸åˆ†é… CPU æ‰§è¡Œ**. è¿™ä¸ªçŠ¶æ€å±äºç¼–ç¨‹è¯­è¨€ç‰¹æœ‰çš„, ä¸è¿‡è¿™é‡Œæ‰€è°“çš„è¢«åˆ›å»º, ä»…ä»…æ˜¯åœ¨ç¼–ç¨‹è¯­è¨€å±‚é¢è¢«åˆ›å»º, è€Œ"),t("strong",[s._v("åœ¨æ“ä½œç³»ç»Ÿå±‚é¢, çœŸæ­£çš„çº¿ç¨‹è¿˜æ²¡æœ‰åˆ›å»º")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("å¯è¿è¡ŒçŠ¶æ€")]),s._v(": æŒ‡çš„æ˜¯çº¿ç¨‹"),t("strong",[s._v("å¯ä»¥åˆ†é… CPU æ‰§è¡Œ")]),s._v(". åœ¨è¿™ç§çŠ¶æ€ä¸‹, çœŸæ­£çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹"),t("strong",[s._v("å·²ç»è¢«æˆåŠŸåˆ›å»º")]),s._v("äº†, æ‰€ä»¥å¯ä»¥åˆ†é… CPU æ‰§è¡Œ.")]),s._v(" "),t("li",[t("strong",[s._v("è¿è¡ŒçŠ¶æ€")]),s._v(": å½“æœ‰ç©ºé—²çš„ CPU æ—¶, æ“ä½œç³»ç»Ÿä¼šå°†å…¶"),t("strong",[s._v("åˆ†é…ç»™ä¸€ä¸ªå¤„äºå¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹")]),s._v(", è¢«åˆ†é…åˆ° CPU çš„çº¿ç¨‹çš„çŠ¶æ€å°±è½¬æ¢æˆäº†"),t("strong",[s._v("è¿è¡ŒçŠ¶æ€")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("ä¼‘çœ çŠ¶æ€")]),s._v(": è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹å¦‚æœ"),t("strong",[s._v("è°ƒç”¨ä¸€ä¸ªé˜»å¡çš„ API(ä¾‹å¦‚ä»¥é˜»å¡æ–¹å¼è¯»æ–‡ä»¶)æˆ–è€…ç­‰å¾…æŸä¸ªäº‹ä»¶(ä¾‹å¦‚æ¡ä»¶å˜é‡)")]),s._v(" , é‚£ä¹ˆçº¿ç¨‹çš„çŠ¶æ€å°±ä¼šè½¬æ¢åˆ°"),t("strong",[s._v("ä¼‘çœ çŠ¶æ€, åŒæ—¶é‡Šæ”¾ CPU ä½¿ç”¨æƒ, ä¼‘çœ çŠ¶æ€çš„çº¿ç¨‹æ°¸è¿œæ²¡æœ‰æœºä¼šè·å¾— CPU ä½¿ç”¨æƒ. å½“ç­‰å¾…çš„äº‹ä»¶å‡ºç°äº†, çº¿ç¨‹å°±ä¼šä»ä¼‘çœ çŠ¶æ€è½¬æ¢åˆ°å¯è¿è¡ŒçŠ¶æ€")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("ç»ˆæ­¢çŠ¶æ€")]),s._v(": çº¿ç¨‹æ‰§è¡Œå®Œæˆ–è€…å‡ºç°å¼‚å¸¸å°±ä¼šè¿›å…¥"),t("strong",[s._v("ç»ˆæ­¢çŠ¶æ€")]),s._v(", ç»ˆæ­¢çŠ¶æ€çš„çº¿ç¨‹ä¸ä¼šåˆ‡æ¢åˆ°å…¶ä»–ä»»ä½•çŠ¶æ€, è¿›å…¥ç»ˆæ­¢çŠ¶æ€ä¹Ÿå°±æ„å‘³ç€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸç»“æŸäº†.")])]),s._v(" "),t("p",[s._v("è¿™äº”ç§çŠ¶æ€åœ¨ä¸åŒç¼–ç¨‹è¯­è¨€é‡Œä¼šæœ‰ç®€åŒ–åˆå¹¶. ä¾‹å¦‚, C è¯­è¨€çš„ POSIX Threads è§„èŒƒ, å°±æŠŠåˆå§‹çŠ¶æ€å’Œå¯è¿è¡ŒçŠ¶æ€åˆå¹¶äº†; Java è¯­è¨€é‡Œåˆ™æŠŠå¯è¿è¡ŒçŠ¶æ€å’Œè¿è¡ŒçŠ¶æ€åˆå¹¶äº†, è¿™ä¸¤ä¸ªçŠ¶æ€åœ¨æ“ä½œç³»ç»Ÿè°ƒåº¦å±‚é¢æœ‰ç”¨, è€Œ JVM å±‚é¢ä¸å…³å¿ƒè¿™ä¸¤ä¸ªçŠ¶æ€, å› ä¸º JVM æŠŠçº¿ç¨‹è°ƒåº¦äº¤ç»™æ“ä½œç³»ç»Ÿå¤„ç†äº†.")]),s._v(" "),t("p",[s._v("é™¤äº†ç®€åŒ–åˆå¹¶, è¿™äº”ç§çŠ¶æ€ä¹Ÿæœ‰"),t("strong",[s._v("å¯èƒ½è¢«ç»†åŒ–")]),s._v(", æ¯”å¦‚ Java è¯­è¨€é‡Œå°±ç»†åŒ–äº†ä¼‘çœ çŠ¶æ€(è¿™ä¸ªä¸‹é¢ä¼šè¯¦ç»†è®²è§£).")]),s._v(" "),t("h5",{attrs:{id:"javaä¸­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javaä¸­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"}},[s._v("#")]),s._v(" Javaä¸­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ")]),s._v(" "),t("p",[s._v("ä»‹ç»å®Œé€šç”¨çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸæ¨¡å‹, æ¥ä¸‹æ¥å°±æ¥è¯¦ç»†çœ‹çœ‹ Java è¯­è¨€é‡Œçš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸæ˜¯ä»€ä¹ˆæ ·çš„.")]),s._v(" "),t("p",[s._v("Java è¯­è¨€ä¸­çº¿ç¨‹å…±æœ‰å…­ç§çŠ¶æ€, åˆ†åˆ«æ˜¯:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("NEW(åˆå§‹åŒ–çŠ¶æ€)")])]),s._v(" "),t("li",[t("strong",[s._v("RUNNABLE(å¯è¿è¡Œ/è¿è¡ŒçŠ¶æ€)")])]),s._v(" "),t("li",[t("strong",[s._v("BLOCKED(é˜»å¡çŠ¶æ€)")])]),s._v(" "),t("li",[t("strong",[s._v("WAITING(æ— æ—¶é™ç­‰å¾…)")])]),s._v(" "),t("li",[t("strong",[s._v("TIMED_WAITING(æœ‰æ—¶é™ç­‰å¾…)")])]),s._v(" "),t("li",[t("strong",[s._v("TERMINATED(ç»ˆæ­¢çŠ¶æ€)")])])]),s._v(" "),t("p",[s._v("è¿™çœ‹ä¸Šå»æŒºå¤æ‚çš„, çŠ¶æ€ç±»å‹ä¹Ÿæ¯”è¾ƒå¤š. "),t("mark",[t("strong",[s._v("ä½†å…¶å®åœ¨æ“ä½œç³»ç»Ÿå±‚é¢, Java çº¿ç¨‹ä¸­çš„ BLOCKED, WAITING, TIMED_WAITING æ˜¯ä¸€ç§çŠ¶æ€, å³å‰é¢æåˆ°çš„ä¼‘çœ çŠ¶æ€. ä¹Ÿå°±æ˜¯è¯´åªè¦ Java çº¿ç¨‹å¤„äºè¿™ä¸‰ç§çŠ¶æ€ä¹‹ä¸€, é‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ°¸è¿œæ²¡æœ‰ CPU çš„ä½¿ç”¨æƒ")])]),s._v(".")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ Java çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥ç®€åŒ–ä¸ºä¸‹å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/14d5ebdae35bc89ddc07820d3b187cd7-20230731162452-hi7wnsq.png",alt:"",title:"Java ä¸­çš„çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾"}})]),s._v(" "),t("p",[s._v("å…¶ä¸­, "),t("strong",[s._v("BLOCKED, WAITING, TIMED_WAITING å¯ä»¥ç†è§£ä¸ºçº¿ç¨‹å¯¼è‡´ä¼‘çœ çŠ¶æ€çš„ä¸‰ç§åŸå› ")]),s._v(". é‚£å…·ä½“æ˜¯å“ªäº›æƒ…å½¢ä¼šå¯¼è‡´çº¿ç¨‹ä» RUNNABLE çŠ¶æ€è½¬æ¢åˆ°è¿™ä¸‰ç§çŠ¶æ€å‘¢? è€Œè¿™ä¸‰ç§çŠ¶æ€åˆæ˜¯ä½•æ—¶è½¬æ¢å› RUNNABLE çš„å‘¢? ä»¥åŠ NEW, TERMINATED å’Œ RUNNABLE çŠ¶æ€æ˜¯å¦‚ä½•è½¬æ¢çš„?")]),s._v(" "),t("h6",{attrs:{id:"_1-runnableä¸blockedçš„çŠ¶æ€è½¬æ¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-runnableä¸blockedçš„çŠ¶æ€è½¬æ¢"}},[s._v("#")]),s._v(" (1)RUNNABLEä¸BLOCKEDçš„çŠ¶æ€è½¬æ¢")]),s._v(" "),t("p",[t("strong",[s._v("åªæœ‰ä¸€ç§åœºæ™¯ä¼šè§¦å‘è¿™ç§è½¬æ¢, å°±æ˜¯çº¿ç¨‹ç­‰å¾… synchronized çš„éšå¼é”")]),s._v(". synchronized ä¿®é¥°çš„æ–¹æ³•, ä»£ç å—åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ, å…¶ä»–çº¿ç¨‹åªèƒ½ç­‰å¾…, è¿™ç§æƒ…å†µä¸‹, "),t("strong",[s._v("ç­‰å¾…çš„çº¿ç¨‹å°±ä¼šä» RUNNABLE è½¬æ¢åˆ° BLOCKED çŠ¶æ€. è€Œå½“ç­‰å¾…çš„çº¿ç¨‹è·å¾— synchronized éšå¼é”æ—¶, å°±åˆä¼šä» BLOCKED è½¬æ¢åˆ° RUNNABLE çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æœä½ ç†Ÿæ‚‰æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸçš„è¯, å¯èƒ½ä¼šæœ‰ä¸ªç–‘é—®: çº¿ç¨‹è°ƒç”¨é˜»å¡å¼ API æ—¶, æ˜¯å¦ä¼šè½¬æ¢åˆ° BLOCKED çŠ¶æ€å‘¢? åœ¨æ“ä½œç³»ç»Ÿå±‚é¢, çº¿ç¨‹æ˜¯ä¼šè½¬æ¢åˆ°ä¼‘çœ çŠ¶æ€çš„, ä½†æ˜¯åœ¨ JVM å±‚é¢, Java çº¿ç¨‹çš„çŠ¶æ€ä¸ä¼šå‘ç”Ÿå˜åŒ–, ä¹Ÿå°±æ˜¯è¯´ Java çº¿ç¨‹çš„çŠ¶æ€ä¼šä¾ç„¶ä¿æŒ RUNNABLE çŠ¶æ€. "),t("mark",[t("strong",[s._v("JVM å±‚é¢å¹¶ä¸å…³å¿ƒæ“ä½œç³»ç»Ÿè°ƒåº¦ç›¸å…³çš„çŠ¶æ€")])]),s._v(", å› ä¸ºåœ¨ JVM çœ‹æ¥, ç­‰å¾… CPU ä½¿ç”¨æƒ(æ“ä½œç³»ç»Ÿå±‚é¢æ­¤æ—¶å¤„äºå¯æ‰§è¡ŒçŠ¶æ€)ä¸ç­‰å¾… I/O(æ“ä½œç³»ç»Ÿå±‚é¢æ­¤æ—¶å¤„äºä¼‘çœ çŠ¶æ€)æ²¡æœ‰åŒºåˆ«, éƒ½æ˜¯åœ¨ç­‰å¾…æŸä¸ªèµ„æº, æ‰€ä»¥éƒ½å½’å…¥äº† RUNNABLE çŠ¶æ€.")]),s._v(" "),t("p",[s._v("è€Œå¹³æ—¶æ‰€è°“çš„ Java åœ¨è°ƒç”¨é˜»å¡å¼ API æ—¶, çº¿ç¨‹ä¼šé˜»å¡, "),t("strong",[s._v("æŒ‡çš„æ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„çŠ¶æ€, å¹¶ä¸æ˜¯ Java çº¿ç¨‹çš„çŠ¶æ€")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_2-runnableä¸waitingçš„çŠ¶æ€è½¬æ¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-runnableä¸waitingçš„çŠ¶æ€è½¬æ¢"}},[s._v("#")]),s._v(" (2)RUNNABLEä¸WAITINGçš„çŠ¶æ€è½¬æ¢")]),s._v(" "),t("p",[s._v("æ€»ä½“æ¥è¯´, æœ‰ä¸‰ç§åœºæ™¯ä¼šè§¦å‘è¿™ç§è½¬æ¢.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬ä¸€ç§åœºæ™¯, è·å¾— synchronized éšå¼é”çš„çº¿ç¨‹, è°ƒç”¨æ— å‚æ•°çš„ Object.wait() æ–¹æ³•")]),s._v(". å…¶ä¸­, wait() æ–¹æ³•åœ¨ä¸Šä¸€èŠ‚è®²è§£ç®¡ç¨‹çš„æ—¶å€™å·²ç»æ·±å…¥ä»‹ç»è¿‡äº†, è¿™é‡Œå°±ä¸å†èµ˜è¿°.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬äºŒç§åœºæ™¯, è°ƒç”¨æ— å‚æ•°çš„ Thread.join() æ–¹æ³•")]),s._v(". å…¶ä¸­çš„ join() æ˜¯ä¸€ç§"),t("strong",[s._v("çº¿ç¨‹åŒæ­¥æ–¹æ³•")]),s._v(", ä¾‹å¦‚æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ thread A, å½“è°ƒç”¨ A.join() çš„æ—¶å€™, æ‰§è¡Œè¿™æ¡è¯­å¥çš„çº¿ç¨‹ä¼šç­‰å¾… thread A æ‰§è¡Œå®Œ, è€Œç­‰å¾…ä¸­çš„è¿™ä¸ªçº¿ç¨‹, å…¶çŠ¶æ€ä¼šä» RUNNABLE è½¬æ¢åˆ° WAITING. å½“çº¿ç¨‹ thread A æ‰§è¡Œå®Œ, åŸæ¥ç­‰å¾…å®ƒçš„çº¿ç¨‹åˆä¼šä» WAITING çŠ¶æ€è½¬æ¢åˆ° RUNNABLE.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬ä¸‰ç§åœºæ™¯, è°ƒç”¨ LockSupport.park() æ–¹æ³•")]),s._v(". å…¶ä¸­çš„ LockSupport å¯¹è±¡, ä¹Ÿè®¸ä½ æœ‰ç‚¹é™Œç”Ÿ, å…¶å® Java å¹¶å‘åŒ…ä¸­çš„é”, éƒ½æ˜¯åŸºäºå®ƒå®ç°çš„. è°ƒç”¨ LockSupport.park() æ–¹æ³•, å½“å‰çº¿ç¨‹ä¼š"),t("strong",[s._v("é˜»å¡")]),s._v(", çº¿ç¨‹çš„çŠ¶æ€ä¼šä» RUNNABLE è½¬æ¢åˆ° WAITING. è°ƒç”¨ LockSupport.unpark(Thread thread) å¯å”¤é†’ç›®æ ‡çº¿ç¨‹, ç›®æ ‡çº¿ç¨‹çš„çŠ¶æ€åˆä¼šä» WAITING çŠ¶æ€è½¬æ¢åˆ° RUNNABLE.")]),s._v(" "),t("h6",{attrs:{id:"_3-runnableä¸timed-waitingçš„çŠ¶æ€è½¬æ¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-runnableä¸timed-waitingçš„çŠ¶æ€è½¬æ¢"}},[s._v("#")]),s._v(" (3)RUNNABLEä¸TIMED_WAITINGçš„çŠ¶æ€è½¬æ¢")]),s._v(" "),t("p",[s._v("æœ‰äº”ç§åœºæ™¯ä¼šè§¦å‘è¿™ç§è½¬æ¢:")]),s._v(" "),t("ol",[t("li",[s._v("è°ƒç”¨"),t("strong",[s._v("å¸¦è¶…æ—¶å‚æ•°")]),s._v("çš„ Thread.sleep(long millis) æ–¹æ³•;")]),s._v(" "),t("li",[s._v("è·å¾— synchronized éšå¼é”çš„çº¿ç¨‹, è°ƒç”¨"),t("strong",[s._v("å¸¦è¶…æ—¶å‚æ•°")]),s._v("çš„ Object.wait(long timeout) æ–¹æ³•;")]),s._v(" "),t("li",[s._v("è°ƒç”¨"),t("strong",[s._v("å¸¦è¶…æ—¶å‚æ•°")]),s._v("çš„ Thread.join(long millis) æ–¹æ³•;")]),s._v(" "),t("li",[s._v("è°ƒç”¨"),t("strong",[s._v("å¸¦è¶…æ—¶å‚æ•°")]),s._v("çš„ LockSupport.parkNanos(Object blocker, long deadline) æ–¹æ³•;")]),s._v(" "),t("li",[s._v("è°ƒç”¨"),t("strong",[s._v("å¸¦è¶…æ—¶å‚æ•°")]),s._v("çš„ LockSupport.parkUntil(long deadline) æ–¹æ³•.")])]),s._v(" "),t("p",[s._v("å¯ä»¥å‘ç°, å…¶å® TIMED_WAITING å’Œ WAITING çŠ¶æ€çš„åŒºåˆ«, ä»…ä»…æ˜¯è§¦å‘æ¡ä»¶å¤šäº†"),t("strong",[s._v("è¶…æ—¶å‚æ•°")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_4-ä»newåˆ°runnableçŠ¶æ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-ä»newåˆ°runnableçŠ¶æ€"}},[s._v("#")]),s._v(" (4)ä»NEWåˆ°RUNNABLEçŠ¶æ€")]),s._v(" "),t("p",[s._v("Java åˆšåˆ›å»ºå‡ºæ¥çš„ Thread å¯¹è±¡å°±æ˜¯ NEW çŠ¶æ€, è€Œåˆ›å»º Thread å¯¹è±¡ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•. ä¸€ç§æ˜¯ç»§æ‰¿ Thread å¯¹è±¡, é‡å†™ run() æ–¹æ³•. ç¤ºä¾‹ä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è‡ªå®šä¹‰çº¿ç¨‹å¯¹è±¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»£ç ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹å¯¹è±¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThread")]),s._v(" myThread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("å¦ä¸€ç§æ˜¯å®ç° Runnable æ¥å£, é‡å†™ run() æ–¹æ³•, å¹¶å°†è¯¥å®ç°ç±»ä½œä¸ºåˆ›å»º Thread å¯¹è±¡çš„å‚æ•°. ç¤ºä¾‹ä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®ç° Runnable æ¥å£")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runner")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»£ç ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹å¯¹è±¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("strong",[s._v("NEW çŠ¶æ€çš„çº¿ç¨‹, ä¸ä¼šè¢«æ“ä½œç³»ç»Ÿè°ƒåº¦, å› æ­¤ä¸ä¼šæ‰§è¡Œ")]),s._v(". Java çº¿ç¨‹è¦æ‰§è¡Œ, å°±å¿…é¡»è½¬æ¢åˆ° RUNNABLE çŠ¶æ€. ä» NEW çŠ¶æ€è½¬æ¢åˆ° RUNNABLE çŠ¶æ€å¾ˆç®€å•, åªè¦"),t("strong",[s._v("è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„ start() æ–¹æ³•")]),s._v("å°±å¯ä»¥äº†, ç¤ºä¾‹ä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThread")]),s._v(" myThread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä» NEW çŠ¶æ€è½¬æ¢åˆ° RUNNABLE çŠ¶æ€")]),s._v("\nmyThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h6",{attrs:{id:"_5-ä»runnableåˆ°terminatedçŠ¶æ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-ä»runnableåˆ°terminatedçŠ¶æ€"}},[s._v("#")]),s._v(" (5)ä»RUNNABLEåˆ°TERMINATEDçŠ¶æ€")]),s._v(" "),t("p",[t("strong",[s._v("çº¿ç¨‹æ‰§è¡Œå®Œ run() æ–¹æ³•å, ä¼šè‡ªåŠ¨è½¬æ¢åˆ° TERMINATED çŠ¶æ€, å½“ç„¶å¦‚æœæ‰§è¡Œ run() æ–¹æ³•çš„æ—¶å€™å¼‚å¸¸æŠ›å‡º, ä¹Ÿä¼šå¯¼è‡´çº¿ç¨‹ç»ˆæ­¢")]),s._v(". æœ‰æ—¶å€™éœ€è¦å¼ºåˆ¶ä¸­æ–­ run() æ–¹æ³•çš„æ‰§è¡Œ, ä¾‹å¦‚ run() æ–¹æ³•è®¿é—®ä¸€ä¸ªå¾ˆæ…¢çš„ç½‘ç»œ, ç­‰ä¸ä¸‹å»äº†, æƒ³ç»ˆæ­¢æ€ä¹ˆåŠå‘¢? Java çš„ Thread ç±»é‡Œé¢å€’æ˜¯æœ‰ä¸ª stop() æ–¹æ³•, ä¸è¿‡å·²ç»æ ‡è®°ä¸º @Deprecated, æ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨äº†. æ­£ç¡®çš„å§¿åŠ¿å…¶å®æ˜¯è°ƒç”¨ interrupt() æ–¹æ³•.")]),s._v(" "),t("p",[s._v("**é‚£ stop() å’Œ interrupt() æ–¹æ³•çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢? **")]),s._v(" "),t("p",[s._v("stop() æ–¹æ³•ä¼šçœŸçš„æ€æ­»çº¿ç¨‹, ä¸ç»™çº¿ç¨‹å–˜æ¯çš„æœºä¼š, å¦‚æœçº¿ç¨‹æŒæœ‰ ReentrantLock é”, è¢« stop() çš„çº¿ç¨‹å¹¶ä¸ä¼šè‡ªåŠ¨è°ƒç”¨ ReentrantLock çš„ unlock() å»é‡Šæ”¾é”, é‚£å…¶ä»–çº¿ç¨‹å°±å†ä¹Ÿæ²¡æœºä¼šè·å¾— ReentrantLock é”, è¿™å®åœ¨æ˜¯å¤ªå±é™©äº†. æ‰€ä»¥è¯¥æ–¹æ³•å°±ä¸å»ºè®®ä½¿ç”¨äº†, ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰ suspend() å’Œ resume() æ–¹æ³•, è¿™ä¸¤ä¸ªæ–¹æ³•åŒæ ·ä¹Ÿéƒ½ä¸å»ºè®®ä½¿ç”¨äº†.")]),s._v(" "),t("p",[s._v("è€Œ interrupt() æ–¹æ³•å°±æ¸©æŸ”å¤šäº†, "),t("strong",[s._v("interrupt() æ–¹æ³•ä»…ä»…æ˜¯é€šçŸ¥çº¿ç¨‹")]),s._v(", çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œä¸€äº›åç»­æ“ä½œ, åŒæ—¶ä¹Ÿå¯ä»¥æ— è§†è¿™ä¸ªé€šçŸ¥. è¢« interrupt çš„çº¿ç¨‹, æ˜¯æ€ä¹ˆæ”¶åˆ°é€šçŸ¥çš„å‘¢? ä¸€ç§æ˜¯å¼‚å¸¸, å¦ä¸€ç§æ˜¯ä¸»åŠ¨æ£€æµ‹.")]),s._v(" "),t("p",[s._v("å½“çº¿ç¨‹ A å¤„äº WAITING, TIMED_WAITING çŠ¶æ€æ—¶, å¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨çº¿ç¨‹ A çš„ interrupt() æ–¹æ³•, ä¼šä½¿çº¿ç¨‹ A è¿”å›åˆ° RUNNABLE çŠ¶æ€, åŒæ—¶çº¿ç¨‹ A çš„ä»£ç ä¼šè§¦å‘ InterruptedException å¼‚å¸¸. ä¸Šé¢æåˆ°è½¬æ¢åˆ° WAITING, TIMED_WAITING çŠ¶æ€çš„è§¦å‘æ¡ä»¶, éƒ½æ˜¯è°ƒç”¨äº†ç±»ä¼¼ wait(), join(), sleep() è¿™æ ·çš„æ–¹æ³•, çœ‹è¿™äº›æ–¹æ³•çš„ç­¾å, å‘ç°éƒ½ä¼š throws InterruptedException è¿™ä¸ªå¼‚å¸¸. è¿™ä¸ªå¼‚å¸¸çš„è§¦å‘æ¡ä»¶å°±æ˜¯: "),t("strong",[s._v("å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥çº¿ç¨‹çš„ interrupt() æ–¹æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“çº¿ç¨‹ A å¤„äº RUNNABLE çŠ¶æ€æ—¶, å¹¶ä¸”é˜»å¡åœ¨ java.nio.channels.InterruptibleChannel ä¸Šæ—¶, å¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨çº¿ç¨‹ A çš„ interrupt() æ–¹æ³•, çº¿ç¨‹ A ä¼šè§¦å‘ java.nio.channels.ClosedByInterruptException è¿™ä¸ªå¼‚å¸¸; è€Œé˜»å¡åœ¨ java.nio.channels.Selector ä¸Šæ—¶, å¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨çº¿ç¨‹ A çš„ interrupt() æ–¹æ³•, çº¿ç¨‹ A çš„ java.nio.channels.Selector ä¼šç«‹å³è¿”å›.")]),s._v(" "),t("p",[s._v("ä¸Šé¢è¿™ä¸¤ç§æƒ…å†µå±äºè¢«ä¸­æ–­çš„çº¿ç¨‹é€šè¿‡å¼‚å¸¸çš„æ–¹å¼è·å¾—äº†é€šçŸ¥. è¿˜æœ‰ä¸€ç§æ˜¯ä¸»åŠ¨æ£€æµ‹, å¦‚æœçº¿ç¨‹å¤„äº RUNNABLE çŠ¶æ€, å¹¶ä¸”æ²¡æœ‰é˜»å¡åœ¨æŸä¸ª I/O æ“ä½œä¸Š, ä¾‹å¦‚ä¸­æ–­è®¡ç®—åœ†å‘¨ç‡çš„çº¿ç¨‹ A, è¿™æ—¶å°±å¾—ä¾èµ–çº¿ç¨‹ A ä¸»åŠ¨æ£€æµ‹ä¸­æ–­çŠ¶æ€äº†. å¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨çº¿ç¨‹ A çš„ interrupt() æ–¹æ³•, é‚£ä¹ˆçº¿ç¨‹ A å¯ä»¥é€šè¿‡ isInterrupted() æ–¹æ³•, æ£€æµ‹æ˜¯ä¸æ˜¯è‡ªå·±è¢«ä¸­æ–­äº†.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-9"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("ç†è§£ Java çº¿ç¨‹çš„å„ç§çŠ¶æ€ä»¥åŠç”Ÿå‘½å‘¨æœŸå¯¹äºè¯Šæ–­å¤šçº¿ç¨‹ Bug éå¸¸æœ‰å¸®åŠ©, å¤šçº¿ç¨‹ç¨‹åºå¾ˆéš¾è°ƒè¯•, å‡ºäº† Bug åŸºæœ¬ä¸Šéƒ½æ˜¯é æ—¥å¿—, é çº¿ç¨‹ dump æ¥è·Ÿè¸ªé—®é¢˜, åˆ†æçº¿ç¨‹ dump çš„ä¸€ä¸ªåŸºæœ¬åŠŸå°±æ˜¯åˆ†æçº¿ç¨‹çŠ¶æ€, å¤§éƒ¨åˆ†çš„æ­»é”, é¥¥é¥¿, æ´»é”é—®é¢˜éƒ½éœ€è¦è·Ÿè¸ªåˆ†æçº¿ç¨‹çš„çŠ¶æ€. åŒæ—¶æœ¬æ–‡ä»‹ç»çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå…·å¤‡å¾ˆå¼ºçš„é€šç”¨æ€§, å¯¹äºå­¦ä¹ å…¶ä»–è¯­è¨€çš„å¤šçº¿ç¨‹ç¼–ç¨‹ä¹Ÿæœ‰å¾ˆå¤§çš„å¸®åŠ©.")]),s._v(" "),t("h4",{attrs:{id:"_10-javaçº¿ç¨‹-ä¸­-åˆ›å»ºå¤šå°‘çº¿ç¨‹æ‰æ˜¯åˆé€‚çš„-ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-javaçº¿ç¨‹-ä¸­-åˆ›å»ºå¤šå°‘çº¿ç¨‹æ‰æ˜¯åˆé€‚çš„-ğŸ€"}},[s._v("#")]),s._v(" 10-Javaçº¿ç¨‹(ä¸­):åˆ›å»ºå¤šå°‘çº¿ç¨‹æ‰æ˜¯åˆé€‚çš„?ğŸ€")]),s._v(" "),t("p",[s._v("åœ¨ Java é¢†åŸŸ, å®ç°å¹¶å‘ç¨‹åºçš„ä¸»è¦æ‰‹æ®µå°±æ˜¯å¤šçº¿ç¨‹, ä½¿ç”¨å¤šçº¿ç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„, ä½†æ˜¯"),t("strong",[s._v("ä½¿ç”¨å¤šå°‘ä¸ªçº¿ç¨‹")]),s._v('å´æ˜¯ä¸ªå›°éš¾çš„é—®é¢˜. å·¥ä½œä¸­, ç»å¸¸æœ‰äººé—®, "å„ç§çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡è°ƒæ•´æˆå¤šå°‘æ˜¯åˆé€‚çš„?" æˆ–è€… "Tomcat çš„çº¿ç¨‹æ•°, Jdbc è¿æ¥æ± çš„è¿æ¥æ•°æ˜¯å¤šå°‘?" ç­‰ç­‰. é‚£'),t("strong",[s._v("åº”è¯¥å¦‚ä½•è®¾ç½®åˆé€‚çš„çº¿ç¨‹æ•°")]),s._v("å‘¢?")]),s._v(" "),t("p",[s._v("è¦è§£å†³è¿™ä¸ªé—®é¢˜, é¦–å…ˆè¦åˆ†æä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹?")]),s._v(" "),t("li",[s._v("å¤šçº¿ç¨‹çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›?")])]),s._v(" "),t("h5",{attrs:{id:"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹?")]),s._v(" "),t("p",[s._v("ä½¿ç”¨å¤šçº¿ç¨‹, æœ¬è´¨ä¸Šå°±æ˜¯æå‡ç¨‹åºæ€§èƒ½. ä¸è¿‡æ­¤åˆ»è°ˆåˆ°çš„æ€§èƒ½, å¯èƒ½åœ¨ä½ è„‘æµ·é‡Œè¿˜æ˜¯æ¯”è¾ƒç¬¼ç»Ÿçš„, åŸºæœ¬ä¸Šå°±æ˜¯å¿«, å¿«, å¿«, è¿™ç§æ— æ³•åº¦é‡çš„æ„Ÿæ€§è®¤è¯†å¾ˆä¸ç§‘å­¦, æ‰€ä»¥åœ¨æå‡æ€§èƒ½ä¹‹å‰, é¦–è¦é—®é¢˜æ˜¯: "),t("strong",[s._v("å¦‚ä½•åº¦é‡æ€§èƒ½")]),s._v(".")]),s._v(" "),t("p",[s._v("åº¦é‡æ€§èƒ½çš„æŒ‡æ ‡æœ‰å¾ˆå¤š, ä½†æ˜¯æœ‰ä¸¤ä¸ªæŒ‡æ ‡æ˜¯æœ€æ ¸å¿ƒçš„, å®ƒä»¬å°±æ˜¯"),t("strong",[s._v("å»¶è¿Ÿå’Œååé‡")]),s._v(". "),t("strong",[s._v("å»¶è¿Ÿ")]),s._v("æŒ‡çš„æ˜¯å‘å‡ºè¯·æ±‚åˆ°æ”¶åˆ°å“åº”è¿™ä¸ªè¿‡ç¨‹çš„æ—¶é—´; å»¶è¿Ÿè¶ŠçŸ­, æ„å‘³ç€ç¨‹åºæ‰§è¡Œå¾—è¶Šå¿«, æ€§èƒ½ä¹Ÿå°±è¶Šå¥½. "),t("strong",[s._v("ååé‡")]),s._v("æŒ‡çš„æ˜¯åœ¨å•ä½æ—¶é—´å†…èƒ½å¤„ç†è¯·æ±‚çš„æ•°é‡; ååé‡è¶Šå¤§, æ„å‘³ç€ç¨‹åºèƒ½å¤„ç†çš„è¯·æ±‚è¶Šå¤š, æ€§èƒ½ä¹Ÿå°±è¶Šå¥½. è¿™ä¸¤ä¸ªæŒ‡æ ‡å†…éƒ¨æœ‰ä¸€å®šçš„è”ç³»(åŒç­‰æ¡ä»¶ä¸‹, å»¶è¿Ÿè¶ŠçŸ­, ååé‡è¶Šå¤§), ä½†æ˜¯ç”±äºå®ƒä»¬éš¶å±ä¸åŒçš„ç»´åº¦(ä¸€ä¸ªæ˜¯æ—¶é—´ç»´åº¦, ä¸€ä¸ªæ˜¯ç©ºé—´ç»´åº¦), å¹¶ä¸èƒ½äº’ç›¸è½¬æ¢.")]),s._v(" "),t("p",[s._v("æ‰€è°“æå‡æ€§èƒ½, ä»åº¦é‡çš„è§’åº¦, ä¸»è¦æ˜¯"),t("strong",[s._v("é™ä½å»¶è¿Ÿ, æé«˜ååé‡")]),s._v(". è¿™ä¹Ÿæ˜¯ä½¿ç”¨å¤šçº¿ç¨‹çš„ä¸»è¦ç›®çš„. é‚£è¯¥æ€ä¹ˆé™ä½å»¶è¿Ÿ, æé«˜ååé‡å‘¢? è¿™ä¸ªå°±è¦ä»å¤šçº¿ç¨‹çš„åº”ç”¨åœºæ™¯è¯´èµ·äº†.")]),s._v(" "),t("h5",{attrs:{id:"å¤šçº¿ç¨‹çš„åº”ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¤šçº¿ç¨‹çš„åº”ç”¨åœºæ™¯"}},[s._v("#")]),s._v(" å¤šçº¿ç¨‹çš„åº”ç”¨åœºæ™¯")]),s._v(" "),t("p",[s._v('è¦æƒ³ "é™ä½å»¶è¿Ÿ, æé«˜ååé‡", å¯¹åº”çš„æ–¹æ³•, åŸºæœ¬ä¸Šæœ‰ä¸¤ä¸ªæ–¹å‘, ä¸€ä¸ªæ–¹å‘æ˜¯'),t("strong",[s._v("ä¼˜åŒ–ç®—æ³•")]),s._v(", å¦ä¸€ä¸ªæ–¹å‘æ˜¯"),t("strong",[s._v("å°†ç¡¬ä»¶çš„æ€§èƒ½å‘æŒ¥åˆ°æè‡´")]),s._v(". å‰è€…å±äºç®—æ³•èŒƒç•´, åè€…åˆ™æ˜¯å’Œå¹¶å‘ç¼–ç¨‹æ¯æ¯ç›¸å…³äº†. é‚£è®¡ç®—æœºä¸»è¦æœ‰å“ªäº›ç¡¬ä»¶å‘¢? ä¸»è¦æ˜¯ä¸¤ç±»: ä¸€ä¸ªæ˜¯ I/O, ä¸€ä¸ªæ˜¯ CPU. ç®€è¨€ä¹‹, "),t("strong",[s._v("åœ¨å¹¶å‘ç¼–ç¨‹é¢†åŸŸ, æå‡æ€§èƒ½æœ¬è´¨ä¸Šå°±æ˜¯æå‡ç¡¬ä»¶çš„åˆ©ç”¨ç‡, å†å…·ä½“ç‚¹æ¥è¯´, å°±æ˜¯æå‡ I/O çš„åˆ©ç”¨ç‡å’Œ CPU çš„åˆ©ç”¨ç‡")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¼°è®¡è¿™ä¸ªæ—¶å€™ä½ ä¼šæœ‰ä¸ªç–‘é—®, æ“ä½œç³»ç»Ÿä¸æ˜¯å·²ç»è§£å†³äº†ç¡¬ä»¶çš„åˆ©ç”¨ç‡é—®é¢˜äº†å—? çš„ç¡®æ˜¯è¿™æ ·, ä¾‹å¦‚æ“ä½œç³»ç»Ÿå·²ç»è§£å†³äº†ç£ç›˜å’Œç½‘å¡çš„åˆ©ç”¨ç‡é—®é¢˜, åˆ©ç”¨ä¸­æ–­æœºåˆ¶è¿˜èƒ½é¿å… CPU è½®è¯¢ I/O çŠ¶æ€, ä¹Ÿæå‡äº† CPU çš„åˆ©ç”¨ç‡. ä½†æ˜¯æ“ä½œç³»ç»Ÿè§£å†³ç¡¬ä»¶åˆ©ç”¨ç‡é—®é¢˜çš„å¯¹è±¡å¾€å¾€æ˜¯å•ä¸€çš„ç¡¬ä»¶è®¾å¤‡, è€Œå¹¶å‘ç¨‹åº, å¾€å¾€éœ€è¦ CPU å’Œ I/O è®¾å¤‡ç›¸äº’é…åˆå·¥ä½œ, ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("éœ€è¦è§£å†³ CPU å’Œ I/O è®¾å¤‡ç»¼åˆåˆ©ç”¨ç‡çš„é—®é¢˜")]),s._v(". å…³äºè¿™ä¸ªç»¼åˆåˆ©ç”¨ç‡çš„é—®é¢˜, æ“ä½œç³»ç»Ÿè™½ç„¶æ²¡æœ‰åŠæ³•å®Œç¾è§£å†³, ä½†æ˜¯å´æä¾›äº†æ–¹æ¡ˆ, é‚£å°±æ˜¯: å¤šçº¿ç¨‹.")]),s._v(" "),t("p",[s._v("ä¸‹é¢ç”¨ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥è¯´æ˜: å¦‚ä½•åˆ©ç”¨å¤šçº¿ç¨‹æ¥æå‡ CPU å’Œ I/O è®¾å¤‡çš„åˆ©ç”¨ç‡? å‡è®¾ç¨‹åºæŒ‰ç…§ CPU è®¡ç®—å’Œ I/O æ“ä½œäº¤å‰æ‰§è¡Œçš„æ–¹å¼è¿è¡Œ, è€Œä¸” CPU è®¡ç®—å’Œ I/O æ“ä½œçš„è€—æ—¶æ˜¯ 1:1.")]),s._v(" "),t("p",[s._v("å¦‚ä¸‹å›¾æ‰€ç¤º, å¦‚æœ"),t("strong",[s._v("åªæœ‰ä¸€ä¸ªçº¿ç¨‹")]),s._v(", æ‰§è¡Œ CPU è®¡ç®—çš„æ—¶å€™, I/O è®¾å¤‡ç©ºé—²; æ‰§è¡Œ I/O æ“ä½œçš„æ—¶å€™, CPU ç©ºé—², æ‰€ä»¥ CPU çš„åˆ©ç”¨ç‡å’Œ I/O è®¾å¤‡çš„åˆ©ç”¨ç‡éƒ½æ˜¯ 50%.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b5ee606d45d6a5c278cac82e0ba4aa66-20230731162452-4my2t0r.png",alt:"",title:"å•çº¿ç¨‹æ‰§è¡Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å¦‚æœ"),t("strong",[s._v("æœ‰ä¸¤ä¸ªçº¿ç¨‹")]),s._v(", å¦‚ä¸‹å›¾æ‰€ç¤º, å½“çº¿ç¨‹ A æ‰§è¡Œ CPU è®¡ç®—çš„æ—¶å€™, çº¿ç¨‹ B æ‰§è¡Œ I/O æ“ä½œ; å½“çº¿ç¨‹ A æ‰§è¡Œ I/O æ“ä½œçš„æ—¶å€™, çº¿ç¨‹ B æ‰§è¡Œ CPU è®¡ç®—, è¿™æ · CPU çš„åˆ©ç”¨ç‡å’Œ I/O è®¾å¤‡çš„åˆ©ç”¨ç‡å°±éƒ½è¾¾åˆ°äº† 100%.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c4b11ea40c23a006e955f7963570495f-20230731162452-zgdm6ug.png",alt:"",title:"äºŒçº¿ç¨‹æ‰§è¡Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å°† CPU çš„åˆ©ç”¨ç‡å’Œ I/O è®¾å¤‡çš„åˆ©ç”¨ç‡éƒ½æå‡åˆ°äº† 100%, ä¼šå¯¹æ€§èƒ½äº§ç”Ÿäº†å“ªäº›å½±å“å‘¢? é€šè¿‡ä¸Šé¢çš„å›¾ç¤º, å¾ˆå®¹æ˜“çœ‹å‡º: å•ä½æ—¶é—´å¤„ç†çš„è¯·æ±‚æ•°é‡ç¿»äº†ä¸€ç•ª, ä¹Ÿå°±æ˜¯è¯´ååé‡æé«˜äº† 1 å€. æ­¤æ—¶å¯ä»¥é€†å‘æ€ç»´ä¸€ä¸‹, "),t("mark",[t("strong",[s._v("å¦‚æœ CPU å’Œ I/O è®¾å¤‡çš„åˆ©ç”¨ç‡éƒ½å¾ˆä½, é‚£ä¹ˆå¯ä»¥å°è¯•é€šè¿‡å¢åŠ çº¿ç¨‹æ¥æé«˜ååé‡")])]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("åœ¨å•æ ¸æ—¶ä»£, å¤šçº¿ç¨‹ä¸»è¦å°±æ˜¯ç”¨æ¥å¹³è¡¡ CPU å’Œ I/O è®¾å¤‡çš„")]),s._v(". å¦‚æœç¨‹åºåªæœ‰ CPU è®¡ç®—, è€Œæ²¡æœ‰ I/O æ“ä½œçš„è¯, å¤šçº¿ç¨‹ä¸ä½†ä¸ä¼šæå‡æ€§èƒ½, è¿˜ä¼šä½¿æ€§èƒ½å˜å¾—æ›´å·®, åŸå› æ˜¯å¢åŠ äº†çº¿ç¨‹åˆ‡æ¢çš„æˆæœ¬. ä½†æ˜¯åœ¨å¤šæ ¸æ—¶ä»£, è¿™ç§çº¯è®¡ç®—å‹çš„ç¨‹åºä¹Ÿå¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹æ¥æå‡æ€§èƒ½. ä¸ºä»€ä¹ˆå‘¢? "),t("strong",[s._v("å› ä¸ºåˆ©ç”¨å¤šæ ¸å¯ä»¥é™ä½å“åº”æ—¶é—´")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸ºä¾¿äºç†è§£, è¿™é‡Œä¸¾ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜ä¸€ä¸‹: è®¡ç®— 1+2+...+100 äº¿çš„å€¼, å¦‚æœåœ¨ 4 æ ¸çš„ CPU ä¸Šåˆ©ç”¨ 4 ä¸ªçº¿ç¨‹æ‰§è¡Œ, çº¿ç¨‹ A è®¡ç®— [1, 25 äº¿), çº¿ç¨‹ B è®¡ç®— [25 äº¿, 50 äº¿), çº¿ç¨‹ C è®¡ç®— [50, 75 äº¿), çº¿ç¨‹ D è®¡ç®— [75 äº¿, 100 äº¿], ä¹‹åæ±‡æ€», é‚£ä¹ˆç†è®ºä¸Šåº”è¯¥æ¯”ä¸€ä¸ªçº¿ç¨‹è®¡ç®— [1, 100 äº¿] å¿«å°†è¿‘ 4 å€, å“åº”æ—¶é—´èƒ½å¤Ÿé™åˆ° 25%. ä¸€ä¸ªçº¿ç¨‹, å¯¹äº 4 æ ¸çš„ CPU, CPU çš„åˆ©ç”¨ç‡åªæœ‰ 25%, è€Œ 4 ä¸ªçº¿ç¨‹, åˆ™èƒ½å¤Ÿå°† CPU çš„åˆ©ç”¨ç‡æé«˜åˆ° 100%.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3c0cf831d6c80dc83976f88f99b23c18-20230731162452-rjehpzy.png",alt:"",title:"å¤šæ ¸æ‰§è¡Œå¤šçº¿ç¨‹ç¤ºæ„å›¾"}})]),s._v(" "),t("h5",{attrs:{id:"åˆ›å»ºå¤šå°‘çº¿ç¨‹åˆé€‚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºå¤šå°‘çº¿ç¨‹åˆé€‚"}},[s._v("#")]),s._v(" åˆ›å»ºå¤šå°‘çº¿ç¨‹åˆé€‚?")]),s._v(" "),t("p",[s._v("åˆ›å»ºå¤šå°‘çº¿ç¨‹åˆé€‚, è¦çœ‹å¤šçº¿ç¨‹å…·ä½“çš„åº”ç”¨åœºæ™¯. "),t("strong",[s._v("ç¨‹åºä¸€èˆ¬éƒ½æ˜¯ CPU è®¡ç®—å’Œ I/O æ“ä½œäº¤å‰æ‰§è¡Œçš„")]),s._v(", ç”±äº I/O è®¾å¤‡çš„é€Ÿåº¦ç›¸å¯¹äº CPU æ¥è¯´éƒ½å¾ˆæ…¢, æ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹, I/O æ“ä½œæ‰§è¡Œçš„æ—¶é—´ç›¸å¯¹äº CPU è®¡ç®—æ¥è¯´éƒ½éå¸¸é•¿, è¿™ç§åœºæ™¯ä¸€èˆ¬éƒ½ç§°ä¸º I/O å¯†é›†å‹è®¡ç®—; å’Œ I/O å¯†é›†å‹è®¡ç®—ç›¸å¯¹çš„å°±æ˜¯ CPU å¯†é›†å‹è®¡ç®—äº†, CPU å¯†é›†å‹è®¡ç®—å¤§éƒ¨åˆ†åœºæ™¯ä¸‹éƒ½æ˜¯çº¯ CPU è®¡ç®—. I/O å¯†é›†å‹ç¨‹åºå’Œ CPU å¯†é›†å‹ç¨‹åº, è®¡ç®—æœ€ä½³çº¿ç¨‹æ•°çš„æ–¹æ³•æ˜¯ä¸åŒçš„.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å¯¹è¿™ä¸¤ä¸ªåœºæ™¯åˆ†åˆ«è¯´æ˜.")]),s._v(" "),t("p",[s._v("å¯¹äº "),t("strong",[s._v("CPU å¯†é›†å‹è®¡ç®—")]),s._v(", å¤šçº¿ç¨‹æœ¬è´¨ä¸Šæ˜¯"),t("mark",[t("strong",[s._v("æå‡å¤šæ ¸ CPU çš„åˆ©ç”¨ç‡")])]),s._v(', æ‰€ä»¥å¯¹äºä¸€ä¸ª 4 æ ¸çš„ CPU, æ¯ä¸ªæ ¸ä¸€ä¸ªçº¿ç¨‹, ç†è®ºä¸Šåˆ›å»º 4 ä¸ªçº¿ç¨‹å°±å¯ä»¥äº†, å†å¤šåˆ›å»ºçº¿ç¨‹ä¹Ÿåªæ˜¯å¢åŠ çº¿ç¨‹åˆ‡æ¢çš„æˆæœ¬. æ‰€ä»¥, **å¯¹äº CPU å¯†é›†å‹çš„è®¡ç®—åœºæ™¯, ç†è®ºä¸Š "'),t("strong",[s._v("â€‹")]),s._v("==çº¿ç¨‹çš„æ•°é‡ = CPU æ ¸æ•°"),t("mark",[s._v("**â€‹ "),t("strong",[s._v('" å°±æ˜¯æœ€åˆé€‚çš„')]),s._v(". ä¸è¿‡åœ¨å·¥ç¨‹ä¸Š, "),t("strong",[s._v('çº¿ç¨‹çš„æ•°é‡ä¸€èˆ¬ä¼šè®¾ç½®ä¸º "'),t("strong",[s._v("â€‹")])])]),s._v("CPU æ ¸æ•° +=="),s._v(" "),t("strong",[s._v('1"')]),s._v(" , è¿™æ ·çš„è¯, "),t("strong",[s._v("å½“çº¿ç¨‹å› ä¸ºå¶å°”çš„å†…å­˜é¡µå¤±æ•ˆæˆ–å…¶ä»–åŸå› å¯¼è‡´é˜»å¡æ—¶, è¿™ä¸ªé¢å¤–çš„çº¿ç¨‹å¯ä»¥é¡¶ä¸Š, ä»è€Œä¿è¯ CPU çš„åˆ©ç”¨ç‡")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯¹äº "),t("strong",[s._v("I/O å¯†é›†å‹çš„è®¡ç®—")]),s._v("åœºæ™¯, æ¯”å¦‚å‰é¢çš„ä¾‹å­ä¸­, å¦‚æœ CPU è®¡ç®—å’Œ I/O æ“ä½œçš„"),t("strong",[s._v("è€—æ—¶æ˜¯ 1:1")]),s._v(", é‚£ä¹ˆ 2 ä¸ªçº¿ç¨‹æ˜¯æœ€åˆé€‚çš„. å¦‚æœ CPU è®¡ç®—å’Œ I/O æ“ä½œçš„"),t("strong",[s._v("è€—æ—¶æ˜¯ 1:2")]),s._v(", é‚£å¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚å‘¢? æ˜¯ 3 ä¸ªçº¿ç¨‹, å¦‚ä¸‹å›¾æ‰€ç¤º: CPU åœ¨ A, B, C ä¸‰ä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢, å¯¹äºçº¿ç¨‹ A, å½“ CPU ä» B, C åˆ‡æ¢å›æ¥æ—¶, çº¿ç¨‹ A æ­£å¥½æ‰§è¡Œå®Œ I/O æ“ä½œ. è¿™æ · CPU å’Œ I/O è®¾å¤‡çš„åˆ©ç”¨ç‡éƒ½è¾¾åˆ°äº† 100%.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6556668e05a6637c239b382b3e33b68d-20230731162452-9rhk5gh.png",alt:"",title:"ä¸‰çº¿ç¨‹æ‰§è¡Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šé¢è¿™ä¸ªä¾‹å­å¯ä»¥å‘ç°, å¯¹äº "),t("strong",[s._v("I/O å¯†é›†å‹è®¡ç®—åœºæ™¯")]),s._v(", æœ€ä½³çš„çº¿ç¨‹æ•°æ˜¯ä¸ç¨‹åºä¸­ CPU è®¡ç®—å’Œ I/O æ“ä½œçš„è€—æ—¶æ¯”ç›¸å…³çš„, å¯ä»¥æ€»ç»“å‡ºè¿™æ ·ä¸€ä¸ªå…¬å¼:")]),s._v(" "),t("blockquote",[t("p",[s._v("æœ€ä½³çº¿ç¨‹æ•° = 1 + (I/Oè€—æ—¶ / CPUè€—æ—¶)")])]),s._v(" "),t("p",[s._v("ä»¤ R=I/Oè€—æ—¶ / CPUè€—æ—¶, ç»¼åˆä¸Šå›¾, å¯ä»¥è¿™æ ·ç†è§£: "),t("strong",[s._v("å½“çº¿ç¨‹ A æ‰§è¡Œ IO æ“ä½œæ—¶, å¦å¤– R ä¸ªçº¿ç¨‹æ­£å¥½æ‰§è¡Œå®Œå„è‡ªçš„ CPU è®¡ç®—. è¿™æ · CPU çš„åˆ©ç”¨ç‡å°±è¾¾åˆ°äº† 100%")]),s._v(" .")]),s._v(" "),t("p",[s._v("ä¸è¿‡ä¸Šé¢è¿™ä¸ªå…¬å¼æ˜¯é’ˆå¯¹"),t("strong",[s._v("å•æ ¸ CPU çš„")]),s._v(", è‡³äºå¤šæ ¸ CPU, ä¹Ÿå¾ˆç®€å•, åªéœ€è¦"),t("strong",[s._v("ç­‰æ¯”æ‰©å¤§")]),s._v("å°±å¯ä»¥äº†, è®¡ç®—å…¬å¼å¦‚ä¸‹:")]),s._v(" "),t("blockquote",[t("p",[s._v("æœ€ä½³çº¿ç¨‹æ•° = CPU æ ¸æ•° * [ 1 + (I/Oè€—æ—¶ / CPUè€—æ—¶)]")])]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-10"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-10"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("å¾ˆå¤šäººéƒ½çŸ¥é“çº¿ç¨‹æ•°ä¸æ˜¯è¶Šå¤šè¶Šå¥½, ä½†æ˜¯è®¾ç½®å¤šå°‘æ˜¯åˆé€‚çš„, å´åˆæ‹¿ä¸å®šä¸»æ„. å…¶å®åªè¦æŠŠæ¡ä½ä¸€æ¡åŸåˆ™å°±å¯ä»¥äº†, è¿™æ¡åŸåˆ™å°±æ˜¯"),t("strong",[s._v("å°†ç¡¬ä»¶çš„æ€§èƒ½å‘æŒ¥åˆ°æè‡´")]),s._v(". ä¸Šé¢é’ˆå¯¹ CPU å¯†é›†å‹å’Œ I/O å¯†é›†å‹è®¡ç®—åœºæ™¯éƒ½ç»™å‡ºäº†ç†è®ºä¸Šçš„æœ€ä½³å…¬å¼, è¿™äº›å…¬å¼èƒŒåçš„ç›®æ ‡å…¶å®å°±æ˜¯"),t("strong",[s._v("å°†ç¡¬ä»¶çš„æ€§èƒ½å‘æŒ¥åˆ°æè‡´")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯¹äº I/O å¯†é›†å‹è®¡ç®—åœºæ™¯, I/O è€—æ—¶å’Œ CPU è€—æ—¶çš„æ¯”å€¼æ˜¯ä¸€ä¸ªå…³é”®å‚æ•°, ä¸å¹¸çš„æ˜¯è¿™ä¸ªå‚æ•°æ˜¯æœªçŸ¥çš„, è€Œä¸”æ˜¯åŠ¨æ€å˜åŒ–çš„, æ‰€ä»¥å·¥ç¨‹ä¸Šè¦ä¼°ç®—è¿™ä¸ªå‚æ•°, ç„¶ååšå„ç§ä¸åŒåœºæ™¯ä¸‹çš„å‹æµ‹æ¥éªŒè¯ä¼°è®¡. ä¸è¿‡å·¥ç¨‹ä¸Š, åŸåˆ™è¿˜æ˜¯"),t("strong",[s._v("å°†ç¡¬ä»¶çš„æ€§èƒ½å‘æŒ¥åˆ°æè‡´")]),s._v(", æ‰€ä»¥å‹æµ‹æ—¶, éœ€è¦é‡ç‚¹å…³æ³¨ CPU, I/O è®¾å¤‡çš„åˆ©ç”¨ç‡å’Œæ€§èƒ½æŒ‡æ ‡(å“åº”æ—¶é—´, ååé‡)ä¹‹é—´çš„å…³ç³».")]),s._v(" "),t("h4",{attrs:{id:"_11-javaçº¿ç¨‹-ä¸‹-ä¸ºä»€ä¹ˆå±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„-ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-javaçº¿ç¨‹-ä¸‹-ä¸ºä»€ä¹ˆå±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„-ğŸ€"}},[s._v("#")]),s._v(" 11-Javaçº¿ç¨‹(ä¸‹):ä¸ºä»€ä¹ˆå±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„?ğŸ€")]),s._v(" "),t("p",[s._v("å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«å˜é‡çš„æ—¶å€™, ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜. é‚£åœ¨ Java è¯­è¨€é‡Œ, æ˜¯ä¸æ˜¯æ‰€æœ‰å˜é‡éƒ½æ˜¯å…±äº«å˜é‡å‘¢? å·¥ä½œä¸­æˆ‘å‘ç°ä¸å°‘åŒå­¦ä¼šç»™æ–¹æ³•é‡Œé¢çš„å±€éƒ¨å˜é‡è®¾ç½®åŒæ­¥, æ˜¾ç„¶è¿™äº›åŒå­¦å¹¶æ²¡æœ‰æŠŠå…±äº«å˜é‡ææ¸…æ¥š. é‚£ Java æ–¹æ³•é‡Œé¢çš„å±€éƒ¨å˜é‡æ˜¯å¦å­˜åœ¨å¹¶å‘é—®é¢˜å‘¢? ä¸‹é¢å°±å…ˆç»“åˆä¸€ä¸ªä¾‹å­å‰–æä¸‹è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚, ä¸‹é¢ä»£ç é‡Œçš„ fibonacci() è¿™ä¸ªæ–¹æ³•, ä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•° n, è¿”å› 1 åˆ° n çš„æ–æ³¢é‚£å¥‘æ•°åˆ—, æ–æ³¢é‚£å¥‘æ•°åˆ—ç±»ä¼¼è¿™æ ·:  1, 1, 2, 3, 5, 8, 13, 21, 34... ç¬¬ 1 é¡¹å’Œç¬¬ 2 é¡¹æ˜¯ 1, ä»ç¬¬ 3 é¡¹å¼€å§‹, æ¯ä¸€é¡¹éƒ½ç­‰äºå‰ä¸¤é¡¹ä¹‹å’Œ. åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢, æœ‰ä¸ªå±€éƒ¨å˜é‡: æ•°ç»„ r ç”¨æ¥ä¿å­˜æ•°åˆ—çš„ç»“æœ, æ¯æ¬¡è®¡ç®—å®Œä¸€é¡¹, éƒ½ä¼šæ›´æ–°æ•°ç»„ r å¯¹åº”ä½ç½®ä¸­çš„å€¼. å¯ä»¥æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜, å½“å¤šä¸ªçº¿ç¨‹è°ƒç”¨ fibonacci() è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™, æ•°ç»„ r æ˜¯å¦å­˜åœ¨æ•°æ®ç«äº‰(Data Race)å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›æ–æ³¢é‚£å¥‘æ•°åˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fibonacci")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºç»“æœæ•°ç»„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆå§‹åŒ–ç¬¬ä¸€, ç¬¬äºŒä¸ªæ•°")]),s._v("\n    r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¡ç®— 2..n")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("å¯ä»¥åœ¨å¤§è„‘é‡Œæ¨¡æ‹Ÿä¸€ä¸‹å¤šä¸ªçº¿ç¨‹è°ƒç”¨ fibonacci() æ–¹æ³•çš„æƒ…æ™¯, å‡è®¾å¤šä¸ªçº¿ç¨‹æ‰§è¡Œåˆ° â‘  å¤„, å¤šä¸ªçº¿ç¨‹éƒ½è¦å¯¹æ•°ç»„ r çš„ç¬¬ 1 é¡¹å’Œç¬¬ 2 é¡¹èµ‹å€¼, è¿™é‡Œçœ‹ä¸Šå»æ„Ÿè§‰æ˜¯å­˜åœ¨æ•°æ®ç«äº‰çš„, ä¸è¿‡æ„Ÿè§‰å†æ¬¡æ¬ºéª—äº†ä½ .")]),s._v(" "),t("p",[s._v("å…¶å®å¾ˆå¤šäººä¹Ÿæ˜¯çŸ¥é“"),t("strong",[s._v("å±€éƒ¨å˜é‡ä¸å­˜åœ¨æ•°æ®ç«äº‰")]),s._v("çš„, ä½†æ˜¯è‡³äºåŸå› å˜›, å°±è¯´ä¸æ¸…æ¥šäº†.")]),s._v(" "),t("p",[s._v('é‚£å®ƒèƒŒåçš„åŸå› åˆ°åº•æ˜¯æ€æ ·çš„å‘¢? è¦å¼„æ¸…æ¥šè¿™ä¸ª, å°±éœ€è¦ä¸€ç‚¹ç¼–è¯‘åŸç†çš„çŸ¥è¯†. åœ¨ CPU å±‚é¢, æ˜¯æ²¡æœ‰æ–¹æ³•æ¦‚å¿µçš„, CPU çš„çœ¼é‡Œ, åªæœ‰ä¸€æ¡æ¡çš„æŒ‡ä»¤. ç¼–è¯‘ç¨‹åº, è´Ÿè´£æŠŠé«˜çº§è¯­è¨€é‡Œçš„æ–¹æ³•è½¬æ¢æˆä¸€æ¡æ¡çš„æŒ‡ä»¤. æ‰€ä»¥å¯ä»¥ç«™åœ¨ç¼–è¯‘å™¨å®ç°è€…çš„è§’åº¦æ¥æ€è€ƒ "æ€ä¹ˆå®Œæˆæ–¹æ³•åˆ°æŒ‡ä»¤çš„è½¬æ¢".')]),s._v(" "),t("h5",{attrs:{id:"æ–¹æ³•æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ–¹æ³•æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„"}},[s._v("#")]),s._v(" æ–¹æ³•æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„")]),s._v(" "),t("p",[s._v("é«˜çº§è¯­è¨€é‡Œçš„æ™®é€šè¯­å¥, ä¾‹å¦‚ä¸Šé¢çš„ "),t("code",[s._v("r[i] = r[i-2] + r[i-1];")]),s._v("â€‹ ç¿»è¯‘æˆ CPU çš„æŒ‡ä»¤ç›¸å¯¹ç®€å•, å¯æ–¹æ³•çš„è°ƒç”¨å°±æ¯”è¾ƒå¤æ‚äº†. ä¾‹å¦‚ä¸‹é¢è¿™ä¸‰è¡Œä»£ç : ç¬¬ 1 è¡Œ, å£°æ˜ä¸€ä¸ª int å˜é‡ a; ç¬¬ 2 è¡Œ, è°ƒç”¨æ–¹æ³• fibonacci(a); ç¬¬ 3 è¡Œ, å°† b èµ‹å€¼ç»™ c.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fibonacci")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å½“è°ƒç”¨ fibonacci(a) çš„æ—¶å€™, CPU è¦å…ˆæ‰¾åˆ°æ–¹æ³• fibonacci() çš„åœ°å€, ç„¶åè·³è½¬åˆ°è¿™ä¸ªåœ°å€å»æ‰§è¡Œä»£ç , æœ€å CPU æ‰§è¡Œå®Œæ–¹æ³• fibonacci() ä¹‹å, è¦èƒ½å¤Ÿè¿”å›. é¦–å…ˆæ‰¾åˆ°è°ƒç”¨æ–¹æ³•çš„ä¸‹ä¸€æ¡è¯­å¥çš„åœ°å€: ä¹Ÿå°±æ˜¯ "),t("code",[s._v("int[] c=b;")]),s._v("â€‹ çš„åœ°å€, å†è·³è½¬åˆ°è¿™ä¸ªåœ°å€å»æ‰§è¡Œ. å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªå›¾å†åŠ æ·±ä¸€ä¸‹ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/961d3abf78f9e9cba87d1721042cc98f-20230731162452-napm5pp.png",alt:"",title:"æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹"}})]),s._v(" "),t("p",[s._v('åˆ°è¿™é‡Œ, æ–¹æ³•è°ƒç”¨çš„è¿‡ç¨‹æƒ³å¿…ä½ å·²ç»æ¸…æ¥šäº†, ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜, "CPU å»å“ªé‡Œæ‰¾åˆ°è°ƒç”¨æ–¹æ³•çš„å‚æ•°å’Œè¿”å›åœ°å€?" å¦‚æœä½ ç†Ÿæ‚‰ CPU çš„å·¥ä½œåŸç†, ä½ åº”è¯¥ä¼šç«‹åˆ»æƒ³åˆ°: '),t("strong",[s._v("é€šè¿‡ CPU çš„å †æ ˆå¯„å­˜å™¨")]),s._v(". CPU æ”¯æŒä¸€ç§æ ˆç»“æ„, æ ˆä½ ä¸€å®šå¾ˆç†Ÿæ‚‰äº†, å°±åƒæ‰‹æªçš„å¼¹å¤¹, å…ˆå…¥åå‡º. å› ä¸ºè¿™ä¸ªæ ˆæ˜¯å’Œæ–¹æ³•è°ƒç”¨ç›¸å…³çš„, å› æ­¤ç»å¸¸è¢«ç§°ä¸º"),t("strong",[s._v("è°ƒç”¨æ ˆ")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¾‹å¦‚, æœ‰ä¸‰ä¸ªæ–¹æ³• A, B, C, ä»–ä»¬çš„è°ƒç”¨å…³ç³»æ˜¯ A->B->C(A è°ƒç”¨ B, B è°ƒç”¨ C), åœ¨è¿è¡Œæ—¶, ä¼šæ„å»ºå‡ºä¸‹é¢è¿™æ ·çš„è°ƒç”¨æ ˆ. æ¯ä¸ªæ–¹æ³•åœ¨è°ƒç”¨æ ˆé‡Œéƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹ç©ºé—´, ç§°ä¸º"),t("strong",[s._v("æ ˆå¸§")]),s._v(", æ¯ä¸ªæ ˆå¸§é‡Œéƒ½æœ‰å¯¹åº”æ–¹æ³•éœ€è¦çš„"),t("strong",[s._v("å‚æ•°å’Œè¿”å›åœ°å€")]),s._v(". å½“è°ƒç”¨æ–¹æ³•æ—¶, ä¼šåˆ›å»ºæ–°çš„æ ˆå¸§, å¹¶å‹å…¥è°ƒç”¨æ ˆ; å½“æ–¹æ³•è¿”å›æ—¶, å¯¹åº”çš„æ ˆå¸§å°±ä¼šè¢«è‡ªåŠ¨å¼¹å‡º. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("æ ˆå¸§å’Œæ–¹æ³•æ˜¯åŒç”Ÿå…±æ­»çš„")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a5174d867f41b2d77d3b351b011d4fff-20230731162452-6qbmt6a.png",alt:"",title:"è°ƒç”¨æ ˆç»“æ„"}})]),s._v(" "),t("p",[s._v("åˆ©ç”¨æ ˆç»“æ„æ¥æ”¯æŒæ–¹æ³•è°ƒç”¨è¿™ä¸ªæ–¹æ¡ˆéå¸¸æ™®é, ä»¥è‡³äº CPU é‡Œå†…ç½®äº†æ ˆå¯„å­˜å™¨. è™½ç„¶å„å®¶ç¼–ç¨‹è¯­è¨€å®šä¹‰çš„æ–¹æ³•åƒå¥‡ç™¾æ€ª, ä½†æ˜¯æ–¹æ³•çš„å†…éƒ¨æ‰§è¡ŒåŸç†å´æ˜¯å‡ºå¥‡çš„ä¸€è‡´: éƒ½æ˜¯"),t("strong",[s._v("é æ ˆç»“æ„è§£å†³")]),s._v("çš„. Java è¯­è¨€è™½ç„¶æ˜¯é è™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œçš„, ä½†æ˜¯æ–¹æ³•çš„è°ƒç”¨ä¹Ÿæ˜¯åˆ©ç”¨æ ˆç»“æ„è§£å†³çš„.")]),s._v(" "),t("h5",{attrs:{id:"å±€éƒ¨å˜é‡å­˜å“ªé‡Œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å±€éƒ¨å˜é‡å­˜å“ªé‡Œ"}},[s._v("#")]),s._v(" å±€éƒ¨å˜é‡å­˜å“ªé‡Œ?")]),s._v(" "),t("p",[s._v("å‰é¢å·²ç»çŸ¥é“äº†æ–¹æ³•é—´çš„è°ƒç”¨åœ¨ CPU çœ¼é‡Œæ˜¯æ€ä¹ˆæ‰§è¡Œçš„, ä½†è¿˜æœ‰ä¸€ä¸ªå…³é”®é—®é¢˜: "),t("strong",[s._v("æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡å­˜å“ªé‡Œ")]),s._v("?")]),s._v(" "),t("p",[s._v("å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæ˜¯æ–¹æ³•å†…éƒ¨, ä¹Ÿå°±æ˜¯è¯´å½“æ–¹æ³•æ‰§è¡Œå®Œ, å±€éƒ¨å˜é‡å°±æ²¡ç”¨äº†, å±€éƒ¨å˜é‡åº”è¯¥å’Œæ–¹æ³•åŒç”Ÿå…±æ­». æ­¤æ—¶ä½ åº”è¯¥ä¼šæƒ³åˆ°è°ƒç”¨æ ˆçš„æ ˆå¸§, è°ƒç”¨æ ˆçš„æ ˆå¸§å°±æ˜¯å’Œæ–¹æ³•åŒç”Ÿå…±æ­»çš„, æ‰€ä»¥å±€éƒ¨å˜é‡æ”¾åˆ°è°ƒç”¨æ ˆé‡Œé‚£å„¿æ˜¯ç›¸å½“çš„åˆç†. äº‹å®ä¸Š, çš„ç¡®æ˜¯è¿™æ ·çš„, "),t("mark",[t("strong",[s._v("å±€éƒ¨å˜é‡å°±æ˜¯æ”¾åˆ°äº†è°ƒç”¨æ ˆé‡Œ")])]),s._v(". äºæ˜¯è°ƒç”¨æ ˆçš„ç»“æ„å°±å˜æˆäº†ä¸‹å›¾è¿™æ ·.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/82523771c0a0eb804f7d4de7181a5756-20230731162452-3yuxdly.png",alt:"",title:"ä¿æŠ¤å±€éƒ¨å˜é‡çš„è°ƒç”¨æ ˆç»“æ„"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªç»“è®ºç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“, å› ä¸ºå­¦ Java è¯­è¨€çš„æ—¶å€™, åŸºæœ¬æ‰€æœ‰çš„æ•™æéƒ½ä¼šå‘Šè¯‰ä½  new å‡ºæ¥çš„å¯¹è±¡æ˜¯åœ¨å †é‡Œ, å±€éƒ¨å˜é‡æ˜¯åœ¨æ ˆé‡Œ, åªä¸è¿‡å¾ˆå¤šäººå¹¶ä¸æ¸…æ¥šå †å’Œæ ˆçš„åŒºåˆ«, ä»¥åŠä¸ºä»€ä¹ˆè¦åŒºåˆ†å †å’Œæ ˆ. ç°åœ¨ä½ åº”è¯¥å¾ˆæ¸…æ¥šäº†, "),t("strong",[s._v("å±€éƒ¨å˜é‡æ˜¯å’Œæ–¹æ³•åŒç”Ÿå…±æ­»çš„, ä¸€ä¸ªå˜é‡å¦‚æœæƒ³è·¨è¶Šæ–¹æ³•çš„è¾¹ç•Œ, å°±å¿…é¡»åˆ›å»ºåœ¨å †é‡Œ")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"è°ƒç”¨æ ˆä¸çº¿ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è°ƒç”¨æ ˆä¸çº¿ç¨‹"}},[s._v("#")]),s._v(" è°ƒç”¨æ ˆä¸çº¿ç¨‹")]),s._v(" "),t("p",[s._v("ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ç”¨ä¸åŒçš„å‚æ•°è°ƒç”¨ç›¸åŒçš„æ–¹æ³•, é‚£è°ƒç”¨æ ˆå’Œçº¿ç¨‹ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»å‘¢? ç­”æ¡ˆæ˜¯: "),t("mark",[t("strong",[s._v("æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è°ƒç”¨æ ˆ")])]),s._v(". å› ä¸ºå¦‚æœä¸æ˜¯è¿™æ ·, é‚£ä¸¤ä¸ªçº¿ç¨‹å°±äº’ç›¸å¹²æ‰°äº†. å¦‚ä¸‹é¢è¿™å¹…å›¾æ‰€ç¤º, çº¿ç¨‹ A, B, C æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è°ƒç”¨æ ˆ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/967e2ce66cb241d3610b3e150dc79bf7-20230731162452-kblwtlc.png",alt:"",title:"çº¿ç¨‹ä¸è°ƒç”¨æ ˆçš„å…³ç³»å›¾"}})]),s._v(" "),t("p",[s._v("ç°åœ¨å›è¿‡å¤´æ¥å†çœ‹ä¹‹å‰çš„é—®é¢˜: "),t("strong",[s._v("Java æ–¹æ³•é‡Œé¢çš„å±€éƒ¨å˜é‡æ˜¯å¦å­˜åœ¨å¹¶å‘é—®é¢˜? å…¶å®å°±æ˜¯ä¸€ç‚¹é—®é¢˜éƒ½æ²¡æœ‰. å› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„è°ƒç”¨æ ˆ, å±€éƒ¨å˜é‡ä¿å­˜åœ¨çº¿ç¨‹å„è‡ªçš„è°ƒç”¨æ ˆé‡Œé¢, ä¸ä¼šå…±äº«, æ‰€ä»¥è‡ªç„¶ä¹Ÿå°±æ²¡æœ‰å¹¶å‘é—®é¢˜. å†æ¬¡é‡ç”³ä¸€é: æ²¡æœ‰å…±äº«, å°±æ²¡æœ‰ä¼¤å®³")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"çº¿ç¨‹å°é—­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#çº¿ç¨‹å°é—­"}},[s._v("#")]),s._v(" çº¿ç¨‹å°é—­")]),s._v(" "),t("p",[s._v("æ–¹æ³•é‡Œçš„å±€éƒ¨å˜é‡, å› ä¸ºä¸ä¼šå’Œå…¶ä»–çº¿ç¨‹å…±äº«, æ‰€ä»¥æ²¡æœ‰å¹¶å‘é—®é¢˜, è¿™ä¸ªæ€è·¯å¾ˆå¥½, å·²ç»æˆä¸ºè§£å†³å¹¶å‘é—®é¢˜çš„ä¸€ä¸ªé‡è¦æŠ€æœ¯, åŒæ—¶è¿˜æœ‰ä¸ªå“å½“å½“çš„åå­—å«åš"),t("mark",[t("strong",[s._v("çº¿ç¨‹å°é—­")])]),s._v(", æ¯”è¾ƒå®˜æ–¹çš„è§£é‡Šæ˜¯: "),t("strong",[s._v("ä»…åœ¨å•çº¿ç¨‹å†…è®¿é—®æ•°æ®")]),s._v(". ç”±äºä¸å­˜åœ¨å…±äº«, æ‰€ä»¥å³ä¾¿ä¸åŒæ­¥ä¹Ÿä¸ä¼šæœ‰å¹¶å‘é—®é¢˜, æ€§èƒ½æ æ çš„.")]),s._v(" "),t("p",[s._v("é‡‡ç”¨çº¿ç¨‹å°é—­æŠ€æœ¯çš„æ¡ˆä¾‹éå¸¸å¤š, ä¾‹å¦‚ä»æ•°æ®åº“è¿æ¥æ± é‡Œè·å–çš„è¿æ¥ Connection, åœ¨ JDBC è§„èŒƒé‡Œå¹¶æ²¡æœ‰è¦æ±‚è¿™ä¸ª Connection å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„. "),t("strong",[s._v("æ•°æ®åº“è¿æ¥æ± é€šè¿‡çº¿ç¨‹å°é—­æŠ€æœ¯, ä¿è¯ä¸€ä¸ª Connection ä¸€æ—¦è¢«ä¸€ä¸ªçº¿ç¨‹è·å–ä¹‹å, åœ¨è¿™ä¸ªçº¿ç¨‹å…³é—­ Connection ä¹‹å‰çš„è¿™æ®µæ—¶é—´é‡Œ, ä¸ä¼šå†åˆ†é…ç»™å…¶ä»–çº¿ç¨‹, ä»è€Œä¿è¯äº† Connection ä¸ä¼šæœ‰å¹¶å‘é—®é¢˜")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_12-å¦‚ä½•ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¥½å¹¶å‘ç¨‹åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-å¦‚ä½•ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¥½å¹¶å‘ç¨‹åº"}},[s._v("#")]),s._v(" 12-å¦‚ä½•ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¥½å¹¶å‘ç¨‹åº?")]),s._v(" "),t("p",[s._v("é¢å‘å¯¹è±¡æ€æƒ³ä¸å¹¶å‘ç¼–ç¨‹æœ‰å…³ç³»å—? æœ¬æ¥æ˜¯æ²¡å…³ç³»çš„, å®ƒä»¬åˆ†å±ä¸¤ä¸ªä¸åŒçš„é¢†åŸŸ, ä½†æ˜¯åœ¨ Java è¯­è¨€é‡Œ, è¿™ä¸¤ä¸ªé¢†åŸŸè¢«æ— æƒ…åœ°èåˆåœ¨ä¸€èµ·äº†, å¥½åœ¨èåˆçš„æ•ˆæœè¿˜æ˜¯ä¸é”™çš„: "),t("strong",[s._v("åœ¨ Java è¯­è¨€é‡Œ, é¢å‘å¯¹è±¡æ€æƒ³èƒ½å¤Ÿè®©å¹¶å‘ç¼–ç¨‹å˜å¾—æ›´ç®€å•")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£å¦‚ä½•æ‰èƒ½ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¥½å¹¶å‘ç¨‹åºå‘¢? ç»“åˆæˆ‘è‡ªå·±çš„å·¥ä½œç»éªŒæ¥çœ‹, æˆ‘è§‰å¾—ä½ å¯ä»¥ä»"),t("strong",[s._v("å°è£…å…±äº«å˜é‡, è¯†åˆ«å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶å’Œåˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥")]),s._v("è¿™ä¸‰ä¸ªæ–¹é¢ä¸‹æ‰‹.")]),s._v(" "),t("h5",{attrs:{id:"_1-å°è£…å…±äº«å˜é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å°è£…å…±äº«å˜é‡"}},[s._v("#")]),s._v(" 1.å°è£…å…±äº«å˜é‡")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¨‹åºçš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜, ä¸è¿‡æ˜¯è§£å†³å¤šçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«å˜é‡çš„é—®é¢˜. å‰é¢ç±»æ¯”è¿‡çƒåœºé—¨ç¥¨çš„ç®¡ç†, ç°å®ä¸–ç•Œé‡Œé—¨ç¥¨ç®¡ç†çš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯: æ‰€æœ‰è§‚ä¼—åªèƒ½é€šè¿‡è§„å®šçš„å…¥å£è¿›å…¥, å¦åˆ™æ£€ç¥¨å°±å½¢åŒè™šè®¾. åœ¨ç¼–ç¨‹ä¸–ç•Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆé‡è¦, ç¼–ç¨‹é¢†åŸŸé‡Œé¢å¯¹äºå…±äº«å˜é‡çš„è®¿é—®è·¯å¾„å°±ç±»ä¼¼äºçƒåœºçš„å…¥å£, å¿…é¡»ä¸¥æ ¼æ§åˆ¶. å¥½åœ¨æœ‰äº†é¢å‘å¯¹è±¡æ€æƒ³, å¯¹å…±äº«å˜é‡çš„è®¿é—®è·¯å¾„å¯ä»¥è½»æ¾æŠŠæ§.")]),s._v(" "),t("p",[s._v("é¢å‘å¯¹è±¡æ€æƒ³é‡Œé¢æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§æ˜¯"),t("strong",[s._v("å°è£…")]),s._v(", å°è£…çš„é€šä¿—è§£é‡Šå°±æ˜¯"),t("strong",[s._v("å°†å±æ€§å’Œå®ç°ç»†èŠ‚å°è£…åœ¨å¯¹è±¡å†…éƒ¨")]),s._v(", å¤–ç•Œå¯¹è±¡"),t("strong",[s._v("åªèƒ½é€šè¿‡")]),s._v("ç›®æ ‡å¯¹è±¡æä¾›çš„"),t("strong",[s._v("å…¬å…±æ–¹æ³•æ¥é—´æ¥è®¿é—®")]),s._v("è¿™äº›å†…éƒ¨å±æ€§, è¿™å’Œé—¨ç¥¨ç®¡ç†æ¨¡å‹åŒ¹é…åº¦ç›¸å½“çš„é«˜, çƒåœºé‡Œçš„åº§ä½å°±æ˜¯å¯¹è±¡å±æ€§, çƒåœºå…¥å£å°±æ˜¯å¯¹è±¡çš„å…¬å…±æ–¹æ³•. "),t("strong",[s._v("æŠŠå…±äº«å˜é‡ä½œä¸ºå¯¹è±¡çš„å±æ€§, é‚£å¯¹äºå…±äº«å˜é‡çš„è®¿é—®è·¯å¾„å°±æ˜¯å¯¹è±¡çš„å…¬å…±æ–¹æ³•, æ‰€æœ‰å…¥å£éƒ½è¦å®‰æ’æ£€ç¥¨ç¨‹åºå°±ç›¸å½“äºå‰é¢æåˆ°çš„å¹¶å‘è®¿é—®ç­–ç•¥")]),s._v(".")]),s._v(" "),t("p",[s._v("åˆ©ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¹¶å‘ç¨‹åºçš„æ€è·¯, å…¶å®å°±è¿™ä¹ˆç®€å•: "),t("strong",[s._v("å°†å…±äº«å˜é‡ä½œä¸ºå¯¹è±¡å±æ€§å°è£…åœ¨å†…éƒ¨, å¯¹æ‰€æœ‰å…¬å…±æ–¹æ³•åˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥")]),s._v(". å°±æ‹¿å¾ˆå¤šç»Ÿè®¡ç¨‹åºéƒ½è¦ç”¨åˆ°è®¡æ•°å™¨æ¥è¯´, ä¸‹é¢çš„è®¡æ•°å™¨ç¨‹åºå…±äº«å˜é‡åªæœ‰ä¸€ä¸ª, å°±æ˜¯ value, æŠŠå®ƒä½œä¸º Counter ç±»çš„å±æ€§, å¹¶ä¸”å°†ä¸¤ä¸ªå…¬å…±æ–¹æ³• get() å’Œ addOne() å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•, è¿™æ · Counter ç±»å°±æˆä¸ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Counter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("å½“ç„¶, å®é™…å·¥ä½œä¸­, å¾ˆå¤šçš„åœºæ™¯éƒ½ä¸ä¼šåƒè®¡æ•°å™¨è¿™ä¹ˆç®€å•, ç»å¸¸è¦é¢ä¸´çš„æƒ…å†µå¾€å¾€æ˜¯æœ‰å¾ˆå¤šçš„å…±äº«å˜é‡, ä¾‹å¦‚, ä¿¡ç”¨å¡è´¦æˆ·æœ‰å¡å·, å§“å, èº«ä»½è¯, ä¿¡ç”¨é¢åº¦, å·²å‡ºè´¦å•, æœªå‡ºè´¦å•ç­‰å¾ˆå¤šå…±äº«å˜é‡. è¿™ä¹ˆå¤šçš„å…±äº«å˜é‡, å¦‚æœæ¯ä¸€ä¸ªéƒ½è€ƒè™‘å®ƒçš„å¹¶å‘å®‰å…¨é—®é¢˜, é‚£å°±ç´¯æ­»äº†. ä½†å…¶å®ä»”ç»†è§‚å¯Ÿ, ä½ ä¼šå‘ç°, å¾ˆå¤šå…±äº«å˜é‡çš„å€¼æ˜¯ä¸ä¼šå˜çš„, ä¾‹å¦‚ä¿¡ç”¨å¡è´¦æˆ·çš„å¡å·, å§“å, èº«ä»½è¯. "),t("strong",[s._v("å¯¹äºè¿™äº›ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„å…±äº«å˜é‡, å»ºè®®ç”¨ final å…³é”®å­—æ¥ä¿®é¥°")]),s._v(". è¿™æ ·æ—¢èƒ½é¿å…å¹¶å‘é—®é¢˜, ä¹Ÿèƒ½å¾ˆæ˜äº†åœ°è¡¨æ˜ä½ çš„è®¾è®¡æ„å›¾, è®©åé¢æ¥æ‰‹ä½ ç¨‹åºçš„å…„å¼ŸçŸ¥é“, ä½ å·²ç»è€ƒè™‘è¿‡è¿™äº›å…±äº«å˜é‡çš„å¹¶å‘å®‰å…¨é—®é¢˜äº†.")]),s._v(" "),t("h5",{attrs:{id:"_2-è¯†åˆ«å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-è¯†åˆ«å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶"}},[s._v("#")]),s._v(" 2.è¯†åˆ«å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶")]),s._v(" "),t("p",[s._v("è¯†åˆ«å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶éå¸¸é‡è¦. å› ä¸º"),t("strong",[s._v("è¿™äº›çº¦æŸæ¡ä»¶, å†³å®šäº†å¹¶å‘è®¿é—®ç­–ç•¥")]),s._v(". ä¾‹å¦‚, åº“å­˜ç®¡ç†é‡Œé¢æœ‰ä¸ªåˆç†åº“å­˜çš„æ¦‚å¿µ, åº“å­˜é‡ä¸èƒ½å¤ªé«˜, ä¹Ÿä¸èƒ½å¤ªä½, å®ƒæœ‰ä¸€ä¸ªä¸Šé™å’Œä¸€ä¸ªä¸‹é™. å…³äºè¿™äº›çº¦æŸæ¡ä»¶, å¯ä»¥ç”¨ä¸‹é¢çš„ç¨‹åºæ¥æ¨¡æ‹Ÿä¸€ä¸‹. åœ¨ç±» SafeWM ä¸­, å£°æ˜äº†ä¸¤ä¸ªæˆå‘˜å˜é‡ upper å’Œ lower, åˆ†åˆ«ä»£è¡¨åº“å­˜ä¸Šé™å’Œåº“å­˜ä¸‹é™, è¿™ä¸¤ä¸ªå˜é‡ç”¨äº† AtomicLong è¿™ä¸ªåŸå­ç±», åŸå­ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„, æ‰€ä»¥è¿™ä¸¤ä¸ªæˆå‘˜å˜é‡çš„ set æ–¹æ³•å°±ä¸éœ€è¦åŒæ­¥äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeWM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åº“å­˜ä¸Šé™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" upper "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åº“å­˜ä¸‹é™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" lower "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®åº“å­˜ä¸Šé™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setUpper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®åº“å­˜ä¸‹é™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setLower")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lower"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("è™½è¯´ä¸Šé¢çš„ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„, ä½†æ˜¯å¿½è§†äº†ä¸€ä¸ªçº¦æŸæ¡ä»¶, å°±æ˜¯"),t("strong",[s._v("åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™")]),s._v(", è¿™ä¸ªçº¦æŸæ¡ä»¶èƒ½å¤Ÿç›´æ¥åŠ åˆ°ä¸Šé¢çš„ set æ–¹æ³•ä¸Šå—? å…ˆç›´æ¥åŠ ä¸€ä¸‹çœ‹çœ‹æ•ˆæœ(å¦‚ä¸‹é¢ä»£ç æ‰€ç¤º). åœ¨ setUpper() å’Œ setLower() ä¸­å¢åŠ äº†"),t("strong",[s._v("å‚æ•°æ ¡éªŒ")]),s._v(", è¿™ä¹çœ‹ä¸Šå»å¥½åƒæ˜¯å¯¹çš„, ä½†å…¶å®å­˜åœ¨å¹¶å‘é—®é¢˜, "),t("strong",[s._v("é—®é¢˜åœ¨äºå­˜åœ¨ç«æ€æ¡ä»¶")]),s._v(". è¿™é‡Œé¡ºä¾¿æ’ä¸€å¥, å…¶å®å½“çœ‹åˆ°ä»£ç é‡Œå‡ºç° if è¯­å¥çš„æ—¶å€™, å°±åº”è¯¥ç«‹åˆ»æ„è¯†åˆ°å¯èƒ½å­˜åœ¨ç«æ€æ¡ä»¶.")]),s._v(" "),t("p",[s._v("å‡è®¾åº“å­˜çš„ä¸‹é™å’Œä¸Šé™åˆ†åˆ«æ˜¯ (2,10), çº¿ç¨‹ A è°ƒç”¨ setUpper(5) å°†ä¸Šé™è®¾ç½®ä¸º 5, çº¿ç¨‹ B è°ƒç”¨ setLower(7) å°†ä¸‹é™è®¾ç½®ä¸º 7, å¦‚æœçº¿ç¨‹ A å’Œçº¿ç¨‹ B å®Œå…¨åŒæ—¶æ‰§è¡Œ, ä½ ä¼šå‘ç°çº¿ç¨‹ A èƒ½å¤Ÿé€šè¿‡å‚æ•°æ ¡éªŒ, å› ä¸ºè¿™ä¸ªæ—¶å€™, ä¸‹é™è¿˜æ²¡æœ‰è¢«çº¿ç¨‹ B è®¾ç½®, è¿˜æ˜¯ 2, è€Œ 5 > 2; çº¿ç¨‹ B ä¹Ÿèƒ½å¤Ÿé€šè¿‡å‚æ•°æ ¡éªŒ, å› ä¸ºè¿™ä¸ªæ—¶å€™, ä¸Šé™è¿˜æ²¡æœ‰è¢«çº¿ç¨‹ A è®¾ç½®, è¿˜æ˜¯ 10, è€Œ 7 < 10. å½“çº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½é€šè¿‡å‚æ•°æ ¡éªŒå, å°±æŠŠåº“å­˜çš„ä¸‹é™å’Œä¸Šé™è®¾ç½®æˆ (7, 5) äº†, æ˜¾ç„¶æ­¤æ—¶çš„ç»“æœæ˜¯ä¸ç¬¦åˆ"),t("strong",[s._v("åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™")]),s._v("è¿™ä¸ªçº¦æŸæ¡ä»¶çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeWM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åº“å­˜ä¸Šé™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" upper "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åº“å­˜ä¸‹é™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" lower "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®åº“å­˜ä¸Šé™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setUpper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ£€æŸ¥å‚æ•°åˆæ³•æ€§")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" lower"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®åº“å­˜ä¸‹é™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setLower")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ£€æŸ¥å‚æ•°åˆæ³•æ€§")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        lower"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("åœ¨æ²¡æœ‰è¯†åˆ«å‡º"),t("strong",[s._v("åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™")]),s._v("è¿™ä¸ªçº¦æŸæ¡ä»¶ä¹‹å‰, åˆ¶å®šçš„å¹¶å‘è®¿é—®ç­–ç•¥æ˜¯åˆ©ç”¨åŸå­ç±», ä½†æ˜¯è¿™ä¸ªç­–ç•¥, å®Œå…¨ä¸èƒ½ä¿è¯"),t("strong",[s._v("åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™")]),s._v("è¿™ä¸ªçº¦æŸæ¡ä»¶. æ‰€ä»¥åœ¨è®¾è®¡é˜¶æ®µ, "),t("strong",[s._v("ä¸€å®šè¦è¯†åˆ«å‡ºæ‰€æœ‰å…±äº«å˜é‡ä¹‹é—´çš„çº¦æŸæ¡ä»¶, å¦‚æœçº¦æŸæ¡ä»¶è¯†åˆ«ä¸è¶³, å¾ˆå¯èƒ½å¯¼è‡´åˆ¶å®šçš„å¹¶å‘è®¿é—®ç­–ç•¥å—è¾•åŒ—è¾™")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å…±äº«å˜é‡ä¹‹é—´çš„çº¦æŸæ¡ä»¶, åæ˜ åœ¨ä»£ç é‡Œ, åŸºæœ¬ä¸Šéƒ½ä¼šæœ‰ if è¯­å¥, æ‰€ä»¥ä¸€å®šè¦ç‰¹åˆ«æ³¨æ„ç«æ€æ¡ä»¶")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"_3-åˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-åˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥"}},[s._v("#")]),s._v(" 3.åˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥")]),s._v(" "),t("p",[s._v('åˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥, æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„äº‹æƒ…. åº”è¯¥è¯´æ•´ä¸ªä¸“æ éƒ½æ˜¯åœ¨å°è¯•æå®šå®ƒ. ä¸è¿‡ä»æ–¹æ¡ˆä¸Šæ¥çœ‹, æ— å¤–ä¹å°±æ˜¯ä»¥ä¸‹ "ä¸‰ä»¶äº‹".')]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("é¿å…å…±äº«")]),s._v(": é¿å…å…±äº«çš„æŠ€æœ¯ä¸»è¦æ˜¯åˆ©ç”¨"),t("strong",[s._v("çº¿ç¨‹æœ¬åœ°å­˜å‚¨ä»¥åŠä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ç‹¬ç«‹çš„çº¿ç¨‹")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("ä¸å˜æ¨¡å¼")]),s._v(": è¿™ä¸ªåœ¨ Java é¢†åŸŸåº”ç”¨çš„å¾ˆå°‘, ä½†åœ¨å…¶ä»–é¢†åŸŸå´æœ‰ç€å¹¿æ³›çš„åº”ç”¨, ä¾‹å¦‚ Actor æ¨¡å¼, CSP æ¨¡å¼ä»¥åŠå‡½æ•°å¼ç¼–ç¨‹çš„åŸºç¡€éƒ½æ˜¯ä¸å˜æ¨¡å¼.")]),s._v(" "),t("li",[t("strong",[s._v("ç®¡ç¨‹åŠå…¶ä»–åŒæ­¥å·¥å…·")]),s._v(": Java é¢†åŸŸä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ç®¡ç¨‹, ä½†æ˜¯å¯¹äºå¾ˆå¤šç‰¹å®šåœºæ™¯, ä½¿ç”¨ Java å¹¶å‘åŒ…æä¾›çš„è¯»å†™é”, å¹¶å‘å®¹å™¨ç­‰åŒæ­¥å·¥å…·ä¼šæ›´å¥½.")])]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥ç¬¬äºŒæ¨¡å—ä¼šä»”ç»†è®²è§£ Java å¹¶å‘å·¥å…·ç±»ä»¥åŠä»–ä»¬çš„åº”ç”¨åœºæ™¯, åœ¨ç¬¬ä¸‰æ¨¡å—è¿˜ä¼šè®²è§£å¹¶å‘ç¼–ç¨‹çš„è®¾è®¡æ¨¡å¼, è¿™äº›éƒ½æ˜¯å’Œåˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥æœ‰å…³çš„.")]),s._v(" "),t("p",[s._v('é™¤äº†è¿™äº›æ–¹æ¡ˆä¹‹å¤–, è¿˜æœ‰ä¸€äº›å®è§‚çš„åŸåˆ™éœ€è¦ä½ äº†è§£. è¿™äº›å®è§‚åŸåˆ™, æœ‰åŠ©äºå†™å‡º "å¥å£®" çš„å¹¶å‘ç¨‹åº. è¿™äº›åŸåˆ™ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰æ¡.')]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä¼˜å…ˆä½¿ç”¨æˆç†Ÿçš„å·¥å…·ç±»")]),s._v(': Java SDK å¹¶å‘åŒ…é‡Œæä¾›äº†ä¸°å¯Œçš„å·¥å…·ç±», åŸºæœ¬ä¸Šèƒ½æ»¡è¶³æ—¥å¸¸çš„éœ€è¦, å»ºè®®ç†Ÿæ‚‰å®ƒä»¬, ç”¨å¥½å®ƒä»¬, è€Œä¸æ˜¯è‡ªå·±å†"å‘æ˜è½®å­", æ¯•ç«Ÿå¹¶å‘å·¥å…·ç±»ä¸æ˜¯éšéšä¾¿ä¾¿å°±èƒ½å‘æ˜æˆåŠŸçš„.')]),s._v(" "),t("li",[t("strong",[s._v("è¿«ä¸å¾—å·²æ—¶æ‰ä½¿ç”¨ä½çº§çš„åŒæ­¥åŸè¯­")]),s._v(": ä½çº§çš„åŒæ­¥åŸè¯­ä¸»è¦æŒ‡çš„æ˜¯ synchronized, Lock, Semaphore ç­‰, è¿™äº›è™½ç„¶æ„Ÿè§‰ç®€å•, ä½†å®é™…ä¸Šå¹¶æ²¡é‚£ä¹ˆç®€å•, ä¸€å®šè¦å°å¿ƒä½¿ç”¨.")]),s._v(" "),t("li",[t("strong",[s._v("é¿å…è¿‡æ—©ä¼˜åŒ–")]),s._v(": å®‰å…¨ç¬¬ä¸€, å¹¶å‘ç¨‹åºé¦–å…ˆè¦ä¿è¯å®‰å…¨, å‡ºç°æ€§èƒ½ç“¶é¢ˆåå†ä¼˜åŒ–. åœ¨è®¾è®¡æœŸå’Œå¼€å‘æœŸ, å¾ˆå¤šäººç»å¸¸ä¼šæƒ…ä¸è‡ªç¦åœ°é¢„ä¼°æ€§èƒ½çš„ç“¶é¢ˆ, å¹¶å¯¹æ­¤å®æ–½ä¼˜åŒ–, ä½†æ®‹é…·çš„ç°å®å´æ˜¯: æ€§èƒ½ç“¶é¢ˆä¸æ˜¯æƒ³é¢„ä¼°å°±èƒ½é¢„ä¼°çš„.")])]),s._v(" "),t("h4",{attrs:{id:"_13-ç†è®ºåŸºç¡€æ¨¡å—æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13-ç†è®ºåŸºç¡€æ¨¡å—æ€»ç»“"}},[s._v("#")]),s._v(" 13-ç†è®ºåŸºç¡€æ¨¡å—æ€»ç»“")]),s._v(" "),t("p",[s._v('åˆ°è¿™é‡Œ, ä¸“æ çš„ç¬¬ä¸€æ¨¡å—-å¹¶å‘ç¼–ç¨‹çš„ç†è®ºåŸºç¡€å·²ç»è®²è§£å®Œäº†, æ€»å…± 12 ç¯‡,ä½† "è·³å‡ºæ¥, çœ‹å…¨æ™¯" ä½ ä¼šå‘ç°è¿™ 12 ç¯‡çš„å†…å®¹åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ª"ä¸²è¡Œçš„æ•…äº‹". æ‰€ä»¥, åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­, å»ºè®®ä½ ä»ä¸€ä¸ªä¸ªå•ä¸€çš„çŸ¥è¯†å’ŒæŠ€æœ¯ä¸­"è·³å‡ºæ¥", çœ‹å…¨å±€, æ­å»ºè‡ªå·±çš„å¹¶å‘ç¼–ç¨‹çŸ¥è¯†ä½“ç³».')]),s._v(" "),t("p",[t("strong",[s._v('é‚£è¿™ä¸ª"ä¸²è¡Œçš„æ•…äº‹"æ˜¯æ€æ ·çš„å‘¢?')])]),s._v(" "),t("p",[s._v("èµ·æºæ˜¯ä¸€ä¸ªç¡¬ä»¶çš„æ ¸å¿ƒçŸ›ç›¾: "),t("strong",[s._v("CPU ä¸å†…å­˜, I/O çš„é€Ÿåº¦å·®å¼‚, ç³»ç»Ÿè½¯ä»¶(æ“ä½œç³»ç»Ÿ, ç¼–è¯‘å™¨)åœ¨è§£å†³è¿™ä¸ªæ ¸å¿ƒçŸ›ç›¾çš„åŒæ—¶, å¼•å…¥äº†å¯è§æ€§, åŸå­æ€§å’Œæœ‰åºæ€§é—®é¢˜, è¿™ä¸‰ä¸ªé—®é¢˜å°±æ˜¯å¾ˆå¤šå¹¶å‘ç¨‹åºçš„ Bug ä¹‹æº")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£å¦‚ä½•è§£å†³è¿™ä¸‰ä¸ªé—®é¢˜å‘¢? Java è¯­è¨€è‡ªç„¶æœ‰æ‹›å„¿, "),t("strong",[s._v("å®ƒæä¾›äº† Java å†…å­˜æ¨¡å‹å’Œäº’æ–¥é”æ–¹æ¡ˆ")]),s._v(". æ‰€ä»¥ä»‹ç»äº† Java å†…å­˜æ¨¡å‹, ä»¥åº”å¯¹å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜; é‚£å¦ä¸€ä¸ªåŸå­æ€§é—®é¢˜è¯¥å¦‚ä½•è§£å†³? å¤šæ–¹è€ƒé‡ç”¨å¥½äº’æ–¥é”æ‰æ˜¯å…³é”®.")]),s._v(" "),t("p",[s._v("è™½è¯´äº’æ–¥é”æ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„æ ¸å¿ƒå·¥å…·, ä½†å®ƒä¹Ÿå¯èƒ½ä¼šå¸¦æ¥æ­»é”é—®é¢˜, æ‰€ä»¥ä»‹ç»äº†æ­»é”çš„äº§ç”ŸåŸå› ä»¥åŠè§£å†³æ–¹æ¡ˆ; åŒæ—¶è¿˜å¼•å‡ºä¸€ä¸ªçº¿ç¨‹é—´åä½œçš„é—®é¢˜, ä»‹ç»äº†çº¿ç¨‹é—´çš„åä½œæœºåˆ¶: ç­‰å¾…-é€šçŸ¥.")]),s._v(" "),t("p",[s._v("å‰é¢çš„éƒ¨åˆ†æ›´å¤šåœ°æ˜¯ç«™åœ¨å¾®è§‚çš„è§’åº¦çœ‹å¾…å¹¶å‘é—®é¢˜. è€Œåé¢åˆ™æ˜¯æ¢ä¸€ä¸ªè§’åº¦, ç«™åœ¨å®è§‚çš„è§’åº¦é‡æ–°å®¡è§†å¹¶å‘ç¼–ç¨‹ç›¸å…³çš„æ¦‚å¿µå’Œç†è®º, åŒæ—¶ä¹Ÿæ˜¯å¯¹å‰å…­ç¯‡æ–‡ç« çš„æŸ¥æ¼è¡¥ç¼º.")]),s._v(" "),t("p",[t("strong",[s._v("ç®¡ç¨‹")]),s._v("æ˜¯ Java å¹¶å‘ç¼–ç¨‹æŠ€æœ¯çš„åŸºç¡€, æ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™. å¹¶å‘ç¼–ç¨‹é‡Œä¸¤å¤§æ ¸å¿ƒé—®é¢˜-äº’æ–¥å’ŒåŒæ­¥, éƒ½æ˜¯å¯ä»¥ç”±ç®¡ç¨‹æ¥è§£å†³çš„. æ‰€ä»¥å­¦å¥½ç®¡ç¨‹, å°±ç›¸å½“äºæŒæ¡äº†ä¸€æŠŠå¹¶å‘ç¼–ç¨‹çš„ä¸‡èƒ½é’¥åŒ™. è‡³æ­¤, å¹¶å‘ç¼–ç¨‹ç›¸å…³çš„é—®é¢˜, ç†è®ºä¸Šä½ éƒ½åº”è¯¥èƒ½æ‰¾åˆ°é—®é¢˜æ‰€åœ¨, å¹¶èƒ½ç»™å‡ºç†è®ºä¸Šçš„è§£å†³æ–¹æ¡ˆäº†. è€Œååˆä»‹ç»äº†"),t("strong",[s._v("çº¿ç¨‹ç›¸å…³çš„çŸ¥è¯†")]),s._v(", æ¯•ç«Ÿ Java å¹¶å‘ç¼–ç¨‹æ˜¯è¦é å¤šçº¿ç¨‹æ¥å®ç°çš„, æ‰€ä»¥æœ‰é’ˆå¯¹æ€§åœ°å­¦ä¹ è¿™éƒ¨åˆ†çŸ¥è¯†ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„, åŒ…æ‹¬çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ, å¦‚ä½•è®¡ç®—åˆé€‚çš„çº¿ç¨‹æ•°ä»¥åŠçº¿ç¨‹å†…éƒ¨æ˜¯å¦‚ä½•æ‰§è¡Œçš„.")]),s._v(" "),t("p",[s._v("æœ€åä»‹ç»äº†å¦‚ä½•ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¥½å¹¶å‘ç¨‹åº, å› ä¸ºåœ¨ Java è¯­è¨€é‡Œ, é¢å‘å¯¹è±¡æ€æƒ³èƒ½å¤Ÿè®©å¹¶å‘ç¼–ç¨‹å˜å¾—æ›´ç®€å•.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/52e8424fdd7335dd01bfedc7294c7e8b-20230731162452-7pkca5x.png",alt:""}})]),s._v(" "),t("p",[s._v('ç»è¿‡è¿™æ ·ä¸€ä¸ªç®€è¦çš„æ€»ç»“, ç›¸ä¿¡ä½ æ­¤æ—¶å¯¹äºå¹¶å‘ç¼–ç¨‹ç›¸å…³çš„æ¦‚å¿µ, ç†è®º, äº§ç”Ÿçš„èƒŒæ™¯ä»¥åŠå®ƒä»¬èƒŒåçš„å…³ç³»å·²ç»éƒ½æœ‰äº†ä¸€ä¸ªç›¸å¯¹å…¨é¢çš„è®¤è¯†. è‡³äºæ›´æ·±åˆ»çš„è®¤è¯†å’Œåº”ç”¨ä½“éªŒ, è¿˜æ˜¯éœ€è¦ä½  "é’»è¿›å», çœ‹æœ¬è´¨", åŠ æ·±å¯¹æŠ€æœ¯æœ¬èº«çš„è®¤è¯†, æ‹“å±•çŸ¥è¯†æ·±åº¦å’Œå¹¿åº¦.')]),s._v(" "),t("p",[s._v("å¦å¤–, åœ¨æ¯ç¯‡æ–‡ç« çš„æœ€å, æˆ‘éƒ½é™„ä¸Šäº†ä¸€ä¸ªæ€è€ƒé¢˜, è¿™äº›æ€è€ƒé¢˜è™½ç„¶å¤§éƒ¨åˆ†éƒ½å¾ˆç®€å•, ä½†æ˜¯éšè—çš„é—®é¢˜å´å¾ˆå®¹æ˜“è®©äººå¿½ç•¥, ä»è€Œä¸ç»æ„é—´å°±å¼•å‘äº† Bug; å†åŠ ä¸Šç•™è¨€åŒºçš„ä¸€äº›çƒ­é—¨è¯„è®º, æ‰€ä»¥æˆ‘æƒ³ç€"),t("strong",[s._v("å°†è¿™äº›éšè—çš„é—®é¢˜æˆ–è€…æ˜“æ··æ·†çš„é—®é¢˜, åšä¸€ä¸ªæ€»ç»“ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„")]),s._v(".")]),s._v(" "),t("h3",{attrs:{id:"å¹¶å‘å·¥å…·ç±»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹¶å‘å·¥å…·ç±»"}},[s._v("#")]),s._v(" å¹¶å‘å·¥å…·ç±»")]),s._v(" "),t("h4",{attrs:{id:"_14-lockå’Œcondition-ä¸Š-éšè—åœ¨å¹¶å‘åŒ…ä¸­çš„ç®¡ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14-lockå’Œcondition-ä¸Š-éšè—åœ¨å¹¶å‘åŒ…ä¸­çš„ç®¡ç¨‹"}},[s._v("#")]),s._v(" 14-Lockå’ŒCondition(ä¸Š)-éšè—åœ¨å¹¶å‘åŒ…ä¸­çš„ç®¡ç¨‹")]),s._v(" "),t("p",[s._v("Java SDK å¹¶å‘åŒ…å†…å®¹å¾ˆä¸°å¯Œ, åŒ…ç½—ä¸‡è±¡, ä½†æ˜¯æˆ‘è§‰å¾—æœ€æ ¸å¿ƒçš„è¿˜æ˜¯å…¶"),t("strong",[s._v("å¯¹ç®¡ç¨‹çš„å®ç°")]),s._v(". å› ä¸ºç†è®ºä¸Šåˆ©ç”¨ç®¡ç¨‹, å‡ ä¹å¯ä»¥å®ç°å¹¶å‘åŒ…é‡Œæ‰€æœ‰çš„å·¥å…·ç±». å‰é¢æåˆ°è¿‡åœ¨å¹¶å‘ç¼–ç¨‹é¢†åŸŸ, æœ‰ä¸¤å¤§æ ¸å¿ƒé—®é¢˜: ä¸€ä¸ªæ˜¯"),t("mark",[t("strong",[s._v("äº’æ–¥")])]),s._v(", å³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº; å¦ä¸€ä¸ªæ˜¯"),t("mark",[t("strong",[s._v("åŒæ­¥")])]),s._v(", å³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡, åä½œ. è¿™ä¸¤å¤§é—®é¢˜, ç®¡ç¨‹éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„. "),t("mark",[t("strong",[s._v("Java SDK å¹¶å‘åŒ…é€šè¿‡ Lock å’Œ Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨‹, å…¶ä¸­ Lock ç”¨äºè§£å†³äº’æ–¥é—®é¢˜, Condition ç”¨äºè§£å†³åŒæ­¥é—®é¢˜")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä»Šå¤©é‡ç‚¹ä»‹ç» Lock çš„ä½¿ç”¨, åœ¨ä»‹ç» Lock çš„ä½¿ç”¨ä¹‹å‰, æœ‰ä¸ªé—®é¢˜éœ€è¦é¦–å…ˆæ€è€ƒä¸€ä¸‹: "),t("strong",[s._v("Java è¯­è¨€æœ¬èº«æä¾›çš„ synchronized ä¹Ÿæ˜¯ç®¡ç¨‹çš„ä¸€ç§å®ç°, æ—¢ç„¶ Java ä»è¯­è¨€å±‚é¢å·²ç»å®ç°äº†ç®¡ç¨‹äº†, é‚£ä¸ºä»€ä¹ˆè¿˜è¦åœ¨ SDK é‡Œæä¾›å¦å¤–ä¸€ç§å®ç°å‘¢")]),s._v('? éš¾é“ Java æ ‡å‡†å§”å‘˜ä¼šè¿˜èƒ½åŒæ„ "é‡å¤é€ è½®å­" çš„æ–¹æ¡ˆ? å¾ˆæ˜¾ç„¶å®ƒä»¬ä¹‹é—´æ˜¯æœ‰å·¨å¤§åŒºåˆ«çš„. é‚£åŒºåˆ«åœ¨å“ªé‡Œå‘¢? å¦‚æœèƒ½æ·±å…¥ç†è§£è¿™ä¸ªé—®é¢˜, å¯¹ä½ ç”¨å¥½ Lock å¸®åŠ©å¾ˆå¤§. ä¸‹é¢å°±ä¸€èµ·æ¥å‰–æä¸€ä¸‹è¿™ä¸ªé—®é¢˜.')]),s._v(" "),t("h5",{attrs:{id:"å†é€ ç®¡ç¨‹çš„ç†ç”±"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†é€ ç®¡ç¨‹çš„ç†ç”±"}},[s._v("#")]),s._v(" å†é€ ç®¡ç¨‹çš„ç†ç”±")]),s._v(" "),t("p",[s._v('ä½ ä¹Ÿè®¸æ›¾ç»å¬åˆ°è¿‡å¾ˆå¤šè¿™æ–¹é¢çš„ä¼ è¯´, ä¾‹å¦‚åœ¨ Java çš„ 1.5 ç‰ˆæœ¬ä¸­, synchronized æ€§èƒ½ä¸å¦‚ SDK é‡Œé¢çš„ Lock, ä½† 1.6 ç‰ˆæœ¬ä¹‹å, synchronized åšäº†å¾ˆå¤šä¼˜åŒ–, å°†æ€§èƒ½è¿½äº†ä¸Šæ¥, æ‰€ä»¥ 1.6 ä¹‹åçš„ç‰ˆæœ¬åˆæœ‰äººæ¨èä½¿ç”¨ synchronized äº†. é‚£æ€§èƒ½æ˜¯å¦å¯ä»¥æˆä¸º "é‡å¤é€ è½®å­" çš„ç†ç”±å‘¢? æ˜¾ç„¶ä¸èƒ½. å› ä¸ºæ€§èƒ½é—®é¢˜ä¼˜åŒ–ä¸€ä¸‹å°±å¯ä»¥äº†, å®Œå…¨æ²¡å¿…è¦ "é‡å¤é€ è½®å­".')]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œ, å…³äºè¿™ä¸ªé—®é¢˜, ä½ æ˜¯å¦èƒ½å¤Ÿæƒ³å‡ºä¸€æ¡ç†ç”±æ¥å‘¢? å¦‚æœä½ ç»†å¿ƒçš„è¯, ä¹Ÿè®¸èƒ½æƒ³åˆ°ä¸€ç‚¹. é‚£å°±æ˜¯å‰é¢åœ¨ä»‹ç»æ­»é”çš„æ—¶å€™, æå‡ºäº†ä¸€ä¸ª"),t("strong",[s._v("ç ´åä¸å¯æŠ¢å æ¡ä»¶")]),s._v("æ–¹æ¡ˆ, ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆ synchronized æ²¡æœ‰åŠæ³•è§£å†³. åŸå› æ˜¯ synchronized ç”³è¯·èµ„æºçš„æ—¶å€™, å¦‚æœç”³è¯·ä¸åˆ°, çº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†, è€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€, å•¥éƒ½å¹²ä¸äº†, ä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æº. ä½†ä¸€èˆ¬å¸Œæœ›çš„æ˜¯:")]),s._v(" "),t("blockquote",[t("p",[s._v('å¯¹äº "ä¸å¯æŠ¢å " è¿™ä¸ªæ¡ä»¶, å ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶, å¦‚æœç”³è¯·ä¸åˆ°, å¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æº, è¿™æ ·ä¸å¯æŠ¢å è¿™ä¸ªæ¡ä»¶å°±ç ´åæ‰äº†.')])]),s._v(" "),t("p",[s._v("å¦‚æœé‡æ–°è®¾è®¡ä¸€æŠŠäº’æ–¥é”å»è§£å†³è¿™ä¸ªé—®é¢˜, é‚£è¯¥æ€ä¹ˆè®¾è®¡å‘¢? æˆ‘è§‰å¾—æœ‰ä¸‰ç§æ–¹æ¡ˆ.")]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v("èƒ½å¤Ÿå“åº”ä¸­æ–­")])]),s._v(". synchronized çš„é—®é¢˜æ˜¯, æŒæœ‰é” A å, å¦‚æœå°è¯•è·å–é” B å¤±è´¥, é‚£ä¹ˆçº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€, ä¸€æ—¦å‘ç”Ÿæ­»é”, å°±æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å”¤é†’é˜»å¡çš„çº¿ç¨‹. ä½†å¦‚æœ"),t("strong",[s._v("é˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·, ä¹Ÿå°±æ˜¯è¯´å½“ç»™é˜»å¡çš„çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·çš„æ—¶å€™, èƒ½å¤Ÿå”¤é†’å®ƒ, é‚£å®ƒå°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” A")]),s._v(". è¿™æ ·å°±ç ´åäº†ä¸å¯æŠ¢å æ¡ä»¶äº†.")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("æ”¯æŒè¶…æ—¶")])]),s._v(". å¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰è·å–åˆ°é”, ä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€, è€Œæ˜¯"),t("strong",[s._v("è¿”å›ä¸€ä¸ªé”™è¯¯")]),s._v(", é‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”. è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶.")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("éé˜»å¡åœ°è·å–é”")])]),s._v(". å¦‚æœå°è¯•è·å–é”å¤±è´¥, å¹¶ä¸è¿›å…¥é˜»å¡çŠ¶æ€, è€Œæ˜¯"),t("strong",[s._v("ç›´æ¥è¿”å›")]),s._v(", é‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”. è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶.")])]),s._v(" "),t("p",[s._v('è¿™ä¸‰ç§æ–¹æ¡ˆå¯ä»¥å…¨é¢å¼¥è¡¥ synchronized çš„é—®é¢˜. åˆ°è¿™é‡Œç›¸ä¿¡ä½ åº”è¯¥ä¹Ÿèƒ½ç†è§£äº†, è¿™ä¸‰ä¸ªæ–¹æ¡ˆå°±æ˜¯ "é‡å¤é€ è½®å­" çš„ä¸»è¦åŸå› , ä½“ç°åœ¨ API ä¸Š, '),t("strong",[s._v("å°±æ˜¯ Lock æ¥å£çš„ä¸‰ä¸ªæ–¹æ³•")]),s._v(". è¯¦æƒ…å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ”¯æŒä¸­æ–­çš„ API")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lockInterruptibly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ”¯æŒè¶…æ—¶çš„ API")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ”¯æŒéé˜»å¡è·å–é”çš„ API")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"å¦‚ä½•ä¿è¯å¯è§æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä¿è¯å¯è§æ€§"}},[s._v("#")]),s._v(" å¦‚ä½•ä¿è¯å¯è§æ€§")]),s._v(" "),t("p",[s._v("Java SDK é‡Œé¢ Lock çš„ä½¿ç”¨, æœ‰ä¸€ä¸ªç»å…¸çš„èŒƒä¾‹, å°±æ˜¯ "),t("code",[s._v("try{} finally{}")]),s._v("â€‹, éœ€è¦é‡ç‚¹å…³æ³¨çš„æ˜¯åœ¨ finally é‡Œé¢é‡Šæ”¾é”. è¿™ä¸ªèŒƒä¾‹æ— éœ€å¤šè§£é‡Š, çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç å°±æ˜ç™½äº†. ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦è§£é‡Šä¸€ä¸‹, é‚£å°±æ˜¯"),t("strong",[s._v("å¯è§æ€§æ˜¯æ€ä¹ˆä¿è¯")]),s._v("çš„. Java é‡Œå¤šçº¿ç¨‹çš„å¯è§æ€§æ˜¯é€šè¿‡ Happens-Before è§„åˆ™ä¿è¯çš„, è€Œ synchronized ä¹‹æ‰€ä»¥èƒ½å¤Ÿä¿è¯å¯è§æ€§, ä¹Ÿæ˜¯å› ä¸ºæœ‰ä¸€æ¡ synchronized ç›¸å…³çš„è§„åˆ™: synchronized çš„è§£é” Happens-Before äºåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”. "),t("strong",[s._v("é‚£ Java SDK é‡Œé¢ Lock é ä»€ä¹ˆä¿è¯å¯è§æ€§å‘¢")]),s._v("? ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­, çº¿ç¨‹ T1 å¯¹ value è¿›è¡Œäº† "),t("code",[s._v("+=1")]),s._v("â€‹ æ“ä½œ, é‚£åç»­çš„çº¿ç¨‹ T2 èƒ½å¤Ÿçœ‹åˆ° value çš„æ­£ç¡®ç»“æœå—?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("X")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" rtl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–é”")]),s._v("\n        rtl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿è¯é”èƒ½é‡Šæ”¾")]),s._v("\n            rtl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("ç­”æ¡ˆå¿…é¡»æ˜¯è‚¯å®šçš„. "),t("strong",[s._v("Java SDK é‡Œé¢é”")]),s._v("çš„å®ç°éå¸¸å¤æ‚, è¿™é‡Œå°±ä¸å±•å¼€ç»†è¯´äº†, ä½†æ˜¯åŸç†è¿˜æ˜¯éœ€è¦ç®€å•ä»‹ç»ä¸€ä¸‹: å®ƒæ˜¯"),t("mark",[t("strong",[s._v("åˆ©ç”¨äº† volatile ç›¸å…³çš„ Happens-Before è§„åˆ™")])]),s._v(". Java SDK é‡Œé¢çš„ "),t("strong",[s._v("ReentrantLock, å†…éƒ¨æŒæœ‰ä¸€ä¸ª volatile çš„æˆå‘˜å˜é‡ state, è·å–é”çš„æ—¶å€™, ä¼šè¯»å†™ state çš„å€¼; è§£é”çš„æ—¶å€™, ä¹Ÿä¼šè¯»å†™ state çš„å€¼(ç®€åŒ–åçš„ä»£ç å¦‚ä¸‹é¢æ‰€ç¤º)")]),s._v(" . ä¹Ÿå°±æ˜¯è¯´, åœ¨æ‰§è¡Œ "),t("code",[s._v("value+=1")]),s._v("â€‹ ä¹‹å‰, ç¨‹åºå…ˆè¯»å†™äº†ä¸€æ¬¡ volatile å˜é‡ state, åœ¨æ‰§è¡Œ "),t("code",[s._v("value+=1")]),s._v("â€‹ ä¹‹å, åˆè¯»å†™äº†ä¸€æ¬¡ volatile å˜é‡ state. æ ¹æ®ç›¸å…³çš„ Happens-Before è§„åˆ™:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("é¡ºåºæ€§è§„åˆ™")]),s._v(": å¯¹äºçº¿ç¨‹ T1, "),t("code",[s._v("value+=1")]),s._v("â€‹ Happens-Before é‡Šæ”¾é”çš„æ“ä½œ unlock();")]),s._v(" "),t("li",[t("strong",[s._v("volatile å˜é‡è§„åˆ™")]),s._v(": ç”±äº state = 1 ä¼šå…ˆè¯»å– state, æ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œ;")]),s._v(" "),t("li",[t("strong",[s._v("ä¼ é€’æ€§è§„åˆ™")]),s._v(": çº¿ç¨‹ T1 çš„ "),t("code",[s._v("value+=1")]),s._v("â€‹ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œ.")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SampleLock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŠ é”")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä»£ç æ— æ•°")]),s._v("\n        state "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è§£é”")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä»£ç æ— æ•°")]),s._v("\n        state "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("æ‰€ä»¥è¯´åç»­çº¿ç¨‹ T2 èƒ½å¤Ÿçœ‹åˆ° value çš„æ­£ç¡®ç»“æœ. å¦‚æœä½ è§‰å¾—ç†è§£èµ·æ¥è¿˜æœ‰ç‚¹å›°éš¾, å»ºè®®é‡æ¸©ä¸€ä¸‹å‰é¢è®²è¿‡çš„ç›¸å…³å†…å®¹.")]),s._v(" "),t("h5",{attrs:{id:"ä»€ä¹ˆæ˜¯å¯é‡å…¥é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯å¯é‡å…¥é”"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯å¯é‡å…¥é”")]),s._v(" "),t("p",[s._v("å¦‚æœä½ ç»†å¿ƒè§‚å¯Ÿ, ä¼šå‘ç°åˆ›å»ºçš„é”çš„å…·ä½“ç±»åæ˜¯ ReentrantLock, è¿™ä¸ªç¿»è¯‘è¿‡æ¥å«"),t("strong",[s._v("å¯é‡å…¥é”")]),s._v(", è¿™ä¸ªæ¦‚å¿µå‰é¢ä¸€ç›´æ²¡æœ‰ä»‹ç»è¿‡. "),t("strong",[s._v("æ‰€è°“å¯é‡å…¥é”, é¡¾åæ€ä¹‰, æŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥é‡å¤è·å–åŒä¸€æŠŠé”")]),s._v(". ä¾‹å¦‚ä¸‹é¢ä»£ç ä¸­, å½“çº¿ç¨‹ T1 æ‰§è¡Œåˆ° â‘  å¤„æ—¶, å·²ç»è·å–åˆ°äº†é” rtl , å½“åœ¨ â‘  å¤„è°ƒç”¨ get() æ–¹æ³•æ—¶, ä¼šåœ¨ â‘¡ å†æ¬¡å¯¹é” rtl æ‰§è¡ŒåŠ é”æ“ä½œ. æ­¤æ—¶, å¦‚æœé” rtl æ˜¯"),t("strong",[s._v("å¯é‡å…¥")]),s._v("çš„, é‚£ä¹ˆçº¿ç¨‹ T1 å¯ä»¥å†æ¬¡åŠ é”æˆåŠŸ; å¦‚æœé” rtl æ˜¯ä¸å¯é‡å…¥çš„, é‚£ä¹ˆçº¿ç¨‹ T1 æ­¤æ—¶"),t("strong",[s._v("ä¼šè¢«é˜»å¡")]),s._v(".")]),s._v(" "),t("p",[s._v("é™¤äº†å¯é‡å…¥é”, å¯èƒ½ä½ è¿˜å¬è¯´è¿‡å¯é‡å…¥å‡½æ•°, å¯é‡å…¥å‡½æ•°æ€ä¹ˆç†è§£å‘¢? æŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥é‡å¤è°ƒç”¨? æ˜¾ç„¶ä¸æ˜¯, æ‰€è°“"),t("strong",[s._v("å¯é‡å…¥å‡½æ•°, æŒ‡çš„æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è°ƒç”¨è¯¥å‡½æ•°")]),s._v(", æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½å¾—åˆ°æ­£ç¡®ç»“æœ; åŒæ—¶åœ¨ä¸€ä¸ªçº¿ç¨‹å†…æ”¯æŒçº¿ç¨‹åˆ‡æ¢, æ— è®ºè¢«åˆ‡æ¢å¤šå°‘æ¬¡, ç»“æœéƒ½æ˜¯æ­£ç¡®çš„. å¤šçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œ, è¿˜æ”¯æŒçº¿ç¨‹åˆ‡æ¢, è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢? çº¿ç¨‹å®‰å…¨å•Š. æ‰€ä»¥, "),t("strong",[s._v("å¯é‡å…¥å‡½æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("X")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" rtl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–é”")]),s._v("\n        rtl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿è¯é”èƒ½é‡Šæ”¾")]),s._v("\n            rtl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–é”")]),s._v("\n        rtl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿è¯é”èƒ½é‡Šæ”¾")]),s._v("\n            rtl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h5",{attrs:{id:"å…¬å¹³é”ä¸éå…¬å¹³é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¬å¹³é”ä¸éå…¬å¹³é”"}},[s._v("#")]),s._v(" å…¬å¹³é”ä¸éå…¬å¹³é”")]),s._v(" "),t("p",[s._v("åœ¨ä½¿ç”¨ ReentrantLock çš„æ—¶å€™, ä½ ä¼šå‘ç° ReentrantLock è¿™ä¸ªç±»"),t("strong",[s._v("æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°")]),s._v(", ä¸€ä¸ªæ˜¯æ— å‚æ„é€ å‡½æ•°, ä¸€ä¸ªæ˜¯ä¼ å…¥ fair å‚æ•°çš„æ„é€ å‡½æ•°. "),t("strong",[s._v("fair å‚æ•°ä»£è¡¨çš„æ˜¯é”çš„å…¬å¹³ç­–ç•¥, å¦‚æœä¼ å…¥ true å°±è¡¨ç¤ºéœ€è¦æ„é€ ä¸€ä¸ªå…¬å¹³é”, åä¹‹åˆ™è¡¨ç¤ºè¦æ„é€ ä¸€ä¸ªéå…¬å¹³é”")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ— å‚æ„é€ å‡½æ•°: é»˜è®¤éå…¬å¹³é”")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sync "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NonfairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¹æ®å…¬å¹³ç­–ç•¥å‚æ•°åˆ›å»ºé”")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" fair"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sync "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fair "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NonfairSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("åœ¨å‰é¢ä»‹ç»è¿‡å…¥å£ç­‰å¾…é˜Ÿåˆ—, é”éƒ½å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—, å¦‚æœä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰è·å¾—é”, å°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—, å½“æœ‰çº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™, å°±éœ€è¦ä»ç­‰å¾…é˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹. "),t("strong",[s._v("å¦‚æœæ˜¯å…¬å¹³é”, å”¤é†’çš„ç­–ç•¥å°±æ˜¯è°ç­‰å¾…çš„æ—¶é—´é•¿, å°±å”¤é†’è°, å¾ˆå…¬å¹³; å¦‚æœæ˜¯éå…¬å¹³é”, åˆ™ä¸æä¾›è¿™ä¸ªå…¬å¹³ä¿è¯, æœ‰å¯èƒ½ç­‰å¾…æ—¶é—´çŸ­çš„çº¿ç¨‹åè€Œå…ˆè¢«å”¤é†’")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ç”¨é”çš„æœ€ä½³å®è·µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨é”çš„æœ€ä½³å®è·µ"}},[s._v("#")]),s._v(" ç”¨é”çš„æœ€ä½³å®è·µ")]),s._v(" "),t("p",[s._v("ä½ å·²ç»çŸ¥é“, ç”¨é”è™½ç„¶èƒ½è§£å†³å¾ˆå¤šå¹¶å‘é—®é¢˜, ä½†æ˜¯é£é™©ä¹Ÿæ˜¯æŒºé«˜çš„. å¯èƒ½ä¼šå¯¼è‡´æ­»é”, ä¹Ÿå¯èƒ½å½±å“æ€§èƒ½. è¿™æ–¹é¢æœ‰æ˜¯å¦æœ‰ç›¸å…³çš„æœ€ä½³å®è·µå‘¢? æœ‰, è¿˜å¾ˆå¤š. ä½†æˆ‘è§‰å¾—æœ€å€¼å¾—æ¨èçš„æ˜¯å¹¶å‘å¤§å¸ˆ Doug Leaã€ŠJava å¹¶å‘ç¼–ç¨‹: è®¾è®¡åŸåˆ™ä¸æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­, æ¨èçš„ä¸‰ä¸ªç”¨é”çš„æœ€ä½³å®è·µ, å®ƒä»¬åˆ†åˆ«æ˜¯:")]),s._v(" "),t("blockquote",[t("ol",[t("li",[s._v("æ°¸è¿œåªåœ¨æ›´æ–°å¯¹è±¡çš„æˆå‘˜å˜é‡æ—¶åŠ é”")]),s._v(" "),t("li",[s._v("æ°¸è¿œåªåœ¨è®¿é—®å¯å˜çš„æˆå‘˜å˜é‡æ—¶åŠ é”")]),s._v(" "),t("li",[s._v("æ°¸è¿œä¸åœ¨è°ƒç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•æ—¶åŠ é”")])])]),s._v(" "),t("p",[s._v("è¿™ä¸‰æ¡è§„åˆ™, å‰ä¸¤æ¡ä¼°è®¡ä½ ä¸€å®šä¼šè®¤åŒ, æœ€åä¸€æ¡ä½ å¯èƒ½ä¼šè§‰å¾—è¿‡äºä¸¥è‹›. ä½†æ˜¯è¿˜æ˜¯å€¾å‘äºå»éµå®ˆ, "),t("strong",[s._v('å› ä¸ºè°ƒç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•, å®åœ¨æ˜¯å¤ªä¸å®‰å…¨äº†, ä¹Ÿè®¸"å…¶ä»–"æ–¹æ³•é‡Œé¢æœ‰çº¿ç¨‹ sleep() çš„è°ƒç”¨, ä¹Ÿå¯èƒ½ä¼šæœ‰å¥‡æ…¢æ— æ¯”çš„ I/O æ“ä½œ, è¿™äº›éƒ½ä¼šä¸¥é‡å½±å“æ€§èƒ½')]),s._v('. æ›´å¯æ€•çš„æ˜¯, "å…¶ä»–" ç±»çš„æ–¹æ³•å¯èƒ½ä¹Ÿä¼šåŠ é”, ç„¶ååŒé‡åŠ é”å°±å¯èƒ½å¯¼è‡´æ­»é”.')]),s._v(" "),t("p",[s._v("å¹¶å‘é—®é¢˜, æœ¬æ¥å°±éš¾ä»¥è¯Šæ–­, æ‰€ä»¥ä¸€å®šè¦è®©ä»£ç å°½é‡å®‰å…¨, å°½é‡ç®€å•, å“ªæ€•æœ‰ä¸€ç‚¹å¯èƒ½ä¼šå‡ºé—®é¢˜, éƒ½è¦åŠªåŠ›é¿å….")]),s._v(" "),t("h4",{attrs:{id:"_15-lockå’Œcondition-ä¸‹-dubboå¦‚ä½•ç”¨ç®¡ç¨‹å®ç°å¼‚æ­¥è½¬åŒæ­¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15-lockå’Œcondition-ä¸‹-dubboå¦‚ä½•ç”¨ç®¡ç¨‹å®ç°å¼‚æ­¥è½¬åŒæ­¥"}},[s._v("#")]),s._v(" 15-Lockå’ŒCondition(ä¸‹):Dubboå¦‚ä½•ç”¨ç®¡ç¨‹å®ç°å¼‚æ­¥è½¬åŒæ­¥?")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šä¸€èŠ‚è®²åˆ° Java SDK å¹¶å‘åŒ…é‡Œçš„ Lock æœ‰åˆ«äº synchronized éšå¼é”çš„ä¸‰ä¸ªç‰¹æ€§: "),t("mark",[t("strong",[s._v("èƒ½å¤Ÿå“åº”ä¸­æ–­, æ”¯æŒè¶…æ—¶å’Œéé˜»å¡åœ°è·å–é”")])]),s._v(". é‚£ä»Šå¤©æ¥ç€å†æ¥èŠèŠ Java SDK å¹¶å‘åŒ…é‡Œçš„ Condition, "),t("mark",[t("strong",[s._v("Condition å®ç°äº†ç®¡ç¨‹æ¨¡å‹é‡Œé¢çš„æ¡ä»¶å˜é‡")])]),s._v(".")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°è¿‡ "),t("strong",[s._v("Java è¯­è¨€å†…ç½®çš„ç®¡ç¨‹é‡Œåªæœ‰ä¸€ä¸ªæ¡ä»¶å˜é‡, è€Œ Lock&Condition å®ç°çš„ç®¡ç¨‹æ˜¯æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡çš„, è¿™æ˜¯äºŒè€…çš„ä¸€ä¸ªé‡è¦åŒºåˆ«")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨å¾ˆå¤šå¹¶å‘åœºæ™¯ä¸‹, æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡èƒ½å¤Ÿè®©å¹¶å‘ç¨‹åºå¯è¯»æ€§æ›´å¥½, å®ç°èµ·æ¥ä¹Ÿæ›´å®¹æ˜“. ä¾‹å¦‚, å®ç°ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—, å°±éœ€è¦ä¸¤ä¸ªæ¡ä»¶å˜é‡.")]),s._v(" "),t("p",[s._v("**é‚£å¦‚ä½•åˆ©ç”¨ä¸¤ä¸ªæ¡ä»¶å˜é‡å¿«é€Ÿå®ç°é˜»å¡é˜Ÿåˆ—å‘¢? **")]),s._v(" "),t("p",[s._v("ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—, éœ€è¦ä¸¤ä¸ªæ¡ä»¶å˜é‡, ä¸€ä¸ªæ˜¯"),t("strong",[s._v("é˜Ÿåˆ—ä¸ç©º")]),s._v("(ç©ºé˜Ÿåˆ—ä¸å…è®¸å‡ºé˜Ÿ), å¦ä¸€ä¸ªæ˜¯"),t("strong",[s._v("é˜Ÿåˆ—ä¸æ»¡")]),s._v("(é˜Ÿåˆ—å·²æ»¡ä¸å…è®¸å…¥é˜Ÿ), è¿™ä¸ªä¾‹å­å‰é¢è¯¦ç»†è¯´è¿‡, è¿™é‡Œå°±ä¸å†èµ˜è¿°. ç›¸å…³çš„ä»£ç , è¿™é‡Œé‡æ–°åˆ—äº†å‡ºæ¥, å¯ä»¥æ¸©æ•…çŸ¥æ–°ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockedQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¡ä»¶å˜é‡: é˜Ÿåˆ—ä¸æ»¡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Condition")]),s._v(" notFull "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCondition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¡ä»¶å˜é‡: é˜Ÿåˆ—ä¸ç©º  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Condition")]),s._v(" notEmpty "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCondition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…¥é˜Ÿ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("enq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("é˜Ÿåˆ—å·²æ»¡"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…é˜Ÿåˆ—ä¸æ»¡")]),s._v("\n                notFull"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å…¥é˜Ÿæ“ä½œ...")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…¥é˜Ÿå, é€šçŸ¥å¯å‡ºé˜Ÿ")]),s._v("\n            notEmpty"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‡ºé˜Ÿ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("deq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("é˜Ÿåˆ—å·²ç©º"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…é˜Ÿåˆ—ä¸ç©º")]),s._v("\n                notEmpty"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å‡ºé˜Ÿæ“ä½œ...")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‡ºé˜Ÿå, é€šçŸ¥å¯å…¥é˜Ÿ")]),s._v("\n            notFull"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("p",[s._v("ä¸è¿‡, è¿™é‡Œéœ€è¦æ³¨æ„, Lock å’Œ Condition å®ç°çš„ç®¡ç¨‹, "),t("strong",[s._v("çº¿ç¨‹ç­‰å¾…å’Œé€šçŸ¥éœ€è¦è°ƒç”¨ await(), signal(), signalAll()")]),s._v(" , å®ƒä»¬çš„è¯­ä¹‰å’Œ wait(), notify(), notifyAll() æ˜¯ç›¸åŒçš„. ä½†æ˜¯ä¸ä¸€æ ·çš„æ˜¯, "),t("strong",[s._v("Lock&Condition å®ç°çš„ç®¡ç¨‹é‡Œåªèƒ½ä½¿ç”¨å‰é¢çš„ await(), signal(), signalAll()")]),s._v(" , è€Œåé¢çš„ wait(), notify(), notifyAll() åªæœ‰åœ¨ synchronized å®ç°çš„ç®¡ç¨‹é‡Œæ‰èƒ½ä½¿ç”¨. å¦‚æœä¸€ä¸å°å¿ƒåœ¨ Lock&Condition å®ç°çš„ç®¡ç¨‹é‡Œè°ƒç”¨äº† wait(), notify(), notifyAll(), é‚£ç¨‹åºå¯å°±å½»åº•ç©å„¿å®Œäº†.")]),s._v(" "),t("p",[s._v("Java SDK "),t("strong",[s._v("å¹¶å‘åŒ…é‡Œçš„ Lock å’Œ Condition ä¸è¿‡å°±æ˜¯ç®¡ç¨‹çš„ä¸€ç§å®ç°")]),s._v("è€Œå·², ç®¡ç¨‹ä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†, é‚£ Lock å’Œ Condition çš„ä½¿ç”¨è‡ªç„¶æ˜¯å°èœä¸€ç¢Ÿ. ä¸‹é¢å°±æ¥çœ‹çœ‹åœ¨çŸ¥åé¡¹ç›® Dubbo ä¸­, Lock å’Œ Condition æ˜¯æ€ä¹ˆç”¨çš„. ä¸è¿‡åœ¨å¼€å§‹ä»‹ç»æºç ä¹‹å‰, è¿˜å…ˆè¦ä»‹ç»ä¸¤ä¸ªæ¦‚å¿µ: åŒæ­¥å’Œå¼‚æ­¥.")]),s._v(" "),t("h5",{attrs:{id:"åŒæ­¥ä¸å¼‚æ­¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŒæ­¥ä¸å¼‚æ­¥"}},[s._v("#")]),s._v(" åŒæ­¥ä¸å¼‚æ­¥")]),s._v(" "),t("p",[s._v("æœ€è¿‘å‡ å¹´, å¼‚æ­¥ç¼–ç¨‹å¤§ç«. é‚£åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢? "),t("strong",[s._v("é€šä¿—ç‚¹æ¥è®²å°±æ˜¯è°ƒç”¨æ–¹æ˜¯å¦éœ€è¦ç­‰å¾…ç»“æœ, å¦‚æœéœ€è¦ç­‰å¾…ç»“æœ, å°±æ˜¯åŒæ­¥; å¦‚æœä¸éœ€è¦ç­‰å¾…ç»“æœ, å°±æ˜¯å¼‚æ­¥")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚åœ¨ä¸‹é¢çš„ä»£ç é‡Œ, æœ‰ä¸€ä¸ªè®¡ç®—åœ†å‘¨ç‡å°æ•°ç‚¹å 100 ä¸‡ä½çš„æ–¹æ³• "),t("code",[s._v("pai1M()")]),s._v("â€‹, è¿™ä¸ªæ–¹æ³•å¯èƒ½éœ€è¦æ‰§è¡Œä¿©ç¤¼æ‹œ, å¦‚æœè°ƒç”¨ "),t("code",[s._v("pai1M()")]),s._v("â€‹ ä¹‹å, çº¿ç¨‹ä¸€ç›´ç­‰ç€è®¡ç®—ç»“æœ, ç­‰ä¿©ç¤¼æ‹œä¹‹åç»“æœè¿”å›, å°±å¯ä»¥æ‰§è¡Œ "),t("code",[s._v('printf("hello world")')]),s._v("â€‹ äº†, è¿™ä¸ªå±äºåŒæ­¥; å¦‚æœè°ƒç”¨ "),t("code",[s._v("pai1M()")]),s._v("â€‹ ä¹‹å, çº¿ç¨‹ä¸ç”¨ç­‰å¾…è®¡ç®—ç»“æœ, ç«‹åˆ»å°±å¯ä»¥æ‰§è¡Œ "),t("code",[s._v('printf("hello world")')]),s._v("â€‹, è¿™ä¸ªå°±å±äºå¼‚æ­¥.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¡ç®—åœ†å‘¨ç‡å°è¯´ç‚¹å 100 ä¸‡ä½ ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pai1M")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä»£ç æ— æ•°")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pai1M")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("åŒæ­¥, æ˜¯ Java ä»£ç é»˜è®¤çš„å¤„ç†æ–¹å¼. å¦‚æœæƒ³è®©ç¨‹åºæ”¯æŒå¼‚æ­¥, å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹å¼æ¥å®ç°:")]),s._v(" "),t("ol",[t("li",[s._v("è°ƒç”¨æ–¹åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹, åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œæ–¹æ³•è°ƒç”¨, è¿™ç§è°ƒç”¨ç§°ä¸ºå¼‚æ­¥è°ƒç”¨;")]),s._v(" "),t("li",[s._v("æ–¹æ³•å®ç°çš„æ—¶å€™, åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä¸»è¦é€»è¾‘, ä¸»çº¿ç¨‹ç›´æ¥ return, è¿™ç§æ–¹æ³•ä¸€èˆ¬ç§°ä¸ºå¼‚æ­¥æ–¹æ³•.")])]),s._v(" "),t("h5",{attrs:{id:"dubboæºç åˆ†æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dubboæºç åˆ†æ"}},[s._v("#")]),s._v(" Dubboæºç åˆ†æ")]),s._v(" "),t("p",[s._v("å…¶å®åœ¨ç¼–ç¨‹é¢†åŸŸ, å¼‚æ­¥çš„åœºæ™¯è¿˜æ˜¯æŒºå¤šçš„, æ¯”å¦‚ TCP åè®®æœ¬èº«å°±æ˜¯å¼‚æ­¥çš„, å·¥ä½œä¸­ç»å¸¸ç”¨åˆ°çš„ RPC è°ƒç”¨, "),t("strong",[s._v("åœ¨ TCP åè®®å±‚é¢, å‘é€å®Œ RPC è¯·æ±‚å, çº¿ç¨‹æ˜¯ä¸ä¼šç­‰å¾… RPC çš„å“åº”ç»“æœçš„")]),s._v(". å¯èƒ½ä½ ä¼šè§‰å¾—å¥‡æ€ª, å¹³æ—¶å·¥ä½œä¸­çš„ RPC è°ƒç”¨å¤§å¤šæ•°éƒ½æ˜¯åŒæ­¥çš„å•Š? è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢?")]),s._v(" "),t("p",[s._v("å…¶å®å¾ˆç®€å•, ä¸€å®šæ˜¯æœ‰äººå¸®ä½ åšäº†å¼‚æ­¥è½¬åŒæ­¥çš„äº‹æƒ…. ä¾‹å¦‚ç›®å‰çŸ¥åçš„ RPC æ¡†æ¶ "),t("mark",[t("strong",[s._v("Dubbo å°±åšäº†å¼‚æ­¥è½¬åŒæ­¥çš„äº‹æƒ…")])]),s._v(", é‚£å®ƒæ˜¯æ€ä¹ˆåšçš„å‘¢? ä¸‹é¢å°±æ¥åˆ†æä¸€ä¸‹ Dubbo çš„ç›¸å…³æºç .")]),s._v(" "),t("p",[s._v('å¯¹äºä¸‹é¢ä¸€ä¸ªç®€å•çš„ RPC è°ƒç”¨, é»˜è®¤æƒ…å†µä¸‹ sayHello() æ–¹æ³•, æ˜¯ä¸ªåŒæ­¥æ–¹æ³•, ä¹Ÿå°±æ˜¯è¯´, æ‰§è¡Œ service.sayHello("dubbo") çš„æ—¶å€™, çº¿ç¨‹ä¼šåœä¸‹æ¥ç­‰ç»“æœ.')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DemoService")]),s._v(" service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" åˆå§‹åŒ–éƒ¨åˆ†çœç•¥\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sayHello")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dubbo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å¦‚æœæ­¤æ—¶å°†è°ƒç”¨çº¿ç¨‹ dump å‡ºæ¥çš„è¯, ä¼šæ˜¯ä¸‹å›¾è¿™ä¸ªæ ·å­, ä½ ä¼šå‘ç°è°ƒç”¨çº¿ç¨‹é˜»å¡äº†, çº¿ç¨‹çŠ¶æ€æ˜¯ "),t("strong",[s._v("TIMED_WAITING")]),s._v(". æœ¬æ¥å‘é€è¯·æ±‚æ˜¯"),t("strong",[s._v("å¼‚æ­¥")]),s._v("çš„, ä½†æ˜¯è°ƒç”¨çº¿ç¨‹å´"),t("strong",[s._v("é˜»å¡")]),s._v("äº†, è¯´æ˜ Dubbo å¸®åšäº†å¼‚æ­¥è½¬åŒæ­¥çš„äº‹æƒ…. é€šè¿‡è°ƒç”¨æ ˆ, èƒ½çœ‹åˆ°çº¿ç¨‹æ˜¯é˜»å¡åœ¨ DefaultFuture.get() æ–¹æ³•ä¸Š, æ‰€ä»¥å¯ä»¥æ¨æ–­: "),t("strong",[s._v("Dubbo å¼‚æ­¥è½¬åŒæ­¥çš„åŠŸèƒ½åº”è¯¥æ˜¯é€šè¿‡ DefaultFuture è¿™ä¸ªç±»å®ç°çš„")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/84ac9b6ddd47c2a1590dc1e001c14358-20230731162452-4ikcfct.png",alt:"",title:"è°ƒç”¨æ ˆä¿¡æ¯"}})]),s._v(" "),t("p",[s._v("ä¸è¿‡ä¸ºäº†ç†æ¸…å‰åå…³ç³», è¿˜æ˜¯æœ‰å¿…è¦åˆ†æä¸€ä¸‹è°ƒç”¨ DefaultFuture.get() ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆ. DubboInvoker çš„ 108 è¡Œè°ƒç”¨äº† DefaultFuture.get(), è¿™ä¸€è¡Œå¾ˆå…³é”®, è¿™é‡Œç¨å¾®ä¿®æ”¹äº†ä¸€ä¸‹åˆ—åœ¨äº†ä¸‹é¢. è¿™ä¸€è¡Œå…ˆè°ƒç”¨äº† request(inv, timeout) æ–¹æ³•, è¿™ä¸ªæ–¹æ³•å…¶å®å°±æ˜¯å‘é€ RPC è¯·æ±‚, ä¹‹åé€šè¿‡è°ƒç”¨ get() æ–¹æ³•ç­‰å¾… RPC è¿”å›ç»“æœ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DubboInvoker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doInvoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Invocation")]),s._v(" inv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸‹é¢è¿™è¡Œå°±æ˜¯æºç ä¸­ 108 è¡Œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸ºäº†ä¾¿äºå±•ç¤º, åšäº†ä¿®æ”¹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" currentClient"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("DefaultFuture è¿™ä¸ªç±»æ˜¯å¾ˆå…³é”®, è¿™é‡ŒæŠŠç›¸å…³çš„ä»£ç ç²¾ç®€ä¹‹å, åˆ—åˆ°äº†ä¸‹é¢. ä¸è¿‡åœ¨çœ‹ä»£ç ä¹‹å‰, è¿˜æ˜¯æœ‰å¿…è¦é‡å¤ä¸€ä¸‹éœ€æ±‚: "),t("strong",[s._v("å½“ RPC è¿”å›ç»“æœä¹‹å‰, é˜»å¡è°ƒç”¨çº¿ç¨‹, è®©è°ƒç”¨çº¿ç¨‹ç­‰å¾…; å½“ RPC è¿”å›ç»“æœå, å”¤é†’è°ƒç”¨çº¿ç¨‹, è®©è°ƒç”¨çº¿ç¨‹é‡æ–°æ‰§è¡Œ")]),s._v(". ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰, è¿™ä¸å°±æ˜¯ç»å…¸çš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶å—? è¿™ä¸ªæ—¶å€™æƒ³å¿…ä½ çš„è„‘æµ·é‡Œåº”è¯¥èƒ½å¤Ÿæµ®ç°å‡º"),t("strong",[s._v("ç®¡ç¨‹")]),s._v("çš„è§£å†³æ–¹æ¡ˆäº†. å†æ¥çœ‹çœ‹ Dubbo æ˜¯æ€ä¹ˆå®ç°çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºé”ä¸æ¡ä»¶å˜é‡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Condition")]),s._v(" done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCondition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨æ–¹é€šè¿‡è¯¥æ–¹æ³•ç­‰å¾…ç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isDone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" cur "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isDone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" cur "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isDone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeoutException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("returnFromResponse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// RPC ç»“æœæ˜¯å¦å·²ç»è¿”å›")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isDone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// RPC ç»“æœè¿”å›æ—¶è°ƒç”¨è¯¥æ–¹æ³•   ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doReceived")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Response")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        response "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br")])]),t("p",[s._v('è°ƒç”¨çº¿ç¨‹é€šè¿‡è°ƒç”¨ get() æ–¹æ³•ç­‰å¾… RPC è¿”å›ç»“æœ, è¿™ä¸ªæ–¹æ³•é‡Œé¢, ä½ çœ‹åˆ°çš„éƒ½æ˜¯ç†Ÿæ‚‰çš„"é¢å­”": '),t("strong",[s._v("è°ƒç”¨ lock() è·å–é”, åœ¨ finally é‡Œé¢è°ƒç”¨ unlock() é‡Šæ”¾é”; è·å–é”å, é€šè¿‡ç»å…¸çš„åœ¨å¾ªç¯ä¸­è°ƒç”¨ await() æ–¹æ³•æ¥å®ç°ç­‰å¾…")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ RPC ç»“æœè¿”å›æ—¶, ä¼šè°ƒç”¨ doReceived() æ–¹æ³•, è¿™ä¸ªæ–¹æ³•é‡Œé¢, è°ƒç”¨ lock() è·å–é”, åœ¨ finally é‡Œé¢è°ƒç”¨ unlock() é‡Šæ”¾é”, è·å–é”åé€šè¿‡è°ƒç”¨ signal() æ¥é€šçŸ¥è°ƒç”¨çº¿ç¨‹, ç»“æœå·²ç»è¿”å›, ä¸ç”¨ç»§ç»­ç­‰å¾…äº†.")]),s._v(" "),t("p",[s._v("è‡³æ­¤, Dubbo é‡Œé¢çš„å¼‚æ­¥è½¬åŒæ­¥çš„æºç å°±åˆ†æå®Œäº†, æœ‰æ²¡æœ‰è§‰å¾—è¿˜æŒºç®€å•çš„? æœ€è¿‘è¿™å‡ å¹´, å·¥ä½œä¸­éœ€è¦å¼‚æ­¥å¤„ç†çš„è¶Šæ¥è¶Šå¤šäº†, å…¶ä¸­æœ‰ä¸€ä¸ªä¸»è¦åŸå› å°±æ˜¯æœ‰äº› API æœ¬èº«å°±æ˜¯å¼‚æ­¥ API. ä¾‹å¦‚ websocket ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„é€šä¿¡åè®®, å¦‚æœåŸºäºè¿™ä¸ªåè®®å®ç°ä¸€ä¸ªç®€å•çš„ RPC, ä¹Ÿä¼šé‡åˆ°å¼‚æ­¥è½¬åŒæ­¥çš„é—®é¢˜. ç°åœ¨å¾ˆå¤šå…¬æœ‰äº‘çš„ API æœ¬èº«ä¹Ÿæ˜¯å¼‚æ­¥çš„, ä¾‹å¦‚åˆ›å»ºäº‘ä¸»æœº, å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ API, è°ƒç”¨è™½ç„¶æˆåŠŸäº†, ä½†æ˜¯äº‘ä¸»æœºå¹¶æ²¡æœ‰åˆ›å»ºæˆåŠŸ, ä½ éœ€è¦è°ƒç”¨å¦å¤–ä¸€ä¸ª API å»è½®è¯¢äº‘ä¸»æœºçš„çŠ¶æ€. å¦‚æœä½ éœ€è¦åœ¨é¡¹ç›®å†…éƒ¨å°è£…åˆ›å»ºäº‘ä¸»æœºçš„ API, ä½ ä¹Ÿä¼šé¢ä¸´å¼‚æ­¥è½¬åŒæ­¥çš„é—®é¢˜, å› ä¸ºåŒæ­¥çš„ API æ›´æ˜“ç”¨.")]),s._v(" "),t("h4",{attrs:{id:"_16-semaphore-å¦‚ä½•å¿«é€Ÿå®ç°ä¸€ä¸ªé™æµå™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-semaphore-å¦‚ä½•å¿«é€Ÿå®ç°ä¸€ä¸ªé™æµå™¨"}},[s._v("#")]),s._v(" 16-Semaphore:å¦‚ä½•å¿«é€Ÿå®ç°ä¸€ä¸ªé™æµå™¨?")]),s._v(" "),t("p",[s._v('Semaphore, ç°åœ¨æ™®éç¿»è¯‘ä¸º"ä¿¡å·é‡", ä»¥å‰ä¹Ÿæ›¾è¢«ç¿»è¯‘æˆ"ä¿¡å·ç¯", å› ä¸ºç±»ä¼¼ç°å®ç”Ÿæ´»é‡Œçš„çº¢ç»¿ç¯, è½¦è¾†èƒ½ä¸èƒ½é€šè¡Œ, è¦çœ‹æ˜¯ä¸æ˜¯ç»¿ç¯. åŒæ ·, åœ¨ç¼–ç¨‹ä¸–ç•Œé‡Œ, '),t("strong",[s._v("çº¿ç¨‹èƒ½ä¸èƒ½æ‰§è¡Œ, ä¹Ÿè¦çœ‹ä¿¡å·é‡æ˜¯ä¸æ˜¯å…è®¸")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¿¡å·é‡æ˜¯ç”±å¤§åé¼é¼çš„è®¡ç®—æœºç§‘å­¦å®¶è¿ªæ°æ–¯ç‰¹æ‹‰(Dijkstra)äº 1965 å¹´æå‡º, åœ¨è¿™ä¹‹åçš„ 15 å¹´, ä¿¡å·é‡ä¸€ç›´éƒ½æ˜¯å¹¶å‘ç¼–ç¨‹é¢†åŸŸçš„ç»ˆç»“è€…, ç›´åˆ° 1980 å¹´ç®¡ç¨‹è¢«æå‡ºæ¥, æ‰æœ‰äº†ç¬¬äºŒé€‰æ‹©. ç›®å‰å‡ ä¹æ‰€æœ‰æ”¯æŒå¹¶å‘ç¼–ç¨‹çš„è¯­è¨€éƒ½æ”¯æŒä¿¡å·é‡æœºåˆ¶, æ‰€ä»¥å­¦å¥½ä¿¡å·é‡è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„.")]),s._v(" "),t("p",[s._v("ä¸‹é¢é¦–å…ˆä»‹ç»ä¿¡å·é‡æ¨¡å‹, ä¹‹åä»‹ç»å¦‚ä½•ä½¿ç”¨ä¿¡å·é‡, æœ€åå†ç”¨ä¿¡å·é‡æ¥å®ç°ä¸€ä¸ª"),t("strong",[s._v("é™æµå™¨")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ä¿¡å·é‡æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¿¡å·é‡æ¨¡å‹"}},[s._v("#")]),s._v(" ä¿¡å·é‡æ¨¡å‹")]),s._v(" "),t("p",[s._v("ä¿¡å·é‡æ¨¡å‹è¿˜æ˜¯å¾ˆç®€å•çš„, å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸º: "),t("strong",[s._v("ä¸€ä¸ªè®¡æ•°å™¨, ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—, ä¸‰ä¸ªæ–¹æ³•")]),s._v(". åœ¨ä¿¡å·é‡æ¨¡å‹é‡Œ, è®¡æ•°å™¨å’Œç­‰å¾…é˜Ÿåˆ—å¯¹å¤–æ˜¯é€æ˜çš„, æ‰€ä»¥åªèƒ½é€šè¿‡ä¿¡å·é‡æ¨¡å‹æä¾›çš„ä¸‰ä¸ªæ–¹æ³•æ¥è®¿é—®å®ƒä»¬, è¿™ä¸‰ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯: "),t("strong",[s._v("init(), down() å’Œ up()")]),s._v(" . å¯ä»¥ç»“åˆä¸‹å›¾æ¥å½¢è±¡åŒ–åœ°ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1ee4f4d32ec49f4158c86909d74f5d16-20230731162452-kuozkyh.png",alt:"",title:"ä¿¡å·é‡æ¨¡å‹å›¾"}})]),s._v(" "),t("p",[s._v("è¿™ä¸‰ä¸ªæ–¹æ³•è¯¦ç»†çš„è¯­ä¹‰å…·ä½“å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("init(): è®¾ç½®è®¡æ•°å™¨çš„åˆå§‹å€¼")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("down(): è®¡æ•°å™¨çš„å€¼å‡ 1; å¦‚æœæ­¤æ—¶è®¡æ•°å™¨çš„å€¼å°äº 0, åˆ™å½“å‰çº¿ç¨‹å°†è¢«é˜»å¡, å¦åˆ™å½“å‰çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ.")])]),s._v(" "),t("li",[t("strong",[s._v("up(): è®¡æ•°å™¨çš„å€¼åŠ  1; å¦‚æœæ­¤æ—¶è®¡æ•°å™¨çš„å€¼å°äºæˆ–è€…ç­‰äº 0, åˆ™å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹, å¹¶å°†å…¶ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤.")])])]),s._v(" "),t("p",[s._v("è¿™é‡Œæåˆ°çš„ init(), down() å’Œ up() ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯"),t("strong",[s._v("åŸå­æ€§")]),s._v("çš„, å¹¶ä¸”è¿™ä¸ªåŸå­æ€§æ˜¯ç”±ä¿¡å·é‡æ¨¡å‹çš„å®ç°æ–¹ä¿è¯çš„. åœ¨ Java SDK é‡Œé¢, ä¿¡å·é‡æ¨¡å‹æ˜¯ç”± java.util.concurrent.Semaphore å®ç°çš„, Semaphore è¿™ä¸ªç±»èƒ½å¤Ÿä¿è¯è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯åŸå­æ“ä½œ.")]),s._v(" "),t("p",[s._v("å¦‚æœä½ è§‰å¾—ä¸Šé¢çš„æè¿°æœ‰ç‚¹ç»•çš„è¯, å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªä»£ç åŒ–çš„ä¿¡å·é‡æ¨¡å‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¡æ•°å™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…é˜Ÿåˆ—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Queue")]),s._v(" queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆå§‹åŒ–æ“ä½œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("down")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†å½“å‰çº¿ç¨‹æ’å…¥ç­‰å¾…é˜Ÿåˆ—")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é˜»å¡å½“å‰çº¿ç¨‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("up")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç§»é™¤ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æŸä¸ªçº¿ç¨‹ T")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å”¤é†’çº¿ç¨‹ T")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("è¿™é‡Œå†æ’ä¸€å¥, ä¿¡å·é‡æ¨¡å‹é‡Œé¢, down(), up() è¿™ä¸¤ä¸ªæ“ä½œå†å²ä¸Šæœ€æ—©ç§°ä¸º P æ“ä½œå’Œ V æ“ä½œ, æ‰€ä»¥ä¿¡å·é‡æ¨¡å‹ä¹Ÿè¢«"),t("strong",[s._v("ç§°ä¸º PV åŸè¯­")]),s._v(". å¦å¤–, è¿˜æœ‰äº›äººå–œæ¬¢ç”¨ semWait() å’Œ semSignal() æ¥ç§°å‘¼å®ƒä»¬, è™½ç„¶å«æ³•ä¸åŒ, ä½†æ˜¯è¯­ä¹‰éƒ½æ˜¯ç›¸åŒçš„. åœ¨ Java SDK å¹¶å‘åŒ…é‡Œ, "),t("strong",[s._v("down() å’Œ up() å¯¹åº”çš„åˆ™æ˜¯ acquire() å’Œ release()")]),s._v(" .")]),s._v(" "),t("h5",{attrs:{id:"å¦‚ä½•ä½¿ç”¨ä¿¡å·é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä½¿ç”¨ä¿¡å·é‡"}},[s._v("#")]),s._v(" å¦‚ä½•ä½¿ç”¨ä¿¡å·é‡")]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šæ–‡, ä½ åº”è¯¥ä¼šå‘ç°ä¿¡å·é‡çš„æ¨¡å‹è¿˜æ˜¯å¾ˆç®€å•çš„, é‚£å…·ä½“è¯¥å¦‚ä½•ä½¿ç”¨å‘¢? å…¶å®æƒ³æƒ³çº¢ç»¿ç¯å°±å¯ä»¥äº†. åå­—è·¯å£çš„çº¢ç»¿ç¯å¯ä»¥æ§åˆ¶äº¤é€š, å¾—ç›Šäºå®ƒçš„ä¸€ä¸ªå…³é”®è§„åˆ™: "),t("strong",[s._v("è½¦è¾†åœ¨é€šè¿‡è·¯å£å‰å¿…é¡»å…ˆæ£€æŸ¥æ˜¯å¦æ˜¯ç»¿ç¯, åªæœ‰ç»¿ç¯æ‰èƒ½é€šè¡Œ")]),s._v(". è¿™ä¸ªè§„åˆ™å’Œå‰é¢æåˆ°çš„é”è§„åˆ™æ˜¯ä¸æ˜¯å¾ˆç±»ä¼¼?")]),s._v(" "),t("p",[s._v("å…¶å®, ä¿¡å·é‡çš„ä½¿ç”¨ä¹Ÿæ˜¯ç±»ä¼¼çš„. è¿™é‡Œè¿˜æ˜¯ç”¨ç´¯åŠ å™¨çš„ä¾‹å­æ¥è¯´æ˜ä¿¡å·é‡çš„ä½¿ç”¨. åœ¨ç´¯åŠ å™¨çš„ä¾‹å­é‡Œé¢, count+=1 æ“ä½œæ˜¯ä¸ªä¸´ç•ŒåŒº, åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ, ä¹Ÿå°±æ˜¯è¯´è¦ä¿è¯äº’æ–¥. é‚£è¿™ç§æƒ…å†µç”¨ä¿¡å·é‡æ€ä¹ˆæ§åˆ¶å‘¢?")]),s._v(" "),t("p",[s._v("å…¶å®å¾ˆç®€å•, å°±åƒç”¨äº’æ–¥é”ä¸€æ ·, åªéœ€è¦"),t("strong",[s._v("åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰æ‰§è¡Œä¸€ä¸‹ down() æ“ä½œ, é€€å‡ºä¸´ç•ŒåŒºä¹‹å‰æ‰§è¡Œä¸€ä¸‹ up() æ“ä½œå°±å¯ä»¥äº†")]),s._v(". ä¸‹é¢æ˜¯ Java ä»£ç çš„ç¤ºä¾‹, acquire() å°±æ˜¯ä¿¡å·é‡é‡Œçš„ down() æ“ä½œ, release() å°±æ˜¯ä¿¡å·é‡é‡Œçš„ up() æ“ä½œ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆå§‹åŒ–ä¿¡å·é‡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),s._v(" s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨ä¿¡å·é‡ä¿è¯äº’æ–¥  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("ä¸‹é¢å†æ¥åˆ†æä¸€ä¸‹, "),t("strong",[s._v("ä¿¡å·é‡æ˜¯å¦‚ä½•ä¿è¯äº’æ–¥")]),s._v("çš„. å‡è®¾ä¸¤ä¸ªçº¿ç¨‹ T1 å’Œ T2 åŒæ—¶è®¿é—® addOne() æ–¹æ³•, å½“å®ƒä»¬åŒæ—¶è°ƒç”¨ acquire() çš„æ—¶å€™, ç”±äº acquire() æ˜¯ä¸€ä¸ª"),t("strong",[s._v("åŸå­æ“ä½œ")]),s._v(", æ‰€ä»¥åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹(å‡è®¾ T1)æŠŠä¿¡å·é‡é‡Œçš„è®¡æ•°å™¨å‡ä¸º 0, å¦å¤–ä¸€ä¸ªçº¿ç¨‹(T2)åˆ™æ˜¯å°†è®¡æ•°å™¨å‡ä¸º -1. å¯¹äºçº¿ç¨‹ T1, ä¿¡å·é‡é‡Œé¢çš„è®¡æ•°å™¨çš„å€¼æ˜¯ 0, å¤§äºç­‰äº 0, æ‰€ä»¥çº¿ç¨‹ T1 ä¼šç»§ç»­æ‰§è¡Œ; å¯¹äºçº¿ç¨‹ T2, ä¿¡å·é‡é‡Œé¢çš„è®¡æ•°å™¨çš„å€¼æ˜¯ -1, å°äº 0, æŒ‰ç…§ä¿¡å·é‡æ¨¡å‹é‡Œå¯¹ down() æ“ä½œçš„æè¿°, çº¿ç¨‹ T2 å°†è¢«é˜»å¡. æ‰€ä»¥æ­¤æ—¶åªæœ‰çº¿ç¨‹ T1 ä¼šè¿›å…¥ä¸´ç•ŒåŒºæ‰§è¡Œ "),t("code",[s._v("count+=1;")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("å½“çº¿ç¨‹ T1 æ‰§è¡Œ release() æ“ä½œ, ä¹Ÿå°±æ˜¯ up() æ“ä½œçš„æ—¶å€™, ä¿¡å·é‡é‡Œè®¡æ•°å™¨çš„å€¼æ˜¯ -1, åŠ  1 ä¹‹åçš„å€¼æ˜¯ 0, å°äºç­‰äº 0, æŒ‰ç…§ä¿¡å·é‡æ¨¡å‹é‡Œå¯¹ up() æ“ä½œçš„æè¿°, "),t("strong",[s._v("æ­¤æ—¶ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ T2 å°†ä¼šè¢«å”¤é†’")]),s._v(". äºæ˜¯ T2 åœ¨ T1 æ‰§è¡Œå®Œä¸´ç•ŒåŒºä»£ç ä¹‹åæ‰è·å¾—äº†è¿›å…¥ä¸´ç•ŒåŒºæ‰§è¡Œçš„æœºä¼š, ä»è€Œä¿è¯äº†äº’æ–¥æ€§.")]),s._v(" "),t("h5",{attrs:{id:"å¿«é€Ÿå®ç°ä¸€ä¸ªé™æµå™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¿«é€Ÿå®ç°ä¸€ä¸ªé™æµå™¨"}},[s._v("#")]),s._v(" å¿«é€Ÿå®ç°ä¸€ä¸ªé™æµå™¨")]),s._v(" "),t("p",[s._v("ä¸Šé¢çš„ä¾‹å­ç”¨ä¿¡å·é‡å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„äº’æ–¥é”åŠŸèƒ½. ä¼°è®¡ä½ ä¼šè§‰å¾—å¥‡æ€ª, æ—¢ç„¶æœ‰ Java SDK é‡Œé¢æä¾›äº† Lock, ä¸ºå•¥è¿˜è¦æä¾›ä¸€ä¸ª Semaphore ? å…¶å®å®ç°ä¸€ä¸ªäº’æ–¥é”, ä»…ä»…æ˜¯ Semaphore çš„éƒ¨åˆ†åŠŸèƒ½, Semaphore è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯ Lock ä¸å®¹æ˜“å®ç°çš„, é‚£å°±æ˜¯: "),t("mark",[t("strong",[s._v("Semaphore å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªä¸´ç•ŒåŒº")])]),s._v(".")]),s._v(" "),t("p",[s._v("ç°å®ä¸­è¿˜æœ‰è¿™ç§éœ€æ±‚? æœ‰çš„. æ¯”è¾ƒå¸¸è§çš„éœ€æ±‚å°±æ˜¯å·¥ä½œä¸­é‡åˆ°çš„"),t("strong",[s._v("å„ç§æ± åŒ–èµ„æº, ä¾‹å¦‚è¿æ¥æ± , å¯¹è±¡æ± , çº¿ç¨‹æ± ")]),s._v("ç­‰ç­‰. å…¶ä¸­, ä½ å¯èƒ½æœ€ç†Ÿæ‚‰æ•°æ®åº“è¿æ¥æ± , åœ¨åŒä¸€æ—¶åˆ», ä¸€å®šæ˜¯å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨è¿æ¥æ± çš„, å½“ç„¶"),t("strong",[s._v("æ¯ä¸ªè¿æ¥åœ¨è¢«é‡Šæ”¾å‰, æ˜¯ä¸å…è®¸å…¶ä»–çº¿ç¨‹ä½¿ç”¨çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("æˆ‘ä¹Ÿé‡åˆ°è¿‡ä¸€ä¸ªå¯¹è±¡æ± çš„éœ€æ±‚. æ‰€è°“å¯¹è±¡æ± , æŒ‡çš„æ˜¯ä¸€æ¬¡æ€§åˆ›å»ºå‡º N ä¸ªå¯¹è±¡, ä¹‹åæ‰€æœ‰çš„çº¿ç¨‹é‡å¤åˆ©ç”¨è¿™ N ä¸ªå¯¹è±¡, å½“ç„¶å¯¹è±¡åœ¨è¢«é‡Šæ”¾å‰, ä¹Ÿæ˜¯ä¸å…è®¸å…¶ä»–çº¿ç¨‹ä½¿ç”¨çš„. å¯¹è±¡æ± , å¯ä»¥ç”¨ List ä¿å­˜å®ä¾‹å¯¹è±¡, è¿™ä¸ªå¾ˆç®€å•. ä½†å…³é”®æ˜¯é™æµå™¨çš„è®¾è®¡, è¿™é‡Œçš„é™æµ, æŒ‡çš„æ˜¯"),t("strong",[s._v("ä¸å…è®¸å¤šäº N ä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒº")]),s._v(". é‚£å¦‚ä½•å¿«é€Ÿå®ç°ä¸€ä¸ªè¿™æ ·çš„é™æµå™¨å‘¢? è¿™ç§åœºæ™¯, å°±ç«‹åˆ»å°±æƒ³åˆ°äº†ä¿¡å·é‡çš„è§£å†³æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("ä¿¡å·é‡çš„è®¡æ•°å™¨, åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­è®¾ç½®æˆäº† 1, è¿™ä¸ª 1 è¡¨ç¤ºåªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒº, "),t("strong",[s._v("ä½†å¦‚æœæŠŠè®¡æ•°å™¨çš„å€¼è®¾ç½®æˆå¯¹è±¡æ± é‡Œå¯¹è±¡çš„ä¸ªæ•° N, å°±èƒ½å®Œç¾è§£å†³å¯¹è±¡æ± çš„é™æµé—®é¢˜")]),s._v("äº†. ä¸‹é¢å°±æ˜¯å¯¹è±¡æ± çš„ç¤ºä¾‹ä»£ç .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjPool")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨ä¿¡å·é‡å®ç°é™æµå™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),s._v(" sem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ å‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        pool "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vector")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        sem "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Semaphore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ©ç”¨å¯¹è±¡æ± çš„å¯¹è±¡, è°ƒç”¨ func")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Function")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" func"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" func"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            sem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºå¯¹è±¡æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjPool")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" pool "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjPool")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€šè¿‡å¯¹è±¡æ± è·å– t, ä¹‹åæ‰§è¡Œ  ")]),s._v("\npool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("è¿™é‡Œç”¨ä¸€ä¸ª Listæ¥ä¿å­˜å¯¹è±¡å®ä¾‹, ç”¨ Semaphore å®ç°é™æµå™¨. å…³é”®çš„ä»£ç æ˜¯ ObjPool é‡Œé¢çš„ exec() æ–¹æ³•, è¿™ä¸ªæ–¹æ³•é‡Œé¢"),t("strong",[s._v("å®ç°äº†é™æµçš„åŠŸèƒ½")]),s._v(". åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢, é¦–å…ˆè°ƒç”¨ acquire() æ–¹æ³•(ä¸ä¹‹åŒ¹é…çš„æ˜¯åœ¨ finally é‡Œé¢è°ƒç”¨ release() æ–¹æ³•), å‡è®¾å¯¹è±¡æ± çš„å¤§å°æ˜¯ 10, ä¿¡å·é‡çš„è®¡æ•°å™¨åˆå§‹åŒ–ä¸º 10, é‚£ä¹ˆå‰ 10 ä¸ªçº¿ç¨‹è°ƒç”¨ acquire() æ–¹æ³•, éƒ½èƒ½ç»§ç»­æ‰§è¡Œ, ç›¸å½“äºé€šè¿‡äº†ä¿¡å·ç¯, è€Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šé˜»å¡åœ¨ acquire() æ–¹æ³•ä¸Š. å¯¹äºé€šè¿‡ä¿¡å·ç¯çš„çº¿ç¨‹, ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ä¸ªå¯¹è±¡ t(è¿™ä¸ªåˆ†é…å·¥ä½œæ˜¯é€šè¿‡ pool.remove(0) å®ç°çš„), åˆ†é…å®Œä¹‹åä¼šæ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•° func, è€Œå‡½æ•°çš„å‚æ•°æ­£æ˜¯å‰é¢åˆ†é…çš„å¯¹è±¡ t ; æ‰§è¡Œå®Œå›è°ƒå‡½æ•°ä¹‹å, å®ƒä»¬å°±ä¼šé‡Šæ”¾å¯¹è±¡(è¿™ä¸ªé‡Šæ”¾å·¥ä½œæ˜¯é€šè¿‡ pool.add(t) å®ç°çš„), åŒæ—¶è°ƒç”¨ release() æ–¹æ³•æ¥æ›´æ–°ä¿¡å·é‡çš„è®¡æ•°å™¨. å¦‚æœæ­¤æ—¶ä¿¡å·é‡é‡Œè®¡æ•°å™¨çš„å€¼å°äºç­‰äº 0, é‚£ä¹ˆè¯´æ˜æœ‰çº¿ç¨‹åœ¨ç­‰å¾…, æ­¤æ—¶ä¼šè‡ªåŠ¨å”¤é†’ç­‰å¾…çš„çº¿ç¨‹.")]),s._v(" "),t("p",[s._v("ç®€è¨€ä¹‹, ä½¿ç”¨ä¿¡å·é‡, å¯ä»¥è½»æ¾åœ°å®ç°ä¸€ä¸ªé™æµå™¨, ä½¿ç”¨èµ·æ¥è¿˜æ˜¯éå¸¸ç®€å•çš„.")]),s._v(" "),t("h4",{attrs:{id:"_17-readwritelock-å¦‚ä½•å¿«é€Ÿå®ç°ä¸€ä¸ªå®Œå¤‡çš„ç¼“å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_17-readwritelock-å¦‚ä½•å¿«é€Ÿå®ç°ä¸€ä¸ªå®Œå¤‡çš„ç¼“å­˜"}},[s._v("#")]),s._v(" 17-ReadWriteLock:å¦‚ä½•å¿«é€Ÿå®ç°ä¸€ä¸ªå®Œå¤‡çš„ç¼“å­˜?")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº†ç®¡ç¨‹å’Œä¿¡å·é‡è¿™ä¸¤ä¸ªåŒæ­¥åŸè¯­åœ¨ Java è¯­è¨€ä¸­çš„å®ç°, ç†è®ºä¸Šç”¨è¿™ä¸¤ä¸ªåŒæ­¥åŸè¯­ä¸­ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥è§£å†³æ‰€æœ‰çš„å¹¶å‘é—®é¢˜. é‚£ Java SDK å¹¶å‘åŒ…é‡Œä¸ºä»€ä¹ˆè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„å·¥å…·ç±»å‘¢? åŸå› å¾ˆç®€å•: "),t("strong",[s._v("åˆ†åœºæ™¯ä¼˜åŒ–æ€§èƒ½, æå‡æ˜“ç”¨æ€§")]),s._v(".")]),s._v(" "),t("p",[s._v("ä»Šå¤©å°±ä»‹ç»ä¸€ç§éå¸¸æ™®éçš„å¹¶å‘åœºæ™¯: "),t("strong",[s._v("è¯»å¤šå†™å°‘åœº")]),s._v("æ™¯. å®é™…å·¥ä½œä¸­, ä¸ºäº†ä¼˜åŒ–æ€§èƒ½, ç»å¸¸ä¼šä½¿ç”¨ç¼“å­˜, ä¾‹å¦‚ç¼“å­˜å…ƒæ•°æ®, ç¼“å­˜åŸºç¡€æ•°æ®ç­‰, è¿™å°±æ˜¯ä¸€ç§å…¸å‹çš„è¯»å¤šå†™å°‘åº”ç”¨åœºæ™¯. "),t("strong",[s._v("ç¼“å­˜ä¹‹æ‰€ä»¥èƒ½æå‡æ€§èƒ½, ä¸€ä¸ªé‡è¦çš„æ¡ä»¶å°±æ˜¯ç¼“å­˜çš„æ•°æ®ä¸€å®šæ˜¯è¯»å¤šå†™å°‘çš„")]),s._v(", ä¾‹å¦‚å…ƒæ•°æ®å’ŒåŸºç¡€æ•°æ®åŸºæœ¬ä¸Šä¸ä¼šå‘ç”Ÿå˜åŒ–(å†™å°‘), ä½†æ˜¯ä½¿ç”¨å®ƒä»¬çš„åœ°æ–¹å´å¾ˆå¤š(è¯»å¤š).")]),s._v(" "),t("p",[s._v("é’ˆå¯¹è¯»å¤šå†™å°‘è¿™ç§å¹¶å‘åœºæ™¯, Java SDK å¹¶å‘åŒ…æä¾›äº†è¯»å†™é”--ReadWriteLock, éå¸¸å®¹æ˜“ä½¿ç”¨, å¹¶ä¸”æ€§èƒ½å¾ˆå¥½.")]),s._v(" "),t("p",[s._v("**é‚£ä»€ä¹ˆæ˜¯è¯»å†™é”å‘¢? **")]),s._v(" "),t("p",[s._v("è¯»å†™é”, å¹¶ä¸æ˜¯ Java è¯­è¨€ç‰¹æœ‰çš„, è€Œæ˜¯ä¸€ä¸ªå¹¿ä¸ºä½¿ç”¨çš„é€šç”¨æŠ€æœ¯, æ‰€æœ‰çš„è¯»å†™é”éƒ½éµå®ˆä»¥ä¸‹ä¸‰æ¡åŸºæœ¬åŸåˆ™:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡;")])]),s._v(" "),t("li",[t("strong",[s._v("åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…±äº«å˜é‡;")])]),s._v(" "),t("li",[t("strong",[s._v("å¦‚æœä¸€ä¸ªå†™çº¿ç¨‹æ­£åœ¨æ‰§è¡Œå†™æ“ä½œ, æ­¤æ—¶ç¦æ­¢è¯»çº¿ç¨‹è¯»å…±äº«å˜é‡.")])])]),s._v(" "),t("p",[s._v("è¯»å†™é”ä¸äº’æ–¥é”çš„ä¸€ä¸ªé‡è¦åŒºåˆ«å°±æ˜¯"),t("strong",[s._v("è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡")]),s._v(", è€Œäº’æ–¥é”æ˜¯ä¸å…è®¸çš„, è¿™æ˜¯è¯»å†™é”åœ¨è¯»å¤šå†™å°‘åœºæ™¯ä¸‹æ€§èƒ½ä¼˜äºäº’æ–¥é”çš„å…³é”®. ä½†"),t("strong",[s._v("è¯»å†™é”çš„å†™æ“ä½œæ˜¯äº’æ–¥çš„")]),s._v(", å½“ä¸€ä¸ªçº¿ç¨‹åœ¨å†™å…±äº«å˜é‡çš„æ—¶å€™, æ˜¯ä¸å…è®¸å…¶ä»–çº¿ç¨‹æ‰§è¡Œå†™æ“ä½œå’Œè¯»æ“ä½œ.")]),s._v(" "),t("h5",{attrs:{id:"å¿«é€Ÿå®ç°ä¸€ä¸ªç¼“å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¿«é€Ÿå®ç°ä¸€ä¸ªç¼“å­˜"}},[s._v("#")]),s._v(" å¿«é€Ÿå®ç°ä¸€ä¸ªç¼“å­˜")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±å®è·µèµ·æ¥, "),t("strong",[s._v("ç”¨ ReadWriteLock å¿«é€Ÿå®ç°ä¸€ä¸ªé€šç”¨çš„ç¼“å­˜å·¥å…·ç±»")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ä¸‹é¢çš„ä»£ç ä¸­, å£°æ˜äº†ä¸€ä¸ª "),t("code",[s._v("Cache<K, V>")]),s._v("â€‹ ç±», å…¶ä¸­ç±»å‹å‚æ•° K ä»£è¡¨ç¼“å­˜é‡Œ key çš„ç±»å‹, V ä»£è¡¨ç¼“å­˜é‡Œ value çš„ç±»å‹. ç¼“å­˜çš„æ•°æ®ä¿å­˜åœ¨ Cache ç±»å†…éƒ¨çš„ HashMap é‡Œé¢, HashMap ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„, è¿™é‡Œä½¿ç”¨è¯»å†™é” ReadWriteLock æ¥ä¿è¯å…¶çº¿ç¨‹å®‰å…¨. ReadWriteLock æ˜¯ä¸€ä¸ªæ¥å£, å®ƒçš„å®ç°ç±»æ˜¯ ReentrantReadWriteLock, é€šè¿‡åå­—å°±èƒ½åˆ¤æ–­å‡ºæ¥, å®ƒæ˜¯æ”¯æŒå¯é‡å…¥çš„. ä¸‹é¢é€šè¿‡ rwl "),t("strong",[s._v("åˆ›å»ºäº†ä¸€æŠŠè¯»é”å’Œä¸€æŠŠå†™é”")]),s._v(".")]),s._v(" "),t("p",[s._v("Cache è¿™ä¸ªå·¥å…·ç±», æä¾›äº†ä¸¤ä¸ªæ–¹æ³•, ä¸€ä¸ªæ˜¯è¯»ç¼“å­˜æ–¹æ³• get(), å¦ä¸€ä¸ªæ˜¯å†™ç¼“å­˜æ–¹æ³• put(). è¯»ç¼“å­˜éœ€è¦ç”¨åˆ°è¯»é”, è¯»é”çš„ä½¿ç”¨å’Œå‰é¢ä»‹ç»çš„ Lock çš„ä½¿ç”¨æ˜¯ç›¸åŒçš„, éƒ½æ˜¯ "),t("code",[s._v("try{} finally{}")]),s._v("â€‹ è¿™ä¸ªç¼–ç¨‹èŒƒå¼. å†™ç¼“å­˜åˆ™éœ€è¦ç”¨åˆ°å†™é”, å†™é”çš„ä½¿ç”¨å’Œè¯»é”æ˜¯ç±»ä¼¼çš„. è¿™æ ·çœ‹æ¥, è¯»å†™é”çš„ä½¿ç”¨è¿˜æ˜¯éå¸¸ç®€å•çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Cache")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReadWriteLock")]),s._v(" rwl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantReadWriteLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»é”")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rwl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™é”")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rwl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»ç¼“å­˜")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™ç¼“å­˜")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Data")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡ç¼“å­˜çš„è¯, ä½ åº”è¯¥çŸ¥é“"),t("strong",[s._v("ä½¿ç”¨ç¼“å­˜é¦–å…ˆè¦è§£å†³ç¼“å­˜æ•°æ®çš„åˆå§‹åŒ–é—®é¢˜")]),s._v(". ç¼“å­˜æ•°æ®çš„åˆå§‹åŒ–, å¯ä»¥é‡‡ç”¨ä¸€æ¬¡æ€§åŠ è½½çš„æ–¹å¼, ä¹Ÿå¯ä»¥ä½¿ç”¨æŒ‰éœ€åŠ è½½çš„æ–¹å¼.")]),s._v(" "),t("p",[s._v("å¦‚æœæºå¤´æ•°æ®çš„æ•°æ®é‡ä¸å¤§, å°±å¯ä»¥é‡‡ç”¨ä¸€æ¬¡æ€§åŠ è½½çš„æ–¹å¼, è¿™ç§æ–¹å¼æœ€ç®€å•(å¯å‚è€ƒä¸‹å›¾), åªéœ€åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™æŠŠæºå¤´æ•°æ®æŸ¥è¯¢å‡ºæ¥, ä¾æ¬¡è°ƒç”¨ç±»ä¼¼ä¸Šé¢ç¤ºä¾‹ä»£ç ä¸­çš„ put() æ–¹æ³•å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/77f0efad68c07a85c439da5bd5c17ead-20230731162452-xihn7xa.png",alt:"",title:"ç¼“å­˜ä¸€æ¬¡æ€§åŠ è½½ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å¦‚æœæºå¤´æ•°æ®é‡éå¸¸å¤§, é‚£ä¹ˆå°±éœ€è¦æŒ‰éœ€åŠ è½½äº†, æŒ‰éœ€åŠ è½½ä¹Ÿå«"),t("strong",[s._v("æ‡’åŠ è½½")]),s._v(", æŒ‡çš„æ˜¯åªæœ‰å½“åº”ç”¨æŸ¥è¯¢ç¼“å­˜, å¹¶ä¸”æ•°æ®ä¸åœ¨ç¼“å­˜é‡Œçš„æ—¶å€™, æ‰è§¦å‘åŠ è½½æºå¤´ç›¸å…³æ•°æ®è¿›ç¼“å­˜çš„æ“ä½œ. ä¸‹é¢å¯ä»¥ç»“åˆæ–‡ä¸­ç¤ºæ„å›¾çœ‹çœ‹å¦‚ä½•åˆ©ç”¨ ReadWriteLock æ¥å®ç°ç¼“å­˜çš„æŒ‰éœ€åŠ è½½.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e73d8698d413270f0e912827a0ec11d2-20230731162452-5rxpb8q.png",alt:"",title:"ç¼“å­˜æŒ‰éœ€åŠ è½½ç¤ºæ„å›¾"}})]),s._v(" "),t("h5",{attrs:{id:"å®ç°ç¼“å­˜çš„æŒ‰éœ€åŠ è½½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°ç¼“å­˜çš„æŒ‰éœ€åŠ è½½"}},[s._v("#")]),s._v(" å®ç°ç¼“å­˜çš„æŒ‰éœ€åŠ è½½")]),s._v(" "),t("p",[s._v("æ–‡ä¸­ä¸‹é¢çš„è¿™æ®µä»£ç å®ç°äº†æŒ‰éœ€åŠ è½½çš„åŠŸèƒ½, è¿™é‡Œå‡è®¾ç¼“å­˜çš„æºå¤´æ˜¯æ•°æ®åº“. éœ€è¦æ³¨æ„çš„æ˜¯, å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ç¼“å­˜ç›®æ ‡å¯¹è±¡, é‚£ä¹ˆå°±éœ€è¦ä»æ•°æ®åº“ä¸­åŠ è½½, ç„¶åå†™å…¥ç¼“å­˜, å†™ç¼“å­˜éœ€è¦ç”¨åˆ°å†™é”, æ‰€ä»¥åœ¨ä»£ç ä¸­çš„ â‘¤ å¤„è°ƒç”¨äº† "),t("code",[s._v("w.lock()")]),s._v("â€‹ æ¥è·å–å†™é”.")]),s._v(" "),t("p",[s._v("å¦å¤–, è¿˜éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨è·å–å†™é”ä¹‹å, å¹¶æ²¡æœ‰ç›´æ¥å»æŸ¥è¯¢æ•°æ®åº“, è€Œæ˜¯åœ¨ä»£ç  â‘¥â‘¦ å¤„, "),t("strong",[s._v("é‡æ–°éªŒè¯äº†ä¸€æ¬¡ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨, å†æ¬¡éªŒè¯å¦‚æœè¿˜æ˜¯ä¸å­˜åœ¨, æ‰å»æŸ¥è¯¢æ•°æ®åº“å¹¶æ›´æ–°æœ¬åœ°ç¼“å­˜")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Cache")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReadWriteLock")]),s._v(" rwl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantReadWriteLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rwl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rwl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»ç¼“å­˜")]),s._v("\n        r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¢")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¼“å­˜ä¸­å­˜åœ¨, è¿”å›")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘£")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¼“å­˜ä¸­ä¸å­˜åœ¨, æŸ¥è¯¢æ•°æ®åº“")]),s._v("\n        w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¤")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†æ¬¡éªŒè¯")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…¶ä»–çº¿ç¨‹å¯èƒ½å·²ç»æŸ¥è¯¢è¿‡æ•°æ®åº“")]),s._v("\n            v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¥")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¦")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æ•°æ®åº“")]),s._v("\n                v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" çœç•¥ä»£ç æ— æ•°\n                m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("ä¸ºä»€ä¹ˆè¦å†æ¬¡éªŒè¯å‘¢? åŸå› æ˜¯åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹, æœ‰å¯èƒ½ä¼šæœ‰å¤šçº¿ç¨‹ç«äº‰å†™é”. å‡è®¾ç¼“å­˜æ˜¯ç©ºçš„, æ²¡æœ‰ç¼“å­˜ä»»ä½•ä¸œè¥¿, å¦‚æœæ­¤æ—¶æœ‰ä¸‰ä¸ªçº¿ç¨‹ T1, T2 å’Œ T3 åŒæ—¶è°ƒç”¨ get() æ–¹æ³•, å¹¶ä¸”å‚æ•° key ä¹Ÿæ˜¯ç›¸åŒçš„. é‚£ä¹ˆå®ƒä»¬ä¼šåŒæ—¶æ‰§è¡Œåˆ°ä»£ç  â‘¤ å¤„, ä½†æ­¤æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å¾—å†™é”, å‡è®¾æ˜¯çº¿ç¨‹ T1, çº¿ç¨‹ T1 è·å–å†™é”ä¹‹åæŸ¥è¯¢æ•°æ®åº“å¹¶æ›´æ–°ç¼“å­˜, æœ€ç»ˆé‡Šæ”¾å†™é”. æ­¤æ—¶çº¿ç¨‹ T2 å’Œ T3 ä¼šå†æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–å†™é”, å‡è®¾æ˜¯ T2, å¦‚æœä¸é‡‡ç”¨å†æ¬¡éªŒè¯çš„æ–¹å¼, æ­¤æ—¶ T2 ä¼š"),t("strong",[s._v("å†æ¬¡")]),s._v("æŸ¥è¯¢æ•°æ®åº“. T2 é‡Šæ”¾å†™é”ä¹‹å, T3 ä¹Ÿä¼šå†æ¬¡æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“. è€Œå®é™…ä¸Šçº¿ç¨‹ T1 å·²ç»æŠŠç¼“å­˜çš„å€¼è®¾ç½®å¥½äº†, T2, T3 å®Œå…¨æ²¡æœ‰å¿…è¦å†æ¬¡æŸ¥è¯¢æ•°æ®åº“. æ‰€ä»¥"),t("strong",[s._v("å†æ¬¡éªŒè¯çš„æ–¹å¼, èƒ½å¤Ÿé¿å…é«˜å¹¶å‘åœºæ™¯ä¸‹é‡å¤æŸ¥è¯¢æ•°æ®çš„é—®é¢˜")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"è¯»å†™é”çš„å‡çº§ä¸é™çº§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¯»å†™é”çš„å‡çº§ä¸é™çº§"}},[s._v("#")]),s._v(" è¯»å†™é”çš„å‡çº§ä¸é™çº§")]),s._v(" "),t("p",[s._v("ä¸Šé¢æŒ‰éœ€åŠ è½½çš„ç¤ºä¾‹ä»£ç ä¸­, åœ¨ â‘  å¤„è·å–è¯»é”, åœ¨ â‘¢ å¤„é‡Šæ”¾è¯»é”, é‚£æ˜¯å¦å¯ä»¥åœ¨ â‘¡ å¤„çš„ä¸‹é¢å¢åŠ éªŒè¯ç¼“å­˜å¹¶æ›´æ–°ç¼“å­˜çš„é€»è¾‘å‘¢? è¯¦ç»†çš„ä»£ç å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»ç¼“å­˜")]),s._v("\nr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†æ¬¡éªŒè¯å¹¶æ›´æ–°ç¼“å­˜")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥è¯¦ç»†ä»£ç ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘¢")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("è¿™æ ·çœ‹ä¸Šå»å¥½åƒæ˜¯æ²¡æœ‰é—®é¢˜çš„, å…ˆæ˜¯è·å–è¯»é”, ç„¶åå†å‡çº§ä¸ºå†™é”, å¯¹æ­¤è¿˜æœ‰ä¸ªä¸“ä¸šçš„åå­—, å«"),t("strong",[s._v("é”çš„å‡çº§")]),s._v(". å¯æƒœ ReadWriteLock å¹¶ä¸æ”¯æŒè¿™ç§å‡çº§. åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­, "),t("strong",[s._v("è¯»é”è¿˜æ²¡æœ‰é‡Šæ”¾, æ­¤æ—¶è·å–å†™é”, ä¼šå¯¼è‡´å†™é”æ°¸ä¹…ç­‰å¾…, æœ€ç»ˆå¯¼è‡´ç›¸å…³çº¿ç¨‹éƒ½è¢«é˜»å¡, æ°¸è¿œä¹Ÿæ²¡æœ‰æœºä¼šè¢«å”¤é†’. é”çš„å‡çº§æ˜¯ä¸å…è®¸çš„, è¿™ä¸ªä¸€å®šè¦æ³¨æ„")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸è¿‡, è™½ç„¶é”çš„å‡çº§æ˜¯ä¸å…è®¸çš„, ä½†æ˜¯"),t("strong",[s._v("é”çš„é™çº§å´æ˜¯å…è®¸")]),s._v("çš„. ä»¥ä¸‹ä»£ç æ¥æºè‡ª ReentrantReadWriteLock çš„å®˜æ–¹ç¤ºä¾‹, ç•¥åšäº†æ”¹åŠ¨. ä½ ä¼šå‘ç°åœ¨ä»£ç  â‘  å¤„, è·å–è¯»é”çš„æ—¶å€™çº¿ç¨‹è¿˜æ˜¯æŒæœ‰å†™é”çš„, è¿™ç§é”çš„é™çº§æ˜¯æ”¯æŒçš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CachedData")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" cacheValid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReadWriteLock")]),s._v(" rwl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantReadWriteLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»é”  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rwl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™é”")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rwl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processCachedData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–è¯»é”")]),s._v("\n        r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("cacheValid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾è¯»é”, å› ä¸ºä¸å…è®¸è¯»é”çš„å‡çº§")]),s._v("\n            r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å†™é”")]),s._v("\n            w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†æ¬¡æ£€æŸ¥çŠ¶æ€  ")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("cacheValid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    data "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    cacheValid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾å†™é”å‰, é™çº§ä¸ºè¯»é”")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é™çº§æ˜¯å¯ä»¥çš„")]),s._v("\n                r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾å†™é”")]),s._v("\n                w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤å¤„ä»ç„¶æŒæœ‰è¯»é”")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-11"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-11"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("è¯»å†™é”ç±»ä¼¼äº ReentrantLock, ä¹Ÿæ”¯æŒå…¬å¹³æ¨¡å¼å’Œéå…¬å¹³æ¨¡å¼. è¯»é”å’Œå†™é”éƒ½å®ç°äº† java.util.concurrent.locks.Lock æ¥å£, æ‰€ä»¥é™¤äº†æ”¯æŒ lock() æ–¹æ³•å¤–, tryLock(), lockInterruptibly() ç­‰æ–¹æ³•ä¹Ÿéƒ½æ˜¯æ”¯æŒçš„. ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„, é‚£å°±æ˜¯"),t("strong",[s._v("åªæœ‰å†™é”æ”¯æŒæ¡ä»¶å˜é‡, è¯»é”æ˜¯ä¸æ”¯æŒæ¡ä»¶å˜é‡çš„")]),s._v(", è¯»é”è°ƒç”¨ newCondition() ä¼šæŠ›å‡º UnsupportedOperationException å¼‚å¸¸.")]),s._v(" "),t("p",[s._v("ä»Šå¤©ç”¨ ReadWriteLock å®ç°äº†ä¸€ä¸ªç®€å•çš„ç¼“å­˜, è¿™ä¸ªç¼“å­˜è™½ç„¶è§£å†³äº†ç¼“å­˜çš„åˆå§‹åŒ–é—®é¢˜, ä½†æ˜¯æ²¡æœ‰è§£å†³ç¼“å­˜æ•°æ®ä¸æºå¤´æ•°æ®çš„åŒæ­¥é—®é¢˜, è¿™é‡Œçš„æ•°æ®åŒæ­¥æŒ‡çš„æ˜¯ä¿è¯ç¼“å­˜æ•°æ®å’Œæºå¤´æ•°æ®çš„ä¸€è‡´æ€§. è§£å†³æ•°æ®åŒæ­¥é—®é¢˜çš„ä¸€ä¸ªæœ€ç®€å•çš„æ–¹æ¡ˆå°±æ˜¯"),t("strong",[s._v("è¶…æ—¶æœºåˆ¶")]),s._v(". æ‰€è°“è¶…æ—¶æœºåˆ¶æŒ‡çš„æ˜¯åŠ è½½è¿›ç¼“å­˜çš„æ•°æ®ä¸æ˜¯é•¿ä¹…æœ‰æ•ˆçš„, è€Œæ˜¯æœ‰æ—¶æ•ˆçš„, å½“ç¼“å­˜çš„æ•°æ®è¶…è¿‡æ—¶æ•ˆ, ä¹Ÿå°±æ˜¯è¶…æ—¶ä¹‹å, è¿™æ¡æ•°æ®åœ¨ç¼“å­˜ä¸­å°±å¤±æ•ˆäº†. è€Œè®¿é—®ç¼“å­˜ä¸­å¤±æ•ˆçš„æ•°æ®, ä¼šè§¦å‘ç¼“å­˜é‡æ–°ä»æºå¤´æŠŠæ•°æ®åŠ è½½è¿›ç¼“å­˜.")]),s._v(" "),t("p",[s._v("å½“ç„¶ä¹Ÿå¯ä»¥åœ¨æºå¤´æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶, å¿«é€Ÿåé¦ˆç»™ç¼“å­˜, ä½†è¿™ä¸ªå°±è¦ä¾èµ–å…·ä½“çš„åœºæ™¯äº†. ä¾‹å¦‚ MySQL ä½œä¸ºæ•°æ®æºå¤´, å¯ä»¥é€šè¿‡è¿‘å®æ—¶åœ°è§£æ binlog æ¥è¯†åˆ«æ•°æ®æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–, å¦‚æœå‘ç”Ÿäº†å˜åŒ–å°±å°†æœ€æ–°çš„æ•°æ®æ¨é€ç»™ç¼“å­˜. å¦å¤–, è¿˜æœ‰ä¸€äº›æ–¹æ¡ˆé‡‡å–çš„æ˜¯æ•°æ®åº“å’Œç¼“å­˜çš„åŒå†™æ–¹æ¡ˆ.")]),s._v(" "),t("h4",{attrs:{id:"_18-stampedlock-æœ‰æ²¡æœ‰æ¯”è¯»å†™é”æ›´å¿«çš„é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_18-stampedlock-æœ‰æ²¡æœ‰æ¯”è¯»å†™é”æ›´å¿«çš„é”"}},[s._v("#")]),s._v(" 18-StampedLock:æœ‰æ²¡æœ‰æ¯”è¯»å†™é”æ›´å¿«çš„é”?")]),s._v(" "),t("p",[s._v('ä¸Šä¸€èŠ‚ä»‹ç»äº†è¯»å†™é”, å­¦ä¹ å®Œä¹‹åä½ åº”è¯¥å·²ç»çŸ¥é“ "è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡, é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯". é‚£'),t("strong",[s._v("åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸­, è¿˜æœ‰æ²¡æœ‰æ›´å¿«çš„æŠ€æœ¯æ–¹æ¡ˆ")]),s._v("å‘¢? è¿˜çœŸæœ‰, Java åœ¨ 1.8 è¿™ä¸ªç‰ˆæœ¬é‡Œ, æä¾›äº†ä¸€ç§å« "),t("strong",[s._v("StampedLock")]),s._v(" çš„é”, å®ƒçš„æ€§èƒ½å°±æ¯”è¯»å†™é”è¿˜è¦å¥½.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹ StampedLock çš„ä½¿ç”¨æ–¹æ³•, å†…éƒ¨å·¥ä½œåŸç†ä»¥åŠåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„äº‹é¡¹.")]),s._v(" "),t("h5",{attrs:{id:"stampedlockæ”¯æŒçš„ä¸‰ç§é”æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#stampedlockæ”¯æŒçš„ä¸‰ç§é”æ¨¡å¼"}},[s._v("#")]),s._v(" StampedLockæ”¯æŒçš„ä¸‰ç§é”æ¨¡å¼")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹çœ‹åœ¨ä½¿ç”¨ä¸Š StampedLock å’Œä¸Šä¸€èŠ‚è®²çš„ ReadWriteLock æœ‰å“ªäº›åŒºåˆ«.")]),s._v(" "),t("p",[s._v("ReadWriteLock æ”¯æŒä¸¤ç§æ¨¡å¼: ä¸€ç§æ˜¯è¯»é”, ä¸€ç§æ˜¯å†™é”. è€Œ StampedLock æ”¯æŒä¸‰ç§æ¨¡å¼, åˆ†åˆ«æ˜¯: "),t("mark",[t("strong",[s._v("å†™é”")])]),s._v("â€‹"),t("mark",[s._v(",")]),s._v(" "),t("mark",[t("strong",[s._v("æ‚²è§‚è¯»é”")])]),s._v("â€‹"),t("mark",[s._v("å’Œ")]),s._v("â€‹"),t("mark",[t("strong",[s._v("ä¹è§‚è¯»")])]),s._v(". å…¶ä¸­, å†™é”, æ‚²è§‚è¯»é”çš„è¯­ä¹‰å’Œ ReadWriteLock çš„å†™é”, è¯»é”çš„è¯­ä¹‰éå¸¸ç±»ä¼¼, "),t("strong",[s._v("å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–æ‚²è§‚è¯»é”, ä½†æ˜¯åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”, å†™é”å’Œæ‚²è§‚è¯»é”æ˜¯äº’æ–¥çš„")]),s._v(". ä¸åŒçš„æ˜¯: "),t("strong",[s._v("StampedLock é‡Œçš„å†™é”å’Œæ‚²è§‚è¯»é”åŠ é”æˆåŠŸä¹‹å, éƒ½ä¼šè¿”å›ä¸€ä¸ª stamp; ç„¶åè§£é”çš„æ—¶å€™, éœ€è¦ä¼ å…¥è¿™ä¸ª stamp")]),s._v(". ç›¸å…³çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StampedLock")]),s._v(" sl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StampedLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–/é‡Šæ”¾æ‚²è§‚è¯»é”ç¤ºæ„ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" stamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä¸šåŠ¡ç›¸å…³ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlockRead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å– / é‡Šæ”¾å†™é”ç¤ºæ„ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" stamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä¸šåŠ¡ç›¸å…³ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlockWrite")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("StampedLock çš„æ€§èƒ½ä¹‹æ‰€ä»¥æ¯” ReadWriteLock è¿˜è¦å¥½, å…¶å…³é”®æ˜¯ StampedLock "),t("strong",[s._v("æ”¯æŒä¹è§‚è¯»")]),s._v("çš„æ–¹å¼. "),t("strong",[s._v("ReadWriteLock æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯», ä½†æ˜¯å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»çš„æ—¶å€™, æ‰€æœ‰çš„å†™æ“ä½œä¼šè¢«é˜»å¡; è€Œ StampedLock æä¾›çš„ä¹è§‚è¯», æ˜¯å…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”çš„, ä¹Ÿå°±æ˜¯è¯´ä¸æ˜¯æ‰€æœ‰çš„å†™æ“ä½œéƒ½è¢«é˜»å¡")]),s._v(".")]),s._v(" "),t("p",[s._v('æ³¨æ„è¿™é‡Œç”¨çš„æ˜¯ "ä¹è§‚è¯»" è¿™ä¸ªè¯, è€Œä¸æ˜¯ "ä¹è§‚è¯»é”", æ˜¯è¦æé†’ä½ , '),t("strong",[s._v("ä¹è§‚è¯»è¿™ä¸ªæ“ä½œæ˜¯æ— é”çš„")]),s._v(", æ‰€ä»¥ç›¸æ¯”è¾ƒ ReadWriteLock çš„è¯»é”, ä¹è§‚è¯»çš„æ€§èƒ½æ›´å¥½ä¸€äº›.")]),s._v(" "),t("p",[s._v("æ–‡ä¸­ä¸‹é¢è¿™æ®µä»£ç æ˜¯å‡ºè‡ª Java SDK å®˜æ–¹ç¤ºä¾‹, å¹¶ç•¥åšäº†ä¿®æ”¹. åœ¨ distanceFromOrigin() è¿™ä¸ªæ–¹æ³•ä¸­, é¦–å…ˆé€šè¿‡è°ƒç”¨ tryOptimisticRead() è·å–äº†ä¸€ä¸ª stamp, è¿™é‡Œçš„ tryOptimisticRead() å°±æ˜¯å‰é¢æåˆ°çš„ä¹è§‚è¯». ä¹‹åå°†å…±äº«å˜é‡ x å’Œ y è¯»å…¥æ–¹æ³•çš„å±€éƒ¨å˜é‡ä¸­, ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯, ç”±äº tryOptimisticRead() æ˜¯æ— é”çš„, æ‰€ä»¥å…±äº«å˜é‡ x å’Œ y è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡æ—¶, x å’Œ y æœ‰å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†. å› æ­¤æœ€åè¯»å®Œä¹‹å, è¿˜éœ€è¦å†æ¬¡éªŒè¯ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å†™æ“ä½œ, è¿™ä¸ªéªŒè¯æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨ validate(stamp) æ¥å®ç°çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Point")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StampedLock")]),s._v(" sl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StampedLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¡ç®—åˆ°åŸç‚¹çš„è·ç¦»  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("distanceFromOrigin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¹è§‚è¯»")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" stamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryOptimisticRead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»å…¥å±€éƒ¨å˜é‡, ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»çš„è¿‡ç¨‹æ•°æ®å¯èƒ½è¢«ä¿®æ”¹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" curX "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" curY "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­æ‰§è¡Œè¯»æ“ä½œæœŸé—´, ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ˜¯å¦å­˜åœ¨å†™æ“ä½œ, å¦‚æœå­˜åœ¨, ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ™ sl.validate è¿”å› false")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("validate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‡çº§ä¸ºæ‚²è§‚è¯»é”")]),s._v("\n            stamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                curX "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                curY "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾æ‚²è§‚è¯»é”")]),s._v("\n                sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlockRead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Math")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sqrt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curX "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" curX "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" curY "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" curY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("åœ¨ä¸Šé¢è¿™ä¸ªä»£ç ç¤ºä¾‹ä¸­, "),t("strong",[s._v("å¦‚æœæ‰§è¡Œä¹è§‚è¯»æ“ä½œçš„æœŸé—´, å­˜åœ¨å†™æ“ä½œ, ä¼šæŠŠä¹è§‚è¯»å‡çº§ä¸ºæ‚²è§‚è¯»é”")]),s._v(". è¿™ä¸ªåšæ³•æŒºåˆç†çš„, å¦åˆ™å°±éœ€è¦åœ¨ä¸€ä¸ªå¾ªç¯é‡Œåå¤æ‰§è¡Œä¹è§‚è¯», ç›´åˆ°æ‰§è¡Œä¹è§‚è¯»æ“ä½œçš„æœŸé—´æ²¡æœ‰å†™æ“ä½œ(åªæœ‰è¿™æ ·æ‰èƒ½ä¿è¯ x å’Œ y çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§), è€Œå¾ªç¯è¯»ä¼šæµªè´¹å¤§é‡çš„ CPU. å‡çº§ä¸ºæ‚²è§‚è¯»é”, ä»£ç ç®€ç»ƒä¸”ä¸æ˜“å‡ºé”™, å»ºè®®ä½ åœ¨å…·ä½“å®è·µæ—¶ä¹Ÿé‡‡ç”¨è¿™æ ·çš„æ–¹æ³•.")]),s._v(" "),t("h5",{attrs:{id:"è¿›ä¸€æ­¥ç†è§£ä¹è§‚è¯»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿›ä¸€æ­¥ç†è§£ä¹è§‚è¯»"}},[s._v("#")]),s._v(" è¿›ä¸€æ­¥ç†è§£ä¹è§‚è¯»")]),s._v(" "),t("p",[s._v("å¦‚æœä½ æ›¾ç»ç”¨è¿‡æ•°æ®åº“çš„ä¹è§‚é”, å¯èƒ½ä¼šå‘ç° StampedLock çš„ä¹è§‚è¯»å’Œæ•°æ®åº“çš„ä¹è§‚é”æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™. çš„ç¡®æ˜¯è¿™æ ·çš„, å°±æ‹¿æˆ‘ä¸ªäººæ¥è¯´, æˆ‘æ˜¯å…ˆæ¥è§¦çš„æ•°æ®åº“é‡Œçš„ä¹è§‚é”, ç„¶åæ‰æ¥è§¦çš„ StampedLock, æˆ‘å°±è§‰å¾—æˆ‘å‰æœŸæ•°æ®åº“é‡Œä¹è§‚é”çš„å­¦ä¹ å¯¹äºåé¢ç†è§£ StampedLock çš„ä¹è§‚è¯»æœ‰å¾ˆå¤§å¸®åŠ©, æ‰€ä»¥è¿™é‡Œæœ‰å¿…è¦å†ä»‹ç»ä¸€ä¸‹æ•°æ®åº“é‡Œçš„ä¹è§‚é”.")]),s._v(" "),t("p",[s._v("è¿˜è®°å¾—æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨æ•°æ®åº“ä¹è§‚é”çš„åœºæ™¯æ˜¯è¿™æ ·çš„: åœ¨ ERP çš„ç”Ÿäº§æ¨¡å—é‡Œ, ä¼šæœ‰å¤šä¸ªäººé€šè¿‡ ERP ç³»ç»Ÿæä¾›çš„ UI åŒæ—¶ä¿®æ”¹åŒä¸€æ¡ç”Ÿäº§è®¢å•, é‚£å¦‚ä½•ä¿è¯ç”Ÿäº§è®¢å•æ•°æ®æ˜¯å¹¶å‘å®‰å…¨çš„å‘¢? æˆ‘é‡‡ç”¨çš„æ–¹æ¡ˆå°±æ˜¯ä¹è§‚é”.")]),s._v(" "),t("p",[s._v("ä¹è§‚é”çš„å®ç°å¾ˆç®€å•, åœ¨ç”Ÿäº§è®¢å•çš„è¡¨ product_doc é‡Œå¢åŠ äº†ä¸€ä¸ªæ•°å€¼å‹ç‰ˆæœ¬å·å­—æ®µ version, æ¯æ¬¡æ›´æ–° product_doc è¿™ä¸ªè¡¨çš„æ—¶å€™, éƒ½å°† version å­—æ®µåŠ  1. ç”Ÿäº§è®¢å•çš„ UI åœ¨å±•ç¤ºçš„æ—¶å€™, éœ€è¦æŸ¥è¯¢æ•°æ®åº“, æ­¤æ—¶å°†è¿™ä¸ª version å­—æ®µå’Œå…¶ä»–ä¸šåŠ¡å­—æ®µä¸€èµ·è¿”å›ç»™ç”Ÿäº§è®¢å• UI. å‡è®¾ç”¨æˆ·æŸ¥è¯¢çš„ç”Ÿäº§è®¢å•çš„ id=777, é‚£ä¹ˆ SQL è¯­å¥ç±»ä¼¼ä¸‹é¢è¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("select id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" versionfrom product_docwhere id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç”¨æˆ·åœ¨ç”Ÿäº§è®¢å• UI æ‰§è¡Œä¿å­˜æ“ä½œçš„æ—¶å€™, åå°åˆ©ç”¨ä¸‹é¢çš„ SQL è¯­å¥æ›´æ–°ç”Ÿäº§è®¢å•, æ­¤å¤„å‡è®¾è¯¥æ¡ç”Ÿäº§è®¢å•çš„ version=9.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("update product_doc set version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("where id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" and version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æœè¿™æ¡ SQL è¯­å¥æ‰§è¡ŒæˆåŠŸå¹¶ä¸”è¿”å›çš„æ¡æ•°ç­‰äº 1, é‚£ä¹ˆè¯´æ˜ä»ç”Ÿäº§è®¢å• UI æ‰§è¡ŒæŸ¥è¯¢æ“ä½œåˆ°æ‰§è¡Œä¿å­˜æ“ä½œæœŸé—´, æ²¡æœ‰å…¶ä»–äººä¿®æ”¹è¿‡è¿™æ¡æ•°æ®. å› ä¸ºå¦‚æœè¿™æœŸé—´å…¶ä»–äººä¿®æ”¹è¿‡è¿™æ¡æ•°æ®, "),t("strong",[s._v("é‚£ä¹ˆç‰ˆæœ¬å·å­—æ®µä¸€å®šä¼šå¤§äº 9")]),s._v(".")]),s._v(" "),t("p",[s._v("ä½ ä¼šå‘ç°"),t("strong",[s._v("æ•°æ®åº“é‡Œçš„ä¹è§‚é”, æŸ¥è¯¢çš„æ—¶å€™éœ€è¦æŠŠ version å­—æ®µæŸ¥å‡ºæ¥, æ›´æ–°çš„æ—¶å€™è¦åˆ©ç”¨ version å­—æ®µåšéªŒè¯. è¿™ä¸ª version å­—æ®µå°±ç±»ä¼¼äº StampedLock é‡Œé¢çš„ stamp")]),s._v(". è¿™æ ·å¯¹æ¯”ç€çœ‹ä¼šæ›´å®¹æ˜“ç†è§£ StampedLock é‡Œä¹è§‚è¯»çš„ç”¨æ³•.")]),s._v(" "),t("h5",{attrs:{id:"stampedlockä½¿ç”¨æ³¨æ„äº‹é¡¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#stampedlockä½¿ç”¨æ³¨æ„äº‹é¡¹"}},[s._v("#")]),s._v(" StampedLockä½¿ç”¨æ³¨æ„äº‹é¡¹")]),s._v(" "),t("p",[s._v("å¯¹äºè¯»å¤šå†™å°‘çš„åœºæ™¯ StampedLock æ€§èƒ½å¾ˆå¥½, ç®€å•çš„åº”ç”¨åœºæ™¯åŸºæœ¬ä¸Šå¯ä»¥æ›¿ä»£ ReadWriteLock, ä½†æ˜¯"),t("strong",[s._v("StampedLock çš„åŠŸèƒ½ä»…ä»…æ˜¯ ReadWriteLock çš„å­é›†")]),s._v(", åœ¨ä½¿ç”¨çš„æ—¶å€™, è¿˜æ˜¯æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("StampedLock åœ¨å‘½åä¸Šå¹¶æ²¡æœ‰å¢åŠ  Reentrant, æƒ³å¿…ä½ å·²ç»çŒœæµ‹åˆ° StampedLock åº”è¯¥æ˜¯ä¸å¯é‡å…¥çš„. äº‹å®ä¸Š, çš„ç¡®æ˜¯è¿™æ ·çš„, "),t("mark",[t("strong",[s._v("StampedLock ä¸æ”¯æŒé‡å…¥")])]),s._v(". è¿™ä¸ªæ˜¯åœ¨ä½¿ç”¨ä¸­å¿…é¡»è¦ç‰¹åˆ«æ³¨æ„çš„.")]),s._v(" "),t("p",[s._v("å¦å¤–, StampedLock çš„"),t("strong",[s._v("æ‚²è§‚è¯»é”, å†™é”éƒ½ä¸æ”¯æŒæ¡ä»¶å˜é‡")]),s._v(", è¿™ä¸ªä¹Ÿéœ€è¦æ³¨æ„.")]),s._v(" "),t("p",[s._v("è¿˜æœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„, é‚£å°±æ˜¯: "),t("strong",[s._v("å¦‚æœçº¿ç¨‹é˜»å¡åœ¨ StampedLock çš„ readLock() æˆ–è€… writeLock() ä¸Šæ—¶, æ­¤æ—¶è°ƒç”¨è¯¥é˜»å¡çº¿ç¨‹çš„ interrupt() æ–¹æ³•, ä¼šå¯¼è‡´ CPU é£™å‡")]),s._v(". ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­, çº¿ç¨‹ T1 è·å–å†™é”ä¹‹åå°†è‡ªå·±é˜»å¡, çº¿ç¨‹ T2 å°è¯•è·å–æ‚²è§‚è¯»é”, ä¹Ÿä¼šé˜»å¡; å¦‚æœæ­¤æ—¶è°ƒç”¨çº¿ç¨‹ T2 çš„ interrupt() æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹ T2 çš„è¯, ä½ ä¼šå‘ç°çº¿ç¨‹ T2 æ‰€åœ¨ CPU ä¼šé£™å‡åˆ° 100%.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StampedLock")]),s._v(" lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StampedLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å†™é”")]),s._v("\n    lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ°¸è¿œé˜»å¡åœ¨æ­¤å¤„, ä¸é‡Šæ”¾å†™é”")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LockSupport")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("park")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿è¯ T1 è·å–å†™é”")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é˜»å¡åœ¨æ‚²è§‚è¯»é”")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿è¯ T2 é˜»å¡åœ¨è¯»é”")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸­æ–­çº¿ç¨‹ T2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¼šå¯¼è‡´çº¿ç¨‹ T2 æ‰€åœ¨ CPU é£™å‡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("æ‰€ä»¥, "),t("strong",[s._v("ä½¿ç”¨ StampedLock ä¸€å®šä¸è¦è°ƒç”¨ä¸­æ–­æ“ä½œ, å¦‚æœéœ€è¦æ”¯æŒä¸­æ–­åŠŸèƒ½, ä¸€å®šä½¿ç”¨å¯ä¸­æ–­çš„æ‚²è§‚è¯»é” readLockInterruptibly() å’Œå†™é” writeLockInterruptibly()")]),s._v(" . è¿™ä¸ªè§„åˆ™ä¸€å®šè¦è®°æ¸…æ¥š.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-12"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-12"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("StampedLock çš„ä½¿ç”¨çœ‹ä¸Šå»æœ‰ç‚¹å¤æ‚, ä½†æ˜¯å¦‚æœèƒ½ç†è§£ä¹è§‚é”èƒŒåçš„åŸç†, ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒæµç•…çš„. å»ºè®®è®¤çœŸæ£æ‘© Java çš„å®˜æ–¹ç¤ºä¾‹, è¿™ä¸ªç¤ºä¾‹åŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªæœ€ä½³å®è·µ. æŠŠ Java å®˜æ–¹ç¤ºä¾‹ç²¾ç®€å, å½¢æˆä¸‹é¢çš„ä»£ç æ¨¡æ¿, å»ºè®®åœ¨å®é™…å·¥ä½œä¸­å°½é‡æŒ‰ç…§è¿™ä¸ªæ¨¡æ¿æ¥ä½¿ç”¨ StampedLock.")]),s._v(" "),t("p",[s._v("StampedLock è¯»æ¨¡æ¿:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StampedLock")]),s._v(" sl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StampedLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¹è§‚è¯»")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" stamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryOptimisticRead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ......")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¡éªŒ stamp")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("validate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‡çº§ä¸ºæ‚²è§‚è¯»é”")]),s._v("\n    stamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// .....")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾æ‚²è§‚è¯»é”")]),s._v("\n        sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlockRead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä½¿ç”¨æ–¹æ³•å±€éƒ¨å˜é‡æ‰§è¡Œä¸šåŠ¡æ“ä½œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ......")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("StampedLock å†™æ¨¡æ¿:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" stamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™å…±äº«å˜é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ......")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlockWrite")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"_19-countdownlatchå’Œcyclicbarrier-å¦‚ä½•è®©å¤šçº¿ç¨‹æ­¥è°ƒä¸€è‡´"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_19-countdownlatchå’Œcyclicbarrier-å¦‚ä½•è®©å¤šçº¿ç¨‹æ­¥è°ƒä¸€è‡´"}},[s._v("#")]),s._v(" 19-CountDownLatchå’ŒCyclicBarrier:å¦‚ä½•è®©å¤šçº¿ç¨‹æ­¥è°ƒä¸€è‡´?")]),s._v(" "),t("p",[s._v("å‰å‡ å¤©è€æ¿çªç„¶åŒ†åŒ†å¿™å¿™è¿‡æ¥, è¯´å¯¹è´¦ç³»ç»Ÿæœ€è¿‘è¶Šæ¥è¶Šæ…¢äº†, èƒ½ä¸èƒ½å¿«é€Ÿä¼˜åŒ–ä¸€ä¸‹. æˆ‘äº†è§£äº†å¯¹è´¦ç³»ç»Ÿçš„ä¸šåŠ¡å, å‘ç°è¿˜æ˜¯æŒºç®€å•çš„, ç”¨æˆ·é€šè¿‡åœ¨çº¿å•†åŸä¸‹å•, ä¼šç”Ÿæˆç”µå­è®¢å•, ä¿å­˜åœ¨è®¢å•åº“; ä¹‹åç‰©æµä¼šç”Ÿæˆæ´¾é€å•ç»™ç”¨æˆ·å‘è´§, æ´¾é€å•ä¿å­˜åœ¨æ´¾é€å•åº“. ä¸ºäº†é˜²æ­¢æ¼æ´¾é€æˆ–è€…é‡å¤æ´¾é€, å¯¹è´¦ç³»ç»Ÿæ¯å¤©è¿˜ä¼šæ ¡éªŒæ˜¯å¦å­˜åœ¨å¼‚å¸¸è®¢å•.")]),s._v(" "),t("p",[s._v("å¯¹è´¦ç³»ç»Ÿçš„å¤„ç†é€»è¾‘å¾ˆç®€å•, å¯ä»¥å‚è€ƒä¸‹é¢çš„å¯¹è´¦ç³»ç»Ÿæµç¨‹å›¾. ç›®å‰å¯¹è´¦ç³»ç»Ÿçš„å¤„ç†é€»è¾‘æ˜¯"),t("strong",[s._v("é¦–å…ˆæŸ¥è¯¢è®¢å•, ç„¶åæŸ¥è¯¢æ´¾é€å•, ä¹‹åå¯¹æ¯”è®¢å•å’Œæ´¾é€å•, å°†å·®å¼‚å†™å…¥å·®å¼‚åº“")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6538041abca11f8ead4f8475614791f4-20230731162452-gsvk9gj.png",alt:"",title:"å¯¹è´¦ç³»ç»Ÿæµç¨‹å›¾"}})]),s._v(" "),t("p",[s._v("å¯¹è´¦ç³»ç»Ÿçš„ä»£ç æŠ½è±¡ä¹‹å, ä¹Ÿå¾ˆç®€å•, æ ¸å¿ƒä»£ç å¦‚ä¸‹, å°±æ˜¯åœ¨ä¸€ä¸ªå•çº¿ç¨‹é‡Œé¢å¾ªç¯æŸ¥è¯¢è®¢å•, æ´¾é€å•, ç„¶åæ‰§è¡Œå¯¹è´¦, æœ€åå°†å†™å…¥å·®å¼‚åº“.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("å­˜åœ¨æœªå¯¹è´¦è®¢å•"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æœªå¯¹è´¦è®¢å•")]),s._v("\n    pos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æ´¾é€å•")]),s._v("\n    dos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå¯¹è´¦æ“ä½œ")]),s._v("\n    diff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å·®å¼‚å†™å…¥å·®å¼‚åº“")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("diff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h5",{attrs:{id:"åˆ©ç”¨å¹¶è¡Œä¼˜åŒ–å¯¹è´¦ç³»ç»Ÿ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ©ç”¨å¹¶è¡Œä¼˜åŒ–å¯¹è´¦ç³»ç»Ÿ"}},[s._v("#")]),s._v(" åˆ©ç”¨å¹¶è¡Œä¼˜åŒ–å¯¹è´¦ç³»ç»Ÿ")]),s._v(" "),t("p",[s._v("è€æ¿è¦æˆ‘ä¼˜åŒ–æ€§èƒ½, é‚£å°±é¦–å…ˆè¦æ‰¾åˆ°è¿™ä¸ªå¯¹è´¦ç³»ç»Ÿçš„ç“¶é¢ˆæ‰€åœ¨.")]),s._v(" "),t("p",[s._v("ç›®å‰çš„å¯¹è´¦ç³»ç»Ÿ, ç”±äºè®¢å•é‡å’Œæ´¾é€å•é‡å·¨å¤§, æ‰€ä»¥æŸ¥è¯¢æœªå¯¹è´¦è®¢å• getPOrders() å’ŒæŸ¥è¯¢æ´¾é€å• getDOrders() ç›¸å¯¹è¾ƒæ…¢, é‚£æœ‰æ²¡æœ‰åŠæ³•å¿«é€Ÿä¼˜åŒ–ä¸€ä¸‹å‘¢? ç›®å‰å¯¹è´¦ç³»ç»Ÿæ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„, å›¾å½¢åŒ–åæ˜¯ä¸‹å›¾è¿™ä¸ªæ ·å­. å¯¹äºä¸²è¡ŒåŒ–çš„ç³»ç»Ÿ, ä¼˜åŒ–æ€§èƒ½é¦–å…ˆæƒ³åˆ°çš„æ˜¯èƒ½å¦"),t("strong",[s._v("åˆ©ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/88db20105d226f1ebac4dab19c5a412c-20230731162452-ku1jn1c.png",alt:"",title:"å¯¹è´¦ç³»ç»Ÿå•çº¿ç¨‹æ‰§è¡Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("æ‰€ä»¥, è¿™é‡Œåº”è¯¥èƒ½å¤Ÿçœ‹å‡ºæ¥è¿™ä¸ªå¯¹è´¦ç³»ç»Ÿé‡Œçš„ç“¶é¢ˆ: æŸ¥è¯¢æœªå¯¹è´¦è®¢å• getPOrders() å’ŒæŸ¥è¯¢æ´¾é€å• getDOrders() æ˜¯å¦å¯ä»¥å¹¶è¡Œå¤„ç†å‘¢? æ˜¾ç„¶æ˜¯å¯ä»¥çš„, å› ä¸º"),t("strong",[s._v("è¿™ä¸¤ä¸ªæ“ä½œå¹¶æ²¡æœ‰å…ˆåé¡ºåºçš„ä¾èµ–")]),s._v(". è¿™ä¸¤ä¸ªæœ€è€—æ—¶çš„æ“ä½œå¹¶è¡Œä¹‹å, æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º. å¯¹æ¯”ä¸€ä¸‹å•çº¿ç¨‹çš„æ‰§è¡Œç¤ºæ„å›¾, ä½ ä¼šå‘ç°åŒç­‰æ—¶é—´é‡Œ, å¹¶è¡Œæ‰§è¡Œçš„ååé‡è¿‘ä¹å•çº¿ç¨‹çš„ 2 å€, ä¼˜åŒ–æ•ˆæœè¿˜æ˜¯ç›¸å¯¹æ˜æ˜¾çš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d7ed4c233ea2025c83d6ba85189846b4-20230731162452-c9k7ie5.png",alt:"",title:"å¯¹è´¦ç³»ç»Ÿå¹¶è¡Œæ‰§è¡Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("æ€è·¯æœ‰äº†, ä¸‹é¢å†æ¥çœ‹çœ‹å¦‚ä½•ç”¨ä»£ç å®ç°. åœ¨ä¸‹é¢çš„ä»£ç ä¸­, åˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ T1 å’Œ T2, å¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢æœªå¯¹è´¦è®¢å• getPOrders() å’ŒæŸ¥è¯¢æ´¾é€å• getDOrders() è¿™ä¸¤ä¸ªæ“ä½œ. åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œå¯¹è´¦æ“ä½œ check() å’Œå·®å¼‚å†™å…¥ save() ä¸¤ä¸ªæ“ä½œ. ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯: "),t("strong",[s._v("ä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…çº¿ç¨‹ T1 å’Œ T2 æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œ check() å’Œ save() è¿™ä¸¤ä¸ªæ“ä½œ, ä¸ºæ­¤é€šè¿‡è°ƒç”¨ T1.join() å’Œ T2.join() æ¥å®ç°ç­‰å¾…, å½“ T1 å’Œ T2 çº¿ç¨‹é€€å‡ºæ—¶, è°ƒç”¨ T1.join() å’Œ T2.join() çš„ä¸»çº¿ç¨‹å°±ä¼šä»é˜»å¡æ€è¢«å”¤é†’, ä»è€Œæ‰§è¡Œä¹‹åçš„ check() å’Œ save()")]),s._v(" .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("å­˜åœ¨æœªå¯¹è´¦è®¢å•"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æœªå¯¹è´¦è®¢å•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        pos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æ´¾é€å•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        dos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾… T1, T2 ç»“æŸ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå¯¹è´¦æ“ä½œ")]),s._v("\n    diff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å·®å¼‚å†™å…¥å·®å¼‚åº“")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("diff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h5",{attrs:{id:"ç”¨countdownlatchå®ç°çº¿ç¨‹ç­‰å¾…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨countdownlatchå®ç°çº¿ç¨‹ç­‰å¾…"}},[s._v("#")]),s._v(" ç”¨CountDownLatchå®ç°çº¿ç¨‹ç­‰å¾…")]),s._v(" "),t("p",[s._v("ç»è¿‡ä¸Šé¢çš„ä¼˜åŒ–ä¹‹å, åŸºæœ¬ä¸Šå¯ä»¥è·Ÿè€æ¿æ±‡æŠ¥æ”¶å·¥äº†, ä½†è¿˜æ˜¯æœ‰ç‚¹ç¾ä¸­ä¸è¶³, ç›¸ä¿¡ä½ ä¹Ÿå‘ç°äº†, while å¾ªç¯é‡Œé¢æ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹, è€Œåˆ›å»ºçº¿ç¨‹å¯æ˜¯ä¸ªè€—æ—¶çš„æ“ä½œ. æ‰€ä»¥æœ€å¥½æ˜¯åˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹èƒ½å¤Ÿå¾ªç¯åˆ©ç”¨, ä¼°è®¡è¿™æ—¶ä½ å·²ç»æƒ³åˆ°çº¿ç¨‹æ± äº†, æ˜¯çš„, çº¿ç¨‹æ± å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("è€Œä¸‹é¢çš„ä»£ç å°±æ˜¯ç”¨çº¿ç¨‹æ± ä¼˜åŒ–åçš„: é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå›ºå®šå¤§å°ä¸º 2 çš„çº¿ç¨‹æ± , ä¹‹ååœ¨ while å¾ªç¯é‡Œé‡å¤åˆ©ç”¨. ä¸€åˆ‡çœ‹ä¸Šå»éƒ½å¾ˆé¡ºåˆ©, ä½†æ˜¯æœ‰ä¸ªé—®é¢˜å¥½åƒæ— è§£äº†, é‚£å°±æ˜¯ä¸»çº¿ç¨‹å¦‚ä½•çŸ¥é“ getPOrders() å’Œ getDOrders() è¿™ä¸¤ä¸ªæ“ä½œä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œ. å‰é¢ä¸»çº¿ç¨‹é€šè¿‡è°ƒç”¨çº¿ç¨‹ T1 å’Œ T2 çš„ join() æ–¹æ³•æ¥ç­‰å¾…çº¿ç¨‹ T1 å’Œ T2 é€€å‡º, ä½†æ˜¯åœ¨çº¿ç¨‹æ± çš„æ–¹æ¡ˆé‡Œ, çº¿ç¨‹æ ¹æœ¬å°±ä¸ä¼šé€€å‡º, æ‰€ä»¥ join() æ–¹æ³•å·²ç»å¤±æ•ˆäº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º 2 ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("å­˜åœ¨æœªå¯¹è´¦è®¢å•"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æœªå¯¹è´¦è®¢å•")]),s._v("\n    executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        pos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æ´¾é€å•")]),s._v("\n    executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        dos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* ? ? å¦‚ä½•å®ç°ç­‰å¾…? ? */")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå¯¹è´¦æ“ä½œ")]),s._v("\n    diff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å·®å¼‚å†™å…¥å·®å¼‚åº“")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("diff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("é‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢? å¯ä»¥å¼€åŠ¨è„‘ç­‹æƒ³å‡ºå¾ˆå¤šåŠæ³•, æœ€ç›´æ¥çš„åŠæ³•æ˜¯å¼„ä¸€ä¸ªè®¡æ•°å™¨, åˆå§‹å€¼è®¾ç½®æˆ 2, å½“æ‰§è¡Œå®Œ "),t("code",[s._v("pos = getPOrders();")]),s._v("â€‹è¿™ä¸ªæ“ä½œä¹‹åå°†è®¡æ•°å™¨å‡ 1, æ‰§è¡Œå®Œ "),t("code",[s._v("dos = getDOrders();")]),s._v("â€‹ ä¹‹åä¹Ÿå°†è®¡æ•°å™¨å‡ 1, åœ¨ä¸»çº¿ç¨‹é‡Œ, ç­‰å¾…è®¡æ•°å™¨ç­‰äº 0; å½“è®¡æ•°å™¨ç­‰äº 0 æ—¶, è¯´æ˜è¿™ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œæ‰§è¡Œå®Œäº†. ç­‰å¾…è®¡æ•°å™¨ç­‰äº 0 å…¶å®å°±æ˜¯ä¸€ä¸ªæ¡ä»¶å˜é‡, ç”¨ç®¡ç¨‹å®ç°èµ·æ¥ä¹Ÿå¾ˆç®€å•.")]),s._v(" "),t("p",[s._v("ä¸è¿‡å¹¶ä¸å»ºè®®åœ¨å®é™…é¡¹ç›®ä¸­å»å®ç°ä¸Šé¢çš„æ–¹æ¡ˆ, å› ä¸º Java å¹¶å‘åŒ…é‡Œå·²ç»æä¾›äº†å®ç°ç±»ä¼¼åŠŸèƒ½çš„å·¥å…·ç±»: "),t("strong",[s._v("CountDownLatch")]),s._v(", ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†. ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­, åœ¨ while å¾ªç¯é‡Œé¢, é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª CountDownLatch, è®¡æ•°å™¨çš„åˆå§‹å€¼ç­‰äº 2, ä¹‹ååœ¨ "),t("code",[s._v("pos = getPOrders();")]),s._v("â€‹ å’Œ "),t("code",[s._v("dos = getDOrders();")]),s._v("â€‹ ä¸¤æ¡è¯­å¥çš„åé¢å¯¹è®¡æ•°å™¨æ‰§è¡Œå‡ 1 æ“ä½œ, è¿™ä¸ªå¯¹è®¡æ•°å™¨å‡ 1 çš„æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨ "),t("code",[s._v("latch.countDown();")]),s._v("â€‹ æ¥å®ç°çš„. åœ¨ä¸»çº¿ç¨‹ä¸­, é€šè¿‡è°ƒç”¨ "),t("code",[s._v("latch.await()")]),s._v("â€‹ æ¥å®ç°å¯¹è®¡æ•°å™¨ç­‰äº 0 çš„ç­‰å¾….")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º 2 ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("å­˜åœ¨æœªå¯¹è´¦è®¢å•"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¡æ•°å™¨åˆå§‹åŒ–ä¸º 2")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CountDownLatch")]),s._v(" latch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CountDownLatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æœªå¯¹è´¦è®¢å•")]),s._v("\n    executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        pos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        latch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("countDown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢æ´¾é€å•")]),s._v("\n    executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        dos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        latch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("countDown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œç»“æŸ")]),s._v("\n    latch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå¯¹è´¦æ“ä½œ")]),s._v("\n    diff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å·®å¼‚å†™å…¥å·®å¼‚åº“")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("diff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h5",{attrs:{id:"è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½"}},[s._v("#")]),s._v(" è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½")]),s._v(" "),t("p",[s._v("ç»è¿‡ä¸Šé¢çš„é‡é‡ä¼˜åŒ–ä¹‹å, é•¿å‡ºä¸€å£æ°”, ç»ˆäºå¯ä»¥äº¤ä»˜äº†. ä¸è¿‡åœ¨äº¤ä»˜ä¹‹å‰è¿˜éœ€è¦å†æ¬¡å®¡è§†ä¸€ç•ª, çœ‹çœ‹è¿˜æœ‰æ²¡æœ‰ä¼˜åŒ–çš„ä½™åœ°, ä»”ç»†çœ‹è¿˜æ˜¯æœ‰çš„.")]),s._v(" "),t("p",[s._v("å‰é¢å°† getPOrders() å’Œ getDOrders() è¿™ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œå¹¶è¡Œäº†, ä½†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œå’Œå¯¹è´¦æ“ä½œ check(), save() ä¹‹é—´è¿˜æ˜¯"),t("strong",[s._v("ä¸²è¡Œ")]),s._v("çš„. å¾ˆæ˜¾ç„¶, è¿™ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œå’Œå¯¹è´¦æ“ä½œä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œçš„, ä¹Ÿå°±æ˜¯è¯´, åœ¨æ‰§è¡Œå¯¹è´¦æ“ä½œçš„æ—¶å€™, å¯ä»¥åŒæ—¶å»æ‰§è¡Œä¸‹ä¸€è½®çš„æŸ¥è¯¢æ“ä½œ, è¿™ä¸ªè¿‡ç¨‹å¯ä»¥å½¢è±¡åŒ–åœ°è¡¨è¿°ä¸ºä¸‹é¢è¿™å¹…ç¤ºæ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/18059955db59ee0af5c12dc2f29c1065-20230731162452-f5kqyyl.png",alt:"",title:"å®Œå…¨å¹¶è¡Œæ‰§è¡Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("é‚£æ¥ä¸‹æ¥å†æ¥æ€è€ƒä¸€ä¸‹å¦‚ä½•å®ç°è¿™æ­¥ä¼˜åŒ–, ä¸¤æ¬¡æŸ¥è¯¢æ“ä½œèƒ½å¤Ÿå’Œå¯¹è´¦æ“ä½œå¹¶è¡Œ, å¯¹è´¦æ“ä½œè¿˜ä¾èµ–æŸ¥è¯¢æ“ä½œçš„ç»“æœ, è¿™æ˜æ˜¾æœ‰ç‚¹ç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„æ„æ€, ä¸¤æ¬¡æŸ¥è¯¢æ“ä½œæ˜¯ç”Ÿäº§è€…, å¯¹è´¦æ“ä½œæ˜¯æ¶ˆè´¹è€…. æ—¢ç„¶æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹, é‚£"),t("strong",[s._v("å°±éœ€è¦æœ‰ä¸ªé˜Ÿåˆ—, æ¥ä¿å­˜ç”Ÿäº§è€…ç”Ÿäº§çš„æ•°æ®, è€Œæ¶ˆè´¹è€…åˆ™ä»è¿™ä¸ªé˜Ÿåˆ—æ¶ˆè´¹æ•°æ®")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸è¿‡é’ˆå¯¹å¯¹è´¦è¿™ä¸ªé¡¹ç›®, æˆ‘è®¾è®¡äº†ä¸¤ä¸ªé˜Ÿåˆ—, å¹¶ä¸”ä¸¤ä¸ªé˜Ÿåˆ—çš„å…ƒç´ ä¹‹é—´è¿˜æœ‰å¯¹åº”å…³ç³». å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤º, è®¢å•æŸ¥è¯¢æ“ä½œå°†è®¢å•æŸ¥è¯¢ç»“æœæ’å…¥è®¢å•é˜Ÿåˆ—, æ´¾é€å•æŸ¥è¯¢æ“ä½œå°†æ´¾é€å•æ’å…¥æ´¾é€å•é˜Ÿåˆ—, è¿™ä¸¤ä¸ªé˜Ÿåˆ—çš„å…ƒç´ ä¹‹é—´æ˜¯æœ‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»çš„. ä¸¤ä¸ªé˜Ÿåˆ—çš„å¥½å¤„æ˜¯, "),t("strong",[s._v("å¯¹è´¦æ“ä½œå¯ä»¥æ¯æ¬¡ä»è®¢å•é˜Ÿåˆ—å‡ºä¸€ä¸ªå…ƒç´ , ä»æ´¾é€å•é˜Ÿåˆ—å‡ºä¸€ä¸ªå…ƒç´ , ç„¶åå¯¹è¿™ä¸¤ä¸ªå…ƒç´ æ‰§è¡Œå¯¹è´¦æ“ä½œ, è¿™æ ·æ•°æ®ä¸€å®šä¸ä¼šä¹±æ‰")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/32c71b1a66b0b4fbf70c65e447b5d44e-20230731162452-p3qbrxc.png",alt:"",title:"åŒé˜Ÿåˆ—ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢å†æ¥çœ‹å¦‚ä½•ç”¨åŒé˜Ÿåˆ—æ¥å®ç°å®Œå…¨çš„å¹¶è¡Œ. ä¸€ä¸ªæœ€ç›´æ¥çš„æƒ³æ³•æ˜¯: ä¸€ä¸ªçº¿ç¨‹ T1 æ‰§è¡Œè®¢å•çš„æŸ¥è¯¢å·¥ä½œ, ä¸€ä¸ªçº¿ç¨‹ T2 æ‰§è¡Œæ´¾é€å•çš„æŸ¥è¯¢å·¥ä½œ, å½“çº¿ç¨‹ T1 å’Œ T2 éƒ½å„è‡ªç”Ÿäº§å®Œ 1 æ¡æ•°æ®çš„æ—¶å€™, é€šçŸ¥çº¿ç¨‹ T3 æ‰§è¡Œå¯¹è´¦æ“ä½œ. è¿™ä¸ªæƒ³æ³•è™½çœ‹ä¸Šå»ç®€å•, ä½†å…¶å®è¿˜éšè—ç€ä¸€ä¸ªæ¡ä»¶, é‚£å°±æ˜¯çº¿ç¨‹ T1 å’Œçº¿ç¨‹ T2 çš„å·¥ä½œè¦æ­¥è°ƒä¸€è‡´, ä¸èƒ½ä¸€ä¸ªè·‘å¾—å¤ªå¿«, ä¸€ä¸ªè·‘å¾—å¤ªæ…¢, åªæœ‰è¿™æ ·æ‰èƒ½åšåˆ°å„è‡ªç”Ÿäº§å®Œ 1 æ¡æ•°æ®çš„æ—¶å€™, é€šçŸ¥çº¿ç¨‹ T3.")]),s._v(" "),t("p",[s._v("ä¸‹é¢è¿™å¹…å›¾å½¢è±¡åœ°æè¿°äº†ä¸Šé¢çš„æ„å›¾: çº¿ç¨‹ T1 å’Œçº¿ç¨‹ T2 åªæœ‰éƒ½ç”Ÿäº§å®Œ 1 æ¡æ•°æ®çš„æ—¶å€™, æ‰èƒ½ä¸€èµ·å‘ä¸‹æ‰§è¡Œ, ä¹Ÿå°±æ˜¯è¯´, çº¿ç¨‹ T1 å’Œçº¿ç¨‹ T2 è¦äº’ç›¸ç­‰å¾…, æ­¥è°ƒè¦ä¸€è‡´; åŒæ—¶å½“çº¿ç¨‹ T1 å’Œ T2 éƒ½ç”Ÿäº§å®Œä¸€æ¡æ•°æ®çš„æ—¶å€™, è¿˜è¦èƒ½å¤Ÿé€šçŸ¥çº¿ç¨‹ T3 æ‰§è¡Œå¯¹è´¦æ“ä½œ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5d6b4f8132cca40ccea1b941f2bc0bcc-20230731162452-lua82p5.png",alt:"",title:"åŒæ­¥æ‰§è¡Œç¤ºæ„å›¾"}})]),s._v(" "),t("h5",{attrs:{id:"ç”¨cyclicbarrierå®ç°çº¿ç¨‹åŒæ­¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨cyclicbarrierå®ç°çº¿ç¨‹åŒæ­¥"}},[s._v("#")]),s._v(" ç”¨CyclicBarrierå®ç°çº¿ç¨‹åŒæ­¥")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ¥å®ç°ä¸Šé¢æåˆ°çš„æ–¹æ¡ˆ. è¿™ä¸ªæ–¹æ¡ˆçš„éš¾ç‚¹æœ‰ä¸¤ä¸ª: "),t("strong",[s._v("ä¸€ä¸ªæ˜¯çº¿ç¨‹ T1 å’Œ T2 è¦åšåˆ°æ­¥è°ƒä¸€è‡´, å¦ä¸€ä¸ªæ˜¯è¦èƒ½å¤Ÿé€šçŸ¥åˆ°çº¿ç¨‹ T3")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¾ç„¶å¯ä»¥åˆ©ç”¨ä¸€ä¸ªè®¡æ•°å™¨æ¥è§£å†³è¿™ä¸¤ä¸ªéš¾ç‚¹, è®¡æ•°å™¨åˆå§‹åŒ–ä¸º 2, çº¿ç¨‹ T1 å’Œ T2 ç”Ÿäº§å®Œä¸€æ¡æ•°æ®éƒ½å°†è®¡æ•°å™¨å‡ 1, å¦‚æœè®¡æ•°å™¨å¤§äº 0 åˆ™çº¿ç¨‹ T1 æˆ–è€… T2 ç­‰å¾…. å¦‚æœè®¡æ•°å™¨ç­‰äº 0, åˆ™é€šçŸ¥çº¿ç¨‹ T3, å¹¶å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ T1 æˆ–è€… T2, ä¸æ­¤åŒæ—¶å°†è®¡æ•°å™¨é‡ç½®ä¸º 2, è¿™æ ·çº¿ç¨‹ T1 å’Œçº¿ç¨‹ T2 ç”Ÿäº§ä¸‹ä¸€æ¡æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç»§ç»­ä½¿ç”¨è¿™ä¸ªè®¡æ•°å™¨äº†.")]),s._v(" "),t("p",[s._v("åŒæ ·, è¿˜æ˜¯å»ºè®®ä¸è¦åœ¨å®é™…é¡¹ç›®ä¸­è¿™ä¹ˆåš, å› ä¸º Java å¹¶å‘åŒ…é‡Œä¹Ÿå·²ç»æä¾›äº†ç›¸å…³çš„å·¥å…·ç±»: "),t("strong",[s._v("CyclicBarrier")]),s._v(". åœ¨ä¸‹é¢çš„ä»£ç ä¸­, é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªè®¡æ•°å™¨åˆå§‹å€¼ä¸º 2 çš„ CyclicBarrier, éœ€è¦æ³¨æ„çš„æ˜¯åˆ›å»º CyclicBarrier çš„æ—¶å€™, "),t("strong",[s._v("è¿˜ä¼ å…¥äº†ä¸€ä¸ªå›è°ƒå‡½æ•°, å½“è®¡æ•°å™¨å‡åˆ° 0 çš„æ—¶å€™, ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°")]),s._v(".")]),s._v(" "),t("p",[s._v("çº¿ç¨‹ T1 è´Ÿè´£æŸ¥è¯¢è®¢å•, å½“æŸ¥å‡ºä¸€æ¡æ—¶, è°ƒç”¨ "),t("code",[s._v("barrier.await()")]),s._v("â€‹ æ¥å°†è®¡æ•°å™¨å‡ 1, åŒæ—¶ç­‰å¾…è®¡æ•°å™¨å˜æˆ 0; çº¿ç¨‹ T2 è´Ÿè´£æŸ¥è¯¢æ´¾é€å•, å½“æŸ¥å‡ºä¸€æ¡æ—¶, ä¹Ÿè°ƒç”¨ "),t("code",[s._v("barrier.await()")]),s._v("â€‹ æ¥å°†è®¡æ•°å™¨å‡ 1, åŒæ—¶ç­‰å¾…è®¡æ•°å™¨å˜æˆ 0; å½“ T1 å’Œ T2 éƒ½è°ƒç”¨ "),t("code",[s._v("barrier.await()")]),s._v("â€‹ çš„æ—¶å€™, è®¡æ•°å™¨ä¼šå‡åˆ° 0, æ­¤æ—¶ T1 å’Œ T2 å°±å¯ä»¥æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥äº†, åŒæ—¶ä¼šè°ƒç”¨ barrier çš„"),t("strong",[s._v("å›è°ƒå‡½æ•°")]),s._v("æ¥æ‰§è¡Œå¯¹è´¦æ“ä½œ.")]),s._v(" "),t("p",[s._v("éå¸¸å€¼å¾—ä¸€æçš„æ˜¯, CyclicBarrier çš„"),t("strong",[s._v("è®¡æ•°å™¨æœ‰è‡ªåŠ¨é‡ç½®")]),s._v("çš„åŠŸèƒ½, å½“å‡åˆ° 0 çš„æ—¶å€™, ä¼šè‡ªåŠ¨é‡ç½®è®¾ç½®çš„åˆå§‹å€¼. è¿™ä¸ªåŠŸèƒ½ç”¨èµ·æ¥å®åœ¨æ˜¯å¤ªæ–¹ä¾¿äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¢å•é˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vector")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("P")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" pos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ´¾é€å•é˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vector")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" dos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå›è°ƒçš„çº¿ç¨‹æ±  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CyclicBarrier")]),s._v(" barrier "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CyclicBarrier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" check "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("P")]),s._v(" p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("D")]),s._v(" d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå¯¹è´¦æ“ä½œ")]),s._v("\n    diff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å·®å¼‚å†™å…¥å·®å¼‚åº“")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("diff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" checkAll "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¾ªç¯æŸ¥è¯¢è®¢å•åº“")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("å­˜åœ¨æœªå¯¹è´¦è®¢å•"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢è®¢å•åº“")]),s._v("\n            pos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…")]),s._v("\n            barrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¾ªç¯æŸ¥è¯¢è¿å•åº“")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("å­˜åœ¨æœªå¯¹è´¦è®¢å•"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢è¿å•åº“")]),s._v("\n            dos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDOrders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…")]),s._v("\n            barrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-13"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-13"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("CountDownLatch å’Œ CyclicBarrier æ˜¯ Java å¹¶å‘åŒ…æä¾›çš„ä¸¤ä¸ªéå¸¸æ˜“ç”¨çš„çº¿ç¨‹åŒæ­¥å·¥å…·ç±», è¿™ä¸¤ä¸ªå·¥å…·ç±»ç”¨æ³•çš„åŒºåˆ«åœ¨è¿™é‡Œè¿˜æ˜¯æœ‰å¿…è¦å†å¼ºè°ƒä¸€ä¸‹: "),t("mark",[t("strong",[s._v("CountDownLatch ä¸»è¦ç”¨æ¥è§£å†³ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„åœºæ™¯")])]),s._v(", å¯ä»¥ç±»æ¯”æ—…æ¸¸å›¢å›¢é•¿è¦ç­‰å¾…æ‰€æœ‰çš„æ¸¸å®¢åˆ°é½æ‰èƒ½å»ä¸‹ä¸€ä¸ªæ™¯ç‚¹; è€Œ "),t("mark",[t("strong",[s._v("CyclicBarrier æ˜¯ä¸€ç»„çº¿ç¨‹ä¹‹é—´äº’ç›¸ç­‰å¾…")])]),s._v(", æ›´åƒæ˜¯å‡ ä¸ªé©´å‹ä¹‹é—´ä¸ç¦»ä¸å¼ƒ. é™¤æ­¤ä¹‹å¤– CountDownLatch çš„è®¡æ•°å™¨æ˜¯ä¸èƒ½å¾ªç¯åˆ©ç”¨çš„, ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦è®¡æ•°å™¨å‡åˆ° 0, å†æœ‰çº¿ç¨‹è°ƒç”¨ await(), è¯¥çº¿ç¨‹ä¼šç›´æ¥é€šè¿‡. ä½† "),t("strong",[s._v("CyclicBarrier çš„è®¡æ•°å™¨æ˜¯å¯ä»¥å¾ªç¯åˆ©ç”¨çš„")]),s._v(", è€Œä¸”å…·å¤‡è‡ªåŠ¨é‡ç½®çš„åŠŸèƒ½, ä¸€æ—¦è®¡æ•°å™¨å‡åˆ° 0 ä¼šè‡ªåŠ¨é‡ç½®åˆ°è®¾ç½®çš„åˆå§‹å€¼. é™¤æ­¤ä¹‹å¤–, CyclicBarrier è¿˜å¯ä»¥è®¾ç½®"),t("strong",[s._v("å›è°ƒå‡½æ•°")]),s._v(", å¯ä»¥è¯´æ˜¯åŠŸèƒ½ä¸°å¯Œ.")]),s._v(" "),t("h4",{attrs:{id:"_20-å¹¶å‘å®¹å™¨-éƒ½æœ‰å“ªäº›-å‘-éœ€è¦æˆ‘ä»¬å¡«"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_20-å¹¶å‘å®¹å™¨-éƒ½æœ‰å“ªäº›-å‘-éœ€è¦æˆ‘ä»¬å¡«"}},[s._v("#")]),s._v(' 20-å¹¶å‘å®¹å™¨:éƒ½æœ‰å“ªäº›"å‘"éœ€è¦æˆ‘ä»¬å¡«?')]),s._v(" "),t("p",[s._v("Java å¹¶å‘åŒ…æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†å†…å®¹éƒ½æ˜¯å…³äº"),t("strong",[s._v("å¹¶å‘å®¹å™¨")]),s._v("çš„, å› æ­¤å­¦ä¹ å’Œææ‡‚è¿™éƒ¨åˆ†çš„å†…å®¹å¾ˆæœ‰å¿…è¦.")]),s._v(" "),t("p",[s._v("Java 1.5 ä¹‹å‰æä¾›çš„"),t("strong",[s._v("åŒæ­¥å®¹å™¨")]),s._v("è™½ç„¶ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨, ä½†æ˜¯æ€§èƒ½å¾ˆå·®, è€Œ Java 1.5 ç‰ˆæœ¬ä¹‹åæä¾›çš„å¹¶å‘å®¹å™¨åœ¨æ€§èƒ½æ–¹é¢åˆ™åšäº†å¾ˆå¤šä¼˜åŒ–, å¹¶ä¸”å®¹å™¨çš„ç±»å‹ä¹Ÿæ›´åŠ ä¸°å¯Œäº†. ä¸‹é¢å°±å¯¹æ¯”äºŒè€…æ¥å­¦ä¹ è¿™éƒ¨åˆ†çš„å†…å®¹.")]),s._v(" "),t("h5",{attrs:{id:"åŒæ­¥å®¹å™¨åŠå…¶æ³¨æ„äº‹é¡¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŒæ­¥å®¹å™¨åŠå…¶æ³¨æ„äº‹é¡¹"}},[s._v("#")]),s._v(" åŒæ­¥å®¹å™¨åŠå…¶æ³¨æ„äº‹é¡¹")]),s._v(" "),t("p",[s._v("Java ä¸­çš„å®¹å™¨ä¸»è¦å¯ä»¥åˆ†ä¸ºå››ä¸ªå¤§ç±», åˆ†åˆ«æ˜¯ List, Map, Set å’Œ Queue, ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„ Java å®¹å™¨éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„. ä¾‹å¦‚å¸¸ç”¨çš„ ArrayList, HashMap å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„. åœ¨ä»‹ç»çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ä¹‹å‰, å…ˆæ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜: "),t("strong",[s._v("å¦‚ä½•å°†éçº¿ç¨‹å®‰å…¨çš„å®¹å™¨å˜æˆçº¿ç¨‹å®‰å…¨çš„å®¹å™¨")]),s._v("?")]),s._v(" "),t("p",[s._v("å‰é¢è®²è¿‡å®ç°æ€è·¯å…¶å®å¾ˆç®€å•, åªè¦æŠŠéçº¿ç¨‹å®‰å…¨çš„å®¹å™¨å°è£…åœ¨å¯¹è±¡å†…éƒ¨, ç„¶åæ§åˆ¶å¥½è®¿é—®è·¯å¾„å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±ä»¥ ArrayList ä¸ºä¾‹, çœ‹çœ‹å¦‚ä½•å°†å®ƒå˜æˆçº¿ç¨‹å®‰å…¨çš„. åœ¨ä¸‹é¢çš„ä»£ç ä¸­, SafeArrayList å†…éƒ¨æŒæœ‰ä¸€ä¸ª ArrayList çš„å®ä¾‹ c, æ‰€æœ‰è®¿é—® c çš„æ–¹æ³•éƒ½å¢åŠ äº† synchronized å…³é”®å­—, éœ€è¦æ³¨æ„çš„æ˜¯è¿˜å¢åŠ äº†ä¸€ä¸ª addIfNotExist() æ–¹æ³•, è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç”¨ synchronized æ¥ä¿è¯åŸå­æ€§çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°è£… ArrayList")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ§åˆ¶è®¿é—®è·¯å¾„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" idx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("idx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" idx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("idx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addIfNotExist")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("çœ‹åˆ°è¿™é‡Œ, ä½ å¯èƒ½ä¼šä¸¾ä¸€åä¸‰, ç„¶åæƒ³åˆ°: æ‰€æœ‰éçº¿ç¨‹å®‰å…¨çš„ç±»æ˜¯ä¸æ˜¯éƒ½å¯ä»¥ç”¨è¿™ç§åŒ…è£…çš„æ–¹å¼æ¥å®ç°çº¿ç¨‹å®‰å…¨å‘¢? å…¶å®è¿™ä¸€ç‚¹ä¸æ­¢ä½ æƒ³åˆ°äº†, Java SDK çš„å¼€å‘äººå‘˜ä¹Ÿæƒ³åˆ°äº†, æ‰€ä»¥ä»–ä»¬åœ¨ Collections è¿™ä¸ªç±»ä¸­è¿˜æä¾›äº†ä¸€å¥—å®Œå¤‡çš„åŒ…è£…ç±», æ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, åˆ†åˆ«æŠŠ ArrayList, HashSet å’Œ HashMap åŒ…è£…æˆäº†çº¿ç¨‹å®‰å…¨çš„ List, Set å’Œ Map.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),s._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("synchronizedList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),s._v(" set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("synchronizedSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),s._v(" map "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("synchronizedMap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("æˆ‘ä»¬æ›¾ç»å¤šæ¬¡å¼ºè°ƒ, "),t("mark",[t("strong",[s._v("ç»„åˆæ“ä½œéœ€è¦æ³¨æ„ç«æ€æ¡ä»¶é—®é¢˜")])]),s._v(", ä¾‹å¦‚ä¸Šé¢æåˆ°çš„ addIfNotExist() æ–¹æ³•å°±åŒ…å«ç»„åˆæ“ä½œ. ç»„åˆæ“ä½œå¾€å¾€éšè—ç€ç«æ€æ¡ä»¶é—®é¢˜, "),t("strong",[s._v("å³ä¾¿æ¯ä¸ªæ“ä½œéƒ½èƒ½ä¿è¯åŸå­æ€§, ä¹Ÿå¹¶ä¸èƒ½ä¿è¯ç»„åˆæ“ä½œçš„åŸå­æ€§")]),s._v(", è¿™ä¸ªä¸€å®šè¦æ³¨æ„.")]),s._v(" "),t("p",[s._v("åœ¨å®¹å™¨é¢†åŸŸ"),t("strong",[s._v('ä¸€ä¸ªå®¹æ˜“è¢«å¿½è§†çš„ "å‘" æ˜¯ç”¨è¿­ä»£å™¨éå†å®¹å™¨')]),s._v(", ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­, é€šè¿‡è¿­ä»£å™¨éå†å®¹å™¨ list, å¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨ foo() æ–¹æ³•, è¿™å°±"),t("strong",[s._v("å­˜åœ¨å¹¶å‘é—®é¢˜, è¿™äº›ç»„åˆçš„æ“ä½œä¸å…·å¤‡åŸå­æ€§")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),s._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("synchronizedList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iterator")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("iterator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("è€Œæ­£ç¡®åšæ³•æ˜¯ä¸‹é¢è¿™æ ·, "),t("strong",[s._v("é”ä½ list ä¹‹åå†æ‰§è¡Œéå†æ“ä½œ")]),s._v(". å¦‚æœæŸ¥çœ‹ Collections å†…éƒ¨çš„åŒ…è£…ç±»æºç , å°±ä¼šå‘ç°åŒ…è£…ç±»çš„"),t("strong",[s._v("å…¬å…±æ–¹æ³•é”çš„æ˜¯å¯¹è±¡çš„ this, å…¶å®å°±æ˜¯è¿™é‡Œçš„ list, æ‰€ä»¥é”ä½ list ç»å¯¹æ˜¯çº¿ç¨‹å®‰å…¨çš„")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),s._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("synchronizedList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iterator")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("iterator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("ä¸Šé¢æåˆ°çš„è¿™äº›ç»è¿‡åŒ…è£…åçº¿ç¨‹å®‰å…¨å®¹å™¨, éƒ½æ˜¯"),t("strong",[s._v("åŸºäº synchronized è¿™ä¸ªåŒæ­¥å…³é”®å­—å®ç°")]),s._v("çš„, æ‰€ä»¥ä¹Ÿè¢«ç§°ä¸º"),t("strong",[s._v("åŒæ­¥å®¹å™¨")]),s._v(". Java æä¾›çš„åŒæ­¥å®¹å™¨è¿˜æœ‰ Vector, Stack å’Œ Hashtable, è¿™ä¸‰ä¸ªå®¹å™¨ä¸æ˜¯åŸºäºåŒ…è£…ç±»å®ç°çš„, ä½†åŒæ ·æ˜¯åŸºäº synchronized å®ç°çš„, å¯¹è¿™ä¸‰ä¸ªå®¹å™¨çš„éå†, åŒæ ·è¦åŠ é”ä¿è¯äº’æ–¥.")]),s._v(" "),t("h5",{attrs:{id:"å¹¶å‘å®¹å™¨åŠå…¶æ³¨æ„äº‹é¡¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹¶å‘å®¹å™¨åŠå…¶æ³¨æ„äº‹é¡¹"}},[s._v("#")]),s._v(" å¹¶å‘å®¹å™¨åŠå…¶æ³¨æ„äº‹é¡¹")]),s._v(" "),t("p",[s._v("Java åœ¨ 1.5 ç‰ˆæœ¬ä¹‹å‰æ‰€è°“çš„çº¿ç¨‹å®‰å…¨çš„å®¹å™¨, ä¸»è¦æŒ‡çš„å°±æ˜¯"),t("strong",[s._v("åŒæ­¥å®¹å™¨")]),s._v(". ä¸è¿‡åŒæ­¥å®¹å™¨æœ‰ä¸ªæœ€å¤§çš„é—®é¢˜, é‚£å°±æ˜¯"),t("strong",[s._v("æ€§èƒ½å·®")]),s._v(", æ‰€æœ‰æ–¹æ³•éƒ½ç”¨ synchronized æ¥ä¿è¯äº’æ–¥, ä¸²è¡Œåº¦å¤ªé«˜äº†. å› æ­¤ Java åœ¨ 1.5 åŠä¹‹åç‰ˆæœ¬æä¾›äº†æ€§èƒ½æ›´é«˜çš„å®¹å™¨, ä¸€èˆ¬ç§°ä¸º"),t("strong",[s._v("å¹¶å‘å®¹å™¨")]),s._v(".")]),s._v(" "),t("p",[s._v("å¹¶å‘å®¹å™¨è™½ç„¶æ•°é‡éå¸¸å¤š, ä½†ä¾ç„¶æ˜¯å‰é¢æåˆ°çš„å››å¤§ç±»: "),t("strong",[s._v("List, Map, Set å’Œ Queue")]),s._v(", ä¸‹é¢çš„å¹¶å‘å®¹å™¨å…³ç³»å›¾, åŸºæœ¬ä¸ŠæŠŠç»å¸¸ç”¨çš„å®¹å™¨éƒ½è¦†ç›–åˆ°äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/fe5edf1b8ed5c52011638c4a9208d7bf-20230731162452-z4x18y7.png",alt:"",title:"å¹¶å‘å®¹å™¨å…³ç³»å›¾"}})]),s._v(" "),t("p",[s._v("é‰´äºå¹¶å‘å®¹å™¨çš„æ•°é‡å¤ªå¤š, å†åŠ ä¸Šç¯‡å¹…é™åˆ¶, æ‰€ä»¥å¹¶ä¸ä¼šä¸€ä¸€è¯¦ç»†ä»‹ç»å®ƒä»¬çš„ç”¨æ³•, åªæ˜¯æŠŠå…³é”®ç‚¹ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),t("h6",{attrs:{id:"_1-list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-list"}},[s._v("#")]),s._v(" (1)List")]),s._v(" "),t("p",[s._v("List é‡Œé¢åªæœ‰ä¸€ä¸ªå®ç°ç±»å°±æ˜¯ "),t("strong",[s._v("CopyOnWriteArrayList")]),s._v(". CopyOnWrite, é¡¾åæ€ä¹‰å°±æ˜¯"),t("strong",[s._v("å†™çš„æ—¶å€™ä¼šå°†å…±äº«å˜é‡æ–°å¤åˆ¶ä¸€ä»½å‡ºæ¥, è¿™æ ·åšçš„å¥½å¤„æ˜¯è¯»æ“ä½œå®Œå…¨æ— é”")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ CopyOnWriteArrayList çš„å®ç°åŸç†æ˜¯æ€æ ·çš„å‘¢? ä¸‹é¢å°±æ¥ç®€å•ä»‹ç»ä¸€ä¸‹")]),s._v(" "),t("p",[t("strong",[s._v("CopyOnWriteArrayList å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªæ•°ç»„, æˆå‘˜å˜é‡ array å°±æŒ‡å‘è¿™ä¸ªå†…éƒ¨æ•°ç»„, æ‰€æœ‰çš„è¯»æ“ä½œéƒ½æ˜¯åŸºäº array è¿›è¡Œçš„, å¦‚ä¸‹å›¾æ‰€ç¤º, è¿­ä»£å™¨ Iterator éå†çš„å°±æ˜¯ array æ•°ç»„.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f321d4e4ea86f156a204a3a8c2ec0c5a-20230731162452-edx9gja.png",alt:"",title:"æ‰§è¡Œè¿­ä»£çš„å†…éƒ¨ç»“æ„å›¾"}})]),s._v(" "),t("p",[s._v("å¦‚æœåœ¨éå† array çš„åŒæ—¶, è¿˜æœ‰ä¸€ä¸ª"),t("strong",[s._v("å†™æ“ä½œ")]),s._v(", ä¾‹å¦‚å¢åŠ å…ƒç´ , CopyOnWriteArrayList æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢? "),t("strong",[s._v("CopyOnWriteArrayList ä¼šå°† array å¤åˆ¶ä¸€ä»½, ç„¶ååœ¨æ–°å¤åˆ¶å¤„ç†çš„æ•°ç»„ä¸Šæ‰§è¡Œå¢åŠ å…ƒç´ çš„æ“ä½œ, æ‰§è¡Œå®Œä¹‹åå†å°† array æŒ‡å‘è¿™ä¸ªæ–°çš„æ•°ç»„")]),s._v(". é€šè¿‡ä¸‹å›¾å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("è¯»å†™æ˜¯å¯ä»¥å¹¶è¡Œçš„, éå†æ“ä½œä¸€ç›´éƒ½æ˜¯åŸºäºåŸ array æ‰§è¡Œ, è€Œå†™æ“ä½œåˆ™æ˜¯åŸºäºæ–° array è¿›è¡Œ")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b5742b9895972d72e423147803259e4e-20230731162452-24mzbx2.png",alt:"",title:"æ‰§è¡Œå¢åŠ å…ƒç´ çš„å†…éƒ¨ç»“æ„å›¾"}})]),s._v(" "),t("p",[s._v('ä½¿ç”¨ CopyOnWriteArrayList éœ€è¦æ³¨æ„çš„ "å‘" ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢. ä¸€ä¸ªæ˜¯åº”ç”¨åœºæ™¯, '),t("strong",[s._v("CopyOnWriteArrayList ä»…é€‚ç”¨äºå†™æ“ä½œéå¸¸å°‘çš„åœºæ™¯, è€Œä¸”èƒ½å¤Ÿå®¹å¿è¯»å†™çš„çŸ­æš‚ä¸ä¸€è‡´")]),s._v(". ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­, å†™å…¥çš„æ–°å…ƒç´ å¹¶ä¸èƒ½ç«‹åˆ»è¢«éå†åˆ°. å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯, "),t("strong",[s._v("CopyOnWriteArrayList è¿­ä»£å™¨æ˜¯åªè¯»çš„, ä¸æ”¯æŒå¢åˆ æ”¹")]),s._v(". å› ä¸ºè¿­ä»£å™¨éå†çš„ä»…ä»…æ˜¯ä¸€ä¸ª"),t("strong",[s._v("å¿«ç…§")]),s._v(", è€Œå¯¹å¿«ç…§è¿›è¡Œå¢åˆ æ”¹æ˜¯æ²¡æœ‰æ„ä¹‰çš„.")]),s._v(" "),t("h6",{attrs:{id:"_2-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-map"}},[s._v("#")]),s._v(" (2)Map")]),s._v(" "),t("p",[s._v("Map æ¥å£çš„ä¸¤ä¸ªå®ç°æ˜¯ "),t("strong",[s._v("ConcurrentHashMap å’Œ ConcurrentSkipListMap")]),s._v(", å®ƒä»¬ä»åº”ç”¨çš„è§’åº¦æ¥çœ‹, ä¸»è¦åŒºåˆ«åœ¨äº "),t("strong",[s._v("ConcurrentHashMap çš„ key æ˜¯æ— åºçš„, è€Œ ConcurrentSkipListMap çš„ key æ˜¯æœ‰åºçš„")]),s._v(". æ‰€ä»¥å¦‚æœéœ€è¦ä¿è¯ key çš„é¡ºåº, å°±åªèƒ½ä½¿ç”¨ ConcurrentSkipListMap.")]),s._v(" "),t("p",[s._v("ä½¿ç”¨ ConcurrentHashMap å’Œ ConcurrentSkipListMap éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯, å®ƒä»¬çš„ key å’Œ value éƒ½ä¸èƒ½ä¸ºç©º, å¦åˆ™ä¼šæŠ›å‡º "),t("code",[s._v("NullPointerException")]),s._v("â€‹. ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº† Map ç›¸å…³çš„å®ç°ç±»å¯¹äº key å’Œ value çš„è¦æ±‚, å¯ä»¥å¯¹æ¯”å­¦ä¹ .")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0cdabf41d8b79bc967a06fd5d1a098db-20230731162452-njzs6r6.png",alt:""}})]),s._v(" "),t("p",[s._v('ConcurrentSkipListMap é‡Œé¢çš„ SkipList æœ¬èº«å°±æ˜¯ä¸€ç§æ•°æ®ç»“æ„, ä¸­æ–‡ä¸€èˆ¬éƒ½ç¿»è¯‘ä¸º "è·³è¡¨". è·³è¡¨æ’å…¥, åˆ é™¤, æŸ¥è¯¢æ“ä½œå¹³å‡çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(log n), ç†è®ºä¸Šå’Œå¹¶å‘çº¿ç¨‹æ•°æ²¡æœ‰å…³ç³», æ‰€ä»¥åœ¨å¹¶å‘åº¦éå¸¸é«˜çš„æƒ…å†µä¸‹, è‹¥å¯¹ ConcurrentHashMap çš„æ€§èƒ½è¿˜ä¸æ»¡æ„, å¯ä»¥å°è¯•ä¸€ä¸‹ ConcurrentSkipListMap.')]),s._v(" "),t("h6",{attrs:{id:"_3-set"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-set"}},[s._v("#")]),s._v(" (3)Set")]),s._v(" "),t("p",[s._v("Set æ¥å£çš„ä¸¤ä¸ªå®ç°æ˜¯ "),t("strong",[s._v("CopyOnWriteArraySet å’Œ ConcurrentSkipListSet")]),s._v(", ä½¿ç”¨åœºæ™¯å¯ä»¥å‚è€ƒå‰é¢è®²è¿°çš„ CopyOnWriteArrayList å’Œ ConcurrentSkipListMap, å®ƒä»¬çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„, è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†.")]),s._v(" "),t("h6",{attrs:{id:"_4-queue"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-queue"}},[s._v("#")]),s._v(" (4)Queue")]),s._v(" "),t("p",[s._v("Java å¹¶å‘åŒ…é‡Œé¢ Queue è¿™ç±»å¹¶å‘å®¹å™¨æ˜¯æœ€å¤æ‚çš„, å¯ä»¥ä»ä»¥ä¸‹ä¸¤ä¸ªç»´åº¦æ¥åˆ†ç±». ä¸€ä¸ªç»´åº¦æ˜¯"),t("strong",[s._v("é˜»å¡ä¸éé˜»å¡")]),s._v(", æ‰€è°“é˜»å¡æŒ‡çš„æ˜¯å½“é˜Ÿåˆ—å·²æ»¡æ—¶, å…¥é˜Ÿæ“ä½œé˜»å¡; å½“é˜Ÿåˆ—å·²ç©ºæ—¶, å‡ºé˜Ÿæ“ä½œé˜»å¡. å¦ä¸€ä¸ªç»´åº¦æ˜¯"),t("strong",[s._v("å•ç«¯ä¸åŒç«¯")]),s._v(", å•ç«¯æŒ‡çš„æ˜¯åªèƒ½é˜Ÿå°¾å…¥é˜Ÿ, é˜Ÿé¦–å‡ºé˜Ÿ; è€ŒåŒç«¯æŒ‡çš„æ˜¯é˜Ÿé¦–é˜Ÿå°¾çš†å¯å…¥é˜Ÿå‡ºé˜Ÿ. Java å¹¶å‘åŒ…é‡Œ"),t("mark",[t("strong",[s._v("é˜»å¡é˜Ÿåˆ—éƒ½ç”¨ Blocking å…³é”®å­—æ ‡è¯†, å•ç«¯é˜Ÿåˆ—ä½¿ç”¨ Queue æ ‡è¯†, åŒç«¯é˜Ÿåˆ—ä½¿ç”¨ Deque æ ‡è¯†")])]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸¤ä¸ªç»´åº¦ç»„åˆå, å¯ä»¥å°† Queue ç»†åˆ†ä¸ºå››å¤§ç±», åˆ†åˆ«æ˜¯:")]),s._v(" "),t("p",[t("strong",[s._v("å•ç«¯é˜»å¡é˜Ÿåˆ—")]),s._v(": å…¶å®ç°æœ‰ "),t("strong",[s._v("ArrayBlockingQueue, LinkedBlockingQueue, SynchronousQueue, LinkedTransferQueue, PriorityBlockingQueue å’Œ DelayQueue")]),s._v(". å†…éƒ¨ä¸€èˆ¬ä¼šæŒæœ‰ä¸€ä¸ªé˜Ÿåˆ—, è¿™ä¸ªé˜Ÿåˆ—å¯ä»¥æ˜¯"),t("strong",[s._v("æ•°ç»„")]),s._v("(å…¶å®ç°æ˜¯ ArrayBlockingQueue) ä¹Ÿå¯ä»¥æ˜¯"),t("strong",[s._v("é“¾è¡¨")]),s._v("(å…¶å®ç°æ˜¯ LinkedBlockingQueue); ç”šè‡³è¿˜å¯ä»¥ä¸æŒæœ‰é˜Ÿåˆ—(å…¶å®ç°æ˜¯ SynchronousQueue), æ­¤æ—¶ç”Ÿäº§è€…çº¿ç¨‹çš„å…¥é˜Ÿæ“ä½œå¿…é¡»ç­‰å¾…æ¶ˆè´¹è€…çº¿ç¨‹çš„å‡ºé˜Ÿæ“ä½œ. è€Œ LinkedTransferQueue èåˆ LinkedBlockingQueue å’Œ SynchronousQueue çš„åŠŸèƒ½, æ€§èƒ½æ¯” LinkedBlockingQueue æ›´å¥½; PriorityBlockingQueue æ”¯æŒæŒ‰ç…§ä¼˜å…ˆçº§å‡ºé˜Ÿ; DelayQueue æ”¯æŒå»¶æ—¶å‡ºé˜Ÿ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3f332e1dc5817a7e2ef7bc09fe60ae0c-20230731162452-apm836d.png",alt:"",title:"å•ç«¯é˜»å¡é˜Ÿåˆ—ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[t("strong",[s._v("åŒç«¯é˜»å¡é˜Ÿåˆ—")]),s._v(": å…¶å®ç°æ˜¯ "),t("strong",[s._v("LinkedBlockingDeque")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f2061dda8c8f0d70648fb0b2a8cbb50c-20230731162452-arnju17.png",alt:"",title:"åŒç«¯é˜»å¡é˜Ÿåˆ—ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[t("strong",[s._v("å•ç«¯éé˜»å¡é˜Ÿåˆ—")]),s._v(": å…¶å®ç°æ˜¯ "),t("strong",[s._v("ConcurrentLinkedQueue")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("åŒç«¯éé˜»å¡é˜Ÿåˆ—")]),s._v(": å…¶å®ç°æ˜¯ "),t("strong",[s._v("ConcurrentLinkedDeque")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦å¤–, ä½¿ç”¨é˜Ÿåˆ—æ—¶, éœ€è¦æ ¼å¤–æ³¨æ„é˜Ÿåˆ—"),t("strong",[s._v("æ˜¯å¦æ”¯æŒæœ‰ç•Œ")]),s._v("(æ‰€è°“æœ‰ç•ŒæŒ‡çš„æ˜¯å†…éƒ¨çš„é˜Ÿåˆ—æ˜¯å¦æœ‰å®¹é‡é™åˆ¶). å®é™…å·¥ä½œä¸­, ä¸€èˆ¬éƒ½ä¸å»ºè®®ä½¿ç”¨æ— ç•Œçš„é˜Ÿåˆ—, å› ä¸ºæ•°æ®é‡å¤§äº†ä¹‹åå¾ˆå®¹æ˜“å¯¼è‡´ OOM. ä¸Šé¢æåˆ°çš„è¿™äº› Queue ä¸­, åªæœ‰ ArrayBlockingQueue å’Œ LinkedBlockingQueue æ˜¯æ”¯æŒæœ‰ç•Œçš„, æ‰€ä»¥"),t("strong",[s._v("åœ¨ä½¿ç”¨å…¶ä»–æ— ç•Œé˜Ÿåˆ—æ—¶, ä¸€å®šè¦å……åˆ†è€ƒè™‘æ˜¯å¦å­˜åœ¨å¯¼è‡´ OOM çš„éšæ‚£")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-14"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-14"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Java å¹¶å‘å®¹å™¨çš„å†…å®¹å¾ˆå¤š, ä½†é‰´äºç¯‡å¹…æœ‰é™, åªæ˜¯å¯¹ä¸€äº›å…³é”®ç‚¹è¿›è¡Œäº†æ¢³ç†å’Œä»‹ç».")]),s._v(" "),t("p",[s._v("è€Œåœ¨å®é™…å·¥ä½œä¸­, ä¸å•è¦æ¸…æ¥šæ¯ç§å®¹å™¨çš„ç‰¹æ€§, è¿˜è¦èƒ½"),t("strong",[s._v("é€‰å¯¹å®¹å™¨, è¿™æ‰æ˜¯å…³é”®")]),s._v(", è‡³äºæ¯ç§å®¹å™¨çš„ç”¨æ³•, ç”¨çš„æ—¶å€™çœ‹ä¸€ä¸‹ API è¯´æ˜å°±å¯ä»¥äº†, è¿™äº›å®¹å™¨çš„ä½¿ç”¨éƒ½ä¸éš¾. åœ¨æ–‡ä¸­ç”šè‡³éƒ½æ²¡æœ‰ä»‹ç» Java å®¹å™¨çš„å¿«é€Ÿå¤±è´¥æœºåˆ¶(Fail-Fast), åŸå› å°±åœ¨äºå½“ä½ é€‰å¯¹å®¹å™¨çš„æ—¶å€™, æ ¹æœ¬ä¸ä¼šè§¦å‘å®ƒ.")]),s._v(" "),t("h4",{attrs:{id:"_21-åŸå­ç±»-æ— é”å·¥å…·ç±»çš„å…¸èŒƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_21-åŸå­ç±»-æ— é”å·¥å…·ç±»çš„å…¸èŒƒ"}},[s._v("#")]),s._v(" 21-åŸå­ç±»:æ— é”å·¥å…·ç±»çš„å…¸èŒƒ")]),s._v(" "),t("p",[s._v("å‰é¢å¤šæ¬¡æåˆ°ä¸€ä¸ªç´¯åŠ å™¨çš„ä¾‹å­, ç¤ºä¾‹ä»£ç å¦‚ä¸‹. åœ¨è¿™ä¸ªä¾‹å­ä¸­, add10K() è¿™ä¸ªæ–¹æ³•ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„, é—®é¢˜å°±å‡ºåœ¨å˜é‡ count çš„å¯è§æ€§å’Œ count+=1 çš„åŸå­æ€§ä¸Š. å¯è§æ€§é—®é¢˜å¯ä»¥ç”¨ volatile æ¥è§£å†³, è€ŒåŸå­æ€§é—®é¢˜å‰é¢ä¸€ç›´éƒ½æ˜¯é‡‡ç”¨çš„"),t("strong",[s._v("äº’æ–¥é”")]),s._v("æ–¹æ¡ˆ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add10K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" idx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("idx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("å…¶å®å¯¹äºç®€å•çš„åŸå­æ€§é—®é¢˜, è¿˜æœ‰ä¸€ç§"),t("strong",[s._v("æ— é”æ–¹æ¡ˆ")]),s._v(". Java SDK å¹¶å‘åŒ…å°†è¿™ç§æ— é”æ–¹æ¡ˆå°è£…æç‚¼ä¹‹å, å®ç°äº†ä¸€ç³»åˆ—çš„"),t("strong",[s._v("åŸå­ç±»")]),s._v(". ä¸è¿‡, åœ¨æ·±å…¥ä»‹ç»åŸå­ç±»çš„å®ç°ä¹‹å‰, å…ˆçœ‹çœ‹å¦‚ä½•åˆ©ç”¨åŸå­ç±»è§£å†³ç´¯åŠ å™¨é—®é¢˜, è¿™æ ·ä½ ä¼šå¯¹åŸå­ç±»æœ‰ä¸ªåˆæ­¥çš„è®¤è¯†.")]),s._v(" "),t("p",[s._v("åœ¨ä¸‹é¢çš„ä»£ç ä¸­, å°†åŸæ¥çš„ long å‹å˜é‡ count æ›¿æ¢ä¸ºäº†"),t("strong",[s._v("åŸå­ç±» AtomicLong")]),s._v(", åŸæ¥çš„ "),t("code",[s._v("count +=1")]),s._v("â€‹ æ›¿æ¢æˆäº† count.getAndIncrement(), ä»…éœ€è¦è¿™ä¸¤å¤„ç®€å•çš„æ”¹åŠ¨å°±èƒ½ä½¿ add10K() æ–¹æ³•å˜æˆ"),t("strong",[s._v("çº¿ç¨‹å®‰å…¨çš„")]),s._v(", åŸå­ç±»çš„ä½¿ç”¨è¿˜æ˜¯æŒºç®€å•çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add10K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" idx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("idx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndIncrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("æ— é”æ–¹æ¡ˆç›¸å¯¹äº’æ–¥é”æ–¹æ¡ˆ, æœ€å¤§çš„å¥½å¤„å°±æ˜¯"),t("strong",[s._v("æ€§èƒ½")]),s._v(". äº’æ–¥é”æ–¹æ¡ˆä¸ºäº†ä¿è¯äº’æ–¥æ€§, éœ€è¦æ‰§è¡ŒåŠ é”, è§£é”æ“ä½œ, è€ŒåŠ é”, è§£é”æ“ä½œæœ¬èº«å°±æ¶ˆè€—æ€§èƒ½; åŒæ—¶æ‹¿ä¸åˆ°é”çš„çº¿ç¨‹è¿˜ä¼šè¿›å…¥é˜»å¡çŠ¶æ€, è¿›è€Œè§¦å‘çº¿ç¨‹åˆ‡æ¢, çº¿ç¨‹åˆ‡æ¢å¯¹æ€§èƒ½çš„æ¶ˆè€—ä¹Ÿå¾ˆå¤§.  ç›¸æ¯”ä¹‹ä¸‹, "),t("strong",[s._v("æ— é”æ–¹æ¡ˆåˆ™å®Œå…¨æ²¡æœ‰åŠ é”, è§£é”çš„æ€§èƒ½æ¶ˆè€—, åŒæ—¶è¿˜èƒ½ä¿è¯äº’æ–¥æ€§")]),s._v(", æ—¢è§£å†³äº†é—®é¢˜, åˆæ²¡æœ‰å¸¦æ¥æ–°çš„é—®é¢˜, å¯è°“ç»ä½³æ–¹æ¡ˆ. é‚£å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"æ— é”æ–¹æ¡ˆçš„å®ç°åŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ— é”æ–¹æ¡ˆçš„å®ç°åŸç†"}},[s._v("#")]),s._v(" æ— é”æ–¹æ¡ˆçš„å®ç°åŸç†")]),s._v(" "),t("p",[s._v("å…¶å®åŸå­ç±»æ€§èƒ½é«˜çš„ç§˜å¯†å¾ˆç®€å•, "),t("strong",[s._v("ç¡¬ä»¶æ”¯æŒ")]),s._v('è€Œå·². CPU ä¸ºäº†è§£å†³å¹¶å‘é—®é¢˜, æä¾›äº† CAS æŒ‡ä»¤(CAS, å…¨ç§°æ˜¯ Compare And Swap, å³ "æ¯”è¾ƒå¹¶äº¤æ¢"). CAS æŒ‡ä»¤åŒ…å« 3 ä¸ªå‚æ•°: '),t("mark",[t("strong",[s._v("å…±äº«å˜é‡çš„å†…å­˜åœ°å€ A, ç”¨äºæ¯”è¾ƒçš„å€¼ B å’Œå…±äº«å˜é‡çš„æ–°å€¼ C; å¹¶ä¸”åªæœ‰å½“å†…å­˜ä¸­åœ°å€ A å¤„çš„å€¼ç­‰äº B æ—¶, æ‰èƒ½å°†å†…å­˜ä¸­åœ°å€ A å¤„çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ C. ä½œä¸ºä¸€æ¡ CPU æŒ‡ä»¤, CAS æŒ‡ä»¤æœ¬èº«æ˜¯èƒ½å¤Ÿä¿è¯åŸå­æ€§çš„")])]),s._v(".")]),s._v(" "),t("p",[s._v("å¯ä»¥é€šè¿‡ä¸‹é¢ CAS æŒ‡ä»¤çš„æ¨¡æ‹Ÿä»£ç æ¥ç†è§£ CAS çš„å·¥ä½œåŸç†. åœ¨ä¸‹é¢çš„æ¨¡æ‹Ÿç¨‹åºä¸­æœ‰ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªæ˜¯æœŸæœ›å€¼ expect, å¦ä¸€ä¸ªæ˜¯éœ€è¦å†™å…¥çš„æ–°å€¼ newValue, "),t("mark",[t("strong",[s._v("åªæœ‰å½“ç›®å‰ count çš„å€¼å’ŒæœŸæœ›å€¼ expect ç›¸ç­‰æ—¶, æ‰ä¼šå°† count æ›´æ–°ä¸º newValue")])]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimulatedCAS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" expect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»ç›®å‰ count çš„å€¼")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" curValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯”è¾ƒç›®å‰ count å€¼æ˜¯å¦ <mark> æœŸæœ›å€¼")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" expect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ˜¯, åˆ™æ›´æ–° count çš„å€¼")]),s._v("\n            count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›å†™å…¥å‰çš„å€¼")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" curValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v('ä½ ä»”ç»†åœ°å†æ¬¡æ€è€ƒä¸€ä¸‹è¿™å¥è¯, "'),t("strong",[s._v("åªæœ‰å½“ç›®å‰ count çš„å€¼å’ŒæœŸæœ›å€¼ expect ç›¸ç­‰æ—¶, æ‰ä¼šå°† count æ›´æ–°ä¸º newValue.")]),s._v(' " è¦æ€ä¹ˆç†è§£è¿™å¥è¯å‘¢?')]),s._v(" "),t("p",[s._v("å¯¹äºå‰é¢æåˆ°çš„ç´¯åŠ å™¨çš„ä¾‹å­, "),t("code",[s._v("count += 1")]),s._v("â€‹ çš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯: åŸºäºå†…å­˜ä¸­ count çš„å½“å‰å€¼ A è®¡ç®—å‡ºæ¥çš„ "),t("code",[s._v("count+=1")]),s._v("â€‹ ä¸º A+1, åœ¨å°† A+1 å†™å…¥å†…å­˜çš„æ—¶å€™, "),t("strong",[s._v("å¾ˆå¯èƒ½æ­¤æ—¶å†…å­˜ä¸­ count å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡äº†, è¿™æ ·å°±ä¼šå¯¼è‡´é”™è¯¯åœ°è¦†ç›–å…¶ä»–çº¿ç¨‹å†™å…¥çš„å€¼")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, åªæœ‰å½“å†…å­˜ä¸­ count çš„å€¼ç­‰äºæœŸæœ›å€¼ A æ—¶, æ‰èƒ½å°†å†…å­˜ä¸­ count çš„å€¼æ›´æ–°ä¸ºè®¡ç®—ç»“æœ A+1, è¿™ä¸å°±æ˜¯ CAS çš„è¯­ä¹‰å—!")]),s._v(" "),t("p",[t("strong",[s._v("ä½¿ç”¨ CAS æ¥è§£å†³å¹¶å‘é—®é¢˜, ä¸€èˆ¬éƒ½ä¼šä¼´éšç€è‡ªæ—‹")]),s._v(", è€Œæ‰€è°“è‡ªæ—‹, å…¶å®å°±æ˜¯å¾ªç¯å°è¯•. ä¾‹å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ "),t("code",[s._v("count += 1")]),s._v('â€‹æ“ä½œ, "CAS+ è‡ªæ—‹" çš„å®ç°æ–¹æ¡ˆå¦‚ä¸‹æ‰€ç¤º, é¦–å…ˆè®¡ç®— '),t("code",[s._v("newValue = count+1")]),s._v("â€‹, å¦‚æœ cas(count,newValue) è¿”å›çš„å€¼ä¸ç­‰äº count, åˆ™æ„å‘³ç€çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä»£ç  â‘  å¤„ä¹‹å, æ‰§è¡Œä»£ç  â‘¡ å¤„ä¹‹å‰, count çš„å€¼è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡. é‚£æ­¤æ—¶è¯¥æ€ä¹ˆå¤„ç†å‘¢? å¯ä»¥é‡‡ç”¨"),t("strong",[s._v("è‡ªæ—‹æ–¹æ¡ˆ")]),s._v(", å°±åƒä¸‹é¢ä»£ç ä¸­å±•ç¤ºçš„, å¯ä»¥"),t("strong",[s._v("é‡æ–°è¯» count æœ€æ–°çš„å€¼æ¥è®¡ç®— newValue å¹¶å°è¯•å†æ¬¡æ›´æ–°")]),s._v(", ç›´åˆ°æˆåŠŸ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimulatedCAS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®ç° count+=1")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            newValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//â‘¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¨¡æ‹Ÿå®ç° CAS, ä»…ç”¨æ¥å¸®åŠ©ç†è§£")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" expect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»ç›®å‰ count çš„å€¼")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" curValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯”è¾ƒç›®å‰ count å€¼æ˜¯å¦ <mark> æœŸæœ›å€¼")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" expect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ˜¯, åˆ™æ›´æ–° count çš„å€¼")]),s._v("\n            count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›å†™å…¥å‰çš„å€¼")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" curValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ä»£ç , æƒ³å¿…ä½ å·²ç»å‘ç°äº†, CAS è¿™ç§æ— é”æ–¹æ¡ˆ, å®Œå…¨æ²¡æœ‰åŠ é”, è§£é”æ“ä½œ, å³ä¾¿ä¸¤ä¸ªçº¿ç¨‹å®Œå…¨åŒæ—¶æ‰§è¡Œ addOne() æ–¹æ³•, ä¹Ÿä¸ä¼šæœ‰çº¿ç¨‹è¢«é˜»å¡, æ‰€ä»¥ç›¸å¯¹äºäº’æ–¥é”æ–¹æ¡ˆæ¥è¯´, æ€§èƒ½å¥½äº†å¾ˆå¤š.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯åœ¨ CAS æ–¹æ¡ˆä¸­, æœ‰ä¸€ä¸ªé—®é¢˜å¯èƒ½ä¼šå¸¸è¢«ä½ å¿½ç•¥, é‚£"),t("strong",[s._v("å°±æ˜¯ ABA é—®é¢˜")]),s._v(". ä»€ä¹ˆæ˜¯ ABA é—®é¢˜å‘¢?")]),s._v(" "),t("p",[s._v('å‰é¢æåˆ° "å¦‚æœ cas(count,newValue) è¿”å›çš„å€¼'),t("strong",[s._v("ä¸ç­‰äº")]),s._v(" count, æ„å‘³ç€çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä»£ç  â‘  å¤„ä¹‹å, æ‰§è¡Œä»£ç  â‘¡ å¤„ä¹‹å‰, count çš„å€¼è¢«å…¶ä»–çº¿ç¨‹"),t("strong",[s._v("æ›´æ–°è¿‡")]),s._v('", é‚£å¦‚æœ cas(count,newValue) è¿”å›çš„å€¼'),t("strong",[s._v("ç­‰äº")]),s._v(" count, æ˜¯å¦å°±èƒ½å¤Ÿè®¤ä¸º count çš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹"),t("strong",[s._v("æ›´æ–°è¿‡")]),s._v("å‘¢? æ˜¾ç„¶ä¸æ˜¯çš„, å‡è®¾ count åŸæœ¬æ˜¯ A, çº¿ç¨‹ T1 åœ¨æ‰§è¡Œå®Œä»£ç  â‘  å¤„ä¹‹å, æ‰§è¡Œä»£ç  â‘¡ å¤„ä¹‹å‰, æœ‰å¯èƒ½ count è¢«çº¿ç¨‹ T2 æ›´æ–°æˆäº† B, ä¹‹ååˆè¢« T3 æ›´æ–°å›äº† A, è¿™æ ·çº¿ç¨‹ T1 è™½ç„¶çœ‹åˆ°çš„ä¸€ç›´æ˜¯ A, ä½†æ˜¯å…¶å®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡äº†, è¿™å°±æ˜¯ ABA é—®é¢˜.")]),s._v(" "),t("p",[s._v("å¯èƒ½å¤§å¤šæ•°æƒ…å†µä¸‹å¹¶ä¸å…³å¿ƒ ABA é—®é¢˜, ä¾‹å¦‚æ•°å€¼çš„åŸå­é€’å¢, ä½†ä¹Ÿä¸èƒ½æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¸å…³å¿ƒ, ä¾‹å¦‚åŸå­åŒ–çš„æ›´æ–°å¯¹è±¡å¾ˆå¯èƒ½å°±éœ€è¦å…³å¿ƒ ABA é—®é¢˜, å› ä¸ºä¸¤ä¸ª A è™½ç„¶ç›¸ç­‰, ä½†æ˜¯ç¬¬äºŒä¸ª A çš„å±æ€§å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–äº†. æ‰€ä»¥åœ¨ä½¿ç”¨ CAS æ–¹æ¡ˆçš„æ—¶å€™, "),t("strong",[s._v("ä¸€å®šè¦å…ˆ check ä¸€ä¸‹")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"çœ‹javaå¦‚ä½•å®ç°åŸå­åŒ–çš„count-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#çœ‹javaå¦‚ä½•å®ç°åŸå­åŒ–çš„count-1"}},[s._v("#")]),s._v(" çœ‹Javaå¦‚ä½•å®ç°åŸå­åŒ–çš„count+=1")]),s._v(" "),t("p",[s._v("åœ¨æœ¬æ–‡å¼€å§‹éƒ¨åˆ†, ä½¿ç”¨åŸå­ç±» AtomicLong çš„ getAndIncrement() æ–¹æ³•æ›¿ä»£äº† "),t("code",[s._v("count += 1")]),s._v("â€‹, ä»è€Œå®ç°äº†çº¿ç¨‹å®‰å…¨. "),t("strong",[s._v("åŸå­ç±» AtomicLong çš„ getAndIncrement() æ–¹æ³•å†…éƒ¨å°±æ˜¯åŸºäº CAS å®ç°çš„")]),s._v(", ä¸‹é¢æ¥çœ‹çœ‹ Java æ˜¯å¦‚ä½•ä½¿ç”¨ CAS æ¥å®ç°åŸå­åŒ–çš„ "),t("code",[s._v("count += 1")]),s._v("â€‹ çš„.")]),s._v(" "),t("p",[s._v("åœ¨ Java 1.8 ç‰ˆæœ¬ä¸­, getAndIncrement() æ–¹æ³•ä¼šè½¬è°ƒ "),t("strong",[s._v("unsafe.getAndAddLong()")]),s._v("  æ–¹æ³•. è¿™é‡Œ this å’Œ valueOffset ä¸¤ä¸ªå‚æ•°å¯ä»¥"),t("strong",[s._v("å”¯ä¸€ç¡®å®šå…±äº«å˜é‡çš„å†…å­˜åœ°å€")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndIncrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" unsafe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndAddLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" valueOffset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("unsafe.getAndAddLong() æ–¹æ³•çš„æºç å¦‚ä¸‹, è¯¥æ–¹æ³•"),t("strong",[s._v("é¦–å…ˆä¼šåœ¨å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡çš„å€¼, ä¹‹åå¾ªç¯è°ƒç”¨ compareAndSwapLong() æ–¹æ³•æ¥å°è¯•è®¾ç½®å…±äº«å˜é‡çš„å€¼, ç›´åˆ°æˆåŠŸä¸ºæ­¢")]),s._v(". compareAndSwapLong() æ˜¯ä¸€ä¸ª native æ–¹æ³•, åªæœ‰å½“å†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ç­‰äº expected æ—¶, æ‰ä¼šå°†å…±äº«å˜é‡çš„å€¼æ›´æ–°ä¸º x, å¹¶ä¸”è¿”å› true; å¦åˆ™è¿”å› fasle. compareAndSwapLong çš„è¯­ä¹‰å’Œ CAS æŒ‡ä»¤çš„è¯­ä¹‰çš„å·®åˆ«ä»…ä»…æ˜¯è¿”å›å€¼ä¸åŒè€Œå·².")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndAddLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" offset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" delta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»å–å†…å­˜ä¸­çš„å€¼")]),s._v("\n        v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLongVolatile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" offset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSwapLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" offset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" delta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­æ€§åœ°å°†å˜é‡æ›´æ–°ä¸º x")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¡ä»¶æ˜¯å†…å­˜ä¸­çš„å€¼ç­‰äº expected")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ›´æ–°æˆåŠŸåˆ™è¿”å› true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSwapLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" offset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" expected"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯, "),t("strong",[s._v("getAndAddLong() æ–¹æ³•çš„å®ç°, åŸºæœ¬ä¸Šå°±æ˜¯ CAS ä½¿ç”¨çš„ç»å…¸èŒƒä¾‹")]),s._v(". æ‰€ä»¥è¯·å†æ¬¡ä½“ä¼šä¸‹é¢è¿™æ®µæŠ½è±¡åçš„ä»£ç ç‰‡æ®µ, å®ƒåœ¨å¾ˆå¤šæ— é”ç¨‹åºä¸­ç»å¸¸å‡ºç°. Java æä¾›çš„åŸå­ç±»é‡Œé¢ CAS ä¸€èˆ¬è¢«å®ç°ä¸º compareAndSet(), compareAndSet() çš„è¯­ä¹‰å’Œ CAS æŒ‡ä»¤çš„è¯­ä¹‰çš„å·®åˆ«ä»…ä»…æ˜¯è¿”å›å€¼ä¸åŒè€Œå·², compareAndSet() é‡Œé¢å¦‚æœæ›´æ–°æˆåŠŸ, åˆ™ä¼šè¿”å› true, å¦åˆ™è¿”å› false.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å½“å‰å€¼")]),s._v("\n    oldV "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xxxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¹æ®å½“å‰å€¼è®¡ç®—æ–°å€¼")]),s._v("\n    newV "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oldV"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldV"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newV"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"åŸå­ç±»æ¦‚è§ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸå­ç±»æ¦‚è§ˆ"}},[s._v("#")]),s._v(" åŸå­ç±»æ¦‚è§ˆ")]),s._v(" "),t("p",[s._v("Java SDK å¹¶å‘åŒ…é‡Œæä¾›çš„åŸå­ç±»å†…å®¹å¾ˆä¸°å¯Œ, å¯ä»¥å°†å®ƒä»¬åˆ†ä¸ºäº”ä¸ªç±»åˆ«: "),t("strong",[s._v("åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹, åŸå­åŒ–çš„å¯¹è±¡å¼•ç”¨ç±»å‹, åŸå­åŒ–æ•°ç»„, åŸå­åŒ–å¯¹è±¡å±æ€§æ›´æ–°å™¨")]),s._v("å’Œ"),t("strong",[s._v("åŸå­åŒ–çš„ç´¯åŠ å™¨")]),s._v(". è¿™äº”ä¸ªç±»åˆ«æä¾›çš„æ–¹æ³•åŸºæœ¬ä¸Šæ˜¯ç›¸ä¼¼çš„, å¹¶ä¸”æ¯ä¸ªç±»åˆ«éƒ½æœ‰è‹¥å¹²åŸå­ç±», å¯ä»¥é€šè¿‡ä¸‹é¢çš„åŸå­ç±»ç»„æˆæ¦‚è§ˆå›¾æ¥è·å¾—ä¸€ä¸ªå…¨å±€çš„å°è±¡. ä¸‹é¢è¯¦ç»†è§£è¯»è¿™äº”ä¸ªç±»åˆ«.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7e1c4116189c825d8d93912b45bdf367-20230731162452-jppujwx.png",alt:"",title:"åŸå­ç±»ç»„æˆæ¦‚è§ˆå›¾"}})]),s._v(" "),t("h6",{attrs:{id:"_1-åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹"}},[s._v("#")]),s._v(" (1)åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹")]),s._v(" "),t("p",[s._v("ç›¸å…³å®ç°æœ‰ AtomicBoolean, AtomicInteger å’Œ AtomicLong, æä¾›çš„æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹è¿™äº›, è¯¦æƒ…å¯ä»¥å‚è€ƒ SDK çš„æºä»£ç , éƒ½å¾ˆç®€å•, è¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndIncrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­åŒ– i++")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndDecrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­åŒ–çš„ i--")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­åŒ–çš„ ++i")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­åŒ–çš„ --i")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰å€¼ +=delta, è¿”å› += å‰çš„å€¼")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndAdd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰å€¼ +=delta, è¿”å› += åçš„å€¼")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//CAS æ“ä½œ, è¿”å›æ˜¯å¦æˆåŠŸ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¥ä¸‹å››ä¸ªæ–¹æ³•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°å€¼å¯ä»¥é€šè¿‡ä¼ å…¥ func å‡½æ•°æ¥è®¡ç®—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndUpdate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("func"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("func"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndAccumulate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("func"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accumulateAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("func"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h6",{attrs:{id:"_2-åŸå­åŒ–çš„å¯¹è±¡å¼•ç”¨ç±»å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-åŸå­åŒ–çš„å¯¹è±¡å¼•ç”¨ç±»å‹"}},[s._v("#")]),s._v(" (2)åŸå­åŒ–çš„å¯¹è±¡å¼•ç”¨ç±»å‹")]),s._v(" "),t("p",[s._v("ç›¸å…³å®ç°æœ‰ "),t("strong",[s._v("AtomicReference, AtomicStampedReference å’Œ AtomicMarkableReference")]),s._v(", åˆ©ç”¨å®ƒä»¬å¯ä»¥å®ç°"),t("strong",[s._v("å¯¹è±¡å¼•ç”¨çš„åŸå­åŒ–æ›´æ–°")]),s._v(". AtomicReference æä¾›çš„æ–¹æ³•å’ŒåŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹å·®ä¸å¤š, è¿™é‡Œä¸å†èµ˜è¿°. ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯, "),t("strong",[s._v("å¯¹è±¡å¼•ç”¨çš„æ›´æ–°éœ€è¦é‡ç‚¹å…³æ³¨ ABA é—®é¢˜, AtomicStampedReference å’Œ AtomicMarkableReference è¿™ä¸¤ä¸ªåŸå­ç±»å¯ä»¥è§£å†³ ABA é—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("è§£å†³ ABA é—®é¢˜çš„æ€è·¯å…¶å®å¾ˆç®€å•, å¢åŠ ä¸€ä¸ª"),t("strong",[s._v("ç‰ˆæœ¬å·ç»´åº¦")]),s._v("å°±å¯ä»¥äº†, è¿™ä¸ªä¸å‰é¢ä»‹ç»çš„ä¹è§‚é”æœºåˆ¶å¾ˆç±»ä¼¼, æ¯æ¬¡æ‰§è¡Œ CAS æ“ä½œ, é™„åŠ å†æ›´æ–°ä¸€ä¸ªç‰ˆæœ¬å·, åªè¦ä¿è¯ç‰ˆæœ¬å·æ˜¯é€’å¢çš„, é‚£ä¹ˆå³ä¾¿ A å˜æˆ B ä¹‹åå†å˜å› A, ç‰ˆæœ¬å·ä¹Ÿä¸ä¼šå˜å›æ¥(ç‰ˆæœ¬å·é€’å¢çš„). AtomicStampedReference å®ç°çš„ CAS æ–¹æ³•å°±"),t("strong",[s._v("å¢åŠ äº†ç‰ˆæœ¬å·å‚æ•°")]),s._v(", æ–¹æ³•ç­¾åå¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" expectedReference"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" newReference"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" expectedStamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" newStamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("AtomicMarkableReference çš„å®ç°æœºåˆ¶åˆ™æ›´ç®€å•, å°†ç‰ˆæœ¬å·ç®€åŒ–æˆäº†ä¸€ä¸ª Boolean å€¼, æ–¹æ³•ç­¾åå¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" expectedReference"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" newReference"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" expectedMark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" newMark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h6",{attrs:{id:"_3-åŸå­åŒ–æ•°ç»„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-åŸå­åŒ–æ•°ç»„"}},[s._v("#")]),s._v(" (3)åŸå­åŒ–æ•°ç»„")]),s._v(" "),t("p",[s._v("ç›¸å…³å®ç°æœ‰ AtomicIntegerArray, AtomicLongArray å’Œ AtomicReferenceArray, åˆ©ç”¨è¿™äº›åŸå­ç±», å¯ä»¥åŸå­åŒ–åœ°æ›´æ–°æ•°ç»„é‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ . è¿™äº›ç±»æä¾›çš„æ–¹æ³•å’ŒåŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹çš„åŒºåˆ«ä»…ä»…æ˜¯: æ¯ä¸ªæ–¹æ³•å¤šäº†ä¸€ä¸ªæ•°ç»„çš„ç´¢å¼•å‚æ•°, æ‰€ä»¥è¿™é‡Œä¹Ÿä¸å†èµ˜è¿°äº†.")]),s._v(" "),t("h6",{attrs:{id:"_4-åŸå­åŒ–å¯¹è±¡å±æ€§æ›´æ–°å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-åŸå­åŒ–å¯¹è±¡å±æ€§æ›´æ–°å™¨"}},[s._v("#")]),s._v(" (4)åŸå­åŒ–å¯¹è±¡å±æ€§æ›´æ–°å™¨")]),s._v(" "),t("p",[s._v("ç›¸å…³å®ç°æœ‰ AtomicIntegerFieldUpdater, AtomicLongFieldUpdater å’Œ AtomicReferenceFieldUpdater, åˆ©ç”¨å®ƒä»¬å¯ä»¥"),t("strong",[s._v("åŸå­åŒ–åœ°æ›´æ–°å¯¹è±¡çš„å±æ€§, è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯åˆ©ç”¨åå°„æœºåˆ¶å®ç°")]),s._v("çš„, åˆ›å»ºæ›´æ–°å™¨çš„æ–¹æ³•å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicXXXFieldUpdater")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newUpdater")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" tclass"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" fieldName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, "),t("strong",[s._v("å¯¹è±¡å±æ€§å¿…é¡»æ˜¯ volatile ç±»å‹çš„, åªæœ‰è¿™æ ·æ‰èƒ½ä¿è¯å¯è§æ€§")]),s._v("; å¦‚æœå¯¹è±¡å±æ€§ä¸æ˜¯ volatile ç±»å‹çš„, newUpdater() æ–¹æ³•ä¼šæŠ›å‡º IllegalArgumentException è¿™ä¸ªè¿è¡Œæ—¶å¼‚å¸¸.")]),s._v(" "),t("p",[s._v("ä½ ä¼šå‘ç° newUpdater() çš„æ–¹æ³•å‚æ•°åªæœ‰ç±»çš„ä¿¡æ¯, æ²¡æœ‰å¯¹è±¡çš„å¼•ç”¨, è€Œæ›´æ–°"),t("strong",[s._v("å¯¹è±¡")]),s._v("çš„å±æ€§, ä¸€å®šéœ€è¦å¯¹è±¡çš„å¼•ç”¨, é‚£è¿™ä¸ªå‚æ•°æ˜¯åœ¨å“ªé‡Œä¼ å…¥çš„å‘¢? æ˜¯åœ¨"),t("strong",[s._v("åŸå­æ“ä½œçš„æ–¹æ³•å‚æ•°ä¸­ä¼ å…¥")]),s._v("çš„. ä¾‹å¦‚ compareAndSet() è¿™ä¸ªåŸå­æ“ä½œ, ç›¸æ¯”åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹å¤šäº†ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ obj. åŸå­åŒ–å¯¹è±¡å±æ€§æ›´æ–°å™¨ç›¸å…³çš„æ–¹æ³•, ç›¸æ¯”åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹ä»…ä»…æ˜¯å¤šäº†å¯¹è±¡å¼•ç”¨å‚æ•°, æ‰€ä»¥è¿™é‡Œä¹Ÿä¸å†èµ˜è¿°äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" expect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h6",{attrs:{id:"_5-åŸå­åŒ–çš„ç´¯åŠ å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-åŸå­åŒ–çš„ç´¯åŠ å™¨"}},[s._v("#")]),s._v(" (5)åŸå­åŒ–çš„ç´¯åŠ å™¨")]),s._v(" "),t("p",[t("strong",[s._v("DoubleAccumulator, DoubleAdder, LongAccumulator å’Œ LongAdder")]),s._v(", è¿™å››ä¸ªç±»ä»…ä»…ç”¨æ¥æ‰§è¡Œ"),t("strong",[s._v("ç´¯åŠ ")]),s._v("æ“ä½œ, ç›¸æ¯”åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹, é€Ÿåº¦æ›´å¿«, ä½†æ˜¯ä¸æ”¯æŒ compareAndSet() æ–¹æ³•. å¦‚æœä»…ä»…éœ€è¦ç´¯åŠ æ“ä½œ, ä½¿ç”¨åŸå­åŒ–çš„ç´¯åŠ å™¨æ€§èƒ½ä¼šæ›´å¥½.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-15"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-15"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("æ— é”æ–¹æ¡ˆç›¸å¯¹äºäº’æ–¥é”æ–¹æ¡ˆ, ä¼˜ç‚¹éå¸¸å¤š, é¦–å…ˆæ€§èƒ½å¥½, å…¶æ¬¡æ˜¯åŸºæœ¬ä¸ä¼šå‡ºç°æ­»é”é—®é¢˜(ä½†å¯èƒ½å‡ºç°é¥¥é¥¿å’Œæ´»é”é—®é¢˜, å› ä¸ºè‡ªæ—‹ä¼šåå¤é‡è¯•). Java æä¾›çš„åŸå­ç±»å¤§éƒ¨åˆ†éƒ½å®ç°äº† compareAndSet() æ–¹æ³•, åŸºäº compareAndSet() æ–¹æ³•, å¯ä»¥æ„å»ºè‡ªå·±çš„æ— é”æ•°æ®ç»“æ„, ä½†æ˜¯"),t("strong",[s._v("å»ºè®®ä¸è¦è¿™æ ·åš, è¿™ä¸ªå·¥ä½œæœ€å¥½è¿˜æ˜¯è®©å¤§å¸ˆä»¬å»å®Œæˆ")]),s._v(", åŸå› æ˜¯æ— é”ç®—æ³•æ²¡æƒ³è±¡çš„é‚£ä¹ˆç®€å•.")]),s._v(" "),t("p",[s._v("Java æä¾›çš„åŸå­ç±»èƒ½å¤Ÿè§£å†³ä¸€äº›ç®€å•çš„åŸå­æ€§é—®é¢˜, ä½†ä½ å¯èƒ½ä¼šå‘ç°, ä¸Šé¢æ‰€æœ‰åŸå­ç±»çš„æ–¹æ³•éƒ½æ˜¯é’ˆå¯¹"),t("strong",[s._v("ä¸€ä¸ªå…±äº«å˜é‡")]),s._v("çš„, å¦‚æœ"),t("strong",[s._v("éœ€è¦è§£å†³å¤šä¸ªå˜é‡çš„åŸå­æ€§é—®é¢˜, å»ºè®®è¿˜æ˜¯ä½¿ç”¨äº’æ–¥é”æ–¹æ¡ˆ")]),s._v(". åŸå­ç±»è™½å¥½, ä½†ä½¿ç”¨è¦æ…ä¹‹åˆæ….")]),s._v(" "),t("h4",{attrs:{id:"_22-executorä¸çº¿ç¨‹æ± -å¦‚ä½•åˆ›å»ºæ­£ç¡®çš„çº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_22-executorä¸çº¿ç¨‹æ± -å¦‚ä½•åˆ›å»ºæ­£ç¡®çš„çº¿ç¨‹æ± "}},[s._v("#")]),s._v(" 22-Executorä¸çº¿ç¨‹æ± :å¦‚ä½•åˆ›å»ºæ­£ç¡®çš„çº¿ç¨‹æ± ?")]),s._v(" "),t("p",[s._v("è™½ç„¶åœ¨ Java è¯­è¨€ä¸­åˆ›å»ºçº¿ç¨‹çœ‹ä¸Šå»å°±åƒåˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¸€æ ·ç®€å•, åªéœ€è¦ new Thread() å°±å¯ä»¥äº†, ä½†å®é™…ä¸Šåˆ›å»ºçº¿ç¨‹è¿œä¸æ˜¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡é‚£ä¹ˆç®€å•. åˆ›å»ºå¯¹è±¡, ä»…ä»…æ˜¯åœ¨ JVM çš„å †é‡Œåˆ†é…ä¸€å—å†…å­˜è€Œå·²; è€Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹, å´éœ€è¦è°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„ API, ç„¶åæ“ä½œç³»ç»Ÿè¦ä¸ºçº¿ç¨‹åˆ†é…ä¸€ç³»åˆ—çš„èµ„æº, è¿™ä¸ªæˆæœ¬å°±å¾ˆé«˜äº†, æ‰€ä»¥"),t("strong",[s._v("çº¿ç¨‹æ˜¯ä¸€ä¸ªé‡é‡çº§çš„å¯¹è±¡, åº”è¯¥é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£å¦‚ä½•é¿å…å‘¢? é‚£å°±æ˜¯"),t("strong",[s._v("çº¿ç¨‹æ± ")]),s._v(".")]),s._v(" "),t("p",[s._v("çº¿ç¨‹æ± çš„éœ€æ±‚æ˜¯å¦‚æ­¤æ™®é, æ‰€ä»¥ Java SDK å¹¶å‘åŒ…è‡ªç„¶ä¹Ÿå°‘ä¸äº†å®ƒ. ä½†æ˜¯å¾ˆå¤šäººåœ¨åˆæ¬¡æ¥è§¦å¹¶å‘åŒ…é‡Œçº¿ç¨‹æ± ç›¸å…³çš„å·¥å…·ç±»æ—¶, å¤šå°‘ä¼šéƒ½æœ‰ç‚¹è’™, ä¸çŸ¥é“è¯¥ä»å“ªé‡Œå…¥æ‰‹, æˆ‘è§‰å¾—æ ¹æœ¬åŸå› åœ¨äºçº¿ç¨‹æ± å’Œä¸€èˆ¬æ„ä¹‰ä¸Šçš„æ± åŒ–èµ„æºæ˜¯ä¸åŒçš„. ä¸€èˆ¬æ„ä¹‰ä¸Šçš„æ± åŒ–èµ„æº, éƒ½æ˜¯ä¸‹é¢è¿™æ ·, å½“éœ€è¦èµ„æºçš„æ—¶å€™å°±è°ƒç”¨ acquire() æ–¹æ³•æ¥ç”³è¯·èµ„æº, ç”¨å®Œä¹‹åå°±è°ƒç”¨ release() é‡Šæ”¾èµ„æº. è‹¥å¸¦ç€è¿™ä¸ªå›ºæœ‰æ¨¡å‹æ¥çœ‹å¹¶å‘åŒ…é‡Œçº¿ç¨‹æ± ç›¸å…³çš„å·¥å…·ç±»æ—¶, ä¼šå¾ˆé—æ†¾åœ°å‘ç°å®ƒä»¬å®Œå…¨åŒ¹é…ä¸ä¸Š, "),t("strong",[s._v("Java æä¾›çš„çº¿ç¨‹æ± é‡Œé¢å‹æ ¹å°±æ²¡æœ‰ç”³è¯·çº¿ç¨‹å’Œé‡Šæ”¾çº¿ç¨‹çš„æ–¹æ³•")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XXXPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–æ± åŒ–èµ„æº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XXX")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾æ± åŒ–èµ„æº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XXX")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h5",{attrs:{id:"çº¿ç¨‹æ± æ˜¯ä¸€ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#çº¿ç¨‹æ± æ˜¯ä¸€ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼"}},[s._v("#")]),s._v(" çº¿ç¨‹æ± æ˜¯ä¸€ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼")]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆçº¿ç¨‹æ± æ²¡æœ‰é‡‡ç”¨ä¸€èˆ¬æ„ä¹‰ä¸Šæ± åŒ–èµ„æºçš„è®¾è®¡æ–¹æ³•å‘¢? å¦‚æœçº¿ç¨‹æ± é‡‡ç”¨ä¸€èˆ¬æ„ä¹‰ä¸Šæ± åŒ–èµ„æºçš„è®¾è®¡æ–¹æ³•, åº”è¯¥æ˜¯ä¸‹é¢ç¤ºä¾‹ä»£ç è¿™æ ·. å¯ä»¥æ€è€ƒä¸€ä¸‹, å‡è®¾è·å–åˆ°ä¸€ä¸ªç©ºé—²çº¿ç¨‹ T1, ç„¶åè¯¥å¦‚ä½•ä½¿ç”¨ T1 å‘¢? ä½ æœŸæœ›çš„å¯èƒ½æ˜¯è¿™æ ·: é€šè¿‡è°ƒç”¨ T1 çš„ execute() æ–¹æ³•, ä¼ å…¥ä¸€ä¸ª Runnable å¯¹è±¡æ¥æ‰§è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘, å°±åƒé€šè¿‡æ„é€ å‡½æ•° Thread(Runnable target) åˆ›å»ºçº¿ç¨‹ä¸€æ ·. å¯æƒœçš„æ˜¯, ä½ ç¿»é Thread å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•, éƒ½ä¸å­˜åœ¨ç±»ä¼¼ execute(Runnable target) è¿™æ ·çš„å…¬å…±æ–¹æ³•.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡‡ç”¨ä¸€èˆ¬æ„ä¹‰ä¸Šæ± åŒ–èµ„æºçš„è®¾è®¡æ–¹æ³•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPool")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–ç©ºé—²çº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾çº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœŸæœ›çš„ä½¿ç”¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPool")]),s._v(" pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¼ å…¥ Runnable å¯¹è±¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…·ä½“ä¸šåŠ¡é€»è¾‘")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ......")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("æ‰€ä»¥çº¿ç¨‹æ± çš„è®¾è®¡, æ²¡æœ‰åŠæ³•ç›´æ¥é‡‡ç”¨ä¸€èˆ¬æ„ä¹‰ä¸Šæ± åŒ–èµ„æºçš„è®¾è®¡æ–¹æ³•. é‚£çº¿ç¨‹æ± è¯¥å¦‚ä½•è®¾è®¡å‘¢? ç›®å‰ä¸šç•Œçº¿ç¨‹æ± çš„è®¾è®¡, æ™®éé‡‡ç”¨çš„éƒ½æ˜¯"),t("mark",[t("strong",[s._v("ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼")])]),s._v(". çº¿ç¨‹æ± çš„"),t("strong",[s._v("ä½¿ç”¨æ–¹æ˜¯ç”Ÿäº§è€…, çº¿ç¨‹æ± æœ¬èº«æ˜¯æ¶ˆè´¹è€…")]),s._v(". åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, åˆ›å»ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„çº¿ç¨‹æ±  MyThreadPool, å¯ä»¥é€šè¿‡å®ƒæ¥ç†è§£çº¿ç¨‹æ± çš„å·¥ä½œåŸç†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç®€åŒ–çš„çº¿ç¨‹æ± , ä»…ç”¨æ¥è¯´æ˜å·¥ä½œåŸç†")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThreadPool")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ©ç”¨é˜»å¡é˜Ÿåˆ—å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿å­˜å†…éƒ¨å·¥ä½œçº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WorkerThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" threads "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" poolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("workQueue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºå·¥ä½œçº¿ç¨‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" idx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" idx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" poolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" idx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WorkerThread")]),s._v(" work "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WorkerThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            work"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            threads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("work"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å·¥ä½œçº¿ç¨‹è´Ÿè´£æ¶ˆè´¹ä»»åŠ¡, å¹¶æ‰§è¡Œä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WorkerThread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¾ªç¯å–ä»»åŠ¡å¹¶æ‰§è¡Œ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// â‘ ")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * ä½¿ç”¨ç¤ºä¾‹\n **/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºæœ‰ç•Œé˜»å¡é˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" workQueue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹æ±   ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThreadPool")]),s._v(" pool "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ä»»åŠ¡  ")]),s._v("\npool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("p",[s._v("åœ¨ MyThreadPool çš„å†…éƒ¨, ç»´æŠ¤äº†ä¸€ä¸ª"),t("strong",[s._v("é˜»å¡é˜Ÿåˆ— workQueue å’Œä¸€ç»„å·¥ä½œçº¿ç¨‹, å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°ç”±æ„é€ å‡½æ•°ä¸­çš„ poolSize æ¥æŒ‡å®š")]),s._v(". ç”¨æˆ·é€šè¿‡"),t("strong",[s._v("è°ƒç”¨ execute() æ–¹æ³•æ¥æäº¤ Runnable ä»»åŠ¡, execute() æ–¹æ³•çš„å†…éƒ¨å®ç°ä»…ä»…æ˜¯å°†ä»»åŠ¡åŠ å…¥åˆ° workQueue ä¸­. MyThreadPool å†…éƒ¨ç»´æŠ¤çš„å·¥ä½œçº¿ç¨‹ä¼šæ¶ˆè´¹ workQueue ä¸­çš„ä»»åŠ¡å¹¶æ‰§è¡Œä»»åŠ¡, ç›¸å…³çš„ä»£ç å°±æ˜¯ä»£ç  â‘  å¤„çš„ while å¾ªç¯")]),s._v(". çº¿ç¨‹æ± ä¸»è¦çš„å·¥ä½œåŸç†å°±è¿™äº›, æ˜¯ä¸æ˜¯è¿˜æŒºç®€å•çš„?")]),s._v(" "),t("h5",{attrs:{id:"å¦‚ä½•ä½¿ç”¨javaä¸­çš„çº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä½¿ç”¨javaä¸­çš„çº¿ç¨‹æ± "}},[s._v("#")]),s._v(" å¦‚ä½•ä½¿ç”¨Javaä¸­çš„çº¿ç¨‹æ± ")]),s._v(" "),t("p",[s._v("Java å¹¶å‘åŒ…é‡Œæä¾›çš„çº¿ç¨‹æ± , è¿œæ¯”ä¸Šé¢çš„ç¤ºä¾‹ä»£ç å¼ºå¤§å¾—å¤š, å½“ç„¶ä¹Ÿå¤æ‚å¾—å¤š. Java æä¾›çš„çº¿ç¨‹æ± ç›¸å…³çš„å·¥å…·ç±»ä¸­, æœ€æ ¸å¿ƒçš„æ˜¯ "),t("mark",[t("strong",[s._v("ThreadPoolExecutor")])]),s._v(", é€šè¿‡åå­—ä¹Ÿèƒ½çœ‹å‡ºæ¥, å®ƒå¼ºè°ƒçš„æ˜¯ "),t("strong",[s._v("Executor")]),s._v(", è€Œä¸æ˜¯ä¸€èˆ¬æ„ä¹‰ä¸Šçš„æ± åŒ–èµ„æº.")]),s._v(" "),t("p",[s._v("ThreadPoolExecutor çš„æ„é€ å‡½æ•°éå¸¸å¤æ‚, å¦‚ä¸‹é¢ä»£ç æ‰€ç¤º, è¿™ä¸ªæœ€å®Œå¤‡çš„æ„é€ å‡½æ•°æœ‰ 7 ä¸ªå‚æ•°.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maximumPoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" keepAliveTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadFactory")]),s._v(" threadFactory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RejectedExecutionHandler")]),s._v(" handler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("ä¸‹é¢ä¸€ä¸€ä»‹ç»è¿™äº›å‚æ•°çš„æ„ä¹‰, å¯ä»¥"),t("strong",[s._v("æŠŠçº¿ç¨‹æ± ç±»æ¯”ä¸ºä¸€ä¸ªé¡¹ç›®ç»„, è€Œçº¿ç¨‹å°±æ˜¯é¡¹ç›®ç»„çš„æˆå‘˜")]),s._v(".")]),s._v(" "),t("ul",[t("li",[t("mark",[t("strong",[s._v("corePoolSize")])]),s._v(": è¡¨ç¤ºçº¿ç¨‹æ± ä¿æœ‰çš„"),t("strong",[s._v("æœ€å°çº¿ç¨‹æ•°")]),s._v(". æœ‰äº›é¡¹ç›®å¾ˆé—², ä½†æ˜¯ä¹Ÿä¸èƒ½æŠŠäººéƒ½æ’¤äº†, è‡³å°‘è¦ç•™ corePoolSize ä¸ªäººåšå®ˆé˜µåœ°.")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("maximumPoolSize")])]),s._v(": è¡¨ç¤ºçº¿ç¨‹æ± åˆ›å»ºçš„"),t("strong",[s._v("æœ€å¤§çº¿ç¨‹æ•°")]),s._v(". å½“é¡¹ç›®å¾ˆå¿™æ—¶, å°±éœ€è¦åŠ äºº, ä½†æ˜¯ä¹Ÿä¸èƒ½æ— é™åˆ¶åœ°åŠ , æœ€å¤šå°±åŠ åˆ° maximumPoolSize ä¸ªäºº. å½“é¡¹ç›®é—²ä¸‹æ¥æ—¶, å°±è¦æ’¤äººäº†, æœ€å¤šèƒ½æ’¤åˆ° corePoolSize ä¸ªäºº.")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("keepAliveTime & unit")])]),s._v(': ä¸Šé¢æåˆ°é¡¹ç›®æ ¹æ®å¿™é—²æ¥å¢å‡äººå‘˜, é‚£åœ¨ç¼–ç¨‹ä¸–ç•Œé‡Œ, å¦‚ä½•å®šä¹‰å¿™å’Œé—²å‘¢? å¾ˆç®€å•, ä¸€ä¸ªçº¿ç¨‹å¦‚æœåœ¨ä¸€æ®µæ—¶é—´å†…, éƒ½æ²¡æœ‰æ‰§è¡Œä»»åŠ¡, è¯´æ˜å¾ˆé—², keepAliveTime å’Œ unit å°±æ˜¯ç”¨æ¥å®šä¹‰è¿™ä¸ª "ä¸€æ®µæ—¶é—´" çš„å‚æ•°. ä¹Ÿå°±æ˜¯è¯´, å¦‚æœä¸€ä¸ªçº¿ç¨‹ç©ºé—²äº† '),t("code",[s._v("keepAliveTime & unit")]),s._v("â€‹ è¿™ä¹ˆä¹…, è€Œä¸”çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°å¤§äº corePoolSize, é‚£ä¹ˆè¿™ä¸ªç©ºé—²çš„çº¿ç¨‹å°±è¦è¢«å›æ”¶äº†.")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("workQueue")])]),s._v(": å·¥ä½œé˜Ÿåˆ—, å’Œä¸Šé¢ç¤ºä¾‹ä»£ç çš„å·¥ä½œé˜Ÿåˆ—åŒä¹‰.")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("threadFactory")])]),s._v(": é€šè¿‡è¿™ä¸ªå‚æ•°å¯ä»¥"),t("strong",[s._v("è‡ªå®šä¹‰å¦‚ä½•åˆ›å»ºçº¿ç¨‹")]),s._v(", ä¾‹å¦‚å¯ä»¥ç»™çº¿ç¨‹æŒ‡å®šä¸€ä¸ªæœ‰æ„ä¹‰çš„åå­—.")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("handler")])]),s._v(": é€šè¿‡è¿™ä¸ªå‚æ•°å¯ä»¥"),t("strong",[s._v("è‡ªå®šä¹‰ä»»åŠ¡çš„æ‹’ç»ç­–ç•¥")]),s._v(". å¦‚æœçº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨å¿™ç¢Œ, å¹¶ä¸”å·¥ä½œé˜Ÿåˆ—ä¹Ÿæ»¡äº†(å‰ææ˜¯å·¥ä½œé˜Ÿåˆ—æ˜¯æœ‰ç•Œé˜Ÿåˆ—), é‚£ä¹ˆæ­¤æ—¶æäº¤ä»»åŠ¡, çº¿ç¨‹æ± å°±ä¼šæ‹’ç»æ¥æ”¶. è‡³äºæ‹’ç»çš„ç­–ç•¥, å¯ä»¥é€šè¿‡ handler è¿™ä¸ªå‚æ•°æ¥æŒ‡å®š. ThreadPoolExecutor å·²ç»æä¾›äº†ä»¥ä¸‹ 4 ç§ç­–ç•¥.\n"),t("ul",[t("li",[t("strong",[s._v("CallerRunsPolicy")]),s._v(": æäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±å»æ‰§è¡Œè¯¥ä»»åŠ¡.")]),s._v(" "),t("li",[t("strong",[s._v("AbortPolicy")]),s._v(": é»˜è®¤çš„æ‹’ç»ç­–ç•¥, ä¼š throws RejectedExecutionException.")]),s._v(" "),t("li",[t("strong",[s._v("DiscardPolicy")]),s._v(": ç›´æ¥ä¸¢å¼ƒä»»åŠ¡, æ²¡æœ‰ä»»ä½•å¼‚å¸¸æŠ›å‡º.")]),s._v(" "),t("li",[t("strong",[s._v("DiscardOldestPolicy")]),s._v(": ä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡, å…¶å®å°±æ˜¯æŠŠæœ€æ—©è¿›å…¥å·¥ä½œé˜Ÿåˆ—çš„ä»»åŠ¡ä¸¢å¼ƒ, ç„¶åæŠŠæ–°ä»»åŠ¡åŠ å…¥åˆ°å·¥ä½œé˜Ÿåˆ—.")])])])]),s._v(" "),t("p",[s._v("Java åœ¨ 1.6 ç‰ˆæœ¬è¿˜å¢åŠ äº† allowCoreThreadTimeOut(boolean value) æ–¹æ³•, å®ƒå¯ä»¥è®©æ‰€æœ‰çº¿ç¨‹éƒ½æ”¯æŒè¶…æ—¶, è¿™æ„å‘³ç€å¦‚æœé¡¹ç›®å¾ˆé—², å°±ä¼šå°†é¡¹ç›®ç»„çš„æˆå‘˜éƒ½æ’¤èµ°.")]),s._v(" "),t("h5",{attrs:{id:"ä½¿ç”¨çº¿ç¨‹æ± è¦æ³¨æ„äº›ä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨çº¿ç¨‹æ± è¦æ³¨æ„äº›ä»€ä¹ˆ"}},[s._v("#")]),s._v(" ä½¿ç”¨çº¿ç¨‹æ± è¦æ³¨æ„äº›ä»€ä¹ˆ")]),s._v(" "),t("p",[s._v("è€ƒè™‘åˆ° ThreadPoolExecutor çš„æ„é€ å‡½æ•°å®åœ¨æ˜¯æœ‰äº›å¤æ‚, æ‰€ä»¥ Java å¹¶å‘åŒ…é‡Œæä¾›äº†ä¸€ä¸ª"),t("strong",[s._v("çº¿ç¨‹æ± çš„é™æ€å·¥å‚ç±» Executors")]),s._v(", åˆ©ç”¨ Executors å¯ä»¥å¿«é€Ÿåˆ›å»ºçº¿ç¨‹æ± . ä¸è¿‡ç›®å‰å¤§å‚çš„ç¼–ç è§„èŒƒä¸­åŸºæœ¬ä¸Šéƒ½ä¸å»ºè®®ä½¿ç”¨ Executors äº†, æ‰€ä»¥è¿™é‡Œå°±ä¸å†èŠ±ç¯‡å¹…ä»‹ç»äº†.")]),s._v(" "),t("p",[s._v("ä¸å»ºè®®ä½¿ç”¨ Executors çš„æœ€é‡è¦çš„åŸå› æ˜¯: "),t("mark",[t("strong",[s._v("Executors æä¾›çš„å¾ˆå¤šæ–¹æ³•é»˜è®¤ä½¿ç”¨çš„éƒ½æ˜¯æ— ç•Œçš„ LinkedBlockingQueue, é«˜è´Ÿè½½æƒ…å¢ƒä¸‹, æ— ç•Œé˜Ÿåˆ—å¾ˆå®¹æ˜“å¯¼è‡´ OOM, è€Œ OOM ä¼šå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½æ— æ³•å¤„ç†, è¿™æ˜¯è‡´å‘½é—®é¢˜. æ‰€ä»¥å¼ºçƒˆå»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—, å½“ä»»åŠ¡è¿‡å¤šæ—¶, çº¿ç¨‹æ± ä¼šè§¦å‘æ‰§è¡Œæ‹’ç»ç­–ç•¥, çº¿ç¨‹æ± é»˜è®¤çš„æ‹’ç»ç­–ç•¥ä¼š throw RejectedExecutionException è¿™æ˜¯ä¸ªè¿è¡Œæ—¶å¼‚å¸¸, å¯¹äºè¿è¡Œæ—¶å¼‚å¸¸ç¼–è¯‘å™¨å¹¶ä¸å¼ºåˆ¶ catch å®ƒ, æ‰€ä»¥å¼€å‘äººå‘˜å¾ˆå®¹æ˜“å¿½ç•¥. å› æ­¤"),t("strong",[s._v("é»˜è®¤æ‹’ç»ç­–ç•¥è¦æ…é‡ä½¿ç”¨")]),s._v(". å¦‚æœçº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡éå¸¸é‡è¦, å»ºè®®è‡ªå®šä¹‰è‡ªå·±çš„æ‹’ç»ç­–ç•¥; å¹¶ä¸”åœ¨å®é™…å·¥ä½œä¸­, è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥å¾€å¾€å’Œé™çº§ç­–ç•¥é…åˆä½¿ç”¨.")]),s._v(" "),t("p",[s._v("ä½¿ç”¨çº¿ç¨‹æ± , è¿˜è¦æ³¨æ„å¼‚å¸¸å¤„ç†çš„é—®é¢˜, ä¾‹å¦‚é€šè¿‡ ThreadPoolExecutor å¯¹è±¡çš„ execute() æ–¹æ³•æäº¤ä»»åŠ¡æ—¶, å¦‚æœä»»åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‡ºç°è¿è¡Œæ—¶å¼‚å¸¸, ä¼šå¯¼è‡´æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ç»ˆæ­¢; ä¸è¿‡, æœ€è‡´å‘½çš„æ˜¯ä»»åŠ¡è™½ç„¶å¼‚å¸¸äº†, ä½†æ˜¯å´è·å–ä¸åˆ°ä»»ä½•é€šçŸ¥, è¿™ä¼šè®©ä½ è¯¯ä»¥ä¸ºä»»åŠ¡éƒ½æ‰§è¡Œå¾—å¾ˆæ­£å¸¸. è™½ç„¶çº¿ç¨‹æ± æä¾›äº†å¾ˆå¤šç”¨äºå¼‚å¸¸å¤„ç†çš„æ–¹æ³•, ä½†æ˜¯æœ€ç¨³å¦¥å’Œç®€å•çš„æ–¹æ¡ˆè¿˜æ˜¯æ•è·æ‰€æœ‰å¼‚å¸¸å¹¶æŒ‰éœ€å¤„ç†, å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ä»£ç .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸šåŠ¡é€»è¾‘")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‰éœ€å¤„ç†")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‰éœ€å¤„ç†")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"_23-future-å¦‚ä½•ç”¨å¤šçº¿ç¨‹å®ç°æœ€ä¼˜çš„-çƒ§æ°´æ³¡èŒ¶-ç¨‹åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_23-future-å¦‚ä½•ç”¨å¤šçº¿ç¨‹å®ç°æœ€ä¼˜çš„-çƒ§æ°´æ³¡èŒ¶-ç¨‹åº"}},[s._v("#")]),s._v(' 23-Future:å¦‚ä½•ç”¨å¤šçº¿ç¨‹å®ç°æœ€ä¼˜çš„"çƒ§æ°´æ³¡èŒ¶"ç¨‹åº?')]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åˆ›å»ºæ­£ç¡®çš„çº¿ç¨‹æ± , é‚£åˆ›å»ºå®Œçº¿ç¨‹æ± , è¯¥å¦‚ä½•ä½¿ç”¨å‘¢? ä¸Šä¸€èŠ‚ä»…ä»…ä»‹ç»äº† ThreadPoolExecutor çš„ "),t("code",[s._v("void execute(Runnable command)")]),s._v("â€‹ æ–¹æ³•, åˆ©ç”¨è¿™ä¸ªæ–¹æ³•è™½ç„¶"),t("strong",[s._v("å¯ä»¥æäº¤ä»»åŠ¡, ä½†æ˜¯å´æ²¡æœ‰åŠæ³•è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœ(execute() æ–¹æ³•æ²¡æœ‰è¿”å›å€¼)")]),s._v(" . è€Œå¾ˆå¤šåœºæ™¯ä¸‹, åˆéƒ½æ˜¯éœ€è¦è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœçš„. é‚£ ThreadPoolExecutor æ˜¯å¦æä¾›äº†ç›¸å…³åŠŸèƒ½å‘¢? å¿…é¡»çš„, è¿™ä¹ˆé‡è¦çš„åŠŸèƒ½å½“ç„¶éœ€è¦æä¾›äº†.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹"),t("strong",[s._v("ä½¿ç”¨ ThreadPoolExecutor çš„æ—¶å€™, å¦‚ä½•è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"å¦‚ä½•è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ"}},[s._v("#")]),s._v(" å¦‚ä½•è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ")]),s._v(" "),t("p",[s._v("Java é€šè¿‡ "),t("strong",[s._v("ThreadPoolExecutor æä¾›çš„ 3 ä¸ª submit() æ–¹æ³•å’Œ 1 ä¸ª FutureTask å·¥å…·ç±»æ¥æ”¯æŒè·å¾—ä»»åŠ¡æ‰§è¡Œç»“æœçš„éœ€æ±‚")]),s._v(". ä¸‹é¢å…ˆæ¥ä»‹ç»è¿™ 3 ä¸ª submit() æ–¹æ³•, è¿™ 3 ä¸ªæ–¹æ³•çš„æ–¹æ³•ç­¾åå¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ Runnable ä»»åŠ¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ Callable ä»»åŠ¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Callable")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ Runnable ä»»åŠ¡åŠç»“æœå¼•ç”¨  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä½ ä¼šå‘ç°å®ƒä»¬çš„è¿”å›å€¼éƒ½æ˜¯ Future æ¥å£, Future æ¥å£æœ‰ 5 ä¸ªæ–¹æ³•, éƒ½åˆ—åœ¨ä¸‹é¢äº†, å®ƒä»¬åˆ†åˆ«æ˜¯"),t("strong",[s._v("å–æ¶ˆä»»åŠ¡çš„æ–¹æ³• cancel(), åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å–æ¶ˆçš„æ–¹æ³• isCancelled(), åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»“æŸçš„æ–¹æ³• isDone()"),t("strong",[s._v("â€‹"),t("strong",[t("strong",[s._v("ä»¥åŠ")])]),s._v(" "),t("strong",[s._v("2 ä¸ªè·å¾—ä»»åŠ¡æ‰§è¡Œç»“æœçš„ get() å’Œ get(timeout, unit)")]),s._v(" , å…¶ä¸­æœ€åä¸€ä¸ª get(timeout, unit) æ”¯æŒè¶…æ—¶æœºåˆ¶. é€šè¿‡ Future æ¥å£çš„è¿™ 5 ä¸ªæ–¹æ³•å¯ä»¥å‘ç°, "),t("strong",[s._v("æäº¤çš„ä»»åŠ¡ä¸ä½†èƒ½å¤Ÿè·å–ä»»åŠ¡æ‰§è¡Œç»“æœ, è¿˜å¯ä»¥å–æ¶ˆä»»åŠ¡")]),s._v(". ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯: è¿™ä¸¤ä¸ª get() æ–¹æ³•éƒ½æ˜¯")]),s._v("é˜»å¡å¼")]),s._v("çš„, å¦‚æœè¢«è°ƒç”¨çš„æ—¶å€™, ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ, é‚£ä¹ˆè°ƒç”¨ get() æ–¹æ³•çš„çº¿ç¨‹ä¼šé˜»å¡, ç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ‰ä¼šè¢«å”¤é†’.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å–æ¶ˆä»»åŠ¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cancel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" mayInterruptIfRunning"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å–æ¶ˆ  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isCancelled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»“æŸ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isDone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å¾—ä»»åŠ¡æ‰§è¡Œç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å¾—ä»»åŠ¡æ‰§è¡Œç»“æœ, æ”¯æŒè¶…æ—¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("è¿™ 3 ä¸ª submit() æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«åœ¨äº"),t("strong",[s._v("æ–¹æ³•å‚æ•°ä¸åŒ")]),s._v(", ä¸‹é¢ç®€è¦ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),t("ol",[t("li",[s._v("æäº¤ Runnable ä»»åŠ¡ "),t("code",[s._v("submit(Runnable task)")]),s._v("â€‹: è¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª "),t("strong",[s._v("Runnable æ¥å£")]),s._v(", Runnable æ¥å£çš„ run() æ–¹æ³•æ˜¯"),t("strong",[s._v("æ²¡æœ‰è¿”å›å€¼")]),s._v("çš„, æ‰€ä»¥ "),t("code",[s._v("submit(Runnable task)")]),s._v("â€‹ è¿™ä¸ªæ–¹æ³•è¿”å›çš„ "),t("strong",[s._v("Future ä»…å¯ä»¥ç”¨æ¥æ–­è¨€ä»»åŠ¡å·²ç»ç»“æŸ")]),s._v("äº†, ç±»ä¼¼äº Thread.join().")]),s._v(" "),t("li",[s._v("æäº¤ Callable ä»»åŠ¡ "),t("code",[s._v("submit(Callable<T> task)")]),s._v("â€‹: è¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª "),t("strong",[s._v("Callable æ¥å£")]),s._v(", å®ƒåªæœ‰ä¸€ä¸ª call() æ–¹æ³•, å¹¶ä¸”è¿™ä¸ªæ–¹æ³•æ˜¯"),t("strong",[s._v("æœ‰è¿”å›å€¼")]),s._v("çš„, æ‰€ä»¥è¿™ä¸ªæ–¹æ³•è¿”å›çš„ Future å¯¹è±¡"),t("strong",[s._v("å¯ä»¥é€šè¿‡è°ƒç”¨å…¶ get() æ–¹æ³•æ¥è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœ")]),s._v(".")]),s._v(" "),t("li",[s._v("æäº¤ Runnable ä»»åŠ¡åŠç»“æœå¼•ç”¨ "),t("code",[s._v("submit(Runnable task, T result)")]),s._v("â€‹: è¿™ä¸ªæ–¹æ³•å¾ˆæœ‰æ„æ€, å‡è®¾è¿™ä¸ªæ–¹æ³•è¿”å›çš„ Future å¯¹è±¡æ˜¯ f, f.get() çš„è¿”å›å€¼å°±æ˜¯ä¼ ç»™ submit() æ–¹æ³•çš„å‚æ•° result. è¿™ä¸ªæ–¹æ³•è¯¥æ€ä¹ˆç”¨å‘¢? ä¸‹é¢è¿™æ®µç¤ºä¾‹ä»£ç å±•ç¤ºäº†å®ƒçš„ç»å…¸ç”¨æ³•. éœ€è¦æ³¨æ„çš„æ˜¯ Runnable æ¥å£çš„å®ç°ç±» Task å£°æ˜äº†ä¸€ä¸ªæœ‰å‚æ„é€ å‡½æ•° "),t("code",[s._v("Task(Result r)")]),s._v("â€‹, åˆ›å»º Task å¯¹è±¡çš„æ—¶å€™ä¼ å…¥äº† result å¯¹è±¡, è¿™æ ·å°±èƒ½åœ¨ç±» Task çš„ run() æ–¹æ³•ä¸­å¯¹ result è¿›è¡Œå„ç§æ“ä½œäº†. result ç›¸å½“äºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ä¹‹é—´çš„æ¡¥æ¢, é€šè¿‡å®ƒä¸»å­çº¿ç¨‹å¯ä»¥å…±äº«æ•°æ®.")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º Result å¯¹è±¡ r")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAAA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ä»»åŠ¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" future "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),s._v(" fr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" future"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸‹é¢ç­‰å¼æˆç«‹")]),s._v("\nfr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nfr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAAA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nfr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getXXX")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥ result")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯ä»¥æ“ä½œ result")]),s._v("\n        a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAAA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setXXX")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("Â·Â·Â·")]),s._v(" "),t("p",[s._v("ä¸‹é¢å†æ¥ä»‹ç» "),t("strong",[s._v("FutureTask å·¥å…·ç±»")]),s._v(". å‰é¢æåˆ°çš„ Future æ˜¯ä¸€ä¸ªæ¥å£, è€Œ FutureTask æ˜¯ä¸€ä¸ªå®å®åœ¨åœ¨çš„å·¥å…·ç±», è¿™ä¸ªå·¥å…·ç±»æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°, å®ƒä»¬çš„å‚æ•°å’Œå‰é¢ä»‹ç»çš„ submit() æ–¹æ³•ç±»ä¼¼, æ‰€ä»¥è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Callable")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" callable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" runnable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("é‚£å¦‚ä½•ä½¿ç”¨ FutureTask å‘¢? å…¶å®å¾ˆç®€å•, "),t("strong",[s._v("FutureTask å®ç°äº† Runnable å’Œ Future æ¥å£, ç”±äºå®ç°äº† Runnable æ¥å£, æ‰€ä»¥å¯ä»¥å°† FutureTask å¯¹è±¡ä½œä¸ºä»»åŠ¡æäº¤ç»™ ThreadPoolExecutor å»æ‰§è¡Œ, ä¹Ÿå¯ä»¥ç›´æ¥è¢« Thread æ‰§è¡Œ; åˆå› ä¸ºå®ç°äº† Future æ¥å£, æ‰€ä»¥ä¹Ÿèƒ½ç”¨æ¥è·å¾—ä»»åŠ¡çš„æ‰§è¡Œç»“æœ")]),s._v(". ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯å°† FutureTask å¯¹è±¡æäº¤ç»™ ThreadPoolExecutor å»æ‰§è¡Œ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º FutureTask")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" futureTask "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCachedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ FutureTask ")]),s._v("\nes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("futureTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–è®¡ç®—ç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" futureTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("FutureTask å¯¹è±¡ç›´æ¥è¢« Thread æ‰§è¡Œçš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤º. ç›¸ä¿¡ä½ å·²ç»å‘ç°äº†, "),t("strong",[s._v("åˆ©ç”¨ FutureTask å¯¹è±¡å¯ä»¥å¾ˆå®¹æ˜“è·å–å­çº¿ç¨‹çš„æ‰§è¡Œç»“æœ")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º FutureTask")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" futureTask "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("futureTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–è®¡ç®—ç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" futureTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"å®ç°æœ€ä¼˜çš„-çƒ§æ°´æ³¡èŒ¶-ç¨‹åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°æœ€ä¼˜çš„-çƒ§æ°´æ³¡èŒ¶-ç¨‹åº"}},[s._v("#")]),s._v(' å®ç°æœ€ä¼˜çš„"çƒ§æ°´æ³¡èŒ¶"ç¨‹åº')]),s._v(" "),t("p",[s._v("è®°å¾—ä»¥å‰åˆä¸­è¯­æ–‡è¯¾æ–‡é‡Œæœ‰ä¸€ç¯‡è‘—åæ•°å­¦å®¶åç½—åºšå…ˆç”Ÿçš„æ–‡ç« ã€Šç»Ÿç­¹æ–¹æ³•ã€‹, è¿™ç¯‡æ–‡ç« é‡Œä»‹ç»äº†ä¸€ä¸ªçƒ§æ°´æ³¡èŒ¶çš„ä¾‹å­, æ–‡ä¸­æåˆ°æœ€ä¼˜çš„å·¥åºåº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/dfd8bd8b8389479a6509374b1a3d38ae-20230731162452-5nbart4.png",alt:"",title:"çƒ§æ°´æ³¡èŒ¶æœ€ä¼˜å·¥åº"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢ç”¨ç¨‹åºæ¥æ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªæœ€ä¼˜å·¥åº. å‰é¢æ›¾ç»æåˆ°, å¹¶å‘ç¼–ç¨‹å¯ä»¥æ€»ç»“ä¸ºä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜: "),t("strong",[s._v("åˆ†å·¥, åŒæ­¥å’Œäº’æ–¥")]),s._v(". ç¼–å†™å¹¶å‘ç¨‹åº, é¦–å…ˆè¦åšçš„å°±æ˜¯åˆ†å·¥, æ‰€è°“åˆ†å·¥æŒ‡çš„æ˜¯å¦‚ä½•é«˜æ•ˆåœ°æ‹†è§£ä»»åŠ¡å¹¶åˆ†é…ç»™çº¿ç¨‹. å¯¹äºçƒ§æ°´æ³¡èŒ¶è¿™ä¸ªç¨‹åº, ä¸€ç§æœ€ä¼˜çš„åˆ†å·¥æ–¹æ¡ˆå¯ä»¥æ˜¯ä¸‹å›¾æ‰€ç¤ºçš„è¿™æ ·: ç”¨ä¸¤ä¸ªçº¿ç¨‹ T1 å’Œ T2 æ¥å®Œæˆçƒ§æ°´æ³¡èŒ¶ç¨‹åº, T1 è´Ÿè´£æ´—æ°´å£¶, çƒ§å¼€æ°´, æ³¡èŒ¶è¿™ä¸‰é“å·¥åº, T2 è´Ÿè´£æ´—èŒ¶å£¶, æ´—èŒ¶æ¯, æ‹¿èŒ¶å¶ä¸‰é“å·¥åº, å…¶ä¸­ T1 åœ¨æ‰§è¡Œæ³¡èŒ¶è¿™é“å·¥åºæ—¶éœ€è¦ç­‰å¾… T2 å®Œæˆæ‹¿èŒ¶å¶çš„å·¥åº. å¯¹äº T1 çš„è¿™ä¸ªç­‰å¾…åŠ¨ä½œ, ä½ åº”è¯¥å¯ä»¥æƒ³å‡ºå¾ˆå¤šç§åŠæ³•, ä¾‹å¦‚ Thread.join(), CountDownLatch, ç”šè‡³é˜»å¡é˜Ÿåˆ—éƒ½å¯ä»¥è§£å†³, ä¸è¿‡ä»Šå¤©ç”¨ Future ç‰¹æ€§æ¥å®ç°.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4f95b782869f7e48ae4ded1ce5c1cddc-20230731162452-otyrhd4.png",alt:"",title:"çƒ§æ°´æ³¡èŒ¶æœ€ä¼˜åˆ†å·¥æ–¹æ¡ˆ"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°±æ˜¯ç”¨è¿™ä¸€ç« æåˆ°çš„ Future ç‰¹æ€§æ¥å®ç°çš„. é¦–å…ˆåˆ›å»ºäº†ä¸¤ä¸ª FutureTask -- ft1 å’Œ ft2, ft1 å®Œæˆæ´—æ°´å£¶, çƒ§å¼€æ°´, æ³¡èŒ¶çš„ä»»åŠ¡, ft2 å®Œæˆæ´—èŒ¶å£¶, æ´—èŒ¶æ¯, æ‹¿èŒ¶å¶çš„ä»»åŠ¡; è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ ft1 è¿™ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œæ³¡èŒ¶ä»»åŠ¡å‰, éœ€è¦ç­‰å¾… ft2 æŠŠèŒ¶å¶æ‹¿æ¥, æ‰€ä»¥ ft1 å†…éƒ¨éœ€è¦å¼•ç”¨ ft2, å¹¶åœ¨æ‰§è¡Œæ³¡èŒ¶ä¹‹å‰, è°ƒç”¨ ft2 çš„ get() æ–¹æ³•å®ç°ç­‰å¾….")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä»»åŠ¡ T2 çš„ FutureTask")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ft2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T2Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä»»åŠ¡ T1 çš„ FutureTask")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ft1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T1Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ft2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹ T1 æ‰§è¡Œä»»åŠ¡ ft1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ft1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹ T2 æ‰§è¡Œä»»åŠ¡ ft2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ft2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…çº¿ç¨‹ T1 æ‰§è¡Œç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ft1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// T1Task éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡: ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ´—æ°´å£¶, çƒ§å¼€æ°´, æ³¡èŒ¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T1Task")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Callable")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ft2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// T1 ä»»åŠ¡éœ€è¦ T2 ä»»åŠ¡çš„ FutureTask")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T1Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ft2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ft2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ft2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T1: æ´—æ°´å£¶..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T1: çƒ§å¼€æ°´..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å– T2 çº¿ç¨‹çš„èŒ¶å¶  ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" tf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ft2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T1: æ‹¿åˆ°èŒ¶å¶:"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" tf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T1: æ³¡èŒ¶..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ä¸ŠèŒ¶:"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" tf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// T2Task éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ´—èŒ¶å£¶, æ´—èŒ¶æ¯, æ‹¿èŒ¶å¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T2Task")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Callable")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T2: æ´—èŒ¶å£¶..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T2: æ´—èŒ¶æ¯..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T2: æ‹¿èŒ¶å¶..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" é¾™äº• "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸€æ¬¡æ‰§è¡Œç»“æœ: ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ´—æ°´å£¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ´—èŒ¶å£¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" çƒ§å¼€æ°´"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ´—èŒ¶æ¯"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ‹¿èŒ¶å¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ‹¿åˆ°èŒ¶å¶"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" é¾™äº•\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ³¡èŒ¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nä¸ŠèŒ¶"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" é¾™äº•\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-16"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-16"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("åˆ©ç”¨ Java å¹¶å‘åŒ…æä¾›çš„ Future å¯ä»¥"),t("strong",[s._v("å¾ˆå®¹æ˜“è·å¾—å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœ")]),s._v(", æ— è®ºå¼‚æ­¥ä»»åŠ¡æ˜¯é€šè¿‡çº¿ç¨‹æ±  ThreadPoolExecutor æ‰§è¡Œçš„, è¿˜æ˜¯é€šè¿‡æ‰‹å·¥åˆ›å»ºå­çº¿ç¨‹æ¥æ‰§è¡Œçš„. Future å¯ä»¥ç±»æ¯”ä¸ºç°å®ä¸–ç•Œé‡Œçš„æè´§å•, æ¯”å¦‚å»è›‹ç³•åº—è®¢ç”Ÿæ—¥è›‹ç³•, è›‹ç³•åº—éƒ½æ˜¯å…ˆç»™ä½ ä¸€å¼ æè´§å•, ä½ æ‹¿åˆ°æè´§å•ä¹‹å, æ²¡æœ‰å¿…è¦ä¸€ç›´åœ¨åº—é‡Œç­‰ç€, å¯ä»¥å…ˆå»å¹²ç‚¹å…¶ä»–äº‹, æ¯”å¦‚çœ‹åœºç”µå½±; ç­‰çœ‹å®Œç”µå½±å, åŸºæœ¬ä¸Šè›‹ç³•ä¹Ÿåšå¥½äº†, ç„¶åä½ å°±å¯ä»¥å‡­æè´§å•é¢†è›‹ç³•äº†.")]),s._v(" "),t("p",[s._v("åˆ©ç”¨å¤šçº¿ç¨‹å¯ä»¥å¿«é€Ÿå°†ä¸€äº›ä¸²è¡Œçš„ä»»åŠ¡å¹¶è¡ŒåŒ–, ä»è€Œæé«˜æ€§èƒ½; å¦‚æœä»»åŠ¡ä¹‹é—´æœ‰ä¾èµ–å…³ç³», æ¯”å¦‚å½“å‰ä»»åŠ¡ä¾èµ–å‰ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœ, è¿™ç§é—®é¢˜åŸºæœ¬ä¸Šéƒ½å¯ä»¥ç”¨ Future æ¥è§£å†³. åœ¨åˆ†æè¿™ç§é—®é¢˜çš„è¿‡ç¨‹ä¸­, å»ºè®®ç”¨æœ‰å‘å›¾æè¿°ä¸€ä¸‹ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³», åŒæ—¶å°†çº¿ç¨‹çš„åˆ†å·¥ä¹Ÿåšå¥½, ç±»ä¼¼äºçƒ§æ°´æ³¡èŒ¶æœ€ä¼˜åˆ†å·¥æ–¹æ¡ˆé‚£å¹…å›¾. å¯¹ç…§å›¾æ¥å†™ä»£ç , å¥½å¤„æ˜¯æ›´å½¢è±¡, ä¸”ä¸æ˜“å‡ºé”™.")]),s._v(" "),t("h4",{attrs:{id:"_24-completablefuture-å¼‚æ­¥ç¼–ç¨‹æ²¡é‚£ä¹ˆéš¾ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_24-completablefuture-å¼‚æ­¥ç¼–ç¨‹æ²¡é‚£ä¹ˆéš¾ğŸ€"}},[s._v("#")]),s._v(" 24-CompletableFuture:å¼‚æ­¥ç¼–ç¨‹æ²¡é‚£ä¹ˆéš¾ğŸ€")]),s._v(" "),t("p",[s._v("å‰é¢ä¸æ­¢ä¸€æ¬¡æåˆ°, ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–æ€§èƒ½, å…¶å®ä¸è¿‡å°±æ˜¯å°†ä¸²è¡Œæ“ä½œå˜æˆå¹¶è¡Œæ“ä½œ. å¦‚æœä»”ç»†è§‚å¯Ÿ, è¿˜å¯ä»¥å‘ç°åœ¨ä¸²è¡Œè½¬æ¢æˆå¹¶è¡Œçš„è¿‡ç¨‹ä¸­, ä¸€å®šä¼šæ¶‰åŠåˆ°"),t("strong",[s._v("å¼‚æ­¥åŒ–")]),s._v(", ä¾‹å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç , ç°åœ¨æ˜¯ä¸²è¡Œçš„, ä¸ºäº†æå‡æ€§èƒ½, å¾—æŠŠå®ƒä»¬å¹¶è¡ŒåŒ–, é‚£å…·ä½“å®æ–½èµ·æ¥è¯¥æ€ä¹ˆåšå‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è€—æ—¶æ“ä½œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doBizA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doBizB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿˜æ˜¯æŒºç®€å•çš„, å°±åƒä¸‹é¢ä»£ç ä¸­è¿™æ ·, åˆ›å»ºä¸¤ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œå°±å¯ä»¥äº†. ä½ ä¼šå‘ç°ä¸‹é¢çš„å¹¶è¡Œæ–¹æ¡ˆ, ä¸»çº¿ç¨‹æ— éœ€ç­‰å¾… doBizA() å’Œ doBizB() çš„æ‰§è¡Œç»“æœ, ä¹Ÿå°±æ˜¯è¯´ doBizA() å’Œ doBizB() ä¸¤ä¸ªæ“ä½œå·²ç»è¢«å¼‚æ­¥åŒ–äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doBizA")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doBizB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("å¼‚æ­¥åŒ–")]),s._v(", æ˜¯å¹¶è¡Œæ–¹æ¡ˆå¾—ä»¥å®æ–½çš„åŸºç¡€, æ›´æ·±å…¥åœ°è®²å…¶å®å°±æ˜¯: "),t("strong",[s._v("åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–æ€§èƒ½è¿™ä¸ªæ ¸å¿ƒæ–¹æ¡ˆå¾—ä»¥å®æ–½çš„åŸºç¡€")]),s._v(". çœ‹åˆ°è¿™é‡Œ, ç›¸ä¿¡ä½ åº”è¯¥å°±èƒ½ç†è§£å¼‚æ­¥ç¼–ç¨‹æœ€è¿‘å‡ å¹´ä¸ºä»€ä¹ˆä¼šå¤§ç«äº†, å› ä¸ºä¼˜åŒ–æ€§èƒ½æ˜¯äº’è”ç½‘å¤§å‚çš„ä¸€ä¸ªæ ¸å¿ƒéœ€æ±‚å•Š. Java åœ¨ 1.8 ç‰ˆæœ¬æä¾›äº† "),t("strong",[s._v("CompletableFuture æ¥æ”¯æŒå¼‚æ­¥ç¼–ç¨‹")]),s._v(", CompletableFuture æœ‰å¯èƒ½æ˜¯ä½ è§è¿‡çš„æœ€å¤æ‚çš„å·¥å…·ç±»äº†, ä¸è¿‡åŠŸèƒ½ä¹Ÿç€å®è®©äººæ„Ÿåˆ°éœ‡æ’¼.")]),s._v(" "),t("h5",{attrs:{id:"completablefutureçš„æ ¸å¿ƒä¼˜åŠ¿"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#completablefutureçš„æ ¸å¿ƒä¼˜åŠ¿"}},[s._v("#")]),s._v(" CompletableFutureçš„æ ¸å¿ƒä¼˜åŠ¿")]),s._v(" "),t("p",[s._v("ä¸ºäº†é¢†ç•¥ CompletableFuture å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿, è¿™é‡Œç”¨ CompletableFuture é‡æ–°å®ç°å‰é¢æ›¾æåŠçš„çƒ§æ°´æ³¡èŒ¶ç¨‹åº. é¦–å…ˆè¿˜æ˜¯éœ€è¦å…ˆå®Œæˆåˆ†å·¥æ–¹æ¡ˆ, åœ¨ä¸‹é¢çš„ç¨‹åºä¸­, åˆ†äº† 3 ä¸ªä»»åŠ¡: ä»»åŠ¡ 1 è´Ÿè´£æ´—æ°´å£¶, çƒ§å¼€æ°´, ä»»åŠ¡ 2 è´Ÿè´£æ´—èŒ¶å£¶, æ´—èŒ¶æ¯å’Œæ‹¿èŒ¶å¶, ä»»åŠ¡ 3 è´Ÿè´£æ³¡èŒ¶. å…¶ä¸­ä»»åŠ¡ 3 è¦ç­‰å¾…ä»»åŠ¡ 1 å’Œä»»åŠ¡ 2 éƒ½å®Œæˆåæ‰èƒ½å¼€å§‹. è¿™ä¸ªåˆ†å·¥å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/675bdf8b5e51a5c61f649171e4c0453c-20230731162452-ma8k7yn.png",alt:"",title:"çƒ§æ°´æ³¡èŒ¶åˆ†å·¥æ–¹æ¡ˆ"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢æ˜¯ä»£ç å®ç°, å…ˆç•¥è¿‡ runAsync(), supplyAsync(), thenCombine() è¿™äº›ä¸å¤ªç†Ÿæ‚‰çš„æ–¹æ³•, ä»å¤§å±€ä¸Šçœ‹, ä½ ä¼šå‘ç°:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("æ— éœ€æ‰‹å·¥ç»´æŠ¤çº¿ç¨‹")]),s._v(", æ²¡æœ‰ç¹ççš„æ‰‹å·¥ç»´æŠ¤çº¿ç¨‹çš„å·¥ä½œ, ç»™ä»»åŠ¡åˆ†é…çº¿ç¨‹çš„å·¥ä½œä¹Ÿä¸éœ€è¦å…³æ³¨;")]),s._v(" "),t("li",[s._v("è¯­ä¹‰æ›´æ¸…æ™°, ä¾‹å¦‚ "),t("code",[s._v("f3 = f1.thenCombine(f2, ()->{})")]),s._v('â€‹ èƒ½å¤Ÿæ¸…æ™°åœ°è¡¨è¿° "ä»»åŠ¡ 3 è¦ç­‰å¾…ä»»åŠ¡ 1 å’Œä»»åŠ¡ 2 éƒ½å®Œæˆåæ‰èƒ½å¼€å§‹";')]),s._v(" "),t("li",[t("strong",[s._v("ä»£ç æ›´ç®€ç»ƒå¹¶ä¸”ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘, å‡ ä¹æ‰€æœ‰ä»£ç éƒ½æ˜¯ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„")]),s._v(".")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»»åŠ¡ 1: æ´—æ°´å£¶ -> çƒ§å¼€æ°´")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T1: æ´—æ°´å£¶..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T1: çƒ§å¼€æ°´..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»»åŠ¡ 2: æ´—èŒ¶å£¶ -> æ´—èŒ¶æ¯ -> æ‹¿èŒ¶å¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("supplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T2: æ´—èŒ¶å£¶..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T2: æ´—èŒ¶æ¯..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T2: æ‹¿èŒ¶å¶..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" é¾™äº• "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»»åŠ¡ 3: ä»»åŠ¡ 1 å’Œä»»åŠ¡ 2 å®Œæˆåæ‰§è¡Œ: æ³¡èŒ¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenCombine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T1: æ‹¿åˆ°èŒ¶å¶:"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" tf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"T1: æ³¡èŒ¶..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ä¸ŠèŒ¶:"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" tf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…ä»»åŠ¡ 3 æ‰§è¡Œç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" sleep "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" u"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        u"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸€æ¬¡æ‰§è¡Œç»“æœ: ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ´—æ°´å£¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ´—èŒ¶å£¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" çƒ§å¼€æ°´"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ´—èŒ¶æ¯"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ‹¿èŒ¶å¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ‹¿åˆ°èŒ¶å¶"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" é¾™äº•\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("T1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ³¡èŒ¶"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nä¸ŠèŒ¶"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" é¾™äº•\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("é¢†ç•¥ CompletableFuture å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿ä¹‹å, ä¸‹é¢è¯¦ç»†ä»‹ç» CompletableFuture çš„ä½¿ç”¨, é¦–å…ˆæ˜¯å¦‚ä½•åˆ›å»º CompletableFuture å¯¹è±¡.")]),s._v(" "),t("h5",{attrs:{id:"åˆ›å»ºcompletablefutureå¯¹è±¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºcompletablefutureå¯¹è±¡"}},[s._v("#")]),s._v(" åˆ›å»ºCompletableFutureå¯¹è±¡")]),s._v(" "),t("p",[s._v("åˆ›å»º CompletableFuture å¯¹è±¡ä¸»è¦é ä¸‹é¢ä»£ç ä¸­å±•ç¤ºçš„è¿™ 4 ä¸ªé™æ€æ–¹æ³•, å…ˆçœ‹å‰ä¸¤ä¸ª. åœ¨çƒ§æ°´æ³¡èŒ¶çš„ä¾‹å­ä¸­, å·²ç»ä½¿ç”¨äº† "),t("code",[s._v("runAsync(Runnable runnable)")]),s._v("â€‹ å’Œ "),t("code",[s._v("supplyAsync(Supplier<U> supplier)")]),s._v("â€‹, å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯: "),t("strong",[s._v("Runnable æ¥å£çš„ run() æ–¹æ³•æ²¡æœ‰è¿”å›å€¼, è€Œ Supplier æ¥å£çš„ get() æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å‰ä¸¤ä¸ªæ–¹æ³•å’Œåä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«åœ¨äº: "),t("strong",[s._v("åä¸¤ä¸ªæ–¹æ³•å¯ä»¥æŒ‡å®šçº¿ç¨‹æ± å‚æ•°")]),s._v(".")]),s._v(" "),t("p",[s._v("é»˜è®¤æƒ…å†µä¸‹ CompletableFuture ä¼šä½¿ç”¨å…¬å…±çš„ ForkJoinPool çº¿ç¨‹æ± , è¿™ä¸ªçº¿ç¨‹æ± é»˜è®¤åˆ›å»ºçš„çº¿ç¨‹æ•°æ˜¯ CPU çš„æ ¸æ•°(ä¹Ÿå¯ä»¥é€šè¿‡ "),t("code",[s._v("JVM option:-Djava.util.concurrent.ForkJoinPool.common.parallelism")]),s._v("â€‹ æ¥è®¾ç½® ForkJoinPool çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°). å¦‚æœæ‰€æœ‰ CompletableFuture å…±äº«ä¸€ä¸ªçº¿ç¨‹æ± , é‚£ä¹ˆä¸€æ—¦æœ‰ä»»åŠ¡æ‰§è¡Œä¸€äº›å¾ˆæ…¢çš„ I/O æ“ä½œ, å°±ä¼šå¯¼è‡´çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹éƒ½é˜»å¡åœ¨ I/O æ“ä½œä¸Š, ä»è€Œé€ æˆçº¿ç¨‹é¥¥é¥¿, è¿›è€Œå½±å“æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½. æ‰€ä»¥, å¼ºçƒˆå»ºè®®è¦"),t("strong",[s._v("æ ¹æ®ä¸åŒçš„ä¸šåŠ¡ç±»å‹åˆ›å»ºä¸åŒçš„çº¿ç¨‹æ± , ä»¥é¿å…äº’ç›¸å¹²æ‰°")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" runnable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("supplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" supplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯ä»¥æŒ‡å®šçº¿ç¨‹æ±   ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" runnable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("supplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" supplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("åˆ›å»ºå®Œ CompletableFuture å¯¹è±¡ä¹‹å, ä¼šè‡ªåŠ¨åœ°å¼‚æ­¥æ‰§è¡Œ runnable.run() æ–¹æ³•æˆ–è€… supplier.get() æ–¹æ³•")]),s._v(", å¯¹äºä¸€ä¸ªå¼‚æ­¥æ“ä½œ, éœ€è¦å…³æ³¨ä¸¤ä¸ªé—®é¢˜: "),t("strong",[s._v("ä¸€ä¸ªæ˜¯å¼‚æ­¥æ“ä½œä»€ä¹ˆæ—¶å€™ç»“æŸ, å¦ä¸€ä¸ªæ˜¯å¦‚ä½•è·å–å¼‚æ­¥æ“ä½œçš„æ‰§è¡Œç»“æœ")]),s._v(". å› ä¸º CompletableFuture ç±»å®ç°äº† Future æ¥å£, æ‰€ä»¥è¿™ä¸¤ä¸ªé—®é¢˜éƒ½å¯ä»¥é€šè¿‡ Future æ¥å£æ¥è§£å†³. å¦å¤–, CompletableFuture ç±»è¿˜å®ç°äº† CompletionStage æ¥å£, è¿™ä¸ªæ¥å£å†…å®¹å®åœ¨æ˜¯å¤ªä¸°å¯Œäº†, åœ¨ 1.8 ç‰ˆæœ¬é‡Œæœ‰ 40 ä¸ªæ–¹æ³•, è¿™äº›æ–¹æ³•è¯¥å¦‚ä½•ç†è§£å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"å¦‚ä½•ç†è§£completionstageæ¥å£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ç†è§£completionstageæ¥å£"}},[s._v("#")]),s._v(" å¦‚ä½•ç†è§£CompletionStageæ¥å£")]),s._v(" "),t("p",[s._v("æˆ‘è§‰å¾—å¯ä»¥"),t("strong",[s._v("ç«™åœ¨åˆ†å·¥çš„è§’åº¦ç±»æ¯”ä¸€ä¸‹å·¥ä½œæµ")]),s._v(". ä»»åŠ¡æ˜¯æœ‰æ—¶åºå…³ç³»çš„, æ¯”å¦‚æœ‰"),t("strong",[s._v("ä¸²è¡Œå…³ç³», å¹¶è¡Œå…³ç³», æ±‡èšå…³ç³»")]),s._v("ç­‰. è¿™æ ·è¯´å¯èƒ½æœ‰ç‚¹æŠ½è±¡, è¿™é‡Œè¿˜ä¸¾å‰é¢çƒ§æ°´æ³¡èŒ¶çš„ä¾‹å­, å…¶ä¸­æ´—æ°´å£¶å’Œçƒ§å¼€æ°´å°±æ˜¯ä¸²è¡Œå…³ç³», æ´—æ°´å£¶, çƒ§å¼€æ°´å’Œæ´—èŒ¶å£¶, æ´—èŒ¶æ¯è¿™ä¸¤ç»„ä»»åŠ¡ä¹‹é—´å°±æ˜¯å¹¶è¡Œå…³ç³», è€Œçƒ§å¼€æ°´, æ‹¿èŒ¶å¶å’Œæ³¡èŒ¶å°±æ˜¯æ±‡èšå…³ç³».")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cd90e09d864209195d2623c63420602d-20230731162452-aq4ty57.png",alt:"",title:"ä¸²è¡Œå…³ç³»"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0e01bc4362b9b677026dcf3e1ec8ba67-20230731162452-6ujeyya.png",alt:"",title:"å¹¶è¡Œå…³ç³»"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/61727821e6993a508b7cac74c3500d29-20230731162452-d84fzb9.png",alt:"",title:"æ±‡èšå…³ç³»"}})]),s._v(" "),t("p",[t("strong",[s._v("CompletionStage æ¥å£å¯ä»¥æ¸…æ™°åœ°æè¿°ä»»åŠ¡ä¹‹é—´çš„è¿™ç§æ—¶åºå…³ç³»")]),s._v(", ä¾‹å¦‚å‰é¢æåˆ°çš„ "),t("code",[s._v("f3 = f1.thenCombine(f2, ()->{})")]),s._v("â€‹ æè¿°çš„å°±æ˜¯ä¸€ç§æ±‡èšå…³ç³». çƒ§æ°´æ³¡èŒ¶ç¨‹åºä¸­çš„æ±‡èšå…³ç³»æ˜¯ä¸€ç§ AND èšåˆå…³ç³», è¿™é‡Œçš„ AND æŒ‡çš„æ˜¯æ‰€æœ‰ä¾èµ–çš„ä»»åŠ¡(çƒ§å¼€æ°´å’Œæ‹¿èŒ¶å¶)éƒ½å®Œæˆåæ‰å¼€å§‹æ‰§è¡Œå½“å‰ä»»åŠ¡(æ³¡èŒ¶). æ—¢ç„¶æœ‰ AND èšåˆå…³ç³», é‚£å°±ä¸€å®šè¿˜æœ‰ OR èšåˆå…³ç³», "),t("strong",[s._v("æ‰€è°“ OR æŒ‡çš„æ˜¯ä¾èµ–çš„ä»»åŠ¡åªè¦æœ‰ä¸€ä¸ªå®Œæˆå°±å¯ä»¥æ‰§è¡Œå½“å‰ä»»åŠ¡")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ç¼–ç¨‹é¢†åŸŸ, è¿˜æœ‰ä¸€ä¸ªç»•ä¸è¿‡å»çš„å±±å¤´, é‚£å°±æ˜¯å¼‚å¸¸å¤„ç†, CompletionStage æ¥å£ä¹Ÿå¯ä»¥"),t("strong",[s._v("æ–¹ä¾¿åœ°æè¿°å¼‚å¸¸å¤„ç†")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ¥ä¸€ä¸€ä»‹ç», CompletionStage æ¥å£å¦‚ä½•æè¿°ä¸²è¡Œå…³ç³», AND èšåˆå…³ç³», OR èšåˆå…³ç³»ä»¥åŠå¼‚å¸¸å¤„ç†.")]),s._v(" "),t("h6",{attrs:{id:"_1-æè¿°ä¸²è¡Œå…³ç³»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æè¿°ä¸²è¡Œå…³ç³»"}},[s._v("#")]),s._v(" (1)æè¿°ä¸²è¡Œå…³ç³»")]),s._v(" "),t("p",[s._v("CompletionStage æ¥å£é‡Œé¢æè¿°ä¸²è¡Œå…³ç³», ä¸»è¦æ˜¯ "),t("strong",[s._v("thenApply, thenAccept, thenRun å’Œ thenCompose")]),s._v(" è¿™å››ä¸ªç³»åˆ—çš„æ¥å£.")]),s._v(" "),t("p",[s._v("thenApply ç³»åˆ—å‡½æ•°é‡Œå‚æ•° fn çš„ç±»å‹æ˜¯æ¥å£ "),t("code",[s._v("Function<T, R>")]),s._v("â€‹, è¿™ä¸ªæ¥å£é‡Œä¸ CompletionStage ç›¸å…³çš„æ–¹æ³•æ˜¯ "),t("code",[s._v("R apply(T t)")]),s._v("â€‹, è¿™ä¸ªæ–¹æ³•æ—¢èƒ½æ¥æ”¶å‚æ•°ä¹Ÿæ”¯æŒè¿”å›å€¼, æ‰€ä»¥ thenApply ç³»åˆ—æ–¹æ³•è¿”å›çš„æ˜¯"),t("code",[s._v("CompletionStage<R>")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("è€Œ thenAccept ç³»åˆ—æ–¹æ³•é‡Œå‚æ•° consumer çš„ç±»å‹æ˜¯æ¥å£ "),t("code",[s._v("Consumer<T>")]),s._v("â€‹, è¿™ä¸ªæ¥å£é‡Œä¸ CompletionStage ç›¸å…³çš„æ–¹æ³•æ˜¯ "),t("code",[s._v("void accept(T t)")]),s._v("â€‹, è¿™ä¸ªæ–¹æ³•è™½ç„¶æ”¯æŒå‚æ•°, ä½†å´ä¸æ”¯æŒå›å€¼, æ‰€ä»¥ thenAccept ç³»åˆ—æ–¹æ³•è¿”å›çš„æ˜¯ "),t("code",[s._v("CompletionStage<Void>")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("thenRun ç³»åˆ—æ–¹æ³•é‡Œ action çš„å‚æ•°æ˜¯ Runnable, æ‰€ä»¥ action æ—¢ä¸èƒ½æ¥æ”¶å‚æ•°ä¹Ÿä¸æ”¯æŒè¿”å›å€¼, æ‰€ä»¥ thenRun ç³»åˆ—æ–¹æ³•è¿”å›çš„ä¹Ÿæ˜¯ "),t("code",[s._v("CompletionStage<Void>")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("è¿™äº›æ–¹æ³•é‡Œé¢ Async ä»£è¡¨çš„æ˜¯å¼‚æ­¥æ‰§è¡Œ fn, consumer æˆ–è€… action. å…¶ä¸­, éœ€è¦æ³¨æ„çš„æ˜¯ thenCompose ç³»åˆ—æ–¹æ³•, è¿™ä¸ªç³»åˆ—çš„æ–¹æ³•ä¼š"),t("strong",[s._v("æ–°åˆ›å»ºå‡ºä¸€ä¸ªå­æµç¨‹, æœ€ç»ˆç»“æœå’Œ thenApply ç³»åˆ—æ˜¯ç›¸åŒçš„")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenApply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenApplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenAccept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenAcceptAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenRun")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenRunAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenCompose")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenComposeAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("é€šè¿‡ä¸‹é¢çš„ç¤ºä¾‹ä»£ç , å¯ä»¥çœ‹ä¸€ä¸‹ thenApply() æ–¹æ³•æ˜¯å¦‚ä½•ä½¿ç”¨çš„. é¦–å…ˆé€šè¿‡ supplyAsync() "),t("strong",[s._v("å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥æµç¨‹")]),s._v(", ä¹‹åæ˜¯ä¸¤ä¸ªä¸²è¡Œæ“ä½œ, æ•´ä½“çœ‹èµ·æ¥è¿˜æ˜¯æŒºç®€å•çš„. ä¸è¿‡è™½ç„¶è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æµç¨‹, ä½†ä»»åŠ¡ â‘ â‘¡â‘¢ å´æ˜¯ä¸²è¡Œæ‰§è¡Œçš„,  â‘¡ ä¾èµ– â‘  çš„æ‰§è¡Œç»“æœ, â‘¢ ä¾èµ– â‘¡ çš„æ‰§è¡Œç»“æœ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("supplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//â‘ ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenApply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" QQ"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//â‘¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenApply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toUpperCase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//â‘¢")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¾“å‡ºç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// HELLO WORLD QQ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h6",{attrs:{id:"_2-æè¿°andæ±‡èšå…³ç³»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æè¿°andæ±‡èšå…³ç³»"}},[s._v("#")]),s._v(" (2)æè¿°ANDæ±‡èšå…³ç³»")]),s._v(" "),t("p",[s._v("CompletionStage æ¥å£é‡Œé¢æè¿° AND æ±‡èšå…³ç³», ä¸»è¦æ˜¯ "),t("strong",[s._v("thenCombine, thenAcceptBoth å’Œ runAfterBoth")]),s._v(" ç³»åˆ—çš„æ¥å£, è¿™äº›æ¥å£çš„åŒºåˆ«ä¹Ÿæ˜¯æºè‡ª fn, consumer, action è¿™ä¸‰ä¸ªæ ¸å¿ƒå‚æ•°ä¸åŒ. å®ƒä»¬çš„ä½¿ç”¨å¯ä»¥å‚è€ƒä¸Šé¢çƒ§æ°´æ³¡èŒ¶çš„å®ç°ç¨‹åº, è¿™é‡Œå°±ä¸èµ˜è¿°äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenCombine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenCombineAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenAcceptBoth")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenAcceptBothAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runAfterBoth")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runAfterBothAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h6",{attrs:{id:"_3-æè¿°oræ±‡èšå…³ç³»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æè¿°oræ±‡èšå…³ç³»"}},[s._v("#")]),s._v(" (3)æè¿°ORæ±‡èšå…³ç³»")]),s._v(" "),t("p",[s._v("CompletionStage æ¥å£é‡Œé¢æè¿° OR æ±‡èšå…³ç³», ä¸»è¦æ˜¯ "),t("strong",[s._v("applyToEither, acceptEither å’Œ runAfterEither")]),s._v(" ç³»åˆ—çš„æ¥å£, è¿™äº›æ¥å£çš„åŒºåˆ«ä¹Ÿæ˜¯æºè‡ª fn, consumer, action è¿™ä¸‰ä¸ªæ ¸å¿ƒå‚æ•°ä¸åŒ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("applyToEither")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("applyToEitherAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acceptEither")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acceptEitherAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runAfterEither")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runAfterEitherAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("other"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ applyToEither() æ–¹æ³•æ¥æè¿°ä¸€ä¸ª OR æ±‡èšå…³ç³».")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("supplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRandom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("valueOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("supplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRandom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("valueOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("applyToEither")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h6",{attrs:{id:"_4-å¼‚å¸¸å¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-å¼‚å¸¸å¤„ç†"}},[s._v("#")]),s._v(" (4)å¼‚å¸¸å¤„ç†")]),s._v(" "),t("p",[s._v("è™½ç„¶ä¸Šé¢æåˆ°çš„ fn, consumer, action å®ƒä»¬çš„æ ¸å¿ƒæ–¹æ³•éƒ½"),t("strong",[s._v("ä¸å…è®¸æŠ›å‡ºå¯æ£€æŸ¥å¼‚å¸¸, ä½†æ˜¯å´æ— æ³•é™åˆ¶å®ƒä»¬æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸")]),s._v(", ä¾‹å¦‚ä¸‹é¢çš„ä»£ç , æ‰§è¡Œ "),t("code",[s._v("7/0")]),s._v("â€‹ å°±ä¼šå‡ºç°é™¤é›¶é”™è¯¯è¿™ä¸ªè¿è¡Œæ—¶å¼‚å¸¸. éå¼‚æ­¥ç¼–ç¨‹é‡Œé¢, å¯ä»¥ä½¿ç”¨ "),t("code",[s._v("try{} catch{}")]),s._v("â€‹ æ¥æ•è·å¹¶å¤„ç†å¼‚å¸¸, é‚£åœ¨å¼‚æ­¥ç¼–ç¨‹é‡Œé¢, å¼‚å¸¸è¯¥å¦‚ä½•å¤„ç†å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("supplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenApply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("CompletionStage æ¥å£æä¾›çš„æ–¹æ¡ˆéå¸¸ç®€å•, æ¯” try{} catch{} è¿˜è¦ç®€å•, ä¸‹é¢æ˜¯ç›¸å…³çš„æ–¹æ³•, ä½¿ç”¨è¿™äº›æ–¹æ³•"),t("strong",[s._v("è¿›è¡Œå¼‚å¸¸å¤„ç†å’Œä¸²è¡Œæ“ä½œæ˜¯ä¸€æ ·çš„, éƒ½æ”¯æŒé“¾å¼ç¼–ç¨‹æ–¹å¼")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exceptionally")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("whenComplete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("whenCompleteAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionStage")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("R")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ exceptionally() æ–¹æ³•æ¥å¤„ç†å¼‚å¸¸, exceptionally() çš„ä½¿ç”¨éå¸¸ç±»ä¼¼äº  "),t("code",[s._v("try{} catch{}")]),s._v("â€‹ ä¸­çš„ catch{}, ä½†æ˜¯ç”±äºæ”¯æŒé“¾å¼ç¼–ç¨‹æ–¹å¼, æ‰€ä»¥ç›¸å¯¹æ›´ç®€å•. æ—¢ç„¶æœ‰ "),t("code",[s._v("try{} catch{}")]),s._v("â€‹, é‚£å°±ä¸€å®šè¿˜æœ‰ "),t("code",[s._v("try{} finally{}")]),s._v("â€‹, "),t("strong",[s._v("whenComplete() å’Œ handle() ç³»åˆ—æ–¹æ³•")]),s._v("å°±ç±»ä¼¼äº "),t("code",[s._v("try{} finally{}")]),s._v("â€‹ ä¸­çš„ finally{}, æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ "),t("strong",[s._v("whenComplete() ä¸­çš„å›è°ƒå‡½æ•°")]),s._v(" consumer å’Œ handle() ä¸­çš„å›è°ƒå‡½æ•° fn. whenComplete() å’Œ handle() çš„åŒºåˆ«åœ¨äº whenComplete() ä¸æ”¯æŒè¿”å›ç»“æœ, è€Œ handle() æ˜¯æ”¯æŒè¿”å›ç»“æœçš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" \n  f0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletableFuture")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("supplyAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("thenApply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exceptionally")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-17"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-17"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("æ›¾ç»ä¸€æåˆ°å¼‚æ­¥ç¼–ç¨‹, å¤§å®¶è„‘æµ·é‡Œéƒ½ä¼šéšä¹‹æµ®ç°å›è°ƒå‡½æ•°, ä¾‹å¦‚åœ¨ JavaScript é‡Œé¢å¼‚æ­¥é—®é¢˜åŸºæœ¬ä¸Šéƒ½æ˜¯é å›è°ƒå‡½æ•°æ¥è§£å†³çš„, å›è°ƒå‡½æ•°åœ¨å¤„ç†å¼‚å¸¸ä»¥åŠå¤æ‚çš„å¼‚æ­¥ä»»åŠ¡å…³ç³»æ—¶å¾€å¾€åŠ›ä¸ä»å¿ƒ, å¯¹æ­¤ä¸šç•Œè¿˜å‘æ˜äº†ä¸ªåè¯: "),t("strong",[s._v("å›è°ƒåœ°ç‹±")]),s._v("(Callback Hell). åº”è¯¥è¯´åœ¨å‰äº›å¹´, å¼‚æ­¥ç¼–ç¨‹è¿˜æ˜¯å£°åç‹¼è—‰çš„.")]),s._v(" "),t("p",[s._v("ä¸è¿‡æœ€è¿‘å‡ å¹´, å¼‚æ­¥ç¼–ç¨‹å·²ç»æ…¢æ…¢å¼€å§‹æˆç†Ÿ, Java è¯­è¨€ä¹Ÿå¼€å§‹å®˜æ–¹æ”¯æŒå¼‚æ­¥ç¼–ç¨‹: åœ¨ 1.8 ç‰ˆæœ¬æä¾›äº† CompletableFuture, åœ¨ Java 9 ç‰ˆæœ¬åˆ™æä¾›äº†æ›´åŠ å®Œå¤‡çš„ Flow API, å¼‚æ­¥ç¼–ç¨‹ç›®å‰å·²ç»å®Œå…¨å·¥ä¸šåŒ–. å› æ­¤, å­¦å¥½å¼‚æ­¥ç¼–ç¨‹è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„. CompletableFuture å·²ç»èƒ½å¤Ÿæ»¡è¶³ç®€å•çš„å¼‚æ­¥ç¼–ç¨‹éœ€æ±‚, å¦‚æœå¯¹å¼‚æ­¥ç¼–ç¨‹æ„Ÿå…´è¶£, å¯ä»¥é‡ç‚¹å…³æ³¨ RxJava è¿™ä¸ªé¡¹ç›®.")]),s._v(" "),t("h4",{attrs:{id:"_25-completionservice-å¦‚ä½•æ‰¹é‡æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡-ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_25-completionservice-å¦‚ä½•æ‰¹é‡æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡-ğŸ€"}},[s._v("#")]),s._v(" 25-CompletionService:å¦‚ä½•æ‰¹é‡æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡?ğŸ€")]),s._v(" "),t("p",[s._v("æ€è€ƒä¸€ä¸ªé—®é¢˜: å°æ˜è¦åšä¸€ä¸ªè¯¢ä»·åº”ç”¨, è¿™ä¸ªåº”ç”¨éœ€è¦ä»ä¸‰ä¸ªç”µå•†è¯¢ä»·, ç„¶åä¿å­˜åœ¨è‡ªå·±çš„æ•°æ®åº“é‡Œ. æ ¸å¿ƒç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤º, ç”±äºæ˜¯ä¸²è¡Œçš„, æ‰€ä»¥æ€§èƒ½å¾ˆæ…¢, è¯•ç€ä¼˜åŒ–ä¸€ä¸‹å§.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘ç”µå•† S1 è¯¢ä»·, å¹¶ä¿å­˜")]),s._v("\nr1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘ç”µå•† S2 è¯¢ä»·, å¹¶ä¿å­˜")]),s._v("\nr2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘ç”µå•† S3 è¯¢ä»·, å¹¶ä¿å­˜")]),s._v("\nr3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v('å¦‚æœé‡‡ç”¨ "ThreadPoolExecutor + Future" çš„æ–¹æ¡ˆ, ä½ çš„ä¼˜åŒ–ç»“æœå¾ˆå¯èƒ½æ˜¯ä¸‹é¢ç¤ºä¾‹ä»£ç è¿™æ ·: ç”¨ä¸‰ä¸ªçº¿ç¨‹å¼‚æ­¥æ‰§è¡Œè¯¢ä»·, é€šè¿‡ä¸‰æ¬¡è°ƒç”¨ Future çš„ get() æ–¹æ³•è·å–è¯¢ä»·ç»“æœ, ä¹‹åå°†è¯¢ä»·ç»“æœä¿å­˜åœ¨æ•°æ®åº“ä¸­.')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¼‚æ­¥å‘ç”µå•† S1 è¯¢ä»·")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¼‚æ­¥å‘ç”µå•† S2 è¯¢ä»·")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¼‚æ­¥å‘ç”µå•† S3 è¯¢ä»·")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–ç”µå•† S1 æŠ¥ä»·å¹¶ä¿å­˜")]),s._v("\nr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–ç”µå•† S2 æŠ¥ä»·å¹¶ä¿å­˜")]),s._v("\nr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–ç”µå•† S3 æŠ¥ä»·å¹¶ä¿å­˜  ")]),s._v("\nr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„è¿™ä¸ªæ–¹æ¡ˆæœ¬èº«æ²¡æœ‰å¤ªå¤§é—®é¢˜, ä½†æ˜¯æœ‰ä¸ªåœ°æ–¹çš„å¤„ç†éœ€è¦æ³¨æ„, é‚£å°±æ˜¯å¦‚æœè·å–ç”µå•† S1 æŠ¥ä»·çš„è€—æ—¶å¾ˆé•¿, é‚£ä¹ˆå³ä¾¿è·å–ç”µå•† S2 æŠ¥ä»·çš„è€—æ—¶å¾ˆçŸ­, ä¹Ÿæ— æ³•è®©ä¿å­˜ S2 æŠ¥ä»·çš„æ“ä½œå…ˆæ‰§è¡Œ, å› ä¸ºè¿™ä¸ª"),t("strong",[s._v("ä¸»çº¿ç¨‹éƒ½é˜»å¡")]),s._v("åœ¨äº† "),t("code",[s._v("f1.get()")]),s._v("â€‹ æ“ä½œä¸Š. è¿™ç‚¹å°ç‘•ç–µè¯¥å¦‚ä½•è§£å†³å‘¢?")]),s._v(" "),t("p",[s._v("ä¼°è®¡ä½ å·²ç»æƒ³åˆ°äº†, å¢åŠ ä¸€ä¸ª"),t("strong",[s._v("é˜»å¡é˜Ÿåˆ—")]),s._v(", è·å–åˆ° S1, S2, S3 çš„æŠ¥ä»·"),t("strong",[s._v("éƒ½è¿›å…¥é˜»å¡é˜Ÿåˆ—")]),s._v(", ç„¶å"),t("strong",[s._v("åœ¨ä¸»çº¿ç¨‹ä¸­æ¶ˆè´¹é˜»å¡é˜Ÿåˆ—, è¿™æ ·å°±èƒ½ä¿è¯å…ˆè·å–åˆ°çš„æŠ¥ä»·å…ˆä¿å­˜åˆ°æ•°æ®åº“")]),s._v("äº†. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨é˜»å¡é˜Ÿåˆ—å®ç°å…ˆè·å–åˆ°çš„æŠ¥ä»·å…ˆä¿å­˜åˆ°æ•°æ®åº“.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºé˜»å¡é˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" bq "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”µå•† S1 æŠ¥ä»·å¼‚æ­¥è¿›å…¥é˜»å¡é˜Ÿåˆ—  ")]),s._v("\nexecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”µå•† S2 æŠ¥ä»·å¼‚æ­¥è¿›å…¥é˜»å¡é˜Ÿåˆ—  ")]),s._v("\nexecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”µå•† S3 æŠ¥ä»·å¼‚æ­¥è¿›å…¥é˜»å¡é˜Ÿåˆ—  ")]),s._v("\nexecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¼‚æ­¥ä¿å­˜æ‰€æœ‰æŠ¥ä»·  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»é˜»å¡é˜Ÿåˆ—è·å–ç»“æœè¿›è¡Œæ¶ˆè´¹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h5",{attrs:{id:"åˆ©ç”¨completionserviceå®ç°è¯¢ä»·ç³»ç»Ÿ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ©ç”¨completionserviceå®ç°è¯¢ä»·ç³»ç»Ÿ"}},[s._v("#")]),s._v(" åˆ©ç”¨CompletionServiceå®ç°è¯¢ä»·ç³»ç»Ÿ")]),s._v(" "),t("p",[s._v("ä¸è¿‡åœ¨å®é™…é¡¹ç›®ä¸­, å¹¶ä¸å»ºè®®è¿™æ ·åš, å› ä¸º Java SDK å¹¶å‘åŒ…é‡Œå·²ç»æä¾›äº†è®¾è®¡ç²¾è‰¯çš„ "),t("strong",[s._v("CompletionService")]),s._v(". åˆ©ç”¨ CompletionService ä¸ä½†èƒ½è§£å†³å…ˆè·å–åˆ°çš„æŠ¥ä»·å…ˆä¿å­˜åˆ°æ•°æ®åº“çš„é—®é¢˜, è€Œä¸”è¿˜èƒ½è®©ä»£ç æ›´ç®€ç»ƒ.")]),s._v(" "),t("p",[t("strong",[s._v("CompletionService çš„å®ç°åŸç†ä¹Ÿæ˜¯å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—, å½“ä»»åŠ¡æ‰§è¡Œç»“æŸå°±æŠŠä»»åŠ¡çš„æ‰§è¡Œç»“æœåŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­, ä¸åŒçš„æ˜¯ CompletionService æ˜¯æŠŠä»»åŠ¡æ‰§è¡Œç»“æœçš„ Future å¯¹è±¡åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­")]),s._v(", è€Œä¸Šé¢çš„ç¤ºä¾‹ä»£ç æ˜¯æŠŠä»»åŠ¡æœ€ç»ˆçš„æ‰§è¡Œç»“æœæ”¾å…¥äº†é˜»å¡é˜Ÿåˆ—ä¸­.")]),s._v(" "),t("p",[s._v("**é‚£åˆ°åº•è¯¥å¦‚ä½•åˆ›å»º CompletionService å‘¢? **")]),s._v(" "),t("p",[s._v("CompletionService æ¥å£çš„å®ç°ç±»æ˜¯ "),t("strong",[s._v("ExecutorCompletionService")]),s._v(", è¿™ä¸ªå®ç°ç±»çš„æ„é€ æ–¹æ³•æœ‰ä¸¤ä¸ª, åˆ†åˆ«æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorCompletionService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorCompletionService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" completionQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•éƒ½éœ€è¦"),t("strong",[s._v("ä¼ å…¥ä¸€ä¸ªçº¿ç¨‹æ± ")]),s._v(", å¦‚æœä¸æŒ‡å®š completionQueue, é‚£ä¹ˆé»˜è®¤ä¼šä½¿ç”¨æ— ç•Œçš„ LinkedBlockingQueue. "),t("strong",[s._v("ä»»åŠ¡æ‰§è¡Œç»“æœçš„ Future å¯¹è±¡å°±æ˜¯åŠ å…¥åˆ° completionQueue ä¸­")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å®Œæ•´åœ°å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ CompletionService æ¥å®ç°é«˜æ€§èƒ½çš„è¯¢ä»·ç³»ç»Ÿ. å…¶ä¸­æ²¡æœ‰æŒ‡å®š completionQueue, å› æ­¤é»˜è®¤ä½¿ç”¨æ— ç•Œçš„ LinkedBlockingQueue. ä¹‹åé€šè¿‡ CompletionService æ¥å£æä¾›çš„ submit() æ–¹æ³•æäº¤äº†ä¸‰ä¸ªè¯¢ä»·æ“ä½œ, "),t("strong",[s._v("è¿™ä¸‰ä¸ªè¯¢ä»·æ“ä½œå°†ä¼šè¢« CompletionService å¼‚æ­¥æ‰§è¡Œ")]),s._v(". æœ€åé€šè¿‡ CompletionService æ¥å£æä¾›çš„ take() æ–¹æ³•è·å–ä¸€ä¸ª Future å¯¹è±¡(å‰é¢æåˆ°è¿‡, åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­çš„æ˜¯ä»»åŠ¡æ‰§è¡Œç»“æœçš„ Future å¯¹è±¡), "),t("strong",[s._v("è°ƒç”¨ Future å¯¹è±¡çš„ get() æ–¹æ³•å°±èƒ½è¿”å›è¯¢ä»·æ“ä½œçš„æ‰§è¡Œç»“æœ")]),s._v("äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º CompletionService")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionService")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorCompletionService")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¼‚æ­¥å‘ç”µå•† S1 è¯¢ä»·")]),s._v("\ncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¼‚æ­¥å‘ç”µå•† S2 è¯¢ä»·")]),s._v("\ncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¼‚æ­¥å‘ç”µå•† S3 è¯¢ä»·")]),s._v("\ncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPriceByS3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†è¯¢ä»·ç»“æœå¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h5",{attrs:{id:"completionserviceæ¥å£è¯´æ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#completionserviceæ¥å£è¯´æ˜"}},[s._v("#")]),s._v(" CompletionServiceæ¥å£è¯´æ˜")]),s._v(" "),t("p",[s._v("ä¸‹é¢è¯¦ç»†åœ°ä»‹ç»ä¸€ä¸‹ CompletionService æ¥å£æä¾›çš„æ–¹æ³•, CompletionService æ¥å£æä¾›çš„æ–¹æ³•æœ‰ 5 ä¸ª, è¿™ 5 ä¸ªæ–¹æ³•çš„æ–¹æ³•ç­¾åå¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("p",[s._v("å…¶ä¸­, submit() ç›¸å…³çš„æ–¹æ³•æœ‰ä¸¤ä¸ª. ä¸€ä¸ªæ–¹æ³•å‚æ•°æ˜¯ "),t("code",[s._v("Callable<V> task")]),s._v("â€‹, å‰é¢åˆ©ç”¨ CompletionService å®ç°è¯¢ä»·ç³»ç»Ÿçš„ç¤ºä¾‹ä»£ç ä¸­, æäº¤ä»»åŠ¡å°±æ˜¯ç”¨çš„å®ƒ. å¦å¤–ä¸€ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°, åˆ†åˆ«æ˜¯ "),t("code",[s._v("Runnable task")]),s._v("â€‹ å’Œ "),t("code",[s._v("V result")]),s._v("â€‹, è¿™ä¸ªæ–¹æ³•ç±»ä¼¼äº ThreadPoolExecutor çš„ "),t("code",[s._v("<T> Future<T> submit(Runnable task, T result)")]),s._v("â€‹, è¿™ä¸ªæ–¹æ³•å‰é¢å·²è¯¦ç»†ä»‹ç»è¿‡, è¿™é‡Œä¸å†èµ˜è¿°.")]),s._v(" "),t("p",[s._v("CompletionService æ¥å£å…¶ä½™çš„ 3 ä¸ªæ–¹æ³•, éƒ½æ˜¯å’Œé˜»å¡é˜Ÿåˆ—ç›¸å…³çš„, "),t("strong",[s._v("take(), poll() éƒ½æ˜¯ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–å¹¶ç§»é™¤ä¸€ä¸ªå…ƒç´ ; å®ƒä»¬çš„åŒºåˆ«åœ¨äºå¦‚æœé˜»å¡é˜Ÿåˆ—æ˜¯ç©ºçš„, é‚£ä¹ˆè°ƒç”¨ take() æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡, è€Œ poll() æ–¹æ³•ä¼šè¿”å› null å€¼")]),s._v(". "),t("code",[s._v("poll(long timeout, TimeUnit unit)")]),s._v("â€‹ æ–¹æ³•æ”¯æŒä»¥è¶…æ—¶çš„æ–¹å¼è·å–å¹¶ç§»é™¤é˜»å¡é˜Ÿåˆ—å¤´éƒ¨çš„ä¸€ä¸ªå…ƒç´ , å¦‚æœç­‰å¾…äº† timeout unit æ—¶é—´, é˜»å¡é˜Ÿåˆ—è¿˜æ˜¯ç©ºçš„, é‚£ä¹ˆè¯¥æ–¹æ³•ä¼šè¿”å› null å€¼.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Callable")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h5",{attrs:{id:"åˆ©ç”¨completionserviceå®ç°dubboä¸­çš„forking-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ©ç”¨completionserviceå®ç°dubboä¸­çš„forking-cluster"}},[s._v("#")]),s._v(" åˆ©ç”¨CompletionServiceå®ç°Dubboä¸­çš„Forking Cluster")]),s._v(" "),t("p",[s._v("Dubbo ä¸­æœ‰ä¸€ç§å«åš "),t("strong",[s._v("Forking çš„é›†ç¾¤æ¨¡å¼")]),s._v(", è¿™ç§é›†ç¾¤æ¨¡å¼ä¸‹, æ”¯æŒ"),t("strong",[s._v("å¹¶è¡Œåœ°è°ƒç”¨å¤šä¸ªæŸ¥è¯¢æœåŠ¡, åªè¦æœ‰ä¸€ä¸ªæˆåŠŸè¿”å›ç»“æœ, æ•´ä¸ªæœåŠ¡å°±å¯ä»¥è¿”å›äº†")]),s._v(". ä¾‹å¦‚éœ€è¦æä¾›ä¸€ä¸ªåœ°å€è½¬åæ ‡çš„æœåŠ¡, ä¸ºäº†ä¿è¯è¯¥æœåŠ¡çš„é«˜å¯ç”¨å’Œæ€§èƒ½, å¯ä»¥å¹¶è¡Œåœ°è°ƒç”¨ 3 ä¸ªåœ°å›¾æœåŠ¡å•†çš„ API, ç„¶ååªè¦æœ‰ 1 ä¸ªæ­£ç¡®è¿”å›äº†ç»“æœ r, é‚£ä¹ˆåœ°å€è½¬åæ ‡è¿™ä¸ªæœåŠ¡å°±å¯ä»¥ç›´æ¥è¿”å› r äº†. è¿™ç§é›†ç¾¤æ¨¡å¼å¯ä»¥å®¹å¿ 2 ä¸ªåœ°å›¾æœåŠ¡å•†æœåŠ¡å¼‚å¸¸, ä½†ç¼ºç‚¹æ˜¯æ¶ˆè€—çš„èµ„æºåå¤š.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("geocoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¹¶è¡Œæ‰§è¡Œä»¥ä¸‹ 3 ä¸ªæŸ¥è¯¢æœåŠ¡,  ")]),s._v("\n    r1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("geocoderByS1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    r2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("geocoderByS2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    r3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("geocoderByS3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åªè¦ r1,r2,r3 æœ‰ä¸€ä¸ªè¿”å›")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ™è¿”å›")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" r1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" r2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" r3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("strong",[s._v("åˆ©ç”¨ CompletionService å¯ä»¥å¿«é€Ÿå®ç° Forking è¿™ç§é›†ç¾¤æ¨¡å¼")]),s._v(", æ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°±å±•ç¤ºäº†å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„. é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ±  executor, ä¸€ä¸ª CompletionService å¯¹è±¡ cs å’Œä¸€ä¸ª "),t("code",[s._v("Future<Integer>")]),s._v("â€‹ ç±»å‹çš„åˆ—è¡¨ futures, æ¯æ¬¡é€šè¿‡è°ƒç”¨ CompletionService çš„ submit() æ–¹æ³•æäº¤ä¸€ä¸ª"),t("strong",[s._v("å¼‚æ­¥ä»»åŠ¡")]),s._v(", ä¼šè¿”å›ä¸€ä¸ª Future å¯¹è±¡, æŠŠè¿™äº› Future å¯¹è±¡ä¿å­˜åœ¨åˆ—è¡¨ futures ä¸­. é€šè¿‡è°ƒç”¨ "),t("code",[s._v("cs.take().get()")]),s._v("â€‹, èƒ½å¤Ÿæ‹¿åˆ°æœ€å¿«è¿”å›çš„ä»»åŠ¡æ‰§è¡Œç»“æœ, åªè¦æ‹¿åˆ°ä¸€ä¸ªæ­£ç¡®è¿”å›çš„ç»“æœ, å°±"),t("strong",[s._v("å¯ä»¥å–æ¶ˆæ‰€æœ‰ä»»åŠ¡å¹¶ä¸”è¿”å›æœ€ç»ˆç»“æœ")]),s._v("äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º CompletionService")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionService")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorCompletionService")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨äºä¿å­˜ Future å¯¹è±¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" futures "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤å¼‚æ­¥ä»»åŠ¡, å¹¶ä¿å­˜ future åˆ° futures ")]),s._v("\nfutures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("geocoderByS1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nfutures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("geocoderByS2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nfutures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("geocoderByS3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–æœ€å¿«è¿”å›çš„ä»»åŠ¡æ‰§è¡Œç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åªè¦æœ‰ä¸€ä¸ªæˆåŠŸè¿”å›, åˆ™ break")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç®€å•åœ°é€šè¿‡åˆ¤ç©ºæ¥æ£€æŸ¥æ˜¯å¦æˆåŠŸè¿”å›")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å–æ¶ˆæ‰€æœ‰ä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Future")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" futures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cancel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›ç»“æœ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-18"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-18"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[t("strong",[s._v("å½“éœ€è¦æ‰¹é‡æäº¤å¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™å»ºè®®ä½¿ç”¨ CompletionService. CompletionService å°†çº¿ç¨‹æ±  Executor å’Œé˜»å¡é˜Ÿåˆ— BlockingQueue çš„åŠŸèƒ½èåˆåœ¨äº†ä¸€èµ·, èƒ½å¤Ÿè®©æ‰¹é‡å¼‚æ­¥ä»»åŠ¡çš„ç®¡ç†æ›´ç®€å•. é™¤æ­¤ä¹‹å¤–, CompletionService èƒ½å¤Ÿè®©å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœæœ‰åºåŒ–, å…ˆæ‰§è¡Œå®Œçš„å…ˆè¿›å…¥é˜»å¡é˜Ÿåˆ—, åˆ©ç”¨è¿™ä¸ªç‰¹æ€§, å¯ä»¥è½»æ¾å®ç°åç»­å¤„ç†çš„æœ‰åºæ€§, é¿å…æ— è°“çš„ç­‰å¾…, åŒæ—¶è¿˜å¯ä»¥å¿«é€Ÿå®ç°è¯¸å¦‚ Forking Cluster è¿™æ ·çš„éœ€æ±‚")]),s._v(".")]),s._v(" "),t("p",[s._v("CompletionService çš„å®ç°ç±» ExecutorCompletionService, éœ€è¦è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± , è™½çœ‹ä¸Šå»æœ‰äº›å•°å—¦, ä½†å¥½å¤„æ˜¯å¯ä»¥è®©å¤šä¸ª ExecutorCompletionService çš„çº¿ç¨‹æ± éš”ç¦», è¿™ç§éš”ç¦»æ€§èƒ½é¿å…å‡ ä¸ªç‰¹åˆ«è€—æ—¶çš„ä»»åŠ¡æ‹–å®æ•´ä¸ªåº”ç”¨çš„é£é™©.")]),s._v(" "),t("h4",{attrs:{id:"_26-fork-join-å•æœºç‰ˆçš„mapreduce"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_26-fork-join-å•æœºç‰ˆçš„mapreduce"}},[s._v("#")]),s._v(" 26-Fork/Join:å•æœºç‰ˆçš„MapReduce")]),s._v(" "),t("p",[s._v("å‰é¢å‡ ç¯‡æ–‡ç« ä»‹ç»äº†çº¿ç¨‹æ± , Future, CompletableFuture å’Œ CompletionService, ä»”ç»†è§‚å¯Ÿä¼šå‘ç°è¿™äº›å·¥å…·ç±»éƒ½æ˜¯"),t("strong",[s._v("ç«™åœ¨ä»»åŠ¡çš„è§†è§’")]),s._v("æ¥è§£å†³å¹¶å‘é—®é¢˜, è€Œä¸æ˜¯çº ç¼ åœ¨çº¿ç¨‹ä¹‹é—´å¦‚ä½•åä½œçš„ç»†èŠ‚ä¸Š(æ¯”å¦‚çº¿ç¨‹ä¹‹é—´å¦‚ä½•å®ç°ç­‰å¾…, é€šçŸ¥ç­‰). "),t("strong",[s._v('å¯¹äºç®€å•çš„å¹¶è¡Œä»»åŠ¡, å¯ä»¥é€šè¿‡ "çº¿ç¨‹æ±  +Future" çš„æ–¹æ¡ˆæ¥è§£å†³; å¦‚æœä»»åŠ¡ä¹‹é—´æœ‰èšåˆå…³ç³», æ— è®ºæ˜¯ AND èšåˆè¿˜æ˜¯ OR èšåˆ, éƒ½å¯ä»¥é€šè¿‡ CompletableFuture æ¥è§£å†³; è€Œæ‰¹é‡çš„å¹¶è¡Œä»»åŠ¡, åˆ™å¯ä»¥é€šè¿‡ CompletionService æ¥è§£å†³.')])]),s._v(" "),t("p",[s._v("å‰é¢ä¸€ç›´è®², å¹¶å‘ç¼–ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå±‚é¢çš„é—®é¢˜, åˆ†åˆ«æ˜¯åˆ†å·¥, åä½œå’Œäº’æ–¥, å½“å…³æ³¨äºä»»åŠ¡çš„æ—¶å€™, ä¼šå‘ç°ä½ çš„è§†è§’å·²ç»ä»å¹¶å‘ç¼–ç¨‹çš„ç»†èŠ‚ä¸­è·³å‡ºæ¥äº†, ä½ åº”ç”¨çš„æ›´å¤šçš„æ˜¯ç°å®ä¸–ç•Œçš„æ€ç»´æ¨¡å¼, ç±»æ¯”çš„å¾€å¾€æ˜¯ç°å®ä¸–ç•Œé‡Œçš„åˆ†å·¥, æ‰€ä»¥æˆ‘"),t("strong",[s._v("æŠŠçº¿ç¨‹æ± , Future, CompletableFuture å’Œ CompletionService éƒ½åˆ—åˆ°äº†åˆ†å·¥")]),s._v("é‡Œé¢.")]),s._v(" "),t("p",[s._v("ä¸‹é¢ç”¨ç°å®ä¸–ç•Œé‡Œçš„å·¥ä½œæµç¨‹å›¾æè¿°äº†å¹¶å‘ç¼–ç¨‹é¢†åŸŸçš„ç®€å•å¹¶è¡Œä»»åŠ¡, èšåˆä»»åŠ¡å’Œæ‰¹é‡å¹¶è¡Œä»»åŠ¡, è¾…ä»¥è¿™äº›æµç¨‹å›¾, ç›¸ä¿¡ä½ ä¸€å®šèƒ½å°†ä½ çš„æ€ç»´æ¨¡å¼è½¬æ¢åˆ°ç°å®ä¸–ç•Œé‡Œæ¥.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7bb80ebe35bcb7b1637e737943f32c02-20230731162452-zehx3uc.png",alt:"",title:"ä»ä¸Šåˆ°ä¸‹, ä¾æ¬¡ä¸ºç®€å•å¹¶è¡Œä»»åŠ¡, èšåˆä»»åŠ¡å’Œæ‰¹é‡å¹¶è¡Œä»»åŠ¡ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v('ä¸Šé¢æåˆ°çš„ç®€å•å¹¶è¡Œ, èšåˆ, æ‰¹é‡å¹¶è¡Œè¿™ä¸‰ç§ä»»åŠ¡æ¨¡å‹, åŸºæœ¬ä¸Šèƒ½å¤Ÿè¦†ç›–æ—¥å¸¸å·¥ä½œä¸­çš„å¹¶å‘åœºæ™¯äº†, ä½†è¿˜æ˜¯ä¸å¤Ÿå…¨é¢, å› ä¸ºè¿˜æœ‰ä¸€ç§ "åˆ†æ²»" çš„ä»»åŠ¡æ¨¡å‹æ²¡æœ‰è¦†ç›–åˆ°. '),t("strong",[s._v("åˆ†æ²»")]),s._v(", é¡¾åæ€ä¹‰, å³åˆ†è€Œæ²»ä¹‹, æ˜¯ä¸€ç§è§£å†³å¤æ‚é—®é¢˜çš„æ€ç»´æ–¹æ³•å’Œæ¨¡å¼; å…·ä½“æ¥è®², æŒ‡çš„æ˜¯"),t("strong",[s._v("æŠŠä¸€ä¸ªå¤æ‚çš„é—®é¢˜åˆ†è§£æˆå¤šä¸ªç›¸ä¼¼çš„å­é—®é¢˜, ç„¶åå†æŠŠå­é—®é¢˜åˆ†è§£æˆæ›´å°çš„å­é—®é¢˜, ç›´åˆ°å­é—®é¢˜ç®€å•åˆ°å¯ä»¥ç›´æ¥æ±‚è§£")]),s._v(". ç†è®ºä¸Šæ¥è®², è§£å†³æ¯ä¸€ä¸ªé—®é¢˜éƒ½å¯¹åº”ç€ä¸€ä¸ªä»»åŠ¡, æ‰€ä»¥å¯¹äºé—®é¢˜çš„åˆ†æ²», å®é™…ä¸Šå°±æ˜¯å¯¹äºä»»åŠ¡çš„åˆ†æ²».")]),s._v(" "),t("p",[s._v("åˆ†æ²»æ€æƒ³åœ¨å¾ˆå¤šé¢†åŸŸéƒ½æœ‰å¹¿æ³›çš„åº”ç”¨, ä¾‹å¦‚ç®—æ³•é¢†åŸŸæœ‰åˆ†æ²»ç®—æ³•(å½’å¹¶æ’åº, å¿«é€Ÿæ’åºéƒ½å±äºåˆ†æ²»ç®—æ³•, äºŒåˆ†æ³•æŸ¥æ‰¾ä¹Ÿæ˜¯ä¸€ç§åˆ†æ²»ç®—æ³•); å¤§æ•°æ®é¢†åŸŸçŸ¥åçš„è®¡ç®—æ¡†æ¶ "),t("strong",[s._v("MapReduce")]),s._v(" èƒŒåçš„æ€æƒ³ä¹Ÿæ˜¯åˆ†æ²». æ—¢ç„¶åˆ†æ²»è¿™ç§ä»»åŠ¡æ¨¡å‹å¦‚æ­¤æ™®é, é‚£ Java æ˜¾ç„¶ä¹Ÿéœ€è¦æ”¯æŒ, Java å¹¶å‘åŒ…é‡Œæä¾›äº†ä¸€ç§å«åš Fork/Join çš„å¹¶è¡Œè®¡ç®—æ¡†æ¶, å°±æ˜¯ç”¨æ¥æ”¯æŒåˆ†æ²»è¿™ç§ä»»åŠ¡æ¨¡å‹çš„.")]),s._v(" "),t("h5",{attrs:{id:"åˆ†æ²»ä»»åŠ¡æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†æ²»ä»»åŠ¡æ¨¡å‹"}},[s._v("#")]),s._v(" åˆ†æ²»ä»»åŠ¡æ¨¡å‹")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦å…ˆæ·±å…¥äº†è§£ä¸€ä¸‹åˆ†æ²»ä»»åŠ¡æ¨¡å‹, åˆ†æ²»ä»»åŠ¡æ¨¡å‹å¯åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ: ä¸€ä¸ªé˜¶æ®µæ˜¯"),t("strong",[s._v("ä»»åŠ¡åˆ†è§£")]),s._v(", ä¹Ÿå°±æ˜¯å°†ä»»åŠ¡è¿­ä»£åœ°åˆ†è§£ä¸ºå­ä»»åŠ¡, ç›´è‡³å­ä»»åŠ¡å¯ä»¥ç›´æ¥è®¡ç®—å‡ºç»“æœ; å¦ä¸€ä¸ªé˜¶æ®µæ˜¯"),t("strong",[s._v("ç»“æœåˆå¹¶")]),s._v(", å³é€å±‚åˆå¹¶å­ä»»åŠ¡çš„æ‰§è¡Œç»“æœ, ç›´è‡³è·å¾—æœ€ç»ˆç»“æœ. ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€åŒ–çš„åˆ†æ²»ä»»åŠ¡æ¨¡å‹å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/60ddb6b705384d40eda6d88e6eeb5a12-20230731162452-2ii2c72.png",alt:"",title:"ç®€ç‰ˆåˆ†æ²»ä»»åŠ¡æ¨¡å‹å›¾"}})]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªåˆ†æ²»ä»»åŠ¡æ¨¡å‹é‡Œ, "),t("strong",[s._v("ä»»åŠ¡å’Œåˆ†è§£åçš„å­ä»»åŠ¡å…·æœ‰ç›¸ä¼¼æ€§, è¿™ç§ç›¸ä¼¼æ€§å¾€å¾€ä½“ç°åœ¨ä»»åŠ¡å’Œå­ä»»åŠ¡çš„ç®—æ³•æ˜¯ç›¸åŒçš„, ä½†æ˜¯è®¡ç®—çš„æ•°æ®è§„æ¨¡æ˜¯ä¸åŒçš„")]),s._v(". å…·å¤‡è¿™ç§ç›¸ä¼¼æ€§çš„é—®é¢˜, å¾€å¾€éƒ½é‡‡ç”¨"),t("strong",[s._v("é€’å½’ç®—æ³•")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"fork-joinçš„ä½¿ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fork-joinçš„ä½¿ç”¨"}},[s._v("#")]),s._v(" Fork/Joinçš„ä½¿ç”¨")]),s._v(" "),t("p",[s._v("Fork/Join æ˜¯ä¸€ä¸ªå¹¶è¡Œè®¡ç®—çš„æ¡†æ¶, ä¸»è¦å°±æ˜¯ç”¨æ¥æ”¯æŒåˆ†æ²»ä»»åŠ¡æ¨¡å‹çš„, è¿™ä¸ªè®¡ç®—æ¡†æ¶é‡Œçš„ "),t("strong",[s._v("Fork å¯¹åº”çš„æ˜¯åˆ†æ²»ä»»åŠ¡æ¨¡å‹é‡Œçš„ä»»åŠ¡åˆ†è§£, Join å¯¹åº”çš„æ˜¯ç»“æœåˆå¹¶")]),s._v(". Fork/Join è®¡ç®—æ¡†æ¶ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†, ä¸€éƒ¨åˆ†æ˜¯"),t("mark",[t("strong",[s._v("åˆ†æ²»ä»»åŠ¡çš„çº¿ç¨‹æ±  ForkJoinPool")])]),s._v(", å¦ä¸€éƒ¨åˆ†æ˜¯"),t("mark",[t("strong",[s._v("åˆ†æ²»ä»»åŠ¡ ForkJoinTask")])]),s._v(". è¿™ä¸¤éƒ¨åˆ†çš„å…³ç³»ç±»ä¼¼äº ThreadPoolExecutor å’Œ Runnable çš„å…³ç³», éƒ½å¯ä»¥ç†è§£ä¸ºæäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± , åªä¸è¿‡åˆ†æ²»ä»»åŠ¡æœ‰è‡ªå·±ç‹¬ç‰¹ç±»å‹ ForkJoinTask.")]),s._v(" "),t("p",[s._v("ForkJoinTask æ˜¯ä¸€ä¸ªæŠ½è±¡ç±», å®ƒçš„æ–¹æ³•æœ‰å¾ˆå¤š, "),t("strong",[s._v("æœ€æ ¸å¿ƒçš„æ˜¯ fork() æ–¹æ³•å’Œ join() æ–¹æ³•, å…¶ä¸­ fork() æ–¹æ³•ä¼šå¼‚æ­¥åœ°æ‰§è¡Œä¸€ä¸ªå­ä»»åŠ¡, è€Œ join() æ–¹æ³•åˆ™ä¼šé˜»å¡å½“å‰çº¿ç¨‹æ¥ç­‰å¾…å­ä»»åŠ¡çš„æ‰§è¡Œç»“æœ")]),s._v(". ForkJoinTask æœ‰ä¸¤ä¸ªå­ç±»--RecursiveAction å’Œ RecursiveTask, é€šè¿‡åå­—å°±èƒ½çŸ¥é“, å®ƒä»¬éƒ½æ˜¯ç”¨é€’å½’çš„æ–¹å¼æ¥å¤„ç†åˆ†æ²»ä»»åŠ¡çš„. è¿™ä¸¤ä¸ªå­ç±»éƒ½å®šä¹‰äº†æŠ½è±¡æ–¹æ³• compute(), ä¸è¿‡åŒºåˆ«æ˜¯ "),t("strong",[s._v("RecursiveAction å®šä¹‰çš„ compute() æ²¡æœ‰è¿”å›å€¼, è€Œ RecursiveTask å®šä¹‰çš„ compute() æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„")]),s._v(". è¿™ä¸¤ä¸ªå­ç±»ä¹Ÿæ˜¯æŠ½è±¡ç±», åœ¨ä½¿ç”¨çš„æ—¶å€™, éœ€è¦å®šä¹‰å­ç±»å»æ‰©å±•.")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥å°±æ¥å®ç°ä¸€ä¸‹, çœ‹çœ‹å¦‚ä½•ç”¨ Fork/Join è¿™ä¸ªå¹¶è¡Œè®¡ç®—æ¡†æ¶è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—(ä¸‹é¢çš„ä»£ç æºè‡ª Java å®˜æ–¹ç¤ºä¾‹). é¦–å…ˆéœ€è¦"),t("strong",[s._v("åˆ›å»ºä¸€ä¸ªåˆ†æ²»ä»»åŠ¡çº¿ç¨‹æ± ä»¥åŠè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„åˆ†æ²»ä»»åŠ¡, ä¹‹åé€šè¿‡è°ƒç”¨åˆ†æ²»ä»»åŠ¡çº¿ç¨‹æ± çš„ invoke() æ–¹æ³•æ¥å¯åŠ¨åˆ†æ²»ä»»åŠ¡")]),s._v(". ç”±äºè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—éœ€è¦æœ‰è¿”å›å€¼, æ‰€ä»¥ Fibonacci ç»§æ‰¿è‡ª RecursiveTask. åˆ†æ²»ä»»åŠ¡ Fibonacci éœ€è¦å®ç° compute() æ–¹æ³•, è¿™ä¸ªæ–¹æ³•é‡Œé¢çš„é€»è¾‘å’Œæ™®é€šè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—éå¸¸ç±»ä¼¼, åŒºåˆ«ä¹‹å¤„åœ¨äºè®¡ç®— "),t("code",[s._v("Fibonacci(n - 1)")]),s._v("â€‹ ä½¿ç”¨äº†å¼‚æ­¥å­ä»»åŠ¡, è¿™æ˜¯é€šè¿‡ "),t("code",[s._v("f1.fork()")]),s._v("â€‹ è¿™æ¡è¯­å¥å®ç°çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºåˆ†æ²»ä»»åŠ¡çº¿ç¨‹æ±   ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ForkJoinPool")]),s._v(" fjp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ForkJoinPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºåˆ†æ²»ä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fibonacci")]),s._v(" fib "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fibonacci")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨åˆ†æ²»ä»»åŠ¡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fjp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fib"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¾“å‡ºç»“æœ  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€’å½’ä»»åŠ¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fibonacci")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RecursiveTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fibonacci")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fibonacci")]),s._v(" f1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fibonacci")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºå­ä»»åŠ¡  ")]),s._v("\n        f1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fork")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fibonacci")]),s._v(" f2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fibonacci")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…å­ä»»åŠ¡ç»“æœ, å¹¶åˆå¹¶ç»“æœ  ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" f2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" f1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("h5",{attrs:{id:"forkjoinpoolå·¥ä½œåŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#forkjoinpoolå·¥ä½œåŸç†"}},[s._v("#")]),s._v(" ForkJoinPoolå·¥ä½œåŸç†")]),s._v(" "),t("p",[s._v("Fork/Join å¹¶è¡Œè®¡ç®—çš„"),t("strong",[s._v("æ ¸å¿ƒç»„ä»¶æ˜¯ ForkJoinPool")]),s._v(", æ‰€ä»¥ä¸‹é¢å°±æ¥ç®€å•ä»‹ç»ä¸€ä¸‹ ForkJoinPool çš„å·¥ä½œåŸç†.")]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸“æ å‰é¢æ–‡ç« çš„å­¦ä¹ , åº”è¯¥å·²ç»çŸ¥é“ ThreadPoolExecutor æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„å®ç°, å†…éƒ¨æœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—, è¿™ä¸ªä»»åŠ¡é˜Ÿåˆ—æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é€šä¿¡çš„åª’ä»‹; ThreadPoolExecutor å¯ä»¥æœ‰å¤šä¸ªå·¥ä½œçº¿ç¨‹, ä½†æ˜¯è¿™äº›å·¥ä½œçº¿ç¨‹éƒ½å…±äº«ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—.")]),s._v(" "),t("p",[t("strong",[s._v("ForkJoinPool æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„å®ç°")]),s._v(", ä½†æ˜¯æ›´åŠ æ™ºèƒ½, å¯ä»¥å‚è€ƒä¸‹é¢çš„ ForkJoinPool å·¥ä½œåŸç†å›¾æ¥ç†è§£å…¶åŸç†. "),t("strong",[s._v("ThreadPoolExecutor å†…éƒ¨åªæœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—, è€Œ ForkJoinPool å†…éƒ¨æœ‰å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—, å½“é€šè¿‡ ForkJoinPool çš„ invoke() æˆ–è€… submit() æ–¹æ³•æäº¤ä»»åŠ¡æ—¶, ForkJoinPool æ ¹æ®ä¸€å®šçš„è·¯ç”±è§„åˆ™æŠŠä»»åŠ¡æäº¤åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­, å¦‚æœä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šåˆ›å»ºå‡ºå­ä»»åŠ¡, é‚£ä¹ˆå­ä»»åŠ¡ä¼šæäº¤åˆ°å·¥ä½œçº¿ç¨‹å¯¹åº”çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­")]),s._v(".")]),s._v(" "),t("p",[s._v('å¦‚æœå·¥ä½œçº¿ç¨‹å¯¹åº”çš„ä»»åŠ¡é˜Ÿåˆ—ç©ºäº†, æ˜¯ä¸æ˜¯å°±æ²¡æ´»å„¿å¹²äº†å‘¢? ä¸æ˜¯çš„, ForkJoinPool æ”¯æŒä¸€ç§å«åš "'),t("strong",[s._v("ä»»åŠ¡çªƒå–")]),s._v('" çš„æœºåˆ¶, å¦‚æœå·¥ä½œçº¿ç¨‹ç©ºé—²äº†, é‚£å®ƒå¯ä»¥ "çªƒå–" å…¶ä»–å·¥ä½œä»»åŠ¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡, ä¾‹å¦‚ä¸‹å›¾ä¸­, çº¿ç¨‹ T2 å¯¹åº”çš„ä»»åŠ¡é˜Ÿåˆ—å·²ç»ç©ºäº†, å®ƒå¯ä»¥ "çªƒå–" çº¿ç¨‹ T1 å¯¹åº”çš„ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡. å¦‚æ­¤ä¸€æ¥, æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹éƒ½ä¸ä¼šé—²ä¸‹æ¥äº†.')]),s._v(" "),t("p",[s._v("ForkJoinPool ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—é‡‡ç”¨çš„æ˜¯"),t("strong",[s._v("åŒç«¯é˜Ÿåˆ—")]),s._v(', å·¥ä½œçº¿ç¨‹æ­£å¸¸è·å–ä»»åŠ¡å’Œ "çªƒå–ä»»åŠ¡" åˆ†åˆ«æ˜¯ä»ä»»åŠ¡é˜Ÿåˆ—ä¸åŒçš„ç«¯æ¶ˆè´¹, è¿™æ ·èƒ½é¿å…å¾ˆå¤šä¸å¿…è¦çš„æ•°æ®ç«äº‰. è¿™é‡Œä»‹ç»çš„ä»…ä»…æ˜¯ç®€åŒ–åçš„åŸç†, ForkJoinPool çš„å®ç°è¿œæ¯”è¿™é‡Œä»‹ç»çš„å¤æ‚, å¦‚æœä½ æ„Ÿå…´è¶£, å»ºè®®å»çœ‹å®ƒçš„æºç .')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d6861169089dd30df194cd99edfc40e0-20230731162452-04u5x6i.png",alt:"",title:"ForkJoinPoolå·¥ä½œåŸç†å›¾"}})]),s._v(" "),t("h5",{attrs:{id:"æ¨¡æ‹Ÿmapreduceç»Ÿè®¡å•è¯æ•°é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¨¡æ‹Ÿmapreduceç»Ÿè®¡å•è¯æ•°é‡"}},[s._v("#")]),s._v(" æ¨¡æ‹ŸMapReduceç»Ÿè®¡å•è¯æ•°é‡")]),s._v(" "),t("p",[s._v("å­¦ä¹  MapReduce æœ‰ä¸€ä¸ªå…¥é—¨ç¨‹åº, ç»Ÿè®¡ä¸€ä¸ªæ–‡ä»¶é‡Œé¢æ¯ä¸ªå•è¯çš„æ•°é‡, ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•ç”¨ Fork/Join å¹¶è¡Œè®¡ç®—æ¡†æ¶æ¥å®ç°.")]),s._v(" "),t("p",[s._v("å¯ä»¥å…ˆç”¨äºŒåˆ†æ³•é€’å½’åœ°å°†ä¸€ä¸ªæ–‡ä»¶æ‹†åˆ†æˆæ›´å°çš„æ–‡ä»¶, ç›´åˆ°æ–‡ä»¶é‡Œåªæœ‰ä¸€è¡Œæ•°æ®, ç„¶åç»Ÿè®¡è¿™ä¸€è¡Œæ•°æ®é‡Œå•è¯çš„æ•°é‡, æœ€åå†é€çº§æ±‡æ€»ç»“æœ, å¯ä»¥å¯¹ç…§å‰é¢çš„ç®€ç‰ˆåˆ†æ²»ä»»åŠ¡æ¨¡å‹å›¾æ¥ç†è§£è¿™ä¸ªè¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("æ€è·¯æœ‰äº†, é©¬ä¸Šæ¥å®ç°. ä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ "),t("code",[s._v("String[] fc")]),s._v("â€‹ æ¥æ¨¡æ‹Ÿæ–‡ä»¶å†…å®¹, fc é‡Œé¢çš„å…ƒç´ ä¸æ–‡ä»¶é‡Œé¢çš„è¡Œæ•°æ®ä¸€ä¸€å¯¹åº”. å…³é”®çš„ä»£ç åœ¨ "),t("code",[s._v("compute()")]),s._v("â€‹ è¿™ä¸ªæ–¹æ³•é‡Œé¢, è¿™æ˜¯ä¸€ä¸ª"),t("strong",[s._v("é€’å½’æ–¹æ³•")]),s._v(", å‰åŠéƒ¨åˆ†æ•°æ® fork ä¸€ä¸ªé€’å½’ä»»åŠ¡å»å¤„ç†(å…³é”®ä»£ç  mr1.fork()), ååŠéƒ¨åˆ†æ•°æ®åˆ™åœ¨å½“å‰ä»»åŠ¡ä¸­é€’å½’å¤„ç†(mr2.compute()).")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" main "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" fc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello me"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello fork"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello join"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fork join in world"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º ForkJoin çº¿ç¨‹æ±   ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ForkJoinPool")]),s._v(" fjp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ForkJoinPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä»»åŠ¡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MR")]),s._v(" mr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨ä»»åŠ¡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fjp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¾“å‡ºç»“æœ  ")]),s._v("\n    result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// MR æ¨¡æ‹Ÿç±»")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RecursiveTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" end"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ å‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("MR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("end "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("end "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("calc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" mid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" end"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MR")]),s._v(" mr1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            mr1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fork")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MR")]),s._v(" mr2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" end"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¡ç®—å­ä»»åŠ¡, å¹¶è¿”å›åˆå¹¶çš„ç»“æœ  ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("merge")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mr2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mr1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆå¹¶ç»“æœ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("merge")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" r2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆå¹¶ç»“æœ")]),s._v("\n        r2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»Ÿè®¡å•è¯æ•°é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("calc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" line"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ†å‰²å•è¯  ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" words "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" line"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\\\s+"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»Ÿè®¡å•è¯æ•°é‡  ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" words"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-19"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-19"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Fork/Join å¹¶è¡Œè®¡ç®—æ¡†æ¶ä¸»è¦è§£å†³çš„æ˜¯"),t("strong",[s._v("åˆ†æ²»ä»»åŠ¡")]),s._v('. åˆ†æ²»çš„æ ¸å¿ƒæ€æƒ³æ˜¯"åˆ†è€Œæ²»ä¹‹": å°†ä¸€ä¸ªå¤§çš„ä»»åŠ¡æ‹†åˆ†æˆå°çš„å­ä»»åŠ¡å»è§£å†³, ç„¶åå†æŠŠå­ä»»åŠ¡çš„ç»“æœèšåˆèµ·æ¥ä»è€Œå¾—åˆ°æœ€ç»ˆç»“æœ. è¿™ä¸ªè¿‡ç¨‹éå¸¸ç±»ä¼¼äºå¤§æ•°æ®å¤„ç†ä¸­çš„ MapReduce, æ‰€ä»¥å¯ä»¥æŠŠ Fork/Join çœ‹ä½œå•æœºç‰ˆçš„ MapReduce.')]),s._v(" "),t("p",[s._v("Fork/Join å¹¶è¡Œè®¡ç®—æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶æ˜¯ ForkJoinPool. "),t("strong",[s._v("ForkJoinPool æ”¯æŒä»»åŠ¡çªƒå–æœºåˆ¶, èƒ½å¤Ÿè®©æ‰€æœ‰çº¿ç¨‹çš„å·¥ä½œé‡åŸºæœ¬å‡è¡¡, ä¸ä¼šå‡ºç°æœ‰çš„çº¿ç¨‹å¾ˆå¿™, è€Œæœ‰çš„çº¿ç¨‹å¾ˆé—²çš„çŠ¶å†µ, æ‰€ä»¥æ€§èƒ½å¾ˆå¥½")]),s._v(". Java 1.8 æä¾›çš„ Stream API é‡Œé¢å¹¶è¡Œæµä¹Ÿæ˜¯ä»¥ ForkJoinPool ä¸ºåŸºç¡€çš„. "),t("mark",[t("strong",[s._v("ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯, é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„å¹¶è¡Œæµè®¡ç®—éƒ½å…±äº«ä¸€ä¸ª ForkJoinPool, è¿™ä¸ªå…±äº«çš„ ForkJoinPool é»˜è®¤çš„çº¿ç¨‹æ•°æ˜¯ CPU çš„æ ¸æ•°; å¦‚æœæ‰€æœ‰çš„å¹¶è¡Œæµè®¡ç®—éƒ½æ˜¯ CPU å¯†é›†å‹è®¡ç®—çš„è¯, å®Œå…¨æ²¡æœ‰é—®é¢˜, ä½†æ˜¯å¦‚æœå­˜åœ¨ I/O å¯†é›†å‹çš„å¹¶è¡Œæµè®¡ç®—, é‚£ä¹ˆå¾ˆå¯èƒ½ä¼šå› ä¸ºä¸€ä¸ªå¾ˆæ…¢çš„ I/O è®¡ç®—è€Œæ‹–æ…¢æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½. æ‰€ä»¥å»ºè®®ç”¨ä¸åŒçš„ ForkJoinPool æ‰§è¡Œä¸åŒç±»å‹çš„è®¡ç®—ä»»åŠ¡")])]),s._v(".")]),s._v(" "),t("h3",{attrs:{id:"å¹¶å‘è®¾è®¡æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹¶å‘è®¾è®¡æ¨¡å¼"}},[s._v("#")]),s._v(" å¹¶å‘è®¾è®¡æ¨¡å¼")]),s._v(" "),t("h4",{attrs:{id:"_28-immutabilityæ¨¡å¼-å¦‚ä½•åˆ©ç”¨ä¸å˜æ€§è§£å†³å¹¶å‘é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_28-immutabilityæ¨¡å¼-å¦‚ä½•åˆ©ç”¨ä¸å˜æ€§è§£å†³å¹¶å‘é—®é¢˜"}},[s._v("#")]),s._v(" 28-Immutabilityæ¨¡å¼:å¦‚ä½•åˆ©ç”¨ä¸å˜æ€§è§£å†³å¹¶å‘é—®é¢˜?")]),s._v(" "),t("p",[s._v('å‰é¢è¯´è¿‡, "å¤šä¸ªçº¿ç¨‹åŒæ—¶'),t("strong",[s._v("è¯»å†™")]),s._v('åŒä¸€å…±äº«å˜é‡å­˜åœ¨å¹¶å‘é—®é¢˜", è¿™é‡Œçš„'),t("strong",[s._v("å¿…è¦æ¡ä»¶ä¹‹ä¸€æ˜¯è¯»å†™, å¦‚æœåªæœ‰è¯», è€Œæ²¡æœ‰å†™, æ˜¯æ²¡æœ‰å¹¶å‘é—®é¢˜çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("è§£å†³å¹¶å‘é—®é¢˜, å…¶å®æœ€ç®€å•çš„åŠæ³•å°±æ˜¯"),t("mark",[t("strong",[s._v("è®©å…±äº«å˜é‡åªæœ‰è¯»æ“ä½œ, è€Œæ²¡æœ‰å†™æ“ä½œ")])]),s._v(". è¿™ä¸ªåŠæ³•å¦‚æ­¤é‡è¦, ä»¥è‡³äºè¢«ä¸Šå‡åˆ°äº†ä¸€ç§è§£å†³å¹¶å‘é—®é¢˜çš„è®¾è®¡æ¨¡å¼: "),t("strong",[s._v("ä¸å˜æ€§(Immutability)æ¨¡å¼")]),s._v(". æ‰€è°“"),t("strong",[s._v("ä¸å˜æ€§, ç®€å•æ¥è®², å°±æ˜¯å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºä¹‹å, çŠ¶æ€å°±ä¸å†å‘ç”Ÿå˜åŒ–")]),s._v(". æ¢å¥è¯è¯´, å°±æ˜¯å˜é‡ä¸€æ—¦è¢«èµ‹å€¼, å°±ä¸å…è®¸ä¿®æ”¹äº†(æ²¡æœ‰å†™æ“ä½œ); æ²¡æœ‰ä¿®æ”¹æ“ä½œ, ä¹Ÿå°±æ˜¯ä¿æŒäº†ä¸å˜æ€§.")]),s._v(" "),t("h5",{attrs:{id:"å¿«é€Ÿå®ç°å…·å¤‡ä¸å¯å˜æ€§çš„ç±»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¿«é€Ÿå®ç°å…·å¤‡ä¸å¯å˜æ€§çš„ç±»"}},[s._v("#")]),s._v(" å¿«é€Ÿå®ç°å…·å¤‡ä¸å¯å˜æ€§çš„ç±»")]),s._v(" "),t("p",[s._v("å®ç°ä¸€ä¸ªå…·å¤‡ä¸å¯å˜æ€§çš„ç±», è¿˜æ˜¯æŒºç®€å•çš„. "),t("mark",[t("strong",[s._v("å°†ä¸€ä¸ªç±»æ‰€æœ‰çš„å±æ€§éƒ½è®¾ç½®æˆ final çš„, å¹¶ä¸”åªå…è®¸å­˜åœ¨åªè¯»æ–¹æ³•, é‚£ä¹ˆè¿™ä¸ªç±»åŸºæœ¬ä¸Šå°±å…·å¤‡ä¸å¯å˜æ€§äº†")])]),s._v("â€‹"),t("mark",[s._v(". æ›´ä¸¥æ ¼çš„åšæ³•æ˜¯")]),s._v("â€‹"),t("mark",[t("strong",[s._v("è¿™ä¸ªç±»æœ¬èº«ä¹Ÿæ˜¯ final çš„")])]),s._v(", ä¹Ÿå°±æ˜¯ä¸å…è®¸ç»§æ‰¿. å› ä¸ºå­ç±»å¯ä»¥è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•, æœ‰å¯èƒ½æ”¹å˜ä¸å¯å˜æ€§, æ‰€ä»¥æ¨èåœ¨å®é™…å·¥ä½œä¸­, ä½¿ç”¨è¿™ç§æ›´ä¸¥æ ¼çš„åšæ³•.")]),s._v(" "),t("p",[s._v("Java SDK é‡Œå¾ˆå¤šç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§, åªæ˜¯ç”±äºå®ƒä»¬çš„ä½¿ç”¨å¤ªç®€å•, æœ€ååè€Œè¢«å¿½ç•¥äº†. ä¾‹å¦‚ç»å¸¸ç”¨åˆ°çš„ String å’Œ Long, Integer, Double ç­‰åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§, è¿™äº›å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨æ€§éƒ½æ˜¯é ä¸å¯å˜æ€§æ¥ä¿è¯çš„. å¦‚æœä»”ç»†ç¿»çœ‹è¿™äº›ç±»çš„å£°æ˜, å±æ€§å’Œæ–¹æ³•, ä½ ä¼šå‘ç°å®ƒä»¬éƒ½ä¸¥æ ¼éµå®ˆä¸å¯å˜ç±»çš„ä¸‰ç‚¹è¦æ±‚: "),t("mark",[t("strong",[s._v("ç±»å’Œå±æ€§éƒ½æ˜¯ final çš„, æ‰€æœ‰æ–¹æ³•å‡æ˜¯åªè¯»çš„")])]),s._v(".")]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šç–‘æƒ‘, Java çš„ String æ–¹æ³•ä¹Ÿæœ‰ç±»ä¼¼å­—ç¬¦æ›¿æ¢æ“ä½œ, æ€ä¹ˆèƒ½è¯´æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åªè¯»çš„å‘¢? ç»“åˆ String çš„æºä»£ç æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªé—®é¢˜, ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æºè‡ª Java 1.8 SDK, ç•¥åšäº†ä¿®æ”¹, ä»…ä¿ç•™äº†å…³é”®å±æ€§ value[] å’Œ replace() æ–¹æ³•, ä½ ä¼šå‘ç°: "),t("strong",[s._v("String è¿™ä¸ªç±»ä»¥åŠå®ƒçš„å±æ€§ value[] éƒ½æ˜¯ final çš„; è€Œ replace() æ–¹æ³•çš„å®ç°, å°±çš„ç¡®æ²¡æœ‰ä¿®æ”¹ value[], è€Œæ˜¯å°†æ›¿æ¢åçš„å­—ç¬¦ä¸²ä½œä¸ºè¿”å›å€¼è¿”å›äº†")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å­—ç¬¦æ›¿æ¢")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("replace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" oldChar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" newChar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ— éœ€æ›¿æ¢, ç›´æ¥è¿”å› this  ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldChar "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" newChar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" len "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* avoid getfield opcode */")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" val "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šä½åˆ°éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä½ç½®")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("val"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" oldChar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœªæ‰¾åˆ° oldChar, æ— éœ€æ›¿æ¢")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä¸€ä¸ª buf[], è¿™æ˜¯å…³é”®")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨æ¥ä¿å­˜æ›¿æ¢åçš„å­—ç¬¦ä¸²")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" j "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" j "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" j"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("j"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" val"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("j"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" val"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" oldChar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" newChar "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿”å›")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­—ç¬¦ä¸²ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("p",[s._v("é€šè¿‡åˆ†æ String çš„å®ç°, ä½ å¯èƒ½å·²ç»å‘ç°äº†, å¦‚æœ"),t("strong",[s._v("å…·å¤‡ä¸å¯å˜æ€§çš„ç±», éœ€è¦æä¾›ç±»ä¼¼ä¿®æ”¹çš„åŠŸèƒ½")]),s._v(", å…·ä½“è¯¥æ€ä¹ˆæ“ä½œå‘¢? åšæ³•å¾ˆç®€å•, é‚£å°±æ˜¯"),t("mark",[t("strong",[s._v("åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡")])]),s._v(", è¿™æ˜¯ä¸å¯å˜å¯¹è±¡çš„ä¸€ä¸ªé‡è¦åŒºåˆ«, å¯å˜å¯¹è±¡å¾€å¾€æ˜¯ä¿®æ”¹è‡ªå·±çš„å±æ€§.")]),s._v(" "),t("p",[s._v("æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œéƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡, ä½ å¯èƒ½ä¼šæœ‰è¿™ç§æ‹…å¿ƒ: "),t("strong",[s._v("æ˜¯ä¸æ˜¯åˆ›å»ºçš„å¯¹è±¡å¤ªå¤šäº†, æœ‰ç‚¹å¤ªæµªè´¹å†…å­˜å‘¢? æ˜¯çš„, è¿™æ ·åšçš„ç¡®æœ‰äº›æµªè´¹, é‚£å¦‚ä½•è§£å†³å‘¢")]),s._v("?")]),s._v(" "),t("h5",{attrs:{id:"åˆ©ç”¨äº«å…ƒæ¨¡å¼é¿å…åˆ›å»ºé‡å¤å¯¹è±¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ©ç”¨äº«å…ƒæ¨¡å¼é¿å…åˆ›å»ºé‡å¤å¯¹è±¡"}},[s._v("#")]),s._v(" åˆ©ç”¨äº«å…ƒæ¨¡å¼é¿å…åˆ›å»ºé‡å¤å¯¹è±¡")]),s._v(" "),t("p",[s._v("å¦‚æœä½ ç†Ÿæ‚‰é¢å‘å¯¹è±¡ç›¸å…³çš„è®¾è®¡æ¨¡å¼, ç›¸ä¿¡ä½ ä¸€å®šèƒ½æƒ³åˆ°**äº«å…ƒæ¨¡å¼(Flyweight Pattern). åˆ©ç”¨äº«å…ƒæ¨¡å¼å¯ä»¥å‡å°‘åˆ›å»ºå¯¹è±¡çš„æ•°é‡, ä»è€Œå‡å°‘å†…å­˜å ç”¨. **Java è¯­è¨€é‡Œé¢ Long, Integer, Short, Byte ç­‰è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»éƒ½ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±ä»¥ Long è¿™ä¸ªç±»ä½œä¸ºä¾‹å­, çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åˆ©ç”¨äº«å…ƒæ¨¡å¼æ¥ä¼˜åŒ–å¯¹è±¡çš„åˆ›å»ºçš„.")]),s._v(" "),t("p",[s._v("äº«å…ƒæ¨¡å¼æœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ä¸€ä¸ª"),t("strong",[s._v("å¯¹è±¡æ± ")]),s._v(", åˆ©ç”¨äº«å…ƒæ¨¡å¼åˆ›å»ºå¯¹è±¡çš„é€»è¾‘ä¹Ÿå¾ˆç®€å•: "),t("strong",[s._v("åˆ›å»ºä¹‹å‰, é¦–å…ˆå»å¯¹è±¡æ± é‡Œçœ‹çœ‹æ˜¯ä¸æ˜¯å­˜åœ¨; å¦‚æœå·²ç»å­˜åœ¨, å°±åˆ©ç”¨å¯¹è±¡æ± é‡Œçš„å¯¹è±¡; å¦‚æœä¸å­˜åœ¨, å°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡, å¹¶ä¸”æŠŠè¿™ä¸ªæ–°åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡æ”¾è¿›å¯¹è±¡æ± é‡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("Long è¿™ä¸ªç±»å¹¶æ²¡æœ‰ç…§æ¬äº«å…ƒæ¨¡å¼, Long å†…éƒ¨ç»´æŠ¤äº†ä¸€"),t("strong",[s._v("ä¸ªé™æ€çš„å¯¹è±¡æ± , ä»…ç¼“å­˜äº† [-128,127] ä¹‹é—´çš„æ•°å­—")]),s._v(", è¿™ä¸ªå¯¹è±¡æ± åœ¨ JVM å¯åŠ¨çš„æ—¶å€™å°±åˆ›å»ºå¥½äº†, è€Œä¸”è¿™ä¸ªå¯¹è±¡æ± ä¸€ç›´éƒ½ä¸ä¼šå˜åŒ–, ä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯é™æ€çš„. ä¹‹æ‰€ä»¥é‡‡ç”¨è¿™æ ·çš„è®¾è®¡, æ˜¯å› ä¸º Long è¿™ä¸ªå¯¹è±¡çš„çŠ¶æ€å…±æœ‰ 2^64 ç§, å®åœ¨å¤ªå¤š, ä¸å®œå…¨éƒ¨ç¼“å­˜, è€Œ [-128,127] ä¹‹é—´çš„æ•°å­—åˆ©ç”¨ç‡æœ€é«˜. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å‡ºè‡ª Java 1.8, valueOf() æ–¹æ³•å°±ç”¨åˆ°äº† LongCache è¿™ä¸ªç¼“å­˜, ä½ å¯ä»¥ç»“åˆç€æ¥åŠ æ·±ç†è§£.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("valueOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" offset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [-128,127] ç›´æ¥çš„æ•°å­—åšäº†ç¼“å­˜")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" l "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongCache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" l "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" offset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¼“å­˜, ç­‰ä»·äºå¯¹è±¡æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»…ç¼“å­˜ [-128,127] ç›´æ¥çš„æ•°å­—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongCache")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[t("mark",[t("strong",[s._v('å‰é¢æåˆ° "Integer å’Œ String ç±»å‹çš„å¯¹è±¡ä¸é€‚åˆåšé”", å…¶å®åŸºæœ¬ä¸Šæ‰€æœ‰çš„åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½ä¸é€‚åˆåšé”, å› ä¸ºå®ƒä»¬å†…éƒ¨ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼, è¿™ä¼šå¯¼è‡´çœ‹ä¸Šå»ç§æœ‰çš„é”, å…¶å®æ˜¯å…±æœ‰çš„')])]),s._v(". ä¾‹å¦‚åœ¨ä¸‹é¢ä»£ç ä¸­, æœ¬æ„æ˜¯ A ç”¨é” al, B ç”¨é” bl, å„è‡ªç®¡ç†å„è‡ªçš„, äº’ä¸å½±å“. ä½†å®é™…ä¸Š al å’Œ bl æ˜¯ä¸€ä¸ªå¯¹è±¡, ç»“æœ A å’Œ B å…±ç”¨çš„æ˜¯ä¸€æŠŠé”.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" al "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("valueOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAX")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("al"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä»£ç æ— æ•°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" bl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("valueOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä»£ç æ— æ•°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h5",{attrs:{id:"ä½¿ç”¨immutabilityæ¨¡å¼çš„æ³¨æ„äº‹é¡¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨immutabilityæ¨¡å¼çš„æ³¨æ„äº‹é¡¹"}},[s._v("#")]),s._v(" ä½¿ç”¨Immutabilityæ¨¡å¼çš„æ³¨æ„äº‹é¡¹")]),s._v(" "),t("p",[s._v("åœ¨ä½¿ç”¨ Immutability æ¨¡å¼çš„æ—¶å€™, éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯ final çš„, å¹¶ä¸èƒ½ä¿è¯ä¸å¯å˜æ€§")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("ä¸å¯å˜å¯¹è±¡ä¹Ÿéœ€è¦æ­£ç¡®å‘å¸ƒ")]),s._v(".")])]),s._v(" "),t("p",[s._v("åœ¨ Java è¯­è¨€ä¸­, final ä¿®é¥°çš„å±æ€§ä¸€æ—¦è¢«èµ‹å€¼, å°±ä¸å¯ä»¥å†ä¿®æ”¹, ä½†æ˜¯å¦‚æœå±æ€§çš„ç±»å‹æ˜¯æ™®é€šå¯¹è±¡, é‚£ä¹ˆè¿™ä¸ªæ™®é€šå¯¹è±¡çš„å±æ€§æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„. ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­, Bar çš„å±æ€§ foo è™½ç„¶æ˜¯ final çš„, ä¾ç„¶å¯ä»¥é€šè¿‡ setAge() æ–¹æ³•æ¥è®¾ç½® foo çš„å±æ€§ age. æ‰€ä»¥"),t("strong",[s._v("åœ¨ä½¿ç”¨ Immutability æ¨¡å¼çš„æ—¶å€™ä¸€å®šè¦ç¡®è®¤ä¿æŒä¸å˜æ€§çš„è¾¹ç•Œåœ¨å“ªé‡Œ, æ˜¯å¦è¦æ±‚å±æ€§å¯¹è±¡ä¹Ÿå…·å¤‡ä¸å¯å˜æ€§")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Foo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Bar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Foo")]),s._v(" foo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAge")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        foo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("ä¸‹é¢å†çœ‹çœ‹å¦‚ä½•æ­£ç¡®åœ°å‘å¸ƒä¸å¯å˜å¯¹è±¡. ä¸å¯å˜å¯¹è±¡è™½ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„, "),t("strong",[s._v("ä½†æ˜¯å¹¶ä¸æ„å‘³ç€å¼•ç”¨è¿™äº›ä¸å¯å˜å¯¹è±¡çš„å¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„")]),s._v(". ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­, Foo å…·å¤‡ä¸å¯å˜æ€§, çº¿ç¨‹å®‰å…¨, ä½†æ˜¯ç±» Bar å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„, ç±» Bar ä¸­æŒæœ‰å¯¹ Foo çš„å¼•ç”¨ foo, å¯¹ foo è¿™ä¸ªå¼•ç”¨çš„ä¿®æ”¹åœ¨å¤šçº¿ç¨‹ä¸­å¹¶ä¸èƒ½ä¿è¯å¯è§æ€§å’ŒåŸå­æ€§.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Foo çº¿ç¨‹å®‰å…¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Foo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Bar çº¿ç¨‹ä¸å®‰å…¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Bar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Foo")]),s._v(" foo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setFoo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Foo")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("foo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("å¦‚æœä½ çš„ç¨‹åºä»…ä»…éœ€è¦ foo ä¿æŒå¯è§æ€§, æ— éœ€ä¿è¯åŸå­æ€§, é‚£ä¹ˆå¯ä»¥å°† foo å£°æ˜ä¸º volatile å˜é‡, è¿™æ ·å°±èƒ½ä¿è¯å¯è§æ€§. å¦‚æœä½ çš„ç¨‹åºéœ€è¦ä¿è¯åŸå­æ€§, é‚£ä¹ˆå¯ä»¥é€šè¿‡åŸå­ç±»æ¥å®ç°. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯åˆç†åº“å­˜çš„åŸå­åŒ–å®ç°, ä½ åº”è¯¥å¾ˆç†Ÿæ‚‰äº†, å…¶ä¸­å°±æ˜¯ç”¨åŸå­ç±»è§£å†³äº†ä¸å¯å˜å¯¹è±¡å¼•ç”¨çš„åŸå­æ€§é—®é¢˜.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeWM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WMRange")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" lower"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WMRange")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" lower"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥æ„é€ å‡½æ•°å®ç°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WMRange")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" rf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WMRange")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®åº“å­˜ä¸Šé™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setUpper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WMRange")]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ£€æŸ¥å‚æ•°åˆæ³•æ€§")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" or"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lower"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WMRange")]),s._v(" nr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WMRange")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" or"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lower"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("or"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-20"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-20"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Java è¯­è¨€é‡Œé¢çš„ String å’Œ Long, Integer, Double ç­‰åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§, è¿™äº›å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨æ€§éƒ½æ˜¯é ä¸å¯å˜æ€§æ¥ä¿è¯çš„. Immutability æ¨¡å¼æ˜¯æœ€ç®€å•çš„è§£å†³å¹¶å‘é—®é¢˜çš„æ–¹æ³•, å½“è¯•å›¾è§£å†³ä¸€ä¸ªå¹¶å‘é—®é¢˜æ—¶, å¯ä»¥å°è¯•ä¸€ä¸‹ Immutability æ¨¡å¼, çœ‹æ˜¯å¦èƒ½å¤Ÿå¿«é€Ÿè§£å†³.")]),s._v(" "),t("p",[t("strong",[s._v("å…·å¤‡ä¸å˜æ€§çš„å¯¹è±¡, åªæœ‰ä¸€ç§çŠ¶æ€, è¿™ä¸ªçŠ¶æ€ç”±å¯¹è±¡å†…éƒ¨æ‰€æœ‰çš„ä¸å˜å±æ€§å…±åŒå†³å®š")]),s._v(". å…¶å®è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„ä¸å˜æ€§å¯¹è±¡, é‚£å°±æ˜¯"),t("strong",[s._v("æ— çŠ¶æ€")]),s._v(". æ— çŠ¶æ€å¯¹è±¡å†…éƒ¨æ²¡æœ‰å±æ€§, åªæœ‰æ–¹æ³•. é™¤äº†æ— çŠ¶æ€çš„å¯¹è±¡, ä½ å¯èƒ½è¿˜å¬è¯´è¿‡æ— çŠ¶æ€çš„æœåŠ¡, æ— çŠ¶æ€çš„åè®®ç­‰ç­‰. æ— çŠ¶æ€æœ‰å¾ˆå¤šå¥½å¤„, æœ€æ ¸å¿ƒçš„ä¸€ç‚¹å°±æ˜¯æ€§èƒ½. åœ¨å¤šçº¿ç¨‹é¢†åŸŸ, æ— çŠ¶æ€å¯¹è±¡æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜, æ— éœ€åŒæ­¥å¤„ç†, è‡ªç„¶æ€§èƒ½å¾ˆå¥½; åœ¨åˆ†å¸ƒå¼é¢†åŸŸ, æ— çŠ¶æ€æ„å‘³ç€å¯ä»¥æ— é™åœ°æ°´å¹³æ‰©å±•, æ‰€ä»¥åˆ†å¸ƒå¼é¢†åŸŸé‡Œé¢æ€§èƒ½çš„ç“¶é¢ˆä¸€å®šä¸æ˜¯å‡ºåœ¨æ— çŠ¶æ€çš„æœåŠ¡èŠ‚ç‚¹ä¸Š.")]),s._v(" "),t("h4",{attrs:{id:"_29-copy-on-writeæ¨¡å¼-ä¸æ˜¯å»¶æ—¶ç­–ç•¥çš„cow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_29-copy-on-writeæ¨¡å¼-ä¸æ˜¯å»¶æ—¶ç­–ç•¥çš„cow"}},[s._v("#")]),s._v(" 29-Copy on Writeæ¨¡å¼:ä¸æ˜¯å»¶æ—¶ç­–ç•¥çš„COW")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚è®²åˆ° Java é‡Œ String è¿™ä¸ªç±»åœ¨å®ç° replace() æ–¹æ³•çš„æ—¶å€™, å¹¶æ²¡æœ‰æ›´æ”¹åŸå­—ç¬¦ä¸²é‡Œé¢ value[] æ•°ç»„çš„å†…å®¹, è€Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°å­—ç¬¦ä¸², è¿™ç§æ–¹æ³•åœ¨è§£å†³ä¸å¯å˜å¯¹è±¡çš„ä¿®æ”¹é—®é¢˜æ—¶ç»å¸¸ç”¨åˆ°. å¦‚æœä½ æ·±å…¥åœ°æ€è€ƒè¿™ä¸ªæ–¹æ³•, ä½ ä¼šå‘ç°å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ "),t("strong",[s._v("Copy-on-Write æ–¹æ³•")]),s._v(". æ‰€è°“ Copy-on-Write, ç»å¸¸è¢«ç¼©å†™ä¸º COW æˆ–è€… CoW, é¡¾åæ€ä¹‰å°±æ˜¯"),t("mark",[t("strong",[s._v("å†™æ—¶å¤åˆ¶")])]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("ä¸å¯å˜å¯¹è±¡çš„å†™æ“ä½œå¾€å¾€éƒ½æ˜¯ä½¿ç”¨ Copy-on-Write æ–¹æ³•è§£å†³çš„, å½“ç„¶ Copy-on-Write çš„åº”ç”¨é¢†åŸŸå¹¶ä¸å±€é™äº Immutability æ¨¡å¼")]),s._v(". ä¸‹é¢å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ Copy-on-Write çš„åº”ç”¨é¢†åŸŸ, è®©ä½ å¯¹å®ƒæœ‰ä¸ªæ›´å…¨é¢çš„è®¤è¯†.")]),s._v(" "),t("h5",{attrs:{id:"copy-on-writeæ¨¡å¼çš„åº”ç”¨é¢†åŸŸ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#copy-on-writeæ¨¡å¼çš„åº”ç”¨é¢†åŸŸ"}},[s._v("#")]),s._v(" Copy-on-Writeæ¨¡å¼çš„åº”ç”¨é¢†åŸŸ")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»è¿‡ "),t("strong",[s._v("CopyOnWriteArrayList å’Œ CopyOnWriteArraySet")]),s._v(" è¿™ä¸¤ä¸ª Copy-on-Write å®¹å™¨, å®ƒä»¬èƒŒåçš„è®¾è®¡æ€æƒ³å°±æ˜¯ Copy-on-Write; é€šè¿‡ Copy-on-Write è¿™ä¸¤ä¸ªå®¹å™¨å®ç°çš„"),t("strong",[s._v("è¯»æ“ä½œæ˜¯æ— é”çš„, ç”±äºæ— é”, æ‰€ä»¥å°†è¯»æ“ä½œçš„æ€§èƒ½å‘æŒ¥åˆ°äº†æè‡´")]),s._v(".")]),s._v(" "),t("p",[s._v("é™¤äº† Java è¿™ä¸ªé¢†åŸŸ, Copy-on-Write åœ¨æ“ä½œç³»ç»Ÿé¢†åŸŸä¹Ÿæœ‰å¹¿æ³›çš„åº”ç”¨.")]),s._v(" "),t("p",[s._v("æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦ Copy-on-Write å…¶å®å°±æ˜¯åœ¨æ“ä½œç³»ç»Ÿé¢†åŸŸ. ç±» Unix çš„æ“ä½œç³»ç»Ÿä¸­åˆ›å»ºè¿›ç¨‹çš„ API æ˜¯ fork(), ä¼ ç»Ÿçš„ fork() å‡½æ•°ä¼šåˆ›å»ºçˆ¶è¿›ç¨‹çš„ä¸€ä¸ªå®Œæ•´å‰¯æœ¬, ä¾‹å¦‚çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´ç°åœ¨ç”¨åˆ°äº† 1G çš„å†…å­˜, é‚£ä¹ˆ fork() å­è¿›ç¨‹çš„æ—¶å€™è¦å¤åˆ¶çˆ¶è¿›ç¨‹æ•´ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´(å æœ‰ 1G å†…å­˜)ç»™å­è¿›ç¨‹, è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆè€—æ—¶çš„. è€Œ Linux ä¸­çš„ fork() å‡½æ•°å°±èªæ˜å¾—å¤šäº†, fork() å­è¿›ç¨‹çš„æ—¶å€™, å¹¶ä¸å¤åˆ¶æ•´ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´, è€Œæ˜¯"),t("strong",[s._v("è®©çˆ¶å­è¿›ç¨‹å…±äº«åŒä¸€ä¸ªåœ°å€ç©ºé—´; åªç”¨åœ¨çˆ¶è¿›ç¨‹æˆ–è€…å­è¿›ç¨‹éœ€è¦å†™å…¥çš„æ—¶å€™æ‰ä¼šå¤åˆ¶åœ°å€ç©ºé—´, ä»è€Œä½¿çˆ¶å­è¿›ç¨‹æ‹¥æœ‰å„è‡ªçš„åœ°å€ç©ºé—´")]),s._v(".")]),s._v(" "),t("p",[s._v("æœ¬è´¨ä¸Šæ¥è®², çˆ¶å­è¿›ç¨‹çš„åœ°å€ç©ºé—´ä»¥åŠæ•°æ®éƒ½æ˜¯è¦"),t("strong",[s._v("éš”ç¦»")]),s._v("çš„, ä½¿ç”¨ Copy-on-Write æ›´å¤šåœ°ä½“ç°çš„æ˜¯ä¸€ç§"),t("strong",[s._v("å»¶æ—¶ç­–ç•¥, åªæœ‰åœ¨çœŸæ­£éœ€è¦å¤åˆ¶çš„æ—¶å€™æ‰å¤åˆ¶, è€Œä¸æ˜¯æå‰å¤åˆ¶å¥½")]),s._v(", åŒæ—¶ Copy-on-Write è¿˜æ”¯æŒæŒ‰éœ€å¤åˆ¶, æ‰€ä»¥ Copy-on-Write åœ¨æ“ä½œç³»ç»Ÿé¢†åŸŸæ˜¯èƒ½å¤Ÿæå‡æ€§èƒ½çš„. ç›¸æ¯”è¾ƒè€Œè¨€, Java æä¾›çš„ Copy-on-Write å®¹å™¨, ç”±äºåœ¨ä¿®æ”¹çš„åŒæ—¶ä¼šå¤åˆ¶æ•´ä¸ªå®¹å™¨, æ‰€ä»¥åœ¨æå‡è¯»æ“ä½œæ€§èƒ½çš„åŒæ—¶, "),t("mark",[t("strong",[s._v("æ˜¯ä»¥å†…å­˜å¤åˆ¶ä¸ºä»£ä»·çš„")])]),s._v(". è¿™é‡Œä½ ä¼šå‘ç°, åŒæ ·æ˜¯åº”ç”¨ Copy-on-Write, ä¸åŒçš„åœºæ™¯, å¯¹æ€§èƒ½çš„å½±å“æ˜¯ä¸åŒçš„.")]),s._v(" "),t("p",[s._v("åœ¨æ“ä½œç³»ç»Ÿé¢†åŸŸ, é™¤äº†åˆ›å»ºè¿›ç¨‹ç”¨åˆ°äº† Copy-on-Write, å¾ˆå¤šæ–‡ä»¶ç³»ç»Ÿä¹ŸåŒæ ·ç”¨åˆ°äº†, ä¾‹å¦‚ Btrfs (B-Tree File System), aufs(advanced multi-layered unification filesystem)ç­‰.")]),s._v(" "),t("p",[s._v("é™¤äº† Java é¢†åŸŸ, æ“ä½œç³»ç»Ÿé¢†åŸŸ, å¾ˆå¤šå…¶ä»–é¢†åŸŸä¹Ÿéƒ½èƒ½çœ‹åˆ° Copy-on-Write çš„èº«å½±: Docker å®¹å™¨é•œåƒçš„è®¾è®¡æ˜¯ Copy-on-Write, ç”šè‡³åˆ†å¸ƒå¼æºç ç®¡ç†ç³»ç»Ÿ Git èƒŒåçš„è®¾è®¡æ€æƒ³éƒ½æœ‰ Copy-on-Write.")]),s._v(" "),t("p",[s._v("ä¸è¿‡, "),t("strong",[s._v("Copy-on-Write æœ€å¤§çš„åº”ç”¨é¢†åŸŸè¿˜æ˜¯åœ¨å‡½æ•°å¼ç¼–ç¨‹é¢†åŸŸ")]),s._v(". å‡½æ•°å¼ç¼–ç¨‹çš„åŸºç¡€æ˜¯"),t("strong",[s._v("ä¸å¯å˜æ€§")]),s._v('(Immutability), æ‰€ä»¥å‡½æ•°å¼ç¼–ç¨‹é‡Œé¢æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œéƒ½éœ€è¦ Copy-on-Write æ¥è§£å†³. ä½ æˆ–è®¸ä¼šæœ‰ç–‘é—®, "æ‰€æœ‰æ•°æ®çš„ä¿®æ”¹éƒ½éœ€è¦å¤åˆ¶ä¸€ä»½, æ€§èƒ½æ˜¯ä¸æ˜¯ä¼šæˆä¸ºç“¶é¢ˆå‘¢?" ä½ çš„æ‹…å¿§æ˜¯æœ‰é“ç†çš„, ä¹‹æ‰€ä»¥å‡½æ•°å¼ç¼–ç¨‹æ—©å¹´é—´æ²¡æœ‰å…´èµ·, æ€§èƒ½ç»å¯¹æ‹–äº†åè…¿. ä½†æ˜¯éšç€ç¡¬ä»¶æ€§èƒ½çš„æå‡, æ€§èƒ½é—®é¢˜å·²ç»æ…¢æ…¢å˜å¾—å¯ä»¥æ¥å—äº†. è€Œä¸”, Copy-on-Write ä¹Ÿè¿œä¸åƒ Java é‡Œçš„ CopyOnWriteArrayList é‚£æ ·ç¬¨: æ•´ä¸ªæ•°ç»„éƒ½å¤åˆ¶ä¸€é. Copy-on-Write ä¹Ÿæ˜¯å¯ä»¥æŒ‰éœ€å¤åˆ¶çš„, å¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥å‚è€ƒ Purely Functional Data Structures è¿™æœ¬ä¹¦, é‡Œé¢æè¿°äº†å„ç§å…·å¤‡ä¸å˜æ€§çš„æ•°æ®ç»“æ„çš„å®ç°.')]),s._v(" "),t("p",[t("strong",[s._v("CopyOnWriteArrayList å’Œ CopyOnWriteArraySet è¿™ä¸¤ä¸ª Copy-on-Write å®¹å™¨åœ¨ä¿®æ”¹çš„æ—¶å€™ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„, æ‰€ä»¥å¦‚æœå®¹å™¨ç»å¸¸è¢«ä¿®æ”¹æˆ–è€…è¿™ä¸ªæ•°ç»„æœ¬èº«å°±éå¸¸å¤§çš„æ—¶å€™, æ˜¯ä¸å»ºè®®ä½¿ç”¨çš„")]),s._v(". åä¹‹, å¦‚æœæ˜¯ä¿®æ”¹éå¸¸å°‘, æ•°ç»„æ•°é‡ä¹Ÿä¸å¤§, å¹¶ä¸”å¯¹è¯»æ€§èƒ½è¦æ±‚è‹›åˆ»çš„åœºæ™¯, ä½¿ç”¨ Copy-on-Write å®¹å™¨æ•ˆæœå°±éå¸¸å¥½äº†. ä¸‹é¢ç»“åˆä¸€ä¸ªçœŸå®çš„æ¡ˆä¾‹æ¥è®²è§£ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"ä¸€ä¸ªçœŸå®æ¡ˆä¾‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ä¸ªçœŸå®æ¡ˆä¾‹"}},[s._v("#")]),s._v(" ä¸€ä¸ªçœŸå®æ¡ˆä¾‹")]),s._v(" "),t("p",[s._v("æˆ‘æ›¾ç»å†™è¿‡ä¸€ä¸ª RPC æ¡†æ¶, æœ‰ç‚¹ç±»ä¼¼ Dubbo, æœåŠ¡æä¾›æ–¹æ˜¯å¤šå®ä¾‹åˆ†å¸ƒå¼éƒ¨ç½²çš„, æ‰€ä»¥æœåŠ¡çš„å®¢æˆ·ç«¯åœ¨è°ƒç”¨ RPC çš„æ—¶å€™, ä¼šé€‰å®šä¸€ä¸ªæœåŠ¡å®ä¾‹æ¥è°ƒç”¨, è¿™ä¸ªé€‰å®šçš„è¿‡ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯åœ¨åšè´Ÿè½½å‡è¡¡, è€Œåšè´Ÿè½½å‡è¡¡çš„å‰ææ˜¯å®¢æˆ·ç«¯è¦æœ‰å…¨éƒ¨çš„è·¯ç”±ä¿¡æ¯. ä¾‹å¦‚åœ¨ä¸‹å›¾ä¸­, A æœåŠ¡çš„æä¾›æ–¹æœ‰ 3 ä¸ªå®ä¾‹, åˆ†åˆ«æ˜¯ 192.168.1.1, 192.168.1.2 å’Œ 192.168.1.3, å®¢æˆ·ç«¯åœ¨è°ƒç”¨ç›®æ ‡æœåŠ¡ A å‰, é¦–å…ˆéœ€è¦åšçš„æ˜¯è´Ÿè½½å‡è¡¡, ä¹Ÿå°±æ˜¯ä»è¿™ 3 ä¸ªå®ä¾‹ä¸­é€‰å‡º 1 ä¸ªæ¥, ç„¶åå†é€šè¿‡ RPC æŠŠè¯·æ±‚å‘é€é€‰ä¸­çš„ç›®æ ‡å®ä¾‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/42e5276fe9654cb99311a124876f71e6-20230731162452-wiffdm8.png",alt:"",title:"RPC è·¯ç”±å…³ç³»å›¾"}})]),s._v(" "),t("p",[s._v("RPC æ¡†æ¶çš„ä¸€ä¸ªæ ¸å¿ƒä»»åŠ¡å°±æ˜¯ç»´æŠ¤æœåŠ¡çš„è·¯ç”±å…³ç³», å¯ä»¥æŠŠæœåŠ¡çš„è·¯ç”±å…³ç³»ç®€åŒ–æˆä¸‹å›¾æ‰€ç¤ºçš„è·¯ç”±è¡¨. å½“æœåŠ¡æä¾›æ–¹ä¸Šçº¿æˆ–è€…ä¸‹çº¿çš„æ—¶å€™, å°±éœ€è¦æ›´æ–°å®¢æˆ·ç«¯çš„è¿™å¼ è·¯ç”±è¡¨.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d1e9b9471432d3ae4bc1e2909aa3fb47-20230731162452-6hskmaq.png",alt:""}})]),s._v(" "),t("p",[s._v("é¦–å…ˆæ¥åˆ†æä¸€ä¸‹å¦‚ä½•ç”¨ç¨‹åºæ¥å®ç°. æ¯æ¬¡ RPC è°ƒç”¨éƒ½éœ€è¦é€šè¿‡è´Ÿè½½å‡è¡¡å™¨æ¥è®¡ç®—ç›®æ ‡æœåŠ¡çš„ IP å’Œç«¯å£å·, è€Œè´Ÿè½½å‡è¡¡å™¨éœ€è¦é€šè¿‡è·¯ç”±è¡¨è·å–æ¥å£çš„æ‰€æœ‰è·¯ç”±ä¿¡æ¯, ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("æ¯æ¬¡ RPC è°ƒç”¨éƒ½éœ€è¦è®¿é—®è·¯ç”±è¡¨")]),s._v(", æ‰€ä»¥è®¿é—®è·¯ç”±è¡¨è¿™ä¸ªæ“ä½œçš„æ€§èƒ½è¦æ±‚æ˜¯å¾ˆé«˜çš„. ä¸è¿‡è·¯ç”±è¡¨å¯¹æ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚å¹¶ä¸é«˜, ä¸€ä¸ªæœåŠ¡æä¾›æ–¹ä»ä¸Šçº¿åˆ°åé¦ˆåˆ°å®¢æˆ·ç«¯çš„è·¯ç”±è¡¨é‡Œ, å³ä¾¿æœ‰ 5 ç§’é’Ÿ, å¾ˆå¤šæ—¶å€™ä¹Ÿéƒ½æ˜¯èƒ½æ¥å—çš„(5 ç§’é’Ÿ, å¯¹äºä»¥çº³ç§’ä½œä¸ºæ—¶é’Ÿå‘¨æœŸçš„ CPU æ¥è¯´, é‚£ä½•æ­¢æ˜¯ä¸€ä¸‡å¹´, æ‰€ä»¥è·¯ç”±è¡¨å¯¹ä¸€è‡´æ€§çš„è¦æ±‚å¹¶ä¸é«˜). è€Œä¸”"),t("strong",[s._v("è·¯ç”±è¡¨æ˜¯å…¸å‹çš„è¯»å¤šå†™å°‘ç±»é—®é¢˜")]),s._v(", å†™æ“ä½œçš„é‡ç›¸æ¯”äºè¯»æ“ä½œ, å¯è°“æ˜¯æ²§æµ·ä¸€ç²Ÿ, å°‘å¾—å¯æ€œ.")]),s._v(" "),t("p",[s._v("é€šè¿‡ä»¥ä¸Šåˆ†æ, ä½ ä¼šå‘ç°ä¸€äº›å…³é”®è¯: å¯¹è¯»çš„æ€§èƒ½è¦æ±‚å¾ˆé«˜, è¯»å¤šå†™å°‘, å¼±ä¸€è‡´æ€§. å®ƒä»¬ç»¼åˆåœ¨ä¸€èµ·, ä½ ä¼šæƒ³åˆ°ä»€ä¹ˆå‘¢? CopyOnWriteArrayList å’Œ CopyOnWriteArraySet å¤©ç”Ÿå°±é€‚ç”¨è¿™ç§åœºæ™¯å•Š. æ‰€ä»¥ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, RouteTable è¿™ä¸ªç±»å†…éƒ¨é€šè¿‡ "),t("code",[s._v("ConcurrentHashMap<String, CopyOnWriteArraySet<Router>>")]),s._v("â€‹ è¿™ä¸ªæ•°æ®ç»“æ„æ¥æè¿°è·¯ç”±è¡¨, ConcurrentHashMap çš„ Key æ˜¯æ¥å£å, Value æ˜¯è·¯ç”±é›†åˆ, è¿™ä¸ªè·¯ç”±é›†åˆæ˜¯ CopyOnWriteArraySet.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å†æ¥æ€è€ƒ Router è¯¥å¦‚ä½•è®¾è®¡, "),t("strong",[s._v("æœåŠ¡æä¾›æ–¹çš„æ¯ä¸€æ¬¡ä¸Šçº¿, ä¸‹çº¿éƒ½ä¼šæ›´æ–°è·¯ç”±ä¿¡æ¯")]),s._v(", è¿™æ—¶å€™æœ‰ä¸¤ç§é€‰æ‹©. ä¸€ç§æ˜¯é€šè¿‡æ›´æ–° Router çš„ä¸€ä¸ªçŠ¶æ€ä½æ¥æ ‡è¯†, å¦‚æœè¿™æ ·åš, é‚£ä¹ˆæ‰€æœ‰è®¿é—®è¯¥çŠ¶æ€ä½çš„åœ°æ–¹éƒ½éœ€è¦åŒæ­¥è®¿é—®, è¿™æ ·å¾ˆå½±å“æ€§èƒ½. å¦å¤–ä¸€ç§å°±æ˜¯é‡‡ç”¨ Immutability æ¨¡å¼, "),t("strong",[s._v("æ¯æ¬¡ä¸Šçº¿, ä¸‹çº¿éƒ½åˆ›å»ºæ–°çš„ Router å¯¹è±¡æˆ–è€…åˆ é™¤å¯¹åº”çš„ Router å¯¹è±¡. ç”±äºä¸Šçº¿, ä¸‹çº¿çš„é¢‘ç‡å¾ˆä½, æ‰€ä»¥åè€…æ˜¯æœ€å¥½çš„é€‰æ‹©")]),s._v(".")]),s._v(" "),t("p",[s._v("Router çš„å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤º, æ˜¯ä¸€ç§å…¸å‹ Immutability æ¨¡å¼çš„å®ç°, éœ€è¦æ³¨æ„çš„æ˜¯"),t("strong",[s._v("é‡å†™äº† equals æ–¹æ³•")]),s._v(", è¿™æ · CopyOnWriteArraySet çš„ add() å’Œ remove() æ–¹æ³•æ‰èƒ½æ­£å¸¸å·¥ä½œ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·¯ç”±ä¿¡æ¯")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ å‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("iface "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡å†™ equals æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hashCode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ hashCode ç›¸å…³ä»£ç ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·¯ç”±è¡¨ä¿¡æ¯")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RouterTable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Key: æ¥å£å")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Value: è·¯ç”±é›†åˆ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CopyOnWriteArraySet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" rt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¹æ®æ¥å£åè·å–è·¯ç”±è¡¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" rt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ é™¤è·¯ç”±")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),s._v(" router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            set"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¢åŠ è·¯ç”±")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),s._v(" router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("computeIfAbsent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("route"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CopyOnWriteArraySet")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        set"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-21"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-21"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("ç›®å‰ Copy-on-Write åœ¨ Java å¹¶å‘ç¼–ç¨‹é¢†åŸŸçŸ¥ååº¦ä¸æ˜¯å¾ˆé«˜, å¾ˆå¤šäººéƒ½åœ¨æ— æ„ä¸­æŠŠå®ƒå¿½è§†äº†, ä½†å…¶å® Copy-on-Write æ‰æ˜¯æœ€ç®€å•çš„å¹¶å‘è§£å†³æ–¹æ¡ˆ. å®ƒæ˜¯å¦‚æ­¤ç®€å•, ä»¥è‡³äº Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ String, Integer, Long ç­‰éƒ½æ˜¯åŸºäº Copy-on-Write æ–¹æ¡ˆå®ç°çš„.")]),s._v(" "),t("p",[t("strong",[s._v("Copy-on-Write æ˜¯ä¸€é¡¹éå¸¸é€šç”¨çš„æŠ€æœ¯æ–¹æ¡ˆ, åœ¨å¾ˆå¤šé¢†åŸŸéƒ½æœ‰ç€å¹¿æ³›çš„åº”ç”¨. ä¸è¿‡, å®ƒä¹Ÿæœ‰ç¼ºç‚¹çš„, é‚£å°±æ˜¯æ¶ˆè€—å†…å­˜, æ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦å¤åˆ¶ä¸€ä¸ªæ–°çš„å¯¹è±¡å‡ºæ¥")]),s._v(", å¥½åœ¨éšç€è‡ªåŠ¨åƒåœ¾å›æ”¶(GC)ç®—æ³•çš„æˆç†Ÿä»¥åŠç¡¬ä»¶çš„å‘å±•, è¿™ç§å†…å­˜æ¶ˆè€—å·²ç»æ¸æ¸å¯ä»¥æ¥å—äº†. æ‰€ä»¥åœ¨å®é™…å·¥ä½œä¸­, å¦‚æœå†™æ“ä½œéå¸¸å°‘, é‚£ä½ å°±å¯ä»¥å°è¯•ç”¨ä¸€ä¸‹ Copy-on-Write, æ•ˆæœè¿˜æ˜¯ä¸é”™çš„.")]),s._v(" "),t("h4",{attrs:{id:"_30-çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼-æ²¡æœ‰å…±äº«-å°±æ²¡æœ‰ä¼¤å®³ğŸ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_30-çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼-æ²¡æœ‰å…±äº«-å°±æ²¡æœ‰ä¼¤å®³ğŸ€"}},[s._v("#")]),s._v(" 30-çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼:æ²¡æœ‰å…±äº«,å°±æ²¡æœ‰ä¼¤å®³ğŸ€")]),s._v(" "),t("p",[s._v('æ°‘å›½å¹´é—´æŸå±±ä¸œçœä¸»å¸­å‚åŠ æŸå¤§å­¦æ ¡åº†æ¼”è®², åœ¨ç¯®çƒåœºçœ‹åˆ°åæ¥ä¸ªäººç©¿ç€è£¤è¡©æŠ¢ä¸€ä¸ªçƒ, è§‚ä¹‹å®åœ¨ä¸é›…, äºæ˜¯æ€’æ–¥å­¦æ ¡çš„æ€»åŠ¡å¤„é•¿è´ªæ±¡, å¹¶ä¸”å‘è¯: "å¤šä¹°å‡ ä¸ªçƒ, ä¸€äººå‘ä¸€ä¸ª, çœå¾—ä½ äº‰æˆ‘æŠ¢!" å°æ—¶å€™å¬åˆ°è¿™ä¸ªæ®µå­åªæ˜¯è§‰å¾—å¥½ç©, ä»Šå¤©å†æ¥çœ‹, å´åˆ«æœ‰ä¸€ç•ªæ»‹å‘³. ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºå…¶é—´è•´è—ç€è§£å†³å¹¶å‘é—®é¢˜çš„ä¸€ä¸ªé‡è¦æ–¹æ³•: '),t("mark",[t("strong",[s._v("é¿å…å…±äº«")])]),s._v(".")]),s._v(" "),t("p",[s._v("å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€å…±äº«å˜é‡å­˜åœ¨å¹¶å‘é—®é¢˜. å‰é¢ä¸¤èŠ‚çªç ´çš„æ˜¯å†™, æ²¡æœ‰å†™æ“ä½œè‡ªç„¶æ²¡æœ‰å¹¶å‘é—®é¢˜äº†. å…¶å®è¿˜å¯ä»¥"),t("strong",[s._v("çªç ´å…±äº«å˜é‡")]),s._v(", æ²¡æœ‰å…±äº«å˜é‡ä¹Ÿä¸ä¼šæœ‰å¹¶å‘é—®é¢˜, æ­£æ‰€è°“æ˜¯"),t("strong",[s._v("æ²¡æœ‰å…±äº«, å°±æ²¡æœ‰ä¼¤å®³")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£å¦‚ä½•é¿å…å…±äº«å‘¢? æ€è·¯å…¶å®å¾ˆç®€å•, å¤šä¸ªäººäº‰ä¸€ä¸ªçƒæ€»å®¹æ˜“å‡ºçŸ›ç›¾, é‚£å°±æ¯ä¸ªäººå‘ä¸€ä¸ªçƒ. å¯¹åº”åˆ°å¹¶å‘ç¼–ç¨‹é¢†åŸŸ, å°±æ˜¯"),t("strong",[s._v("æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„å˜é‡, å½¼æ­¤ä¹‹é—´ä¸å…±äº«, ä¹Ÿå°±æ²¡æœ‰å¹¶å‘é—®é¢˜")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°è¿‡"),t("strong",[s._v("çº¿ç¨‹å°é—­")]),s._v(", å…¶æœ¬è´¨ä¸Šå°±æ˜¯é¿å…å…±äº«. é€šè¿‡å±€éƒ¨å˜é‡å¯ä»¥åšåˆ°é¿å…å…±äº«, é‚£è¿˜æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥åšåˆ°å‘¢? æœ‰çš„, "),t("strong",[s._v("Java è¯­è¨€æä¾›çš„çº¿ç¨‹æœ¬åœ°å­˜å‚¨(ThreadLocal)å°±èƒ½å¤Ÿåšåˆ°")]),s._v(". ä¸‹é¢å…ˆçœ‹çœ‹ ThreadLocal åˆ°åº•è¯¥å¦‚ä½•ä½¿ç”¨.")]),s._v(" "),t("h5",{attrs:{id:"threadlocalçš„ä½¿ç”¨æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#threadlocalçš„ä½¿ç”¨æ–¹æ³•"}},[s._v("#")]),s._v(" ThreadLocalçš„ä½¿ç”¨æ–¹æ³•")]),s._v(" "),t("p",[s._v("ä¸‹é¢è¿™ä¸ª"),t("strong",[s._v("é™æ€ç±» ThreadId ä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„çº¿ç¨‹ Id")]),s._v(", å¦‚æœ"),t("strong",[s._v("ä¸€ä¸ªçº¿ç¨‹")]),s._v("å‰åä¸¤æ¬¡è°ƒç”¨ ThreadId çš„ get() æ–¹æ³•, ä¸¤æ¬¡ get() æ–¹æ³•çš„è¿”å›å€¼æ˜¯ç›¸åŒçš„. ä½†å¦‚æœæ˜¯"),t("strong",[s._v("ä¸¤ä¸ªçº¿ç¨‹")]),s._v("åˆ†åˆ«è°ƒç”¨ ThreadId çš„ get() æ–¹æ³•, é‚£ä¹ˆä¸¤ä¸ªçº¿ç¨‹çœ‹åˆ°çš„ get() æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸åŒçš„. è‹¥ä½ æ˜¯åˆæ¬¡æ¥è§¦ ThreadLocal, å¯èƒ½ä¼šè§‰å¾—å¥‡æ€ª, ä¸ºä»€ä¹ˆ"),t("strong",[s._v("ç›¸åŒçº¿ç¨‹è°ƒç”¨ get() æ–¹æ³•ç»“æœå°±ç›¸åŒ, è€Œä¸åŒçº¿ç¨‹è°ƒç”¨ get() æ–¹æ³•ç»“æœå°±ä¸åŒ")]),s._v("å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadId")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" nextId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šä¹‰ ThreadLocal å˜é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" tl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("withInitial")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" nextId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndIncrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤æ–¹æ³•ä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ Id")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" tl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("èƒ½æœ‰è¿™ä¸ªå¥‡æ€ªçš„ç»“æœ, éƒ½æ˜¯ ThreadLocal çš„æ°ä½œ, ä¸è¿‡åœ¨è¯¦ç»†è§£é‡Š ThreadLocal çš„å·¥ä½œåŸç†ä¹‹å‰, å†çœ‹ä¸€ä¸ªå®é™…å·¥ä½œä¸­å¯èƒ½é‡åˆ°çš„ä¾‹å­æ¥åŠ æ·±ä¸€ä¸‹å¯¹ ThreadLocal çš„ç†è§£. ä½ å¯èƒ½çŸ¥é“ SimpleDateFormat ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„, é‚£å¦‚æœéœ€è¦åœ¨å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨å®ƒ, ä½ è¯¥æ€ä¹ˆåŠå‘¢?")]),s._v(" "),t("p",[s._v("å…¶å®æœ‰ä¸€ä¸ªåŠæ³•å°±æ˜¯ç”¨ ThreadLocal æ¥è§£å†³, ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°±æ˜¯ "),t("strong",[s._v("ThreadLocal è§£å†³æ–¹æ¡ˆ")]),s._v("çš„å…·ä½“å®ç°, è¿™æ®µä»£ç ä¸å‰é¢ ThreadId çš„ä»£ç é«˜åº¦ç›¸ä¼¼, åŒæ ·åœ°, ä¸åŒçº¿ç¨‹è°ƒç”¨ SafeDateFormat çš„ get() æ–¹æ³•å°†è¿”å›ä¸åŒçš„ SimpleDateFormat å¯¹è±¡å®ä¾‹, "),t("strong",[s._v("ç”±äºä¸åŒçº¿ç¨‹å¹¶ä¸å…±äº« SimpleDateFormat, æ‰€ä»¥å°±åƒå±€éƒ¨å˜é‡ä¸€æ ·, æ˜¯çº¿ç¨‹å®‰å…¨çš„")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeDateFormat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šä¹‰ ThreadLocal å˜é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DateFormat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" tl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("withInitial")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleDateFormat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyy-MM-dd HH:mm:ss"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DateFormat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" tl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸åŒçº¿ç¨‹æ‰§è¡Œä¸‹é¢ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›çš„ df æ˜¯ä¸åŒçš„")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DateFormat")]),s._v(" df "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SafeDateFormat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("é€šè¿‡ä¸Šé¢ä¸¤ä¸ªä¾‹å­, ç›¸ä¿¡ä½ å¯¹ ThreadLocal çš„ç”¨æ³•ä»¥åŠåº”ç”¨åœºæ™¯éƒ½äº†è§£äº†, ä¸‹é¢å°±æ¥è¯¦ç»†è§£é‡Š ThreadLocal çš„å·¥ä½œåŸç†.")]),s._v(" "),t("h5",{attrs:{id:"threadlocalçš„å·¥ä½œåŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#threadlocalçš„å·¥ä½œåŸç†"}},[s._v("#")]),s._v(" ThreadLocalçš„å·¥ä½œåŸç†")]),s._v(" "),t("p",[s._v("åœ¨è§£é‡Š ThreadLocal çš„å·¥ä½œåŸç†ä¹‹å‰, å…ˆè‡ªå·±æƒ³æƒ³: å¦‚æœè®©ä½ æ¥å®ç° ThreadLocal çš„åŠŸèƒ½, ä½ ä¼šæ€ä¹ˆè®¾è®¡å‘¢? "),t("strong",[s._v("ThreadLocal çš„ç›®æ ‡æ˜¯è®©ä¸åŒçš„çº¿ç¨‹æœ‰ä¸åŒçš„å˜é‡ V, é‚£æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åˆ›å»ºä¸€ä¸ª Map, å®ƒçš„ Key æ˜¯çº¿ç¨‹, Value æ˜¯æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰çš„å˜é‡ V, ThreadLocal å†…éƒ¨æŒæœ‰è¿™æ ·çš„ä¸€ä¸ª Map å°±å¯ä»¥äº†")]),s._v(". ä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºæ„å›¾å’Œç¤ºä¾‹ä»£ç æ¥ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6a8fd6021988dff01aabf3fdab6c6da2-20230731162452-6yrxlid.png",alt:"",title:"ThreadLocal æŒæœ‰ Map çš„ç¤ºæ„å›¾"}})]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" locals "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–çº¿ç¨‹å˜é‡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" locals"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®çº¿ç¨‹å˜é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        locals"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("é‚£ Java çš„ ThreadLocal æ˜¯è¿™ä¹ˆå®ç°çš„å—? è¿™ä¸€æ¬¡çš„è®¾è®¡æ€è·¯å’Œ Java çš„å®ç°å·®å¼‚å¾ˆå¤§. Java çš„å®ç°é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª Map, "),t("strong",[s._v("å«åš ThreadLocalMap, ä¸è¿‡æŒæœ‰ ThreadLocalMap çš„ä¸æ˜¯ ThreadLocal, è€Œæ˜¯ Thread")]),s._v(". Thread è¿™ä¸ªç±»å†…éƒ¨æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ threadLocals, å…¶ç±»å‹å°±æ˜¯ ThreadLocalMap, ThreadLocalMap çš„ Key æ˜¯ ThreadLocal. å¯ä»¥ç»“åˆä¸‹é¢çš„ç¤ºæ„å›¾å’Œç²¾ç®€ä¹‹åçš„ Java å®ç°ä»£ç æ¥ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/58df97ed0581cc8edaeaac43feda7573-20230731162452-odqyr2d.png",alt:"",title:"Thread æŒæœ‰ ThreadLocalMap çš„ç¤ºæ„å›¾"}})]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†…éƒ¨æŒæœ‰ ThreadLocalMap")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ThreadLocalMap")]),s._v(" threadLocals"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¦–å…ˆè·å–çº¿ç¨‹æŒæœ‰çš„")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ThreadLocalMap")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocalMap")]),s._v(" map "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("threadLocals"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨ ThreadLocalMap ä¸­")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥æ‰¾å˜é‡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Entry")]),s._v(" e "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getEntry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocalMap")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†…éƒ¨æ˜¯æ•°ç»„è€Œä¸æ˜¯ Map")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Entry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" table"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¹æ® ThreadLocal æŸ¥æ‰¾ Entry")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Entry")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getEntry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥æŸ¥æ‰¾é€»è¾‘")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Entry å®šä¹‰")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Entry")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WeakReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[s._v("åˆçœ‹ä¸Šå», ç®€æ˜“çš„è®¾è®¡æ–¹æ¡ˆå’Œ Java çš„å®ç°ä»…ä»…æ˜¯ Map çš„æŒæœ‰æ–¹ä¸åŒè€Œå·², ç®€æ˜“çš„è®¾è®¡é‡Œé¢ Map å±äº ThreadLocal, è€Œ Java çš„å®ç°é‡Œé¢ ThreadLocalMap åˆ™æ˜¯å±äº Thread. è¿™ä¸¤ç§æ–¹å¼å“ªç§æ›´åˆç†å‘¢? å¾ˆæ˜¾ç„¶ Java çš„å®ç°æ›´åˆç†ä¸€äº›. "),t("strong",[s._v("åœ¨ Java çš„å®ç°æ–¹æ¡ˆé‡Œé¢, ThreadLocal ä»…ä»…æ˜¯ä¸€ä¸ªä»£ç†å·¥å…·ç±», å†…éƒ¨å¹¶ä¸æŒæœ‰ä»»ä½•ä¸çº¿ç¨‹ç›¸å…³çš„æ•°æ®, æ‰€æœ‰å’Œçº¿ç¨‹ç›¸å…³çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ Thread é‡Œé¢")]),s._v(", è¿™æ ·çš„è®¾è®¡å®¹æ˜“ç†è§£. è€Œä»æ•°æ®çš„äº²ç¼˜æ€§ä¸Šæ¥è®², ThreadLocalMap å±äº Thread ä¹Ÿæ›´åŠ åˆç†.")]),s._v(" "),t("p",[s._v("å½“ç„¶è¿˜æœ‰ä¸€ä¸ªæ›´åŠ æ·±å±‚æ¬¡çš„åŸå› , é‚£å°±æ˜¯"),t("strong",[s._v("ä¸å®¹æ˜“äº§ç”Ÿå†…å­˜æ³„éœ²")]),s._v(". åœ¨ç®€æ˜“çš„è®¾è®¡æ–¹æ¡ˆä¸­, ThreadLocal æŒæœ‰çš„ Map ä¼šæŒæœ‰ Thread å¯¹è±¡çš„å¼•ç”¨, è¿™å°±æ„å‘³ç€, "),t("strong",[s._v("åªè¦ ThreadLocal å¯¹è±¡å­˜åœ¨, é‚£ä¹ˆ Map ä¸­çš„ Thread å¯¹è±¡å°±æ°¸è¿œä¸ä¼šè¢«å›æ”¶")]),s._v(". ThreadLocal çš„ç”Ÿå‘½å‘¨æœŸå¾€å¾€éƒ½æ¯”çº¿ç¨‹è¦é•¿, æ‰€ä»¥è¿™ç§è®¾è®¡æ–¹æ¡ˆå¾ˆå®¹æ˜“å¯¼è‡´å†…å­˜æ³„éœ². è€Œ Java çš„å®ç°ä¸­ Thread æŒæœ‰ ThreadLocalMap, è€Œä¸” ThreadLocalMap é‡Œå¯¹ ThreadLocal çš„å¼•ç”¨è¿˜æ˜¯å¼±å¼•ç”¨(WeakReference), "),t("strong",[s._v("æ‰€ä»¥åªè¦ Thread å¯¹è±¡å¯ä»¥è¢«å›æ”¶, é‚£ä¹ˆ ThreadLocalMap å°±èƒ½è¢«å›æ”¶")]),s._v(". Java çš„è¿™ç§å®ç°æ–¹æ¡ˆè™½ç„¶çœ‹ä¸Šå»å¤æ‚ä¸€äº›, ä½†æ˜¯æ›´åŠ å®‰å…¨.")]),s._v(" "),t("p",[s._v("Java çš„ ThreadLocal å®ç°åº”è¯¥ç§°å¾—ä¸Šæ·±æ€ç†Ÿè™‘äº†, ä¸è¿‡å³ä¾¿å¦‚æ­¤æ·±æ€ç†Ÿè™‘, "),t("strong",[s._v("è¿˜æ˜¯ä¸èƒ½ç™¾åˆ†ç™¾åœ°è®©ç¨‹åºå‘˜é¿å…å†…å­˜æ³„éœ², ä¾‹å¦‚åœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨ ThreadLocal, å¦‚æœä¸è°¨æ…å°±å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"threadlocalä¸å†…å­˜æ³„éœ²"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#threadlocalä¸å†…å­˜æ³„éœ²"}},[s._v("#")]),s._v(" ThreadLocalä¸å†…å­˜æ³„éœ²")]),s._v(" "),t("p",[s._v("åœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨ ThreadLocal ä¸ºä»€ä¹ˆå¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²å‘¢? åŸå› å°±å‡ºåœ¨"),t("mark",[t("strong",[s._v("çº¿ç¨‹æ± ")])]),s._v("â€‹"),t("strong",[s._v("ä¸­çº¿ç¨‹çš„å­˜æ´»æ—¶é—´å¤ªé•¿, å¾€å¾€éƒ½æ˜¯å’Œç¨‹åºåŒç”Ÿå…±æ­»çš„, è¿™å°±æ„å‘³ç€ Thread æŒæœ‰çš„ ThreadLocalMap ä¸€ç›´éƒ½ä¸ä¼šè¢«å›æ”¶, å†åŠ ä¸Š ThreadLocalMap ä¸­çš„ Entry å¯¹ ThreadLocal æ˜¯å¼±å¼•ç”¨(WeakReference), æ‰€ä»¥åªè¦ ThreadLocal ç»“æŸäº†è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¯ä»¥è¢«å›æ”¶æ‰çš„. ä½†æ˜¯ Entry ä¸­çš„ Value å´æ˜¯è¢« Entry å¼ºå¼•ç”¨çš„, æ‰€ä»¥å³ä¾¿ Value çš„ç”Ÿå‘½å‘¨æœŸç»“æŸäº†, Value ä¹Ÿæ˜¯æ— æ³•è¢«å›æ”¶çš„, ä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£åœ¨çº¿ç¨‹æ± ä¸­, è¯¥å¦‚ä½•æ­£ç¡®ä½¿ç”¨ ThreadLocal å‘¢? å…¶å®å¾ˆç®€å•, æ—¢ç„¶ JVM ä¸èƒ½åšåˆ°è‡ªåŠ¨é‡Šæ”¾å¯¹ Value çš„å¼ºå¼•ç”¨, é‚£æ‰‹åŠ¨é‡Šæ”¾å°±å¯ä»¥äº†. å¦‚ä½•èƒ½åšåˆ°æ‰‹åŠ¨é‡Šæ”¾å‘¢? ä¼°è®¡ä½ é©¬ä¸Šæƒ³åˆ° "),t("strong",[s._v("try{}finally{} æ–¹æ¡ˆ")]),s._v("äº†, è¿™ä¸ªç®€ç›´å°±æ˜¯"),t("strong",[s._v("æ‰‹åŠ¨é‡Šæ”¾èµ„æºçš„åˆ©å™¨")]),s._v(". ç¤ºä¾‹çš„ä»£ç å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),s._v(" tl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ThreadLocal å¢åŠ å˜é‡")]),s._v("\n    tl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰‹åŠ¨æ¸…ç† ThreadLocal ")]),s._v("\n        tl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h5",{attrs:{id:"inheritablethreadlocalä¸ç»§æ‰¿æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#inheritablethreadlocalä¸ç»§æ‰¿æ€§"}},[s._v("#")]),s._v(" InheritableThreadLocalä¸ç»§æ‰¿æ€§")]),s._v(" "),t("p",[t("strong",[s._v("é€šè¿‡ ThreadLocal åˆ›å»ºçš„çº¿ç¨‹å˜é‡, å…¶å­çº¿ç¨‹æ˜¯æ— æ³•ç»§æ‰¿çš„")]),s._v(". ä¹Ÿå°±æ˜¯è¯´"),t("strong",[s._v("åœ¨çº¿ç¨‹ä¸­é€šè¿‡ ThreadLocal åˆ›å»ºäº†çº¿ç¨‹å˜é‡ V, è€Œåè¯¥çº¿ç¨‹åˆ›å»ºäº†å­çº¿ç¨‹, åœ¨å­çº¿ç¨‹ä¸­æ˜¯æ— æ³•é€šè¿‡ ThreadLocal æ¥è®¿é—®çˆ¶çº¿ç¨‹çš„çº¿ç¨‹å˜é‡ V çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æœéœ€è¦å­çº¿ç¨‹ç»§æ‰¿çˆ¶çº¿ç¨‹çš„çº¿ç¨‹å˜é‡, é‚£è¯¥æ€ä¹ˆåŠå‘¢? å…¶å®å¾ˆç®€å•, Java æä¾›äº† InheritableThreadLocal æ¥æ”¯æŒè¿™ç§ç‰¹æ€§, InheritableThreadLocal æ˜¯ ThreadLocal å­ç±», æ‰€ä»¥ç”¨æ³•å’Œ ThreadLocal ç›¸åŒ, è¿™é‡Œå°±ä¸å¤šä»‹ç»äº†.")]),s._v(" "),t("p",[s._v("ä¸è¿‡, "),t("strong",[s._v("å®Œå…¨ä¸å»ºè®®åœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨ InheritableThreadLocal")]),s._v(", ä¸ä»…ä»…æ˜¯å› ä¸ºå®ƒå…·æœ‰ ThreadLocal ç›¸åŒçš„ç¼ºç‚¹-å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ², æ›´é‡è¦çš„åŸå› æ˜¯: çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„åˆ›å»ºæ˜¯åŠ¨æ€çš„, å¾ˆå®¹æ˜“å¯¼è‡´ç»§æ‰¿å…³ç³»é”™ä¹±, å¦‚æœä¸šåŠ¡é€»è¾‘ä¾èµ– InheritableThreadLocal, é‚£ä¹ˆå¾ˆå¯èƒ½å¯¼è‡´ä¸šåŠ¡é€»è¾‘è®¡ç®—é”™è¯¯, è€Œè¿™ä¸ªé”™è¯¯å¾€å¾€æ¯”å†…å­˜æ³„éœ²æ›´è¦å‘½.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-22"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-22"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é¿å…å…±äº«çš„æ–¹æ¡ˆ, ç”±äºæ²¡æœ‰å…±äº«, æ‰€ä»¥è‡ªç„¶ä¹Ÿå°±æ²¡æœ‰å¹¶å‘é—®é¢˜. å¦‚æœä½ éœ€è¦åœ¨å¹¶å‘åœºæ™¯ä¸­ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„å·¥å…·ç±», æœ€ç®€å•çš„æ–¹æ¡ˆå°±æ˜¯"),t("strong",[s._v("é¿å…å…±äº«")]),s._v(". é¿å…å…±äº«æœ‰ä¸¤ç§æ–¹æ¡ˆ, ä¸€ç§æ–¹æ¡ˆæ˜¯å°†è¿™ä¸ªå·¥å…·ç±»ä½œä¸º"),t("strong",[s._v("å±€éƒ¨å˜é‡ä½¿ç”¨")]),s._v(", å¦å¤–ä¸€ç§æ–¹æ¡ˆå°±æ˜¯"),t("strong",[s._v("çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼")]),s._v(". è¿™ä¸¤ç§æ–¹æ¡ˆ, å±€éƒ¨å˜é‡æ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡, è€Œçº¿ç¨‹æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆ, æ¯ä¸ªçº¿ç¨‹åªéœ€è¦åˆ›å»ºä¸€ä¸ªå·¥å…·ç±»çš„å®ä¾‹, æ‰€ä»¥ä¸å­˜åœ¨é¢‘ç¹åˆ›å»ºå¯¹è±¡çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼æ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„å¸¸ç”¨æ–¹æ¡ˆ, æ‰€ä»¥ Java SDK ä¹Ÿæä¾›äº†ç›¸åº”çš„å®ç°: "),t("strong",[s._v("ThreadLocal")]),s._v(". é€šè¿‡ä¸Šé¢çš„åˆ†æ, ä½ åº”è¯¥èƒ½ä½“ä¼šåˆ° Java SDK çš„å®ç°å·²ç»æ˜¯æ·±æ€ç†Ÿè™‘äº†, ä¸è¿‡å³ä¾¿å¦‚æ­¤, ä»ä¸èƒ½å°½å–„å°½ç¾, ä¾‹å¦‚"),t("strong",[s._v("åœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨ ThreadLocal ä»å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼")]),s._v(", æ‰€ä»¥ä½¿ç”¨ ThreadLocal è¿˜æ˜¯éœ€è¦è¶³å¤Ÿè°¨æ….")]),s._v(" "),t("h4",{attrs:{id:"_31-guarded-suspensionæ¨¡å¼-ç­‰å¾…å”¤é†’æœºåˆ¶çš„è§„èŒƒå®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_31-guarded-suspensionæ¨¡å¼-ç­‰å¾…å”¤é†’æœºåˆ¶çš„è§„èŒƒå®ç°"}},[s._v("#")]),s._v(" 31-Guarded Suspensionæ¨¡å¼:ç­‰å¾…å”¤é†’æœºåˆ¶çš„è§„èŒƒå®ç°")]),s._v(" "),t("p",[s._v("å‰ä¸ä¹…, åŒäº‹å°ç°å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªé—®é¢˜, ä»–å¼€å‘äº†ä¸€ä¸ª Web é¡¹ç›®: Web ç‰ˆçš„æ–‡ä»¶æµè§ˆå™¨, é€šè¿‡å®ƒç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨é‡ŒæŸ¥çœ‹æœåŠ¡å™¨ä¸Šçš„ç›®å½•å’Œæ–‡ä»¶. è¿™ä¸ªé¡¹ç›®ä¾èµ–è¿ç»´éƒ¨é—¨æä¾›çš„æ–‡ä»¶æµè§ˆæœåŠ¡, è€Œè¿™ä¸ªæ–‡ä»¶æµè§ˆæœåŠ¡åªæ”¯æŒæ¶ˆæ¯é˜Ÿåˆ—(MQ)æ–¹å¼æ¥å…¥. æ¶ˆæ¯é˜Ÿåˆ—åœ¨äº’è”ç½‘å¤§å‚ä¸­ç”¨çš„éå¸¸å¤š, ä¸»è¦ç”¨ä½œæµé‡å‰Šå³°å’Œç³»ç»Ÿè§£è€¦. åœ¨è¿™ç§æ¥å…¥æ–¹å¼ä¸­, å‘é€æ¶ˆæ¯å’Œæ¶ˆè´¹ç»“æœè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´æ˜¯å¼‚æ­¥çš„, å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºæ„å›¾æ¥ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7db95a5bd8218b3ee3bbd8f7c3722ec5-20230731162452-grlbooj.png",alt:"",title:"æ¶ˆæ¯é˜Ÿåˆ—(MQ)ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("åœ¨å°ç°çš„è¿™ä¸ª Web é¡¹ç›®ä¸­, ç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘è¿‡æ¥ä¸€ä¸ªè¯·æ±‚, ä¼šè¢«è½¬æ¢æˆä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯å‘é€ç»™ MQ, ç­‰ MQ è¿”å›ç»“æœå, å†å°†è¿™ä¸ªç»“æœè¿”å›è‡³æµè§ˆå™¨. å°ç°åŒå­¦çš„é—®é¢˜æ˜¯: "),t("strong",[s._v("ç»™ MQ å‘é€æ¶ˆæ¯çš„çº¿ç¨‹æ˜¯å¤„ç† Web è¯·æ±‚çš„çº¿ç¨‹ T1, ä½†æ¶ˆè´¹ MQ ç»“æœçš„çº¿ç¨‹å¹¶ä¸æ˜¯çº¿ç¨‹ T1, é‚£çº¿ç¨‹ T1 å¦‚ä½•ç­‰å¾… MQ çš„è¿”å›ç»“æœå‘¢")]),s._v("? ä¸ºä¾¿äºç†è§£è¿™ä¸ªåœºæ™¯, æˆ‘å°†å…¶ä»£ç åŒ–äº†, ç¤ºä¾‹ä»£ç å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯¥æ–¹æ³•å¯ä»¥å‘é€æ¶ˆæ¯")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ç›¸å…³ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// MQ æ¶ˆæ¯è¿”å›åä¼šè°ƒç”¨è¯¥æ–¹æ³•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯¥æ–¹æ³•çš„æ‰§è¡Œçº¿ç¨‹ä¸åŒäº")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘é€æ¶ˆæ¯çš„çº¿ç¨‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ç›¸å…³ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†æµè§ˆå™¨å‘æ¥çš„è¯·æ±‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Respond")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleWebReq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä¸€æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{...}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘é€æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚ä½•ç­‰å¾… MQ è¿”å›çš„æ¶ˆæ¯å‘¢? ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("çœ‹åˆ°è¿™é‡Œ, ç›¸ä¿¡ä½ ä¸€å®šæœ‰ç‚¹ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰, è¿™ä¸å°±æ˜¯å‰é¢æ›¾ä»‹ç»è¿‡çš„"),t("strong",[s._v("å¼‚æ­¥è½¬åŒæ­¥")]),s._v("é—®é¢˜å—? ä»”ç»†åˆ†æ, çš„ç¡®æ˜¯è¿™æ ·, ä¸è¿‡åœ¨é‚£ä¸€èŠ‚åªæ˜¯ä»‹ç»äº†æœ€ç»ˆæ–¹æ¡ˆ, è®©ä½ çŸ¥å…¶ç„¶, ä½†æ˜¯å¹¶æ²¡æœ‰ä»‹ç»è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¦‚ä½•è®¾è®¡å‡ºæ¥çš„, ä»Šå¤©å†ä»”ç»†èŠèŠè¿™ä¸ªé—®é¢˜, è®©ä½ çŸ¥å…¶æ‰€ä»¥ç„¶, é‡åˆ°ç±»ä¼¼é—®é¢˜ä¹Ÿèƒ½è‡ªå·±è®¾è®¡å‡ºæ–¹æ¡ˆæ¥.")]),s._v(" "),t("h5",{attrs:{id:"guarded-suspensionæ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#guarded-suspensionæ¨¡å¼"}},[s._v("#")]),s._v(" Guarded Suspensionæ¨¡å¼")]),s._v(" "),t("p",[s._v('ä¸Šé¢å°ç°é‡åˆ°çš„é—®é¢˜, åœ¨ç°å®ä¸–ç•Œé‡Œæ¯”æ¯”çš†æ˜¯, åªæ˜¯å¤§å®¶ä¸€ä¸å°å¿ƒå°±å¿½ç•¥äº†. æ¯”å¦‚, é¡¹ç›®ç»„å›¢å»ºè¦å¤–å‡ºèšé¤, å¤§å®¶æå‰é¢„è®¢äº†ä¸€ä¸ªåŒ…é—´, ç„¶åå…´å†²å†²åœ°å¥”è¿‡å», åˆ°é‚£å„¿åå¤§å ‚ç»ç†çœ‹äº†ä¸€çœ¼åŒ…é—´, å‘ç°æœåŠ¡å‘˜æ­£åœ¨æ”¶æ‹¾, å°±ä¼šå‘Šè¯‰æˆ‘ä»¬: "æ‚¨é¢„è®¢çš„åŒ…é—´æœåŠ¡å‘˜æ­£åœ¨æ”¶æ‹¾, è¯·æ‚¨ç¨ç­‰ç‰‡åˆ»." è¿‡äº†ä¸€ä¼š, å¤§å ‚ç»ç†å‘ç°åŒ…é—´å·²ç»æ”¶æ‹¾å®Œäº†, äºæ˜¯é©¬ä¸Šå¸¦å¤§å®¶å»åŒ…é—´å°±é¤.')]),s._v(" "),t("p",[s._v("å¤§å®¶ç­‰å¾…åŒ…é—´æ”¶æ‹¾å®Œçš„è¿™ä¸ªè¿‡ç¨‹å’Œå°ç°é‡åˆ°çš„ç­‰å¾… MQ è¿”å›æ¶ˆæ¯æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„, éƒ½æ˜¯"),t("strong",[s._v("ç­‰å¾…ä¸€ä¸ªæ¡ä»¶æ»¡è¶³")]),s._v(": å°±é¤éœ€è¦ç­‰å¾…åŒ…é—´æ”¶æ‹¾å®Œ, å°ç°çš„ç¨‹åºé‡Œè¦ç­‰å¾… MQ è¿”å›æ¶ˆæ¯.")]),s._v(" "),t("p",[s._v("æ¥çœ‹çœ‹ç°å®ä¸–ç•Œé‡Œæ˜¯å¦‚ä½•è§£å†³è¿™ç±»é—®é¢˜çš„å‘¢? ç°å®ä¸–ç•Œé‡Œ"),t("strong",[s._v("å¤§å ‚ç»ç†è¿™ä¸ªè§’è‰²")]),s._v("å¾ˆé‡è¦, æ˜¯å¦ç­‰å¾…å®Œå…¨æ˜¯ç”±ä»–æ¥åè°ƒçš„. é€šè¿‡ç±»æ¯”, ç›¸ä¿¡ä½ ä¹Ÿä¸€å®šæœ‰æ€è·¯äº†: ç¨‹åºé‡Œä¹Ÿéœ€è¦è¿™æ ·ä¸€ä¸ªå¤§å ‚ç»ç†. çš„ç¡®æ˜¯è¿™æ ·, é‚£ç¨‹åºä¸–ç•Œé‡Œçš„å¤§å ‚ç»ç†è¯¥å¦‚ä½•è®¾è®¡å‘¢? å…¶å®è®¾è®¡æ–¹æ¡ˆå‰äººæ—©å°±æå®šäº†, è€Œä¸”è¿˜å°†å…¶æ€»ç»“æˆäº†ä¸€ä¸ªè®¾è®¡æ¨¡å¼: "),t("strong",[s._v("Guarded Suspension")]),s._v('. æ‰€è°“ Guarded Suspension, ç›´è¯‘è¿‡æ¥å°±æ˜¯ "ä¿æŠ¤æ€§åœ°æš‚åœ". é‚£ä¸‹é¢å°±æ¥çœ‹çœ‹, Guarded Suspension æ¨¡å¼æ˜¯å¦‚ä½•æ¨¡æ‹Ÿå¤§å ‚ç»ç†è¿›è¡Œä¿æŠ¤æ€§åœ°æš‚åœçš„.')]),s._v(" "),t("p",[s._v("ä¸‹å›¾å°±æ˜¯ Guarded Suspension æ¨¡å¼çš„ç»“æ„å›¾, éå¸¸ç®€å•, "),t("strong",[s._v("ä¸€ä¸ªå¯¹è±¡ GuardedObjec")]),s._v("t, å†…éƒ¨æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡â€”â€”å—ä¿æŠ¤çš„å¯¹è±¡, ä»¥åŠä¸¤ä¸ªæˆå‘˜æ–¹æ³• "),t("code",[s._v("get(Predicate<T> p)")]),s._v("â€‹ å’Œ "),t("code",[s._v("onChanged(T obj)")]),s._v("â€‹ æ–¹æ³•. å…¶ä¸­, å¯¹è±¡ GuardedObject å°±æ˜¯å¤§å ‚ç»ç†, å—ä¿æŠ¤å¯¹è±¡å°±æ˜¯é¤å…é‡Œé¢çš„åŒ…é—´; å—ä¿æŠ¤å¯¹è±¡çš„ get() æ–¹æ³•å¯¹åº”çš„æ˜¯å°±é¤, å°±é¤çš„å‰ææ¡ä»¶æ˜¯åŒ…é—´å·²ç»æ”¶æ‹¾å¥½äº†, å‚æ•° p å°±æ˜¯ç”¨æ¥æè¿°è¿™ä¸ªå‰ææ¡ä»¶çš„; å—ä¿æŠ¤å¯¹è±¡çš„ onChanged() æ–¹æ³•å¯¹åº”çš„æ˜¯æœåŠ¡å‘˜æŠŠåŒ…é—´æ”¶æ‹¾å¥½äº†, é€šè¿‡ onChanged() æ–¹æ³•å¯ä»¥ fire ä¸€ä¸ªäº‹ä»¶, è€Œè¿™ä¸ªäº‹ä»¶å¾€å¾€èƒ½æ”¹å˜å‰ææ¡ä»¶ p çš„è®¡ç®—ç»“æœ. ä¸‹å›¾ä¸­, å·¦ä¾§çš„ç»¿è‰²çº¿ç¨‹å°±æ˜¯éœ€è¦å°±é¤çš„é¡¾å®¢, è€Œå³ä¾§çš„è“è‰²çº¿ç¨‹å°±æ˜¯æ”¶æ‹¾åŒ…é—´çš„æœåŠ¡å‘˜.")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/df25930c41752d8e8991a758f3b87e33-20230731162452-y4m3t8w.png",alt:"",title:"Guarded Suspension æ¨¡å¼ç»“æ„å›¾"}}),s._v("â€‹")]),s._v(" "),t("p",[s._v("GuardedObject çš„å†…éƒ¨å®ç°éå¸¸ç®€å•, æ˜¯"),t("strong",[s._v("ç®¡ç¨‹")]),s._v("çš„ä¸€ä¸ªç»å…¸ç”¨æ³•, å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ä»£ç , æ ¸å¿ƒæ˜¯: "),t("strong",[s._v("get() æ–¹æ³•é€šè¿‡æ¡ä»¶å˜é‡çš„ await() æ–¹æ³•å®ç°ç­‰å¾…, onChanged() æ–¹æ³•é€šè¿‡æ¡ä»¶å˜é‡çš„ signalAll() æ–¹æ³•å®ç°å”¤é†’åŠŸèƒ½")]),s._v(". é€»è¾‘è¿˜æ˜¯å¾ˆç®€å•çš„, æ‰€ä»¥è¿™é‡Œå°±ä¸å†è¯¦ç»†ä»‹ç»äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å—ä¿æŠ¤çš„å¯¹è±¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Condition")]),s._v(" done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCondition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å—ä¿æŠ¤å¯¹è±¡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Predicate")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// MESA ç®¡ç¨‹æ¨èå†™æ³•")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›éç©ºçš„å—ä¿æŠ¤å¯¹è±¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// äº‹ä»¶é€šçŸ¥æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onChanged")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signalAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("h5",{attrs:{id:"æ‰©å±•guarded-suspensionæ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ‰©å±•guarded-suspensionæ¨¡å¼"}},[s._v("#")]),s._v(" æ‰©å±•Guarded Suspensionæ¨¡å¼")]),s._v(" "),t("p",[s._v('ä¸Šé¢ä»‹ç»äº† Guarded Suspension æ¨¡å¼åŠå…¶å®ç°, è¿™ä¸ªæ¨¡å¼èƒ½å¤Ÿæ¨¡æ‹Ÿç°å®ä¸–ç•Œé‡Œå¤§å ‚ç»ç†çš„è§’è‰², é‚£ç°åœ¨å†æ¥çœ‹çœ‹è¿™ä¸ª"å¤§å ‚ç»ç†"èƒ½å¦è§£å†³å°ç°åŒå­¦é‡åˆ°çš„é—®é¢˜.')]),s._v(" "),t("p",[s._v("Guarded Suspension æ¨¡å¼é‡Œ GuardedObject æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•, ä¸€ä¸ªæ˜¯ get() æ–¹æ³•, ä¸€ä¸ªæ˜¯ onChanged() æ–¹æ³•. å¾ˆæ˜¾ç„¶, åœ¨å¤„ç† Web è¯·æ±‚çš„æ–¹æ³• handleWebReq() ä¸­, å¯ä»¥"),t("strong",[s._v("è°ƒç”¨ GuardedObject çš„ get() æ–¹æ³•æ¥å®ç°ç­‰å¾…; åœ¨ MQ æ¶ˆæ¯çš„æ¶ˆè´¹æ–¹æ³• onMessage() ä¸­, å¯ä»¥è°ƒç”¨ GuardedObject çš„ onChanged() æ–¹æ³•æ¥å®ç°å”¤é†’")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†æµè§ˆå™¨å‘æ¥çš„è¯·æ±‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Respond")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleWebReq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä¸€æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘é€æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ©ç”¨ GuardedObject å®ç°ç­‰å¾…")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" go "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardObjec")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" go"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚ä½•æ‰¾åˆ°åŒ¹é…çš„ go? ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" go "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n    go"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onChanged")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("ä½†æ˜¯åœ¨å®ç°çš„æ—¶å€™ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜, handleWebReq() é‡Œé¢åˆ›å»ºäº† GuardedObject å¯¹è±¡çš„å®ä¾‹ go, å¹¶è°ƒç”¨å…¶ get() æ–¹ç­‰å¾…ç»“æœ, é‚£åœ¨ onMessage() æ–¹æ³•ä¸­, å¦‚ä½•æ‰èƒ½å¤Ÿæ‰¾åˆ°åŒ¹é…çš„ GuardedObject å¯¹è±¡å‘¢? è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼æœåŠ¡å‘˜å‘Šè¯‰å¤§å ‚ç»ç†æŸæŸåŒ…é—´å·²ç»æ”¶æ‹¾å¥½äº†, å¤§å ‚ç»ç†å¦‚ä½•æ ¹æ®åŒ…é—´æ‰¾åˆ°å°±é¤çš„äºº. ç°å®ä¸–ç•Œé‡Œ, å¤§å ‚ç»ç†çš„å¤´è„‘ä¸­, æœ‰åŒ…é—´å’Œå°±é¤äººä¹‹é—´çš„å…³ç³»å›¾, æ‰€ä»¥æœåŠ¡å‘˜è¯´å®Œä¹‹åå¤§å ‚ç»ç†ç«‹åˆ»å°±èƒ½æŠŠå°±é¤äººæ‰¾å‡ºæ¥.")]),s._v(" "),t("p",[s._v("å¯ä»¥å‚è€ƒå¤§å ‚ç»ç†è¯†åˆ«å°±é¤äººçš„åŠæ³•, æ¥æ‰©å±•ä¸€ä¸‹ Guarded Suspension æ¨¡å¼, ä»è€Œä½¿å®ƒèƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°è§£å†³å°ç°åŒå­¦çš„é—®é¢˜. åœ¨å°ç°çš„ç¨‹åºä¸­, "),t("strong",[s._v("æ¯ä¸ªå‘é€åˆ° MQ çš„æ¶ˆæ¯, éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ€§çš„å±æ€§ id")]),s._v(", æ‰€ä»¥å¯ä»¥"),t("strong",[s._v("ç»´æŠ¤ä¸€ä¸ª MQ æ¶ˆæ¯ id å’Œ GuardedObject å¯¹è±¡å®ä¾‹çš„å…³ç³», è¿™ä¸ªå…³ç³»å¯ä»¥ç±»æ¯”å¤§å ‚ç»ç†å¤§è„‘é‡Œç»´æŠ¤çš„åŒ…é—´å’Œå°±é¤äººçš„å…³ç³»")]),s._v(".")]),s._v(" "),t("p",[s._v("æœ‰äº†è¿™ä¸ªå…³ç³», æ¥çœ‹çœ‹å…·ä½“å¦‚ä½•å®ç°. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯æ‰©å±• Guarded Suspension æ¨¡å¼çš„å®ç°, æ‰©å±•åçš„ GuardedObject å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª "),t("strong",[s._v("Map")]),s._v(", å…¶ Key æ˜¯ MQ æ¶ˆæ¯ id, è€Œ Value æ˜¯ GuardedObject å¯¹è±¡å®ä¾‹, åŒæ—¶å¢åŠ äº†é™æ€æ–¹æ³• create() å’Œ fireEvent(); create() æ–¹æ³•ç”¨æ¥åˆ›å»ºä¸€ä¸ª GuardedObject å¯¹è±¡å®ä¾‹, å¹¶æ ¹æ® key å€¼å°†å…¶åŠ å…¥åˆ° Map ä¸­, è€Œ fireEvent() æ–¹æ³•åˆ™æ˜¯æ¨¡æ‹Ÿçš„å¤§å ‚ç»ç†æ ¹æ®åŒ…é—´æ‰¾å°±é¤äººçš„é€»è¾‘.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å—ä¿æŠ¤çš„å¯¹è±¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lock")]),s._v(" lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Condition")]),s._v(" done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCondition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿å­˜æ‰€æœ‰ GuardedObject")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GO_MAP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é™æ€æ–¹æ³•åˆ›å»º GuardedObject")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),s._v(" go "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GO_MAP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" go"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" go"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fireEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),s._v(" go "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GO_MAP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("go "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            go"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onChanged")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å—ä¿æŠ¤å¯¹è±¡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Predicate")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// MESA ç®¡ç¨‹æ¨èå†™æ³•")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›éç©ºçš„å—ä¿æŠ¤å¯¹è±¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// äº‹ä»¶é€šçŸ¥æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onChanged")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signalAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br")])]),t("p",[s._v("è¿™æ ·åˆ©ç”¨æ‰©å±•åçš„ GuardedObject æ¥è§£å†³å°ç°åŒå­¦çš„é—®é¢˜å°±å¾ˆç®€å•äº†, å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†æµè§ˆå™¨å‘æ¥çš„è¯·æ±‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Respond")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleWebReq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" åºå·ç”Ÿæˆå™¨"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä¸€æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{...}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º GuardedObject å®ä¾‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" go "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘é€æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾… MQ æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" go"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å”¤é†’ç­‰å¾…çš„çº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuardedObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fireEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-23"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-23"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[t("strong",[s._v("Guarded Suspension æ¨¡å¼æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç­‰å¾…å”¤é†’æœºåˆ¶çš„å®ç°")]),s._v(", åªä¸è¿‡ Guarded Suspension æ¨¡å¼å°†å…¶è§„èŒƒåŒ–äº†. è§„èŒƒåŒ–çš„å¥½å¤„æ˜¯ä½ æ— éœ€é‡å¤´æ€è€ƒå¦‚ä½•å®ç°, ä¹Ÿæ— éœ€æ‹…å¿ƒå®ç°ç¨‹åºçš„å¯ç†è§£æ€§é—®é¢˜, åŒæ—¶ä¹Ÿèƒ½é¿å…ä¸€ä¸å°å¿ƒå†™å‡ºä¸ª Bug æ¥. ä½† Guarded Suspension æ¨¡å¼åœ¨è§£å†³å®é™…é—®é¢˜çš„æ—¶å€™, å¾€å¾€è¿˜æ˜¯éœ€è¦æ‰©å±•çš„, æ‰©å±•çš„æ–¹å¼æœ‰å¾ˆå¤š, æœ¬èŠ‚å°±ç›´æ¥å¯¹ GuardedObject çš„åŠŸèƒ½è¿›è¡Œäº†å¢å¼º, "),t("strong",[s._v("Dubbo ä¸­ DefaultFuture è¿™ä¸ªç±»ä¹Ÿæ˜¯é‡‡ç”¨çš„è¿™ç§æ–¹å¼")]),s._v(", å¯ä»¥å¯¹æ¯”ç€æ¥çœ‹, ç›¸ä¿¡å¯¹ DefaultFuture çš„å®ç°åŸç†ä¼šç†è§£å¾—æ›´é€å½». å½“ç„¶ä¹Ÿå¯ä»¥åˆ›å»ºæ–°çš„ç±»æ¥å®ç°å¯¹ Guarded Suspension æ¨¡å¼çš„æ‰©å±•.")]),s._v(" "),t("p",[s._v("Guarded Suspension æ¨¡å¼ä¹Ÿå¸¸è¢«"),t("strong",[s._v("ç§°ä½œ Guarded Wait æ¨¡å¼")]),s._v(', Spin Lock æ¨¡å¼(å› ä¸ºä½¿ç”¨äº† while å¾ªç¯å»ç­‰å¾…), è¿™äº›åå­—éƒ½å¾ˆå½¢è±¡, ä¸è¿‡å®ƒè¿˜æœ‰ä¸€ä¸ªæ›´å½¢è±¡çš„éå®˜æ–¹åå­—: å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ if. å•çº¿ç¨‹åœºæ™¯ä¸­, if è¯­å¥æ˜¯ä¸éœ€è¦ç­‰å¾…çš„, å› ä¸ºåœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„æ¡ä»¶ä¸‹, å¦‚æœè¿™ä¸ªçº¿ç¨‹è¢«é˜»å¡, é‚£å°±æ²¡æœ‰å…¶ä»–æ´»åŠ¨çº¿ç¨‹äº†, è¿™æ„å‘³ç€ if åˆ¤æ–­æ¡ä»¶çš„ç»“æœä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–äº†. ä½†æ˜¯å¤šçº¿ç¨‹åœºæ™¯ä¸­, ç­‰å¾…å°±å˜å¾—æœ‰æ„ä¹‰äº†, è¿™ç§åœºæ™¯ä¸‹, if åˆ¤æ–­æ¡ä»¶çš„ç»“æœæ˜¯å¯èƒ½å‘ç”Ÿå˜åŒ–çš„. æ‰€ä»¥, ç”¨ "å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ if" æ¥ç†è§£è¿™ä¸ªæ¨¡å¼ä¼šæ›´ç®€å•.')]),s._v(" "),t("h4",{attrs:{id:"_32-balkingæ¨¡å¼-å†è°ˆçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_32-balkingæ¨¡å¼-å†è°ˆçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"}},[s._v("#")]),s._v(" 32-Balkingæ¨¡å¼:å†è°ˆçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼")]),s._v(" "),t("p",[s._v('ä¸Šä¸€èŠ‚æåˆ°å¯ä»¥ç”¨ "å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ if" æ¥ç†è§£ Guarded Suspension æ¨¡å¼, ä¸åŒäºå•çº¿ç¨‹ä¸­çš„ if, è¿™ä¸ª "å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ if" æ˜¯'),t("strong",[s._v("éœ€è¦ç­‰å¾…")]),s._v("çš„, è€Œä¸”è¿˜å¾ˆæ‰§ç€, å¿…é¡»è¦ç­‰åˆ°æ¡ä»¶ä¸ºçœŸ. ä½†å¾ˆæ˜¾ç„¶è¿™ä¸ªä¸–ç•Œ, ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦è¿™ä¹ˆæ‰§ç€, æœ‰æ—¶å€™è¿˜éœ€è¦å¿«é€Ÿæ”¾å¼ƒ.")]),s._v(" "),t("p",[s._v("éœ€è¦å¿«é€Ÿæ”¾å¼ƒçš„ä¸€ä¸ªæœ€å¸¸è§çš„ä¾‹å­æ˜¯å„ç§"),t("strong",[s._v("ç¼–è¾‘å™¨æä¾›çš„è‡ªåŠ¨ä¿å­˜åŠŸèƒ½")]),s._v(". è‡ªåŠ¨ä¿å­˜åŠŸèƒ½çš„å®ç°é€»è¾‘ä¸€èˆ¬éƒ½æ˜¯éš”ä¸€å®šæ—¶é—´è‡ªåŠ¨æ‰§è¡Œå­˜ç›˜æ“ä½œ, å­˜ç›˜æ“ä½œçš„å‰ææ˜¯æ–‡ä»¶åšè¿‡ä¿®æ”¹, å¦‚æœæ–‡ä»¶æ²¡æœ‰æ‰§è¡Œè¿‡ä¿®æ”¹æ“ä½œ, å°±éœ€è¦å¿«é€Ÿæ”¾å¼ƒå­˜ç›˜æ“ä½œ. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°†è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ä»£ç åŒ–äº†, å¾ˆæ˜¾ç„¶ AutoSaveEditor è¿™ä¸ªç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„, å› ä¸ºå¯¹å…±äº«å˜é‡ changed çš„è¯»å†™æ²¡æœ‰ä½¿ç”¨åŒæ­¥, é‚£å¦‚ä½•ä¿è¯ AutoSaveEditor çš„çº¿ç¨‹å®‰å…¨æ€§å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AutoSaveEditor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹è¿‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ScheduledExecutorService")]),s._v(" ses "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newSingleThreadScheduledExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šæ—¶æ‰§è¡Œè‡ªåŠ¨ä¿å­˜")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("startAutoSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ses"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scheduleWithFixedDelay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("autoSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è‡ªåŠ¨å­˜ç›˜æ“ä½œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("autoSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("changed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå­˜ç›˜æ“ä½œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä¸”å®ç°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¼–è¾‘æ“ä½œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("edit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ç¼–è¾‘é€»è¾‘")]),s._v("\n        changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("è§£å†³è¿™ä¸ªé—®é¢˜ç›¸ä¿¡ä½ ä¸€å®šæ‰‹åˆ°æ“’æ¥äº†: è¯»å†™å…±äº«å˜é‡ changed çš„æ–¹æ³• autoSave() å’Œ edit() éƒ½åŠ äº’æ–¥é”å°±å¯ä»¥äº†. è¿™æ ·åšè™½ç„¶ç®€å•, ä½†æ˜¯æ€§èƒ½å¾ˆå·®, åŸå› æ˜¯é”çš„èŒƒå›´å¤ªå¤§äº†. é‚£å¯ä»¥å°†é”çš„èŒƒå›´ç¼©å°, åªåœ¨è¯»å†™å…±äº«å˜é‡ changed çš„åœ°æ–¹åŠ é”, å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è‡ªåŠ¨å­˜ç›˜æ“ä½œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("autoSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("changed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå­˜ç›˜æ“ä½œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä¸”å®ç°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¼–è¾‘æ“ä½œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("edit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ç¼–è¾‘é€»è¾‘")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("å¦‚æœæ·±å…¥åœ°åˆ†æä¸€ä¸‹è¿™ä¸ªç¤ºä¾‹ç¨‹åº, å¯ä»¥å‘ç°, ç¤ºä¾‹ä¸­çš„å…±äº«å˜é‡æ˜¯ä¸€ä¸ª"),t("strong",[s._v("çŠ¶æ€å˜é‡")]),s._v(', ä¸šåŠ¡é€»è¾‘ä¾èµ–äºè¿™ä¸ªçŠ¶æ€å˜é‡çš„çŠ¶æ€: å½“çŠ¶æ€æ»¡è¶³æŸä¸ªæ¡ä»¶æ—¶, æ‰§è¡ŒæŸä¸ªä¸šåŠ¡é€»è¾‘, å…¶æœ¬è´¨å…¶å®ä¸è¿‡å°±æ˜¯ä¸€ä¸ª if è€Œå·², æ”¾åˆ°å¤šçº¿ç¨‹åœºæ™¯é‡Œ, å°±æ˜¯ä¸€ç§ "å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ if". '),t("strong",[s._v('è¿™ç§ "å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ if" çš„åº”ç”¨åœºæ™¯è¿˜æ˜¯å¾ˆå¤šçš„, æ‰€ä»¥ä¹Ÿæœ‰äººæŠŠå®ƒæ€»ç»“æˆäº†ä¸€ç§è®¾è®¡æ¨¡å¼, å«åš Balking æ¨¡å¼')]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"balkingæ¨¡å¼çš„ç»å…¸å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#balkingæ¨¡å¼çš„ç»å…¸å®ç°"}},[s._v("#")]),s._v(" Balkingæ¨¡å¼çš„ç»å…¸å®ç°")]),s._v(" "),t("p",[t("strong",[s._v('Balking æ¨¡å¼æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è§„èŒƒåŒ–åœ°è§£å†³ "å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ if" çš„æ–¹æ¡ˆ')]),s._v(", å¯¹äºä¸Šé¢è‡ªåŠ¨ä¿å­˜çš„ä¾‹å­, ä½¿ç”¨ Balking æ¨¡å¼è§„èŒƒåŒ–ä¹‹åçš„å†™æ³•å¦‚ä¸‹æ‰€ç¤º, å¯ä»¥å‘ç°ä»…ä»…æ˜¯å°† edit() æ–¹æ³•ä¸­å¯¹å…±äº«å˜é‡ changed çš„èµ‹å€¼æ“ä½œæŠ½å–åˆ°äº† change() ä¸­, è¿™æ ·çš„å¥½å¤„æ˜¯"),t("strong",[s._v("å°†å¹¶å‘å¤„ç†é€»è¾‘å’Œä¸šåŠ¡é€»è¾‘")]),s._v("åˆ†å¼€.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è‡ªåŠ¨å­˜ç›˜æ“ä½œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("autoSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("changed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œå­˜ç›˜æ“ä½œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ä¸”å®ç°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¼–è¾‘æ“ä½œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("edit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ç¼–è¾‘é€»è¾‘")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("change")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ”¹å˜çŠ¶æ€")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("change")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h5",{attrs:{id:"ç”¨volatileå®ç°balkingæ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨volatileå®ç°balkingæ¨¡å¼"}},[s._v("#")]),s._v(" ç”¨volatileå®ç°Balkingæ¨¡å¼")]),s._v(" "),t("p",[s._v("å‰é¢ç”¨ synchronized å®ç°äº† Balking æ¨¡å¼, è¿™ç§å®ç°æ–¹å¼æœ€ä¸ºç¨³å¦¥, å»ºè®®å®é™…å·¥ä½œä¸­ä¹Ÿä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆ. ä¸è¿‡åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹, ä¹Ÿå¯ä»¥ä½¿ç”¨ volatile æ¥å®ç°, ä½†"),t("strong",[s._v("ä½¿ç”¨ volatile çš„å‰ææ˜¯å¯¹åŸå­æ€§æ²¡æœ‰è¦æ±‚")]),s._v(".")]),s._v(" "),t("p",[s._v("å‰é¢æœ‰ä¸€ä¸ª RPC æ¡†æ¶è·¯ç”±è¡¨çš„æ¡ˆä¾‹, åœ¨ RPC æ¡†æ¶ä¸­, æœ¬åœ°è·¯ç”±è¡¨æ˜¯è¦å’Œæ³¨å†Œä¸­å¿ƒè¿›è¡Œä¿¡æ¯åŒæ­¥çš„, åº”ç”¨å¯åŠ¨çš„æ—¶å€™, ä¼šå°†åº”ç”¨ä¾èµ–æœåŠ¡çš„è·¯ç”±è¡¨ä»æ³¨å†Œä¸­å¿ƒåŒæ­¥åˆ°æœ¬åœ°è·¯ç”±è¡¨ä¸­, å¦‚æœåº”ç”¨é‡å¯çš„æ—¶å€™æ³¨å†Œä¸­å¿ƒå®•æœº, é‚£ä¹ˆä¼šå¯¼è‡´è¯¥åº”ç”¨ä¾èµ–çš„æœåŠ¡å‡ä¸å¯ç”¨, å› ä¸ºæ‰¾ä¸åˆ°ä¾èµ–æœåŠ¡çš„è·¯ç”±è¡¨. ä¸ºäº†é˜²æ­¢è¿™ç§æç«¯æƒ…å†µå‡ºç°, "),t("strong",[s._v("RPC æ¡†æ¶å¯ä»¥å°†æœ¬åœ°è·¯ç”±è¡¨è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ä¸­, å¦‚æœé‡å¯çš„æ—¶å€™æ³¨å†Œä¸­å¿ƒå®•æœº, é‚£ä¹ˆå°±ä»æœ¬åœ°æ–‡ä»¶ä¸­æ¢å¤é‡å¯å‰çš„è·¯ç”±è¡¨")]),s._v(". è¿™å…¶å®ä¹Ÿæ˜¯ä¸€ç§é™çº§çš„æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("è‡ªåŠ¨ä¿å­˜è·¯ç”±è¡¨å’Œå‰é¢ä»‹ç»çš„ç¼–è¾‘å™¨è‡ªåŠ¨ä¿å­˜åŸç†æ˜¯ä¸€æ ·çš„, ä¹Ÿå¯ä»¥ç”¨ Balking æ¨¡å¼å®ç°, ä¸è¿‡è¿™é‡Œé‡‡ç”¨ volatile æ¥å®ç°, å®ç°çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º. ä¹‹æ‰€ä»¥å¯ä»¥é‡‡ç”¨ volatile æ¥å®ç°, æ˜¯å› ä¸º"),t("strong",[s._v("å¯¹å…±äº«å˜é‡ changed å’Œ rt çš„å†™æ“ä½œä¸å­˜åœ¨åŸå­æ€§çš„è¦æ±‚")]),s._v(", è€Œä¸”é‡‡ç”¨ scheduleWithFixedDelay() è¿™ç§è°ƒåº¦æ–¹å¼èƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ autoSave() æ–¹æ³•.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·¯ç”±è¡¨ä¿¡æ¯")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RouterTable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Key: æ¥å£å")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Value: è·¯ç”±é›†åˆ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CopyOnWriteArraySet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" rt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·¯ç”±è¡¨æ˜¯å¦å‘ç”Ÿå˜åŒ–")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" changed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†è·¯ç”±è¡¨å†™å…¥æœ¬åœ°æ–‡ä»¶çš„çº¿ç¨‹æ± ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ScheduledExecutorService")]),s._v(" ses "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newSingleThreadScheduledExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨å®šæ—¶ä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†å˜æ›´åçš„è·¯ç”±è¡¨å†™å…¥æœ¬åœ°æ–‡ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("startLocalSaver")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ses"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scheduleWithFixedDelay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("autoSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MINUTES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿å­˜è·¯ç”±è¡¨åˆ°æœ¬åœ°æ–‡ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("autoSave")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("changed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†è·¯ç”±è¡¨å†™å…¥æœ¬åœ°æ–‡ä»¶")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å…¶æ–¹æ³•å®ç°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save2Local")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ é™¤è·¯ç”±")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),s._v(" router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            set"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·¯ç”±è¡¨å·²å‘ç”Ÿå˜åŒ–")]),s._v("\n            changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¢åŠ è·¯ç”±")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),s._v(" router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("computeIfAbsent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("route"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("iface"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CopyOnWriteArraySet")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        set"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·¯ç”±è¡¨å·²å‘ç”Ÿå˜åŒ–")]),s._v("\n        changed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("p",[s._v("Balking æ¨¡å¼æœ‰ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯"),t("strong",[s._v("å•æ¬¡åˆå§‹åŒ–")]),s._v(", ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯å®ƒçš„å®ç°. è¿™ä¸ªå®ç°æ–¹æ¡ˆä¸­, å°† init() å£°æ˜ä¸ºä¸€ä¸ªåŒæ­¥æ–¹æ³•, "),t("strong",[s._v("è¿™æ ·åŒä¸€ä¸ªæ—¶åˆ»å°±åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œ init() æ–¹æ³•")]),s._v("; init() æ–¹æ³•åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œæ—¶ä¼šå°† inited è®¾ç½®ä¸º true, è¿™æ ·åç»­æ‰§è¡Œ init() æ–¹æ³•çš„çº¿ç¨‹å°±ä¸ä¼šå†æ‰§è¡Œ doInit() äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InitTest")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" inited "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inited"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ doInit çš„å®ç°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doInit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        inited "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[t("strong",[s._v("çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼æœ¬è´¨ä¸Šå…¶å®ä¹Ÿæ˜¯å•æ¬¡åˆå§‹åŒ–, æ‰€ä»¥å¯ä»¥ç”¨ Balking æ¨¡å¼æ¥å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼")]),s._v(", ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯å…¶å®ç°. è¿™ä¸ªå®ç°è™½ç„¶åŠŸèƒ½ä¸Šæ²¡æœ‰é—®é¢˜, ä½†æ˜¯æ€§èƒ½å´å¾ˆå·®, å› ä¸ºäº’æ–¥é” synchronized å°† getInstance() æ–¹æ³•ä¸²è¡ŒåŒ–äº†, é‚£æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹å®ƒçš„æ€§èƒ½å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" singleton"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ æ–¹æ³•ç§æœ‰åŒ–  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å®ä¾‹(å•ä¾‹)")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("singleton "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            singleton "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" singleton"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("åŠæ³•å½“ç„¶æ˜¯æœ‰çš„, é‚£å°±æ˜¯ç»å…¸çš„"),t("strong",[s._v("åŒé‡æ£€æŸ¥")]),s._v("(Double Check)æ–¹æ¡ˆ, ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯å…¶è¯¦ç»†å®ç°. åœ¨åŒé‡æ£€æŸ¥æ–¹æ¡ˆä¸­, ä¸€æ—¦ Singleton å¯¹è±¡è¢«æˆåŠŸåˆ›å»ºä¹‹å, å°±ä¸ä¼šæ‰§è¡Œ synchronized(Singleton.class){} ç›¸å…³çš„ä»£ç , ä¹Ÿå°±æ˜¯è¯´, æ­¤æ—¶ getInstance() æ–¹æ³•çš„æ‰§è¡Œè·¯å¾„æ˜¯"),t("strong",[s._v("æ— é”")]),s._v("çš„, ä»è€Œè§£å†³äº†æ€§èƒ½é—®é¢˜. ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯, è¿™ä¸ªæ–¹æ¡ˆä¸­"),t("strong",[s._v("ä½¿ç”¨äº† volatile æ¥ç¦æ­¢ç¼–è¯‘ä¼˜åŒ–")]),s._v(", å…¶åŸå› å‰é¢ä¹Ÿæåˆ°è¿‡. è‡³äºè·å–é”åçš„äºŒæ¬¡æ£€æŸ¥, åˆ™æ˜¯å‡ºäºå¯¹å®‰å…¨æ€§è´Ÿè´£.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" singleton"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ æ–¹æ³•ç§æœ‰åŒ–  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å®ä¾‹(å•ä¾‹)")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¬¬ä¸€æ¬¡æ£€æŸ¥")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("singleton "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            synchronize "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–é”åäºŒæ¬¡æ£€æŸ¥")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("singleton "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        singleton "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Singleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" singleton"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-24"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-24"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v('Balking æ¨¡å¼å’Œ Guarded Suspension æ¨¡å¼ä»å®ç°ä¸Šçœ‹ä¼¼ä¹æ²¡æœ‰å¤šå¤§çš„å…³ç³», Balking æ¨¡å¼åªéœ€è¦ç”¨äº’æ–¥é”å°±èƒ½è§£å†³, è€Œ Guarded Suspension æ¨¡å¼åˆ™è¦ç”¨åˆ°ç®¡ç¨‹è¿™ç§é«˜çº§çš„å¹¶å‘åŸè¯­; ä½†æ˜¯ä»åº”ç”¨çš„è§’åº¦æ¥çœ‹, å®ƒä»¬è§£å†³çš„éƒ½æ˜¯ "çº¿ç¨‹å®‰å…¨çš„ if" è¯­ä¹‰, ä¸åŒä¹‹å¤„åœ¨äº, Guarded Suspension æ¨¡å¼ä¼šç­‰å¾… if æ¡ä»¶ä¸ºçœŸ, è€Œ Balking æ¨¡å¼ä¸ä¼šç­‰å¾….')]),s._v(" "),t("p",[s._v("Balking æ¨¡å¼çš„ç»å…¸å®ç°æ˜¯ä½¿ç”¨"),t("strong",[s._v("äº’æ–¥é”")]),s._v(", å¯ä»¥ä½¿ç”¨ Java è¯­è¨€å†…ç½® synchronized, ä¹Ÿå¯ä»¥ä½¿ç”¨ SDK æä¾› Lock; å¦‚æœå¯¹äº’æ–¥é”çš„æ€§èƒ½ä¸æ»¡æ„, å¯ä»¥å°è¯•é‡‡ç”¨ volatile æ–¹æ¡ˆ, ä¸è¿‡ä½¿ç”¨ volatile æ–¹æ¡ˆéœ€è¦æ›´åŠ è°¨æ….")]),s._v(" "),t("p",[s._v("å½“ç„¶ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨åŒé‡æ£€æŸ¥æ–¹æ¡ˆæ¥ä¼˜åŒ–æ€§èƒ½, åŒé‡æ£€æŸ¥ä¸­çš„ç¬¬ä¸€æ¬¡æ£€æŸ¥, å®Œå…¨æ˜¯å‡ºäºå¯¹æ€§èƒ½çš„è€ƒé‡: "),t("strong",[s._v("é¿å…æ‰§è¡ŒåŠ é”æ“ä½œ, å› ä¸ºåŠ é”æ“ä½œå¾ˆè€—æ—¶. è€ŒåŠ é”ä¹‹åçš„äºŒæ¬¡æ£€æŸ¥, åˆ™æ˜¯å‡ºäºå¯¹å®‰å…¨æ€§è´Ÿè´£")]),s._v(". åŒé‡æ£€æŸ¥æ–¹æ¡ˆåœ¨ä¼˜åŒ–åŠ é”æ€§èƒ½æ–¹é¢ç»å¸¸ç”¨åˆ°.")]),s._v(" "),t("h4",{attrs:{id:"_33-thread-per-messageæ¨¡å¼-æœ€ç®€å•å®ç”¨çš„åˆ†å·¥æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_33-thread-per-messageæ¨¡å¼-æœ€ç®€å•å®ç”¨çš„åˆ†å·¥æ–¹æ³•"}},[s._v("#")]),s._v(" 33-Thread-Per-Messageæ¨¡å¼:æœ€ç®€å•å®ç”¨çš„åˆ†å·¥æ–¹æ³•")]),s._v(" "),t("p",[s._v("å‰é¢æ›¾ç»æŠŠå¹¶å‘ç¼–ç¨‹é¢†åŸŸçš„é—®é¢˜æ€»ç»“ä¸ºä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜: "),t("strong",[s._v("åˆ†å·¥, åŒæ­¥å’Œäº’æ–¥")]),s._v(". å…¶ä¸­, åŒæ­¥å’Œäº’æ–¥ç›¸å…³é—®é¢˜æ›´å¤šåœ°æºè‡ªå¾®è§‚, è€Œåˆ†å·¥é—®é¢˜åˆ™æ˜¯æºè‡ªå®è§‚. è§£å†³é—®é¢˜å¾€å¾€éƒ½æ˜¯ä»å®è§‚å…¥æ‰‹, åœ¨ç¼–ç¨‹é¢†åŸŸ, è½¯ä»¶çš„è®¾è®¡è¿‡ç¨‹ä¹Ÿæ˜¯å…ˆä»æ¦‚è¦è®¾è®¡å¼€å§‹, è€Œåæ‰è¿›è¡Œè¯¦ç»†è®¾è®¡. åŒæ ·, "),t("strong",[s._v("è§£å†³å¹¶å‘ç¼–ç¨‹é—®é¢˜, é¦–è¦é—®é¢˜ä¹Ÿæ˜¯è§£å†³å®è§‚çš„åˆ†å·¥é—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹é¢†åŸŸé‡Œ, "),t("strong",[s._v("è§£å†³åˆ†å·¥é—®é¢˜ä¹Ÿæœ‰ä¸€ç³»åˆ—çš„è®¾è®¡æ¨¡å¼, æ¯”è¾ƒå¸¸ç”¨çš„ä¸»è¦æœ‰ Thread-Per-Message æ¨¡å¼, Worker Thread æ¨¡å¼, ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ç­‰ç­‰")]),s._v(". ä»Šå¤©é‡ç‚¹ä»‹ç» Thread-Per-Message æ¨¡å¼.")]),s._v(" "),t("h5",{attrs:{id:"å¦‚ä½•ç†è§£thread-per-messageæ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ç†è§£thread-per-messageæ¨¡å¼"}},[s._v("#")]),s._v(" å¦‚ä½•ç†è§£Thread-Per-Messageæ¨¡å¼")]),s._v(" "),t("p",[s._v("ç°å®ä¸–ç•Œé‡Œ, å¾ˆå¤šäº‹æƒ…éƒ½éœ€è¦å§”æ‰˜ä»–äººåŠç†, ä¸€æ–¹é¢å—é™äºè‡ªå·±çš„èƒ½åŠ›, æ€»æœ‰å¾ˆå¤šæä¸å®šçš„äº‹, æ¯”å¦‚æ•™è‚²å°æœ‹å‹, æä¸å®šæ€ä¹ˆåŠå‘¢? åªèƒ½å§”æ‰˜å­¦æ ¡è€å¸ˆäº†; å¦ä¸€æ–¹é¢å—é™äºæ—¶é—´, æ¯”å¦‚å¿™ç€å†™ Bug, å“ªæœ‰æ—¶é—´ä¹°åˆ«å¢…å‘¢? åªèƒ½å§”æ‰˜æˆ¿äº§ä¸­ä»‹äº†. "),t("strong",[s._v("å§”æ‰˜ä»–äººä»£åŠæœ‰ä¸€ä¸ªéå¸¸å¤§çš„å¥½å¤„, é‚£å°±æ˜¯å¯ä»¥ä¸“å¿ƒåšè‡ªå·±çš„äº‹")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("åœ¨ç¼–ç¨‹é¢†åŸŸä¹Ÿæœ‰å¾ˆå¤šç±»ä¼¼çš„éœ€æ±‚, æ¯”å¦‚å†™ä¸€ä¸ª HTTP Server, å¾ˆæ˜¾ç„¶åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ¥æ”¶è¯·æ±‚, è€Œä¸èƒ½å¤„ç† HTTP è¯·æ±‚, å› ä¸ºå¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸­å¤„ç† HTTP è¯·æ±‚çš„è¯, é‚£åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚, å¤ªæ…¢äº†! æ€ä¹ˆåŠå‘¢? å¯ä»¥åˆ©ç”¨ä»£åŠçš„æ€è·¯, "),t("strong",[s._v("åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹, å§”æ‰˜å­çº¿ç¨‹å»å¤„ç† HTTP è¯·æ±‚")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ç§å§”æ‰˜ä»–äººåŠç†çš„æ–¹å¼, åœ¨å¹¶å‘ç¼–ç¨‹é¢†åŸŸè¢«æ€»ç»“ä¸ºä¸€ç§è®¾è®¡æ¨¡å¼, å«åš "),t("strong",[s._v("Thread-Per-Message æ¨¡å¼")]),s._v(", ç®€è¨€ä¹‹å°±æ˜¯"),t("strong",[s._v("ä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹. è¿™æ˜¯ä¸€ç§æœ€ç®€å•çš„åˆ†å·¥æ–¹æ³•, å®ç°èµ·æ¥ä¹Ÿéå¸¸ç®€å•")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"ç”¨threadå®ç°thread-per-messageæ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨threadå®ç°thread-per-messageæ¨¡å¼"}},[s._v("#")]),s._v(" ç”¨Threadå®ç°Thread-Per-Messageæ¨¡å¼")]),s._v(" "),t("p",[s._v("Thread-Per-Message æ¨¡å¼çš„ä¸€ä¸ªæœ€ç»å…¸çš„åº”ç”¨åœºæ™¯æ˜¯"),t("strong",[s._v("ç½‘ç»œç¼–ç¨‹é‡ŒæœåŠ¡ç«¯çš„å®ç°")]),s._v(", æœåŠ¡ç«¯ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹, å½“çº¿ç¨‹å¤„ç†å®Œè¯·æ±‚å, è‡ªåŠ¨é”€æ¯, è¿™æ˜¯ä¸€ç§æœ€ç®€å•çš„å¹¶å‘å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ–¹æ³•.")]),s._v(" "),t("p",[s._v('ç½‘ç»œç¼–ç¨‹é‡Œæœ€ç®€å•çš„ç¨‹åºå½“æ•° echo ç¨‹åºäº†, echo ç¨‹åºçš„æœåŠ¡ç«¯ä¼šåŸå°ä¸åŠ¨åœ°å°†å®¢æˆ·ç«¯çš„è¯·æ±‚å‘é€å›å®¢æˆ·ç«¯. ä¾‹å¦‚, å®¢æˆ·ç«¯å‘é€ TCP è¯·æ±‚ "Hello World", é‚£ä¹ˆæœåŠ¡ç«¯ä¹Ÿä¼šè¿”å› "Hello World".')]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±ä»¥ echo ç¨‹åºçš„æœåŠ¡ç«¯ä¸ºä¾‹, ä»‹ç»å¦‚ä½•å®ç° Thread-Per-Message æ¨¡å¼.")]),s._v(" "),t("p",[s._v("åœ¨ Java ä¸­, å®ç° echo ç¨‹åºçš„æœåŠ¡ç«¯è¿˜æ˜¯å¾ˆç®€å•çš„. åªéœ€è¦ 30 è¡Œä»£ç å°±èƒ½å¤Ÿå®ç°, ç¤ºä¾‹ä»£ç å¦‚ä¸‹, ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½åˆ›å»ºäº†ä¸€ä¸ª Java çº¿ç¨‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),s._v(" ssc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetSocketAddress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†è¯·æ±‚    ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¥æ”¶è¯·æ±‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketChannel")]),s._v(" sc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ssc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯ä¸ªè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯» Socket")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" rb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("allocateDirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™ Socket")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" wb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" rb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("flip")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­ Socket")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UncheckedIOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ssc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("å¦‚æœä½ ç†Ÿæ‚‰ç½‘ç»œç¼–ç¨‹, ç›¸ä¿¡ä½ ä¸€å®šä¼šæå‡ºä¸€ä¸ªå¾ˆå°–é”çš„é—®é¢˜: ä¸Šé¢è¿™ä¸ª echo æœåŠ¡çš„å®ç°æ–¹æ¡ˆæ˜¯"),t("strong",[s._v("ä¸å…·å¤‡å¯è¡Œæ€§")]),s._v("çš„. åŸå› åœ¨äº Java ä¸­çš„çº¿ç¨‹æ˜¯ä¸€ä¸ªé‡é‡çº§çš„å¯¹è±¡, åˆ›å»ºæˆæœ¬å¾ˆé«˜, ä¸€æ–¹é¢åˆ›å»ºçº¿ç¨‹æ¯”è¾ƒè€—æ—¶, å¦ä¸€æ–¹é¢çº¿ç¨‹å ç”¨çš„å†…å­˜ä¹Ÿæ¯”è¾ƒå¤§. æ‰€ä»¥, "),t("strong",[s._v("ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¹¶ä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯")]),s._v(".")]),s._v(" "),t("p",[s._v("äºæ˜¯, ä½ å¼€å§‹è´¨ç–‘ Thread-Per-Message æ¨¡å¼, è€Œä¸”å¼€å§‹é‡æ–°æ€ç´¢è§£å†³æ–¹æ¡ˆ, è¿™æ—¶å€™å¾ˆå¯èƒ½ä½ ä¼šæƒ³åˆ° Java æä¾›çš„"),t("strong",[s._v("çº¿ç¨‹æ± ")]),s._v(". è¿™ä¸ªæ€è·¯æ²¡æœ‰é—®é¢˜, ä½†æ˜¯å¼•å…¥çº¿ç¨‹æ± éš¾å…ä¼šå¢åŠ å¤æ‚åº¦. å…¶å®å®Œå…¨å¯ä»¥æ¢ä¸€ä¸ªè§’åº¦æ¥æ€è€ƒè¿™ä¸ªé—®é¢˜, è¯­è¨€, å·¥å…·, æ¡†æ¶æœ¬èº«åº”è¯¥æ˜¯å¸®åŠ©å¤§å®¶æ›´æ•æ·åœ°å®ç°æ–¹æ¡ˆçš„, è€Œä¸æ˜¯ç”¨æ¥å¦å®šæ–¹æ¡ˆçš„, Thread-Per-Message æ¨¡å¼ä½œä¸ºä¸€ç§æœ€ç®€å•çš„åˆ†å·¥æ–¹æ¡ˆ, Java è¯­è¨€æ”¯æŒä¸äº†, æ˜¾ç„¶æ˜¯ Java è¯­è¨€æœ¬èº«çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("Java è¯­è¨€é‡Œ, "),t("mark",[t("strong",[s._v("Java çº¿ç¨‹æ˜¯å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„, è¿™ç§åšæ³•æœ¬è´¨ä¸Šæ˜¯å°† Java çº¿ç¨‹çš„è°ƒåº¦æƒå®Œå…¨å§”æ‰˜ç»™æ“ä½œç³»ç»Ÿ, è€Œæ“ä½œç³»ç»Ÿåœ¨è¿™æ–¹é¢éå¸¸æˆç†Ÿ, æ‰€ä»¥è¿™ç§åšæ³•çš„å¥½å¤„æ˜¯ç¨³å®š, å¯é , ä½†æ˜¯ä¹Ÿç»§æ‰¿äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„ç¼ºç‚¹: åˆ›å»ºæˆæœ¬é«˜")])]),s._v(". ä¸ºäº†è§£å†³è¿™ä¸ªç¼ºç‚¹, Java å¹¶å‘åŒ…é‡Œæä¾›äº†çº¿ç¨‹æ± ç­‰å·¥å…·ç±». è¿™ä¸ªæ€è·¯åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œéƒ½æ˜¯å¾ˆç¨³å¦¥çš„æ–¹æ¡ˆ, ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸æ˜¯å”¯ä¸€çš„æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("ä¸šç•Œè¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ¡ˆ, å«åš"),t("mark",[t("strong",[s._v("è½»é‡çº§çº¿ç¨‹")])]),s._v(". è¿™ä¸ªæ–¹æ¡ˆåœ¨ Java é¢†åŸŸçŸ¥ååº¦å¹¶ä¸é«˜, ä½†æ˜¯åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€é‡Œå´å«å¾—å¾ˆå“, ä¾‹å¦‚ Go è¯­è¨€, Lua è¯­è¨€é‡Œçš„åç¨‹, æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹. "),t("strong",[s._v("è½»é‡çº§çš„çº¿ç¨‹, åˆ›å»ºçš„æˆæœ¬å¾ˆä½, åŸºæœ¬ä¸Šå’Œåˆ›å»ºä¸€ä¸ªæ™®é€šå¯¹è±¡çš„æˆæœ¬ç›¸ä¼¼; å¹¶ä¸”åˆ›å»ºçš„é€Ÿåº¦å’Œå†…å­˜å ç”¨ç›¸æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªæ•°é‡çº§çš„æå‡, æ‰€ä»¥åŸºäºè½»é‡çº§çº¿ç¨‹å®ç° Thread-Per-Message æ¨¡å¼å°±å®Œå…¨æ²¡æœ‰é—®é¢˜äº†")]),s._v(".")]),s._v(" "),t("p",[s._v("Java è¯­è¨€ç›®å‰ä¹Ÿå·²ç»æ„è¯†åˆ°è½»é‡çº§çº¿ç¨‹çš„é‡è¦æ€§äº†, OpenJDK æœ‰ä¸ª Loom é¡¹ç›®, å°±æ˜¯è¦è§£å†³ Java è¯­è¨€çš„è½»é‡çº§çº¿ç¨‹é—®é¢˜, åœ¨è¿™ä¸ªé¡¹ç›®ä¸­, è½»é‡çº§çº¿ç¨‹è¢«å« "),t("strong",[s._v("Fiber")]),s._v(". ä¸‹é¢å°±æ¥çœ‹çœ‹åŸºäº Fiber å¦‚ä½•å®ç° Thread-Per-Message æ¨¡å¼.")]),s._v(" "),t("h5",{attrs:{id:"ç”¨fiberå®ç°thread-per-messageæ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨fiberå®ç°thread-per-messageæ¨¡å¼"}},[s._v("#")]),s._v(" ç”¨Fiberå®ç°Thread-Per-Messageæ¨¡å¼")]),s._v(" "),t("p",[s._v("Loom é¡¹ç›®åœ¨è®¾è®¡è½»é‡çº§çº¿ç¨‹æ—¶, å……åˆ†è€ƒé‡äº†å½“å‰ Java çº¿ç¨‹çš„ä½¿ç”¨æ–¹å¼, é‡‡å–çš„æ˜¯å°½é‡å…¼å®¹çš„æ€åº¦, æ‰€ä»¥ä½¿ç”¨ä¸Šè¿˜æ˜¯æŒºç®€å•çš„. ç”¨ Fiber å®ç° echo æœåŠ¡çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤º, å¯¹æ¯” Thread çš„å®ç°, ä½ ä¼šå‘ç°æ”¹åŠ¨é‡éå¸¸å°, åªéœ€è¦æŠŠæ–°å»ºçº¿ç¨‹çš„æ“ä½œæ¢æˆ "),t("code",[s._v("Fiber.schedule(()->{})")]),s._v("â€‹ å°±å¯ä»¥äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),s._v(" ssc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetSocketAddress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†è¯·æ±‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¥æ”¶è¯·æ±‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketChannel")]),s._v(" sc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serverSocketChannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fiber")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("schedule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯» Socket")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" rb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("allocateDirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LockSupport")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parkNanos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™ Socket")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" wb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" rb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("flip")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­ Socket")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UncheckedIOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// while")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ssc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("é‚£ä½¿ç”¨ Fiber å®ç°çš„ echo æœåŠ¡æ˜¯å¦èƒ½å¤Ÿè¾¾åˆ°é¢„æœŸçš„æ•ˆæœå‘¢? å¯ä»¥åœ¨ Linux ç¯å¢ƒä¸‹åšä¸€ä¸ªç®€å•çš„å®éªŒ, æ­¥éª¤å¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("é¦–å…ˆé€šè¿‡ "),t("code",[s._v("ulimit -u 512")]),s._v(" å°†ç”¨æˆ·èƒ½åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°(åŒ…æ‹¬çº¿ç¨‹)è®¾ç½®ä¸º 512;")]),s._v(" "),t("li",[s._v("å¯åŠ¨ Fiber å®ç°çš„ echo ç¨‹åº;")]),s._v(" "),t("li",[s._v("åˆ©ç”¨å‹æµ‹å·¥å…· ab è¿›è¡Œå‹æµ‹: "),t("code",[s._v("ab -r -c 20000 -n 200000 http:// æµ‹è¯•æœº IP åœ°å€:8080/")]),s._v("â€‹")])]),s._v(" "),t("p",[s._v("å‹æµ‹æ‰§è¡Œç»“æœå¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Concurrency")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Time")]),s._v(" taken "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" tests"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("67.718")]),s._v(" seconds\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Complete")]),s._v(" requests"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Failed")]),s._v(" requests"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Write")]),s._v(" errors"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Non")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("xx responses"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Total")]),s._v(" transferred"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16400000")]),s._v(" bytes\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTML")]),s._v(" transferred"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Requests")]),s._v(" per second"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2953.41")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("#"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Time")]),s._v(" per request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6771.844")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Time")]),s._v(" per request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.339")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" across all concurrent requests"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Transfer")]),s._v(" rate"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("236.50")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Kbytes")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received\n \n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connection")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Times")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              min  mean"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" median   max\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connect")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("557")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3541.6")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63127")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Processing")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2010")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.8")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2003")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2615")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Waiting")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1986")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2008")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.9")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2002")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2615")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Total")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2567")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3543.9")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2004")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65293")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("å¯ä»¥å‘ç°å³ä¾¿åœ¨ 20000 å¹¶å‘ä¸‹, è¯¥ç¨‹åºä¾ç„¶èƒ½å¤Ÿè‰¯å¥½è¿è¡Œ. åŒç­‰æ¡ä»¶ä¸‹, Thread å®ç°çš„ echo ç¨‹åº 512 å¹¶å‘éƒ½æŠ—ä¸è¿‡å», ç›´æ¥å°± OOM äº†.")]),s._v(" "),t("p",[s._v("å¦‚æœé€šè¿‡ Linux å‘½ä»¤ "),t("code",[s._v("top -Hp pid")]),s._v("â€‹ æŸ¥çœ‹ Fiber å®ç°çš„ echo ç¨‹åºçš„è¿›ç¨‹ä¿¡æ¯, å¯ä»¥çœ‹åˆ°è¯¥è¿›ç¨‹"),t("strong",[s._v("ä»…ä»…åˆ›å»ºäº† 16(ä¸åŒ CPU æ ¸æ•°ç»“æœä¼šä¸åŒ)ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ca0e7ae68c8bd73ac0f7d2e48645688e-20230731162452-shjq6f1.png",alt:""}})]),s._v(" "),t("p",[s._v("å¦‚æœä½ å¯¹ Loom é¡¹ç›®æ„Ÿå…´è¶£, å¯ä»¥ä¸‹è½½æºä»£ç è‡ªå·±æ„å»º, æ„å»ºæ–¹æ³•å¯ä»¥å‚ è€ƒ"),t("a",{attrs:{href:"https://wiki.openjdk.java.net/display/loom/Main",target:"_blank",rel:"noopener noreferrer"}},[s._v("Project Loom çš„ç›¸å…³èµ„æ–™"),t("OutboundLink")],1),s._v(", ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯æ„å»ºä¹‹å‰ä¸€å®šè¦æŠŠä»£ç åˆ†æ”¯åˆ‡æ¢åˆ° Fibers.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-25"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-25"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("å¹¶å‘ç¼–ç¨‹é¢†åŸŸçš„åˆ†å·¥é—®é¢˜, æŒ‡çš„æ˜¯"),t("strong",[s._v("å¦‚ä½•é«˜æ•ˆåœ°æ‹†è§£ä»»åŠ¡å¹¶åˆ†é…ç»™çº¿ç¨‹")]),s._v(". å‰é¢åœ¨å¹¶å‘å·¥å…·ç±»æ¨¡å—ä¸­å·²ç»ä»‹ç»äº†ä¸å°‘è§£å†³åˆ†å·¥é—®é¢˜çš„å·¥å…·ç±», ä¾‹å¦‚ Future, CompletableFuture, CompletionService, Fork/Join è®¡ç®—æ¡†æ¶ç­‰, è¿™äº›å·¥å…·ç±»éƒ½èƒ½å¾ˆå¥½åœ°è§£å†³ç‰¹å®šåº”ç”¨åœºæ™¯çš„é—®é¢˜, æ‰€ä»¥è¿™äº›å·¥å…·ç±»æ›¾ç»æ˜¯ Java è¯­è¨€å¼•ä»¥ä¸ºå‚²çš„. ä¸è¿‡è¿™äº›å·¥å…·ç±»éƒ½ç»§æ‰¿äº† Java è¯­è¨€çš„è€æ¯›ç—…: å¤ªå¤æ‚.")]),s._v(" "),t("p",[s._v("å¦‚æœä½ ä¸€ç›´ä»äº‹ Java å¼€å‘, ä¼°è®¡ä½ å·²ç»ä¹ ä»¥ä¸ºå¸¸äº†, ä¹ æƒ¯æ€§åœ°è®¤ä¸ºè¿™ä¸ªå¤æ‚åº¦æ˜¯æ­£å¸¸çš„. ä¸è¿‡è¿™ä¸ªä¸–ç•Œæ—¶åˆ»éƒ½åœ¨å˜åŒ–, "),t("strong",[s._v("æ›¾ç»æ­£å¸¸çš„å¤æ‚åº¦, ç°åœ¨çœ‹æ¥ä¹Ÿè®¸å°±å·²ç»æ²¡æœ‰å¿…è¦äº†")]),s._v(", ä¾‹å¦‚ Thread-Per-Message æ¨¡å¼å¦‚æœä½¿ç”¨çº¿ç¨‹æ± æ–¹æ¡ˆå°±ä¼šå¢åŠ å¤æ‚åº¦.")]),s._v(" "),t("p",[t("strong",[s._v("Thread-Per-Message æ¨¡å¼åœ¨ Java é¢†åŸŸå¹¶ä¸æ˜¯é‚£ä¹ˆçŸ¥å, æ ¹æœ¬åŸå› åœ¨äº Java è¯­è¨€é‡Œçš„çº¿ç¨‹æ˜¯ä¸€ä¸ªé‡é‡çº§çš„å¯¹è±¡, ä¸ºæ¯ä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æˆæœ¬å¤ªé«˜, å°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘é¢†åŸŸ, åŸºæœ¬å°±ä¸å…·å¤‡å¯è¡Œæ€§")]),s._v(". ä¸è¿‡è¿™ä¸ªèƒŒæ™¯æ¡ä»¶ç›®å‰æ­£åœ¨å‘ç”Ÿå·¨å˜, Java è¯­è¨€æœªæ¥ä¸€å®šä¼šæä¾›è½»é‡çº§çº¿ç¨‹, è¿™æ ·åŸºäºè½»é‡çº§çº¿ç¨‹å®ç° Thread-Per-Message æ¨¡å¼å°±æ˜¯ä¸€ä¸ªéå¸¸é è°±çš„é€‰æ‹©.")]),s._v(" "),t("p",[s._v("å½“ç„¶, å¯¹äºä¸€äº›å¹¶å‘åº¦æ²¡é‚£ä¹ˆé«˜çš„å¼‚æ­¥åœºæ™¯, ä¾‹å¦‚å®šæ—¶ä»»åŠ¡, é‡‡ç”¨ Thread-Per-Message æ¨¡å¼æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„. å®é™…å·¥ä½œä¸­, æˆ‘å°±è§è¿‡å®Œå…¨åŸºäº Thread-Per-Message æ¨¡å¼å®ç°çš„åˆ†å¸ƒå¼è°ƒåº¦æ¡†æ¶, è¿™ä¸ªæ¡†æ¶ä¸ºæ¯ä¸ªå®šæ—¶ä»»åŠ¡éƒ½åˆ†é…äº†ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹.")]),s._v(" "),t("h4",{attrs:{id:"_34-worker-threadæ¨¡å¼-å¦‚ä½•é¿å…é‡å¤åˆ›å»ºçº¿ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_34-worker-threadæ¨¡å¼-å¦‚ä½•é¿å…é‡å¤åˆ›å»ºçº¿ç¨‹"}},[s._v("#")]),s._v(" 34-Worker Threadæ¨¡å¼:å¦‚ä½•é¿å…é‡å¤åˆ›å»ºçº¿ç¨‹?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€èŠ‚ä»‹ç»äº†ä¸€ç§æœ€ç®€å•çš„åˆ†å·¥æ¨¡å¼--Thread-Per-Message æ¨¡å¼, å¯¹åº”åˆ°ç°å®ä¸–ç•Œ, å…¶å®å°±æ˜¯"),t("strong",[s._v("å§”æ‰˜ä»£")]),s._v("åŠ. è¿™ç§åˆ†å·¥æ¨¡å¼å¦‚æœç”¨ Java Thread å®ç°, é¢‘ç¹åœ°åˆ›å»º, é”€æ¯çº¿ç¨‹éå¸¸å½±å“æ€§èƒ½, åŒæ—¶æ— é™åˆ¶åœ°åˆ›å»ºçº¿ç¨‹è¿˜å¯èƒ½å¯¼è‡´ OOM, æ‰€ä»¥åœ¨ Java é¢†åŸŸä½¿ç”¨åœºæ™¯å°±å—é™äº†.")]),s._v(" "),t("p",[t("strong",[s._v("è¦æƒ³æœ‰æ•ˆé¿å…çº¿ç¨‹çš„é¢‘ç¹åˆ›å»º, é”€æ¯ä»¥åŠ OOM é—®é¢˜, å°±ä¸å¾—ä¸æä»Šå¤©è¦ç»†èŠçš„, ä¹Ÿæ˜¯ Java é¢†åŸŸä½¿ç”¨æœ€å¤šçš„ Worker Thread æ¨¡å¼")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"worker-threadæ¨¡å¼åŠå…¶å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#worker-threadæ¨¡å¼åŠå…¶å®ç°"}},[s._v("#")]),s._v(" Worker Threadæ¨¡å¼åŠå…¶å®ç°")]),s._v(" "),t("p",[s._v("Worker Thread æ¨¡å¼å¯ä»¥ç±»æ¯”ç°å®ä¸–ç•Œé‡Œ"),t("strong",[s._v("è½¦é—´çš„å·¥ä½œæ¨¡å¼")]),s._v(": è½¦é—´é‡Œçš„å·¥äºº, æœ‰æ´»å„¿äº†, å¤§å®¶ä¸€èµ·å¹², æ²¡æ´»å„¿äº†å°±èŠèŠå¤©ç­‰ç€. å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºæ„å›¾, Worker Thread æ¨¡å¼ä¸­ "),t("strong",[s._v("Worker Thread å¯¹åº”åˆ°ç°å®ä¸–ç•Œé‡Œ, å…¶å®æŒ‡çš„å°±æ˜¯è½¦é—´é‡Œçš„å·¥äºº")]),s._v(". ä¸è¿‡è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, è½¦é—´é‡Œçš„å·¥äººæ•°é‡å¾€å¾€æ˜¯ç¡®å®šçš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/76a0c1ac82a6ea20a6a17e1e3df57ab4-20230731162452-zvji9l4.png",alt:"",title:"è½¦é—´å·¥ä½œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("é‚£åœ¨ç¼–ç¨‹é¢†åŸŸè¯¥å¦‚ä½•æ¨¡æ‹Ÿè½¦é—´çš„è¿™ç§å·¥ä½œæ¨¡å¼å‘¢? æˆ–è€…è¯´å¦‚ä½•å»å®ç° Worker Thread æ¨¡å¼å‘¢? é€šè¿‡ä¸Šé¢çš„å›¾, å¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ°ç”¨é˜»å¡é˜Ÿåˆ—åšä»»åŠ¡æ± , ç„¶ååˆ›å»ºå›ºå®šæ•°é‡çš„çº¿ç¨‹æ¶ˆè´¹é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡. å…¶å®ä½ ä»”ç»†æƒ³ä¼šå‘ç°, è¿™ä¸ªæ–¹æ¡ˆå°±æ˜¯ Java è¯­è¨€æä¾›"),t("strong",[s._v("çš„çº¿ç¨‹æ± ")]),s._v(".")]),s._v(" "),t("p",[s._v("çº¿ç¨‹æ± æœ‰å¾ˆå¤šä¼˜ç‚¹, ä¾‹å¦‚èƒ½å¤Ÿé¿å…é‡å¤åˆ›å»º, é”€æ¯çº¿ç¨‹, åŒæ—¶èƒ½å¤Ÿé™åˆ¶åˆ›å»ºçº¿ç¨‹çš„ä¸Šé™ç­‰ç­‰. ä¸Šä¸€èŠ‚ç”¨ Java çš„ Thread å®ç° Thread-Per-Message æ¨¡å¼éš¾ä»¥åº”å¯¹é«˜å¹¶å‘åœºæ™¯, åŸå› å°±åœ¨äºé¢‘ç¹åˆ›å»º, é”€æ¯ Java çº¿ç¨‹çš„æˆæœ¬æœ‰ç‚¹é«˜, è€Œä¸”æ— é™åˆ¶åœ°åˆ›å»ºçº¿ç¨‹è¿˜å¯èƒ½å¯¼è‡´åº”ç”¨ OOM. çº¿ç¨‹æ± , åˆ™æ°å¥½èƒ½è§£å†³è¿™äº›é—®é¢˜.")]),s._v(" "),t("p",[s._v("è¿˜æ˜¯ä»¥ echo ç¨‹åºä¸ºä¾‹, çœ‹çœ‹å¦‚ä½•ç”¨çº¿ç¨‹æ± æ¥å®ç°.")]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯ç”¨çº¿ç¨‹æ± å®ç°çš„ echo æœåŠ¡ç«¯, ç›¸æ¯”äº Thread-Per-Message æ¨¡å¼çš„å®ç°, æ”¹åŠ¨éå¸¸å°‘, ä»…ä»…æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæœ€å¤šçº¿ç¨‹æ•°ä¸º 500 çš„çº¿ç¨‹æ±  es, ç„¶åé€šè¿‡ es.execute() æ–¹æ³•å°†è¯·æ±‚å¤„ç†çš„ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± å¤„ç†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),s._v(" ssc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetSocketAddress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†è¯·æ±‚  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¥æ”¶è¯·æ±‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketChannel")]),s._v(" sc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ssc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†è¯·æ±‚å¤„ç†ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ")]),s._v("\n        es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯» Socket")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" rb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("allocateDirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™ Socket")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" wb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" rb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("flip")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­ Socket")]),s._v("\n                sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UncheckedIOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ssc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("h5",{attrs:{id:"æ­£ç¡®åœ°åˆ›å»ºçº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ­£ç¡®åœ°åˆ›å»ºçº¿ç¨‹æ± "}},[s._v("#")]),s._v(" æ­£ç¡®åœ°åˆ›å»ºçº¿ç¨‹æ± ")]),s._v(" "),t("p",[s._v("Java çš„çº¿ç¨‹æ± æ—¢èƒ½å¤Ÿé¿å…æ— é™åˆ¶åœ°"),t("strong",[s._v("åˆ›å»ºçº¿ç¨‹")]),s._v("å¯¼è‡´ OOM, ä¹Ÿèƒ½é¿å…æ— é™åˆ¶åœ°"),t("strong",[s._v("æ¥æ”¶ä»»åŠ¡")]),s._v("å¯¼è‡´ OOM. åªä¸è¿‡åè€…ç»å¸¸å®¹æ˜“è¢«å¿½ç•¥, ä¾‹å¦‚åœ¨ä¸Šé¢çš„å®ç°ä¸­, å°±è¢«å¿½ç•¥äº†. æ‰€ä»¥å¼ºçƒˆå»ºè®®"),t("strong",[s._v("ç”¨åˆ›å»ºæœ‰ç•Œçš„é˜Ÿåˆ—æ¥æ¥æ”¶ä»»åŠ¡")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“è¯·æ±‚é‡å¤§äºæœ‰ç•Œé˜Ÿåˆ—çš„å®¹é‡æ—¶, å°±éœ€è¦åˆç†åœ°æ‹’ç»è¯·æ±‚. å¦‚ä½•åˆç†åœ°æ‹’ç»å‘¢? è¿™éœ€è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ¥åˆ¶å®š, å³ä¾¿çº¿ç¨‹æ± é»˜è®¤çš„æ‹’ç»ç­–ç•¥èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚, ä¹ŸåŒæ ·å»ºè®®"),t("strong",[s._v("åœ¨åˆ›å»ºçº¿ç¨‹æ± æ—¶, æ¸…æ™°åœ°æŒ‡æ˜æ‹’ç»ç­–ç•¥")]),s._v(".")]),s._v(" "),t("p",[s._v("åŒæ—¶, ä¸ºäº†ä¾¿äºè°ƒè¯•å’Œè¯Šæ–­é—®é¢˜, å¼ºçƒˆå»ºè®®"),t("strong",[s._v("åœ¨å®é™…å·¥ä½œä¸­ç»™çº¿ç¨‹èµ‹äºˆä¸€ä¸ªä¸šåŠ¡ç›¸å…³çš„åå­—")]),s._v(".")]),s._v(" "),t("p",[s._v("ç»¼åˆä»¥ä¸Šè¿™ä¸‰ç‚¹å»ºè®®, echo ç¨‹åºä¸­åˆ›å»ºçº¿ç¨‹å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ³¨æ„è¦åˆ›å»ºæœ‰ç•Œé˜Ÿåˆ—")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å»ºè®®æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®ç° ThreadFactory")]),s._v("\n        r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo-"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hashCode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å»ºè®®æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®ç° RejectedExecutionHandler")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CallerRunsPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h5",{attrs:{id:"é¿å…çº¿ç¨‹æ­»é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é¿å…çº¿ç¨‹æ­»é”"}},[s._v("#")]),s._v(" é¿å…çº¿ç¨‹æ­»é”")]),s._v(" "),t("p",[s._v("ä½¿ç”¨çº¿ç¨‹æ± è¿‡ç¨‹ä¸­, è¿˜è¦æ³¨æ„ä¸€ç§"),t("strong",[s._v("çº¿ç¨‹æ­»é”")]),s._v("çš„åœºæ™¯. å¦‚æœæäº¤åˆ°ç›¸åŒçº¿ç¨‹æ± çš„ä»»åŠ¡"),t("strong",[s._v("ä¸æ˜¯ç›¸äº’ç‹¬ç«‹")]),s._v("çš„, è€Œæ˜¯æœ‰ä¾èµ–å…³ç³»çš„, é‚£ä¹ˆå°±æœ‰å¯èƒ½å¯¼è‡´çº¿ç¨‹æ­»é”. å®é™…å·¥ä½œä¸­, æˆ‘å°±äº²å†è¿‡è¿™ç§çº¿ç¨‹æ­»é”çš„åœºæ™¯. å…·ä½“ç°è±¡æ˜¯"),t("strong",[s._v("åº”ç”¨æ¯è¿è¡Œä¸€æ®µæ—¶é—´å¶å°”å°±ä¼šå¤„äºæ— å“åº”çš„çŠ¶æ€, ç›‘æ§æ•°æ®çœ‹ä¸Šå»ä¸€åˆ‡éƒ½æ­£å¸¸, ä½†æ˜¯å®é™…ä¸Šå·²ç»ä¸èƒ½æ­£å¸¸å·¥ä½œäº†")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªå‡ºé—®é¢˜çš„åº”ç”¨, ç›¸å…³çš„é€»è¾‘ç²¾ç®€ä¹‹å, å¦‚ä¸‹å›¾æ‰€ç¤º, è¯¥åº”ç”¨å°†ä¸€ä¸ªå¤§å‹çš„è®¡ç®—ä»»åŠ¡åˆ†æˆä¸¤ä¸ªé˜¶æ®µ, ç¬¬ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡ä¼šç­‰å¾…ç¬¬äºŒé˜¶æ®µçš„å­ä»»åŠ¡å®Œæˆ. åœ¨è¿™ä¸ªåº”ç”¨é‡Œ, æ¯ä¸€ä¸ªé˜¶æ®µéƒ½ä½¿ç”¨äº†çº¿ç¨‹æ± , è€Œä¸”ä¸¤ä¸ªé˜¶æ®µä½¿ç”¨çš„è¿˜æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ± .")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/50b6956dde6fd5ecbba1fb650adb504b-20230731162452-e98vrzk.png",alt:"",title:"åº”ç”¨ä¸šåŠ¡é€»è¾‘ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å¯ä»¥ç”¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ¥æ¨¡æ‹Ÿè¯¥åº”ç”¨, å¦‚æœæ‰§è¡Œä¸‹é¢çš„è¿™æ®µä»£ç , ä¼šå‘ç°å®ƒæ°¸è¿œæ‰§è¡Œä¸åˆ°æœ€åä¸€è¡Œ. æ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰ä»»ä½•å¼‚å¸¸, ä½†æ˜¯åº”ç”¨å·²ç»åœæ­¢å“åº”äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//L1, L2 é˜¶æ®µå…±ç”¨çš„çº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//L1 é˜¶æ®µçš„é—­é”    ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CountDownLatch")]),s._v(" l1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CountDownLatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œ L1 é˜¶æ®µä»»åŠ¡")]),s._v("\n    es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//L2 é˜¶æ®µçš„é—­é” ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CountDownLatch")]),s._v(" l2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CountDownLatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œ L2 é˜¶æ®µå­ä»»åŠ¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" j "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" j "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" j"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                l2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("countDown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾… L2 é˜¶æ®µä»»åŠ¡æ‰§è¡Œå®Œ")]),s._v("\n        l2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        l1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("countDown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰ç€ L1 é˜¶æ®µä»»åŠ¡æ‰§è¡Œå®Œ")]),s._v("\nl1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"end"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("å½“åº”ç”¨å‡ºç°ç±»ä¼¼é—®é¢˜æ—¶, é¦–é€‰çš„è¯Šæ–­æ–¹æ³•æ˜¯æŸ¥çœ‹çº¿ç¨‹æ ˆ. ä¸‹å›¾æ˜¯ä¸Šé¢ç¤ºä¾‹ä»£ç åœæ­¢å“åº”åçš„çº¿ç¨‹æ ˆ, ä½ ä¼šå‘ç°çº¿ç¨‹æ± ä¸­çš„ä¸¤ä¸ªçº¿ç¨‹å…¨éƒ¨éƒ½é˜»å¡åœ¨ "),t("code",[s._v("l2.await();")]),s._v(" è¿™è¡Œä»£ç ä¸Šäº†, ä¹Ÿå°±æ˜¯è¯´, çº¿ç¨‹æ± é‡Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾… L2 é˜¶æ®µçš„ä»»åŠ¡æ‰§è¡Œå®Œ, é‚£ L2 é˜¶æ®µçš„å­ä»»åŠ¡ä»€ä¹ˆæ—¶å€™èƒ½å¤Ÿæ‰§è¡Œå®Œå‘¢? æ°¸è¿œéƒ½æ²¡é‚£ä¸€å¤©äº†, ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹éƒ½é˜»å¡äº†, æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œ L2 é˜¶æ®µçš„ä»»åŠ¡äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0e30a3d840da72fac3301a96069679f5-20230731162452-su2l37r.png",alt:""}})]),s._v(" "),t("p",[s._v("åŸå› æ‰¾åˆ°äº†, é‚£å¦‚ä½•è§£å†³å°±ç®€å•äº†, æœ€ç®€å•ç²—æš´çš„åŠæ³•å°±æ˜¯å°†çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°è°ƒå¤§, å¦‚æœèƒ½å¤Ÿç¡®å®šä»»åŠ¡çš„æ•°é‡ä¸æ˜¯éå¸¸å¤šçš„è¯, è¿™ä¸ªåŠæ³•ä¹Ÿæ˜¯å¯è¡Œçš„, å¦åˆ™è¿™ä¸ªåŠæ³•å°±è¡Œä¸é€šäº†. å…¶å®"),t("strong",[s._v("è¿™ç§é—®é¢˜é€šç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºä¸åŒçš„ä»»åŠ¡åˆ›å»ºä¸åŒçš„çº¿ç¨‹æ± ")]),s._v(". å¯¹äºä¸Šé¢çš„è¿™ä¸ªåº”ç”¨, L1 é˜¶æ®µçš„ä»»åŠ¡å’Œ L2 é˜¶æ®µçš„ä»»åŠ¡å¦‚æœå„è‡ªéƒ½æœ‰è‡ªå·±çš„çº¿ç¨‹æ± , å°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†.")]),s._v(" "),t("p",[s._v("æœ€åå†æ¬¡å¼ºè°ƒä¸€ä¸‹: "),t("mark",[t("strong",[s._v("æäº¤åˆ°ç›¸åŒçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡ä¸€å®šæ˜¯ç›¸äº’ç‹¬ç«‹çš„, å¦åˆ™å°±ä¸€å®šè¦æ…é‡")])]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-26"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-26"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("è§£å†³å¹¶å‘ç¼–ç¨‹é‡Œçš„åˆ†å·¥é—®é¢˜, æœ€å¥½çš„åŠæ³•æ˜¯å’Œç°å®ä¸–ç•Œåšå¯¹æ¯”. å¯¹æ¯”ç°å®ä¸–ç•Œæ„å»ºç¼–ç¨‹é¢†åŸŸçš„æ¨¡å‹, èƒ½å¤Ÿè®©æ¨¡å‹æ›´å®¹æ˜“ç†è§£. ä¸Šä¸€ç¯‡ä»‹ç»çš„ Thread-Per-Message æ¨¡å¼, ç±»ä¼¼äºç°å®ä¸–ç•Œé‡Œçš„å§”æ‰˜ä»–äººåŠç†, è€Œä»Šå¤©ä»‹ç»çš„ "),t("strong",[s._v("Worker Thread æ¨¡å¼åˆ™ç±»ä¼¼äºè½¦é—´é‡Œå·¥äººçš„å·¥ä½œæ¨¡å¼")]),s._v(". å¦‚æœä½ åœ¨è®¾è®¡é˜¶æ®µ, å‘ç°å¯¹ä¸šåŠ¡æ¨¡å‹å»ºæ¨¡ä¹‹å, æ¨¡å‹éå¸¸ç±»ä¼¼äºè½¦é—´çš„å·¥ä½œæ¨¡å¼, é‚£åŸºæœ¬ä¸Šå°±èƒ½ç¡®å®šå¯ä»¥åœ¨å®ç°é˜¶æ®µé‡‡ç”¨ Worker Thread æ¨¡å¼æ¥å®ç°.")]),s._v(" "),t("p",[s._v("Worker Thread æ¨¡å¼å’Œ Thread-Per-Message æ¨¡å¼çš„åŒºåˆ«æœ‰å“ªäº›å‘¢? ä»ç°å®ä¸–ç•Œçš„è§’åº¦çœ‹, å§”æ‰˜ä»£åŠäººåšäº‹, å¾€å¾€æ˜¯å’Œä»£åŠäººç›´æ¥æ²Ÿé€šçš„; å¯¹åº”åˆ°ç¼–ç¨‹é¢†åŸŸ, å…¶å®ç°ä¹Ÿæ˜¯ä¸»çº¿ç¨‹ç›´æ¥åˆ›å»ºäº†ä¸€ä¸ªå­çº¿ç¨‹, ä¸»å­çº¿ç¨‹ä¹‹é—´æ˜¯å¯ä»¥ç›´æ¥é€šä¿¡çš„. è€Œè½¦é—´å·¥äººçš„å·¥ä½œæ–¹å¼åˆ™æ˜¯å®Œå…¨å›´ç»•ä»»åŠ¡å±•å¼€çš„, ä¸€ä¸ªå…·ä½“çš„ä»»åŠ¡è¢«å“ªä¸ªå·¥äººæ‰§è¡Œ, é¢„å…ˆæ˜¯æ— æ³•çŸ¥é“çš„; å¯¹åº”åˆ°ç¼–ç¨‹é¢†åŸŸ, åˆ™æ˜¯"),t("strong",[s._v("ä¸»çº¿ç¨‹æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± , ä½†ä¸»çº¿ç¨‹å¹¶ä¸å…³å¿ƒä»»åŠ¡è¢«å“ªä¸ªçº¿ç¨‹æ‰§è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("Worker Thread æ¨¡å¼èƒ½é¿å…çº¿ç¨‹é¢‘ç¹åˆ›å»º, é”€æ¯çš„é—®é¢˜, è€Œä¸”èƒ½å¤Ÿé™åˆ¶çº¿ç¨‹çš„æœ€å¤§æ•°é‡. Java è¯­è¨€é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨çº¿ç¨‹æ± æ¥å®ç° Worker Thread æ¨¡å¼, çº¿ç¨‹æ± æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€å’Œä¼˜ç§€çš„å·¥å…·ç±», ç”šè‡³æœ‰äº›å¤§å‚çš„ç¼–ç è§„èŒƒéƒ½ä¸å…è®¸ç”¨ new Thread() æ¥åˆ›å»ºçº¿ç¨‹çš„, å¿…é¡»ä½¿ç”¨çº¿ç¨‹æ± .")]),s._v(" "),t("h4",{attrs:{id:"_35-ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼-å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_35-ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼-å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹"}},[s._v("#")]),s._v(" 35-ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼:å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹?")]),s._v(" "),t("p",[s._v("å‰é¢ä¸¤èŠ‚è®²è¿°çš„å†…å®¹, ä»çº¯æŠ€æœ¯çš„è§’åº¦çœ‹, éƒ½æ˜¯"),t("strong",[s._v("å¯åŠ¨")]),s._v("å¤šçº¿ç¨‹å»æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡. æ—¢å¯åŠ¨, é‚£åˆè¯¥å¦‚ä½•ç»ˆæ­¢å‘¢? ä»Šå¤©å°±ä»æŠ€æœ¯çš„è§’åº¦èŠèŠå¦‚ä½•ä¼˜é›…åœ°"),t("strong",[s._v("ç»ˆæ­¢")]),s._v("çº¿ç¨‹, æ­£æ‰€è°“æœ‰å§‹æœ‰ç»ˆ.")]),s._v(" "),t("p",[s._v("å‰é¢è®²è¿‡: "),t("strong",[s._v("çº¿ç¨‹æ‰§è¡Œå®Œæˆ–è€…å‡ºç°å¼‚å¸¸å°±ä¼šè¿›å…¥ç»ˆæ­¢çŠ¶æ€")]),s._v('. è¿™æ ·çœ‹, ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹çœ‹ä¸Šå»å¾ˆç®€å•å•Š! ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œè‡ªå·±çš„ä»»åŠ¡, è‡ªå·±è¿›å…¥ç»ˆæ­¢çŠ¶æ€, è¿™çš„ç¡®å¾ˆç®€å•. ä¸è¿‡ä»Šå¤©è°ˆåˆ°çš„ "ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹", ä¸æ˜¯è‡ªå·±ç»ˆæ­¢è‡ªå·±, è€Œæ˜¯'),t("strong",[s._v("åœ¨ä¸€ä¸ªçº¿ç¨‹ T1 ä¸­, ç»ˆæ­¢çº¿ç¨‹ T2")]),s._v('; è¿™é‡Œæ‰€è°“çš„ "ä¼˜é›…", æŒ‡çš„æ˜¯ç»™ T2 ä¸€ä¸ªæœºä¼šæ–™ç†åäº‹, è€Œä¸æ˜¯è¢«ä¸€å‰‘å°å–‰.')]),s._v(" "),t("p",[s._v("Java è¯­è¨€çš„ Thread ç±»ä¸­æ›¾ç»æä¾›äº†ä¸€ä¸ª stop() æ–¹æ³•, ç”¨æ¥ç»ˆæ­¢çº¿ç¨‹, å¯æ˜¯æ—©å·²ä¸å»ºè®®ä½¿ç”¨äº†, åŸå› æ˜¯è¿™ä¸ªæ–¹æ³•ç”¨çš„å°±æ˜¯ä¸€å‰‘å°å–‰çš„åšæ³•, è¢«ç»ˆæ­¢çš„çº¿ç¨‹æ²¡æœ‰æœºä¼šæ–™ç†åäº‹.")]),s._v(" "),t("p",[s._v("æ—¢ç„¶ä¸å»ºè®®ä½¿ç”¨ stop() æ–¹æ³•, é‚£åœ¨ Java åˆè¯¥å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"å¦‚ä½•ç†è§£ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ç†è§£ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"}},[s._v("#")]),s._v(" å¦‚ä½•ç†è§£ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼")]),s._v(" "),t("p",[s._v("å‰è¾ˆä»¬ç»è¿‡è®¤çœŸå¯¹æ¯”åˆ†æ, å·²ç»æ€»ç»“å‡ºäº†ä¸€å¥—æˆç†Ÿçš„æ–¹æ¡ˆ, å«åš"),t("strong",[s._v("ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼")]),s._v(". é¡¾åæ€ä¹‰, å°±æ˜¯å°†ç»ˆæ­¢è¿‡ç¨‹åˆ†æˆä¸¤ä¸ªé˜¶æ®µ, å…¶ä¸­"),t("strong",[s._v("ç¬¬ä¸€ä¸ªé˜¶æ®µä¸»è¦æ˜¯çº¿ç¨‹ T1 å‘çº¿ç¨‹ T2 å‘é€ç»ˆæ­¢æŒ‡ä»¤, è€Œç¬¬äºŒé˜¶æ®µåˆ™æ˜¯çº¿ç¨‹ T2 å“åº”ç»ˆæ­¢æŒ‡ä»¤")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e1f684fd4f8dfba9a0df3c73ead0260b-20230731162452-2e47eyl.png",alt:"",title:"ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("é‚£åœ¨ Java é‡Œ, ç»ˆæ­¢æŒ‡ä»¤æ˜¯ä»€ä¹ˆå‘¢? è¿™ä¸ªè¦ä» Java çº¿ç¨‹çš„çŠ¶æ€è½¬æ¢è¿‡ç¨‹è¯´èµ·. å‰é¢æåˆ°è¿‡ Java çº¿ç¨‹çš„çŠ¶æ€è½¬æ¢å›¾, å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/14d5ebdae35bc89ddc07820d3b187cd7-20230731162452-19bhbc1.png",alt:"",title:"Java ä¸­çš„çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾"}})]),s._v(" "),t("p",[s._v("ä»è¿™ä¸ªå›¾é‡Œä¼šå‘ç°, Java çº¿ç¨‹"),t("strong",[s._v("è¿›å…¥ç»ˆæ­¢çŠ¶æ€çš„å‰ææ˜¯çº¿ç¨‹è¿›å…¥ RUNNABLE çŠ¶æ€")]),s._v(", è€Œå®é™…ä¸Šçº¿ç¨‹ä¹Ÿå¯èƒ½å¤„åœ¨ä¼‘çœ çŠ¶æ€, ä¹Ÿå°±æ˜¯è¯´, è¦æƒ³ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹, "),t("strong",[s._v("é¦–å…ˆè¦æŠŠçº¿ç¨‹çš„çŠ¶æ€ä»ä¼‘çœ çŠ¶æ€è½¬æ¢åˆ° RUNNABLE çŠ¶")]),s._v("æ€. å¦‚ä½•åšåˆ°å‘¢? è¿™ä¸ªè¦é  Java Thread ç±»æä¾›çš„ "),t("strong",[s._v("interrupt() æ–¹æ³•")]),s._v(", å®ƒå¯ä»¥"),t("strong",[s._v("å°†ä¼‘çœ çŠ¶æ€çš„çº¿ç¨‹è½¬æ¢åˆ° RUNNABLE çŠ¶æ€")]),s._v(".")]),s._v(" "),t("p",[s._v("çº¿ç¨‹è½¬æ¢åˆ° RUNNABLE çŠ¶æ€ä¹‹å, å¦‚ä½•å†å°†å…¶ç»ˆæ­¢å‘¢? RUNNABLE çŠ¶æ€è½¬æ¢åˆ°ç»ˆæ­¢çŠ¶æ€, ä¼˜é›…çš„æ–¹å¼æ˜¯è®© Java çº¿ç¨‹è‡ªå·±æ‰§è¡Œå®Œ run() æ–¹æ³•, æ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨çš„æ–¹æ³•æ˜¯"),t("strong",[s._v("è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½")]),s._v(", ç„¶åçº¿ç¨‹ä¼šåœ¨åˆé€‚çš„æ—¶æœºæ£€æŸ¥è¿™ä¸ªæ ‡å¿—ä½, å¦‚æœå‘ç°ç¬¦åˆç»ˆæ­¢æ¡ä»¶, åˆ™è‡ªåŠ¨é€€å‡º run() æ–¹æ³•. è¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯å‰é¢æåˆ°çš„ç¬¬äºŒé˜¶æ®µ: "),t("strong",[s._v("å“åº”ç»ˆæ­¢æŒ‡ä»¤")]),s._v(".")]),s._v(" "),t("p",[s._v("ç»¼åˆä¸Šé¢è¿™ä¸¤ç‚¹, èƒ½æ€»ç»“å‡ºç»ˆæ­¢æŒ‡ä»¤, å…¶å®åŒ…æ‹¬ä¸¤æ–¹é¢å†…å®¹: "),t("strong",[s._v("interrupt() æ–¹æ³•")]),s._v("å’Œ"),t("strong",[s._v("çº¿ç¨‹ç»ˆæ­¢çš„æ ‡å¿—ä½")]),s._v(".")]),s._v(" "),t("p",[s._v("ç†è§£äº†ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ä¹‹å, ä¸‹é¢çœ‹ä¸€ä¸ªå®é™…å·¥ä½œä¸­çš„æ¡ˆä¾‹.")]),s._v(" "),t("h5",{attrs:{id:"ç”¨ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ç»ˆæ­¢ç›‘æ§æ“ä½œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ç»ˆæ­¢ç›‘æ§æ“ä½œ"}},[s._v("#")]),s._v(" ç”¨ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ç»ˆæ­¢ç›‘æ§æ“ä½œ")]),s._v(" "),t("p",[s._v("å®é™…å·¥ä½œä¸­, æœ‰äº›ç›‘æ§ç³»ç»Ÿéœ€è¦"),t("strong",[s._v("åŠ¨æ€åœ°é‡‡é›†ä¸€äº›æ•°æ®")]),s._v(", ä¸€èˆ¬éƒ½æ˜¯ç›‘æ§ç³»ç»Ÿå‘é€é‡‡é›†æŒ‡ä»¤ç»™è¢«ç›‘æ§ç³»ç»Ÿçš„ç›‘æ§ä»£ç†, ç›‘æ§ä»£ç†æ¥æ”¶åˆ°æŒ‡ä»¤ä¹‹å, ä»ç›‘æ§ç›®æ ‡æ”¶é›†æ•°æ®, ç„¶åå›ä¼ ç»™ç›‘æ§ç³»ç»Ÿ, è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º. å‡ºäºå¯¹æ€§èƒ½çš„è€ƒè™‘(æœ‰äº›ç›‘æ§é¡¹å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“å¾ˆå¤§, æ‰€ä»¥ä¸èƒ½ä¸€ç›´æŒç»­ç›‘æ§), åŠ¨æ€é‡‡é›†åŠŸèƒ½ä¸€èˆ¬éƒ½ä¼šæœ‰ç»ˆæ­¢æ“ä½œ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f3479d3b3f76316e94401923f6864375-20230731162452-0gev21b.png",alt:"",title:"åŠ¨æ€é‡‡é›†åŠŸèƒ½ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯"),t("strong",[s._v("ç›‘æ§ä»£ç†")]),s._v("ç®€åŒ–ä¹‹åçš„å®ç°, start() æ–¹æ³•ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ rptThread æ¥æ‰§è¡Œç›‘æ§æ•°æ®é‡‡é›†å’Œå›ä¼ çš„åŠŸèƒ½, stop() æ–¹æ³•éœ€è¦ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ rptThread, é‚£ stop() ç›¸å…³åŠŸèƒ½è¯¥å¦‚ä½•å®ç°å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Proxy")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡‡é›†çº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" rptThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨é‡‡é›†åŠŸèƒ½")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸å…è®¸åŒæ—¶å¯åŠ¨å¤šä¸ªé‡‡é›†çº¿ç¨‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("started"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rptThread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥é‡‡é›†, å›ä¼ å®ç°")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("report")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯éš”ä¸¤ç§’é’Ÿé‡‡é›†, å›ä¼ ä¸€æ¬¡æ•°æ®")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œåˆ°æ­¤å¤„è¯´æ˜çº¿ç¨‹é©¬ä¸Šç»ˆæ­¢")]),s._v("\n            started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rptThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»ˆæ­¢é‡‡é›†åŠŸèƒ½")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚ä½•å®ç°? ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("æŒ‰ç…§ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼, é¦–å…ˆéœ€è¦åšçš„å°±æ˜¯å°†çº¿ç¨‹ rptThread çŠ¶æ€è½¬æ¢åˆ° RUNNABLE, åšæ³•å¾ˆç®€å•, åªéœ€è¦åœ¨è°ƒç”¨ "),t("code",[s._v("rptThread.interrupt()")]),s._v("â€‹ å°±å¯ä»¥äº†. çº¿ç¨‹ rptThread çš„çŠ¶æ€è½¬æ¢åˆ° RUNNABLE ä¹‹å, å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢å‘¢? ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, é€‰æ‹©çš„æ ‡å¿—ä½æ˜¯çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€: "),t("code",[s._v("Thread.currentThread().isInterrupted()")]),s._v("â€‹, éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨æ•è· Thread.sleep() çš„ä¸­æ–­å¼‚å¸¸ä¹‹å, é€šè¿‡ "),t("code",[s._v("Thread.currentThread().interrupt()")]),s._v("â€‹ é‡æ–°è®¾ç½®äº†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€, "),t("strong",[s._v("å› ä¸º JVM çš„å¼‚å¸¸å¤„ç†ä¼šæ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Proxy")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡‡é›†çº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" rptThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨é‡‡é›†åŠŸèƒ½")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸å…è®¸åŒæ—¶å¯åŠ¨å¤šä¸ªé‡‡é›†çº¿ç¨‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("started"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rptThread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isInterrupted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥é‡‡é›†, å›ä¼ å®ç°")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("report")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯éš”ä¸¤ç§’é’Ÿé‡‡é›†, å›ä¼ ä¸€æ¬¡æ•°æ®")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡æ–°è®¾ç½®çº¿ç¨‹ä¸­æ–­çŠ¶æ€")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œåˆ°æ­¤å¤„è¯´æ˜çº¿ç¨‹é©¬ä¸Šç»ˆæ­¢")]),s._v("\n            started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rptThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»ˆæ­¢é‡‡é›†åŠŸèƒ½")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        rptThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ç¤ºä¾‹ä»£ç çš„ç¡®èƒ½å¤Ÿè§£å†³å½“å‰çš„é—®é¢˜, ä½†æ˜¯å»ºè®®åœ¨å®é™…å·¥ä½œä¸­"),t("strong",[s._v("è°¨æ…ä½¿ç”¨")]),s._v(". åŸå› åœ¨äºå¾ˆå¯èƒ½åœ¨çº¿ç¨‹çš„ run() æ–¹æ³•ä¸­è°ƒç”¨ç¬¬ä¸‰æ–¹ç±»åº“æä¾›çš„æ–¹æ³•, è€Œæ²¡æœ‰åŠæ³•ä¿è¯ç¬¬ä¸‰æ–¹ç±»åº“æ­£ç¡®å¤„ç†äº†çº¿ç¨‹çš„ä¸­æ–­å¼‚å¸¸, ä¾‹å¦‚ç¬¬ä¸‰æ–¹ç±»åº“åœ¨æ•è·åˆ° Thread.sleep() æ–¹æ³•æŠ›å‡ºçš„ä¸­æ–­å¼‚å¸¸å, æ²¡æœ‰é‡æ–°è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€, é‚£ä¹ˆå°±ä¼šå¯¼è‡´çº¿ç¨‹ä¸èƒ½å¤Ÿæ­£å¸¸ç»ˆæ­¢. æ‰€ä»¥å¼ºçƒˆå»ºè®®"),t("strong",[s._v("è®¾ç½®è‡ªå·±çš„çº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½")]),s._v(", ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­, ä½¿ç”¨ "),t("strong",[s._v("isTerminated")]),s._v(" ä½œä¸ºçº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½, æ­¤æ—¶æ— è®ºæ˜¯å¦æ­£ç¡®å¤„ç†äº†çº¿ç¨‹çš„ä¸­æ–­å¼‚å¸¸, éƒ½ä¸ä¼šå½±å“çº¿ç¨‹ä¼˜é›…åœ°ç»ˆæ­¢.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Proxy")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" terminated "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡‡é›†çº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" rptThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨é‡‡é›†åŠŸèƒ½")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸å…è®¸åŒæ—¶å¯åŠ¨å¤šä¸ªé‡‡é›†çº¿ç¨‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("started"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        terminated "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rptThread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("terminated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥é‡‡é›†, å›ä¼ å®ç°")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("report")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯éš”ä¸¤ç§’é’Ÿé‡‡é›†, å›ä¼ ä¸€æ¬¡æ•°æ®")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡æ–°è®¾ç½®çº¿ç¨‹ä¸­æ–­çŠ¶æ€")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œåˆ°æ­¤å¤„è¯´æ˜çº¿ç¨‹é©¬ä¸Šç»ˆæ­¢")]),s._v("\n            started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rptThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»ˆæ­¢é‡‡é›†åŠŸèƒ½")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®ä¸­æ–­æ ‡å¿—ä½")]),s._v("\n        terminated "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸­æ–­çº¿ç¨‹ rptThread")]),s._v("\n        rptThread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("h5",{attrs:{id:"å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹æ± "}},[s._v("#")]),s._v(" å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹æ± ")]),s._v(" "),t("p",[s._v("Java é¢†åŸŸç”¨çš„æœ€å¤šçš„è¿˜æ˜¯çº¿ç¨‹æ± , è€Œä¸æ˜¯æ‰‹åŠ¨åœ°åˆ›å»ºçº¿ç¨‹. é‚£è¯¥å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹æ± å‘¢?")]),s._v(" "),t("p",[s._v("çº¿ç¨‹æ± æä¾›äº†ä¸¤ä¸ªæ–¹æ³•: "),t("strong",[s._v("shutdown()")]),s._v(" "),t("strong",[t("strong",[s._v("å’Œ")])]),s._v(" "),t("strong",[s._v("shutdownNow()")]),s._v(" . è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢? è¦äº†è§£å®ƒä»¬çš„åŒºåˆ«, å°±å…ˆéœ€è¦äº†è§£çº¿ç¨‹æ± çš„å®ç°åŸç†.")]),s._v(" "),t("p",[s._v("å‰é¢æ›¾ç»è®²è¿‡, Java çº¿ç¨‹æ± æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¸€ç§å®ç°, æäº¤ç»™çº¿ç¨‹æ± çš„ä»»åŠ¡, é¦–å…ˆæ˜¯è¿›å…¥ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­, ä¹‹åçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ‰§è¡Œ.")]),s._v(" "),t("p",[t("strong",[s._v("shutdown() æ–¹æ³•æ˜¯ä¸€ç§å¾ˆä¿å®ˆçš„å…³é—­çº¿ç¨‹æ± çš„æ–¹æ³•. çº¿ç¨‹æ± æ‰§è¡Œ shutdown() å, å°±ä¼šæ‹’ç»æ¥æ”¶æ–°çš„ä»»åŠ¡, ä½†æ˜¯ä¼šç­‰å¾…çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å’Œå·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œä¹‹åæ‰æœ€ç»ˆå…³é—­çº¿ç¨‹æ± ")]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œ shutdownNow() æ–¹æ³•, ç›¸å¯¹å°±æ¿€è¿›ä¸€äº›äº†, çº¿ç¨‹æ± æ‰§è¡Œ shutdownNow() å, "),t("strong",[s._v("ä¼šæ‹’ç»æ¥æ”¶æ–°çš„ä»»åŠ¡, åŒæ—¶è¿˜ä¼šä¸­æ–­çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡")]),s._v(", å·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡ä¹Ÿè¢«å‰¥å¤ºäº†æ‰§è¡Œçš„æœºä¼š, ä¸è¿‡è¿™äº›è¢«å‰¥å¤ºæ‰§è¡Œæœºä¼šçš„ä»»åŠ¡ä¼šä½œä¸º shutdownNow() æ–¹æ³•çš„è¿”å›å€¼è¿”å›. å› ä¸º shutdownNow() æ–¹æ³•ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹, æ‰€ä»¥æäº¤åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡, å¦‚æœéœ€è¦ä¼˜é›…åœ°ç»“æŸ, å°±éœ€è¦æ­£ç¡®åœ°å¤„ç†çº¿ç¨‹ä¸­æ–­.")]),s._v(" "),t("p",[s._v("å¦‚æœæäº¤åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡ä¸å…è®¸å–æ¶ˆ, é‚£å°±ä¸èƒ½ä½¿ç”¨ shutdownNow() æ–¹æ³•ç»ˆæ­¢çº¿ç¨‹æ± . ä¸è¿‡, å¦‚æœæäº¤åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡å…è®¸åç»­ä»¥è¡¥å¿çš„æ–¹å¼é‡æ–°æ‰§è¡Œ, ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ shutdownNow() æ–¹æ³•ç»ˆæ­¢çº¿ç¨‹æ± çš„.")]),s._v(" "),t("p",[s._v("å…¶å®åˆ†æå®Œ shutdown() å’Œ shutdownNow() æ–¹æ³•ä½ ä¼šå‘ç°, å®ƒä»¬å®è´¨ä¸Šä½¿ç”¨çš„ä¹Ÿæ˜¯"),t("strong",[s._v("ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼")]),s._v(", åªæ˜¯ç»ˆæ­¢æŒ‡ä»¤çš„èŒƒå›´ä¸åŒè€Œå·², å‰è€…åªå½±å“é˜»å¡é˜Ÿåˆ—æ¥æ”¶ä»»åŠ¡, åè€…èŒƒå›´æ‰©å¤§åˆ°çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„ä»»åŠ¡.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-27"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-27"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼æ˜¯ä¸€ç§åº”ç”¨å¾ˆå¹¿æ³›çš„å¹¶å‘è®¾è®¡æ¨¡å¼, åœ¨ Java è¯­è¨€ä¸­ä½¿ç”¨ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼æ¥ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹, éœ€è¦æ³¨æ„ä¸¤ä¸ªå…³é”®ç‚¹: ä¸€ä¸ªæ˜¯ä»…æ£€æŸ¥ç»ˆæ­¢æ ‡å¿—ä½æ˜¯ä¸å¤Ÿçš„, å› ä¸ºçº¿ç¨‹çš„çŠ¶æ€å¯èƒ½å¤„äºä¼‘çœ æ€; å¦ä¸€ä¸ªæ˜¯ä»…æ£€æŸ¥çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¹Ÿæ˜¯ä¸å¤Ÿçš„, å› ä¸ºä¾èµ–çš„ç¬¬ä¸‰æ–¹ç±»åº“å¾ˆå¯èƒ½æ²¡æœ‰æ­£ç¡®å¤„ç†ä¸­æ–­å¼‚å¸¸.")]),s._v(" "),t("p",[s._v("å½“ä½¿ç”¨ Java çš„çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹çš„æ—¶å€™, éœ€è¦ä¾èµ–çº¿ç¨‹æ± æä¾›çš„ shutdown() å’Œ shutdownNow() æ–¹æ³•æ¥ç»ˆæ­¢çº¿ç¨‹æ± . ä¸è¿‡åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„å®ƒä»¬çš„åº”ç”¨åœºæ™¯, å°¤å…¶æ˜¯åœ¨ä½¿ç”¨ shutdownNow() çš„æ—¶å€™, ä¸€å®šè¦è°¨æ….")]),s._v(" "),t("h4",{attrs:{id:"_36-ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼-ç”¨æµæ°´çº¿æ€æƒ³æé«˜æ•ˆç‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_36-ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼-ç”¨æµæ°´çº¿æ€æƒ³æé«˜æ•ˆç‡"}},[s._v("#")]),s._v(" 36-ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼:ç”¨æµæ°´çº¿æ€æƒ³æé«˜æ•ˆç‡")]),s._v(" "),t("p",[s._v("å‰é¢è®²åˆ°, Worker Thread æ¨¡å¼ç±»æ¯”çš„æ˜¯å·¥å‚é‡Œè½¦é—´å·¥äººçš„å·¥ä½œæ¨¡å¼. ä½†å…¶å®åœ¨ç°å®ä¸–ç•Œ, å·¥å‚é‡Œè¿˜æœ‰ä¸€ç§æµæ°´çº¿çš„å·¥ä½œæ¨¡å¼, ç±»æ¯”åˆ°ç¼–ç¨‹é¢†åŸŸ, å°±æ˜¯"),t("strong",[s._v("ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼")]),s._v(".")]),s._v(" "),t("p",[s._v("ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼åœ¨ç¼–ç¨‹é¢†åŸŸçš„åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›, å‰é¢æ›¾ç»æåˆ°, Java çº¿ç¨‹æ± æœ¬è´¨ä¸Šå°±æ˜¯ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å®ç°çš„, æ‰€ä»¥æ¯å½“ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™, å…¶å®å°±æ˜¯åœ¨åº”ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼.")]),s._v(" "),t("p",[s._v("å½“ç„¶, é™¤äº†åœ¨çº¿ç¨‹æ± ä¸­çš„åº”ç”¨, ä¸ºäº†æå‡æ€§èƒ½, å¹¶å‘ç¼–ç¨‹é¢†åŸŸå¾ˆå¤šåœ°æ–¹ä¹Ÿéƒ½ç”¨åˆ°äº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼, ä¾‹å¦‚ Log4j2 ä¸­å¼‚æ­¥ Appender å†…éƒ¨ä¹Ÿç”¨åˆ°äº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼. æ‰€ä»¥ä»Šå¤©å°±æ¥æ·±å…¥åœ°èŠèŠç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼, çœ‹çœ‹å®ƒå…·ä½“æœ‰å“ªäº›ä¼˜ç‚¹, ä»¥åŠå¦‚ä½•æå‡ç³»ç»Ÿçš„æ€§èƒ½.")]),s._v(" "),t("h5",{attrs:{id:"ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¼˜ç‚¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¼˜ç‚¹"}},[s._v("#")]),s._v(" ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¼˜ç‚¹")]),s._v(" "),t("p",[t("strong",[s._v("ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—, ç”Ÿäº§è€…çº¿ç¨‹ç”Ÿäº§ä»»åŠ¡, å¹¶å°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­, è€Œæ¶ˆè´¹è€…çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œ")]),s._v(". ä¸‹é¢æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¸€ä¸ªç¤ºæ„å›¾, ä½ å¯ä»¥ç»“åˆå®ƒæ¥ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e201c3f38d774c5ba72bc108963fb6fa-20230731162452-rh0x3lf.png",alt:"",title:"ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("ä»æ¶æ„è®¾è®¡çš„è§’åº¦æ¥çœ‹, ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ä¼˜ç‚¹, å°±æ˜¯"),t("strong",[s._v("è§£è€¦")]),s._v(". è§£è€¦å¯¹äºå¤§å‹ç³»ç»Ÿçš„è®¾è®¡éå¸¸é‡è¦, è€Œè§£è€¦çš„ä¸€ä¸ªå…³é”®å°±æ˜¯ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œé€šä¿¡æ–¹å¼å¿…é¡»å—é™. åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸­, ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³», å®ƒä»¬å½¼æ­¤ä¹‹é—´çš„é€šä¿¡åªèƒ½é€šè¿‡ä»»åŠ¡é˜Ÿåˆ—, æ‰€ä»¥"),t("strong",[s._v("ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼æ˜¯ä¸€ä¸ªä¸é”™çš„è§£è€¦æ–¹æ¡ˆ")]),s._v(".")]),s._v(" "),t("p",[s._v("é™¤äº†æ¶æ„è®¾è®¡ä¸Šçš„ä¼˜ç‚¹ä¹‹å¤–, ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä¼˜ç‚¹å°±æ˜¯"),t("strong",[s._v("æ”¯æŒå¼‚æ­¥, å¹¶ä¸”èƒ½å¤Ÿå¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„é€Ÿåº¦å·®å¼‚")]),s._v(". ç”Ÿäº§è€…çº¿ç¨‹åªéœ€è¦å°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—è€Œæ— éœ€ç­‰å¾…ä»»åŠ¡è¢«æ¶ˆè´¹è€…çº¿ç¨‹æ‰§è¡Œå®Œ, ä¹Ÿå°±æ˜¯è¯´ä»»åŠ¡çš„ç”Ÿäº§å’Œæ¶ˆè´¹æ˜¯å¼‚æ­¥çš„, è¿™æ˜¯ä¸ä¼ ç»Ÿçš„æ–¹æ³•ä¹‹é—´è°ƒç”¨çš„æœ¬è´¨åŒºåˆ«, ä¼ ç»Ÿçš„æ–¹æ³•ä¹‹é—´è°ƒç”¨æ˜¯åŒæ­¥çš„.")]),s._v(" "),t("p",[s._v('ä½ æˆ–è®¸ä¼šæœ‰è¿™æ ·çš„ç–‘é—®, å¼‚æ­¥åŒ–å¤„ç†æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å»å¤„ç†, é‚£ä¸­é—´å¢åŠ ä¸€ä¸ª "'),t("strong",[s._v("ä»»åŠ¡é˜Ÿåˆ—")]),s._v('" ç©¶ç«Ÿæœ‰ä»€ä¹ˆç”¨å‘¢? æˆ‘è§‰å¾—ä¸»è¦è¿˜æ˜¯ç”¨äº'),t("strong",[s._v("å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„é€Ÿåº¦å·®å¼‚")]),s._v(". å‡è®¾ç”Ÿäº§è€…çš„é€Ÿç‡å¾ˆæ…¢, è€Œæ¶ˆè´¹è€…çš„é€Ÿç‡å¾ˆé«˜, æ¯”å¦‚æ˜¯ 1:3, å¦‚æœç”Ÿäº§è€…æœ‰ 3 ä¸ªçº¿ç¨‹, é‡‡ç”¨åˆ›å»ºæ–°çš„çº¿ç¨‹çš„æ–¹å¼, é‚£ä¹ˆä¼šåˆ›å»º 3 ä¸ªå­çº¿ç¨‹, è€Œé‡‡ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼, æ¶ˆè´¹çº¿ç¨‹åªéœ€è¦ 1 ä¸ªå°±å¯ä»¥äº†. Java è¯­è¨€é‡Œ, Java çº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„, çº¿ç¨‹åˆ›å»ºå¾—å¤ªå¤š, ä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬, æ‰€ä»¥ Java çº¿ç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½, é€‚é‡å³å¯. è€Œ"),t("strong",[s._v("ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼æ°å¥½èƒ½æ”¯æŒä½ ç”¨é€‚é‡çš„çº¿ç¨‹")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ”¯æŒæ‰¹é‡æ‰§è¡Œä»¥æå‡æ€§èƒ½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ”¯æŒæ‰¹é‡æ‰§è¡Œä»¥æå‡æ€§èƒ½"}},[s._v("#")]),s._v(" æ”¯æŒæ‰¹é‡æ‰§è¡Œä»¥æå‡æ€§èƒ½")]),s._v(" "),t("p",[s._v("å‰é¢è®²è¿‡è½»é‡çº§çš„çº¿ç¨‹, å¦‚æœä½¿ç”¨è½»é‡çº§çº¿ç¨‹, å°±æ²¡æœ‰å¿…è¦å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„é€Ÿåº¦å·®å¼‚äº†, å› ä¸ºè½»é‡çº§çº¿ç¨‹æœ¬èº«å°±æ˜¯å»‰ä»·çš„, é‚£æ˜¯å¦æ„å‘³ç€ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼åœ¨æ€§èƒ½ä¼˜åŒ–æ–¹é¢å°±æ— ç”¨æ­¦ä¹‹åœ°äº†å‘¢? å½“ç„¶ä¸æ˜¯, æœ‰ä¸€ç±»å¹¶å‘åœºæ™¯åº”ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å°±æœ‰å¥‡æ•ˆ, é‚£å°±æ˜¯"),t("strong",[s._v("æ‰¹é‡æ‰§è¡Œ")]),s._v("ä»»åŠ¡.")]),s._v(" "),t("p",[s._v("ä¾‹å¦‚è¦åœ¨æ•°æ®åº“é‡Œ INSERT 1000 æ¡æ•°æ®, æœ‰ä¸¤ç§æ–¹æ¡ˆ: ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯ç”¨ 1000 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ, æ¯ä¸ªçº¿ç¨‹ INSERT ä¸€æ¡æ•°æ®; ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ç”¨ 1 ä¸ªçº¿ç¨‹, æ‰§è¡Œä¸€ä¸ªæ‰¹é‡çš„ SQL, ä¸€æ¬¡æ€§æŠŠ 1000 æ¡æ•°æ® INSERT è¿›å». è¿™ä¸¤ç§æ–¹æ¡ˆ, æ˜¾ç„¶æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆæ•ˆç‡æ›´é«˜, å…¶å®è¿™æ ·çš„åº”ç”¨åœºæ™¯å°±æ˜¯ä¸Šé¢æåˆ°çš„æ‰¹é‡æ‰§è¡Œåœºæ™¯.")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°ä¸€ä¸ªç›‘æ§ç³»ç»ŸåŠ¨æ€é‡‡é›†çš„æ¡ˆä¾‹, å…¶å®æœ€ç»ˆå›ä¼ çš„ç›‘æ§æ•°æ®è¿˜æ˜¯è¦å­˜å…¥æ•°æ®åº“çš„(å¦‚ä¸‹å›¾). ä½†è¢«ç›‘æ§ç³»ç»Ÿå¾€å¾€æœ‰å¾ˆå¤š, å¦‚æœæ¯ä¸€æ¡å›ä¼ æ•°æ®éƒ½ç›´æ¥ INSERT åˆ°æ•°æ®åº“, é‚£ä¹ˆè¿™ä¸ªæ–¹æ¡ˆå°±æ˜¯ä¸Šé¢æåˆ°çš„ç¬¬ä¸€ç§æ–¹æ¡ˆ: æ¯ä¸ªçº¿ç¨‹ INSERT ä¸€æ¡æ•°æ®. å¾ˆæ˜¾ç„¶, æ›´å¥½çš„æ–¹æ¡ˆæ˜¯æ‰¹é‡æ‰§è¡Œ SQL, é‚£å¦‚ä½•å®ç°å‘¢? è¿™å°±è¦ç”¨åˆ°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ae2d3497e4ad366615ec1b50f118357e-20230731162452-t3o5aqr.png",alt:"",title:"åŠ¨æ€é‡‡é›†åŠŸèƒ½ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("åˆ©ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å®ç°æ‰¹é‡æ‰§è¡Œ SQL éå¸¸ç®€å•: å°†åŸæ¥ç›´æ¥ INSERT æ•°æ®åˆ°æ•°æ®åº“çš„çº¿ç¨‹ä½œä¸ºç”Ÿäº§è€…çº¿ç¨‹, ç”Ÿäº§è€…çº¿ç¨‹åªéœ€å°†æ•°æ®æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—, ç„¶åæ¶ˆè´¹è€…çº¿ç¨‹è´Ÿè´£å°†ä»»åŠ¡ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­"),t("strong",[s._v("æ‰¹é‡å–å‡ºå¹¶æ‰¹é‡æ‰§è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, åˆ›å»ºäº† 5 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹è´Ÿè´£æ‰¹é‡æ‰§è¡Œ SQL, è¿™ 5 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä»¥ "),t("code",[s._v("while(true){ }")]),s._v("â€‹ å¾ªç¯æ–¹å¼æ‰¹é‡åœ°è·å–ä»»åŠ¡å¹¶æ‰¹é‡åœ°æ‰§è¡Œ. éœ€è¦æ³¨æ„çš„æ˜¯, ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–æ‰¹é‡ä»»åŠ¡çš„æ–¹æ³• pollTasks() ä¸­, é¦–å…ˆæ˜¯ä»¥é˜»å¡æ–¹å¼è·å–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä¸€æ¡ä»»åŠ¡, è€Œååˆ™æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼è·å–ä»»åŠ¡; ä¹‹æ‰€ä»¥é¦–å…ˆé‡‡ç”¨é˜»å¡æ–¹å¼, æ˜¯å› ä¸ºå¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»åŠ¡, è¿™æ ·çš„æ–¹å¼èƒ½å¤Ÿé¿å…æ— è°“çš„å¾ªç¯.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»»åŠ¡é˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" bq "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨ 5 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œæ‰¹é‡ä»»åŠ¡  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" start "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xecutors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–æ‰¹é‡ä»»åŠ¡")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pollTasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œæ‰¹é‡ä»»åŠ¡")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execTasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–æ‰¹é‡ä»»åŠ¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" pollTasks "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é˜»å¡å¼è·å–ä¸€æ¡ä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// éé˜»å¡å¼è·å–ä¸€æ¡ä»»åŠ¡")]),s._v("\n        t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰¹é‡æ‰§è¡Œä»»åŠ¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execTasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å…·ä½“ä»£ç æ— æ•°")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("h5",{attrs:{id:"æ”¯æŒåˆ†é˜¶æ®µæäº¤ä»¥æå‡æ€§èƒ½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ”¯æŒåˆ†é˜¶æ®µæäº¤ä»¥æå‡æ€§èƒ½"}},[s._v("#")]),s._v(" æ”¯æŒåˆ†é˜¶æ®µæäº¤ä»¥æå‡æ€§èƒ½")]),s._v(" "),t("p",[s._v("åˆ©ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼è¿˜å¯ä»¥è½»æ¾åœ°æ”¯æŒä¸€ç§"),t("strong",[s._v("åˆ†é˜¶æ®µæäº¤")]),s._v("çš„åº”ç”¨åœºæ™¯. å¤§å®¶çŸ¥é“å†™æ–‡ä»¶å¦‚æœåŒæ­¥åˆ·ç›˜æ€§èƒ½ä¼šå¾ˆæ…¢, æ‰€ä»¥å¯¹äºä¸æ˜¯å¾ˆé‡è¦çš„æ•°æ®, å¾€å¾€é‡‡ç”¨å¼‚æ­¥åˆ·ç›˜çš„æ–¹å¼. æˆ‘æ›¾ç»å‚ä¸è¿‡ä¸€ä¸ªé¡¹ç›®, å…¶ä¸­çš„æ—¥å¿—ç»„ä»¶æ˜¯è‡ªå·±å®ç°çš„, é‡‡ç”¨çš„å°±æ˜¯å¼‚æ­¥åˆ·ç›˜æ–¹å¼, åˆ·ç›˜çš„æ—¶æœºæ˜¯:")]),s._v(" "),t("ol",[t("li",[s._v("ERROR çº§åˆ«çš„æ—¥å¿—éœ€è¦ç«‹å³åˆ·ç›˜;")]),s._v(" "),t("li",[s._v("æ•°æ®ç§¯ç´¯åˆ° 500 æ¡éœ€è¦ç«‹å³åˆ·ç›˜;")]),s._v(" "),t("li",[s._v("å­˜åœ¨æœªåˆ·ç›˜æ•°æ®, ä¸” 5 ç§’é’Ÿå†…æœªæ›¾åˆ·ç›˜, éœ€è¦ç«‹å³åˆ·ç›˜.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ—¥å¿—ç»„ä»¶çš„å¼‚æ­¥åˆ·ç›˜æ“ä½œæœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ä¸€ç§"),t("strong",[s._v("åˆ†é˜¶æ®µæäº¤")]),s._v(". ä¸‹é¢å…·ä½“çœ‹çœ‹ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å¦‚ä½•å®ç°. åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, å¯ä»¥é€šè¿‡è°ƒç”¨ "),t("code",[s._v("info()")]),s._v("â€‹ å’Œ "),t("code",[s._v("error()")]),s._v("â€‹ æ–¹æ³•å†™å…¥æ—¥å¿—, è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ—¥å¿—ä»»åŠ¡ LogMsg, å¹¶æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­, è°ƒç”¨ "),t("code",[s._v("info()")]),s._v("â€‹ å’Œ "),t("code",[s._v("error()")]),s._v("â€‹ æ–¹æ³•çš„çº¿ç¨‹æ˜¯ç”Ÿäº§è€…; è€ŒçœŸæ­£å°†æ—¥å¿—å†™å…¥æ–‡ä»¶çš„æ˜¯æ¶ˆè´¹è€…çº¿ç¨‹, åœ¨ Logger è¿™ä¸ªç±»ä¸­, åªåˆ›å»ºäº† 1 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹, åœ¨è¿™ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä¸­, ä¼šæ ¹æ®åˆ·ç›˜è§„åˆ™æ‰§è¡Œåˆ·ç›˜æ“ä½œ, é€»è¾‘å¾ˆç®€å•, è¿™é‡Œå°±ä¸èµ˜è¿°äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»»åŠ¡é˜Ÿåˆ—  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogMsg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" bq "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//flush æ‰¹é‡  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åªéœ€è¦ä¸€ä¸ªçº¿ç¨‹å†™æ—¥å¿—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨å†™æ—¥å¿—çº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),s._v(" file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createTempFile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileWriter")]),s._v(" writer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileWriter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœªåˆ·ç›˜æ—¥å¿—æ•°é‡")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" curIdx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" preFT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentTimeMillis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogMsg")]),s._v(" log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™æ—¥å¿—")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        writer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("curIdx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœä¸å­˜åœ¨æœªåˆ·ç›˜æ•°æ®, åˆ™æ— éœ€åˆ·ç›˜")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curIdx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¹æ®è§„åˆ™åˆ·ç›˜")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("level "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LEVEL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ERROR")]),s._v(" \n                            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" curIdx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentTimeMillis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" preFT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        writer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("flush")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        curIdx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        preFT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentTimeMillis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    writer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("flush")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    writer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™ INFO çº§åˆ«æ—¥å¿—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogMsg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LEVEL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†™ ERROR çº§åˆ«æ—¥å¿—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        bq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogMsg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LEVEL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ERROR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ—¥å¿—çº§åˆ«")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LEVEL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ERROR")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogMsg")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LEVEL")]),s._v(" level"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥æ„é€ å‡½æ•°å®ç°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogMsg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LEVEL")]),s._v(" lvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥ toString() å®ç°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-28"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-28"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Java è¯­è¨€æä¾›çš„çº¿ç¨‹æ± æœ¬èº«å°±æ˜¯ä¸€ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„å®ç°, ä½†æ˜¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ¯æ¬¡åªèƒ½ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æ¶ˆè´¹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œ, å¯¹äºå¤§éƒ¨åˆ†å¹¶å‘åœºæ™¯è¿™ç§ç­–ç•¥éƒ½æ²¡æœ‰é—®é¢˜. ä½†æ˜¯æœ‰äº›åœºæ™¯è¿˜æ˜¯éœ€è¦è‡ªå·±æ¥å®ç°, ä¾‹å¦‚éœ€è¦æ‰¹é‡æ‰§è¡Œä»¥åŠåˆ†é˜¶æ®µæäº¤çš„åœºæ™¯.")]),s._v(" "),t("p",[s._v("ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼åœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›. åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹, å¯ä»¥å€ŸåŠ©åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—(MQ)æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼. MQ ä¸€èˆ¬éƒ½ä¼šæ”¯æŒä¸¤ç§æ¶ˆæ¯æ¨¡å‹, ä¸€ç§æ˜¯ç‚¹å¯¹ç‚¹æ¨¡å‹, ä¸€ç§æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å‹. è¿™ä¸¤ç§æ¨¡å‹çš„åŒºåˆ«åœ¨äº, ç‚¹å¯¹ç‚¹æ¨¡å‹é‡Œä¸€ä¸ªæ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹, å’Œ Java çš„çº¿ç¨‹æ± éå¸¸ç±»ä¼¼(Java çº¿ç¨‹æ± çš„ä»»åŠ¡ä¹Ÿåªä¼šè¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ); è€Œå‘å¸ƒè®¢é˜…æ¨¡å‹é‡Œä¸€ä¸ªæ¶ˆæ¯ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹, æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ¶ˆæ¯çš„å¹¿æ’­, åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹é¢†åŸŸ, å¯ä»¥ç»“åˆè§‚å¯Ÿè€…æ¨¡å¼å®ç°å¹¿æ’­åŠŸèƒ½.")]),s._v(" "),t("h3",{attrs:{id:"æ¡ˆä¾‹åˆ†æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹åˆ†æ"}},[s._v("#")]),s._v(" æ¡ˆä¾‹åˆ†æ")]),s._v(" "),t("h4",{attrs:{id:"_38-æ¡ˆä¾‹åˆ†æ-é«˜æ€§èƒ½é™æµå™¨guava-ratelimiter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_38-æ¡ˆä¾‹åˆ†æ-é«˜æ€§èƒ½é™æµå™¨guava-ratelimiter"}},[s._v("#")]),s._v(" 38-æ¡ˆä¾‹åˆ†æ:é«˜æ€§èƒ½é™æµå™¨Guava RateLimiter")]),s._v(" "),t("p",[s._v("ä»ä»Šå¤©å¼€å§‹, å°±è¿›å…¥æ¡ˆä¾‹åˆ†ææ¨¡å—äº†. è¿™ä¸ªæ¨¡å—å°†åˆ†æå››ä¸ªç»å…¸çš„å¼€æºæ¡†æ¶, çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å¤„ç†å¹¶å‘é—®é¢˜çš„, é€šè¿‡è¿™å››ä¸ªæ¡ˆä¾‹çš„å­¦ä¹ , ç›¸ä¿¡ä½ ä¼šå¯¹å¦‚ä½•è§£å†³å¹¶å‘é—®é¢˜æœ‰ä¸ªæ›´æ·±å…¥çš„è®¤è¯†.")]),s._v(" "),t("p",[s._v("é¦–å…ˆæ¥çœ‹çœ‹ "),t("strong",[s._v("Guava RateLimiter æ˜¯å¦‚ä½•è§£å†³é«˜å¹¶å‘åœºæ™¯ä¸‹çš„é™æµé—®é¢˜çš„")]),s._v(". Guava æ˜¯ Google å¼€æºçš„ Java ç±»åº“, æä¾›äº†ä¸€ä¸ªå·¥å…·ç±» RateLimiter. å…ˆæ¥çœ‹çœ‹ RateLimiter çš„ä½¿ç”¨, è®©ä½ å¯¹é™æµæœ‰ä¸ªæ„Ÿå®˜çš„å°è±¡. å‡è®¾æœ‰ä¸€ä¸ªçº¿ç¨‹æ± , å®ƒæ¯ç§’åªèƒ½å¤„ç†ä¸¤ä¸ªä»»åŠ¡, å¦‚æœæäº¤çš„ä»»åŠ¡è¿‡å¿«, å¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®š, è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°é™æµ.")]),s._v(" "),t("p",[s._v("åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, åˆ›å»ºäº†ä¸€ä¸ªæµé€Ÿä¸º 2 ä¸ªè¯·æ±‚/ç§’çš„é™æµå™¨, è¿™é‡Œçš„æµé€Ÿè¯¥æ€ä¹ˆç†è§£å‘¢? ç›´è§‚åœ°çœ‹, 2 ä¸ªè¯·æ±‚/ç§’æŒ‡çš„æ˜¯æ¯ç§’æœ€å¤šå…è®¸ 2 ä¸ªè¯·æ±‚é€šè¿‡é™æµå™¨, å…¶å®åœ¨ Guava ä¸­, æµé€Ÿè¿˜æœ‰æ›´æ·±ä¸€å±‚çš„æ„æ€: æ˜¯ä¸€ç§åŒ€é€Ÿçš„æ¦‚å¿µ, 2 ä¸ªè¯·æ±‚/ç§’ç­‰ä»·äº 1 ä¸ªè¯·æ±‚/ 500 æ¯«ç§’.")]),s._v(" "),t("p",[s._v("åœ¨å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡ä¹‹å‰, è°ƒç”¨ "),t("code",[s._v("acquire()")]),s._v("â€‹ æ–¹æ³•å°±èƒ½èµ·åˆ°"),t("strong",[s._v("é™æµ")]),s._v("çš„ä½œç”¨. é€šè¿‡ç¤ºä¾‹ä»£ç çš„æ‰§è¡Œç»“æœ, ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± çš„æ—¶é—´é—´éš”åŸºæœ¬ä¸Šç¨³å®šåœ¨ 500 æ¯«ç§’.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é™æµå™¨æµé€Ÿ: 2 ä¸ªè¯·æ±‚ / ç§’")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RateLimiter")]),s._v(" limiter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RateLimiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®°å½•ä¸Šä¸€æ¬¡æ‰§è¡Œæ—¶é—´")]),s._v("\nprev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æµ‹è¯•æ‰§è¡Œ 20 æ¬¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é™æµå™¨é™æµ")]),s._v("\n    limiter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œ")]),s._v("\n    es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" cur "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰“å°æ—¶é—´é—´éš”: æ¯«ç§’")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cur "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" prev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000_000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        prev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cur"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("è¾“å‡ºç»“æœ"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("499")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("499")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("499")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"ç»å…¸é™æµç®—æ³•-ä»¤ç‰Œæ¡¶ç®—æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»å…¸é™æµç®—æ³•-ä»¤ç‰Œæ¡¶ç®—æ³•"}},[s._v("#")]),s._v(" ç»å…¸é™æµç®—æ³•:ä»¤ç‰Œæ¡¶ç®—æ³•")]),s._v(" "),t("p",[s._v("Guava çš„é™æµå™¨ä½¿ç”¨ä¸Šè¿˜æ˜¯å¾ˆç®€å•çš„, é‚£å®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢? Guava é‡‡ç”¨çš„æ˜¯"),t("mark",[t("strong",[s._v("ä»¤ç‰Œæ¡¶ç®—æ³•")])]),s._v(", å…¶"),t("strong",[s._v("æ ¸å¿ƒæ˜¯è¦æƒ³é€šè¿‡é™æµå™¨, å¿…é¡»æ‹¿åˆ°ä»¤ç‰Œ")]),s._v(". ä¹Ÿå°±æ˜¯è¯´, åªè¦èƒ½å¤Ÿé™åˆ¶å‘æ”¾ä»¤ç‰Œçš„é€Ÿç‡, é‚£ä¹ˆå°±èƒ½æ§åˆ¶æµé€Ÿäº†. ä»¤ç‰Œæ¡¶ç®—æ³•çš„è¯¦ç»†æè¿°å¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä»¤ç‰Œä»¥å›ºå®šçš„é€Ÿç‡æ·»åŠ åˆ°ä»¤ç‰Œæ¡¶ä¸­, å‡è®¾é™æµçš„é€Ÿç‡æ˜¯ r/ ç§’, åˆ™ä»¤ç‰Œæ¯ 1/r ç§’ä¼šæ·»åŠ ä¸€ä¸ª")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("å‡è®¾ä»¤ç‰Œæ¡¶çš„å®¹é‡æ˜¯ b, å¦‚æœä»¤ç‰Œæ¡¶å·²æ»¡, åˆ™æ–°çš„ä»¤ç‰Œä¼šè¢«ä¸¢å¼ƒ")]),s._v(";")]),s._v(" "),t("li",[t("strong",[s._v("è¯·æ±‚èƒ½å¤Ÿé€šè¿‡é™æµå™¨çš„å‰ææ˜¯ä»¤ç‰Œæ¡¶ä¸­æœ‰ä»¤ç‰Œ")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªç®—æ³•ä¸­, é™æµçš„é€Ÿç‡ r è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„, ä½†ä»¤ç‰Œæ¡¶çš„å®¹é‡ b è¯¥æ€ä¹ˆç†è§£å‘¢? b å…¶å®æ˜¯ burst çš„ç®€å†™, æ„ä¹‰æ˜¯"),t("mark",[t("strong",[s._v("é™æµå™¨å…è®¸çš„æœ€å¤§çªå‘æµé‡")])]),s._v(". æ¯”å¦‚ b=10, è€Œä¸”ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œå·²æ»¡, æ­¤æ—¶é™æµå™¨å…è®¸ 10 ä¸ªè¯·æ±‚åŒæ—¶é€šè¿‡é™æµå™¨, å½“ç„¶åªæ˜¯çªå‘æµé‡è€Œå·², è¿™ 10 ä¸ªè¯·æ±‚ä¼šå¸¦èµ° 10 ä¸ªä»¤ç‰Œ, æ‰€ä»¥"),t("strong",[s._v("åç»­çš„æµé‡åªèƒ½æŒ‰ç…§é€Ÿç‡ r é€šè¿‡é™æµå™¨")]),s._v(".")]),s._v(" "),t("p",[s._v("ä»¤ç‰Œæ¡¶è¿™ä¸ªç®—æ³•, å¦‚ä½•ç”¨ Java å®ç°å‘¢? å¾ˆå¯èƒ½ä½ çš„ç›´è§‰ä¼šå‘Šè¯‰ä½ ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼: ä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹å®šæ—¶å‘é˜»å¡é˜Ÿåˆ—ä¸­æ·»åŠ ä»¤ç‰Œ, è€Œè¯•å›¾é€šè¿‡é™æµå™¨çš„çº¿ç¨‹åˆ™ä½œä¸ºæ¶ˆè´¹è€…çº¿ç¨‹, åªæœ‰ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–åˆ°ä»¤ç‰Œ, æ‰å…è®¸é€šè¿‡é™æµå™¨.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªç®—æ³•çœ‹ä¸Šå»éå¸¸å®Œç¾, è€Œä¸”å®ç°èµ·æ¥éå¸¸ç®€å•, å¦‚æœå¹¶å‘é‡ä¸å¤§, è¿™ä¸ªå®ç°å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜. å¯å®é™…æƒ…å†µå´æ˜¯ä½¿ç”¨é™æµçš„åœºæ™¯å¤§éƒ¨åˆ†éƒ½æ˜¯é«˜å¹¶å‘åœºæ™¯, è€Œä¸”ç³»ç»Ÿå‹åŠ›å·²ç»ä¸´è¿‘æé™äº†, æ­¤æ—¶è¿™ä¸ªå®ç°å°±æœ‰é—®é¢˜äº†. é—®é¢˜å°±å‡ºåœ¨å®šæ—¶å™¨ä¸Š, åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹, å½“ç³»ç»Ÿå‹åŠ›å·²ç»ä¸´è¿‘æé™çš„æ—¶å€™, å®šæ—¶å™¨çš„ç²¾åº¦è¯¯å·®ä¼šéå¸¸å¤§, åŒæ—¶å®šæ—¶å™¨æœ¬èº«ä¼šåˆ›å»ºè°ƒåº¦çº¿ç¨‹, ä¹Ÿä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½äº§ç”Ÿå½±å“.")]),s._v(" "),t("p",[s._v("é‚£è¿˜æœ‰ä»€ä¹ˆå¥½çš„å®ç°æ–¹å¼å‘¢? å½“ç„¶æœ‰, Guava çš„å®ç°å°±"),t("strong",[s._v("æ²¡æœ‰ä½¿ç”¨å®šæ—¶å™¨")]),s._v(", ä¸‹é¢å°±æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„.")]),s._v(" "),t("h5",{attrs:{id:"guavaå¦‚ä½•å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#guavaå¦‚ä½•å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•"}},[s._v("#")]),s._v(" Guavaå¦‚ä½•å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•")]),s._v(" "),t("p",[s._v("Guava å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•, ç”¨äº†ä¸€ä¸ªå¾ˆç®€å•çš„åŠæ³•, å…¶å…³é”®æ˜¯"),t("strong",[s._v("è®°å½•å¹¶åŠ¨æ€è®¡ç®—ä¸‹ä¸€ä»¤ç‰Œå‘æ”¾çš„æ—¶é—´")]),s._v(". ä¸‹é¢ä»¥ä¸€ä¸ªæœ€ç®€å•çš„åœºæ™¯æ¥ä»‹ç»è¯¥ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹. å‡è®¾ä»¤ç‰Œæ¡¶çš„å®¹é‡ä¸º b=1, é™æµé€Ÿç‡ r = 1 ä¸ªè¯·æ±‚/ç§’, å¦‚ä¸‹å›¾æ‰€ç¤º, å¦‚æœå½“å‰ä»¤ç‰Œæ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œ, ä¸‹ä¸€ä¸ªä»¤ç‰Œçš„å‘æ”¾æ—¶é—´æ˜¯åœ¨ç¬¬ 3 ç§’, è€Œåœ¨ç¬¬ 2 ç§’çš„æ—¶å€™æœ‰ä¸€ä¸ªçº¿ç¨‹ T1 è¯·æ±‚ä»¤ç‰Œ, æ­¤æ—¶è¯¥å¦‚ä½•å¤„ç†å‘¢?")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1e37008a81dc1878d832df5c40ce9de1-20230731162452-cu7xjew.png",alt:"",title:"çº¿ç¨‹ T1 è¯·æ±‚ä»¤ç‰Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å¯¹äºè¿™ä¸ªè¯·æ±‚ä»¤ç‰Œçš„çº¿ç¨‹è€Œè¨€, å¾ˆæ˜¾ç„¶éœ€è¦ç­‰å¾… 1 ç§’, å› ä¸º 1 ç§’ä»¥å(ç¬¬ 3 ç§’)å®ƒå°±èƒ½æ‹¿åˆ°ä»¤ç‰Œäº†. æ­¤æ—¶éœ€è¦æ³¨æ„çš„æ˜¯, ä¸‹ä¸€ä¸ªä»¤ç‰Œå‘æ”¾çš„æ—¶é—´ä¹Ÿè¦å¢åŠ  1 ç§’, ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºç¬¬ 3 ç§’å‘æ”¾çš„ä»¤ç‰Œå·²ç»è¢«çº¿ç¨‹ T1 é¢„å äº†. å¤„ç†ä¹‹åå¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1e43287d99cc0ecdf18a7cad5519f058-20230731162452-kz12562.png",alt:"",title:"çº¿ç¨‹ T1 è¯·æ±‚ç»“æŸç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å‡è®¾ T1 åœ¨é¢„å äº†ç¬¬ 3 ç§’çš„ä»¤ç‰Œä¹‹å, é©¬ä¸Šåˆæœ‰ä¸€ä¸ªçº¿ç¨‹ T2 è¯·æ±‚ä»¤ç‰Œ, å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8f4e10b4ca1782cf3b961c32aaa0f42b-20230731162452-elynm1l.png",alt:"",title:"çº¿ç¨‹ T2 è¯·æ±‚ä»¤ç‰Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å¾ˆæ˜¾ç„¶, ç”±äºä¸‹ä¸€ä¸ªä»¤ç‰Œäº§ç”Ÿçš„æ—¶é—´æ˜¯ç¬¬ 4 ç§’, æ‰€ä»¥çº¿ç¨‹ T2 è¦ç­‰å¾…ä¸¤ç§’çš„æ—¶é—´, æ‰èƒ½è·å–åˆ°ä»¤ç‰Œ, åŒæ—¶ç”±äº T2 é¢„å äº†ç¬¬ 4 ç§’çš„ä»¤ç‰Œ, æ‰€ä»¥ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´è¿˜è¦å¢åŠ  1 ç§’, å®Œå…¨å¤„ç†ä¹‹å, å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e70d6ba0ef51fe90749f9236778e5baa-20230731162452-vdudhwy.png",alt:"",title:"çº¿ç¨‹ T2 è¯·æ±‚ç»“æŸç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("ä¸Šé¢çº¿ç¨‹ T1, T2 éƒ½æ˜¯åœ¨"),t("strong",[s._v("ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´ä¹‹å‰")]),s._v("è¯·æ±‚ä»¤ç‰Œ, å¦‚æœçº¿ç¨‹åœ¨"),t("strong",[s._v("ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´ä¹‹å")]),s._v("è¯·æ±‚ä»¤ç‰Œä¼šå¦‚ä½•å‘¢? å‡è®¾åœ¨çº¿ç¨‹ T1 è¯·æ±‚ä»¤ç‰Œä¹‹åçš„ 5 ç§’, ä¹Ÿå°±æ˜¯ç¬¬ 7 ç§’, çº¿ç¨‹ T3 è¯·æ±‚ä»¤ç‰Œ, å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/97fa907bb3b8fd42285b0bff9c7bd54d-20230731162452-pf1nj2u.png",alt:"",title:"çº¿ç¨‹ T3 è¯·æ±‚ä»¤ç‰Œç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("ç”±äºåœ¨ç¬¬ 5 ç§’å·²ç»äº§ç”Ÿäº†ä¸€ä¸ªä»¤ç‰Œ, æ‰€ä»¥æ­¤æ—¶çº¿ç¨‹ T3 å¯ä»¥ç›´æ¥æ‹¿åˆ°ä»¤ç‰Œ, è€Œæ— éœ€ç­‰å¾…. åœ¨ç¬¬ 7 ç§’, å®é™…ä¸Šé™æµå™¨èƒ½å¤Ÿäº§ç”Ÿ 3 ä¸ªä»¤ç‰Œ, ç¬¬ 5, 6, 7 ç§’å„äº§ç”Ÿä¸€ä¸ªä»¤ç‰Œ. ç”±äºå‡è®¾ä»¤ç‰Œæ¡¶çš„å®¹é‡æ˜¯ 1, æ‰€ä»¥ç¬¬ 6, 7 ç§’äº§ç”Ÿçš„ä»¤ç‰Œå°±ä¸¢å¼ƒäº†, å…¶å®ç­‰ä»·åœ°ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¿ç•™çš„ç¬¬ 7 ç§’çš„ä»¤ç‰Œ, ä¸¢å¼ƒçš„ç¬¬ 5, 6 ç§’çš„ä»¤ç‰Œ, ä¹Ÿå°±æ˜¯è¯´ç¬¬ 7 ç§’çš„ä»¤ç‰Œè¢«çº¿ç¨‹ T3 å æœ‰äº†, äºæ˜¯ä¸‹ä¸€ä»¤ç‰Œçš„çš„äº§ç”Ÿæ—¶é—´åº”è¯¥æ˜¯ç¬¬ 8 ç§’, å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c20d810c7c85d61c091caa6f2b3bed2b-20230731162452-tv90sqy.png",alt:"",title:"çº¿ç¨‹ T3 è¯·æ±‚ç»“æŸç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šé¢ç®€è¦åœ°åˆ†æ, ä½ ä¼šå‘ç°, "),t("strong",[s._v("åªéœ€è¦è®°å½•ä¸€ä¸ªä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿçš„æ—¶é—´, å¹¶åŠ¨æ€æ›´æ–°å®ƒ, å°±èƒ½å¤Ÿè½»æ¾å®Œæˆé™æµåŠŸèƒ½")]),s._v(". å¯ä»¥å°†ä¸Šé¢çš„è¿™ä¸ªç®—æ³•ä»£ç åŒ–, ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤º, ä¾ç„¶å‡è®¾ä»¤ç‰Œæ¡¶çš„å®¹é‡æ˜¯ 1. å…³é”® æ˜¯"),t("strong",[s._v("reserve() æ–¹æ³•")]),s._v(", è¿™ä¸ªæ–¹æ³•ä¼š"),t("strong",[s._v("ä¸ºè¯·æ±‚ä»¤ç‰Œçš„çº¿ç¨‹é¢„åˆ†é…ä»¤ç‰Œ, åŒæ—¶è¿”å›è¯¥çº¿ç¨‹èƒ½å¤Ÿè·å–ä»¤ç‰Œçš„æ—¶é—´")]),s._v(". å…¶å®ç°é€»è¾‘å°±æ˜¯ä¸Šé¢æåˆ°çš„: å¦‚æœçº¿ç¨‹è¯·æ±‚ä»¤ç‰Œçš„æ—¶é—´åœ¨ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´ä¹‹å, é‚£ä¹ˆè¯¥çº¿ç¨‹ç«‹åˆ»å°±èƒ½å¤Ÿè·å–ä»¤ç‰Œ; åä¹‹, å¦‚æœè¯·æ±‚æ—¶é—´åœ¨ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´ä¹‹å‰, é‚£ä¹ˆè¯¥çº¿ç¨‹æ˜¯åœ¨ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿçš„æ—¶é—´è·å–ä»¤ç‰Œ. ç”±äºæ­¤æ—¶ä¸‹ä¸€ä»¤ç‰Œå·²ç»è¢«è¯¥çº¿ç¨‹é¢„å , æ‰€ä»¥ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿçš„æ—¶é—´éœ€è¦åŠ ä¸Š 1 ç§’.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleLimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘æ”¾ä»¤ç‰Œé—´éš”: çº³ç§’")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" interval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000_000_000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¢„å ä»¤ç‰Œ, è¿”å›èƒ½å¤Ÿè·å–ä»¤ç‰Œçš„æ—¶é—´")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reserve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯·æ±‚æ—¶é—´åœ¨ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´ä¹‹å")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡æ–°è®¡ç®—ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("now "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´é‡ç½®ä¸ºå½“å‰æ—¶é—´")]),s._v("\n            next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// èƒ½å¤Ÿè·å–ä»¤ç‰Œçš„æ—¶é—´")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" at "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´")]),s._v("\n        next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›çº¿ç¨‹éœ€è¦ç­‰å¾…çš„æ—¶é—´")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Math")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("at"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”³è¯·ä»¤ç‰Œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”³è¯·ä»¤ç‰Œæ—¶çš„æ—¶é—´")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" now "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¢„å ä»¤ç‰Œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" at "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reserve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" waitTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("at "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‰ç…§æ¡ä»¶ç­‰å¾…")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("waitTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NANOSECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("waitTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("p",[s._v("å¦‚æœä»¤ç‰Œæ¡¶çš„å®¹é‡å¤§äº 1, åˆè¯¥å¦‚ä½•å¤„ç†å‘¢? æŒ‰ç…§ä»¤ç‰Œæ¡¶ç®—æ³•, ä»¤ç‰Œè¦é¦–å…ˆä»ä»¤ç‰Œæ¡¶ä¸­å‡º, æ‰€ä»¥éœ€è¦æŒ‰éœ€è®¡ç®—ä»¤ç‰Œæ¡¶ä¸­çš„æ•°é‡, å½“æœ‰çº¿ç¨‹è¯·æ±‚ä»¤ç‰Œæ—¶, å…ˆä»ä»¤ç‰Œæ¡¶ä¸­å‡º. å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤º. å¢åŠ äº†ä¸€ä¸ª "),t("strong",[s._v("resync() æ–¹æ³•")]),s._v(", åœ¨è¿™ä¸ªæ–¹æ³•ä¸­, å¦‚æœçº¿ç¨‹è¯·æ±‚ä»¤ç‰Œçš„æ—¶é—´åœ¨ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´ä¹‹å, ä¼šé‡æ–°è®¡ç®—ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œæ•°, "),t("strong",[s._v("æ–°äº§ç”Ÿçš„ä»¤ç‰Œçš„è®¡ç®—å…¬å¼æ˜¯: (now-next)/interval")]),s._v(", å¯å¯¹ç…§ä¸Šé¢çš„ç¤ºæ„å›¾æ¥ç†è§£. reserve() æ–¹æ³•ä¸­, åˆ™å¢åŠ äº†å…ˆä»ä»¤ç‰Œæ¡¶ä¸­å‡ºä»¤ç‰Œçš„é€»è¾‘, ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯, "),t("strong",[s._v("å¦‚æœä»¤ç‰Œæ˜¯ä»ä»¤ç‰Œæ¡¶ä¸­å‡ºçš„, é‚£ä¹ˆ next å°±æ— éœ€å¢åŠ ä¸€ä¸ª interval äº†")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleLimiter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œæ•°é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" storedPermits "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¤ç‰Œæ¡¶çš„å®¹é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" maxPermits "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘æ”¾ä»¤ç‰Œé—´éš”: çº³ç§’")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" interval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000_000_000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯·æ±‚æ—¶é—´åœ¨ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´ä¹‹å, åˆ™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. é‡æ–°è®¡ç®—ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œæ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. å°†ä¸‹ä¸€ä¸ªä»¤ç‰Œå‘æ”¾æ—¶é—´é‡ç½®ä¸ºå½“å‰æ—¶é—´")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("now "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°äº§ç”Ÿçš„ä»¤ç‰Œæ•°")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" newPermits "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("now "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°ä»¤ç‰Œå¢åŠ åˆ°ä»¤ç‰Œæ¡¶")]),s._v("\n            storedPermits "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("min")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxPermits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" storedPermits "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" newPermits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†ä¸‹ä¸€ä¸ªä»¤ç‰Œå‘æ”¾æ—¶é—´é‡ç½®ä¸ºå½“å‰æ—¶é—´")]),s._v("\n            next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¢„å ä»¤ç‰Œ, è¿”å›èƒ½å¤Ÿè·å–ä»¤ç‰Œçš„æ—¶é—´")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reserve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// èƒ½å¤Ÿè·å–ä»¤ç‰Œçš„æ—¶é—´")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" at "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¤ç‰Œæ¡¶ä¸­èƒ½æä¾›çš„ä»¤ç‰Œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" fb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("min")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" storedPermits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¤ç‰Œå‡€éœ€æ±‚: é¦–å…ˆå‡æ‰ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" nr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" fb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡æ–°è®¡ç®—ä¸‹ä¸€ä»¤ç‰Œäº§ç”Ÿæ—¶é—´")]),s._v("\n        next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" nr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡æ–°è®¡ç®—ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("storedPermits "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" fb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" at"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”³è¯·ä»¤ç‰Œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”³è¯·ä»¤ç‰Œæ—¶çš„æ—¶é—´")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" now "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¢„å ä»¤ç‰Œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" at "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reserve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" waitTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("at "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‰ç…§æ¡ä»¶ç­‰å¾…")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("waitTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NANOSECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("waitTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-29"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-29"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("ç»å…¸çš„é™æµç®—æ³•æœ‰ä¸¤ä¸ª, ä¸€ä¸ªæ˜¯"),t("strong",[s._v("ä»¤ç‰Œæ¡¶ç®—æ³•(Token Bucket)")]),s._v(" , å¦ä¸€ä¸ªæ˜¯"),t("strong",[s._v("æ¼æ¡¶ç®—æ³•(Leaky Bucket)")]),s._v(" . ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯å®šæ—¶å‘ä»¤ç‰Œæ¡¶å‘é€ä»¤ç‰Œ, è¯·æ±‚èƒ½å¤Ÿä»ä»¤ç‰Œæ¡¶ä¸­æ‹¿åˆ°ä»¤ç‰Œ, ç„¶åæ‰èƒ½é€šè¿‡é™æµå™¨; è€Œæ¼æ¡¶ç®—æ³•é‡Œ, è¯·æ±‚å°±åƒæ°´ä¸€æ ·æ³¨å…¥æ¼æ¡¶, æ¼æ¡¶ä¼šæŒ‰ç…§ä¸€å®šçš„é€Ÿç‡è‡ªåŠ¨å°†æ°´æ¼æ‰, åªæœ‰æ¼æ¡¶é‡Œè¿˜èƒ½æ³¨å…¥æ°´çš„æ—¶å€™, è¯·æ±‚æ‰èƒ½é€šè¿‡é™æµå™¨. ä»¤ç‰Œæ¡¶ç®—æ³•å’Œæ¼æ¡¶ç®—æ³•å¾ˆåƒä¸€ä¸ªç¡¬å¸çš„æ­£åé¢, æ‰€ä»¥å¯ä»¥å‚è€ƒä»¤ç‰Œæ¡¶ç®—æ³•çš„å®ç°æ¥å®ç°æ¼æ¡¶ç®—æ³•.")]),s._v(" "),t("p",[s._v("ä¸Šé¢ä»‹ç»äº† Guava æ˜¯å¦‚ä½•å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•çš„, ç¤ºä¾‹ä»£ç æ˜¯å¯¹ Guava RateLimiter çš„ç®€åŒ–, Guava RateLimiter æ‰©å±•äº†æ ‡å‡†çš„ä»¤ç‰Œæ¡¶ç®—æ³•, æ¯”å¦‚è¿˜èƒ½æ”¯æŒé¢„çƒ­åŠŸèƒ½. å¯¹äºæŒ‰éœ€åŠ è½½çš„ç¼“å­˜æ¥è¯´, é¢„çƒ­åç¼“å­˜èƒ½æ”¯æŒ 5 ä¸‡ TPS çš„å¹¶å‘, ä½†æ˜¯åœ¨é¢„çƒ­å‰ 5 ä¸‡ TPS çš„å¹¶å‘ç›´æ¥å°±æŠŠç¼“å­˜å‡»å®äº†, æ‰€ä»¥å¦‚æœéœ€è¦ç»™è¯¥ç¼“å­˜é™æµ, é™æµå™¨ä¹Ÿéœ€è¦æ”¯æŒé¢„çƒ­åŠŸèƒ½, åœ¨åˆå§‹é˜¶æ®µ, é™åˆ¶çš„æµé€Ÿ r å¾ˆå°, ä½†æ˜¯åŠ¨æ€å¢é•¿çš„. é¢„çƒ­åŠŸèƒ½çš„å®ç°éå¸¸å¤æ‚, Guava æ„å»ºäº†ä¸€ä¸ªç§¯åˆ†å‡½æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜, å¦‚æœä½ æ„Ÿå…´è¶£, å¯ä»¥ç»§ç»­æ·±å…¥ç ”ç©¶.")]),s._v(" "),t("h4",{attrs:{id:"_39-æ¡ˆä¾‹åˆ†æ-äºŒ-é«˜æ€§èƒ½ç½‘ç»œåº”ç”¨æ¡†æ¶netty"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_39-æ¡ˆä¾‹åˆ†æ-äºŒ-é«˜æ€§èƒ½ç½‘ç»œåº”ç”¨æ¡†æ¶netty"}},[s._v("#")]),s._v(" 39-æ¡ˆä¾‹åˆ†æ(äºŒ):é«˜æ€§èƒ½ç½‘ç»œåº”ç”¨æ¡†æ¶Netty")]),s._v(" "),t("p",[s._v("Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ç½‘ç»œåº”ç”¨æ¡†æ¶, åº”ç”¨éå¸¸æ™®é, ç›®å‰åœ¨ Java é¢†åŸŸé‡Œ, Netty åŸºæœ¬ä¸Šæˆä¸ºç½‘ç»œç¨‹åºçš„æ ‡é…äº†. Netty æ¡†æ¶åŠŸèƒ½ä¸°å¯Œ, ä¹Ÿéå¸¸å¤æ‚, ä»Šå¤©ä¸»è¦åˆ†æ Netty æ¡†æ¶ä¸­çš„çº¿ç¨‹æ¨¡å‹, è€Œ"),t("strong",[s._v("çº¿ç¨‹æ¨¡å‹ç›´æ¥å½±å“ç€ç½‘ç»œç¨‹åºçš„æ€§èƒ½")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ä»‹ç» Netty çš„çº¿ç¨‹æ¨¡å‹ä¹‹å‰, é¦–å…ˆéœ€è¦æŠŠé—®é¢˜ææ¸…æ¥š, äº†è§£ç½‘ç»œç¼–ç¨‹æ€§èƒ½çš„ç“¶é¢ˆåœ¨å“ªé‡Œ, ç„¶åå†çœ‹ Netty çš„çº¿ç¨‹æ¨¡å‹æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„.")]),s._v(" "),t("h5",{attrs:{id:"ç½‘ç»œç¼–ç¨‹æ€§èƒ½çš„ç“¶é¢ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘ç»œç¼–ç¨‹æ€§èƒ½çš„ç“¶é¢ˆ"}},[s._v("#")]),s._v(" ç½‘ç»œç¼–ç¨‹æ€§èƒ½çš„ç“¶é¢ˆ")]),s._v(" "),t("p",[s._v("å‰é¢å†™è¿‡ä¸€ä¸ªç®€å•çš„ç½‘ç»œç¨‹åº echo, é‡‡ç”¨çš„æ˜¯é˜»å¡å¼ I/O(BIO). BIO æ¨¡å‹é‡Œ, æ‰€æœ‰ read() æ“ä½œå’Œ write() æ“ä½œéƒ½ä¼š"),t("strong",[s._v("é˜»å¡å½“å‰çº¿ç¨‹")]),s._v("çš„, å¦‚æœå®¢æˆ·ç«¯å·²ç»å’ŒæœåŠ¡ç«¯å»ºç«‹äº†ä¸€ä¸ªè¿æ¥, è€Œè¿Ÿè¿Ÿä¸å‘é€æ•°æ®, é‚£ä¹ˆæœåŠ¡ç«¯çš„ read() æ“ä½œä¼šä¸€ç›´é˜»å¡, æ‰€ä»¥"),t("strong",[s._v("ä½¿ç”¨ BIO æ¨¡å‹, ä¸€èˆ¬éƒ½ä¼šä¸ºæ¯ä¸ª socket åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹")]),s._v(", è¿™æ ·å°±ä¸ä¼šå› ä¸ºçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ª socket ä¸Šè€Œå½±å“å¯¹å…¶ä»– socket çš„è¯»å†™. BIO çš„çº¿ç¨‹æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤º, æ¯ä¸€ä¸ª socket éƒ½å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹; ä¸ºäº†é¿å…é¢‘ç¹åˆ›å»º, æ¶ˆè€—çº¿ç¨‹, å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± , ä½†æ˜¯ socket å’Œçº¿ç¨‹ä¹‹é—´çš„å¯¹åº”å…³ç³»å¹¶ä¸ä¼šå˜åŒ–.")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/dc1d37a4a6e770f9b05196b2c86be40f-20230731162452-bvixg6m.png",alt:"",title:"BIO çš„çº¿ç¨‹æ¨¡å‹"}}),s._v("â€‹")]),s._v(" "),t("p",[s._v("BIO è¿™ç§çº¿ç¨‹æ¨¡å‹"),t("strong",[s._v("é€‚ç”¨äº socket è¿æ¥ä¸æ˜¯å¾ˆå¤š")]),s._v("çš„åœºæ™¯; ä½†æ˜¯ç°åœ¨çš„äº’è”ç½‘åœºæ™¯, å¾€å¾€éœ€è¦æœåŠ¡å™¨èƒ½å¤Ÿæ”¯æ’‘åä¸‡ç”šè‡³ç™¾ä¸‡è¿æ¥, è€Œåˆ›å»ºåä¸‡ç”šè‡³ä¸Šç™¾ä¸‡ä¸ªçº¿ç¨‹æ˜¾ç„¶å¹¶ä¸ç°å®, æ‰€ä»¥ BIO çº¿ç¨‹æ¨¡å‹æ— æ³•è§£å†³ç™¾ä¸‡è¿æ¥çš„é—®é¢˜. å¦‚æœä»”ç»†è§‚å¯Ÿ, ä½ ä¼šå‘ç°äº’è”ç½‘åœºæ™¯ä¸­, è™½ç„¶è¿æ¥å¤š, "),t("strong",[s._v("ä½†æ˜¯æ¯ä¸ªè¿æ¥ä¸Šçš„è¯·æ±‚å¹¶ä¸é¢‘ç¹")]),s._v(", æ‰€ä»¥çº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾… I/O å°±ç»ª. ä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½é˜»å¡åœ¨é‚£é‡Œ, è¿™å®Œå…¨æ˜¯æµªè´¹, å¦‚æœèƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜, é‚£å°±ä¸éœ€è¦è¿™ä¹ˆå¤šçº¿ç¨‹äº†.")]),s._v(" "),t("p",[s._v("é¡ºç€è¿™ä¸ªæ€è·¯, å¯ä»¥å°†çº¿ç¨‹æ¨¡å‹ä¼˜åŒ–ä¸ºä¸‹å›¾è¿™ä¸ªæ ·å­, "),t("strong",[s._v("å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªè¿æ¥")]),s._v(", è¿™æ ·çº¿ç¨‹çš„åˆ©ç”¨ç‡å°±ä¸Šæ¥äº†, åŒæ—¶æ‰€éœ€çš„çº¿ç¨‹æ•°é‡ä¹Ÿè·Ÿç€é™ä¸‹æ¥äº†. è¿™ä¸ªæ€è·¯å¾ˆå¥½, å¯æ˜¯ä½¿ç”¨ BIO ç›¸å…³çš„ API æ˜¯æ— æ³•å®ç°çš„, è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? å› ä¸º BIO ç›¸å…³çš„ socket è¯»å†™æ“ä½œéƒ½æ˜¯"),t("strong",[s._v("é˜»å¡å¼")]),s._v("çš„, è€Œä¸€æ—¦è°ƒç”¨äº†é˜»å¡å¼ API, åœ¨ I/O å°±ç»ªå‰, è°ƒç”¨çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡, ä¹Ÿå°±æ— æ³•å¤„ç†å…¶ä»–çš„ socket è¿æ¥äº†.")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/0b42103a8b1f9bb7930091ab269ce56c-20230731162452-ammcbuo.png",alt:"",title:"ç†æƒ³çš„çº¿ç¨‹æ¨¡å‹å›¾"}}),s._v("â€‹")]),s._v(" "),t("p",[s._v("å¥½åœ¨ Java é‡Œè¿˜æä¾›äº†éé˜»å¡å¼(NIO)API, "),t("strong",[s._v("åˆ©ç”¨éé˜»å¡å¼ API å°±èƒ½å¤Ÿå®ç°ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¿æ¥äº†")]),s._v(". é‚£å…·ä½“å¦‚ä½•å®ç°å‘¢? ç°åœ¨æ™®ééƒ½æ˜¯"),t("strong",[s._v("é‡‡ç”¨ Reactor æ¨¡å¼")]),s._v(", åŒ…æ‹¬ Netty çš„å®ç°. æ‰€ä»¥, è¦æƒ³ç†è§£ Netty çš„å®ç°, æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ Reactor æ¨¡å¼.")]),s._v(" "),t("h5",{attrs:{id:"reactoræ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reactoræ¨¡å¼"}},[s._v("#")]),s._v(" Reactoræ¨¡å¼")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ˜¯ Reactor æ¨¡å¼çš„ç±»ç»“æ„å›¾, å…¶ä¸­ Handle æŒ‡çš„æ˜¯ I/O å¥æŸ„, åœ¨ Java ç½‘ç»œç¼–ç¨‹é‡Œ, å®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç½‘ç»œè¿æ¥. Event Handler å¾ˆå®¹æ˜“ç†è§£, å°±æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨, å…¶ä¸­ handle_event() æ–¹æ³•å¤„ç† I/O äº‹ä»¶, ä¹Ÿå°±æ˜¯æ¯ä¸ª Event Handler å¤„ç†ä¸€ä¸ª I/O Handle; get_handle() æ–¹æ³•å¯ä»¥è¿”å›è¿™ä¸ª I/O çš„ Handle. Synchronous Event Demultiplexer å¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿæä¾›çš„ I/O å¤šè·¯å¤ç”¨ API, ä¾‹å¦‚ POSIX æ ‡å‡†é‡Œçš„ select() ä»¥åŠ Linux é‡Œé¢çš„ epoll().")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/78d19ce7b7bb310cbb5a26446062c6fc-20230731162452-6vhkh10.png",alt:"",title:"Reactor æ¨¡å¼ç±»ç»“æ„å›¾"}})]),s._v(" "),t("p",[s._v("Reactor æ¨¡å¼çš„æ ¸å¿ƒè‡ªç„¶æ˜¯ "),t("strong",[s._v("Reactor è¿™ä¸ªç±»")]),s._v(", å…¶ä¸­ register_handler() å’Œ remove_handler() è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥æ³¨å†Œå’Œåˆ é™¤ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨; "),t("strong",[s._v("handle_events() æ–¹å¼æ˜¯æ ¸å¿ƒ")]),s._v(", ä¹Ÿæ˜¯ Reactor æ¨¡å¼çš„å‘åŠ¨æœº, è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹: é¦–å…ˆé€šè¿‡åŒæ­¥äº‹ä»¶å¤šè·¯é€‰æ‹©å™¨æä¾›çš„ select() æ–¹æ³•ç›‘å¬ç½‘ç»œäº‹ä»¶, å½“æœ‰ç½‘ç»œäº‹ä»¶å°±ç»ªå, å°±éå†äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¯¥ç½‘ç»œäº‹ä»¶. ç”±äºç½‘ç»œäº‹ä»¶æ˜¯æºæºä¸æ–­çš„, æ‰€ä»¥åœ¨ä¸»ç¨‹åºä¸­å¯åŠ¨ Reactor æ¨¡å¼, éœ€è¦ä»¥ "),t("code",[s._v("while(true){}")]),s._v("â€‹ çš„æ–¹å¼è°ƒç”¨ handle_events() æ–¹æ³•.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Reactor")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle_events")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€šè¿‡åŒæ­¥äº‹ä»¶å¤šè·¯é€‰æ‹©å™¨æä¾›çš„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//select() æ–¹æ³•ç›‘å¬ç½‘ç»œäº‹ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("handlers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†ç½‘ç»œäº‹ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h in handlers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle_event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨ä¸»ç¨‹åºä¸­å¯åŠ¨äº‹ä»¶å¾ªç¯")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle_events")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h5",{attrs:{id:"nettyä¸­çš„çº¿ç¨‹æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nettyä¸­çš„çº¿ç¨‹æ¨¡å‹"}},[s._v("#")]),s._v(" Nettyä¸­çš„çº¿ç¨‹æ¨¡å‹")]),s._v(" "),t("p",[s._v("Netty çš„å®ç°è™½ç„¶å‚è€ƒäº† Reactor æ¨¡å¼, ä½†æ˜¯å¹¶æ²¡æœ‰å®Œå…¨ç…§æ¬, "),t("strong",[s._v("Netty ä¸­æœ€æ ¸å¿ƒçš„æ¦‚å¿µæ˜¯äº‹ä»¶å¾ªç¯(EventLoop)")]),s._v(" , å…¶å®ä¹Ÿå°±æ˜¯ Reactor æ¨¡å¼ä¸­çš„ Reactor, "),t("strong",[s._v("è´Ÿè´£ç›‘å¬ç½‘ç»œäº‹ä»¶å¹¶è°ƒç”¨äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†")]),s._v(". åœ¨ 4.x ç‰ˆæœ¬çš„ Netty ä¸­, ç½‘ç»œè¿æ¥å’Œ EventLoop æ˜¯ç¨³å®šçš„å¤šå¯¹ 1 å…³ç³», è€Œ EventLoop å’Œ Java çº¿ç¨‹æ˜¯ 1 å¯¹ 1 å…³ç³», è¿™é‡Œçš„ç¨³å®šæŒ‡çš„æ˜¯å…³ç³»ä¸€æ—¦ç¡®å®šå°±ä¸å†å‘ç”Ÿå˜åŒ–. ä¹Ÿå°±æ˜¯"),t("strong",[s._v("è¯´ä¸€ä¸ªç½‘ç»œè¿æ¥åªä¼šå¯¹åº”å”¯ä¸€çš„ä¸€ä¸ª EventLoop, è€Œä¸€ä¸ª EventLoop ä¹Ÿåªä¼šå¯¹åº”åˆ°ä¸€ä¸ª Java çº¿ç¨‹, æ‰€ä»¥ä¸€ä¸ªç½‘ç»œè¿æ¥åªä¼šå¯¹åº”åˆ°ä¸€ä¸ª Java çº¿ç¨‹")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸€ä¸ªç½‘ç»œè¿æ¥å¯¹åº”åˆ°ä¸€ä¸ª Java çº¿ç¨‹ä¸Š, æœ‰ä»€ä¹ˆå¥½å¤„å‘¢? æœ€å¤§çš„å¥½å¤„å°±æ˜¯å¯¹äºä¸€ä¸ªç½‘ç»œè¿æ¥çš„äº‹ä»¶å¤„ç†æ˜¯å•çº¿ç¨‹çš„, è¿™æ ·å°±"),t("strong",[s._v("é¿å…äº†å„ç§å¹¶å‘é—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("Netty ä¸­çš„çº¿ç¨‹æ¨¡å‹å¯ä»¥å‚è€ƒä¸‹å›¾, è¿™ä¸ªå›¾å’Œå‰é¢æåˆ°çš„ç†æƒ³çš„çº¿ç¨‹æ¨¡å‹å›¾éå¸¸ç›¸ä¼¼, æ ¸å¿ƒç›®æ ‡éƒ½æ˜¯ç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a2178bbe275aff26662fc96142ceed36-20230731162452-36h31zj.png",alt:"",title:"Netty ä¸­çš„çº¿ç¨‹æ¨¡å‹"}})]),s._v(" "),t("p",[s._v("Netty ä¸­è¿˜æœ‰ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ "),t("strong",[s._v("EventLoopGroup")]),s._v(", é¡¾åæ€ä¹‰, ä¸€ä¸ª EventLoopGroup ç”±ä¸€ç»„ EventLoop ç»„æˆ. å®é™…ä½¿ç”¨ä¸­, ä¸€èˆ¬éƒ½ä¼šåˆ›å»ºä¸¤ä¸ª EventLoopGroup, "),t("strong",[s._v("ä¸€ä¸ªç§°ä¸º bossGroup, ä¸€ä¸ªç§°ä¸º workerGroup")]),s._v(". ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä¸ª EventLoopGroup å‘¢?")]),s._v(" "),t("p",[s._v("è¿™ä¸ªå’Œ socket å¤„ç†ç½‘ç»œè¯·æ±‚çš„æœºåˆ¶æœ‰å…³, socket å¤„ç† TCP ç½‘ç»œ"),t("strong",[s._v("è¿æ¥è¯·æ±‚")]),s._v(", æ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ socket ä¸­, æ¯å½“æœ‰ä¸€ä¸ª TCP è¿æ¥æˆåŠŸå»ºç«‹, éƒ½ä¼š"),t("strong",[s._v("åˆ›å»ºä¸€ä¸ªæ–°çš„ socket")]),s._v(", ä¹‹åå¯¹ TCP "),t("strong",[s._v("è¿æ¥çš„è¯»å†™éƒ½æ˜¯ç”±æ–°åˆ›å»ºå¤„ç†çš„ socket å®Œæˆçš„")]),s._v(". ä¹Ÿå°±æ˜¯è¯´"),t("strong",[s._v("å¤„ç† TCP è¿æ¥è¯·æ±‚å’Œè¯»å†™è¯·æ±‚æ˜¯é€šè¿‡ä¸¤ä¸ªä¸åŒçš„ socket å®Œæˆçš„")]),s._v(". ä¸Šé¢åœ¨è®¨è®ºç½‘ç»œè¯·æ±‚çš„æ—¶å€™, ä¸ºäº†ç®€åŒ–æ¨¡å‹, åªæ˜¯è®¨è®ºäº†è¯»å†™è¯·æ±‚, è€Œæ²¡æœ‰è®¨è®ºè¿æ¥è¯·æ±‚.")]),s._v(" "),t("p",[t("strong",[s._v("åœ¨ Netty ä¸­,")]),s._v(" "),t("mark",[t("strong",[s._v("bossGroup å°±ç”¨æ¥å¤„ç†è¿æ¥è¯·æ±‚çš„, è€Œ workerGroup æ˜¯ç”¨æ¥å¤„ç†è¯»å†™è¯·æ±‚çš„")])]),s._v(". bossGroup å¤„ç†å®Œè¿æ¥è¯·æ±‚å, ä¼šå°†è¿™ä¸ªè¿æ¥"),t("strong",[s._v("æäº¤ç»™ workerGroup æ¥å¤„ç†")]),s._v(",  workerGroup é‡Œé¢æœ‰å¤šä¸ª EventLoop, é‚£æ–°çš„è¿æ¥ä¼šäº¤ç»™å“ªä¸ª EventLoop æ¥å¤„ç†å‘¢? è¿™å°±éœ€è¦ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç®—æ³•, Netty ä¸­ç›®å‰ä½¿ç”¨çš„æ˜¯"),t("strong",[s._v("è½®è¯¢ç®—æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹é¢ç”¨ Netty é‡æ–°å®ç°ä»¥ä¸‹ echo ç¨‹åºçš„æœåŠ¡ç«¯, è¿‘è·ç¦»æ„Ÿå—ä¸€ä¸‹ Netty.")]),s._v(" "),t("h5",{attrs:{id:"ç”¨nettyå®ç°echoç¨‹åºæœåŠ¡ç«¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨nettyå®ç°echoç¨‹åºæœåŠ¡ç«¯"}},[s._v("#")]),s._v(" ç”¨Nettyå®ç°Echoç¨‹åºæœåŠ¡ç«¯")]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç åŸºäº Netty å®ç°äº† echo ç¨‹åºæœåŠ¡ç«¯: é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨(ç­‰åŒäº Reactor æ¨¡å¼ä¸­çš„äº‹ä»¶å¤„ç†å™¨), ç„¶ååˆ›å»ºäº† bossGroup å’Œ workerGroup, å†ä¹‹ååˆ›å»ºå¹¶åˆå§‹åŒ–äº† ServerBootstrap, ä»£ç è¿˜æ˜¯å¾ˆç®€å•çš„, ä¸è¿‡æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ä¸ª, å¦‚æœ NettybossGroup "),t("strong",[s._v("åªç›‘å¬ä¸€ä¸ªç«¯å£")]),s._v(", é‚£ bossGroup åªéœ€è¦ 1 ä¸ª EventLoop å°±å¯ä»¥äº†, å¤šäº†çº¯å±æµªè´¹.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒä¸ª, é»˜è®¤æƒ…å†µä¸‹, "),t("strong",[s._v('Netty ä¼šåˆ›å»º "2*CPU æ ¸æ•°" ä¸ª EventLoop')]),s._v(", ç”±äºç½‘ç»œè¿æ¥ä¸ EventLoop æœ‰ç¨³å®šçš„å…³ç³», æ‰€ä»¥äº‹ä»¶å¤„ç†å™¨åœ¨å¤„ç†ç½‘ç»œäº‹ä»¶çš„æ—¶å€™æ˜¯ä¸èƒ½æœ‰é˜»å¡æ“ä½œçš„, å¦åˆ™å¾ˆå®¹æ˜“å¯¼è‡´è¯·æ±‚å¤§é¢ç§¯è¶…æ—¶. å¦‚æœå®åœ¨æ— æ³•é¿å…ä½¿ç”¨é˜»å¡æ“ä½œ, é‚£å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æ¥å¼‚æ­¥å¤„ç†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// äº‹ä»¶å¤„ç†å™¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EchoServerHandler")]),s._v(" serverHandler "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EchoServerHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//boss çº¿ç¨‹ç»„  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventLoopGroup")]),s._v(" bossGroup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NioEventLoopGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//worker çº¿ç¨‹ç»„  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventLoopGroup")]),s._v(" workerGroup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NioEventLoopGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerBootstrap")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerBootstrap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bossGroup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" workerGroup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NioServerSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("childHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChannelInitializer")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketChannel")]),s._v(" ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pipeline")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addLast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("serverHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//bind æœåŠ¡ç«¯ç«¯å£  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChannelFuture")]),s._v(" f "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("closeFuture")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»ˆæ­¢å·¥ä½œçº¿ç¨‹ç»„")]),s._v("\n    workerGroup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdownGracefully")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»ˆæ­¢ boss çº¿ç¨‹ç»„")]),s._v("\n    bossGroup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdownGracefully")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//socket è¿æ¥å¤„ç†å™¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EchoServerHandler")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChannelInboundHandlerAdapter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†è¯»äº‹ä»¶  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("channelRead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChannelHandlerContext")]),s._v(" ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†è¯»å®Œæˆäº‹ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("channelReadComplete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChannelHandlerContext")]),s._v(" ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("flush")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†å¼‚å¸¸äº‹ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exceptionCaught")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChannelHandlerContext")]),s._v(" ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" cause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        cause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-30"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-30"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Netty æ˜¯ä¸€ä¸ªæ¬¾ä¼˜ç§€çš„ç½‘ç»œç¼–ç¨‹æ¡†æ¶, æ€§èƒ½éå¸¸å¥½, ä¸ºäº†å®ç°é«˜æ€§èƒ½çš„ç›®æ ‡, Netty åšäº†å¾ˆå¤šä¼˜åŒ–, ä¾‹å¦‚ä¼˜åŒ–äº† ByteBuffer, æ”¯æŒé›¶æ‹·è´ç­‰ç­‰, å’Œå¹¶å‘ç¼–ç¨‹ç›¸å…³çš„å°±æ˜¯å®ƒçš„çº¿ç¨‹æ¨¡å‹äº†. Netty çš„çº¿ç¨‹æ¨¡å‹è®¾è®¡å¾—å¾ˆç²¾å·§, æ¯ä¸ªç½‘ç»œè¿æ¥éƒ½å…³è”åˆ°äº†ä¸€ä¸ªçº¿ç¨‹ä¸Š, è¿™æ ·åšçš„å¥½å¤„æ˜¯: å¯¹äºä¸€ä¸ªç½‘ç»œè¿æ¥, è¯»å†™æ“ä½œéƒ½æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„, ä»è€Œé¿å…äº†å¹¶å‘ç¨‹åºçš„å„ç§é—®é¢˜.")]),s._v(" "),t("h4",{attrs:{id:"_40-æ¡ˆä¾‹åˆ†æ-ä¸‰-é«˜æ€§èƒ½é˜Ÿåˆ—disruptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_40-æ¡ˆä¾‹åˆ†æ-ä¸‰-é«˜æ€§èƒ½é˜Ÿåˆ—disruptor"}},[s._v("#")]),s._v(" 40-æ¡ˆä¾‹åˆ†æ(ä¸‰):é«˜æ€§èƒ½é˜Ÿåˆ—Disruptor")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»è¿‡ Java SDK æä¾›äº† 2 ä¸ªæœ‰ç•Œé˜Ÿåˆ—: ArrayBlockingQueue å’Œ LinkedBlockingQueue, å®ƒä»¬éƒ½æ˜¯åŸºäº ReentrantLock å®ç°çš„, åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹, é”çš„æ•ˆç‡å¹¶ä¸é«˜, é‚£æœ‰æ²¡æœ‰æ›´å¥½çš„æ›¿ä»£å“å‘¢? æœ‰, ä»Šå¤©å°±ä»‹ç»ä¸€ç§æ€§èƒ½æ›´é«˜çš„æœ‰ç•Œé˜Ÿåˆ—: "),t("strong",[s._v("Disruptor")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("Disruptor æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„æœ‰ç•Œå†…å­˜é˜Ÿåˆ—")]),s._v(", ç›®å‰åº”ç”¨éå¸¸å¹¿æ³›, Log4j2, Spring Messaging, HBase, Storm éƒ½ç”¨åˆ°äº† Disruptor, é‚£ Disruptor çš„æ€§èƒ½ä¸ºä»€ä¹ˆè¿™ä¹ˆé«˜å‘¢? Disruptor é¡¹ç›®å›¢é˜Ÿæ›¾ç»å†™è¿‡ä¸€ç¯‡è®ºæ–‡, è¯¦ç»†è§£é‡Šäº†å…¶åŸå› , å¯ä»¥æ€»ç»“ä¸ºå¦‚ä¸‹:")]),s._v(" "),t("ol",[t("li",[s._v("å†…å­˜åˆ†é…æ›´åŠ åˆç†, ä½¿ç”¨ "),t("strong",[s._v("RingBuffer")]),s._v(" æ•°æ®ç»“æ„, æ•°ç»„å…ƒç´ åœ¨åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§å…¨éƒ¨åˆ›å»º, æå‡ç¼“å­˜å‘½ä¸­ç‡; å¯¹è±¡å¾ªç¯åˆ©ç”¨, é¿å…é¢‘ç¹ GC.")]),s._v(" "),t("li",[s._v("èƒ½å¤Ÿé¿å…ä¼ªå…±äº«, æå‡ç¼“å­˜åˆ©ç”¨ç‡.")]),s._v(" "),t("li",[s._v("é‡‡ç”¨"),t("strong",[s._v("æ— é”ç®—æ³•")]),s._v(", é¿å…é¢‘ç¹åŠ é”, è§£é”çš„æ€§èƒ½æ¶ˆè€—.")]),s._v(" "),t("li",[s._v("æ”¯æŒ"),t("strong",[s._v("æ‰¹é‡æ¶ˆè´¹")]),s._v(", æ¶ˆè´¹è€…å¯ä»¥æ— é”æ–¹å¼æ¶ˆè´¹å¤šä¸ªæ¶ˆæ¯.")])]),s._v(" "),t("p",[s._v("å…¶ä¸­, å‰ä¸‰ç‚¹æ¶‰åŠåˆ°çš„çŸ¥è¯†æ¯”è¾ƒå¤š, æ‰€ä»¥ä»Šå¤©é‡ç‚¹è®²è§£å‰ä¸‰ç‚¹, ä¸è¿‡åœ¨è¯¦ç»†ä»‹ç»è¿™äº›çŸ¥è¯†ä¹‹å‰, å…ˆæ¥èŠèŠ Disruptor å¦‚ä½•ä½¿ç”¨, å¥½è®©ä½ å…ˆå¯¹ Disruptor æœ‰ä¸ªæ„Ÿå®˜çš„è®¤è¯†.")]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ä»£ç å‡ºè‡ªå®˜æ–¹ç¤ºä¾‹, è¿™é‡Œç•¥åšäº†ä¸€äº›ä¿®æ”¹, ç›¸è¾ƒè€Œè¨€, Disruptor çš„ä½¿ç”¨æ¯” Java SDK æä¾› BlockingQueue è¦å¤æ‚ä¸€äº›, ä½†æ˜¯æ€»ä½“æ€è·¯è¿˜æ˜¯ä¸€è‡´çš„, å…¶å¤§è‡´æƒ…å†µå¦‚ä¸‹:")]),s._v(" "),t("ul",[t("li",[s._v("åœ¨ Disruptor ä¸­, "),t("strong",[s._v("ç”Ÿäº§è€…ç”Ÿäº§çš„å¯¹è±¡(ä¹Ÿå°±æ˜¯æ¶ˆè´¹è€…æ¶ˆè´¹çš„å¯¹è±¡)ç§°ä¸º Event, ä½¿ç”¨ Disruptor å¿…é¡»è‡ªå®šä¹‰ Event")]),s._v(", ä¾‹å¦‚ç¤ºä¾‹ä»£ç çš„è‡ªå®šä¹‰ Event æ˜¯ LongEvent;")]),s._v(" "),t("li",[s._v("æ„å»º Disruptor å¯¹è±¡é™¤äº†è¦æŒ‡å®šé˜Ÿåˆ—å¤§å°å¤–, è¿˜éœ€è¦ä¼ å…¥ä¸€ä¸ª "),t("strong",[s._v("EventFactory")]),s._v(", ç¤ºä¾‹ä»£ç ä¸­ä¼ å…¥çš„æ˜¯"),t("code",[s._v("LongEvent::new")]),s._v("â€‹;")]),s._v(" "),t("li",[t("strong",[s._v("æ¶ˆè´¹ Disruptor ä¸­çš„ Event éœ€è¦é€šè¿‡ handleEventsWith() æ–¹æ³•æ³¨å†Œä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨, å‘å¸ƒ Event åˆ™éœ€è¦é€šè¿‡ publishEvent() æ–¹æ³•")]),s._v(".")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è‡ªå®šä¹‰ Event")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongEvent")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‡å®š RingBuffer å¤§å°,")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¿…é¡»æ˜¯ 2 çš„ N æ¬¡æ–¹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" bufferSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„å»º Disruptor")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Disruptor")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" disruptor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Disruptor")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongEvent")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        bufferSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DaemonThreadFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INSTANCE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ³¨å†Œäº‹ä»¶å¤„ç†å™¨")]),s._v("\ndisruptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleEventsWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sequence"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" endOfBatch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"E: "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨ Disruptor")]),s._v("\ndisruptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å– RingBuffer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RingBuffer")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ringBuffer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" disruptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRingBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”Ÿäº§ Event")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" bb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("allocate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" l "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    bb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("putLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯")]),s._v("\n    ringBuffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("publishEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sequence"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("\n                    event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("h5",{attrs:{id:"ringbufferå¦‚ä½•æå‡æ€§èƒ½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ringbufferå¦‚ä½•æå‡æ€§èƒ½"}},[s._v("#")]),s._v(" RingBufferå¦‚ä½•æå‡æ€§èƒ½")]),s._v(" "),t("p",[s._v("Java SDK ä¸­ ArrayBlockingQueue ä½¿ç”¨"),t("strong",[s._v("æ•°ç»„")]),s._v("ä½œä¸ºåº•å±‚çš„æ•°æ®å­˜å‚¨, è€Œ Disruptor æ˜¯ä½¿ç”¨ "),t("strong",[s._v("RingBuffer")]),s._v(" ä½œä¸ºæ•°æ®å­˜å‚¨. RingBuffer æœ¬è´¨ä¸Šä¹Ÿæ˜¯æ•°ç»„, æ‰€ä»¥ä»…ä»…å°†æ•°æ®å­˜å‚¨ä»æ•°ç»„æ¢æˆ RingBuffer å¹¶ä¸èƒ½æå‡æ€§èƒ½, ä½†æ˜¯ Disruptor åœ¨ RingBuffer çš„åŸºç¡€ä¸Šè¿˜åšäº†å¾ˆå¤šä¼˜åŒ–, å…¶ä¸­ä¸€é¡¹ä¼˜åŒ–å°±æ˜¯å’Œ"),t("strong",[s._v("å†…å­˜åˆ†é…")]),s._v("æœ‰å…³çš„.")]),s._v(" "),t("p",[s._v("åœ¨ä»‹ç»è¿™é¡¹ä¼˜åŒ–ä¹‹å‰, éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ç¨‹åºçš„å±€éƒ¨æ€§åŸç†. ç®€å•æ¥è®², "),t("strong",[s._v("ç¨‹åºçš„å±€éƒ¨æ€§åŸç†æŒ‡çš„æ˜¯åœ¨ä¸€æ®µæ—¶é—´å†…ç¨‹åºçš„æ‰§è¡Œä¼šé™å®šåœ¨ä¸€ä¸ªå±€éƒ¨èŒƒå›´å†…")]),s._v('. è¿™é‡Œçš„ "å±€éƒ¨æ€§" å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢æ¥ç†è§£, ä¸€ä¸ªæ˜¯æ—¶é—´å±€éƒ¨æ€§, å¦ä¸€ä¸ªæ˜¯ç©ºé—´å±€éƒ¨æ€§. '),t("strong",[s._v("æ—¶é—´å±€éƒ¨æ€§")]),s._v("æŒ‡çš„æ˜¯ç¨‹åºä¸­çš„æŸæ¡æŒ‡ä»¤ä¸€æ—¦è¢«æ‰§è¡Œ, ä¸ä¹…ä¹‹åè¿™æ¡æŒ‡ä»¤å¾ˆå¯èƒ½å†æ¬¡è¢«æ‰§è¡Œ; å¦‚æœæŸæ¡æ•°æ®è¢«è®¿é—®, ä¸ä¹…ä¹‹åè¿™æ¡æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è¢«è®¿é—®. è€Œ"),t("strong",[s._v("ç©ºé—´å±€éƒ¨æ€§")]),s._v("æ˜¯æŒ‡æŸå—å†…å­˜ä¸€æ—¦è¢«è®¿é—®, ä¸ä¹…ä¹‹åè¿™å—å†…å­˜é™„è¿‘çš„å†…å­˜ä¹Ÿå¾ˆå¯èƒ½è¢«è®¿é—®.")]),s._v(" "),t("p",[s._v("CPU çš„ç¼“å­˜å°±åˆ©ç”¨äº†ç¨‹åºçš„å±€éƒ¨æ€§åŸç†: CPU ä»å†…å­˜ä¸­åŠ è½½æ•°æ® X æ—¶, ä¼šå°†æ•°æ® X ç¼“å­˜åœ¨é«˜é€Ÿç¼“å­˜ Cache ä¸­, å®é™…ä¸Š CPU ç¼“å­˜ X çš„åŒæ—¶, è¿˜ç¼“å­˜äº† X å‘¨å›´çš„æ•°æ®, å› ä¸ºæ ¹æ®ç¨‹åºå…·å¤‡å±€éƒ¨æ€§åŸç†, X å‘¨å›´çš„æ•°æ®ä¹Ÿå¾ˆæœ‰å¯èƒ½è¢«è®¿é—®. ä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥çœ‹, å¦‚æœç¨‹åºèƒ½å¤Ÿå¾ˆå¥½åœ°ä½“ç°å‡ºå±€éƒ¨æ€§åŸç†, ä¹Ÿå°±èƒ½æ›´å¥½åœ°åˆ©ç”¨ CPU çš„ç¼“å­˜, ä»è€Œæå‡ç¨‹åºçš„æ€§èƒ½. Disruptor åœ¨è®¾è®¡ RingBuffer çš„æ—¶å€™å°±å……åˆ†è€ƒè™‘äº†è¿™ä¸ªé—®é¢˜, ä¸‹é¢å°±å¯¹æ¯”ç€ ArrayBlockingQueue æ¥åˆ†æä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("é¦–å…ˆæ˜¯ ArrayBlockingQueue. ç”Ÿäº§è€…çº¿ç¨‹å‘ ArrayBlockingQueue å¢åŠ ä¸€ä¸ªå…ƒç´ , æ¯æ¬¡å¢åŠ å…ƒç´  E ä¹‹å‰, éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡ E, å¦‚ä¸‹å›¾æ‰€ç¤º, ArrayBlockingQueue å†…éƒ¨æœ‰ 6 ä¸ªå…ƒç´ , è¿™ 6 ä¸ªå…ƒç´ éƒ½æ˜¯ç”±ç”Ÿäº§è€…çº¿ç¨‹åˆ›å»ºçš„, ç”±äºåˆ›å»ºè¿™äº›å…ƒç´ çš„æ—¶é—´åŸºæœ¬ä¸Šæ˜¯ç¦»æ•£çš„, æ‰€ä»¥"),t("strong",[s._v("è¿™äº›å…ƒç´ çš„å†…å­˜åœ°å€å¤§æ¦‚ç‡ä¹Ÿä¸æ˜¯è¿ç»­")]),s._v("çš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/84d6e8357b51c15316082da59a790a39-20230731162452-5spvmm0.png",alt:"",title:"ArrayBlockingQueue å†…éƒ¨ç»“æ„å›¾"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢å†çœ‹çœ‹ Disruptor æ˜¯å¦‚ä½•å¤„ç†çš„. Disruptor å†…éƒ¨çš„ RingBuffer ä¹Ÿæ˜¯ç”¨æ•°ç»„å®ç°çš„, "),t("mark",[t("strong",[s._v("ä½†æ˜¯è¿™ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ åœ¨åˆå§‹åŒ–æ—¶æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨åˆ›å»ºçš„, æ‰€ä»¥è¿™äº›å…ƒç´ çš„å†…å­˜åœ°å€å¤§æ¦‚ç‡æ˜¯è¿ç»­çš„")])]),s._v(", ç›¸å…³çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" bufferSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// entries[] å°±æ˜¯ RingBuffer å†…éƒ¨çš„æ•°ç»„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// eventFactory å°±æ˜¯å‰é¢ç¤ºä¾‹ä»£ç ä¸­ä¼ å…¥çš„ LongEvent::new")]),s._v("\n    entries"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BUFFER_PAD")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" eventFactory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("Disruptor å†…éƒ¨ RingBuffer çš„ç»“æ„å¯ä»¥ç®€åŒ–æˆä¸‹å›¾, é‚£é—®é¢˜æ¥äº†, æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ å†…å­˜åœ°å€è¿ç»­èƒ½æå‡æ€§èƒ½å—? èƒ½! ä¸ºä»€ä¹ˆå‘¢? "),t("strong",[s._v("å› ä¸ºæ¶ˆè´¹è€…çº¿ç¨‹åœ¨æ¶ˆè´¹çš„æ—¶å€™, æ˜¯éµå¾ªç©ºé—´å±€éƒ¨æ€§åŸç†çš„, æ¶ˆè´¹å®Œç¬¬ 1 ä¸ªå…ƒç´ , å¾ˆå¿«å°±ä¼šæ¶ˆè´¹ç¬¬ 2 ä¸ªå…ƒç´ ; å½“æ¶ˆè´¹ç¬¬ 1 ä¸ªå…ƒç´  E1 çš„æ—¶å€™, CPU ä¼šæŠŠå†…å­˜ä¸­ E1 åé¢çš„æ•°æ®ä¹ŸåŠ è½½è¿› Cache, å¦‚æœ E1 å’Œ E2 åœ¨å†…å­˜ä¸­çš„åœ°å€æ˜¯è¿ç»­çš„, é‚£ä¹ˆ E2 ä¹Ÿå°±ä¼šè¢«åŠ è½½è¿› Cache ä¸­, ç„¶åå½“æ¶ˆè´¹ç¬¬ 2 ä¸ªå…ƒç´ çš„æ—¶å€™, ç”±äº E2 å·²ç»åœ¨ Cache ä¸­äº†, æ‰€ä»¥å°±ä¸éœ€è¦ä»å†…å­˜ä¸­åŠ è½½äº†, è¿™æ ·å°±èƒ½å¤§å¤§æå‡æ€§èƒ½")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cc8d72e6c1e319b3b9e555de3c5caaa9-20230731162452-q83hk2j.png",alt:"",title:"Disruptor å†…éƒ¨ RingBuffer ç»“æ„å›¾"}})]),s._v(" "),t("p",[s._v("é™¤æ­¤ä¹‹å¤–, åœ¨ Disruptor ä¸­, ç”Ÿäº§è€…çº¿ç¨‹é€šè¿‡ publishEvent() å‘å¸ƒ Event çš„æ—¶å€™, å¹¶ä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ Event, è€Œæ˜¯é€šè¿‡ event.set() æ–¹æ³•ä¿®æ”¹ Event, ä¹Ÿå°±æ˜¯è¯´ RingBuffer åˆ›å»ºçš„ Event æ˜¯å¯ä»¥"),t("strong",[s._v("å¾ªç¯åˆ©ç”¨")]),s._v("çš„, è¿™æ ·è¿˜èƒ½é¿å…é¢‘ç¹åˆ›å»º, åˆ é™¤ Event å¯¼è‡´çš„é¢‘ç¹ GC é—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"å¦‚ä½•é¿å…-ä¼ªå…±äº«"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•é¿å…-ä¼ªå…±äº«"}},[s._v("#")]),s._v(' å¦‚ä½•é¿å…"ä¼ªå…±äº«"')]),s._v(" "),t("p",[s._v("é«˜æ•ˆåˆ©ç”¨ Cache, èƒ½å¤Ÿå¤§å¤§æå‡æ€§èƒ½, æ‰€ä»¥è¦åŠªåŠ›æ„å»ºèƒ½å¤Ÿ"),t("strong",[s._v("é«˜æ•ˆåˆ©ç”¨ Cache çš„å†…å­˜ç»“æ„")]),s._v(". è€Œä»å¦å¤–ä¸€ä¸ªè§’åº¦çœ‹, åŠªåŠ›é¿å…ä¸èƒ½é«˜æ•ˆåˆ©ç”¨ Cache çš„å†…å­˜ç»“æ„ä¹ŸåŒæ ·é‡è¦.")]),s._v(" "),t("p",[s._v('æœ‰ä¸€ç§å«åš "ä¼ªå…±äº«(False sharing)" çš„å†…å­˜å¸ƒå±€å°±ä¼šä½¿ Cache å¤±æ•ˆ, é‚£ä»€ä¹ˆæ˜¯ "ä¼ªå…±äº«" å‘¢?')]),s._v(" "),t("p",[s._v("ä¼ªå…±äº«å’Œ CPU å†…éƒ¨çš„ Cache æœ‰å…³, Cache å†…éƒ¨æ˜¯æŒ‰ç…§"),t("strong",[s._v("ç¼“å­˜è¡Œ")]),s._v("(Cache Line)ç®¡ç†çš„, ç¼“å­˜è¡Œçš„å¤§å°é€šå¸¸æ˜¯ 64 ä¸ªå­—èŠ‚; CPU ä»å†…å­˜ä¸­åŠ è½½æ•°æ® X, ä¼šåŒæ—¶åŠ è½½ X åé¢(64-size(X))ä¸ªå­—èŠ‚çš„æ•°æ®. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å‡ºè‡ª Java SDK çš„ ArrayBlockingQueue, å…¶å†…éƒ¨ç»´æŠ¤äº† 4 ä¸ªæˆå‘˜å˜é‡, åˆ†åˆ«æ˜¯é˜Ÿåˆ—æ•°ç»„ items, å‡ºé˜Ÿç´¢å¼• takeIndex, å…¥é˜Ÿç´¢å¼• putIndex ä»¥åŠé˜Ÿåˆ—ä¸­çš„å…ƒç´ æ€»æ•° count.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** é˜Ÿåˆ—æ•°ç»„ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" items"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** å‡ºé˜Ÿç´¢å¼• */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" takeIndex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** å…¥é˜Ÿç´¢å¼• */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" putIndex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** é˜Ÿåˆ—ä¸­å…ƒç´ æ€»æ•° */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("å½“ CPU ä»å†…å­˜ä¸­åŠ è½½ takeIndex çš„æ—¶å€™, ä¼šåŒæ—¶å°† putIndex ä»¥åŠ count éƒ½åŠ è½½è¿› Cache. ä¸‹å›¾æ˜¯æŸä¸ªæ—¶åˆ» CPU ä¸­ Cache çš„çŠ¶å†µ, ä¸ºäº†ç®€åŒ–, ç¼“å­˜è¡Œä¸­ä»…åˆ—å‡ºäº† takeIndex å’Œ putIndex.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ce695c16357fe49d3328775b2078d810-20230731162452-1ix6sno.png",alt:"",title:"CPU ç¼“å­˜ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("å‡è®¾çº¿ç¨‹ A è¿è¡Œåœ¨ CPU-1 ä¸Š, æ‰§è¡Œå…¥é˜Ÿæ“ä½œ, å…¥é˜Ÿæ“ä½œä¼šä¿®æ”¹ putIndex, è€Œä¿®æ”¹ putIndex ä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„æ‰€æœ‰æ ¸ä¸Šçš„ç¼“å­˜è¡Œå‡å¤±æ•ˆ; æ­¤æ—¶å‡è®¾è¿è¡Œåœ¨ CPU-2 ä¸Šçš„çº¿ç¨‹æ‰§è¡Œå‡ºé˜Ÿæ“ä½œ, å‡ºé˜Ÿæ“ä½œéœ€è¦è¯»å– takeIndex, ç”±äº takeIndex æ‰€åœ¨çš„ç¼“å­˜è¡Œ"),t("strong",[s._v("å·²ç»å¤±æ•ˆ")]),s._v(", æ‰€ä»¥ CPU-2 å¿…é¡»ä»å†…å­˜ä¸­é‡æ–°è¯»å–. å…¥é˜Ÿæ“ä½œæœ¬ä¸ä¼šä¿®æ”¹ takeIndex, ä½†æ˜¯ç”±äº takeIndex å’Œ putIndex å…±äº«çš„æ˜¯ä¸€ä¸ªç¼“å­˜è¡Œ, å°±å¯¼è‡´å‡ºé˜Ÿæ“ä½œä¸èƒ½å¾ˆå¥½åœ°åˆ©ç”¨ Cache, è¿™å…¶å®å°±æ˜¯"),t("strong",[s._v("ä¼ªå…±äº«")]),s._v(". ç®€å•æ¥è®², "),t("strong",[s._v("ä¼ªå…±äº«æŒ‡çš„æ˜¯ç”±äºå…±äº«ç¼“å­˜è¡Œå¯¼è‡´ç¼“å­˜æ— æ•ˆçš„åœºæ™¯")]),s._v(".")]),s._v(" "),t("p",[s._v("ArrayBlockingQueue çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œæ˜¯ç”¨é”æ¥ä¿è¯äº’æ–¥çš„, æ‰€ä»¥å…¥é˜Ÿå’Œå‡ºé˜Ÿä¸ä¼šåŒæ—¶å‘ç”Ÿ. å¦‚æœå…è®¸å…¥é˜Ÿå’Œå‡ºé˜ŸåŒæ—¶å‘ç”Ÿ, é‚£å°±ä¼šå¯¼è‡´çº¿ç¨‹ A å’Œçº¿ç¨‹ B äº‰ç”¨åŒä¸€ä¸ªç¼“å­˜è¡Œ, è¿™æ ·ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜. æ‰€ä»¥ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜, å¿…é¡»é¿å…ä¼ªå…±äº«, é‚£å¦‚ä½•é¿å…å‘¢?")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0b1b0428a2fc16e33291633e95e8819b-20230731162452-bysb6jx.png",alt:"",title:"CPU ç¼“å­˜å¤±æ•ˆç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("æ–¹æ¡ˆå¾ˆç®€å•, "),t("mark",[t("strong",[s._v("æ¯ä¸ªå˜é‡ç‹¬å ä¸€ä¸ªç¼“å­˜è¡Œ, ä¸å…±äº«ç¼“å­˜è¡Œ")])]),s._v("å°±å¯ä»¥äº†, å…·ä½“æŠ€æœ¯æ˜¯"),t("strong",[s._v("ç¼“å­˜è¡Œå¡«å……")]),s._v(". æ¯”å¦‚æƒ³è®© takeIndex ç‹¬å ä¸€ä¸ªç¼“å­˜è¡Œ, å¯ä»¥åœ¨ takeIndex çš„å‰åå„å¡«å…… 56 ä¸ªå­—èŠ‚, è¿™æ ·å°±ä¸€å®šèƒ½ä¿è¯ takeIndex ç‹¬å ä¸€ä¸ªç¼“å­˜è¡Œ. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å‡ºè‡ª Disruptor, "),t("strong",[s._v("Sequence å¯¹è±¡ä¸­çš„ value å±æ€§å°±èƒ½é¿å…ä¼ªå…±äº«, å› ä¸ºè¿™ä¸ªå±æ€§å‰åéƒ½å¡«å……äº† 56 ä¸ªå­—èŠ‚")]),s._v(". Disruptor ä¸­å¾ˆå¤šå¯¹è±¡, ä¾‹å¦‚ RingBuffer, RingBuffer å†…éƒ¨çš„æ•°ç»„éƒ½ç”¨åˆ°äº†è¿™ç§å¡«å……æŠ€æœ¯æ¥é¿å…ä¼ªå…±äº«.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‰: å¡«å…… 56 å­—èŠ‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LhsPadding")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" p1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Value")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LhsPadding")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å: å¡«å…… 56 å­—èŠ‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RhsPadding")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" p9"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p13"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p14"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p15"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sequence")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RhsPadding")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çœç•¥å®ç°")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h5",{attrs:{id:"disruptorä¸­çš„æ— é”ç®—æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#disruptorä¸­çš„æ— é”ç®—æ³•"}},[s._v("#")]),s._v(" Disruptorä¸­çš„æ— é”ç®—æ³•")]),s._v(" "),t("p",[s._v("ArrayBlockingQueue æ˜¯åˆ©ç”¨ç®¡ç¨‹å®ç°çš„, ä¸­è§„ä¸­çŸ©, ç”Ÿäº§, æ¶ˆè´¹æ“ä½œéƒ½éœ€è¦åŠ é”, å®ç°èµ·æ¥ç®€å•, ä½†æ˜¯æ€§èƒ½å¹¶ä¸ååˆ†ç†æƒ³. Disruptor é‡‡ç”¨çš„æ˜¯æ— é”ç®—æ³•, å¾ˆå¤æ‚, ä½†æ˜¯æ ¸å¿ƒæ— éæ˜¯ç”Ÿäº§å’Œæ¶ˆè´¹ä¸¤ä¸ªæ“ä½œ. Disruptor ä¸­æœ€å¤æ‚çš„æ˜¯å…¥é˜Ÿæ“ä½œ, æ‰€ä»¥é‡ç‚¹æ¥çœ‹çœ‹å…¥é˜Ÿæ“ä½œæ˜¯å¦‚ä½•å®ç°çš„.")]),s._v(" "),t("p",[s._v("å¯¹äºå…¥é˜Ÿæ“ä½œ, æœ€å…³é”®çš„è¦æ±‚æ˜¯"),t("strong",[s._v("ä¸èƒ½è¦†ç›–æ²¡æœ‰æ¶ˆè´¹çš„å…ƒç´ ")]),s._v("; å¯¹äºå‡ºé˜Ÿæ“ä½œ, æœ€å…³é”®çš„è¦æ±‚æ˜¯"),t("strong",[s._v("ä¸èƒ½è¯»å–æ²¡æœ‰å†™å…¥çš„å…ƒç´ ")]),s._v(", æ‰€ä»¥ Disruptor ä¸­ä¹Ÿä¸€å®šä¼šç»´æŠ¤ç±»ä¼¼å‡ºé˜Ÿç´¢å¼•å’Œå…¥é˜Ÿç´¢å¼•è¿™æ ·ä¸¤ä¸ªå…³é”®å˜é‡. Disruptor ä¸­çš„ RingBuffer ç»´æŠ¤äº†å…¥é˜Ÿç´¢å¼•, ä½†æ˜¯å¹¶æ²¡æœ‰ç»´æŠ¤å‡ºé˜Ÿç´¢å¼•, è¿™æ˜¯å› ä¸ºåœ¨ Disruptor ä¸­å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥åŒæ—¶æ¶ˆè´¹, æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæœ‰ä¸€ä¸ªå‡ºé˜Ÿç´¢å¼•, æ‰€ä»¥ RingBuffer çš„å‡ºé˜Ÿç´¢å¼•æ˜¯æ‰€æœ‰æ¶ˆè´¹è€…é‡Œé¢"),t("strong",[s._v("æœ€å°çš„é‚£ä¸€ä¸ª")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ˜¯ Disruptor ç”Ÿäº§è€…å…¥é˜Ÿæ“ä½œçš„æ ¸å¿ƒä»£ç , çœ‹ä¸Šå»å¾ˆå¤æ‚, å…¶å®é€»è¾‘å¾ˆç®€å•: å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„ç©ºä½™ä½ç½®, å°±å‡ºè®© CPU ä½¿ç”¨æƒ, ç„¶åé‡æ–°è®¡ç®—; åä¹‹åˆ™ç”¨ CAS è®¾ç½®å…¥é˜Ÿç´¢å¼•.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”Ÿäº§è€…è·å– n ä¸ªå†™å…¥ä½ç½®")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//cursor ç±»ä¼¼äºå…¥é˜Ÿç´¢å¼•, æŒ‡çš„æ˜¯ä¸Šæ¬¡ç”Ÿäº§åˆ°è¿™é‡Œ")]),s._v("\n    current "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cursor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç›®æ ‡æ˜¯åœ¨ç”Ÿäº§ n ä¸ª")]),s._v("\n    next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" current "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‡æ‰ä¸€ä¸ªå¾ªç¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" wrapPoint "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" bufferSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–ä¸Šä¸€æ¬¡çš„æœ€å°æ¶ˆè´¹ä½ç½®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" cachedGatingSequence "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" gatingSequenceCache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ²¡æœ‰è¶³å¤Ÿçš„ç©ºä½™ä½ç½®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wrapPoint "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" cachedGatingSequence "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" cachedGatingSequence "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" current"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡æ–°è®¡ç®—æ‰€æœ‰æ¶ˆè´¹è€…é‡Œé¢çš„æœ€å°å€¼ä½ç½®")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" gatingSequence "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Util")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMinimumSequence")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gatingSequences"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" current"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»ç„¶æ²¡æœ‰è¶³å¤Ÿçš„ç©ºä½™ä½ç½®, å‡ºè®© CPU ä½¿ç”¨æƒ, é‡æ–°æ‰§è¡Œä¸‹ä¸€å¾ªç¯")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wrapPoint "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" gatingSequence"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LockSupport")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parkNanos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»æ–°è®¾ç½®ä¸Šä¸€æ¬¡çš„æœ€å°æ¶ˆè´¹ä½ç½®")]),s._v("\n        gatingSequenceCache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gatingSequence"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cursor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å†™å…¥ä½ç½®æˆåŠŸ, è·³å‡ºå¾ªç¯")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-31"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-31"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Disruptor åœ¨ä¼˜åŒ–å¹¶å‘æ€§èƒ½æ–¹é¢å¯è°“æ˜¯åšåˆ°äº†æè‡´, ä¼˜åŒ–çš„æ€è·¯å¤§ä½“æ˜¯ä¸¤ä¸ªæ–¹é¢, "),t("strong",[s._v("ä¸€ä¸ªæ˜¯åˆ©ç”¨æ— é”ç®—æ³•é¿å…é”çš„äº‰ç”¨, å¦å¤–ä¸€ä¸ªåˆ™æ˜¯å°†ç¡¬ä»¶(CPU)çš„æ€§èƒ½å‘æŒ¥åˆ°æè‡´")]),s._v(". å°¤å…¶æ˜¯åè€…, åœ¨ Java é¢†åŸŸåŸºæœ¬ä¸Šå±äºç»å…¸ä¹‹ä½œäº†.")]),s._v(" "),t("p",[s._v("å‘æŒ¥ç¡¬ä»¶çš„èƒ½åŠ›ä¸€èˆ¬æ˜¯ C è¿™ç§é¢å‘ç¡¬ä»¶çš„è¯­è¨€å¸¸å¹²çš„äº‹å„¿, C è¯­è¨€é¢†åŸŸç»å¸¸é€šè¿‡è°ƒæ•´å†…å­˜å¸ƒå±€ä¼˜åŒ–å†…å­˜å ç”¨, è€Œ Java é¢†åŸŸåˆ™ç”¨çš„å¾ˆå°‘, åŸå› åœ¨äº Java å¯ä»¥æ™ºèƒ½åœ°ä¼˜åŒ–å†…å­˜å¸ƒå±€, å†…å­˜å¸ƒå±€å¯¹ Java ç¨‹åºå‘˜çš„é€æ˜çš„. è¿™ç§æ™ºèƒ½çš„ä¼˜åŒ–å¤§éƒ¨åˆ†åœºæ™¯æ˜¯å¾ˆå‹å¥½çš„, ä½†æ˜¯å¦‚æœæƒ³é€šè¿‡å¡«å……æ–¹å¼é¿å…ä¼ªå…±äº«å°±å¿…é¡»ç»•è¿‡è¿™ç§ä¼˜åŒ–, å…³äºè¿™æ–¹é¢ Disruptor æä¾›äº†ç»å…¸çš„å®ç°, ä½ å¯ä»¥å‚è€ƒ.")]),s._v(" "),t("h4",{attrs:{id:"_41-æ¡ˆä¾‹åˆ†æ-å››-é«˜æ€§èƒ½æ•°æ®åº“è¿æ¥æ± hikaricp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_41-æ¡ˆä¾‹åˆ†æ-å››-é«˜æ€§èƒ½æ•°æ®åº“è¿æ¥æ± hikaricp"}},[s._v("#")]),s._v(" 41-æ¡ˆä¾‹åˆ†æ(å››):é«˜æ€§èƒ½æ•°æ®åº“è¿æ¥æ± HiKariCP")]),s._v(" "),t("p",[s._v("å®é™…å·¥ä½œä¸­, æ€»ä¼šéš¾å…å’Œæ•°æ®åº“æ‰“äº¤é“; åªè¦å’Œæ•°æ®åº“æ‰“äº¤é“, å°±å…ä¸äº†ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± . ä¸šç•ŒçŸ¥åçš„æ•°æ®åº“è¿æ¥æ± æœ‰ä¸å°‘, ä¾‹å¦‚ c3p0, DBCP, Tomcat JDBC Connection Pool, Druid ç­‰, ä¸è¿‡æœ€è¿‘å¤§ç«çš„æ˜¯ HiKariCP.")]),s._v(" "),t("p",[t("strong",[s._v("HiKariCP å·ç§°æ˜¯ä¸šç•Œè·‘å¾—æœ€å¿«çš„æ•°æ®åº“è¿æ¥æ± ")]),s._v(", è¿™ä¸¤å¹´å‘å±•å¾—é¡ºé£é¡ºæ°´, å°¤å…¶æ˜¯ Springboot 2.0 å°†å…¶ä½œä¸º"),t("strong",[s._v("é»˜è®¤æ•°æ®åº“è¿æ¥æ± ")]),s._v("å, æ±Ÿæ¹–ä¸€å“¥çš„åœ°ä½å·²æ˜¯æ¯‹åº¸ç½®ç–‘äº†. é‚£å®ƒä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«å‘¢? ä»Šå¤©å°±é‡ç‚¹èŠèŠè¿™ä¸ªè¯é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± "}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± ")]),s._v(" "),t("p",[s._v("åœ¨è¯¦ç»†åˆ†æ HiKariCP é«˜æ€§èƒ½ä¹‹å‰, æœ‰å¿…è¦å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± . æœ¬è´¨ä¸Š, æ•°æ®åº“è¿æ¥æ± å’Œçº¿ç¨‹æ± ä¸€æ ·, éƒ½å±äº"),t("strong",[s._v("æ± åŒ–èµ„æº")]),s._v(", ä½œç”¨éƒ½æ˜¯"),t("strong",[s._v("é¿å…é‡é‡çº§èµ„æºçš„é¢‘ç¹åˆ›å»ºå’Œé”€æ¯, å¯¹äºæ•°æ®åº“è¿æ¥æ± æ¥è¯´, ä¹Ÿå°±æ˜¯é¿å…æ•°æ®åº“è¿æ¥é¢‘ç¹åˆ›å»ºå’Œé”€æ¯")]),s._v(". å¦‚ä¸‹å›¾æ‰€ç¤º, æœåŠ¡ç«¯ä¼šåœ¨"),t("strong",[s._v("è¿è¡ŒæœŸæŒæœ‰ä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥, å½“éœ€è¦æ‰§è¡Œ SQL æ—¶, å¹¶ä¸æ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥, è€Œæ˜¯ä»è¿æ¥æ± ä¸­è·å–ä¸€ä¸ª; å½“ SQL æ‰§è¡Œå®Œ, ä¹Ÿå¹¶ä¸æ˜¯å°†æ•°æ®åº“è¿æ¥çœŸçš„å…³æ‰, è€Œæ˜¯å°†å…¶å½’è¿˜åˆ°è¿æ¥æ± ä¸­")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4e6a5f30f0a40628f5abd1690328c9da-20230731162452-rkvwrks.png",alt:"",title:"æ•°æ®åº“è¿æ¥æ± ç¤ºæ„å›¾"}})]),s._v(" "),t("p",[s._v("åœ¨å®é™…å·¥ä½œä¸­, éƒ½æ˜¯ä½¿ç”¨å„ç§æŒä¹…åŒ–æ¡†æ¶æ¥å®Œæˆæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥, åŸºæœ¬ä¸Šä¸ä¼šç›´æ¥å’Œæ•°æ®åº“è¿æ¥æ± æ‰“äº¤é“, ä¸ºäº†èƒ½æ›´å¥½åœ°ç†è§£æ•°æ®åº“è¿æ¥æ± çš„å·¥ä½œåŸç†, ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•æ¡†æ¶, è€Œæ˜¯åŸç”Ÿåœ°ä½¿ç”¨ HiKariCP. æ‰§è¡Œæ•°æ®åº“æ“ä½œåŸºæœ¬ä¸Šæ˜¯ä¸€ç³»åˆ—è§„èŒƒåŒ–çš„æ­¥éª¤:")]),s._v(" "),t("ol",[t("li",[s._v("é€šè¿‡æ•°æ®æºè·å–ä¸€ä¸ªæ•°æ®åº“è¿æ¥;")]),s._v(" "),t("li",[s._v("åˆ›å»º Statement;")]),s._v(" "),t("li",[s._v("æ‰§è¡Œ SQL;")]),s._v(" "),t("li",[s._v("é€šè¿‡ ResultSet è·å– SQL æ‰§è¡Œç»“æœ;")]),s._v(" "),t("li",[s._v("é‡Šæ”¾ ResultSet;")]),s._v(" "),t("li",[s._v("é‡Šæ”¾ Statement;")]),s._v(" "),t("li",[s._v("é‡Šæ”¾æ•°æ®åº“è¿æ¥.")])]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç , é€šè¿‡ "),t("code",[s._v("ds.getConnection()")]),s._v("â€‹ è·å–ä¸€ä¸ª"),t("strong",[s._v("æ•°æ®åº“è¿æ¥")]),s._v("æ—¶, å…¶å®æ˜¯å‘æ•°æ®åº“è¿æ¥æ± "),t("strong",[s._v("ç”³è¯·")]),s._v("ä¸€ä¸ªæ•°æ®åº“è¿æ¥, è€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“è¿æ¥. åŒæ ·, é€šè¿‡ "),t("code",[s._v("conn.close()")]),s._v("â€‹ é‡Šæ”¾ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ—¶, ä¹Ÿä¸æ˜¯ç›´æ¥å°†è¿æ¥å…³é—­, è€Œæ˜¯å°†è¿æ¥"),t("strong",[s._v("å½’è¿˜")]),s._v("ç»™æ•°æ®åº“è¿æ¥æ± .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ•°æ®åº“è¿æ¥æ± é…ç½®")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HikariConfig")]),s._v(" config "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HikariConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMinimumIdle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaximumPoolSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConnectionTestQuery")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SELECT 1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDataSourceClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.h2.jdbcx.JdbcDataSource"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addDataSourceProperty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jdbc:h2:mem:test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºæ•°æ®æº")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DataSource")]),s._v(" ds "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HikariDataSource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connection")]),s._v(" conn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Statement")]),s._v(" stmt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResultSet")]),s._v(" rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–æ•°æ®åº“è¿æ¥")]),s._v("\n    conn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º Statement ")]),s._v("\n    stmt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createStatement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œ SQL")]),s._v("\n    rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" stmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("executeQuery")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"select * from abc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–ç»“æœ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ......")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­ ResultSet")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­ Statement ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­ Connection")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­èµ„æº")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" close "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AutoCloseable")]),s._v(" rs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            rs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SQLException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://github.com/brettwooldridge/HikariCP/wiki/Down-the-Rabbit-Hole",target:"_blank",rel:"noopener noreferrer"}},[s._v("HiKariCP å®˜æ–¹ç½‘ç«™"),t("OutboundLink")],1),s._v("è§£é‡Šäº†å…¶æ€§èƒ½ä¹‹æ‰€ä»¥å¦‚æ­¤ä¹‹é«˜çš„ç§˜å¯†. å¾®è§‚ä¸Š HiKariCP ç¨‹åºç¼–è¯‘å‡ºçš„å­—èŠ‚ç æ‰§è¡Œæ•ˆç‡æ›´é«˜, ç«™åœ¨å­—èŠ‚ç çš„è§’åº¦å»ä¼˜åŒ– Java ä»£ç , HiKariCP çš„ä½œè€…å¯¹æ€§èƒ½çš„æ‰§ç€å¯è§ä¸€æ–‘, ä¸è¿‡é—æ†¾çš„æ˜¯ä»–å¹¶æ²¡æœ‰è¯¦ç»†è§£é‡Šéƒ½åšäº†å“ªäº›ä¼˜åŒ–. è€Œå®è§‚ä¸Šä¸»è¦æ˜¯å’Œ"),t("strong",[s._v("ä¸¤ä¸ªæ•°æ®ç»“æ„")]),s._v("æœ‰å…³, ä¸€ä¸ªæ˜¯ "),t("strong",[s._v("FastList")]),s._v(", å¦ä¸€ä¸ªæ˜¯ "),t("strong",[s._v("ConcurrentBag")]),s._v(". ä¸‹é¢æ¥çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•æå‡ HiKariCP çš„æ€§èƒ½çš„.")]),s._v(" "),t("h5",{attrs:{id:"fastlistè§£å†³äº†å“ªäº›æ€§èƒ½é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastlistè§£å†³äº†å“ªäº›æ€§èƒ½é—®é¢˜"}},[s._v("#")]),s._v(" FastListè§£å†³äº†å“ªäº›æ€§èƒ½é—®é¢˜")]),s._v(" "),t("p",[s._v("æŒ‰ç…§è§„èŒƒæ­¥éª¤, æ‰§è¡Œå®Œæ•°æ®åº“æ“ä½œä¹‹å, éœ€è¦ä¾æ¬¡å…³é—­ ResultSet, Statement, Connection, ä½†æ˜¯æ€»æœ‰ç²—å¿ƒçš„åŒå­¦åªæ˜¯å…³é—­äº† Connection, è€Œå¿˜äº†å…³é—­ ResultSet å’Œ Statement. ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜, æœ€å¥½çš„åŠæ³•æ˜¯å½“å…³é—­ Connection æ—¶, èƒ½å¤Ÿ"),t("strong",[s._v("è‡ªåŠ¨å…³é—­ Statemen")]),s._v("t. ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡, Connection å°±éœ€è¦è·Ÿè¸ªåˆ›å»ºçš„ Statement, æœ€ç®€å•çš„åŠæ³•å°±æ˜¯å°†åˆ›å»ºçš„ Statement ä¿å­˜åœ¨æ•°ç»„ ArrayList é‡Œ, è¿™æ ·å½“å…³é—­ Connection çš„æ—¶å€™, å°±å¯ä»¥ä¾æ¬¡å°†æ•°ç»„ä¸­çš„æ‰€æœ‰ Statement å…³é—­.")]),s._v(" "),t("p",[s._v("HiKariCP è§‰å¾—ç”¨ ArrayList è¿˜æ˜¯å¤ªæ…¢, å½“é€šè¿‡ "),t("code",[s._v("conn.createStatement()")]),s._v(" åˆ›å»ºä¸€ä¸ª Statement æ—¶, éœ€è¦è°ƒç”¨ ArrayList çš„ add() æ–¹æ³•åŠ å…¥åˆ° ArrayList ä¸­, è¿™ä¸ªæ˜¯æ²¡æœ‰é—®é¢˜çš„; ä½†æ˜¯å½“é€šè¿‡ "),t("code",[s._v("stmt.close()")]),s._v(" å…³é—­ Statement çš„æ—¶å€™, éœ€è¦è°ƒç”¨ ArrayList çš„ remove() æ–¹æ³•æ¥å°†å…¶ä» ArrayList ä¸­åˆ é™¤, è¿™é‡Œæ˜¯æœ‰ä¼˜åŒ–ä½™åœ°çš„.")]),s._v(" "),t("p",[s._v("å‡è®¾ä¸€ä¸ª Connection ä¾æ¬¡åˆ›å»º 6 ä¸ª Statement, åˆ†åˆ«æ˜¯ S1, S2, S3, S4, S5, S6, æŒ‰ç…§æ­£å¸¸çš„ç¼–ç ä¹ æƒ¯, å…³é—­ Statement çš„é¡ºåºä¸€èˆ¬æ˜¯é€†åºçš„, å…³é—­çš„é¡ºåºæ˜¯: S6, S5, S4, S3, S2, S1, è€Œ ArrayList çš„ remove(Object o) æ–¹æ³•æ˜¯é¡ºåºéå†æŸ¥æ‰¾, é€†åºåˆ é™¤è€Œé¡ºåºæŸ¥æ‰¾, è¿™æ ·çš„æŸ¥æ‰¾æ•ˆç‡å°±å¤ªæ…¢äº†. å¦‚ä½•ä¼˜åŒ–å‘¢? å¾ˆç®€å•, ä¼˜åŒ–æˆé€†åºæŸ¥æ‰¾å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/27c29fa3eeeee1cb1efc2b9a763c2810-20230731162452-whwjv0q.png",alt:"",title:"é€†åºåˆ é™¤ç¤ºæ„å›¾"}}),s._v("â€‹")]),s._v(" "),t("p",[s._v("HiKariCP ä¸­çš„ FastList ç›¸å¯¹äº ArrayList çš„ä¸€ä¸ªä¼˜åŒ–ç‚¹å°±æ˜¯å°† "),t("code",[s._v("remove(Object element)")]),s._v("â€‹ æ–¹æ³•çš„"),t("strong",[s._v("æŸ¥æ‰¾é¡ºåºå˜æˆäº†é€†åºæŸ¥æ‰¾")]),s._v(". é™¤æ­¤ä¹‹å¤–, FastList è¿˜æœ‰å¦ä¸€ä¸ªä¼˜åŒ–ç‚¹, æ˜¯ "),t("code",[s._v("get(int index)")]),s._v("â€‹ æ–¹æ³•æ²¡æœ‰å¯¹ index å‚æ•°è¿›è¡Œè¶Šç•Œæ£€æŸ¥, HiKariCP èƒ½ä¿è¯"),t("strong",[s._v("ä¸ä¼šè¶Šç•Œ")]),s._v(", æ‰€ä»¥ä¸ç”¨æ¯æ¬¡éƒ½è¿›è¡Œè¶Šç•Œæ£€æŸ¥.")]),s._v(" "),t("p",[s._v("æ•´ä½“æ¥çœ‹, FastList çš„ä¼˜åŒ–ç‚¹è¿˜æ˜¯å¾ˆç®€å•çš„. ä¸‹é¢å†æ¥èŠèŠ HiKariCP ä¸­çš„å¦å¤–ä¸€ä¸ªæ•°æ®ç»“æ„ ConcurrentBag, çœ‹çœ‹å®ƒåˆæ˜¯å¦‚ä½•æå‡æ€§èƒ½çš„.")]),s._v(" "),t("h5",{attrs:{id:"concurrentbagè§£å†³äº†å“ªäº›æ€§èƒ½é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#concurrentbagè§£å†³äº†å“ªäº›æ€§èƒ½é—®é¢˜"}},[s._v("#")]),s._v(" ConcurrentBagè§£å†³äº†å“ªäº›æ€§èƒ½é—®é¢˜")]),s._v(" "),t("p",[s._v("å¦‚æœè‡ªå·±æ¥å®ç°ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± , æœ€ç®€å•çš„åŠæ³•å°±æ˜¯ç”¨"),t("strong",[s._v("ä¸¤ä¸ªé˜»å¡é˜Ÿåˆ—")]),s._v("æ¥å®ç°, ä¸€ä¸ª"),t("strong",[s._v("ç”¨äºä¿å­˜ç©ºé—²æ•°æ®åº“è¿æ¥çš„é˜Ÿåˆ— idle, å¦ä¸€ä¸ªç”¨äºä¿å­˜å¿™ç¢Œæ•°æ®åº“è¿æ¥çš„é˜Ÿåˆ— busy; è·å–è¿æ¥æ—¶å°†ç©ºé—²çš„æ•°æ®åº“è¿æ¥ä» idle é˜Ÿåˆ—ç§»åŠ¨åˆ° busy é˜Ÿåˆ—, è€Œå…³é—­è¿æ¥æ—¶å°†æ•°æ®åº“è¿æ¥ä» busy ç§»åŠ¨åˆ° idle")]),s._v(". è¿™ç§æ–¹æ¡ˆå°†å¹¶å‘é—®é¢˜å§”æ‰˜ç»™äº†é˜»å¡é˜Ÿåˆ—, å®ç°ç®€å•, ä½†æ˜¯æ€§èƒ½å¹¶ä¸æ˜¯å¾ˆç†æƒ³. å› ä¸º Java SDK ä¸­çš„é˜»å¡é˜Ÿåˆ—æ˜¯ç”¨"),t("strong",[s._v("é”")]),s._v("å®ç°çš„, è€Œé«˜å¹¶å‘åœºæ™¯ä¸‹é”çš„äº‰ç”¨å¯¹æ€§èƒ½å½±å“å¾ˆå¤§.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¿™ç¢Œé˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" busy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç©ºé—²é˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" idle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("HiKariCP å¹¶æ²¡æœ‰ä½¿ç”¨ Java SDK ä¸­çš„é˜»å¡é˜Ÿåˆ—, è€Œæ˜¯è‡ªå·±å®ç°äº†ä¸€ä¸ª"),t("strong",[s._v("å«åš ConcurrentBag çš„å¹¶å‘å®¹å™¨")]),s._v(". ConcurrentBag çš„è®¾è®¡æœ€åˆæºè‡ª "),t("code",[s._v("C#")]),s._v("â€‹, å®ƒçš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡æ˜¯"),t("strong",[s._v("ä½¿ç”¨ ThreadLocal é¿å…éƒ¨åˆ†å¹¶å‘é—®é¢˜")]),s._v(", ä¸è¿‡ HiKariCP ä¸­çš„ ConcurrentBag å¹¶æ²¡æœ‰å®Œå…¨å‚è€ƒ C# çš„å®ç°, ä¸‹é¢æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„.")]),s._v(" "),t("p",[s._v("ConcurrentBag ä¸­æœ€å…³é”®çš„å±æ€§æœ‰ 4 ä¸ª, åˆ†åˆ«æ˜¯: "),t("strong",[s._v("ç”¨äºå­˜å‚¨æ‰€æœ‰çš„æ•°æ®åº“è¿æ¥çš„å…±äº«é˜Ÿåˆ— sharedList, çº¿ç¨‹æœ¬åœ°å­˜å‚¨ threadList, ç­‰å¾…æ•°æ®åº“è¿æ¥çš„çº¿ç¨‹æ•° waiters ä»¥åŠåˆ†é…æ•°æ®åº“è¿æ¥çš„å·¥å…· handoffQueue")]),s._v(". å…¶ä¸­, handoffQueue ç”¨çš„æ˜¯ Java SDK æä¾›çš„ SynchronousQueue, SynchronousQueue ä¸»è¦ç”¨äºçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨äºå­˜å‚¨æ‰€æœ‰çš„æ•°æ®åº“è¿æ¥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CopyOnWriteArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" sharedList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹æœ¬åœ°å­˜å‚¨ä¸­çš„æ•°æ®åº“è¿æ¥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadLocal")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" threadList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾…æ•°æ®åº“è¿æ¥çš„çº¿ç¨‹æ•°")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),s._v(" waiters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ†é…æ•°æ®åº“è¿æ¥çš„å·¥å…·")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SynchronousQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" handoffQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("å½“çº¿ç¨‹æ± åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ—¶, é€šè¿‡è°ƒç”¨ ConcurrentBag çš„ add() æ–¹æ³•åŠ å…¥åˆ° ConcurrentBag ä¸­, ä¸‹é¢æ˜¯ add() æ–¹æ³•çš„å…·ä½“å®ç°, é€»è¾‘å¾ˆç®€å•, å°±æ˜¯å°†è¿™ä¸ªè¿æ¥åŠ å…¥åˆ°å…±äº«é˜Ÿåˆ— sharedList ä¸­, å¦‚æœæ­¤æ—¶æœ‰çº¿ç¨‹åœ¨ç­‰å¾…æ•°æ®åº“è¿æ¥, é‚£ä¹ˆå°±é€šè¿‡ handoffQueue å°†è¿™ä¸ªè¿æ¥åˆ†é…ç»™ç­‰å¾…çš„çº¿ç¨‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†ç©ºé—²è¿æ¥æ·»åŠ åˆ°é˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" add "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŠ å…¥å…±äº«é˜Ÿåˆ—")]),s._v("\n    sharedList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæœ‰ç­‰å¾…è¿æ¥çš„çº¿ç¨‹, ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ™é€šè¿‡ handoffQueue ç›´æ¥åˆ†é…ç»™ç­‰å¾…çš„çº¿ç¨‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("waiters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_NOT_IN_USE")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("handoffQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("offer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("é€šè¿‡ ConcurrentBag æä¾›çš„ borrow() æ–¹æ³•, "),t("strong",[s._v("å¯ä»¥è·å–ä¸€ä¸ªç©ºé—²çš„æ•°æ®åº“è¿æ¥")]),s._v(", borrow() çš„ä¸»è¦é€»è¾‘æ˜¯:")]),s._v(" "),t("ol",[t("li",[s._v("é¦–å…ˆæŸ¥çœ‹çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ˜¯å¦æœ‰ç©ºé—²è¿æ¥, å¦‚æœæœ‰, åˆ™è¿”å›ä¸€ä¸ªç©ºé—²çš„è¿æ¥;")]),s._v(" "),t("li",[s._v("å¦‚æœçº¿ç¨‹æœ¬åœ°å­˜å‚¨ä¸­æ— ç©ºé—²è¿æ¥, åˆ™ä»å…±äº«é˜Ÿåˆ—ä¸­è·å–.")]),s._v(" "),t("li",[s._v("å¦‚æœå…±äº«é˜Ÿåˆ—ä¸­ä¹Ÿæ²¡æœ‰ç©ºé—²çš„è¿æ¥, åˆ™è¯·æ±‚çº¿ç¨‹éœ€è¦ç­‰å¾….")])]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, çº¿ç¨‹æœ¬åœ°å­˜å‚¨ä¸­çš„è¿æ¥æ˜¯å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹çªƒå–çš„, æ‰€ä»¥éœ€è¦ç”¨ CAS æ–¹æ³•é˜²æ­¢é‡å¤åˆ†é…. åœ¨å…±äº«é˜Ÿåˆ—ä¸­è·å–ç©ºé—²è¿æ¥, ä¹Ÿé‡‡ç”¨äº† CAS æ–¹æ³•é˜²æ­¢é‡å¤åˆ†é….")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("borrow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" timeUnit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…ˆæŸ¥çœ‹çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ˜¯å¦æœ‰ç©ºé—²è¿æ¥")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" threadList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" entry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" bagEntry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" weakThreadLocals "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WeakReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" entry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" entry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹æœ¬åœ°å­˜å‚¨ä¸­çš„è¿æ¥ä¹Ÿå¯ä»¥è¢«çªƒå–, ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰€ä»¥éœ€è¦ç”¨ CAS æ–¹æ³•é˜²æ­¢é‡å¤åˆ†é…")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bagEntry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_NOT_IN_USE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_IN_USE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹æœ¬åœ°å­˜å‚¨ä¸­æ— ç©ºé—²è¿æ¥, åˆ™ä»å…±äº«é˜Ÿåˆ—ä¸­è·å–")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" waiting "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" waiters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" bagEntry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" sharedList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœå…±äº«é˜Ÿåˆ—ä¸­æœ‰ç©ºé—²è¿æ¥, åˆ™è¿”å›")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_NOT_IN_USE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_IN_USE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…±äº«é˜Ÿåˆ—ä¸­æ²¡æœ‰è¿æ¥, åˆ™éœ€è¦ç­‰å¾…")]),s._v("\n        timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timeUnit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toNanos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" bagEntry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" handoffQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NANOSECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bagEntry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_NOT_IN_USE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_IN_USE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡æ–°è®¡ç®—ç­‰å¾…æ—¶é—´")]),s._v("\n            timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("elapsedNanos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10_000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¶…æ—¶æ²¡æœ‰è·å–åˆ°è¿æ¥, è¿”å› null")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        waiters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("p",[t("strong",[s._v("é‡Šæ”¾è¿æ¥éœ€è¦è°ƒç”¨ ConcurrentBag æä¾›çš„ requite() æ–¹æ³•")]),s._v(", è¯¥æ–¹æ³•çš„é€»è¾‘å¾ˆç®€å•, é¦–å…ˆå°†æ•°æ®åº“è¿æ¥çŠ¶æ€æ›´æ”¹ä¸º STATE_NOT_IN_USE, ä¹‹åæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ç­‰å¾…çº¿ç¨‹, å¦‚æœæœ‰, åˆ™åˆ†é…ç»™ç­‰å¾…çº¿ç¨‹; å¦‚æœæ²¡æœ‰, åˆ™å°†è¯¥æ•°æ®åº“è¿æ¥ä¿å­˜åˆ°çº¿ç¨‹æœ¬åœ°å­˜å‚¨é‡Œ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾è¿æ¥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("requite")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ›´æ–°è¿æ¥çŠ¶æ€")]),s._v("\n    bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_NOT_IN_USE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæœ‰ç­‰å¾…çš„çº¿ç¨‹, åˆ™ç›´æ¥åˆ†é…ç»™çº¿ç¨‹, æ— éœ€è¿›å…¥ä»»ä½•é˜Ÿåˆ—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" waiters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATE_NOT_IN_USE")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" handoffQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("offer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xff")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xff")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parkNanos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MICROSECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toNanos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ²¡æœ‰ç­‰å¾…çš„çº¿ç¨‹, åˆ™è¿›å…¥çº¿ç¨‹æœ¬åœ°å­˜å‚¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" threadLocalList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" threadList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("threadLocalList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        threadLocalList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("weakThreadLocals\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WeakReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bagEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-32"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-32"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("HiKariCP ä¸­çš„ FastList å’Œ ConcurrentBag è¿™ä¸¤ä¸ªæ•°æ®ç»“æ„ä½¿ç”¨å¾—éå¸¸å·§å¦™, è™½ç„¶å®ç°èµ·æ¥å¹¶ä¸å¤æ‚, ä½†æ˜¯å¯¹äºæ€§èƒ½çš„æå‡éå¸¸æ˜æ˜¾, æ ¹æœ¬åŸå› åœ¨äºè¿™ä¸¤ä¸ªæ•°æ®ç»“æ„é€‚ç”¨äºæ•°æ®åº“è¿æ¥æ± è¿™ä¸ªç‰¹å®šçš„åœºæ™¯. "),t("strong",[s._v("FastList é€‚ç”¨äºé€†åºåˆ é™¤åœºæ™¯; è€Œ ConcurrentBag é€šè¿‡ ThreadLocal åšä¸€æ¬¡é¢„åˆ†é…, é¿å…ç›´æ¥ç«äº‰å…±äº«èµ„æº, éå¸¸é€‚åˆæ± åŒ–èµ„æºçš„åˆ†é…")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨å®é™…å·¥ä½œä¸­é‡åˆ°çš„å¹¶å‘é—®é¢˜åƒå·®ä¸‡åˆ«, è¿™æ—¶é€‰æ‹©åˆé€‚çš„å¹¶å‘æ•°æ®ç»“æ„å°±éå¸¸é‡è¦äº†. å½“ç„¶èƒ½é€‰å¯¹çš„å‰ææ˜¯å¯¹ç‰¹å®šåœºæ™¯çš„å¹¶å‘ç‰¹æ€§æœ‰æ·±å…¥çš„äº†è§£, åªæœ‰äº†è§£åˆ°æ— è°“çš„æ€§èƒ½æ¶ˆè€—åœ¨å“ªé‡Œ, æ‰èƒ½å¯¹ç—‡ä¸‹è¯.")]),s._v(" "),t("h3",{attrs:{id:"å…¶ä»–å¹¶å‘æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¶ä»–å¹¶å‘æ¨¡å‹"}},[s._v("#")]),s._v(" å…¶ä»–å¹¶å‘æ¨¡å‹")]),s._v(" "),t("h4",{attrs:{id:"_42-actoræ¨¡å‹-é¢å‘å¯¹è±¡åŸç”Ÿçš„å¹¶å‘æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_42-actoræ¨¡å‹-é¢å‘å¯¹è±¡åŸç”Ÿçš„å¹¶å‘æ¨¡å‹"}},[s._v("#")]),s._v(" 42-Actoræ¨¡å‹:é¢å‘å¯¹è±¡åŸç”Ÿçš„å¹¶å‘æ¨¡å‹")]),s._v(" "),t("p",[s._v("æŒ‰ç…§é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ç†è®º, å¯¹è±¡ä¹‹é—´é€šä¿¡éœ€è¦ä¾é "),t("strong",[s._v("æ¶ˆæ¯")]),s._v(", è€Œå®é™…ä¸Š, åƒ C++, Java è¿™äº›é¢å‘å¯¹è±¡çš„è¯­è¨€, å¯¹è±¡ä¹‹é—´é€šä¿¡, ä¾é çš„æ˜¯"),t("strong",[s._v("å¯¹è±¡æ–¹æ³•")]),s._v(". å¯¹è±¡æ–¹æ³•å’Œè¿‡ç¨‹è¯­è¨€é‡Œçš„å‡½æ•°æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«, æœ‰å…¥å‚, æœ‰å‡ºå‚, æ€ç»´æ–¹å¼å¾ˆç›¸ä¼¼, ä½¿ç”¨èµ·æ¥éƒ½å¾ˆç®€å•. é‚£é¢å‘å¯¹è±¡ç†è®ºé‡Œçš„æ¶ˆæ¯æ˜¯å¦å°±ç­‰ä»·äºé¢å‘å¯¹è±¡è¯­è¨€é‡Œçš„å¯¹è±¡æ–¹æ³•å‘¢? å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œ, æˆ‘éƒ½ä»¥ä¸ºå¯¹è±¡æ–¹æ³•æ˜¯é¢å‘å¯¹è±¡ç†è®ºä¸­æ¶ˆæ¯çš„ä¸€ç§å®ç°, ç›´åˆ°æ¥è§¦åˆ° Actor æ¨¡å‹, æ‰æ˜ç™½æ¶ˆæ¯å‹æ ¹ä¸æ˜¯è¿™ä¸ªå®ç°æ³•.")]),s._v(" "),t("h5",{attrs:{id:"hello-actoræ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hello-actoræ¨¡å‹"}},[s._v("#")]),s._v(" Hello Actoræ¨¡å‹")]),s._v(" "),t("p",[s._v("Actor æ¨¡å‹æœ¬è´¨ä¸Šæ˜¯ä¸€ç§"),t("strong",[s._v("è®¡ç®—æ¨¡å‹")]),s._v(", åŸºæœ¬çš„è®¡ç®—å•å…ƒç§°ä¸º Actor, æ¢è¨€ä¹‹, "),t("strong",[s._v("åœ¨ Actor æ¨¡å‹ä¸­, æ‰€æœ‰çš„è®¡ç®—éƒ½æ˜¯åœ¨ Actor ä¸­æ‰§è¡Œçš„")]),s._v(". åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹é‡Œé¢, ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡; "),t("strong",[s._v("åœ¨ Actor æ¨¡å‹é‡Œ, ä¸€åˆ‡éƒ½æ˜¯ Actor, å¹¶ä¸” Actor ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„, ä¸ä¼šå…±äº«ä»»ä½•å˜é‡")]),s._v(".")]),s._v(" "),t("p",[s._v('å½“çœ‹åˆ° "ä¸å…±äº«ä»»ä½•å˜é‡" çš„æ—¶å€™, ç›¸ä¿¡ä½ ä¸€å®šä¼šçœ¼å‰ä¸€äº®, å¹¶å‘é—®é¢˜çš„æ ¹æºå°±åœ¨äºå…±äº«å˜é‡, è€Œ Actor æ¨¡å‹ä¸­ Actor ä¹‹é—´ä¸å…±äº«å˜é‡, é‚£ç”¨ Actor æ¨¡å‹è§£å†³å¹¶å‘é—®é¢˜, ä¸€å®šæ˜¯ç›¸å½“é¡ºæ‰‹. çš„ç¡®æ˜¯è¿™æ ·, æ‰€ä»¥å¾ˆå¤šäººå°±æŠŠ Actor æ¨¡å‹å®šä¹‰ä¸ºä¸€ç§'),t("strong",[s._v("å¹¶å‘è®¡ç®—æ¨¡å‹")]),s._v(". å…¶å® Actor æ¨¡å‹æ—©åœ¨ 1973 å¹´å°±è¢«æå‡ºæ¥äº†, åªæ˜¯ç›´åˆ°æœ€è¿‘å‡ å¹´æ‰è¢«å¹¿æ³›å…³æ³¨, ä¸€ä¸ªä¸»è¦åŸå› å°±åœ¨äºå®ƒæ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„åˆ©å™¨, è€Œæœ€è¿‘å‡ å¹´éšç€å¤šæ ¸å¤„ç†å™¨çš„å‘å±•, å¹¶å‘é—®é¢˜è¢«æ¨åˆ°äº†é£å£æµªå°–ä¸Š.")]),s._v(" "),t("p",[t("strong",[s._v("ä½†æ˜¯ Java è¯­è¨€æœ¬èº«å¹¶ä¸æ”¯æŒ Actor æ¨¡å‹")]),s._v(", æ‰€ä»¥å¦‚æœæƒ³åœ¨ Java è¯­è¨€é‡Œä½¿ç”¨ Actor æ¨¡å‹, å°±éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹ç±»åº“, ç›®å‰èƒ½å®Œå¤‡åœ°æ”¯æŒ Actor æ¨¡å‹è€Œä¸”æ¯”è¾ƒæˆç†Ÿçš„ç±»åº“å°±æ˜¯ "),t("strong",[s._v("Akka")]),s._v(" äº†. åœ¨è¯¦ç»†ä»‹ç» Actor æ¨¡å‹ä¹‹å‰, å°±å…ˆåŸºäº Akka å†™ä¸€ä¸ª Hello World ç¨‹åº, è®©ä½ å¯¹ Actor æ¨¡å‹å…ˆæœ‰ä¸ªæ„Ÿå®˜çš„å°è±¡.")]),s._v(" "),t("p",[s._v('åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª ActorSystem(Actor ä¸èƒ½è„±ç¦» ActorSystem å­˜åœ¨); ä¹‹ååˆ›å»ºäº†ä¸€ä¸ª HelloActor, Akka ä¸­åˆ›å»º Actor å¹¶ä¸æ˜¯ new ä¸€ä¸ªå¯¹è±¡å‡ºæ¥, è€Œæ˜¯é€šè¿‡è°ƒç”¨ system.actorOf() æ–¹æ³•åˆ›å»ºçš„, è¯¥æ–¹æ³•è¿”å›çš„æ˜¯ ActorRef, è€Œä¸æ˜¯ HelloActor; æœ€åé€šè¿‡è°ƒç”¨ ActorRef çš„ tell() æ–¹æ³•ç»™ HelloActor å‘é€äº†ä¸€æ¡æ¶ˆæ¯ "Actor".')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯¥ Actor å½“æ”¶åˆ°æ¶ˆæ¯ message å, ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¼šæ‰“å° Hello message")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloActor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UntypedActor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onReceive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º Actor ç³»ç»Ÿ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorSystem")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorSystem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HelloSystem"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º HelloActor")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorRef")]),s._v(" helloActor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("actorOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Props")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloActor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘é€æ¶ˆæ¯ç»™ HelloActor")]),s._v("\n    helloActor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Actor"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("noSender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("é€šè¿‡è¿™ä¸ªä¾‹å­, ä½ ä¼šå‘ç° Actor æ¨¡å‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹å¥‘åˆåº¦éå¸¸é«˜, "),t("strong",[s._v("å®Œå…¨å¯ä»¥ç”¨ Actor ç±»æ¯”é¢å‘å¯¹è±¡ç¼–ç¨‹é‡Œé¢çš„å¯¹è±¡, è€Œä¸” Actor ä¹‹é—´çš„é€šä¿¡æ–¹å¼å®Œç¾åœ°éµå®ˆäº†æ¶ˆæ¯æœºåˆ¶, è€Œä¸æ˜¯é€šè¿‡å¯¹è±¡æ–¹æ³•æ¥å®ç°å¯¹è±¡ä¹‹é—´çš„é€šä¿¡")]),s._v(". é‚£ Actor ä¸­çš„æ¶ˆæ¯æœºåˆ¶å’Œé¢å‘å¯¹è±¡è¯­è¨€é‡Œçš„å¯¹è±¡æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?")]),s._v(" "),t("h5",{attrs:{id:"æ¶ˆæ¯å’Œå¯¹è±¡æ–¹æ³•çš„åŒºåˆ«"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¶ˆæ¯å’Œå¯¹è±¡æ–¹æ³•çš„åŒºåˆ«"}},[s._v("#")]),s._v(" æ¶ˆæ¯å’Œå¯¹è±¡æ–¹æ³•çš„åŒºåˆ«")]),s._v(" "),t("p",[s._v('åœ¨æ²¡æœ‰è®¡ç®—æœºçš„æ—¶ä»£, å¼‚åœ°çš„æœ‹å‹å¾€å¾€æ˜¯é€šè¿‡å†™ä¿¡æ¥äº¤æµæ„Ÿæƒ…çš„, ä½†ä¿¡ä»¶å‘å‡ºå»ä¹‹å, ä¹Ÿè®¸ä¼šåœ¨å¯„é€è¿‡ç¨‹ä¸­å¼„ä¸¢äº†, ä¹Ÿæœ‰å¯èƒ½å¯„åˆ°å, å¯¹æ–¹ä¸€ç›´æ²¡æœ‰æ—¶é—´å†™å›ä¿¡...è¿™ä¸ªæ—¶å€™éƒ½å¯ä»¥è®©é‚®å±€ "èƒŒä¸ªé”…", ä¸è¿‡æ— è®ºå¦‚ä½•, ä¹Ÿä¸è¿‡æ˜¯é‡å†™ä¸€å°, ç”Ÿæ´»ç»§ç»­.')]),s._v(" "),t("p",[s._v("Actor ä¸­çš„æ¶ˆæ¯æœºåˆ¶, å°±å¯ä»¥ç±»æ¯”è¿™ç°å®ä¸–ç•Œé‡Œçš„å†™ä¿¡. "),t("strong",[s._v("Actor å†…éƒ¨æœ‰ä¸€ä¸ªé‚®ç®±(Mailbox), æ¥æ”¶åˆ°çš„æ¶ˆæ¯éƒ½æ˜¯å…ˆæ”¾åˆ°é‚®ç®±é‡Œ, å¦‚æœé‚®ç®±é‡Œæœ‰ç§¯å‹çš„æ¶ˆæ¯, é‚£ä¹ˆæ–°æ”¶åˆ°çš„æ¶ˆæ¯å°±ä¸ä¼šé©¬ä¸Šå¾—åˆ°å¤„ç†, ä¹Ÿæ­£æ˜¯å› ä¸º Actor ä½¿ç”¨å•çº¿ç¨‹å¤„ç†æ¶ˆæ¯, æ‰€ä»¥ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜")]),s._v(". ä½ å¯ä»¥æŠŠ Actor å†…éƒ¨çš„å·¥ä½œæ¨¡å¼æƒ³è±¡æˆåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼.")]),s._v(" "),t("p",[s._v("æ‰€ä»¥, åœ¨ Actor æ¨¡å‹é‡Œ, å‘é€æ¶ˆæ¯ä»…ä»…æ˜¯æŠŠæ¶ˆæ¯å‘å‡ºå»è€Œå·², æ¥æ”¶æ¶ˆæ¯çš„ Actor åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯å, ä¹Ÿä¸ä¸€å®šä¼šç«‹å³å¤„ç†, ä¹Ÿå°±æ˜¯è¯´ "),t("strong",[s._v("Actor ä¸­çš„æ¶ˆæ¯æœºåˆ¶å®Œå…¨æ˜¯å¼‚æ­¥çš„")]),s._v(". è€Œ"),t("strong",[s._v("è°ƒç”¨å¯¹è±¡æ–¹æ³•")]),s._v(", å®é™…ä¸Šæ˜¯"),t("strong",[s._v("åŒæ­¥")]),s._v("çš„, å¯¹è±¡æ–¹æ³• return ä¹‹å‰, è°ƒç”¨æ–¹ä¼šä¸€ç›´ç­‰å¾….")]),s._v(" "),t("p",[s._v("é™¤æ­¤ä¹‹å¤–, "),t("strong",[s._v("è°ƒç”¨å¯¹è±¡æ–¹æ³•")]),s._v(", éœ€è¦æŒæœ‰å¯¹è±¡çš„å¼•ç”¨, "),t("strong",[s._v("æ‰€æœ‰çš„å¯¹è±¡å¿…é¡»åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­")]),s._v(". è€Œåœ¨ Actor ä¸­å‘é€æ¶ˆæ¯, ç±»ä¼¼äºç°å®ä¸­çš„å†™ä¿¡, åªéœ€è¦çŸ¥é“å¯¹æ–¹çš„åœ°å€å°±å¯ä»¥, "),t("strong",[s._v("å‘é€æ¶ˆæ¯å’Œæ¥æ”¶æ¶ˆæ¯çš„ Actor å¯ä»¥ä¸åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­, ä¹Ÿå¯ä»¥ä¸åœ¨åŒä¸€å°æœºå™¨ä¸Š")]),s._v(". å› æ­¤, Actor æ¨¡å‹"),t("strong",[s._v("ä¸ä½†é€‚ç”¨äºå¹¶å‘è®¡ç®—, è¿˜é€‚ç”¨äºåˆ†å¸ƒå¼è®¡ç®—")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"actorçš„è§„èŒƒåŒ–å®šä¹‰"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#actorçš„è§„èŒƒåŒ–å®šä¹‰"}},[s._v("#")]),s._v(" Actorçš„è§„èŒƒåŒ–å®šä¹‰")]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šé¢çš„ä»‹ç», ç›¸ä¿¡ä½ åº”è¯¥å·²ç»å¯¹ Actor æœ‰ä¸€ä¸ªæ„Ÿå®˜å°è±¡äº†, ä¸‹é¢å†æ¥çœ‹çœ‹ Actor è§„èŒƒåŒ–çš„å®šä¹‰æ˜¯ä»€ä¹ˆæ ·çš„. Actor æ˜¯ä¸€ç§åŸºç¡€çš„è®¡ç®—å•å…ƒ, å…·ä½“æ¥è®²åŒ…æ‹¬ä¸‰éƒ¨åˆ†èƒ½åŠ›, åˆ†åˆ«æ˜¯:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å¤„ç†èƒ½åŠ›, å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("å­˜å‚¨èƒ½åŠ›, Actor å¯ä»¥å­˜å‚¨è‡ªå·±çš„å†…éƒ¨çŠ¶æ€, å¹¶ä¸”å†…éƒ¨çŠ¶æ€åœ¨ä¸åŒ Actor ä¹‹é—´æ˜¯ç»å¯¹éš”ç¦»çš„")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("é€šä¿¡èƒ½åŠ›, Actor å¯ä»¥å’Œå…¶ä»– Actor ä¹‹é—´é€šä¿¡")]),s._v(".")])]),s._v(" "),t("p",[s._v("å½“ä¸€ä¸ª Actor æ¥æ”¶çš„ä¸€æ¡æ¶ˆæ¯ä¹‹å, è¿™ä¸ª Actor å¯ä»¥åšä»¥ä¸‹ä¸‰ä»¶äº‹:")]),s._v(" "),t("ol",[t("li",[s._v("åˆ›å»ºæ›´å¤šçš„ Actor;")]),s._v(" "),t("li",[s._v("å‘æ¶ˆæ¯ç»™å…¶ä»– Actor;")]),s._v(" "),t("li",[s._v("ç¡®å®šå¦‚ä½•å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯.")])]),s._v(" "),t("p",[s._v("å…¶ä¸­å‰ä¸¤æ¡è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„, å°±æ˜¯æœ€åä¸€æ¡, è¯¥å¦‚ä½•å»ç†è§£å‘¢? å‰é¢è¯´è¿‡ Actor å…·å¤‡å­˜å‚¨èƒ½åŠ›, å®ƒæœ‰è‡ªå·±çš„å†…éƒ¨çŠ¶æ€, æ‰€ä»¥ä¹Ÿå¯ä»¥æŠŠ Actor çœ‹ä½œä¸€ä¸ª"),t("strong",[s._v("çŠ¶æ€æœº")]),s._v(", æŠŠ Actor "),t("strong",[s._v("å¤„ç†æ¶ˆæ¯çœ‹ä½œæ˜¯è§¦å‘çŠ¶æ€æœºçš„çŠ¶æ€å˜åŒ–")]),s._v("; è€ŒçŠ¶æ€æœºçš„å˜åŒ–å¾€å¾€è¦åŸºäºä¸Šä¸€ä¸ªçŠ¶æ€, è§¦å‘çŠ¶æ€æœºå‘ç”Ÿå˜åŒ–çš„æ—¶åˆ», ä¸Šä¸€ä¸ªçŠ¶æ€å¿…é¡»æ˜¯ç¡®å®šçš„, æ‰€ä»¥ç¡®å®šå¦‚ä½•å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯, æœ¬è´¨ä¸Šä¸è¿‡æ˜¯æ”¹å˜å†…éƒ¨çŠ¶æ€.")]),s._v(" "),t("p",[s._v("åœ¨å¤šçº¿ç¨‹é‡Œé¢, ç”±äºå¯èƒ½å­˜åœ¨ç«æ€æ¡ä»¶, æ‰€ä»¥æ ¹æ®å½“å‰çŠ¶æ€ç¡®å®šå¦‚ä½•å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯è¿˜æ˜¯æœ‰éš¾åº¦çš„, éœ€è¦ä½¿ç”¨å„ç§åŒæ­¥å·¥å…·, ä½†åœ¨ Actor æ¨¡å‹é‡Œ, ç”±äºæ˜¯"),t("strong",[s._v("å•çº¿ç¨‹å¤„ç†, æ‰€ä»¥å°±ä¸å­˜åœ¨ç«æ€æ¡ä»¶é—®é¢˜")]),s._v("äº†.")]),s._v(" "),t("h5",{attrs:{id:"ç”¨actorå®ç°ç´¯åŠ å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨actorå®ç°ç´¯åŠ å™¨"}},[s._v("#")]),s._v(" ç”¨Actorå®ç°ç´¯åŠ å™¨")]),s._v(" "),t("p",[s._v("æ”¯æŒå¹¶å‘çš„ç´¯åŠ å™¨å¯èƒ½æ˜¯æœ€ç®€å•å¹¶ä¸”æœ‰ä»£è¡¨æ€§çš„å¹¶å‘é—®é¢˜äº†, å¯ä»¥åŸºäºäº’æ–¥é”æ–¹æ¡ˆå®ç°, ä¹Ÿå¯ä»¥åŸºäºåŸå­ç±»å®ç°, ä½†ä»Šå¤©è¦å°è¯•ç”¨ Actor æ¥å®ç°.")]),s._v(" "),t("p",[s._v("åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, CounterActor å†…éƒ¨æŒæœ‰ç´¯è®¡å€¼ counter, å½“ CounterActor æ¥æ”¶åˆ°ä¸€ä¸ªæ•°å€¼å‹çš„æ¶ˆæ¯ message æ—¶, å°±å°†ç´¯è®¡å€¼ counter += message; ä½†å¦‚æœæ˜¯å…¶ä»–ç±»å‹çš„æ¶ˆæ¯, åˆ™æ‰“å°å½“å‰ç´¯è®¡å€¼ counter. åœ¨ main() æ–¹æ³•ä¸­, å¯åŠ¨äº† 4 ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œç´¯åŠ æ“ä½œ. æ•´ä¸ªç¨‹åºæ²¡æœ‰é”, ä¹Ÿæ²¡æœ‰ CAS, ä½†æ˜¯ç¨‹åºæ˜¯çº¿ç¨‹å®‰å…¨çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç´¯åŠ å™¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CounterActor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UntypedActor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" counter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onReceive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯æ•°å­—ç±»å‹, æ‰§è¡Œç´¯åŠ æ“ä½œ, ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦åˆ™æ‰“å° counter çš„å€¼")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Number")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            counter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Number")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("counter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º Actor ç³»ç»Ÿ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorSystem")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorSystem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HelloSystem"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4 ä¸ªçº¿ç¨‹ç”Ÿäº§æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º CounterActor ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorRef")]),s._v(" counterActor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("actorOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Props")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CounterActor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”Ÿäº§ 4*100000 ä¸ªæ¶ˆæ¯ ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" j "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" j "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" j"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                counterActor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("noSender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­çº¿ç¨‹æ± ")]),s._v("\n    es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾… CounterActor å¤„ç†å®Œæ‰€æœ‰æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰“å°ç»“æœ")]),s._v("\n    counterActor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActorRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("noSender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é—­ Actor ç³»ç»Ÿ")]),s._v("\n    system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-33"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-33"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[t("strong",[s._v("Actor æ¨¡å‹æ˜¯ä¸€ç§éå¸¸ç®€å•çš„è®¡ç®—æ¨¡å‹, å…¶ä¸­ Actor æ˜¯æœ€åŸºæœ¬çš„è®¡ç®—å•å…ƒ, Actor ä¹‹é—´æ˜¯é€šè¿‡æ¶ˆæ¯è¿›è¡Œé€šä¿¡")]),s._v(". Actor ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)ä¸­çš„å¯¹è±¡åŒ¹é…åº¦éå¸¸é«˜, åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹é‡Œ, ç³»ç»Ÿç”±ç±»ä¼¼äºç”Ÿç‰©ç»†èƒé‚£æ ·çš„å¯¹è±¡æ„æˆ, å¯¹è±¡ä¹‹é—´ä¹Ÿæ˜¯é€šè¿‡æ¶ˆæ¯è¿›è¡Œé€šä¿¡, æ‰€ä»¥åœ¨é¢å‘å¯¹è±¡è¯­è¨€é‡Œä½¿ç”¨ Actor æ¨¡å‹åŸºæœ¬ä¸Šä¸ä¼šæœ‰è¿å’Œæ„Ÿ.")]),s._v(" "),t("p",[s._v("åœ¨ Java é¢†åŸŸ, é™¤äº†å¯ä»¥ä½¿ç”¨ Akka æ¥æ”¯æŒ Actor æ¨¡å‹å¤–, è¿˜å¯ä»¥ä½¿ç”¨ Vert.x, ä¸è¿‡ç›¸å¯¹æ¥è¯´ Vert.x æ›´åƒæ˜¯ Actor æ¨¡å‹çš„éšå¼å®ç°, å¯¹åº”å…³ç³»ä¸åƒ Akka é‚£æ ·æ˜æ˜¾, ä¸è¿‡æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ Actor æ¨¡å‹.")]),s._v(" "),t("p",[s._v("Actor å¯ä»¥åˆ›å»ºæ–°çš„ Actor, è¿™äº› Actor æœ€ç»ˆä¼šå‘ˆç°å‡ºä¸€ä¸ªæ ‘çŠ¶ç»“æ„, éå¸¸åƒç°å®ä¸–ç•Œé‡Œçš„ç»„ç»‡ç»“æ„, æ‰€ä»¥åˆ©ç”¨ Actor æ¨¡å‹æ¥å¯¹ç¨‹åºè¿›è¡Œå»ºæ¨¡, å’Œç°å®ä¸–ç•Œçš„åŒ¹é…åº¦éå¸¸é«˜. Actor æ¨¡å‹å’Œç°å®ä¸–ç•Œä¸€æ ·éƒ½æ˜¯å¼‚æ­¥æ¨¡å‹, ç†è®ºä¸Šä¸ä¿è¯æ¶ˆæ¯ç™¾åˆ†ç™¾é€è¾¾, ä¹Ÿä¸ä¿è¯æ¶ˆæ¯é€è¾¾çš„é¡ºåºå’Œå‘é€çš„é¡ºåºæ˜¯ä¸€è‡´çš„, ç”šè‡³æ— æ³•ä¿è¯æ¶ˆæ¯ä¼šè¢«ç™¾åˆ†ç™¾å¤„ç†. è™½ç„¶å®ç° Actor æ¨¡å‹çš„å‚å•†éƒ½åœ¨è¯•å›¾è§£å†³è¿™äº›é—®é¢˜, ä½†é—æ†¾çš„æ˜¯è§£å†³å¾—å¹¶ä¸å®Œç¾, æ‰€ä»¥ä½¿ç”¨ Actor æ¨¡å‹ä¹Ÿæ˜¯æœ‰æˆæœ¬çš„.")]),s._v(" "),t("h4",{attrs:{id:"_43-è½¯ä»¶äº‹åŠ¡å†…å­˜-å€Ÿé‰´æ•°æ®åº“çš„å¹¶å‘ç»éªŒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_43-è½¯ä»¶äº‹åŠ¡å†…å­˜-å€Ÿé‰´æ•°æ®åº“çš„å¹¶å‘ç»éªŒ"}},[s._v("#")]),s._v(" 43-è½¯ä»¶äº‹åŠ¡å†…å­˜:å€Ÿé‰´æ•°æ®åº“çš„å¹¶å‘ç»éªŒ")]),s._v(" "),t("p",[s._v("å¾ˆå¤šåŒå­¦åé¦ˆè¯´, å·¥ä½œäº†æŒºé•¿æ—¶é—´ä½†æ˜¯æ²¡æœ‰æœºä¼šæ¥è§¦å¹¶å‘ç¼–ç¨‹, å®é™…ä¸Šå¾ˆå¤šäººå¤©å¤©éƒ½åœ¨å†™å¹¶å‘ç¨‹åº, åªä¸è¿‡å¹¶å‘ç›¸å…³çš„é—®é¢˜éƒ½è¢«ç±»ä¼¼ Tomcat è¿™æ ·çš„ Web æœåŠ¡å™¨ä»¥åŠ MySQL è¿™æ ·çš„æ•°æ®åº“è§£å†³äº†. å°¤å…¶æ˜¯æ•°æ®åº“, åœ¨è§£å†³å¹¶å‘é—®é¢˜æ–¹é¢, å¯è°“æˆç»©æ–ç„¶, å®ƒçš„"),t("strong",[s._v("äº‹åŠ¡æœºåˆ¶éå¸¸ç®€å•æ˜“ç”¨")]),s._v(", èƒ½ç”© Java é‡Œé¢çš„é”, åŸå­ç±»åæ¡è¡—. æŠ€æœ¯æ— è¾¹ç•Œ, å¾ˆæ˜¾ç„¶è¦å€Ÿé‰´ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("å…¶å®å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æœ‰ä»æ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†ä¸­è·å¾—çµæ„Ÿ, å¹¶ä¸”æ€»ç»“å‡ºäº†ä¸€ä¸ªæ–°çš„å¹¶å‘è§£å†³æ–¹æ¡ˆ: "),t("strong",[s._v("è½¯ä»¶äº‹åŠ¡å†…å­˜(Software Transactional Memory, ç®€ç§° STM)")]),s._v(" . ä¼ ç»Ÿçš„æ•°æ®åº“äº‹åŠ¡, æ”¯æŒ 4 ä¸ªç‰¹æ€§: åŸå­æ€§(Atomicity), ä¸€è‡´æ€§(Consistency), éš”ç¦»æ€§(Isolation)å’ŒæŒä¹…æ€§(Durability), ä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è¯´çš„ ACID, STM ç”±äºä¸æ¶‰åŠåˆ°æŒä¹…åŒ–, æ‰€ä»¥åªæ”¯æŒ ACI.")]),s._v(" "),t("p",[s._v("STM çš„ä½¿ç”¨å¾ˆç®€å•, ä¸‹é¢ä»¥ç»å…¸çš„è½¬è´¦æ“ä½œä¸ºä¾‹, çœ‹çœ‹ç”¨ STM è¯¥å¦‚ä½•å®ç°.")]),s._v(" "),t("h5",{attrs:{id:"ç”¨stmå®ç°è½¬è´¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨stmå®ç°è½¬è´¦"}},[s._v("#")]),s._v(" ç”¨STMå®ç°è½¬è´¦")]),s._v(" "),t("p",[s._v("å‰é¢æ›¾ç»è®²åˆ°å¹¶å‘è½¬è´¦çš„ä¾‹å­, ç¤ºä¾‹ä»£ç å¦‚ä¸‹. ç®€å•åœ°ä½¿ç”¨ synchronized å°† transfer() æ–¹æ³•å˜æˆåŒæ­¥æ–¹æ³•å¹¶ä¸èƒ½è§£å†³å¹¶å‘é—®é¢˜, å› ä¸ºè¿˜å­˜åœ¨æ­»é”é—®é¢˜.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnsafeAccount")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä½™é¢")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ å‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnsafeAccount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnsafeAccount")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("è¯¥è½¬è´¦æ“ä½œè‹¥ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡å°±ä¼šéå¸¸ç®€å•, å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ‰€ç¤º. å¦‚æœæ‰€æœ‰ SQL éƒ½æ­£å¸¸æ‰§è¡Œ, åˆ™é€šè¿‡ commit() æ–¹æ³•æäº¤äº‹åŠ¡; å¦‚æœ SQL åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰å¼‚å¸¸, åˆ™é€šè¿‡ rollback() æ–¹æ³•å›æ»šäº‹åŠ¡. æ•°æ®åº“ä¿è¯åœ¨å¹¶å‘æƒ…å†µä¸‹ä¸ä¼šæœ‰æ­»é”, è€Œä¸”è¿˜èƒ½ä¿è¯å‰é¢è¯´çš„åŸå­æ€§, ä¸€è‡´æ€§, éš”ç¦»æ€§å’ŒæŒä¹…æ€§, ä¹Ÿå°±æ˜¯ ACID.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connection")]),s._v(" conn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–æ•°æ®åº“è¿æ¥")]),s._v("\n    conn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DriverManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡")]),s._v("\n    conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAutoCommit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œè½¬è´¦ SQL")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ......")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤äº‹åŠ¡")]),s._v("\n    conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‡ºç°å¼‚å¸¸å›æ»šäº‹åŠ¡")]),s._v("\n    conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rollback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("é‚£å¦‚æœç”¨ STM åˆè¯¥å¦‚ä½•å®ç°å‘¢? Java è¯­è¨€å¹¶ä¸æ”¯æŒ STM, ä¸è¿‡å¯ä»¥å€ŸåŠ©ç¬¬ä¸‰æ–¹çš„ç±»åº“æ¥æ”¯æŒ, "),t("a",{attrs:{href:"https://github.com/pveentjer/Multiverse",target:"_blank",rel:"noopener noreferrer"}},[s._v("Multiverse"),t("OutboundLink")],1),s._v(" å°±æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°±æ˜¯å€ŸåŠ© Multiverse å®ç°äº†çº¿ç¨‹å®‰å…¨çš„è½¬è´¦æ“ä½œ, ç›¸æ¯”è¾ƒä¸Šé¢çº¿ç¨‹ä¸å®‰å…¨çš„ UnsafeAccount, å…¶æ”¹åŠ¨å¹¶ä¸å¤§, ä»…ä»…æ˜¯å°†ä½™é¢çš„ç±»å‹ä» long å˜æˆäº† TxnLong , å°†è½¬è´¦çš„æ“ä½œæ”¾åˆ°äº† "),t("code",[s._v("atomic(()->{})")]),s._v("â€‹ ä¸­.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä½™é¢")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnLong")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ å‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StmUtils")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newTxnLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­åŒ–æ“ä½œ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("atomic")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("increment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("ä¸€ä¸ªå…³é”®çš„ atomic() æ–¹æ³•å°±æŠŠå¹¶å‘é—®é¢˜è§£å†³äº†, è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¸Šå»æ¯”ä¼ ç»Ÿçš„æ–¹æ¡ˆçš„ç¡®ç®€å•äº†å¾ˆå¤š, é‚£å®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢? æ•°æ®åº“äº‹åŠ¡å‘å±•äº†å‡ åå¹´äº†, ç›®å‰è¢«å¹¿æ³›ä½¿ç”¨çš„æ˜¯ "),t("strong",[s._v("MVCC")]),s._v("(å…¨ç§°æ˜¯ Multi-Version Concurrency Control), ä¹Ÿå°±æ˜¯"),t("strong",[s._v("å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶")]),s._v(".")]),s._v(" "),t("p",[s._v("MVCC å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºæ•°æ®åº“äº‹åŠ¡åœ¨å¼€å¯çš„æ—¶å€™, ä¼šç»™æ•°æ®åº“æ‰“ä¸€ä¸ªå¿«ç…§, "),t("strong",[s._v("ä»¥åæ‰€æœ‰çš„è¯»å†™éƒ½æ˜¯åŸºäºè¿™ä¸ªå¿«ç…§çš„")]),s._v(". å½“æäº¤äº‹åŠ¡çš„æ—¶å€™, å¦‚æœæ‰€æœ‰è¯»å†™è¿‡çš„æ•°æ®åœ¨è¯¥äº‹åŠ¡æ‰§è¡ŒæœŸé—´æ²¡æœ‰å‘ç”Ÿè¿‡å˜åŒ–, é‚£ä¹ˆå°±å¯ä»¥æäº¤; å¦‚æœå‘ç”Ÿäº†å˜åŒ–, è¯´æ˜è¯¥äº‹åŠ¡å’Œæœ‰å…¶ä»–äº‹åŠ¡è¯»å†™çš„æ•°æ®å†²çªäº†, è¿™ä¸ªæ—¶å€™æ˜¯ä¸å¯ä»¥æäº¤çš„.")]),s._v(" "),t("p",[s._v("ä¸ºäº†è®°å½•æ•°æ®æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–, å¯ä»¥ç»™æ¯æ¡æ•°æ®"),t("strong",[s._v("å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·")]),s._v(", è¿™æ ·æ¯æ¬¡æˆåŠŸä¿®æ”¹æ•°æ®éƒ½ä¼šå¢åŠ ç‰ˆæœ¬å·çš„å€¼. MVCC çš„å·¥ä½œåŸç†ä¸ä¹è§‚é”éå¸¸ç›¸ä¼¼. æœ‰ä¸å°‘ STM çš„å®ç°æ–¹æ¡ˆéƒ½æ˜¯åŸºäº MVCC çš„, ä¾‹å¦‚çŸ¥åçš„ Clojure STM.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±ç”¨æœ€ç®€å•çš„ä»£ç åŸºäº MVCC å®ç°ä¸€ä¸ªç®€ç‰ˆçš„ STM, è¿™æ ·ä½ ä¼šå¯¹ STM ä»¥åŠ MVCC çš„å·¥ä½œåŸç†æœ‰æ›´æ·±å…¥çš„è®¤è¯†.")]),s._v(" "),t("h5",{attrs:{id:"è‡ªå·±å®ç°stm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªå·±å®ç°stm"}},[s._v("#")]),s._v(" è‡ªå·±å®ç°STM")]),s._v(" "),t("p",[s._v("é¦–å…ˆè¦åšçš„, å°±æ˜¯è®© Java ä¸­çš„å¯¹è±¡æœ‰"),t("strong",[s._v("ç‰ˆæœ¬å·")]),s._v(", åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, VersionedRef è¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯å°†å¯¹è±¡ value åŒ…è£…æˆå¸¦ç‰ˆæœ¬å·çš„å¯¹è±¡. æŒ‰ç…§ MVCC ç†è®º, "),t("strong",[s._v("æ•°æ®çš„æ¯ä¸€æ¬¡ä¿®æ”¹éƒ½å¯¹åº”ç€ä¸€ä¸ªå”¯ä¸€çš„ç‰ˆæœ¬å·")]),s._v(", æ‰€ä»¥ä¸å­˜åœ¨ä»…ä»…æ”¹å˜ value æˆ–è€… version çš„æƒ…å†µ, ç”¨ä¸å˜æ€§æ¨¡å¼å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜, æ‰€ä»¥ VersionedRef è¿™ä¸ªç±»è¢«è®¾è®¡æˆäº†ä¸å¯å˜çš„.")]),s._v(" "),t("p",[s._v("æ‰€æœ‰å¯¹æ•°æ®çš„è¯»å†™æ“ä½œ, ä¸€å®šæ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢, TxnRef è¿™ä¸ªç±»è´Ÿè´£å®Œæˆäº‹åŠ¡å†…çš„è¯»å†™æ“ä½œ, è¯»å†™æ“ä½œå§”æ‰˜ç»™äº†æ¥å£ Txn, Txn ä»£è¡¨çš„æ˜¯è¯»å†™æ“ä½œæ‰€åœ¨çš„å½“å‰äº‹åŠ¡,  å†…éƒ¨æŒæœ‰çš„ curRef ä»£è¡¨çš„æ˜¯ç³»ç»Ÿä¸­çš„æœ€æ–°å€¼.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¸¦ç‰ˆæœ¬å·çš„å¯¹è±¡å¼•ç”¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("version "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ”¯æŒäº‹åŠ¡çš„å¼•ç”¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰æ•°æ®, å¸¦ç‰ˆæœ¬å·")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),s._v(" curRef"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å½“å‰äº‹åŠ¡ä¸­çš„æ•°æ®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Txn")]),s._v(" txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨å½“å‰äº‹åŠ¡ä¸­è®¾ç½®æ•°æ®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Txn")]),s._v(" txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("p",[s._v("STMTxn "),t("strong",[s._v("æ˜¯ Txn æœ€å…³é”®çš„ä¸€ä¸ªå®ç°ç±»")]),s._v(", äº‹åŠ¡å†…å¯¹äºæ•°æ®çš„è¯»å†™, éƒ½æ˜¯é€šè¿‡å®ƒæ¥å®Œæˆçš„. STMTxn å†…éƒ¨æœ‰ä¸¤ä¸ª Map: inTxnMap, ç”¨äºä¿å­˜å½“å‰äº‹åŠ¡ä¸­æ‰€æœ‰è¯»å†™çš„æ•°æ®çš„å¿«ç…§; writeMap, ç”¨äºä¿å­˜å½“å‰äº‹åŠ¡éœ€è¦å†™å…¥çš„æ•°æ®. æ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„äº‹åŠ¡ ID txnId, è¿™ä¸ª txnId æ˜¯å…¨å±€é€’å¢çš„.")]),s._v(" "),t("p",[s._v("STMTxn æœ‰ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•, åˆ†åˆ«æ˜¯è¯»æ•°æ®çš„ get() æ–¹æ³•, å†™æ•°æ®çš„ set() æ–¹æ³•å’Œæäº¤äº‹åŠ¡çš„ commit() æ–¹æ³•. å…¶ä¸­, get() æ–¹æ³•å°†è¦è¯»å–æ•°æ®ä½œä¸ºå¿«ç…§æ”¾å…¥ inTxnMap, åŒæ—¶ä¿è¯æ¯æ¬¡è¯»å–çš„æ•°æ®éƒ½æ˜¯ä¸€ä¸ªç‰ˆæœ¬. set() æ–¹æ³•ä¼šå°†è¦å†™å…¥çš„æ•°æ®æ”¾å…¥ writeMap, ä½†å¦‚æœå†™å…¥çš„æ•°æ®æ²¡è¢«è¯»å–è¿‡, ä¹Ÿä¼šå°†å…¶æ”¾å…¥ inTxnMap.")]),s._v(" "),t("p",[s._v("è‡³äº commit() æ–¹æ³•, ä¸ºäº†ç®€åŒ–å®ç°, ä½¿ç”¨äº†äº’æ–¥é”, æ‰€ä»¥äº‹åŠ¡çš„æäº¤æ˜¯ä¸²è¡Œçš„. commit() æ–¹æ³•çš„å®ç°å¾ˆç®€å•, é¦–å…ˆæ£€æŸ¥ inTxnMap ä¸­çš„æ•°æ®æ˜¯å¦å‘ç”Ÿè¿‡å˜åŒ–, å¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–, é‚£ä¹ˆå°±å°† writeMap ä¸­çš„æ•°æ®å†™å…¥(è¿™é‡Œçš„å†™å…¥å…¶å®å°±æ˜¯ TxnRef å†…éƒ¨æŒæœ‰çš„ curRef); å¦‚æœå‘ç”Ÿè¿‡å˜åŒ–, é‚£ä¹ˆå°±ä¸èƒ½å°† writeMap ä¸­çš„æ•°æ®å†™å…¥äº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// äº‹åŠ¡æ¥å£")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Txn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//STM äº‹åŠ¡å®ç°ç±»")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("STMTxn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Txn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// äº‹åŠ¡ ID ç”Ÿæˆå™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" txnSeq "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰äº‹åŠ¡æ‰€æœ‰çš„ç›¸å…³æ•°æ®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" inTxnMap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰äº‹åŠ¡æ‰€æœ‰éœ€è¦ä¿®æ”¹çš„æ•°æ®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" writeMap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰äº‹åŠ¡ ID")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" txnId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ å‡½æ•°, è‡ªåŠ¨ç”Ÿæˆå½“å‰äº‹åŠ¡ ID")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("STMTxn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        txnId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" txnSeq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å½“å‰äº‹åŠ¡ä¸­çš„æ•°æ®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†éœ€è¦è¯»å–çš„æ•°æ®, åŠ å…¥ inTxnMap")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("inTxnMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("containsKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            inTxnMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRef"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" inTxnMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨å½“å‰äº‹åŠ¡ä¸­ä¿®æ”¹æ•°æ®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†éœ€è¦ä¿®æ”¹çš„æ•°æ®, åŠ å…¥ inTxnMap")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("inTxnMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("containsKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            inTxnMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRef"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        writeMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤äº‹åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("commitLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ˜¯å¦æ ¡éªŒé€šè¿‡")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" isValid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¡éªŒæ‰€æœ‰è¯»è¿‡çš„æ•°æ®æ˜¯å¦å‘ç”Ÿè¿‡å˜åŒ–")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Entry")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" entry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" inTxnMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("entrySet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),s._v(" curRef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" entry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRef"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),s._v(" readRef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" entry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€šè¿‡ç‰ˆæœ¬å·æ¥éªŒè¯æ•°æ®æ˜¯å¦å‘ç”Ÿè¿‡å˜åŒ–")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curRef"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("version "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" readRef"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    isValid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ ¡éªŒé€šè¿‡, åˆ™æ‰€æœ‰æ›´æ”¹ç”Ÿæ•ˆ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isValid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                writeMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionedRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" txnId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" isValid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br")])]),t("p",[s._v("ä¸‹é¢æ¥æ¨¡æ‹Ÿå®ç° Multiverse ä¸­çš„åŸå­åŒ–æ“ä½œ atomic(). atomic() æ–¹æ³•ä¸­ä½¿ç”¨äº†ç±»ä¼¼äº CAS çš„æ“ä½œ, å¦‚æœäº‹åŠ¡æäº¤å¤±è´¥, é‚£ä¹ˆå°±é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡, é‡æ–°æ‰§è¡Œ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@FunctionalInterface")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRunnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Txn")]),s._v(" txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// STM")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("STM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç§æœ‰åŒ–æ„é€ æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("STM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤æ•°æ®éœ€è¦ç”¨åˆ°çš„å…¨å±€é”  ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" commitLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­åŒ–æäº¤æ–¹æ³•")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" atomic "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRunnable")]),s._v(" action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" committed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ²¡æœ‰æäº¤æˆåŠŸ, åˆ™ä¸€ç›´é‡è¯•")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("committed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºæ–°çš„äº‹åŠ¡")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("STMTxn")]),s._v(" txn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("STMTxn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œä¸šåŠ¡é€»è¾‘")]),s._v("\n                action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤äº‹åŠ¡")]),s._v("\n                committed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("å°±è¿™æ ·è‡ªå·±å®ç°äº† STM, å¹¶å®Œæˆäº†çº¿ç¨‹å®‰å…¨çš„è½¬è´¦æ“ä½œ, ä½¿ç”¨æ–¹æ³•å’Œ Multiverse å·®ä¸å¤š, è¿™é‡Œå°±ä¸èµ˜è¿°äº†, å…·ä½“ä»£ç å¦‚ä¸‹é¢æ‰€ç¤º.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä½™é¢")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ„é€ æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxnRef")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½¬è´¦æ“ä½œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("atomic")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" from "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("balance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" amt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-34"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-34"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("STM å€Ÿé‰´çš„æ˜¯æ•°æ®åº“çš„ç»éªŒ, æ•°æ®åº“è™½ç„¶å¤æ‚, ä½†ä»…ä»…å­˜å‚¨æ•°æ®, è€Œç¼–ç¨‹è¯­è¨€é™¤äº†æœ‰å…±äº«å˜é‡ä¹‹å¤–, è¿˜ä¼šæ‰§è¡Œå„ç§ I/O æ“ä½œ, å¾ˆæ˜¾ç„¶ I/O æ“ä½œæ˜¯å¾ˆéš¾æ”¯æŒå›æ»šçš„. æ‰€ä»¥, STM ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„. "),t("strong",[s._v("ç›®å‰æ”¯æŒ STM çš„ç¼–ç¨‹è¯­è¨€ä¸»è¦æ˜¯å‡½æ•°å¼è¯­è¨€, å‡½æ•°å¼è¯­è¨€é‡Œçš„æ•°æ®å¤©ç”Ÿå…·å¤‡ä¸å¯å˜æ€§, åˆ©ç”¨è¿™ç§ä¸å¯å˜æ€§å®ç° STM ç›¸å¯¹æ¥è¯´æ›´ç®€å•")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_44-åç¨‹-æ›´è½»é‡çº§çš„çº¿ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_44-åç¨‹-æ›´è½»é‡çº§çš„çº¿ç¨‹"}},[s._v("#")]),s._v(" 44-åç¨‹:æ›´è½»é‡çº§çš„çº¿ç¨‹")]),s._v(" "),t("p",[s._v("Java è¯­è¨€é‡Œè§£å†³å¹¶å‘é—®é¢˜é çš„æ˜¯å¤šçº¿ç¨‹, ä½†"),t("strong",[s._v("çº¿ç¨‹æ˜¯ä¸ªé‡é‡çº§çš„å¯¹è±¡, ä¸èƒ½é¢‘ç¹åˆ›å»º, é”€æ¯, è€Œä¸”çº¿ç¨‹åˆ‡æ¢çš„æˆæœ¬ä¹Ÿå¾ˆé«˜")]),s._v(", ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜, Java SDK æä¾›äº†çº¿ç¨‹æ± . ç„¶è€Œç”¨å¥½çº¿ç¨‹æ± å¹¶ä¸å®¹æ˜“, Java å›´ç»•çº¿ç¨‹æ± æä¾›äº†å¾ˆå¤šå·¥å…·ç±», è¿™äº›å·¥å…·ç±»å­¦èµ·æ¥ä¹Ÿä¸å®¹æ˜“. é‚£æœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆå‘¢? Java è¯­è¨€é‡Œç›®å‰è¿˜æ²¡æœ‰, ä½†æ˜¯å…¶ä»–è¯­è¨€é‡Œæœ‰, è¿™ä¸ªæ–¹æ¡ˆå°±æ˜¯"),t("strong",[s._v("åç¨‹")]),s._v("(Coroutine).")]),s._v(" "),t("p",[t("mark",[s._v("å¯ä»¥æŠŠ")]),s._v("â€‹"),t("mark",[t("strong",[s._v("åç¨‹")])]),s._v("â€‹"),t("mark",[s._v("ç®€å•åœ°ç†è§£")]),s._v("â€‹"),t("mark",[t("strong",[s._v("ä¸ºä¸€ç§è½»é‡çº§çš„çº¿ç¨‹")])]),s._v(". "),t("strong",[s._v("ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥çœ‹,")]),s._v(" "),t("mark",[t("strong",[s._v("çº¿ç¨‹æ˜¯åœ¨å†…æ ¸æ€ä¸­è°ƒåº¦çš„, è€Œåç¨‹æ˜¯åœ¨ç”¨æˆ·æ€è°ƒåº¦çš„")])]),s._v("â€‹ "),t("strong",[s._v(", æ‰€ä»¥ç›¸å¯¹äºçº¿ç¨‹æ¥è¯´, åç¨‹åˆ‡æ¢çš„æˆæœ¬æ›´ä½. åç¨‹è™½ç„¶ä¹Ÿæœ‰è‡ªå·±çš„æ ˆ, ä½†æ˜¯ç›¸æ¯”çº¿ç¨‹æ ˆè¦å°å¾—å¤š, å…¸å‹çš„çº¿ç¨‹æ ˆå¤§å°å·®ä¸å¤šæœ‰ 1M, è€Œåç¨‹æ ˆçš„å¤§å°å¾€å¾€åªæœ‰å‡  K æˆ–è€…å‡ å K. æ‰€ä»¥, æ— è®ºæ˜¯ä»æ—¶é—´ç»´åº¦è¿˜æ˜¯ç©ºé—´ç»´åº¦æ¥çœ‹, åç¨‹éƒ½æ¯”çº¿ç¨‹è½»é‡å¾—å¤š")]),s._v(".")]),s._v(" "),t("p",[s._v("æ”¯æŒåç¨‹çš„è¯­è¨€è¿˜æ˜¯æŒºå¤šçš„, ä¾‹å¦‚ Golang, Python, Lua, Kotlin ç­‰éƒ½æ”¯æŒåç¨‹. ä¸‹é¢å°±ä»¥ Golang ä¸ºä»£è¡¨, çœ‹çœ‹åç¨‹æ˜¯å¦‚ä½•åœ¨ Golang ä¸­ä½¿ç”¨çš„.")]),s._v(" "),t("h5",{attrs:{id:"golangä¸­çš„åç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#golangä¸­çš„åç¨‹"}},[s._v("#")]),s._v(" Golangä¸­çš„åç¨‹")]),s._v(" "),t("p",[s._v("åœ¨ Golang ä¸­åˆ›å»ºåç¨‹éå¸¸ç®€å•, åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­, è¦è®© hello() æ–¹æ³•åœ¨ä¸€ä¸ª"),t("strong",[s._v("æ–°çš„åç¨‹")]),s._v("ä¸­æ‰§è¡Œ, åªéœ€è¦ "),t("code",[s._v('go hello("World")')]),s._v('â€‹ è¿™ä¸€è¡Œä»£ç å°±æå®šäº†. å¯ä»¥å¯¹æ¯”ç€æƒ³æƒ³åœ¨ Java é‡Œæ˜¯å¦‚ä½•"è¾›å‹¤"åœ°åˆ›å»ºçº¿ç¨‹å’Œçº¿ç¨‹æ± çš„å§, æˆ‘çš„æ„Ÿè§‰ä¸€ç›´éƒ½æ˜¯: æ¯æ¬¡å†™å®Œ Golang çš„ä»£ç , å°±å†ä¹Ÿä¸æƒ³å†™ Java ä»£ç äº†.')]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tfmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨æ–°çš„åç¨‹ä¸­æ‰§è¡Œ hello æ–¹æ³•")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    fmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Run in main"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç­‰å¾… 100 æ¯«ç§’è®©åç¨‹æ‰§è¡Œç»“æŸ")]),s._v("\n\ttime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Millisecond"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("å‰é¢ä»‹ç»è¿‡, åˆ©ç”¨åç¨‹èƒ½å¤Ÿå¾ˆå¥½åœ°å®ç° Thread-Per-Message æ¨¡å¼. Thread-Per-Message æ¨¡å¼éå¸¸ç®€å•, å…¶å®è¶Šæ˜¯ç®€å•çš„æ¨¡å¼, åŠŸèƒ½ä¸Šå°±è¶Šç¨³å®š, å¯ç†è§£æ€§ä¹Ÿè¶Šå¥½.")]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯ç”¨ Golang å®ç°çš„ echo ç¨‹åºçš„æœåŠ¡ç«¯, ç”¨çš„æ˜¯ Thread-Per-Message æ¨¡å¼, ä¸ºæ¯ä¸ªæˆåŠŸå»ºç«‹è¿æ¥çš„ socket åˆ†é…ä¸€ä¸ªåç¨‹, ç›¸æ¯” Java çº¿ç¨‹æ± çš„å®ç°æ–¹æ¡ˆ, Golang ä¸­åç¨‹çš„æ–¹æ¡ˆæ›´ç®€å•.")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç›‘å¬æœ¬åœ° 9090 ç«¯å£")]),s._v("\n\tsocket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" net"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:9090"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Panicln")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("defer")]),s._v(" socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†è¿æ¥è¯·æ±‚  ")]),s._v("\n\t\tconn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Panicln")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†å·²ç»æˆåŠŸå»ºç«‹è¿æ¥çš„è¯·æ±‚")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†å·²ç»æˆåŠŸå»ºç«‹è¿æ¥çš„è¯·æ±‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("conn net"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("defer")]),s._v(" conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tbuf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»å–è¯·æ±‚æ•°æ®")]),s._v("\n\t\tsize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å›å†™ç›¸åº”æ•°æ®  ")]),s._v("\n\t\tconn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("h5",{attrs:{id:"åˆ©ç”¨åç¨‹å®ç°åŒæ­¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ©ç”¨åç¨‹å®ç°åŒæ­¥"}},[s._v("#")]),s._v(" åˆ©ç”¨åç¨‹å®ç°åŒæ­¥")]),s._v(" "),t("p",[s._v("å…¶å®åç¨‹å¹¶ä¸ä»…é™äºå®ç° Thread-Per-Message æ¨¡å¼, å®ƒè¿˜å¯ä»¥"),t("strong",[s._v("å°†å¼‚æ­¥æ¨¡å¼è½¬æ¢ä¸ºåŒæ­¥æ¨¡å¼")]),s._v(". å¼‚æ­¥ç¼–ç¨‹è™½ç„¶è¿‘å‡ å¹´å–å¾—äº†é•¿è¶³å‘å±•, ä½†æ˜¯å¼‚æ­¥çš„æ€ç»´æ¨¡å¼å¯¹äºæ™®é€šäººæ¥è®²æ¯•ç«Ÿæ˜¯æœ‰éš¾åº¦çš„, åªæœ‰çº¿æ€§çš„æ€ç»´æ¨¡å¼æ‰æ˜¯é€‚åˆæ‰€æœ‰äººçš„. è€Œçº¿æ€§çš„æ€ç»´æ¨¡å¼åæ˜ åˆ°ç¼–ç¨‹ä¸–ç•Œ, å°±æ˜¯åŒæ­¥.")]),s._v(" "),t("p",[s._v("åœ¨ Java é‡Œä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘åœ°å¤„ç† I/O, åŸºæœ¬ä¸Šç”¨çš„éƒ½æ˜¯"),t("strong",[s._v("å¼‚æ­¥éé˜»å¡æ¨¡å‹")]),s._v(", è¿™ç§æ¨¡å‹çš„å¼‚æ­¥ä¸»è¦æ˜¯"),t("strong",[s._v("é æ³¨å†Œå›è°ƒå‡½æ•°")]),s._v("å®ç°çš„, é‚£èƒ½å¦éƒ½ä½¿ç”¨åŒæ­¥å¤„ç†å‘¢? æ˜¾ç„¶æ˜¯ä¸èƒ½çš„. å› ä¸º"),t("strong",[s._v("åŒæ­¥æ„å‘³ç€ç­‰å¾…, è€Œçº¿ç¨‹ç­‰å¾…, æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§ä¸¥é‡çš„æµªè´¹")]),s._v(". ä¸è¿‡å¯¹äºåç¨‹æ¥è¯´, ç­‰å¾…çš„æˆæœ¬å°±æ²¡æœ‰é‚£ä¹ˆé«˜äº†, æ‰€ä»¥åŸºäºåç¨‹å®ç°"),t("strong",[s._v("åŒæ­¥éé˜»å¡")]),s._v("æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("OpenResty é‡Œå®ç°çš„ cosocket å°±æ˜¯ä¸€ç§åŒæ­¥éé˜»å¡æ–¹æ¡ˆ, å€ŸåŠ© cosocket å¯ä»¥ç”¨çº¿æ€§çš„æ€ç»´æ¨¡å¼æ¥ç¼–å†™éé˜»å¡çš„ç¨‹åº. ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯ç”¨ cosocket å®ç°çš„ socket ç¨‹åºçš„å®¢æˆ·ç«¯, å»ºç«‹è¿æ¥, å‘é€è¯·æ±‚, è¯»å–å“åº”æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åŒæ­¥çš„, ç”±äº cosocket æœ¬èº«æ˜¯éé˜»å¡çš„, æ‰€ä»¥è¿™äº›æ“ä½œè™½ç„¶æ˜¯åŒæ­¥çš„, ä½†æ˜¯å¹¶ä¸ä¼šé˜»å¡.")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" åˆ›å»º socket\nlocal sock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ngx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tcp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" è®¾ç½® socket è¶…æ—¶æ—¶é—´\nsock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("settimeouts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connect_timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" send_timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" read_timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" è¿æ¥åˆ°ç›®æ ‡åœ°å€\nlocal ok"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("connect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not ok then\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" çœç•¥å¼‚å¸¸å¤„ç†\nend\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" å‘é€è¯·æ±‚\nlocal bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not bytes then\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" çœç•¥å¼‚å¸¸å¤„ç†\nend\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" è¯»å–å“åº”\nlocal line"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("receive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err then\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" çœç•¥å¼‚å¸¸å¤„ç†\nend\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" å…³é—­ socket\nsock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" å¤„ç†è¯»å–åˆ°çš„æ•°æ® line\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("line"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h5",{attrs:{id:"ç»“æ„åŒ–å¹¶å‘ç¼–ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“æ„åŒ–å¹¶å‘ç¼–ç¨‹"}},[s._v("#")]),s._v(" ç»“æ„åŒ–å¹¶å‘ç¼–ç¨‹")]),s._v(" "),t("p",[s._v("Golang ä¸­çš„ go è¯­å¥è®©åç¨‹ç”¨èµ·æ¥å¤ªç®€å•äº†, ä½†æ˜¯è¿™ç§ç®€å•ä¹Ÿè•´è—ç€é£é™©. è¦æ·±å…¥äº†è§£è¿™ä¸ªé£é™©æ˜¯ä»€ä¹ˆ, å°±éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ goto è¯­å¥çš„å‰ä¸–ä»Šç”Ÿ.")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬æ¥è¯´, å„ç§å„æ ·çš„ç¼–ç¨‹è¯­è¨€ä¹¦ç±ä¸­éƒ½ä¼šè°ˆåˆ°ä¸å»ºè®®ä½¿ç”¨ goto è¯­å¥, åŸå› æ˜¯ goto è¯­å¥ä¼šè®©ç¨‹åºå˜å¾—æ··ä¹±. é‚£ä¸ºä»€ä¹ˆ goto è¯­å¥ä¼šè®©ç¨‹åºå˜å¾—æ··ä¹±å‘¢? æ··ä¹±å…·ä½“æŒ‡çš„åˆæ˜¯ä»€ä¹ˆå‘¢? å…¶å®æ‰€è°“çš„"),t("strong",[s._v("æ··ä¹±æŒ‡çš„æ˜¯ä»£ç çš„ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåºä¸ä¸€è‡´")]),s._v('. ä»£ç çš„ä¹¦å†™é¡ºåº, ä»£è¡¨çš„æ˜¯æˆ‘ä»¬çš„æ€ç»´è¿‡ç¨‹, å¦‚æœæ€ç»´çš„è¿‡ç¨‹ä¸ä»£ç æ‰§è¡Œçš„é¡ºåºä¸ä¸€è‡´, é‚£å°±ä¼šå¹²æ‰°æˆ‘ä»¬å¯¹ä»£ç çš„ç†è§£. æˆ‘ä»¬çš„æ€ç»´æ˜¯çº¿æ€§çš„, å‚»å‚»åœ°ä¸€æ¡é“å„¿è·‘åˆ°é»‘, è€Œ goto è¯­å¥å¤ªçµæ´», éšæ—¶å¯ä»¥ç©¿è¶Šæ—¶ç©º, å®åœ¨æ˜¯å¤ª"æ··ä¹±"äº†.')]),s._v(" "),t("p",[s._v('é¦–å…ˆå‘ç° goto è¯­å¥æ˜¯ "æ¯’è¯" çš„äººæ˜¯è‘—åçš„è®¡ç®—æœºç§‘å­¦å®¶è‰¾å…¹æ ¼Â·è¿ªç§‘æ–¯å½»(Edsger Dijkstra), åŒæ—¶ä»–è¿˜æå‡ºäº†ç»“æ„åŒ–ç¨‹åºè®¾è®¡. åœ¨ç»“æ„åŒ–ç¨‹åºè®¾è®¡ä¸­, å¯ä»¥ä½¿ç”¨ä¸‰ç§åŸºæœ¬æ§åˆ¶ç»“æ„æ¥ä»£æ›¿ goto, è¿™ä¸‰ç§åŸºæœ¬çš„æ§åˆ¶ç»“æ„å°±æ˜¯ä»Šå¤©æˆ‘ä»¬å¹¿æ³›ä½¿ç”¨çš„'),t("strong",[s._v("é¡ºåºç»“æ„")]),s._v(", "),t("strong",[s._v("é€‰æ‹©ç»“æ„")]),s._v("å’Œ"),t("strong",[s._v("å¾ªç¯ç»“æ„")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸‰ç§åŸºæœ¬çš„æ§åˆ¶ç»“æ„å¥ å®šäº†ä»Šå¤©é«˜çº§è¯­è¨€çš„åŸºç¡€, å¦‚æœä»”ç»†è§‚å¯Ÿè¿™ä¸‰ç§ç»“æ„, ä½ ä¼šå‘ç°å®ƒä»¬çš„"),t("strong",[s._v("å…¥å£å’Œå‡ºå£åªæœ‰ä¸€ä¸ª")]),s._v(", è¿™æ„å‘³å®ƒä»¬æ˜¯å¯ç»„åˆçš„, è€Œä¸”ç»„åˆèµ·æ¥ä¸€å®šæ˜¯çº¿æ€§çš„, æ•´ä½“æ¥çœ‹, ä»£ç çš„ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåºä¹Ÿæ˜¯ä¸€è‡´çš„.")]),s._v(" "),t("p",[s._v('ä»¥å‰å†™çš„å¹¶å‘ç¨‹åº, æ˜¯å¦è¿èƒŒäº†ç»“æ„åŒ–ç¨‹åºè®¾è®¡å‘¢? è¿™ä¸ªé—®é¢˜ä»¥å‰å¹¶æ²¡æœ‰è¢«å…³æ³¨, ä½†æ˜¯æœ€è¿‘ä¸¤å¹´, éšç€å¹¶å‘ç¼–ç¨‹çš„å¿«é€Ÿå‘å±•, å·²ç»å¼€å§‹æœ‰äººå…³æ³¨äº†, è€Œä¸”å‰‘æŒ‡ Golang ä¸­çš„ go è¯­å¥, æŒ‡å…¶ä¸º "æ¯’è¯", ç±»æ¯”çš„æ˜¯ goto è¯­å¥. è¯¦æƒ…å¯ä»¥å‚è€ƒ'),t("a",{attrs:{href:"https://vorpus.org/blog/notes-on-structured-concurrency-or-go-statement-considered-harmful/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›¸å…³çš„æ–‡ç« "),t("OutboundLink")],1),s._v(". Golang ä¸­çš„ go è¯­å¥ä¸è¿‡æ˜¯å¿«é€Ÿåˆ›å»ºåç¨‹çš„æ–¹æ³•è€Œå·², è¿™ç¯‡æ–‡ç« æœ¬è´¨ä¸Šå¹¶ä¸ä»…ä»…åœ¨æ‰¹åˆ¤ Golang ä¸­çš„ go è¯­å¥, è€Œæ˜¯åœ¨æ‰¹åˆ¤å¼€å¯æ–°çš„çº¿ç¨‹(æˆ–è€…åç¨‹)å¼‚æ­¥æ‰§è¡Œè¿™ç§ç²—ç³™çš„åšæ³•, è¿èƒŒäº†ç»“æ„åŒ–ç¨‹åºè®¾è®¡, Java è¯­è¨€å…¶å®ä¹Ÿåœ¨å…¶åˆ—.")]),s._v(" "),t("p",[s._v("å½“å¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ—¶, ç¨‹åºä¼šå¹¶è¡Œåœ°å‡ºç°ä¸¤ä¸ªåˆ†æ”¯, ä¸»çº¿ç¨‹ä¸€ä¸ªåˆ†æ”¯, å­çº¿ç¨‹ä¸€ä¸ªåˆ†æ”¯, è¿™ä¸¤ä¸ªåˆ†æ”¯å¾ˆå¤šæƒ…å†µä¸‹éƒ½æ˜¯å¤©å„ä¸€æ–¹, æ°¸ä¸ç›¸è§. è€Œç»“æ„åŒ–çš„ç¨‹åº, å¯ä»¥æœ‰åˆ†æ”¯, ä½†æ˜¯æœ€ç»ˆä¸€å®šè¦æ±‡èš, ä¸èƒ½æœ‰å¤šä¸ªå‡ºå£, å› ä¸ºåªæœ‰è¿™æ ·å®ƒä»¬ç»„åˆèµ·æ¥æ‰æ˜¯çº¿æ€§çš„.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-35"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-35"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("æœ€è¿‘å‡ å¹´æ”¯æŒåç¨‹çš„å¼€å‘è¯­è¨€è¶Šæ¥è¶Šå¤šäº†, Java OpenSDK ä¸­ Loom é¡¹ç›®çš„ç›®æ ‡å°±æ˜¯æ”¯æŒåç¨‹, ç›¸ä¿¡ä¸ä¹…çš„å°†æ¥, Java ç¨‹åºå‘˜ä¹Ÿå¯ä»¥ä½¿ç”¨åç¨‹æ¥è§£å†³å¹¶å‘é—®é¢˜äº†.")]),s._v(" "),t("p",[s._v("è®¡ç®—æœºé‡Œå¾ˆå¤šé¢å‘å¼€å‘äººå‘˜çš„æŠ€æœ¯, å¤§å¤šæ•°éƒ½æ˜¯åœ¨è§£å†³ä¸€ä¸ªé—®é¢˜: "),t("strong",[s._v("æ˜“ç”¨æ€§")]),s._v(". åç¨‹ä½œä¸ºä¸€é¡¹å¹¶å‘ç¼–ç¨‹æŠ€æœ¯, æœ¬è´¨ä¸Šä¹Ÿä¸è¿‡æ˜¯è§£å†³å¹¶å‘å·¥å…·çš„æ˜“ç”¨æ€§é—®é¢˜è€Œå·². å¯¹äºæ˜“ç”¨æ€§, æˆ‘è§‰å¾—æœ€é‡è¦çš„å°±æ˜¯"),t("strong",[s._v("è¦é€‚åº”æˆ‘ä»¬çš„æ€ç»´æ¨¡å¼")]),s._v(", åœ¨å·¥ä½œçš„å‰å‡ å¹´, æˆ‘å¹¶æ²¡æœ‰æ€ä¹ˆå…³æ³¨å®ƒ, ä½†æ˜¯æœ€è¿‘å‡ å¹´æ€ç»´æ¨¡å¼å·²æˆä¸ºæˆ‘é‡ç‚¹å…³æ³¨çš„å¯¹è±¡. å› ä¸ºæ€ç»´æ¨¡å¼å¯¹å·¥ä½œçš„å¾ˆå¤šæ–¹é¢éƒ½ä¼šäº§ç”Ÿå½±å“, ä¾‹å¦‚è´¨é‡.")]),s._v(" "),t("h3",{attrs:{id:"ç»“æŸè¯­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“æŸè¯­"}},[s._v("#")]),s._v(" ç»“æŸè¯­")]),s._v(" "),t("h4",{attrs:{id:"ç»“æŸè¯­-åå¹´ä¹‹å-åˆå¿ƒä¾æ—§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“æŸè¯­-åå¹´ä¹‹å-åˆå¿ƒä¾æ—§"}},[s._v("#")]),s._v(" ç»“æŸè¯­-åå¹´ä¹‹å,åˆå¿ƒä¾æ—§")]),s._v(" "),t("p",[s._v("æˆ‘æ›¾ç»æè¿‡ 5 å¹´çš„ ERP, å…¶é—´æˆ‘æ˜¯å¾ˆæƒ³åœ¨è¿™æ¡è·¯ä¸Šä¸€ç›´èµ°ä¸‹å», ä½†åœ¨è¿™ä¸ªè¡Œä¸šæ‘¸çˆ¬æ»šæ‰“äº†å‡ å¹´ä¹‹å, æˆ‘å‘ç°è¿™ä¸ªè¡Œä¸šé‡Œæ‡‚ä¸šåŠ¡æ¯”æ‡‚æŠ€æœ¯æ›´é‡è¦. äºæ˜¯ä¸ºäº†æé«˜ä¸šåŠ¡æ°´å¹³, æˆ‘å°±å»ææ³¨å†Œä¼šè®¡å¸ˆäº†; ä½†åœ¨æˆ‘è¿˜æ²¡æœ‰æå®šå®ƒçš„æ—¶å€™, æˆ‘çªç„¶å‘ç°è‡ªå·±ç«Ÿç„¶å¤±ä¸šäº†. è¿™ä¸ªæ—¶å€™æˆ‘æ‰æ„è¯†åˆ°, é€‰æ‹©æ‹¼æäºç»†åˆ†è¡Œä¸šé‡Œçš„å¤•é˜³äº§ä¸š, æ˜¯å¤šä¹ˆæ„šè ¢. **é€‰æ‹©, æ°¸è¿œæ¯”åŠªåŠ›æ›´é‡è¦. **")]),s._v(" "),t("p",[s._v('å¯ç¬‘çš„æ˜¯æˆ‘ä»¬é€‰æ‹©çš„, å¾€å¾€ä¸æ˜¯æœŸæœ›çš„é‚£æ ·. åæ¥æˆ‘é˜´é”™é˜³å·®å»äº†ä¸€å®¶å¤®ä¼, ä¼ ç»Ÿè§‚ç‚¹è®¤ä¸ºè¿™é‡Œå’Œå…»è€é™¢æ˜¯å¯¹é—¨å„¿, å¯å®é™…ä¸Š, åœ¨ "å…»è€é™¢å¯¹é—¨å„¿" çš„è¿™ä¸‰å¹´å¤š, æ˜¯æˆ‘æˆé•¿æœ€å¿«çš„ä¸‰å¹´, åŒ…æ‹¬æŠ€æœ¯. è¿™ä¸‰å¹´å±äºè¢«"éª‚"çš„æœ€å¤šçš„ä¸‰å¹´, åšçš„ä¸œè¥¿è¢«åŒè¡Œ"éª‚", æ±‡æŠ¥è¢«é¢†å¯¼"éª‚", è¢«"éª‚"çš„å¤šäº†, æ¸æ¸å°±æ„è¯†åˆ°è‡ªå·±çš„é—®é¢˜äº†. '),t("mark",[t("strong",[s._v("æ‰¾åˆ°è‡ªå·±çš„é—®é¢˜, æ‰æ˜¯æœ€é‡è¦çš„")])]),s._v("â€‹ "),t("strong",[s._v(".")])]),s._v(" "),t("p",[s._v('ä¸€å“¥ä»¬å„¿æ›¾æœ‰è¿‡ä¸€æ®µç»å…¸çš„æ€»ç»“: æ‰€æœ‰çš„å¤±è´¥éƒ½å¯ä»¥å½’ç»“ä¸º "'),t("mark",[t("strong",[s._v("é”™ä¼°äº†å½¢åŠ¿, ä½ä¼°äº†æ•Œäºº, é«˜ä¼°äº†è‡ªå·±")])]),s._v('". äºº, æ€»æ˜¯é«˜ä¼°äº†è‡ªå·±, æ˜¾ç„¶, æˆ‘ä¹Ÿæ˜¯. å¾ˆå¤šæ—¶å€™, æˆ‘ä¹Ÿä¼šä¸€ä¸å°å¿ƒå°±é«˜ä¼°äº†è‡ªå·±, è€Œä¸”è¿˜ä¸€ç‚¹éƒ½æ„è¯†ä¸åˆ°. æ„Ÿè°¢ä½›å®¶ç»å…¸ã€Šé‡‘åˆšç»ã€‹, è™½è¯´åˆ°ç°åœ¨æˆ‘ä¹Ÿæ²¡æœ‰æŠŠå®ƒæŠ„å®Œ, ä½†æ˜¯æŠ„åˆ°ä¸åˆ°ä¸€åŠçš„æ—¶å€™, æˆ‘å·²ç»æ·±æ·±è®¤è¯†åˆ°è‡ªå·±æ˜¯å¤šä¹ˆçš„æµ…è–„ä¸ç‹‚å¦„äº†. '),t("strong",[s._v("é©±é™¤è™šå¦„, æ‰èƒ½è¿›æ­¥.")])]),s._v(" "),t("p",[s._v("ææŠ€æœ¯çš„ç“¶é¢ˆåœ¨å“ªé‡Œå‘¢? æ¯ä¸ªäººèµ„è´¨, æœºé‡ä¸åŒ, å…¶å®æ²¡æœ‰å¿…è¦å¼ºæ±‚. æˆ‘ä¹Ÿæ›¾ç»å…´è¶£å¹¿æ³›, å¤§å­¦æ—¶è¿˜ä¹°è¿‡å…¨è‹±æ–‡çš„ã€ŠIntel å¾®å¤„ç†å™¨ã€‹, æ¬äº†å‡ æ¬¡å®¶, éƒ½æ²¡èˆå¾—æ‰”, å‰ä¸¤å¹´ç»ˆäºæ‰”æ‰äº†, çº¯ç²¹æ˜¯æµªè´¹æ—¶é—´å’Œç©ºé—´. æœ‰æ—¶æˆ‘ä»¬å¾—æ‰¿è®¤, ä¸æ˜¯éšä¾¿ä¸€ä¸ªé¢†åŸŸæˆ‘ä»¬éƒ½èƒ½å¹²å¾—å¾ˆæ·±å…¥çš„, å®é™…åœºæ™¯å’Œèµ„è´¨éƒ½å¾ˆé‡è¦. "),t("mark",[t("strong",[s._v("æ‹¿ä¸åŠ¨çš„ä¸œè¥¿è¶Šæ—©æ”¾å¼ƒè¶Šå¥½, åšäº†å‡æ³•, æ‰èƒ½åšåŠ æ³•, ç”Ÿä¹Ÿæœ‰æ¶¯, è¯¥æ”¾å°±æ”¾")])]),s._v("â€‹ "),t("strong",[s._v(".")])]),s._v(" "),t("p",[s._v("å·¥ä½œåå¹´, å¾ˆå¤šäººå·²ç»åœ¨ä¸åŒçš„è½¨é“ä¸Šäº†, æœ‰äº›äººé€‰æ‹©äº†åšç®¡ç†, æœ‰äº›äººé€‰æ‹©äº†åˆ›ä¸š, åªæœ‰å¾ˆå°‘çš„äººåœ¨ææŠ€æœ¯. åå¹´, å¾ˆå¤šé¢å…·ä¸‹çš„è„¸éƒ½å·²åƒç–®ç™¾å­”, æœ‰äº›äººæ‘˜ä¸‹é¢å…·å¾ˆä¸‘, æœ‰äº›äººæ‘˜ä¸‹é¢å…·å¾ˆæ€ª, åªæœ‰å¾ˆå°‘çš„äººæ‘˜ä¸‹é¢å…·ä½ è¿˜è®¤å¾—. äº‹å®è¯æ˜, ä½ ä¸è®¤å¾—çš„, åŸºæœ¬éƒ½å·²è½é©¬; ä½ è¿˜è®¤å¾—çš„, åŸºæœ¬éƒ½æ··å¾—ä¸é”™. æ­£æ‰€è°“, è·¯é¥çŸ¥é©¬åŠ›, æ—¥ä¹…è§äººå¿ƒ. **ç®€å•åšäºº, æŒºå¥½. **")]),s._v(" "),t("p",[s._v("â€")])])}),[],!1,null,null,null);t.default=e.exports}}]);