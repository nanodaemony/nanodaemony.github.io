(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{482:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_200-æ·±å…¥æ‹†è§£tomcatä¸jetty-æå®¢æ—¶é—´-ğŸŒ¸"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_200-æ·±å…¥æ‹†è§£tomcatä¸jetty-æå®¢æ—¶é—´-ğŸŒ¸"}},[s._v("#")]),s._v(" 200.æ·±å…¥æ‹†è§£Tomcatä¸Jetty(æå®¢æ—¶é—´)ğŸŒ¸")]),s._v(" "),t("h3",{attrs:{id:"åŸºç¡€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€"}},[s._v("#")]),s._v(" åŸºç¡€")]),s._v(" "),t("h4",{attrs:{id:"_0-ä¸ºä»€ä¹ˆå­¦ä¹ tomcat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0-ä¸ºä»€ä¹ˆå­¦ä¹ tomcat"}},[s._v("#")]),s._v(" 0.ä¸ºä»€ä¹ˆå­¦ä¹ Tomcat?")]),s._v(" "),t("p",[s._v("Servlet æŠ€æœ¯æ˜¯ Web å¼€å‘çš„åŸç‚¹, å‡ ä¹æ‰€æœ‰çš„ Java Web æ¡†æ¶(æ¯”å¦‚ Spring)éƒ½æ˜¯åŸºäº Servlet çš„å°è£…, Spring åº”ç”¨æœ¬èº«å°±æ˜¯ä¸€ä¸ª Servlet, è€Œ Tomcat å’Œ Jetty è¿™æ ·çš„ Web å®¹å™¨, è´Ÿè´£åŠ è½½å’Œè¿è¡Œ Servlet. å¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¼ å›¾æ¥ç†è§£ Tomcat å’Œ Jetty åœ¨ Web å¼€å‘ä¸­çš„ä½ç½®.")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/image-20230405155856-ubjww1f.jpg",alt:""}}),s._v("â€‹")]),s._v(" "),t("p",[s._v("Tomcat å’Œ Jetty ä¸­ç”¨åˆ°ä¸å°‘ Java é«˜çº§æŠ€æœ¯, æ¯”å¦‚ Java å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹, Socket ç½‘ç»œç¼–ç¨‹ä»¥åŠåå°„ç­‰ç­‰. é€šè¿‡å¯¹ Tomcat å’Œ Jetty æºç çš„å­¦ä¹ , å¯ä»¥å­¦ä¼šåœ¨ä»€ä¹ˆæ ·çš„åœºæ™¯ä¸‹å»ç”¨è¿™äº›æŠ€æœ¯, è¿™ä¸€ç‚¹è‡³å…³é‡è¦.")]),s._v(" "),t("p",[s._v("è¿˜æœ‰å°±æ˜¯ç³»ç»Ÿè®¾è®¡èƒ½åŠ›, Tomcat å’Œ Jetty ä½œä¸ºå·¥ä¸šçº§çš„ä¸­é—´ä»¶, å®ƒä»¬çš„è®¾è®¡éå¸¸ä¼˜ç§€, æ¯”å¦‚é¢å‘æ¥å£ç¼–ç¨‹, ç»„ä»¶åŒ–, éª¨æ¶æŠ½è±¡ç±», ä¸€é”®å¼å¯åœ, å¯¹è±¡æ± æŠ€æœ¯ä»¥åŠå„ç§è®¾è®¡æ¨¡å¼, æ¯”å¦‚æ¨¡æ¿æ–¹æ³•, è§‚å¯Ÿè€…æ¨¡å¼, è´£ä»»é“¾æ¨¡å¼ç­‰, ä¹‹åæˆ‘ä¹Ÿå¼€å§‹æ¨¡ä»¿å®ƒä»¬å¹¶æŠŠè¿™äº›è®¾è®¡æ€æƒ³è¿ç”¨åˆ°å®é™…çš„å·¥ä½œä¸­.")]),s._v(" "),t("p",[s._v("ç‹¬å½“ä¸€é¢çš„èƒ½åŠ›, ç¦»ä¸å¼€"),t("strong",[s._v("æŠ€æœ¯çš„å¹¿åº¦å’Œæ·±åº¦")]),s._v(".")]),s._v(" "),t("p",[s._v("æŠ€æœ¯çš„å¹¿åº¦ä½“ç°åœ¨ä½ çš„çŸ¥è¯†æ˜¯æˆä½“ç³»çš„, ä»å‰ç«¯åˆ°åç«¯, ä»åº”ç”¨å±‚é¢åˆ°æ“ä½œç³»ç»Ÿ, ä»è½¯ä»¶åˆ°ç¡¬ä»¶, ä»å¼€å‘, æµ‹è¯•, éƒ¨ç½²åˆ°è¿ç»´â€¦æœ‰äº›é¢†åŸŸè™½ç„¶ä½ ä¸éœ€è¦æŒ–å¾—å¾ˆæ·±, ä½†æ˜¯ä½ å¿…é¡»çŸ¥é“è¿™å…¶ä¸­çš„â€œé—¨é“â€.")]),s._v(" "),t("p",[s._v("è€ŒæŠ€æœ¯çš„æ·±åº¦ä½“ç°åœ¨å¯¹äºæŸç§æŠ€æœ¯, ä½ ä¸ä»…çŸ¥é“æ€ä¹ˆç”¨, è¿˜çŸ¥é“è¿™é¡¹æŠ€æœ¯å¦‚ä½•äº§ç”Ÿçš„, å®ƒèƒŒåçš„åŸç†æ˜¯ä»€ä¹ˆ, ä»¥åŠå®ƒä¸ºä»€ä¹ˆè¢«è®¾è®¡æˆè¿™æ ·, ç”šè‡³ä½ è¿˜å¾—çŸ¥é“å¦‚ä½•å»æ”¹è¿›å®ƒ.")]),s._v(" "),t("p",[s._v("æ€»ä¹‹å¼„æ‡‚äº† Tomcat å’Œ Jetty, å°±èƒ½ä½“ä¼šåˆ°å¤§ç¥ä»¬æ˜¯å¦‚ä½•è®¾è®¡ Tomcat å’Œ Jetty çš„, ä½“ä¼šä»–ä»¬å¦‚ä½•æ€è€ƒé—®é¢˜, å¦‚ä½•å†™ä»£ç . æ¯”å¦‚æ€æ ·è®¾è®¡æœåŠ¡ç«¯ç¨‹åºçš„ I/O å’Œçº¿ç¨‹æ¨¡å‹, æ€æ ·å†™é«˜æ€§èƒ½é«˜å¹¶å‘ç¨‹åº, Spring çš„ IoC å®¹å™¨ä¸ºä»€ä¹ˆè®¾è®¡æˆè¿™ä¸ªæ ·å­, è®¾è®¡ä¸€ä¸ªä¸­é—´ä»¶æˆ–è€…æ¡†æ¶æœ‰å“ªäº›å¥—è·¯ç­‰...")]),s._v(" "),t("p",[s._v("æœ‰äº†ä¸€å®š Java åŸºç¡€çš„äºº, å¯¹äºç³»ç»Ÿè®¾è®¡çš„ä½“ä¼šå¯èƒ½è¿˜ä¸å¤Ÿæ·±åˆ», ç¼–ç¨‹çš„æ—¶å€™è¿˜åœç•™åœ¨å®ŒæˆåŠŸèƒ½çš„å±‚æ¬¡. è¿™æ ·ä¸ä»…ä¸šåŠ¡ä¸Šéš¾æœ‰çªç ´, å¯¹äºä¸ªäººæˆé•¿ä¹Ÿå¾ˆä¸åˆ©. ä¸ºäº†æ‰“ç ´è¿™ä¸ªç“¶é¢ˆ, å°±éœ€è¦åœ¨æ·±åº¦ä¸Šå¤šä¸‹åŠŸå¤«, æ‰¾å‡†ä¸€ä¸ªç‚¹, æ·±æŒ–ä¸‹å», å½»åº•ç†è§£å®ƒçš„åŸç†å’Œè®¾è®¡ç²¾é«“.")]),s._v(" "),t("h4",{attrs:{id:"_1-httpä¸tomcat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-httpä¸tomcat"}},[s._v("#")]),s._v(" 1.HTTPä¸Tomcat")]),s._v(" "),t("h5",{attrs:{id:"httpä¸tomcat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#httpä¸tomcat"}},[s._v("#")]),s._v(" HTTPä¸Tomcat")]),s._v(" "),t("p",[t("strong",[s._v("HTTP åè®®çš„æœ¬è´¨å°±æ˜¯ä¸€ç§æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çº¦å®šå¥½çš„é€šä¿¡æ ¼å¼")]),s._v(". ä¸€æ¬¡ HTTP çš„è¯·æ±‚è¿‡ç¨‹å¦‚ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405160006-9o9saqk.jpg",alt:""}})]),s._v(" "),t("p",[s._v("Tomcat å’Œ Jetty ä½œä¸ºä¸€ä¸ª HTTP æœåŠ¡å™¨, åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­éƒ½åšäº†äº›ä»€ä¹ˆäº‹æƒ…å‘¢? ä¸»è¦æ˜¯"),t("strong",[s._v("æ¥å—è¿æ¥, è§£æè¯·æ±‚æ•°æ®, å¤„ç†è¯·æ±‚å’Œå‘é€å“åº”")]),s._v("è¿™å‡ ä¸ªæ­¥éª¤. æ³¨æ„, å¯èƒ½æœ‰æˆåƒä¸Šä¸‡çš„æµè§ˆå™¨åŒæ—¶è¯·æ±‚åŒä¸€ä¸ª HTTP æœåŠ¡å™¨, å› æ­¤ Tomcat å’Œ Jetty ä¸ºäº†æé«˜æœåŠ¡çš„èƒ½åŠ›å’Œå¹¶å‘åº¦, å¾€å¾€ä¼šå°†è‡ªå·±è¦åšçš„å‡ ä¸ªäº‹æƒ…"),t("strong",[s._v("å¹¶è¡ŒåŒ–")]),s._v(", å…·ä½“æ¥è¯´å°±æ˜¯"),t("strong",[s._v("ä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"tomcatä¸session"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatä¸session"}},[s._v("#")]),s._v(" Tomcatä¸Session")]),s._v(" "),t("p",[s._v("HTTP åè®®æœ‰ä¸ªç‰¹ç‚¹æ˜¯æ— çŠ¶æ€, è¯·æ±‚ä¸è¯·æ±‚ä¹‹é—´æ˜¯æ²¡æœ‰å…³ç³»çš„. è¿™æ ·ä¼šå‡ºç°ä¸€ä¸ªå¾ˆå°´å°¬çš„é—®é¢˜: Web åº”ç”¨ä¸çŸ¥é“ä½ æ˜¯è°. æ¯”å¦‚ä½ ç™»é™†æ·˜å®å, åœ¨è´­ç‰©è½¦ä¸­æ·»åŠ äº†ä¸‰ä»¶å•†å“, åˆ·æ–°ä¸€ä¸‹ç½‘é¡µ, è¿™æ—¶ç³»ç»Ÿæç¤ºä½ ä»ç„¶å¤„äºæœªç™»å½•çš„çŠ¶æ€, è´­ç‰©è½¦ä¹Ÿç©ºäº†, å¾ˆæ˜¾ç„¶è¿™ç§æƒ…å†µæ˜¯ä¸å¯æ¥å—çš„. å› æ­¤ HTTP åè®®éœ€è¦ä¸€ç§æŠ€æœ¯è®©è¯·æ±‚ä¸è¯·æ±‚ä¹‹é—´å»ºç«‹èµ·è”ç³», å¹¶ä¸”æœåŠ¡å™¨éœ€è¦çŸ¥é“è¿™ä¸ªè¯·æ±‚æ¥è‡ªå“ªä¸ªç”¨æˆ·, äºæ˜¯ Cookie æŠ€æœ¯å‡ºç°äº†.")]),s._v(" "),t("p",[s._v("ç”±äº Cookie ä»¥æ˜æ–‡çš„æ–¹å¼å­˜å‚¨åœ¨æœ¬åœ°, è€Œ Cookie ä¸­å¾€å¾€å¸¦æœ‰ç”¨æˆ·ä¿¡æ¯, è¿™æ ·å°±é€ æˆäº†éå¸¸å¤§çš„å®‰å…¨éšæ‚£. è€Œ Session çš„å‡ºç°è§£å†³äº†è¿™ä¸ªé—®é¢˜, "),t("strong",[s._v("Session å¯ä»¥ç†è§£ä¸º")]),s._v("â€‹******æœåŠ¡å™¨**"),t("strong",[t("strong",[s._v("â€‹")]),s._v("ç«¯å¼€è¾Ÿçš„å­˜å‚¨ç©ºé—´, é‡Œé¢ä¿å­˜äº†ç”¨æˆ·çš„çŠ¶æ€")]),s._v(", ç”¨æˆ·ä¿¡æ¯ä»¥ Session çš„å½¢å¼å­˜å‚¨åœ¨æœåŠ¡ç«¯. å½“ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶, æœåŠ¡ç«¯å¯ä»¥æŠŠç”¨æˆ·çš„è¯·æ±‚å’Œç”¨æˆ·çš„ Session å¯¹åº”èµ·æ¥. é‚£ä¹ˆ Session æ˜¯æ€ä¹ˆå’Œè¯·æ±‚å¯¹åº”èµ·æ¥çš„å‘¢? ç­”æ¡ˆæ˜¯é€šè¿‡ Cookie, æµè§ˆå™¨åœ¨ Cookie ä¸­å¡«å……äº†ä¸€ä¸ª Session ID ä¹‹ç±»çš„å­—æ®µç”¨æ¥æ ‡è¯†è¯·æ±‚.")]),s._v(" "),t("p",[s._v("å…·ä½“å·¥ä½œè¿‡ç¨‹æ˜¯è¿™æ ·çš„: "),t("strong",[s._v("æœåŠ¡å™¨åœ¨åˆ›å»º Session çš„åŒæ—¶, ä¼šä¸ºè¯¥ Session ç”Ÿæˆå”¯ä¸€çš„ Session ID, å½“æµè§ˆå™¨å†æ¬¡å‘é€è¯·æ±‚çš„æ—¶å€™, ä¼šå°†è¿™ä¸ª Session ID å¸¦ä¸Š, æœåŠ¡å™¨æ¥å—åˆ°è¯·æ±‚ä¹‹åå°±ä¼šä¾æ® Session ID æ‰¾åˆ°ç›¸åº”çš„ Session, æ‰¾åˆ° Session å, å°±å¯ä»¥åœ¨ Session ä¸­è·å–æˆ–è€…æ·»åŠ å†…å®¹äº†")]),s._v(". è€Œè¿™äº›å†…å®¹åªä¼šä¿å­˜åœ¨æœåŠ¡å™¨ä¸­, å‘åˆ°å®¢æˆ·ç«¯çš„åªæœ‰ Session ID, è¿™æ ·ç›¸å¯¹å®‰å…¨, ä¹ŸèŠ‚çœäº†ç½‘ç»œæµé‡, å› ä¸ºä¸éœ€è¦åœ¨ Cookie ä¸­å­˜å‚¨å¤§é‡ç”¨æˆ·ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ Session åœ¨ä½•æ—¶ä½•åœ°åˆ›å»ºå‘¢? å½“ç„¶è¿˜æ˜¯åœ¨æœåŠ¡å™¨ç«¯ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­åˆ›å»ºçš„, ä¸åŒè¯­è¨€å®ç°çš„åº”ç”¨ç¨‹åºæœ‰ä¸åŒçš„åˆ›å»º Session çš„æ–¹æ³•. "),t("strong",[s._v("åœ¨ Java ä¸­, æ˜¯ Web åº”ç”¨ç¨‹åºåœ¨è°ƒç”¨ HttpServletRequest çš„ getSession æ–¹æ³•æ—¶, ç”± Web å®¹å™¨(æ¯”å¦‚ Tomcat)åˆ›å»ºçš„")]),s._v(".")]),s._v(" "),t("p",[s._v("Tomcat çš„ Session ç®¡ç†å™¨æä¾›äº†"),t("strong",[s._v("å¤šç§æŒä¹…åŒ–æ–¹æ¡ˆæ¥å­˜å‚¨ Session")]),s._v(", é€šå¸¸ä¼šé‡‡ç”¨é«˜æ€§èƒ½çš„å­˜å‚¨æ–¹å¼, æ¯”å¦‚ Redis, å¹¶ä¸”é€šè¿‡é›†ç¾¤éƒ¨ç½²çš„æ–¹å¼, é˜²æ­¢å•ç‚¹æ•…éšœ, ä»è€Œæå‡é«˜å¯ç”¨. åŒæ—¶, Session æœ‰è¿‡æœŸæ—¶é—´, "),t("strong",[s._v("å› æ­¤ Tomcat ä¼šå¼€å¯åå°çº¿ç¨‹å®šæœŸçš„è½®è¯¢, å¦‚æœ Session è¿‡æœŸäº†å°±å°† Session å¤±æ•ˆ")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_2-servletè§„èŒƒä¸servletå®¹å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-servletè§„èŒƒä¸servletå®¹å™¨"}},[s._v("#")]),s._v(" 2.Servletè§„èŒƒä¸Servletå®¹å™¨")]),s._v(" "),t("h5",{attrs:{id:"servletè§„èŒƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#servletè§„èŒƒ"}},[s._v("#")]),s._v(" Servletè§„èŒƒ")]),s._v(" "),t("p",[s._v("æµè§ˆå™¨å‘ç»™æœåŠ¡ç«¯çš„æ˜¯ä¸€ä¸ª HTTP æ ¼å¼çš„è¯·æ±‚, HTTP æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªè¯·æ±‚å, éœ€è¦è°ƒç”¨æœåŠ¡ç«¯ç¨‹åºæ¥å¤„ç†, æ‰€è°“çš„æœåŠ¡ç«¯ç¨‹åºå°±æ˜¯å†™çš„ Java ç±», ä¸€èˆ¬æ¥è¯´ä¸åŒçš„è¯·æ±‚éœ€è¦ç”±ä¸åŒçš„ Java ç±»æ¥å¤„ç†. é‚£ä¹ˆ HTTP æœåŠ¡å™¨æ€ä¹ˆçŸ¥é“è¦è°ƒç”¨å“ªä¸ª Java ç±»çš„å“ªä¸ªæ–¹æ³•å‘¢. æœ€ç›´æ¥çš„åšæ³•æ˜¯åœ¨ HTTP æœåŠ¡å™¨ä»£ç é‡Œå†™ä¸€å¤§å † if else é€»è¾‘åˆ¤æ–­: å¦‚æœæ˜¯ A è¯·æ±‚å°±è°ƒ X ç±»çš„ M1 æ–¹æ³•, å¦‚æœæ˜¯ B è¯·æ±‚å°±è°ƒ Y ç±»çš„ M2 æ–¹æ³•. ä½†è¿™æ ·åšæ˜æ˜¾æœ‰é—®é¢˜, å› ä¸º HTTP æœåŠ¡å™¨çš„ä»£ç è·Ÿä¸šåŠ¡é€»è¾‘è€¦åˆåœ¨ä¸€èµ·äº†, å¦‚æœæ–°åŠ ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•è¿˜è¦æ”¹ HTTP æœåŠ¡å™¨çš„ä»£ç .")]),s._v(" "),t("p",[s._v("é‚£è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢? é¢å‘æ¥å£ç¼–ç¨‹æ˜¯è§£å†³è€¦åˆé—®é¢˜çš„æ³•å®, äºæ˜¯ä¸€ä¼™äººå°±å®šä¹‰äº†ä¸€ä¸ªæ¥å£, å„ç§ä¸šåŠ¡ç±»éƒ½å¿…é¡»å®ç°è¿™ä¸ªæ¥å£, è¿™ä¸ªæ¥å£å°±å« "),t("strong",[s._v("Servlet æ¥å£")]),s._v(", æœ‰æ—¶ä¹ŸæŠŠå®ç°äº† Servlet æ¥å£çš„ä¸šåŠ¡ç±»å«ä½œ Servlet.")]),s._v(" "),t("p",[s._v("è¿˜æœ‰ä¸€ä¸ªé—®é¢˜, å¯¹äºç‰¹å®šçš„è¯·æ±‚, HTTP æœåŠ¡å™¨å¦‚ä½•çŸ¥é“ç”±å“ªä¸ª Servlet æ¥å¤„ç†å‘¢? Servlet åˆæ˜¯ç”±è°æ¥å®ä¾‹åŒ–å‘¢? æ˜¾ç„¶ HTTP æœåŠ¡å™¨ä¸é€‚åˆåšè¿™ä¸ªå·¥ä½œ, å¦åˆ™åˆå’Œä¸šåŠ¡ç±»è€¦åˆäº†.")]),s._v(" "),t("p",[s._v("äºæ˜¯, åˆå‘æ˜äº† "),t("strong",[s._v("Servlet å®¹å™¨, Servlet å®¹å™¨ç”¨æ¥åŠ è½½å’Œç®¡ç†ä¸šåŠ¡ç±»")]),s._v(". "),t("strong",[s._v("HTTP æœåŠ¡å™¨ä¸ç›´æ¥è·Ÿä¸šåŠ¡ç±»æ‰“äº¤é“, è€Œæ˜¯æŠŠè¯·æ±‚äº¤ç»™ Servlet å®¹å™¨å»å¤„ç†, Servlet å®¹å™¨ä¼šå°†è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„ Servlet, å¦‚æœè¿™ä¸ª Servlet è¿˜æ²¡åˆ›å»º, å°±åŠ è½½å¹¶å®ä¾‹åŒ–è¿™ä¸ª Servlet, ç„¶åè°ƒç”¨è¿™ä¸ª Servlet çš„æ¥å£æ–¹æ³•")]),s._v(". å› æ­¤ Servlet æ¥å£å…¶å®æ˜¯ "),t("strong",[s._v("Servlet å®¹å™¨è·Ÿå…·ä½“ä¸šåŠ¡ç±»ä¹‹é—´çš„æ¥å£")]),s._v(". ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾æ¥åŠ æ·±ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405160035-9i7e2ce.jpg",alt:""}})]),s._v(" "),t("p",[s._v("å›¾çš„å·¦è¾¹è¡¨ç¤º HTTP æœåŠ¡å™¨ç›´æ¥è°ƒç”¨å…·ä½“ä¸šåŠ¡ç±», å®ƒä»¬æ˜¯ç´§è€¦åˆçš„. å†çœ‹å›¾çš„å³è¾¹, "),t("strong",[s._v("HTTP æœåŠ¡å™¨ä¸ç›´æ¥è°ƒç”¨ä¸šåŠ¡ç±», è€Œæ˜¯æŠŠè¯·æ±‚äº¤ç»™å®¹å™¨æ¥å¤„ç†, å®¹å™¨é€šè¿‡ Servlet æ¥å£è°ƒç”¨ä¸šåŠ¡ç±»")]),s._v(". å› æ­¤ Servlet æ¥å£å’Œ Servlet å®¹å™¨çš„å‡ºç°, è¾¾åˆ°äº† "),t("strong",[s._v("HTTP æœåŠ¡å™¨ä¸ä¸šåŠ¡ç±»è§£è€¦")]),s._v("çš„ç›®çš„.")]),s._v(" "),t("p",[s._v("è€Œ Servlet æ¥å£å’Œ Servlet å®¹å™¨è¿™ä¸€æ•´å¥—è§„èŒƒå«ä½œ "),t("strong",[s._v("Servlet è§„èŒƒ")]),s._v(". "),t("strong",[s._v("Tomcat å’Œ Jetty éƒ½æŒ‰ç…§ Servlet è§„èŒƒçš„è¦æ±‚å®ç°äº† Servlet å®¹å™¨, åŒæ—¶å®ƒä»¬ä¹Ÿå…·æœ‰ HTTP æœåŠ¡å™¨çš„åŠŸèƒ½")]),s._v(". å¦‚æœè¦å®ç°æ–°çš„ä¸šåŠ¡åŠŸèƒ½, åªéœ€è¦å®ç°ä¸€ä¸ª Servlet, å¹¶æŠŠå®ƒæ³¨å†Œåˆ° Tomcat(Servlet å®¹å™¨)ä¸­, å‰©ä¸‹çš„äº‹æƒ…å°±ç”± Tomcat å¤„ç†äº†.")]),s._v(" "),t("p",[s._v("Tomcat å’Œ Jetty éƒ½æ˜¯ Servlet å®¹å™¨çš„å…·ä½“å®ç°, è™½ç„¶å®ƒä»¬çš„å®ç°æ–¹æ³•å„æœ‰ç‰¹ç‚¹, ä½†æ˜¯éƒ½éµå®ˆäº† Servlet è§„èŒƒ, å› æ­¤ Web åº”ç”¨å¯ä»¥åœ¨è¿™ä¸¤ä¸ª Servlet å®¹å™¨ä¸­æ–¹ä¾¿çš„åˆ‡æ¢.")]),s._v(" "),t("h5",{attrs:{id:"servletæ¥å£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#servletæ¥å£"}},[s._v("#")]),s._v(" Servletæ¥å£")]),s._v(" "),t("p",[s._v("Servlet æ¥å£å®šä¹‰äº†ä¸‹é¢äº”ä¸ªæ–¹æ³•:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Servlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletConfig")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletConfig")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServletConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletRequest")]),s._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletResponse")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServletInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("destroy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("strong",[s._v("å…¶ä¸­æœ€é‡è¦æ˜¯çš„ service() æ–¹æ³•, å…·ä½“ä¸šåŠ¡ç±»åœ¨è¿™ä¸ªæ–¹æ³•é‡Œå®ç°å¤„ç†é€»è¾‘")]),s._v(". è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°: "),t("strong",[s._v("ServletRequest å’Œ ServletResponse. ServletRequest ç”¨æ¥å°è£…è¯·æ±‚ä¿¡æ¯, ServletResponse ç”¨æ¥å°è£…å“åº”ä¿¡æ¯")]),s._v(", å› æ­¤**æœ¬è´¨ä¸Šè¿™ä¸¤ä¸ªç±»æ˜¯å¯¹é€šä¿¡åè®®çš„å°è£…. **")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ "),t("strong",[s._v("HTTP åè®®ä¸­çš„è¯·æ±‚å’Œå“åº”")]),s._v("å°±æ˜¯å¯¹åº”äº† "),t("strong",[s._v("HttpServletRequest")]),s._v(" å’Œ "),t("strong",[s._v("HttpServletResponse")]),s._v(" è¿™ä¸¤ä¸ªç±». å¯ä»¥é€šè¿‡ HttpServletRequest æ¥è·å–æ‰€æœ‰è¯·æ±‚ç›¸å…³çš„ä¿¡æ¯, åŒ…æ‹¬è¯·æ±‚è·¯å¾„, Cookie, HTTP å¤´, è¯·æ±‚å‚æ•°ç­‰. æ­¤å¤–, è¿˜å¯ä»¥é€šè¿‡ HttpServletRequest æ¥åˆ›å»ºå’Œè·å– Session. è€Œ HttpServletResponse æ˜¯ç”¨æ¥å°è£… HTTP å“åº”çš„.")]),s._v(" "),t("p",[s._v("æ¥å£ä¸­è¿˜æœ‰ä¸¤ä¸ªè·Ÿ"),t("strong",[s._v("ç”Ÿå‘½å‘¨æœŸæœ‰å…³çš„æ–¹æ³• init() å’Œ destroy()")]),s._v(" , è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒè´´å¿ƒçš„è®¾è®¡, "),t("strong",[s._v("Servlet å®¹å™¨åœ¨åŠ è½½ Servlet ç±»çš„æ—¶å€™ä¼šè°ƒç”¨ init() æ–¹æ³•, åœ¨å¸è½½çš„æ—¶å€™ä¼šè°ƒç”¨ destroy() æ–¹æ³•. å¯èƒ½ä¼šåœ¨ init() æ–¹æ³•é‡Œåˆå§‹åŒ–ä¸€äº›èµ„æº, å¹¶åœ¨ destroy() æ–¹æ³•é‡Œé‡Šæ”¾è¿™äº›èµ„æº, æ¯”å¦‚ Spring MVC ä¸­çš„ DispatcherServlet, å°±æ˜¯åœ¨ init() æ–¹æ³•é‡Œåˆ›å»ºäº†è‡ªå·±çš„ Spring å®¹å™¨")]),s._v(".")]),s._v(" "),t("p",[s._v("æ³¨æ„ ServletConfig è¿™ä¸ªç±», "),t("strong",[s._v("ServletConfig çš„ä½œç”¨å°±æ˜¯å°è£… Servlet çš„åˆå§‹åŒ–å‚æ•°")]),s._v(". å¯ä»¥åœ¨ web.xml ç»™ Servlet é…ç½®å‚æ•°, å¹¶åœ¨ç¨‹åºé‡Œé€šè¿‡ getServletConfig() æ–¹æ³•æ‹¿åˆ°è¿™äº›å‚æ•°.")]),s._v(" "),t("p",[s._v("æ—¢ç„¶å®šä¹‰äº† Servlet æ¥å£, æœ‰æ¥å£ä¸€èˆ¬å°±æœ‰æŠ½è±¡ç±», æŠ½è±¡ç±»ç”¨æ¥å®ç°æ¥å£å’Œå°è£…é€šç”¨çš„é€»è¾‘, å› æ­¤ Servlet è§„èŒƒæä¾›äº† "),t("strong",[s._v("GenericServlet")]),s._v(" æŠ½è±¡ç±», å¯ä»¥é€šè¿‡æ‰©å±•å®ƒæ¥å®ç° Servlet. è™½ç„¶ Servlet è§„èŒƒå¹¶ä¸åœ¨ä¹é€šä¿¡åè®®æ˜¯ä»€ä¹ˆ, ä½†æ˜¯å¤§å¤šæ•°çš„ Servlet éƒ½æ˜¯åœ¨ HTTP ç¯å¢ƒä¸­å¤„ç†çš„, å› æ­¤ "),t("strong",[s._v("Servet è§„èŒƒè¿˜æä¾›äº† HttpServlet æ¥ç»§æ‰¿ GenericServlet")]),s._v(", å¹¶ä¸”åŠ å…¥äº† HTTP ç‰¹æ€§. "),t("strong",[s._v("å› æ­¤ä¸€èˆ¬å¯ä»¥ç»§æ‰¿ HttpServlet ç±»æ¥å®ç°è‡ªå·±çš„ Servlet, åªéœ€è¦é‡å†™ä¸¤ä¸ªæ–¹æ³•: doGet() å’Œ doPost()")]),s._v(" .")]),s._v(" "),t("h5",{attrs:{id:"servletå®¹å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#servletå®¹å™¨"}},[s._v("#")]),s._v(" Servletå®¹å™¨")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°, ä¸ºäº†è§£è€¦, HTTP æœåŠ¡å™¨ä¸ç›´æ¥è°ƒç”¨ Servlet, è€Œæ˜¯"),t("strong",[s._v("æŠŠè¯·æ±‚äº¤ç»™ Servlet å®¹å™¨æ¥å¤„ç†")]),s._v(", é‚£ Servlet å®¹å™¨åˆæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢? ä¸‹é¢çœ‹çœ‹ä¸¤ä¸ªé‡è¦è¯é¢˜: "),t("strong",[s._v("Web åº”ç”¨çš„ç›®å½•æ ¼å¼æ˜¯ä»€ä¹ˆæ ·çš„, ä»¥åŠè¯¥æ€æ ·æ‰©å±•å’Œå®šåˆ¶åŒ– Servlet å®¹å™¨çš„åŠŸèƒ½")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_1-å·¥ä½œæµç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å·¥ä½œæµç¨‹"}},[s._v("#")]),s._v(" 1.å·¥ä½œæµç¨‹")]),s._v(" "),t("p",[t("strong",[s._v("å½“å®¢æˆ·è¯·æ±‚æŸä¸ªèµ„æºæ—¶, HTTP æœåŠ¡å™¨ä¼šç”¨ä¸€ä¸ª ServletRequest å¯¹è±¡æŠŠå®¢æˆ·çš„è¯·æ±‚ä¿¡æ¯å°è£…èµ·æ¥, ç„¶åè°ƒç”¨ Servlet å®¹å™¨çš„ service() æ–¹æ³•, Servlet å®¹å™¨æ‹¿åˆ°è¯·æ±‚å, æ ¹æ®è¯·æ±‚çš„ URL å’Œ Servlet çš„æ˜ å°„å…³ç³», æ‰¾åˆ°ç›¸åº”çš„ Servlet, å¦‚æœ Servlet è¿˜æ²¡æœ‰è¢«åŠ è½½, å°±ç”¨åå°„æœºåˆ¶åˆ›å»ºè¿™ä¸ª Servlet, å¹¶è°ƒç”¨ Servlet çš„ init() æ–¹æ³•æ¥å®Œæˆåˆå§‹åŒ–, æ¥ç€è°ƒç”¨ Servlet çš„ service() æ–¹æ³•æ¥å¤„ç†è¯·æ±‚, æŠŠ ServletResponse å¯¹è±¡è¿”å›ç»™ HTTP æœåŠ¡å™¨, HTTP æœåŠ¡å™¨ä¼šæŠŠå“åº”å‘é€ç»™å®¢æˆ·ç«¯")]),s._v(". åŒæ ·é€šè¿‡ä¸€å¼ å›¾æ¥å¸®åŠ©ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405160035-vakv9dj.jpg",alt:""}})]),s._v(" "),t("h6",{attrs:{id:"_2-webåº”ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-webåº”ç”¨"}},[s._v("#")]),s._v(" 2.Webåº”ç”¨")]),s._v(" "),t("p",[s._v("Servlet å®¹å™¨ä¼šå®ä¾‹åŒ–å’Œè°ƒç”¨ Servlet, é‚£ Servlet æ˜¯æ€ä¹ˆæ³¨å†Œåˆ° Servlet å®¹å™¨ä¸­çš„å‘¢? ä¸€èˆ¬æ¥è¯´æ˜¯ä»¥ Web åº”ç”¨ç¨‹åºçš„æ–¹å¼æ¥éƒ¨ç½² Servlet çš„, è€Œæ ¹æ® Servlet è§„èŒƒ, "),t("strong",[s._v("Web åº”ç”¨ç¨‹åºæœ‰ä¸€å®šçš„ç›®å½•ç»“æ„")]),s._v(", åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ†åˆ«æ”¾ç½®äº† Servlet çš„ç±»æ–‡ä»¶, é…ç½®æ–‡ä»¶ä»¥åŠé™æ€èµ„æº, Servlet å®¹å™¨é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶, å°±èƒ½æ‰¾åˆ°å¹¶åŠ è½½ Servlet. Web åº”ç”¨çš„ç›®å½•ç»“æ„å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("| -  MyWebApp\n      | -  WEB-INF/web.xml        -- é…ç½®æ–‡ä»¶, ç”¨æ¥é…ç½® Servlet ç­‰\n      | -  WEB-INF/lib/           -- å­˜æ”¾ Web åº”ç”¨æ‰€éœ€å„ç§ JAR åŒ…\n      | -  WEB-INF/classes/       -- å­˜æ”¾åº”ç”¨ç±», æ¯”å¦‚ Servlet ç±»\n      | -  META-INF/              -- ç›®å½•å­˜æ”¾å·¥ç¨‹çš„ä¸€äº›ä¿¡æ¯\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("Servlet è§„èŒƒé‡Œå®šä¹‰äº† "),t("strong",[s._v("ServletContext ** è¿™ä¸ªæ¥å£æ¥å¯¹åº”ä¸€ä¸ª Web åº”ç”¨. Web åº”ç”¨éƒ¨ç½²å¥½å, Servlet å®¹å™¨åœ¨å¯åŠ¨æ—¶ä¼šåŠ è½½ Web åº”ç”¨, å¹¶")]),s._v("ä¸ºæ¯ä¸ª Web åº”ç”¨åˆ›å»ºå”¯ä¸€çš„ ServletContext å¯¹è±¡**. å¯ä»¥æŠŠ ServletContext çœ‹æˆæ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡, ä¸€ä¸ª Web åº”ç”¨å¯èƒ½æœ‰å¤šä¸ª Servlet, è¿™äº› Servlet å¯ä»¥é€šè¿‡å…¨å±€çš„ ServletContext æ¥å…±äº«æ•°æ®, è¿™äº›æ•°æ®åŒ…æ‹¬ Web åº”ç”¨çš„åˆå§‹åŒ–å‚æ•°, Web åº”ç”¨ç›®å½•ä¸‹çš„æ–‡ä»¶èµ„æºç­‰. ç”±äº ServletContext æŒæœ‰æ‰€æœ‰ Servlet å®ä¾‹, è¿˜å¯ä»¥é€šè¿‡å®ƒæ¥å®ç° Servlet è¯·æ±‚çš„è½¬å‘.")]),s._v(" "),t("h6",{attrs:{id:"_3-æ‰©å±•æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ‰©å±•æœºåˆ¶"}},[s._v("#")]),s._v(" 3.æ‰©å±•æœºåˆ¶")]),s._v(" "),t("p",[s._v("å¼•å…¥äº† Servlet è§„èŒƒå, å°±ä¸éœ€è¦å…³å¿ƒ Socket ç½‘ç»œé€šä¿¡, ä¸éœ€è¦å…³å¿ƒ HTTP åè®®, ä¹Ÿä¸éœ€è¦å…³å¿ƒä¸šåŠ¡ç±»æ˜¯å¦‚ä½•è¢«å®ä¾‹åŒ–å’Œè°ƒç”¨çš„, å› ä¸ºè¿™äº›éƒ½è¢« "),t("strong",[s._v("Servlet è§„èŒƒæ ‡å‡†åŒ–")]),s._v("äº†, åªè¦å…³å¿ƒæ€ä¹ˆå®ç°ä¸šåŠ¡é€»è¾‘. è¿™å¯¹äºç¨‹åºå‘˜æ¥è¯´æ˜¯ä»¶å¥½äº‹, ä½†ä¹Ÿæœ‰ä¸æ–¹ä¾¿çš„ä¸€é¢. æ‰€è°“è§„èŒƒå°±æ˜¯è¯´å¤§å®¶éƒ½è¦éµå®ˆ, å°±ä¼šåƒç¯‡ä¸€å¾‹, ä½†æ˜¯å¦‚æœè¿™ä¸ªè§„èŒƒä¸èƒ½æ»¡è¶³ä¸šåŠ¡çš„ä¸ªæ€§åŒ–éœ€æ±‚, å°±æœ‰é—®é¢˜äº†, å› æ­¤"),t("strong",[s._v("è®¾è®¡ä¸€ä¸ªè§„èŒƒæˆ–è€…ä¸€ä¸ªä¸­é—´ä»¶, è¦å……åˆ†è€ƒè™‘åˆ°å¯æ‰©å±•æ€§")]),s._v(". Servlet è§„èŒƒæä¾›äº†ä¸¤ç§æ‰©å±•æœºåˆ¶: **Filter ** å’Œ "),t("strong",[s._v("Listener")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("Filter æ˜¯è¿‡æ»¤å™¨")]),s._v(", è¿™ä¸ªæ¥å£å…è®¸å¯¹è¯·æ±‚å’Œå“åº”åšä¸€äº›ç»Ÿä¸€çš„å®šåˆ¶åŒ–å¤„ç†, æ¯”å¦‚å¯ä»¥æ ¹æ®è¯·æ±‚çš„é¢‘ç‡æ¥é™åˆ¶è®¿é—®, æˆ–è€…æ ¹æ®å›½å®¶åœ°åŒºçš„ä¸åŒæ¥ä¿®æ”¹å“åº”å†…å®¹. è¿‡æ»¤å™¨çš„å·¥ä½œåŸç†æ˜¯è¿™æ ·çš„: Web åº”ç”¨éƒ¨ç½²å®Œæˆå, Servlet å®¹å™¨"),t("strong",[s._v("éœ€è¦å®ä¾‹åŒ– Filter å¹¶æŠŠ Filter é“¾æ¥æˆä¸€ä¸ª FilterChain. å½“è¯·æ±‚è¿›æ¥æ—¶, è·å–ç¬¬ä¸€ä¸ª Filter å¹¶è°ƒç”¨ doFilter() æ–¹æ³•, doFilter() æ–¹æ³•è´Ÿè´£è°ƒç”¨è¿™ä¸ª FilterChain ä¸­çš„ä¸‹ä¸€ä¸ª Filter")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("Listener æ˜¯ç›‘å¬å™¨")]),s._v(", è¿™æ˜¯å¦ä¸€ç§æ‰©å±•æœºåˆ¶. å½“ Web åº”ç”¨åœ¨ Servlet å®¹å™¨ä¸­è¿è¡Œæ—¶, Servlet å®¹å™¨å†…éƒ¨ä¼šä¸æ–­çš„å‘ç”Ÿå„ç§äº‹ä»¶, å¦‚ Web åº”ç”¨çš„å¯åŠ¨å’Œåœæ­¢, ç”¨æˆ·è¯·æ±‚åˆ°è¾¾ç­‰.  Servlet å®¹å™¨æä¾›äº†ä¸€äº›é»˜è®¤çš„ç›‘å¬å™¨æ¥ç›‘å¬è¿™äº›äº‹ä»¶, "),t("strong",[s._v("å½“äº‹ä»¶å‘ç”Ÿæ—¶, Servlet å®¹å™¨ä¼šè´Ÿè´£è°ƒç”¨ç›‘å¬å™¨çš„æ–¹æ³•")]),s._v(". å½“ç„¶, å¯ä»¥å®šä¹‰è‡ªå·±çš„ç›‘å¬å™¨å»ç›‘å¬æ„Ÿå…´è¶£çš„äº‹ä»¶, å°†ç›‘å¬å™¨é…ç½®åœ¨ web.xml ä¸­. æ¯”å¦‚ Spring å°±å®ç°äº†è‡ªå·±çš„ç›‘å¬å™¨, æ¥ç›‘å¬ ServletContext çš„å¯åŠ¨äº‹ä»¶, ç›®çš„æ˜¯å½“ Servlet å®¹å™¨å¯åŠ¨æ—¶, åˆ›å»ºå¹¶åˆå§‹åŒ–å…¨å±€çš„ Spring å®¹å™¨.")]),s._v(" "),t("p",[s._v("æ€»ç»“ä¸€ä¸‹ Filter å’Œ Listener çš„æœ¬è´¨åŒºåˆ«:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Filter æ˜¯å¹²é¢„è¿‡ç¨‹çš„")]),s._v(", å®ƒæ˜¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†, æ˜¯åŸºäºè¿‡ç¨‹è¡Œä¸ºçš„.")]),s._v(" "),t("li",[t("strong",[s._v("Listener æ˜¯åŸºäºçŠ¶æ€çš„")]),s._v(", ä»»ä½•è¡Œä¸ºæ”¹å˜åŒä¸€ä¸ªçŠ¶æ€, è§¦å‘çš„äº‹ä»¶æ˜¯ä¸€è‡´çš„.")])]),s._v(" "),t("h4",{attrs:{id:"_3-å®æˆ˜-è¿è¡Œä¸€ä¸ªservlet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-å®æˆ˜-è¿è¡Œä¸€ä¸ªservlet"}},[s._v("#")]),s._v(" 3.å®æˆ˜:è¿è¡Œä¸€ä¸ªServlet")]),s._v(" "),t("p",[s._v("ä»Šå¤©å°±æŠ›å¼ƒ IDE, æ‹’ç»æ¡†æ¶, è‡ªå·±çº¯æ‰‹å·¥ç¼–å†™ä¸€ä¸ª Servlet, å¹¶åœ¨ Tomcat ä¸­è¿è¡Œèµ·æ¥.")]),s._v(" "),t("p",[s._v("ä¸»è¦çš„æ­¥éª¤æœ‰:")]),s._v(" "),t("ol",[t("li",[s._v("ä¸‹è½½å¹¶å®‰è£… Tomcat.")]),s._v(" "),t("li",[s._v("ç¼–å†™ä¸€ä¸ªç»§æ‰¿ HttpServlet çš„ Java ç±».")]),s._v(" "),t("li",[s._v("å°† Java ç±»æ–‡ä»¶ç¼–è¯‘æˆ Class æ–‡ä»¶.")]),s._v(" "),t("li",[s._v("å»ºç«‹ Web åº”ç”¨çš„ç›®å½•ç»“æ„, å¹¶é…ç½® web.xml.")]),s._v(" "),t("li",[s._v("éƒ¨ç½² Web åº”ç”¨.")]),s._v(" "),t("li",[s._v("å¯åŠ¨ Tomcat.")]),s._v(" "),t("li",[s._v("æµè§ˆå™¨è®¿é—®éªŒè¯ç»“æœ.")]),s._v(" "),t("li",[s._v("æŸ¥çœ‹ Tomcat æ—¥å¿—.")])]),s._v(" "),t("p",[s._v("Servlet 3.0 è§„èŒƒæ”¯æŒç”¨æ³¨è§£çš„æ–¹å¼æ¥éƒ¨ç½² Servlet, ä¸éœ€è¦åœ¨ web.xml é‡Œé…ç½®, æœ€åä¼šæ¼”ç¤ºæ€ä¹ˆç”¨æ³¨è§£çš„æ–¹å¼æ¥éƒ¨ç½² Servlet.")]),s._v(" "),t("p",[t("strong",[s._v("1.ä¸‹è½½å¹¶å®‰è£…Tomcat")])]),s._v(" "),t("p",[s._v("æœ€æ–°ç‰ˆæœ¬çš„ Tomcat å¯ä»¥ç›´æ¥åœ¨"),t("a",{attrs:{href:"https://tomcat.apache.org/download-90.cgi",target:"_blank",rel:"noopener noreferrer"}},[s._v("å®˜ç½‘"),t("OutboundLink")],1),s._v("ä¸Šä¸‹è½½, æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿä¸‹è½½ç›¸åº”çš„ç‰ˆæœ¬, è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ Mac ç³»ç»Ÿ, ä¸‹è½½å®Œæˆåç›´æ¥è§£å‹, è§£å‹åçš„ç›®å½•ç»“æ„å¦‚ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405160901-fs7d46p.png",alt:""}})]),s._v(" "),t("p",[s._v("ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹è¿™äº›ç›®å½•:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("/bin")]),s._v(": å­˜æ”¾å¯åŠ¨å’Œå…³é—­ Tomcat çš„è„šæœ¬æ–‡ä»¶.")]),s._v(" "),t("li",[t("strong",[s._v("/conf")]),s._v(": å­˜æ”¾ Tomcat çš„å„ç§å…¨å±€é…ç½®æ–‡ä»¶, å…¶ä¸­æœ€é‡è¦çš„æ˜¯ "),t("strong",[s._v("server.xml")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("/lib")]),s._v(": å­˜æ”¾ "),t("strong",[s._v("Tomcat ä»¥åŠæ‰€æœ‰ Web åº”ç”¨éƒ½å¯ä»¥è®¿é—®çš„ JAR æ–‡ä»¶")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("/logs")]),s._v(": å­˜æ”¾ Tomcat æ‰§è¡Œæ—¶äº§ç”Ÿçš„æ—¥å¿—æ–‡ä»¶.")]),s._v(" "),t("li",[t("strong",[s._v("/work")]),s._v(": å­˜æ”¾ JSP ç¼–è¯‘åäº§ç”Ÿçš„ Class æ–‡ä»¶.")]),s._v(" "),t("li",[t("strong",[s._v("/webapps")]),s._v(": Tomcat çš„ "),t("strong",[s._v("Web åº”ç”¨ç›®å½•, é»˜è®¤æƒ…å†µä¸‹æŠŠ Web åº”ç”¨æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹")]),s._v(".")])]),s._v(" "),t("p",[t("strong",[s._v("2.ç¼–å†™ä¸€ä¸ªç»§æ‰¿HttpServletçš„Javaç±»")])]),s._v(" "),t("p",[s._v("ä¹‹å‰æåˆ°, å¯ä»¥é€šè¿‡ç»§æ‰¿ HttpServlet ç±»æ¥å®ç°è‡ªå·±çš„ Servlet åªéœ€è¦é‡å†™ä¸¤ä¸ªæ–¹æ³•: doGet() å’Œ doPost(). å› æ­¤è¿™é‡Œåˆ›å»ºä¸€ä¸ª Java ç±»å»ç»§æ‰¿ HttpServlet ç±», å¹¶é‡å†™ doGet() å’Œ doPost() æ–¹æ³•. é¦–å…ˆæ–°å»ºä¸€ä¸ªåä¸º MyServlet.java çš„æ–‡ä»¶, å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PrintWriter")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServlet")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyServlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MyServlet åœ¨å¤„ç† get()è¯·æ±‚..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PrintWriter")]),s._v(" out "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWriter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContentType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/html;charset=utf-8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<strong>My Servlet!</strong><br>"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doPost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MyServlet åœ¨å¤„ç† post()è¯·æ±‚..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PrintWriter")]),s._v(" out "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWriter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContentType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/html;charset=utf-8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<strong>My Servlet!</strong><br>"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[s._v("è¿™ä¸ª Servlet å®Œæˆçš„åŠŸèƒ½å¾ˆç®€å•, åˆ†åˆ«åœ¨ doGet() å’Œ doPost() æ–¹æ³•ä½“é‡Œè¿”å›ä¸€æ®µç®€å•çš„ HTML.")]),s._v(" "),t("p",[t("strong",[s._v("3.å°†Javaæ–‡ä»¶ç¼–è¯‘æˆClassæ–‡ä»¶")])]),s._v(" "),t("p",[s._v("ä¸‹ä¸€æ­¥éœ€è¦æŠŠ MyServlet.java æ–‡ä»¶ç¼–è¯‘æˆ Class æ–‡ä»¶. æ¥ç€éœ€è¦æŠŠ Tomcat /lib ç›®å½•ä¸‹çš„ servlet-api.jar æ‹·è´åˆ°å½“å‰ç›®å½•ä¸‹, è¿™æ˜¯å› ä¸º "),t("strong",[s._v("servlet-api.jar ä¸­å®šä¹‰äº† Servlet æ¥å£")]),s._v(", è€Œè‡ªå®šä¹‰çš„ Servlet ç±»å®ç°äº† Servlet æ¥å£, å› æ­¤ç¼–è¯‘ Servlet ç±»éœ€è¦è¿™ä¸ª JAR åŒ…. æ¥ç€æ‰§è¡Œç¼–è¯‘å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("javac -cp ./servlet-api.jar MyServlet.java\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç¼–è¯‘æˆåŠŸå, ä½ ä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ªå« MyServlet.class çš„æ–‡ä»¶.")]),s._v(" "),t("p",[t("strong",[s._v("4.å»ºç«‹Webåº”ç”¨çš„ç›®å½•ç»“æ„")])]),s._v(" "),t("p",[s._v("Servlet æ˜¯æ”¾åˆ° Web åº”ç”¨éƒ¨ç½²åˆ° Tomcat çš„, è€Œ Web åº”ç”¨å…·æœ‰ä¸€å®šçš„ç›®å½•ç»“æ„, æ‰€æœ‰æŒ‰ç…§è¦æ±‚å»ºç«‹ Web åº”ç”¨æ–‡ä»¶å¤¹, åå­—å« MyWebApp, ç„¶ååœ¨è¿™ä¸ªç›®å½•ä¸‹å»ºç«‹å­æ–‡ä»¶å¤¹, åƒä¸‹é¢è¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("MyWebApp/WEB-INF/web.xml\nMyWebApp/WEB-INF/classes/MyServlet.class\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("ç„¶ååœ¨ web.xml ä¸­é…ç½® Servlet, å†…å®¹å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token prolog"}},[s._v('<?xml version="1.0" encoding="UTF-8"?>')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("web-app")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("xmlns")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://xmlns.jcp.org/xml/ns/javaee"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("xmlns:")]),s._v("xsi")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://www.w3.org/2001/XMLSchema-instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("xsi:")]),s._v("schemaLocation")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://xmlns.jcp.org/xml/ns/javaee\n  http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("4.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("metadata-complete")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" Servlet Example. "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("display-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" MyServlet Example "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("display-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("request-character-encoding")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("UTF-8"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("request-character-encoding")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("servlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("servlet-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("myServlet"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("servlet-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("servlet-class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("MyServlet"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("servlet-class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("servlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("servlet-mapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("servlet-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("myServlet"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("servlet-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("url-pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("/myservlet"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("url-pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("servlet-mapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("web-app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°åœ¨ web.xml é…ç½®äº† Servlet çš„åå­—å’Œå…·ä½“çš„ç±», ä»¥åŠè¿™ä¸ª Servlet å¯¹åº”çš„ URL è·¯å¾„. æ³¨æ„ **servlet å’Œ servlet-mapping è¿™ä¸¤ä¸ªæ ‡ç­¾é‡Œçš„ servlet-name è¦ä¿æŒä¸€è‡´. **")]),s._v(" "),t("p",[t("strong",[s._v("5.éƒ¨ç½²Webåº”ç”¨")])]),s._v(" "),t("p",[s._v("Tomcat åº”ç”¨çš„éƒ¨ç½²éå¸¸ç®€å•, å°†è¿™ä¸ªç›®å½• MyWebApp æ‹·è´åˆ° Tomcat çš„å®‰è£…ç›®å½•ä¸‹çš„ webapps ç›®å½•å³å¯.")]),s._v(" "),t("p",[t("strong",[s._v("6.å¯åŠ¨Tomcat")])]),s._v(" "),t("p",[s._v("æ‰¾åˆ° Tomcat å®‰è£…ç›®å½•ä¸‹çš„ bin ç›®å½•, æ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒ, æ‰§è¡Œç›¸åº”çš„å¯åŠ¨è„šæœ¬. Linux ç³»ç»Ÿåˆ™æ‰§è¡Œ "),t("code",[s._v("startup.sh")]),s._v("â€‹.")]),s._v(" "),t("p",[t("strong",[s._v("7.æµè§ˆè®¿é—®éªŒè¯ç»“æœ")])]),s._v(" "),t("p",[s._v("åœ¨æµè§ˆå™¨é‡Œè®¿é—®è¿™ä¸ª URL: "),t("code",[s._v("http://localhost:8080/MyWebApp/myservlet")]),s._v("â€‹, ä¼šå¾—åˆ°:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("My Servlet!\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„, è®¿é—® URL è·¯å¾„ä¸­çš„ MyWebApp æ˜¯ Web åº”ç”¨çš„åå­—, myservlet æ˜¯åœ¨ web.xml é‡Œé…ç½®çš„ Servlet çš„è·¯å¾„.")]),s._v(" "),t("p",[t("strong",[s._v("8.æŸ¥çœ‹Tomcatæ—¥å¿—")])]),s._v(" "),t("p",[s._v("æ‰“å¼€ Tomcat çš„æ—¥å¿—ç›®å½•, ä¹Ÿå°±æ˜¯ Tomcat å®‰è£…ç›®å½•ä¸‹çš„ logs ç›®å½•. Tomcat çš„æ—¥å¿—ä¿¡æ¯åˆ†ä¸ºä¸¤ç±»: ä¸€æ˜¯è¿è¡Œæ—¥å¿—, å®ƒä¸»è¦è®°å½•è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›ä¿¡æ¯, å°¤å…¶æ˜¯ä¸€äº›å¼‚å¸¸é”™è¯¯æ—¥å¿—ä¿¡æ¯; äºŒæ˜¯è®¿é—®æ—¥å¿—, å®ƒè®°å½•è®¿é—®çš„æ—¶é—´, IP åœ°å€, è®¿é—®çš„è·¯å¾„ç­‰ç›¸å…³ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("è¿™é‡Œç®€è¦ä»‹ç»å„ä¸ªæ–‡ä»¶çš„å«ä¹‰.")]),s._v(" "),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v("catalina.***.log")]),s._v("â€‹")])]),s._v(" "),t("p",[s._v("ä¸»è¦æ˜¯è®°å½• Tomcat å¯åŠ¨è¿‡ç¨‹çš„ä¿¡æ¯, åœ¨è¿™ä¸ªæ–‡ä»¶å¯ä»¥çœ‹åˆ°å¯åŠ¨çš„ JVM å‚æ•°ä»¥åŠæ“ä½œç³»ç»Ÿç­‰æ—¥å¿—ä¿¡æ¯.")]),s._v(" "),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v("catalina.out")]),s._v("â€‹")])]),s._v(" "),t("p",[s._v('catalina.out æ˜¯ Tomcat çš„æ ‡å‡†è¾“å‡º(stdout)å’Œæ ‡å‡†é”™è¯¯(stderr), è¿™æ˜¯åœ¨ Tomcat çš„å¯åŠ¨è„šæœ¬é‡ŒæŒ‡å®šçš„, å¦‚æœæ²¡æœ‰ä¿®æ”¹çš„è¯ stdout å’Œ stderr ä¼šé‡å®šå‘åˆ°è¿™é‡Œ. æ‰€ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå¯ä»¥çœ‹åˆ°åœ¨ MyServlet.java ç¨‹åºé‡Œæ‰“å°å‡ºæ¥çš„ä¿¡æ¯: "MyServlet åœ¨å¤„ç† get() è¯·æ±‚..."')]),s._v(" "),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v("localhost.**.log")]),s._v("â€‹")])]),s._v(" "),t("p",[s._v("ä¸»è¦è®°å½• Web åº”ç”¨åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­é‡åˆ°çš„æœªå¤„ç†çš„å¼‚å¸¸, ä¼šè¢« Tomcat æ•è·è€Œè¾“å‡ºè¿™ä¸ªæ—¥å¿—æ–‡ä»¶.")]),s._v(" "),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v("localhost_access_log.**.txt")]),s._v("â€‹")])]),s._v(" "),t("p",[s._v("å­˜æ”¾è®¿é—® Tomcat çš„è¯·æ±‚æ—¥å¿—, åŒ…æ‹¬ IP åœ°å€ä»¥åŠè¯·æ±‚çš„è·¯å¾„, æ—¶é—´, è¯·æ±‚åè®®ä»¥åŠçŠ¶æ€ç ç­‰ä¿¡æ¯.")]),s._v(" "),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v("manager.***.log/host-manager.***.log")]),s._v("â€‹")])]),s._v(" "),t("p",[s._v("å­˜æ”¾ Tomcat è‡ªå¸¦çš„ manager é¡¹ç›®çš„æ—¥å¿—ä¿¡æ¯.")]),s._v(" "),t("p",[t("strong",[s._v("9.ç”¨æ³¨è§£çš„æ–¹å¼éƒ¨ç½²Servlet")])]),s._v(" "),t("p",[s._v("ä¸ºäº†æ¼”ç¤ºç”¨æ³¨è§£çš„æ–¹å¼æ¥éƒ¨ç½² Servlet, é¦–å…ˆä¿®æ”¹ Java ä»£ç , ç»™ Servlet ç±»åŠ ä¸Š  **@WebServlet ** æ³¨è§£, ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PrintWriter")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServlet")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServlet")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@WebServlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/myAnnotationServlet"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AnnotationServlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AnnotationServlet åœ¨å¤„ç† get()è¯·æ±‚..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PrintWriter")]),s._v(" out "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWriter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContentType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/html; charset=utf-8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<strong>Annotation Servlet!</strong><br>"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doPost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AnnotationServlet åœ¨å¤„ç† post()è¯·æ±‚..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PrintWriter")]),s._v(" out "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWriter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContentType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/html; charset=utf-8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<strong>Annotation Servlet!</strong><br>"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("è¿™æ®µä»£ç é‡Œæœ€å…³é”®çš„å°±æ˜¯è¿™ä¸ªæ³¨è§£, å®ƒè¡¨æ˜ä¸¤å±‚æ„æ€: ç¬¬ä¸€å±‚æ„æ€æ˜¯ AnnotationServlet è¿™ä¸ª Java ç±»æ˜¯ä¸€ä¸ª Servlet, ç¬¬äºŒå±‚æ„æ€æ˜¯è¿™ä¸ª Servlet å¯¹åº”çš„ URL è·¯å¾„æ˜¯ myAnnotationServlet.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('@WebServlet("/myAnnotationServlet")\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("åˆ›å»ºå¥½ Java ç±»ä»¥å, åŒæ ·ç»è¿‡ç¼–è¯‘, å¹¶æ”¾åˆ° MyWebApp çš„ class ç›®å½•ä¸‹. è¿™é‡Œè¦æ³¨æ„çš„æ˜¯, "),t("strong",[s._v("éœ€è¦åˆ é™¤ä¹‹å‰çš„ web.xml")]),s._v(", å› ä¸ºä¸éœ€è¦ web.xml æ¥é…ç½® Servlet äº†. ç„¶åé‡å¯ Tomcat, æ¥ä¸‹æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªæ–°çš„ AnnotationServlet æœ‰æ²¡æœ‰éƒ¨ç½²æˆåŠŸ. åœ¨æµè§ˆå™¨é‡Œè¾“å…¥: "),t("code",[s._v("http://localhost:8080/MyWebApp/myAnnotationServlet")]),s._v("â€‹, å¾—åˆ°ç»“æœ:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Annotation Servlet!\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™è¯´æ˜ AnnotationServlet éƒ¨ç½²æˆåŠŸäº†. å¯ä»¥é€šè¿‡æ³¨è§£å®Œæˆ web.xml æ‰€æœ‰çš„é…ç½®åŠŸèƒ½, åŒ…æ‹¬ Servlet åˆå§‹åŒ–å‚æ•°ä»¥åŠé…ç½® Filter å’Œ Listener ç­‰.")]),s._v(" "),t("h3",{attrs:{id:"æ•´ä½“æ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•´ä½“æ¶æ„"}},[s._v("#")]),s._v(" æ•´ä½“æ¶æ„")]),s._v(" "),t("h4",{attrs:{id:"_4-tomcatç³»ç»Ÿæ¶æ„-è¿æ¥å™¨å’Œå®¹å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-tomcatç³»ç»Ÿæ¶æ„-è¿æ¥å™¨å’Œå®¹å™¨"}},[s._v("#")]),s._v(" 4.Tomcatç³»ç»Ÿæ¶æ„:è¿æ¥å™¨å’Œå®¹å™¨")]),s._v(" "),t("p",[s._v("è¿™é‡Œä¸€æ­¥ä¸€æ­¥åˆ†æ Tomcat çš„è®¾è®¡æ€è·¯, çœ‹çœ‹ Tomcat çš„è®¾è®¡è€…ä»¬å½“æ—¶æ˜¯æ€ä¹ˆå›ç­”è¿™ä¸ªé—®é¢˜çš„. ä¸€æ–¹é¢å¯ä»¥å­¦åˆ° Tomcat çš„æ€»ä½“æ¶æ„, å­¦ä¼šä»å®è§‚ä¸Šæ€ä¹ˆå»è®¾è®¡ä¸€ä¸ªå¤æ‚ç³»ç»Ÿ, æ€ä¹ˆè®¾è®¡é¡¶å±‚æ¨¡å—, ä»¥åŠæ¨¡å—ä¹‹é—´çš„å…³ç³»; å¦ä¸€æ–¹é¢ä¹Ÿä¸ºæ·±å…¥å­¦ä¹  Tomcat çš„å·¥ä½œåŸç†æ‰“ä¸‹åŸºç¡€.")]),s._v(" "),t("h5",{attrs:{id:"tomcatæ€»ä½“æ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatæ€»ä½“æ¶æ„"}},[s._v("#")]),s._v(" Tomcatæ€»ä½“æ¶æ„")]),s._v(" "),t("p",[s._v("å¦‚æœè¦è®¾è®¡ä¸€ä¸ªç³»ç»Ÿ, é¦–å…ˆæ˜¯è¦äº†è§£éœ€æ±‚. å‰é¢å·²ç»äº†è§£äº† Tomcat è¦å®ç° 2 ä¸ªæ ¸å¿ƒåŠŸèƒ½:")]),s._v(" "),t("ul",[t("li",[s._v("å¤„ç† Socket è¿æ¥, è´Ÿè´£ç½‘ç»œå­—èŠ‚æµä¸ Request å’Œ Response å¯¹è±¡çš„è½¬åŒ–.")]),s._v(" "),t("li",[s._v("åŠ è½½å’Œç®¡ç† Servlet, ä»¥åŠå…·ä½“å¤„ç† Request è¯·æ±‚.")])]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("å› æ­¤ Tomcat è®¾è®¡äº†ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶è¿æ¥å™¨(Connector)å’Œå®¹å™¨(Container)æ¥åˆ†åˆ«åšè¿™ä¸¤ä»¶äº‹æƒ…. è¿æ¥å™¨è´Ÿè´£å¯¹å¤–äº¤æµ, å®¹å™¨è´Ÿè´£å†…éƒ¨å¤„ç†")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("åœ¨å¼€å§‹åˆ†æè¿æ¥å™¨å‰, å…ˆé“ºå«ä¸€ä¸‹ Tomcat æ”¯æŒçš„å¤šç§ I/O æ¨¡å‹å’Œåº”ç”¨å±‚åè®®.")]),s._v(" "),t("p",[s._v("Tomcat æ”¯æŒçš„ I/O æ¨¡å‹æœ‰:")]),s._v(" "),t("ul",[t("li",[s._v("NIO: éé˜»å¡ I/O, é‡‡ç”¨ Java NIO ç±»åº“å®ç°.")]),s._v(" "),t("li",[s._v("NIO2: å¼‚æ­¥ I/O, é‡‡ç”¨ JDK 7 æœ€æ–°çš„ NIO2 ç±»åº“å®ç°.")]),s._v(" "),t("li",[s._v("APR: é‡‡ç”¨ Apache å¯ç§»æ¤è¿è¡Œåº“å®ç°, æ˜¯ C/C++ ç¼–å†™çš„æœ¬åœ°åº“.")])]),s._v(" "),t("p",[s._v("Tomcat æ”¯æŒçš„åº”ç”¨å±‚åè®®æœ‰:")]),s._v(" "),t("ul",[t("li",[s._v("HTTP/1.1: è¿™æ˜¯å¤§éƒ¨åˆ† Web åº”ç”¨é‡‡ç”¨çš„è®¿é—®åè®®.")]),s._v(" "),t("li",[s._v("AJP: ç”¨äºå’Œ Web æœåŠ¡å™¨é›†æˆ(å¦‚ Apache).")]),s._v(" "),t("li",[s._v("HTTP/2: HTTP 2.0 å¤§å¹…åº¦çš„æå‡äº† Web æ€§èƒ½.")])]),s._v(" "),t("p",[s._v("**Tomcat ä¸ºäº†å®ç°æ”¯æŒå¤šç§ I/O æ¨¡å‹å’Œåº”ç”¨å±‚åè®®, ä¸€ä¸ªå®¹å™¨å¯èƒ½å¯¹æ¥å¤šä¸ªè¿æ¥å™¨, å°±å¥½æ¯”ä¸€ä¸ªæˆ¿é—´æœ‰å¤šä¸ªé—¨. ä½†æ˜¯å•ç‹¬çš„è¿æ¥å™¨æˆ–è€…å®¹å™¨éƒ½ä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡, éœ€è¦æŠŠå®ƒä»¬ç»„è£…èµ·æ¥æ‰èƒ½å·¥ä½œ, ç»„è£…åè¿™ä¸ªæ•´ä½“å«ä½œ Service ç»„ä»¶. æ³¨æ„, Service æœ¬èº«æ²¡æœ‰åšä»€ä¹ˆé‡è¦çš„äº‹æƒ…, åªæ˜¯åœ¨è¿æ¥å™¨å’Œå®¹å™¨å¤–é¢å¤šåŒ…äº†ä¸€å±‚, æŠŠå®ƒä»¬ç»„è£…åœ¨ä¸€èµ·. Tomcat å†…å¯èƒ½æœ‰å¤šä¸ª Service, è¿™æ ·çš„è®¾è®¡ä¹Ÿæ˜¯å‡ºäºçµæ´»æ€§çš„è€ƒè™‘. é€šè¿‡åœ¨ Tomcat ä¸­é…ç½®å¤šä¸ª Service, å¯ä»¥å®ç°é€šè¿‡ä¸åŒçš„ç«¯å£å·æ¥è®¿é—®åŒä¸€å°æœºå™¨ä¸Šéƒ¨ç½²çš„ä¸åŒåº”ç”¨. **")]),s._v(" "),t("p",[s._v("åˆ°æ­¤å¾—åˆ°è¿™æ ·ä¸€å¼ å…³ç³»å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405160950-u1ygbo1.jpg",alt:""}})]),s._v(" "),t("p",[s._v("**å›¾ä¸­æœ€é¡¶å±‚æ˜¯ Server, è¿™é‡Œçš„ Server æŒ‡çš„å°±æ˜¯ä¸€ä¸ª Tomcat å®ä¾‹. ä¸€ä¸ª Server ä¸­æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª Service, ä¸€ä¸ª Service ä¸­æœ‰å¤šä¸ªè¿æ¥å™¨å’Œä¸€ä¸ªå®¹å™¨. è¿æ¥å™¨ä¸å®¹å™¨ä¹‹é—´é€šè¿‡æ ‡å‡†çš„ ServletRequest å’Œ ServletResponse é€šä¿¡. **")]),s._v(" "),t("p",[s._v("ä¸‹é¢åˆ†åˆ«è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿æ¥å™¨å’Œå®¹å™¨.")]),s._v(" "),t("h5",{attrs:{id:"è¿æ¥å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥å™¨"}},[s._v("#")]),s._v(" è¿æ¥å™¨")]),s._v(" "),t("p",[s._v("**è¿æ¥å™¨å¯¹ Servlet å®¹å™¨å±è”½äº†åè®®åŠ I/O æ¨¡å‹ç­‰çš„åŒºåˆ«, æ— è®ºæ˜¯ HTTP è¿˜æ˜¯ AJP, åœ¨å®¹å™¨ä¸­è·å–åˆ°çš„éƒ½æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ ServletRequest å¯¹è±¡. **")]),s._v(" "),t("p",[s._v("å¯ä»¥æŠŠè¿æ¥å™¨çš„åŠŸèƒ½éœ€æ±‚è¿›ä¸€æ­¥ç»†åŒ–, æ¯”å¦‚:")]),s._v(" "),t("ul",[t("li",[s._v("ç›‘å¬ç½‘ç»œç«¯å£.")]),s._v(" "),t("li",[s._v("æ¥å—ç½‘ç»œè¿æ¥è¯·æ±‚.")]),s._v(" "),t("li",[s._v("è¯»å–è¯·æ±‚ç½‘ç»œå­—èŠ‚æµ.")]),s._v(" "),t("li",[s._v("æ ¹æ®å…·ä½“åº”ç”¨å±‚åè®®(HTTP/AJP)è§£æå­—èŠ‚æµ, ç”Ÿæˆç»Ÿä¸€çš„ Tomcat Request å¯¹è±¡.")]),s._v(" "),t("li",[s._v("å°† Tomcat Request å¯¹è±¡è½¬æˆæ ‡å‡†çš„ ServletRequest.")]),s._v(" "),t("li",[s._v("è°ƒç”¨ Servlet å®¹å™¨, å¾—åˆ° ServletResponse.")]),s._v(" "),t("li",[s._v("å°† ServletResponse è½¬æˆ Tomcat Response å¯¹è±¡.")]),s._v(" "),t("li",[s._v("å°† Tomcat Response è½¬æˆç½‘ç»œå­—èŠ‚æµ.")]),s._v(" "),t("li",[s._v("å°†å“åº”å­—èŠ‚æµå†™å›ç»™æµè§ˆå™¨.")])]),s._v(" "),t("p",[s._v("éœ€æ±‚åˆ—æ¸…æ¥šåè¦è€ƒè™‘çš„ä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯, è¿æ¥å™¨åº”è¯¥æœ‰å“ªäº›å­æ¨¡å—? ä¼˜ç§€çš„æ¨¡å—åŒ–è®¾è®¡åº”è¯¥è€ƒè™‘"),t("strong",[s._v("é«˜å†…èš, ä½è€¦åˆ")]),s._v(".")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("é«˜å†…èš")]),s._v("æ˜¯æŒ‡ç›¸å…³åº¦æ¯”è¾ƒé«˜çš„åŠŸèƒ½è¦å°½å¯èƒ½é›†ä¸­, ä¸è¦åˆ†æ•£.")]),s._v(" "),t("li",[t("strong",[s._v("ä½è€¦åˆ")]),s._v("æ˜¯æŒ‡ä¸¤ä¸ªç›¸å…³çš„æ¨¡å—è¦å°½å¯èƒ½å‡å°‘ä¾èµ–çš„éƒ¨åˆ†å’Œé™ä½ä¾èµ–çš„ç¨‹åº¦, ä¸è¦è®©ä¸¤ä¸ªæ¨¡å—äº§ç”Ÿå¼ºä¾èµ–.")])]),s._v(" "),t("p",[s._v("é€šè¿‡åˆ†æè¿æ¥å™¨çš„è¯¦ç»†åŠŸèƒ½åˆ—è¡¨, å¯ä»¥å‘ç°è¿æ¥å™¨éœ€è¦å®Œæˆ 3 ä¸ª"),t("strong",[s._v("é«˜å†…èš")]),s._v("çš„åŠŸèƒ½:")]),s._v(" "),t("ul",[t("li",[s._v("ç½‘ç»œé€šä¿¡.")]),s._v(" "),t("li",[s._v("åº”ç”¨å±‚åè®®è§£æ.")]),s._v(" "),t("li",[s._v("Tomcat Request/Response ä¸ ServletRequest/ServletResponse çš„è½¬åŒ–.")])]),s._v(" "),t("p",[s._v("**å› æ­¤ Tomcat çš„è®¾è®¡è€…è®¾è®¡äº† 3 ä¸ªç»„ä»¶æ¥å®ç°è¿™ 3 ä¸ªåŠŸèƒ½, åˆ†åˆ«æ˜¯ EndPoint, Processor å’Œ Adapter. **")]),s._v(" "),t("p",[s._v("ç»„ä»¶ä¹‹é—´é€šè¿‡æŠ½è±¡æ¥å£äº¤äº’. è¿™æ ·åšè¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯**å°è£…å˜åŒ–. ** è¿™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ç²¾é«“, å°†ç³»ç»Ÿä¸­ç»å¸¸å˜åŒ–çš„éƒ¨åˆ†å’Œç¨³å®šçš„éƒ¨åˆ†éš”ç¦», æœ‰åŠ©äºå¢åŠ å¤ç”¨æ€§, å¹¶é™ä½ç³»ç»Ÿè€¦åˆåº¦.")]),s._v(" "),t("p",[s._v("ç½‘ç»œé€šä¿¡çš„ I/O æ¨¡å‹æ˜¯å˜åŒ–çš„, å¯èƒ½æ˜¯éé˜»å¡ I/O, å¼‚æ­¥ I/O æˆ–è€… APR. åº”ç”¨å±‚åè®®ä¹Ÿæ˜¯å˜åŒ–çš„, å¯èƒ½æ˜¯ HTTP, HTTPS, AJP. æµè§ˆå™¨ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯ä¹Ÿæ˜¯å˜åŒ–çš„.")]),s._v(" "),t("p",[s._v("**ä½†æ˜¯æ•´ä½“çš„å¤„ç†é€»è¾‘æ˜¯ä¸å˜çš„, EndPoint è´Ÿè´£æä¾›å­—èŠ‚æµç»™ Processor, Processor è´Ÿè´£æä¾› Tomcat Request å¯¹è±¡ç»™ Adapter, Adapter è´Ÿè´£æä¾› ServletRequest å¯¹è±¡ç»™å®¹å™¨. **")]),s._v(" "),t("p",[s._v("å¦‚æœè¦æ”¯æŒæ–°çš„ I/O æ–¹æ¡ˆ, æ–°çš„åº”ç”¨å±‚åè®®, åªéœ€è¦å®ç°ç›¸å…³çš„å…·ä½“å­ç±», ä¸Šå±‚é€šç”¨çš„å¤„ç†é€»è¾‘æ˜¯ä¸å˜çš„.")]),s._v(" "),t("p",[s._v("ç”±äº I/O æ¨¡å‹å’Œåº”ç”¨å±‚åè®®å¯ä»¥è‡ªç”±ç»„åˆ, æ¯”å¦‚ NIO + HTTP æˆ–è€… NIO2 + AJP. Tomcat çš„è®¾è®¡è€…å°†ç½‘ç»œé€šä¿¡å’Œåº”ç”¨å±‚åè®®è§£ææ”¾åœ¨ä¸€èµ·è€ƒè™‘, è®¾è®¡äº†ä¸€ä¸ªå« "),t("strong",[s._v("ProtocolHandler çš„æ¥å£æ¥å°è£…è¿™ä¸¤ç§å˜åŒ–ç‚¹. å„ç§åè®®å’Œé€šä¿¡æ¨¡å‹çš„ç»„åˆæœ‰ç›¸åº”çš„å…·ä½“å®ç°ç±». æ¯”å¦‚: Http11NioProtocol å’Œ AjpNioProtocol")]),s._v(".")]),s._v(" "),t("p",[s._v("é™¤äº†è¿™äº›å˜åŒ–ç‚¹, ç³»ç»Ÿä¹Ÿå­˜åœ¨ä¸€äº›ç›¸å¯¹ç¨³å®šçš„éƒ¨åˆ†, å› æ­¤ Tomcat è®¾è®¡äº†ä¸€ç³»åˆ—æŠ½è±¡åŸºç±»æ¥"),t("strong",[s._v("å°è£…è¿™äº›ç¨³å®šçš„éƒ¨åˆ†")]),s._v(", æŠ½è±¡åŸºç±» "),t("strong",[s._v("AbstractProtocol")]),s._v(" å®ç°äº† ProtocolHandler æ¥å£. æ¯ä¸€ç§åº”ç”¨å±‚åè®®æœ‰è‡ªå·±çš„æŠ½è±¡åŸºç±», æ¯”å¦‚ AbstractAjpProtocol å’Œ AbstractHttp11Protocol, å…·ä½“åè®®çš„å®ç°ç±»æ‰©å±•äº†åè®®å±‚æŠ½è±¡åŸºç±». ä¸‹é¢æ•´ç†ä¸€ä¸‹å®ƒä»¬çš„ç»§æ‰¿å…³ç³».")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405160950-36cmbgl.jpg",alt:""}})]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šé¢çš„å›¾å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°å®ƒä»¬çš„ç»§æ‰¿å’Œå±‚æ¬¡å…³ç³», è¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯"),t("strong",[s._v("å°½é‡å°†ç¨³å®šçš„éƒ¨åˆ†æ”¾åˆ°æŠ½è±¡åŸºç±»")]),s._v(", åŒæ—¶æ¯ä¸€ç§ I/O æ¨¡å‹å’Œåè®®çš„ç»„åˆéƒ½æœ‰ç›¸åº”çš„å…·ä½“å®ç°ç±», åœ¨ä½¿ç”¨æ—¶å°±å¯ä»¥è‡ªç”±é€‰æ‹©.")]),s._v(" "),t("p",[s._v("å°ç»“ä¸€ä¸‹, è¿æ¥å™¨æ¨¡å—ç”¨ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶: Endpoint, Processor å’Œ Adapter æ¥åˆ†åˆ«åšä¸‰ä»¶äº‹æƒ…, å…¶ä¸­ Endpoint å’Œ Processor æ”¾åœ¨ä¸€èµ·æŠ½è±¡æˆäº† ProtocolHandler ç»„ä»¶, å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405160951-h8go2yh.jpg",alt:""}})]),s._v(" "),t("p",[s._v("ä¸‹é¢è¯¦ç»†ä»‹ç»è¿™ä¸¤ä¸ªé¡¶å±‚ç»„ä»¶ ProtocolHandler å’Œ Adapter.")]),s._v(" "),t("h6",{attrs:{id:"_1-protocolhandlerç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-protocolhandlerç»„ä»¶"}},[s._v("#")]),s._v(" 1.ProtocolHandlerç»„ä»¶")]),s._v(" "),t("p",[s._v("ä»å‰é¢å¯çŸ¥, "),t("strong",[s._v("è¿æ¥å™¨ç”¨ ProtocolHandler æ¥å¤„ç†ç½‘ç»œè¿æ¥å’Œåº”ç”¨å±‚åè®®, åŒ…å«äº† 2 ä¸ªé‡è¦éƒ¨ä»¶: EndPoint å’Œ Processor")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("(1)EndPoint")])]),s._v(" "),t("p",[s._v("EndPoint æ˜¯é€šä¿¡ç«¯ç‚¹, å³é€šä¿¡ç›‘å¬çš„æ¥å£, æ˜¯å…·ä½“çš„ Socket æ¥æ”¶å’Œå‘é€å¤„ç†å™¨, æ˜¯å¯¹ä¼ è¾“å±‚çš„æŠ½è±¡, å› æ­¤ "),t("strong",[s._v("EndPoint æ˜¯ç”¨æ¥å®ç° TCP/IP åè®®")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("EndPoint æ˜¯ä¸€ä¸ªæ¥å£, å¯¹åº”çš„æŠ½è±¡å®ç°ç±»æ˜¯ AbstractEndpoint, è€Œ AbstractEndpoint çš„å…·ä½“å­ç±», æ¯”å¦‚åœ¨ NioEndpoint å’Œ Nio2Endpoint ä¸­, æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç»„ä»¶: "),t("strong",[s._v("Acceptor å’Œ SocketProcessor")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶ä¸­ Acceptor ç”¨äºç›‘å¬ Socket è¿æ¥è¯·æ±‚. SocketProcessor ç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„ Socket è¯·æ±‚, å®ƒå®ç° Runnable æ¥å£, åœ¨ Run æ–¹æ³•é‡Œè°ƒç”¨åè®®å¤„ç†ç»„ä»¶ Processor è¿›è¡Œå¤„ç†. ä¸ºäº†æé«˜å¤„ç†èƒ½åŠ›, SocketProcessor è¢«æäº¤åˆ°çº¿ç¨‹æ± æ¥æ‰§è¡Œ. è€Œè¿™ä¸ªçº¿ç¨‹æ± å«ä½œæ‰§è¡Œå™¨(Executor), åé¢ä¼šè¯¦ç»†ä»‹ç» Tomcat å¦‚ä½•æ‰©å±•åŸç”Ÿçš„ Java çº¿ç¨‹æ± .")]),s._v(" "),t("p",[t("strong",[s._v("(2)Processor")])]),s._v(" "),t("p",[s._v("å¦‚æœè¯´ EndPoint æ˜¯ç”¨æ¥å®ç° TCP/IP åè®®çš„, é‚£ä¹ˆ "),t("strong",[s._v("Processor ç”¨æ¥å®ç° HTTP åè®®")]),s._v(", Processor æ¥æ”¶æ¥è‡ª EndPoint çš„ Socket, è¯»å–å­—èŠ‚æµè§£ææˆ Tomcat Request å’Œ Response å¯¹è±¡, å¹¶é€šè¿‡ Adapter å°†å…¶æäº¤åˆ°å®¹å™¨å¤„ç†, Processor æ˜¯å¯¹åº”ç”¨å±‚åè®®çš„æŠ½è±¡.")]),s._v(" "),t("p",[s._v("Processor æ˜¯ä¸€ä¸ªæ¥å£, å®šä¹‰äº†è¯·æ±‚çš„å¤„ç†ç­‰æ–¹æ³•. å®ƒçš„æŠ½è±¡å®ç°ç±» AbstractProcessor å¯¹ä¸€äº›åè®®å…±æœ‰çš„å±æ€§è¿›è¡Œå°è£…, æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡Œå®ç°. å…·ä½“çš„å®ç°æœ‰ AJPProcessor, HTTP11Processor ç­‰, è¿™äº›å…·ä½“å®ç°ç±»å®ç°äº†ç‰¹å®šåè®®çš„è§£ææ–¹æ³•å’Œè¯·æ±‚å¤„ç†æ–¹å¼.")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹çœ‹è¿æ¥å™¨çš„ç»„ä»¶å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405160951-uuujwdk.jpg",alt:""}})]),s._v(" "),t("p",[s._v("ä»å›¾ä¸­çœ‹åˆ°, "),t("strong",[s._v("EndPoint æ¥æ”¶åˆ° Socket è¿æ¥å, ç”Ÿæˆä¸€ä¸ª SocketProcessor ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± å»å¤„ç†, SocketProcessor çš„ Run æ–¹æ³•ä¼šè°ƒç”¨ Processor ç»„ä»¶å»è§£æåº”ç”¨å±‚åè®®, Processor é€šè¿‡è§£æç”Ÿæˆ Request å¯¹è±¡å, ä¼šè°ƒç”¨ Adapter çš„ Service æ–¹æ³•")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_2-adapterç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-adapterç»„ä»¶"}},[s._v("#")]),s._v(" 2.Adapterç»„ä»¶")]),s._v(" "),t("p",[s._v("ç”±äºåè®®ä¸åŒ, å®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚ä¿¡æ¯ä¹Ÿä¸å°½ç›¸åŒ, Tomcat å®šä¹‰äº†è‡ªå·±çš„ "),t("strong",[s._v("Request")]),s._v(" ç±»æ¥â€œå­˜æ”¾â€è¿™äº›è¯·æ±‚ä¿¡æ¯. "),t("strong",[s._v("ProtocolHandler æ¥å£è´Ÿè´£è§£æè¯·æ±‚å¹¶ç”Ÿæˆ Tomcat Request ç±». ** ä½†æ˜¯è¿™ä¸ª Request å¯¹è±¡ä¸æ˜¯æ ‡å‡†çš„ ServletRequest, ä¹Ÿå°±æ„å‘³ç€, ä¸èƒ½ç”¨ Tomcat Request ä½œä¸ºå‚æ•°æ¥è°ƒç”¨å®¹å™¨. Tomcat è®¾è®¡è€…çš„è§£å†³æ–¹æ¡ˆæ˜¯")]),s._v("å¼•å…¥ CoyoteAdapter, è¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„ç»å…¸è¿ç”¨, è¿æ¥å™¨è°ƒç”¨ CoyoteAdapter çš„ Sevice æ–¹æ³•, ä¼ å…¥çš„æ˜¯ Tomcat Request å¯¹è±¡, CoyoteAdapter è´Ÿè´£å°† Tomcat Request è½¬æˆ ServletRequest, å†è°ƒç”¨å®¹å™¨çš„ Service æ–¹æ³•**.")]),s._v(" "),t("h5",{attrs:{id:"å®¹å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®¹å™¨"}},[s._v("#")]),s._v(" å®¹å™¨")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ° Tomcat æœ‰ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶: "),t("strong",[s._v("è¿æ¥å™¨å’Œå®¹å™¨")]),s._v(", å…¶ä¸­è¿æ¥å™¨è´Ÿè´£å¤–éƒ¨äº¤æµ, å®¹å™¨è´Ÿè´£å†…éƒ¨å¤„ç†. å…·ä½“æ¥è¯´å°±æ˜¯, è¿æ¥å™¨å¤„ç† Socket é€šä¿¡å’Œåº”ç”¨å±‚åè®®çš„è§£æ, å¾—åˆ° Servlet è¯·æ±‚; è€Œå®¹å™¨åˆ™è´Ÿè´£å¤„ç† Servlet è¯·æ±‚.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161017-eu8rf7s.jpg",alt:""}})]),s._v(" "),t("p",[s._v("è¿™é‡Œåˆ†æä¸€ä¸‹å®¹å™¨. å®¹å™¨é¡¾åæ€ä¹‰å°±æ˜¯ç”¨æ¥è£…è½½ä¸œè¥¿çš„å™¨å…·, "),t("strong",[s._v("åœ¨ Tomcat é‡Œ, å®¹å™¨å°±æ˜¯ç”¨æ¥è£…è½½ Servlet çš„")]),s._v(". é‚£ Tomcat çš„ Servlet å®¹å™¨æ˜¯å¦‚ä½•è®¾è®¡çš„å‘¢?")]),s._v(" "),t("h6",{attrs:{id:"_1-å®¹å™¨çš„å±‚æ¬¡ç»“æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å®¹å™¨çš„å±‚æ¬¡ç»“æ„"}},[s._v("#")]),s._v(" 1.å®¹å™¨çš„å±‚æ¬¡ç»“æ„")]),s._v(" "),t("p",[s._v("Tomcat è®¾è®¡äº† 4 ç§å®¹å™¨, åˆ†åˆ«æ˜¯ "),t("strong",[s._v("Engine, Host, Context å’Œ Wrapper")]),s._v(". è¿™ 4 ç§å®¹å™¨ä¸æ˜¯å¹³è¡Œå…³ç³», è€Œæ˜¯"),t("strong",[s._v("çˆ¶å­å…³ç³»")]),s._v(". ä¸‹é¢å®ƒä»¬çš„å…³ç³».")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161017-jslu79o.jpg",alt:""}})]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆè¿™ä¹ˆå¤šå±‚æ¬¡çš„å®¹å™¨, è¿™ä¸æ˜¯å¢åŠ äº†å¤æ‚åº¦å—? è¿™æ · **Tomcat é€šè¿‡ä¸€ç§åˆ†å±‚çš„æ¶æ„, ä½¿å¾— Servlet å®¹å™¨å…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§. **")]),s._v(" "),t("p",[t("strong",[s._v("Context è¡¨ç¤ºä¸€ä¸ª Web åº”ç”¨ç¨‹åº; Wrapper è¡¨ç¤ºä¸€ä¸ª Servlet, ä¸€ä¸ª Web åº”ç”¨ç¨‹åºä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ª Servlet; Host ä»£è¡¨çš„æ˜¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœº, æˆ–è€…è¯´ä¸€ä¸ªç«™ç‚¹, å¯ä»¥ç»™ Tomcat é…ç½®å¤šä¸ªè™šæ‹Ÿä¸»æœºåœ°å€, è€Œä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸‹å¯ä»¥éƒ¨ç½²å¤šä¸ª Web åº”ç”¨ç¨‹åº; Engine è¡¨ç¤ºå¼•æ“, ç”¨æ¥ç®¡ç†å¤šä¸ªè™šæ‹Ÿç«™ç‚¹, ä¸€ä¸ª Service æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª Engine")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯ä»¥å†é€šè¿‡ Tomcat çš„ server.xml é…ç½®æ–‡ä»¶æ¥åŠ æ·±å¯¹ Tomcat å®¹å™¨çš„ç†è§£. Tomcat é‡‡ç”¨äº†ç»„ä»¶åŒ–çš„è®¾è®¡, å®ƒçš„æ„æˆç»„ä»¶éƒ½æ˜¯å¯é…ç½®çš„, å…¶ä¸­æœ€å¤–å±‚çš„æ˜¯ Server, å…¶ä»–ç»„ä»¶æŒ‰ç…§ä¸€å®šçš„æ ¼å¼è¦æ±‚é…ç½®åœ¨è¿™ä¸ªé¡¶å±‚å®¹å™¨ä¸­.")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("                       // é¡¶å±‚ç»„ä»¶, å¯ä»¥åŒ…å«å¤šä¸ªService\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("                  // é¡¶å±‚ç»„ä»¶, å¯ä»¥åŒ…å«ä¸€ä¸ªEngine, å¤šä¸ªè¿æ¥å™¨ \n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Connector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("            // è¿æœºå™¨ç»„ä»¶, ä»£è¡¨é€šä¿¡æ¥å£\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Connector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("    \n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Engine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("               // å®¹å™¨ç»„ä»¶, ä¸€ä¸ªEngineç»„ä»¶å¤„ç†Serviceä¸­çš„æ‰€æœ‰è¯·æ±‚, åŒ…å«å¤šä¸ªHost\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("             // å®¹å™¨ç»„ä»¶, å¤„ç†ç‰¹å®šçš„Hostä¸‹çš„å®¢æˆ·è¯·æ±‚, å¯åŒ…å«å¤šä¸ªContext\n                "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("      // å®¹å™¨ç»„ä»¶, ä¸ºç‰¹å®šçš„Webåº”ç”¨å¤„ç†æ‰€æœ‰çš„å®¢æˆ·è¯·æ±‚\n                "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Engine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("é‚£ä¹ˆ, Tomcat æ˜¯æ€ä¹ˆç®¡ç†è¿™äº›å®¹å™¨çš„å‘¢? ä½ ä¼šå‘ç°è¿™äº›å®¹å™¨å…·æœ‰"),t("strong",[s._v("çˆ¶å­å…³ç³», å½¢æˆä¸€ä¸ªæ ‘å½¢ç»“æ„")]),s._v(", ä½ å¯èƒ½é©¬ä¸Šå°±æƒ³åˆ°äº†è®¾è®¡æ¨¡å¼ä¸­çš„"),t("strong",[s._v("ç»„åˆæ¨¡å¼")]),s._v(". æ²¡é”™, "),t("strong",[s._v("Tomcat å°±æ˜¯ç”¨ç»„åˆæ¨¡å¼æ¥ç®¡ç†è¿™äº›å®¹å™¨çš„")]),s._v(". å…·ä½“å®ç°æ–¹æ³•æ˜¯, "),t("strong",[s._v("æ‰€æœ‰å®¹å™¨ç»„ä»¶éƒ½å®ç°äº† Container æ¥å£, å› æ­¤ç»„åˆæ¨¡å¼å¯ä»¥ä½¿å¾—ç”¨æˆ·å¯¹å•å®¹å™¨å¯¹è±¡å’Œç»„åˆå®¹å™¨å¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§")]),s._v(". è¿™é‡Œå•å®¹å™¨å¯¹è±¡æŒ‡çš„æ˜¯æœ€åº•å±‚çš„ Wrapper, ç»„åˆå®¹å™¨å¯¹è±¡æŒ‡çš„æ˜¯ä¸Šé¢çš„ Context, Host æˆ–è€… Engine.")]),s._v(" "),t("p",[t("strong",[s._v("Container æ¥å£")]),s._v("å®šä¹‰å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lifecycle")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getParent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setParent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),s._v(" container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addChild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),s._v(" child"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("removeChild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),s._v(" child"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findChild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("ä¸ºäº†å®ç°çˆ¶å­å…³ç³», "),t("strong",[s._v("Container æ¥å£æœ‰")]),s._v(" getParent, SetParent, addChild å’Œ removeChild ç­‰æ–¹æ³•. Container æ¥å£è¿˜æ‰©å±•äº† LifeCycle æ¥å£, LifeCycle æ¥å£ç”¨æ¥ç»Ÿä¸€ç®¡ç†å„ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ, åé¢ä¼šè¯¦ç»†ä»‹ç».")]),s._v(" "),t("h6",{attrs:{id:"_2-è¯·æ±‚å®šä½servletçš„è¿‡ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-è¯·æ±‚å®šä½servletçš„è¿‡ç¨‹"}},[s._v("#")]),s._v(" 2.è¯·æ±‚å®šä½Servletçš„è¿‡ç¨‹")]),s._v(" "),t("p",[s._v("æ—¢ç„¶è®¾è®¡äº†è¿™ä¹ˆå¤šå±‚æ¬¡çš„å®¹å™¨, Tomcat æ˜¯æ€ä¹ˆç¡®å®šè¯·æ±‚æ˜¯ç”±å“ªä¸ª Wrapper å®¹å™¨é‡Œçš„ Servlet æ¥å¤„ç†çš„å‘¢? ç­”æ¡ˆæ˜¯, Tomcat æ˜¯ç”¨ "),t("strong",[s._v("Mapper ç»„ä»¶")]),s._v("æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡çš„.")]),s._v(" "),t("p",[s._v("Mapper ç»„ä»¶çš„åŠŸèƒ½å°±æ˜¯å°†ç”¨æˆ·è¯·æ±‚çš„ URL å®šä½åˆ°ä¸€ä¸ª Servlet, å®ƒçš„å·¥ä½œåŸç†æ˜¯: Mapper ç»„ä»¶é‡Œä¿å­˜äº† Web åº”ç”¨çš„é…ç½®ä¿¡æ¯, å…¶å®å°±æ˜¯"),t("strong",[s._v("å®¹å™¨ç»„ä»¶ä¸è®¿é—®è·¯å¾„çš„æ˜ å°„å…³ç³»")]),s._v(", æ¯”å¦‚ Host å®¹å™¨é‡Œé…ç½®çš„åŸŸå, Context å®¹å™¨é‡Œçš„ Web åº”ç”¨è·¯å¾„, ä»¥åŠ Wrapper å®¹å™¨é‡Œ Servlet æ˜ å°„çš„è·¯å¾„, å¯ä»¥æƒ³è±¡è¿™äº›é…ç½®ä¿¡æ¯å°±æ˜¯ä¸€ä¸ª"),t("strong",[s._v("å¤šå±‚æ¬¡çš„ Map")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ä¸€ä¸ªè¯·æ±‚åˆ°æ¥æ—¶, Mapper ç»„ä»¶é€šè¿‡è§£æè¯·æ±‚ URL é‡Œçš„åŸŸåå’Œè·¯å¾„, å†åˆ°è‡ªå·±ä¿å­˜çš„ Map é‡Œå»æŸ¥æ‰¾, å°±èƒ½å®šä½åˆ°ä¸€ä¸ª Servlet. æ³¨æ„, "),t("strong",[s._v("ä¸€ä¸ªè¯·æ±‚ URL æœ€ååªä¼šå®šä½åˆ°ä¸€ä¸ª Wrapper å®¹å™¨, ä¹Ÿå°±æ˜¯ä¸€ä¸ª Servlet")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šè¿™ä¸ªå®šä½çš„è¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("å‡å¦‚æœ‰ä¸€ä¸ªç½‘è´­ç³»ç»Ÿ, æœ‰é¢å‘ç½‘ç«™ç®¡ç†äººå‘˜çš„åå°ç®¡ç†ç³»ç»Ÿ, è¿˜æœ‰é¢å‘ç»ˆç«¯å®¢æˆ·çš„åœ¨çº¿è´­ç‰©ç³»ç»Ÿ. è¿™ä¸¤ä¸ªç³»ç»Ÿè·‘åœ¨åŒä¸€ä¸ª Tomcat ä¸Š, ä¸ºäº†éš”ç¦»å®ƒä»¬çš„è®¿é—®åŸŸå, é…ç½®äº†ä¸¤ä¸ªè™šæ‹ŸåŸŸå: "),t("code",[s._v("manage.shopping.com")]),s._v("â€‹ å’Œ "),t("code",[s._v("user.shopping.com")]),s._v("â€‹, ç½‘ç«™ç®¡ç†äººå‘˜é€šè¿‡ "),t("code",[s._v("manage.shopping.com")]),s._v("â€‹ åŸŸåè®¿é—® Tomcat å»ç®¡ç†ç”¨æˆ·å’Œå•†å“, è€Œç”¨æˆ·ç®¡ç†å’Œå•†å“ç®¡ç†æ˜¯ä¸¤ä¸ªå•ç‹¬çš„ Web åº”ç”¨. ç»ˆç«¯å®¢æˆ·é€šè¿‡ "),t("code",[s._v("user.shopping.com")]),s._v("â€‹ åŸŸåå»æœç´¢å•†å“å’Œä¸‹è®¢å•, æœç´¢åŠŸèƒ½å’Œè®¢å•ç®¡ç†ä¹Ÿæ˜¯"),t("strong",[s._v("ä¸¤ä¸ªç‹¬ç«‹çš„ Web åº”ç”¨")]),s._v(".")]),s._v(" "),t("p",[s._v("é’ˆå¯¹è¿™æ ·çš„éƒ¨ç½², Tomcat ä¼š"),t("strong",[s._v("åˆ›å»ºä¸€ä¸ª Service ç»„ä»¶å’Œä¸€ä¸ª Engine å®¹å™¨ç»„ä»¶, åœ¨ Engine å®¹å™¨ä¸‹åˆ›å»ºä¸¤ä¸ª Host å­å®¹å™¨, åœ¨æ¯ä¸ª Host å®¹å™¨ä¸‹åˆ›å»ºä¸¤ä¸ª Context å­å®¹å™¨. ç”±äºä¸€ä¸ª Web åº”ç”¨é€šå¸¸æœ‰å¤šä¸ª Servlet, Tomcat è¿˜ä¼šåœ¨æ¯ä¸ª Context å®¹å™¨é‡Œåˆ›å»ºå¤šä¸ª Wrapper å­å®¹å™¨")]),s._v(". æ¯ä¸ªå®¹å™¨éƒ½æœ‰å¯¹åº”çš„è®¿é—®è·¯å¾„, å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161017-4f2wapf.jpg",alt:""}})]),s._v(" "),t("p",[s._v("å‡å¦‚æœ‰ç”¨æˆ·è®¿é—®ä¸€ä¸ª URL, æ¯”å¦‚å›¾ä¸­çš„ "),t("code",[s._v("http://user.shopping.com:8080/order/buy")]),s._v("â€‹, Tomcat å°†è¿™ä¸ª URL å®šä½åˆ°ä¸€ä¸ª Servlet çš„è¿‡ç¨‹å¦‚ä¸‹:")]),s._v(" "),t("p",[s._v("**é¦–å…ˆ, æ ¹æ®åè®®å’Œç«¯å£å·é€‰å®š Service å’Œ Engine. **")]),s._v(" "),t("p",[s._v("Tomcat çš„"),t("strong",[s._v("æ¯ä¸ªè¿æ¥å™¨éƒ½ç›‘å¬ä¸åŒçš„ç«¯å£")]),s._v(", æ¯”å¦‚ Tomcat é»˜è®¤çš„ HTTP è¿æ¥å™¨ç›‘å¬ 8080 ç«¯å£, é»˜è®¤çš„ AJP è¿æ¥å™¨ç›‘å¬ 8009 ç«¯å£. ä¸Šé¢ä¾‹å­ä¸­çš„ URL è®¿é—®çš„æ˜¯ 8080 ç«¯å£, å› æ­¤"),t("strong",[s._v("è¿™ä¸ªè¯·æ±‚ä¼šè¢« HTTP è¿æ¥å™¨æ¥æ”¶")]),s._v(", è€Œä¸€ä¸ªè¿æ¥å™¨æ˜¯å±äºä¸€ä¸ª Service ç»„ä»¶çš„, è¿™æ · "),t("strong",[s._v("Service ç»„ä»¶")]),s._v("å°±ç¡®å®šäº†. ä¸€ä¸ª Service ç»„ä»¶é‡Œé™¤äº†æœ‰å¤šä¸ªè¿æ¥å™¨, è¿˜æœ‰ä¸€ä¸ªå®¹å™¨ç»„ä»¶, å…·ä½“æ¥è¯´å°±æ˜¯ä¸€ä¸ª Engine å®¹å™¨, å› æ­¤ Service ç¡®å®šäº†ä¹Ÿå°±æ„å‘³ç€ Engine ä¹Ÿç¡®å®šäº†.")]),s._v(" "),t("p",[s._v("**ç„¶å, æ ¹æ®åŸŸåé€‰å®š Host. **")]),s._v(" "),t("p",[s._v("Service å’Œ Engine ç¡®å®šå, Mapper ç»„ä»¶é€šè¿‡ URL ä¸­çš„åŸŸåå»æŸ¥æ‰¾ç›¸åº”çš„ Host å®¹å™¨, æ¯”å¦‚ä¾‹å­ä¸­çš„ URL è®¿é—®çš„åŸŸåæ˜¯ "),t("code",[s._v("user.shopping.com")]),s._v("â€‹, å› æ­¤ Mapper ä¼šæ‰¾åˆ° Host2 è¿™ä¸ªå®¹å™¨.")]),s._v(" "),t("p",[s._v("**ä¹‹å, æ ¹æ® URL è·¯å¾„æ‰¾åˆ° Context ç»„ä»¶. **")]),s._v(" "),t("p",[s._v("Host ç¡®å®šä»¥å, Mapper æ ¹æ® URL çš„è·¯å¾„æ¥åŒ¹é…ç›¸åº”çš„ Web åº”ç”¨çš„è·¯å¾„, æ¯”å¦‚ä¾‹å­ä¸­è®¿é—®çš„æ˜¯ /order, å› æ­¤æ‰¾åˆ°äº† "),t("strong",[s._v("Context4")]),s._v(" è¿™ä¸ª Context å®¹å™¨.")]),s._v(" "),t("p",[s._v("**æœ€å, æ ¹æ® URL è·¯å¾„æ‰¾åˆ° Wrapper(Servlet). **")]),s._v(" "),t("p",[s._v("Context ç¡®å®šå, Mapper å†æ ¹æ® web.xml ä¸­é…ç½®çš„ Servlet æ˜ å°„è·¯å¾„æ¥æ‰¾åˆ°å…·ä½“çš„ Wrapper å’Œ Servlet.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œåº”è¯¥å·²ç»äº†è§£äº†ä»€ä¹ˆæ˜¯å®¹å™¨, ä»¥åŠ Tomcat å¦‚ä½•é€šè¿‡ä¸€å±‚ä¸€å±‚çš„çˆ¶å­å®¹å™¨æ‰¾åˆ°æŸä¸ª Servlet æ¥å¤„ç†è¯·æ±‚. éœ€è¦æ³¨æ„çš„æ˜¯, å¹¶ä¸æ˜¯è¯´åªæœ‰ Servlet æ‰ä¼šå»å¤„ç†è¯·æ±‚, å®é™…ä¸Šè¿™ä¸ªæŸ¥æ‰¾è·¯å¾„ä¸Šçš„çˆ¶å­å®¹å™¨éƒ½ä¼šå¯¹è¯·æ±‚åšä¸€äº›å¤„ç†. å‰é¢è¯´è¿‡, è¿æ¥å™¨ä¸­çš„ Adapter ä¼šè°ƒç”¨å®¹å™¨çš„ Service æ–¹æ³•æ¥æ‰§è¡Œ Servlet, æœ€å…ˆæ‹¿åˆ°è¯·æ±‚çš„æ˜¯ Engine å®¹å™¨, Engine å®¹å™¨å¯¹è¯·æ±‚åšä¸€äº›å¤„ç†å, ä¼šæŠŠè¯·æ±‚ä¼ ç»™è‡ªå·±å­å®¹å™¨ Host ç»§ç»­å¤„ç†, ä¾æ¬¡ç±»æ¨, æœ€åè¿™ä¸ªè¯·æ±‚ä¼šä¼ ç»™ Wrapper å®¹å™¨, Wrapper ä¼šè°ƒç”¨æœ€ç»ˆçš„ Servlet æ¥å¤„ç†. é‚£ä¹ˆè¿™ä¸ªè°ƒç”¨è¿‡ç¨‹å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å‘¢? ç­”æ¡ˆæ˜¯ä½¿ç”¨ "),t("strong",[s._v("Pipeline-Valve ç®¡é“")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("Pipeline-Valve æ˜¯è´£ä»»é“¾æ¨¡å¼")]),s._v(", è´£ä»»é“¾æ¨¡å¼æ˜¯æŒ‡åœ¨ä¸€ä¸ªè¯·æ±‚å¤„ç†çš„è¿‡ç¨‹ä¸­æœ‰å¾ˆå¤šå¤„ç†è€…ä¾æ¬¡å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†, æ¯ä¸ªå¤„ç†è€…è´Ÿè´£åšè‡ªå·±ç›¸åº”çš„å¤„ç†, å¤„ç†å®Œä¹‹åå°†å†è°ƒç”¨ä¸‹ä¸€ä¸ªå¤„ç†è€…ç»§ç»­å¤„ç†.")]),s._v(" "),t("p",[t("strong",[s._v("Valve è¡¨ç¤ºä¸€ä¸ªå¤„ç†ç‚¹")]),s._v(", æ¯”å¦‚æƒé™è®¤è¯å’Œè®°å½•æ—¥å¿—. å¯ä»¥æ¥çœ‹çœ‹ "),t("strong",[s._v("Valve å’Œ Pipeline æ¥å£")]),s._v("ä¸­çš„å…³é”®æ–¹æ³•.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" valve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Request")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Response")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("ç”±äº Valve æ˜¯ä¸€ä¸ªå¤„ç†ç‚¹, å› æ­¤ invoke æ–¹æ³•å°±æ˜¯æ¥"),t("strong",[s._v("å¤„ç†è¯·æ±‚")]),s._v("çš„. æ³¨æ„åˆ° Valve ä¸­æœ‰ getNext å’Œ setNext æ–¹æ³•, å› æ­¤å¤§æ¦‚å¯ä»¥çŒœåˆ°æœ‰ä¸€ä¸ªé“¾è¡¨å°† Valve é“¾èµ·æ¥äº†.")]),s._v(" "),t("p",[s._v("ç»§ç»­çœ‹ Pipeline æ¥å£:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Pipeline")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Contained")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addValve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" valve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBasic")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBasic")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" valve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getFirst")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("æ²¡é”™, Pipeline ä¸­æœ‰ addValve() æ–¹æ³•. "),t("strong",[s._v("Pipeline ä¸­ç»´æŠ¤äº† Valve é“¾è¡¨")]),s._v(", Valve å¯ä»¥æ’å…¥åˆ° Pipeline ä¸­, å¯¹è¯·æ±‚åšæŸäº›å¤„ç†. è¿˜å¯ä»¥å‘ç° Pipeline ä¸­æ²¡æœ‰ invoke æ–¹æ³•, å› ä¸º"),t("strong",[s._v("æ•´ä¸ªè°ƒç”¨é“¾çš„è§¦å‘æ˜¯ Valve æ¥å®Œæˆçš„, Valve å®Œæˆè‡ªå·±çš„å¤„ç†å, è°ƒç”¨ getNext.invoke() æ¥è§¦å‘ä¸‹ä¸€ä¸ª Valve è°ƒç”¨")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("æ¯ä¸€ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ª Pipeline å¯¹è±¡, åªè¦è§¦å‘è¿™ä¸ª Pipeline çš„ç¬¬ä¸€ä¸ª Valve, è¿™ä¸ªå®¹å™¨é‡Œ Pipeline ä¸­çš„ Valve å°±éƒ½ä¼šè¢«è°ƒç”¨åˆ°")]),s._v(". ä½†æ˜¯, ä¸åŒå®¹å™¨çš„ Pipeline æ˜¯æ€ä¹ˆé“¾å¼è§¦å‘çš„å‘¢, æ¯”å¦‚ Engine ä¸­ Pipeline éœ€è¦è°ƒç”¨ä¸‹å±‚å®¹å™¨ Host ä¸­çš„ Pipeline.")]),s._v(" "),t("p",[s._v("è¿™æ˜¯å› ä¸º Pipeline ä¸­è¿˜æœ‰ä¸ª getBasic() æ–¹æ³•. è¿™ä¸ª BasicValve å¤„äº Valve é“¾è¡¨çš„"),t("strong",[s._v("æœ«ç«¯")]),s._v(", å®ƒæ˜¯ Pipeline ä¸­å¿…ä¸å¯å°‘çš„ä¸€ä¸ª Valve, è´Ÿè´£è°ƒç”¨ä¸‹å±‚å®¹å™¨çš„ Pipeline é‡Œçš„ç¬¬ä¸€ä¸ª Valve. æ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161017-4comhnb.jpg",alt:""}})]),s._v(" "),t("p",[s._v("**æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ç”±è¿æ¥å™¨ä¸­çš„ Adapter è§¦å‘çš„, å®ƒä¼šè°ƒç”¨ Engine çš„ç¬¬ä¸€ä¸ª Valve: **")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Calling the container")]),s._v("\nconnector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPipeline")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getFirst")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("Wrapper å®¹å™¨çš„æœ€åä¸€ä¸ª Valve ä¼šåˆ›å»ºä¸€ä¸ª Filter é“¾, å¹¶è°ƒç”¨ doFilter() æ–¹æ³•, æœ€ç»ˆä¼šè°ƒåˆ° Servlet çš„ service() æ–¹æ³•.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, å‰é¢ä¸æ˜¯è®²åˆ°äº† Filter, ä¼¼ä¹ä¹Ÿæœ‰ç›¸ä¼¼çš„åŠŸèƒ½, é‚£ Valve å’Œ Filter æœ‰ä»€ä¹ˆåŒºåˆ«å—? å®ƒä»¬çš„åŒºåˆ«æ˜¯:")]),s._v(" "),t("ul",[t("li",[s._v("**Valve æ˜¯ Tomcat çš„ç§æœ‰æœºåˆ¶, ä¸ Tomcat çš„åŸºç¡€æ¶æ„ /API æ˜¯ç´§è€¦åˆçš„. Servlet API æ˜¯å…¬æœ‰çš„æ ‡å‡†, æ‰€æœ‰çš„ Web å®¹å™¨åŒ…æ‹¬ Jetty éƒ½æ”¯æŒ Filter æœºåˆ¶. **")]),s._v(" "),t("li",[s._v("**å¦ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯ Valve å·¥ä½œåœ¨ Web å®¹å™¨çº§åˆ«, æ‹¦æˆªæ‰€æœ‰åº”ç”¨çš„è¯·æ±‚; è€Œ Servlet Filter å·¥ä½œåœ¨åº”ç”¨çº§åˆ«, åªèƒ½æ‹¦æˆªæŸä¸ª Web åº”ç”¨çš„æ‰€æœ‰è¯·æ±‚. å¦‚æœæƒ³åšæ•´ä¸ª Web å®¹å™¨çš„æ‹¦æˆªå™¨, å¿…é¡»é€šè¿‡ Valve æ¥å®ç°. **")])]),s._v(" "),t("p",[s._v("è¯·æ±‚çš„é“¾å¼è°ƒç”¨æ˜¯åŸºäº Pipeline-Valve è´£ä»»é“¾æ¥å®Œæˆçš„, è¿™æ ·çš„è®¾è®¡ä½¿å¾—ç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§, å¦‚æœéœ€è¦æ‰©å±•å®¹å™¨æœ¬èº«çš„åŠŸèƒ½, åªéœ€è¦å¢åŠ ç›¸åº”çš„ Valve å³å¯.")]),s._v(" "),t("h4",{attrs:{id:"_5-tomcatå¦‚ä½•å®ç°ä¸€é”®å¼å¯åœ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-tomcatå¦‚ä½•å®ç°ä¸€é”®å¼å¯åœ"}},[s._v("#")]),s._v(" 5.Tomcatå¦‚ä½•å®ç°ä¸€é”®å¼å¯åœ?")]),s._v(" "),t("p",[s._v("ä¸‹é¢é€šè¿‡ä¸€å¼ ç®€åŒ–çš„ç±»å›¾æ¥å›é¡¾ä¸€ä¸‹ Tomcat çš„åŸºæœ¬æ¶æ„, çœ‹åˆ°å„ç§ç»„ä»¶çš„å±‚æ¬¡å…³ç³», å›¾ä¸­çš„"),t("strong",[s._v("è™šçº¿è¡¨ç¤ºä¸€ä¸ªè¯·æ±‚åœ¨ Tomcat ä¸­æµè½¬çš„è¿‡ç¨‹")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161039-3vw9z54.png",alt:""}})]),s._v(" "),t("p",[s._v("ä¸Šé¢è¿™å¼ å›¾æè¿°äº†ç»„ä»¶ä¹‹é—´çš„é™æ€å…³ç³», å¦‚æœæƒ³è®©ä¸€ä¸ªç³»ç»Ÿèƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡, éœ€è¦åˆ›å»º, ç»„è£…å¹¶å¯åŠ¨è¿™äº›ç»„ä»¶; åœ¨æœåŠ¡åœæ­¢çš„æ—¶å€™, æˆ‘ä»¬è¿˜éœ€è¦é‡Šæ”¾èµ„æº, é”€æ¯è¿™äº›ç»„ä»¶, å› æ­¤è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("Tomcat éœ€è¦åŠ¨æ€åœ°ç®¡ç†è¿™äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æœä½ éœ€è¦è®¾è®¡ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç³»ç»Ÿæˆ–è€…æ¡†æ¶æ—¶, åŒæ ·ä¹Ÿéœ€è¦è€ƒè™‘è¿™å‡ ä¸ªé—®é¢˜: **å¦‚ä½•ç»Ÿä¸€ç®¡ç†ç»„ä»¶çš„åˆ›å»º, åˆå§‹åŒ–, å¯åŠ¨, åœæ­¢å’Œé”€æ¯? å¦‚ä½•åšåˆ°ä»£ç é€»è¾‘æ¸…æ™°? å¦‚ä½•æ–¹ä¾¿åœ°æ·»åŠ æˆ–è€…åˆ é™¤ç»„ä»¶? å¦‚ä½•åšåˆ°ç»„ä»¶å¯åŠ¨å’Œåœæ­¢ä¸é—æ¼, ä¸é‡å¤? **")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ¥è§£å†³ä¸Šé¢çš„é—®é¢˜. å…ˆæ¥çœ‹çœ‹ç»„ä»¶ä¹‹é—´çš„å…³ç³», ä»”ç»†è§‚æµ‹å¯ä»¥å‘ç°è¿™äº›ç»„ä»¶å…·æœ‰ä¸¤å±‚å…³ç³».")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ç¬¬ä¸€å±‚å…³ç³»æ˜¯ç»„ä»¶æœ‰å¤§æœ‰å°")]),s._v(", å¤§ç»„ä»¶ç®¡ç†å°ç»„ä»¶, æ¯”å¦‚ Server ç®¡ç† Service, Service åˆç®¡ç†è¿æ¥å™¨å’Œå®¹å™¨.")]),s._v(" "),t("li",[t("strong",[s._v("ç¬¬äºŒå±‚å…³ç³»æ˜¯ç»„ä»¶æœ‰å¤–æœ‰å†…")]),s._v(", å¤–å±‚ç»„ä»¶æ§åˆ¶å†…å±‚ç»„ä»¶, æ¯”å¦‚è¿æ¥å™¨æ˜¯å¤–å±‚ç»„ä»¶, è´Ÿè´£å¯¹å¤–äº¤æµ, å¤–å±‚ç»„ä»¶è°ƒç”¨å†…å±‚ç»„ä»¶å®Œæˆä¸šåŠ¡åŠŸèƒ½. ä¹Ÿå°±æ˜¯è¯´, **è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹æ˜¯ç”±å¤–å±‚ç»„ä»¶æ¥é©±åŠ¨çš„. **")])]),s._v(" "),t("p",[s._v("è¿™ä¸¤å±‚å…³ç³»å†³å®šäº†ç³»ç»Ÿåœ¨åˆ›å»ºç»„ä»¶æ—¶åº”è¯¥éµå¾ªä¸€å®šçš„é¡ºåº.")]),s._v(" "),t("ul",[t("li",[s._v('ç¬¬ä¸€ä¸ªåŸåˆ™æ˜¯å…ˆåˆ›å»ºå­ç»„ä»¶, å†åˆ›å»ºçˆ¶ç»„ä»¶, å­ç»„ä»¶éœ€è¦è¢«"æ³¨å…¥"åˆ°çˆ¶ç»„ä»¶ä¸­.')]),s._v(" "),t("li",[s._v('ç¬¬äºŒä¸ªåŸåˆ™æ˜¯å…ˆåˆ›å»ºå†…å±‚ç»„ä»¶, å†åˆ›å»ºå¤–å±‚ç»„ä»¶, å†…å±‚ç»„å»ºéœ€è¦è¢«"æ³¨å…¥"åˆ°å¤–å±‚ç»„ä»¶.')])]),s._v(" "),t("p",[s._v("å› æ­¤, æœ€ç›´è§‚çš„åšæ³•å°±æ˜¯å°†å›¾ä¸Šæ‰€æœ‰çš„ç»„ä»¶æŒ‰ç…§å…ˆå°åå¤§, å…ˆå†…åå¤–çš„é¡ºåºåˆ›å»ºå‡ºæ¥, ç„¶åç»„è£…åœ¨ä¸€èµ·. ä¸çŸ¥é“ä½ æ³¨æ„åˆ°æ²¡æœ‰, è¿™ä¸ªæ€è·¯å…¶å®å¾ˆæœ‰é—®é¢˜! å› ä¸ºè¿™æ ·ä¸ä»…ä¼šé€ æˆä»£ç é€»è¾‘æ··ä¹±å’Œç»„ä»¶é—æ¼, è€Œä¸”ä¹Ÿä¸åˆ©äºåæœŸçš„åŠŸèƒ½æ‰©å±•.")]),s._v(" "),t("p",[s._v('ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, å¸Œæœ›æ‰¾åˆ°ä¸€ç§é€šç”¨çš„, ç»Ÿä¸€çš„æ–¹æ³•æ¥ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ, å°±åƒæ±½è½¦"ä¸€é”®å¯åŠ¨"é‚£æ ·çš„æ•ˆæœ.')]),s._v(" "),t("h5",{attrs:{id:"ä¸€é”®å¼å¯åœ-lifecycleæ¥å£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€é”®å¼å¯åœ-lifecycleæ¥å£"}},[s._v("#")]),s._v(" ä¸€é”®å¼å¯åœ:LifeCycleæ¥å£")]),s._v(" "),t("p",[t("strong",[s._v("è®¾è®¡å°±æ˜¯è¦æ‰¾åˆ°ç³»ç»Ÿçš„å˜åŒ–ç‚¹å’Œä¸å˜ç‚¹")]),s._v(". è¿™é‡Œçš„"),t("strong",[s._v("ä¸å˜ç‚¹å°±æ˜¯æ¯ä¸ªç»„ä»¶éƒ½è¦ç»å†åˆ›å»º, åˆå§‹åŒ–, å¯åŠ¨è¿™å‡ ä¸ªè¿‡ç¨‹, è¿™äº›çŠ¶æ€ä»¥åŠçŠ¶æ€çš„è½¬åŒ–æ˜¯ä¸å˜çš„")]),s._v(". è€Œå˜åŒ–ç‚¹æ˜¯æ¯ä¸ªå…·ä½“ç»„ä»¶çš„åˆå§‹åŒ–æ–¹æ³•, ä¹Ÿå°±æ˜¯å¯åŠ¨æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„.")]),s._v(" "),t("p",[s._v("å› æ­¤å¯ä»¥æŠŠä¸å˜ç‚¹æŠ½è±¡å‡ºæ¥æˆä¸ºä¸€ä¸ªæ¥å£, è¿™ä¸ªæ¥å£è·Ÿç”Ÿå‘½å‘¨æœŸæœ‰å…³, å«ä½œ "),t("strong",[s._v("LifeCycle")]),s._v(". LifeCycle æ¥å£é‡Œåº”è¯¥å®šä¹‰è¿™ä¹ˆå‡ ä¸ªæ–¹æ³•: init(), start(), stop() å’Œ destroy(), æ¯ä¸ªå…·ä½“çš„ç»„ä»¶å»å®ç°è¿™äº›æ–¹æ³•, åšåˆ°æ–¹æ³•çš„ä¸ä¸€æ ·.")]),s._v(" "),t("p",[s._v("ç†æ‰€å½“ç„¶, åœ¨çˆ¶ç»„ä»¶çš„ init() æ–¹æ³•é‡Œéœ€è¦åˆ›å»ºå­ç»„ä»¶å¹¶è°ƒç”¨å­ç»„ä»¶çš„ init() æ–¹æ³•. åŒæ ·, åœ¨çˆ¶ç»„ä»¶çš„ start() æ–¹æ³•é‡Œä¹Ÿéœ€è¦è°ƒç”¨å­ç»„ä»¶çš„ start() æ–¹æ³•, å› æ­¤è°ƒç”¨è€…å¯ä»¥æ— å·®åˆ«çš„è°ƒç”¨å„ç»„ä»¶çš„ init() æ–¹æ³•å’Œ start() æ–¹æ³•, è¿™å°±æ˜¯"),t("strong",[s._v("ç»„åˆæ¨¡å¼")]),s._v("çš„ä½¿ç”¨, å¹¶ä¸”åªè¦è°ƒç”¨æœ€é¡¶å±‚ç»„ä»¶, ä¹Ÿå°±æ˜¯ Server ç»„ä»¶çš„ init() å’Œ start() æ–¹æ³•, æ•´ä¸ª Tomcat å°±è¢«å¯åŠ¨èµ·æ¥äº†. ä¸‹é¢æ˜¯ LifeCycle æ¥å£çš„å®šä¹‰.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lifecycle")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("destroy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"å¯æ‰©å±•æ€§-lifecycleäº‹ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯æ‰©å±•æ€§-lifecycleäº‹ä»¶"}},[s._v("#")]),s._v(" å¯æ‰©å±•æ€§:LifeCycleäº‹ä»¶")]),s._v(" "),t("p",[s._v("å†æ¥è€ƒè™‘å¦ä¸€ä¸ªé—®é¢˜, é‚£å°±æ˜¯ç³»ç»Ÿçš„"),t("strong",[s._v("å¯æ‰©å±•æ€§")]),s._v(". å› ä¸ºå„ä¸ªç»„ä»¶ init() å’Œ start() æ–¹æ³•çš„å…·ä½“å®ç°æ˜¯å¤æ‚å¤šå˜çš„, æ¯”å¦‚åœ¨ Host å®¹å™¨çš„å¯åŠ¨æ–¹æ³•é‡Œéœ€è¦æ‰«æ webapps ç›®å½•ä¸‹çš„ Web åº”ç”¨, åˆ›å»ºç›¸åº”çš„ Context å®¹å™¨, å¦‚æœå°†æ¥éœ€è¦å¢åŠ æ–°çš„é€»è¾‘, ç›´æ¥ä¿®æ”¹ start() æ–¹æ³•? è¿™æ ·ä¼šè¿åå¼€é—­åŸåˆ™, é‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢? å¼€é—­åŸåˆ™è¯´çš„æ˜¯ä¸ºäº†æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½, ä¸èƒ½ç›´æ¥ä¿®æ”¹ç³»ç»Ÿä¸­å·²æœ‰çš„ç±», ä½†æ˜¯å¯ä»¥å®šä¹‰æ–°çš„ç±».")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬æ³¨æ„åˆ°, ç»„ä»¶çš„ init() å’Œ start() è°ƒç”¨æ˜¯ç”±å®ƒçš„çˆ¶ç»„ä»¶çš„çŠ¶æ€å˜åŒ–è§¦å‘çš„, ä¸Šå±‚ç»„ä»¶çš„åˆå§‹åŒ–ä¼šè§¦å‘å­ç»„ä»¶çš„åˆå§‹åŒ–, ä¸Šå±‚ç»„ä»¶çš„å¯åŠ¨ä¼šè§¦å‘å­ç»„ä»¶çš„å¯åŠ¨, å› æ­¤å¯ä»¥æŠŠ"),t("strong",[s._v("ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå®šä¹‰æˆä¸€ä¸ªä¸ªçŠ¶æ€, æŠŠçŠ¶æ€çš„è½¬å˜çœ‹ä½œæ˜¯ä¸€ä¸ªäº‹ä»¶")]),s._v(". è€Œäº‹ä»¶æ˜¯æœ‰ç›‘å¬å™¨çš„, åœ¨ç›‘å¬å™¨é‡Œå¯ä»¥å®ç°ä¸€äº›é€»è¾‘, å¹¶ä¸”ç›‘å¬å™¨ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„æ·»åŠ å’Œåˆ é™¤, è¿™å°±æ˜¯å…¸å‹çš„"),t("strong",[s._v("è§‚å¯Ÿè€…æ¨¡å¼")]),s._v(".")]),s._v(" "),t("p",[s._v("å…·ä½“æ¥è¯´å°±æ˜¯åœ¨ LifeCycle æ¥å£é‡ŒåŠ å…¥ä¸¤ä¸ªæ–¹æ³•: "),t("strong",[s._v("æ·»åŠ ç›‘å¬å™¨å’Œåˆ é™¤ç›‘å¬å™¨")]),s._v(". é™¤æ­¤ä¹‹å¤–, è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ª Enum æ¥è¡¨ç¤º"),t("strong",[s._v("ç»„ä»¶æœ‰å“ªäº›çŠ¶æ€")]),s._v(", ä»¥åŠå¤„åœ¨ä»€ä¹ˆçŠ¶æ€ä¼šè§¦å‘ä»€ä¹ˆæ ·çš„äº‹ä»¶. å› æ­¤ "),t("strong",[s._v("LifeCycle æ¥å£å’Œ LifeCycleState æšä¸¾")]),s._v("å°±å®šä¹‰æˆäº†ä¸‹é¢è¿™æ ·.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161039-r9xwme8.png",alt:""}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæœ‰ NEW, INITIALIZING, INITIALIZED, STARTING_PREP, STARTING, STARTED ç­‰, è€Œä¸€æ—¦ç»„ä»¶åˆ°è¾¾ç›¸åº”çš„çŠ¶æ€å°±"),t("strong",[s._v("è§¦å‘ç›¸åº”çš„äº‹ä»¶")]),s._v(", æ¯”å¦‚ NEW çŠ¶æ€è¡¨ç¤ºç»„ä»¶åˆšåˆšè¢«å®ä¾‹åŒ–; è€Œå½“ init() æ–¹æ³•è¢«è°ƒç”¨æ—¶, çŠ¶æ€å°±å˜æˆ INITIALIZING çŠ¶æ€, è¿™ä¸ªæ—¶å€™å°±ä¼šè§¦å‘ BEFORE_INIT_EVENT äº‹ä»¶, å¦‚æœæœ‰ç›‘å¬å™¨åœ¨ç›‘å¬è¿™ä¸ªäº‹ä»¶, å®ƒçš„æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨.")]),s._v(" "),t("h5",{attrs:{id:"é‡ç”¨æ€§-lifecyclebaseæŠ½è±¡åŸºç±»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡ç”¨æ€§-lifecyclebaseæŠ½è±¡åŸºç±»"}},[s._v("#")]),s._v(" é‡ç”¨æ€§:LifeCycleBaseæŠ½è±¡åŸºç±»")]),s._v(" "),t("p",[s._v("æœ‰äº†æ¥å£å°±è¦ç”¨ç±»å»å®ç°æ¥å£. ä¸€èˆ¬æ¥è¯´å®ç°ç±»ä¸æ­¢ä¸€ä¸ª, ä¸åŒçš„ç±»åœ¨å®ç°æ¥å£æ—¶å¾€å¾€ä¼šæœ‰ä¸€äº›ç›¸åŒçš„é€»è¾‘, å¦‚æœè®©å„ä¸ªå­ç±»éƒ½å»å®ç°ä¸€é, å°±ä¼šæœ‰é‡å¤ä»£ç . "),t("strong",[s._v("é‚£å­ç±»å¦‚ä½•é‡ç”¨è¿™éƒ¨åˆ†é€»è¾‘å‘¢? å…¶å®å°±æ˜¯å®šä¹‰ä¸€ä¸ªåŸºç±»æ¥å®ç°å…±åŒçš„é€»è¾‘, ç„¶åè®©å„ä¸ªå­ç±»å»ç»§æ‰¿å®ƒ, å°±è¾¾åˆ°äº†é‡ç”¨çš„ç›®çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("**è€ŒåŸºç±»ä¸­å¾€å¾€ä¼šå®šä¹‰ä¸€äº›æŠ½è±¡æ–¹æ³•, æ‰€è°“çš„æŠ½è±¡æ–¹æ³•å°±æ˜¯è¯´åŸºç±»ä¸ä¼šå»å®ç°è¿™äº›æ–¹æ³•, è€Œæ˜¯è°ƒç”¨è¿™äº›æ–¹æ³•æ¥å®ç°éª¨æ¶é€»è¾‘. æŠ½è±¡æ–¹æ³•æ˜¯ç•™ç»™å„ä¸ªå­ç±»å»å®ç°çš„, å¹¶ä¸”å­ç±»å¿…é¡»å®ç°, å¦åˆ™æ— æ³•å®ä¾‹åŒ–. **")]),s._v(" "),t("p",[s._v("æ¯”å¦‚å®é©¬å’Œè£å¨çš„åº•ç›˜å’Œéª¨æ¶å…¶å®æ˜¯ä¸€æ ·çš„, åªæ˜¯å‘åŠ¨æœºå’Œå†…é¥°ç­‰é…å¥—æ˜¯ä¸ä¸€æ ·çš„. åº•ç›˜å’Œéª¨æ¶å°±æ˜¯åŸºç±», å®é©¬å’Œè£å¨å°±æ˜¯å­ç±». ä»…ä»…æœ‰åº•ç›˜å’Œéª¨æ¶è¿˜ä¸æ˜¯ä¸€è¾†çœŸæ­£æ„ä¹‰ä¸Šçš„è½¦, åªèƒ½ç®—æ˜¯åŠæˆå“, å› æ­¤åœ¨åº•ç›˜å’Œéª¨æ¶ä¸Šä¼šç•™å‡ºä¸€äº›å®‰è£…æ¥å£, æ¯”å¦‚å®‰è£…å‘åŠ¨æœºçš„æ¥å£, å®‰è£…åº§æ¤…çš„æ¥å£, è¿™äº›å°±æ˜¯æŠ½è±¡æ–¹æ³•. å®é©¬æˆ–è€…è£å¨ä¸Šå®‰è£…çš„å‘åŠ¨æœºå’Œåº§æ¤…æ˜¯ä¸ä¸€æ ·çš„, ä¹Ÿå°±æ˜¯å…·ä½“å­ç±»å¯¹æŠ½è±¡æ–¹æ³•æœ‰ä¸åŒçš„å®ç°.")]),s._v(" "),t("p",[s._v("å›åˆ° LifeCycle æ¥å£, "),t("strong",[s._v("Tomcat å®šä¹‰äº†ä¸€ä¸ªåŸºç±» LifeCycleBase æ¥å®ç° LifeCycle æ¥å£, æŠŠä¸€äº›å…¬å…±çš„é€»è¾‘æ”¾åˆ°åŸºç±»ä¸­å», æ¯”å¦‚ç”Ÿå‘½çŠ¶æ€çš„è½¬å˜ä¸ç»´æŠ¤, ç”Ÿå‘½äº‹ä»¶çš„è§¦å‘ä»¥åŠç›‘å¬å™¨çš„æ·»åŠ å’Œåˆ é™¤ç­‰, è€Œå­ç±»å°±è´Ÿè´£å®ç°è‡ªå·±çš„åˆå§‹åŒ–, å¯åŠ¨å’Œåœæ­¢ç­‰æ–¹æ³•")]),s._v(". ä¸ºäº†é¿å…è·ŸåŸºç±»ä¸­çš„æ–¹æ³•åŒå, è¿™é‡ŒæŠŠå…·ä½“å­ç±»çš„å®ç°æ–¹æ³•æ”¹ä¸ªåå­—, åœ¨åé¢åŠ ä¸Š Internal, å« initInternal(), startInternal() ç­‰. å†æ¥çœ‹å¼•å…¥äº†åŸºç±» LifeCycleBase åçš„ç±»å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161039-vxv9018.png",alt:""}})]),s._v(" "),t("p",[s._v("ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°, LifeCycleBase å®ç°äº† LifeCycle æ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•, è¿˜å®šä¹‰äº†ç›¸åº”çš„æŠ½è±¡æ–¹æ³•äº¤ç»™å…·ä½“å­ç±»å»å®ç°, è¿™æ˜¯å…¸å‹çš„"),t("strong",[s._v("æ¨¡æ¿è®¾è®¡æ¨¡å¼")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿˜æ˜¯çœ‹ä¸€çœ‹ä»£ç , ä¸‹é¢æ˜¯ LifeCycleBase çš„ init() æ–¹æ³•å®ç°.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1. çŠ¶æ€æ£€æŸ¥")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NEW")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invalidTransition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lifecycle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BEFORE_INIT_EVENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2. è§¦å‘ INITIALIZING äº‹ä»¶çš„ç›‘å¬å™¨")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setStateInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INITIALIZING")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3. è°ƒç”¨å…·ä½“å­ç±»çš„åˆå§‹åŒ–æ–¹æ³•")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4. è§¦å‘ INITIALIZED äº‹ä»¶çš„ç›‘å¬å™¨")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setStateInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INITIALIZED")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("è¿™ä¸ªæ–¹æ³•é€»è¾‘æ¯”è¾ƒæ¸…æ¥š, ä¸»è¦å®Œæˆäº†å››æ­¥:")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€æ­¥, æ£€æŸ¥çŠ¶æ€çš„åˆæ³•æ€§, æ¯”å¦‚å½“å‰çŠ¶æ€å¿…é¡»æ˜¯ NEW ç„¶åæ‰èƒ½è¿›è¡Œåˆå§‹åŒ–.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒæ­¥, è§¦å‘ INITIALIZING äº‹ä»¶çš„ç›‘å¬å™¨:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setStateInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INITIALIZING")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("åœ¨è¿™ä¸ª setStateInternal() æ–¹æ³•é‡Œ, ä¼šè°ƒç”¨ç›‘å¬å™¨çš„ä¸šåŠ¡æ–¹æ³•.")]),s._v(" "),t("p",[s._v("ç¬¬ä¸‰æ­¥, è°ƒç”¨å…·ä½“å­ç±»å®ç°çš„æŠ½è±¡æ–¹æ³• initInternal() æ–¹æ³•. å‰é¢æåˆ°è¿‡, ä¸ºäº†å®ç°ä¸€é”®å¼å¯åŠ¨, å…·ä½“ç»„ä»¶åœ¨å®ç° initInternal() æ–¹æ³•æ—¶, åˆä¼š"),t("strong",[s._v("è°ƒç”¨å®ƒçš„å­ç»„ä»¶çš„ init() æ–¹æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("ç¬¬å››æ­¥, å­ç»„ä»¶åˆå§‹åŒ–å, è§¦å‘ INITIALIZED äº‹ä»¶çš„ç›‘å¬å™¨, ç›¸åº”ç›‘å¬å™¨çš„ä¸šåŠ¡æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setStateInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INITIALIZED")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ€»ä¹‹, "),t("strong",[s._v("LifeCycleBase è°ƒç”¨äº†æŠ½è±¡æ–¹æ³•æ¥å®ç°éª¨æ¶é€»è¾‘")]),s._v(".")]),s._v(" "),t("p",[s._v("æ—¢ç„¶ LifeCycleBase è´Ÿè´£è§¦å‘äº‹ä»¶, å¹¶è°ƒç”¨ç›‘å¬å™¨çš„æ–¹æ³•, é‚£æ˜¯ä»€ä¹ˆæ—¶å€™, è°æŠŠç›‘å¬å™¨æ³¨å†Œè¿›æ¥çš„å‘¢?")]),s._v(" "),t("p",[s._v("åˆ†ä¸ºä¸¤ç§æƒ…å†µ:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Tomcat è‡ªå®šä¹‰äº†ä¸€äº›ç›‘å¬å™¨")]),s._v(", è¿™äº›ç›‘å¬å™¨æ˜¯çˆ¶ç»„ä»¶åœ¨åˆ›å»ºå­ç»„ä»¶çš„è¿‡ç¨‹ä¸­æ³¨å†Œåˆ°å­ç»„ä»¶çš„. æ¯”å¦‚ MemoryLeakTrackingListener ç›‘å¬å™¨, ç”¨æ¥æ£€æµ‹ Context å®¹å™¨ä¸­çš„å†…å­˜æ³„æ¼, è¿™ä¸ªç›‘å¬å™¨æ˜¯ Host å®¹å™¨åœ¨åˆ›å»º Context å®¹å™¨æ—¶æ³¨å†Œåˆ° Context ä¸­çš„.")]),s._v(" "),t("li",[s._v("è¿˜å¯ä»¥åœ¨ server.xml ä¸­å®šä¹‰è‡ªå·±çš„ç›‘å¬å™¨, Tomcat åœ¨å¯åŠ¨æ—¶ä¼šè§£æ server.xml, åˆ›å»ºç›‘å¬å™¨å¹¶æ³¨å†Œåˆ°å®¹å™¨ç»„ä»¶.")])]),s._v(" "),t("h5",{attrs:{id:"ç”Ÿå‘¨æœŸç®¡ç†æ€»ä½“ç±»å›¾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿå‘¨æœŸç®¡ç†æ€»ä½“ç±»å›¾"}},[s._v("#")]),s._v(" ç”Ÿå‘¨æœŸç®¡ç†æ€»ä½“ç±»å›¾")]),s._v(" "),t("p",[s._v("æ€»ç»“ä¸€ä¸‹ Tomcat ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†, å†æ¥çœ‹ä¸€å¼ æ€»ä½“ç±»å›¾ç»§ç»­åŠ æ·±å°è±¡.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161039-ucf2yi3.png",alt:""}})]),s._v(" "),t("p",[s._v("æ³¨æ„, å›¾ä¸­çš„ "),t("strong",[s._v("StandardServer, StandardService")]),s._v(" ç­‰æ˜¯ Server å’Œ Service ç»„ä»¶çš„"),t("strong",[s._v("å…·ä½“å®ç°ç±»")]),s._v(", å®ƒä»¬éƒ½ç»§æ‰¿äº† LifeCycleBase ç±».")]),s._v(" "),t("p",[t("strong",[s._v("StandardEngine, StandardHost, StandardContext å’Œ StandardWrapper")]),s._v(" æ˜¯ç›¸åº”å®¹å™¨ç»„ä»¶çš„å…·ä½“å®ç°ç±», å› ä¸ºå®ƒä»¬éƒ½æ˜¯å®¹å™¨, æ‰€ä»¥ç»§æ‰¿äº† ContainerBase æŠ½è±¡åŸºç±», è€Œ ContainerBase å®ç°äº† Container æ¥å£, ä¹Ÿç»§æ‰¿äº† LifeCycleBase ç±», å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æ¥å£å’ŒåŠŸèƒ½æ¥å£æ˜¯åˆ†å¼€çš„, è¿™ä¹Ÿç¬¦åˆè®¾è®¡ä¸­"),t("strong",[s._v("æ¥å£åˆ†ç¦»çš„åŸåˆ™")]),s._v(".")]),s._v(" "),t("p",[s._v("Tomcat ä¸ºäº†å®ç°ä¸€é”®å¼å¯åœä»¥åŠä¼˜é›…çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†, å¹¶è€ƒè™‘åˆ°äº†å¯æ‰©å±•æ€§å’Œå¯é‡ç”¨æ€§, å°†é¢å‘å¯¹è±¡æ€æƒ³å’Œè®¾è®¡æ¨¡å¼å‘æŒ¥åˆ°äº†æè‡´, åˆ†åˆ«è¿ç”¨äº†"),t("strong",[s._v("ç»„åˆæ¨¡å¼, è§‚å¯Ÿè€…æ¨¡å¼, éª¨æ¶æŠ½è±¡ç±»å’Œæ¨¡æ¿æ–¹æ³•")]),s._v(". å¦‚æœä½ éœ€è¦ç»´æŠ¤ä¸€å †å…·æœ‰çˆ¶å­å…³ç³»çš„å®ä½“, å¯ä»¥è€ƒè™‘ä½¿ç”¨ç»„åˆæ¨¡å¼. è§‚å¯Ÿè€…æ¨¡å¼å¬èµ·æ¥â€œé«˜å¤§ä¸Šâ€, å…¶å®å°±æ˜¯å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿå, éœ€è¦æ‰§è¡Œä¸€è¿ä¸²æ›´æ–°æ“ä½œ. ä¼ ç»Ÿçš„å®ç°æ–¹å¼æ˜¯åœ¨äº‹ä»¶å“åº”ä»£ç é‡Œç›´æ¥åŠ æ›´æ–°é€»è¾‘, å½“æ›´æ–°é€»è¾‘åŠ å¤šäº†ä¹‹å, ä»£ç ä¼šå˜å¾—è‡ƒè‚¿, å¹¶ä¸”è¿™ç§æ–¹å¼æ˜¯ç´§è€¦åˆçš„, ä¾µå…¥å¼çš„. è€Œè§‚å¯Ÿè€…æ¨¡å¼å®ç°äº†ä½è€¦åˆ, éä¾µå…¥å¼çš„é€šçŸ¥ä¸æ›´æ–°æœºåˆ¶. è€Œæ¨¡æ¿æ–¹æ³•åœ¨æŠ½è±¡åŸºç±»ä¸­ç»å¸¸ç”¨åˆ°, ç”¨æ¥å®ç°é€šç”¨é€»è¾‘.")]),s._v(" "),t("h4",{attrs:{id:"_8-tomcatçš„-é«˜å±‚ä»¬-éƒ½è´Ÿè´£åšä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-tomcatçš„-é«˜å±‚ä»¬-éƒ½è´Ÿè´£åšä»€ä¹ˆ"}},[s._v("#")]),s._v(' 8.Tomcatçš„"é«˜å±‚ä»¬"éƒ½è´Ÿè´£åšä»€ä¹ˆ?')]),s._v(" "),t("p",[s._v("é€šè¿‡ Tomcat çš„ /bin ç›®å½•ä¸‹çš„è„šæœ¬ startup.sh å¯ä»¥å¯åŠ¨ Tomcat, æ‰§è¡Œäº†è¿™ä¸ªè„šæœ¬åå‘ç”Ÿäº†ä»€ä¹ˆ? å¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¼ æµç¨‹å›¾æ¥äº†è§£ä¸€ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161100-ut6smnd.png",alt:""}})]),s._v(" "),t("p",[s._v("1.Tomcat æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Java ç¨‹åº, å› æ­¤ startup.sh è„šæœ¬ä¼š"),t("strong",[s._v("å¯åŠ¨ä¸€ä¸ª JVM æ¥è¿è¡Œ Tomcat çš„å¯åŠ¨ç±» Bootstrap")]),s._v(".")]),s._v(" "),t("p",[s._v("2.Bootstrap çš„ä¸»è¦ä»»åŠ¡æ˜¯"),t("strong",[s._v("åˆå§‹åŒ– Tomcat çš„ç±»åŠ è½½å™¨, å¹¶ä¸”åˆ›å»º Catalina")]),s._v(". å…³äº Tomcat ä¸ºä»€ä¹ˆéœ€è¦è‡ªå·±çš„ç±»åŠ è½½å™¨, åé¢ä¼šè¯¦ç»†ä»‹ç».")]),s._v(" "),t("p",[s._v("3."),t("strong",[s._v("Catalina æ˜¯ä¸€ä¸ªå¯åŠ¨ç±», å®ƒé€šè¿‡è§£æ server.xml, åˆ›å»ºç›¸åº”çš„ç»„ä»¶, å¹¶è°ƒç”¨ Server çš„ start() æ–¹æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("4.Server ç»„ä»¶çš„èŒè´£å°±æ˜¯"),t("strong",[s._v("ç®¡ç† Service ç»„ä»¶, å®ƒä¼šè´Ÿè´£è°ƒç”¨ Service çš„ start() æ–¹æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("5.Service ç»„ä»¶çš„èŒè´£å°±æ˜¯"),t("strong",[s._v("ç®¡ç†è¿æ¥å™¨å’Œé¡¶å±‚å®¹å™¨ Engine, å› æ­¤å®ƒä¼šè°ƒç”¨è¿æ¥å™¨å’Œ Engine çš„ start() æ–¹æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ · Tomcat çš„å¯åŠ¨å°±ç®—å®Œæˆäº†. ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ä¸Šé¢è¿™ä¸ªå¯åŠ¨è¿‡ç¨‹ä¸­æåˆ°çš„å‡ ä¸ªéå¸¸å…³é”®çš„å¯åŠ¨ç±»å’Œç»„ä»¶.")]),s._v(" "),t("p",[s._v("å¯ä»¥æŠŠ Bootstrap çœ‹ä½œæ˜¯ä¸Šå¸, å®ƒåˆå§‹åŒ–äº†ç±»åŠ è½½å™¨, ä¹Ÿå°±æ˜¯åˆ›é€ ä¸‡ç‰©çš„å·¥å…·.")]),s._v(" "),t("p",[s._v("å¦‚æœæŠŠ Tomcat æ¯”ä½œæ˜¯ä¸€å®¶å…¬å¸, é‚£ä¹ˆ Catalina åº”è¯¥æ˜¯å…¬å¸åˆ›å§‹äºº, å› ä¸º Catalina è´Ÿè´£ç»„å»ºå›¢é˜Ÿ, ä¹Ÿå°±æ˜¯åˆ›å»º Server ä»¥åŠå®ƒçš„å­ç»„ä»¶.")]),s._v(" "),t("p",[s._v("Server æ˜¯å…¬å¸çš„ CEO, è´Ÿè´£ç®¡ç†å¤šä¸ªäº‹ä¸šç¾¤, æ¯ä¸ªäº‹ä¸šç¾¤å°±æ˜¯ä¸€ä¸ª Service.")]),s._v(" "),t("p",[s._v("Service æ˜¯äº‹ä¸šç¾¤æ€»ç»ç†, å®ƒç®¡ç†ä¸¤ä¸ªèŒèƒ½éƒ¨é—¨: ä¸€ä¸ªæ˜¯å¯¹å¤–çš„å¸‚åœºéƒ¨, ä¹Ÿå°±æ˜¯è¿æ¥å™¨ç»„ä»¶; å¦ä¸€ä¸ªæ˜¯å¯¹å†…çš„ç ”å‘éƒ¨, ä¹Ÿå°±æ˜¯å®¹å™¨ç»„ä»¶.")]),s._v(" "),t("p",[s._v("Engine åˆ™æ˜¯ç ”å‘éƒ¨ç»ç†, å› ä¸º Engine æ˜¯æœ€é¡¶å±‚çš„å®¹å™¨ç»„ä»¶.")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°"),t("strong",[s._v("è¿™äº›å¯åŠ¨ç±»æˆ–è€…ç»„ä»¶ä¸å¤„ç†å…·ä½“è¯·æ±‚")]),s._v(', å®ƒä»¬çš„ä»»åŠ¡ä¸»è¦æ˜¯"ç®¡ç†", '),t("strong",[s._v('ç®¡ç†ä¸‹å±‚ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ, å¹¶ä¸”ç»™ä¸‹å±‚ç»„ä»¶åˆ†é…ä»»åŠ¡, ä¹Ÿå°±æ˜¯æŠŠè¯·æ±‚è·¯ç”±åˆ°è´Ÿè´£"å¹²æ´»å„¿"çš„ç»„ä»¶. å› æ­¤æŠŠå®ƒä»¬æ¯”ä½œ Tomcat çš„"é«˜å±‚"')]),s._v(" .")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ¥çœ‹çœ‹è¿™äº› "),t("strong",[s._v('"é«˜å±‚"')]),s._v(" çš„å®ç°ç»†èŠ‚, è¿›è€Œé€æ­¥ç†è§£ Tomcat çš„å·¥ä½œåŸç†. å¦ä¸€æ–¹é¢, è½¯ä»¶ç³»ç»Ÿä¸­å¾€å¾€éƒ½æœ‰ä¸€äº›èµ·ç®¡ç†ä½œç”¨çš„ç»„ä»¶, å¯ä»¥å­¦ä¹ å’Œå€Ÿé‰´ Tomcat æ˜¯å¦‚ä½•å®ç°è¿™äº›ç»„ä»¶çš„.")]),s._v(" "),t("h5",{attrs:{id:"catalina"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#catalina"}},[s._v("#")]),s._v(" Catalina")]),s._v(" "),t("p",[s._v("Catalina çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯"),t("strong",[s._v("åˆ›å»º Server")]),s._v(', å®ƒä¸æ˜¯ç›´æ¥ new ä¸€ä¸ª Server å®ä¾‹å°±å®Œäº‹äº†, è€Œæ˜¯éœ€è¦è§£æ server.xml, æŠŠåœ¨ server.xml é‡Œé…ç½®çš„å„ç§ç»„ä»¶ä¸€ä¸€åˆ›å»ºå‡ºæ¥, æ¥ç€è°ƒç”¨ Server ç»„ä»¶çš„ init() æ–¹æ³•å’Œ start() æ–¹æ³•, è¿™æ ·æ•´ä¸ª Tomcat å°±å¯åŠ¨èµ·æ¥äº†. ä½œä¸º"ç®¡ç†è€…", Catalina è¿˜éœ€è¦å¤„ç†å„ç§"å¼‚å¸¸"æƒ…å†µ, æ¯”å¦‚å½“é€šè¿‡ "Ctrl + C" å…³é—­ Tomcat æ—¶, Tomcat å°†å¦‚ä½•ä¼˜é›…çš„åœæ­¢å¹¶ä¸”æ¸…ç†èµ„æºå‘¢? å› æ­¤ Catalina åœ¨ JVM ä¸­æ³¨å†Œä¸€ä¸ª "å…³é—­é’©å­".')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1. å¦‚æœæŒæœ‰çš„ Server å®ä¾‹ä¸ºç©º, å°±è§£æ server.xml åˆ›å»ºå‡ºæ¥")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("load")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2. å¦‚æœåˆ›å»ºå¤±è´¥, æŠ¥é”™é€€å‡º")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fatal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"catalina.noServer"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3. å¯åŠ¨ Server")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºå¹¶æ³¨å†Œå…³é—­é’©å­")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("useShutdownHook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shutdownHook "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            shutdownHook "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CatalinaShutdownHook")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runtime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRuntime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addShutdownHook")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shutdownHook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨ await æ–¹æ³•ç›‘å¬åœæ­¢è¯·æ±‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("await"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("await")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("p",[s._v('ä»€ä¹ˆæ˜¯"å…³é—­é’©å­"? å¦‚æœéœ€è¦åœ¨ '),t("strong",[s._v("JVM å…³é—­æ—¶åšä¸€äº›æ¸…ç†å·¥ä½œ")]),s._v(', æ¯”å¦‚å°†ç¼“å­˜æ•°æ®åˆ·åˆ°ç£ç›˜ä¸Š, æˆ–è€…æ¸…ç†ä¸€äº›ä¸´æ—¶æ–‡ä»¶, å¯ä»¥å‘ JVM æ³¨å†Œä¸€ä¸ª"å…³é—­é’©å­". "å…³é—­é’©å­" å…¶å®å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹, JVM åœ¨åœæ­¢ä¹‹å‰ä¼šå°è¯•æ‰§è¡Œè¿™ä¸ªçº¿ç¨‹çš„ run() æ–¹æ³•. ä¸‹é¢æ¥çœ‹çœ‹ Tomcat çš„ "å…³é—­é’©å­" CatalinaShutdownHook åšäº†äº›ä»€ä¹ˆ.')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CatalinaShutdownHook")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Catalina")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹å‡º Tomcat çš„  "),t("strong",[s._v('"å…³é—­é’©å­" å®é™…ä¸Šå°±æ‰§è¡Œäº† Server çš„ stop() æ–¹æ³•, Server çš„ stop() æ–¹æ³•ä¼šé‡Šæ”¾å’Œæ¸…ç†æ‰€æœ‰çš„èµ„æº')]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"serverç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#serverç»„ä»¶"}},[s._v("#")]),s._v(" Serverç»„ä»¶")]),s._v(" "),t("p",[s._v("Server ç»„ä»¶çš„å…·ä½“å®ç°ç±»æ˜¯ "),t("strong",[s._v("StandardServer")]),s._v(", æ¥çœ‹ä¸‹ StandardServer å…·ä½“å®ç°äº†å“ªäº›åŠŸèƒ½. Server ç»§æ‰¿äº† "),t("strong",[s._v("LifeCycleBase")]),s._v(", å®ƒçš„ç”Ÿå‘½å‘¨æœŸè¢«ç»Ÿä¸€ç®¡ç†, å¹¶ä¸”å®ƒçš„å­ç»„ä»¶æ˜¯ Service, å› æ­¤å®ƒè¿˜éœ€è¦ç®¡ç† Service çš„ç”Ÿå‘½å‘¨æœŸ, ä¹Ÿå°±æ˜¯è¯´åœ¨å¯åŠ¨æ—¶è°ƒç”¨ Service ç»„ä»¶çš„å¯åŠ¨æ–¹æ³•, åœ¨åœæ­¢æ—¶è°ƒç”¨å®ƒä»¬çš„åœæ­¢æ–¹æ³•. "),t("strong",[s._v("Server åœ¨å†…éƒ¨ç»´æŠ¤äº†è‹¥å¹² Service ç»„ä»¶")]),s._v(", å®ƒæ˜¯ä»¥æ•°ç»„æ¥ä¿å­˜çš„, é‚£ Server æ˜¯å¦‚ä½•æ·»åŠ ä¸€ä¸ª Service åˆ°æ•°ç»„ä¸­çš„å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Service")]),s._v(" service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servicesLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä¸€ä¸ªé•¿åº¦ +1 çš„æ–°æ•°ç»„")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Service")]),s._v(" results"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("services"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†è€çš„æ•°æ®å¤åˆ¶è¿‡å»")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("arraycopy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("services"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" results"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" services"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        results"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("services"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        services "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" results"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨ Service ç»„ä»¶")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isAvailable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Ignore")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è§¦å‘ç›‘å¬äº‹ä»¶")]),s._v("\n        support"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("firePropertyChange")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡º, å®ƒå¹¶æ²¡æœ‰ä¸€å¼€å§‹å°±åˆ†é…ä¸€ä¸ªå¾ˆé•¿çš„æ•°ç»„, è€Œæ˜¯"),t("strong",[s._v("åœ¨æ·»åŠ çš„è¿‡ç¨‹ä¸­åŠ¨æ€åœ°æ‰©å±•æ•°ç»„é•¿åº¦")]),s._v(", å½“æ·»åŠ ä¸€ä¸ªæ–°çš„ Service å®ä¾‹æ—¶, ä¼š"),t("strong",[s._v("åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„å¹¶æŠŠåŸæ¥æ•°ç»„å†…å®¹å¤åˆ¶åˆ°æ–°æ•°ç»„")]),s._v(", è¿™æ ·åšçš„ç›®çš„å…¶å®æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´.")]),s._v(" "),t("p",[s._v("é™¤æ­¤ä¹‹å¤–, Server ç»„ä»¶è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡æ˜¯å¯åŠ¨ä¸€ä¸ª Socket æ¥ç›‘å¬åœæ­¢ç«¯å£, è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ èƒ½é€šè¿‡ shutdown å‘½ä»¤æ¥å…³é—­ Tomcat. ä¸çŸ¥é“ä½ ç•™æ„åˆ°æ²¡æœ‰, ä¸Šé¢ Caralina çš„å¯åŠ¨æ–¹æ³•çš„æœ€åä¸€è¡Œä»£ç å°±æ˜¯è°ƒç”¨äº† Server çš„ await() æ–¹æ³•. åœ¨ await() æ–¹æ³•é‡Œä¼šåˆ›å»ºä¸€ä¸ª Socket ç›‘å¬ 8005 ç«¯å£, å¹¶åœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œ"),t("strong",[s._v("æ¥æ”¶ Socket ä¸Šçš„è¿æ¥è¯·æ±‚")]),s._v(', å¦‚æœæœ‰æ–°çš„è¿æ¥åˆ°æ¥å°±å»ºç«‹è¿æ¥, ç„¶åä» Socket ä¸­è¯»å–æ•°æ®; å¦‚æœè¯»åˆ°çš„æ•°æ®æ˜¯åœæ­¢å‘½ä»¤ "SHUTDOWN", å°±é€€å‡ºå¾ªç¯, è¿›å…¥ stop æµç¨‹.')]),s._v(" "),t("h5",{attrs:{id:"serviceç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#serviceç»„ä»¶"}},[s._v("#")]),s._v(" Serviceç»„ä»¶")]),s._v(" "),t("p",[s._v("Service ç»„ä»¶çš„å…·ä½“å®ç°ç±»æ˜¯ "),t("strong",[s._v("StandardService")]),s._v(", å…ˆæ¥çœ‹çœ‹å®ƒçš„å®šä¹‰ä»¥åŠå…³é”®çš„æˆå‘˜å˜é‡.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StandardService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleBase")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Service")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åå­—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Server å®ä¾‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Server")]),s._v(" server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿æ¥å™¨æ•°ç»„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connector")]),s._v(" connectors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" connectorsLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯¹åº”çš„ Engine å®¹å™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Engine")]),s._v(" engine "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ˜ å°„å™¨åŠå…¶ç›‘å¬å™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mapper")]),s._v(" mapper "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mapper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MapperListener")]),s._v(" mapperListener "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MapperListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("StandardService ç»§æ‰¿äº† LifecycleBase æŠ½è±¡ç±», æ­¤å¤– StandardService ä¸­è¿˜æœ‰ä¸€äº›ç†Ÿæ‚‰çš„ç»„ä»¶, æ¯”å¦‚ Server, Connector, Engine å’Œ Mapper.")]),s._v(" "),t("p",[s._v("é‚£ä¸ºä»€ä¹ˆè¿˜æœ‰ä¸€ä¸ª "),t("strong",[s._v("MapperListener")]),s._v("? è¿™æ˜¯å› ä¸º Tomcat æ”¯æŒçƒ­éƒ¨ç½², å½“ Web åº”ç”¨çš„éƒ¨ç½²å‘ç”Ÿå˜åŒ–æ—¶, Mapper ä¸­çš„æ˜ å°„ä¿¡æ¯ä¹Ÿè¦è·Ÿç€å˜åŒ–, "),t("strong",[s._v("MapperListener å°±æ˜¯ä¸€ä¸ªç›‘å¬å™¨, å®ƒç›‘å¬å®¹å™¨çš„å˜åŒ–, å¹¶æŠŠä¿¡æ¯æ›´æ–°åˆ° Mapper ä¸­, è¿™æ˜¯å…¸å‹çš„è§‚å¯Ÿè€…æ¨¡å¼")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v('ä½œä¸º"ç®¡ç†"è§’è‰²çš„ç»„ä»¶, æœ€é‡è¦çš„æ˜¯ç»´æŠ¤å…¶ä»–ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ')]),s._v(". æ­¤å¤–åœ¨å¯åŠ¨å„ç§ç»„ä»¶æ—¶, è¦æ³¨æ„å®ƒä»¬çš„ä¾èµ–å…³ç³», ä¹Ÿå°±æ˜¯è¯´, è¦æ³¨æ„å¯åŠ¨çš„é¡ºåº. æ¥çœ‹çœ‹ Service å¯åŠ¨æ–¹æ³•:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("startInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1. è§¦å‘å¯åŠ¨ç›‘å¬å™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STARTING")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2. å…ˆå¯åŠ¨ Engine, Engine ä¼šå¯åŠ¨å®ƒå­å®¹å™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("engine "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("engine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            engine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3. å†å¯åŠ¨ Mapper ç›‘å¬å™¨")]),s._v("\n    mapperListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4. æœ€åå¯åŠ¨è¿æ¥å™¨, è¿æ¥å™¨ä¼šå¯åŠ¨å®ƒå­ç»„ä»¶, æ¯”å¦‚ Endpoint")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connectorsLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connector")]),s._v(" connector"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" connectors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FAILED")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                connector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("ä»å¯åŠ¨æ–¹æ³•å¯ä»¥çœ‹åˆ°, Service å…ˆå¯åŠ¨äº† Engine ç»„ä»¶, å†å¯åŠ¨ Mapper ç›‘å¬å™¨, æœ€åæ‰æ˜¯å¯åŠ¨è¿æ¥å™¨. è¿™å¾ˆå¥½ç†è§£, å› ä¸º"),t("strong",[s._v("å†…å±‚ç»„ä»¶å¯åŠ¨å¥½äº†æ‰èƒ½å¯¹å¤–æä¾›æœåŠ¡, æ‰èƒ½å¯åŠ¨å¤–å±‚çš„è¿æ¥å™¨ç»„ä»¶")]),s._v(". è€Œ Mapper ä¹Ÿä¾èµ–å®¹å™¨ç»„ä»¶, å®¹å™¨ç»„ä»¶å¯åŠ¨å¥½äº†æ‰èƒ½ç›‘å¬å®ƒä»¬çš„å˜åŒ–, å› æ­¤ Mapper å’Œ MapperListener åœ¨å®¹å™¨ç»„ä»¶ä¹‹åå¯åŠ¨. ç»„ä»¶åœæ­¢çš„é¡ºåºè·Ÿå¯åŠ¨é¡ºåºæ­£å¥½ç›¸åçš„, ä¹Ÿæ˜¯åŸºäºå®ƒä»¬çš„ä¾èµ–å…³ç³».")]),s._v(" "),t("h5",{attrs:{id:"engineç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#engineç»„ä»¶"}},[s._v("#")]),s._v(" Engineç»„ä»¶")]),s._v(" "),t("p",[s._v("æœ€åå†æ¥çœ‹çœ‹é¡¶å±‚çš„å®¹å™¨ç»„ä»¶ Engine å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„. Engine æœ¬è´¨æ˜¯ä¸€ä¸ª"),t("strong",[s._v("å®¹å™¨")]),s._v(", å› æ­¤å®ƒç»§æ‰¿äº† ContainerBase åŸºç±», å¹¶ä¸”å®ç°äº† Engine æ¥å£.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StandardEngine")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ContainerBase")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Engine")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("Engine çš„å­å®¹å™¨æ˜¯ Host, æ‰€ä»¥"),t("strong",[s._v("å®ƒæŒæœ‰äº†ä¸€ä¸ª Host å®¹å™¨çš„æ•°ç»„")]),s._v(", è¿™äº›åŠŸèƒ½éƒ½è¢«æŠ½è±¡åˆ°äº† ContainerBase ä¸­, ContainerBase ä¸­æœ‰è¿™æ ·ä¸€ä¸ªæ•°æ®ç»“æ„:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" children "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v('ContainerBase ç”¨ HashMap ä¿å­˜äº†å®ƒçš„å­å®¹å™¨, å¹¶ä¸” ContainerBase è¿˜å®ç°äº†å­å®¹å™¨çš„"å¢åˆ æ”¹æŸ¥", ç”šè‡³è¿å­ç»„ä»¶çš„å¯åŠ¨å’Œåœæ­¢éƒ½æä¾›äº†é»˜è®¤å®ç°, æ¯”å¦‚ ContainerBase ä¼šç”¨ä¸“é—¨çš„çº¿ç¨‹æ± æ¥å¯åŠ¨å­å®¹å™¨.')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   results"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("startStopExecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StartChild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("æ‰€ä»¥ Engine åœ¨å¯åŠ¨ Host å­å®¹å™¨æ—¶å°±ç›´æ¥é‡ç”¨äº†è¿™ä¸ªæ–¹æ³•.")]),s._v(" "),t("p",[s._v('é‚£ Engine è‡ªå·±åšäº†ä»€ä¹ˆå‘¢? ç”±äºå®¹å™¨ç»„ä»¶æœ€é‡è¦çš„åŠŸèƒ½æ˜¯å¤„ç†è¯·æ±‚, è€Œ Engine å®¹å™¨å¯¹è¯·æ±‚çš„ "å¤„ç†", å…¶å®å°±æ˜¯æŠŠè¯·æ±‚'),t("strong",[s._v("è½¬å‘")]),s._v("ç»™æŸä¸€ä¸ª Host å­å®¹å™¨æ¥å¤„ç†, å…·ä½“æ˜¯"),t("strong",[s._v("é€šè¿‡ Valve æ¥å®ç°")]),s._v("çš„.")]),s._v(" "),t("p",[s._v("æ¯ä¸€ä¸ªå®¹å™¨ç»„ä»¶éƒ½æœ‰ä¸€ä¸ª "),t("strong",[s._v("Pipeline")]),s._v(", è€Œ Pipeline ä¸­æœ‰ä¸€ä¸ª"),t("strong",[s._v("åŸºç¡€é˜€(Basic Valve)")]),s._v(" , è€Œ Engine å®¹å™¨çš„åŸºç¡€é˜€å®šä¹‰å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StandardEngineValve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ValveBase")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Request")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Response")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‹¿åˆ°è¯·æ±‚ä¸­çš„ Host å®¹å™¨")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Host")]),s._v(" host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨ Host å®¹å™¨ä¸­çš„ Pipeline ä¸­çš„ç¬¬ä¸€ä¸ª Valve")]),s._v("\n      host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPipeline")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getFirst")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[t("strong",[s._v("è¿™ä¸ªåŸºç¡€é˜€å®ç°éå¸¸ç®€å•, å°±æ˜¯æŠŠè¯·æ±‚è½¬å‘åˆ° Host å®¹å™¨")]),s._v(". ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°, å¤„ç†è¯·æ±‚çš„ Host å®¹å™¨å¯¹è±¡æ˜¯ä»è¯·æ±‚ä¸­æ‹¿åˆ°çš„, è¯·æ±‚å¯¹è±¡ä¸­æ€ä¹ˆä¼šæœ‰ Host å®¹å™¨å‘¢? è¿™æ˜¯å› ä¸º"),t("strong",[s._v("è¯·æ±‚åˆ°è¾¾ Engine å®¹å™¨ä¸­ä¹‹å‰, Mapper ç»„ä»¶å·²ç»å¯¹è¯·æ±‚è¿›è¡Œäº†è·¯ç”±å¤„ç†, Mapper ç»„ä»¶é€šè¿‡è¯·æ±‚çš„ URL å®šä½äº†ç›¸åº”çš„å®¹å™¨, å¹¶ä¸”æŠŠå®¹å™¨å¯¹è±¡ä¿å­˜åˆ°äº†è¯·æ±‚å¯¹è±¡ä¸­")]),s._v(".")]),s._v(" "),t("p",[s._v("æ€»ç»“ Tomcat çš„è®¾è®¡, å½“åœ¨è®¾è®¡ç»„ä»¶æ—¶, éœ€è¦è€ƒè™‘ä¸¤ä¸ªæ–¹é¢:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("é¦–å…ˆè¦é€‰ç”¨åˆé€‚çš„æ•°æ®ç»“æ„æ¥ä¿å­˜å­ç»„ä»¶, æ¯”å¦‚ Server ç”¨æ•°ç»„æ¥ä¿å­˜ Service ç»„ä»¶, å¹¶ä¸”é‡‡å–åŠ¨æ€æ‰©å®¹çš„æ–¹å¼, è¿™æ˜¯å› ä¸ºæ•°ç»„ç»“æ„ç®€å•, å ç”¨å†…å­˜å°; å†æ¯”å¦‚ ContainerBase ç”¨ HashMap æ¥ä¿å­˜å­å®¹å™¨, è™½ç„¶ Map å ç”¨å†…å­˜ä¼šå¤šä¸€ç‚¹, ä½†æ˜¯å¯ä»¥é€šè¿‡ Map æ¥å¿«é€Ÿçš„æŸ¥æ‰¾å­å®¹å™¨. å› æ­¤åœ¨å®é™…çš„å·¥ä½œä¸­, ä¹Ÿéœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯å’Œéœ€æ±‚æ¥é€‰ç”¨åˆé€‚çš„æ•°æ®ç»“æ„.")])]),s._v(" "),t("li",[t("p",[s._v('å…¶æ¬¡è¿˜éœ€è¦æ ¹æ®å­ç»„ä»¶ä¾èµ–å…³ç³»æ¥å†³å®šå®ƒä»¬çš„å¯åŠ¨å’Œåœæ­¢é¡ºåº, ä»¥åŠå¦‚ä½•ä¼˜é›…çš„åœæ­¢, é˜²æ­¢å¼‚å¸¸æƒ…å†µä¸‹çš„èµ„æºæ³„æ¼. è¿™æ­£æ˜¯ "ç®¡ç†è€…" åº”è¯¥è€ƒè™‘çš„äº‹æƒ….')])])]),s._v(" "),t("h4",{attrs:{id:"_9-jettyåŸºç¡€æ¶æ„åˆ†æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-jettyåŸºç¡€æ¶æ„åˆ†æ"}},[s._v("#")]),s._v(" 9.JettyåŸºç¡€æ¶æ„åˆ†æ")]),s._v(" "),t("p",[s._v("Servlet å®¹å™¨å¹¶éåªæœ‰ Tomcat ä¸€å®¶, è¿˜æœ‰åˆ«çš„æ¶æ„è®¾è®¡æ€è·¯å—? ä¸‹é¢çœ‹çœ‹ Jetty çš„è®¾è®¡ç‰¹ç‚¹.")]),s._v(" "),t("p",[s._v('å’Œ Tomcat ä¸€æ ·, Jetty ä¹Ÿæ˜¯ä¸€ä¸ª "HTTP æœåŠ¡å™¨ + Servlet å®¹å™¨", å¹¶ä¸” Jetty å’Œ Tomcat åœ¨æ¶æ„è®¾è®¡ä¸Šæœ‰ä¸å°‘ç›¸ä¼¼çš„åœ°æ–¹. ä½†åŒæ—¶ Jetty ä¹Ÿæœ‰è‡ªå·±çš„ç‰¹ç‚¹, ä¸»è¦æ˜¯æ›´åŠ å°å·§, æ›´æ˜“äºå®šåˆ¶åŒ–. Jetty ä½œä¸ºä¸€ååèµ·ä¹‹ç§€, åº”ç”¨èŒƒå›´ä¹Ÿè¶Šæ¥è¶Šå¹¿, æ¯”å¦‚ Google App Engine å°±é‡‡ç”¨äº† Jetty æ¥ä½œä¸º Web å®¹å™¨. Jetty å’Œ Tomcat å„æœ‰ç‰¹ç‚¹, è¿™é‡Œé‡ç‚¹çœ‹çœ‹ Jetty åœ¨å“ªäº›åœ°æ–¹è·Ÿ Tomcat ä¸åŒ. é€šè¿‡æ¯”è¾ƒå®ƒä»¬çš„å·®å¼‚, å¯ä»¥ç»§ç»­åŠ æ·±å¯¹ Web å®¹å™¨æ¶æ„è®¾è®¡çš„ç†è§£, å¦ä¸€æ–¹é¢ä¹Ÿæ›´æ¸…æ¥šå®ƒä»¬çš„è®¾è®¡åŒºåˆ«, å¹¶æ ¹æ®å®ƒä»¬çš„ç‰¹ç‚¹æ¥é€‰ç”¨è¿™ä¸¤æ¬¾ Web å®¹å™¨.')]),s._v(" "),t("h5",{attrs:{id:"jettyæ•´ä½“æ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jettyæ•´ä½“æ¶æ„"}},[s._v("#")]),s._v(" Jettyæ•´ä½“æ¶æ„")]),s._v(" "),t("p",[s._v("ç®€å•æ¥è¯´, Jetty Server å°±æ˜¯ç”±å¤šä¸ª "),t("strong",[s._v("Connector")]),s._v("(è¿æ¥å™¨), å¤šä¸ª "),t("strong",[s._v("Handler")]),s._v("(å¤„ç†å™¨), ä»¥åŠä¸€ä¸ªçº¿ç¨‹æ± ç»„æˆ. æ•´ä½“ç»“æ„å¦‚ä¸‹å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161119-s1sa5ui.jpg",alt:""}})]),s._v(" "),t("p",[s._v("è·Ÿ Tomcat ä¸€æ ·, "),t("strong",[s._v("Jetty ä¹Ÿæœ‰ HTTP æœåŠ¡å™¨å’Œ Servlet å®¹å™¨çš„åŠŸèƒ½, å› æ­¤ Jetty ä¸­çš„ Connector ç»„ä»¶å’Œ Handler ç»„ä»¶åˆ†åˆ«æ¥å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½, è€Œè¿™ä¸¤ä¸ªç»„ä»¶å·¥ä½œæ—¶æ‰€éœ€è¦çš„çº¿ç¨‹èµ„æºéƒ½ç›´æ¥ä»ä¸€ä¸ªå…¨å±€çº¿ç¨‹æ±  ThreadPool ä¸­è·å–")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("Jetty Server å¯ä»¥æœ‰å¤šä¸ª Connector åœ¨ä¸åŒçš„ç«¯å£ä¸Šç›‘å¬å®¢æˆ·è¯·æ±‚, è€Œå¯¹äºè¯·æ±‚å¤„ç†çš„ Handler ç»„ä»¶, ä¹Ÿå¯ä»¥æ ¹æ®å…·ä½“åœºæ™¯ä½¿ç”¨ä¸åŒçš„ Handler")]),s._v(". è¿™æ ·çš„è®¾è®¡æé«˜äº† Jetty çš„çµæ´»æ€§, éœ€è¦æ”¯æŒ Servlet, åˆ™å¯ä»¥ä½¿ç”¨ ServletHandler; éœ€è¦æ”¯æŒ Session, åˆ™å†å¢åŠ ä¸€ä¸ª SessionHandler. ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä¸ä½¿ç”¨ Servlet æˆ– Session, åªè¦ä¸é…ç½®è¿™ä¸ª Handler å°±è¡Œäº†.")]),s._v(" "),t("p",[s._v("ä¸ºäº†å¯åŠ¨å’Œåè°ƒä¸Šé¢çš„æ ¸å¿ƒç»„ä»¶å·¥ä½œ, Jetty æä¾›äº†ä¸€ä¸ª "),t("strong",[s._v("Server")]),s._v(" ç±»æ¥åšè¿™ä¸ªäº‹æƒ…, å®ƒè´Ÿè´£åˆ›å»ºå¹¶åˆå§‹åŒ– Connector, Handler, ThreadPool ç»„ä»¶, ç„¶åè°ƒç”¨ start æ–¹æ³•å¯åŠ¨å®ƒä»¬.")]),s._v(" "),t("p",[s._v("å¯¹æ¯”ä¸€ä¸‹ Tomcat çš„æ•´ä½“æ¶æ„å›¾, å¯ä»¥å‘ç° Tomcat åœ¨æ•´ä½“ä¸Šè·Ÿ Jetty å¾ˆç›¸ä¼¼, ä½†ä¹Ÿæœ‰ä¸€äº›åŒºåˆ«.")]),s._v(" "),t("p",[t("strong",[s._v("å®ƒä»¬çš„ç¬¬ä¸€ä¸ªåŒºåˆ«")]),s._v("æ˜¯ Jetty ä¸­æ²¡æœ‰ Service çš„æ¦‚å¿µ, Tomcat ä¸­çš„ Service åŒ…è£…äº†å¤šä¸ªè¿æ¥å™¨å’Œä¸€ä¸ªå®¹å™¨ç»„ä»¶, ä¸€ä¸ª Tomcat å®ä¾‹å¯ä»¥é…ç½®å¤šä¸ª Service, ä¸åŒçš„ Service é€šè¿‡ä¸åŒçš„è¿æ¥å™¨ç›‘å¬ä¸åŒçš„ç«¯å£; è€Œ Jetty ä¸­ "),t("strong",[s._v("Connector æ˜¯è¢«æ‰€æœ‰ Handler å…±äº«çš„")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161119-ftahlji.jpg",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("å®ƒä»¬çš„ç¬¬äºŒä¸ªåŒºåˆ«")]),s._v("æ˜¯, åœ¨ Tomcat ä¸­æ¯ä¸ªè¿æ¥å™¨éƒ½æœ‰è‡ªå·±çš„çº¿ç¨‹æ± , è€Œåœ¨ Jetty ä¸­"),t("strong",[s._v("æ‰€æœ‰çš„ Connector å…±äº«ä¸€ä¸ªå…¨å±€çš„çº¿ç¨‹æ± ")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"connectorç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#connectorç»„ä»¶"}},[s._v("#")]),s._v(" Connectorç»„ä»¶")]),s._v(" "),t("p",[s._v("è·Ÿ Tomcat ä¸€æ ·, Connector çš„ä¸»è¦åŠŸèƒ½æ˜¯å¯¹ I/O æ¨¡å‹å’Œåº”ç”¨å±‚åè®®çš„å°è£…. I/O æ¨¡å‹æ–¹é¢, æœ€æ–°çš„ Jetty 9 ç‰ˆæœ¬åªæ”¯æŒ NIO, å› æ­¤ Jetty çš„ Connector è®¾è®¡æœ‰æ˜æ˜¾çš„ Java NIO é€šä¿¡æ¨¡å‹çš„ç—•è¿¹. è‡³äºåº”ç”¨å±‚åè®®æ–¹é¢, è·Ÿ Tomcat çš„ Processor ä¸€æ ·, Jetty æŠ½è±¡å‡ºäº† Connection ç»„ä»¶æ¥å°è£…åº”ç”¨å±‚åè®®çš„å·®å¼‚.")]),s._v(" "),t("p",[s._v("Java NIO æ—©å·²æˆä¸ºç¨‹åºå‘˜çš„å¿…å¤‡æŠ€èƒ½, æ¥ä¸‹æ¥çœ‹çœ‹ Jetty æ˜¯å¦‚ä½•å®ç° NIO æ¨¡å‹çš„, ä»¥åŠå®ƒæ˜¯æ€ä¹ˆ**ç”¨ ** Java NIO çš„.")]),s._v(" "),t("p",[s._v("Java NIO çš„æ ¸å¿ƒç»„ä»¶æ˜¯ Channel, Buffer å’Œ Selector.")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Channel è¡¨ç¤ºä¸€ä¸ªè¿æ¥, å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª Socket, é€šè¿‡å®ƒå¯ä»¥è¯»å–å’Œå†™å…¥æ•°æ®, ä½†æ˜¯å¹¶ä¸èƒ½ç›´æ¥æ“ä½œæ•°æ®, éœ€è¦é€šè¿‡ Buffer æ¥ä¸­è½¬.")])]),s._v(" "),t("li",[t("p",[s._v("Selector å¯ä»¥ç”¨æ¥æ£€æµ‹ Channel ä¸Šçš„ I/O äº‹ä»¶, æ¯”å¦‚è¯»å°±ç»ª, å†™å°±ç»ª, è¿æ¥å°±ç»ª, ä¸€ä¸ª Selector å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ª Channel, å› æ­¤å•ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ª Channel, è¿™æ ·ä¼šå¤§é‡å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€.")])])]),s._v(" "),t("p",[s._v("ä¸‹é¢é€šè¿‡ä¸€ä¸ªå…¸å‹çš„æœåŠ¡ç«¯ NIO ç¨‹åºæ¥å›é¡¾ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨è¿™äº›ç»„ä»¶.")]),s._v(" "),t("p",[s._v("é¦–å…ˆ, åˆ›å»ºæœåŠ¡ç«¯ Channel, ç»‘å®šç›‘å¬ç«¯å£å¹¶æŠŠ Channel è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),s._v(" server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("socket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetSocketAddress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configureBlocking")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("ç„¶å, åˆ›å»º Selector, å¹¶åœ¨ Selector ä¸­æ³¨å†Œ Channel æ„Ÿå…´è¶£çš„äº‹ä»¶ OP_ACCEPT, å‘Šè¯‰ Selector å¦‚æœå®¢æˆ·ç«¯æœ‰æ–°çš„è¿æ¥è¯·æ±‚åˆ°è¿™ä¸ªç«¯å£å°±é€šçŸ¥æˆ‘.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Selector")]),s._v(" selector "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OP_ACCEPT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("æ¥ä¸‹æ¥, Selector ä¼šåœ¨ä¸€ä¸ª"),t("strong",[s._v("æ­»å¾ªç¯")]),s._v('é‡Œä¸æ–­åœ°è°ƒç”¨ select() å»æŸ¥è¯¢ I/O çŠ¶æ€, select() ä¼šè¿”å›ä¸€ä¸ª SelectionKey åˆ—è¡¨, Selector ä¼šéå†è¿™ä¸ªåˆ—è¡¨, çœ‹çœ‹æ˜¯å¦æœ‰ "å®¢æˆ·" æ„Ÿå…´è¶£çš„äº‹ä»¶, å¦‚æœæœ‰, å°±é‡‡å–ç›¸åº”çš„åŠ¨ä½œ.')]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­, å¦‚æœæœ‰æ–°çš„è¿æ¥è¯·æ±‚, å°±ä¼šå»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥. è¿æ¥å»ºç«‹å, å†æ³¨å†Œ Channel çš„å¯è¯»äº‹ä»¶åˆ° Selector ä¸­, å‘Šè¯‰ Selector æˆ‘å¯¹è¿™ä¸ª Channel ä¸Šæ˜¯å¦æœ‰æ–°çš„æ•°æ®åˆ°è¾¾æ„Ÿå…´è¶£.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥è¯¢ I/O äº‹ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iterator")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectedKeys")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("iterator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),s._v(" key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isAcceptable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å»ºç«‹ä¸€ä¸ªæ–°è¿æ¥ ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketChannel")]),s._v(" client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n            client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configureBlocking")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n      \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿æ¥å»ºç«‹å, å‘Šè¯‰ Selector, æˆ‘ç°åœ¨å¯¹ I/O å¯è¯»äº‹ä»¶æ„Ÿå…´è¶£")]),s._v("\n            client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OP_READ")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("ç®€å•å›é¡¾å®ŒæœåŠ¡ç«¯ NIO ç¼–ç¨‹ä¹‹å, ä½ ä¼šå‘ç°æœåŠ¡ç«¯åœ¨ I/O é€šä¿¡ä¸Šä¸»è¦å®Œæˆäº†ä¸‰ä»¶äº‹æƒ…: "),t("strong",[s._v("ç›‘å¬è¿æ¥, I/O äº‹ä»¶æŸ¥è¯¢ä»¥åŠæ•°æ®è¯»å†™")]),s._v(". å› æ­¤ Jetty è®¾è®¡äº† "),t("strong",[s._v("Acceptor, SelectorManager å’Œ Connection æ¥åˆ†åˆ«åšè¿™ä¸‰ä»¶äº‹æƒ…")]),s._v(", ä¸‹é¢åˆ†åˆ«æ¥è¯´è¯´è¿™ä¸‰ä¸ªç»„ä»¶.")]),s._v(" "),t("h6",{attrs:{id:"_1-acceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-acceptor"}},[s._v("#")]),s._v(" 1.Acceptor")]),s._v(" "),t("p",[s._v("é¡¾åæ€ä¹‰, Acceptor ç”¨äº"),t("strong",[s._v("æ¥å—è¯·æ±‚")]),s._v(", è·Ÿ Tomcat ä¸€æ ·, Jetty ä¹Ÿæœ‰ç‹¬ç«‹çš„ Acceptor çº¿ç¨‹ç»„ç”¨äºå¤„ç†è¿æ¥è¯·æ±‚. åœ¨ Connector çš„å®ç°ç±» ServerConnector ä¸­, æœ‰ä¸€ä¸ª "),t("code",[s._v("_acceptors")]),s._v("â€‹ çš„æ•°ç»„, åœ¨ Connector å¯åŠ¨çš„æ—¶å€™, ä¼šæ ¹æ®"),t("code",[s._v("_acceptors")]),s._v("â€‹ æ•°ç»„çš„é•¿åº¦åˆ›å»ºå¯¹åº”æ•°é‡çš„ Acceptor, è€Œ Acceptor çš„ä¸ªæ•°å¯ä»¥é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" _acceptors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Acceptor")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Acceptor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("Acceptor æ˜¯ ServerConnector ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±», åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª Runnable, Acceptor çº¿ç¨‹æ˜¯é€šè¿‡ getExecutor() å¾—åˆ°çš„çº¿ç¨‹æ± æ¥æ‰§è¡Œçš„, å‰é¢æåˆ°è¿™æ˜¯ä¸€ä¸ªå…¨å±€çš„çº¿ç¨‹æ± .")]),s._v(" "),t("p",[s._v("Acceptor é€šè¿‡é˜»å¡çš„æ–¹å¼æ¥æ¥å—è¿æ¥, è¿™ä¸€ç‚¹è·Ÿ Tomcat ä¹Ÿæ˜¯ä¸€æ ·çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" acceptorID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),s._v(" serverChannel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _acceptChannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("serverChannel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" serverChannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isOpen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œæ˜¯é˜»å¡çš„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketChannel")]),s._v(" channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serverChannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œåˆ°è¿™é‡Œæ—¶è¯´æ˜æœ‰è¯·æ±‚è¿›æ¥äº†")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accepted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("æ¥å—è¿æ¥æˆåŠŸåä¼šè°ƒç”¨ accepted() å‡½æ•°, accepted() å‡½æ•°ä¸­ä¼šå°† SocketChannel è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼, ç„¶åäº¤ç»™ Selector å»å¤„ç†, å› æ­¤è¿™ä¹Ÿå°±åˆ°äº† Selector çš„åœ°ç•Œäº†.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accepted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketChannel")]),s._v(" channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configureBlocking")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Socket")]),s._v(" socket "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("socket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// _manager æ˜¯ SelectorManager å®ä¾‹, é‡Œé¢ç®¡ç†äº†æ‰€æœ‰çš„ Selector å®ä¾‹")]),s._v("\n    _manager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h6",{attrs:{id:"_2-selectormanager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-selectormanager"}},[s._v("#")]),s._v(" 2.SelectorManager")]),s._v(" "),t("p",[s._v("Jetty çš„ Selector ç”± SelectorManager ç±»ç®¡ç†, è€Œè¢«ç®¡ç†çš„ Selector å«ä½œ ManagedSelector. SelectorManager å†…éƒ¨æœ‰ä¸€ä¸ª ManagedSelector æ•°ç»„, "),t("strong",[s._v("çœŸæ­£å¹²æ´»çš„æ˜¯ ManagedSelector")]),s._v(". å’±ä»¬æ¥ç€ä¸Šé¢åˆ†æ, çœ‹çœ‹åœ¨ SelectorManager åœ¨ accept æ–¹æ³•é‡Œåšäº†ä»€ä¹ˆ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectableChannel")]),s._v(" channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€‰æ‹©ä¸€ä¸ª ManagedSelector æ¥å¤„ç† Channel")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ManagedSelector")]),s._v(" selector "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chooseSelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤ä¸€ä¸ªä»»åŠ¡ Accept ç»™ ManagedSelector")]),s._v("\n  selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("SelectorManager ä»æœ¬èº«çš„ Selector æ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ª Selector æ¥å¤„ç†è¿™ä¸ª Channel, å¹¶åˆ›å»ºä¸€ä¸ªä»»åŠ¡ Accept äº¤ç»™ ManagedSelector, ManagedSelector åœ¨å¤„ç†è¿™ä¸ªä»»åŠ¡ä¸»è¦åšäº†ä¸¤æ­¥:")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€æ­¥, è°ƒç”¨ Selector çš„ register æ–¹æ³•æŠŠ Channel "),t("strong",[s._v("æ³¨å†Œåˆ° Selector")]),s._v(" ä¸Š, æ‹¿åˆ°ä¸€ä¸ª SelectionKey.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v(" _key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OP_ACCEPT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç¬¬äºŒæ­¥, åˆ›å»ºä¸€ä¸ª EndPoint å’Œ Connection, å¹¶è·Ÿè¿™ä¸ª SelectionKey(Channel)ç»‘åœ¨ä¸€èµ·:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createEndPoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectableChannel")]),s._v(" channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),s._v(" selectionKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. åˆ›å»º Endpoint")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EndPoint")]),s._v(" endPoint "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _selectorManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newEndPoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" selectionKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. åˆ›å»º Connection")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connection")]),s._v(" connection "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _selectorManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" endPoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" selectionKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("attachment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. æŠŠ Endpoint, Connection å’Œ SelectionKey ç»‘åœ¨ä¸€èµ·")]),s._v("\n    endPoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    selectionKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("attach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("endPoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("ä¸Šé¢è¿™ä¸¤ä¸ªè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ„æ€å‘¢? æ‰“ä¸ªæ¯”æ–¹, ä½ åˆ°é¤å…åƒé¥­, å…ˆç‚¹èœ(æ³¨å†Œ I/O äº‹ä»¶), æœåŠ¡å‘˜(ManagedSelector)ç»™ä½ ä¸€ä¸ªå•å­(SelectionKey), ç­‰èœåšå¥½äº†(I/O äº‹ä»¶åˆ°äº†), æœåŠ¡å‘˜æ ¹æ®å•å­å°±çŸ¥é“æ˜¯å“ªæ¡Œç‚¹äº†è¿™ä¸ªèœ, äºæ˜¯å–Šä¸€å—“å­æŸæŸæ¡Œçš„èœåšå¥½äº†(è°ƒç”¨äº†ç»‘å®šåœ¨ SelectionKey ä¸Šçš„ EndPoint çš„æ–¹æ³•).")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦ä½ ç‰¹åˆ«æ³¨æ„çš„æ˜¯, ManagedSelector å¹¶æ²¡æœ‰è°ƒç”¨ç›´æ¥ EndPoint çš„æ–¹æ³•å»å¤„ç†æ•°æ®, è€Œæ˜¯é€šè¿‡è°ƒç”¨ EndPoint çš„æ–¹æ³•"),t("strong",[s._v("è¿”å›ä¸€ä¸ª Runnable, ç„¶åæŠŠè¿™ä¸ª Runnable æ‰”ç»™çº¿ç¨‹æ± æ‰§è¡Œ")]),s._v(", æ‰€ä»¥ä½ èƒ½çŒœåˆ°, è¿™ä¸ª Runnable æ‰ä¼šå»çœŸæ­£è¯»æ•°æ®å’Œå¤„ç†è¯·æ±‚.")]),s._v(" "),t("h6",{attrs:{id:"_3-connection"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-connection"}},[s._v("#")]),s._v(" 3.Connection")]),s._v(" "),t("p",[s._v("è¿™ä¸ª Runnable æ˜¯ EndPoint çš„ä¸€ä¸ªå†…éƒ¨ç±», å®ƒä¼šè°ƒç”¨ Connection çš„"),t("strong",[s._v("å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯·æ±‚")]),s._v(". Jetty çš„ Connection ç»„ä»¶ç±»æ¯”å°±æ˜¯ Tomcat çš„ Processor, è´Ÿè´£å…·ä½“åè®®çš„è§£æ, å¾—åˆ° Request å¯¹è±¡, å¹¶è°ƒç”¨ Handler å®¹å™¨è¿›è¡Œå¤„ç†. ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹å®ƒçš„å…·ä½“å®ç°ç±» HttpConnection å¯¹è¯·æ±‚å’Œå“åº”çš„å¤„ç†è¿‡ç¨‹.")]),s._v(" "),t("p",[t("strong",[s._v("è¯·æ±‚å¤„ç†")]),s._v(": HttpConnection å¹¶ä¸ä¼šä¸»åŠ¨å‘ EndPoint è¯»å–æ•°æ®, è€Œæ˜¯å‘åœ¨ EndPoint ä¸­æ³¨å†Œä¸€å †å›è°ƒæ–¹æ³•:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getEndPoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fillInterested")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_readCallback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™æ®µä»£ç å°±æ˜¯å‘Šè¯‰ EndPoint, æ•°æ®åˆ°äº†å°±è°ƒè¿™äº›å›è°ƒæ–¹æ³• _readCallback() å§, æœ‰ç‚¹å¼‚æ­¥ I/O çš„æ„Ÿè§‰, ä¹Ÿå°±æ˜¯è¯´ Jetty åœ¨"),t("strong",[s._v("åº”ç”¨å±‚é¢æ¨¡æ‹Ÿäº†å¼‚æ­¥ I/O æ¨¡å‹")]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œåœ¨å›è°ƒæ–¹æ³• _readCallback() é‡Œ, ä¼šè°ƒç”¨ EndPoint çš„æ¥å£å»è¯»æ•°æ®, è¯»å®Œåè®© HTTP è§£æå™¨å»è§£æå­—èŠ‚æµ, HTTP è§£æå™¨ä¼šå°†è§£æåçš„æ•°æ®, åŒ…æ‹¬è¯·æ±‚è¡Œ, è¯·æ±‚å¤´ç›¸å…³ä¿¡æ¯å­˜åˆ° Request å¯¹è±¡é‡Œ.")]),s._v(" "),t("p",[t("strong",[s._v("å“åº”å¤„ç†")]),s._v(": Connection è°ƒç”¨ Handler è¿›è¡Œä¸šåŠ¡å¤„ç†, Handler ä¼šé€šè¿‡ Response å¯¹è±¡æ¥æ“ä½œå“åº”æµ, å‘æµé‡Œé¢å†™å…¥æ•°æ®, HttpConnection å†é€šè¿‡ EndPoint æŠŠæ•°æ®å†™åˆ° Channel, è¿™æ ·ä¸€æ¬¡å“åº”å°±å®Œæˆäº†.")]),s._v(" "),t("p",[s._v("åˆ°æ­¤åº”è¯¥äº†è§£äº† Connector çš„å·¥ä½œåŸç†, ä¸‹é¢ç”»å¼ å›¾å†æ¥å›é¡¾ä¸€ä¸‹ Connector çš„å·¥ä½œæµç¨‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161119-eg06rkc.jpg",alt:""}})]),s._v(" "),t("p",[s._v("1.Acceptor ç›‘å¬è¿æ¥è¯·æ±‚, å½“æœ‰è¿æ¥è¯·æ±‚åˆ°è¾¾æ—¶å°±æ¥å—è¿æ¥, ä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ª Channel, Acceptor å°† Channel äº¤ç»™ ManagedSelector æ¥å¤„ç†.")]),s._v(" "),t("p",[s._v("2.ManagedSelector æŠŠ Channel æ³¨å†Œåˆ° Selector ä¸Š, å¹¶åˆ›å»ºä¸€ä¸ª EndPoint å’Œ Connection è·Ÿè¿™ä¸ª Channel ç»‘å®š, æ¥ç€å°±ä¸æ–­åœ°æ£€æµ‹ I/O äº‹ä»¶.")]),s._v(" "),t("p",[s._v("3.I/O äº‹ä»¶åˆ°äº†å°±è°ƒç”¨ EndPoint çš„æ–¹æ³•æ‹¿åˆ°ä¸€ä¸ª Runnable, å¹¶æ‰”ç»™çº¿ç¨‹æ± æ‰§è¡Œ.")]),s._v(" "),t("p",[s._v("4.çº¿ç¨‹æ± ä¸­è°ƒåº¦æŸä¸ªçº¿ç¨‹æ‰§è¡Œ Runnable.")]),s._v(" "),t("p",[s._v("5.Runnable æ‰§è¡Œæ—¶, è°ƒç”¨å›è°ƒå‡½æ•°, è¿™ä¸ªå›è°ƒå‡½æ•°æ˜¯ Connection æ³¨å†Œåˆ° EndPoint ä¸­çš„.")]),s._v(" "),t("p",[s._v("6.å›è°ƒå‡½æ•°å†…éƒ¨å®ç°, å…¶å®å°±æ˜¯è°ƒç”¨ EndPoint çš„æ¥å£æ–¹æ³•æ¥è¯»æ•°æ®.")]),s._v(" "),t("p",[s._v("7.Connection è§£æè¯»åˆ°çš„æ•°æ®, ç”Ÿæˆè¯·æ±‚å¯¹è±¡å¹¶äº¤ç»™ Handler ç»„ä»¶å»å¤„ç†.")]),s._v(" "),t("h6",{attrs:{id:"_4-æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ€»ç»“"}},[s._v("#")]),s._v(" 4.æ€»ç»“")]),s._v(" "),t("p",[s._v("Jetty Server å°±æ˜¯ç”±å¤šä¸ª Connector, å¤šä¸ª Handler, ä»¥åŠä¸€ä¸ªçº¿ç¨‹æ± ç»„æˆ, åœ¨è®¾è®¡ä¸Šç®€æ´æ˜äº†.")]),s._v(" "),t("p",[s._v("Jetty çš„ Connector åªæ”¯æŒ NIO æ¨¡å‹, è·Ÿ Tomcat çš„ NioEndpoint ç»„ä»¶ä¸€æ ·, å®ƒä¹Ÿæ˜¯é€šè¿‡ Java çš„ NIO API å®ç°çš„. æˆ‘ä»¬çŸ¥é“, Java NIO ç¼–ç¨‹æœ‰ä¸‰ä¸ªå…³é”®ç»„ä»¶: Channel, Buffer å’Œ Selector, è€Œæ ¸å¿ƒæ˜¯ Selector. ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨, Jetty åœ¨åŸç”Ÿ Selector ç»„ä»¶çš„åŸºç¡€ä¸Šåšäº†ä¸€äº›å°è£…, å®ç°äº† ManagedSelector ç»„ä»¶.")]),s._v(" "),t("p",[s._v("åœ¨çº¿ç¨‹æ¨¡å‹è®¾è®¡ä¸Š Tomcat çš„ NioEndpoint è·Ÿ Jetty çš„ Connector æ˜¯ç›¸ä¼¼çš„, éƒ½æ˜¯ç”¨ä¸€ä¸ª Acceptor æ•°ç»„ç›‘å¬è¿æ¥, ç”¨ä¸€ä¸ª Selector æ•°ç»„ä¾¦æµ‹ I/O äº‹ä»¶, ç”¨ä¸€ä¸ªçº¿ç¨‹æ± æ‰§è¡Œè¯·æ±‚. å®ƒä»¬çš„ä¸åŒç‚¹åœ¨äº, Jetty ä½¿ç”¨äº†ä¸€ä¸ªå…¨å±€çš„çº¿ç¨‹æ± , æ‰€æœ‰çš„çº¿ç¨‹èµ„æºéƒ½æ˜¯ä»çº¿ç¨‹æ± æ¥åˆ†é….")]),s._v(" "),t("p",[s._v("Jetty Connector è®¾è®¡ä¸­çš„ä¸€å¤§ç‰¹ç‚¹æ˜¯, ä½¿ç”¨äº†å›è°ƒå‡½æ•°æ¥æ¨¡æ‹Ÿå¼‚æ­¥ I/O, æ¯”å¦‚ Connection å‘ EndPoint æ³¨å†Œäº†ä¸€å †å›è°ƒå‡½æ•°. å®ƒçš„æœ¬è´¨"),t("strong",[s._v("å°†å‡½æ•°å½“ä½œä¸€ä¸ªå‚æ•°æ¥ä¼ é€’")]),s._v(", å‘Šè¯‰å¯¹æ–¹, ä½ å‡†å¤‡å¥½äº†å°±è°ƒè¿™ä¸ªå›è°ƒå‡½æ•°.")]),s._v(" "),t("h5",{attrs:{id:"handlerç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#handlerç»„ä»¶"}},[s._v("#")]),s._v(" Handlerç»„ä»¶")]),s._v(" "),t("p",[s._v("å‰é¢äº† Jetty çš„æ•´ä½“æ¶æ„. å…ˆæ¥å›é¡¾ä¸€ä¸‹, Jetty å°±æ˜¯ç”±å¤šä¸ª Connector(è¿æ¥å™¨), å¤šä¸ª Handler(å¤„ç†å™¨), ä»¥åŠä¸€ä¸ªçº¿ç¨‹æ± ç»„æˆ, æ•´ä½“ç»“æ„å›¾å¦‚ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161141-6ge7pa7.png",alt:""}})]),s._v(" "),t("p",[s._v("å‰é¢åˆ†æäº† Jetty Connector ç»„ä»¶çš„è®¾è®¡, "),t("strong",[s._v("Connector ä¼šå°† Servlet è¯·æ±‚äº¤ç»™ Handler å»å¤„ç†")]),s._v(", é‚£ Handler åˆæ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„å‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("Jetty çš„ Handler åœ¨è®¾è®¡ä¸Šéå¸¸æœ‰æ„æ€, å¯ä»¥è¯´æ˜¯ Jetty çš„çµé­‚, Jetty é€šè¿‡ Handler å®ç°äº†é«˜åº¦å¯å®šåˆ¶åŒ–")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_1-handleræ˜¯ä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-handleræ˜¯ä»€ä¹ˆ"}},[s._v("#")]),s._v(" 1.Handleræ˜¯ä»€ä¹ˆ")]),s._v(" "),t("p",[t("strong",[s._v("Handler å°±æ˜¯ä¸€ä¸ªæ¥å£, å®ƒæœ‰ä¸€å †å®ç°ç±»")]),s._v(", Jetty çš„ Connector ç»„ä»¶è°ƒç”¨è¿™äº›æ¥å£æ¥å¤„ç† Servlet è¯·æ±‚, å…ˆæ¥çœ‹çœ‹è¿™ä¸ªæ¥å£çš„å®šä¹‰.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Handler")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifeCycle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Destroyable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†è¯·æ±‚çš„æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Request")]),s._v(" baseRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯ä¸ª Handler éƒ½å…³è”ä¸€ä¸ª Server ç»„ä»¶, è¢« Server ç®¡ç†")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Server")]),s._v(" server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”€æ¯æ–¹æ³•ç›¸å…³çš„èµ„æº")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("destroy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ° Handler æ¥å£çš„å®šä¹‰éå¸¸ç®€æ´, ä¸»è¦å°±æ˜¯"),t("strong",[s._v("ç”¨ handle() æ–¹æ³•ç”¨æ¥å¤„ç†è¯·æ±‚")]),s._v(", è·Ÿ Tomcat å®¹å™¨ç»„ä»¶çš„ service() æ–¹æ³•ä¸€æ ·, å®ƒæœ‰ ServletRequest å’Œ ServeletResponse ä¸¤ä¸ªå‚æ•°. é™¤æ­¤ä¹‹å¤–, è¿™ä¸ªæ¥å£ä¸­è¿˜æœ‰ setServer() å’Œ getServer() æ–¹æ³•, å› ä¸ºä»»ä½•ä¸€ä¸ª Handler éƒ½éœ€è¦å…³è”ä¸€ä¸ª Server ç»„ä»¶, ä¹Ÿå°±æ˜¯è¯´ Handler éœ€è¦è¢« Server ç»„ä»¶æ¥ç®¡ç†. ä¸€èˆ¬æ¥è¯´ Handler ä¼šåŠ è½½ä¸€äº›èµ„æºåˆ°å†…å­˜, å› æ­¤é€šè¿‡è®¾ç½® destroy() æ–¹æ³•æ¥é”€æ¯.")]),s._v(" "),t("blockquote",[t("p",[s._v("Handlerç»§æ‰¿å…³ç³»")])]),s._v(" "),t("p",[s._v("Handler åªæ˜¯ä¸€ä¸ªæ¥å£, å®Œæˆå…·ä½“åŠŸèƒ½çš„è¿˜æ˜¯å®ƒçš„å­ç±». é‚£ä¹ˆ Handler æœ‰å“ªäº›å­ç±»? å®ƒä»¬çš„ç»§æ‰¿å…³ç³»åˆæ˜¯æ€æ ·çš„? è¿™äº›å­ç±»æ˜¯å¦‚ä½•å®ç° Servlet å®¹å™¨åŠŸèƒ½çš„?")]),s._v(" "),t("p",[s._v("Jetty ä¸­å®šä¹‰äº†ä¸€äº›"),t("strong",[s._v("é»˜è®¤ Handler ç±»")]),s._v(", å¹¶ä¸”è¿™äº› Handler ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚, å…ˆé€šè¿‡ä¸€ä¸ªå…¨æ™¯å›¾æ¥äº†è§£ä¸€ä¸‹(å·²ç»ç®€åŒ–).")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161141-na7x260.png",alt:""}})]),s._v(" "),t("p",[s._v("ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°, Handler çš„ç§ç±»å’Œå±‚æ¬¡å…³ç³»è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„:")]),s._v(" "),t("p",[s._v("Handler æ¥å£ä¹‹ä¸‹æœ‰æŠ½è±¡ç±» "),t("strong",[s._v("AbstractHandler")]),s._v(", è¿™ä¸€ç‚¹å¹¶ä¸æ„å¤–, å› ä¸ºæœ‰æ¥å£ä¸€èˆ¬å°±æœ‰æŠ½è±¡å®ç°ç±».")]),s._v(" "),t("p",[s._v("åœ¨ AbstractHandler ä¹‹ä¸‹æœ‰ "),t("strong",[s._v("AbstractHandlerContainer")]),s._v(", ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªç±»å‘¢? è¿™å…¶å®æ˜¯ä¸ªè¿‡æ¸¡, "),t("strong",[s._v("ä¸ºäº†å®ç°é“¾å¼è°ƒç”¨, ä¸€ä¸ª Handler å†…éƒ¨å¿…ç„¶è¦æœ‰å…¶ä»– Handler çš„å¼•ç”¨, æ‰€ä»¥è¿™ä¸ªç±»çš„åå­—é‡Œæ‰æœ‰ Container, æ„æ€å°±æ˜¯è¿™æ ·çš„ Handler é‡ŒåŒ…å«äº†å…¶ä»– Handler çš„å¼•ç”¨")]),s._v(".")]),s._v(" "),t("p",[s._v("ç†è§£äº†ä¸Šé¢çš„ AbstractHandlerContainer, å°±èƒ½ç†è§£å®ƒçš„ä¸¤ä¸ªå­ç±»äº†: "),t("strong",[s._v("HandlerWrapper")]),s._v(" å’Œ "),t("strong",[s._v("HandlerCollection")]),s._v(". ç®€å•æ¥è¯´å°±æ˜¯, HandlerWrapper å’Œ HandlerCollection éƒ½æ˜¯ Handler, ä½†æ˜¯è¿™äº› Handler é‡Œè¿˜åŒ…æ‹¬å…¶ä»– Handler çš„å¼•ç”¨. ä¸åŒçš„æ˜¯, HandlerWrapper åªåŒ…å«ä¸€ä¸ªå…¶ä»– Handler çš„å¼•ç”¨, è€Œ HandlerCollection ä¸­æœ‰ä¸€ä¸ª Handler æ•°ç»„çš„å¼•ç”¨.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161141-j4aue1d.png",alt:""}})]),s._v(" "),t("p",[s._v("æ¥ç€æ¥çœ‹å·¦è¾¹çš„ "),t("strong",[s._v("HandlerWrapper")]),s._v(", å®ƒæœ‰ä¸¤ä¸ªå­ç±»: "),t("strong",[s._v("Server å’Œ ScopedHandler")]),s._v(".")]),s._v(" "),t("p",[s._v("Server æ¯”è¾ƒå¥½ç†è§£, å®ƒæœ¬èº«æ˜¯ Handler æ¨¡å—çš„å…¥å£, å¿…ç„¶è¦å°†è¯·æ±‚ä¼ é€’ç»™å…¶ä»– Handler æ¥å¤„ç†, ä¸ºäº†è§¦å‘å…¶ä»– Handler çš„è°ƒç”¨, æ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ª HandlerWrapper.")]),s._v(" "),t("p",[s._v('å†çœ‹ ScopedHandler, å®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ Handler, å®ç°äº† "å…·æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯" çš„è´£ä»»é“¾è°ƒç”¨. ä¸ºä»€ä¹ˆè¦å¼ºè°ƒ "å…·æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯" å‘¢? é‚£æ˜¯å› ä¸º Servlet è§„èŒƒè§„å®š Servlet åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯æœ‰ä¸Šä¸‹æ–‡çš„. é‚£ä¹ˆè¿™äº› Handler åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚ä½•è®¿é—®è¿™ä¸ªä¸Šä¸‹æ–‡å‘¢? è¿™ä¸ªä¸Šä¸‹æ–‡åˆå­˜åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢? ç­”æ¡ˆå°±æ˜¯é€šè¿‡ '),t("strong",[s._v("ScopedHandler")]),s._v(" æ¥å®ç°çš„.")]),s._v(" "),t("p",[t("strong",[s._v("è€Œ ScopedHandler æœ‰ä¸€å †çš„å­ç±», è¿™äº›å­ç±»å°±æ˜¯ç”¨æ¥å®ç° Servlet è§„èŒƒçš„")]),s._v(", æ¯”å¦‚ ServletHandler, ContextHandler, SessionHandler, ServletContextHandler å’Œ WebAppContext.")]),s._v(" "),t("p",[s._v("å†çœ‹ç±»å›¾çš„å³è¾¹, è·Ÿ HandlerWapper å¯¹ç­‰çš„è¿˜æœ‰ "),t("strong",[s._v("HandlerCollection")]),s._v(", HandlerCollection å…¶å®ç»´æŠ¤äº†ä¸€ä¸ª Handler æ•°ç»„. ä½ å¯èƒ½ä¼šé—®, ä¸ºä»€ä¹ˆè¦å‘æ˜ä¸€ä¸ªè¿™æ ·çš„ Handler? è¿™æ˜¯å› ä¸º "),t("strong",[s._v("Jetty å¯èƒ½éœ€è¦åŒæ—¶æ”¯æŒå¤šä¸ª Web åº”ç”¨")]),s._v(", å¦‚æœæ¯ä¸ª Web åº”ç”¨æœ‰ä¸€ä¸ª Handler å…¥å£, é‚£ä¹ˆå¤šä¸ª Web åº”ç”¨çš„ Handler å°±æˆäº†ä¸€ä¸ªæ•°ç»„, æ¯”å¦‚ Server ä¸­å°±æœ‰ä¸€ä¸ª HandlerCollection, Server ä¼š"),t("strong",[s._v("æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„ URL ä»æ•°ç»„ä¸­é€‰å–ç›¸åº”çš„ Handler æ¥å¤„ç†, å°±æ˜¯é€‰æ‹©ç‰¹å®šçš„ Web åº”ç”¨æ¥å¤„ç†è¯·æ±‚")]),s._v(".")]),s._v(" "),t("blockquote",[t("p",[s._v("Handlerçš„ç±»å‹")])]),s._v(" "),t("p",[s._v("è™½ç„¶ä»ç±»å›¾ä¸Šçœ‹ Handler æœ‰å¾ˆå¤š, ä½†æ˜¯æœ¬è´¨ä¸Šè¿™äº› Handler åˆ†æˆä¸‰ç§ç±»å‹:")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€ç§æ˜¯"),t("strong",[s._v("åè°ƒ Handler")]),s._v(", è¿™ç§ Handler è´Ÿè´£å°†"),t("strong",[s._v("è¯·æ±‚è·¯ç”±")]),s._v("åˆ°ä¸€ç»„ Handler ä¸­å», æ¯”å¦‚ä¸Šå›¾ä¸­çš„ HandlerCollection, å®ƒå†…éƒ¨æŒæœ‰ä¸€ä¸ª Handler æ•°ç»„, å½“è¯·æ±‚åˆ°æ¥æ—¶, å®ƒè´Ÿè´£å°†è¯·æ±‚è½¬å‘åˆ°æ•°ç»„ä¸­çš„æŸä¸€ä¸ª Handler.")]),s._v(" "),t("li",[s._v("ç¬¬äºŒç§æ˜¯"),t("strong",[s._v("è¿‡æ»¤å™¨ Handler")]),s._v(", è¿™ç§ Handler è‡ªå·±ä¼š"),t("strong",[s._v("å¤„ç†è¯·æ±‚")]),s._v(", å¤„ç†å®Œäº†åå†æŠŠè¯·æ±‚è½¬å‘åˆ°ä¸‹ä¸€ä¸ª Handler, æ¯”å¦‚å›¾ä¸Šçš„ HandlerWrapper, å®ƒå†…éƒ¨æŒæœ‰ä¸‹ä¸€ä¸ª Handler çš„å¼•ç”¨. éœ€è¦æ³¨æ„çš„æ˜¯, æ‰€æœ‰ç»§æ‰¿äº† HandlerWrapper çš„ Handler éƒ½å…·æœ‰äº†è¿‡æ»¤å™¨ Handler çš„ç‰¹å¾, æ¯”å¦‚ ContextHandler, SessionHandler å’Œ WebAppContext ç­‰.")]),s._v(" "),t("li",[s._v("ç¬¬ä¸‰ç§æ˜¯"),t("strong",[s._v("å†…å®¹ Handler")]),s._v(", è¯´ç™½äº†å°±æ˜¯è¿™äº› Handler ä¼š"),t("strong",[s._v("çœŸæ­£è°ƒç”¨ Servlet æ¥å¤„ç†è¯·æ±‚")]),s._v(", ç”Ÿæˆå“åº”çš„å†…å®¹, æ¯”å¦‚ ServletHandler. å¦‚æœæµè§ˆå™¨è¯·æ±‚çš„æ˜¯ä¸€ä¸ªé™æ€èµ„æº, ä¹Ÿæœ‰ç›¸åº”çš„ ResourceHandler æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚, è¿”å›é™æ€é¡µé¢.")])]),s._v(" "),t("h6",{attrs:{id:"_2-å¦‚ä½•å®ç°servletè§„èŒƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¦‚ä½•å®ç°servletè§„èŒƒ"}},[s._v("#")]),s._v(" 2.å¦‚ä½•å®ç°Servletè§„èŒƒ")]),s._v(" "),t("p",[s._v("ä¸Šæ–‡æåˆ° ServletHandler, ContextHandler ä»¥åŠ WebAppContext ç­‰å®ç°äº† Servlet è§„èŒƒ, é‚£å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å‘¢? ä¸ºå¸®åŠ©ç†è§£, åœ¨è¿™ä¹‹å‰å…ˆçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Jetty æ¥å¯åŠ¨ä¸€ä¸ª Web åº”ç”¨.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°å»ºä¸€ä¸ª WebAppContext, WebAppContext æ˜¯ä¸€ä¸ª Handler")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebAppContext")]),s._v(" webapp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebAppContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nwebapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContextPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mywebapp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nwebapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setWar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mywebapp.war"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°† Handler æ·»åŠ åˆ° Server ä¸­å»")]),s._v("\nserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("webapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯åŠ¨ Server")]),s._v("\nserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä¸¤æ­¥:")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬ä¸€æ­¥åˆ›å»ºä¸€ä¸ª WebAppContext")]),s._v(", æ¥ç€è®¾ç½®ä¸€äº›å‚æ•°åˆ°è¿™ä¸ª Handler ä¸­, å°±æ˜¯å‘Šè¯‰ WebAppContext ä½ çš„ WAR åŒ…æ”¾åœ¨å“ª, Web åº”ç”¨çš„è®¿é—®è·¯å¾„æ˜¯ä»€ä¹ˆ.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ–°åˆ›å»ºçš„ WebAppContext æ·»åŠ åˆ° Server ä¸­, ç„¶åå¯åŠ¨ Server")]),s._v(".")]),s._v(" "),t("p",[s._v("WebAppContext å¯¹åº”ä¸€ä¸ª Web åº”ç”¨. å›å¿†ä¸€ä¸‹ Servlet è§„èŒƒä¸­æœ‰ Context, Servlet, Filter, Listener å’Œ Session ç­‰, Jetty è¦æ”¯æŒ Servlet è§„èŒƒ, å°±éœ€è¦æœ‰ç›¸åº”çš„ Handler æ¥åˆ†åˆ«å®ç°è¿™äº›åŠŸèƒ½. å› æ­¤, Jetty è®¾è®¡äº† 3 ä¸ªç»„ä»¶: "),t("strong",[s._v("ContextHandler, ServletHandler å’Œ SessionHandler")]),s._v(" æ¥å®ç° Servle è§„èŒƒä¸­è§„å®šçš„åŠŸèƒ½, è€Œ "),t("strong",[s._v("WebAppContext æœ¬èº«å°±æ˜¯ä¸€ä¸ª ContextHandler")]),s._v(", å¦å¤–å®ƒè¿˜è´Ÿè´£ç®¡ç† ServletHandler å’Œ SessionHandler.")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯ "),t("mark",[t("strong",[s._v("ContextHandler")])]),s._v(". ContextHandler ä¼š"),t("strong",[s._v("åˆ›å»ºå¹¶åˆå§‹åŒ– Servlet è§„èŒƒé‡Œçš„ ServletContext å¯¹è±¡")]),s._v(", åŒæ—¶ ContextHandler è¿˜åŒ…å«äº†ä¸€ç»„èƒ½å¤Ÿè®©ä½ çš„ Web åº”ç”¨è¿è¡Œèµ·æ¥çš„ Handler, å¯ä»¥è¿™æ ·ç†è§£, Context æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§ Handler, å®ƒé‡Œé¢åŒ…å«äº†å…¶ä»–çš„ Handler, è¿™äº› Handler èƒ½å¤„ç†æŸä¸ªç‰¹å®š URL ä¸‹çš„è¯·æ±‚. æ¯”å¦‚, ContextHandler åŒ…å«äº†ä¸€ä¸ªæˆ–è€…å¤šä¸ª ServletHandler.")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹ "),t("mark",[t("strong",[s._v("ServletHandler")])]),s._v(", å®ƒ"),t("strong",[s._v("å®ç°äº† Servlet è§„èŒƒä¸­çš„ Servlet, Filter å’Œ Listener çš„åŠŸèƒ½")]),s._v(". ServletHandler ä¾èµ– FilterHolder, ServletHolder, ServletMapping, FilterMapping è¿™å››å¤§ç»„ä»¶. FilterHolder å’Œ ServletHolder åˆ†åˆ«æ˜¯ Filter å’Œ Servlet çš„åŒ…è£…ç±», æ¯ä¸€ä¸ª Servlet ä¸è·¯å¾„çš„æ˜ å°„ä¼šè¢«å°è£…æˆ ServletMapping, è€Œ Filter ä¸æ‹¦æˆª URL çš„æ˜ å°„ä¼šè¢«å°è£…æˆ FilterMapping.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("SessionHandler")])]),s._v(" ä»åå­—å°±çŸ¥é“å®ƒçš„åŠŸèƒ½, "),t("strong",[s._v("ç”¨æ¥ç®¡ç† Session")]),s._v(". é™¤æ­¤ä¹‹å¤– WebAppContext è¿˜æœ‰ä¸€äº›é€šç”¨åŠŸèƒ½çš„ Handler, æ¯”å¦‚ SecurityHandler å’Œ GzipHandler, åŒæ ·ä»åå­—å¯ä»¥çŸ¥é“è¿™äº› Handler çš„åŠŸèƒ½åˆ†åˆ«æ˜¯å®‰å…¨æ§åˆ¶å’Œå‹ç¼© / è§£å‹ç¼©.")]),s._v(" "),t("p",[s._v("WebAppContext ä¼šå°†è¿™äº› Handler æ„å»ºæˆä¸€ä¸ªæ‰§è¡Œé“¾, é€šè¿‡è¿™ä¸ªé“¾ä¼šæœ€ç»ˆè°ƒç”¨åˆ°ä¸šåŠ¡ Servlet. ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£ä¸€ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161141-rb27mbx.jpg",alt:""}})]),s._v(" "),t("p",[s._v("é€šè¿‡å¯¹æ¯” Tomcat çš„æ¶æ„å›¾, å¯ä»¥çœ‹åˆ°, Jetty çš„ Handler ç»„ä»¶å’Œ Tomcat ä¸­çš„å®¹å™¨ç»„ä»¶æ˜¯å¤§è‡´æ˜¯å¯¹ç­‰çš„æ¦‚å¿µ, Jetty ä¸­çš„ WebAppContext ç›¸å½“äº Tomcat çš„ Context ç»„ä»¶, éƒ½æ˜¯å¯¹åº”ä¸€ä¸ª Web åº”ç”¨; è€Œ Jetty ä¸­çš„ ServletHandler å¯¹åº” Tomcat ä¸­çš„ Wrapper ç»„ä»¶, å®ƒè´Ÿè´£åˆå§‹åŒ–å’Œè°ƒç”¨ Servlet, å¹¶å®ç°äº† Filter çš„åŠŸèƒ½.")]),s._v(" "),t("p",[s._v("å¯¹äºä¸€äº›é€šç”¨ç»„ä»¶, æ¯”å¦‚å®‰å…¨å’Œè§£å‹ç¼©, åœ¨ Jetty ä¸­"),t("strong",[s._v("éƒ½è¢«åšæˆäº† Handler")]),s._v(", è¿™æ˜¯ Jetty Handler æ¶æ„çš„ç‰¹ç‚¹.")]),s._v(" "),t("p",[t("strong",[s._v('å› æ­¤å¯¹äº Jetty æ¥è¯´, è¯·æ±‚å¤„ç†æ¨¡å—å°±è¢«æŠ½è±¡æˆ Handler, ä¸ç®¡æ˜¯å®ç°äº† Servlet è§„èŒƒçš„ Handler, è¿˜æ˜¯å®ç°é€šç”¨åŠŸèƒ½çš„ Handler, æ¯”å¦‚å®‰å…¨, è§£å‹ç¼©ç­‰, æˆ‘ä»¬å¯ä»¥ä»»æ„æ·»åŠ æˆ–è€…è£å‰ªè¿™äº› "åŠŸèƒ½æ¨¡å—", ä»è€Œå®ç°é«˜åº¦çš„å¯å®šåˆ¶åŒ–.')])]),s._v(" "),t("h6",{attrs:{id:"_3-æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ€»ç»“"}},[s._v("#")]),s._v(" 3.æ€»ç»“")]),s._v(" "),t("p",[s._v("Jetty Server å°±æ˜¯ç”±å¤šä¸ª Connector, å¤šä¸ª Handler, ä»¥åŠä¸€ä¸ªçº¿ç¨‹æ± ç»„æˆ.")]),s._v(" "),t("p",[s._v('Jetty çš„ Handler è®¾è®¡æ˜¯å®ƒçš„ä¸€å¤§ç‰¹è‰², Jetty æœ¬è´¨å°±æ˜¯ä¸€ä¸ª Handler ç®¡ç†å™¨, Jetty æœ¬èº«å°±æä¾›äº†ä¸€äº›é»˜è®¤ Handler æ¥å®ç° Servlet å®¹å™¨çš„åŠŸèƒ½, ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ Handler æ¥æ·»åŠ åˆ° Jetty ä¸­, è¿™ä½“ç°äº† "'),t("strong",[s._v("å¾®å†…æ ¸ + æ’ä»¶")]),s._v('" çš„è®¾è®¡æ€æƒ³.')]),s._v(" "),t("h4",{attrs:{id:"_11-æ€»ç»“-ä»tomcatå’Œjettyä¸­æç‚¼ç»„ä»¶åŒ–è®¾è®¡è§„èŒƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-æ€»ç»“-ä»tomcatå’Œjettyä¸­æç‚¼ç»„ä»¶åŒ–è®¾è®¡è§„èŒƒ"}},[s._v("#")]),s._v(" 11.æ€»ç»“:ä»Tomcatå’ŒJettyä¸­æç‚¼ç»„ä»¶åŒ–è®¾è®¡è§„èŒƒ")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬ç»å¸¸è°ˆæ•æ·, å¿«é€Ÿè¿­ä»£å’Œé‡æ„, è¿™äº›éƒ½æ˜¯ä¸ºäº†åº”å¯¹éœ€æ±‚çš„å¿«é€Ÿå˜åŒ–, ä¹Ÿå› æ­¤åœ¨å¼€å§‹è®¾è®¡ä¸€ä¸ªç³»ç»Ÿæ—¶å°±è¦è€ƒè™‘å¯æ‰©å±•æ€§. é‚£ç©¶ç«Ÿè¯¥æ€æ ·è®¾è®¡æ‰èƒ½é€‚åº”å˜åŒ–å‘¢? æˆ–è€…è¦è®¾è®¡æˆä»€ä¹ˆæ ·åé¢æ‰èƒ½ä»¥æœ€å°çš„æˆæœ¬è¿›è¡Œé‡æ„å‘¢? ä¸‹é¢æ¥æ€»ç»“ä¸€äº› Tomcat å’Œ Jetty ç»„ä»¶åŒ–çš„è®¾è®¡æ€æƒ³, æˆ–è®¸ä»ä¸­å¯ä»¥å¾—åˆ°ä¸€äº›å¯å‘.")]),s._v(" "),t("h5",{attrs:{id:"ç»„ä»¶åŒ–åŠå¯é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»„ä»¶åŒ–åŠå¯é…ç½®"}},[s._v("#")]),s._v(" ç»„ä»¶åŒ–åŠå¯é…ç½®")]),s._v(" "),t("p",[t("strong",[s._v("Tomcat å’Œ Jetty çš„æ•´ä½“æ¶æ„éƒ½æ˜¯åŸºäºç»„ä»¶çš„")]),s._v(", å¯ä»¥é€šè¿‡ XML æ–‡ä»¶æˆ–è€…ä»£ç çš„æ–¹å¼æ¥é…ç½®è¿™äº›ç»„ä»¶, æ¯”å¦‚å¯ä»¥åœ¨ server.xml é…ç½® Tomcat çš„è¿æ¥å™¨ä»¥åŠå®¹å™¨ç»„ä»¶. ç›¸åº”çš„, ä¹Ÿå¯ä»¥åœ¨ Jetty.xml æ–‡ä»¶é‡Œç»„è£… Jetty çš„ Connector ç»„ä»¶, ä»¥åŠå„ç§ Handler ç»„ä»¶. ä¹Ÿå°±æ˜¯è¯´, "),t("mark",[t("strong",[s._v("Tomcat å’Œ Jetty æä¾›äº†ä¸€å †ç§¯æœ¨, æ€ä¹ˆæ­å»ºè¿™äº›ç§¯æœ¨ç”±ä½ æ¥å†³å®š")])]),s._v(", å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦çµæ´»é€‰æ‹©ç»„ä»¶æ¥æ­å»º Web å®¹å™¨, å¹¶ä¸”ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç»„ä»¶, è¿™æ ·çš„è®¾è®¡ä¸º Web å®¹å™¨æä¾›äº†æ·±åº¦å¯å®šåˆ¶åŒ–.")]),s._v(" "),t("p",[s._v("é‚£ Web å®¹å™¨å¦‚ä½•å®ç°è¿™ç§ç»„ä»¶åŒ–è®¾è®¡å‘¢? ä¸»è¦æœ‰ä¸¤ä¸ªè¦ç‚¹:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ç¬¬ä¸€ä¸ªæ˜¯é¢å‘æ¥å£ç¼–ç¨‹")]),s._v('. éœ€è¦å¯¹ç³»ç»Ÿçš„åŠŸèƒ½æŒ‰ç…§ "é«˜å†…èš, ä½è€¦åˆ" çš„åŸåˆ™è¿›è¡Œæ‹†åˆ†, æ¯ä¸ªç»„ä»¶éƒ½æœ‰ç›¸åº”çš„æ¥å£, ç»„ä»¶ä¹‹é—´é€šè¿‡æ¥å£é€šä¿¡, è¿™æ ·å°±å¯ä»¥æ–¹ä¾¿åœ°æ›¿æ¢ç»„ä»¶äº†. æ¯”å¦‚å¯ä»¥é€‰æ‹©ä¸åŒè¿æ¥å™¨ç±»å‹, åªè¦è¿™äº›è¿æ¥å™¨ç»„ä»¶å®ç°åŒä¸€ä¸ªæ¥å£å°±è¡Œ.')]),s._v(" "),t("li",[t("strong",[s._v("ç¬¬äºŒä¸ªæ˜¯ Web å®¹å™¨æä¾›ä¸€ä¸ªè½½ä½“æŠŠç»„ä»¶ç»„è£…åœ¨ä¸€èµ·å·¥ä½œ")]),s._v('. ç»„ä»¶çš„å·¥ä½œæ— éå°±æ˜¯å¤„ç†è¯·æ±‚, å› æ­¤å®¹å™¨é€šè¿‡è´£ä»»é“¾æ¨¡å¼æŠŠè¯·æ±‚ä¾æ¬¡äº¤ç»™ç»„ä»¶å»å¤„ç†. å¯¹äºç”¨æˆ·æ¥è¯´, åªéœ€è¦å‘Šè¯‰ Web å®¹å™¨ç”±å“ªäº›ç»„ä»¶æ¥å¤„ç†è¯·æ±‚. æŠŠç»„ä»¶ç»„ç»‡èµ·æ¥éœ€è¦ä¸€ä¸ª"ç®¡ç†è€…", è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Tomcat å’Œ Jetty éƒ½æœ‰ä¸€ä¸ª Server çš„æ¦‚å¿µ, '),t("strong",[s._v("Server å°±æ˜¯ç»„ä»¶çš„è½½ä½“, Server é‡ŒåŒ…å«äº†è¿æ¥å™¨ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶; å®¹å™¨è¿˜éœ€è¦æŠŠè¯·æ±‚äº¤ç»™å„ä¸ªå­å®¹å™¨ç»„ä»¶å»å¤„ç†, Tomcat å’Œ Jetty éƒ½æ˜¯è´£ä»»é“¾æ¨¡å¼æ¥å®ç°çš„")]),s._v(".")])]),s._v(" "),t("p",[s._v("ç”¨æˆ·é€šè¿‡é…ç½®æ¥ç»„è£…ç»„ä»¶, è·Ÿ Spring ä¸­ Bean çš„ä¾èµ–æ³¨å…¥ç›¸ä¼¼. Spring çš„ç”¨æˆ·å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æˆ–è€…æ³¨è§£çš„æ–¹å¼æ¥ç»„è£… Bean, Bean ä¸ Bean çš„ä¾èµ–å…³ç³»å®Œå…¨ç”±ç”¨æˆ·è‡ªå·±æ¥å®šä¹‰. è¿™ä¸€ç‚¹ä¸ Web å®¹å™¨"),t("strong",[s._v("ä¸åŒ")]),s._v(', Web å®¹å™¨ä¸­ç»„ä»¶ä¸ç»„ä»¶ä¹‹é—´çš„å…³ç³»æ˜¯å›ºå®šçš„, æ¯”å¦‚ Tomcat ä¸­ Engine ç»„ä»¶ä¸‹æœ‰ Host ç»„ä»¶, Host ç»„ä»¶ä¸‹æœ‰ Context ç»„ä»¶ç­‰, ä½†ä¸èƒ½åœ¨ Host ç»„ä»¶é‡Œ "æ³¨å…¥" ä¸€ä¸ª Wrapper ç»„ä»¶, è¿™æ˜¯ç”±äº Web å®¹å™¨æœ¬èº«çš„åŠŸèƒ½æ¥å†³å®šçš„.')]),s._v(" "),t("h5",{attrs:{id:"ç»„ä»¶çš„åˆ›å»º"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»„ä»¶çš„åˆ›å»º"}},[s._v("#")]),s._v(" ç»„ä»¶çš„åˆ›å»º")]),s._v(" "),t("p",[s._v("ç”±äºç»„ä»¶æ˜¯å¯ä»¥é…ç½®çš„, Web å®¹å™¨åœ¨å¯åŠ¨ä¹‹å‰å¹¶ä¸çŸ¥é“è¦åˆ›å»ºå“ªäº›ç»„ä»¶, ä¹Ÿå°±æ˜¯è¯´, ä¸èƒ½é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼æ¥å®ä¾‹åŒ–è¿™äº›ç»„ä»¶, è€Œæ˜¯éœ€è¦é€šè¿‡"),t("strong",[s._v("åå°„æœºåˆ¶")]),s._v("æ¥åŠ¨æ€åœ°åˆ›å»º. å…·ä½“æ¥è¯´, Web å®¹å™¨ä¸æ˜¯é€šè¿‡ new æ–¹æ³•æ¥å®ä¾‹åŒ–ç»„ä»¶å¯¹è±¡çš„, è€Œæ˜¯"),t("strong",[s._v("é€šè¿‡ Class.forName æ¥åˆ›å»ºç»„ä»¶")]),s._v(". æ— è®ºå“ªç§æ–¹å¼, åœ¨å®ä¾‹åŒ–ä¸€ä¸ªç±»ä¹‹å‰, Web å®¹å™¨éœ€è¦æŠŠç»„ä»¶ç±»åŠ è½½åˆ° JVM, è¿™å°±æ¶‰åŠä¸€ä¸ªç±»åŠ è½½çš„é—®é¢˜, Web å®¹å™¨è®¾è®¡äº†è‡ªå·±ç±»åŠ è½½å™¨, åé¢ä¼šè¯¦ç»†ä»‹ç» Tomcat çš„ç±»åŠ è½½å™¨.")]),s._v(" "),t("p",[s._v("Spring ä¹Ÿæ˜¯é€šè¿‡åå°„æœºåˆ¶æ¥åŠ¨æ€åœ°å®ä¾‹åŒ– Bean, é‚£ä¹ˆå®ƒç”¨åˆ°çš„ç±»åŠ è½½å™¨æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢? Web å®¹å™¨ç»™æ¯ä¸ª Web åº”ç”¨åˆ›å»ºäº†ä¸€ä¸ªç±»åŠ è½½å™¨, Spring ç”¨åˆ°çš„ç±»åŠ è½½å™¨æ˜¯ Web å®¹å™¨ä¼ ç»™å®ƒçš„.")]),s._v(" "),t("h5",{attrs:{id:"ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†"}},[s._v("#")]),s._v(" ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†")]),s._v(" "),t("p",[s._v("ä¸åŒç±»å‹çš„ç»„ä»¶å…·æœ‰çˆ¶å­å±‚æ¬¡å…³ç³», çˆ¶ç»„ä»¶å¤„ç†è¯·æ±‚åå†æŠŠè¯·æ±‚ä¼ é€’ç»™æŸä¸ªå­ç»„ä»¶. ä½ å¯èƒ½ä¼šæ„Ÿåˆ°ç–‘æƒ‘, Jetty çš„ä¸­ Handler ä¸æ˜¯ä¸€æ¡é“¾å—, çœ‹ä¸Šå»åƒæ˜¯å¹³è¡Œå…³ç³»? å…¶å®ä¸ç„¶, Jetty ä¸­çš„ Handler ä¹Ÿæ˜¯åˆ†å±‚æ¬¡çš„, æ¯”å¦‚ WebAppContext ä¸­åŒ…å« ServletHandler å’Œ SessionHandler. å› æ­¤ä¹Ÿå¯ä»¥æŠŠ ContextHandler å’Œå®ƒæ‰€åŒ…å«çš„ Handler çœ‹ä½œæ˜¯çˆ¶å­å…³ç³».")]),s._v(" "),t("p",[s._v("è€Œ Tomcat é€šè¿‡å®¹å™¨çš„æ¦‚å¿µ, æŠŠå°å®¹å™¨æ”¾åˆ°å¤§å®¹å™¨æ¥å®ç°çˆ¶å­å…³ç³», å…¶å®å®ƒä»¬çš„æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„. è¿™å…¶å®æ¶‰åŠå¦‚ä½•ç»Ÿä¸€ç®¡ç†è¿™äº›ç»„ä»¶, å¦‚ä½•åšåˆ°ä¸€é”®å¼å¯åœ.")]),s._v(" "),t("p",[s._v("Tomcat å’Œ Jetty éƒ½é‡‡ç”¨äº†ç±»ä¼¼çš„åŠæ³•æ¥"),t("strong",[s._v("ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ")]),s._v(", ä¸»è¦æœ‰ä¸¤ä¸ªè¦ç‚¹, "),t("mark",[t("strong",[s._v("ä¸€æ˜¯çˆ¶ç»„ä»¶è´Ÿè´£å­ç»„ä»¶çš„åˆ›å»º, å¯åœå’Œé”€æ¯")])]),s._v(". è¿™æ ·åªè¦å¯åŠ¨æœ€ä¸Šå±‚ç»„ä»¶, æ•´ä¸ª Web å®¹å™¨å°±è¢«å¯åŠ¨èµ·æ¥äº†, ä¹Ÿå°±å®ç°äº†ä¸€é”®å¼å¯åœ; "),t("mark",[t("strong",[s._v("äºŒæ˜¯ Tomcat å’Œ Jetty éƒ½å®šä¹‰äº†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€, å¹¶ä¸”æŠŠç»„ä»¶çŠ¶æ€çš„è½¬å˜å®šä¹‰æˆä¸€ä¸ªäº‹ä»¶, ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€å˜åŒ–ä¼šè§¦å‘å­ç»„ä»¶çš„å˜åŒ–")])]),s._v(", æ¯”å¦‚ Host å®¹å™¨çš„å¯åŠ¨äº‹ä»¶é‡Œä¼šè§¦å‘ Web åº”ç”¨çš„æ‰«æå’ŒåŠ è½½, æœ€ç»ˆä¼šåœ¨ Host å®¹å™¨ä¸‹åˆ›å»ºç›¸åº”çš„ Context å®¹å™¨, è€Œ Context ç»„ä»¶çš„å¯åŠ¨äº‹ä»¶åˆä¼šè§¦å‘ Servlet çš„æ‰«æ, è¿›è€Œåˆ›å»º Wrapper ç»„ä»¶. é‚£ä¹ˆå¦‚ä½•å®ç°è¿™ç§è”åŠ¨å‘¢? ç­”æ¡ˆæ˜¯"),t("strong",[s._v("è§‚å¯Ÿè€…æ¨¡å¼")]),s._v('. å…·ä½“æ¥è¯´å°±æ˜¯åˆ›å»ºç›‘å¬å™¨å»ç›‘å¬å®¹å™¨çš„çŠ¶æ€å˜åŒ–, åœ¨ç›‘å¬å™¨çš„æ–¹æ³•é‡Œå»å®ç°ç›¸åº”çš„åŠ¨ä½œ, è¿™äº›ç›‘å¬å™¨å…¶å®æ˜¯ç»„ä»¶ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­çš„ "æ‰©å±•ç‚¹".')]),s._v(" "),t("p",[s._v('Spring ä¹Ÿé‡‡ç”¨äº†ç±»ä¼¼çš„è®¾è®¡, Spring ç»™ Bean ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æä¾›äº†å¾ˆå¤šçš„ "æ‰©å±•ç‚¹". è¿™äº›æ‰©å±•ç‚¹è¢«å®šä¹‰æˆä¸€ä¸ªä¸ªæ¥å£, åªè¦ Bean å®ç°äº†è¿™äº›æ¥å£, Spring å°±ä¼šè´Ÿè´£è°ƒç”¨è¿™äº›æ¥å£, è¿™æ ·åšçš„ç›®çš„å°±æ˜¯, å½“ Bean çš„åˆ›å»º, åˆå§‹åŒ–å’Œé”€æ¯è¿™äº›æ§åˆ¶æƒäº¤ç»™ Spring å, Spring è®©ä½ æœ‰æœºä¼šåœ¨ Bean çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œä½ çš„é€»è¾‘. ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹:')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161159-cayup9b.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"ç»„ä»¶çš„éª¨æ¶æŠ½è±¡ç±»å’Œæ¨¡æ¿æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»„ä»¶çš„éª¨æ¶æŠ½è±¡ç±»å’Œæ¨¡æ¿æ¨¡å¼"}},[s._v("#")]),s._v(" ç»„ä»¶çš„éª¨æ¶æŠ½è±¡ç±»å’Œæ¨¡æ¿æ¨¡å¼")]),s._v(" "),t("p",[s._v("å…·ä½“åˆ°ç»„ä»¶çš„è®¾è®¡çš„ä¸å®ç°, Tomcat å’Œ Jetty éƒ½å¤§é‡é‡‡ç”¨äº†"),t("strong",[s._v("éª¨æ¶æŠ½è±¡ç±»å’Œæ¨¡æ¿æ¨¡å¼")]),s._v(". æ¯”å¦‚è¯´ Tomcat ä¸­ ProtocolHandler æ¥å£, ProtocolHandler æœ‰æŠ½è±¡åŸºç±» AbstractProtocol, å®ƒå®ç°äº†åè®®å¤„ç†å±‚çš„éª¨æ¶å’Œé€šç”¨é€»è¾‘, è€Œå…·ä½“åè®®ä¹Ÿæœ‰æŠ½è±¡åŸºç±», æ¯”å¦‚ HttpProtocol å’Œ AjpProtocol. å¯¹äº Jetty æ¥è¯´, Handler æ¥å£ä¹‹ä¸‹æœ‰ AbstractHandler, Connector æ¥å£ä¹‹ä¸‹æœ‰ AbstractorConnector, è¿™äº›æŠ½è±¡éª¨æ¶ç±»å®ç°äº†ä¸€äº›é€šç”¨é€»è¾‘, å¹¶ä¸”ä¼š"),t("strong",[s._v("å®šä¹‰ä¸€äº›æŠ½è±¡æ–¹æ³•")]),s._v(", è¿™äº›æŠ½è±¡æ–¹æ³•ç”±å­ç±»å®ç°, æŠ½è±¡éª¨æ¶ç±»è°ƒç”¨æŠ½è±¡æ–¹æ³•æ¥å®ç°éª¨æ¶é€»è¾‘.")]),s._v(" "),t("p",[s._v("è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„è®¾è®¡è§„èŒƒ, ä¸ç®¡æ˜¯ Web å®¹å™¨è¿˜æ˜¯ Spring, ç”šè‡³ JDK æœ¬èº«éƒ½åˆ°å¤„ä½¿ç”¨è¿™ç§è®¾è®¡, æ¯”å¦‚ Java é›†åˆä¸­çš„ AbstractSet, AbstractMap ç­‰. å€¼å¾—ä¸€æçš„æ˜¯, ä» Java 8 å¼€å§‹å…è®¸æ¥å£æœ‰ default æ–¹æ³•, è¿™æ ·å¯ä»¥æŠŠæŠ½è±¡éª¨æ¶ç±»çš„é€šç”¨é€»è¾‘æ”¾åˆ°æ¥å£ä¸­å».")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("è¿™é‡Œ"),t("mark",[t("strong",[s._v('æ€»ç»“äº† Tomcat å’Œ Jetty çš„ç»„ä»¶åŒ–è®¾è®¡, å¯ä»¥é€šè¿‡æ­ç§¯æœ¨çš„æ–¹å¼æ¥å®šåˆ¶åŒ–è‡ªå·±çš„ Web å®¹å™¨. Web å®¹å™¨ä¸ºäº†æ”¯æŒè¿™ç§ç»„ä»¶åŒ–è®¾è®¡, éµå¾ªäº†ä¸€äº›è§„èŒƒ, æ¯”å¦‚é¢å‘æ¥å£ç¼–ç¨‹, ç”¨ "ç®¡ç†è€…" å»ç»„è£…è¿™äº›ç»„ä»¶, ç”¨åå°„çš„æ–¹å¼åŠ¨æ€çš„åˆ›å»ºç»„ä»¶, ç»Ÿä¸€ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ, å¹¶ä¸”ç»™ç»„ä»¶ç”Ÿå‘½çŠ¶æ€çš„å˜åŒ–æä¾›äº†æ‰©å±•ç‚¹, ç»„ä»¶çš„å…·ä½“å®ç°ä¸€èˆ¬éµå¾ªéª¨æ¶æŠ½è±¡ç±»å’Œæ¨¡æ¿æ¨¡å¼')])]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_12-å®æˆ˜-ä¼˜åŒ–å¹¶æé«˜tomcatå¯åŠ¨é€Ÿåº¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-å®æˆ˜-ä¼˜åŒ–å¹¶æé«˜tomcatå¯åŠ¨é€Ÿåº¦"}},[s._v("#")]),s._v(" 12.å®æˆ˜:ä¼˜åŒ–å¹¶æé«˜Tomcatå¯åŠ¨é€Ÿåº¦")]),s._v(" "),t("p",[s._v("åœ¨ä½¿ç”¨ Tomcat æ—¶å¯èƒ½ä¼šç¢°åˆ°å¯åŠ¨æ¯”è¾ƒæ…¢çš„é—®é¢˜, æ¯”å¦‚ç³»ç»Ÿå‘å¸ƒæ–°ç‰ˆæœ¬ä¸Šçº¿æ—¶, å¯èƒ½éœ€è¦é‡å¯æœåŠ¡, è¿™ä¸ªæ—¶å€™å¸Œæœ› Tomcat èƒ½å¿«é€Ÿå¯åŠ¨èµ·æ¥æä¾›æœåŠ¡. ä¸‹é¢é’ˆå¯¹ Tomcat 8.5 å’Œ 9.0 ç‰ˆæœ¬, ç»™å‡ºå‡ æ¡éå¸¸æ˜ç¡®çš„å»ºè®®.")]),s._v(" "),t("p",[s._v("å¦‚æœæ˜¯ç”¨åµŒå…¥å¼çš„æ–¹å¼è¿è¡Œ Tomcat, æ¯”å¦‚ Spring Boot, ä¹Ÿå¯ä»¥é€šè¿‡ Spring Boot çš„æ–¹å¼å»ä¿®æ”¹ Tomcat çš„å‚æ•°, è°ƒä¼˜çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„.")]),s._v(" "),t("h5",{attrs:{id:"æ¸…ç†ä½ çš„tomcat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†ä½ çš„tomcat"}},[s._v("#")]),s._v(" æ¸…ç†ä½ çš„Tomcat")]),s._v(" "),t("p",[t("strong",[s._v("1. æ¸…ç†ä¸å¿…è¦çš„ Web åº”ç”¨")])]),s._v(" "),t("p",[s._v("é¦–å…ˆè¦åšçš„æ˜¯åˆ é™¤æ‰ webapps æ–‡ä»¶å¤¹ä¸‹ä¸éœ€è¦çš„å·¥ç¨‹, ä¸€èˆ¬æ˜¯ host-manager, example, doc ç­‰è¿™äº›é»˜è®¤çš„å·¥ç¨‹, å¯èƒ½è¿˜æœ‰ä»¥å‰æ·»åŠ çš„ä½†ç°åœ¨ç”¨ä¸ç€çš„å·¥ç¨‹, æœ€å¥½æŠŠè¿™äº›å…¨éƒ½åˆ é™¤æ‰. å¦‚æœä½ çœ‹è¿‡ Tomcat çš„å¯åŠ¨æ—¥å¿—, å¯ä»¥å‘ç°"),t("strong",[s._v("æ¯æ¬¡å¯åŠ¨ Tomcat, éƒ½ä¼šé‡æ–°å¸ƒç½²è¿™äº›å·¥ç¨‹")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("2. æ¸…ç† XML é…ç½®æ–‡ä»¶")])]),s._v(" "),t("p",[s._v("Tomcat åœ¨å¯åŠ¨çš„æ—¶å€™ä¼š"),t("strong",[s._v("è§£ææ‰€æœ‰çš„ XML é…ç½®æ–‡ä»¶")]),s._v(", ä½† XML è§£æçš„ä»£ä»·å¯ä¸å°, å› æ­¤è¦å°½é‡ä¿æŒé…ç½®æ–‡ä»¶çš„ç®€æ´, éœ€è¦è§£æçš„ä¸œè¥¿è¶Šå°‘, é€Ÿåº¦è‡ªç„¶å°±ä¼šè¶Šå¿«.")]),s._v(" "),t("p",[t("strong",[s._v("3. æ¸…ç† JAR æ–‡ä»¶")])]),s._v(" "),t("p",[s._v("è¿˜å¯ä»¥åˆ é™¤æ‰€æœ‰ä¸éœ€è¦çš„ JAR æ–‡ä»¶. JVM çš„ç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»æ—¶, éœ€è¦æŸ¥æ‰¾æ¯ä¸€ä¸ª JAR æ–‡ä»¶, å»æ‰¾åˆ°æ‰€éœ€è¦çš„ç±». å¦‚æœåˆ é™¤äº†ä¸éœ€è¦çš„ JAR æ–‡ä»¶, æŸ¥æ‰¾çš„é€Ÿåº¦å°±ä¼šå¿«ä¸€äº›. è¿™é‡Œè¯·æ³¨æ„: "),t("strong",[s._v("Web åº”ç”¨ä¸­çš„ lib ç›®å½•ä¸‹ä¸åº”è¯¥å‡ºç° Servlet API æˆ–è€… Tomcat è‡ªèº«çš„ JAR")]),s._v(", è¿™äº› JAR ç”± Tomcat è´Ÿè´£æä¾›. å¦‚æœæ˜¯ä½¿ç”¨ Maven æ¥æ„å»ºåº”ç”¨, å¯¹ Servlet API çš„ä¾èµ–åº”è¯¥æŒ‡å®šä¸º"),t("code",[s._v("<scope>provided</scope>")]),s._v("â€‹.")]),s._v(" "),t("p",[t("strong",[s._v("4. æ¸…ç†å…¶ä»–æ–‡ä»¶")])]),s._v(" "),t("p",[s._v("åŠæ—¶æ¸…ç†æ—¥å¿—, åˆ é™¤ logs æ–‡ä»¶å¤¹ä¸‹ä¸éœ€è¦çš„æ—¥å¿—æ–‡ä»¶. åŒæ ·è¿˜æœ‰ work æ–‡ä»¶å¤¹ä¸‹çš„ catalina æ–‡ä»¶å¤¹, å®ƒå…¶å®æ˜¯ Tomcat æŠŠ JSP è½¬æ¢ä¸º Class æ–‡ä»¶çš„å·¥ä½œç›®å½•. æœ‰æ—¶å€™ä¹Ÿè®¸ä¼šé‡åˆ°ä¿®æ”¹äº†ä»£ç , é‡å¯äº† Tomcat, ä½†æ˜¯ä»æ²¡æ•ˆæœ, è¿™æ—¶å€™ä¾¿å¯ä»¥åˆ é™¤æ‰è¿™ä¸ªæ–‡ä»¶å¤¹, Tomcat ä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™ä¼šé‡æ–°ç”Ÿæˆ.")]),s._v(" "),t("h5",{attrs:{id:"ç¦æ­¢tomcat-tldæ‰«æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¦æ­¢tomcat-tldæ‰«æ"}},[s._v("#")]),s._v(" ç¦æ­¢Tomcat TLDæ‰«æ")]),s._v(" "),t("p",[s._v("Tomcat ä¸ºäº†æ”¯æŒ JSP, åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ä¼šæ‰«æ JAR åŒ…é‡Œé¢çš„ TLD æ–‡ä»¶, åŠ è½½é‡Œé¢å®šä¹‰çš„æ ‡ç­¾åº“.")]),s._v(" "),t("p",[s._v("å»ºè®®é…ç½®ä¸€ä¸‹ Tomcat ä¸è¦å»æ‰«æè¿™äº› JAR åŒ…, è¿™æ ·å¯ä»¥æé«˜ Tomcat çš„å¯åŠ¨é€Ÿåº¦, å¹¶èŠ‚çœ JSP ç¼–è¯‘æ—¶é—´.")]),s._v(" "),t("h5",{attrs:{id:"å…³é—­websocketæ”¯æŒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…³é—­websocketæ”¯æŒ"}},[s._v("#")]),s._v(" å…³é—­WebSocketæ”¯æŒ")]),s._v(" "),t("p",[s._v("Tomcat ä¼šæ‰«æ WebSocket æ³¨è§£çš„ API å®ç°, æ¯”å¦‚ "),t("code",[s._v("@ServerEndpoint")]),s._v("â€‹ æ³¨è§£çš„ç±». æ³¨è§£æ‰«æä¸€èˆ¬æ˜¯æ¯”è¾ƒæ…¢çš„, å¦‚æœä¸éœ€è¦ä½¿ç”¨ WebSockets å°±å¯ä»¥å…³é—­å®ƒ. å…·ä½“æ–¹æ³•æ˜¯, æ‰¾åˆ° Tomcat çš„ "),t("code",[s._v("conf/")]),s._v("â€‹ ç›®å½•ä¸‹çš„ "),t("code",[s._v("context.xml")]),s._v("â€‹ æ–‡ä»¶, ç»™ Context æ ‡ç­¾åŠ ä¸€ä¸ª **containerSciFilter ** çš„å±æ€§.")]),s._v(" "),t("p",[s._v("æ›´è¿›ä¸€æ­¥, å¦‚æœä¸éœ€è¦ WebSockets è¿™ä¸ªåŠŸèƒ½, å¯ä»¥æŠŠ Tomcat lib ç›®å½•ä¸‹çš„ "),t("code",[s._v("websocket-api.jar")]),s._v("â€‹ å’Œ "),t("code",[s._v("tomcat-websocket.jar")]),s._v("â€‹ è¿™ä¸¤ä¸ª JAR æ–‡ä»¶åˆ é™¤æ‰, è¿›ä¸€æ­¥æé«˜æ€§èƒ½.")]),s._v(" "),t("h5",{attrs:{id:"å¹¶è¡Œå¯åŠ¨å¤šä¸ªwebåº”ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹¶è¡Œå¯åŠ¨å¤šä¸ªwebåº”ç”¨"}},[s._v("#")]),s._v(" å¹¶è¡Œå¯åŠ¨å¤šä¸ªWebåº”ç”¨")]),s._v(" "),t("p",[s._v("Tomcat å¯åŠ¨çš„æ—¶å€™, é»˜è®¤æƒ…å†µä¸‹ Web åº”ç”¨éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªå¯åŠ¨çš„, ç­‰æ‰€æœ‰ Web åº”ç”¨å…¨éƒ¨å¯åŠ¨å®Œæˆ, Tomcat æ‰ç®—å¯åŠ¨å®Œæ¯•. å¦‚æœåœ¨ä¸€ä¸ª Tomcat ä¸‹æœ‰å¤šä¸ª Web åº”ç”¨, ä¸ºäº†ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦, å¯ä»¥é…ç½®å¤šä¸ªåº”ç”¨ç¨‹åºå¹¶è¡Œå¯åŠ¨, å¯ä»¥é€šè¿‡ä¿®æ”¹ "),t("code",[s._v("server.xml")]),s._v("â€‹ ä¸­ Host å…ƒç´ çš„ startStopThreads å±æ€§æ¥å®Œæˆ. startStopThreads çš„å€¼è¡¨ç¤ºæƒ³ç”¨å¤šå°‘ä¸ªçº¿ç¨‹æ¥å¯åŠ¨ Web åº”ç”¨, å¦‚æœè®¾æˆ 0 è¡¨ç¤ºè¦å¹¶è¡Œå¯åŠ¨ Web åº”ç”¨.")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, Engine å…ƒç´ é‡Œä¹Ÿé…ç½®äº†è¿™ä¸ªå‚æ•°, è¿™æ„å‘³ç€å¦‚æœ Tomcat é…ç½®äº†å¤šä¸ª Host(è™šæ‹Ÿä¸»æœº), Tomcat ä¼šä»¥å¹¶è¡Œçš„æ–¹å¼å¯åŠ¨å¤šä¸ª Host.")]),s._v(" "),t("h3",{attrs:{id:"è¿æ¥å™¨-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥å™¨-2"}},[s._v("#")]),s._v(" è¿æ¥å™¨")]),s._v(" "),t("h4",{attrs:{id:"_14-nioendpointç»„ä»¶-tomcatå¦‚ä½•å®ç°éé˜»å¡io"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14-nioendpointç»„ä»¶-tomcatå¦‚ä½•å®ç°éé˜»å¡io"}},[s._v("#")]),s._v(" 14.NioEndpointç»„ä»¶:Tomcatå¦‚ä½•å®ç°éé˜»å¡IO?")]),s._v(" "),t("p",[s._v("UNIX ç³»ç»Ÿä¸‹çš„ I/O æ¨¡å‹æœ‰ 5 ç§: åŒæ­¥é˜»å¡ I/O, åŒæ­¥éé˜»å¡ I/O, I/O å¤šè·¯å¤ç”¨, ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/O. è¿™äº›åè¯æˆ‘ä»¬å¥½åƒéƒ½ä¼¼æ›¾ç›¸è¯†, ä½†è¿™äº› I/O é€šä¿¡æ¨¡å‹æœ‰ä»€ä¹ˆåŒºåˆ«? åŒæ­¥å’Œé˜»å¡ä¼¼ä¹æ˜¯ä¸€å›äº‹, åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒ? ç­‰ä¸€ä¸‹, åœ¨è¿™ä¹‹å‰é—®ä¸€ä¸ªç»ˆæé—®é¢˜: ä»€ä¹ˆæ˜¯ I/O? ä¸ºä»€ä¹ˆéœ€è¦è¿™äº› I/O æ¨¡å‹?")]),s._v(" "),t("p",[s._v("æ‰€è°“çš„ "),t("strong",[s._v("I/O å°±æ˜¯è®¡ç®—æœºå†…å­˜ä¸å¤–éƒ¨è®¾å¤‡ä¹‹é—´æ‹·è´æ•°æ®çš„è¿‡ç¨‹")]),s._v(". ç”±äº CPU è®¿é—®å†…å­˜çš„é€Ÿåº¦è¿œè¿œé«˜äºå¤–éƒ¨è®¾å¤‡, å› æ­¤ CPU æ˜¯å…ˆæŠŠå¤–éƒ¨è®¾å¤‡çš„æ•°æ®è¯»åˆ°å†…å­˜é‡Œ, ç„¶åå†è¿›è¡Œå¤„ç†. è¯·è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªåœºæ™¯, å½“ä½ çš„ç¨‹åºé€šè¿‡ CPU å‘å¤–éƒ¨è®¾å¤‡å‘å‡ºä¸€ä¸ªè¯»æŒ‡ä»¤æ—¶, æ•°æ®ä»å¤–éƒ¨è®¾å¤‡æ‹·è´åˆ°å†…å­˜å¾€å¾€éœ€è¦ä¸€æ®µæ—¶é—´, è¿™ä¸ªæ—¶å€™ CPU æ²¡äº‹å¹²äº†, ä½ çš„ç¨‹åºæ˜¯ä¸»åŠ¨æŠŠ CPU è®©ç»™åˆ«äºº? è¿˜æ˜¯è®© CPU ä¸åœåœ°æŸ¥: æ•°æ®åˆ°äº†å—, æ•°æ®åˆ°äº†å—...")]),s._v(" "),t("p",[t("strong",[s._v("è¿™å°±æ˜¯ I/O æ¨¡å‹è¦è§£å†³çš„é—®é¢˜")]),s._v(". è¿™é‡Œå…ˆè¯´è¯´å„ç§ I/O æ¨¡å‹çš„åŒºåˆ«, ç„¶åé‡ç‚¹åˆ†æ Tomcat çš„ "),t("strong",[s._v("NioEndpoint ç»„ä»¶æ˜¯å¦‚ä½•å®ç°éé˜»å¡ I/O æ¨¡å‹")]),s._v("çš„.")]),s._v(" "),t("h5",{attrs:{id:"java-i-oæ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-i-oæ¨¡å‹"}},[s._v("#")]),s._v(" Java I/Oæ¨¡å‹")]),s._v(" "),t("p",[s._v("å¯¹äºä¸€ä¸ªç½‘ç»œ I/O é€šä¿¡è¿‡ç¨‹, æ¯”å¦‚ç½‘ç»œæ•°æ®è¯»å–, ä¼šæ¶‰åŠä¸¤ä¸ªå¯¹è±¡, "),t("strong",[s._v("ä¸€ä¸ªæ˜¯è°ƒç”¨è¿™ä¸ª I/O æ“ä½œçš„ç”¨æˆ·çº¿ç¨‹, å¦å¤–ä¸€ä¸ªå°±æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸. ä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´, ç”¨æˆ·çº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®å†…æ ¸ç©ºé—´")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç”¨æˆ·çº¿ç¨‹å‘èµ· I/O æ“ä½œå, ç½‘ç»œæ•°æ®è¯»å–æ“ä½œä¼šç»å†ä¸¤ä¸ªæ­¥éª¤:")]),s._v(" "),t("ul",[t("li",[t("mark",[s._v("**ç”¨æˆ·çº¿ç¨‹ç­‰å¾…å†…æ ¸å°†æ•°æ®ä»ç½‘å¡æ‹·è´åˆ°å†…æ ¸ç©ºé—´. **")])]),s._v(" "),t("li",[t("mark",[s._v("**å†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´. **")])])]),s._v(" "),t("p",[s._v("å„ç§ I/O æ¨¡å‹çš„åŒºåˆ«å°±æ˜¯: å®ƒä»¬å®ç°è¿™ä¸¤ä¸ªæ­¥éª¤çš„æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„.")]),s._v(" "),t("p",[t("strong",[s._v("åŒæ­¥é˜»å¡ I/O")]),s._v(": ç”¨æˆ·çº¿ç¨‹å‘èµ· read è°ƒç”¨åå°±é˜»å¡äº†, è®©å‡º CPU. å†…æ ¸ç­‰å¾…ç½‘å¡æ•°æ®åˆ°æ¥, æŠŠæ•°æ®ä»ç½‘å¡æ‹·è´åˆ°å†…æ ¸ç©ºé—´, æ¥ç€æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´, å†æŠŠç”¨æˆ·çº¿ç¨‹å«é†’.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161302-sz6gt2s.jpg",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("åŒæ­¥éé˜»å¡ I/O")]),s._v(": ç”¨æˆ·çº¿ç¨‹ä¸æ–­çš„å‘èµ· read è°ƒç”¨, æ•°æ®æ²¡åˆ°å†…æ ¸ç©ºé—´æ—¶, æ¯æ¬¡éƒ½è¿”å›å¤±è´¥, ç›´åˆ°æ•°æ®åˆ°äº†å†…æ ¸ç©ºé—´, è¿™ä¸€æ¬¡ read è°ƒç”¨å, åœ¨ç­‰å¾…æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´è¿™æ®µæ—¶é—´é‡Œ, çº¿ç¨‹è¿˜æ˜¯é˜»å¡çš„, ç­‰æ•°æ®åˆ°äº†ç”¨æˆ·ç©ºé—´å†æŠŠçº¿ç¨‹å«é†’.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161302-o6f8wgz.jpg",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("I/O å¤šè·¯å¤ç”¨")]),s._v(": "),t("strong",[s._v("ç”¨æˆ·çº¿ç¨‹çš„è¯»å–æ“ä½œåˆ†æˆä¸¤æ­¥")]),s._v("äº†, çº¿ç¨‹å…ˆå‘èµ· select è°ƒç”¨, ç›®çš„æ˜¯é—®å†…æ ¸æ•°æ®å‡†å¤‡å¥½äº†å—? ç­‰å†…æ ¸æŠŠæ•°æ®å‡†å¤‡å¥½äº†, ç”¨æˆ·çº¿ç¨‹å†å‘èµ· read è°ƒç”¨. åœ¨ç­‰å¾…æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´è¿™æ®µæ—¶é—´é‡Œ, çº¿ç¨‹è¿˜æ˜¯é˜»å¡çš„. é‚£ä¸ºä»€ä¹ˆå« I/O å¤šè·¯å¤ç”¨å‘¢? "),t("strong",[s._v("å› ä¸ºä¸€æ¬¡ select è°ƒç”¨å¯ä»¥å‘å†…æ ¸æŸ¥å¤šä¸ªæ•°æ®é€šé“(Channel)çš„çŠ¶æ€, æ‰€ä»¥å«å¤šè·¯å¤ç”¨")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161302-nyy072b.jpg",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("å¼‚æ­¥ I/O")]),s._v(": ç”¨æˆ·çº¿ç¨‹å‘èµ· read è°ƒç”¨çš„åŒæ—¶"),t("strong",[s._v("æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°")]),s._v(", read ç«‹å³è¿”å›, ç­‰å†…æ ¸å°†æ•°æ®å‡†å¤‡å¥½å, å†è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°å®Œæˆå¤„ç†. åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, ç”¨æˆ·çº¿ç¨‹ä¸€ç›´æ²¡æœ‰é˜»å¡.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161302-6jzsof7.jpg",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"nioendpointç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nioendpointç»„ä»¶"}},[s._v("#")]),s._v(" NioEndpointç»„ä»¶")]),s._v(" "),t("p",[t("strong",[s._v("Tomcat çš„ NioEndPoint ç»„ä»¶å®ç°äº† I/O å¤šè·¯å¤ç”¨æ¨¡å‹")]),s._v(", æ¥ä¸‹æ¥ä»‹ç» NioEndpoint çš„å®ç°åŸç†, åé¢ä¼šä»‹ç» Tomcat å¦‚ä½•å®ç°å¼‚æ­¥ I/O æ¨¡å‹.")]),s._v(" "),t("p",[t("strong",[s._v("æ€»ä½“å·¥ä½œæµç¨‹")])]),s._v(" "),t("p",[s._v("å¯¹äº Java çš„å¤šè·¯å¤ç”¨å™¨çš„ä½¿ç”¨, æ— éæ˜¯ä¸¤æ­¥:")]),s._v(" "),t("ol",[t("li",[s._v("**åˆ›å»ºä¸€ä¸ª Seletor, åœ¨å®ƒèº«ä¸Šæ³¨å†Œå„ç§æ„Ÿå…´è¶£çš„äº‹ä»¶, ç„¶åè°ƒç”¨ select æ–¹æ³•, ç­‰å¾…æ„Ÿå…´è¶£çš„äº‹æƒ…å‘ç”Ÿ. **")]),s._v(" "),t("li",[s._v("**æ„Ÿå…´è¶£çš„äº‹æƒ…å‘ç”Ÿäº†, æ¯”å¦‚å¯ä»¥è¯»äº†, è¿™æ—¶ä¾¿åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ä» Channel ä¸­è¯»æ•°æ®. **")])]),s._v(" "),t("p",[s._v("Tomcat çš„ NioEndpoint ç»„ä»¶è™½ç„¶å®ç°æ¯”è¾ƒå¤æ‚, ä½†åŸºæœ¬åŸç†å°±æ˜¯ä¸Šé¢ä¸¤æ­¥. å…ˆæ¥çœ‹çœ‹å®ƒæœ‰å“ªäº›ç»„ä»¶, å®ƒ"),t("strong",[s._v("ä¸€å…±åŒ…å« LimitLatch, Acceptor, Poller, SocketProcessor å’Œ Executor å…± 5 ä¸ªç»„ä»¶")]),s._v(", å®ƒä»¬çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161302-b8n88nw.jpg",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("LimitLatch æ˜¯è¿æ¥æ§åˆ¶å™¨")]),s._v(", å®ƒè´Ÿè´£æ§åˆ¶æœ€å¤§è¿æ¥æ•°, NIO æ¨¡å¼ä¸‹é»˜è®¤æ˜¯ 10000, è¾¾åˆ°è¿™ä¸ªé˜ˆå€¼å, è¿æ¥è¯·æ±‚è¢«æ‹’ç».")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("Acceptor")]),s._v(" è·‘åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹é‡Œ, å®ƒåœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œè°ƒç”¨ accept æ–¹æ³•æ¥æ¥æ”¶æ–°è¿æ¥, ä¸€æ—¦æœ‰æ–°çš„è¿æ¥è¯·æ±‚åˆ°æ¥, accept æ–¹æ³•è¿”å›ä¸€ä¸ª "),t("strong",[s._v("Channel")]),s._v(" å¯¹è±¡, æ¥ç€æŠŠ Channel å¯¹è±¡äº¤ç»™ Poller å»å¤„ç†.")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("Poller çš„æœ¬è´¨æ˜¯ä¸€ä¸ª Selector")]),s._v(", ä¹Ÿè·‘åœ¨å•ç‹¬çº¿ç¨‹é‡Œ. Poller åœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª Channel æ•°ç»„, å®ƒåœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œä¸æ–­æ£€æµ‹ Channel çš„æ•°æ®å°±ç»ªçŠ¶æ€, ä¸€æ—¦æœ‰ Channel å¯è¯», å°±ç”Ÿæˆä¸€ä¸ª SocketProcessor ä»»åŠ¡å¯¹è±¡æ‰”ç»™ Executor å»å¤„ç†.")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("Executor å°±æ˜¯çº¿ç¨‹æ± ")]),s._v(", è´Ÿè´£è¿è¡Œ SocketProcessor ä»»åŠ¡ç±», SocketProcessor çš„ run æ–¹æ³•ä¼šè°ƒç”¨ Http11Processor æ¥è¯»å–å’Œè§£æè¯·æ±‚æ•°æ®. æˆ‘ä»¬çŸ¥é“, Http11Processor æ˜¯åº”ç”¨å±‚åè®®çš„å°è£…, å®ƒä¼šè°ƒç”¨å®¹å™¨è·å¾—å“åº”, å†æŠŠå“åº”é€šè¿‡ Channel å†™å‡º.")])])]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹å„ç»„ä»¶çš„è®¾è®¡ç‰¹ç‚¹.")]),s._v(" "),t("h6",{attrs:{id:"_1-limitlatch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-limitlatch"}},[s._v("#")]),s._v(" 1.LimitLatch")]),s._v(" "),t("p",[s._v("LimitLatch ç”¨æ¥æ§åˆ¶è¿æ¥ä¸ªæ•°, å½“è¿æ¥æ•°åˆ°è¾¾æœ€å¤§æ—¶é˜»å¡çº¿ç¨‹, ç›´åˆ°åç»­ç»„ä»¶å¤„ç†å®Œä¸€ä¸ªè¿æ¥åå°†è¿æ¥æ•°å‡ 1. è¯·ä½ æ³¨æ„åˆ°è¾¾æœ€å¤§è¿æ¥æ•°åæ“ä½œç³»ç»Ÿåº•å±‚è¿˜æ˜¯ä¼šæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥, ä½†ç”¨æˆ·å±‚å·²ç»ä¸å†æ¥æ”¶. LimitLatch çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LimitLatch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractQueuedSynchronizer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   \n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquireShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" newCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" limit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryReleaseShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sync")]),s._v(" sync"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" limit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥è·å¾—æ¥æ”¶æ–°è¿æ¥çš„è®¸å¯, çº¿ç¨‹å¯èƒ½è¢«é˜»å¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("countUpOrAwait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      sync"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquireSharedInterruptibly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥è®¸å¯, é‚£ä¹ˆå‰é¢é˜»å¡çš„çº¿ç¨‹å¯èƒ½è¢«å”¤é†’")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("countDown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      sync"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("releaseShared")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°, LimitLatch å†…æ­¥å®šä¹‰äº†å†…éƒ¨ç±» Sync, è€Œ Sync æ‰©å±•äº† AQS, AQS æ˜¯ Java å¹¶å‘åŒ…ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç±», å®ƒåœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€å’Œä¸€ä¸ªçº¿ç¨‹é˜Ÿåˆ—, å¯ä»¥ç”¨æ¥"),t("strong",[s._v("æ§åˆ¶çº¿ç¨‹ä»€ä¹ˆæ—¶å€™æŒ‚èµ·, ä»€ä¹ˆæ—¶å€™å”¤é†’")]),s._v(". å¯ä»¥æ‰©å±•å®ƒæ¥å®ç°è‡ªå·±çš„åŒæ­¥å™¨, å®é™…ä¸Š Java å¹¶å‘åŒ…é‡Œçš„é”å’Œæ¡ä»¶å˜é‡ç­‰ç­‰éƒ½æ˜¯é€šè¿‡ AQS æ¥å®ç°çš„, è¿™é‡Œçš„ LimitLatch ä¹Ÿä¸ä¾‹å¤–.")]),s._v(" "),t("p",[s._v("ç†è§£ä¸Šé¢çš„ä»£ç æ—¶æœ‰ä¸¤ä¸ªè¦ç‚¹:")]),s._v(" "),t("ol",[t("li",[s._v("ç”¨æˆ·çº¿ç¨‹é€šè¿‡è°ƒç”¨ LimitLatch çš„ countUpOrAwait() æ–¹æ³•æ¥æ‹¿åˆ°é”, å¦‚æœæš‚æ—¶æ— æ³•è·å–, è¿™ä¸ªçº¿ç¨‹ä¼šè¢«é˜»å¡åˆ° AQS çš„é˜Ÿåˆ—ä¸­. é‚£ AQS æ€ä¹ˆçŸ¥é“æ˜¯é˜»å¡è¿˜æ˜¯ä¸é˜»å¡ç”¨æˆ·çº¿ç¨‹å‘¢? å…¶å®è¿™æ˜¯ç”± AQS çš„ä½¿ç”¨è€…æ¥å†³å®šçš„, ä¹Ÿå°±æ˜¯å†…éƒ¨ç±» Sync æ¥å†³å®šçš„, å› ä¸º Sync ç±»é‡å†™äº† AQS çš„ "),t("strong",[s._v("tryAcquireShared() æ–¹æ³•")]),s._v(". å®ƒçš„å®ç°é€»è¾‘æ˜¯å¦‚æœå½“å‰è¿æ¥æ•° count å°äº limit, çº¿ç¨‹èƒ½è·å–é”, è¿”å› 1, å¦åˆ™è¿”å› -1.")]),s._v(" "),t("li",[s._v("å¦‚ä½•ç”¨æˆ·çº¿ç¨‹è¢«é˜»å¡åˆ°äº† AQS çš„é˜Ÿåˆ—, é‚£ä»€ä¹ˆæ—¶å€™å”¤é†’å‘¢? åŒæ ·æ˜¯ç”± Sync å†…éƒ¨ç±»å†³å®š, Sync é‡å†™äº† AQS çš„"),t("strong",[s._v("releaseShared() æ–¹æ³•")]),s._v(", å…¶å®å°±æ˜¯å½“ä¸€ä¸ªè¿æ¥è¯·æ±‚å¤„ç†å®Œäº†, è¿™æ—¶åˆå¯ä»¥æ¥æ”¶ä¸€ä¸ªæ–°è¿æ¥äº†, è¿™æ ·å‰é¢é˜»å¡çš„çº¿ç¨‹å°†ä¼šè¢«å”¤é†’.")])]),s._v(" "),t("p",[s._v("AQS å°±æ˜¯ä¸€ä¸ªéª¨æ¶æŠ½è±¡ç±», å®ƒå¸®æˆ‘ä»¬æ­äº†ä¸ªæ¶å­, ç”¨æ¥æ§åˆ¶çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’. å…·ä½“ä»€ä¹ˆæ—¶å€™é˜»å¡, ä»€ä¹ˆæ—¶å€™å”¤é†’ç”±ä½ æ¥å†³å®š. è¿˜å¯ä»¥çœ‹åˆ°, å½“å‰çº¿ç¨‹æ•°è¢«å®šä¹‰æˆåŸå­å˜é‡ AtomicLong, è€Œ limit å˜é‡ç”¨ volatile å…³é”®å­—æ¥ä¿®é¥°, è¿™äº›éƒ½æ˜¯å¹¶å‘ç¼–ç¨‹çš„å®é™…è¿ç”¨.")]),s._v(" "),t("h6",{attrs:{id:"_2-acceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-acceptor"}},[s._v("#")]),s._v(" 2.Acceptor")]),s._v(" "),t("p",[s._v("Acceptor å®ç°äº† Runnable æ¥å£, å› æ­¤å¯ä»¥è·‘åœ¨"),t("strong",[s._v("å•ç‹¬çº¿ç¨‹")]),s._v("é‡Œ. "),t("strong",[s._v("ä¸€ä¸ªç«¯å£å·åªèƒ½å¯¹åº”ä¸€ä¸ª ServerSocketChannel")]),s._v(", å› æ­¤è¿™ä¸ª "),t("strong",[s._v("ServerSocketChannel æ˜¯åœ¨å¤šä¸ª Acceptor çº¿ç¨‹ä¹‹é—´å…±äº«")]),s._v("çš„, å®ƒæ˜¯ Endpoint çš„å±æ€§, ç”± Endpoint å®Œæˆåˆå§‹åŒ–å’Œç«¯å£ç»‘å®š. åˆå§‹åŒ–è¿‡ç¨‹å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("serverSock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nserverSock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("socket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAcceptCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nserverSock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configureBlocking")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„åˆå§‹åŒ–ä»£ç å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå…³é”®ä¿¡æ¯:")]),s._v(" "),t("p",[s._v("1.bind() æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ“ä½œç³»ç»Ÿçš„ç­‰å¾…é˜Ÿåˆ—é•¿åº¦. ä¸Šé¢æåˆ°è¿‡, å½“åº”ç”¨å±‚é¢çš„è¿æ¥æ•°åˆ°è¾¾æœ€å¤§å€¼æ—¶, æ“ä½œç³»ç»Ÿå¯ä»¥ç»§ç»­æ¥æ”¶è¿æ¥, é‚£ä¹ˆæ“ä½œç³»ç»Ÿèƒ½ç»§ç»­æ¥æ”¶çš„æœ€å¤§è¿æ¥æ•°å°±æ˜¯è¿™ä¸ªé˜Ÿåˆ—é•¿åº¦, å¯ä»¥é€šè¿‡ acceptCount å‚æ•°é…ç½®, é»˜è®¤æ˜¯ 100.")]),s._v(" "),t("p",[s._v("2.ServerSocketChannel è¢«è®¾ç½®æˆ"),t("strong",[s._v("é˜»å¡æ¨¡å¼")]),s._v(", ä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä»¥é˜»å¡çš„æ–¹å¼æ¥æ”¶è¿æ¥çš„.")]),s._v(" "),t("p",[t("strong",[s._v("ServerSocketChannel é€šè¿‡ accept() æ¥å—æ–°çš„è¿æ¥, accept() æ–¹æ³•è¿”å›è·å¾— SocketChannel å¯¹è±¡, ç„¶åå°† SocketChannel å¯¹è±¡å°è£…åœ¨ä¸€ä¸ª PollerEvent å¯¹è±¡ä¸­, å¹¶å°† PollerEvent å¯¹è±¡å‹å…¥ Poller çš„ Queue é‡Œ, è¿™æ˜¯ä¸ªå…¸å‹çš„ç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å¼, Acceptor ä¸ Poller çº¿ç¨‹ä¹‹é—´é€šè¿‡ Queue é€šä¿¡")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_3-poller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-poller"}},[s._v("#")]),s._v(" 3.Poller")]),s._v(" "),t("p",[s._v("Poller æœ¬è´¨æ˜¯ä¸€ä¸ª Selector, å®ƒå†…éƒ¨ç»´æŠ¤ä¸€ä¸ª Queue, è¿™ä¸ª Queue å®šä¹‰å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SynchronizedQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PollerEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" events "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SynchronizedQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("SynchronizedQueue çš„æ–¹æ³•æ¯”å¦‚ offer, poll, size å’Œ clear æ–¹æ³•, éƒ½ä½¿ç”¨äº† Synchronized å…³é”®å­—è¿›è¡Œä¿®é¥°, ç”¨æ¥ä¿è¯"),t("strong",[s._v("åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª Acceptor çº¿ç¨‹å¯¹ Queue è¿›è¡Œè¯»å†™")]),s._v(". åŒæ—¶æœ‰å¤šä¸ª Poller çº¿ç¨‹åœ¨è¿è¡Œ, æ¯ä¸ª Poller çº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ Queue. æ¯ä¸ª Poller çº¿ç¨‹å¯èƒ½åŒæ—¶è¢«å¤šä¸ª Acceptor çº¿ç¨‹è°ƒç”¨æ¥æ³¨å†Œ PollerEvent. åŒæ · Poller çš„ä¸ªæ•°å¯ä»¥é€šè¿‡ pollers å‚æ•°é…ç½®.")]),s._v(" "),t("p",[s._v("**Poller ä¸æ–­çš„é€šè¿‡å†…éƒ¨çš„ Selector å¯¹è±¡å‘å†…æ ¸æŸ¥è¯¢ Channel çš„çŠ¶æ€, ä¸€æ—¦å¯è¯»å°±ç”Ÿæˆä»»åŠ¡ç±» SocketProcessor äº¤ç»™ Executor å»å¤„ç†. Poller çš„å¦ä¸€ä¸ªé‡è¦ä»»åŠ¡æ˜¯å¾ªç¯éå†æ£€æŸ¥è‡ªå·±æ‰€ç®¡ç†çš„ SocketChannel æ˜¯å¦å·²ç»è¶…æ—¶, å¦‚æœæœ‰è¶…æ—¶å°±å…³é—­è¿™ä¸ª SocketChannel. **")]),s._v(" "),t("h6",{attrs:{id:"_4-socketprocessor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-socketprocessor"}},[s._v("#")]),s._v(" 4.SocketProcessor")]),s._v(" "),t("p",[s._v("Poller ä¼šåˆ›å»º SocketProcessor ä»»åŠ¡ç±»äº¤ç»™"),t("strong",[s._v("çº¿ç¨‹æ± ")]),s._v("å¤„ç†, è€Œ SocketProcessor å®ç°äº† Runnable æ¥å£, ç”¨æ¥"),t("strong",[s._v("å®šä¹‰ Executor ä¸­çº¿ç¨‹æ‰€æ‰§è¡Œçš„ä»»åŠ¡")]),s._v(", ä¸»è¦å°±æ˜¯è°ƒç”¨ Http11Processor ç»„ä»¶æ¥å¤„ç†è¯·æ±‚. "),t("strong",[s._v("Http11Processor è¯»å– Channel çš„æ•°æ®æ¥ç”Ÿæˆ ServletRequest å¯¹è±¡")]),s._v(", è¿™é‡Œéœ€è¦æ³¨æ„:")]),s._v(" "),t("p",[s._v("Http11Processor å¹¶ä¸æ˜¯ç›´æ¥è¯»å– Channel çš„. è¿™æ˜¯å› ä¸º Tomcat æ”¯æŒåŒæ­¥éé˜»å¡ I/O æ¨¡å‹å’Œå¼‚æ­¥ I/O æ¨¡å‹, åœ¨ Java API ä¸­, ç›¸åº”çš„ Channel ç±»ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„, æ¯”å¦‚æœ‰ AsynchronousSocketChannel å’Œ SocketChannel, ä¸ºäº†å¯¹ Http11Processor å±è”½è¿™äº›å·®å¼‚, Tomcat è®¾è®¡äº†ä¸€ä¸ª"),t("strong",[s._v("åŒ…è£…ç±»å«ä½œ SocketWrapper, Http11Processor åªè°ƒç”¨ SocketWrapper çš„æ–¹æ³•å»è¯»å†™æ•°æ®")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_5-executor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-executor"}},[s._v("#")]),s._v(" 5.Executor")]),s._v(" "),t("p",[s._v("Executor æ˜¯ Tomcat "),t("strong",[s._v("å®šåˆ¶ç‰ˆçš„çº¿ç¨‹æ± ")]),s._v(", å®ƒè´Ÿè´£åˆ›å»ºçœŸæ­£å¹²æ´»çš„å·¥ä½œçº¿ç¨‹, å¹²ä»€ä¹ˆæ´»å‘¢? å°±æ˜¯æ‰§è¡Œ SocketProcessor çš„ run() æ–¹æ³•, ä¹Ÿå°±æ˜¯"),t("strong",[s._v("è§£æè¯·æ±‚å¹¶é€šè¿‡å®¹å™¨æ¥å¤„ç†è¯·æ±‚, æœ€ç»ˆä¼šè°ƒç”¨åˆ° Servlet")]),s._v(". åé¢ä¼šç”¨ä¸“é—¨ä»‹ç» Tomcat æ€ä¹ˆæ‰©å±•å’Œä½¿ç”¨ Java åŸç”Ÿçš„çº¿ç¨‹æ± .")]),s._v(" "),t("h5",{attrs:{id:"é«˜å¹¶å‘æ€è·¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é«˜å¹¶å‘æ€è·¯"}},[s._v("#")]),s._v(" é«˜å¹¶å‘æ€è·¯")]),s._v(" "),t("p",[s._v("åœ¨å¼„æ¸…æ¥š NioEndpoint çš„å®ç°åŸç†å, æ¥è€ƒè™‘ä¸€ä¸ªé‡è¦çš„é—®é¢˜, æ€ä¹ˆæŠŠè¿™ä¸ªè¿‡ç¨‹åšåˆ°é«˜å¹¶å‘å‘¢?")]),s._v(" "),t("p",[s._v("é«˜å¹¶å‘å°±æ˜¯èƒ½å¿«é€Ÿåœ°å¤„ç†å¤§é‡çš„è¯·æ±‚, éœ€è¦"),t("strong",[s._v("åˆç†è®¾è®¡çº¿ç¨‹æ¨¡å‹è®© CPU å¿™èµ·æ¥, å°½é‡ä¸è¦è®©çº¿ç¨‹é˜»å¡")]),s._v(", å› ä¸ºä¸€é˜»å¡, CPU å°±é—²ä¸‹æ¥äº†. å¦å¤–å°±æ˜¯æœ‰å¤šå°‘ä»»åŠ¡, å°±ç”¨ç›¸åº”è§„æ¨¡çš„çº¿ç¨‹æ•°å»å¤„ç†. å¯ä»¥æ³¨æ„åˆ° "),t("strong",[s._v("NioEndpoint è¦å®Œæˆä¸‰ä»¶äº‹æƒ…: æ¥æ”¶è¿æ¥, æ£€æµ‹ I/O äº‹ä»¶ä»¥åŠå¤„ç†è¯·æ±‚, é‚£ä¹ˆæœ€æ ¸å¿ƒçš„å°±æ˜¯æŠŠè¿™ä¸‰ä»¶äº‹æƒ…åˆ†å¼€, ç”¨ä¸åŒè§„æ¨¡çš„çº¿ç¨‹å»å¤„ç†, æ¯”å¦‚ç”¨ä¸“é—¨çš„çº¿ç¨‹ç»„å»è·‘ Acceptor, å¹¶ä¸” Acceptor çš„ä¸ªæ•°å¯ä»¥é…ç½®; ç”¨ä¸“é—¨çš„çº¿ç¨‹ç»„å»è·‘ Poller, Poller çš„ä¸ªæ•°ä¹Ÿå¯ä»¥é…ç½®; æœ€åå…·ä½“ä»»åŠ¡çš„æ‰§è¡Œä¹Ÿç”±ä¸“é—¨çš„çº¿ç¨‹æ± æ¥å¤„ç†, ä¹Ÿå¯ä»¥é…ç½®çº¿ç¨‹æ± çš„å¤§å°")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-2"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("I/O æ¨¡å‹æ˜¯ä¸ºäº†è§£å†³å†…å­˜å’Œå¤–éƒ¨è®¾å¤‡é€Ÿåº¦å·®å¼‚çš„é—®é¢˜. å¹³æ—¶è¯´çš„"),t("strong",[s._v("é˜»å¡æˆ–éé˜»å¡")]),s._v("æ˜¯æŒ‡åº”ç”¨ç¨‹åºåœ¨"),t("strong",[s._v("å‘èµ· I/O æ“ä½œæ—¶, æ˜¯ç«‹å³è¿”å›è¿˜æ˜¯ç­‰å¾…")]),s._v(". è€Œ"),t("strong",[s._v("åŒæ­¥å’Œå¼‚æ­¥")]),s._v(", æ˜¯æŒ‡åº”ç”¨ç¨‹åºåœ¨ä¸å†…æ ¸é€šä¿¡æ—¶, **æ•°æ®ä»å†…æ ¸ç©ºé—´åˆ°åº”ç”¨ç©ºé—´çš„æ‹·è´, æ˜¯ç”±å†…æ ¸ä¸»åŠ¨å‘èµ·è¿˜æ˜¯ç”±åº”ç”¨ç¨‹åºæ¥è§¦å‘. **")]),s._v(" "),t("p",[s._v("åœ¨ Tomcat ä¸­, "),t("strong",[s._v("EndPoint ç»„ä»¶çš„ä¸»è¦å·¥ä½œå°±æ˜¯å¤„ç† I/O, è€Œ NioEndpoint åˆ©ç”¨ Java NIO API å®ç°äº†å¤šè·¯å¤ç”¨ I/O æ¨¡å‹")]),s._v(". å…¶ä¸­å…³é”®çš„ä¸€ç‚¹æ˜¯, è¯»å†™æ•°æ®çš„çº¿ç¨‹è‡ªå·±ä¸ä¼šé˜»å¡åœ¨ I/O ç­‰å¾…ä¸Š, è€Œæ˜¯æŠŠè¿™ä¸ªå·¥ä½œäº¤ç»™ Selector. åŒæ—¶ Tomcat åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¿ç”¨åˆ°äº†å¾ˆå¤š Java å¹¶å‘ç¼–ç¨‹æŠ€æœ¯, æ¯”å¦‚ AQS, åŸå­ç±», å¹¶å‘å®¹å™¨, çº¿ç¨‹æ± ç­‰, éƒ½å€¼å¾—ç»†ç»†å“å‘³.")]),s._v(" "),t("h4",{attrs:{id:"_15-nio2endpointç»„ä»¶-tomcatå¦‚ä½•å®ç°å¼‚æ­¥io"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15-nio2endpointç»„ä»¶-tomcatå¦‚ä½•å®ç°å¼‚æ­¥io"}},[s._v("#")]),s._v(" 15.Nio2Endpointç»„ä»¶:Tomcatå¦‚ä½•å®ç°å¼‚æ­¥IO?")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°äº† 5 ç§ I/O æ¨¡å‹, ç›¸åº”çš„ Java æä¾›äº† BIO, NIO å’Œ NIO.2 è¿™äº› API æ¥å®ç°è¿™äº› I/O æ¨¡å‹. BIO æ˜¯åŒæ­¥é˜»å¡, NIO æ˜¯åŒæ­¥éé˜»å¡, é‚£ NIO.2 åˆæ˜¯ä»€ä¹ˆå‘¢? NIO å·²ç»è¶³å¤Ÿå¥½äº†, ä¸ºä»€ä¹ˆè¿˜è¦ NIO.2 å‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("NIO å’Œ NIO.2 æœ€å¤§çš„åŒºåˆ«æ˜¯, ä¸€ä¸ªæ˜¯åŒæ­¥ä¸€ä¸ªæ˜¯å¼‚æ­¥")]),s._v(". å¼‚æ­¥æœ€å¤§çš„ç‰¹ç‚¹æ˜¯, åº”ç”¨ç¨‹åºä¸éœ€è¦è‡ªå·±å»"),t("strong",[s._v("è§¦å‘")]),s._v("æ•°æ®ä»å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„"),t("strong",[s._v("æ‹·è´")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v('ä¸ºä»€ä¹ˆæ˜¯åº”ç”¨ç¨‹åºå» "è§¦å‘" æ•°æ®çš„æ‹·è´, è€Œä¸æ˜¯ç›´æ¥ä»å†…æ ¸æ‹·è´æ•°æ®å‘¢? è¿™æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºæ˜¯ä¸èƒ½è®¿é—®å†…æ ¸ç©ºé—´çš„, å› æ­¤æ•°æ®æ‹·è´è‚¯å®šæ˜¯ç”±å†…æ ¸æ¥åš, å…³é”®æ˜¯è°æ¥è§¦å‘è¿™ä¸ªåŠ¨ä½œ')]),s._v(".")]),s._v(" "),t("p",[s._v("**æ˜¯å†…æ ¸ä¸»åŠ¨å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´å¹¶é€šçŸ¥åº”ç”¨ç¨‹åº. è¿˜æ˜¯ç­‰å¾…åº”ç”¨ç¨‹åºé€šè¿‡ Selector æ¥æŸ¥è¯¢, å½“æ•°æ®å°±ç»ªå, åº”ç”¨ç¨‹åºå†å‘èµ·ä¸€ä¸ª read è°ƒç”¨, è¿™æ—¶å†…æ ¸å†æŠŠæ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´. **")]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´è¿™æ®µæ—¶é—´, åº”ç”¨ç¨‹åºè¿˜æ˜¯é˜»å¡çš„. æ‰€ä»¥å¯ä»¥çœ‹åˆ°å¼‚æ­¥çš„æ•ˆç‡æ˜¯é«˜äºåŒæ­¥çš„, å› ä¸ºå¼‚æ­¥æ¨¡å¼ä¸‹åº”ç”¨ç¨‹åºå§‹ç»ˆä¸ä¼šè¢«é˜»å¡.")]),s._v(" "),t("p",[s._v("ä¸‹é¢ä»¥ç½‘ç»œæ•°æ®è¯»å–ä¸ºä¾‹, æ¥è¯´æ˜å¼‚æ­¥æ¨¡å¼çš„å·¥ä½œè¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("**é¦–å…ˆ, åº”ç”¨ç¨‹åºåœ¨è°ƒç”¨ read API çš„åŒæ—¶å‘Šè¯‰å†…æ ¸ä¸¤ä»¶äº‹æƒ…: æ•°æ®å‡†å¤‡å¥½äº†ä»¥åæ‹·è´åˆ°å“ªä¸ª Buffer, ä»¥åŠè°ƒç”¨å“ªä¸ªå›è°ƒå‡½æ•°å»å¤„ç†è¿™äº›æ•°æ®. ä¹‹å, å†…æ ¸æ¥åˆ°è¿™ä¸ª read æŒ‡ä»¤å, ç­‰å¾…ç½‘å¡æ•°æ®åˆ°è¾¾, æ•°æ®åˆ°äº†å, äº§ç”Ÿç¡¬ä»¶ä¸­æ–­, å†…æ ¸åœ¨ä¸­æ–­ç¨‹åºé‡ŒæŠŠæ•°æ®ä»ç½‘å¡æ‹·è´åˆ°å†…æ ¸ç©ºé—´, æ¥ç€åš TCP/IP åè®®å±‚é¢çš„æ•°æ®è§£åŒ…å’Œé‡ç»„, å†æŠŠæ•°æ®æ‹·è´åˆ°åº”ç”¨ç¨‹åºæŒ‡å®šçš„ Buffer, æœ€åè°ƒç”¨åº”ç”¨ç¨‹åºæŒ‡å®šçš„å›è°ƒå‡½æ•°. **")]),s._v(" "),t("p",[s._v("å¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¼ å›¾æ¥å›é¡¾ä¸€ä¸‹åŒæ­¥ä¸å¼‚æ­¥çš„åŒºåˆ«:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161330-quo98wb.jpg",alt:""}})]),s._v(" "),t("p",[s._v('å¯ä»¥çœ‹åˆ°åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹, åº”ç”¨ç¨‹åºå½“äº†"ç”©æ‰‹æŒæŸœ", å†…æ ¸åˆ™å¿™å‰å¿™å, ä½†æœ€å¤§é™åº¦æé«˜äº† I/O é€šä¿¡çš„æ•ˆç‡. Windows çš„ IOCP å’Œ Linux å†…æ ¸ 2.6 çš„ AIO éƒ½æä¾›äº†å¼‚æ­¥ I/O çš„æ”¯æŒ, '),t("strong",[s._v("Java çš„ NIO.2 API å°±æ˜¯å¯¹æ“ä½œç³»ç»Ÿå¼‚æ­¥ I/O API çš„å°è£…")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"java-nio-2å›é¡¾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-nio-2å›é¡¾"}},[s._v("#")]),s._v(" Java NIO.2å›é¡¾")]),s._v(" "),t("p",[s._v("æœ¬éƒ¨åˆ†é‡ç‚¹å…³æ³¨ Tomcat æ˜¯å¦‚ä½•å®ç°å¼‚æ­¥ I/O æ¨¡å‹çš„, ä½†åœ¨è¿™ä¹‹å‰, å…ˆæ¥ç®€å•å›é¡¾ä¸‹å¦‚ä½•ç”¨ Java çš„ NIO.2 API æ¥ç¼–å†™ä¸€ä¸ªæœåŠ¡ç«¯ç¨‹åº.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nio2Server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" es "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCachedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. åˆ›å»ºå¼‚æ­¥é€šé“ç¾¤ç»„")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousChannelGroup")]),s._v(" tg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousChannelGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("withCachedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. åˆ›å»ºæœåŠ¡ç«¯å¼‚æ­¥é€šé“")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousServerSocketChannel")]),s._v(" assc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousServerSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. ç»‘å®šç›‘å¬ç«¯å£")]),s._v("\n      assc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetSocketAddress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5. ç›‘å¬è¿æ¥, ä¼ å…¥å›è°ƒç±»å¤„ç†è¿æ¥è¯·æ±‚")]),s._v("\n      assc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AcceptHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä»£ç ä¸»è¦åšäº† 5 ä»¶äº‹æƒ…:")]),s._v(" "),t("ol",[t("li",[s._v("åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± , è¿™ä¸ªçº¿ç¨‹æ± ç”¨æ¥æ‰§è¡Œæ¥è‡ªå†…æ ¸çš„å›è°ƒè¯·æ±‚.")]),s._v(" "),t("li",[s._v("åˆ›å»ºä¸€ä¸ª AsynchronousChannelGroup, å¹¶ç»‘å®šä¸€ä¸ªçº¿ç¨‹æ± .")]),s._v(" "),t("li",[s._v("åˆ›å»º AsynchronousServerSocketChannel, å¹¶ç»‘å®šåˆ° AsynchronousChannelGroup.")]),s._v(" "),t("li",[s._v("ç»‘å®šä¸€ä¸ªç›‘å¬ç«¯å£.")]),s._v(" "),t("li",[s._v("è°ƒç”¨ accept() æ–¹æ³•å¼€å§‹ç›‘å¬è¿æ¥è¯·æ±‚, åŒæ—¶ä¼ å…¥ä¸€ä¸ªå›è°ƒç±»å»å¤„ç†è¿æ¥è¯·æ±‚. è¯·æ³¨æ„, accept() æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ this å¯¹è±¡, å°±æ˜¯ Nio2Server å¯¹è±¡æœ¬èº«, ä¸‹æ–‡è¿˜ä¼šè®²ä¸ºä»€ä¹ˆè¦ä¼ å…¥è¿™ä¸ªå‚æ•°.")])]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± å‘¢? å…¶å®"),t("strong",[s._v("åœ¨å¼‚æ­¥ I/O æ¨¡å‹é‡Œ, åº”ç”¨ç¨‹åºä¸çŸ¥é“æ•°æ®åœ¨ä»€ä¹ˆæ—¶å€™åˆ°è¾¾, å› æ­¤å‘å†…æ ¸æ³¨å†Œå›è°ƒå‡½æ•°, å½“æ•°æ®åˆ°è¾¾æ—¶, å†…æ ¸å°±ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°. åŒæ—¶ä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦, ä¼šæä¾›ä¸€ä¸ªçº¿ç¨‹æ± ç»™å†…æ ¸ä½¿ç”¨, è¿™æ ·ä¸ä¼šè€½è¯¯å†…æ ¸çº¿ç¨‹çš„å·¥ä½œ, å†…æ ¸åªéœ€è¦æŠŠå·¥ä½œäº¤ç»™çº¿ç¨‹æ± å°±ç«‹å³è¿”å›äº†")]),s._v(".")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹çœ‹å¤„ç†è¿æ¥çš„å›è°ƒç±» AcceptHandler æ˜¯ä»€ä¹ˆæ ·çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// AcceptHandler ç±»å®ç°äº† CompletionHandler æ¥å£çš„ completed æ–¹æ³•. å®ƒè¿˜æœ‰ä¸¤ä¸ªæ¨¡æ¿å‚æ•°, ç¬¬ä¸€ä¸ªæ˜¯å¼‚æ­¥é€šé“, ç¬¬äºŒä¸ªå°±æ˜¯ Nio2Server æœ¬èº«")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AcceptHandler")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionHandler")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nio2Server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…·ä½“å¤„ç†è¿æ¥è¯·æ±‚çš„å°±æ˜¯ completed() æ–¹æ³•, å®ƒæœ‰ä¸¤ä¸ªå‚æ•°: ç¬¬ä¸€ä¸ªæ˜¯å¼‚æ­¥é€šé“, ç¬¬äºŒä¸ªå°±æ˜¯ä¸Šé¢ä¼ å…¥çš„ NioServer å¯¹è±¡")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("completed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousSocketChannel")]),s._v(" asc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nio2Server")]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨ accept æ–¹æ³•ç»§ç»­æ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚")]),s._v("\n      attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("assc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. å…ˆåˆ†é…å¥½ Buffer, å‘Šè¯‰å†…æ ¸, æ•°æ®æ‹·è´åˆ°å“ªé‡Œå»")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" buf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("allocate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. è°ƒç”¨ read å‡½æ•°è¯»å–æ•°æ®, é™¤äº†æŠŠ buf ä½œä¸ºå‚æ•°ä¼ å…¥, è¿˜ä¼ å…¥è¯»å›è°ƒç±»")]),s._v("\n      channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReadHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("asc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°å®ƒå®ç°äº† CompletionHandler æ¥å£, ä¸‹é¢å…ˆçœ‹çœ‹ CompletionHandler æ¥å£çš„å®šä¹‰.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionHandler")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("completed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("failed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" exc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("CompletionHandler æ¥å£æœ‰ä¸¤ä¸ªæ¨¡æ¿å‚æ•° V å’Œ A, åˆ†åˆ«è¡¨ç¤º I/O è°ƒç”¨çš„è¿”å›å€¼å’Œé™„ä»¶ç±»")]),s._v(". æ¯”å¦‚ accept çš„è¿”å›å€¼å°±æ˜¯ AsynchronousSocketChannel, è€Œé™„ä»¶ç±»ç”±ç”¨æˆ·è‡ªå·±å†³å®š, åœ¨ accept çš„è°ƒç”¨ä¸­, ä¼ å…¥äº†ä¸€ä¸ª Nio2Server. å› æ­¤ AcceptHandler å¸¦æœ‰äº†ä¸¤ä¸ªæ¨¡æ¿å‚æ•°: AsynchronousSocketChannel å’Œ Nio2Server.")]),s._v(" "),t("p",[s._v("CompletionHandler æœ‰ä¸¤ä¸ªæ–¹æ³•: "),t("strong",[s._v("completed() å’Œ failed()")]),s._v(" , åˆ†åˆ«åœ¨ I/O æ“ä½œæˆåŠŸå’Œå¤±è´¥æ—¶è°ƒç”¨. completed() æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°, å…¶å®å°±æ˜¯å‰é¢è¯´çš„ä¸¤ä¸ªæ¨¡æ¿å‚æ•°. ä¹Ÿå°±æ˜¯è¯´, Java çš„ NIO.2 åœ¨"),t("strong",[s._v("è°ƒç”¨å›è°ƒæ–¹æ³•æ—¶, ä¼šæŠŠè¿”å›å€¼å’Œé™„ä»¶ç±»å½“ä½œå‚æ•°ä¼ ç»™ NIO.2 çš„ä½¿ç”¨è€…")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸‹é¢å†æ¥çœ‹çœ‹å¤„ç†è¯»çš„å›è°ƒç±» ReadHandler é•¿ä»€ä¹ˆæ ·å­.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReadHandler")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionHandler")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("   \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»å–åˆ°æ¶ˆæ¯åçš„å¤„ç†  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("completed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// attachment å°±æ˜¯æ•°æ®, è°ƒç”¨ flip æ“ä½œ, å…¶å®å°±æ˜¯æŠŠè¯»çš„ä½ç½®ç§»åŠ¨æœ€å‰é¢")]),s._v("\n        attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("flip")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯»å–æ•°æ®")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("failed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" exc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("read() è°ƒç”¨çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•´å‹æ•°, æ‰€ä»¥å›è°ƒæ–¹æ³•é‡Œçš„"),t("strong",[s._v("ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªæ•´å‹, è¡¨ç¤ºæœ‰å¤šå°‘æ•°æ®")]),s._v("è¢«è¯»å–åˆ°äº† Buffer ä¸­. ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª ByteBuffer, è¿™æ˜¯å› ä¸ºåœ¨è°ƒç”¨ read() æ–¹æ³•æ—¶, æŠŠç”¨æ¥"),t("strong",[s._v("å­˜æ”¾æ•°æ®çš„ ByteBuffer å½“ä½œé™„ä»¶ç±»")]),s._v("ä¼ è¿›å»äº†, æ‰€ä»¥åœ¨å›è°ƒæ–¹æ³•é‡Œ, æœ‰ ByteBuffer ç±»å‹çš„å‚æ•°, "),t("strong",[s._v("å¯ä»¥ç›´æ¥ä»è¿™ä¸ª ByteBuffer é‡Œè·å–æ•°æ®")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"nio2endpoint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nio2endpoint"}},[s._v("#")]),s._v(" Nio2Endpoint")]),s._v(" "),t("p",[s._v("æŒæ¡äº† Java NIO.2 API çš„ä½¿ç”¨ä»¥åŠæœåŠ¡ç«¯ç¨‹åºçš„å·¥ä½œåŸç†ä¹‹å, å†æ¥ç†è§£ Tomcat çš„å¼‚æ­¥ I/O å®ç°å°±ä¸éš¾äº†. å…ˆé€šè¿‡ä¸€å¼ å›¾æ¥çœ‹çœ‹ Nio2Endpoint æœ‰å“ªäº›ç»„ä»¶.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161330-ql4r11f.jpg",alt:""}})]),s._v(" "),t("p",[s._v("ä»å›¾ä¸Šçœ‹, æ€»ä½“å·¥ä½œæµç¨‹è·Ÿ NioEndpoint æ˜¯ç›¸ä¼¼çš„.")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("LimitLatch æ˜¯è¿æ¥æ§åˆ¶å™¨, å®ƒè´Ÿè´£æ§åˆ¶æœ€å¤§è¿æ¥æ•°.")])]),s._v(" "),t("li",[t("p",[s._v("Nio2Acceptor æ‰©å±•äº† Acceptor, ç”¨å¼‚æ­¥ I/O çš„æ–¹å¼æ¥æ¥æ”¶è¿æ¥, è·‘åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹é‡Œ, ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ç»„. Nio2Acceptor æ¥æ”¶æ–°çš„è¿æ¥å, å¾—åˆ°ä¸€ä¸ª AsynchronousSocketChannel, Nio2Acceptor æŠŠ AsynchronousSocketChannel å°è£…æˆä¸€ä¸ª Nio2SocketWrapper, å¹¶åˆ›å»ºä¸€ä¸ª SocketProcessor ä»»åŠ¡ç±»äº¤ç»™çº¿ç¨‹æ± å¤„ç†, å¹¶ä¸” SocketProcessor æŒæœ‰ Nio2SocketWrapper å¯¹è±¡.")])]),s._v(" "),t("li",[t("p",[s._v("Executor åœ¨æ‰§è¡Œ SocketProcessor æ—¶, SocketProcessor çš„ run() æ–¹æ³•ä¼šè°ƒç”¨ "),t("strong",[s._v("Http11Processor")]),s._v(" æ¥å¤„ç†è¯·æ±‚, Http11Processor ä¼šé€šè¿‡ Nio2SocketWrapper è¯»å–å’Œè§£æè¯·æ±‚æ•°æ®, è¯·æ±‚ç»è¿‡å®¹å™¨å¤„ç†å, å†æŠŠå“åº”é€šè¿‡ Nio2SocketWrapper å†™å‡º.")])])]),s._v(" "),t("p",[s._v("éœ€è¦æ³¨æ„ Nio2Endpoint è·Ÿ NioEndpoint çš„ä¸€ä¸ªæ˜æ˜¾ä¸åŒç‚¹æ˜¯, "),t("mark",[t("strong",[s._v("Nio2Endpoint ä¸­æ²¡æœ‰ Poller ç»„ä»¶, ä¹Ÿå°±æ˜¯æ²¡æœ‰ Selector. è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºåœ¨å¼‚æ­¥ I/O æ¨¡å¼ä¸‹, Selector çš„å·¥ä½œäº¤ç»™å†…æ ¸æ¥åšäº†")])]),s._v("â€‹ **. **")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹ Nio2Endpoint å„ç»„ä»¶çš„è®¾è®¡.")]),s._v(" "),t("h6",{attrs:{id:"_1-nio2acceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-nio2acceptor"}},[s._v("#")]),s._v(" 1.Nio2Acceptor")]),s._v(" "),t("p",[s._v("å’Œ NioEndpint ä¸€æ ·, Nio2Endpoint çš„åŸºæœ¬æ€è·¯æ˜¯ç”¨ LimitLatch ç»„ä»¶æ¥æ§åˆ¶è¿æ¥æ•°, ä½†æ˜¯ Nio2Acceptor çš„ç›‘å¬è¿æ¥çš„è¿‡ç¨‹ä¸æ˜¯åœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œä¸æ–­çš„è°ƒ accept() æ–¹æ³•, è€Œæ˜¯"),t("strong",[s._v("é€šè¿‡å›è°ƒå‡½æ•°")]),s._v("æ¥å®Œæˆçš„. æ¥çœ‹çœ‹å®ƒçš„è¿æ¥ç›‘å¬æ–¹æ³•:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("serverSock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å…¶å®å°±æ˜¯è°ƒç”¨äº† accept() æ–¹æ³•, æ³¨æ„å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ this, è¡¨æ˜ Nio2Acceptor è‡ªå·±å°±æ˜¯å¤„ç†è¿æ¥çš„å›è°ƒç±», å› æ­¤ Nio2Acceptor å®ç°äº† CompletionHandler() æ¥å£. é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç° CompletionHandler æ¥å£çš„å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nio2Acceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Acceptor")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionHandler")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousSocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("completed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsynchronousSocketChannel")]),s._v(" socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Void")]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isRunning")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isPaused")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMaxConnections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ²¡æœ‰è¿æ¥é™åˆ¶, ç»§ç»­æ¥æ”¶æ–°çš„è¿æ¥")]),s._v("\n            serverSock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæœ‰è¿æ¥é™åˆ¶, å°±åœ¨çº¿ç¨‹æ± é‡Œè·‘ Run æ–¹æ³•, Run æ–¹æ³•ä¼šæ£€æŸ¥è¿æ¥æ•°")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†è¯·æ±‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setSocketOptions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("closeSocket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ° CompletionHandler çš„ä¸¤ä¸ªæ¨¡æ¿å‚æ•°åˆ†åˆ«æ˜¯ AsynchronousServerSocketChannel å’Œ Void, å‰é¢è¯´è¿‡ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ accept() æ–¹æ³•çš„è¿”å›å€¼, ç¬¬äºŒä¸ªå‚æ•°æ˜¯é™„ä»¶ç±», ç”±ç”¨æˆ·è‡ªå·±å†³å®š, è¿™é‡Œä¸º Void. completed() æ–¹æ³•çš„å¤„ç†é€»è¾‘æ¯”è¾ƒç®€å•:")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æœæ²¡æœ‰è¿æ¥é™åˆ¶, ç»§ç»­åœ¨æœ¬çº¿ç¨‹ä¸­è°ƒç”¨ accept() æ–¹æ³•æ¥æ”¶æ–°çš„è¿æ¥.")]),s._v(" "),t("li",[s._v("å¦‚æœæœ‰è¿æ¥é™åˆ¶, å°±åœ¨çº¿ç¨‹æ± é‡Œè·‘ run() æ–¹æ³•å»æ¥æ”¶æ–°çš„è¿æ¥. é‚£ä¸ºä»€ä¹ˆè¦è·‘ run() æ–¹æ³•å‘¢, å› ä¸ºåœ¨ run() æ–¹æ³•é‡Œä¼šæ£€æŸ¥è¿æ¥æ•°, å½“è¿æ¥è¾¾åˆ°æœ€å¤§æ•°æ—¶, çº¿ç¨‹å¯èƒ½ä¼šè¢« LimitLatch é˜»å¡. ä¸ºä»€ä¹ˆè¦æ”¾åœ¨çº¿ç¨‹æ± é‡Œè·‘å‘¢? è¿™æ˜¯å› ä¸ºå¦‚æœæ”¾åœ¨å½“å‰çº¿ç¨‹é‡Œæ‰§è¡Œ, completed() æ–¹æ³•å¯èƒ½è¢«é˜»å¡, ä¼šå¯¼è‡´è¿™ä¸ªå›è°ƒæ–¹æ³•ä¸€ç›´ä¸è¿”å›.")])]),s._v(" "),t("p",[s._v("æ¥ç€ completed() æ–¹æ³•ä¼šè°ƒç”¨ setSocketOptions() æ–¹æ³•, åœ¨è¿™ä¸ªæ–¹æ³•é‡Œ, ä¼šåˆ›å»º Nio2SocketWrapper å’Œ SocketProcessor, å¹¶äº¤ç»™çº¿ç¨‹æ± å¤„ç†.")]),s._v(" "),t("h6",{attrs:{id:"_2-nio2socketwrapper"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-nio2socketwrapper"}},[s._v("#")]),s._v(" 2.Nio2SocketWrapper")]),s._v(" "),t("p",[s._v("Nio2SocketWrapper çš„ä¸»è¦ä½œç”¨æ˜¯"),t("strong",[s._v("å°è£… Channel")]),s._v(", å¹¶æä¾›æ¥å£ç»™ Http11Processor è¯»å†™æ•°æ®. è®²åˆ°è¿™é‡Œä½ æ˜¯ä¸æ˜¯æœ‰ä¸ªç–‘é—®: Http11Processor æ˜¯ä¸èƒ½é˜»å¡ç­‰å¾…æ•°æ®çš„, æŒ‰ç…§å¼‚æ­¥ I/O çš„å¥—è·¯, Http11Processor åœ¨è°ƒç”¨ Nio2SocketWrapper çš„ read() æ–¹æ³•æ—¶éœ€è¦æ³¨å†Œå›è°ƒç±», read() è°ƒç”¨ä¼šç«‹å³è¿”å›, é—®é¢˜æ˜¯ç«‹å³è¿”å›å Http11Processor è¿˜æ²¡æœ‰è¯»åˆ°æ•°æ®, æ€ä¹ˆåŠå‘¢? è¿™ä¸ªè¯·æ±‚çš„å¤„ç†ä¸å°±å¤±è´¥äº†å—?")]),s._v(" "),t("p",[s._v("ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, Http11Processor æ˜¯"),t("strong",[s._v("é€šè¿‡ 2 æ¬¡ read() è°ƒç”¨æ¥å®Œæˆæ•°æ®è¯»å–æ“ä½œ")]),s._v("çš„.")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€æ¬¡ read è°ƒç”¨: è¿æ¥åˆšåˆšå»ºç«‹å¥½å, Acceptor åˆ›å»º SocketProcessor ä»»åŠ¡ç±»äº¤ç»™çº¿ç¨‹æ± å»å¤„ç†, Http11Processor åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­, ä¼šè°ƒç”¨ Nio2SocketWrapper çš„ read() æ–¹æ³•å‘å‡ºç¬¬ä¸€æ¬¡è¯»è¯·æ±‚, åŒæ—¶æ³¨å†Œäº†å›è°ƒç±» readCompletionHandler, å› ä¸ºæ•°æ®æ²¡è¯»åˆ°, Http11Processor æŠŠå½“å‰çš„ Nio2SocketWrapper æ ‡è®°ä¸ºæ•°æ®ä¸å®Œæ•´. "),t("strong",[s._v("æ¥ç€ SocketProcessor çº¿ç¨‹è¢«å›æ”¶, Http11Processor å¹¶æ²¡æœ‰é˜»å¡ç­‰å¾…æ•°æ®")]),s._v(". è¿™é‡Œè¯·æ³¨æ„, Http11Processor ç»´æŠ¤äº†ä¸€ä¸ª Nio2SocketWrapper åˆ—è¡¨, ä¹Ÿå°±æ˜¯ç»´æŠ¤äº†è¿æ¥çš„çŠ¶æ€.")]),s._v(" "),t("li",[s._v("ç¬¬äºŒæ¬¡ read è°ƒç”¨: å½“æ•°æ®åˆ°è¾¾å, å†…æ ¸å·²ç»æŠŠæ•°æ®æ‹·è´åˆ° Http11Processor æŒ‡å®šçš„ Buffer é‡Œ, åŒæ—¶å›è°ƒç±» readCompletionHandler è¢«è°ƒç”¨, åœ¨è¿™ä¸ªå›è°ƒå¤„ç†æ–¹æ³•é‡Œä¼š"),t("strong",[s._v("é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ SocketProcessor ä»»åŠ¡æ¥ç»§ç»­å¤„ç†è¿™ä¸ªè¿æ¥")]),s._v(", è€Œè¿™ä¸ªæ–°çš„ SocketProcessor ä»»åŠ¡ç±»æŒæœ‰åŸæ¥é‚£ä¸ª Nio2SocketWrapper, è¿™ä¸€æ¬¡ Http11Processor å¯ä»¥é€šè¿‡ Nio2SocketWrapper è¯»å–æ•°æ®äº†, å› ä¸ºæ•°æ®å·²ç»åˆ°äº†åº”ç”¨å±‚çš„ Buffer.")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªå›è°ƒç±» readCompletionHandler çš„æºç å¦‚ä¸‹, æœ€å…³é”®çš„ä¸€ç‚¹æ˜¯, "),t("strong",[s._v("Nio2SocketWrapper æ˜¯ä½œä¸ºé™„ä»¶ç±»æ¥ä¼ é€’çš„")]),s._v(", è¿™æ ·åœ¨å›è°ƒå‡½æ•°é‡Œèƒ½æ‹¿åˆ°æ‰€æœ‰çš„ä¸Šä¸‹æ–‡.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("readCompletionHandler "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompletionHandler")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketWrapperBase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nio2Channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("completed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" nBytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketWrapperBase")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nio2Channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€šè¿‡é™„ä»¶ç±» SocketWrapper æ‹¿åˆ°æ‰€æœ‰çš„ä¸Šä¸‹æ–‡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nio2SocketWrapper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getEndpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processSocket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OPEN_READ")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("failed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" exc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketWrapperBase")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nio2Channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" attachment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-3"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("åœ¨å¼‚æ­¥ I/O æ¨¡å‹é‡Œ, å†…æ ¸åšäº†å¾ˆå¤šäº‹æƒ…, å®ƒæŠŠæ•°æ®å‡†å¤‡å¥½, å¹¶æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´, å†é€šçŸ¥åº”ç”¨ç¨‹åºå»å¤„ç†, ä¹Ÿå°±æ˜¯è°ƒç”¨åº”ç”¨ç¨‹åºæ³¨å†Œçš„å›è°ƒå‡½æ•°. Java åœ¨æ“ä½œç³»ç»Ÿ å¼‚æ­¥ IO API çš„åŸºç¡€ä¸Šè¿›è¡Œäº†å°è£…, æä¾›äº† Java NIO.2 API, è€Œ Tomcat çš„å¼‚æ­¥ I/O æ¨¡å‹å°±æ˜¯åŸºäº Java NIO.2 å®ç°çš„.")]),s._v(" "),t("p",[s._v("ç”±äº NIO å’Œ NIO.2 çš„ API æ¥å£å’Œä½¿ç”¨æ–¹æ³•å®Œå…¨ä¸åŒ, å¯ä»¥æƒ³è±¡ä¸€ä¸ªç³»ç»Ÿä¸­å¦‚æœå·²ç»æ”¯æŒåŒæ­¥ I/O, è¦å†æ”¯æŒå¼‚æ­¥ I/O, æ”¹åŠ¨æ˜¯æ¯”è¾ƒå¤§çš„, å¾ˆæœ‰å¯èƒ½ä¸å¾—ä¸é‡æ–°è®¾è®¡ç»„ä»¶ä¹‹é—´çš„æ¥å£. ä½†æ˜¯ Tomcat é€šè¿‡å……åˆ†çš„æŠ½è±¡, æ¯”å¦‚ SocketWrapper å¯¹ Channel çš„å°è£…, å†åŠ ä¸Š Http11Processor çš„ä¸¤æ¬¡ read è°ƒç”¨, å·§å¦™åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜, ä½¿å¾—åè®®å¤„ç†å™¨ Http11Processor å’Œ I/O é€šä¿¡å¤„ç†å™¨ Endpoint ä¹‹é—´çš„æ¥å£ä¿æŒä¸å˜.")]),s._v(" "),t("h4",{attrs:{id:"_16-aprendpointç»„ä»¶-tomcat-apræé«˜ioæ€§èƒ½çš„ç§˜å¯†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-aprendpointç»„ä»¶-tomcat-apræé«˜ioæ€§èƒ½çš„ç§˜å¯†"}},[s._v("#")]),s._v(" 16.AprEndpointç»„ä»¶:Tomcat APRæé«˜IOæ€§èƒ½çš„ç§˜å¯†")]),s._v(" "),t("p",[s._v("åœ¨ä½¿ç”¨ Tomcat æ—¶, ä¼šåœ¨å¯åŠ¨æ—¥å¿—é‡Œçœ‹åˆ°è¿™æ ·çš„æç¤ºä¿¡æ¯:")]),s._v(" "),t("blockquote",[t("p",[s._v("The APR based Apache Tomcat Native library which allows optimal performance in production environments was not found on the java.library.path: ****")])]),s._v(" "),t("p",[s._v("è¿™å¥è¯çš„æ„æ€å°±æ˜¯æ¨èä½ å»å®‰è£… APR åº“, å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½. é‚£ä»€ä¹ˆæ˜¯ APR å‘¢?")]),s._v(" "),t("p",[s._v("APR(Apache Portable Runtime Libraries)æ˜¯ Apache å¯ç§»æ¤è¿è¡Œæ—¶åº“, å®ƒæ˜¯ç”¨ C è¯­è¨€å®ç°çš„, å…¶ç›®çš„æ˜¯å‘ä¸Šå±‚åº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªè·¨å¹³å°çš„æ“ä½œç³»ç»Ÿæ¥å£åº“. Tomcat å¯ä»¥ç”¨å®ƒæ¥å¤„ç†åŒ…æ‹¬æ–‡ä»¶å’Œç½‘ç»œ I/O, ä»è€Œæå‡æ€§èƒ½. å‰é¢æåˆ°è¿‡, Tomcat æ”¯æŒçš„è¿æ¥å™¨æœ‰ NIO, NIO.2 å’Œ APR. è·Ÿ NioEndpoint ä¸€æ ·, AprEndpoint ä¹Ÿå®ç°äº†éé˜»å¡ I/O, å®ƒä»¬çš„åŒºåˆ«æ˜¯: NioEndpoint é€šè¿‡è°ƒç”¨ Java çš„ NIO API æ¥å®ç°éé˜»å¡ I/O, è€Œ AprEndpoint æ˜¯é€šè¿‡ JNI è°ƒç”¨ APR æœ¬åœ°åº“è€Œå®ç°éé˜»å¡ I/O çš„.")]),s._v(" "),t("p",[s._v("é‚£åŒæ ·æ˜¯éé˜»å¡ I/O, ä¸ºä»€ä¹ˆ Tomcat ä¼šæç¤ºä½¿ç”¨ APR æœ¬åœ°åº“çš„æ€§èƒ½ä¼šæ›´å¥½å‘¢? è¿™æ˜¯å› ä¸ºåœ¨æŸäº›åœºæ™¯ä¸‹, æ¯”å¦‚éœ€è¦é¢‘ç¹ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’, Socket ç½‘ç»œé€šä¿¡å°±æ˜¯è¿™æ ·ä¸€ä¸ªåœºæ™¯, ç‰¹åˆ«æ˜¯å¦‚æœ Web åº”ç”¨ä½¿ç”¨äº† TLS æ¥åŠ å¯†ä¼ è¾“, ç”±äº TLS åè®®åœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­æœ‰å¤šæ¬¡ç½‘ç»œäº¤äº’, åœ¨è¿™ç§æƒ…å†µä¸‹ Java è·Ÿ C è¯­è¨€ç¨‹åºç›¸æ¯”è¿˜æ˜¯æœ‰ä¸€å®šçš„å·®è·, è€Œè¿™æ­£æ˜¯ APR çš„å¼ºé¡¹.")]),s._v(" "),t("p",[s._v("Tomcat æœ¬èº«æ˜¯ Java ç¼–å†™çš„, ä¸ºäº†è°ƒç”¨ C è¯­è¨€ç¼–å†™çš„ APR, éœ€è¦"),t("strong",[s._v("é€šè¿‡ JNI æ–¹å¼")]),s._v("æ¥è°ƒç”¨. JNI(Java Native Interface) æ˜¯ JDK æä¾›çš„ä¸€ä¸ªç¼–ç¨‹æ¥å£, å®ƒå…è®¸ Java ç¨‹åºè°ƒç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„ç¨‹åºæˆ–è€…ä»£ç åº“, å…¶å® JDK æœ¬èº«çš„å®ç°ä¹Ÿå¤§é‡ç”¨åˆ° JNI æŠ€æœ¯æ¥è°ƒç”¨æœ¬åœ° C ç¨‹åºåº“.")]),s._v(" "),t("p",[s._v("æœ¬éƒ¨åˆ†é¦–å…ˆä¼šè®² AprEndpoint ç»„ä»¶çš„å·¥ä½œè¿‡ç¨‹, æ¥ç€ä¼šåœ¨åŸç†çš„åŸºç¡€ä¸Šåˆ†æ APR æå‡æ€§èƒ½çš„ä¸€äº›ç§˜å¯†.")]),s._v(" "),t("h5",{attrs:{id:"aprendpointå·¥ä½œè¿‡ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aprendpointå·¥ä½œè¿‡ç¨‹"}},[s._v("#")]),s._v(" AprEndpointå·¥ä½œè¿‡ç¨‹")]),s._v(" "),t("p",[s._v("ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£ AprEndpoint çš„å·¥ä½œè¿‡ç¨‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161350-110183t.jpg",alt:""}})]),s._v(" "),t("p",[s._v("å®ƒè·Ÿ NioEndpoint çš„å›¾å¾ˆåƒ, ä»å·¦åˆ°å³æœ‰ LimitLatch, Acceptor, Poller, SocketProcessor å’Œ Http11Processor, åªæ˜¯ Acceptor å’Œ Poller çš„å®ç°å’Œ NioEndpoint ä¸åŒ. æ¥ä¸‹æ¥åˆ†åˆ«æ¥è®²è®²è¿™ä¸¤ä¸ªç»„ä»¶.")]),s._v(" "),t("h6",{attrs:{id:"_1-acceptor-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-acceptor-2"}},[s._v("#")]),s._v(" 1.Acceptor")]),s._v(" "),t("p",[s._v("Accpetor çš„åŠŸèƒ½å°±æ˜¯ç›‘å¬è¿æ¥, æ¥æ”¶å¹¶å»ºç«‹è¿æ¥. å®ƒçš„æœ¬è´¨å°±æ˜¯è°ƒç”¨äº†å››ä¸ªæ“ä½œç³»ç»Ÿ API: socket, bind, listen å’Œ accept. é‚£ Java è¯­è¨€å¦‚ä½•ç›´æ¥è°ƒç”¨ C è¯­è¨€ API å‘¢? ç­”æ¡ˆå°±æ˜¯é€šè¿‡ "),t("strong",[s._v("JNI")]),s._v(". å…·ä½“æ¥è¯´å°±æ˜¯ä¸¤æ­¥: å…ˆå°è£…ä¸€ä¸ª Java ç±», åœ¨é‡Œé¢å®šä¹‰ä¸€å †ç”¨ "),t("strong",[s._v("native å…³é”®å­—")]),s._v("ä¿®é¥°çš„æ–¹æ³•, åƒä¸‹é¢è¿™æ ·.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Socket")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨ native ä¿®é¥°è¿™ä¸ªæ–¹æ³•, è¡¨æ˜è¿™ä¸ªå‡½æ•°æ˜¯ C è¯­è¨€å®ç°")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" family"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" protocol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" cont"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" backlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("æ¥ç€ç”¨ C ä»£ç å®ç°è¿™äº›æ–¹æ³•, æ¯”å¦‚ bind() å‡½æ•°å°±æ˜¯è¿™æ ·å®ç°çš„:")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ³¨æ„å‡½æ•°çš„åå­—è¦ç¬¦åˆ JNI è§„èŒƒçš„è¦æ±‚")]),s._v("\nJNIEXPORT jint JNICALL \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Java_org_apache_tomcat_jni_Socket_bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("JNIEnv "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" jlong sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("jlong sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t    jint rv "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" APR_SUCCESS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("tcn_socket_t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("tcn_socket_t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("apr_sockaddr_t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("apr_sockaddr_t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨ APR åº“è‡ªå·±å®ç°çš„ bind å‡½æ•°")]),s._v("\n\t    rv "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apr_socket_bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" rv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("è¦æ³¨æ„çš„æ˜¯å‡½æ•°åå­—è¦ç¬¦åˆ JNI çš„è§„èŒƒ, ä»¥åŠ Java å’Œ C è¯­è¨€å¦‚ä½•äº’ç›¸ä¼ é€’å‚æ•°, æ¯”å¦‚åœ¨ C è¯­è¨€æœ‰æŒ‡é’ˆ, Java æ²¡æœ‰æŒ‡é’ˆçš„æ¦‚å¿µ, æ‰€ä»¥åœ¨ Java ä¸­ç”¨ long ç±»å‹æ¥è¡¨ç¤ºæŒ‡é’ˆ. "),t("strong",[s._v("AprEndpoint çš„ Acceptor ç»„ä»¶å°±æ˜¯è°ƒç”¨äº† APR å®ç°çš„å››ä¸ª API")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_2-poller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-poller"}},[s._v("#")]),s._v(" 2.Poller")]),s._v(" "),t("p",[s._v("Acceptor æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„ Socket è¿æ¥å, æŒ‰ç…§ NioEndpoint çš„å®ç°, å®ƒä¼šæŠŠè¿™ä¸ª Socket äº¤ç»™ Poller å»æŸ¥è¯¢ I/O äº‹ä»¶. AprEndpoint ä¹Ÿæ˜¯è¿™æ ·åšçš„, ä¸è¿‡ AprEndpoint çš„ Poller å¹¶ä¸æ˜¯è°ƒç”¨ Java NIO é‡Œçš„ Selector æ¥æŸ¥è¯¢ Socket çš„çŠ¶æ€, "),t("strong",[s._v("è€Œæ˜¯é€šè¿‡ JNI è°ƒç”¨ APR ä¸­çš„ poll æ–¹æ³•, è€Œ APR åˆæ˜¯è°ƒç”¨äº†æ“ä½œç³»ç»Ÿçš„ epoll API æ¥å®ç°çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™é‡Œæœ‰ä¸ªç‰¹åˆ«çš„åœ°æ–¹æ˜¯åœ¨ AprEndpoint ä¸­, å¯ä»¥é…ç½®ä¸€ä¸ªå« "),t("code",[s._v("deferAccept")]),s._v("â€‹ çš„å‚æ•°, å®ƒå¯¹åº”çš„æ˜¯ TCP åè®®ä¸­çš„"),t("code",[s._v("TCP_DEFER_ACCEPT")]),s._v("â€‹, è®¾ç½®è¿™ä¸ªå‚æ•°å, å½“ TCP å®¢æˆ·ç«¯æœ‰æ–°çš„è¿æ¥è¯·æ±‚åˆ°è¾¾æ—¶, "),t("strong",[s._v("TCP æœåŠ¡ç«¯å…ˆä¸å»ºç«‹è¿æ¥, è€Œæ˜¯å†ç­‰ç­‰, ç›´åˆ°å®¢æˆ·ç«¯æœ‰è¯·æ±‚æ•°æ®å‘è¿‡æ¥æ—¶å†å»ºç«‹è¿æ¥. è¿™æ ·çš„å¥½å¤„æ˜¯æœåŠ¡ç«¯ä¸éœ€è¦ç”¨ Selector å»åå¤æŸ¥è¯¢è¯·æ±‚æ•°æ®æ˜¯å¦å°±ç»ª")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ˜¯ä¸€ç§ TCP åè®®å±‚çš„ä¼˜åŒ–, ä¸æ˜¯æ¯ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸éƒ½æ”¯æŒ, å› ä¸º Java ä½œä¸ºä¸€ç§è·¨å¹³å°è¯­è¨€, éœ€è¦å±è”½å„ç§æ“ä½œç³»ç»Ÿçš„å·®å¼‚, å› æ­¤å¹¶æ²¡æœ‰æŠŠè¿™ä¸ªå‚æ•°æä¾›ç»™ç”¨æˆ·; ä½†æ˜¯å¯¹äº APR æ¥è¯´, å®ƒçš„ç›®çš„å°±æ˜¯å°½å¯èƒ½æå‡æ€§èƒ½, å› æ­¤å®ƒå‘ç”¨æˆ·æš´éœ²äº†è¿™ä¸ªå‚æ•°.")]),s._v(" "),t("h5",{attrs:{id:"apræå‡æ€§èƒ½çš„ç§˜å¯†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apræå‡æ€§èƒ½çš„ç§˜å¯†"}},[s._v("#")]),s._v(" APRæå‡æ€§èƒ½çš„ç§˜å¯†")]),s._v(" "),t("p",[s._v("APR è¿æ¥å™¨ä¹‹æ‰€ä»¥èƒ½æé«˜ Tomcat çš„æ€§èƒ½, é™¤äº† APR æœ¬èº«æ˜¯ C ç¨‹åºåº“ä¹‹å¤–, è¿˜æœ‰å“ªäº›æé€Ÿçš„ç§˜å¯†å‘¢?")]),s._v(" "),t("h6",{attrs:{id:"_1-jvmå †-vs-æœ¬åœ°å†…å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-jvmå †-vs-æœ¬åœ°å†…å­˜"}},[s._v("#")]),s._v(" 1.JVMå † VS æœ¬åœ°å†…å­˜")]),s._v(" "),t("p",[s._v("ç”±äº Java çš„ç±»å®ä¾‹ä¸€èˆ¬åœ¨ JVM å †ä¸Šåˆ†é…, è€Œ Java æ˜¯é€šè¿‡ JNI è°ƒç”¨ C ä»£ç æ¥å®ç° Socket é€šä¿¡çš„, é‚£ä¹ˆ C ä»£ç åœ¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦çš„å†…å­˜åˆæ˜¯ä»å“ªé‡Œåˆ†é…çš„å‘¢? C ä»£ç èƒ½å¦ç›´æ¥æ“ä½œ Java å †?")]),s._v(" "),t("p",[s._v("ä¸ºäº†å›ç­”è¿™äº›é—®é¢˜, å…ˆæ¥è¯´è¯´ "),t("strong",[s._v("JVM å’Œç”¨æˆ·è¿›ç¨‹")]),s._v("çš„å…³ç³». å¦‚æœä½ æƒ³è¿è¡Œä¸€ä¸ª Java ç±»æ–‡ä»¶, å¯ä»¥ç”¨ä¸‹é¢çš„ Java å‘½ä»¤æ¥æ‰§è¡Œ.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("java my.class\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªå‘½ä»¤è¡Œä¸­çš„ "),t("code",[s._v("java")]),s._v("â€‹ å…¶å®æ˜¯"),t("strong",[s._v("ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº, è¿™ä¸ªç¨‹åºä¼šåˆ›å»º JVM æ¥åŠ è½½å’Œè¿è¡Œ Java ç±»")]),s._v(". æ“ä½œç³»ç»Ÿä¼š"),t("strong",[s._v("åˆ›å»ºä¸€ä¸ªè¿›ç¨‹")]),s._v("æ¥æ‰§è¡Œè¿™ä¸ª "),t("code",[s._v("java")]),s._v("â€‹ å¯æ‰§è¡Œç¨‹åº, è€Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„"),t("strong",[s._v("è™šæ‹Ÿåœ°å€ç©ºé—´, JVM ç”¨åˆ°çš„å†…å­˜(åŒ…æ‹¬å †, æ ˆå’Œæ–¹æ³•åŒº)å°±æ˜¯ä»è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸Šåˆ†é…çš„")]),s._v(". è¯·æ³¨æ„, JVM å†…å­˜åªæ˜¯è¿›ç¨‹ç©ºé—´çš„ä¸€éƒ¨åˆ†, é™¤æ­¤ä¹‹å¤–è¿›ç¨‹ç©ºé—´å†…è¿˜æœ‰ä»£ç æ®µ, æ•°æ®æ®µ, å†…å­˜æ˜ å°„åŒº, å†…æ ¸ç©ºé—´ç­‰. ä» JVM çš„è§’åº¦çœ‹, JVM å†…å­˜ä¹‹å¤–çš„éƒ¨åˆ†å«ä½œæœ¬åœ°å†…å­˜, C ç¨‹åºä»£ç åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç”¨åˆ°çš„å†…å­˜å°±æ˜¯æœ¬åœ°å†…å­˜ä¸­åˆ†é…çš„. ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£ä¸€ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161350-v6dugwu.jpg",alt:""}})]),s._v(" "),t("p",[s._v("Tomcat çš„ Endpoint ç»„ä»¶åœ¨æ¥æ”¶ç½‘ç»œæ•°æ®æ—¶éœ€è¦é¢„å…ˆåˆ†é…å¥½ä¸€å— Buffer, æ‰€è°“çš„ Buffer å°±æ˜¯å­—èŠ‚æ•°ç»„ "),t("code",[s._v("byte[]")]),s._v("â€‹, Java "),t("strong",[s._v("é€šè¿‡ JNI è°ƒç”¨æŠŠè¿™å— Buffer çš„åœ°å€ä¼ ç»™ C ä»£ç , C ä»£ç é€šè¿‡æ“ä½œç³»ç»Ÿ API è¯»å– Socket å¹¶æŠŠæ•°æ®å¡«å……åˆ°è¿™å— Buffer")]),s._v(". Java NIO API æä¾›äº†ä¸¤ç§ Buffer æ¥æ¥æ”¶æ•°æ®: HeapByteBuffer å’Œ DirectByteBuffer, ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸¤ç§ Buffer.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ†é… HeapByteBuffer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" buf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("allocate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ†é… DirectByteBuffer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" buf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("allocateDirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("åˆ›å»ºå¥½ Buffer åç›´æ¥ä¼ ç»™ Channel çš„ read æˆ–è€… write å‡½æ•°, æœ€ç»ˆè¿™å— Buffer ä¼šé€šè¿‡ JNI è°ƒç”¨ä¼ é€’ç»™ C ç¨‹åº.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°† buf ä½œä¸º read å‡½æ•°çš„å‚æ•°")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" bytesRead "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" socketChannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("é‚£ HeapByteBuffer å’Œ DirectByteBuffer æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢? HeapByteBuffer å¯¹è±¡æœ¬èº«åœ¨ JVM å †ä¸Šåˆ†é…, å¹¶ä¸”å®ƒæŒæœ‰çš„å­—èŠ‚æ•°ç»„ "),t("code",[s._v("byte[]")]),s._v("â€‹ ä¹Ÿæ˜¯åœ¨ JVM å †ä¸Šåˆ†é…. ä½†æ˜¯å¦‚æœç”¨ **HeapByteBuffer ** æ¥æ¥æ”¶ç½‘ç»œæ•°æ®, "),t("strong",[s._v("éœ€è¦æŠŠæ•°æ®ä»å†…æ ¸å…ˆæ‹·è´åˆ°ä¸€ä¸ªä¸´æ—¶çš„æœ¬åœ°å†…å­˜, å†ä»ä¸´æ—¶æœ¬åœ°å†…å­˜æ‹·è´åˆ° JVM å †")]),s._v(", è€Œä¸æ˜¯ç›´æ¥ä»å†…æ ¸æ‹·è´åˆ° JVM å †ä¸Š. è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? è¿™æ˜¯å› ä¸ºæ•°æ®ä»å†…æ ¸æ‹·è´åˆ° JVM å †çš„è¿‡ç¨‹ä¸­, JVM å¯èƒ½ä¼šå‘ç”Ÿ GC, GC è¿‡ç¨‹ä¸­å¯¹è±¡å¯èƒ½ä¼šè¢«ç§»åŠ¨, ä¹Ÿå°±æ˜¯è¯´ JVM å †ä¸Šçš„å­—èŠ‚æ•°ç»„å¯èƒ½ä¼šè¢«ç§»åŠ¨, è¿™æ ·çš„è¯ Buffer åœ°å€å°±å¤±æ•ˆäº†. å¦‚æœè¿™ä¸­é—´ç»è¿‡æœ¬åœ°å†…å­˜ä¸­è½¬, ä»æœ¬åœ°å†…å­˜åˆ° JVM å †çš„æ‹·è´è¿‡ç¨‹ä¸­ JVM å¯ä»¥ä¿è¯ä¸åš GC.")]),s._v(" "),t("p",[s._v("å¦‚æœä½¿ç”¨ HeapByteBuffer, é‚£ä¹ˆ JVM å †å’Œå†…æ ¸ä¹‹é—´å¤šäº†ä¸€å±‚ä¸­è½¬, è€Œ DirectByteBuffer å¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜, "),t("strong",[s._v("DirectByteBuffer å¯¹è±¡æœ¬èº«åœ¨ JVM å †ä¸Š, ä½†æ˜¯å®ƒæŒæœ‰çš„å­—èŠ‚æ•°ç»„ä¸æ˜¯ä» JVM å †ä¸Šåˆ†é…çš„, è€Œæ˜¯ä»æœ¬åœ°å†…å­˜åˆ†é…çš„")]),s._v(". DirectByteBuffer å¯¹è±¡ä¸­æœ‰ä¸ª long ç±»å‹å­—æ®µ address, è®°å½•ç€æœ¬åœ°å†…å­˜çš„åœ°å€, è¿™æ ·åœ¨æ¥æ”¶æ•°æ®çš„æ—¶å€™, ç›´æ¥æŠŠè¿™ä¸ªæœ¬åœ°å†…å­˜åœ°å€ä¼ é€’ç»™ C ç¨‹åº, C ç¨‹åºä¼šå°†ç½‘ç»œæ•°æ®ä»å†…æ ¸æ‹·è´åˆ°è¿™ä¸ªæœ¬åœ°å†…å­˜, JVM å¯ä»¥ç›´æ¥è¯»å–è¿™ä¸ªæœ¬åœ°å†…å­˜, è¿™ç§æ–¹å¼æ¯” HeapByteBuffer "),t("strong",[s._v("å°‘äº†ä¸€æ¬¡æ‹·è´")]),s._v(", å› æ­¤ä¸€èˆ¬æ¥è¯´å®ƒçš„é€Ÿåº¦ä¼šæ¯” HeapByteBuffer å¿«å¥½å‡ å€. å¯ä»¥é€šè¿‡ä¸Šé¢çš„å›¾åŠ æ·±ç†è§£.")]),s._v(" "),t("p",[t("strong",[s._v("Tomcat ä¸­çš„ AprEndpoint å°±æ˜¯é€šè¿‡ DirectByteBuffer æ¥æ¥æ”¶æ•°æ®çš„, è€Œ NioEndpoint å’Œ Nio2Endpoint æ˜¯é€šè¿‡ HeapByteBuffer æ¥æ¥æ”¶æ•°æ®çš„")]),s._v(". ä½ å¯èƒ½ä¼šé—®, NioEndpoint å’Œ Nio2Endpoint ä¸ºä»€ä¹ˆä¸ç”¨ DirectByteBuffer å‘¢? è¿™æ˜¯å› ä¸ºæœ¬åœ°å†…å­˜ä¸å¥½ç®¡ç†, å‘ç”Ÿå†…å­˜æ³„æ¼éš¾ä»¥å®šä½, ä»ç¨³å®šæ€§è€ƒè™‘, NioEndpoint å’Œ Nio2Endpoint æ²¡æœ‰å»å†’è¿™ä¸ªé™©.")]),s._v(" "),t("h6",{attrs:{id:"_2-sendfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-sendfile"}},[s._v("#")]),s._v(" 2.sendfile")]),s._v(" "),t("p",[s._v("å†æ¥è€ƒè™‘å¦ä¸€ä¸ªç½‘ç»œé€šä¿¡çš„åœºæ™¯, ä¹Ÿå°±æ˜¯é™æ€æ–‡ä»¶çš„å¤„ç†. æµè§ˆå™¨é€šè¿‡ Tomcat æ¥è·å–ä¸€ä¸ª HTML æ–‡ä»¶, è€Œ Tomcat çš„å¤„ç†é€»è¾‘æ— éæ˜¯ä¸¤æ­¥:")]),s._v(" "),t("ol",[t("li",[s._v("ä»ç£ç›˜è¯»å– HTML åˆ°å†…å­˜.")]),s._v(" "),t("li",[s._v("å°†è¿™æ®µå†…å­˜çš„å†…å®¹é€šè¿‡ Socket å‘é€å‡ºå».")])]),s._v(" "),t("p",[s._v("ä½†æ˜¯åœ¨ä¼ ç»Ÿæ–¹å¼ä¸‹, "),t("strong",[s._v("æœ‰å¾ˆå¤šæ¬¡çš„å†…å­˜æ‹·è´")]),s._v(":")]),s._v(" "),t("ul",[t("li",[s._v("è¯»å–æ–‡ä»¶æ—¶, é¦–å…ˆæ˜¯å†…æ ¸æŠŠæ–‡ä»¶å†…å®¹è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒº.")]),s._v(" "),t("li",[s._v("å¦‚æœä½¿ç”¨ HeapByteBuffer, æ–‡ä»¶æ•°æ®ä»å†…æ ¸åˆ° JVM å †å†…å­˜éœ€è¦ç»è¿‡æœ¬åœ°å†…å­˜ä¸­è½¬.")]),s._v(" "),t("li",[s._v("åŒæ ·åœ¨å°†æ–‡ä»¶å†…å®¹æ¨å…¥ç½‘ç»œæ—¶, ä» JVM å †åˆ°å†…æ ¸ç¼“å†²åŒºéœ€è¦ç»è¿‡æœ¬åœ°å†…å­˜ä¸­è½¬.")]),s._v(" "),t("li",[s._v("æœ€åè¿˜éœ€è¦æŠŠæ–‡ä»¶ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç½‘å¡ç¼“å†²åŒº.")])]),s._v(" "),t("p",[s._v("ä»ä¸‹é¢çš„å›¾å¯çŸ¥è¿™ä¸ªè¿‡ç¨‹æœ‰ 6 æ¬¡å†…å­˜æ‹·è´, å¹¶ä¸” read å’Œ write ç­‰ç³»ç»Ÿè°ƒç”¨å°†å¯¼è‡´è¿›ç¨‹ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢, ä¼šè€—è´¹å¤§é‡çš„ CPU å’Œå†…å­˜èµ„æº.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161350-4yleyiz.jpg",alt:""}})]),s._v(" "),t("p",[s._v("è€Œ Tomcat çš„ AprEndpoint é€šè¿‡"),t("strong",[s._v("æ“ä½œç³»ç»Ÿå±‚é¢çš„ sendfile ç‰¹æ€§")]),s._v("è§£å†³äº†è¿™ä¸ªé—®é¢˜, sendfile ç³»ç»Ÿè°ƒç”¨æ–¹å¼éå¸¸ç®€æ´.")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendfile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å®ƒå¸¦æœ‰ä¸¤ä¸ªå…³é”®å‚æ•°: "),t("strong",[s._v("Socket å’Œæ–‡ä»¶å¥æŸ„")]),s._v(". å°†æ–‡ä»¶ä»ç£ç›˜å†™å…¥ Socket çš„è¿‡ç¨‹åªæœ‰ä¸¤æ­¥:")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€æ­¥: å°†æ–‡ä»¶å†…å®¹è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒº.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒæ­¥: æ•°æ®å¹¶æ²¡æœ‰ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ° Socket å…³è”çš„ç¼“å†²åŒº, åªæœ‰è®°å½•æ•°æ®ä½ç½®å’Œé•¿åº¦çš„æè¿°ç¬¦è¢«æ·»åŠ åˆ° Socket ç¼“å†²åŒºä¸­; æ¥ç€æŠŠæ•°æ®ç›´æ¥ä»å†…æ ¸ç¼“å†²åŒºä¼ é€’ç»™ç½‘å¡. è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹ä¸‹é¢çš„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161350-6dxzoz5.jpg",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-4"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("å¯¹äºä¸€äº›éœ€è¦é¢‘ç¹ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„åœºæ™¯, æ¯”å¦‚ç½‘ç»œé€šä¿¡, Java çš„æ•ˆç‡æ²¡æœ‰ C è¯­è¨€é«˜, ç‰¹åˆ«æ˜¯ TLS åè®®æ¡æ‰‹è¿‡ç¨‹ä¸­éœ€è¦å¤šæ¬¡ç½‘ç»œäº¤äº’, è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ APR æœ¬åœ°åº“èƒ½å¤Ÿæ˜¾è‘—æå‡æ€§èƒ½.")]),s._v(" "),t("p",[s._v("é™¤æ­¤ä¹‹å¤–, APR æå‡æ€§èƒ½çš„ç§˜å¯†è¿˜æœ‰: é€šè¿‡ DirectByteBuffer é¿å…äº† JVM å †ä¸æœ¬åœ°å†…å­˜ä¹‹é—´çš„å†…å­˜æ‹·è´; é€šè¿‡ sendfile ç‰¹æ€§é¿å…äº†å†…æ ¸ä¸åº”ç”¨ä¹‹é—´çš„å†…å­˜æ‹·è´ä»¥åŠç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢. å…¶å®å¾ˆå¤šé«˜æ€§èƒ½ç½‘ç»œé€šä¿¡ç»„ä»¶, æ¯”å¦‚ Netty, éƒ½æ˜¯é€šè¿‡ DirectByteBuffer æ¥æ”¶å‘ç½‘ç»œæ•°æ®çš„. ç”±äºæœ¬åœ°å†…å­˜éš¾äºç®¡ç†, Netty é‡‡ç”¨äº†æœ¬åœ°å†…å­˜æ± æŠ€æœ¯.")]),s._v(" "),t("h4",{attrs:{id:"_17-executorç»„ä»¶-tomcatå¦‚ä½•æ‰©å±•javaçº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_17-executorç»„ä»¶-tomcatå¦‚ä½•æ‰©å±•javaçº¿ç¨‹æ± "}},[s._v("#")]),s._v(" 17.Executorç»„ä»¶:Tomcatå¦‚ä½•æ‰©å±•Javaçº¿ç¨‹æ± ?")]),s._v(" "),t("p",[s._v('åœ¨å¼€å‘ä¸­ç»å¸¸ä¼šç¢°åˆ°"æ± "çš„æ¦‚å¿µ, æ¯”å¦‚æ•°æ®åº“è¿æ¥æ± , å†…å­˜æ± , çº¿ç¨‹æ± , å¸¸é‡æ± ç­‰. ä¸ºä»€ä¹ˆéœ€è¦â€œæ± â€å‘¢? ç¨‹åºè¿è¡Œçš„æœ¬è´¨, å°±æ˜¯é€šè¿‡ä½¿ç”¨ç³»ç»Ÿèµ„æº(CPU, å†…å­˜, ç½‘ç»œ, ç£ç›˜ç­‰)æ¥å®Œæˆä¿¡æ¯çš„å¤„ç†, æ¯”å¦‚åœ¨ JVM ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹éœ€è¦æ¶ˆè€— CPU å’Œå†…å­˜èµ„æº, å¦‚æœä½ çš„ç¨‹åºéœ€è¦é¢‘ç¹åˆ›å»ºå¤§é‡çš„å¯¹è±¡, å¹¶ä¸”è¿™äº›å¯¹è±¡çš„å­˜æ´»æ—¶é—´çŸ­, å°±æ„å‘³ç€éœ€è¦è¿›è¡Œé¢‘ç¹é”€æ¯, é‚£ä¹ˆå¾ˆæœ‰å¯èƒ½è¿™éƒ¨åˆ†ä»£ç ä¼šæˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆ.')]),s._v(" "),t("p",[s._v('è€Œ"æ± "å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„, ç®€å•æ¥è¯´, å¯¹è±¡æ± å°±æ˜¯æŠŠç”¨è¿‡çš„å¯¹è±¡ä¿å­˜èµ·æ¥, ç­‰ä¸‹ä¸€æ¬¡éœ€è¦è¿™ç§å¯¹è±¡çš„æ—¶å€™, ç›´æ¥ä»å¯¹è±¡æ± ä¸­æ‹¿å‡ºæ¥é‡å¤ä½¿ç”¨, é¿å…é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯. åœ¨ Java ä¸­ä¸‡ç‰©çš†å¯¹è±¡, çº¿ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡, Java çº¿ç¨‹æ˜¯å¯¹æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„å°è£…, åˆ›å»º Java çº¿ç¨‹ä¹Ÿéœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æº, å› æ­¤å°±æœ‰äº†çº¿ç¨‹æ± . JDK ä¸­æä¾›äº†çº¿ç¨‹æ± çš„é»˜è®¤å®ç°, ä¹Ÿå¯ä»¥é€šè¿‡æ‰©å±• Java åŸç”Ÿçº¿ç¨‹æ± æ¥å®ç°è‡ªå·±çš„çº¿ç¨‹æ± .')]),s._v(" "),t("p",[s._v("åŒæ ·, ä¸ºäº†æé«˜å¤„ç†èƒ½åŠ›å’Œå¹¶å‘åº¦, Web å®¹å™¨ä¸€èˆ¬ä¼šæŠŠ"),t("strong",[s._v("å¤„ç†è¯·æ±‚çš„å·¥ä½œæ”¾åˆ°çº¿ç¨‹æ± é‡Œ")]),s._v("æ¥æ‰§è¡Œ, Tomcat æ‰©å±•äº†åŸç”Ÿçš„ Java çº¿ç¨‹æ± , æ¥æ»¡è¶³ Web å®¹å™¨é«˜å¹¶å‘çš„éœ€æ±‚, ä¸‹é¢å°±æ¥å­¦ä¹ ä¸€ä¸‹ Java çº¿ç¨‹æ± çš„åŸç†, ä»¥åŠ Tomcat æ˜¯å¦‚ä½•æ‰©å±• Java çº¿ç¨‹æ± çš„.")]),s._v(" "),t("h5",{attrs:{id:"javaçº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javaçº¿ç¨‹æ± "}},[s._v("#")]),s._v(" Javaçº¿ç¨‹æ± ")]),s._v(" "),t("p",[s._v("ç®€å•çš„è¯´, Java çº¿ç¨‹æ± é‡Œå†…éƒ¨ç»´æŠ¤ä¸€ä¸ª"),t("strong",[s._v("çº¿ç¨‹æ•°ç»„å’Œä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—")]),s._v(", å½“ä»»åŠ¡å¤„ç†ä¸è¿‡æ¥çš„æ—¶, å°±æŠŠä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—é‡Œæ…¢æ…¢å¤„ç†.")]),s._v(" "),t("h6",{attrs:{id:"_1-threadpoolexecutor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-threadpoolexecutor"}},[s._v("#")]),s._v(" 1.ThreadPoolExecutor")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹çœ‹ Java çº¿ç¨‹æ± æ ¸å¿ƒç±» ThreadPoolExecutor çš„æ„é€ å‡½æ•°, éœ€è¦çŸ¥é“ ThreadPoolExecutor æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›å‚æ•°çš„, è¿™æ˜¯ç†è§£ Java çº¿ç¨‹å·¥ä½œåŸç†çš„å…³é”®.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maximumPoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" keepAliveTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadFactory")]),s._v(" threadFactory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RejectedExecutionHandler")]),s._v(" handler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("æ¯æ¬¡æäº¤ä»»åŠ¡æ—¶, å¦‚æœçº¿ç¨‹æ•°è¿˜æ²¡è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•° "),t("strong",[s._v("corePoolSize")]),s._v(", çº¿ç¨‹æ± å°±åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œ. å½“çº¿ç¨‹æ•°è¾¾åˆ° **corePoolSize ** å, æ–°å¢çš„ä»»åŠ¡å°±æ”¾åˆ°å·¥ä½œé˜Ÿåˆ— **workQueue ** é‡Œ, è€Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ™åŠªåŠ›åœ°ä» **workQueue ** é‡Œæ‹‰æ´»æ¥å¹², ä¹Ÿå°±æ˜¯è°ƒç”¨ poll æ–¹æ³•æ¥è·å–ä»»åŠ¡.")]),s._v(" "),t("p",[s._v("å¦‚æœä»»åŠ¡å¾ˆå¤š, å¹¶ä¸” "),t("strong",[s._v("workQueue ** æ˜¯ä¸ªæœ‰ç•Œé˜Ÿåˆ—, é˜Ÿåˆ—å¯èƒ½ä¼šæ»¡, æ­¤æ—¶çº¿ç¨‹æ± å°±ä¼š")]),s._v("ç´§æ€¥åˆ›å»ºæ–°çš„ä¸´æ—¶çº¿ç¨‹**æ¥æ•‘åœº, å¦‚æœæ€»çš„çº¿ç¨‹æ•°è¾¾åˆ°äº†æœ€å¤§çº¿ç¨‹æ•° "),t("strong",[s._v("maximumPoolSize")]),s._v(", åˆ™ä¸èƒ½å†åˆ›å»ºæ–°çš„ä¸´æ—¶çº¿ç¨‹äº†, è½¬è€Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ "),t("strong",[s._v("handler")]),s._v(", æ¯”å¦‚æŠ›å‡ºå¼‚å¸¸æˆ–è€…ç”±è°ƒç”¨è€…çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ç­‰.")]),s._v(" "),t("p",[s._v("å¦‚æœé«˜å³°è¿‡å»äº†, çº¿ç¨‹æ± æ¯”è¾ƒé—²äº†æ€ä¹ˆåŠ? ä¸´æ—¶çº¿ç¨‹ä½¿ç”¨ poll("),t("strong",[s._v("keepAliveTime, unit")]),s._v(") æ–¹æ³•ä»å·¥ä½œé˜Ÿåˆ—ä¸­æ‹‰æ´»å¹², è¯·æ³¨æ„ poll æ–¹æ³•è®¾ç½®äº†è¶…æ—¶æ—¶é—´, å¦‚æœè¶…æ—¶äº†ä»ç„¶ä¸¤æ‰‹ç©ºç©ºæ²¡æ‹‰åˆ°æ´», è¡¨æ˜å®ƒå¤ªé—²äº†, è¿™ä¸ªçº¿ç¨‹ä¼šè¢«é”€æ¯å›æ”¶.")]),s._v(" "),t("p",[s._v("é‚£è¿˜æœ‰ä¸€ä¸ªå‚æ•° "),t("strong",[s._v("threadFactory ** æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢? é€šè¿‡å®ƒä½ å¯ä»¥")]),s._v("æ‰©å±•åŸç”Ÿçš„çº¿ç¨‹å·¥å‚**, æ¯”å¦‚ç»™åˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹å–ä¸ªæœ‰æ„ä¹‰çš„åå­—.")]),s._v(" "),t("h6",{attrs:{id:"_2-fixedthreadpool-cachedthreadpool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-fixedthreadpool-cachedthreadpool"}},[s._v("#")]),s._v(" 2.FixedThreadPool/CachedThreadPool")]),s._v(" "),t("p",[s._v("Java æä¾›äº†ä¸€äº›é»˜è®¤çš„çº¿ç¨‹æ± å®ç°, æ¯”å¦‚ FixedThreadPool å’Œ CachedThreadPool, å®ƒä»¬çš„æœ¬è´¨å°±æ˜¯ç»™ ThreadPoolExecutor è®¾ç½®äº†ä¸åŒçš„å‚æ•°, æ˜¯å®šåˆ¶ç‰ˆçš„ ThreadPoolExecutor.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" nThreads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nThreads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nThreads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MILLISECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCachedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAX_VALUE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SynchronousQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("FixedThreadPool æœ‰å›ºå®šé•¿åº¦(nThreads)çš„çº¿ç¨‹æ•°ç»„")]),s._v(", å¿™ä¸è¿‡æ¥æ—¶ä¼šæŠŠä»»åŠ¡æ”¾åˆ°æ— é™é•¿çš„é˜Ÿåˆ—é‡Œ, è¿™æ˜¯å› ä¸º"),t("strong",[s._v("LinkedBlockingQueue é»˜è®¤æ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("CachedThreadPool çš„ maximumPoolSize å‚æ•°å€¼æ˜¯")]),s._v("â€‹"),t("strong",[s._v("â€‹"),t("code",[s._v("Integer.MAX_VALUE")]),s._v("â€‹")]),s._v("â€‹, å› æ­¤å®ƒå¯¹çº¿ç¨‹ä¸ªæ•°ä¸åšé™åˆ¶, å¿™ä¸è¿‡æ¥æ—¶æ— é™åˆ›å»ºä¸´æ—¶çº¿ç¨‹, é—²ä¸‹æ¥æ—¶å†å›æ”¶. å®ƒçš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯ "),t("strong",[s._v("SynchronousQueue")]),s._v(", è¡¨æ˜é˜Ÿåˆ—é•¿åº¦ä¸º 0.")])]),s._v(" "),t("h5",{attrs:{id:"tomcatçº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatçº¿ç¨‹æ± "}},[s._v("#")]),s._v(" Tomcatçº¿ç¨‹æ± ")]),s._v(" "),t("p",[s._v("è·Ÿ FixedThreadPool/CachedThreadPool ä¸€æ ·, Tomcat çš„çº¿ç¨‹æ± ä¹Ÿæ˜¯ä¸€ä¸ª"),t("strong",[s._v("å®šåˆ¶ç‰ˆçš„ ThreadPoolExecutor")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_1-å®šåˆ¶ç‰ˆçš„threadpoolexecutor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å®šåˆ¶ç‰ˆçš„threadpoolexecutor"}},[s._v("#")]),s._v(" 1.å®šåˆ¶ç‰ˆçš„ThreadPoolExecutor")]),s._v(" "),t("p",[s._v("é€šè¿‡æ¯”è¾ƒ FixedThreadPool å’Œ CachedThreadPool, å¯ä»¥å‘ç°å®ƒä»¬ä¼ ç»™ ThreadPoolExecutor çš„å‚æ•°æœ‰ä¸¤ä¸ªå…³é”®ç‚¹:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("**æ˜¯å¦é™åˆ¶çº¿ç¨‹ä¸ªæ•°. **")])]),s._v(" "),t("li",[t("p",[s._v("**æ˜¯å¦é™åˆ¶é˜Ÿåˆ—é•¿åº¦. **")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code")]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"})])])]),s._v(" "),t("p",[s._v("å¯¹äº Tomcat æ¥è¯´, è¿™ä¸¤ä¸ªèµ„æºéƒ½éœ€è¦é™åˆ¶, ä¹Ÿå°±æ˜¯è¯´è¦å¯¹é«˜å¹¶å‘è¿›è¡Œæ§åˆ¶, å¦åˆ™ CPU å’Œå†…å­˜æœ‰èµ„æºè€—å°½çš„é£é™©. å› æ­¤ Tomcat ä¼ å…¥çš„å‚æ•°æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šåˆ¶ç‰ˆçš„ä»»åŠ¡é˜Ÿåˆ—")]),s._v("\ntaskqueue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxQueueSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šåˆ¶ç‰ˆçš„çº¿ç¨‹å·¥å‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskThreadFactory")]),s._v(" tf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskThreadFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namePrefix"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" daemon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getThreadPriority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šåˆ¶ç‰ˆçš„çº¿ç¨‹æ± ")]),s._v("\nexecutor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMinSpareThreads")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                                  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMaxThreads")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                                  maxIdleTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                                  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MILLISECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  taskqueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                                  tf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„ä¸¤ä¸ªå…³é”®ç‚¹:")]),s._v(" "),t("ul",[t("li",[s._v("Tomcat æœ‰è‡ªå·±çš„å®šåˆ¶ç‰ˆä»»åŠ¡é˜Ÿåˆ—å’Œçº¿ç¨‹å·¥å‚, å¹¶ä¸”å¯ä»¥é™åˆ¶ä»»åŠ¡é˜Ÿåˆ—çš„é•¿åº¦, å®ƒçš„"),t("strong",[s._v("æœ€å¤§é•¿åº¦æ˜¯ maxQueueSize")]),s._v(".")]),s._v(" "),t("li",[s._v("Tomcat å¯¹çº¿ç¨‹æ•°ä¹Ÿæœ‰é™åˆ¶, è®¾ç½®äº†"),t("strong",[s._v("æ ¸å¿ƒçº¿ç¨‹æ•°(minSpareThreads)å’Œæœ€å¤§çº¿ç¨‹æ± æ•°(maxThreads)")]),s._v(" .")])]),s._v(" "),t("p",[s._v("é™¤äº†èµ„æºé™åˆ¶ä»¥å¤–, Tomcat çº¿ç¨‹æ± è¿˜å®šåˆ¶è‡ªå·±çš„ä»»åŠ¡å¤„ç†æµç¨‹. Java åŸç”Ÿçº¿ç¨‹æ± çš„ä»»åŠ¡å¤„ç†é€»è¾‘æ¯”è¾ƒç®€å•:")]),s._v(" "),t("ol",[t("li",[s._v("å‰ corePoolSize ä¸ªä»»åŠ¡æ—¶, æ¥ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹.")]),s._v(" "),t("li",[s._v("åé¢å†æ¥ä»»åŠ¡, å°±æŠŠä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—é‡Œè®©æ‰€æœ‰çš„çº¿ç¨‹å»æŠ¢, å¦‚æœé˜Ÿåˆ—æ»¡äº†å°±åˆ›å»ºä¸´æ—¶çº¿ç¨‹.")]),s._v(" "),t("li",[s._v("å¦‚æœæ€»çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSize, **æ‰§è¡Œæ‹’ç»ç­–ç•¥. **")])]),s._v(" "),t("p",[s._v("Tomcat çº¿ç¨‹æ± æ‰©å±•äº†åŸç”Ÿçš„ ThreadPoolExecutor, é€šè¿‡"),t("strong",[s._v("é‡å†™ execute() æ–¹æ³•å®ç°äº†è‡ªå·±çš„ä»»åŠ¡å¤„ç†é€»è¾‘")]),s._v(":")]),s._v(" "),t("ol",[t("li",[s._v("å‰ corePoolSize ä¸ªä»»åŠ¡æ—¶, æ¥ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹.")]),s._v(" "),t("li",[s._v("å†æ¥ä»»åŠ¡çš„è¯, å°±æŠŠä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—é‡Œè®©æ‰€æœ‰çš„çº¿ç¨‹å»æŠ¢, å¦‚æœé˜Ÿåˆ—æ»¡äº†å°±åˆ›å»ºä¸´æ—¶çº¿ç¨‹.")]),s._v(" "),t("li",[s._v("å¦‚æœæ€»çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSize, **åˆ™ç»§ç»­å°è¯•æŠŠä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­å». **")]),s._v(" "),t("li",[s._v("**å¦‚æœç¼“å†²é˜Ÿåˆ—ä¹Ÿæ»¡äº†, æ’å…¥å¤±è´¥, æ‰§è¡Œæ‹’ç»ç­–ç•¥. **")])]),s._v(" "),t("p",[s._v("è§‚å¯Ÿ Tomcat çº¿ç¨‹æ± å’Œ Java åŸç”Ÿçº¿ç¨‹æ± çš„åŒºåˆ«, å…¶å®å°±æ˜¯åœ¨ç¬¬ 3 æ­¥, Tomcat åœ¨çº¿ç¨‹æ€»æ•°è¾¾åˆ°æœ€å¤§æ•°æ—¶, ä¸æ˜¯ç«‹å³æ‰§è¡Œæ‹’ç»ç­–ç•¥, è€Œæ˜¯å†å°è¯•å‘ä»»åŠ¡é˜Ÿåˆ—æ·»åŠ ä»»åŠ¡, æ·»åŠ å¤±è´¥åå†æ‰§è¡Œæ‹’ç»ç­–ç•¥. é‚£å…·ä½“å¦‚ä½•å®ç°å‘¢, å…¶å®å¾ˆç®€å•, æ¥çœ‹ä¸€ä¸‹ Tomcat çº¿ç¨‹æ± çš„ execute() æ–¹æ³•çš„æ ¸å¿ƒä»£ç .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("concurrent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("ThreadPoolExecutor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      submittedCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨ Java åŸç”Ÿçº¿ç¨‹æ± çš„ execute å»æ‰§è¡Œä»»åŠ¡")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RejectedExecutionException")]),s._v(" rx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ€»çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSize, Java åŸç”Ÿçº¿ç¨‹æ± æ‰§è¡Œæ‹’ç»ç­–ç•¥")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskQueue")]),s._v(" queue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»§ç»­å°è¯•æŠŠä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­å»")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("force")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                      submittedCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœç¼“å†²é˜Ÿåˆ—ä¹Ÿæ»¡äº†, æ’å…¥å¤±è´¥, æ‰§è¡Œæ‹’ç»ç­–ç•¥. ")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RejectedExecutionException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("ä»è¿™ä¸ªæ–¹æ³•å¯ä»¥çœ‹åˆ°, Tomcat çº¿ç¨‹æ± çš„ execute() æ–¹æ³•ä¼šè°ƒç”¨ Java åŸç”Ÿçº¿ç¨‹æ± çš„ execute() å»æ‰§è¡Œä»»åŠ¡, å¦‚æœæ€»çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSize, Java åŸç”Ÿçº¿ç¨‹æ± çš„ execute() æ–¹æ³•ä¼šæŠ›å‡º RejectedExecutionException å¼‚å¸¸, ä½†æ˜¯è¿™ä¸ªå¼‚å¸¸ä¼šè¢« Tomcat çº¿ç¨‹æ± çš„ execute() æ–¹æ³•æ•è·åˆ°, å¹¶ç»§ç»­å°è¯•æŠŠè¿™ä¸ªä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­å»; å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†, å†æ‰§è¡Œæ‹’ç»ç­–ç•¥.")]),s._v(" "),t("h6",{attrs:{id:"_2-å®šåˆ¶ç‰ˆçš„ä»»åŠ¡é˜Ÿåˆ—"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å®šåˆ¶ç‰ˆçš„ä»»åŠ¡é˜Ÿåˆ—"}},[s._v("#")]),s._v(" 2.å®šåˆ¶ç‰ˆçš„ä»»åŠ¡é˜Ÿåˆ—")]),s._v(" "),t("p",[s._v("ç»†å¿ƒçš„ä½ æœ‰æ²¡æœ‰å‘ç°, åœ¨ Tomcat çº¿ç¨‹æ± çš„ execute() æ–¹æ³•æœ€å¼€å§‹æœ‰è¿™ä¹ˆä¸€è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("submittedCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™è¡Œä»£ç çš„æ„æ€æŠŠ submittedCount è¿™ä¸ªåŸå­å˜é‡åŠ ä¸€, å¹¶ä¸”åœ¨ä»»åŠ¡æ‰§è¡Œå¤±è´¥, æŠ›å‡ºæ‹’ç»å¼‚å¸¸æ—¶, å°†è¿™ä¸ªåŸå­å˜é‡å‡ä¸€:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("submittedCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å…¶å® Tomcat çº¿ç¨‹æ± æ˜¯ç”¨è¿™ä¸ª"),t("strong",[s._v("å˜é‡ submittedCount æ¥ç»´æŠ¤å·²ç»æäº¤åˆ°äº†çº¿ç¨‹æ± , ä½†æ˜¯è¿˜æ²¡æœ‰æ‰§è¡Œå®Œçš„ä»»åŠ¡ä¸ªæ•°")]),s._v(". Tomcat ä¸ºä»€ä¹ˆè¦ç»´æŠ¤è¿™ä¸ªå˜é‡å‘¢? è¿™è·Ÿ Tomcat çš„å®šåˆ¶ç‰ˆçš„ä»»åŠ¡é˜Ÿåˆ—æœ‰å…³. Tomcat çš„ä»»åŠ¡é˜Ÿåˆ— TaskQueue æ‰©å±•äº† Java ä¸­çš„ LinkedBlockingQueue, ç”±äº LinkedBlockingQueue é»˜è®¤æƒ…å†µä¸‹é•¿åº¦æ˜¯æ²¡æœ‰é™åˆ¶çš„, é™¤éç»™å®ƒä¸€ä¸ª capacity. å› æ­¤ Tomcat ç»™äº†å®ƒä¸€ä¸ª capacity, TaskQueue çš„æ„é€ å‡½æ•°ä¸­æœ‰ä¸ªæ•´å‹çš„å‚æ•° capacity, TaskQueue å°† capacity ä¼ ç»™çˆ¶ç±» LinkedBlockingQueue çš„æ„é€ å‡½æ•°.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskQueue")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" capacity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("capacity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("è¿™ä¸ª capacity å‚æ•°æ˜¯é€šè¿‡ Tomcat çš„ maxQueueSize å‚æ•°æ¥è®¾ç½®çš„, ä½†é—®é¢˜æ˜¯é»˜è®¤æƒ…å†µä¸‹ maxQueueSize çš„å€¼æ˜¯"),t("code",[s._v("Integer.MAX_VALUE")]),s._v("â€‹, ç­‰äºæ²¡æœ‰é™åˆ¶, è¿™æ ·å°±å¸¦æ¥ä¸€ä¸ªé—®é¢˜: å½“å‰çº¿ç¨‹æ•°è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ä¹‹å, å†æ¥ä»»åŠ¡çš„è¯çº¿ç¨‹æ± ä¼šæŠŠä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—, å¹¶ä¸”æ€»æ˜¯ä¼šæˆåŠŸ, è¿™æ ·æ°¸è¿œä¸ä¼šæœ‰æœºä¼šåˆ›å»ºæ–°çº¿ç¨‹äº†.")]),s._v(" "),t("p",[s._v("ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, TaskQueue é‡å†™äº† LinkedBlockingQueue çš„ offer() æ–¹æ³•, åœ¨åˆé€‚çš„æ—¶æœºè¿”å› false, è¿”å› false è¡¨ç¤ºä»»åŠ¡æ·»åŠ å¤±è´¥, è¿™æ—¶çº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹. é‚£ä»€ä¹ˆæ˜¯åˆé€‚çš„æ—¶æœºå‘¢? çœ‹ä¸‹é¢ offer() æ–¹æ³•çš„æ ¸å¿ƒæºç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskQueue")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n   "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹æ± è°ƒç”¨ä»»åŠ¡é˜Ÿåˆ—çš„æ–¹æ³•æ—¶, å½“å‰çº¿ç¨‹æ•°è‚¯å®šå·²ç»å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°äº†")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("offer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœçº¿ç¨‹æ•°å·²ç»åˆ°äº†æœ€å¤§å€¼, ä¸èƒ½åˆ›å»ºæ–°çº¿ç¨‹äº†, åªèƒ½æŠŠä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—. ")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPoolSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMaximumPoolSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("offer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œåˆ°è¿™é‡Œ, è¡¨æ˜å½“å‰çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°, å¹¶ä¸”å°äºæœ€å¤§çº¿ç¨‹æ•°. ")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¡¨æ˜æ˜¯å¯ä»¥åˆ›å»ºæ–°çº¿ç¨‹çš„, é‚£åˆ°åº•è¦ä¸è¦åˆ›å»ºå‘¢? åˆ†ä¸¤ç§æƒ…å†µ: ")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. å¦‚æœå·²æäº¤çš„ä»»åŠ¡æ•°å°äºå½“å‰çº¿ç¨‹æ•°, è¡¨ç¤ºè¿˜æœ‰ç©ºé—²çº¿ç¨‹, æ— éœ€åˆ›å»ºæ–°çº¿ç¨‹")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSubmittedCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPoolSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("offer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. å¦‚æœå·²æäº¤çš„ä»»åŠ¡æ•°å¤§äºå½“å‰çº¿ç¨‹æ•°, çº¿ç¨‹ä¸å¤Ÿç”¨äº†, è¿”å› false å»åˆ›å»ºæ–°çº¿ç¨‹")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPoolSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMaximumPoolSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é»˜è®¤æƒ…å†µä¸‹æ€»æ˜¯æŠŠä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("offer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("åªæœ‰å½“å‰çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°, å°äºæœ€å¤§çº¿ç¨‹æ•°, å¹¶ä¸”å·²æäº¤çš„ä»»åŠ¡ä¸ªæ•°å¤§äºå½“å‰çº¿ç¨‹æ•°æ—¶, ä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹ä¸å¤Ÿç”¨äº†, ä½†æ˜¯çº¿ç¨‹æ•°åˆæ²¡è¾¾åˆ°æé™, æ‰ä¼šå»åˆ›å»ºæ–°çš„çº¿ç¨‹")]),s._v(". è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Tomcat éœ€è¦ç»´æŠ¤å·²æäº¤ä»»åŠ¡æ•°è¿™ä¸ªå˜é‡, å®ƒçš„ç›®çš„å°±æ˜¯"),t("strong",[s._v("åœ¨ä»»åŠ¡é˜Ÿåˆ—çš„é•¿åº¦æ— é™åˆ¶çš„æƒ…å†µä¸‹, è®©çº¿ç¨‹æ± æœ‰æœºä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶é»˜è®¤æƒ…å†µä¸‹ Tomcat çš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯æ²¡æœ‰é™åˆ¶çš„, å¯ä»¥é€šè¿‡è®¾ç½® maxQueueSize å‚æ•°æ¥é™åˆ¶ä»»åŠ¡é˜Ÿåˆ—çš„é•¿åº¦.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-5"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("æ± åŒ–çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯å¯¹è±¡, å‡å°‘å¯¹ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—. Java æä¾›äº†é»˜è®¤çš„çº¿ç¨‹æ± å®ç°, ä¹Ÿå¯ä»¥æ‰©å±• Java åŸç”Ÿçš„çº¿ç¨‹æ± æ¥å®ç°å®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± , Tomcat å°±æ˜¯è¿™ä¹ˆåšçš„. "),t("strong",[s._v("Tomcat æ‰©å±•äº† Java çº¿ç¨‹æ± çš„æ ¸å¿ƒç±» ThreadPoolExecutor, å¹¶é‡å†™äº†å®ƒçš„ execute() æ–¹æ³•, å®šåˆ¶äº†è‡ªå·±çš„ä»»åŠ¡å¤„ç†æµç¨‹. åŒæ—¶ Tomcat è¿˜å®ç°äº†å®šåˆ¶ç‰ˆçš„ä»»åŠ¡é˜Ÿåˆ—, é‡å†™äº† offer() æ–¹æ³•, ä½¿å¾—åœ¨ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦æ— é™åˆ¶çš„æƒ…å†µä¸‹, çº¿ç¨‹æ± ä»ç„¶æœ‰æœºä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_18-æ–°ç‰¹æ€§-tomcatå¦‚ä½•æ”¯æŒwebsocket"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_18-æ–°ç‰¹æ€§-tomcatå¦‚ä½•æ”¯æŒwebsocket"}},[s._v("#")]),s._v(" 18.æ–°ç‰¹æ€§:Tomcatå¦‚ä½•æ”¯æŒWebSocket?")]),s._v(" "),t("p",[s._v('HTTP åè®®æ˜¯ "è¯·æ±‚-å“åº”" æ¨¡å¼, æµè§ˆå™¨å¿…é¡»å…ˆå‘è¯·æ±‚ç»™æœåŠ¡å™¨, æœåŠ¡å™¨æ‰ä¼šå“åº”è¿™ä¸ªè¯·æ±‚. ä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨å‘é€æ•°æ®ç»™æµè§ˆå™¨.')]),s._v(" "),t("p",[s._v("å¯¹äºå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒçš„é«˜çš„åº”ç”¨, æ¯”å¦‚åœ¨çº¿æ¸¸æˆ, è‚¡ç¥¨åŸºé‡‘å®æ—¶æŠ¥ä»·å’Œåœ¨çº¿ååŒç¼–è¾‘ç­‰, æµè§ˆå™¨éœ€è¦å®æ—¶æ˜¾ç¤ºæœåŠ¡å™¨ä¸Šæœ€æ–°çš„æ•°æ®, å› æ­¤å‡ºç°äº† Ajax å’Œ Comet æŠ€æœ¯. Ajax æœ¬è´¨ä¸Šè¿˜æ˜¯è½®è¯¢, è€Œ Comet æ˜¯åœ¨ HTTP é•¿è¿æ¥çš„åŸºç¡€ä¸Šåšäº†ä¸€äº› hack, ä½†æ˜¯å®ƒä»¬çš„å®æ—¶æ€§ä¸é«˜, å¦å¤–é¢‘ç¹çš„è¯·æ±‚ä¼šç»™æœåŠ¡å™¨å¸¦æ¥å‹åŠ›, ä¹Ÿä¼šæµªè´¹ç½‘ç»œæµé‡å’Œå¸¦å®½. äºæ˜¯ HTML5 æ¨å‡ºäº† "),t("strong",[s._v("WebSocket æ ‡å‡†, ä½¿å¾—æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥ä¸»åŠ¨å‘æ¶ˆæ¯ç»™å¯¹æ–¹, è¿™æ ·æœåŠ¡å™¨æœ‰æ–°æ•°æ®æ—¶å¯ä»¥ä¸»åŠ¨æ¨é€ç»™æµè§ˆå™¨.")])]),s._v(" "),t("p",[s._v("è¿™é‡Œä»‹ç» WebSocket çš„å·¥ä½œåŸç†, ä»¥åŠä½œä¸ºæœåŠ¡å™¨ç«¯çš„ Tomcat æ˜¯å¦‚ä½•æ”¯æŒ WebSocket çš„. æ›´é‡è¦çš„æ˜¯, å¸Œæœ›ä½ åœ¨å­¦å®Œä¹‹åå¯ä»¥çµæ´»åœ°é€‰ç”¨ WebSocket æŠ€æœ¯æ¥è§£å†³å®é™…å·¥ä½œä¸­çš„é—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"websocketå·¥ä½œåŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#websocketå·¥ä½œåŸç†"}},[s._v("#")]),s._v(" WebSocketå·¥ä½œåŸç†")]),s._v(" "),t("p",[s._v("WebSocket çš„åå­—é‡Œå¸¦æœ‰ Socket, é‚£ Socket æ˜¯ä»€ä¹ˆå‘¢? ç½‘ç»œä¸Šçš„ä¸¤ä¸ªç¨‹åºé€šè¿‡ä¸€ä¸ªåŒå‘é“¾è·¯è¿›è¡Œé€šä¿¡, è¿™ä¸ªåŒå‘é“¾è·¯çš„ä¸€ç«¯ç§°ä¸ºä¸€ä¸ª Socket. ä¸€ä¸ª Socket å¯¹åº”ä¸€ä¸ª IP åœ°å€å’Œç«¯å£å·, åº”ç”¨ç¨‹åºé€šå¸¸é€šè¿‡ Socket å‘ç½‘ç»œå‘å‡ºè¯·æ±‚æˆ–è€…åº”ç­”ç½‘ç»œè¯·æ±‚. Socket ä¸æ˜¯åè®®, å®ƒå…¶å®æ˜¯å¯¹ TCP/IP åè®®å±‚æŠ½è±¡å‡ºæ¥çš„ API.")]),s._v(" "),t("p",[s._v("ä½† WebSocket ä¸æ˜¯ä¸€å¥— API, è·Ÿ HTTP åè®®ä¸€æ ·, "),t("strong",[s._v("WebSocket ä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨å±‚åè®®")]),s._v(". ä¸ºäº†è·Ÿç°æœ‰çš„ HTTP åè®®ä¿æŒå…¼å®¹, å®ƒé€šè¿‡ HTTP åè®®è¿›è¡Œä¸€æ¬¡æ¡æ‰‹, æ¡æ‰‹ä¹‹åæ•°æ®å°±ç›´æ¥ä» TCP å±‚çš„ Socket ä¼ è¾“, å°±ä¸ HTTP åè®®æ— å…³äº†. æµè§ˆå™¨å‘ç»™æœåŠ¡ç«¯çš„è¯·æ±‚ä¼šå¸¦ä¸Šè·Ÿ WebSocket æœ‰å…³çš„è¯·æ±‚å¤´, æ¯”å¦‚ "),t("code",[s._v("Connection: Upgrade")]),s._v("â€‹ å’Œ "),t("code",[s._v("Upgrade: websocket")]),s._v("â€‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161452-10t1maz.png",alt:"image"}})]),s._v(" "),t("p",[s._v("å¦‚æœæœåŠ¡å™¨æ”¯æŒ WebSocket, åŒæ ·ä¼šåœ¨ HTTP å“åº”é‡ŒåŠ ä¸Š WebSocket ç›¸å…³çš„ HTTP å¤´éƒ¨.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161521-r3e8u27.png",alt:"image"}})]),s._v(" "),t("p",[s._v("è¿™æ · WebSocket è¿æ¥å°±å»ºç«‹å¥½äº†, æ¥ä¸‹æ¥ WebSocket çš„"),t("strong",[s._v("æ•°æ®ä¼ è¾“ä¼šä»¥ frame å½¢å¼ä¼ è¾“")]),s._v(", ä¼šå°†ä¸€æ¡æ¶ˆæ¯åˆ†ä¸ºå‡ ä¸ª frame, æŒ‰ç…§å…ˆåé¡ºåºä¼ è¾“å‡ºå». è¿™æ ·åšçš„å¥½å¤„æœ‰:")]),s._v(" "),t("ul",[t("li",[s._v("å¤§æ•°æ®çš„ä¼ è¾“å¯ä»¥åˆ†ç‰‡ä¼ è¾“, ä¸ç”¨è€ƒè™‘æ•°æ®å¤§å°çš„é—®é¢˜.")]),s._v(" "),t("li",[s._v("å’Œ HTTP çš„ chunk ä¸€æ ·, å¯ä»¥è¾¹ç”Ÿæˆæ•°æ®è¾¹ä¼ è¾“, æé«˜ä¼ è¾“æ•ˆç‡.")])]),s._v(" "),t("h5",{attrs:{id:"tomcatå¦‚ä½•æ”¯æŒwebsocket"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatå¦‚ä½•æ”¯æŒwebsocket"}},[s._v("#")]),s._v(" Tomcatå¦‚ä½•æ”¯æŒWebSocket")]),s._v(" "),t("p",[s._v("åœ¨è®² Tomcat å¦‚ä½•æ”¯æŒ WebSocket ä¹‹å‰, å…ˆæ¥å¼€å‘ä¸€ä¸ªç®€å•çš„èŠå¤©å®¤ç¨‹åº, éœ€æ±‚æ˜¯: ç”¨æˆ·å¯ä»¥é€šè¿‡æµè§ˆå™¨åŠ å…¥èŠå¤©å®¤, å‘é€æ¶ˆæ¯, èŠå¤©å®¤çš„å…¶ä»–äººéƒ½å¯ä»¥æ”¶åˆ°æ¶ˆæ¯.")]),s._v(" "),t("h6",{attrs:{id:"_1-websocketèŠå¤©å®¤ç¨‹åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-websocketèŠå¤©å®¤ç¨‹åº"}},[s._v("#")]),s._v(" 1.WebSocketèŠå¤©å®¤ç¨‹åº")]),s._v(" "),t("p",[s._v("æµè§ˆå™¨ç«¯ JavaScript æ ¸å¿ƒä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" Chat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nChat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("socket "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nChat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒ WebSocket")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'WebSocket'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ”¯æŒåˆ™åˆ›å»º WebSocket JS ç±»")]),s._v("\n        Chat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("socket "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebSocket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MozWebSocket'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Chat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("socket "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MozWebSocket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'WebSocket is not supported by this browser.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å›è°ƒå‡½æ•°, å½“å’ŒæœåŠ¡å™¨çš„ WebSocket è¿æ¥å»ºç«‹èµ·æ¥å, æµè§ˆå™¨ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•")]),s._v("\n    Chat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onopen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Info: WebSocket connection opened.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'chat'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onkeydown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("keyCode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                Chat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å›è°ƒå‡½æ•°, å½“å’ŒæœåŠ¡å™¨çš„ WebSocket è¿æ¥å…³é—­å, æµè§ˆå™¨ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•")]),s._v("\n    Chat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onclose")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'chat'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("onkeydown "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        Console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Info: WebSocket closed.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å›è°ƒå‡½æ•°, å½“æœåŠ¡å™¨æœ‰æ–°æ¶ˆæ¯å‘é€åˆ°æµè§ˆå™¨, æµè§ˆå™¨ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•")]),s._v("\n    Chat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onmessage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä»£ç å®ç°é€»è¾‘æ¯”è¾ƒæ¸…æ™°, å°±æ˜¯åˆ›å»ºä¸€ä¸ª WebSocket JavaScript å¯¹è±¡, ç„¶åå®ç°äº†å‡ ä¸ªå›è°ƒæ–¹æ³•: onopen, onclose å’Œ onmessage. å½“è¿æ¥å»ºç«‹, å…³é—­å’Œæœ‰æ–°æ¶ˆæ¯æ—¶, æµè§ˆå™¨ä¼šè´Ÿè´£è°ƒç”¨è¿™äº›å›è°ƒæ–¹æ³•. å†æ¥çœ‹æœåŠ¡å™¨ç«¯ Tomcat çš„å®ç°ä»£ç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Tomcat ç«¯çš„å®ç°ç±»åŠ ä¸Š @ServerEndpoint æ³¨è§£, é‡Œé¢çš„ value æ˜¯ URL è·¯å¾„")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ServerEndpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/websocket/chat"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChatEndpoint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GUEST_PREFIX")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Guest"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®°å½•å½“å‰æœ‰å¤šå°‘ä¸ªç”¨æˆ·åŠ å…¥åˆ°äº†èŠå¤©å®¤, å®ƒæ˜¯ static å…¨å±€å˜é‡. ä¸ºäº†å¤šçº¿ç¨‹å®‰å…¨ä½¿ç”¨åŸå­å˜é‡ AtomicInteger")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),s._v(" connectionIds "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯ä¸ªç”¨æˆ·ç”¨ä¸€ä¸ª CharAnnotation å®ä¾‹æ¥ç»´æŠ¤, è¯·ä½ æ³¨æ„å®ƒæ˜¯ä¸€ä¸ªå…¨å±€çš„ static å˜é‡, æ‰€ä»¥ç”¨åˆ°äº†çº¿ç¨‹å®‰å…¨çš„ CopyOnWriteArraySet")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChatEndpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" connections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CopyOnWriteArraySet")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" nickname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChatEndpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        nickname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GUEST_PREFIX")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" connectionIds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndIncrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°è¿æ¥åˆ°è¾¾æ—¶, Tomcat ä¼šåˆ›å»ºä¸€ä¸ª Session, å¹¶å›è°ƒè¿™ä¸ªå‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@OnOpen")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        connections"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* %s %s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nickname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"has joined."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("broadcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æµè§ˆå™¨å…³é—­è¿æ¥æ—¶, Tomcat ä¼šå›è°ƒè¿™ä¸ªå‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@OnClose")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        connections"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* %s %s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                nickname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"has disconnected."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("broadcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æµè§ˆå™¨å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨æ—¶, Tomcat ä¼šå›è°ƒè¿™ä¸ªå‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@OnMessage")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incoming")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Never trust the client")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" filteredMessage "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s: %s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                nickname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HTMLFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("filter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("broadcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("filteredMessage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Websocket è¿æ¥å‡ºé”™æ—¶, Tomcat ä¼šå›è°ƒè¿™ä¸ªå‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@OnError")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onError")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Chat Error: "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘èŠå¤©å®¤ä¸­çš„æ¯ä¸ªç”¨æˆ·å¹¿æ’­æ¶ˆæ¯")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("broadcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChatAnnotation")]),s._v(" client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" connections"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBasicRemote")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendText")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br")])]),t("p",[s._v("æ ¹æ® Java WebSocket è§„èŒƒçš„è§„å®š, Java WebSocket åº”ç”¨ç¨‹åºç”±ä¸€ç³»åˆ—çš„ "),t("strong",[s._v("WebSocket Endpoint")]),s._v(" ç»„æˆ. "),t("strong",[s._v("Endpoint æ˜¯ä¸€ä¸ª Java å¯¹è±¡, ä»£è¡¨ WebSocket è¿æ¥çš„ä¸€ç«¯, å°±å¥½åƒå¤„ç† HTTP è¯·æ±‚çš„ Servlet ä¸€æ ·, å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯å¤„ç† WebSocket æ¶ˆæ¯çš„æ¥å£")]),s._v(". è·Ÿ Servlet ä¸åŒçš„åœ°æ–¹åœ¨äº, Tomcat ä¼šç»™æ¯ä¸€ä¸ª WebSocket è¿æ¥åˆ›å»ºä¸€ä¸ª Endpoint å®ä¾‹. å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®šä¹‰å’Œå®ç° Endpoint.")]),s._v(" "),t("p",[s._v("ç¬¬ä¸€ç§æ–¹æ³•æ˜¯"),t("strong",[s._v("ç¼–ç¨‹å¼")]),s._v("çš„, å°±æ˜¯ç¼–å†™ä¸€ä¸ª Java ç±»ç»§æ‰¿ "),t("code",[s._v("javax.websocket.Endpoint")]),s._v("â€‹, å¹¶å®ç°å®ƒçš„ onOpen, onClose å’Œ onError æ–¹æ³•. è¿™äº›æ–¹æ³•è·Ÿ Endpoint çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³, Tomcat è´Ÿè´£ç®¡ç† Endpoint çš„ç”Ÿå‘½å‘¨æœŸå¹¶è°ƒç”¨è¿™äº›æ–¹æ³•. å¹¶ä¸”å½“æµè§ˆå™¨è¿æ¥åˆ°ä¸€ä¸ª Endpoint æ—¶, Tomcat ä¼šç»™è¿™ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ Session("),t("code",[s._v("javax.websocket.Session")]),s._v("â€‹). Session åœ¨ WebSocket è¿æ¥æ¡æ‰‹æˆåŠŸä¹‹ååˆ›å»º, å¹¶åœ¨è¿æ¥å…³é—­æ—¶é”€æ¯. å½“è§¦å‘ Endpoint å„ä¸ªç”Ÿå‘½å‘¨æœŸäº‹ä»¶æ—¶, Tomcat ä¼šå°†å½“å‰ Session ä½œä¸ºå‚æ•°ä¼ ç»™ Endpoint çš„å›è°ƒæ–¹æ³•, å› æ­¤ä¸€ä¸ª Endpoint å®ä¾‹å¯¹åº”ä¸€ä¸ª Session, é€šè¿‡åœ¨ Session ä¸­æ·»åŠ  MessageHandler æ¶ˆæ¯å¤„ç†å™¨æ¥æ¥æ”¶æ¶ˆæ¯, MessageHandler ä¸­å®šä¹‰äº† onMessage æ–¹æ³•. **åœ¨è¿™é‡Œ Session çš„æœ¬è´¨æ˜¯å¯¹ Socket çš„å°è£…, Endpoint é€šè¿‡å®ƒä¸æµè§ˆå™¨é€šä¿¡. **")]),s._v(" "),t("p",[s._v("ç¬¬äºŒç§å®šä¹‰ Endpoint çš„æ–¹æ³•æ˜¯"),t("strong",[s._v("æ³¨è§£å¼")]),s._v("çš„, ä¹Ÿå°±æ˜¯ä¸Šé¢çš„èŠå¤©å®¤ç¨‹åºä¾‹å­ä¸­ç”¨åˆ°çš„æ–¹å¼, å³å®ç°ä¸€ä¸ªä¸šåŠ¡ç±»å¹¶ç»™å®ƒæ·»åŠ  WebSocket ç›¸å…³çš„æ³¨è§£. é¦–å…ˆæ³¨æ„åˆ° "),t("code",[s._v('@ServerEndpoint(value = "/websocket/chat")')]),s._v("â€‹ æ³¨è§£, å®ƒè¡¨æ˜å½“å‰ä¸šåŠ¡ç±» ChatEndpoint æ˜¯ä¸€ä¸ªå®ç°äº† WebSocket è§„èŒƒçš„ Endpoint, å¹¶ä¸”æ³¨è§£çš„ value å€¼è¡¨æ˜ ChatEndpoint æ˜ å°„çš„ URL æ˜¯ "),t("code",[s._v("/websocket/chat")]),s._v("â€‹. è¿˜çœ‹åˆ° ChatEndpoint ç±»ä¸­æœ‰ "),t("code",[s._v("@OnOpen")]),s._v("â€‹, "),t("code",[s._v("@OnClose")]),s._v("â€‹, "),t("code",[s._v("@OnError")]),s._v("â€‹å’Œåœ¨"),t("code",[s._v("@OnMessage")]),s._v("â€‹ æ³¨è§£çš„æ–¹æ³•, ä»åå­—å°±çŸ¥é“å®ƒä»¬çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆ.")]),s._v(" "),t("p",[s._v("å¯¹äºç¨‹åºå‘˜æ¥è¯´, å…¶å®åªéœ€è¦ä¸“æ³¨å…·ä½“çš„ Endpoint çš„å®ç°, æ¯”å¦‚åœ¨ä¸Šé¢èŠå¤©å®¤çš„ä¾‹å­ä¸­, ä¸ºäº†æ–¹ä¾¿å‘æ‰€æœ‰äººç¾¤å‘æ¶ˆæ¯, ChatEndpoint åœ¨å†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªå…¨å±€é™æ€çš„é›†åˆ CopyOnWriteArraySet æ¥ç»´æŠ¤æ‰€æœ‰çš„ ChatEndpoint å®ä¾‹, å› ä¸ºæ¯ä¸€ä¸ª ChatEndpoint å®ä¾‹å¯¹åº”ä¸€ä¸ª WebSocket è¿æ¥, ä¹Ÿå°±æ˜¯ä»£è¡¨äº†ä¸€ä¸ªåŠ å…¥èŠå¤©å®¤çš„ç”¨æˆ·. **å½“æŸä¸ª ChatEndpoint å®ä¾‹æ”¶åˆ°æ¥è‡ªæµè§ˆå™¨çš„æ¶ˆæ¯æ—¶, è¿™ä¸ª ChatEndpoint ä¼šå‘é›†åˆä¸­å…¶ä»– ChatEndpoint å®ä¾‹èƒŒåçš„ WebSocket è¿æ¥æ¨é€æ¶ˆæ¯. **")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹ä¸­, Tomcat ä¸»è¦åšäº†å“ªäº›äº‹æƒ…å‘¢? ç®€å•æ¥è¯´å°±æ˜¯ä¸¤ä»¶äº‹æƒ…: "),t("strong",[s._v("Endpoint åŠ è½½å’Œ WebSocket è¯·æ±‚å¤„ç†")]),s._v(". ä¸‹é¢åˆ†åˆ«æ¥è¯¦ç»†è¯´è¯´ Tomcat æ˜¯å¦‚ä½•åšè¿™ä¸¤ä»¶äº‹æƒ…çš„.")]),s._v(" "),t("h6",{attrs:{id:"_2-websocketåŠ è½½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-websocketåŠ è½½"}},[s._v("#")]),s._v(" 2.WebSocketåŠ è½½")]),s._v(" "),t("p",[s._v("Tomcat çš„ WebSocket åŠ è½½æ˜¯é€šè¿‡ SCI æœºåˆ¶å®Œæˆçš„. SCI å…¨ç§° "),t("strong",[s._v("ServletContainerInitializer")]),s._v(", æ˜¯ Servlet 3.0 è§„èŒƒä¸­å®šä¹‰çš„ç”¨æ¥"),t("strong",[s._v("æ¥æ”¶ Web åº”ç”¨å¯åŠ¨äº‹ä»¶çš„æ¥å£")]),s._v(". é‚£ä¸ºä»€ä¹ˆè¦ç›‘å¬ Servlet å®¹å™¨çš„å¯åŠ¨äº‹ä»¶å‘¢? å› ä¸ºè¿™æ ·æœ‰æœºä¼šåœ¨ Web åº”ç”¨å¯åŠ¨æ—¶åšä¸€äº›"),t("strong",[s._v("åˆå§‹åŒ–å·¥ä½œ")]),s._v(", æ¯”å¦‚ WebSocket éœ€è¦æ‰«æå’ŒåŠ è½½ Endpoint ç±». SCI çš„ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•, "),t("strong",[s._v("å°†å®ç° ServletContainerInitializer æ¥å£çš„ç±»å¢åŠ  HandlesTypes æ³¨è§£, å¹¶ä¸”åœ¨æ³¨è§£å†…æŒ‡å®šçš„ä¸€ç³»åˆ—ç±»å’Œæ¥å£é›†åˆ")]),s._v(". æ¯”å¦‚ Tomcat ä¸ºäº†æ‰«æå’ŒåŠ è½½ Endpoint è€Œå®šä¹‰çš„ SCI ç±»å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@HandlesTypes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerEndpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerApplicationConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Endpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WsSci")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContainerInitializer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onStartup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" clazzes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContext")]),s._v(" ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä¸€æ—¦å®šä¹‰å¥½äº† SCI, Tomcat åœ¨å¯åŠ¨é˜¶æ®µæ‰«æç±»æ—¶, ä¼šå°† HandlesTypes æ³¨è§£ä¸­æŒ‡å®šçš„ç±»éƒ½æ‰«æå‡ºæ¥, ä½œä¸º SCI çš„ onStartup() æ–¹æ³•çš„å‚æ•°, å¹¶è°ƒç”¨ SCI çš„ onStartup() æ–¹æ³•. æ³¨æ„åˆ° WsSci çš„ HandlesTypes æ³¨è§£ä¸­å®šä¹‰äº†"),t("code",[s._v("ServerEndpoint.class")]),s._v("â€‹, "),t("code",[s._v("ServerApplicationConfig.class")]),s._v("â€‹ å’Œ "),t("code",[s._v("Endpoint.class")]),s._v("â€‹, å› æ­¤åœ¨ Tomcat çš„å¯åŠ¨é˜¶æ®µä¼šå°†è¿™äº›ç±»çš„ç±»å®ä¾‹(æ³¨æ„ä¸æ˜¯å¯¹è±¡å®ä¾‹)ä¼ é€’ç»™ WsSci çš„ onStartup() æ–¹æ³•. é‚£ä¹ˆ WsSci çš„ onStartup() æ–¹æ³•åˆåšäº†ä»€ä¹ˆäº‹å‘¢?")]),s._v(" "),t("p",[s._v("å®ƒä¼šæ„é€ ä¸€ä¸ª WebSocketContainer å®ä¾‹, å¯ä»¥æŠŠ WebSocketContainer ç†è§£æˆä¸€ä¸ªä¸“é—¨å¤„ç† WebSocket è¯·æ±‚çš„ "),t("strong",[s._v("Endpoint å®¹å™¨")]),s._v(". ä¹Ÿå°±æ˜¯è¯´ Tomcat ä¼šæŠŠæ‰«æåˆ°çš„ Endpoint å­ç±»å’Œæ·»åŠ äº†æ³¨è§£ "),t("code",[s._v("@ServerEndpoint")]),s._v("â€‹ çš„ç±»æ³¨å†Œåˆ°è¿™ä¸ªå®¹å™¨ä¸­, å¹¶ä¸”è¿™ä¸ªå®¹å™¨è¿˜ç»´æŠ¤äº† URL åˆ° Endpoint çš„æ˜ å°„å…³ç³», è¿™æ ·é€šè¿‡è¯·æ±‚ URL å°±èƒ½æ‰¾åˆ°å…·ä½“çš„ Endpoint æ¥å¤„ç† WebSocket è¯·æ±‚.")]),s._v(" "),t("h6",{attrs:{id:"_3-websocketè¯·æ±‚å¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-websocketè¯·æ±‚å¤„ç†"}},[s._v("#")]),s._v(" 3.WebSocketè¯·æ±‚å¤„ç†")]),s._v(" "),t("p",[s._v("åœ¨è®² WebSocket è¯·æ±‚å¤„ç†ä¹‹å‰, å…ˆæ¥å›é¡¾ä¸€ä¸‹ Tomcat è¿æ¥å™¨çš„ç»„ä»¶å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161429-w1czmc5.jpg",alt:""}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ° Tomcat ç”¨ ProtocolHandler ç»„ä»¶å±è”½åº”ç”¨å±‚åè®®çš„å·®å¼‚, å…¶ä¸­ "),t("strong",[s._v("ProtocolHandler ä¸­æœ‰ä¸¤ä¸ªå…³é”®ç»„ä»¶: Endpoint å’Œ Processor")]),s._v(". éœ€è¦æ³¨æ„, è¿™é‡Œçš„ Endpoint è·Ÿä¸Šæ–‡æåˆ°çš„ WebSocket ä¸­çš„ Endpoint å®Œå…¨æ˜¯"),t("mark",[t("strong",[s._v("ä¸¤å›äº‹")])]),s._v(", "),t("strong",[s._v("è¿æ¥å™¨ä¸­çš„ Endpoint ç»„ä»¶ç”¨æ¥å¤„ç† I/O é€šä¿¡. WebSocket æœ¬è´¨å°±æ˜¯ä¸€ä¸ªåº”ç”¨å±‚åè®®, å› æ­¤ä¸èƒ½ç”¨ HttpProcessor æ¥å¤„ç† WebSocket è¯·æ±‚, è€Œè¦ç”¨ä¸“é—¨ Processor æ¥å¤„ç†, è€Œåœ¨ Tomcat ä¸­è¿™æ ·çš„ Processor å«ä½œ UpgradeProcessor")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸ºä»€ä¹ˆå« Upgrade Processor å‘¢? è¿™æ˜¯å› ä¸º "),t("strong",[s._v("Tomcat æ˜¯å°† HTTP åè®®å‡çº§æˆ WebSocket åè®®çš„")]),s._v(", ç”±äº WebSocket æ˜¯é€šè¿‡ HTTP åè®®æ¥è¿›è¡Œæ¡æ‰‹çš„, å› æ­¤å½“ WebSocket çš„æ¡æ‰‹è¯·æ±‚åˆ°æ¥æ—¶, HttpProtocolHandler é¦–å…ˆæ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚, åœ¨å¤„ç†è¿™ä¸ª HTTP è¯·æ±‚æ—¶, Tomcat é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„ Filter åˆ¤æ–­è¯¥å½“å‰ HTTP "),t("strong",[s._v("è¯·æ±‚æ˜¯å¦æ˜¯ä¸€ä¸ª WebSocket Upgrade è¯·æ±‚")]),s._v("(å³åŒ…å«"),t("code",[s._v("Upgrade: websocket")]),s._v("â€‹çš„ HTTP å¤´ä¿¡æ¯), å¦‚æœæ˜¯, åˆ™åœ¨ HTTP å“åº”é‡Œæ·»åŠ  WebSocket ç›¸å…³çš„å“åº”å¤´ä¿¡æ¯, å¹¶è¿›è¡Œ"),t("strong",[s._v("åè®®å‡çº§")]),s._v(". å…·ä½“æ¥è¯´å°±æ˜¯ç”¨ UpgradeProtocolHandler æ›¿æ¢å½“å‰çš„ HttpProtocolHandler, ç›¸åº”çš„, æŠŠå½“å‰ Socket çš„ Processor æ›¿æ¢æˆ "),t("strong",[s._v("UpgradeProcessor")]),s._v(", åŒæ—¶ Tomcat ä¼šåˆ›å»º WebSocket Session å®ä¾‹å’Œ Endpoint å®ä¾‹, å¹¶è·Ÿå½“å‰çš„ WebSocket è¿æ¥ä¸€ä¸€å¯¹åº”èµ·æ¥. è¿™ä¸ª WebSocket è¿æ¥ä¸ä¼šç«‹å³å…³é—­, å¹¶ä¸”åœ¨è¯·æ±‚å¤„ç†ä¸­, ä¸å†ä½¿ç”¨åŸæœ‰çš„ HttpProcessor, è€Œæ˜¯ç”¨ä¸“é—¨çš„ UpgradeProcessor, UpgradeProcessor æœ€ç»ˆä¼šè°ƒç”¨ç›¸åº”çš„ Endpoint å®ä¾‹æ¥å¤„ç†è¯·æ±‚. ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£ä¸€ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161429-as6e7rp.jpg",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("å¯ä»¥çœ‹åˆ°, Tomcat å¯¹ WebSocket è¯·æ±‚çš„å¤„ç†æ²¡æœ‰ç»è¿‡ Servlet å®¹å™¨, è€Œæ˜¯é€šè¿‡ UpgradeProcessor ç»„ä»¶ç›´æ¥æŠŠè¯·æ±‚å‘åˆ° ServerEndpoint å®ä¾‹, å¹¶ä¸” Tomcat çš„ WebSocket å®ç°ä¸éœ€è¦å…³æ³¨å…·ä½“ I/O æ¨¡å‹çš„ç»†èŠ‚, ä»è€Œå®ç°äº†ä¸å…·ä½“ I/O æ–¹å¼çš„è§£è€¦.")])]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-6"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("WebSocket æŠ€æœ¯å®ç°äº† Tomcat ä¸æµè§ˆå™¨çš„åŒå‘é€šä¿¡, Tomcat å¯ä»¥ä¸»åŠ¨å‘æµè§ˆå™¨æ¨é€æ•°æ®, å¯ä»¥ç”¨æ¥å®ç°å¯¹æ•°æ®å®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åº”ç”¨. è¿™éœ€è¦æµè§ˆå™¨å’Œ Web æœåŠ¡å™¨åŒæ—¶æ”¯æŒ WebSocket æ ‡å‡†, Tomcat å¯åŠ¨æ—¶é€šè¿‡ SCI æŠ€æœ¯æ¥æ‰«æå’ŒåŠ è½½ WebSocket çš„å¤„ç†ç±» ServerEndpoint, å¹¶ä¸”å»ºç«‹èµ·äº† URL åˆ° ServerEndpoint çš„æ˜ å°„å…³ç³».")]),s._v(" "),t("p",[t("strong",[s._v("å½“ç¬¬ä¸€ä¸ª WebSocket è¯·æ±‚åˆ°è¾¾æ—¶, Tomcat å°† HTTP åè®®å‡çº§æˆ WebSocket åè®®, å¹¶å°†è¯¥ Socket è¿æ¥çš„ Processor æ›¿æ¢æˆ UpgradeProcessor. è¿™ä¸ª Socket ä¸ä¼šç«‹å³å…³é—­, å¯¹æ¥ä¸‹æ¥çš„è¯·æ±‚, Tomcat é€šè¿‡ UpgradeProcessor ç›´æ¥è°ƒç”¨ç›¸åº”çš„ ServerEndpoint æ¥å¤„ç†.")])]),s._v(" "),t("h4",{attrs:{id:"_19-æ¯”è¾ƒ-jettyçš„çº¿ç¨‹ç­–ç•¥eatwhatyoukill"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_19-æ¯”è¾ƒ-jettyçš„çº¿ç¨‹ç­–ç•¥eatwhatyoukill"}},[s._v("#")]),s._v(" 19.æ¯”è¾ƒ:Jettyçš„çº¿ç¨‹ç­–ç•¥EatWhatYouKill")]),s._v(" "),t("p",[s._v("å‰é¢å·²ç»ä»‹ç»äº† Jetty çš„æ€»ä½“æ¶æ„è®¾è®¡, å›é¡¾ä¸€ä¸‹, Jetty æ€»ä½“ä¸Šæ˜¯ç”±ä¸€ç³»åˆ— Connector, ä¸€ç³»åˆ— Handler å’Œä¸€ä¸ª ThreadPool ç»„æˆ, å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161545-q6zeqaq.jpg",alt:""}})]),s._v(" "),t("p",[s._v("ç›¸æ¯”è¾ƒ Tomcat çš„è¿æ¥å™¨, Jetty çš„ Connector åœ¨è®¾è®¡ä¸Šæœ‰è‡ªå·±çš„ç‰¹ç‚¹. Jetty çš„ Connector æ”¯æŒ NIO é€šä¿¡æ¨¡å‹, ç”±äº "),t("strong",[s._v("NIO æ¨¡å‹ä¸­çš„ä¸»è§’å°±æ˜¯ Selector")]),s._v(", Jetty åœ¨ Java åŸç”Ÿ Selector çš„åŸºç¡€ä¸Šå°è£…äº†è‡ªå·±çš„ Selector, å«ä½œ ManagedSelector. ManagedSelector åœ¨çº¿ç¨‹ç­–ç•¥æ–¹é¢åšäº†å¤§èƒ†å°è¯•, å°† I/O äº‹ä»¶çš„ä¾¦æµ‹å’Œå¤„ç†æ”¾åˆ°åŒä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†, å……åˆ†åˆ©ç”¨äº† CPU ç¼“å­˜å¹¶å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€.")]),s._v(" "),t("p",[s._v("å…·ä½“çš„æ•°å­—æ˜¯, æ ¹æ® Jetty çš„å®˜æ–¹æµ‹è¯•, è¿™ç§"),t("strong",[s._v('åä¸º "EatWhatYouKill" çš„çº¿ç¨‹ç­–ç•¥å°†ååé‡æé«˜äº† 8 å€')]),s._v(". è¿™é‡Œæ¥çœ‹ä¸€çœ‹è¿™èƒŒåçš„åŸç†æ˜¯ä»€ä¹ˆ.")]),s._v(" "),t("h5",{attrs:{id:"selectorç¼–ç¨‹çš„ä¸€èˆ¬æ€è·¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#selectorç¼–ç¨‹çš„ä¸€èˆ¬æ€è·¯"}},[s._v("#")]),s._v(" Selectorç¼–ç¨‹çš„ä¸€èˆ¬æ€è·¯")]),s._v(" "),t("p",[s._v("å¸¸è§„çš„ NIO ç¼–ç¨‹æ€è·¯æ˜¯, å°† I/O äº‹ä»¶çš„ä¾¦æµ‹å’Œè¯·æ±‚çš„å¤„ç†åˆ†åˆ«ç”¨ä¸åŒçš„çº¿ç¨‹å¤„ç†. å…·ä½“è¿‡ç¨‹æ˜¯:")]),s._v(" "),t("p",[s._v("**å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹, åœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œä¸æ–­åœ°è°ƒç”¨ select æ–¹æ³•, æ£€æµ‹ Channel çš„ I/O çŠ¶æ€, ä¸€æ—¦ I/O äº‹ä»¶è¾¾åˆ°, æ¯”å¦‚æ•°æ®å°±ç»ª, å°±æŠŠè¯¥ I/O äº‹ä»¶ä»¥åŠä¸€äº›æ•°æ®åŒ…è£…æˆä¸€ä¸ª Runnable, å°† Runnable æ”¾åˆ°æ–°çº¿ç¨‹ä¸­å»å¤„ç†. **")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æŒ‰ç…§èŒè´£åˆ’åˆ†, æœ‰ä¸¤ä¸ªçº¿ç¨‹åœ¨å¹²æ´», "),t("strong",[s._v("ä¸€ä¸ªæ˜¯ I/O äº‹ä»¶æ£€æµ‹çº¿ç¨‹, å¦ä¸€ä¸ªæ˜¯ I/O äº‹ä»¶å¤„ç†çº¿ç¨‹")]),s._v('. ä»”ç»†æ€è€ƒä¸€ä¸‹è¿™ä¸¤è€…çš„å…³ç³», å…¶å®å®ƒä»¬æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å…³ç³». I/O äº‹ä»¶ä¾¦æµ‹çº¿ç¨‹ä½œä¸ºç”Ÿäº§è€…, è´Ÿè´£ "ç”Ÿäº§" I/O äº‹ä»¶, ä¹Ÿå°±æ˜¯è´Ÿè´£æ¥æ´»å„¿çš„è€æ¿; I/O å¤„ç†çº¿ç¨‹æ˜¯æ¶ˆè´¹è€…, å®ƒ "æ¶ˆè´¹" å¹¶å¤„ç† I/O äº‹ä»¶, å°±æ˜¯å¹²è‹¦åŠ›çš„å‘˜å·¥. æŠŠè¿™ä¸¤ä¸ªå·¥ä½œç”¨ä¸åŒçš„çº¿ç¨‹æ¥å¤„ç†, å¥½å¤„æ˜¯å®ƒä»¬äº’ä¸å¹²æ‰°å’Œé˜»å¡å¯¹æ–¹.')]),s._v(" "),t("h5",{attrs:{id:"jettyä¸­çš„selectorç¼–ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jettyä¸­çš„selectorç¼–ç¨‹"}},[s._v("#")]),s._v(" Jettyä¸­çš„Selectorç¼–ç¨‹")]),s._v(" "),t("p",[s._v("ç„¶è€Œä¸–äº‹æ— ç»å¯¹, å°† I/O äº‹ä»¶æ£€æµ‹å’Œä¸šåŠ¡å¤„ç†è¿™ä¸¤ç§å·¥ä½œåˆ†å¼€çš„æ€è·¯ä¹Ÿæœ‰ç¼ºç‚¹. å½“ Selector æ£€æµ‹è¯»å°±ç»ªäº‹ä»¶æ—¶, "),t("strong",[s._v("æ•°æ®å·²ç»è¢«æ‹·è´åˆ°å†…æ ¸ä¸­çš„ç¼“å­˜")]),s._v("äº†, åŒæ—¶ CPU çš„ç¼“å­˜ä¸­ä¹Ÿæœ‰è¿™äº›æ•°æ®äº†, ç”±äº CPU æœ¬èº«çš„ç¼“å­˜æ¯”å†…å­˜å¿«å¤šäº†, è¿™æ—¶å½“åº”ç”¨ç¨‹åºå»è¯»å–è¿™äº›æ•°æ®æ—¶, å¦‚æœç”¨å¦ä¸€ä¸ªçº¿ç¨‹å»è¯», å¾ˆæœ‰å¯èƒ½è¿™ä¸ªè¯»çº¿ç¨‹ä½¿ç”¨å¦ä¸€ä¸ª CPU æ ¸, è€Œä¸æ˜¯ä¹‹å‰é‚£ä¸ªæ£€æµ‹æ•°æ®å°±ç»ªçš„ CPU æ ¸, è¿™æ · CPU ç¼“å­˜ä¸­çš„æ•°æ®å°±ç”¨ä¸ä¸Šäº†, å¹¶ä¸”çº¿ç¨‹åˆ‡æ¢ä¹Ÿéœ€è¦å¼€é”€.")]),s._v(" "),t("p",[s._v("å› æ­¤ Jetty çš„ Connector åšäº†ä¸€ä¸ªå¤§èƒ†å°è¯•, é‚£å°±æ˜¯ç”¨"),t("strong",[s._v("æŠŠ I/O äº‹ä»¶çš„ç”Ÿäº§å’Œæ¶ˆè´¹æ”¾åˆ°åŒä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†")]),s._v(", å¦‚æœè¿™ä¸¤ä¸ªä»»åŠ¡ç”±åŒä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œ, å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­"),t("strong",[s._v("çº¿ç¨‹ä¸é˜»å¡")]),s._v(", æ“ä½œç³»ç»Ÿä¼šç”¨åŒä¸€ä¸ª CPU æ ¸æ¥æ‰§è¡Œè¿™ä¸¤ä¸ªä»»åŠ¡, è¿™æ ·å°±èƒ½"),t("strong",[s._v("åˆ©ç”¨ CPU ç¼“å­˜")]),s._v("äº†. é‚£å…·ä½“æ˜¯å¦‚ä½•åšçš„å‘¢, è¿˜æ˜¯æ¥è¯¦ç»†åˆ†æä¸€ä¸‹ Connector ä¸­çš„ ManagedSelector ç»„ä»¶.")]),s._v(" "),t("h6",{attrs:{id:"_1-managedselector"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-managedselector"}},[s._v("#")]),s._v(" 1.ManagedSelector")]),s._v(" "),t("p",[s._v("ManagedSelector çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª Selector, è´Ÿè´£ I/O äº‹ä»¶çš„æ£€æµ‹å’Œåˆ†å‘. ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨, Jetty åœ¨ Java åŸç”Ÿçš„ Selector ä¸Šåšäº†ä¸€äº›æ‰©å±•, å°±å˜æˆäº† "),t("strong",[s._v("ManagedSelector")]),s._v(", å…ˆæ¥çœ‹çœ‹å®ƒæœ‰å“ªäº›æˆå‘˜å˜é‡:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ManagedSelector")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ContainerLifeCycle")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Dumpable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŸå­å˜é‡, è¡¨æ˜å½“å‰çš„ ManagedSelector æ˜¯å¦å·²ç»å¯åŠ¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicBoolean")]),s._v(" _started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicBoolean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¡¨æ˜æ˜¯å¦é˜»å¡åœ¨ select è°ƒç”¨ä¸Š")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" _selecting "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç®¡ç†å™¨çš„å¼•ç”¨, SelectorManager ç®¡ç†è‹¥å¹² ManagedSelector çš„ç”Ÿå‘½å‘¨æœŸ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectorManager")]),s._v(" _selectorManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ManagedSelector ä¸æ­¢ä¸€ä¸ª, ä¸ºå®ƒä»¬æ¯äººåˆ†é…ä¸€ä¸ª id")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" _id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…³é”®çš„æ‰§è¡Œç­–ç•¥, ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯å¦åœ¨åŒä¸€ä¸ªçº¿ç¨‹å¤„ç†ç”±å®ƒå†³å®š")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutionStrategy")]),s._v(" _strategy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Java åŸç”Ÿçš„ Selector")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Selector")]),s._v(" _selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//"Selector æ›´æ–°ä»»åŠ¡ " é˜Ÿåˆ—')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Deque")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectorUpdate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _updates "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayDeque")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Deque")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectorUpdate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _updateable "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayDeque")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v('è¿™äº›æˆå‘˜å˜é‡ä¸­å…¶ä»–çš„éƒ½å¥½ç†è§£, å°±æ˜¯ "Selector æ›´æ–°ä»»åŠ¡" é˜Ÿåˆ— '),t("code",[s._v("_updates")]),s._v("â€‹ å’Œæ‰§è¡Œç­–ç•¥ "),t("code",[s._v("_strategy")]),s._v("â€‹ å¯èƒ½ä¸æ˜¯å¾ˆç›´è§‚.")]),s._v(" "),t("h6",{attrs:{id:"_1-selectorupdateæ¥å£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-selectorupdateæ¥å£"}},[s._v("#")]),s._v(" 1.SelectorUpdateæ¥å£")]),s._v(" "),t("p",[s._v('ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ª "Selector æ›´æ–°ä»»åŠ¡" é˜Ÿåˆ—å‘¢, å¯¹äº Selector çš„ç”¨æˆ·æ¥è¯´, å¯¹ Selector çš„æ“ä½œæ— éæ˜¯å°† Channel æ³¨å†Œåˆ° Selector æˆ–è€…å‘Šè¯‰ Selector æˆ‘å¯¹ä»€ä¹ˆ I/O äº‹ä»¶æ„Ÿå…´è¶£, é‚£ä¹ˆè¿™äº›æ“ä½œå…¶å®å°±æ˜¯å¯¹ Selector çŠ¶æ€çš„æ›´æ–°, Jetty æŠŠè¿™äº›æ“ä½œæŠ½è±¡æˆ '),t("strong",[s._v("SelectorUpdate æ¥å£")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * A selector update to be done when the selector has been woken.\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectorUpdate")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Selector")]),s._v(" selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("è¿™æ„å‘³ç€ä¸èƒ½ç›´æ¥æ“ä½œ ManageSelector ä¸­çš„ Selector, è€Œæ˜¯éœ€è¦å‘ ManagedSelector æäº¤ä¸€ä¸ªä»»åŠ¡ç±», è¿™ä¸ªç±»éœ€è¦å®ç° SelectorUpdate æ¥å£ update() æ–¹æ³•, åœ¨ update() æ–¹æ³•é‡Œå®šä¹‰æƒ³è¦å¯¹ ManagedSelector åšçš„æ“ä½œ.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ Connector ä¸­ Endpoint ç»„ä»¶å¯¹è¯»å°±ç»ªäº‹ä»¶æ„Ÿå…´è¶£, å®ƒå°±å‘ ManagedSelector æäº¤äº†ä¸€ä¸ªå†…éƒ¨ä»»åŠ¡ç±» ManagedSelector.SelectorUpdate():")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("_selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_updateKeyAction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ª "),t("code",[s._v("_updateKeyAction")]),s._v("â€‹ å°±æ˜¯ä¸€ä¸ª SelectorUpdate å®ä¾‹, å®ƒçš„ update() æ–¹æ³•å®ç°å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ManagedSelector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SelectorUpdate")]),s._v(" _updateKeyAction "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ManagedSelector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SelectorUpdate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Selector")]),s._v(" selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œçš„ updateKey å…¶å®å°±æ˜¯è°ƒç”¨äº† SelectionKey.interestOps(OP_READ);")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°åœ¨ update() æ–¹æ³•é‡Œ, è°ƒç”¨äº† SelectionKey ç±»çš„ interestOps() æ–¹æ³•, ä¼ å…¥çš„å‚æ•°æ˜¯ "),t("code",[s._v("OP_READ")]),s._v("â€‹, æ„æ€æ˜¯ç°åœ¨æˆ‘å¯¹è¿™ä¸ª Channel ä¸Šçš„è¯»å°±ç»ªäº‹ä»¶æ„Ÿå…´è¶£äº†.")]),s._v(" "),t("p",[s._v("é‚£è°æ¥è´Ÿè´£æ‰§è¡Œè¿™äº› update() æ–¹æ³•å‘¢, ç­”æ¡ˆæ˜¯ ManagedSelector è‡ªå·±, å®ƒåœ¨ä¸€ä¸ª"),t("strong",[s._v("æ­»å¾ªç¯é‡Œæ‹‰å–è¿™äº› SelectorUpdate ä»»åŠ¡ç±»é€ä¸ªæ‰§è¡Œ")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_2-selectableæ¥å£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-selectableæ¥å£"}},[s._v("#")]),s._v(" 2.Selectableæ¥å£")]),s._v(" "),t("p",[s._v("é‚£ I/O äº‹ä»¶åˆ°è¾¾æ—¶, ManagedSelector æ€ä¹ˆçŸ¥é“åº”è¯¥è°ƒå“ªä¸ªå‡½æ•°æ¥å¤„ç†å‘¢? å…¶å®ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ª"),t("strong",[s._v("ä»»åŠ¡ç±»æ¥å£, è¿™ä¸ªæ¥å£å°±æ˜¯ Selectable")]),s._v(", å®ƒè¿”å›ä¸€ä¸ª Runnable, "),t("strong",[s._v("è¿™ä¸ª Runnable å…¶å®å°±æ˜¯ I/O äº‹ä»¶å°±ç»ªæ—¶ç›¸åº”çš„å¤„ç†é€»è¾‘")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Selectable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“æŸä¸€ä¸ª Channel çš„ I/O äº‹ä»¶å°±ç»ªå, ManagedSelector ä¼šè°ƒç”¨çš„å›è°ƒå‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onSelected")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“æ‰€æœ‰äº‹ä»¶å¤„ç†å®Œäº†ä¹‹å ManagedSelector ä¼šè°ƒçš„å›è°ƒå‡½æ•°, å…ˆå¿½ç•¥. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("ManagedSelector åœ¨æ£€æµ‹åˆ°æŸä¸ª Channel ä¸Šçš„ I/O äº‹ä»¶å°±ç»ªæ—¶, ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ª Channel è¢«é€‰ä¸­äº†, ManagedSelector è°ƒç”¨è¿™ä¸ª Channel æ‰€ç»‘å®šçš„é™„ä»¶ç±»çš„ "),t("strong",[s._v("onSelected() æ–¹æ³•æ¥æ‹¿åˆ°ä¸€ä¸ª Runnable")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™å¥è¯æœ‰ç‚¹ç»•, å…¶å®å°±æ˜¯ ManagedSelector çš„ä½¿ç”¨è€…, æ¯”å¦‚ Endpoint ç»„ä»¶åœ¨å‘ ManagedSelector æ³¨å†Œè¯»å°±ç»ªäº‹ä»¶æ—¶, åŒæ—¶ä¹Ÿè¦å‘Šè¯‰ ManagedSelector åœ¨äº‹ä»¶å°±ç»ªæ—¶æ‰§è¡Œä»€ä¹ˆä»»åŠ¡, å…·ä½“æ¥è¯´å°±æ˜¯ä¼ å…¥ä¸€ä¸ªé™„ä»¶ç±», è¿™ä¸ªé™„ä»¶ç±»éœ€è¦å®ç° Selectable æ¥å£. ManagedSelector "),t("strong",[s._v("é€šè¿‡è°ƒç”¨è¿™ä¸ª onSelected() æ‹¿åˆ°ä¸€ä¸ª Runnable, ç„¶åæŠŠ Runnable æ‰”ç»™çº¿ç¨‹æ± å»æ‰§è¡Œ")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ Endpoint çš„ onSelected() æ˜¯å¦‚ä½•å®ç°çš„å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onSelected")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" readyOps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readyOps")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" fillable "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("readyOps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OP_READ")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" flushable "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("readyOps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OP_WRITE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// return task to complete the job")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fillable \n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flushable \n                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" _runCompleteWriteFillable \n                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" _runFillable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flushable \n                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" _runCompleteWrite \n                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä»£ç é€»è¾‘å¾ˆç®€å•, å°±æ˜¯è¯»äº‹ä»¶åˆ°äº†å°±è¯», å†™äº‹ä»¶åˆ°äº†å°±å†™.")]),s._v(" "),t("h6",{attrs:{id:"_3-executionstrategy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-executionstrategy"}},[s._v("#")]),s._v(" 3.ExecutionStrategy")]),s._v(" "),t("p",[s._v("é“ºå«äº†è¿™ä¹ˆå¤š, ç»ˆäºè¦ä¸Šä¸»èœäº†. å‰é¢ä¸»è¦ä»‹ç»äº† ManagedSelector çš„ä½¿ç”¨è€…å¦‚ä½•è·Ÿ ManagedSelector äº¤äº’, ä¹Ÿå°±æ˜¯å¦‚ä½•æ³¨å†Œ Channel ä»¥åŠ I/O äº‹ä»¶, æä¾›ä»€ä¹ˆæ ·çš„å¤„ç†ç±»æ¥å¤„ç† I/O äº‹ä»¶, æ¥ä¸‹æ¥"),t("strong",[s._v("çœ‹çœ‹ ManagedSelector æ˜¯å¦‚ä½•ç»Ÿä¸€ç®¡ç†å’Œç»´æŠ¤ç”¨æˆ·æ³¨å†Œçš„ Channel é›†åˆ")]),s._v(". å†å›åˆ°å¼€å§‹çš„è®¨è®º, ManagedSelector å°† I/O äº‹ä»¶çš„ç”Ÿäº§å’Œæ¶ˆè´¹çœ‹ä½œæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼, ä¸ºäº†å……åˆ†åˆ©ç”¨ CPU ç¼“å­˜, ç”Ÿäº§å’Œæ¶ˆè´¹å°½é‡æ”¾åˆ°åŒä¸€ä¸ªçº¿ç¨‹å¤„ç†, é‚£è¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢? Jetty å®šä¹‰äº† ExecutionStrategy æ¥å£:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutionStrategy")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åªåœ¨ HTTP2 ä¸­ç”¨åˆ°, ç®€å•èµ·è§, å…ˆå¿½ç•¥è¿™ä¸ªæ–¹æ³•. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®ç°å…·ä½“æ‰§è¡Œç­–ç•¥, ä»»åŠ¡ç”Ÿäº§å‡ºæ¥åå¯èƒ½ç”±å½“å‰çº¿ç¨‹æ‰§è¡Œ, ä¹Ÿå¯èƒ½ç”±æ–°çº¿ç¨‹æ¥æ‰§è¡Œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("produce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»»åŠ¡çš„ç”Ÿäº§å§”æ‰˜ç»™ Producer å†…éƒ¨æ¥å£")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Producer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”Ÿäº§ä¸€ä¸ª Runnable(ä»»åŠ¡)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("produce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ° ExecutionStrategy æ¥å£æ¯”è¾ƒç®€å•, å®ƒå°†å…·ä½“ä»»åŠ¡çš„ç”Ÿäº§å§”æ‰˜å†…éƒ¨æ¥å£ Producer, è€Œåœ¨è‡ªå·±çš„ produce() æ–¹æ³•é‡Œæ¥å®ç°å…·ä½“æ‰§è¡Œé€»è¾‘, "),t("strong",[s._v("ä¹Ÿå°±æ˜¯ç”Ÿäº§å‡ºæ¥çš„ä»»åŠ¡è¦ä¹ˆç”±å½“å‰çº¿ç¨‹æ‰§è¡Œ, è¦ä¹ˆæ”¾åˆ°æ–°çº¿ç¨‹ä¸­æ‰§è¡Œ")]),s._v(". Jetty æä¾›äº†ä¸€äº›å…·ä½“ç­–ç•¥å®ç°ç±»: "),t("strong",[s._v("ProduceConsume, ProduceExecuteConsume, ExecuteProduceConsume å’Œ EatWhatYouKill")]),s._v(". å®ƒä»¬çš„åŒºåˆ«æ˜¯:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ProduceConsume")]),s._v(": ä»»åŠ¡ç”Ÿäº§è€…"),t("strong",[s._v("è‡ªå·±ä¾æ¬¡ç”Ÿäº§å’Œæ‰§è¡Œä»»åŠ¡")]),s._v(", å¯¹åº”åˆ° NIO é€šä¿¡æ¨¡å‹å°±æ˜¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ä¾¦æµ‹å’Œå¤„ç†ä¸€ä¸ª ManagedSelector ä¸Šæ‰€æœ‰çš„ I/O äº‹ä»¶, åé¢çš„ I/O äº‹ä»¶è¦ç­‰å¾…å‰é¢çš„ I/O äº‹ä»¶å¤„ç†å®Œ, æ•ˆç‡æ˜æ˜¾ä¸é«˜. é€šè¿‡å›¾æ¥ç†è§£, å›¾ä¸­ç»¿è‰²è¡¨ç¤ºç”Ÿäº§ä¸€ä¸ªä»»åŠ¡, è“è‰²è¡¨ç¤ºæ‰§è¡Œè¿™ä¸ªä»»åŠ¡.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161601-qvnftiu.png",alt:"image"}})]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ProduceExecuteConsume")]),s._v(": ä»»åŠ¡ç”Ÿäº§è€…"),t("strong",[s._v("å¼€å¯æ–°çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡")]),s._v(", è¿™æ˜¯å…¸å‹çš„ I/O äº‹ä»¶ä¾¦æµ‹å’Œå¤„ç†ç”¨ä¸åŒçš„çº¿ç¨‹æ¥å¤„ç†, ç¼ºç‚¹æ˜¯ä¸èƒ½åˆ©ç”¨ CPU ç¼“å­˜, å¹¶ä¸”çº¿ç¨‹åˆ‡æ¢æˆæœ¬é«˜. åŒæ ·é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£, å›¾ä¸­çš„æ£•è‰²è¡¨ç¤ºçº¿ç¨‹åˆ‡æ¢.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161545-swc13gz.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ExecuteProduceConsume")]),s._v(": ä»»åŠ¡ç”Ÿäº§è€…"),t("strong",[s._v("è‡ªå·±è¿è¡Œä»»åŠ¡")]),s._v(', ä½†æ˜¯è¯¥ç­–ç•¥å¯èƒ½ä¼šæ–°å»ºä¸€ä¸ªæ–°çº¿ç¨‹ä»¥ç»§ç»­ç”Ÿäº§å’Œæ‰§è¡Œä»»åŠ¡. è¿™ç§ç­–ç•¥ä¹Ÿè¢«ç§°ä¸º "åƒæ‰ä½ æ€çš„çŒç‰©", å®ƒæ¥è‡ªç‹©çŒä¼¦ç†, è®¤ä¸ºä¸€ä¸ªäººä¸åº”è¯¥æ€æ­»ä»–ä¸åƒæ‰çš„ä¸œè¥¿, å¯¹åº”çº¿ç¨‹æ¥è¯´, ä¸åº”è¯¥ç”Ÿæˆè‡ªå·±ä¸æ‰“ç®—è¿è¡Œçš„ä»»åŠ¡. å®ƒçš„ä¼˜ç‚¹æ˜¯èƒ½åˆ©ç”¨ CPU ç¼“å­˜, ä½†æ˜¯æ½œåœ¨çš„é—®é¢˜æ˜¯å¦‚æœå¤„ç† I/O äº‹ä»¶çš„ä¸šåŠ¡ä»£ç æ‰§è¡Œæ—¶é—´è¿‡é•¿, ä¼šå¯¼è‡´çº¿ç¨‹å¤§é‡é˜»å¡å’Œçº¿ç¨‹é¥¥é¥¿.')])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161545-cezjxrf.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("EatWhatYouKill")]),s._v(": è¿™æ˜¯ Jetty å¯¹ ExecuteProduceConsume ç­–ç•¥çš„"),t("strong",[s._v("æ”¹è‰¯")]),s._v(", "),t("strong",[s._v("åœ¨çº¿ç¨‹æ± çº¿ç¨‹å……è¶³çš„æƒ…å†µä¸‹ç­‰åŒäº ExecuteProduceConsume; å½“ç³»ç»Ÿæ¯”è¾ƒå¿™çº¿ç¨‹ä¸å¤Ÿæ—¶, åˆ‡æ¢æˆ ProduceExecuteConsume ç­–ç•¥")]),s._v(". ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢, åŸå› æ˜¯ ExecuteProduceConsume æ˜¯åœ¨åŒä¸€çº¿ç¨‹æ‰§è¡Œ I/O äº‹ä»¶çš„ç”Ÿäº§å’Œæ¶ˆè´¹, å®ƒä½¿ç”¨çš„çº¿ç¨‹æ¥è‡ª Jetty å…¨å±€çš„çº¿ç¨‹æ± , è¿™äº›çº¿ç¨‹æœ‰å¯èƒ½è¢«ä¸šåŠ¡ä»£ç é˜»å¡, å¦‚æœé˜»å¡å¾—å¤šäº†, å…¨å±€çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è‡ªç„¶å°±ä¸å¤Ÿç”¨äº†, æœ€åçš„æƒ…å†µæ˜¯è¿ I/O äº‹ä»¶çš„ä¾¦æµ‹éƒ½æ²¡æœ‰çº¿ç¨‹å¯ç”¨äº†, ä¼šå¯¼è‡´ Connector æ‹’ç»æµè§ˆå™¨è¯·æ±‚. äºæ˜¯ Jetty åšäº†ä¸€ä¸ªä¼˜åŒ–, "),t("strong",[s._v("åœ¨ä½çº¿ç¨‹æƒ…å†µä¸‹, å°±æ‰§è¡Œ ProduceExecuteConsume ç­–ç•¥, I/O ä¾¦æµ‹ç”¨ä¸“é—¨çš„çº¿ç¨‹å¤„ç†, I/O äº‹ä»¶çš„å¤„ç†æ‰”ç»™çº¿ç¨‹æ± å¤„ç†, å…¶å®å°±æ˜¯æ”¾åˆ°çº¿ç¨‹æ± çš„é˜Ÿåˆ—é‡Œæ…¢æ…¢å¤„ç†")]),s._v(".")])]),s._v(" "),t("p",[s._v("åˆ†æäº†è¿™å‡ ç§çº¿ç¨‹ç­–ç•¥, å†æ¥çœ‹çœ‹ Jetty æ˜¯å¦‚ä½•å®ç° ExecutionStrategy æ¥å£çš„. ç­”æ¡ˆå…¶å®å°±æ˜¯å®ç° produce æ¥å£ç”Ÿäº§ä»»åŠ¡, ä¸€æ—¦ä»»åŠ¡ç”Ÿäº§å‡ºæ¥, ExecutionStrategy ä¼šè´Ÿè´£æ‰§è¡Œè¿™ä¸ªä»»åŠ¡.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectorProducer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutionStrategy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Producer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("emptySet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iterator")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SelectionKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _cursor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("emptyIterator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("produce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚ä½• Channel é›†åˆä¸­æœ‰ I/O äº‹ä»¶å°±ç»ª, è°ƒç”¨å‰é¢æåˆ°çš„ Selectable æ¥å£è·å– Runnable, ç›´æ¥è¿”å›ç»™ ExecutionStrategy å»å¤„ç†")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processSelected")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ²¡æœ‰ I/O äº‹ä»¶å°±ç»ª, å°±å¹²ç‚¹æ‚æ´», çœ‹çœ‹æœ‰æ²¡æœ‰å®¢æˆ·æäº¤äº†æ›´æ–° Selector çš„ä»»åŠ¡, å°±æ˜¯ä¸Šé¢æåˆ°çš„ SelectorUpdate ä»»åŠ¡ç±». ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processUpdates")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateKeys")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç»§ç»­æ‰§è¡Œ select æ–¹æ³•, ä¾¦æµ‹ I/O å°±ç»ªäº‹ä»¶")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("SelectorProducer æ˜¯ ManagedSelector çš„å†…éƒ¨ç±», SelectorProducer å®ç°äº† ExecutionStrategy ä¸­çš„ Producer æ¥å£ä¸­çš„ produce() æ–¹æ³•, éœ€è¦å‘ ExecutionStrategy è¿”å›ä¸€ä¸ª Runnable. åœ¨è¿™ä¸ªæ–¹æ³•é‡Œ SelectorProducer ä¸»è¦å¹²äº†ä¸‰ä»¶äº‹æƒ…")]),s._v(" "),t("ol",[t("li",[s._v("å¦‚æœ Channel é›†åˆä¸­æœ‰ I/O äº‹ä»¶å°±ç»ª, è°ƒç”¨å‰é¢æåˆ°çš„ Selectable æ¥å£è·å– Runnable, ç›´æ¥è¿”å›ç»™ ExecutionStrategy å»å¤„ç†.")]),s._v(" "),t("li",[s._v("å¦‚æœæ²¡æœ‰ I/O äº‹ä»¶å°±ç»ª, å°±å¹²ç‚¹æ‚æ´», çœ‹çœ‹æœ‰æ²¡æœ‰å®¢æˆ·æäº¤äº†æ›´æ–° Selector ä¸Šäº‹ä»¶æ³¨å†Œçš„ä»»åŠ¡, ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ SelectorUpdate ä»»åŠ¡ç±».")]),s._v(" "),t("li",[s._v("å¹²å®Œæ‚æ´»ç»§ç»­æ‰§è¡Œ select æ–¹æ³•, ä¾¦æµ‹ I/O å°±ç»ªäº‹ä»¶.")])]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-7"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("å¤šçº¿ç¨‹è™½ç„¶æ˜¯æé«˜å¹¶å‘çš„æ³•å®, ä½†å¹¶ä¸æ˜¯è¯´çº¿ç¨‹è¶Šå¤šè¶Šå¥½, CPU ç¼“å­˜ä»¥åŠçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„. "),t("strong",[s._v("Jetty å·§å¦™è®¾è®¡äº† EatWhatYouKill çš„çº¿ç¨‹ç­–ç•¥, å°½é‡ç”¨åŒä¸€ä¸ªçº¿ç¨‹ä¾¦æµ‹ I/O äº‹ä»¶å’Œå¤„ç† I/O äº‹ä»¶, å……åˆ†åˆ©ç”¨äº† CPU ç¼“å­˜, å¹¶å‡å°‘äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"_20-æ€»ç»“-tomcatå’Œjettyä¸­çš„å¯¹è±¡æ± æŠ€æœ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_20-æ€»ç»“-tomcatå’Œjettyä¸­çš„å¯¹è±¡æ± æŠ€æœ¯"}},[s._v("#")]),s._v(" 20.æ€»ç»“:Tomcatå’ŒJettyä¸­çš„å¯¹è±¡æ± æŠ€æœ¯")]),s._v(" "),t("p",[s._v("Java å¯¹è±¡, ç‰¹åˆ«æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§, æ¯”è¾ƒå¤æ‚çš„ Java å¯¹è±¡, å®ƒä»¬çš„åˆ›å»º, åˆå§‹åŒ–å’Œ GC éƒ½éœ€è¦è€—è´¹ CPU å’Œå†…å­˜èµ„æº, ä¸ºäº†å‡å°‘è¿™äº›å¼€é”€, Tomcat å’Œ Jetty éƒ½ä½¿ç”¨äº†"),t("strong",[s._v("å¯¹è±¡æ± æŠ€æœ¯")]),s._v(". æ‰€è°“çš„"),t("strong",[s._v("å¯¹è±¡æ± æŠ€æœ¯, å°±æ˜¯è¯´ä¸€ä¸ª Java å¯¹è±¡ç”¨å®Œä¹‹åæŠŠå®ƒä¿å­˜èµ·æ¥, ä¹‹åå†æ‹¿å‡ºæ¥é‡å¤ä½¿ç”¨, çœå»äº†å¯¹è±¡åˆ›å»º, åˆå§‹åŒ–å’Œ GC çš„è¿‡ç¨‹")]),s._v(". å¯¹è±¡æ± æŠ€æœ¯æ˜¯å…¸å‹çš„ä»¥"),t("strong",[s._v("ç©ºé—´æ¢æ—¶é—´")]),s._v("çš„æ€è·¯.")]),s._v(" "),t("p",[s._v("ç”±äºç»´æŠ¤å¯¹è±¡æ± æœ¬èº«ä¹Ÿéœ€è¦èµ„æºçš„å¼€é”€, ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½é€‚åˆç”¨å¯¹è±¡æ± . "),t("strong",[s._v("å¦‚æœä½ çš„ Java å¯¹è±¡æ•°é‡å¾ˆå¤šå¹¶ä¸”å­˜åœ¨çš„æ—¶é—´æ¯”è¾ƒçŸ­, å¯¹è±¡æœ¬èº«åˆæ¯”è¾ƒå¤§æ¯”è¾ƒå¤æ‚, å¯¹è±¡åˆå§‹åŒ–çš„æˆæœ¬æ¯”è¾ƒé«˜, è¿™æ ·çš„åœºæ™¯å°±é€‚åˆç”¨å¯¹è±¡æ± æŠ€æœ¯")]),s._v(". æ¯”å¦‚ Tomcat å’Œ Jetty å¤„ç† HTTP è¯·æ±‚çš„åœºæ™¯å°±ç¬¦åˆè¿™ä¸ªç‰¹å¾, è¯·æ±‚çš„æ•°é‡å¾ˆå¤š, ä¸ºäº†å¤„ç†å•ä¸ªè¯·æ±‚éœ€è¦åˆ›å»ºä¸å°‘çš„å¤æ‚å¯¹è±¡(æ¯”å¦‚ Tomcat è¿æ¥å™¨ä¸­ SocketWrapper å’Œ SocketProcessor), è€Œä¸”ä¸€èˆ¬æ¥è¯´è¯·æ±‚å¤„ç†çš„æ—¶é—´æ¯”è¾ƒçŸ­, ä¸€æ—¦è¯·æ±‚å¤„ç†å®Œæ¯•, è¿™äº›å¯¹è±¡å°±éœ€è¦è¢«é”€æ¯, å› æ­¤è¿™ä¸ªåœºæ™¯é€‚åˆå¯¹è±¡æ± æŠ€æœ¯.")]),s._v(" "),t("h5",{attrs:{id:"tomcatçš„synchronizedstack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatçš„synchronizedstack"}},[s._v("#")]),s._v(" Tomcatçš„SynchronizedStack")]),s._v(" "),t("p",[s._v("Tomcat ç”¨ "),t("strong",[s._v("SynchronizedStack ç±»")]),s._v("æ¥å®ç°å¯¹è±¡æ± , ä¸‹é¢æ˜¯å®ƒçš„å…³é”®ä»£ç .")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SynchronizedStack")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå¯¹è±¡æ•°ç»„, ç”¨æ•°ç»„å®ç°æ ˆçš„åŠŸèƒ½")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" stack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™ä¸ªæ–¹æ³•ç”¨æ¥å½’è¿˜å¯¹è±¡, ç”¨ synchronized è¿›è¡Œçº¿ç¨‹åŒæ­¥")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("push")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        index"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("limit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" limit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expand")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯¹è±¡ä¸å¤Ÿç”¨äº†, æ‰©å±•å¯¹è±¡æ•°ç»„")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                index"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™ä¸ªæ–¹æ³•ç”¨æ¥è·å–å¯¹è±¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" stack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        stack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("index"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰©å±•å¯¹è±¡æ•°ç»„é•¿åº¦, ä»¥ 2 å€å¤§å°æ‰©å±•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expand")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" newSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("limit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" newSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" limit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          newSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" limit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰©å±•ç­–ç•¥æ˜¯åˆ›å»ºä¸€ä¸ªæ•°ç»„é•¿åº¦ä¸ºåŸæ¥ä¸¤å€çš„æ–°æ•°ç»„")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" newStack "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("newSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†è€æ•°ç»„å¯¹è±¡å¼•ç”¨å¤åˆ¶åˆ°æ–°æ•°ç»„")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("arraycopy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newStack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°† stack æŒ‡å‘æ–°æ•°ç»„, è€æ•°ç»„å¯ä»¥è¢« GC æ‰äº†")]),s._v("\n      stack "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" newStack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" newSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br")])]),t("p",[s._v("è¿™ä¸ªä»£ç é€»è¾‘æ¯”è¾ƒæ¸…æ™°, ä¸»è¦æ˜¯ SynchronizedStack å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª"),t("strong",[s._v("å¯¹è±¡æ•°ç»„")]),s._v(", å¹¶ä¸”ç”¨æ•°ç»„æ¥å®ç°æ ˆçš„æ¥å£: "),t("strong",[s._v("push() å’Œ pop() æ–¹æ³•, è¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«ç”¨æ¥å½’è¿˜å¯¹è±¡å’Œè·å–å¯¹è±¡")]),s._v(". ä½ å¯èƒ½å¥½å¥‡ä¸ºä»€ä¹ˆ Tomcat ä½¿ç”¨ä¸€ä¸ªçœ‹èµ·æ¥æ¯”è¾ƒç®€å•çš„ SynchronizedStack æ¥åšå¯¹è±¡å®¹å™¨, ä¸ºä»€ä¹ˆä¸ä½¿ç”¨é«˜çº§ä¸€ç‚¹çš„å¹¶å‘å®¹å™¨æ¯”å¦‚ ConcurrentLinkedQueue å‘¢?")]),s._v(" "),t("p",[s._v("è¿™æ˜¯"),t("strong",[s._v("å› ä¸º SynchronizedStack ç”¨æ•°ç»„è€Œä¸æ˜¯é“¾è¡¨æ¥ç»´æŠ¤å¯¹è±¡, å¯ä»¥å‡å°‘ç»“ç‚¹ç»´æŠ¤çš„å†…å­˜å¼€é”€, å¹¶ä¸”å®ƒæœ¬èº«åªæ”¯æŒæ‰©å®¹ä¸æ”¯æŒç¼©å®¹, ä¹Ÿå°±æ˜¯è¯´æ•°ç»„å¯¹è±¡åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸ä¼šè¢«é‡æ–°èµ‹å€¼, ä¹Ÿå°±ä¸ä¼šè¢« GC")]),s._v(". è¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ç”¨æœ€ä½çš„å†…å­˜å’Œ GC çš„ä»£ä»·æ¥å®ç°æ— ç•Œå®¹å™¨, åŒæ—¶ Tomcat çš„æœ€å¤§åŒæ—¶è¯·æ±‚æ•°æ˜¯æœ‰é™åˆ¶çš„, å› æ­¤ä¸éœ€è¦æ‹…å¿ƒå¯¹è±¡çš„æ•°é‡ä¼šæ— é™è†¨èƒ€.")]),s._v(" "),t("h5",{attrs:{id:"jettyçš„bytebufferpool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jettyçš„bytebufferpool"}},[s._v("#")]),s._v(" Jettyçš„ByteBufferPool")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹ Jetty ä¸­çš„"),t("strong",[s._v("å¯¹è±¡æ±  ByteBufferPool")]),s._v(", å®ƒæœ¬è´¨æ˜¯ä¸€ä¸ª "),t("strong",[s._v("ByteBuffer å¯¹è±¡æ± ")]),s._v(". å½“ Jetty åœ¨è¿›è¡Œç½‘ç»œæ•°æ®è¯»å†™æ—¶, ä¸éœ€è¦æ¯æ¬¡éƒ½åœ¨ JVM å †ä¸Šåˆ†é…ä¸€å—æ–°çš„ Buffer, åªéœ€åœ¨ ByteBuffer å¯¹è±¡æ± é‡Œæ‹¿åˆ°ä¸€å—é¢„å…ˆåˆ†é…å¥½çš„ Buffer, è¿™æ ·å°±é¿å…äº†é¢‘ç¹çš„åˆ†é…å†…å­˜å’Œé‡Šæ”¾å†…å­˜. è¿™ç§è®¾è®¡åŒæ ·å¯ä»¥åœ¨é«˜æ€§èƒ½é€šä¿¡ä¸­é—´ä»¶æ¯”å¦‚ Mina å’Œ Netty ä¸­çœ‹åˆ°. ByteBufferPool æ˜¯ä¸€ä¸ªæ¥å£:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" direct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("æ¥å£ä¸­çš„ä¸¤ä¸ªæ–¹æ³•: acquire() å’Œ release() åˆ†åˆ«ç”¨æ¥åˆ†é…å’Œé‡Šæ”¾å†…å­˜, å¹¶ä¸”å¯ä»¥é€šè¿‡ acquire() æ–¹æ³•çš„ direct å‚æ•°æ¥æŒ‡å®š buffer æ˜¯ä» JVM å †ä¸Šåˆ†é…è¿˜æ˜¯ä»æœ¬åœ°å†…å­˜åˆ†é…. ArrayByteBufferPool æ˜¯ ByteBufferPool çš„å®ç°ç±», å…ˆæ¥çœ‹çœ‹å®ƒçš„æˆå‘˜å˜é‡å’Œæ„é€ å‡½æ•°:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayByteBufferPool")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" _min"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœ€å° size çš„ Buffer é•¿åº¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" _maxQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Queue æœ€å¤§é•¿åº¦")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨ä¸åŒçš„ Bucket(æ¡¶) æ¥æŒæœ‰ä¸åŒ size çš„ ByteBuffer å¯¹è±¡, åŒä¸€ä¸ªæ¡¶ä¸­çš„ ByteBuffer size æ˜¯ä¸€æ ·çš„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Bucket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" _direct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Bucket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" _indirect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ByteBuffer çš„ size å¢é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" _inc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayByteBufferPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" minSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ£€æŸ¥å‚æ•°å€¼å¹¶è®¾ç½®é»˜è®¤å€¼")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("minSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ByteBuffer çš„æœ€å°é•¿åº¦")]),s._v("\n            minSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("increment"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            increment"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é»˜è®¤ä»¥ 1024 é€’å¢")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            maxSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ByteBuffer çš„æœ€å¤§é•¿åº¦é»˜è®¤æ˜¯ 64K")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ByteBuffer çš„æœ€å°é•¿åº¦å¿…é¡»å°äºå¢é‡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("minSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v("increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minSize >= increment"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœ€å¤§é•¿åº¦å¿…é¡»æ˜¯å¢é‡çš„æ•´æ•°å€")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" increment"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v("maxSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"increment must be a divisor of maxSize"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n        _min"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("minSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        _inc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º maxSize/increment ä¸ªæ¡¶, åŒ…å«ç›´æ¥å†…å­˜çš„ä¸ heap çš„")]),s._v("\n        _direct"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Bucket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("maxSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        _indirect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Bucket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("maxSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        _maxQueue"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("maxQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("_direct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v("_inc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          _direct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Bucket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("_maxQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          _indirect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Bucket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("_maxQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°, ByteBufferPool æ˜¯ç”¨ä¸åŒçš„æ¡¶(Bucket)æ¥ç®¡ç†ä¸åŒé•¿åº¦çš„ ByteBuffer, å› ä¸ºå¯èƒ½éœ€è¦åˆ†é…ä¸€å— 1024 å­—èŠ‚çš„ Buffer, ä¹Ÿå¯èƒ½éœ€è¦ä¸€å— 64K å­—èŠ‚çš„ Buffer. è€Œæ¡¶çš„å†…éƒ¨ç”¨ä¸€ä¸ª ConcurrentLinkedDeque æ¥æ”¾ç½® ByteBuffer å¯¹è±¡çš„å¼•ç”¨.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Deque")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _queue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentLinkedDeque")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¯ä»¥é€šè¿‡ä¸‹é¢çš„å›¾å†æ¥ç†è§£ä¸€ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161619-0j3p51e.png",alt:""}})]),s._v(" "),t("p",[s._v("è€Œ Buffer çš„åˆ†é…å’Œé‡Šæ”¾è¿‡ç¨‹, å°±æ˜¯æ‰¾åˆ°ç›¸åº”çš„æ¡¶, å¹¶å¯¹æ¡¶ä¸­çš„ Deque åšå‡ºé˜Ÿå’Œå…¥é˜Ÿçš„æ“ä½œ, è€Œä¸æ˜¯ç›´æ¥å‘ JVM å †ç”³è¯·å’Œé‡Šæ”¾å†…å­˜.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ†é… Buffer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" direct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰¾åˆ°å¯¹åº”çš„æ¡¶, æ²¡æœ‰çš„è¯åˆ›å»ºä¸€ä¸ªæ¡¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Bucket")]),s._v(" bucket "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bucketFor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("direct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bucket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newByteBuffer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("direct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œå…¶å®è°ƒç”¨äº† Deque çš„ poll æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" bucket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("direct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾ Buffer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBuffer")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰¾åˆ°å¯¹åº”çš„æ¡¶")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ByteBufferPool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Bucket")]),s._v(" bucket "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bucketFor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("capacity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isDirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œè°ƒç”¨äº† Deque çš„ offerFirst æ–¹æ³•")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bucket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      bucket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("h5",{attrs:{id:"å¯¹è±¡æ± çš„æ€è€ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯¹è±¡æ± çš„æ€è€ƒ"}},[s._v("#")]),s._v(" å¯¹è±¡æ± çš„æ€è€ƒ")]),s._v(" "),t("p",[t("strong",[s._v("å¯¹è±¡æ± ä½œä¸ºå…¨å±€èµ„æº, é«˜å¹¶å‘ç¯å¢ƒä¸­å¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶éœ€è¦è·å–å¯¹è±¡æ± ä¸­çš„å¯¹è±¡, å› æ­¤å¤šä¸ªçº¿ç¨‹åœ¨äº‰æŠ¢å¯¹è±¡æ—¶ä¼šå› ä¸ºé”ç«äº‰è€Œé˜»å¡, å› æ­¤ä½¿ç”¨å¯¹è±¡æ± æœ‰çº¿ç¨‹åŒæ­¥çš„å¼€é”€, è€Œä¸ä½¿ç”¨å¯¹è±¡æ± åˆ™æœ‰åˆ›å»ºå’Œé”€æ¯å¯¹è±¡çš„å¼€é”€")]),s._v(". å¯¹äºå¯¹è±¡æ± æœ¬èº«çš„è®¾è®¡æ¥è¯´, éœ€è¦å°½é‡åšåˆ°"),t("strong",[s._v("æ— é”åŒ–")]),s._v(", æ¯”å¦‚ Jetty å°±ä½¿ç”¨äº† ConcurrentLinkedDeque. å¦‚æœå†…å­˜è¶³å¤Ÿå¤§, å¯ä»¥è€ƒè™‘ç”¨"),t("strong",[s._v("çº¿ç¨‹æœ¬åœ°(ThreadLocal)å¯¹è±¡æ± ")]),s._v(", è¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å¯¹è±¡æ± , çº¿ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°.")]),s._v(" "),t("p",[t("strong",[s._v("ä¸ºäº†é˜²æ­¢å¯¹è±¡æ± çš„æ— é™è†¨èƒ€, å¿…é¡»è¦å¯¹æ± çš„å¤§å°åšé™åˆ¶")]),s._v(". å¯¹è±¡æ± å¤ªå°å‘æŒ¥ä¸äº†ä½œç”¨, å¯¹è±¡æ± å¤ªå¤§çš„è¯å¯èƒ½æœ‰ç©ºé—²å¯¹è±¡, è¿™äº›ç©ºé—²å¯¹è±¡ä¼šä¸€ç›´å ç”¨å†…å­˜, é€ æˆå†…å­˜æµªè´¹. å› æ­¤éœ€è¦æ ¹æ®å®é™…æƒ…å†µåšä¸€ä¸ªå¹³è¡¡, å› æ­¤å¯¹è±¡æ± æœ¬èº«é™¤äº†åº”è¯¥æœ‰è‡ªåŠ¨æ‰©å®¹çš„åŠŸèƒ½, è¿˜éœ€è¦è€ƒè™‘è‡ªåŠ¨ç¼©å®¹.")]),s._v(" "),t("p",[t("strong",[s._v("æ‰€æœ‰çš„æ± åŒ–æŠ€æœ¯, åŒ…æ‹¬ç¼“å­˜, éƒ½ä¼šé¢ä¸´å†…å­˜æ³„éœ²çš„é—®é¢˜")]),s._v(", åŸå› æ˜¯å¯¹è±¡æ± æˆ–è€…ç¼“å­˜çš„æœ¬è´¨æ˜¯ä¸€ä¸ª Java é›†åˆç±», æ¯”å¦‚ List å’Œ Stack, è¿™ä¸ªé›†åˆç±»æŒæœ‰ç¼“å­˜å¯¹è±¡çš„å¼•ç”¨, åªè¦é›†åˆç±»ä¸è¢« GC, ç¼“å­˜å¯¹è±¡ä¹Ÿä¸ä¼šè¢« GC. ç»´æŒå¤§é‡çš„å¯¹è±¡ä¹Ÿæ¯”è¾ƒå ç”¨å†…å­˜ç©ºé—´, æ‰€ä»¥å¿…è¦æ—¶éœ€è¦ä¸»åŠ¨æ¸…ç†è¿™äº›å¯¹è±¡. ä»¥ Java çš„çº¿ç¨‹æ±  ThreadPoolExecutor ä¸ºä¾‹, å®ƒæä¾›äº† allowCoreThreadTimeOut å’Œ setKeepAliveTime ä¸¤ç§æ–¹æ³•, å¯ä»¥åœ¨è¶…æ—¶åé”€æ¯çº¿ç¨‹, åœ¨å®é™…é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªç­–ç•¥.")]),s._v(" "),t("p",[s._v("å¦å¤–åœ¨ä½¿ç”¨å¯¹è±¡æ± æ—¶, è¿˜æœ‰ä¸€äº›å°è´´å£«å¯ä»¥å‚è€ƒ:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("å¯¹è±¡åœ¨ç”¨å®Œå, éœ€è¦è°ƒç”¨å¯¹è±¡æ± çš„æ–¹æ³•å°†å¯¹è±¡å½’è¿˜ç»™å¯¹è±¡æ± .")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code")]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"})])]),s._v(" "),t("li",[t("p",[s._v("å¯¹è±¡æ± ä¸­çš„å¯¹è±¡åœ¨å†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡ç½®, å¦åˆ™ä¼šäº§ç”Ÿè„å¯¹è±¡, è„å¯¹è±¡å¯èƒ½æŒæœ‰ä¸Šæ¬¡ä½¿ç”¨çš„å¼•ç”¨, å¯¼è‡´å†…å­˜æ³„æ¼ç­‰é—®é¢˜, å¹¶ä¸”å¦‚æœè„å¯¹è±¡ä¸‹ä¸€æ¬¡ä½¿ç”¨æ—¶æ²¡æœ‰è¢«æ¸…ç†, ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„é—®é¢˜.")])]),s._v(" "),t("li",[t("p",[s._v("å¯¹è±¡ä¸€æ—¦å½’è¿˜ç»™å¯¹è±¡æ± , ä½¿ç”¨è€…å°±ä¸èƒ½å¯¹å®ƒåšä»»ä½•æ“ä½œäº†.")])]),s._v(" "),t("li",[t("p",[s._v("å‘å¯¹è±¡æ± è¯·æ±‚å¯¹è±¡æ—¶æœ‰å¯èƒ½å‡ºç°çš„é˜»å¡, å¼‚å¸¸æˆ–è€…è¿”å› null å€¼, è¿™äº›éƒ½éœ€è¦åšä¸€äº›é¢å¤–çš„å¤„ç†, æ¥ç¡®ä¿ç¨‹åºçš„æ­£å¸¸è¿è¡Œ.")])])]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-8"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Tomcat å’Œ Jetty éƒ½ç”¨åˆ°äº†å¯¹è±¡æ± æŠ€æœ¯, è¿™æ˜¯å› ä¸ºå¤„ç†ä¸€æ¬¡ HTTP è¯·æ±‚çš„æ—¶é—´æ¯”è¾ƒçŸ­, ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­åˆéœ€è¦åˆ›å»ºå¤§é‡å¤æ‚å¯¹è±¡.")]),s._v(" "),t("p",[t("strong",[s._v("å¯¹è±¡æ± æŠ€æœ¯å¯ä»¥å‡å°‘é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¯¹è±¡å¸¦æ¥çš„æˆæœ¬, å®ç°å¯¹è±¡çš„ç¼“å­˜å’Œå¤ç”¨. å¦‚æœç³»ç»Ÿéœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å¯¹è±¡, å¹¶ä¸”å¯¹è±¡çš„åˆ›å»ºä»£ä»·æ¯”è¾ƒå¤§, è¿™ç§æƒ…å†µä¸‹, ä¸€èˆ¬æ¥è¯´ä½ ä¼šè§‚å¯Ÿåˆ° GC çš„å‹åŠ›æ¯”è¾ƒå¤§, å ç”¨ CPU ç‡æ¯”è¾ƒé«˜, è¿™ä¸ªæ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨å¯¹è±¡æ± äº†.")])]),s._v(" "),t("p",[t("strong",[s._v("è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯éœ€è¦å¯¹èµ„æºçš„ä½¿ç”¨åšé™åˆ¶, æ¯”å¦‚æ•°æ®åº“è¿æ¥, ä¸èƒ½æ— é™åˆ¶åœ°åˆ›å»ºæ•°æ®åº“è¿æ¥, å› æ­¤å°±æœ‰äº†æ•°æ®åº“è¿æ¥æ± , ä¹Ÿå¯ä»¥è€ƒè™‘æŠŠä¸€äº›å…³é”®çš„èµ„æºæ± åŒ–, å¯¹å®ƒä»¬è¿›è¡Œç»Ÿä¸€ç®¡ç†, é˜²æ­¢æ»¥ç”¨.")])]),s._v(" "),t("h4",{attrs:{id:"_21-æ€»ç»“-tomcatå’Œjettyçš„é«˜æ€§èƒ½-é«˜å¹¶å‘ä¹‹é“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_21-æ€»ç»“-tomcatå’Œjettyçš„é«˜æ€§èƒ½-é«˜å¹¶å‘ä¹‹é“"}},[s._v("#")]),s._v(" 21.æ€»ç»“:Tomcatå’ŒJettyçš„é«˜æ€§èƒ½, é«˜å¹¶å‘ä¹‹é“")]),s._v(" "),t("p",[t("strong",[s._v("é«˜æ€§èƒ½ç¨‹åºå°±æ˜¯é«˜æ•ˆçš„åˆ©ç”¨ CPU, å†…å­˜, ç½‘ç»œå’Œç£ç›˜ç­‰èµ„æº, åœ¨çŸ­æ—¶é—´å†…å¤„ç†å¤§é‡çš„è¯·æ±‚")]),s._v('. é‚£å¦‚ä½•è¡¡é‡"çŸ­æ—¶é—´å’Œå¤§é‡"å‘¢? å…¶å®å°±æ˜¯ä¸¤ä¸ªå…³é”®æŒ‡æ ‡: '),t("strong",[s._v("å“åº”æ—¶é—´å’Œæ¯ç§’äº‹åŠ¡å¤„ç†é‡(TPS)")]),s._v(" .")]),s._v(" "),t("p",[s._v("é‚£ä»€ä¹ˆæ˜¯èµ„æºçš„é«˜æ•ˆåˆ©ç”¨å‘¢? æœ‰ä¸¤ä¸ªåŸåˆ™:")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å‡å°‘èµ„æºæµªè´¹")]),s._v(". æ¯”å¦‚å°½é‡é¿å…çº¿ç¨‹é˜»å¡, å› ä¸ºä¸€é˜»å¡å°±ä¼šå‘ç”Ÿçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢, å°±éœ€è¦è€—è´¹ CPU èµ„æº; å†æ¯”å¦‚ç½‘ç»œé€šä¿¡æ—¶æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ° Java å †å†…å­˜, éœ€è¦é€šè¿‡æœ¬åœ°å†…å­˜ä¸­è½¬.")]),s._v(" "),t("li",[t("strong",[s._v("å½“æŸç§èµ„æºæˆä¸ºç“¶é¢ˆæ—¶, ç”¨å¦ä¸€ç§èµ„æºæ¥æ¢å–")]),s._v(". æ¯”å¦‚ç¼“å­˜å’Œå¯¹è±¡æ± æŠ€æœ¯å°±æ˜¯ç”¨å†…å­˜æ¢ CPU; æ•°æ®å‹ç¼©åå†ä¼ è¾“å°±æ˜¯ç”¨ CPU æ¢ç½‘ç»œ.")])]),s._v(" "),t("p",[s._v("Tomcat å’Œ Jetty ä¸­ç”¨åˆ°äº†å¤§é‡çš„é«˜æ€§èƒ½, é«˜å¹¶å‘çš„è®¾è®¡, è¿™é‡Œæ€»ç»“äº†å‡ ç‚¹: I/O å’Œçº¿ç¨‹æ¨¡å‹, å‡å°‘ç³»ç»Ÿè°ƒç”¨, æ± åŒ–, é›¶æ‹·è´, é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹. ä¸‹é¢è¯¦ç»†ä»‹ç»è¿™äº›è®¾è®¡.")]),s._v(" "),t("h5",{attrs:{id:"i-oå’Œçº¿ç¨‹æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#i-oå’Œçº¿ç¨‹æ¨¡å‹"}},[s._v("#")]),s._v(" I/Oå’Œçº¿ç¨‹æ¨¡å‹")]),s._v(" "),t("p",[t("strong",[s._v("I/O æ¨¡å‹çš„æœ¬è´¨å°±æ˜¯ä¸ºäº†ç¼“è§£ CPU å’Œå¤–è®¾ä¹‹é—´çš„é€Ÿåº¦å·®")]),s._v(". å½“çº¿ç¨‹å‘èµ· I/O è¯·æ±‚æ—¶, æ¯”å¦‚è¯»å†™ç½‘ç»œæ•°æ®, ç½‘å¡æ•°æ®è¿˜æ²¡å‡†å¤‡å¥½, è¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é˜»å¡, è®©å‡º CPU, ä¹Ÿå°±æ˜¯è¯´å‘ç”Ÿäº†çº¿ç¨‹åˆ‡æ¢. è€Œçº¿ç¨‹åˆ‡æ¢æ˜¯æ— ç”¨åŠŸ, å¹¶ä¸”çº¿ç¨‹è¢«é˜»å¡å, å®ƒæŒæœ‰å†…å­˜èµ„æºå¹¶æ²¡æœ‰é‡Šæ”¾, é˜»å¡çš„çº¿ç¨‹è¶Šå¤š, æ¶ˆè€—çš„å†…å­˜å°±è¶Šå¤§, "),t("strong",[s._v("å› æ­¤ I/O æ¨¡å‹çš„ç›®æ ‡å°±æ˜¯å°½é‡å‡å°‘çº¿ç¨‹é˜»å¡")]),s._v(". Tomcat å’Œ Jetty éƒ½å·²ç»æŠ›å¼ƒäº†ä¼ ç»Ÿçš„åŒæ­¥é˜»å¡ I/O, é‡‡ç”¨äº†éé˜»å¡ I/O æˆ–è€…å¼‚æ­¥ I/O, ç›®çš„æ˜¯ä¸šåŠ¡çº¿ç¨‹ä¸éœ€è¦é˜»å¡åœ¨ I/O ç­‰å¾…ä¸Š.")]),s._v(" "),t("p",[s._v("é™¤äº† I/O æ¨¡å‹, "),t("strong",[s._v("çº¿ç¨‹æ¨¡å‹ä¹Ÿæ˜¯å½±å“æ€§èƒ½å’Œå¹¶å‘çš„å…³é”®ç‚¹")]),s._v(". Tomcat å’Œ Jetty çš„æ€»ä½“å¤„ç†åŸåˆ™æ˜¯:")]),s._v(" "),t("ul",[t("li",[s._v("è¿æ¥è¯·æ±‚ç”±ä¸“é—¨çš„ Acceptor çº¿ç¨‹ç»„å¤„ç†.")]),s._v(" "),t("li",[s._v("I/O äº‹ä»¶ä¾¦æµ‹ä¹Ÿç”±ä¸“é—¨çš„ Selector çº¿ç¨‹ç»„æ¥å¤„ç†.")]),s._v(" "),t("li",[s._v("å…·ä½“çš„åè®®è§£æå’Œä¸šåŠ¡å¤„ç†å¯èƒ½äº¤ç»™çº¿ç¨‹æ± (Tomcat), æˆ–è€…äº¤ç»™ Selector çº¿ç¨‹æ¥å¤„ç†(Jetty).")])]),s._v(" "),t("p",[s._v("å°†è¿™äº›äº‹æƒ…åˆ†å¼€çš„å¥½å¤„æ˜¯è§£è€¦, å¹¶ä¸”å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåˆç†è®¾ç½®å„éƒ¨åˆ†çš„çº¿ç¨‹æ•°. è¿™é‡Œè¯·æ³¨æ„, çº¿ç¨‹æ•°å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½, å› ä¸º CPU æ ¸çš„ä¸ªæ•°æœ‰é™, çº¿ç¨‹å¤ªå¤šä¹Ÿå¤„ç†ä¸è¿‡æ¥, ä¼šå¯¼è‡´å¤§é‡çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢.")]),s._v(" "),t("h5",{attrs:{id:"å‡å°‘ç³»ç»Ÿè°ƒç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‡å°‘ç³»ç»Ÿè°ƒç”¨"}},[s._v("#")]),s._v(" å‡å°‘ç³»ç»Ÿè°ƒç”¨")]),s._v(" "),t("p",[s._v("å…¶å®ç³»ç»Ÿè°ƒç”¨æ˜¯éå¸¸è€—èµ„æºçš„ä¸€ä¸ªè¿‡ç¨‹, æ¶‰åŠ CPU ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„è¿‡ç¨‹, å› æ­¤åœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™è¦æœ‰æ„è¯†å°½é‡é¿å…ç³»ç»Ÿè°ƒç”¨. æ¯”å¦‚åœ¨ Tomcat å’Œ Jetty ä¸­, ç³»ç»Ÿè°ƒç”¨æœ€å¤šçš„å°±æ˜¯ç½‘ç»œé€šä¿¡æ“ä½œäº†, ä¸€ä¸ª Channel ä¸Šçš„ write å°±æ˜¯ç³»ç»Ÿè°ƒç”¨, "),t("strong",[s._v("ä¸ºäº†é™ä½ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°, æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ç¼“å†², å½“è¾“å‡ºæ•°æ®è¾¾åˆ°ä¸€å®šçš„å¤§å°æ‰ flush ç¼“å†²åŒº. Tomcat å’Œ Jetty çš„ Channel éƒ½å¸¦æœ‰è¾“å…¥è¾“å‡ºç¼“å†²åŒº")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿˜æœ‰å€¼å¾—ä¸€æçš„æ˜¯, Tomcat å’Œ Jetty åœ¨è§£æ HTTP åè®®æ•°æ®æ—¶,  éƒ½é‡‡å–äº†"),t("strong",[s._v("å»¶è¿Ÿè§£æ")]),s._v("çš„ç­–ç•¥, HTTP çš„è¯·æ±‚ä½“(HTTP Body)ç›´åˆ°ç”¨çš„æ—¶å€™æ‰è§£æ. ä¹Ÿå°±æ˜¯è¯´, å½“ Tomcat è°ƒç”¨ Servlet çš„ service() æ–¹æ³•æ—¶, åªæ˜¯è¯»å–äº†å’Œè§£æäº† HTTP è¯·æ±‚å¤´, å¹¶æ²¡æœ‰è¯»å– HTTP è¯·æ±‚ä½“. "),t("strong",[s._v("ç›´åˆ° Web åº”ç”¨ç¨‹åºè°ƒç”¨äº† ServletRequest å¯¹è±¡çš„ getInputStream() æ–¹æ³•æˆ–è€… getParameter() æ–¹æ³•æ—¶, Tomcat æ‰ä¼šå»è¯»å–å’Œè§£æ HTTP è¯·æ±‚ä½“ä¸­çš„æ•°æ®")]),s._v("; è¿™æ„å‘³ç€å¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰è°ƒç”¨ä¸Šé¢é‚£ä¸¤ä¸ªæ–¹æ³•, HTTP è¯·æ±‚ä½“çš„æ•°æ®å°±ä¸ä¼šè¢«è¯»å–å’Œè§£æ, è¿™æ ·å°±çœæ‰äº†ä¸€æ¬¡ I/O ç³»ç»Ÿè°ƒç”¨.")]),s._v(" "),t("h5",{attrs:{id:"æ± åŒ–-é›¶æ‹·è´"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ± åŒ–-é›¶æ‹·è´"}},[s._v("#")]),s._v(" æ± åŒ–,é›¶æ‹·è´")]),s._v(" "),t("p",[s._v("å‰é¢å·²ç»åˆ†æè¿‡æ± åŒ–å’Œé›¶æ‹·è´. å…¶å®æ± åŒ–çš„æœ¬è´¨å°±æ˜¯ç”¨å†…å­˜æ¢ CPU; è€Œé›¶æ‹·è´å°±æ˜¯ä¸åšæ— ç”¨åŠŸ, å‡å°‘èµ„æºæµªè´¹.")]),s._v(" "),t("h5",{attrs:{id:"é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹"}},[s._v("#")]),s._v(" é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹")]),s._v(" "),t("p",[s._v("å¹¶å‘çš„è¿‡ç¨‹ä¸­ä¸ºäº†åŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„è®¿é—®, éœ€è¦åŠ é”æ¥å®ç°. è€Œé”çš„å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„, æ‹¿é”çš„è¿‡ç¨‹æœ¬èº«å°±æ˜¯ä¸ªç³»ç»Ÿè°ƒç”¨, å¦‚æœé”æ²¡æ‹¿åˆ°çº¿ç¨‹ä¼šé˜»å¡, åˆä¼šå‘ç”Ÿçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢, å°¤å…¶æ˜¯å¤§é‡çº¿ç¨‹åŒæ—¶ç«äº‰ä¸€æŠŠé”æ—¶, ä¼šæµªè´¹å¤§é‡çš„ç³»ç»Ÿèµ„æº. å› æ­¤è¦æœ‰æ„è¯†çš„å°½é‡é¿å…é”çš„ä½¿ç”¨, æ¯”å¦‚å¯ä»¥ä½¿ç”¨åŸå­ç±» CAS æˆ–è€…å¹¶å‘é›†åˆæ¥ä»£æ›¿. å¦‚æœä¸‡ä¸å¾—å·²éœ€è¦ç”¨åˆ°é”, ä¹Ÿè¦å°½é‡ç¼©å°é”çš„èŒƒå›´å’Œé”çš„å¼ºåº¦. æ¥ä¸‹æ¥æ¥çœ‹çœ‹ Tomcat å’Œ Jetty å¦‚ä½•åšåˆ°é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹çš„.")]),s._v(" "),t("h6",{attrs:{id:"_1-ç¼©å°é”çš„èŒƒå›´"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç¼©å°é”çš„èŒƒå›´"}},[s._v("#")]),s._v(" 1.ç¼©å°é”çš„èŒƒå›´")]),s._v(" "),t("p",[s._v("ç¼©å°é”çš„èŒƒå›´, å…¶å®å°±æ˜¯ä¸ç›´æ¥åœ¨æ–¹æ³•ä¸ŠåŠ  synchronized, è€Œæ˜¯ä½¿ç”¨"),t("strong",[s._v("ç»†ç²’åº¦çš„å¯¹è±¡é”")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("startInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STARTING")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é” engine æˆå‘˜å˜é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("engine "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("engine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            engine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é” executors æˆå‘˜å˜é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("executors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" executors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    mapperListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é” connectors æˆå‘˜å˜é‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connectorsLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connector")]),s._v(" connector"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" connectors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// If it has already failed, don't try and start it")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FAILED")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                connector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[s._v("æ¯”å¦‚ä¸Šé¢çš„ä»£ç æ˜¯ Tomcat çš„ StandardService ç»„ä»¶çš„å¯åŠ¨æ–¹æ³•, è¿™ä¸ªå¯åŠ¨æ–¹æ³•è¦å¯åŠ¨ä¸‰ç§å­ç»„ä»¶: engine, executors å’Œ connectors. "),t("strong",[s._v("å®ƒæ²¡æœ‰ç›´æ¥åœ¨æ–¹æ³•ä¸ŠåŠ é”, è€Œæ˜¯ç”¨äº†ä¸‰æŠŠç»†ç²’åº¦çš„é”, æ¥åˆ†åˆ«ç”¨æ¥é”ä¸‰ä¸ªæˆå‘˜å˜é‡")]),s._v(". å¦‚æœç›´æ¥åœ¨æ–¹æ³•ä¸ŠåŠ  synchronized, å¤šä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•æ—¶éœ€è¦æ’é˜Ÿ; è€Œåœ¨å¯¹è±¡çº§åˆ«ä¸ŠåŠ  synchronized, å¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶è¡Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•, åªæ˜¯åœ¨è®¿é—®æŸä¸ªæˆå‘˜å˜é‡æ—¶æ‰éœ€è¦æ’é˜Ÿ.")]),s._v(" "),t("h6",{attrs:{id:"_2-ç”¨åŸå­å˜é‡å’Œcaså–ä»£é”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç”¨åŸå­å˜é‡å’Œcaså–ä»£é”"}},[s._v("#")]),s._v(" 2.ç”¨åŸå­å˜é‡å’ŒCASå–ä»£é”")]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ä»£ç æ˜¯ Jetty çº¿ç¨‹æ± çš„å¯åŠ¨æ–¹æ³•, å®ƒçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯æ ¹æ®ä¼ å…¥çš„å‚æ•°å¯åŠ¨ç›¸åº”ä¸ªæ•°çš„çº¿ç¨‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("startThreads")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" threadsToStart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("threadsToStart "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isRunning")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å½“å‰å·²ç»å¯åŠ¨çš„çº¿ç¨‹æ•°, å¦‚æœå·²ç»å¤Ÿäº†å°±ä¸éœ€è¦å¯åŠ¨äº†")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" threads "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _threadsStarted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("threads "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" _maxThreads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨ CAS æ–¹æ³•å°†çº¿ç¨‹æ•°åŠ ä¸€, è¯·æ³¨æ„æ‰§è¡Œå¤±è´¥èµ° continue, ç»§ç»­å°è¯•")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("_threadsStarted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("threads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" threads "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_runnable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDaemon")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isDaemon")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setPriority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getThreadsPriority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            _threads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//_threads å¹¶å‘é›†åˆ")]),s._v("\n            _lastShrink"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//_lastShrink æ˜¯åŸå­å˜é‡")]),s._v("\n            thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            started "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("threadsToStart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæœ€ç»ˆçº¿ç¨‹å¯åŠ¨å¤±è´¥, è¿˜éœ€è¦æŠŠçº¿ç¨‹æ•°å‡ä¸€")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("started"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                _threadsStarted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementAndGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°æ•´ä¸ªå‡½æ•°çš„å®ç°æ˜¯ä¸€ä¸ª "),t("strong",[s._v("while å¾ªç¯")]),s._v(", å¹¶ä¸”æ˜¯"),t("strong",[s._v("æ— é”")]),s._v("çš„. "),t("code",[s._v("_threadsStarted")]),s._v("â€‹ è¡¨ç¤ºå½“å‰çº¿ç¨‹æ± å·²ç»å¯åŠ¨äº†å¤šå°‘ä¸ªçº¿ç¨‹, å®ƒæ˜¯ä¸€ä¸ªåŸå­å˜é‡ AtomicInteger, é¦–å…ˆé€šè¿‡å®ƒçš„ get() æ–¹æ³•æ‹¿åˆ°å€¼, å¦‚æœçº¿ç¨‹æ•°å·²ç»è¾¾åˆ°æœ€å¤§å€¼, ç›´æ¥è¿”å›. å¦åˆ™å°è¯•ç”¨ CAS æ“ä½œå°† "),t("code",[s._v("_threadsStarted")]),s._v("â€‹ çš„å€¼åŠ ä¸€, å¦‚æœæˆåŠŸäº†æ„å‘³ç€æ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ”¹è¿™ä¸ªå€¼, å½“å‰çº¿ç¨‹å¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œ; å¦åˆ™èµ° continue åˆ†æ”¯, ä¹Ÿå°±æ˜¯ç»§ç»­é‡è¯•, ç›´åˆ°æˆåŠŸä¸ºæ­¢. åœ¨è¿™é‡Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨é”æ¥å®ç°, ä½†æ˜¯æˆ‘ä»¬çš„ç›®çš„æ˜¯æ— é”åŒ–.")]),s._v(" "),t("h6",{attrs:{id:"_3-å¹¶å‘å®¹å™¨çš„ä½¿ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-å¹¶å‘å®¹å™¨çš„ä½¿ç”¨"}},[s._v("#")]),s._v(" 3.å¹¶å‘å®¹å™¨çš„ä½¿ç”¨")]),s._v(" "),t("p",[s._v('CopyOnWriteArrayList é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯, æ¯”å¦‚ Tomcat ç”¨å®ƒæ¥ "å­˜æ”¾" äº‹ä»¶ç›‘å¬å™¨, è¿™æ˜¯å› ä¸ºç›‘å¬å™¨ä¸€èˆ¬åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ç¡®å®šåå°±åŸºæœ¬ä¸ä¼šæ”¹å˜, å½“äº‹ä»¶è§¦å‘æ—¶éœ€è¦éå†è¿™ä¸ªç›‘å¬å™¨åˆ—è¡¨, æ‰€ä»¥è¿™ä¸ªåœºæ™¯ç¬¦åˆè¯»å¤šå†™å°‘çš„ç‰¹å¾.')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleBase")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lifecycle")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// äº‹ä»¶ç›‘å¬å™¨é›†åˆ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" lifecycleListeners "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CopyOnWriteArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h6",{attrs:{id:"_4-volatileå…³é”®å­—çš„ä½¿ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-volatileå…³é”®å­—çš„ä½¿ç”¨"}},[s._v("#")]),s._v(" 4.volatileå…³é”®å­—çš„ä½¿ç”¨")]),s._v(" "),t("p",[s._v("å†æ‹¿ Tomcat ä¸­çš„ LifecycleBase ä½œä¸ºä¾‹å­, å®ƒé‡Œé¢çš„ç”Ÿå‘½çŠ¶æ€å°±æ˜¯ç”¨ volatile å…³é”®å­—ä¿®é¥°çš„. volatile çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å˜é‡, å¦ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¯»åˆ°è¿™ç§å˜åŒ–. å¯¹äºç”Ÿå‘½çŠ¶æ€æ¥è¯´, éœ€è¦åœ¨å„ä¸ªçº¿ç¨‹ä¸­ä¿æŒæ˜¯æœ€æ–°çš„å€¼, å› æ­¤é‡‡ç”¨äº† volatile ä¿®é¥°.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleBase")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lifecycle")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰ç»„ä»¶çš„ç”Ÿå‘½çŠ¶æ€, ç”¨ volatile ä¿®é¥°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),s._v(" state "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NEW")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-9"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("é«˜æ€§èƒ½ç¨‹åºèƒ½å¤Ÿé«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº, é¦–å…ˆå°±æ˜¯å‡å°‘èµ„æºæµªè´¹, æ¯”å¦‚è¦å‡å°‘çº¿ç¨‹çš„é˜»å¡, å› ä¸ºé˜»å¡ä¼šå¯¼è‡´èµ„æºé—²ç½®å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢, Tomcat å’Œ Jetty é€šè¿‡åˆç†çš„ I/O æ¨¡å‹å’Œçº¿ç¨‹æ¨¡å‹å‡å°‘äº†çº¿ç¨‹çš„é˜»å¡. å¦å¤–ç³»ç»Ÿè°ƒç”¨ä¼šå¯¼è‡´ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢çš„è¿‡ç¨‹, Tomcat å’Œ Jetty é€šè¿‡ç¼“å­˜å’Œå»¶è¿Ÿè§£æå°½é‡å‡å°‘ç³»ç»Ÿè°ƒç”¨, å¦å¤–è¿˜é€šè¿‡é›¶æ‹·è´æŠ€æœ¯é¿å…å¤šä½™çš„æ•°æ®æ‹·è´.")]),s._v(" "),t("p",[s._v("é«˜æ•ˆçš„åˆ©ç”¨èµ„æºè¿˜åŒ…æ‹¬å¦ä¸€å±‚å«ä¹‰, é‚£å°±æ˜¯åœ¨ç³»ç»Ÿè®¾è®¡çš„è¿‡ç¨‹ä¸­, ç»å¸¸ä¼šç”¨ä¸€ç§èµ„æºæ¢å–å¦ä¸€ç§èµ„æº, æ¯”å¦‚ Tomcat å’Œ Jetty ä¸­ä½¿ç”¨çš„å¯¹è±¡æ± æŠ€æœ¯, å°±æ˜¯ç”¨å†…å­˜æ¢å– CPU, å°†æ•°æ®å‹ç¼©åå†ä¼ è¾“å°±æ˜¯ç”¨ CPU æ¢ç½‘ç»œ.")]),s._v(" "),t("p",[s._v("é™¤æ­¤ä¹‹å¤–, é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹ä¹Ÿå¾ˆé‡è¦, å¤šçº¿ç¨‹è™½ç„¶å¯ä»¥æé«˜å¹¶å‘åº¦, ä¹Ÿå¸¦æ¥äº†é”çš„å¼€é”€, å› æ­¤åœ¨å®é™…ç¼–ç¨‹è¿‡ç¨‹ä¸­è¦å°½é‡é¿å…ä½¿ç”¨é”, æ¯”å¦‚å¯ä»¥ç”¨åŸå­å˜é‡å’Œ CAS æ“ä½œæ¥ä»£æ›¿é”. å¦‚æœå®åœ¨é¿å…ä¸äº†ç”¨é”, ä¹Ÿè¦å°½é‡å‡å°‘é”çš„èŒƒå›´å’Œå¼ºåº¦, æ¯”å¦‚å¯ä»¥ç”¨ç»†ç²’åº¦çš„å¯¹è±¡é”æˆ–è€…ä½å¼ºåº¦çš„è¯»å†™é”. Tomcat å’Œ Jetty çš„ä»£ç ä¹Ÿå¾ˆå¥½çš„å®è·µäº†è¿™ä¸€ç†å¿µ.")]),s._v(" "),t("h4",{attrs:{id:"_22-çƒ­ç‚¹ç­”ç–‘-2-å†…æ ¸å¦‚ä½•é˜»å¡ä¸å”¤é†’è¿›ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_22-çƒ­ç‚¹ç­”ç–‘-2-å†…æ ¸å¦‚ä½•é˜»å¡ä¸å”¤é†’è¿›ç¨‹"}},[s._v("#")]),s._v(" 22.çƒ­ç‚¹ç­”ç–‘(2):å†…æ ¸å¦‚ä½•é˜»å¡ä¸å”¤é†’è¿›ç¨‹?")]),s._v(" "),t("p",[s._v("å‰é¢å­¦ä¹ äº† Tomcat è¿æ¥å™¨ç»„ä»¶çš„è®¾è®¡, "),t("strong",[s._v("å…¶ä¸­æœ€é‡è¦çš„æ˜¯å„ç§ I/O æ¨¡å‹åŠå…¶å®ç°")]),s._v(". è€Œ I/O æ¨¡å‹è·Ÿæ“ä½œç³»ç»Ÿå¯†åˆ‡ç›¸å…³, è¦å½»åº•ç†è§£è¿™äº›åŸç†, é¦–å…ˆéœ€è¦å¼„æ¸…æ¥šä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹, ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜, ä»€ä¹ˆæ˜¯ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´, çº¿ç¨‹çš„é˜»å¡åˆ°åº•æ„å‘³ç€ä»€ä¹ˆ, å†…æ ¸åˆæ˜¯å¦‚ä½•å”¤é†’ç”¨æˆ·çº¿ç¨‹çš„ç­‰ç­‰è¿™äº›é—®é¢˜. æŒæ¡è¿™äº›åº•å±‚çš„çŸ¥è¯†, å¯¹äºå­¦ä¹  Tomcat å’Œ Jetty çš„åŸç†, ä¹ƒè‡³å…¶ä»–å„ç§åç«¯æ¶æ„éƒ½è‡³å…³é‡è¦, è¿™äº›çŸ¥è¯†å¯ä»¥è¯´æ˜¯åç«¯å¼€å‘çš„åŸºçŸ³.")]),s._v(" "),t("h5",{attrs:{id:"è¿›ç¨‹å’Œçº¿ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿›ç¨‹å’Œçº¿ç¨‹"}},[s._v("#")]),s._v(" è¿›ç¨‹å’Œçº¿ç¨‹")]),s._v(" "),t("p",[s._v('å…ˆä» Linux çš„è¿›ç¨‹è°ˆèµ·, æ“ä½œç³»ç»Ÿè¦è¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº, é¦–å…ˆè¦å°†ç¨‹åºæ–‡ä»¶åŠ è½½åˆ°å†…å­˜, ç„¶å CPU å»è¯»å–å’Œæ‰§è¡Œç¨‹åºæŒ‡ä»¤, è€Œä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ "ä¸€æ¬¡ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹", å†…æ ¸ä¼šç»™æ¯ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºä¸€ä¸ªåä¸º '),t("code",[s._v("task_struct")]),s._v("â€‹ çš„æ•°æ®ç»“æ„, è€Œå†…æ ¸ä¹Ÿæ˜¯ä¸€æ®µç¨‹åº, ç³»ç»Ÿå¯åŠ¨æ—¶å°±è¢«åŠ è½½åˆ°å†…å­˜ä¸­äº†.")]),s._v(" "),t("p",[s._v("è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¦è®¿é—®å†…å­˜, è€Œç‰©ç†å†…å­˜æ˜¯æœ‰é™çš„, æ¯”å¦‚ 16GB, é‚£æ€ä¹ˆæŠŠæœ‰é™çš„å†…å­˜åˆ†ç»™ä¸åŒçš„è¿›ç¨‹ä½¿ç”¨å‘¢? è·Ÿ CPU çš„åˆ†æ—¶å…±äº«ä¸€æ ·, å†…å­˜ä¹Ÿæ˜¯å…±äº«çš„, Linux ç»™æ¯ä¸ªè¿›ç¨‹"),t("strong",[s._v("è™šæ‹Ÿå‡ºä¸€å—å¾ˆå¤§çš„åœ°å€ç©ºé—´")]),s._v(", æ¯”å¦‚ 32 ä½æœºå™¨ä¸Šè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´æ˜¯ 4GB, ä» 0x00000000 åˆ° 0xFFFFFFFF. ä½†è¿™ 4GB å¹¶ä¸æ˜¯çœŸå®çš„ç‰©ç†å†…å­˜, è€Œæ˜¯è¿›ç¨‹è®¿é—®åˆ°äº†æŸä¸ªè™šæ‹Ÿåœ°å€, å¦‚æœè¿™ä¸ªåœ°å€è¿˜æ²¡æœ‰å¯¹åº”çš„ç‰©ç†å†…å­˜é¡µ, å°±ä¼šäº§ç”Ÿ"),t("strong",[s._v("ç¼ºé¡µä¸­æ–­")]),s._v(", åˆ†é…ç‰©ç†å†…å­˜, MMU(å†…å­˜ç®¡ç†å•å…ƒ)ä¼šå°†è™šæ‹Ÿåœ°å€ä¸ç‰©ç†å†…å­˜é¡µçš„æ˜ å°„å…³ç³»ä¿å­˜åœ¨é¡µè¡¨ä¸­, å†æ¬¡è®¿é—®è¿™ä¸ªè™šæ‹Ÿåœ°å€, å°±èƒ½æ‰¾åˆ°ç›¸åº”çš„ç‰©ç†å†…å­˜é¡µ. æ¯ä¸ªè¿›ç¨‹çš„è¿™ 4GB è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†å¸ƒå¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161709-b0l6abr.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ€»ä½“åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´")]),s._v(", ä½åœ°å€ä¸Šçš„ 3GB å±äºç”¨æˆ·ç©ºé—´, é«˜åœ°å€çš„ 1GB æ˜¯å†…æ ¸ç©ºé—´, è¿™æ˜¯åŸºäºå®‰å…¨ä¸Šçš„è€ƒè™‘, ç”¨æˆ·ç¨‹åºåªèƒ½è®¿é—®ç”¨æˆ·ç©ºé—´, å†…æ ¸ç¨‹åºå¯ä»¥è®¿é—®æ•´ä¸ªè¿›ç¨‹ç©ºé—´, å¹¶ä¸”åªæœ‰å†…æ ¸å¯ä»¥ç›´æ¥è®¿é—®å„ç§ç¡¬ä»¶èµ„æº, æ¯”å¦‚ç£ç›˜å’Œç½‘å¡. é‚£ç”¨æˆ·ç¨‹åºéœ€è¦è®¿é—®è¿™äº›ç¡¬ä»¶èµ„æºè¯¥æ€ä¹ˆåŠå‘¢? ç­”æ¡ˆæ˜¯é€šè¿‡"),t("strong",[s._v("ç³»ç»Ÿè°ƒç”¨")]),s._v(", ç³»ç»Ÿè°ƒç”¨å¯ä»¥ç†è§£ä¸ºå†…æ ¸å®ç°çš„å‡½æ•°, æ¯”å¦‚åº”ç”¨ç¨‹åºè¦é€šè¿‡ç½‘å¡æ¥æ”¶æ•°æ®, ä¼šè°ƒç”¨ Socket çš„ read å‡½æ•°:")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ssize_t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("size_t")]),s._v(" nbyte"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("CPU åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ä¸­ä¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€, CPU åœ¨ç”¨æˆ·æ€ä¸‹æ‰§è¡Œç”¨æˆ·ç¨‹åº, ä½¿ç”¨çš„æ˜¯ç”¨æˆ·ç©ºé—´çš„æ ˆ, è®¿é—®ç”¨æˆ·ç©ºé—´çš„å†…å­˜; å½“ CPU åˆ‡æ¢åˆ°å†…æ ¸æ€å, æ‰§è¡Œå†…æ ¸ä»£ç , ä½¿ç”¨çš„æ˜¯å†…æ ¸ç©ºé—´ä¸Šçš„æ ˆ.")]),s._v(" "),t("p",[s._v("ä»ä¸Šé¢è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°, ç”¨æˆ·ç©ºé—´ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ä»£ç åŒº, æ•°æ®åŒº, å †, å…±äº«åº“ä¸ mmap å†…å­˜æ˜ å°„åŒº, æ ˆ, ç¯å¢ƒå˜é‡. å…¶ä¸­å †å‘é«˜åœ°å€å¢é•¿, æ ˆå‘ä½åœ°å€å¢é•¿.")]),s._v(" "),t("p",[s._v("è¯·æ³¨æ„ç”¨æˆ·ç©ºé—´ä¸Šè¿˜æœ‰ä¸€ä¸ªå…±äº«åº“å’Œ mmap æ˜ å°„åŒº, Linux æä¾›äº†å†…å­˜æ˜ å°„å‡½æ•° mmap, å®ƒå¯å°†æ–‡ä»¶å†…å®¹æ˜ å°„åˆ°è¿™ä¸ªå†…å­˜åŒºåŸŸ, ç”¨æˆ·é€šè¿‡è¯»å†™è¿™æ®µå†…å­˜, ä»è€Œå®ç°å¯¹æ–‡ä»¶çš„è¯»å–å’Œä¿®æ”¹, æ— éœ€é€šè¿‡ read/write ç³»ç»Ÿè°ƒç”¨æ¥è¯»å†™æ–‡ä»¶, çœå»äº†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´, Java çš„ MappedByteBuffer å°±æ˜¯é€šè¿‡å®ƒæ¥å®ç°çš„; ç”¨æˆ·ç¨‹åºç”¨åˆ°çš„ç³»ç»Ÿå…±äº«åº“ä¹Ÿæ˜¯é€šè¿‡ mmap æ˜ å°„åˆ°äº†è¿™ä¸ªåŒºåŸŸ.")]),s._v(" "),t("p",[s._v("å¼€å§‹æåˆ°çš„ "),t("code",[s._v("task_struct")]),s._v("â€‹ ç»“æ„ä½“æœ¬èº«æ˜¯åˆ†é…åœ¨å†…æ ¸ç©ºé—´, å®ƒçš„ "),t("code",[s._v("vm_struct")]),s._v("â€‹ æˆå‘˜å˜é‡ä¿å­˜äº†å„å†…å­˜åŒºåŸŸçš„èµ·å§‹å’Œç»ˆæ­¢åœ°å€, æ­¤å¤– "),t("code",[s._v("task_struct")]),s._v("â€‹ ä¸­è¿˜ä¿å­˜äº†è¿›ç¨‹çš„å…¶ä»–ä¿¡æ¯, æ¯”å¦‚è¿›ç¨‹å·, æ‰“å¼€çš„æ–‡ä»¶, åˆ›å»ºçš„ Socket ä»¥åŠ CPU è¿è¡Œä¸Šä¸‹æ–‡ç­‰.")]),s._v(" "),t("p",[s._v("åœ¨ Linux ä¸­, çº¿ç¨‹æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è¿›ç¨‹, è½»é‡çº§è¯´çš„æ˜¯çº¿ç¨‹åªæ˜¯ä¸€ä¸ª CPU è°ƒåº¦å•å…ƒ, å› æ­¤çº¿ç¨‹æœ‰è‡ªå·±çš„ "),t("code",[s._v("task_struct")]),s._v("â€‹ ç»“æ„ä½“å’Œè¿è¡Œæ ˆåŒº, ä½†æ˜¯çº¿ç¨‹çš„å…¶ä»–èµ„æºéƒ½æ˜¯è·Ÿçˆ¶è¿›ç¨‹å…±ç”¨çš„, æ¯”å¦‚è™šæ‹Ÿåœ°å€ç©ºé—´, æ‰“å¼€çš„æ–‡ä»¶å’Œ Socket ç­‰.")]),s._v(" "),t("h5",{attrs:{id:"é˜»å¡ä¸å”¤é†’"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é˜»å¡ä¸å”¤é†’"}},[s._v("#")]),s._v(" é˜»å¡ä¸å”¤é†’")]),s._v(" "),t("p",[s._v("å½“ç”¨æˆ·çº¿ç¨‹å‘èµ·ä¸€ä¸ªé˜»å¡å¼çš„ read è°ƒç”¨, æ•°æ®æœªå°±ç»ªæ—¶, çº¿ç¨‹å°±ä¼šé˜»å¡, é‚£é˜»å¡å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢?")]),s._v(" "),t("p",[s._v("Linux å†…æ ¸å°†çº¿ç¨‹å½“ä½œä¸€ä¸ªè¿›ç¨‹è¿›è¡Œ CPU è°ƒåº¦, å†…æ ¸ç»´æŠ¤äº†ä¸€ä¸ªå¯è¿è¡Œçš„è¿›ç¨‹é˜Ÿåˆ—, æ‰€æœ‰å¤„äº "),t("code",[s._v("TASK_RUNNING")]),s._v("â€‹ çŠ¶æ€çš„è¿›ç¨‹éƒ½ä¼šè¢«æ”¾å…¥è¿è¡Œé˜Ÿåˆ—ä¸­, æœ¬è´¨æ˜¯ç”¨åŒå‘é“¾è¡¨å°† "),t("code",[s._v("task_struct")]),s._v("â€‹ é“¾æ¥èµ·æ¥, æ’é˜Ÿä½¿ç”¨ CPU æ—¶é—´ç‰‡, æ—¶é—´ç‰‡ç”¨å®Œé‡æ–°è°ƒåº¦ CPU. "),t("strong",[s._v("æ‰€è°“è°ƒåº¦å°±æ˜¯åœ¨å¯è¿è¡Œè¿›ç¨‹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹, å†ä» CPU åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ CPU, å°†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡æ¢å¤åˆ°è¿™ä¸ª CPU çš„å¯„å­˜å™¨ä¸­, ç„¶åæ‰§è¡Œè¿›ç¨‹ä¸Šä¸‹æ–‡æŒ‡å®šçš„ä¸‹ä¸€æ¡æŒ‡ä»¤")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161709-ocws3zb.png",alt:""}})]),s._v(" "),t("p",[s._v("è€Œé˜»å¡çš„æœ¬è´¨å°±æ˜¯å°†è¿›ç¨‹çš„ "),t("code",[s._v("task_struct")]),s._v("â€‹ ç§»å‡ºè¿è¡Œé˜Ÿåˆ—, æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—, å¹¶ä¸”å°†è¿›ç¨‹çš„çŠ¶æ€çš„ç½®ä¸º "),t("code",[s._v("TASK_UNINTERRUPTIBLE")]),s._v("â€‹ æˆ–è€… "),t("code",[s._v("TASK_INTERRUPTIBLE")]),s._v("â€‹, é‡æ–°è§¦å‘ä¸€æ¬¡ CPU è°ƒåº¦è®©å‡º CPU.")]),s._v(" "),t("p",[s._v("é‚£çº¿ç¨‹æ€ä¹ˆå”¤é†’å‘¢? çº¿ç¨‹åœ¨åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—çš„åŒæ—¶å‘å†…æ ¸æ³¨å†Œäº†ä¸€ä¸ª"),t("strong",[s._v("å›è°ƒå‡½æ•°")]),s._v(", å‘Šè¯‰å†…æ ¸æˆ‘åœ¨ç­‰å¾…è¿™ä¸ª Socket ä¸Šçš„æ•°æ®, å¦‚æœæ•°æ®åˆ°äº†å°±å”¤é†’æˆ‘. è¿™æ ·"),t("strong",[s._v("å½“ç½‘å¡æ¥æ”¶åˆ°æ•°æ®æ—¶, äº§ç”Ÿç¡¬ä»¶ä¸­æ–­, å†…æ ¸å†é€šè¿‡è°ƒç”¨å›è°ƒå‡½æ•°å”¤é†’è¿›ç¨‹")]),s._v(". å”¤é†’çš„è¿‡ç¨‹å°±æ˜¯å°†è¿›ç¨‹çš„ "),t("code",[s._v("task_struct")]),s._v("â€‹ ä»ç­‰å¾…é˜Ÿåˆ—ç§»åˆ°è¿è¡Œé˜Ÿåˆ—, å¹¶ä¸”å°† "),t("code",[s._v("task_struct")]),s._v("â€‹ çš„çŠ¶æ€ç½®ä¸º "),t("code",[s._v("TASK_RUNNING")]),s._v("â€‹, è¿™æ ·è¿›ç¨‹å°±æœ‰æœºä¼šé‡æ–°è·å¾— CPU æ—¶é—´ç‰‡.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªè¿‡ç¨‹ä¸­, å†…æ ¸è¿˜ä¼šå°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„å †ä¸Š.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161709-othexia.png",alt:""}})]),s._v(" "),t("p",[s._v("å½“ read ç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶, CPU åˆä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€, ç»§ç»­æ‰§è¡Œ read è°ƒç”¨çš„ä¸‹ä¸€è¡Œä»£ç , å¹¶ä¸”èƒ½ä»ç”¨æˆ·ç©ºé—´ä¸Šçš„ Buffer è¯»åˆ°æ•°æ®äº†.")]),s._v(" "),t("p",[s._v("æ€»ç»“ä¸€æ¬¡ Socket read ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹: é¦–å…ˆ CPU åœ¨ç”¨æˆ·æ€æ‰§è¡Œåº”ç”¨ç¨‹åºçš„ä»£ç , è®¿é—®è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„ç”¨æˆ·ç©ºé—´; read ç³»ç»Ÿè°ƒç”¨æ—¶ CPU ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€, æ‰§è¡Œå†…æ ¸ä»£ç , å†…æ ¸æ£€æµ‹åˆ° Socket ä¸Šçš„æ•°æ®æœªå°±ç»ªæ—¶, å°†è¿›ç¨‹çš„"),t("code",[s._v("task_struct")]),s._v("â€‹ç»“æ„ä½“ä»è¿è¡Œé˜Ÿåˆ—ä¸­ç§»åˆ°ç­‰å¾…é˜Ÿåˆ—, å¹¶è§¦å‘ä¸€æ¬¡ CPU è°ƒåº¦, è¿™æ—¶è¿›ç¨‹ä¼šè®©å‡º CPU; å½“ç½‘å¡æ•°æ®åˆ°è¾¾æ—¶, å†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„ Buffer, æ¥ç€å°†è¿›ç¨‹çš„"),t("code",[s._v("task_struct")]),s._v("â€‹ç»“æ„ä½“é‡æ–°ç§»åˆ°è¿è¡Œé˜Ÿåˆ—, è¿™æ ·è¿›ç¨‹å°±æœ‰æœºä¼šé‡æ–°è·å¾— CPU æ—¶é—´ç‰‡, ç³»ç»Ÿè°ƒç”¨è¿”å›, CPU åˆä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€, è®¿é—®ç”¨æˆ·ç©ºé—´çš„æ•°æ®.")]),s._v(" "),t("h3",{attrs:{id:"å®¹å™¨-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®¹å™¨-2"}},[s._v("#")]),s._v(" å®¹å™¨")]),s._v(" "),t("h4",{attrs:{id:"_23-hostå®¹å™¨-tomcatå¦‚ä½•å®ç°çƒ­éƒ¨ç½²å’Œçƒ­åŠ è½½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_23-hostå®¹å™¨-tomcatå¦‚ä½•å®ç°çƒ­éƒ¨ç½²å’Œçƒ­åŠ è½½"}},[s._v("#")]),s._v(" 23.Hostå®¹å™¨:Tomcatå¦‚ä½•å®ç°çƒ­éƒ¨ç½²å’Œçƒ­åŠ è½½?")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥å¼€å§‹ä»‹ç» Tomcat çš„å®¹å™¨æ¨¡å—, æ¥èŠä¸€èŠå„å®¹å™¨ç»„ä»¶å®ç°çš„åŠŸèƒ½, ä¸»è¦æœ‰"),t("strong",[s._v("çƒ­éƒ¨ç½²çƒ­åŠ è½½, ç±»åŠ è½½æœºåˆ¶ä»¥åŠ Servlet è§„èŒƒ")]),s._v("çš„å®ç°. æœ€åè¿˜ä¼šè°ˆåˆ° Spring Boot æ˜¯å¦‚ä½•ä¸ Web å®¹å™¨è¿›è¡Œäº¤äº’çš„.")]),s._v(" "),t("p",[s._v("é¦–å…ˆæ¥çœ‹çƒ­éƒ¨ç½²å’Œçƒ­åŠ è½½. è¦åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å‡çº§ Web åº”ç”¨, å¦‚æœä¸æƒ³é‡å¯ç³»ç»Ÿ, å®ç°çš„æ–¹å¼æœ‰ä¸¤ç§: "),t("strong",[s._v("çƒ­åŠ è½½å’Œçƒ­éƒ¨ç½²")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£å¦‚ä½•å®ç°çƒ­éƒ¨ç½²å’Œçƒ­åŠ è½½å‘¢? å®ƒä»¬è·Ÿ"),t("strong",[s._v("ç±»åŠ è½½æœºåˆ¶")]),s._v("æœ‰å…³, å…·ä½“æ¥è¯´å°±æ˜¯:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("çƒ­åŠ è½½çš„å®ç°æ–¹å¼æ˜¯ Web å®¹å™¨å¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹, å®šæœŸæ£€æµ‹ç±»æ–‡ä»¶çš„å˜åŒ–, å¦‚æœæœ‰å˜åŒ–, å°±é‡æ–°åŠ è½½ç±», åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šæ¸…ç©º Session, ä¸€èˆ¬ç”¨åœ¨å¼€å‘ç¯å¢ƒ.")])]),s._v(" "),t("li",[s._v("**çƒ­éƒ¨ç½²åŸç†ç±»ä¼¼, ä¹Ÿæ˜¯ç”±åå°çº¿ç¨‹å®šæ—¶æ£€æµ‹ Web åº”ç”¨çš„å˜åŒ–, ä½†å®ƒä¼šé‡æ–°åŠ è½½æ•´ä¸ª Web åº”ç”¨. è¿™ç§æ–¹å¼ä¼šæ¸…ç©º Session, æ¯”çƒ­åŠ è½½æ›´åŠ å¹²å‡€, å½»åº•, ä¸€èˆ¬ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒ. **")])]),s._v(" "),t("p",[s._v("Tomcat é€šè¿‡å¼€å¯åå°çº¿ç¨‹, ä½¿å¾—å„ä¸ªå±‚æ¬¡çš„å®¹å™¨ç»„ä»¶éƒ½æœ‰æœºä¼šå®Œæˆä¸€äº›"),t("strong",[s._v("å‘¨æœŸæ€§ä»»åŠ¡")]),s._v(". åœ¨å®é™…å·¥ä½œä¸­, å¾€å¾€ä¹Ÿéœ€è¦æ‰§è¡Œä¸€äº›å‘¨æœŸæ€§çš„ä»»åŠ¡, æ¯”å¦‚ç›‘æ§ç¨‹åºå‘¨æœŸæ€§æ‹‰å–ç³»ç»Ÿçš„å¥åº·çŠ¶æ€, å°±å¯ä»¥å€Ÿé‰´è¿™ç§è®¾è®¡.")]),s._v(" "),t("h5",{attrs:{id:"tomcatçš„åå°çº¿ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatçš„åå°çº¿ç¨‹"}},[s._v("#")]),s._v(" Tomcatçš„åå°çº¿ç¨‹")]),s._v(" "),t("p",[s._v("è¦è¯´å¼€å¯åå°çº¿ç¨‹åšå‘¨æœŸæ€§çš„ä»»åŠ¡, æœ‰ç»éªŒçš„åŒå­¦é©¬ä¸Šä¼šæƒ³åˆ°çº¿ç¨‹æ± ä¸­çš„ "),t("strong",[s._v("ScheduledThreadPoolExecutor")]),s._v(", å®ƒé™¤äº†å…·æœ‰çº¿ç¨‹æ± çš„åŠŸèƒ½, è¿˜èƒ½å¤Ÿæ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡. Tomcat å°±æ˜¯é€šè¿‡å®ƒæ¥å¼€å¯åå°çº¿ç¨‹çš„:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("bgFuture "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" exec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scheduleWithFixedDelay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ContainerBackgroundProcessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¦æ‰§è¡Œçš„ Runnable")]),s._v("\n              backgroundProcessorDelay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¬¬ä¸€æ¬¡æ‰§è¡Œå»¶è¿Ÿå¤šä¹…")]),s._v("\n              backgroundProcessorDelay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¹‹åæ¯æ¬¡æ‰§è¡Œé—´éš”å¤šä¹…")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ—¶é—´å•ä½")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä»£ç è°ƒç”¨äº† scheduleWithFixedDelay() æ–¹æ³•, ä¼ å…¥äº†å››ä¸ªå‚æ•°, ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¦å‘¨æœŸæ€§æ‰§è¡Œçš„ä»»åŠ¡ç±» ContainerBackgroundProcessor, å®ƒæ˜¯ä¸€ä¸ª Runnable, åŒæ—¶ä¹Ÿæ˜¯ ContainerBase çš„å†…éƒ¨ç±», ContainerBase æ˜¯æ‰€æœ‰å®¹å™¨ç»„ä»¶çš„åŸºç±», æ¥å›å¿†ä¸€ä¸‹å®¹å™¨ç»„ä»¶æœ‰å“ªäº›, æœ‰ Engine, Host, Context å’Œ Wrapper ç­‰, å®ƒä»¬å…·æœ‰çˆ¶å­å…³ç³».")]),s._v(" "),t("h6",{attrs:{id:"_1-containerbackgroundprocessorå®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-containerbackgroundprocessorå®ç°"}},[s._v("#")]),s._v(" 1.ContainerBackgroundProcessorå®ç°")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ¥çœ‹ ContainerBackgroundProcessor å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ContainerBackgroundProcessor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// è¯·æ³¨æ„è¿™é‡Œä¼ å…¥çš„å‚æ•°æ˜¯ " å®¿ä¸»ç±»" çš„å®ä¾‹')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processChildren")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ContainerBase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processChildren")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),s._v(" container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. è°ƒç”¨å½“å‰å®¹å™¨çš„ backgroundProcess() æ–¹æ³•. ")]),s._v("\n            container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. éå†æ‰€æœ‰çš„å­å®¹å™¨, é€’å½’è°ƒç”¨ processChildren(), è¿™æ ·å½“å‰å®¹å™¨çš„å­å­™éƒ½ä¼šè¢«å¤„ç†        ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Container")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" children "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findChildren")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œè¯·æ³¨æ„, å®¹å™¨åŸºç±»æœ‰ä¸ªå˜é‡å«åš backgroundProcessorDelay, å¦‚æœå¤§äº 0, è¡¨æ˜å­å®¹å™¨æœ‰è‡ªå·±çš„åå°çº¿ç¨‹, ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ— éœ€çˆ¶å®¹å™¨æ¥è°ƒç”¨å®ƒçš„ processChildren() æ–¹æ³•. ")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBackgroundProcessorDelay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processChildren")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ... ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v('ä¸Šé¢çš„ä»£ç é€»è¾‘ä¹Ÿæ˜¯æ¯”è¾ƒæ¸…æ™°çš„, é¦–å…ˆ ContainerBackgroundProcessor æ˜¯ä¸€ä¸ª Runnable, å®ƒéœ€è¦å®ç° run() æ–¹æ³•, å®ƒçš„ run() å¾ˆç®€å•, å°±æ˜¯è°ƒç”¨äº† processChildren() æ–¹æ³•. è¿™é‡Œæœ‰ä¸ªå°æŠ€å·§, å®ƒæŠŠ "å®¿ä¸»ç±»", ä¹Ÿå°±æ˜¯ '),t("strong",[s._v("ContainerBase çš„ç±»å®ä¾‹å½“æˆå‚æ•°ä¼ ç»™äº† run() æ–¹æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œåœ¨ processChildren() æ–¹æ³•é‡Œ, å°±åšäº†ä¸¤æ­¥: è°ƒç”¨å½“å‰å®¹å™¨çš„ backgroundProcess() æ–¹æ³•, ä»¥åŠé€’å½’è°ƒç”¨å­å­™çš„ backgroundProcess() æ–¹æ³•. è¯·æ³¨æ„ backgroundProcess() æ˜¯ Container æ¥å£ä¸­çš„æ–¹æ³•, ä¹Ÿå°±æ˜¯è¯´"),t("strong",[s._v("æ‰€æœ‰ç±»å‹çš„å®¹å™¨")]),s._v("éƒ½å¯ä»¥å®ç°è¿™ä¸ªæ–¹æ³•, "),t("strong",[s._v("åœ¨è¿™ä¸ªæ–¹æ³•é‡Œå®Œæˆéœ€è¦å‘¨æœŸæ€§æ‰§è¡Œçš„ä»»åŠ¡")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™æ ·çš„è®¾è®¡æ„å‘³ç€ä»€ä¹ˆå‘¢? åªéœ€è¦åœ¨é¡¶å±‚å®¹å™¨, ä¹Ÿå°±æ˜¯ Engine å®¹å™¨ä¸­å¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹, é‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹"),t("strong",[s._v("ä¸ä½†ä¼šæ‰§è¡Œ Engine å®¹å™¨çš„å‘¨æœŸæ€§ä»»åŠ¡, å®ƒè¿˜ä¼šæ‰§è¡Œæ‰€æœ‰å­å®¹å™¨çš„å‘¨æœŸæ€§ä»»åŠ¡")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_2-backgroundprocess-æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-backgroundprocess-æ–¹æ³•"}},[s._v("#")]),s._v(" 2.backgroundProcess()æ–¹æ³•")]),s._v(" "),t("p",[s._v("ä¸Šè¿°ä»£ç éƒ½æ˜¯åœ¨åŸºç±» ContainerBase ä¸­å®ç°çš„, é‚£å…·ä½“å®¹å™¨ç±»éœ€è¦åšä»€ä¹ˆå‘¢? å…¶å®å¾ˆç®€å•, å¦‚æœæœ‰å‘¨æœŸæ€§ä»»åŠ¡è¦æ‰§è¡Œ, å°±å®ç° backgroundProcess() æ–¹æ³•; å¦‚æœæ²¡æœ‰, å°±é‡ç”¨åŸºç±» ContainerBase çš„æ–¹æ³•. ContainerBase çš„ backgroundProcess() æ–¹æ³•å®ç°å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. æ‰§è¡Œå®¹å™¨ä¸­ Cluster ç»„ä»¶çš„å‘¨æœŸæ€§ä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Cluster")]),s._v(" cluster "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClusterInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cluster "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. æ‰§è¡Œå®¹å™¨ä¸­ Realm ç»„ä»¶çš„å‘¨æœŸæ€§ä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Realm")]),s._v(" realm "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRealmInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("realm "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        realm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. æ‰§è¡Œå®¹å™¨ä¸­ Valve ç»„ä»¶çš„å‘¨æœŸæ€§ä»»åŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" current "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pipeline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getFirst")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       current"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       current "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" current"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// 4. è§¦å‘å®¹å™¨çš„ "å‘¨æœŸäº‹ä»¶", Host å®¹å™¨çš„ç›‘å¬å™¨ HostConfig å°±é å®ƒæ¥è°ƒç”¨')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fireLifecycleEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lifecycle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PERIODIC_EVENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°, ä¸ä»…æ¯ä¸ªå®¹å™¨å¯ä»¥æœ‰å‘¨æœŸæ€§ä»»åŠ¡, æ¯ä¸ªå®¹å™¨ä¸­çš„å…¶ä»–é€šç”¨ç»„ä»¶, æ¯”å¦‚è·Ÿé›†ç¾¤ç®¡ç†æœ‰å…³çš„ Cluster ç»„ä»¶, è·Ÿå®‰å…¨ç®¡ç†æœ‰å…³çš„ Realm ç»„ä»¶éƒ½å¯ä»¥æœ‰è‡ªå·±çš„å‘¨æœŸæ€§ä»»åŠ¡.")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°è¿‡, "),t("strong",[s._v("å®¹å™¨ä¹‹é—´çš„é“¾å¼è°ƒç”¨æ˜¯é€šè¿‡ Pipeline-Valve æœºåˆ¶")]),s._v("æ¥å®ç°çš„, ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°å®¹å™¨ä¸­çš„ Valve ä¹Ÿå¯ä»¥æœ‰å‘¨æœŸæ€§ä»»åŠ¡, å¹¶ä¸”è¢« ContainerBase ç»Ÿä¸€å¤„ç†.")]),s._v(" "),t("p",[s._v("è¯·ç‰¹åˆ«æ³¨æ„, åœ¨ backgroundProcess() æ–¹æ³•çš„æœ€å, è¿˜"),t("strong",[s._v('è§¦å‘äº†å®¹å™¨çš„ "å‘¨æœŸäº‹ä»¶"')]),s._v(' . æˆ‘ä»¬çŸ¥é“å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶æœ‰åˆå§‹åŒ–, å¯åŠ¨å’Œåœæ­¢ç­‰, é‚£ "å‘¨æœŸäº‹ä»¶" åˆæ˜¯ä»€ä¹ˆå‘¢? å®ƒè·Ÿç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¸€æ ·, æ˜¯ä¸€ç§æ‰©å±•æœºåˆ¶, å¯ä»¥è¿™æ ·ç†è§£:')]),s._v(" "),t("p",[s._v('åˆä¸€æ®µæ—¶é—´è¿‡å»äº†, å®¹å™¨è¿˜æ´»ç€, ä½ æƒ³åšç‚¹ä»€ä¹ˆå—? å¦‚æœä½ æƒ³åšç‚¹ä»€ä¹ˆ, å°±åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨æ¥ç›‘å¬è¿™ä¸ª "å‘¨æœŸäº‹ä»¶", äº‹ä»¶åˆ°äº†æˆ‘è´Ÿè´£è°ƒç”¨ä½ çš„æ–¹æ³•.')]),s._v(" "),t("p",[s._v("æ€»ä¹‹, æœ‰äº† ContainerBase ä¸­çš„åå°çº¿ç¨‹å’Œ backgroundProcess() æ–¹æ³•, å„ç§å­å®¹å™¨å’Œé€šç”¨ç»„ä»¶ä¸éœ€è¦å„è‡ªå¼„ä¸€ä¸ªåå°çº¿ç¨‹æ¥å¤„ç†å‘¨æœŸæ€§ä»»åŠ¡, è¿™æ ·çš„è®¾è®¡æ˜¾å¾—ä¼˜é›…å’Œæ•´æ´.")]),s._v(" "),t("h5",{attrs:{id:"tomcatçƒ­åŠ è½½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatçƒ­åŠ è½½"}},[s._v("#")]),s._v(" Tomcatçƒ­åŠ è½½")]),s._v(" "),t("p",[s._v('æœ‰äº† ContainerBase çš„å‘¨æœŸæ€§ä»»åŠ¡å¤„ç† "æ¡†æ¶", ä½œä¸º'),t("strong",[s._v("å…·ä½“å®¹å™¨å­ç±», åªéœ€è¦å®ç°è‡ªå·±çš„å‘¨æœŸæ€§ä»»åŠ¡å°±è¡Œ")]),s._v(". è€Œ Tomcat çš„çƒ­åŠ è½½, å°±æ˜¯åœ¨ Context å®¹å™¨ä¸­å®ç°çš„. Context å®¹å™¨çš„ backgroundProcess() æ–¹æ³•æ˜¯è¿™æ ·å®ç°çš„:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// WebappLoader å‘¨æœŸæ€§çš„æ£€æŸ¥ WEB-INF/classes å’Œ WEB-INF/lib ç›®å½•ä¸‹çš„ç±»æ–‡ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Loader")]),s._v(" loader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLoader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        loader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Session ç®¡ç†å™¨å‘¨æœŸæ€§çš„æ£€æŸ¥æ˜¯å¦æœ‰è¿‡æœŸçš„ Session")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Manager")]),s._v(" manager "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("manager "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        manager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘¨æœŸæ€§çš„æ£€æŸ¥é™æ€èµ„æºæ˜¯å¦æœ‰å˜åŒ–")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebResourceRoot")]),s._v(" resources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        resources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨çˆ¶ç±» ContainerBase çš„ backgroundProcess æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[t("strong",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ° Context å®¹å™¨é€šè¿‡ WebappLoader æ¥æ£€æŸ¥ç±»æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°, é€šè¿‡ Session ç®¡ç†å™¨æ¥æ£€æŸ¥æ˜¯å¦æœ‰ Session è¿‡æœŸ, å¹¶ä¸”é€šè¿‡èµ„æºç®¡ç†å™¨æ¥æ£€æŸ¥é™æ€èµ„æºæ˜¯å¦æœ‰æ›´æ–°, æœ€åè¿˜è°ƒç”¨äº†çˆ¶ç±» ContainerBase çš„ backgroundProcess() æ–¹æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™é‡Œè¦é‡ç‚¹å…³æ³¨, WebappLoader æ˜¯å¦‚ä½•å®ç°çƒ­åŠ è½½çš„, å®ƒä¸»è¦æ˜¯è°ƒç”¨äº† Context å®¹å™¨çš„ reload() æ–¹æ³•, è€Œ Context çš„ reload() æ–¹æ³•æ¯”è¾ƒå¤æ‚, æ€»ç»“èµ·æ¥, ä¸»è¦å®Œæˆäº†ä¸‹é¢è¿™äº›ä»»åŠ¡:")]),s._v(" "),t("ol",[t("li",[s._v("åœæ­¢å’Œé”€æ¯ Context å®¹å™¨åŠå…¶æ‰€æœ‰å­å®¹å™¨, å­å®¹å™¨å…¶å®å°±æ˜¯ Wrapper, ä¹Ÿå°±æ˜¯è¯´ Wrapper é‡Œé¢ Servlet å®ä¾‹ä¹Ÿè¢«é”€æ¯äº†.")]),s._v(" "),t("li",[s._v("åœæ­¢å’Œé”€æ¯ Context å®¹å™¨å…³è”çš„ Listener å’Œ Filter.")]),s._v(" "),t("li",[s._v("åœæ­¢å’Œé”€æ¯ Context ä¸‹çš„ Pipeline å’Œå„ç§ Valve.")]),s._v(" "),t("li",[s._v("åœæ­¢å’Œé”€æ¯ Context çš„ç±»åŠ è½½å™¨, ä»¥åŠç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ–‡ä»¶èµ„æº.")]),s._v(" "),t("li",[s._v("å¯åŠ¨ Context å®¹å™¨, åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šé‡æ–°åˆ›å»ºå‰é¢å››æ­¥è¢«é”€æ¯çš„èµ„æº.")])]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, "),t("strong",[s._v("ç±»åŠ è½½å™¨")]),s._v("å‘æŒ¥ç€å…³é”®ä½œç”¨. ä¸€ä¸ª Context å®¹å™¨å¯¹åº”ä¸€ä¸ªç±»åŠ è½½å™¨, ç±»åŠ è½½å™¨åœ¨é”€æ¯çš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒåŠ è½½çš„æ‰€æœ‰ç±»ä¹Ÿå…¨éƒ¨é”€æ¯. Context å®¹å™¨åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­, ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»åŠ è½½å™¨æ¥åŠ è½½æ–°çš„ç±»æ–‡ä»¶.")]),s._v(" "),t("p",[s._v("åœ¨ Context çš„ reload() æ–¹æ³•é‡Œ, å¹¶æ²¡æœ‰è°ƒç”¨ Session ç®¡ç†å™¨çš„ distroy() æ–¹æ³•, ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ª Context å…³è”çš„ Session æ˜¯æ²¡æœ‰é”€æ¯çš„. è¿˜éœ€è¦æ³¨æ„çš„æ˜¯, Tomcat çš„"),t("strong",[s._v("çƒ­åŠ è½½é»˜è®¤æ˜¯å…³é—­")]),s._v("çš„, éœ€è¦åœ¨ conf ç›®å½•ä¸‹çš„ Context.xml æ–‡ä»¶ä¸­è®¾ç½® reloadable å‚æ•°æ¥å¼€å¯è¿™ä¸ªåŠŸèƒ½, åƒä¸‹é¢è¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Context")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("reloadable")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"tomcatçƒ­éƒ¨ç½²"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatçƒ­éƒ¨ç½²"}},[s._v("#")]),s._v(" Tomcatçƒ­éƒ¨ç½²")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹çœ‹çƒ­éƒ¨ç½², çƒ­éƒ¨ç½²è·Ÿçƒ­åŠ è½½çš„æœ¬è´¨åŒºåˆ«æ˜¯, "),t("strong",[s._v("çƒ­éƒ¨ç½²ä¼šé‡æ–°éƒ¨ç½² Web åº”ç”¨, åŸæ¥çš„ Context å¯¹è±¡ä¼šæ•´ä¸ªè¢«é”€æ¯æ‰, å› æ­¤è¿™ä¸ª Context æ‰€å…³è”çš„ä¸€åˆ‡èµ„æºéƒ½ä¼šè¢«é”€æ¯, åŒ…æ‹¬ Session")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ Tomcat çƒ­éƒ¨ç½²åˆæ˜¯ç”±å“ªä¸ªå®¹å™¨æ¥å®ç°çš„å‘¢? åº”è¯¥ä¸æ˜¯ç”± Context, å› ä¸ºçƒ­éƒ¨ç½²è¿‡ç¨‹ä¸­ Context å®¹å™¨è¢«é”€æ¯äº†, é‚£ä¹ˆè¿™ä¸ªé‡æ‹…å°±è½åœ¨ "),t("strong",[s._v("Host")]),s._v(" èº«ä¸Šäº†, å› ä¸ºå®ƒæ˜¯ Context çš„çˆ¶å®¹å™¨.")]),s._v(" "),t("p",[s._v("è·Ÿ Context ä¸ä¸€æ ·, Host å®¹å™¨å¹¶æ²¡æœ‰åœ¨ backgroundProcess() æ–¹æ³•ä¸­å®ç°å‘¨æœŸæ€§æ£€æµ‹çš„ä»»åŠ¡, è€Œæ˜¯"),t("strong",[s._v('é€šè¿‡ç›‘å¬å™¨ HostConfig æ¥å®ç°çš„, HostConfig å°±æ˜¯å‰é¢æåˆ°çš„ "å‘¨æœŸäº‹ä»¶" çš„ç›‘å¬å™¨')]),s._v(', é‚£ "å‘¨æœŸäº‹ä»¶" è¾¾åˆ°æ—¶, HostConfig ä¼šåšä»€ä¹ˆäº‹å‘¢?')]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lifecycleEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifecycleEvent")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œ check æ–¹æ³•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Lifecycle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PERIODIC_EVENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("å®ƒæ‰§è¡Œäº† check() æ–¹æ³•, æ¥ç€æ¥çœ‹ check() æ–¹æ³•é‡Œåšäº†ä»€ä¹ˆ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAutoDeploy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ£€æŸ¥è¿™ä¸ª Host ä¸‹æ‰€æœ‰å·²ç»éƒ¨ç½²çš„ Web åº”ç”¨")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DeployedApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" apps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n            deployed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("values")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toArray")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DeployedApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" apps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ£€æŸ¥ Web åº”ç”¨ç›®å½•æ˜¯å¦æœ‰å˜åŒ–")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkResources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("apps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œéƒ¨ç½²")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("deployApps")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("å…¶å® HostConfig ä¼šæ£€æŸ¥ webapps ç›®å½•ä¸‹çš„æ‰€æœ‰ Web åº”ç”¨:")]),s._v(" "),t("ul",[t("li",[s._v("**å¦‚æœåŸæ¥ Web åº”ç”¨ç›®å½•è¢«åˆ æ‰äº†, å°±æŠŠç›¸åº” Context å®¹å™¨æ•´ä¸ªé”€æ¯æ‰. **")]),s._v(" "),t("li",[s._v("**æ˜¯å¦æœ‰æ–°çš„ Web åº”ç”¨ç›®å½•æ”¾è¿›æ¥äº†, æˆ–è€…æœ‰æ–°çš„ WAR åŒ…æ”¾è¿›æ¥äº†, å°±éƒ¨ç½²ç›¸åº”çš„ Web åº”ç”¨. **")])]),s._v(" "),t("p",[s._v('å› æ­¤ HostConfig åšçš„äº‹æƒ…éƒ½æ˜¯æ¯”è¾ƒ "å®è§‚" çš„, å®ƒä¸ä¼šå»æ£€æŸ¥å…·ä½“ç±»æ–‡ä»¶æˆ–è€…èµ„æºæ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–, è€Œæ˜¯æ£€æŸ¥ Web åº”ç”¨ç›®å½•çº§åˆ«çš„å˜åŒ–.')]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-10"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-10"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("è¿™é‡Œä»‹ç»äº† Tomcat çš„çƒ­åŠ è½½å’Œçƒ­éƒ¨ç½², å®ƒä»¬çš„ç›®çš„éƒ½æ˜¯åœ¨ä¸é‡å¯ Tomcat çš„æƒ…å†µä¸‹å®ç° Web åº”ç”¨çš„æ›´æ–°.")]),s._v(" "),t("p",[s._v("çƒ­åŠ è½½çš„ç²’åº¦æ¯”è¾ƒå°, ä¸»è¦æ˜¯é’ˆå¯¹ç±»æ–‡ä»¶çš„æ›´æ–°, é€šè¿‡åˆ›å»ºæ–°çš„ç±»åŠ è½½å™¨æ¥å®ç°é‡æ–°åŠ è½½. è€Œçƒ­éƒ¨ç½²æ˜¯é’ˆå¯¹æ•´ä¸ª Web åº”ç”¨çš„, Tomcat ä¼šå°†åŸæ¥çš„ Context å¯¹è±¡æ•´ä¸ªé”€æ¯æ‰, å†é‡æ–°åˆ›å»º Context å®¹å™¨å¯¹è±¡.")]),s._v(" "),t("p",[s._v("çƒ­åŠ è½½å’Œçƒ­éƒ¨ç½²çš„å®ç°éƒ½ç¦»ä¸å¼€åå°çº¿ç¨‹çš„å‘¨æœŸæ€§æ£€æŸ¥, Tomcat åœ¨åŸºç±» ContainerBase ä¸­ç»Ÿä¸€å®ç°äº†åå°çº¿ç¨‹çš„å¤„ç†é€»è¾‘, å¹¶åœ¨é¡¶å±‚å®¹å™¨ Engine å¯åŠ¨åå°çº¿ç¨‹, è¿™æ ·å­å®¹å™¨ç»„ä»¶ç”šè‡³å„ç§é€šç”¨ç»„ä»¶éƒ½ä¸éœ€è¦è‡ªå·±å»åˆ›å»ºåå°çº¿ç¨‹, è¿™æ ·çš„è®¾è®¡æ˜¾å¾—ä¼˜é›…æ•´æ´.")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("h4",{attrs:{id:"_24-contextå®¹å™¨-ä¸Š-tomcatå¦‚ä½•æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_24-contextå®¹å™¨-ä¸Š-tomcatå¦‚ä½•æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶"}},[s._v("#")]),s._v(" 24.Contextå®¹å™¨(ä¸Š):Tomcatå¦‚ä½•æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶?")]),s._v(" "),t("p",[s._v("ClassNotFound å¼‚å¸¸è¡¨ç¤º JVM åœ¨å°è¯•åŠ è½½æŸä¸ªç±»çš„æ—¶å€™å¤±è´¥äº†. æƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜, é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯ç±»åŠ è½½, JVM æ˜¯å¦‚ä½•åŠ è½½ç±»çš„, ä»¥åŠä¸ºä»€ä¹ˆä¼šå‡ºç° ClassNotFound å¼‚å¸¸? å¼„æ‡‚ä¸Šé¢è¿™äº›é—®é¢˜ä¹‹å, æ¥ç€è¦æ€è€ƒ Tomcat ä½œä¸º Web å®¹å™¨, å®ƒæ˜¯å¦‚ä½•åŠ è½½å’Œç®¡ç† Web åº”ç”¨ä¸‹çš„ Servlet å‘¢?")]),s._v(" "),t("p",[s._v("Tomcat æ­£æ˜¯é€šè¿‡ Context ç»„ä»¶æ¥åŠ è½½ç®¡ç† Web åº”ç”¨çš„, æ‰€ä»¥è¿™é‡Œè¯¦ç»†åˆ†æ Tomcat çš„ç±»åŠ è½½æœºåˆ¶. ä½†åœ¨è¿™ä¹‹å‰, æœ‰å¿…è¦é¢„ä¹ ä¸€ä¸‹ JVM çš„ç±»åŠ è½½æœºåˆ¶, æ¥ç€å†è°ˆè°ˆ Tomcat çš„ç±»åŠ è½½å™¨å¦‚ä½•æ‰“ç ´ Java çš„åŒäº²å§”æ‰˜æœºåˆ¶.")]),s._v(" "),t("h5",{attrs:{id:"jvmçš„ç±»åŠ è½½å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvmçš„ç±»åŠ è½½å™¨"}},[s._v("#")]),s._v(" JVMçš„ç±»åŠ è½½å™¨")]),s._v(" "),t("p",[s._v('Java çš„ç±»åŠ è½½, å°±æ˜¯æŠŠå­—èŠ‚ç æ ¼å¼ ".class" æ–‡ä»¶åŠ è½½åˆ° JVM çš„'),t("strong",[s._v("æ–¹æ³•åŒº")]),s._v(", å¹¶åœ¨ JVM çš„"),t("strong",[s._v("å †åŒº")]),s._v("å»ºç«‹ä¸€ä¸ª "),t("code",[s._v("java.lang.Class")]),s._v("â€‹ å¯¹è±¡çš„å®ä¾‹, ç”¨æ¥å°è£… Java ç±»ç›¸å…³çš„æ•°æ®å’Œæ–¹æ³•. é‚£ Class å¯¹è±¡åˆæ˜¯ä»€ä¹ˆå‘¢? ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆä¸šåŠ¡ç±»çš„æ¨¡æ¿, JVM æ ¹æ®è¿™ä¸ªæ¨¡æ¿æ¥åˆ›å»ºå…·ä½“ä¸šåŠ¡ç±»å¯¹è±¡å®ä¾‹.")]),s._v(" "),t("p",[s._v('JVM å¹¶ä¸æ˜¯åœ¨å¯åŠ¨æ—¶å°±æŠŠæ‰€æœ‰çš„ ".class" æ–‡ä»¶éƒ½åŠ è½½ä¸€é, è€Œæ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­'),t("strong",[s._v("ç”¨åˆ°äº†è¿™ä¸ªç±»æ‰å»åŠ è½½")]),s._v(". JVM ç±»åŠ è½½æ˜¯ç”±ç±»åŠ è½½å™¨æ¥å®Œæˆçš„, JDK æä¾›ä¸€ä¸ªæŠ½è±¡ç±» "),t("strong",[s._v("ClassLoader")]),s._v(", è¿™ä¸ªæŠ½è±¡ç±»ä¸­å®šä¹‰äº†ä¸‰ä¸ªå…³é”®æ–¹æ³•, ç†è§£æ¸…æ¥šå®ƒä»¬çš„ä½œç”¨å’Œå…³ç³»éå¸¸é‡è¦.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLoader")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰ä¸ªçˆ¶åŠ è½½å™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLoader")]),s._v(" parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŸ¥æ‰¾ä¸€ä¸‹è¿™ä¸ªç±»æ˜¯ä¸æ˜¯å·²ç»åŠ è½½è¿‡äº†")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findLoadedClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ²¡æœ‰åŠ è½½è¿‡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…ˆå§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»åŠ è½½, æ³¨æ„è¿™æ˜¯ä¸ªé€’å½’è°ƒç”¨")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("parent "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœçˆ¶åŠ è½½å™¨ä¸ºç©º, æŸ¥æ‰¾ Bootstrap åŠ è½½å™¨æ˜¯ä¸æ˜¯åŠ è½½è¿‡äº†")]),s._v("\n              c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findBootstrapClassOrNull")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœçˆ¶åŠ è½½å™¨æ²¡åŠ è½½æˆåŠŸ, è°ƒç”¨è‡ªå·±çš„ findClass å»åŠ è½½")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. æ ¹æ®ä¼ å…¥çš„ç±»å name, åˆ°åœ¨ç‰¹å®šç›®å½•ä¸‹å»å¯»æ‰¾ç±»æ–‡ä»¶, æŠŠ.class æ–‡ä»¶è¯»å…¥å†…å­˜")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  \n       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. è°ƒç”¨ defineClass å°†å­—èŠ‚æ•°ç»„è½¬æˆ Class å¯¹è±¡")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("defineClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†å­—èŠ‚ç æ•°ç»„è§£ææˆä¸€ä¸ª Class å¯¹è±¡, ç”¨ native æ–¹æ³•å®ç°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("defineClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥å¾—åˆ°å‡ ä¸ªå…³é”®ä¿¡æ¯:")]),s._v(" "),t("ul",[t("li",[s._v("JVM çš„ç±»åŠ è½½å™¨æ˜¯åˆ†å±‚æ¬¡çš„, å®ƒä»¬æœ‰çˆ¶å­å…³ç³», æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æŒæœ‰ä¸€ä¸ª parent å­—æ®µ, æŒ‡å‘çˆ¶åŠ è½½å™¨.")]),s._v(" "),t("li",[s._v("defineClass() æ˜¯ä¸ªå·¥å…·æ–¹æ³•, å®ƒçš„èŒè´£æ˜¯è°ƒç”¨ native æ–¹æ³•æŠŠ Java ç±»çš„å­—èŠ‚ç è§£ææˆä¸€ä¸ª Class å¯¹è±¡, æ‰€è°“çš„ native æ–¹æ³•å°±æ˜¯ç”± C è¯­è¨€å®ç°çš„æ–¹æ³•, Java é€šè¿‡ JNI æœºåˆ¶è°ƒç”¨.")]),s._v(" "),t("li",[s._v('findClass() æ–¹æ³•çš„ä¸»è¦èŒè´£å°±æ˜¯æ‰¾åˆ° ".class" æ–‡ä»¶, å¯èƒ½æ¥è‡ªæ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç½‘ç»œ, æ‰¾åˆ°åæŠŠ ".class" æ–‡ä»¶è¯»åˆ°å†…å­˜å¾—åˆ°å­—èŠ‚ç æ•°ç»„, ç„¶åè°ƒç”¨ defineClass() æ–¹æ³•å¾—åˆ° Class å¯¹è±¡.')]),s._v(" "),t("li",[s._v("loadClass() æ˜¯ä¸ª public æ–¹æ³•, è¯´æ˜å®ƒæ‰æ˜¯å¯¹å¤–æä¾›æœåŠ¡çš„æ¥å£, å…·ä½“å®ç°ä¹Ÿæ¯”è¾ƒæ¸…æ™°: é¦–å…ˆæ£€æŸ¥è¿™ä¸ªç±»æ˜¯ä¸æ˜¯å·²ç»è¢«åŠ è½½è¿‡äº†, å¦‚æœåŠ è½½è¿‡äº†ç›´æ¥è¿”å›, å¦åˆ™äº¤ç»™çˆ¶åŠ è½½å™¨å»åŠ è½½. è¯·æ³¨æ„, è¿™æ˜¯ä¸€ä¸ª"),t("strong",[s._v("é€’å½’è°ƒç”¨")]),s._v(", ä¹Ÿå°±æ˜¯è¯´å­åŠ è½½å™¨æŒæœ‰çˆ¶åŠ è½½å™¨çš„å¼•ç”¨, å½“ä¸€ä¸ªç±»åŠ è½½å™¨éœ€è¦åŠ è½½ä¸€ä¸ª Java ç±»æ—¶, ä¼šå…ˆå§”æ‰˜çˆ¶åŠ è½½å™¨å»åŠ è½½, ç„¶åçˆ¶åŠ è½½å™¨åœ¨è‡ªå·±çš„åŠ è½½è·¯å¾„ä¸­æœç´¢ Java ç±», å½“çˆ¶åŠ è½½å™¨åœ¨è‡ªå·±çš„åŠ è½½èŒƒå›´å†…æ‰¾ä¸åˆ°æ—¶, æ‰ä¼šäº¤è¿˜ç»™å­åŠ è½½å™¨åŠ è½½, è¿™å°±æ˜¯"),t("strong",[s._v("åŒäº²å§”æ‰˜æœºåˆ¶")]),s._v(".")])]),s._v(" "),t("p",[s._v("JDK ä¸­æœ‰å“ªäº›é»˜è®¤çš„ç±»åŠ è½½å™¨? å®ƒä»¬çš„æœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆ? ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ‰˜æœºåˆ¶? JDK ä¸­æœ‰ 3 ä¸ªç±»åŠ è½½å™¨, å¦å¤–ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨, å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161811-bd1zrn7.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("BootstrapClassLoader")]),s._v(" æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨, ç”± C è¯­è¨€å®ç°, ç”¨æ¥åŠ è½½ JVM å¯åŠ¨æ—¶æ‰€éœ€è¦çš„æ ¸å¿ƒç±», æ¯”å¦‚ "),t("code",[s._v("rt.jar")]),s._v("â€‹, "),t("code",[s._v("resources.jar")]),s._v("â€‹ ç­‰.")]),s._v(" "),t("li",[t("strong",[s._v("ExtClassLoader")]),s._v(" æ˜¯æ‰©å±•ç±»åŠ è½½å™¨, ç”¨æ¥åŠ è½½ "),t("code",[s._v("\\jre\\lib\\ext")]),s._v("â€‹ ç›®å½•ä¸‹ JAR åŒ….")]),s._v(" "),t("li",[t("strong",[s._v("AppClassLoader")]),s._v(" æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨, ç”¨æ¥åŠ è½½ classpath ä¸‹çš„ç±», åº”ç”¨ç¨‹åºé»˜è®¤ç”¨å®ƒæ¥åŠ è½½ç±».")]),s._v(" "),t("li",[s._v("è‡ªå®šä¹‰ç±»åŠ è½½å™¨, ç”¨æ¥åŠ è½½è‡ªå®šä¹‰è·¯å¾„ä¸‹çš„ç±».")])]),s._v(" "),t("p",[s._v("è¿™äº›ç±»åŠ è½½å™¨çš„å·¥ä½œåŸç†æ˜¯ä¸€æ ·çš„, åŒºåˆ«æ˜¯å®ƒä»¬çš„"),t("strong",[s._v("åŠ è½½è·¯å¾„ä¸åŒ")]),s._v(", ä¹Ÿå°±æ˜¯è¯´ findClass() è¿™ä¸ªæ–¹æ³•æŸ¥æ‰¾çš„è·¯å¾„ä¸åŒ. åŒäº²å§”æ‰˜æœºåˆ¶æ˜¯ä¸ºäº†ä¿è¯ä¸€ä¸ª Java ç±»åœ¨ JVM ä¸­æ˜¯å”¯ä¸€çš„, å‡å¦‚ä½ ä¸å°å¿ƒå†™äº†ä¸€ä¸ªä¸ JRE æ ¸å¿ƒç±»åŒåçš„ç±», æ¯”å¦‚ Object ç±», åŒäº²å§”æ‰˜æœºåˆ¶èƒ½ä¿è¯åŠ è½½çš„æ˜¯ JRE é‡Œçš„é‚£ä¸ª Object ç±», è€Œä¸æ˜¯ä½ å†™çš„ Object ç±». è¿™æ˜¯å› ä¸º AppClassLoader åœ¨åŠ è½½ä½ çš„ Object ç±»æ—¶, ä¼šå§”æ‰˜ç»™ ExtClassLoader å»åŠ è½½, è€Œ ExtClassLoader åˆä¼šå§”æ‰˜ç»™ BootstrapClassLoader, BootstrapClassLoader å‘ç°è‡ªå·±å·²ç»åŠ è½½è¿‡äº† Object ç±», ä¼šç›´æ¥è¿”å›, ä¸ä¼šå»åŠ è½½ä½ å†™çš„ Object ç±».")]),s._v(" "),t("p",[s._v("è¯·æ³¨æ„, "),t("strong",[s._v("ç±»åŠ è½½å™¨çš„çˆ¶å­å…³ç³»ä¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥å®ç°çš„, æ¯”å¦‚ AppClassLoader å¹¶ä¸æ˜¯ ExtClassLoader çš„å­ç±», è€Œæ˜¯è¯´ AppClassLoader çš„ parent æˆå‘˜å˜é‡æŒ‡å‘ ExtClassLoader å¯¹è±¡")]),s._v(". åŒæ ·çš„é“ç†, å¦‚æœè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨, ä¸å»ç»§æ‰¿ AppClassLoader, è€Œæ˜¯ç»§æ‰¿ ClassLoader æŠ½è±¡ç±», å†é‡å†™ findClass() å’Œ loadClass() æ–¹æ³•å³å¯, "),t("strong",[s._v("Tomcat å°±æ˜¯é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å®ç°è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘")]),s._v(". å› æ­¤å¦‚æœè¦æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶, å°±éœ€è¦é‡å†™ loadClass() æ–¹æ³•, å› ä¸º loadClass() çš„é»˜è®¤å®ç°å°±æ˜¯åŒäº²å§”æ‰˜æœºåˆ¶.")]),s._v(" "),t("h5",{attrs:{id:"tomcatçš„ç±»åŠ è½½å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatçš„ç±»åŠ è½½å™¨"}},[s._v("#")]),s._v(" Tomcatçš„ç±»åŠ è½½å™¨")]),s._v(" "),t("p",[s._v("Tomcat çš„è‡ªå®šä¹‰ç±»åŠ è½½å™¨ "),t("strong",[s._v("WebAppClassLoader")]),s._v(" æ‰“ç ´äº†åŒäº²å§”æ‰˜æœºåˆ¶, å®ƒ"),t("strong",[s._v("é¦–å…ˆè‡ªå·±å°è¯•å»åŠ è½½æŸä¸ªç±», å¦‚æœæ‰¾ä¸åˆ°å†ä»£ç†ç»™çˆ¶ç±»åŠ è½½å™¨")]),s._v(", å…¶ç›®çš„æ˜¯"),t("strong",[s._v("ä¼˜å…ˆåŠ è½½ Web åº”ç”¨è‡ªå·±å®šä¹‰çš„ç±»")]),s._v(". å…·ä½“å®ç°å°±æ˜¯é‡å†™ ClassLoader çš„ä¸¤ä¸ªæ–¹æ³•: findClass() å’Œ loadClass().")]),s._v(" "),t("h6",{attrs:{id:"_1-findclass-æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-findclass-æ–¹æ³•"}},[s._v("#")]),s._v(" 1.findClass()æ–¹æ³•")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹çœ‹ findClass() æ–¹æ³•çš„å®ç°, ä¸ºäº†æ–¹ä¾¿ç†è§£å’Œé˜…è¯», ä¸‹é¢å»æ‰äº†ä¸€äº›ç»†èŠ‚:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassNotFoundException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. å…ˆåœ¨ Web åº”ç”¨ç›®å½•ä¸‹æŸ¥æ‰¾ç±» ")]),s._v("\n            clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findClassInternal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. å¦‚æœåœ¨æœ¬åœ°ç›®å½•æ²¡æœ‰æ‰¾åˆ°, äº¤ç»™çˆ¶åŠ è½½å™¨å»æŸ¥æ‰¾")]),s._v("\n            clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. å¦‚æœçˆ¶ç±»ä¹Ÿæ²¡æ‰¾åˆ°, æŠ›å‡º ClassNotFoundException")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassNotFoundException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("åœ¨ findClass() æ–¹æ³•é‡Œ, ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤:")]),s._v(" "),t("ol",[t("li",[s._v("**å…ˆåœ¨ Web åº”ç”¨æœ¬åœ°ç›®å½•ä¸‹æŸ¥æ‰¾è¦åŠ è½½çš„ç±». **")]),s._v(" "),t("li",[s._v("**å¦‚æœæ²¡æœ‰æ‰¾åˆ°, äº¤ç»™çˆ¶åŠ è½½å™¨å»æŸ¥æ‰¾, å®ƒçš„çˆ¶åŠ è½½å™¨å°±æ˜¯ä¸Šé¢æåˆ°çš„ç³»ç»Ÿç±»åŠ è½½å™¨ AppClassLoader. **")]),s._v(" "),t("li",[s._v("**å¦‚ä½•çˆ¶åŠ è½½å™¨ä¹Ÿæ²¡æ‰¾åˆ°è¿™ä¸ªç±», æŠ›å‡º ClassNotFound å¼‚å¸¸. **")])]),s._v(" "),t("h6",{attrs:{id:"_2-loadclass-æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-loadclass-æ–¹æ³•"}},[s._v("#")]),s._v(" 2.loadClass()æ–¹æ³•")]),s._v(" "),t("p",[s._v("æ¥ç€å†æ¥çœ‹ Tomcat ç±»åŠ è½½å™¨çš„ loadClass() æ–¹æ³•çš„å®ç°, åŒæ ·ä¹Ÿå»æ‰äº†ä¸€äº›ç»†èŠ‚:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassNotFoundException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClassLoadingLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. å…ˆåœ¨æœ¬åœ° cache æŸ¥æ‰¾è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡")]),s._v("\n        clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findLoadedClass0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolveClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. ä»ç³»ç»Ÿç±»åŠ è½½å™¨çš„ cache ä¸­æŸ¥æ‰¾æ˜¯å¦åŠ è½½è¿‡")]),s._v("\n        clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findLoadedClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolveClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. å°è¯•ç”¨ ExtClassLoader ç±»åŠ è½½å™¨ç±»åŠ è½½, ä¸ºä»€ä¹ˆ? ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLoader")]),s._v(" javaseLoader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getJavaseClassLoader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" javaseLoader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolveClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassNotFoundException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Ignore")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. å°è¯•åœ¨æœ¬åœ°ç›®å½•æœç´¢ class å¹¶åŠ è½½")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolveClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassNotFoundException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Ignore")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5. å°è¯•ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ (ä¹Ÿå°±æ˜¯ AppClassLoader) æ¥åŠ è½½")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolveClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" clazz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassNotFoundException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Ignore")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 6. ä¸Šè¿°è¿‡ç¨‹éƒ½åŠ è½½å¤±è´¥, æŠ›å‡ºå¼‚å¸¸")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassNotFoundException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br")])]),t("p",[s._v("loadClass() æ–¹æ³•ç¨å¾®å¤æ‚ä¸€ç‚¹, ä¸»è¦æœ‰å…­ä¸ªæ­¥éª¤:")]),s._v(" "),t("ol",[t("li",[s._v("å…ˆåœ¨æœ¬åœ° Cache æŸ¥æ‰¾è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡, ä¹Ÿå°±æ˜¯è¯´ Tomcat çš„ç±»åŠ è½½å™¨æ˜¯å¦å·²ç»åŠ è½½è¿‡è¿™ä¸ªç±».")]),s._v(" "),t("li",[s._v("å¦‚æœ Tomcat ç±»åŠ è½½å™¨æ²¡æœ‰åŠ è½½è¿‡è¿™ä¸ªç±», å†çœ‹çœ‹ç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯å¦åŠ è½½è¿‡.")]),s._v(" "),t("li",[s._v("å¦‚æœéƒ½æ²¡æœ‰, å°±è®© "),t("strong",[s._v("ExtClassLoader ** å»åŠ è½½, è¿™ä¸€æ­¥æ¯”è¾ƒå…³é”®, ç›®çš„")]),s._v("é˜²æ­¢ Web åº”ç”¨è‡ªå·±çš„ç±»è¦†ç›– JRE çš„æ ¸å¿ƒç±»**. å› ä¸º Tomcat éœ€è¦æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶, å‡å¦‚ Web åº”ç”¨é‡Œè‡ªå®šä¹‰äº†ä¸€ä¸ªå« Object çš„ç±», å¦‚æœå…ˆåŠ è½½è¿™ä¸ª Object ç±», å°±ä¼šè¦†ç›– JRE é‡Œé¢çš„é‚£ä¸ª Object ç±», è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Tomcat çš„ç±»åŠ è½½å™¨ä¼š"),t("strong",[s._v("ä¼˜å…ˆå°è¯•ç”¨ ExtClassLoader å»åŠ è½½")]),s._v(", å› ä¸º ExtClassLoader ä¼šå§”æ‰˜ç»™ BootstrapClassLoader å»åŠ è½½, BootstrapClassLoader å‘ç°è‡ªå·±å·²ç»åŠ è½½äº† Object ç±», ç›´æ¥è¿”å›ç»™ Tomcat çš„ç±»åŠ è½½å™¨, è¿™æ · Tomcat çš„ç±»åŠ è½½å™¨å°±ä¸ä¼šå»åŠ è½½ Web åº”ç”¨ä¸‹çš„ Object ç±»äº†, ä¹Ÿå°±é¿å…äº†è¦†ç›– JRE æ ¸å¿ƒç±»çš„é—®é¢˜.")]),s._v(" "),t("li",[s._v("å¦‚æœ ExtClassLoader åŠ è½½å™¨åŠ è½½å¤±è´¥, ä¹Ÿå°±æ˜¯è¯´ JRE æ ¸å¿ƒç±»ä¸­æ²¡æœ‰è¿™ç±», é‚£ä¹ˆå°±åœ¨æœ¬åœ° Web åº”ç”¨ç›®å½•ä¸‹æŸ¥æ‰¾å¹¶åŠ è½½.")]),s._v(" "),t("li",[s._v("å¦‚æœæœ¬åœ°ç›®å½•ä¸‹æ²¡æœ‰è¿™ä¸ªç±», è¯´æ˜ä¸æ˜¯ Web åº”ç”¨è‡ªå·±å®šä¹‰çš„ç±», é‚£ä¹ˆç”±"),t("strong",[s._v("ç³»ç»Ÿç±»åŠ è½½å™¨å»åŠ è½½")]),s._v(". è¿™é‡Œè¯·æ³¨æ„, Web åº”ç”¨æ˜¯é€šè¿‡"),t("code",[s._v("Class.forName")]),s._v("â€‹ è°ƒç”¨äº¤ç»™ç³»ç»Ÿç±»åŠ è½½å™¨çš„, å› ä¸º "),t("code",[s._v("Class.forName")]),s._v("â€‹ çš„é»˜è®¤åŠ è½½å™¨å°±æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨.")]),s._v(" "),t("li",[s._v("å¦‚æœä¸Šè¿°åŠ è½½è¿‡ç¨‹å…¨éƒ¨å¤±è´¥, æŠ›å‡º ClassNotFound å¼‚å¸¸.")])]),s._v(" "),t("p",[s._v("ä»ä¸Šé¢çš„è¿‡ç¨‹å¯ä»¥çœ‹åˆ°, "),t("strong",[s._v("Tomcat çš„ç±»åŠ è½½å™¨æ‰“ç ´äº†åŒäº²å§”æ‰˜æœºåˆ¶, æ²¡æœ‰ä¸€ä¸Šæ¥å°±ç›´æ¥å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨, è€Œæ˜¯å…ˆåœ¨æœ¬åœ°ç›®å½•ä¸‹åŠ è½½, ä¸ºäº†é¿å…æœ¬åœ°ç›®å½•ä¸‹çš„ç±»è¦†ç›– JRE çš„æ ¸å¿ƒç±», å…ˆå°è¯•ç”¨ JVM æ‰©å±•ç±»åŠ è½½å™¨ ExtClassLoader å»åŠ è½½. é‚£ä¸ºä»€ä¹ˆä¸å…ˆç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ AppClassLoader å»åŠ è½½? å¾ˆæ˜¾ç„¶, å¦‚æœæ˜¯è¿™æ ·çš„è¯, é‚£å°±å˜æˆåŒäº²å§”æ‰˜æœºåˆ¶äº†, è¿™å°±æ˜¯ Tomcat ç±»åŠ è½½å™¨çš„å·§å¦™ä¹‹å¤„")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-11"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-11"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("è¿™é‡Œä»‹ç»äº† JVM çš„ç±»åŠ è½½å™¨åŸç†å’Œæºç å‰–æ, ä»¥åŠ Tomcat çš„ç±»åŠ è½½å™¨æ˜¯å¦‚ä½•æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶çš„, ç›®çš„æ˜¯ä¸ºäº†ä¼˜å…ˆåŠ è½½ Web åº”ç”¨ç›®å½•ä¸‹çš„ç±», ç„¶åå†åŠ è½½å…¶ä»–ç›®å½•ä¸‹çš„ç±», è¿™ä¹Ÿæ˜¯ Servlet è§„èŒƒçš„æ¨èåšæ³•.")]),s._v(" "),t("p",[s._v("è¦æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶, éœ€è¦ç»§æ‰¿ ClassLoader æŠ½è±¡ç±», å¹¶ä¸”éœ€è¦é‡å†™å®ƒçš„ loadClass() æ–¹æ³•, å› ä¸º ClassLoader çš„é»˜è®¤å®ç°å°±æ˜¯åŒäº²å§”æ‰˜.")]),s._v(" "),t("h4",{attrs:{id:"_25-contextå®¹å™¨-ä¸­-tomcatå¦‚ä½•éš”ç¦»webåº”ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_25-contextå®¹å™¨-ä¸­-tomcatå¦‚ä½•éš”ç¦»webåº”ç”¨"}},[s._v("#")]),s._v(" 25.Contextå®¹å™¨(ä¸­):Tomcatå¦‚ä½•éš”ç¦»Webåº”ç”¨?")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°, Tomcat é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨ WebAppClassLoader æ‰“ç ´äº†åŒäº²å§”æ‰˜æœºåˆ¶, å…·ä½“æ¥è¯´å°±æ˜¯é‡å†™äº† JVM çš„ç±»åŠ è½½å™¨ ClassLoader çš„ findClass() æ–¹æ³•å’Œ loadClass() æ–¹æ³•, è¿™æ ·åšçš„ç›®çš„æ˜¯"),t("strong",[s._v("ä¼˜å…ˆåŠ è½½ Web åº”ç”¨ç›®å½•ä¸‹çš„ç±»")]),s._v(". é™¤æ­¤ä¹‹å¤–, ä½ è§‰å¾— Tomcat çš„ç±»åŠ è½½å™¨è¿˜éœ€è¦å®Œæˆå“ªäº›éœ€æ±‚å‘¢? æˆ–è€…è¯´åœ¨è®¾è®¡ä¸Šè¿˜éœ€è¦è€ƒè™‘å“ªäº›æ–¹é¢?")]),s._v(" "),t("p",[s._v("Tomcat ä½œä¸º Servlet å®¹å™¨, å®ƒè´Ÿè´£åŠ è½½ Servlet ç±», æ­¤å¤–å®ƒè¿˜è´Ÿè´£åŠ è½½ "),t("strong",[s._v("Servlet æ‰€ä¾èµ–çš„ JAR åŒ…")]),s._v(". å¹¶ä¸” Tomcat æœ¬èº«ä¹Ÿæ˜¯ä¹Ÿæ˜¯ä¸€ä¸ª Java ç¨‹åº, å› æ­¤å®ƒéœ€è¦åŠ è½½è‡ªå·±çš„ç±»å’Œä¾èµ–çš„ JAR åŒ…. é¦–å…ˆæ€è€ƒè¿™ä¸€ä¸‹è¿™å‡ ä¸ªé—®é¢˜:")]),s._v(" "),t("ol",[t("li",[s._v("å‡å¦‚åœ¨ Tomcat ä¸­è¿è¡Œäº†ä¸¤ä¸ª Web åº”ç”¨ç¨‹åº, ä¸¤ä¸ª Web åº”ç”¨ä¸­æœ‰"),t("strong",[s._v("åŒåçš„ Servlet")]),s._v(", ä½†æ˜¯åŠŸèƒ½ä¸åŒ, Tomcat éœ€è¦åŒæ—¶åŠ è½½å’Œç®¡ç†è¿™ä¸¤ä¸ªåŒåçš„ Servlet ç±», ä¿è¯å®ƒä»¬ä¸ä¼šå†²çª, å› æ­¤ Web åº”ç”¨ä¹‹é—´çš„ç±»éœ€è¦éš”ç¦».")]),s._v(" "),t("li",[s._v("å‡å¦‚ä¸¤ä¸ª Web åº”ç”¨éƒ½"),t("strong",[s._v("ä¾èµ–åŒä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ JAR åŒ…")]),s._v(", æ¯”å¦‚ Spring, é‚£ Spring çš„ JAR åŒ…è¢«åŠ è½½åˆ°å†…å­˜å, Tomcat è¦ä¿è¯è¿™ä¸¤ä¸ª Web åº”ç”¨èƒ½å¤Ÿå…±äº«, ä¹Ÿå°±æ˜¯è¯´ Spring çš„ JAR åŒ…åªè¢«åŠ è½½ä¸€æ¬¡, å¦åˆ™éšç€ä¾èµ–çš„ç¬¬ä¸‰æ–¹ JAR åŒ…å¢å¤š, JVM çš„å†…å­˜ä¼šè†¨èƒ€.")]),s._v(" "),t("li",[s._v("è·Ÿ JVM ä¸€æ ·, éœ€è¦éš”ç¦» Tomcat æœ¬èº«çš„ç±»å’Œ Web åº”ç”¨çš„ç±».")])]),s._v(" "),t("p",[s._v("åœ¨äº†è§£äº† Tomcat çš„ç±»åŠ è½½å™¨åœ¨è®¾è®¡æ—¶è¦è€ƒè™‘çš„è¿™äº›é—®é¢˜ä»¥å, è¿™é‡Œä¸»è¦æ¥åˆ†æä¸€ä¸‹ Tomcat æ˜¯å¦‚ä½•é€šè¿‡è®¾è®¡å¤šå±‚æ¬¡çš„ç±»åŠ è½½å™¨æ¥è§£å†³è¿™äº›é—®é¢˜çš„.")]),s._v(" "),t("h5",{attrs:{id:"tomcatç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„"}},[s._v("#")]),s._v(" Tomcatç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„")]),s._v(" "),t("p",[s._v("ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜, Tomcat è®¾è®¡äº†ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„, å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º. ä¸‹é¢è¯¦ç»†è§£é‡Šä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™äº›ç±»åŠ è½½å™¨, ä»¥åŠå®ƒä»¬å¦‚ä½•è§£å†³ä¸Šé¢è¿™äº›é—®é¢˜.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161829-mcilwn8.png",alt:""}})]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹"),t("strong",[s._v("ç¬¬ 1 ä¸ªé—®é¢˜")]),s._v(", å‡å¦‚ä½¿ç”¨ JVM é»˜è®¤ AppClassLoader æ¥åŠ è½½ Web åº”ç”¨, AppClassLoader åªèƒ½åŠ è½½ä¸€ä¸ª Servlet ç±», åœ¨åŠ è½½ç¬¬äºŒä¸ªåŒå Servlet ç±»æ—¶, AppClassLoader ä¼šè¿”å›ç¬¬ä¸€ä¸ª Servlet ç±»çš„ Class å®ä¾‹, è¿™æ˜¯å› ä¸ºåœ¨ AppClassLoader çœ‹æ¥, åŒåçš„ Servlet ç±»"),t("strong",[s._v("åªè¢«åŠ è½½ä¸€æ¬¡")]),s._v(".")]),s._v(" "),t("p",[s._v("å› æ­¤ Tomcat çš„è§£å†³æ–¹æ¡ˆæ˜¯"),t("strong",[s._v("è‡ªå®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨ WebAppClassLoader, å¹¶ä¸”ç»™æ¯ä¸ª Web åº”ç”¨åˆ›å»ºä¸€ä¸ªç±»åŠ è½½å™¨å®ä¾‹")]),s._v(". ç”±äº Context å®¹å™¨ç»„ä»¶å¯¹åº”ä¸€ä¸ª Web åº”ç”¨, å› æ­¤, æ¯ä¸ª Context å®¹å™¨è´Ÿè´£åˆ›å»ºå’Œç»´æŠ¤ä¸€ä¸ª WebAppClassLoader åŠ è½½å™¨å®ä¾‹. è¿™èƒŒåçš„åŸç†æ˜¯, "),t("strong",[s._v("ä¸åŒçš„åŠ è½½å™¨å®ä¾‹åŠ è½½çš„ç±»è¢«è®¤ä¸ºæ˜¯ä¸åŒçš„ç±»")]),s._v(", å³ä½¿å®ƒä»¬çš„ç±»åç›¸åŒ. è¿™å°±ç›¸å½“äºåœ¨ Java è™šæ‹Ÿæœºå†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªä¸ªç›¸äº’éš”ç¦»çš„ Java ç±»ç©ºé—´, "),t("strong",[s._v("æ¯ä¸€ä¸ª Web åº”ç”¨éƒ½æœ‰è‡ªå·±çš„ç±»ç©ºé—´, Web åº”ç”¨ä¹‹é—´é€šè¿‡å„è‡ªçš„ç±»åŠ è½½å™¨äº’ç›¸éš”ç¦»")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_1-sharedclassloader"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-sharedclassloader"}},[s._v("#")]),s._v(" 1.SharedClassLoader")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹"),t("strong",[s._v("ç¬¬ 2 ä¸ªé—®é¢˜")]),s._v(", æœ¬è´¨éœ€æ±‚æ˜¯ä¸¤ä¸ª Web åº”ç”¨ä¹‹é—´"),t("strong",[s._v("æ€ä¹ˆå…±äº«åº“ç±»")]),s._v(", å¹¶ä¸”ä¸èƒ½é‡å¤åŠ è½½ç›¸åŒçš„ç±». åœ¨åŒäº²å§”æ‰˜æœºåˆ¶é‡Œ, å„ä¸ªå­åŠ è½½å™¨éƒ½å¯ä»¥é€šè¿‡çˆ¶åŠ è½½å™¨å»åŠ è½½ç±», é‚£ä¹ˆæŠŠéœ€è¦å…±äº«çš„ç±»æ”¾åˆ°çˆ¶åŠ è½½å™¨çš„åŠ è½½è·¯å¾„ä¸‹ä¸å°±è¡Œäº†å—, åº”ç”¨ç¨‹åºä¹Ÿæ­£æ˜¯é€šè¿‡è¿™ç§æ–¹å¼å…±äº« JRE çš„æ ¸å¿ƒç±». å› æ­¤ Tomcat çš„è®¾è®¡è€…"),t("strong",[s._v("åˆåŠ äº†ä¸€ä¸ªç±»åŠ è½½å™¨ SharedClassLoader, ä½œä¸º WebAppClassLoader çš„çˆ¶åŠ è½½å™¨, ä¸“é—¨æ¥åŠ è½½ Web åº”ç”¨ä¹‹é—´å…±äº«çš„ç±»")]),s._v(". å¦‚æœ WebAppClassLoader è‡ªå·±æ²¡æœ‰åŠ è½½åˆ°æŸä¸ªç±», å°±ä¼šå§”æ‰˜çˆ¶åŠ è½½å™¨ SharedClassLoader å»åŠ è½½è¿™ä¸ªç±», SharedClassLoader ä¼šåœ¨æŒ‡å®šç›®å½•ä¸‹åŠ è½½å…±äº«ç±», ä¹‹åè¿”å›ç»™ WebAppClassLoader, è¿™æ ·å…±äº«çš„é—®é¢˜å°±è§£å†³äº†.")]),s._v(" "),t("h6",{attrs:{id:"_2-catalinaclassloader"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-catalinaclassloader"}},[s._v("#")]),s._v(" 2.CatalinaClassloader")]),s._v(" "),t("p",[s._v("æ¥çœ‹"),t("strong",[s._v("ç¬¬ 3 ä¸ªé—®é¢˜")]),s._v(", å¦‚ä½•éš”ç¦» Tomcat æœ¬èº«çš„ç±»å’Œ Web åº”ç”¨çš„ç±»? å¦‚æœ"),t("strong",[s._v("è¦å…±äº«å¯ä»¥é€šè¿‡çˆ¶å­å…³ç³», è¦éš”ç¦»é‚£å°±éœ€è¦å…„å¼Ÿå…³ç³»")]),s._v("äº†. å…„å¼Ÿå…³ç³»å°±æ˜¯æŒ‡ä¸¤ä¸ªç±»åŠ è½½å™¨æ˜¯å¹³è¡Œçš„, å®ƒä»¬å¯èƒ½æ‹¥æœ‰åŒä¸€ä¸ªçˆ¶åŠ è½½å™¨, ä½†æ˜¯ä¸¤ä¸ªå…„å¼Ÿç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯éš”ç¦»çš„. åŸºäºæ­¤ Tomcat åˆè®¾è®¡ä¸€ä¸ª"),t("strong",[s._v("ç±»åŠ è½½å™¨ CatalinaClassloader, ä¸“é—¨æ¥åŠ è½½ Tomcat è‡ªèº«çš„ç±»")]),s._v(". è¿™æ ·è®¾è®¡æœ‰ä¸ªé—®é¢˜, é‚£ Tomcat å’Œå„ Web åº”ç”¨ä¹‹é—´éœ€è¦å…±äº«ä¸€äº›ç±»æ—¶è¯¥æ€ä¹ˆåŠå‘¢?")]),s._v(" "),t("h6",{attrs:{id:"_3-commonclassloader"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-commonclassloader"}},[s._v("#")]),s._v(" 3.CommonClassLoader")]),s._v(" "),t("p",[s._v("è€åŠæ³•, è¿˜æ˜¯"),t("strong",[s._v("å†å¢åŠ ä¸€ä¸ª CommonClassLoader, ä½œä¸º CatalinaClassloader å’Œ SharedClassLoader çš„çˆ¶åŠ è½½å™¨")]),s._v(". CommonClassLoader èƒ½åŠ è½½çš„ç±»éƒ½å¯ä»¥è¢« CatalinaClassLoader å’Œ SharedClassLoader ä½¿ç”¨, è€Œ CatalinaClassLoader å’Œ SharedClassLoader èƒ½åŠ è½½çš„ç±»åˆ™ä¸å¯¹æ–¹ç›¸äº’éš”ç¦». WebAppClassLoader å¯ä»¥ä½¿ç”¨ SharedClassLoader åŠ è½½åˆ°çš„ç±», ä½†å„ä¸ª WebAppClassLoader å®ä¾‹ä¹‹é—´ç›¸äº’éš”ç¦».")]),s._v(" "),t("h5",{attrs:{id:"springçš„åŠ è½½é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#springçš„åŠ è½½é—®é¢˜"}},[s._v("#")]),s._v(" Springçš„åŠ è½½é—®é¢˜")]),s._v(" "),t("p",[s._v("åœ¨ JVM çš„å®ç°ä¸­æœ‰ä¸€æ¡éšå«çš„è§„åˆ™, é»˜è®¤æƒ…å†µä¸‹, "),t("strong",[s._v("å¦‚æœä¸€ä¸ªç±»ç”±ç±»åŠ è½½å™¨ A åŠ è½½, é‚£ä¹ˆè¿™ä¸ªç±»çš„ä¾èµ–ç±»ä¹Ÿæ˜¯ç”±ç›¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½")]),s._v(". æ¯”å¦‚ Spring ä½œä¸ºä¸€ä¸ª Bean å·¥å‚, å®ƒéœ€è¦åˆ›å»ºä¸šåŠ¡ç±»çš„å®ä¾‹, å¹¶ä¸”åœ¨åˆ›å»ºä¸šåŠ¡ç±»å®ä¾‹ä¹‹å‰éœ€è¦åŠ è½½è¿™äº›ç±». Spring æ˜¯é€šè¿‡è°ƒç”¨ "),t("code",[s._v("Class.forName")]),s._v("â€‹ æ¥åŠ è½½ä¸šåŠ¡ç±»çš„, æ¥çœ‹ä¸€ä¸‹ forName() çš„æºç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" className"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" caller "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Reflection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCallerClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forName0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("className"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLoader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClassLoader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("caller"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" caller"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°åœ¨ forName() çš„å‡½æ•°é‡Œ, ä¼šç”¨è°ƒç”¨è€…ä¹Ÿå°±æ˜¯ "),t("strong",[s._v("Spring çš„åŠ è½½å™¨å»åŠ è½½ä¸šåŠ¡ç±»")]),s._v(".")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°, Web åº”ç”¨ä¹‹é—´å…±äº«çš„ JAR åŒ…å¯ä»¥äº¤ç»™ SharedClassLoader æ¥åŠ è½½, ä»è€Œé¿å…é‡å¤åŠ è½½. "),t("strong",[s._v("Spring ä½œä¸ºå…±äº«çš„ç¬¬ä¸‰æ–¹ JAR åŒ…, å®ƒæœ¬èº«æ˜¯ç”± SharedClassLoader æ¥åŠ è½½çš„")]),s._v(", Spring åˆè¦å»åŠ è½½ä¸šåŠ¡ç±», æŒ‰ç…§å‰é¢é‚£æ¡è§„åˆ™, åŠ è½½ Spring çš„ç±»åŠ è½½å™¨ä¹Ÿä¼šç”¨æ¥åŠ è½½ä¸šåŠ¡ç±», ä½†æ˜¯ä¸šåŠ¡ç±»åœ¨ Web åº”ç”¨ç›®å½•ä¸‹, ä¸åœ¨ SharedClassLoader çš„åŠ è½½è·¯å¾„ä¸‹, è¿™è¯¥æ€ä¹ˆåŠå‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("äºæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ç™»åœºäº†, å®ƒå…¶å®æ˜¯ä¸€ç§ç±»åŠ è½½å™¨ä¼ é€’æœºåˆ¶")]),s._v('. ä¸ºä»€ä¹ˆå«ä½œ "çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨" å‘¢, å› ä¸ºè¿™ä¸ªç±»åŠ è½½å™¨ä¿å­˜åœ¨çº¿ç¨‹ç§æœ‰æ•°æ®é‡Œ, åªè¦æ˜¯åŒä¸€ä¸ªçº¿ç¨‹, ä¸€æ—¦è®¾ç½®äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨, åœ¨çº¿ç¨‹åç»­æ‰§è¡Œè¿‡ç¨‹ä¸­å°±èƒ½æŠŠè¿™ä¸ªç±»åŠ è½½å™¨å–å‡ºæ¥ç”¨. '),t("strong",[s._v("å› æ­¤ Tomcat ä¸ºæ¯ä¸ª Web åº”ç”¨åˆ›å»ºä¸€ä¸ª WebAppClassLoarder ç±»åŠ è½½å™¨, å¹¶åœ¨å¯åŠ¨ Web åº”ç”¨çš„çº¿ç¨‹é‡Œè®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨, è¿™æ · Spring åœ¨å¯åŠ¨æ—¶å°±å°†çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨å–å‡ºæ¥, ç”¨æ¥åŠ è½½ Bean")]),s._v(". Spring å–çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½çš„ä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("cl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContextClassLoader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"æ€»ç»“-12"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-12"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† JVM çš„ç±»åŠ è½½å™¨åŸç†å¹¶å‰–æäº†æºç , ä»¥åŠ Tomcat çš„ç±»åŠ è½½å™¨çš„è®¾è®¡. é‡ç‚¹éœ€è¦ç†è§£çš„æ˜¯, Tomcat çš„ Context ç»„ä»¶ä¸ºæ¯ä¸ª Web åº”ç”¨åˆ›å»ºä¸€ä¸ª WebAppClassLoarder ç±»åŠ è½½å™¨, ç”±äº"),t("strong",[s._v("ä¸åŒç±»åŠ è½½å™¨å®ä¾‹åŠ è½½çš„ç±»æ˜¯äº’ç›¸éš”ç¦»çš„")]),s._v(", å› æ­¤è¾¾åˆ°äº†éš”ç¦» Web åº”ç”¨çš„ç›®çš„, åŒæ—¶é€šè¿‡ CommonClassLoader ç­‰çˆ¶åŠ è½½å™¨æ¥å…±äº«ç¬¬ä¸‰æ–¹ JAR åŒ…. è€Œå…±äº«çš„ç¬¬ä¸‰æ–¹ JAR åŒ…æ€ä¹ˆåŠ è½½ç‰¹å®š Web åº”ç”¨çš„ç±»å‘¢? å¯ä»¥é€šè¿‡è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨æ¥è§£å†³. æˆ‘ä»¬åº”è¯¥ç‰¢è®°çš„æ˜¯:")]),s._v(" "),t("ul",[t("li",[s._v("æ¯ä¸ª Web åº”ç”¨è‡ªå·±çš„ Java ç±»æ–‡ä»¶å’Œä¾èµ–çš„ JAR åŒ…, åˆ†åˆ«æ”¾åœ¨ "),t("code",[s._v("WEB-INF/classes")]),s._v("â€‹ å’Œ "),t("code",[s._v("WEB-INF/lib")]),s._v("â€‹ ç›®å½•ä¸‹é¢.")]),s._v(" "),t("li",[s._v("å¤šä¸ªåº”ç”¨å…±äº«çš„ Java ç±»æ–‡ä»¶å’Œ JAR åŒ…, åˆ†åˆ«æ”¾åœ¨ Web å®¹å™¨æŒ‡å®šçš„å…±äº«ç›®å½•ä¸‹.")]),s._v(" "),t("li",[s._v("å½“å‡ºç° ClassNotFound é”™è¯¯æ—¶, åº”è¯¥æ£€æŸ¥ç±»åŠ è½½å™¨æ˜¯å¦æ­£ç¡®.")])]),s._v(" "),t("p",[s._v("çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨ Tomcat å’Œ Spring ç±»åŠ è½½çš„åœºæ™¯é‡Œ, æ ¸å¿ƒæ¡†æ¶ç±»éœ€è¦åŠ è½½å…·ä½“å®ç°ç±»æ—¶éƒ½å¯ä»¥ç”¨åˆ°å®ƒ, æ¯”å¦‚ JDBC å°±æ˜¯é€šè¿‡ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥åŠ è½½ä¸åŒçš„æ•°æ®åº“é©±åŠ¨çš„, æ„Ÿå…´è¶£çš„è¯å¯ä»¥æ·±å…¥äº†è§£ä¸€ä¸‹.")]),s._v(" "),t("h4",{attrs:{id:"_26-contextå®¹å™¨-ä¸‹-tomcatå¦‚ä½•å®ç°servletè§„èŒƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_26-contextå®¹å™¨-ä¸‹-tomcatå¦‚ä½•å®ç°servletè§„èŒƒ"}},[s._v("#")]),s._v(" 26.Contextå®¹å™¨(ä¸‹):Tomcatå¦‚ä½•å®ç°Servletè§„èŒƒ?")]),s._v(" "),t("p",[s._v("Servlet å®¹å™¨æœ€é‡è¦çš„ä»»åŠ¡å°±æ˜¯åˆ›å»º Servlet çš„å®ä¾‹å¹¶ä¸”è°ƒç”¨ Servlet, å‰é¢åˆ†æäº† Tomcat å¦‚ä½•å®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥åŠ è½½ Servlet, ä½†åŠ è½½ Servlet çš„ç±»ä¸ç­‰äºåˆ›å»º Servlet çš„å®ä¾‹, ç±»åŠ è½½åªæ˜¯ç¬¬ä¸€æ­¥, ç±»åŠ è½½å¥½äº†æ‰èƒ½åˆ›å»ºç±»çš„å®ä¾‹, ä¹Ÿå°±æ˜¯è¯´ "),t("strong",[s._v("Tomcat å…ˆåŠ è½½ Servlet çš„ç±», ç„¶ååœ¨ Java å †ä¸Šåˆ›å»ºäº†ä¸€ä¸ª Servlet å®ä¾‹")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸€ä¸ª Web åº”ç”¨é‡Œå¾€å¾€æœ‰å¤šä¸ª Servlet, è€Œåœ¨ Tomcat ä¸­ä¸€ä¸ª Web åº”ç”¨å¯¹åº”ä¸€ä¸ª Context å®¹å™¨, ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Context å®¹å™¨éœ€è¦ç®¡ç†å¤šä¸ª Servlet å®ä¾‹. ä½† Context å®¹å™¨å¹¶ä¸ç›´æ¥æŒæœ‰ Servlet å®ä¾‹, è€Œæ˜¯é€šè¿‡å­å®¹å™¨ Wrapper æ¥ç®¡ç† Servlet, å¯ä»¥æŠŠ Wrapper å®¹å™¨çœ‹ä½œæ˜¯ Servlet çš„åŒ…è£….")]),s._v(" "),t("p",[s._v("é‚£ä¸ºä»€ä¹ˆéœ€è¦ Wrapper å‘¢? Context å®¹å™¨ç›´æ¥ç»´æŠ¤ä¸€ä¸ª Servlet æ•°ç»„ä¸å°±è¡Œäº†å—? è¿™æ˜¯å› ä¸º Servlet ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç±»å®ä¾‹, å®ƒè¿˜æœ‰ç›¸å…³çš„é…ç½®ä¿¡æ¯, æ¯”å¦‚å®ƒçš„ URL æ˜ å°„, å®ƒçš„åˆå§‹åŒ–å‚æ•°, å› æ­¤è®¾è®¡å‡ºäº†ä¸€ä¸ªåŒ…è£…å™¨, æŠŠ Servlet æœ¬èº«å’Œå®ƒç›¸å…³çš„æ•°æ®åŒ…èµ·æ¥, æ²¡é”™, è¿™å°±æ˜¯é¢å‘å¯¹è±¡çš„æ€æƒ³.")]),s._v(" "),t("p",[s._v("é‚£ç®¡ç†å¥½ Servlet å°±å®Œäº‹å¤§å‰äº†å—? åˆ«å¿˜äº† "),t("strong",[s._v("Servlet è¿˜æœ‰ä¸¤ä¸ªå…„å¼Ÿ: Listener å’Œ Filter")]),s._v(", å®ƒä»¬ä¹Ÿæ˜¯ Servlet è§„èŒƒä¸­çš„é‡è¦æˆå‘˜, å› æ­¤ Tomcat ä¹Ÿéœ€è¦åˆ›å»ºå®ƒä»¬çš„å®ä¾‹, ä¹Ÿéœ€è¦åœ¨åˆé€‚çš„æ—¶æœºå»è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ¥èŠä¸€èŠæ˜¯ Tomcat å¦‚ä½•åšåˆ°ä¸Šé¢è¿™äº›äº‹çš„.")]),s._v(" "),t("h5",{attrs:{id:"servletç®¡ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#servletç®¡ç†"}},[s._v("#")]),s._v(" Servletç®¡ç†")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°, Tomcat æ˜¯ç”¨ Wrapper å®¹å™¨æ¥ç®¡ç† Servlet çš„, é‚£ Wrapper å®¹å™¨å…·ä½“é•¿ä»€ä¹ˆæ ·å­å‘¢? å…ˆæ¥çœ‹çœ‹å®ƒé‡Œé¢æœ‰å“ªäº›å…³é”®çš„æˆå‘˜å˜é‡:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Servlet")]),s._v(" instance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ¯«æ— æ‚¬å¿µ, å®ƒæ‹¥æœ‰ä¸€ä¸ª Servlet å®ä¾‹, å¹¶ä¸” Wrapper é€šè¿‡ loadServlet() æ–¹æ³•æ¥å®ä¾‹åŒ– Servlet. ä¸ºäº†æ–¹ä¾¿é˜…è¯», ä¸‹é¢ç®€åŒ–äº†ä»£ç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Servlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadServlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Servlet")]),s._v(" servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. åˆ›å»ºä¸€ä¸ª Servlet å®ä¾‹")]),s._v("\n    servlet "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Servlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" instanceManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servletClass"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. è°ƒç”¨äº† Servlet çš„ init() æ–¹æ³•, è¿™æ˜¯ Servlet è§„èŒƒè¦æ±‚çš„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initServlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("å…¶å® loadServlet() ä¸»è¦åšäº†ä¸¤ä»¶äº‹: åˆ›å»º Servlet çš„å®ä¾‹, å¹¶ä¸”è°ƒç”¨ Servlet çš„ init() æ–¹æ³•, å› ä¸ºè¿™æ˜¯ Servlet è§„èŒƒè¦æ±‚çš„.")]),s._v(" "),t("p",[s._v("é‚£æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯, ä»€ä¹ˆæ—¶å€™ä¼šè°ƒåˆ°è¿™ä¸ª loadServlet() æ–¹æ³•å‘¢? ä¸ºäº†åŠ å¿«ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦, å¾€å¾€ä¼šé‡‡å–"),t("strong",[s._v("èµ„æºå»¶è¿ŸåŠ è½½")]),s._v("çš„ç­–ç•¥, Tomcat ä¹Ÿä¸ä¾‹å¤–, é»˜è®¤æƒ…å†µä¸‹ Tomcat åœ¨å¯åŠ¨æ—¶ä¸ä¼šåŠ è½½ Servlet, é™¤éæŠŠ Servlet çš„ "),t("code",[s._v("loadOnStartup")]),s._v("â€‹ å‚æ•°è®¾ç½®ä¸º "),t("code",[s._v("true")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("è¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯, è™½ç„¶ Tomcat åœ¨å¯åŠ¨æ—¶ä¸ä¼šåˆ›å»º Servlet å®ä¾‹, ä½†æ˜¯"),t("strong",[s._v("ä¼šåˆ›å»º Wrapper å®¹å™¨")]),s._v(", å°±å¥½æ¯”å°½ç®¡æªé‡Œé¢è¿˜æ²¡æœ‰å­å¼¹, å…ˆæŠŠæªé€ å‡ºæ¥. é‚£å­å¼¹ä»€ä¹ˆæ—¶å€™é€ å‘¢? æ˜¯çœŸæ­£éœ€è¦å¼€æªçš„æ—¶å€™, ä¹Ÿå°±æ˜¯è¯´"),t("strong",[s._v("æœ‰è¯·æ±‚æ¥è®¿é—®æŸä¸ª Servlet æ—¶, è¿™ä¸ª Servlet çš„å®ä¾‹æ‰ä¼šè¢«åˆ›å»º")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ Servlet æ˜¯è¢«è°è°ƒç”¨çš„å‘¢? å›å¿†ä¸€ä¸‹å‰é¢æåˆ°è¿‡ Tomcat çš„ "),t("strong",[s._v("Pipeline-Valve æœºåˆ¶")]),s._v(", æ¯ä¸ªå®¹å™¨ç»„ä»¶éƒ½æœ‰è‡ªå·±çš„ Pipeline, æ¯ä¸ª Pipeline ä¸­æœ‰ä¸€ä¸ª Valve é“¾, å¹¶ä¸”æ¯ä¸ªå®¹å™¨ç»„ä»¶æœ‰ä¸€ä¸ª BasicValve(åŸºç¡€é˜€). Wrapper ä½œä¸ºä¸€ä¸ªå®¹å™¨ç»„ä»¶, å®ƒä¹Ÿæœ‰è‡ªå·±çš„ Pipeline å’Œ BasicValve, Wrapper çš„ BasicValve å« "),t("strong",[s._v("StandardWrapperValve")]),s._v(".")]),s._v(" "),t("p",[s._v("å¯ä»¥æƒ³åˆ°, å½“è¯·æ±‚åˆ°æ¥æ—¶, Context å®¹å™¨çš„ BasicValve ä¼šè°ƒç”¨ Wrapper å®¹å™¨ä¸­ Pipeline ä¸­çš„ç¬¬ä¸€ä¸ª Valve, ç„¶åä¼šè°ƒç”¨åˆ° "),t("strong",[s._v("StandardWrapperValve")]),s._v(". å…ˆæ¥çœ‹çœ‹å®ƒçš„ invoke() æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„, åŒæ ·ä¸ºäº†æ–¹ä¾¿é˜…è¯», ä¸‹é¢ä¹Ÿç®€åŒ–äº†ä»£ç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Request")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Response")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. å®ä¾‹åŒ– Servlet")]),s._v("\n    servlet "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" wrapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("allocate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. ç»™å½“å‰è¯·æ±‚åˆ›å»ºä¸€ä¸ª Filter é“¾")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationFilterChain")]),s._v(" filterChain "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationFilterFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createFilterChain")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wrapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. è°ƒç”¨è¿™ä¸ª Filter é“¾, Filter é“¾ä¸­çš„æœ€åä¸€ä¸ª Filter ä¼šè°ƒç”¨ Servlet")]),s._v("\n   filterChain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResponse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("StandardWrapperValve çš„ invoke() æ–¹æ³•æ¯”è¾ƒå¤æ‚, å»æ‰å…¶ä»–å¼‚å¸¸å¤„ç†çš„ä¸€äº›ç»†èŠ‚, æœ¬è´¨ä¸Šå°±æ˜¯ä¸‰æ­¥:")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€æ­¥, åˆ›å»º Servlet å®ä¾‹;")]),s._v(" "),t("li",[s._v("ç¬¬äºŒæ­¥, ç»™å½“å‰è¯·æ±‚åˆ›å»ºä¸€ä¸ª Filter é“¾;")]),s._v(" "),t("li",[s._v("ç¬¬ä¸‰æ­¥, è°ƒç”¨è¿™ä¸ª Filter é“¾.")])]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šé—®, "),t("strong",[s._v("ä¸ºä»€ä¹ˆéœ€è¦ç»™æ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ª Filter é“¾")]),s._v("? è¿™æ˜¯å› ä¸ºæ¯ä¸ªè¯·æ±‚çš„è¯·æ±‚è·¯å¾„éƒ½ä¸ä¸€æ ·, è€Œ Filter éƒ½æœ‰ç›¸åº”çš„è·¯å¾„æ˜ å°„, å› æ­¤ä¸æ˜¯æ‰€æœ‰çš„ Filter éƒ½éœ€è¦æ¥å¤„ç†å½“å‰çš„è¯·æ±‚, éœ€è¦æ ¹æ®è¯·æ±‚çš„è·¯å¾„æ¥é€‰æ‹©ç‰¹å®šçš„ä¸€äº› Filter æ¥å¤„ç†.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒä¸ªé—®é¢˜æ˜¯, ä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ°è°ƒåˆ° Servlet çš„ service() æ–¹æ³•? è¿™æ˜¯å› ä¸º Filter é“¾çš„ doFilter() æ–¹æ³•ä¼šè´Ÿè´£è°ƒç”¨ Servlet, å…·ä½“æ¥è¯´å°±æ˜¯ Filter é“¾ä¸­çš„æœ€åä¸€ä¸ª Filter ä¼šè´Ÿè´£è°ƒç”¨ Servlet.")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥çœ‹ Filter çš„å®ç°åŸç†.")]),s._v(" "),t("h5",{attrs:{id:"filterç®¡ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filterç®¡ç†"}},[s._v("#")]),s._v(" Filterç®¡ç†")]),s._v(" "),t("p",[s._v("ä¸ Servlet ä¸€æ ·, Filter ä¹Ÿå¯ä»¥åœ¨ "),t("code",[s._v("web.xml")]),s._v("â€‹ æ–‡ä»¶é‡Œè¿›è¡Œé…ç½®, ä¸åŒçš„æ˜¯, Filter çš„ä½œç”¨åŸŸæ˜¯"),t("strong",[s._v("æ•´ä¸ª Web åº”ç”¨")]),s._v(", å› æ­¤ "),t("strong",[s._v("Filter çš„å®ä¾‹æ˜¯åœ¨ Context å®¹å™¨ä¸­è¿›è¡Œç®¡ç†")]),s._v("çš„, Context å®¹å™¨ç”¨ Map é›†åˆæ¥ä¿å­˜ Filter.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FilterDef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" filterDefs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("é‚£ä¸Šé¢æåˆ°çš„ Filter é“¾åˆæ˜¯ä»€ä¹ˆå‘¢? "),t("strong",[s._v("Filter é“¾çš„å­˜æ´»æœŸå¾ˆçŸ­, å®ƒæ˜¯è·Ÿæ¯ä¸ªè¯·æ±‚å¯¹åº”çš„. ä¸€ä¸ªæ–°çš„è¯·æ±‚æ¥äº†, å°±åŠ¨æ€åˆ›å»ºä¸€ä¸ª Filter é“¾, è¯·æ±‚å¤„ç†å®Œäº†, Filter é“¾ä¹Ÿå°±è¢«å›æ”¶äº†")]),s._v(". ç†è§£å®ƒçš„åŸç†ä¹Ÿéå¸¸å…³é”®, è¿˜æ˜¯æ¥çœ‹çœ‹æºç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationFilterChain")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FilterChain")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Filter é“¾ä¸­æœ‰ Filter æ•°ç»„, è¿™ä¸ªå¥½ç†è§£")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationFilterConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" filters "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationFilterConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Filter é“¾ä¸­çš„å½“å‰çš„è°ƒç”¨ä½ç½®")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" pos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ€»å…±æœ‰å¤šå°‘äº† Filter")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯ä¸ª Filter é“¾å¯¹åº”ä¸€ä¸ª Servlet, ä¹Ÿå°±æ˜¯å®ƒè¦è°ƒç”¨çš„ Servlet")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Servlet")]),s._v(" servlet "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletRequest")]),s._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletResponse")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("internalDoFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("internalDoFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletRequest")]),s._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletResponse")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯ä¸ª Filter é“¾åœ¨å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Filter æ•°ç»„")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationFilterConfig")]),s._v(" filterConfig "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" filters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Filter")]),s._v(" filter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" filterConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        filter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰€æœ‰ Filter éƒ½è°ƒåˆ°äº†, å°±è°ƒç”¨ Servlet çš„ service() æ–¹æ³•")]),s._v("\n    servlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[s._v("ä» ApplicationFilterChain çš„æºç å¯ä»¥çœ‹åˆ°å‡ ä¸ªå…³é”®ä¿¡æ¯:")]),s._v(" "),t("ol",[t("li",[s._v("Filter é“¾ä¸­é™¤äº†æœ‰ Filter å¯¹è±¡çš„æ•°ç»„, è¿˜æœ‰ä¸€ä¸ªæ•´æ•°å˜é‡ pos, è¿™ä¸ªå˜é‡ç”¨æ¥è®°å½•"),t("strong",[s._v("å½“å‰è¢«è°ƒç”¨çš„ Filter åœ¨æ•°ç»„ä¸­çš„ä½ç½®")]),s._v(".")]),s._v(" "),t("li",[s._v("Filter é“¾ä¸­æœ‰ä¸ª Servlet å®ä¾‹, è¿™ä¸ªå¥½ç†è§£, å› ä¸ºä¸Šé¢æåˆ°äº†, "),t("strong",[s._v("æ¯ä¸ª Filter é“¾æœ€åéƒ½ä¼šè°ƒåˆ°ä¸€ä¸ª Servlet")]),s._v(".")]),s._v(" "),t("li",[s._v("Filter é“¾æœ¬èº«ä¹Ÿå®ç°äº† doFilter() æ–¹æ³•, ç›´æ¥è°ƒç”¨äº†ä¸€ä¸ªå†…éƒ¨æ–¹æ³• internalDoFilter().")]),s._v(" "),t("li",[s._v("internalDoFilter() æ–¹æ³•çš„å®ç°æ¯”è¾ƒæœ‰æ„æ€, å®ƒåšäº†ä¸€ä¸ªåˆ¤æ–­, å¦‚æœå½“å‰ Filter çš„ä½ç½®å°äº Filter æ•°ç»„çš„é•¿åº¦, ä¹Ÿå°±æ˜¯è¯´ Filter è¿˜æ²¡è°ƒå®Œ, å°±ä» Filter æ•°ç»„æ‹¿ä¸‹ä¸€ä¸ª Filter, è°ƒç”¨å®ƒçš„ doFilter() æ–¹æ³•. å¦åˆ™, æ„å‘³ç€æ‰€æœ‰ Filter éƒ½è°ƒåˆ°äº†, å°±è°ƒç”¨ Servlet çš„ service() æ–¹æ³•.")])]),s._v(" "),t("p",[s._v("ä½†é—®é¢˜æ˜¯, æ–¹æ³•ä½“é‡Œæ²¡çœ‹åˆ°å¾ªç¯, è°åœ¨ä¸åœåœ°è°ƒç”¨ Filter é“¾çš„ doFilter() æ–¹æ³•å‘¢? Filter æ˜¯æ€ä¹ˆä¾æ¬¡è°ƒåˆ°çš„å‘¢?")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆæ˜¯ "),t("strong",[s._v("Filter æœ¬èº«çš„ doFilter() æ–¹æ³•ä¼šè°ƒç”¨ Filter é“¾çš„ doFilter() æ–¹æ³•")]),s._v(", è¿˜æ˜¯æ¥çœ‹ä»£ç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletResponse")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FilterChain")]),s._v(" chain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨ Filter çš„æ–¹æ³•")]),s._v("\n      chain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("æ³¨æ„ Filter çš„ doFilter() æ–¹æ³•æœ‰ä¸ªå…³é”®å‚æ•° FilterChain, å°±æ˜¯ Filter é“¾. å¹¶ä¸”æ¯ä¸ª Filter åœ¨å®ç° doFilter() æ—¶, å¿…é¡»è¦è°ƒç”¨ Filter é“¾çš„ doFilter() æ–¹æ³•, è€Œ Filter é“¾ä¸­ä¿å­˜å½“å‰ Filter çš„ä½ç½®, ä¼šè°ƒç”¨ä¸‹ä¸€ä¸ª Filter çš„ doFilter() æ–¹æ³•, è¿™æ ·é“¾å¼è°ƒç”¨å°±å®Œæˆäº†.")]),s._v(" "),t("p",[s._v("Filter é“¾è·Ÿ Tomcat çš„ Pipeline-Valve æœ¬è´¨éƒ½æ˜¯"),t("strong",[s._v("è´£ä»»é“¾æ¨¡å¼")]),s._v(", ä½†æ˜¯åœ¨å…·ä½“å®ç°ä¸Šç¨æœ‰ä¸åŒ, å¯ä»¥ç»†ç»†ä½“ä¼šä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"listenerç®¡ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#listenerç®¡ç†"}},[s._v("#")]),s._v(" Listenerç®¡ç†")]),s._v(" "),t("p",[s._v("æ¥ç€çœ‹ Servlet è§„èŒƒé‡Œ Listener. è·Ÿ Filter ä¸€æ ·, Listener ä¹Ÿæ˜¯ä¸€ç§æ‰©å±•æœºåˆ¶, å¯ä»¥ç›‘å¬å®¹å™¨å†…éƒ¨å‘ç”Ÿçš„"),t("strong",[s._v("äº‹ä»¶")]),s._v(", ä¸»è¦æœ‰ä¸¤ç±»äº‹ä»¶:")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€ç±»æ˜¯"),t("strong",[s._v("ç”Ÿå‘½çŠ¶æ€çš„å˜åŒ–")]),s._v(", æ¯”å¦‚ Context å®¹å™¨å¯åŠ¨å’Œåœæ­¢, Session çš„åˆ›å»ºå’Œé”€æ¯.")]),s._v(" "),t("li",[s._v("ç¬¬äºŒç±»æ˜¯"),t("strong",[s._v("å±æ€§çš„å˜åŒ–")]),s._v(", æ¯”å¦‚ Context å®¹å™¨æŸä¸ªå±æ€§å€¼å˜äº†, Session çš„æŸä¸ªå±æ€§å€¼å˜äº†ä»¥åŠæ–°çš„è¯·æ±‚æ¥äº†ç­‰.")])]),s._v(" "),t("p",[s._v("å¯ä»¥åœ¨ "),t("code",[s._v("web.xml")]),s._v("â€‹ é…ç½®æˆ–è€…é€šè¿‡æ³¨è§£çš„æ–¹å¼æ¥æ·»åŠ ç›‘å¬å™¨, åœ¨ç›‘å¬å™¨é‡Œå®ç°ä¸šåŠ¡é€»è¾‘. å¯¹äº Tomcat æ¥è¯´, å®ƒéœ€è¦è¯»å–é…ç½®æ–‡ä»¶, æ‹¿åˆ°ç›‘å¬å™¨ç±»çš„åå­—, å®ä¾‹åŒ–è¿™äº›ç±», å¹¶ä¸”åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨è¿™äº›ç›‘å¬å™¨çš„æ–¹æ³•.")]),s._v(" "),t("p",[s._v("Tomcat æ˜¯"),t("strong",[s._v("é€šè¿‡ Context å®¹å™¨æ¥ç®¡ç†è¿™äº›ç›‘å¬å™¨")]),s._v("çš„. Context å®¹å™¨å°†ä¸¤ç±»äº‹ä»¶åˆ†å¼€æ¥ç®¡ç†, åˆ†åˆ«ç”¨ä¸åŒçš„é›†åˆæ¥å­˜æ”¾ä¸åŒç±»å‹äº‹ä»¶çš„ç›‘å¬å™¨:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç›‘å¬å±æ€§å€¼å˜åŒ–çš„ç›‘å¬å™¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" applicationEventListenersList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CopyOnWriteArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç›‘å¬ç”Ÿå‘½äº‹ä»¶çš„ç›‘å¬å™¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" applicationLifecycleListenersObjects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("å‰©ä¸‹çš„äº‹æƒ…å°±æ˜¯"),t("strong",[s._v("è§¦å‘ç›‘å¬å™¨")]),s._v("äº†, æ¯”å¦‚åœ¨ Context å®¹å™¨çš„å¯åŠ¨æ–¹æ³•é‡Œ, å°±è§¦å‘äº†æ‰€æœ‰çš„ ServletContextListener:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. æ‹¿åˆ°æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getApplicationLifecycleListeners")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. åˆ¤æ–­ Listener çš„ç±»å‹æ˜¯ä¸æ˜¯ ServletContextListener")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContextListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. è§¦å‘ Listener çš„æ–¹æ³•")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContextListener")]),s._v(" lr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContextListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   lr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("contextInitialized")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯, è¿™é‡Œçš„ ServletContextListener æ¥å£æ˜¯ä¸€ç§ç•™ç»™ç”¨æˆ·çš„æ‰©å±•æœºåˆ¶, ç”¨æˆ·å¯ä»¥å®ç°è¿™ä¸ªæ¥å£æ¥å®šä¹‰è‡ªå·±çš„ç›‘å¬å™¨, ç›‘å¬ Context å®¹å™¨çš„å¯åœäº‹ä»¶. Spring å°±æ˜¯è¿™ä¹ˆåšçš„. ServletContextListener è·Ÿ Tomcat è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ LifecycleListener æ˜¯ä¸åŒçš„. LifecycleListener å®šä¹‰åœ¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ç»„ä»¶ä¸­, ç”±åŸºç±» LifeCycleBase ç»Ÿä¸€ç®¡ç†.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-13"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-13"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v('Servlet è§„èŒƒä¸­æœ€é‡è¦çš„å°±æ˜¯ Servlet, Filter å’Œ Listener "ä¸‰å…„å¼Ÿ". Web å®¹å™¨æœ€é‡è¦çš„èŒèƒ½å°±æ˜¯'),t("strong",[s._v("æŠŠå®ƒä»¬åˆ›å»ºå‡ºæ¥, å¹¶åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•")]),s._v(".")]),s._v(" "),t("p",[s._v('Tomcat é€šè¿‡ Wrapper å®¹å™¨æ¥ç®¡ç† Servlet, Wrapper åŒ…è£…äº† Servlet æœ¬èº«ä»¥åŠç›¸åº”çš„å‚æ•°, è¿™ä½“ç°äº†é¢å‘å¯¹è±¡ä¸­ "å°è£…" çš„è®¾è®¡åŸåˆ™.')]),s._v(" "),t("p",[s._v("Tomcat ä¼šç»™"),t("strong",[s._v("æ¯ä¸ªè¯·æ±‚ç”Ÿæˆä¸€ä¸ª Filter é“¾")]),s._v(", Filter é“¾ä¸­çš„æœ€åä¸€ä¸ª Filter ä¼šè´Ÿè´£è°ƒç”¨ Servlet çš„ service() æ–¹æ³•.")]),s._v(" "),t("p",[s._v("å¯¹äº Listener æ¥è¯´, å¯ä»¥å®šåˆ¶è‡ªå·±çš„ç›‘å¬å™¨æ¥ç›‘å¬ Tomcat å†…éƒ¨å‘ç”Ÿçš„å„ç§äº‹ä»¶: åŒ…æ‹¬ Web åº”ç”¨çº§åˆ«çš„, Session çº§åˆ«çš„å’Œè¯·æ±‚çº§åˆ«çš„. Tomcat ä¸­çš„ Context å®¹å™¨ç»Ÿä¸€ç»´æŠ¤äº†è¿™äº›ç›‘å¬å™¨, å¹¶è´Ÿè´£è§¦å‘.")]),s._v(" "),t("h4",{attrs:{id:"_27-æ–°ç‰¹æ€§-tomcatå¦‚ä½•æ”¯æŒå¼‚æ­¥servlet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_27-æ–°ç‰¹æ€§-tomcatå¦‚ä½•æ”¯æŒå¼‚æ­¥servlet"}},[s._v("#")]),s._v(" 27.æ–°ç‰¹æ€§:Tomcatå¦‚ä½•æ”¯æŒå¼‚æ­¥Servlet?")]),s._v(" "),t("p",[s._v("å½“ä¸€ä¸ªæ–°çš„è¯·æ±‚åˆ°è¾¾æ—¶, Tomcat å’Œ Jetty ä¼šä»çº¿ç¨‹æ± é‡Œæ‹¿å‡ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†è¯·æ±‚, è¿™ä¸ªçº¿ç¨‹ä¼šè°ƒç”¨ä½ çš„ Web åº”ç”¨, Web åº”ç”¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­, "),t("strong",[s._v("Tomcat çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡, ç›´åˆ° Web åº”ç”¨å¤„ç†å®Œæ¯•æ‰èƒ½å†è¾“å‡ºå“åº”, æœ€å Tomcat æ‰å›æ”¶è¿™ä¸ªçº¿ç¨‹")]),s._v(".")]),s._v(" "),t("p",[s._v('æ¥æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜, å‡å¦‚ Web åº”ç”¨éœ€è¦è¾ƒé•¿çš„æ—¶é—´æ¥å¤„ç†è¯·æ±‚(æ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢æˆ–è€…ç­‰å¾…ä¸‹æ¸¸çš„æœåŠ¡è°ƒç”¨è¿”å›), é‚£ä¹ˆ Tomcat çº¿ç¨‹ä¸€ç›´ä¸å›æ”¶, ä¼šå ç”¨ç³»ç»Ÿèµ„æº, åœ¨æç«¯æƒ…å†µä¸‹ä¼šå¯¼è‡´"çº¿ç¨‹é¥¥é¥¿", ä¹Ÿå°±æ˜¯è¯´ Tomcat å’Œ Jetty '),t("strong",[s._v("æ²¡æœ‰æ›´å¤šçš„çº¿ç¨‹æ¥å¤„ç†æ–°çš„è¯·æ±‚")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢? æ–¹æ¡ˆæ˜¯ Servlet 3.0 ä¸­å¼•å…¥çš„"),t("strong",[s._v("å¼‚æ­¥ Servlet")]),s._v(". ä¸»è¦"),t("strong",[s._v("æ˜¯åœ¨ Web åº”ç”¨é‡Œå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥æ‰§è¡Œè¿™äº›æ¯”è¾ƒè€—æ—¶çš„è¯·æ±‚, è€Œ Tomcat çº¿ç¨‹ç«‹å³è¿”å›, ä¸å†ç­‰å¾… Web åº”ç”¨å°†è¯·æ±‚å¤„ç†å®Œ, è¿™æ · Tomcat çº¿ç¨‹å¯ä»¥ç«‹å³è¢«å›æ”¶åˆ°çº¿ç¨‹æ± , ç”¨æ¥å“åº”å…¶ä»–è¯·æ±‚, é™ä½äº†ç³»ç»Ÿçš„èµ„æºæ¶ˆè€—, åŒæ—¶è¿˜èƒ½æé«˜ç³»ç»Ÿçš„ååé‡")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™é‡Œåˆ†æä¸€ä¸‹å¦‚ä½•å¼€å‘ä¸€ä¸ªå¼‚æ­¥ Servlet, ä»¥åŠå¼‚æ­¥ Servlet çš„å·¥ä½œåŸç†, ä¹Ÿå°±æ˜¯ Tomcat æ˜¯å¦‚ä½•æ”¯æŒå¼‚æ­¥ Servlet çš„, è¿›è€Œå½»åº•ç†è§£å®ƒçš„æ¥é¾™å»è„‰.")]),s._v(" "),t("h5",{attrs:{id:"å¼‚æ­¥servletç¤ºä¾‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼‚æ­¥servletç¤ºä¾‹"}},[s._v("#")]),s._v(" å¼‚æ­¥Servletç¤ºä¾‹")]),s._v(" "),t("p",[s._v("å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥äº†è§£ä¸€ä¸‹å¼‚æ­¥ Servlet çš„å®ç°.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@WebServlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("urlPatterns "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/async"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" asyncSupported "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsyncServlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Web åº”ç”¨çº¿ç¨‹æ± , ç”¨æ¥å¤„ç†å¼‚æ­¥ Servlet")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newSingleThreadExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" resp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. è°ƒç”¨ startAsync æˆ–è€…å¼‚æ­¥ä¸Šä¸‹æ–‡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsyncContext")]),s._v(" ctx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("startAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨çº¿ç¨‹æ± æ¥æ‰§è¡Œè€—æ—¶æ“ä½œ")]),s._v("\n        executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n            "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨è¿™é‡Œåšè€—æ—¶çš„æ“ä½œ")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResponse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWriter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Handling Async Servlet"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. å¼‚æ­¥ Servlet å¤„ç†å®Œäº†è°ƒç”¨å¼‚æ­¥ä¸Šä¸‹æ–‡çš„ complete() æ–¹æ³•")]),s._v("\n                ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("complete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä»£ç æœ‰ä¸‰ä¸ªè¦ç‚¹:")]),s._v(" "),t("ol",[t("li",[s._v("é€šè¿‡æ³¨è§£çš„æ–¹å¼æ¥æ³¨å†Œ Servlet, é™¤äº† @WebServlet æ³¨è§£, è¿˜éœ€è¦åŠ ä¸Š asyncSupported=true çš„å±æ€§, è¡¨æ˜"),t("strong",[s._v("å½“å‰çš„ Servlet æ˜¯ä¸€ä¸ªå¼‚æ­¥ Servlet")]),s._v(".")]),s._v(" "),t("li",[s._v("Web åº”ç”¨ç¨‹åºéœ€è¦"),t("strong",[s._v("è°ƒç”¨ Request å¯¹è±¡çš„ startAsync() æ–¹æ³•æ¥æ‹¿åˆ°ä¸€ä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ AsyncContext. è¿™ä¸ªä¸Šä¸‹æ–‡ä¿å­˜äº†è¯·æ±‚å’Œå“åº”å¯¹è±¡")]),s._v(".")]),s._v(" "),t("li",[s._v("Web åº”ç”¨éœ€è¦"),t("strong",[s._v("å¼€å¯ä¸€ä¸ªæ–°çº¿ç¨‹æ¥å¤„ç†è€—æ—¶çš„æ“ä½œ, å¤„ç†å®Œæˆåéœ€è¦è°ƒç”¨ AsyncContext çš„ complete() æ–¹æ³•. ç›®çš„æ˜¯å‘Šè¯‰ Tomcat, è¯·æ±‚å·²ç»å¤„ç†å®Œæˆ")]),s._v(".")])]),s._v(" "),t("p",[s._v("è¿™é‡Œæ³¨æ„, è™½ç„¶å¼‚æ­¥ Servlet å…è®¸ç”¨æ›´é•¿çš„æ—¶é—´æ¥å¤„ç†è¯·æ±‚, ä½†æ˜¯ä¹Ÿæœ‰è¶…æ—¶é™åˆ¶çš„, é»˜è®¤æ˜¯ 30 ç§’, å¦‚æœ 30 ç§’å†…è¯·æ±‚è¿˜æ²¡å¤„ç†å®Œ, Tomcat ä¼šè§¦å‘è¶…æ—¶æœºåˆ¶, å‘æµè§ˆå™¨è¿”å›è¶…æ—¶é”™è¯¯, å¦‚æœè¿™ä¸ªæ—¶å€™ Web åº”ç”¨å†è°ƒç”¨ "),t("code",[s._v("ctx.complete()")]),s._v("â€‹ æ–¹æ³•, ä¼šå¾—åˆ°ä¸€ä¸ª IllegalStateException å¼‚å¸¸.")]),s._v(" "),t("h5",{attrs:{id:"å¼‚æ­¥servletåŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼‚æ­¥servletåŸç†"}},[s._v("#")]),s._v(" å¼‚æ­¥ServletåŸç†")]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥å¯¹ Servlet çš„å¼‚æ­¥å®ç°æœ‰äº†åŸºæœ¬çš„ç†è§£. è¦ç†è§£ Tomcat åœ¨è¿™ä¸ªè¿‡ç¨‹éƒ½åšäº†ä»€ä¹ˆäº‹æƒ…, å…³é”®å°±æ˜¯è¦å¼„æ¸…æ¥š "),t("code",[s._v("req.startAsync()")]),s._v("â€‹ æ–¹æ³•å’Œ "),t("code",[s._v("ctx.complete()")]),s._v("â€‹ æ–¹æ³•éƒ½åšäº†ä»€ä¹ˆ.")]),s._v(" "),t("h6",{attrs:{id:"_1-startasync-æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-startasync-æ–¹æ³•"}},[s._v("#")]),s._v(" 1.startAsync()æ–¹æ³•")]),s._v(" "),t("p",[s._v("startAsync() æ–¹æ³•å…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ AsyncContext å¯¹è±¡, "),t("strong",[s._v("AsyncContext å¯¹è±¡çš„ä½œç”¨æ˜¯ä¿å­˜è¯·æ±‚çš„ä¸­é—´ä¿¡æ¯, æ¯”å¦‚ Request å’Œ Response å¯¹è±¡ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯")]),s._v(". ä½ æ¥æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ä¿å­˜è¿™äº›ä¿¡æ¯å‘¢?")]),s._v(" "),t("p",[s._v("è¿™æ˜¯å› ä¸º Tomcat çš„å·¥ä½œçº¿ç¨‹åœ¨ "),t("code",[s._v("Request.startAsync()")]),s._v("â€‹ è°ƒç”¨ä¹‹å, å°±ç›´æ¥ç»“æŸå›åˆ°çº¿ç¨‹æ± ä¸­äº†, çº¿ç¨‹æœ¬èº«ä¸ä¼šä¿å­˜ä»»ä½•ä¿¡æ¯. ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡ç«¯, æ‰§è¡Œåˆ°ä¸€åŠ, ä½ çš„ Web åº”ç”¨æ­£åœ¨å¤„ç†, è¿™ä¸ªæ—¶å€™ Tomcat çš„å·¥ä½œçº¿ç¨‹æ²¡äº†, è¿™å°±"),t("strong",[s._v("éœ€è¦æœ‰ä¸ªç¼“å­˜èƒ½å¤Ÿä¿å­˜åŸå§‹çš„ Request å’Œ Response å¯¹è±¡, è€Œè¿™ä¸ªç¼“å­˜å°±æ˜¯ AsyncContext")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("æœ‰äº† AsyncContext, Web åº”ç”¨é€šè¿‡å®ƒæ‹¿åˆ° request å’Œ response å¯¹è±¡, æ‹¿åˆ° Request å¯¹è±¡åå°±å¯ä»¥è¯»å–è¯·æ±‚ä¿¡æ¯, è¯·æ±‚å¤„ç†å®Œäº†è¿˜éœ€è¦é€šè¿‡ Response å¯¹è±¡å°† HTTP å“åº”å‘é€ç»™æµè§ˆå™¨.")])]),s._v(" "),t("p",[s._v("é™¤äº†åˆ›å»º AsyncContext å¯¹è±¡, startAsync() è¿˜éœ€è¦å®Œæˆä¸€ä¸ªå…³é”®ä»»åŠ¡, é‚£å°±æ˜¯å‘Šè¯‰ Tomcat å½“å‰çš„ Servlet å¤„ç†æ–¹æ³•è¿”å›æ—¶, ä¸è¦æŠŠå“åº”å‘åˆ°æµè§ˆå™¨, å› ä¸ºè¿™ä¸ªæ—¶å€™, å“åº”è¿˜æ²¡ç”Ÿæˆå‘¢; å¹¶ä¸”ä¸èƒ½æŠŠ Request å¯¹è±¡å’Œ Response å¯¹è±¡é”€æ¯, å› ä¸ºåé¢ Web åº”ç”¨è¿˜è¦ç”¨å‘¢.")]),s._v(" "),t("p",[s._v("åœ¨ Tomcat ä¸­, è´Ÿè´£ flush å“åº”æ•°æ®çš„æ˜¯ CoyoteAdaptor, å®ƒè¿˜ä¼šé”€æ¯ Request å¯¹è±¡å’Œ Response å¯¹è±¡, å› æ­¤éœ€è¦é€šè¿‡æŸç§æœºåˆ¶é€šçŸ¥ CoyoteAdaptor, å…·ä½“æ¥è¯´æ˜¯é€šè¿‡ä¸‹é¢è¿™è¡Œä»£ç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCoyoteRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActionCode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ASYNC_START")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ª Callback, åœ¨è¿™ä¸ª action() æ–¹æ³•é‡Œè®¾ç½®äº† Request å¯¹è±¡çš„çŠ¶æ€, è®¾ç½®å®ƒä¸ºä¸€ä¸ªå¼‚æ­¥ Servlet è¯·æ±‚.")]),s._v(" "),t("p",[s._v("è¿æ¥å™¨æ˜¯è°ƒç”¨ CoyoteAdapter çš„ service() æ–¹æ³•æ¥å¤„ç†è¯·æ±‚çš„, è€Œ CoyoteAdapter ä¼šè°ƒç”¨å®¹å™¨çš„ service() æ–¹æ³•, å½“å®¹å™¨çš„ service() æ–¹æ³•è¿”å›æ—¶, "),t("strong",[s._v("CoyoteAdapter åˆ¤æ–­å½“å‰çš„è¯·æ±‚æ˜¯ä¸æ˜¯å¼‚æ­¥ Servlet è¯·æ±‚, å¦‚æœæ˜¯, å°±ä¸ä¼šé”€æ¯ Request å’Œ Response å¯¹è±¡, ä¹Ÿä¸ä¼šæŠŠå“åº”ä¿¡æ¯å‘åˆ°æµè§ˆå™¨")]),s._v(". å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç ç†è§£ä¸€ä¸‹, è¿™æ˜¯ CoyoteAdapter çš„ service() æ–¹æ³•, ä¸‹é¢å¯¹å®ƒè¿›è¡Œäº†ç®€åŒ–:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("coyote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Request")]),s._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("coyote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Response")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨å®¹å™¨çš„ service æ–¹æ³•å¤„ç†è¯·æ±‚")]),s._v("\n    connector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPipeline")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getFirst")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ˜¯å¼‚æ­¥ Servlet è¯·æ±‚, ä»…ä»…è®¾ç½®ä¸€ä¸ªæ ‡å¿—, ")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦åˆ™è¯´æ˜æ˜¯åŒæ­¥ Servlet è¯·æ±‚, å°±å°†å“åº”æ•°æ®åˆ·åˆ°æµè§ˆå™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isAsync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        async "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("finishRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("finishResponse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœä¸æ˜¯å¼‚æ­¥ Servlet è¯·æ±‚, å°±é”€æ¯ Request å¯¹è±¡å’Œ Response å¯¹è±¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("async"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("recycle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("recycle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("æ¥ä¸‹æ¥, å½“ CoyoteAdaptor çš„ service() æ–¹æ³•è¿”å›åˆ° ProtocolHandler ç»„ä»¶æ—¶, ProtocolHandler åˆ¤æ–­è¿”å›å€¼, å¦‚æœå½“å‰è¯·æ±‚æ˜¯ä¸€ä¸ªå¼‚æ­¥ Servlet è¯·æ±‚, "),t("strong",[s._v("å®ƒä¼šæŠŠå½“å‰ Socket çš„åè®®å¤„ç†è€… Processor ç¼“å­˜èµ·æ¥, å°† SocketWrapper å¯¹è±¡å’Œç›¸åº”çš„ Processor å­˜åˆ°ä¸€ä¸ª Map æ•°æ®ç»“æ„é‡Œ")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("S")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Processor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" connections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("**ä¹‹æ‰€ä»¥è¦ç¼“å­˜æ˜¯å› ä¸ºè¿™ä¸ªè¯·æ±‚æ¥ä¸‹æ¥è¿˜è¦æ¥ç€å¤„ç†, è¿˜æ˜¯ç”±åŸæ¥çš„ Processor æ¥å¤„ç†, é€šè¿‡ SocketWrapper å°±èƒ½ä» Map é‡Œæ‰¾åˆ°ç›¸åº”çš„ Processor. **")]),s._v(" "),t("h6",{attrs:{id:"_2-complete-æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-complete-æ–¹æ³•"}},[s._v("#")]),s._v(" 2.complete()æ–¹æ³•")]),s._v(" "),t("p",[s._v("æ¥ç€å†æ¥çœ‹å…³é”®çš„ "),t("code",[s._v("ctx.complete()")]),s._v("â€‹ æ–¹æ³•, å½“"),t("strong",[s._v("è¯·æ±‚å¤„ç†å®Œæˆæ—¶, Web åº”ç”¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•")]),s._v(". é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åšäº†äº›ä»€ä¹ˆäº‹æƒ…å‘¢? "),t("strong",[s._v("æœ€é‡è¦çš„å°±æ˜¯æŠŠå“åº”æ•°æ®å‘é€åˆ°æµè§ˆå™¨")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä»¶äº‹æƒ…ä¸èƒ½ç”± Web åº”ç”¨çº¿ç¨‹æ¥åš, ä¹Ÿå°±æ˜¯è¯´ "),t("code",[s._v("ctx.complete()")]),s._v("â€‹ æ–¹æ³•ä¸èƒ½ç›´æ¥æŠŠå“åº”æ•°æ®å‘é€åˆ°æµè§ˆå™¨, å› ä¸ºè¿™ä»¶äº‹æƒ…åº”è¯¥ç”± Tomcat çº¿ç¨‹æ¥åš, ä½†å…·ä½“æ€ä¹ˆåšå‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("ç”±äºè¿æ¥å™¨ä¸­çš„ Endpoint ç»„ä»¶æ£€æµ‹åˆ°æœ‰è¯·æ±‚æ•°æ®è¾¾åˆ°æ—¶, ä¼šåˆ›å»ºä¸€ä¸ª SocketProcessor å¯¹è±¡äº¤ç»™çº¿ç¨‹æ± å»å¤„ç†, å› æ­¤ Endpoint çš„é€šä¿¡å¤„ç†å’Œå…·ä½“è¯·æ±‚å¤„ç†åœ¨ä¸¤ä¸ªçº¿ç¨‹é‡Œè¿è¡Œ.")])]),s._v(" "),t("p",[s._v("åœ¨å¼‚æ­¥ Servlet çš„åœºæ™¯é‡Œ, Web åº”ç”¨é€šè¿‡è°ƒç”¨ "),t("code",[s._v("ctx.complete()")]),s._v("â€‹ æ–¹æ³•æ—¶, ä¹Ÿå¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ SocketProcessor ä»»åŠ¡ç±», äº¤ç»™çº¿ç¨‹æ± å¤„ç†. å¯¹äºå¼‚æ­¥ Servlet è¯·æ±‚æ¥è¯´, ç›¸åº”çš„ Socket å’Œåè®®å¤„ç†ç»„ä»¶ Processor éƒ½è¢«"),t("strong",[s._v("ç¼“å­˜")]),s._v("èµ·æ¥äº†, å¹¶ä¸”è¿™äº›å¯¹è±¡éƒ½å¯ä»¥é€šè¿‡ Request å¯¹è±¡æ‹¿åˆ°.")]),s._v(" "),t("p",[s._v("â€‹"),t("code",[s._v("ctx.complete()")]),s._v("â€‹ å®ç°å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("complete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ£€æŸ¥çŠ¶æ€åˆæ³•æ€§, æˆ‘ä»¬å…ˆå¿½ç•¥è¿™å¥")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨ Request å¯¹è±¡çš„ action æ–¹æ³•, å…¶å®å°±æ˜¯é€šçŸ¥è¿æ¥å™¨, è¿™ä¸ªå¼‚æ­¥è¯·æ±‚å¤„ç†å®Œäº†")]),s._v("\n    request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCoyoteRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ActionCode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ASYNC_COMPLETE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ° complete() æ–¹æ³•è°ƒç”¨äº† Request å¯¹è±¡çš„ action() æ–¹æ³•. è€Œåœ¨ action() æ–¹æ³•é‡Œ, åˆ™æ˜¯è°ƒç”¨äº† Processor çš„ processSocketEvent() æ–¹æ³•, å¹¶ä¸”ä¼ å…¥äº†æ“ä½œç  OPEN_READ.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ASYNC_COMPLETE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("clearDispatches")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("asyncStateMachine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("asyncComplete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processSocketEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OPEN_READ")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("æ¥ç€çœ‹ processSocketEvent() æ–¹æ³•, å®ƒè°ƒç”¨ SocketWrapper çš„ processSocket() æ–¹æ³•:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processSocketEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketEvent")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" dispatch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketWrapperBase")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" socketWrapper "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSocketWrapper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socketWrapper "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        socketWrapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processSocket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dispatch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("è€Œ SocketWrapper çš„ processSocket() æ–¹æ³•ä¼šåˆ›å»º SocketProcessor ä»»åŠ¡ç±», å¹¶é€šè¿‡ Tomcat çº¿ç¨‹æ± æ¥å¤„ç†:")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processSocket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketWrapperBase")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("S")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" socketWrapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketEvent")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" dispatch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socketWrapper "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SocketProcessorBase")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("S")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" sc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" processorCache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          sc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createSocketProcessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socketWrapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socketWrapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çº¿ç¨‹æ± è¿è¡Œ")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executor")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dispatch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("è¯·æ³¨æ„ createSocketProcessor() æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ SocketEvent, è¿™é‡Œä¼ å…¥çš„æ˜¯ OPEN_READ. é€šè¿‡è¿™ä¸ªå‚æ•°å°±èƒ½æ§åˆ¶ SocketProcessor çš„è¡Œä¸º, å› ä¸ºä¸éœ€è¦å†æŠŠè¯·æ±‚å‘é€åˆ°å®¹å™¨è¿›è¡Œå¤„ç†, åªéœ€è¦å‘æµè§ˆå™¨ç«¯å‘é€æ•°æ®, å¹¶ä¸”é‡æ–°åœ¨è¿™ä¸ª Socket ä¸Šç›‘å¬æ–°çš„è¯·æ±‚å°±è¡Œäº†.")]),s._v(" "),t("p",[s._v("æœ€åé€šè¿‡ä¸€å¼ å›¾ç†è§£ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405161923-311rtzq.png",alt:"image"}})]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-14"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-14"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("éé˜»å¡ I/O æ¨¡å‹å¯ä»¥åˆ©ç”¨å¾ˆå°‘çš„çº¿ç¨‹å¤„ç†å¤§é‡çš„è¿æ¥, æé«˜äº†å¹¶å‘åº¦, æœ¬è´¨å°±æ˜¯é€šè¿‡ä¸€ä¸ª Selector çº¿ç¨‹æŸ¥è¯¢å¤šä¸ª Socket çš„ I/O äº‹ä»¶, å‡å°‘äº†çº¿ç¨‹çš„é˜»å¡ç­‰å¾….")]),s._v(" "),t("p",[s._v("**åŒæ ·, å¼‚æ­¥ Servlet æœºåˆ¶ä¹Ÿæ˜¯å‡å°‘äº†çº¿ç¨‹çš„é˜»å¡ç­‰å¾…, å°† Tomcat çº¿ç¨‹å’Œä¸šåŠ¡çº¿ç¨‹åˆ†å¼€, Tomca çº¿ç¨‹ä¸å†ç­‰å¾…ä¸šåŠ¡ä»£ç çš„æ‰§è¡Œ. **")]),s._v(" "),t("p",[s._v("é‚£ä»€ä¹ˆæ ·çš„åœºæ™¯é€‚åˆå¼‚æ­¥ Servlet å‘¢? é€‚åˆçš„åœºæ™¯æœ‰å¾ˆå¤š, æœ€ä¸»è¦çš„è¿˜æ˜¯æ ¹æ®å®é™…æƒ…å†µ, å¦‚æœæ‹¿ä¸å‡†æ˜¯å¦é€‚åˆå¼‚æ­¥ Servlet, å°±çœ‹ä¸€æ¡: "),t("strong",[s._v("å¦‚æœä½ å‘ç° Tomcat çš„çº¿ç¨‹ä¸å¤Ÿäº†, å¤§é‡çº¿ç¨‹é˜»å¡åœ¨ç­‰å¾… Web åº”ç”¨çš„å¤„ç†ä¸Š, è€Œ Web åº”ç”¨åˆæ²¡æœ‰ä¼˜åŒ–çš„ç©ºé—´äº†, ç¡®å®éœ€è¦é•¿æ—¶é—´å¤„ç†, è¿™ä¸ªæ—¶å€™ä½ ä¸å¦¨å°è¯•ä¸€ä¸‹å¼‚æ­¥ Servlet.")])]),s._v(" "),t("h4",{attrs:{id:"_28-æ–°ç‰¹æ€§-tomcatå’Œjettyå¦‚ä½•å¤„ç†spring-bootåº”ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_28-æ–°ç‰¹æ€§-tomcatå’Œjettyå¦‚ä½•å¤„ç†spring-bootåº”ç”¨"}},[s._v("#")]),s._v(" 28.æ–°ç‰¹æ€§:Tomcatå’ŒJettyå¦‚ä½•å¤„ç†Spring Bootåº”ç”¨?")]),s._v(" "),t("p",[s._v("ä¸ºäº†æ–¹ä¾¿å¼€å‘å’Œéƒ¨ç½², Spring Boot åœ¨"),t("strong",[s._v("å†…éƒ¨å¯åŠ¨äº†ä¸€ä¸ªåµŒå…¥å¼çš„ Web å®¹å™¨")]),s._v(". ç”±äº Tomcat å’Œ Jetty æ˜¯ç»„ä»¶åŒ–çš„è®¾è®¡, è¦å¯åŠ¨ Tomcat æˆ–è€… Jetty å…¶å®å°±æ˜¯å¯åŠ¨è¿™äº›ç»„ä»¶. åœ¨ Tomcat ç‹¬ç«‹éƒ¨ç½²çš„æ¨¡å¼ä¸‹, å¯ä»¥é€šè¿‡ startup è„šæœ¬æ¥å¯åŠ¨ Tomcat, Tomcat ä¸­çš„ Bootstrap å’Œ Catalina ä¼šè´Ÿè´£åˆå§‹åŒ–ç±»åŠ è½½å™¨, å¹¶è§£æ "),t("code",[s._v("server.xml")]),s._v("â€‹ å’Œå¯åŠ¨è¿™äº›ç»„ä»¶.")]),s._v(" "),t("p",[s._v("åœ¨"),t("strong",[s._v("å†…åµŒå¼")]),s._v("çš„æ¨¡å¼ä¸‹, Bootstrap å’Œ Catalina çš„å·¥ä½œå°±ç”± Spring Boot æ¥åšäº†, "),t("strong",[s._v("Spring Boot è°ƒç”¨äº† Tomcat å’Œ Jetty çš„ API æ¥å¯åŠ¨è¿™äº›ç»„ä»¶")]),s._v(". é‚£ Spring Boot å…·ä½“æ˜¯æ€ä¹ˆåšçš„å‘¢? å¦‚ä½•å‘ SpringBoot ä¸­çš„ Tomcat æ³¨å†Œ Servlet æˆ–è€… Filter å‘¢? åˆå¦‚ä½•å®šåˆ¶å†…åµŒå¼çš„ Tomcat?")]),s._v(" "),t("h5",{attrs:{id:"spring-bootä¸­webå®¹å™¨ç›¸å…³çš„æ¥å£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spring-bootä¸­webå®¹å™¨ç›¸å…³çš„æ¥å£"}},[s._v("#")]),s._v(" Spring Bootä¸­Webå®¹å™¨ç›¸å…³çš„æ¥å£")]),s._v(" "),t("p",[s._v("æ—¢ç„¶è¦æ”¯æŒå¤šç§ Web å®¹å™¨, Spring Boot å¯¹"),t("strong",[s._v("å†…åµŒå¼ Web å®¹å™¨")]),s._v("è¿›è¡Œäº†æŠ½è±¡, å®šä¹‰äº† **WebServer ** æ¥å£:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("å„ç§ Web å®¹å™¨æ¯”å¦‚ Tomcat å’Œ Jetty éœ€è¦å»å®ç°è¿™ä¸ªæ¥å£.")]),s._v(" "),t("p",[s._v("Spring Boot è¿˜å®šä¹‰äº†ä¸€ä¸ªå·¥å‚ **ServletWebServerFactory ** æ¥åˆ›å»º Web å®¹å™¨, è¿”å›çš„å¯¹è±¡å°±æ˜¯ä¸Šé¢æåˆ°çš„ "),t("strong",[s._v("WebServer")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletWebServerFactory")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWebServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContextInitializer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" initializers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ° getWebServer() æœ‰ä¸ªå‚æ•°, ç±»å‹æ˜¯ "),t("strong",[s._v("ServletContextInitializer")]),s._v(". å®ƒè¡¨ç¤º ServletContext çš„åˆå§‹åŒ–å™¨, ç”¨äº ServletContext ä¸­çš„ä¸€äº›é…ç½®:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContextInitializer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onStartup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContext")]),s._v(" servletContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™é‡Œæ³¨æ„, ä¸Šé¢æåˆ°çš„ getWebServer() æ–¹æ³•ä¼šè°ƒç”¨ ServletContextInitializer çš„ onStartup() æ–¹æ³•, ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ æƒ³åœ¨ Servlet å®¹å™¨å¯åŠ¨æ—¶åšä¸€äº›äº‹æƒ…, æ¯”å¦‚æ³¨å†Œè‡ªå·±çš„ Servlet, å¯ä»¥å®ç°ä¸€ä¸ª ServletContextInitializer, åœ¨ Web å®¹å™¨å¯åŠ¨æ—¶, Spring Boot ä¼šæŠŠæ‰€æœ‰å®ç°äº† "),t("strong",[s._v("ServletContextInitializer")]),s._v(" æ¥å£çš„ç±»æ”¶é›†èµ·æ¥, ç»Ÿä¸€è°ƒå®ƒä»¬çš„ onStartup() æ–¹æ³•.")]),s._v(" "),t("p",[s._v("ä¸ºäº†æ”¯æŒå¯¹å†…åµŒå¼ Web å®¹å™¨çš„å®šåˆ¶åŒ–, Spring Boot è¿˜å®šä¹‰äº† **WebServerFactoryCustomizerBeanPostProcessor ** æ¥å£, å®ƒæ˜¯ä¸€ä¸ª "),t("strong",[s._v("BeanPostProcessor")]),s._v(", å®ƒåœ¨ postProcessBeforeInitialization è¿‡ç¨‹ä¸­å»å¯»æ‰¾ Spring å®¹å™¨ä¸­ "),t("strong",[s._v("WebServerFactoryCustomizer")]),s._v(" ç±»å‹çš„ Bean, å¹¶ä¾æ¬¡è°ƒç”¨ WebServerFactoryCustomizer æ¥å£çš„ customize() æ–¹æ³•åšä¸€äº›å®šåˆ¶åŒ–.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerFactoryCustomizer")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("customize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h5",{attrs:{id:"å†…åµŒå¼webå®¹å™¨çš„åˆ›å»ºå’Œå¯åŠ¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…åµŒå¼webå®¹å™¨çš„åˆ›å»ºå’Œå¯åŠ¨"}},[s._v("#")]),s._v(" å†…åµŒå¼Webå®¹å™¨çš„åˆ›å»ºå’Œå¯åŠ¨")]),s._v(" "),t("p",[t("strong",[s._v("é“ºå«äº†è¿™äº›æ¥å£, å†æ¥çœ‹çœ‹ Spring Boot æ˜¯å¦‚ä½•å®ä¾‹åŒ–å’Œå¯åŠ¨ä¸€ä¸ª Web å®¹å™¨çš„")]),s._v(". ç”±äº Spring çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª ApplicationContext, å®ƒçš„æŠ½è±¡å®ç°ç±» "),t("strong",[s._v("AbstractApplicationContext")]),s._v(" å®ç°äº†è‘—åçš„ "),t("strong",[s._v("refresh() ** æ–¹æ³•, å®ƒç”¨æ¥æ–°å»ºæˆ–è€…åˆ·æ–°ä¸€ä¸ª ApplicationContext, åœ¨ refresh() æ–¹æ³•ä¸­ä¼šè°ƒç”¨ "),t("strong",[s._v("onRefresh() æ–¹æ³•")]),s._v(", AbstractApplicationContext çš„å­ç±»å¯ä»¥")]),s._v("é‡å†™è¿™ä¸ªæ–¹æ³• onRefresh() æ–¹æ³•, æ¥å®ç°ç‰¹å®š Context çš„åˆ·æ–°é€»è¾‘**, å› æ­¤ "),t("mark",[t("strong",[s._v("ServletWebServerApplicationContext å°±æ˜¯é€šè¿‡é‡å†™ onRefresh() æ–¹æ³•æ¥åˆ›å»ºå†…åµŒå¼çš„ Web å®¹å™¨")])]),s._v(", å…·ä½“åˆ›å»ºè¿‡ç¨‹æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onRefresh")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onRefresh")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡å†™ onRefresh æ–¹æ³•, è°ƒç”¨ createWebServer åˆ›å»ºå’Œå¯åŠ¨ Tomcat")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createWebServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// createWebServer çš„å…·ä½“å®ç°")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createWebServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œ WebServer æ˜¯ Spring Boot æŠ½è±¡å‡ºæ¥çš„æ¥å£, å…·ä½“å®ç°ç±»å°±æ˜¯ä¸åŒçš„ Web å®¹å™¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServer")]),s._v(" webServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("webServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContext")]),s._v(" servletContext "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServletContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœ Web å®¹å™¨è¿˜æ²¡åˆ›å»º")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("webServer "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" servletContext "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mark"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€šè¿‡ Web å®¹å™¨å·¥å‚æ¥åˆ›å»º")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletWebServerFactory")]),s._v(" factory "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWebServerFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// æ³¨æ„ä¼ å…¥äº†ä¸€ä¸ª "SelfInitializer"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("webServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWebServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContextInitializer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSelfInitializer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servletContext "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSelfInitializer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onStartup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servletContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),s._v(" var4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initPropertySources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[s._v("å†æ¥çœ‹çœ‹ getWebSever() å…·ä½“åšäº†ä»€ä¹ˆ, ä»¥ Tomcat ä¸ºä¾‹, ä¸»è¦è°ƒç”¨ Tomcat çš„ API å»åˆ›å»ºå„ç§ç»„ä»¶:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWebServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContextInitializer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" initializers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. å®ä¾‹åŒ–ä¸€ä¸ª Tomcat, å¯ä»¥ç†è§£ä¸º Server ç»„ä»¶. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Tomcat")]),s._v(" tomcat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Tomcat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),s._v(" baseDir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baseDirectory "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baseDirectory "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createTempDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tomcat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBaseDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("baseDir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAbsolutePath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. åˆå§‹åŒ–å„ç§ç»„ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connector")]),s._v(" connector "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("protocol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tomcat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addConnector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("customizeConnector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tomcat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConnector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tomcat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAutoDeploy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configureEngine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tomcat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getEngine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// 4. åˆ›å»ºå®šåˆ¶ç‰ˆçš„ "Context" ç»„ä»¶. ')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("prepareContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tomcat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" initializers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTomcatWebServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tomcat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("ä½ å¯èƒ½å¥½å¥‡ prepareContext() æ–¹æ³•æ˜¯åšä»€ä¹ˆçš„å‘¢? è¿™é‡Œçš„ Context æ˜¯æŒ‡ "),t("strong",[s._v("Tomcat ä¸­çš„ Context ç»„ä»¶")]),s._v(", ä¸ºäº†æ–¹ä¾¿æ§åˆ¶ Context ç»„ä»¶çš„è¡Œä¸º, Spring Boot å®šä¹‰äº†è‡ªå·±çš„ "),t("strong",[s._v("TomcatEmbeddedContext")]),s._v(", å®ƒæ‰©å±•äº† Tomcat çš„ StandardContext:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TomcatEmbeddedContext")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StandardContext")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"æ³¨å†Œservletçš„ä¸‰ç§æ–¹å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ³¨å†Œservletçš„ä¸‰ç§æ–¹å¼"}},[s._v("#")]),s._v(" æ³¨å†ŒServletçš„ä¸‰ç§æ–¹å¼")]),s._v(" "),t("h6",{attrs:{id:"_1-servletæ³¨è§£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-servletæ³¨è§£"}},[s._v("#")]),s._v(" 1.Servletæ³¨è§£")]),s._v(" "),t("p",[s._v("åœ¨ Spring Boot å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š @ServletComponentScan æ³¨è§£å, "),t("strong",[s._v("ä½¿ç”¨ @WebServlet, @WebFilter, @WebListener æ ‡è®°çš„ Servlet, Filter, Listener å°±å¯ä»¥è‡ªåŠ¨æ³¨å†Œåˆ° Servlet å®¹å™¨ä¸­")]),s._v(", æ— éœ€å…¶ä»–ä»£ç , é€šè¿‡ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¥ç†è§£ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootApplication")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ServletComponentScan")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" xxxApplication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@WebServlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloServlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServlet")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("åœ¨ Web åº”ç”¨çš„å…¥å£ç±»ä¸ŠåŠ ä¸Š @ServletComponentScan,  å¹¶ä¸”åœ¨ Servlet ç±»ä¸ŠåŠ ä¸Š @WebServlet, è¿™æ · SpringBoot ä¼šè´Ÿè´£"),t("strong",[s._v("å°† Servlet æ³¨å†Œåˆ°å†…åµŒçš„ Tomcat ä¸­")]),s._v(".")]),s._v(" "),t("h6",{attrs:{id:"_2-servletregistrationbean"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-servletregistrationbean"}},[s._v("#")]),s._v(" 2.ServletRegistrationBean")]),s._v(" "),t("p",[s._v("åŒæ—¶ Spring Boot ä¹Ÿæä¾›äº† "),t("strong",[s._v("ServletRegistrationBean, FilterRegistrationBean å’Œ ServletListenerRegistrationBean è¿™ä¸‰ä¸ªç±»åˆ†åˆ«ç”¨æ¥æ³¨å†Œ Servlet, Filter, Listener")]),s._v(". å‡å¦‚è¦æ³¨å†Œä¸€ä¸ª Servlet, å¯ä»¥è¿™æ ·åš:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletRegistrationBean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("servletRegistrationBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletRegistrationBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloServlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("è¿™æ®µä»£ç å®ç°çš„æ–¹æ³•è¿”å›ä¸€ä¸ª ServletRegistrationBean, å¹¶å°†å®ƒå½“ä½œ Bean æ³¨å†Œåˆ° Spring ä¸­, å› æ­¤éœ€è¦æŠŠè¿™æ®µä»£ç æ”¾åˆ° Spring Boot è‡ªåŠ¨æ‰«æçš„ç›®å½•ä¸­, æˆ–è€…æ”¾åˆ° @Configuration æ ‡è¯†çš„ç±»ä¸­.")]),s._v(" "),t("h6",{attrs:{id:"_3-åŠ¨æ€æ³¨å†Œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-åŠ¨æ€æ³¨å†Œ"}},[s._v("#")]),s._v(" 3.åŠ¨æ€æ³¨å†Œ")]),s._v(" "),t("p",[s._v("è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»å»å®ç°å‰é¢æåˆ°çš„ "),t("strong",[s._v("ServletContextInitializer")]),s._v(" æ¥å£, å¹¶æŠŠå®ƒæ³¨å†Œä¸ºä¸€ä¸ª Bean, Spring Boot ä¼šè´Ÿè´£è°ƒç”¨è¿™ä¸ªæ¥å£çš„ onStartup() æ–¹æ³•.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyServletRegister")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContextInitializer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onStartup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContext")]),s._v(" servletContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Servlet 3.0 è§„èŒƒæ–°çš„ API")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletRegistration")]),s._v(" myServlet "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" servletContext\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addServlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HelloServlet"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloServlet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        myServlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n        myServlet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setInitParameter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello Servlet"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("è¿™é‡Œæ³¨æ„ä¸¤ç‚¹:")]),s._v(" "),t("ul",[t("li",[s._v("ServletRegistrationBean å…¶å®ä¹Ÿæ˜¯é€šè¿‡ ServletContextInitializer æ¥å®ç°çš„, å®ƒå®ç°äº† ServletContextInitializer æ¥å£.")]),s._v(" "),t("li",[s._v("æ³¨æ„åˆ° onStartup() æ–¹æ³•çš„å‚æ•° ServletContext, å¯ä»¥é€šè¿‡è°ƒç”¨å®ƒçš„ "),t("strong",[s._v("addServlet()")]),s._v("  æ–¹æ³•æ¥åŠ¨æ€æ³¨å†Œæ–°çš„ Servlet, è¿™æ˜¯ Servlet 3.0 ä»¥åæ‰æœ‰çš„åŠŸèƒ½.")])]),s._v(" "),t("h5",{attrs:{id:"webå®¹å™¨çš„å®šåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webå®¹å™¨çš„å®šåˆ¶"}},[s._v("#")]),s._v(" Webå®¹å™¨çš„å®šåˆ¶")]),s._v(" "),t("p",[s._v("å†æ¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜, é‚£å°±æ˜¯å¦‚ä½•åœ¨ Spring Boot ä¸­"),t("strong",[s._v("å®šåˆ¶ Web å®¹å™¨")]),s._v(". åœ¨ Spring Boot 2.0 ä¸­, å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®šåˆ¶ Web å®¹å™¨.")]),s._v(" "),t("p",[t("strong",[s._v("ç¬¬ä¸€ç§æ–¹å¼")]),s._v("æ˜¯é€šè¿‡é€šç”¨çš„ Web å®¹å™¨å·¥å‚ ConfigurableServletWebServerFactory, æ¥å®šåˆ¶ä¸€äº› Web å®¹å™¨é€šç”¨çš„å‚æ•°:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyGeneralCustomizer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerFactoryCustomizer")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConfigurableServletWebServerFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("customize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConfigurableServletWebServerFactory")]),s._v(" factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContextPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("strong",[s._v("ç¬¬äºŒç§æ–¹å¼")]),s._v("æ˜¯é€šè¿‡ç‰¹å®š Web å®¹å™¨çš„å·¥å‚æ¯”å¦‚ TomcatServletWebServerFactory æ¥è¿›ä¸€æ­¥å®šåˆ¶. ä¸‹é¢çš„ä¾‹å­ç»™ Tomcat å¢åŠ ä¸€ä¸ª Valve, è¿™ä¸ª Valve çš„åŠŸèƒ½æ˜¯å‘è¯·æ±‚å¤´é‡Œæ·»åŠ  traceid, ç”¨äºåˆ†å¸ƒå¼è¿½è¸ª. TraceValve çš„å®šä¹‰å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TraceValve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ValveBase")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Request")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Response")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n        request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCoyoteRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMimeHeaders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"traceid"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1234xxxxabcd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Valve")]),s._v(" next "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("è·Ÿç¬¬ä¸€ç§æ–¹å¼ç±»ä¼¼, å†æ·»åŠ ä¸€ä¸ªå®šåˆ¶å™¨, ä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyTomcatCustomizer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerFactoryCustomizer")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TomcatServletWebServerFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("customize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TomcatServletWebServerFactory")]),s._v(" factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContextPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEngineValves")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TraceValve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h4",{attrs:{id:"_30-çƒ­ç‚¹ç­”ç–‘-3-springæ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_30-çƒ­ç‚¹ç­”ç–‘-3-springæ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼"}},[s._v("#")]),s._v(" 30.çƒ­ç‚¹ç­”ç–‘(3):Springæ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼")]),s._v(" "),t("p",[s._v("è¿™é‡Œåˆ†æä¸€ä¸‹ Spring æ¡†æ¶é‡Œçš„è®¾è®¡æ¨¡å¼. Spring çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ IOC å®¹å™¨ä»¥åŠ AOP é¢å‘åˆ‡é¢ç¼–ç¨‹, åŒæ ·ä¹Ÿæ˜¯å¾ˆå¤š Web åç«¯å·¥ç¨‹å¸ˆæ¯å¤©éƒ½è¦æ‰“äº¤é“çš„æ¡†æ¶.")]),s._v(" "),t("h5",{attrs:{id:"ç®€å•å·¥å‚æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç®€å•å·¥å‚æ¨¡å¼"}},[s._v("#")]),s._v(" ç®€å•å·¥å‚æ¨¡å¼")]),s._v(" "),t("p",[s._v("æˆ‘è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯: å½“ A å¯¹è±¡éœ€è¦è°ƒç”¨ B å¯¹è±¡çš„æ–¹æ³•æ—¶, éœ€è¦åœ¨ A ä¸­ new ä¸€ä¸ª B çš„å®ä¾‹, æˆ‘ä»¬æŠŠè¿™ç§æ–¹å¼å«ä½œ"),t("strong",[s._v("ç¡¬ç¼–ç è€¦åˆ")]),s._v(", å®ƒçš„ç¼ºç‚¹æ˜¯ä¸€æ—¦éœ€æ±‚å‘ç”Ÿå˜åŒ–, æ¯”å¦‚éœ€è¦ä½¿ç”¨ C ç±»æ¥ä»£æ›¿ B æ—¶, å°±è¦æ”¹å†™ A ç±»çš„æ–¹æ³•. å‡å¦‚åº”ç”¨ä¸­æœ‰ 1000 ä¸ªç±»ä»¥ç¡¬ç¼–ç çš„æ–¹å¼è€¦åˆäº† B, é‚£æ”¹èµ·æ¥å°±è´¹åŠ²äº†. äºæ˜¯ç®€å•å·¥å‚æ¨¡å¼å°±ç™»åœºäº†, ç®€å•å·¥å‚æ¨¡å¼åˆå«é™æ€å·¥å‚æ–¹æ³•, å…¶å®è´¨æ˜¯ç”±ä¸€ä¸ªå·¥å‚ç±»æ ¹æ®ä¼ å…¥çš„å‚æ•°, åŠ¨æ€å†³å®šåº”è¯¥åˆ›å»ºå“ªä¸€ä¸ªäº§å“ç±».")]),s._v(" "),t("p",[s._v("Spring ä¸­çš„ "),t("strong",[s._v("BeanFactory")]),s._v(" å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„ä½“ç°, BeanFactory æ˜¯ Spring IOC å®¹å™¨ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¥å£, å®ƒçš„å®šä¹‰å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BeanFactory")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BeansException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" requiredType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" requiredType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" requiredType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("containsBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isSingleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   boolea "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isPrototype")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isTypeMatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResolvableType")]),s._v(" typeToMatch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isTypeMatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" typeToMatch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAliases")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("å¯ä»¥é€šè¿‡å®ƒçš„å…·ä½“å®ç°ç±»(æ¯”å¦‚ ClassPathXmlApplicationContext)æ¥è·å– Bean:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BeanFactory")]),s._v(" bf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassPathXmlApplicationContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring.xml"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" userBean "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userBean"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°, ä½¿ç”¨è€…ä¸éœ€è¦è‡ªå·±æ¥ new å¯¹è±¡, è€Œæ˜¯é€šè¿‡å·¥å‚ç±»çš„æ–¹æ³• getBean() æ¥è·å–å¯¹è±¡å®ä¾‹, è¿™æ˜¯å…¸å‹çš„ç®€å•å·¥å‚æ¨¡å¼, åªä¸è¿‡ Spring æ˜¯ç”¨åå°„æœºåˆ¶æ¥åˆ›å»º Bean çš„.")]),s._v(" "),t("h5",{attrs:{id:"å·¥å‚æ–¹æ³•æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å·¥å‚æ–¹æ³•æ¨¡å¼"}},[s._v("#")]),s._v(" å·¥å‚æ–¹æ³•æ¨¡å¼")]),s._v(" "),t("p",[s._v("å·¥å‚æ–¹æ³•æ¨¡å¼è¯´ç™½äº†å…¶å®å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„ä¸€ç§å‡çº§æˆ–è€…è¯´æ˜¯è¿›ä¸€æ­¥æŠ½è±¡, å®ƒå¯ä»¥åº”ç”¨äºæ›´åŠ å¤æ‚çš„åœºæ™¯, çµæ´»æ€§ä¹Ÿæ›´é«˜. åœ¨ç®€å•å·¥å‚ä¸­, ç”±å·¥å‚ç±»è¿›è¡Œæ‰€æœ‰çš„é€»è¾‘åˆ¤æ–­, å®ä¾‹åˆ›å»º; "),t("strong",[s._v("å¦‚æœä¸æƒ³åœ¨å·¥å‚ç±»ä¸­è¿›è¡Œåˆ¤æ–­, å¯ä»¥ä¸ºä¸åŒçš„äº§å“æä¾›ä¸åŒçš„å·¥å‚, ä¸åŒçš„å·¥å‚ç”Ÿäº§ä¸åŒçš„äº§å“, æ¯ä¸€ä¸ªå·¥å‚éƒ½åªå¯¹åº”ä¸€ä¸ªç›¸åº”çš„å¯¹è±¡, è¿™å°±æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼")]),s._v(".")]),s._v(" "),t("p",[s._v("Spring ä¸­çš„ "),t("strong",[s._v("FactoryBean")]),s._v(" å°±æ˜¯è¿™ç§æ€æƒ³çš„ä½“ç°, FactoryBean å¯ä»¥ç†è§£ä¸ºå·¥å‚ Bean, å…ˆæ¥çœ‹çœ‹å®ƒçš„å®šä¹‰:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FactoryBean")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getObjectType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isSingleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("è¿™é‡Œå®šä¹‰ä¸€ä¸ªç±» UserFactoryBean æ¥å®ç° FactoryBean æ¥å£, ä¸»è¦æ˜¯åœ¨ getObject() æ–¹æ³•é‡Œ new ä¸€ä¸ª User å¯¹è±¡. è¿™æ ·é€šè¿‡ getBean(id) è·å¾—çš„æ˜¯è¯¥å·¥å‚æ‰€äº§ç”Ÿçš„ User çš„å®ä¾‹, è€Œä¸æ˜¯ UserFactoryBean æœ¬èº«çš„å®ä¾‹, åƒä¸‹é¢è¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BeanFactory")]),s._v(" bf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassPathXmlApplicationContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user.xml"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" userBean "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userFactoryBean"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h5",{attrs:{id:"å•ä¾‹æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å•ä¾‹æ¨¡å¼"}},[s._v("#")]),s._v(" å•ä¾‹æ¨¡å¼")]),s._v(" "),t("p",[s._v("å•ä¾‹æ¨¡å¼æ˜¯æŒ‡ä¸€ä¸ªç±»åœ¨æ•´ä¸ªç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­, åªå…è®¸äº§ç”Ÿä¸€ä¸ªå®ä¾‹. é‚£ Spring æ˜¯å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼çš„å‘¢? ç­”æ¡ˆæ˜¯"),t("strong",[s._v("é€šè¿‡å•ä¾‹æ³¨å†Œè¡¨")]),s._v("çš„æ–¹å¼, å…·ä½“æ¥è¯´å°±æ˜¯ä½¿ç”¨äº† HashMap. ä¸ºäº†æ–¹ä¾¿é˜…è¯», ä¹Ÿå¯¹ä»£ç è¿›è¡Œäº†ç®€åŒ–:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultSingletonBeanRegistry")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä½¿ç”¨äº†çº¿ç¨‹å®‰å…¨å®¹å™¨ ConcurrentHashMap, ä¿å­˜å„ç§å•å®ä¾‹å¯¹è±¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" singletonObjects "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSingleton")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" beanName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…ˆåˆ° HashMap ä¸­æ‹¿ Object")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" singletonObject "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" singletonObjects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("beanName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ²¡æ‹¿åˆ°é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹, å¹¶æ·»åŠ åˆ° HashMap ä¸­")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("singletonObject "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      singletonObjects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("beanName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                           "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("beanName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›å¯¹è±¡å®ä¾‹")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" singletonObjects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("beanName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä»£ç é€»è¾‘æ¯”è¾ƒæ¸…æ™°, å…ˆåˆ° HashMap å»æ‹¿å•å®ä¾‹å¯¹è±¡, æ²¡æ‹¿åˆ°å°±åˆ›å»ºä¸€ä¸ªæ·»åŠ åˆ° HashMap.")]),s._v(" "),t("h5",{attrs:{id:"ä»£ç†æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»£ç†æ¨¡å¼"}},[s._v("#")]),s._v(" ä»£ç†æ¨¡å¼")]),s._v(" "),t("p",[t("strong",[s._v("æ‰€è°“ä»£ç†, æ˜¯æŒ‡å®ƒä¸è¢«ä»£ç†å¯¹è±¡å®ç°äº†ç›¸åŒçš„æ¥å£, å®¢æˆ·ç«¯å¿…é¡»é€šè¿‡ä»£ç†æ‰èƒ½ä¸è¢«ä»£ç†çš„ç›®æ ‡ç±»è¿›è¡Œäº¤äº’, è€Œä»£ç†ä¸€èˆ¬åœ¨äº¤äº’çš„è¿‡ç¨‹ä¸­(äº¤äº’å‰å), è¿›è¡ŒæŸäº›ç‰¹å®šçš„å¤„ç†, æ¯”å¦‚åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•å‰åšå‰ç½®å¤„ç†, è°ƒç”¨è¿™ä¸ªæ–¹æ³•ååšåç½®å¤„ç†")]),s._v(". ä»£ç†æ¨¡å¼ä¸­æœ‰ä¸‹é¢å‡ ç§è§’è‰²:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("æŠ½è±¡æ¥å£")]),s._v(": å®šä¹‰ç›®æ ‡ç±»åŠä»£ç†ç±»çš„å…±åŒæ¥å£, è¿™æ ·åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ç›®æ ‡å¯¹è±¡çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ä»£ç†å¯¹è±¡.")]),s._v(" "),t("li",[t("strong",[s._v("ç›®æ ‡å¯¹è±¡")]),s._v(": å®šä¹‰äº†ä»£ç†å¯¹è±¡æ‰€ä»£è¡¨çš„ç›®æ ‡å¯¹è±¡, ä¸“æ³¨äºä¸šåŠ¡åŠŸèƒ½çš„å®ç°.")]),s._v(" "),t("li",[t("strong",[s._v("ä»£ç†å¯¹è±¡")]),s._v(": ä»£ç†å¯¹è±¡å†…éƒ¨å«æœ‰ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨, æ”¶åˆ°å®¢æˆ·ç«¯çš„è°ƒç”¨è¯·æ±‚æ—¶, ä»£ç†å¯¹è±¡é€šå¸¸ä¸ä¼šç›´æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•, è€Œæ˜¯åœ¨è°ƒç”¨ä¹‹å‰å’Œä¹‹åå®ç°ä¸€äº›é¢å¤–çš„é€»è¾‘.")])]),s._v(" "),t("p",[s._v("ä»£ç†æ¨¡å¼çš„å¥½å¤„æ˜¯, å¯ä»¥åœ¨ç›®æ ‡å¯¹è±¡ä¸šåŠ¡åŠŸèƒ½çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›"),t("strong",[s._v("å…¬å…±çš„é€»è¾‘")]),s._v(", æ¯”å¦‚æƒ³ç»™ç›®æ ‡å¯¹è±¡åŠ å…¥æ—¥å¿—, æƒé™ç®¡ç†å’Œäº‹åŠ¡æ§åˆ¶ç­‰åŠŸèƒ½, å°±å¯ä»¥ä½¿ç”¨ä»£ç†ç±»æ¥å®Œæˆ, è€Œæ²¡å¿…è¦ä¿®æ”¹ç›®æ ‡ç±», ä»è€Œä½¿å¾—ç›®æ ‡ç±»ä¿æŒç¨³å®š. è¿™å…¶å®æ˜¯"),t("strong",[s._v("å¼€é—­åŸåˆ™")]),s._v("çš„ä½“ç°, ä¸è¦éšæ„å»ä¿®æ”¹åˆ«äººå·²ç»å†™å¥½çš„ä»£ç æˆ–è€…æ–¹æ³•.")]),s._v(" "),t("p",[t("strong",[s._v("ä»£ç†åˆåˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¸¤ç§æ–¹å¼")]),s._v(". é™æ€ä»£ç†éœ€è¦å®šä¹‰æ¥å£, è¢«ä»£ç†å¯¹è±¡(ç›®æ ‡å¯¹è±¡)ä¸ä»£ç†å¯¹è±¡(Proxy) ä¸€èµ·å®ç°ç›¸åŒçš„æ¥å£, é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£ä¸€ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŠ½è±¡æ¥å£")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IStudentDao")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç›®æ ‡å¯¹è±¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StudentDao")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IStudentDao")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ä¿å­˜æˆåŠŸ "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»£ç†å¯¹è±¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StudentDaoProxy")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IStudentDao")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒæœ‰ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IStudentDao")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StudentDaoProxy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IStudentDao")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨ç›®æ ‡åŠŸèƒ½å¯¹è±¡æ–¹æ³•çš„å‰ååŠ å…¥äº‹åŠ¡æ§åˆ¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" å¼€å§‹äº‹åŠ¡ "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" æäº¤äº‹åŠ¡ "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºç›®æ ‡å¯¹è±¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StudentDao")]),s._v(" target "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StudentDao")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä»£ç†å¯¹è±¡, æŠŠç›®æ ‡å¯¹è±¡ä¼ ç»™ä»£ç†å¯¹è±¡, å»ºç«‹ä»£ç†å…³ç³»")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StudentDaoProxy")]),s._v(" proxy "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StudentDaoProxy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œçš„æ˜¯ä»£ç†çš„æ–¹æ³•")]),s._v("\n    proxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("p",[s._v("è€Œ Spring çš„ "),t("strong",[s._v("AOP é‡‡ç”¨çš„æ˜¯åŠ¨æ€ä»£ç†çš„æ–¹å¼")]),s._v(', è€ŒåŠ¨æ€ä»£ç†å°±æ˜¯æŒ‡ä»£ç†ç±»åœ¨ç¨‹åºè¿è¡Œæ—¶ç”± JVM åŠ¨æ€åˆ›å»º. åœ¨ä¸Šé¢é™æ€ä»£ç†çš„ä¾‹å­ä¸­, ä»£ç†ç±»(StudentDaoProxy)æ˜¯è‡ªå·±å®šä¹‰å¥½çš„, åœ¨ç¨‹åºè¿è¡Œä¹‹å‰å°±å·²ç»ç¼–è¯‘å®Œæˆ. è€ŒåŠ¨æ€ä»£ç†, ä»£ç†ç±»å¹¶ä¸æ˜¯åœ¨ Java ä»£ç ä¸­å®šä¹‰çš„, è€Œæ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®åœ¨ Java ä»£ç ä¸­çš„"æŒ‡ç¤º"åŠ¨æ€ç”Ÿæˆçš„. é‚£æ€ä¹ˆ "æŒ‡ç¤º" JDK å»åŠ¨æ€åœ°ç”Ÿæˆä»£ç†ç±»å‘¢?')]),s._v(" "),t("p",[s._v("åœ¨ Java çš„ "),t("code",[s._v("java.lang.reflect")]),s._v("â€‹ åŒ…é‡Œæä¾›äº†ä¸€ä¸ª Proxy ç±»å’Œä¸€ä¸ª "),t("strong",[s._v("InvocationHandler")]),s._v(" æ¥å£, é€šè¿‡è¿™ä¸ªç±»å’Œè¿™ä¸ªæ¥å£å¯ä»¥ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡. å…·ä½“æ¥è¯´æœ‰å¦‚ä¸‹æ­¥éª¤:")]),s._v(" "),t("ol",[t("li",[s._v("å®šä¹‰ä¸€ä¸ª InvocationHandler ç±», å°†éœ€è¦æ‰©å±•çš„é€»è¾‘é›†ä¸­æ”¾åˆ°è¿™ä¸ªç±»ä¸­, æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­æ¨¡æ‹Ÿäº†æ·»åŠ äº‹åŠ¡æ§åˆ¶çš„é€»è¾‘.")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyInvocationHandler")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InvocationHandler")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyInvocationHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" proxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Method")]),s._v(" method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" å¼€å§‹äº‹åŠ¡ "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" å¼€å§‹äº‹åŠ¡ "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("ä½¿ç”¨ Proxy çš„ newProxyInstance() æ–¹æ³•åŠ¨æ€çš„åˆ›å»ºä»£ç†å¯¹è±¡:")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºç›®æ ‡å¯¹è±¡ StudentDao")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IStudentDao")]),s._v(" stuDAO "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StudentDao")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º MyInvocationHandler å¯¹è±¡")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InvocationHandler")]),s._v(" handler "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyInvocationHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stuDAO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä½¿ç”¨ Proxy.newProxyInstance åŠ¨æ€çš„åˆ›å»ºä»£ç†å¯¹è±¡ stuProxy")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IStudentDao")]),s._v(" stuProxy "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IStudentDao")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Proxy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newProxyInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stuDAO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClassLoader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stuDAO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInterfaces")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" handler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŠ¨ç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•")]),s._v("\n  stuProxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("**ä¸Šé¢çš„ä»£ç å®ç°å’Œé™æ€ä»£ç†ä¸€æ ·çš„åŠŸèƒ½, ç›¸æ¯”äºé™æ€ä»£ç†, åŠ¨æ€ä»£ç†çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹ä»£ç†ç±»çš„å‡½æ•°è¿›è¡Œç»Ÿä¸€çš„å¤„ç†, è€Œä¸ç”¨ä¿®æ”¹æ¯ä¸ªä»£ç†ç±»ä¸­çš„æ–¹æ³•. **")]),s._v(" "),t("p",[t("strong",[s._v("Spring å®ç°äº†é€šè¿‡åŠ¨æ€ä»£ç†å¯¹ç±»è¿›è¡Œæ–¹æ³•çº§åˆ«çš„åˆ‡é¢å¢å¼º")]),s._v(", è§£é‡Šä¸€ä¸‹è¿™å¥è¯, å…¶å®å°±æ˜¯åŠ¨æ€ç”Ÿæˆç›®æ ‡å¯¹è±¡çš„ä»£ç†ç±», å¹¶åœ¨ä»£ç†ç±»çš„æ–¹æ³•ä¸­è®¾ç½®æ‹¦æˆªå™¨, é€šè¿‡æ‰§è¡Œæ‹¦æˆªå™¨ä¸­çš„é€»è¾‘å¢å¼ºäº†ä»£ç†æ–¹æ³•çš„åŠŸèƒ½, ä»è€Œå®ç° AOP.")]),s._v(" "),t("h3",{attrs:{id:"é€šç”¨ç»„ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é€šç”¨ç»„ä»¶"}},[s._v("#")]),s._v(" é€šç”¨ç»„ä»¶")]),s._v(" "),t("h4",{attrs:{id:"_31-loggerç»„ä»¶-tomcatçš„æ—¥å¿—æ¡†æ¶åŠå®æˆ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_31-loggerç»„ä»¶-tomcatçš„æ—¥å¿—æ¡†æ¶åŠå®æˆ˜"}},[s._v("#")]),s._v(" 31.Loggerç»„ä»¶:Tomcatçš„æ—¥å¿—æ¡†æ¶åŠå®æˆ˜")]),s._v(" "),t("p",[s._v("æ¯ä¸€ä¸ªç³»ç»Ÿéƒ½æœ‰ä¸€äº›é€šç”¨çš„æ¨¡å—, æ¯”å¦‚æ—¥å¿—æ¨¡å—, å¼‚å¸¸å¤„ç†æ¨¡å—, å·¥å…·ç±»ç­‰, å¯¹äº Tomcat æ¥è¯´, æ¯”è¾ƒé‡è¦çš„é€šç”¨æ¨¡å—æœ‰æ—¥å¿—, Session ç®¡ç†å’Œé›†ç¾¤ç®¡ç†. ä¸‹é¢æ¥ä»‹ç»è¿™äº›é€šç”¨æ¨¡å—.")]),s._v(" "),t("p",[s._v("æ—¥å¿—æ¨¡å—ä½œä¸ºä¸€ä¸ªé€šç”¨çš„åŠŸèƒ½, åœ¨ç³»ç»Ÿé‡Œé€šå¸¸ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ—¥å¿—æ¡†æ¶. Java çš„æ—¥å¿—æ¡†æ¶æœ‰å¾ˆå¤š, æ¯”å¦‚: JUL(Java Util Logging), Log4j, Logback, Log4j2, Tinylog ç­‰. é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰ JCL(Apache Commons Logging)å’Œ SLF4J è¿™æ ·çš„â€œé—¨é¢æ—¥å¿—â€. ä¸‹é¢æ˜¯ SLF4J ä¸æ—¥å¿—æ¡†æ¶ Logback, Log4j çš„å…³ç³»å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162108-n8et45j.png",alt:""}})]),s._v(" "),t("p",[s._v('å…ˆæ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯"é—¨é¢æ—¥å¿—". "é—¨é¢æ—¥å¿—" åˆ©ç”¨äº†è®¾è®¡æ¨¡å¼ä¸­çš„é—¨é¢æ¨¡å¼æ€æƒ³, '),t("strong",[s._v("å¯¹å¤–æä¾›ä¸€å¥—é€šç”¨çš„æ—¥å¿—è®°å½•çš„ API, è€Œä¸æä¾›å…·ä½“çš„æ—¥å¿—è¾“å‡ºæœåŠ¡, å¦‚æœè¦å®ç°æ—¥å¿—è¾“å‡º, éœ€è¦é›†æˆå…¶ä»–çš„æ—¥å¿—æ¡†æ¶, æ¯”å¦‚ Log4j, Logback, Log4j2 ç­‰")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ç§é—¨é¢æ¨¡å¼çš„å¥½å¤„åœ¨äº, è®°å½•æ—¥å¿—çš„ "),t("strong",[s._v("API å’Œæ—¥å¿—è¾“å‡ºçš„æœåŠ¡åˆ†ç¦»å¼€")]),s._v(", ä»£ç é‡Œé¢åªéœ€è¦å…³æ³¨è®°å½•æ—¥å¿—çš„ API, "),t("strong",[s._v("é€šè¿‡ SLF4J æŒ‡å®šçš„æ¥å£è®°å½•æ—¥å¿—; è€Œæ—¥å¿—è¾“å‡ºé€šè¿‡å¼•å…¥ JAR åŒ…çš„æ–¹å¼å³å¯æŒ‡å®šå…¶ä»–çš„æ—¥å¿—æ¡†æ¶")]),s._v(". ** å½“éœ€è¦æ”¹å˜ç³»ç»Ÿçš„æ—¥å¿—è¾“å‡ºæœåŠ¡æ—¶, ä¸ç”¨ä¿®æ”¹ä»£ç , åªéœ€è¦æ”¹å˜å¼•å…¥æ—¥å¿—è¾“å‡ºæ¡†æ¶ JAR åŒ…**.")]),s._v(" "),t("p",[s._v("è¿™é‡Œå°±æ¥çœ‹çœ‹ Tomcat çš„æ—¥å¿—æ¨¡å—æ˜¯å¦‚ä½•å®ç°çš„. é»˜è®¤æƒ…å†µä¸‹, Tomcat ä½¿ç”¨è‡ªèº«çš„ JULI ä½œä¸º Tomcat å†…éƒ¨çš„æ—¥å¿—å¤„ç†ç³»ç»Ÿ. JULI çš„æ—¥å¿—é—¨é¢é‡‡ç”¨äº† JCL; è€Œ JULI çš„å…·ä½“å®ç°æ˜¯æ„å»ºåœ¨ Java åŸç”Ÿçš„æ—¥å¿—ç³»ç»Ÿ "),t("code",[s._v("java.util.logging")]),s._v("â€‹ ä¹‹ä¸Šçš„, æ‰€ä»¥åœ¨çœ‹ JULI çš„æ—¥å¿—ç³»ç»Ÿä¹‹å‰, å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ Java çš„æ—¥å¿—ç³»ç»Ÿ.")]),s._v(" "),t("h5",{attrs:{id:"javaæ—¥å¿—ç³»ç»Ÿ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javaæ—¥å¿—ç³»ç»Ÿ"}},[s._v("#")]),s._v(" Javaæ—¥å¿—ç³»ç»Ÿ")]),s._v(" "),t("p",[s._v("Java çš„æ—¥å¿—åŒ…åœ¨ "),t("code",[s._v("java.util.logging")]),s._v("â€‹ è·¯å¾„ä¸‹, åŒ…å«äº†å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ç»„ä»¶, é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£ä¸€ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162108-gmhlkau.png",alt:""}})]),s._v(" "),t("p",[s._v("ä»å›¾ä¸Šçœ‹åˆ°è¿™æ ·å‡ ä¸ªé‡è¦çš„ç»„ä»¶:")]),s._v(" "),t("ul",[t("li",[s._v("Logger: ç”¨æ¥è®°å½•æ—¥å¿—çš„ç±».")]),s._v(" "),t("li",[s._v("Handler: è§„å®šäº†æ—¥å¿—çš„è¾“å‡ºæ–¹å¼, å¦‚æ§åˆ¶å°è¾“å‡º, å†™å…¥æ–‡ä»¶.")]),s._v(" "),t("li",[s._v("Level: å®šä¹‰äº†æ—¥å¿—çš„ä¸åŒç­‰çº§.")]),s._v(" "),t("li",[s._v("Formatter: å°†æ—¥å¿—ä¿¡æ¯æ ¼å¼åŒ–, æ¯”å¦‚çº¯æ–‡æœ¬, XML.")])]),s._v(" "),t("p",[s._v("å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥ä½¿ç”¨è¿™äº›ç»„ä»¶:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),s._v(" logger "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLogger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.mycompany.myapp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setLevel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Level")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FINE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setUseParentHandlers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Handler")]),s._v(" hd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsoleHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setLevel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Level")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FINE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h5",{attrs:{id:"juli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#juli"}},[s._v("#")]),s._v(" JULI")]),s._v(" "),t("p",[s._v("JULI å¯¹æ—¥å¿—çš„å¤„ç†æ–¹å¼ä¸ Java è‡ªå¸¦çš„åŸºæœ¬ä¸€è‡´, ä½†æ˜¯ Tomcat ä¸­å¯ä»¥åŒ…å«å¤šä¸ªåº”ç”¨, è€Œæ¯ä¸ªåº”ç”¨çš„æ—¥å¿—ç³»ç»Ÿåº”è¯¥ç›¸äº’ç‹¬ç«‹. Java çš„åŸç”Ÿæ—¥å¿—ç³»ç»Ÿæ˜¯æ¯ä¸ª JVM æœ‰ä¸€ä»½æ—¥å¿—çš„é…ç½®æ–‡ä»¶, è¿™ä¸ç¬¦åˆ Tomcat å¤šåº”ç”¨çš„åœºæ™¯, æ‰€ä»¥ JULI é‡æ–°å®ç°äº†ä¸€äº›æ—¥å¿—æ¥å£.")]),s._v(" "),t("p",[t("strong",[s._v("DirectJDKLog")])]),s._v(" "),t("p",[s._v("Log çš„åŸºç¡€å®ç°ç±»æ˜¯ DirectJDKLog, è¿™ä¸ªç±»ç›¸å¯¹ç®€å•, å°±åŒ…è£…äº†ä¸€ä¸‹ Java çš„ Logger ç±». ä½†æ˜¯å®ƒä¹Ÿåœ¨åŸæ¥çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›ä¿®æ”¹, æ¯”å¦‚ä¿®æ”¹é»˜è®¤çš„æ ¼å¼åŒ–æ–¹å¼.")]),s._v(" "),t("p",[t("strong",[s._v("LogFactory")])]),s._v(" "),t("p",[s._v("Log ä½¿ç”¨äº†å·¥å‚æ¨¡å¼æ¥å‘å¤–æä¾›å®ä¾‹, LogFactory æ˜¯ä¸€ä¸ªå•ä¾‹, å¯ä»¥é€šè¿‡ SeviceLoader ä¸º Log æä¾›è‡ªå®šä¹‰çš„å®ç°ç‰ˆæœ¬, å¦‚æœæ²¡æœ‰é…ç½®, å°±é»˜è®¤ä½¿ç”¨ DirectJDKLog.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€šè¿‡ ServiceLoader å°è¯•åŠ è½½ Log çš„å®ç°ç±»")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServiceLoader")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" logLoader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServiceLoader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("load")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Constructor")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),s._v(" log"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" logLoader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            m"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConstructor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NoSuchMethodException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚ä½•æ²¡æœ‰å®šä¹‰ Log çš„å®ç°ç±», discoveredLogConstructor ä¸º null")]),s._v("\n    discoveredLogConstructor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("ä¸‹é¢çš„ä»£ç æ˜¯ LogFactory çš„ getInstance() æ–¹æ³•:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogConfigurationException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœ discoveredLogConstructor ä¸º null, ä¹Ÿå°±æ²¡æœ‰å®šä¹‰ Log ç±», é»˜è®¤ç”¨ DirectJDKLog")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("discoveredLogConstructor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DirectJDKLog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" discoveredLogConstructor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReflectiveOperationException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalArgumentException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogConfigurationException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[t("strong",[s._v("Handler")])]),s._v(" "),t("p",[s._v("åœ¨ JULI ä¸­å°±è‡ªå®šä¹‰äº†ä¸¤ä¸ª Handler: FileHandler å’Œ AsyncFileHandler. FileHandler å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ªåœ¨ç‰¹å®šä½ç½®å†™æ–‡ä»¶çš„å·¥å…·ç±», æœ‰ä¸€äº›å†™æ“ä½œå¸¸ç”¨çš„æ–¹æ³•, å¦‚ open, write(publish), close, flush ç­‰, ä½¿ç”¨äº†è¯»å†™é”. å…¶ä¸­çš„æ—¥å¿—ä¿¡æ¯é€šè¿‡ Formatter æ¥æ ¼å¼åŒ–.")]),s._v(" "),t("p",[s._v("AsyncFileHandler ç»§æ‰¿è‡ª FileHandler, å®ç°äº†å¼‚æ­¥çš„å†™æ“ä½œ. å…¶ä¸­ç¼“å­˜å­˜å‚¨æ˜¯é€šè¿‡é˜»å¡åŒç«¯é˜Ÿåˆ— LinkedBlockingDeque æ¥å®ç°çš„. å½“åº”ç”¨è¦é€šè¿‡è¿™ä¸ª Handler æ¥è®°å½•ä¸€æ¡æ¶ˆæ¯æ—¶, æ¶ˆæ¯ä¼šå…ˆè¢«å­˜å‚¨åˆ°é˜Ÿåˆ—ä¸­, è€Œåœ¨åå°ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯, å–å‡ºçš„æ¶ˆæ¯ä¼šé€šè¿‡çˆ¶ç±»çš„ publish æ–¹æ³•å†™å…¥ç›¸åº”æ–‡ä»¶å†…. è¿™æ ·å°±å¯ä»¥åœ¨å¤§é‡æ—¥å¿—éœ€è¦å†™å…¥çš„æ—¶å€™èµ·åˆ°ç¼“å†²ä½œç”¨, é˜²æ­¢éƒ½é˜»å¡åœ¨å†™æ—¥å¿—è¿™ä¸ªåŠ¨ä½œä¸Š. éœ€è¦æ³¨æ„çš„æ˜¯, æˆ‘ä»¬å¯ä»¥ä¸ºé˜»å¡åŒç«¯é˜Ÿåˆ—è®¾ç½®ä¸åŒçš„æ¨¡å¼, åœ¨ä¸åŒæ¨¡å¼ä¸‹, å¯¹æ–°è¿›å…¥çš„æ¶ˆæ¯æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼, æœ‰äº›æ¨¡å¼ä¸‹ä¼šç›´æ¥ä¸¢å¼ƒä¸€äº›æ—¥å¿—:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("OVERFLOW_DROP_LAST: ä¸¢å¼ƒæ ˆé¡¶çš„å…ƒç´  \nOVERFLOW_DROP_FIRSH: ä¸¢å¼ƒæ ˆåº•çš„å…ƒç´  \nOVERFLOW_DROP_FLUSH: ç­‰å¾…ä¸€å®šæ—¶é—´å¹¶é‡è¯•, ä¸ä¼šä¸¢å¤±å…ƒç´  \nOVERFLOW_DROP_CURRENT: ä¸¢å¼ƒæ”¾å…¥çš„å…ƒç´ \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("Formatter")])]),s._v(" "),t("p",[s._v("Formatter é€šè¿‡ä¸€ä¸ª format æ–¹æ³•å°†æ—¥å¿—è®°å½• LogRecord è½¬åŒ–æˆæ ¼å¼åŒ–çš„å­—ç¬¦ä¸², JULI æä¾›äº†ä¸‰ä¸ªæ–°çš„ Formatter.")]),s._v(" "),t("ul",[t("li",[s._v("OnlineFormatter: åŸºæœ¬ä¸ Java è‡ªå¸¦çš„ SimpleFormatter æ ¼å¼ç›¸åŒ, ä¸è¿‡æŠŠæ‰€æœ‰å†…å®¹éƒ½å†™åˆ°äº†ä¸€è¡Œä¸­.")]),s._v(" "),t("li",[s._v("VerbatimFormatter: åªè®°å½•äº†æ—¥å¿—ä¿¡æ¯, æ²¡æœ‰ä»»ä½•é¢å¤–çš„ä¿¡æ¯.")]),s._v(" "),t("li",[s._v("JdkLoggerFormatter: æ ¼å¼åŒ–äº†ä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—ä¿¡æ¯.")])]),s._v(" "),t("p",[t("strong",[s._v("æ—¥å¿—é…ç½®")])]),s._v(" "),t("p",[s._v("Tomcat çš„æ—¥å¿—é…ç½®æ–‡ä»¶ä¸º Tomcat æ–‡ä»¶å¤¹ä¸‹"),t("code",[s._v("conf/logging.properties")]),s._v("â€‹. æ‹†è§£ä¸€ä¸‹è¿™ä¸ªé…ç½®æ–‡ä»¶, é¦–å…ˆå¯ä»¥çœ‹åˆ°å„ç§ Handler çš„é…ç½®:")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("handlers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1catalina.org.apache.juli.AsyncFileHandler, 2localhost.org.apache.juli.AsyncFileHandler, 3manager.org.apache.juli.AsyncFileHandler, 4host-manager.org.apache.juli.AsyncFileHandler, java.util.logging.ConsoleHandler.handlers = 1catalina.org.apache.juli.AsyncFileHandler, java.util.logging.ConsoleHandler")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä»¥ "),t("code",[s._v("1catalina.org.apache.juli.AsyncFileHandler")]),s._v("â€‹ ä¸ºä¾‹, æ•°å­—æ˜¯ä¸ºäº†åŒºåˆ†åŒä¸€ä¸ªç±»çš„ä¸åŒå®ä¾‹; catalina, localhost, manager å’Œ host-manager æ˜¯ Tomcat ç”¨æ¥åŒºåˆ†ä¸åŒç³»ç»Ÿæ—¥å¿—çš„æ ‡å¿—; åé¢çš„å­—ç¬¦ä¸²è¡¨ç¤ºäº† Handler å…·ä½“ç±»å‹, å¦‚æœè¦æ·»åŠ  Tomcat æœåŠ¡å™¨çš„è‡ªå®šä¹‰ Handler, éœ€è¦åœ¨å­—ç¬¦ä¸²é‡Œæ·»åŠ .")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥æ˜¯æ¯ä¸ª Handler è®¾ç½®æ—¥å¿—ç­‰çº§, ç›®å½•å’Œæ–‡ä»¶å‰ç¼€, è‡ªå®šä¹‰çš„ Handler ä¹Ÿè¦åœ¨è¿™é‡Œé…ç½®è¯¦ç»†ä¿¡æ¯:")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("1catalina.org.apache.juli.AsyncFileHandler.level")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("FINE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("1catalina.org.apache.juli.AsyncFileHandler.directory")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("${catalina.base}/logs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("1catalina.org.apache.juli.AsyncFileHandler.prefix")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("catalina.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("1catalina.org.apache.juli.AsyncFileHandler.maxDays")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("90")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("1catalina.org.apache.juli.AsyncFileHandler.encoding")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("UTF-8")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h5",{attrs:{id:"tomcat-slf4j-logback"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcat-slf4j-logback"}},[s._v("#")]),s._v(" Tomcat+SLF4J+Logback")]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°, "),t("strong",[s._v("SLF4J å’Œ JCL éƒ½æ˜¯æ—¥å¿—é—¨é¢")]),s._v(", é‚£å®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢? å®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨æ—¥å¿—æœåŠ¡ç±»çš„ç»‘å®šæœºåˆ¶ä¸Š. JCL é‡‡ç”¨è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šçš„æœºåˆ¶, åœ¨è¿è¡Œæ—¶åŠ¨æ€å¯»æ‰¾å’ŒåŠ è½½æ—¥å¿—æ¡†æ¶å®ç°.")]),s._v(" "),t("p",[s._v("SLF4J æ—¥å¿—è¾“å‡ºæœåŠ¡ç»‘å®šåˆ™ç›¸å¯¹ç®€å•å¾ˆå¤š, "),t("strong",[s._v("åœ¨ç¼–è¯‘æ—¶å°±é™æ€ç»‘å®šæ—¥å¿—æ¡†æ¶")]),s._v(", åªéœ€è¦æå‰å¼•å…¥éœ€è¦çš„æ—¥å¿—æ¡†æ¶. å¦å¤– Logback å¯ä»¥è¯´ Log4j çš„è¿›åŒ–ç‰ˆ, åœ¨æ€§èƒ½å’Œå¯ç”¨æ€§æ–¹é¢éƒ½æœ‰æ‰€æå‡.")]),s._v(" "),t("p",[s._v('åŸºäºæ­¤æ¥å®æˆ˜ä¸€ä¸‹å¦‚ä½•å°† Tomcat é»˜è®¤çš„æ—¥å¿—æ¡†æ¶åˆ‡æ¢æˆä¸º "SLF4J + Logback". å…·ä½“çš„æ­¥éª¤æ˜¯:')]),s._v(" "),t("ol",[t("li",[s._v("æ ¹æ® Tomcat ç‰ˆæœ¬, ä»"),t("a",{attrs:{href:"https://github.com/tomcat-slf4j-logback/tomcat-slf4j-logback/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("è¿™é‡Œ"),t("OutboundLink")],1),s._v("ä¸‹è½½æ‰€éœ€è¦æ–‡ä»¶. è§£å‹åä½ ä¼šçœ‹åˆ°ä¸€ä¸ªç±»ä¼¼äº Tomcat ç›®å½•ç»“æ„çš„æ–‡ä»¶å¤¹.")]),s._v(" "),t("li",[s._v("æ›¿æ¢æˆ–æ‹·è´ä¸‹åˆ—è¿™äº›æ–‡ä»¶åˆ° Tomcat çš„å®‰è£…ç›®å½•:")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162108-xcx2xlr.jpg",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("åˆ é™¤ "),t("code",[s._v("<Tomcat>/conf/logging.properties")]),s._v("â€‹")]),s._v(" "),t("li",[s._v("å¯åŠ¨ Tomcat")])]),s._v(" "),t("h4",{attrs:{id:"_32-managerç»„ä»¶-tomcatçš„sessionç®¡ç†æœºåˆ¶è§£æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_32-managerç»„ä»¶-tomcatçš„sessionç®¡ç†æœºåˆ¶è§£æ"}},[s._v("#")]),s._v(" 32.Managerç»„ä»¶:Tomcatçš„Sessionç®¡ç†æœºåˆ¶è§£æ")]),s._v(" "),t("p",[t("strong",[s._v("å¯ä»¥é€šè¿‡ Request å¯¹è±¡çš„ getSession() æ–¹æ³•æ¥è·å– Session, å¹¶é€šè¿‡ Session å¯¹è±¡æ¥è¯»å–å’Œå†™å…¥å±æ€§å€¼")]),s._v(". è€Œ Session çš„ç®¡ç†æ˜¯ç”± Web å®¹å™¨æ¥å®Œæˆçš„, ä¸»è¦æ˜¯å¯¹ Session çš„åˆ›å»ºå’Œé”€æ¯, é™¤æ­¤ä¹‹å¤– Web å®¹å™¨è¿˜éœ€è¦å°† Session çŠ¶æ€çš„å˜åŒ–é€šçŸ¥ç»™ç›‘å¬è€….")]),s._v(" "),t("p",[s._v("å½“ç„¶ Session ç®¡ç†è¿˜å¯ä»¥äº¤ç»™ Spring æ¥åš, å¥½å¤„æ˜¯ä¸ç‰¹å®šçš„ Web å®¹å™¨è§£è€¦, "),t("strong",[s._v("Spring Session çš„æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ Filter æ‹¦æˆª Servlet è¯·æ±‚, å°†æ ‡å‡†çš„ ServletRequest åŒ…è£…ä¸€ä¸‹, æ¢æˆ Spring çš„ Request å¯¹è±¡, è¿™æ ·å½“è°ƒç”¨ Request å¯¹è±¡çš„ getSession() æ–¹æ³•æ—¶, Spring ä¼šåˆ›å»ºå’Œç®¡ç† Session")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆ Tomcat çš„ Session ç®¡ç†æœºåˆ¶è¿˜éœ€è¦äº†è§£å—? è¿˜æ˜¯æœ‰å¿…è¦, å› ä¸ºåªæœ‰äº†è§£è¿™äº›åŸç†, æ‰èƒ½æ›´å¥½çš„ç†è§£ Spring Session, ä»¥åŠ Spring Session ä¸ºä»€ä¹ˆè®¾è®¡æˆè¿™æ ·. è¿™é‡Œå°±ä» Session çš„åˆ›å»º, Session çš„æ¸…ç†ä»¥åŠ Session çš„äº‹ä»¶é€šçŸ¥è¿™å‡ ä¸ªæ–¹é¢æ¥äº†è§£ Tomcat çš„ Session ç®¡ç†æœºåˆ¶.")]),s._v(" "),t("h5",{attrs:{id:"sessionçš„åˆ›å»º"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sessionçš„åˆ›å»º"}},[s._v("#")]),s._v(" Sessionçš„åˆ›å»º")]),s._v(" "),t("p",[s._v("Tomcat ä¸­ä¸»è¦ç”±æ¯ä¸ª "),t("strong",[s._v("Context å®¹å™¨å†…çš„ä¸€ä¸ª Manager å¯¹è±¡æ¥ç®¡ç† Session")]),s._v(". é»˜è®¤å®ç°ç±»ä¸º StandardManager. ä¸‹é¢é€šè¿‡å®ƒçš„æ¥å£æ¥äº†è§£ä¸€ä¸‹ StandardManager çš„åŠŸèƒ½:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Manager")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SessionIdGenerator")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSessionIdGenerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setSessionIdGenerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SessionIdGenerator")]),s._v(" sessionIdGenerator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSessionCounter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setSessionCounter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" sessionCounter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMaxActive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxActive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxActive"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getActiveSessions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExpiredSessions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setExpiredSessions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" expiredSessions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRejectedSessions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSessionMaxAliveTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setSessionMaxAliveTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sessionMaxAliveTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSessionAverageAliveTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSessionCreateRate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSessionExpireRate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("changeSessionId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("changeSessionId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" newId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createEmptySession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" sessionId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findSessions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("load")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassNotFoundException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addPropertyChangeListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PropertyChangeListener")]),s._v(" listener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("removePropertyChangeListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PropertyChangeListener")]),s._v(" listener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unload")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("willAttributeDistribute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[s._v("ä¸å‡ºæ„å¤–åœ¨æ¥å£ä¸­çœ‹åˆ°äº†æ·»åŠ å’Œåˆ é™¤ Session çš„æ–¹æ³•; å¦å¤–è¿˜æœ‰ load() å’Œ unload() æ–¹æ³•, å®ƒä»¬çš„ä½œç”¨æ˜¯åˆ†åˆ«æ˜¯å°† Session æŒä¹…åŒ–åˆ°å­˜å‚¨ä»‹è´¨å’Œä»å­˜å‚¨ä»‹è´¨åŠ è½½ Session.")]),s._v(" "),t("p",[s._v("å½“è°ƒç”¨ "),t("code",[s._v("HttpServletRequest.getSession(true)")]),s._v('â€‹æ—¶, è¿™ä¸ªå‚æ•° true çš„æ„æ€æ˜¯"å¦‚æœå½“å‰è¯·æ±‚è¿˜æ²¡æœ‰ Session, å°±åˆ›å»ºä¸€ä¸ªæ–°çš„". é‚£ Tomcat åœ¨èƒŒååšäº†äº›ä»€ä¹ˆå‘¢?')]),s._v(" "),t("p",[s._v("HttpServletRequest æ˜¯ä¸€ä¸ªæ¥å£, Tomcat å®ç°äº†è¿™ä¸ªæ¥å£, å…·ä½“å®ç°ç±»æ˜¯: "),t("code",[s._v("org.apache.catalina.connector.Request")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("ä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æ‹¿åˆ°çš„ Request, Tomcat ä¸ºäº†é¿å…æŠŠä¸€äº›å®ç°ç»†èŠ‚æš´éœ²å‡ºæ¥, è¿˜æœ‰åŸºäºå®‰å…¨ä¸Šçš„è€ƒè™‘, "),t("strong",[s._v("å®šä¹‰äº† Request çš„åŒ…è£…ç±», å«ä½œ RequestFacade")]),s._v(", å¯ä»¥é€šè¿‡ä»£ç æ¥ç†è§£ä¸€ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Request")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RequestFacade")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Request")]),s._v(" request "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSession")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" create"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("å› æ­¤æˆ‘ä»¬æ‹¿åˆ°çš„ Request ç±»å…¶å®æ˜¯ "),t("strong",[s._v("RequestFacade")]),s._v(", RequestFacade çš„ getSession() æ–¹æ³•è°ƒç”¨çš„æ˜¯ Request ç±»çš„ getSession() æ–¹æ³•, ç»§ç»­æ¥çœ‹ Session å…·ä½“æ˜¯å¦‚ä½•åˆ›å»ºçš„:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Manager")]),s._v(" manager "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("manager "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \nsession "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" manager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sessionId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsession"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("access")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡º, Request å¯¹è±¡ä¸­æŒæœ‰ Context å®¹å™¨å¯¹è±¡, è€Œ Context å®¹å™¨æŒæœ‰ Session ç®¡ç†å™¨ Manager, è¿™æ ·é€šè¿‡ Context ç»„ä»¶å°±èƒ½æ‹¿åˆ° Manager ç»„ä»¶, æœ€åç”± Manager ç»„ä»¶æ¥åˆ›å»º Session.")]),s._v(" "),t("p",[s._v("å› æ­¤æœ€åè¿˜æ˜¯åˆ°äº† "),t("strong",[s._v("StandardManager")]),s._v(", StandardManager çš„çˆ¶ç±»å« ManagerBase, è¿™ä¸ª createSession æ–¹æ³•å®šä¹‰åœ¨ ManagerBase ä¸­, StandardManager ç›´æ¥é‡ç”¨è¿™ä¸ªæ–¹æ³•.")]),s._v(" "),t("p",[s._v("æ¥ç€æ¥çœ‹ ManagerBase çš„ createSession() æ˜¯å¦‚ä½•å®ç°çš„:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" sessionId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¦–å…ˆåˆ¤æ–­ Session æ•°é‡æ˜¯ä¸æ˜¯åˆ°äº†æœ€å¤§å€¼, æœ€å¤§ Session æ•°å¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxActiveSessions "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getActiveSessions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" maxActiveSessions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        rejectedSessions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TooManyActiveSessionsException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                sm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"managerBase.createSession.ise"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                maxActiveSessions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡ç”¨æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ Session å¯¹è±¡, è¯·æ³¨æ„åœ¨ Tomcat ä¸­å°±æ˜¯ StandardSession")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®ƒæ˜¯ HttpSession çš„å…·ä½“å®ç°ç±», è€Œ HttpSession æ˜¯ Servlet è§„èŒƒä¸­å®šä¹‰çš„æ¥å£")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" session "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createEmptySession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆå§‹åŒ–æ–° Session çš„å€¼")]),s._v("\n    session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNew")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setValid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCreationTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentTimeMillis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxInactiveInterval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSessionTimeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sessionId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("generateSessionId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œä¼šå°† Session æ·»åŠ åˆ° ConcurrentHashMap ä¸­")]),s._v("\n    sessionCounter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†åˆ›å»ºæ—¶é—´æ·»åŠ åˆ° LinkedList ä¸­, å¹¶ä¸”æŠŠæœ€å…ˆæ·»åŠ çš„æ—¶é—´ç§»é™¤")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸»è¦è¿˜æ˜¯æ–¹ä¾¿æ¸…ç†è¿‡æœŸ Session")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SessionTiming")]),s._v(" timing "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SessionTiming")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCreationTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sessionCreationTiming"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sessionCreationTiming"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timing"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sessionCreationTiming"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" session\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("p",[s._v("åˆ°æ­¤æ˜ç™½äº† Session æ˜¯å¦‚ä½•åˆ›å»ºå‡ºæ¥çš„, åˆ›å»ºå‡ºæ¥å Session ä¼šè¢«ä¿å­˜åˆ°ä¸€ä¸ª "),t("strong",[s._v("ConcurrentHashMap")]),s._v(" ä¸­:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" sessions "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¯·æ³¨æ„ Session çš„å…·ä½“å®ç°ç±»æ˜¯ "),t("strong",[s._v("StandardSession")]),s._v(", StandardSession åŒæ—¶å®ç°äº† "),t("code",[s._v("javax.servlet.http.HttpSession")]),s._v("â€‹å’Œ"),t("code",[s._v("org.apache.catalina.Session")]),s._v("â€‹ æ¥å£, å¹¶ä¸”å¯¹ç¨‹åºå‘˜æš´éœ²çš„æ˜¯ StandardSessionFacade å¤–è§‚ç±», ä¿è¯äº† StandardSession çš„å®‰å…¨, é¿å…äº†ç¨‹åºå‘˜è°ƒç”¨å…¶å†…éƒ¨æ–¹æ³•è¿›è¡Œä¸å½“æ“ä½œ. StandardSession çš„æ ¸å¿ƒæˆå‘˜å˜é‡å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StandardSession")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Serializable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" attributes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" creationTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transient")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" expiring "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transient")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StandardSessionFacade")]),s._v(" facade "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" lastAccessedTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" creationTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transient")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SessionListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" listeners "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transient")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Manager")]),s._v(" manager "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxInactiveInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" isNew "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" isValid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transient")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" notes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Hashtable")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transient")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Principal")]),s._v(" principal "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h5",{attrs:{id:"sessionçš„æ¸…ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sessionçš„æ¸…ç†"}},[s._v("#")]),s._v(" Sessionçš„æ¸…ç†")]),s._v(" "),t("p",[s._v("å†æ¥çœ‹çœ‹ Tomcat æ˜¯å¦‚ä½•æ¸…ç†è¿‡æœŸçš„ Session. åœ¨ Tomcat çƒ­åŠ è½½ä¸çƒ­éƒ¨ç½²éƒ¨åˆ†è®²åˆ°å®¹å™¨ç»„ä»¶ä¼šå¼€å¯ä¸€ä¸ª ContainerBackgroundProcessor åå°çº¿ç¨‹, è°ƒç”¨è‡ªå·±ä»¥åŠå­å®¹å™¨çš„ backgroundProcess è¿›è¡Œä¸€äº›åå°é€»è¾‘çš„å¤„ç†, å’Œ Lifecycle ä¸€æ ·, è¿™ä¸ªåŠ¨ä½œä¹Ÿæ˜¯å…·æœ‰ä¼ é€’æ€§çš„, ä¹Ÿå°±æ˜¯è¯´å­å®¹å™¨è¿˜ä¼šæŠŠè¿™ä¸ªåŠ¨ä½œä¼ é€’ç»™è‡ªå·±çš„å­å®¹å™¨. å¯ä»¥å‚è€ƒä¸‹å›¾æ¥ç†è§£è¿™ä¸ªè¿‡ç¨‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162152-2ymjieo.jpg",alt:""}})]),s._v(" "),t("p",[s._v("å…¶ä¸­çˆ¶å®¹å™¨ä¼šéå†æ‰€æœ‰çš„å­å®¹å™¨å¹¶è°ƒç”¨å…¶ backgroundProcess() æ–¹æ³•, è€Œ StandardContext é‡å†™äº†è¯¥æ–¹æ³•, å®ƒä¼šè°ƒç”¨ StandardManager çš„ backgroundProcess() è¿›è€Œå®Œæˆ Session çš„æ¸…ç†å·¥ä½œ, ä¸‹é¢æ˜¯ StandardManager çš„ backgroundProcess() æ–¹æ³•çš„ä»£ç :")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("backgroundProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// processExpiresFrequency é»˜è®¤å€¼ä¸º 6, è€Œ backgroundProcess é»˜è®¤æ¯éš” 10s è°ƒç”¨ä¸€æ¬¡, ä¹Ÿå°±æ˜¯è¯´é™¤äº†ä»»åŠ¡æ‰§è¡Œçš„è€—æ—¶, æ¯éš” 60s æ‰§è¡Œä¸€æ¬¡")]),s._v("\n    count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" processExpiresFrequency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é»˜è®¤æ¯éš” 60s æ‰§è¡Œä¸€æ¬¡ Session æ¸…ç†")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processExpires")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * å•çº¿ç¨‹å¤„ç†, ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processExpires")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–æ‰€æœ‰çš„ Session")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" sessions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findSessions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" expireHere "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" sessions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Session çš„è¿‡æœŸæ˜¯åœ¨ isValid() æ–¹æ³•é‡Œå¤„ç†çš„")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sessions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("sessions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isValid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expireHere"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[t("strong",[s._v("backgroundProcess() ç”± Tomcat åå°çº¿ç¨‹è°ƒç”¨")]),s._v(", é»˜è®¤æ˜¯æ¯éš” 10 ç§’è°ƒç”¨ä¸€æ¬¡, ä½†æ˜¯ Session çš„æ¸…ç†åŠ¨ä½œä¸èƒ½å¤ªé¢‘ç¹, å› ä¸ºéœ€è¦éå† Session åˆ—è¡¨, ä¼šè€—è´¹ CPU èµ„æº, æ‰€ä»¥åœ¨ backgroundProcess() æ–¹æ³•ä¸­åšäº†å–æ¨¡å¤„ç†, backgroundProcess() è°ƒç”¨ 6 æ¬¡, æ‰æ‰§è¡Œä¸€æ¬¡ Session æ¸…ç†, ä¹Ÿå°±æ˜¯è¯´ Session æ¸…ç†"),t("strong",[s._v("æ¯ 60 ç§’æ‰§è¡Œä¸€æ¬¡")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"sessionäº‹ä»¶é€šçŸ¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sessionäº‹ä»¶é€šçŸ¥"}},[s._v("#")]),s._v(" Sessionäº‹ä»¶é€šçŸ¥")]),s._v(" "),t("p",[s._v("æŒ‰ç…§ Servlet è§„èŒƒ, åœ¨ Session çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­, "),t("strong",[s._v("è¦å°†äº‹ä»¶é€šçŸ¥ç›‘å¬è€…")]),s._v(", Servlet è§„èŒƒå®šä¹‰äº† Session çš„ç›‘å¬å™¨æ¥å£:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSessionListener")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventListener")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Session åˆ›å»ºæ—¶è°ƒç”¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sessionCreated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSessionEvent")]),s._v(" se"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Session é”€æ¯æ—¶è°ƒç”¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sessionDestroyed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSessionEvent")]),s._v(" se"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("æ³¨æ„åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ HttpSessionEvent, æ‰€ä»¥ Tomcat éœ€è¦å…ˆåˆ›å»º HttpSessionEvent å¯¹è±¡, ç„¶åéå† Context å†…éƒ¨çš„ LifecycleListener, å¹¶ä¸”åˆ¤æ–­æ˜¯å¦ä¸º HttpSessionListener å®ä¾‹, å¦‚æœæ˜¯çš„è¯åˆ™è°ƒç”¨ HttpSessionListener çš„ sessionCreated() æ–¹æ³•è¿›è¡Œäº‹ä»¶é€šçŸ¥. è¿™äº›äº‹æƒ…éƒ½æ˜¯åœ¨ Session çš„ setId() æ–¹æ³•ä¸­å®Œæˆçš„:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" notify"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœè¿™ä¸ª id å·²ç»å­˜åœ¨, å…ˆä» Manager ä¸­åˆ é™¤")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("manager "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        manager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ·»åŠ æ–°çš„ Session")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("manager "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        manager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œé¢å®Œæˆäº† HttpSessionListener äº‹ä»¶é€šçŸ¥")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("notify"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tellNew")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("ä»ä»£ç çœ‹åˆ° setId() æ–¹æ³•è°ƒç”¨äº† tellNew() æ–¹æ³•, é‚£ tellNew() åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢?")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tellNew")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é€šçŸ¥ org.apache.catalina.SessionListener")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fireSessionEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SESSION_CREATED_EVENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å– Context å†…éƒ¨çš„ LifecycleListener å¹¶åˆ¤æ–­æ˜¯å¦ä¸º HttpSessionListener")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" manager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" listeners"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getApplicationLifecycleListeners")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listeners "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" listeners"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»º HttpSessionEvent")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSessionEvent")]),s._v(" event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSessionEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" listeners"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­æ˜¯å¦æ˜¯ HttpSessionListener")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listeners"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSessionListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          \n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSessionListener")]),s._v(" listener "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSessionListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" listeners"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ³¨æ„è¿™æ˜¯å®¹å™¨å†…éƒ¨äº‹ä»¶")]),s._v("\n            context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fireContainerEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"beforeSessionCreated"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" listener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è§¦å‘ Session Created äº‹ä»¶")]),s._v("\n            listener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sessionCreated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ³¨æ„è¿™ä¹Ÿæ˜¯å®¹å™¨å†…éƒ¨äº‹ä»¶")]),s._v("\n            context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fireContainerEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"afterSessionCreated"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" listener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      \n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("ä¸Šé¢ä»£ç çš„é€»è¾‘æ˜¯, å…ˆé€šè¿‡ StandardContext å°† HttpSessionListener ç±»å‹çš„ Listener å–å‡º, ç„¶åä¾æ¬¡è°ƒç”¨å®ƒä»¬çš„ sessionCreated() æ–¹æ³•.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-15"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-15"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("è¿™é‡Œä» Request è°ˆåˆ°äº† Session çš„åˆ›å»º, é”€æ¯å’Œäº‹ä»¶é€šçŸ¥, é‡Œé¢æ¶‰åŠä¸å°‘ç›¸å…³çš„ç±», ä¸‹å›¾æ˜¯è¿™äº›ç±»çš„å…³ç³»:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162152-33c5ovy.jpg",alt:""}})]),s._v(" "),t("p",[s._v("Servlet è§„èŒƒä¸­å®šä¹‰äº† HttpServletRequest å’Œ HttpSession æ¥å£, Tomcat å®ç°äº†è¿™äº›æ¥å£, ä½†å…·ä½“å®ç°ç»†èŠ‚å¹¶æ²¡æœ‰æš´éœ²ç»™å¼€å‘è€…, å› æ­¤å®šä¹‰äº†"),t("strong",[s._v("ä¸¤ä¸ªåŒ…è£…ç±», RequestFacade å’Œ StandardSessionFacade")]),s._v(".")]),s._v(" "),t("p",[s._v("Tomcat æ˜¯é€šè¿‡ Manager æ¥ç®¡ç† Session çš„, é»˜è®¤å®ç°æ˜¯ StandardManager. StandardContext æŒæœ‰ StandardManager çš„å®ä¾‹, å¹¶å­˜æ”¾äº† HttpSessionListener é›†åˆ, Session åœ¨åˆ›å»ºå’Œé”€æ¯æ—¶, ä¼šé€šçŸ¥ç›‘å¬å™¨.")]),s._v(" "),t("h4",{attrs:{id:"_33-clusterç»„ä»¶-tomcatçš„é›†ç¾¤é€šä¿¡åŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_33-clusterç»„ä»¶-tomcatçš„é›†ç¾¤é€šä¿¡åŸç†"}},[s._v("#")]),s._v(" 33.Clusterç»„ä»¶:Tomcatçš„é›†ç¾¤é€šä¿¡åŸç†")]),s._v(" "),t("p",[s._v("ä¸ºäº†æ”¯æŒæ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨, Tomcat æä¾›äº†é›†ç¾¤éƒ¨ç½²çš„èƒ½åŠ›, ä½†ä¸æ­¤åŒæ—¶ä¹Ÿå¸¦æ¥äº†"),t("strong",[s._v("åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ä¸ªé€šç”¨é—®é¢˜")]),s._v(", é‚£å°±æ˜¯å¦‚ä½•åœ¨é›†ç¾¤ä¸­çš„"),t("strong",[s._v("å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§")]),s._v(", æ¯”å¦‚ä¼šè¯(Session)ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("è¦å®ç°è¿™ä¸€ç‚¹, åŸºæœ¬ä¸Šæœ‰ä¸¤ç§æ–¹å¼, ä¸€ç§æ˜¯æŠŠæ‰€æœ‰ Session æ•°æ®æ”¾åˆ°ä¸€å°æœåŠ¡å™¨æˆ–è€…ä¸€ä¸ªæ•°æ®åº“ä¸­, é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹é€šè¿‡è®¿é—®è¿™å° Session æœåŠ¡å™¨æ¥è·å–æ•°æ®. å¦ä¸€ç§æ–¹å¼å°±æ˜¯åœ¨é›†ç¾¤ä¸­çš„èŠ‚ç‚¹é—´è¿›è¡Œ Session æ•°æ®çš„åŒæ­¥æ‹·è´, è¿™é‡Œåˆåˆ†ä¸ºä¸¤ç§ç­–ç•¥: ç¬¬ä¸€ç§æ˜¯å°†ä¸€ä¸ªèŠ‚ç‚¹çš„ Session æ‹·è´åˆ°é›†ç¾¤ä¸­å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹; ç¬¬äºŒç§æ˜¯åªå°†ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ Session æ•°æ®æ‹·è´åˆ°å¦ä¸€ä¸ªå¤‡ä»½èŠ‚ç‚¹.")]),s._v(" "),t("p",[t("strong",[s._v("å¯¹äº Tomcat çš„ Session ç®¡ç†æ¥è¯´, è¿™ä¸¤ç§æ–¹å¼éƒ½æ”¯æŒ")]),s._v(". è¿™é‡Œå°±æ¥çœ‹çœ‹ç¬¬äºŒç§æ–¹å¼çš„å®ç°åŸç†, ä¹Ÿå°±æ˜¯ "),t("strong",[s._v("Tomcat é›†ç¾¤é€šä¿¡")]),s._v("çš„åŸç†å’Œé…ç½®æ–¹æ³•, æœ€åé€šè¿‡å®˜ç½‘ä¸Šçš„ä¸€ä¸ªä¾‹å­æ¥äº†è§£ä¸‹ Tomcat é›†ç¾¤åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„.")]),s._v(" "),t("h5",{attrs:{id:"é›†ç¾¤é€šä¿¡åŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é›†ç¾¤é€šä¿¡åŸç†"}},[s._v("#")]),s._v(" é›†ç¾¤é€šä¿¡åŸç†")]),s._v(" "),t("p",[s._v("è¦å®ç°é›†ç¾¤é€šä¿¡, é¦–å…ˆè¦çŸ¥é“é›†ç¾¤ä¸­éƒ½æœ‰å“ªäº›æˆå‘˜. Tomcat æ˜¯é€šè¿‡"),t("strong",[s._v("ç»„æ’­")]),s._v('(Multicast)æ¥å®ç°çš„. é‚£ä»€ä¹ˆæ˜¯ç»„æ’­å‘¢? ä¸ºäº†ç†è§£ç»„æ’­, å…ˆæ¥è¯´è¯´ä»€ä¹ˆæ˜¯"å•æ’­". ç½‘ç»œèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å°±å¥½åƒæ˜¯äººä»¬ä¹‹é—´çš„å¯¹è¯ä¸€æ ·, ä¸€ä¸ªäººå¯¹å¦å¤–ä¸€ä¸ªäººè¯´è¯, æ­¤æ—¶ä¿¡æ¯çš„æ¥æ”¶å’Œä¼ é€’åªåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œ, æ¯”å¦‚ä½ åœ¨æ”¶å‘ç”µå­é‚®ä»¶, æµè§ˆç½‘é¡µæ—¶, ä½¿ç”¨çš„å°±æ˜¯å•æ’­, ä¹Ÿå°±æ˜¯ "ç‚¹å¯¹ç‚¹é€šä¿¡".')]),s._v(" "),t("p",[s._v("å¦‚æœä¸€å°ä¸»æœºéœ€è¦å°†åŒä¸€ä¸ªæ¶ˆæ¯å‘é€å¤šä¸ªä¸»æœºé€ä¸ªä¼ è¾“, æ•ˆç‡å°±ä¼šæ¯”è¾ƒä½, äºæ˜¯å°±å‡ºç°ç»„æ’­æŠ€æœ¯. ç»„æ’­æ˜¯"),t("strong",[s._v("ä¸€å°ä¸»æœºå‘æŒ‡å®šçš„ä¸€ç»„ä¸»æœºå‘é€æ•°æ®æŠ¥åŒ…")]),s._v(", ç»„æ’­é€šä¿¡çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„: æ¯ä¸€ä¸ª Tomcat èŠ‚ç‚¹åœ¨å¯åŠ¨æ—¶å’Œè¿è¡Œæ—¶éƒ½ä¼šå‘¨æœŸæ€§(é»˜è®¤ 500 æ¯«ç§’)å‘é€ç»„æ’­å¿ƒè·³åŒ…, åŒä¸€ä¸ªé›†ç¾¤å†…çš„èŠ‚ç‚¹éƒ½åœ¨ç›¸åŒçš„"),t("strong",[s._v("ç»„æ’­åœ°å€")]),s._v("å’Œ"),t("strong",[s._v("ç«¯å£")]),s._v("ç›‘å¬è¿™äº›ä¿¡æ¯; åœ¨ä¸€å®šçš„æ—¶é—´å†…(é»˜è®¤ 3 ç§’)ä¸å‘é€"),t("strong",[s._v("ç»„æ’­æŠ¥æ–‡")]),s._v("çš„èŠ‚ç‚¹å°±ä¼šè¢«è®¤ä¸ºå·²ç»å´©æºƒäº†, ä¼šä»é›†ç¾¤ä¸­åˆ å». å› æ­¤é€šè¿‡ç»„æ’­, é›†ç¾¤ä¸­æ¯ä¸ªæˆå‘˜éƒ½èƒ½ç»´æŠ¤ä¸€ä¸ªé›†ç¾¤æˆå‘˜åˆ—è¡¨.")]),s._v(" "),t("h5",{attrs:{id:"é›†ç¾¤é€šä¿¡é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é›†ç¾¤é€šä¿¡é…ç½®"}},[s._v("#")]),s._v(" é›†ç¾¤é€šä¿¡é…ç½®")]),s._v(" "),t("p",[s._v("æœ‰äº†é›†ç¾¤æˆå‘˜çš„åˆ—è¡¨, é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å°±èƒ½é€šè¿‡ "),t("strong",[s._v("TCP")]),s._v(" è¿æ¥å‘å…¶ä»–èŠ‚ç‚¹ä¼ è¾“ Session æ•°æ®. Tomcat é€šè¿‡ SimpleTcpCluster ç±»æ¥è¿›è¡Œ"),t("strong",[s._v("ä¼šè¯å¤åˆ¶")]),s._v("(In-Memory Replication). è¦å¼€å¯é›†ç¾¤åŠŸèƒ½, åªéœ€è¦å°† "),t("code",[s._v("server.xml")]),s._v("â€‹ é‡Œçš„è¿™ä¸€è¡Œçš„æ³¨é‡Šå»æ‰å°±è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!-- \n<Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster"/>\n--\x3e')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å˜æˆè¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Cluster")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.tcp.SimpleTcpCluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è™½ç„¶åªæ˜¯ç®€å•çš„ä¸€è¡Œé…ç½®, ä½†è¿™ä¸€è¡Œé…ç½®ç­‰åŒäºä¸‹é¢è¿™æ ·çš„é…ç½®, ä¹Ÿå°±æ˜¯è¯´ Tomcat ç»™æˆ‘ä»¬è®¾ç½®äº†å¾ˆå¤šé»˜è®¤å‚æ•°, è¿™äº›å‚æ•°éƒ½è·Ÿé›†ç¾¤é€šä¿¡æœ‰å…³.")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!-- \n  SimpleTcpCluster æ˜¯ç”¨æ¥å¤åˆ¶ Session çš„ç»„ä»¶. å¤åˆ¶ Session æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼: \n  åŒæ­¥æ¨¡å¼ä¸‹, å‘æµè§ˆå™¨çš„å‘é€å“åº”æ•°æ®å‰, éœ€è¦å…ˆå°† Session æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹å®Œ; \n  å¼‚æ­¥æ¨¡å¼ä¸‹, æ— éœ€ç­‰å¾… Session æ‹·è´å®Œæˆå°±å¯å“åº”. å¼‚æ­¥æ¨¡å¼æ›´é«˜æ•ˆ, ä½†æ˜¯åŒæ­¥æ¨¡å¼\n  å¯é æ€§æ›´é«˜. \n  åŒæ­¥å¼‚æ­¥æ¨¡å¼ç”± channelSendOptions å‚æ•°æ§åˆ¶, é»˜è®¤å€¼æ˜¯ 8, ä¸ºå¼‚æ­¥æ¨¡å¼; 4 æ˜¯åŒæ­¥æ¨¡å¼. \n  åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹, å¯ä»¥é€šè¿‡åŠ ä¸Š " æ‹·è´ç¡®è®¤ "(Acknowledge)æ¥æé«˜å¯é æ€§, æ­¤æ—¶\n  channelSendOptions è®¾ä¸º 10\n--\x3e')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Cluster")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.tcp.SimpleTcpCluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("channelSendOptions")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n    Manager å†³å®šå¦‚ä½•ç®¡ç†é›†ç¾¤çš„ Session ä¿¡æ¯. \n    Tomcat æä¾›äº†ä¸¤ç§ Manager: BackupManager å’Œ DeltaManager. \n    BackupManagerï¼é›†ç¾¤ä¸‹çš„æŸä¸€èŠ‚ç‚¹çš„ Session, å°†å¤åˆ¶åˆ°ä¸€ä¸ªå¤‡ä»½èŠ‚ç‚¹. \n    DeltaManagerï¼ é›†ç¾¤ä¸‹æŸä¸€èŠ‚ç‚¹çš„ Session, å°†å¤åˆ¶åˆ°æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹. \n    DeltaManager æ˜¯ Tomcat é»˜è®¤çš„é›†ç¾¤ Manager. \n  \n    expireSessionsOnShutdownï¼è®¾ç½®ä¸º true æ—¶, ä¸€ä¸ªèŠ‚ç‚¹å…³é—­æ—¶, \n    å°†å¯¼è‡´é›†ç¾¤ä¸‹çš„æ‰€æœ‰ Session å¤±æ•ˆ\n    notifyListenersOnReplicationï¼é›†ç¾¤ä¸‹èŠ‚ç‚¹é—´çš„ Session å¤åˆ¶, \n    åˆ é™¤æ“ä½œ, æ˜¯å¦é€šçŸ¥ session listeners\n  \n    maxInactiveIntervalï¼é›†ç¾¤ä¸‹ Session çš„æœ‰æ•ˆæ—¶é—´ (å•ä½:s). \n    maxInactiveInterval å†…æœªæ´»åŠ¨çš„ Session, å°†è¢« Tomcat å›æ”¶. \n    é»˜è®¤å€¼ä¸º 1800(30min)\n  --\x3e")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Manager")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.session.DeltaManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                   "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("expireSessionsOnShutdown")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                   "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("notifyListenersOnReplication")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n    Channel æ˜¯ Tomcat èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé€šè®¯çš„å·¥å…·. \n    Channel åŒ…æ‹¬ 5 ä¸ªç»„ä»¶: Membership, Receiver, Sender, \n    Transport, Interceptor\n   --\x3e")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.group.GroupChannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n      Membership ç»´æŠ¤é›†ç¾¤çš„å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨. å®ƒå¯ä»¥æ£€æŸ¥åˆ°æ–°å¢çš„èŠ‚ç‚¹, \n      ä¹Ÿå¯ä»¥æ£€æŸ¥æ²¡æœ‰å¿ƒè·³çš„èŠ‚ç‚¹\n      classNameï¼æŒ‡å®š Membership ä½¿ç”¨çš„ç±»\n      addressï¼ç»„æ’­åœ°å€\n      portï¼ç»„æ’­ç«¯å£\n      frequencyï¼å‘é€å¿ƒè·³ (å‘ç»„æ’­åœ°å€å‘é€ UDP æ•°æ®åŒ…) çš„æ—¶é—´é—´éš” (å•ä½:ms). \n      dropTimeï¼Membership åœ¨ dropTime(å•ä½:ms) å†…æœªæ”¶åˆ°æŸä¸€èŠ‚ç‚¹çš„å¿ƒè·³, \n      åˆ™å°†è¯¥èŠ‚ç‚¹ä»å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨åˆ é™¤. é»˜è®¤å€¼ä¸º 3000. \n     --\x3e")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Membership")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.membership.\n         McastService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("228.0.0.4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("45564"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("frequency")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("500"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dropTime")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("3000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n   \n     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n       Receiver ç”¨äºå„ä¸ªèŠ‚ç‚¹æ¥æ”¶å…¶ä»–èŠ‚ç‚¹å‘é€çš„æ•°æ®. \n       æ¥æ”¶å™¨åˆ†ä¸ºä¸¤ç§: BioReceiver(é˜»å¡å¼), NioReceiver(éé˜»å¡å¼)\n \n       classNameï¼æŒ‡å®š Receiver ä½¿ç”¨çš„ç±»\n       addressï¼æ¥æ”¶æ¶ˆæ¯çš„åœ°å€\n       portï¼æ¥æ”¶æ¶ˆæ¯çš„ç«¯å£\n       autoBindï¼ç«¯å£çš„å˜åŒ–åŒºé—´, å¦‚æœ port ä¸º 4000, autoBind ä¸º 100, \n                 æ¥æ”¶å™¨å°†åœ¨ 4000-4099 é—´å–ä¸€ä¸ªç«¯å£è¿›è¡Œç›‘å¬. \n       selectorTimeoutï¼NioReceiver å†… Selector è½®è¯¢çš„è¶…æ—¶æ—¶é—´\n       maxThreadsï¼çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°\n     --\x3e")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Receiver")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.transport.nio.\n         NioReceiver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("auto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("4000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("autoBind")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("100"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("selectorTimeout")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("5000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("maxThreads")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n         Sender ç”¨äºå‘å…¶ä»–èŠ‚ç‚¹å‘é€æ•°æ®, Sender å†…åµŒäº† Transport ç»„ä»¶, \n         Transport çœŸæ­£è´Ÿè´£å‘é€æ¶ˆæ¯. \n      --\x3e")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Sender")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.transport.\n          ReplicationTransmitter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n            Transport åˆ†ä¸ºä¸¤ç§: bio.PooledMultiSender(é˜»å¡å¼)\n            å’Œ nio.PooledParallelSender(éé˜»å¡å¼), PooledParallelSender\n            æ˜¯ä» tcp è¿æ¥æ± ä¸­è·å–è¿æ¥, å¯ä»¥å®ç°å¹¶è¡Œå‘é€, å³é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¯ä»¥\n            åŒæ—¶å‘å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹å‘é€æ•°æ®è€Œäº’ä¸å½±å“. \n           --\x3e")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Transport")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.\n          transport.nio.PooledParallelSender"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("   \n       "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Sender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n   \n       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n         Interceptor : Cluster çš„æ‹¦æˆªå™¨\n         TcpFailureDetectorï¼TcpFailureDetector å¯ä»¥æ‹¦æˆªåˆ°æŸä¸ªèŠ‚ç‚¹å…³é—­\n         çš„ä¿¡æ¯, å¹¶å°è¯•é€šè¿‡ TCP è¿æ¥åˆ°æ­¤èŠ‚ç‚¹, ä»¥ç¡®ä¿æ­¤èŠ‚ç‚¹çœŸæ­£å…³é—­, ä»è€Œæ›´æ–°é›†\n         ç¾¤å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨           \n        --\x3e")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Interceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.group.\n       interceptors.TcpFailureDetector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n   \n       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n         MessageDispatchInterceptorï¼æŸ¥çœ‹ Cluster ç»„ä»¶å‘é€æ¶ˆæ¯çš„\n         æ–¹å¼æ˜¯å¦è®¾ç½®ä¸º Channel.SEND_OPTIONS_ASYNCHRONOUS, å¦‚æœæ˜¯, \n         MessageDispatchInterceptor å…ˆå°†ç­‰å¾…å‘é€çš„æ¶ˆæ¯è¿›è¡Œæ’é˜Ÿ, \n         ç„¶åå°†æ’å¥½é˜Ÿçš„æ¶ˆæ¯è½¬ç»™ Sender. \n        --\x3e")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Interceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.group.\n       interceptors.MessageDispatchInterceptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n    Valve : Tomcat çš„æ‹¦æˆªå™¨, \n    ReplicationValveï¼åœ¨å¤„ç†è¯·æ±‚å‰åæ‰“æ—¥å¿—; è¿‡æ»¤ä¸æ¶‰åŠ Session å˜åŒ–çš„è¯·æ±‚.            \n    --\x3e")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Valve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.tcp.ReplicationValve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("filter")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Valve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.session.\n  JvmRouteBinderValve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n    Deployer ç”¨äºé›†ç¾¤çš„ farm åŠŸèƒ½, ç›‘æ§åº”ç”¨ä¸­æ–‡ä»¶çš„æ›´æ–°, ä»¥ä¿è¯é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹\n    åº”ç”¨çš„ä¸€è‡´æ€§, å¦‚æŸä¸ªç”¨æˆ·ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤ä¸­æŸä¸ªèŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºç›®å½•ä¸‹, Deployer\n    ä¼šç›‘æµ‹åˆ°è¿™ä¸€æ“ä½œå¹¶æŠŠæ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹ç›¸åŒåº”ç”¨çš„å¯¹åº”ç›®å½•ä¸‹ä»¥ä¿æŒ\n    æ‰€æœ‰åº”ç”¨çš„ä¸€è‡´, è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¼ºå¤§çš„åŠŸèƒ½. \n  --\x3e")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Deployer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.deploy.FarmWarDeployer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("tempDir")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/tmp/war-temp/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("deployDir")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/tmp/war-deploy/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("watchDir")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/tmp/war-listen/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("watchEnabled")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n    ClusterListener : ç›‘å¬å™¨, ç›‘å¬ Cluster ç»„ä»¶æ¥æ”¶çš„æ¶ˆæ¯\n    ä½¿ç”¨ DeltaManager æ—¶, Cluster æ¥æ”¶çš„ä¿¡æ¯é€šè¿‡ ClusterSessionListener\n    ä¼ é€’ç»™ DeltaManager, ä»è€Œæ›´æ–°è‡ªå·±çš„ Session åˆ—è¡¨. \n    --\x3e")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ClusterListener")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.session.\n  ClusterSessionListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br"),t("span",{staticClass:"line-number"},[s._v("131")]),t("br"),t("span",{staticClass:"line-number"},[s._v("132")]),t("br"),t("span",{staticClass:"line-number"},[s._v("133")]),t("br"),t("span",{staticClass:"line-number"},[s._v("134")]),t("br"),t("span",{staticClass:"line-number"},[s._v("135")]),t("br"),t("span",{staticClass:"line-number"},[s._v("136")]),t("br"),t("span",{staticClass:"line-number"},[s._v("137")]),t("br"),t("span",{staticClass:"line-number"},[s._v("138")]),t("br"),t("span",{staticClass:"line-number"},[s._v("139")]),t("br")])]),t("p",[s._v("ä»ä¸Šé¢çš„çš„å‚æ•°åˆ—è¡¨å¯ä»¥çœ‹åˆ°, é»˜è®¤æƒ…å†µä¸‹ Session ç®¡ç†ç»„ä»¶ DeltaManager ä¼šåœ¨èŠ‚ç‚¹ä¹‹é—´"),t("strong",[s._v("æ‹·è´ Session")]),s._v(", DeltaManager é‡‡ç”¨çš„ä¸€ç§ "),t("strong",[s._v("all-to-all")]),s._v(" çš„å·¥ä½œæ–¹å¼, "),t("strong",[s._v("å³é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¼šæŠŠ Session æ•°æ®å‘æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹æ‹·è´")]),s._v(", è€Œä¸ç®¡å…¶ä»–èŠ‚ç‚¹æ˜¯å¦éƒ¨ç½²äº†å½“å‰åº”ç”¨. å½“é›†ç¾¤èŠ‚ç‚¹æ•°æ¯”è¾ƒå°‘æ—¶, æ¯”å¦‚å°‘äº 4 ä¸ª, è¿™ç§ all-to-all çš„æ–¹å¼æ˜¯ä¸é”™çš„é€‰æ‹©; ä½†æ˜¯å½“é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°é‡æ¯”è¾ƒå¤šæ—¶, æ•°æ®æ‹·è´çš„å¼€é”€æˆæŒ‡æ•°çº§å¢é•¿, è¿™ç§æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ BackupManager, BackupManager åªå‘ä¸€ä¸ªå¤‡ä»½èŠ‚ç‚¹æ‹·è´æ•°æ®.")]),s._v(" "),t("p",[s._v("åœ¨å¤§ä½“äº†è§£äº† Tomcat é›†ç¾¤å®ç°æ¨¡å‹å, å°±å¯ä»¥å¯¹é›†ç¾¤ä½œå‡ºæ›´ä¼˜åŒ–çš„é…ç½®äº†. Tomcat æ¨èäº†ä¸€å¥—é…ç½®, ä½¿ç”¨äº†æ¯” DeltaManager æ›´é«˜æ•ˆçš„ BackupManager, å¹¶ä¸”é€šè¿‡ ReplicationValve è®¾ç½®äº†è¯·æ±‚è¿‡æ»¤.")]),s._v(" "),t("p",[s._v("è¿™é‡Œè¿˜è¯·æ³¨æ„åœ¨ä¸€å°æœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªèŠ‚ç‚¹æ—¶éœ€è¦ä¿®æ”¹ Receiver çš„ä¾¦å¬ç«¯å£, å¦å¤–ä¸ºäº†åœ¨èŠ‚ç‚¹é—´é«˜æ•ˆåœ°æ‹·è´æ•°æ®, æ‰€æœ‰ Tomcat èŠ‚ç‚¹æœ€å¥½é‡‡ç”¨ç›¸åŒçš„é…ç½®, å…·ä½“é…ç½®å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Cluster")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.tcp.SimpleTcpCluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("channelSendOptions")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Manager")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.session.BackupManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                   "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("expireSessionsOnShutdown")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                   "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("notifyListenersOnReplication")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                   "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mapSendOptions")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n   \n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.group.\n     GroupChannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n   \n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Membership")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.membership.\n     McastService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("228.0.0.4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("45564"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("frequency")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("500"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dropTime")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("3000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n   \n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Receiver")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.transport.nio.\n     NioReceiver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("auto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("5000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("selectorTimeout")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("100"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("maxThreads")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Sender")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.transport.\n     ReplicationTransmitter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Transport")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.transport.\n          nio.PooledParallelSender"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Sender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n   \n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Interceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.group.\n     interceptors.TcpFailureDetector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n   \n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Interceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.group.\n     interceptors.MessageDispatchInterceptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n   \n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Interceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.tribes.group.\n     interceptors.ThroughputInterceptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Valve")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.tcp.ReplicationValve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("filter")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v(".*\\.gif|.*\\.js|.*\\.jpeg|.*\\.jpg|.*\\.png|.*\\\n               .htm|.*\\.html|.*\\.css|.*\\.txt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Deployer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.deploy.FarmWarDeployer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("tempDir")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/tmp/war-temp/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("deployDir")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/tmp/war-deploy/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("watchDir")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/tmp/war-listen/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("watchEnabled")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ClusterListener")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.catalina.ha.session.\n    ClusterSessionListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("h5",{attrs:{id:"é›†ç¾¤å·¥ä½œè¿‡ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é›†ç¾¤å·¥ä½œè¿‡ç¨‹"}},[s._v("#")]),s._v(" é›†ç¾¤å·¥ä½œè¿‡ç¨‹")]),s._v(" "),t("p",[s._v("Tomcat çš„å®˜ç½‘ç»™å‡ºäº†ä¸€ä¸ªä¾‹å­, æ¥è¯´æ˜ Tomcat é›†ç¾¤æ¨¡å¼ä¸‹æ˜¯å¦‚ä½•å·¥ä½œçš„, ä»¥åŠ Tomcat é›†ç¾¤æ˜¯å¦‚ä½•å®ç°é«˜å¯ç”¨çš„. æ¯”å¦‚é›†ç¾¤ç”± Tomcat A å’Œ Tomcat B ä¸¤ä¸ª Tomcat å®ä¾‹ç»„æˆ, æŒ‰ç…§æ—¶é—´å…ˆåé¡ºåºå‘ç”Ÿäº†å¦‚ä¸‹äº‹ä»¶:")]),s._v(" "),t("p",[t("strong",[s._v("1. Tomcat A å¯åŠ¨")])]),s._v(" "),t("p",[s._v("Tomcat A å¯åŠ¨è¿‡ç¨‹ä¸­, å½“ Host å¯¹è±¡è¢«åˆ›å»ºæ—¶, ä¸€ä¸ª Cluster ç»„ä»¶(é»˜è®¤æ˜¯ SimpleTcpCluster)è¢«å…³è”åˆ°è¿™ä¸ª Host å¯¹è±¡. å½“æŸä¸ªåº”ç”¨åœ¨ "),t("code",[s._v("web.xml")]),s._v("â€‹ ä¸­è®¾ç½®äº† Distributable æ—¶, Tomcat å°†ä¸ºæ­¤åº”ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒåˆ›å»ºä¸€ä¸ª DeltaManager. SimpleTcpCluster å¯åŠ¨ Membership æœåŠ¡å’Œ Replication æœåŠ¡.")]),s._v(" "),t("p",[t("strong",[s._v("2. Tomcat B å¯åŠ¨(åœ¨ Tomcat A ä¹‹åå¯åŠ¨)")])]),s._v(" "),t("p",[s._v("é¦–å…ˆ Tomcat B ä¼šæ‰§è¡Œå’Œ Tomcat A ä¸€æ ·çš„æ“ä½œ, ç„¶å SimpleTcpCluster ä¼šå»ºç«‹ä¸€ä¸ªç”± Tomcat A å’Œ Tomcat B ç»„æˆçš„ Membership. æ¥ç€ Tomcat B å‘é›†ç¾¤ä¸­çš„ Tomcat A è¯·æ±‚ Session æ•°æ®, å¦‚æœ Tomcat A æ²¡æœ‰å“åº” Tomcat B çš„æ‹·è´è¯·æ±‚, Tomcat B ä¼šåœ¨ 60 ç§’å time out. åœ¨ Session æ•°æ®æ‹·è´å®Œæˆä¹‹å‰ Tomcat B ä¸ä¼šæ¥æ”¶æµè§ˆå™¨çš„è¯·æ±‚.")]),s._v(" "),t("p",[t("strong",[s._v("3. Tomcat A æ¥æ”¶ HTTP è¯·æ±‚, åˆ›å»º Session 1")])]),s._v(" "),t("p",[s._v("Tomcat A å“åº”å®¢æˆ·è¯·æ±‚, åœ¨æŠŠç»“æœå‘é€å›å®¢æˆ·ç«¯ä¹‹å‰, ReplicationValve ä¼šæ‹¦æˆªå½“å‰è¯·æ±‚(å¦‚æœ Filter ä¸­é…ç½®äº†ä¸éœ€æ‹¦æˆªçš„è¯·æ±‚ç±»å‹, è¿™ä¸€æ­¥å°±ä¸ä¼šè¿›è¡Œ, é»˜è®¤é…ç½®ä¸‹æ‹¦æˆªæ‰€æœ‰è¯·æ±‚), å¦‚æœå‘ç°å½“å‰è¯·æ±‚æ›´æ–°äº† Session, å°±è°ƒç”¨ Replication æœåŠ¡å»ºç«‹ TCP è¿æ¥å°† Session æ‹·è´åˆ° Membership åˆ—è¡¨ä¸­çš„å…¶ä»–èŠ‚ç‚¹å³ Tomcat B. åœ¨æ‹·è´æ—¶, æ‰€æœ‰ä¿å­˜åœ¨å½“å‰ Session ä¸­çš„å¯åºåˆ—åŒ–çš„å¯¹è±¡éƒ½ä¼šè¢«æ‹·è´, è€Œä¸ä»…ä»…æ˜¯å‘ç”Ÿæ›´æ–°çš„éƒ¨åˆ†.")]),s._v(" "),t("p",[t("strong",[s._v("4. Tomcat A å´©æºƒ")])]),s._v(" "),t("p",[s._v("å½“ Tomcat A å´©æºƒæ—¶, Tomcat B ä¼šè¢«å‘ŠçŸ¥ Tomcat A å·²ä»é›†ç¾¤ä¸­é€€å‡º, ç„¶å Tomcat B å°±ä¼šæŠŠ Tomcat A ä»è‡ªå·±çš„ Membership åˆ—è¡¨ä¸­åˆ é™¤. å¹¶ä¸” Tomcat B çš„ Session æ›´æ–°æ—¶ä¸å†å¾€ Tomcat A æ‹·è´, åŒæ—¶è´Ÿè½½å‡è¡¡å™¨ä¼šæŠŠåç»­çš„ HTTP è¯·æ±‚å…¨éƒ¨è½¬å‘ç»™ Tomcat B. åœ¨æ­¤è¿‡ç¨‹ä¸­æ‰€æœ‰çš„ Session æ•°æ®ä¸ä¼šä¸¢å¤±.")]),s._v(" "),t("p",[t("strong",[s._v("5. Tomcat B æ¥æ”¶ Tomcat A çš„è¯·æ±‚")])]),s._v(" "),t("p",[s._v("Tomcat B æ­£å¸¸å“åº”æœ¬åº”è¯¥å‘å¾€ Tomcat A çš„è¯·æ±‚, å› ä¸º Tomcat B ä¿å­˜äº† Tomcat A çš„æ‰€æœ‰ Session æ•°æ®.")]),s._v(" "),t("p",[t("strong",[s._v("6. Tomcat A é‡æ–°å¯åŠ¨")])]),s._v(" "),t("p",[s._v("Tomcat A æŒ‰æ­¥éª¤ 1, 2 æ“ä½œå¯åŠ¨, åŠ å…¥é›†ç¾¤, å¹¶ä» Tomcat B æ‹·è´æ‰€æœ‰ Session æ•°æ®, æ‹·è´å®Œæˆåå¼€å§‹æ¥æ”¶è¯·æ±‚.")]),s._v(" "),t("p",[t("strong",[s._v("7. Tomcat A æ¥æ”¶è¯·æ±‚, Session 1 è¢«ç”¨æˆ·æ³¨é”€")])]),s._v(" "),t("p",[s._v("Tomcat ç»§ç»­æ¥æ”¶å‘å¾€ Tomcat A çš„è¯·æ±‚, Session 1 è®¾ç½®ä¸ºå¤±æ•ˆ. è¯·æ³¨æ„è¿™é‡Œçš„å¤±æ•ˆå¹¶éå› ä¸º Tomcat A å¤„äºéæ´»åŠ¨çŠ¶æ€è¶…è¿‡è®¾ç½®çš„æ—¶é—´, è€Œæ˜¯åº”ç”¨ç¨‹åºæ‰§è¡Œäº†æ³¨é”€çš„æ“ä½œ(æ¯”å¦‚ç”¨æˆ·ç™»å‡º)è€Œå¼•èµ·çš„ Session å¤±æ•ˆ. è¿™æ—¶ Tomcat A å‘ Tomcat B å‘é€ä¸€ä¸ª Session 1 Expired çš„æ¶ˆæ¯, Tomcat B æ”¶åˆ°æ¶ˆæ¯åä¹Ÿä¼šæŠŠ Session 1 è®¾ç½®ä¸ºå¤±æ•ˆ.")]),s._v(" "),t("p",[t("strong",[s._v("8. Tomcat B æ¥æ”¶åˆ°ä¸€ä¸ªæ–°è¯·æ±‚, åˆ›å»º Session 2")])]),s._v(" "),t("p",[s._v("åŒç†è¿™ä¸ªæ–°çš„ Session ä¹Ÿä¼šè¢«æ‹·è´åˆ° Tomcat A.")]),s._v(" "),t("p",[t("strong",[s._v("9. Tomcat A ä¸Šçš„ Session 2 è¿‡æœŸ")])]),s._v(" "),t("p",[s._v("å› è¶…æ—¶åŸå› å¼•èµ·çš„ Session å¤±æ•ˆ Tomcat A æ— éœ€é€šçŸ¥ Tomcat B, Tomcat B åŒæ ·çŸ¥é“ Session 2 å·²ç»è¶…æ—¶. å› æ­¤å¯¹äº Tomcat é›†ç¾¤æœ‰ä¸€ç‚¹éå¸¸é‡è¦, "),t("strong",[s._v("æ‰€æœ‰èŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿæ—¶é—´å¿…é¡»ä¸€è‡´")]),s._v(". ä¸ç„¶ä¼šå‡ºç°æŸä¸ªèŠ‚ç‚¹ Session å·²è¿‡æœŸè€Œåœ¨å¦ä¸€èŠ‚ç‚¹æ­¤ Session ä»å¤„äºæ´»åŠ¨çŠ¶æ€çš„ç°è±¡.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-16"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-16"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("è¿™é‡Œåˆ†æäº† Tomcat çš„é›†ç¾¤å·¥ä½œåŸç†å’Œé…ç½®æ–¹å¼, è¿˜é€šè¿‡å®˜ç½‘ä¸Šçš„ä¸€ä¸ªä¾‹å­è¯´æ˜äº† Tomcat é›†ç¾¤çš„å·¥ä½œè¿‡ç¨‹. Tomcat é›†ç¾¤å¯¹ Session çš„æ‹·è´æ”¯æŒä¸¤ç§æ–¹å¼: DeltaManager å’Œ BackupManager.")]),s._v(" "),t("p",[s._v("å½“é›†ç¾¤ä¸­èŠ‚ç‚¹æ¯”è¾ƒå°‘æ—¶, å¯ä»¥é‡‡ç”¨ DeltaManager, å› ä¸º Session æ•°æ®åœ¨é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¤‡ä»½, ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹å´©æºƒéƒ½ä¸ä¼šå¯¹æ•´ä½“é€ æˆå½±å“, å¯é æ€§æ¯”è¾ƒé«˜.")]),s._v(" "),t("p",[s._v("å½“é›†ç¾¤ä¸­èŠ‚ç‚¹æ•°æ¯”è¾ƒå¤šæ—¶, å¯ä»¥é‡‡ç”¨ BackupManager, è¿™æ˜¯å› ä¸ºä¸€ä¸ªèŠ‚ç‚¹çš„ Session åªä¼šæ‹·è´åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹, æ•°æ®æ‹·è´çš„å¼€é”€æ¯”è¾ƒå°‘, åŒæ—¶åªè¦è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸åŒæ—¶å´©æºƒ, Session æ•°æ®å°±ä¸ä¼šä¸¢å¤±.")]),s._v(" "),t("h3",{attrs:{id:"æ€§èƒ½ä¼˜åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€§èƒ½ä¼˜åŒ–"}},[s._v("#")]),s._v(" æ€§èƒ½ä¼˜åŒ–")]),s._v(" "),t("h4",{attrs:{id:"_34-jvm-gcåŸç†åŠè°ƒä¼˜çš„åŸºæœ¬æ€è·¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_34-jvm-gcåŸç†åŠè°ƒä¼˜çš„åŸºæœ¬æ€è·¯"}},[s._v("#")]),s._v(" 34.JVM GCåŸç†åŠè°ƒä¼˜çš„åŸºæœ¬æ€è·¯")]),s._v(" "),t("p",[s._v("å’Œ Web åº”ç”¨ç¨‹åºä¸€æ ·, Tomcat ä½œä¸ºä¸€ä¸ª Java ç¨‹åºä¹Ÿè·‘åœ¨ JVM ä¸­, å› æ­¤å¦‚æœè¦å¯¹ Tomcat è¿›è¡Œè°ƒä¼˜, éœ€è¦å…ˆäº†è§£ JVM è°ƒä¼˜çš„åŸç†. è€Œå¯¹äº JVM è°ƒä¼˜æ¥è¯´, ä¸»è¦æ˜¯ JVM åƒåœ¾æ”¶é›†çš„ä¼˜åŒ–, ä¸€èˆ¬æ¥è¯´æ˜¯å› ä¸ºæœ‰é—®é¢˜æ‰éœ€è¦ä¼˜åŒ–, æ‰€ä»¥å¯¹äº JVM GC æ¥è¯´, å¦‚æœè§‚å¯Ÿåˆ° Tomcat è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡æ¯”è¾ƒé«˜, å¹¶ä¸”åœ¨ GC æ—¥å¿—ä¸­å‘ç° GC æ¬¡æ•°æ¯”è¾ƒé¢‘ç¹, GC åœé¡¿æ—¶é—´é•¿, è¿™è¡¨æ˜éœ€è¦å¯¹ GC è¿›è¡Œä¼˜åŒ–äº†.")]),s._v(" "),t("p",[s._v("åœ¨å¯¹ GC è°ƒä¼˜çš„è¿‡ç¨‹ä¸­, ä¸ä»…éœ€è¦çŸ¥é“ GC çš„åŸç†, æ›´é‡è¦çš„æ˜¯è¦ç†Ÿç»ƒä½¿ç”¨å„ç§ç›‘æ§å’Œåˆ†æå·¥å…·, å…·å¤‡ GC è°ƒä¼˜çš„å®æˆ˜èƒ½åŠ›. CMS å’Œ G1 æ˜¯æ—¶ä¸‹ä½¿ç”¨ç‡æ¯”è¾ƒé«˜çš„ä¸¤æ¬¾åƒåœ¾æ”¶é›†å™¨, ä» Java 9 å¼€å§‹, é‡‡ç”¨ G1 ä½œä¸ºé»˜è®¤åƒåœ¾æ”¶é›†å™¨, è€Œ G1 çš„ç›®æ ‡ä¹Ÿæ˜¯é€æ­¥å–ä»£ CMS.")]),s._v(" "),t("h5",{attrs:{id:"cms-vs-g1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cms-vs-g1"}},[s._v("#")]),s._v(" CMS vs G1")]),s._v(" "),t("p",[s._v("CMS æ”¶é›†å™¨å°† Java å †åˆ†ä¸º"),t("strong",[s._v("å¹´è½»ä»£")]),s._v("(Young)æˆ–"),t("strong",[s._v("å¹´è€ä»£")]),s._v("(Old). è¿™ä¸»è¦æ˜¯å› ä¸ºæœ‰ç ”ç©¶è¡¨æ˜, è¶…è¿‡ 90ï¼… çš„å¯¹è±¡åœ¨ç¬¬ä¸€æ¬¡ GC æ—¶å°±è¢«å›æ”¶æ‰, ä½†æ˜¯å°‘æ•°å¯¹è±¡å¾€å¾€ä¼šå­˜æ´»è¾ƒé•¿çš„æ—¶é—´.")]),s._v(" "),t("p",[s._v("CMS è¿˜å°†å¹´è½»ä»£å†…å­˜ç©ºé—´åˆ†ä¸º"),t("strong",[s._v("å¹¸å­˜è€…ç©ºé—´")]),s._v("(Survivor)å’Œ"),t("strong",[s._v("ä¼Šç”¸å›­ç©ºé—´")]),s._v("(Eden). æ–°çš„å¯¹è±¡å§‹ç»ˆåœ¨ Eden ç©ºé—´ä¸Šåˆ›å»º. ä¸€æ—¦ä¸€ä¸ªå¯¹è±¡åœ¨ä¸€æ¬¡åƒåœ¾æ”¶é›†åè¿˜å¹¸å­˜, å°±ä¼šè¢«ç§»åŠ¨åˆ°å¹¸å­˜è€…ç©ºé—´. å½“ä¸€ä¸ªå¯¹è±¡åœ¨å¤šæ¬¡åƒåœ¾æ”¶é›†ä¹‹åè¿˜å­˜æ´»æ—¶, å®ƒä¼šç§»åŠ¨åˆ°å¹´è€ä»£. è¿™æ ·åšçš„ç›®çš„æ˜¯åœ¨å¹´è½»ä»£å’Œå¹´è€ä»£é‡‡ç”¨ä¸åŒçš„æ”¶é›†ç®—æ³•, ä»¥è¾¾åˆ°è¾ƒé«˜çš„æ”¶é›†æ•ˆç‡, æ¯”å¦‚åœ¨å¹´è½»ä»£é‡‡ç”¨"),t("strong",[s._v("å¤åˆ¶-æ•´ç†ç®—æ³•")]),s._v(", åœ¨å¹´è€ä»£é‡‡ç”¨"),t("strong",[s._v("æ ‡è®°-æ¸…ç†ç®—æ³•")]),s._v(". å› æ­¤ CMS å°† Java å †åˆ†æˆå¦‚ä¸‹åŒºåŸŸ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162238-fon1zjr.png",alt:""}})]),s._v(" "),t("p",[s._v("ä¸ CMS ç›¸æ¯”, G1 æ”¶é›†å™¨æœ‰ä¸¤å¤§ç‰¹ç‚¹:")]),s._v(" "),t("ul",[t("li",[s._v('G1 å¯ä»¥å¹¶å‘å®Œæˆå¤§éƒ¨åˆ† GC çš„å·¥ä½œ, è¿™æœŸé—´ä¸ä¼š"Stop-The-World".')]),s._v(" "),t("li",[s._v("G1 ä½¿ç”¨"),t("strong",[s._v("éè¿ç»­ç©ºé—´")]),s._v(", è¿™ä½¿ G1 èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†éå¸¸å¤§çš„å †. æ­¤å¤–, G1 å¯ä»¥åŒæ—¶æ”¶é›†å¹´è½»ä»£å’Œå¹´è€ä»£. G1 å¹¶æ²¡æœ‰å°† Java å †åˆ†æˆä¸‰ä¸ªç©ºé—´(Eden, Survivor å’Œ Old), è€Œæ˜¯å°†å †åˆ†æˆè®¸å¤š(é€šå¸¸æ˜¯å‡ ç™¾ä¸ª)éå¸¸å°çš„åŒºåŸŸ. è¿™äº›åŒºåŸŸæ˜¯å›ºå®šå¤§å°çš„(é»˜è®¤æƒ…å†µä¸‹å¤§çº¦ä¸º 2MB). æ¯ä¸ªåŒºåŸŸéƒ½åˆ†é…ç»™ä¸€ä¸ªç©ºé—´.  G1 æ”¶é›†å™¨çš„ Java å †å¦‚ä¸‹å›¾æ‰€ç¤º:")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162238-efnv7sg.png",alt:""}})]),s._v(" "),t("p",[s._v('å›¾ä¸Šçš„ U è¡¨ç¤º "æœªåˆ†é…" åŒºåŸŸ. G1 å°†å †æ‹†åˆ†æˆå°çš„åŒºåŸŸ, ä¸€ä¸ªæœ€å¤§çš„å¥½å¤„æ˜¯å¯ä»¥åšå±€éƒ¨åŒºåŸŸçš„åƒåœ¾å›æ”¶, è€Œä¸éœ€è¦æ¯æ¬¡éƒ½å›æ”¶æ•´ä¸ªåŒºåŸŸæ¯”å¦‚å¹´è½»ä»£å’Œå¹´è€ä»£, è¿™æ ·å›æ”¶çš„åœé¡¿æ—¶é—´ä¼šæ¯”è¾ƒçŸ­. å…·ä½“çš„æ”¶é›†è¿‡ç¨‹æ˜¯:')]),s._v(" "),t("ul",[t("li",[s._v("å°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å°†ä»"),t("strong",[s._v("æ”¶é›†çš„åŒºåŸŸ")]),s._v("å¤åˆ¶åˆ°"),t("strong",[s._v("æœªåˆ†é…çš„åŒºåŸŸ")]),s._v(', æ¯”å¦‚æ”¶é›†çš„åŒºåŸŸæ˜¯ Eden ç©ºé—´, æŠŠ Eden ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æœªåˆ†é…åŒºåŸŸ, è¿™ä¸ªæœªåˆ†é…åŒºåŸŸå°±æˆäº† Survivor ç©ºé—´. ç†æƒ³æƒ…å†µä¸‹, å¦‚æœä¸€ä¸ªåŒºåŸŸå…¨æ˜¯åƒåœ¾(æ„å‘³ç€ä¸€ä¸ªå­˜æ´»çš„å¯¹è±¡éƒ½æ²¡æœ‰), åˆ™å¯ä»¥ç›´æ¥å°†è¯¥åŒºåŸŸå£°æ˜ä¸º "æœªåˆ†é…".')]),s._v(" "),t("li",[s._v("ä¸ºäº†ä¼˜åŒ–æ”¶é›†æ—¶é—´, G1 æ€»æ˜¯ä¼˜å…ˆé€‰æ‹©åƒåœ¾æœ€å¤šçš„åŒºåŸŸ, ä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘åç»­åˆ†é…å’Œé‡Šæ”¾å †ç©ºé—´æ‰€éœ€çš„å·¥ä½œé‡. è¿™ä¹Ÿæ˜¯ G1 æ”¶é›†å™¨åå­—çš„ç”±æ¥---Garbage-First.")])]),s._v(" "),t("h5",{attrs:{id:"gcè°ƒä¼˜åŸåˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gcè°ƒä¼˜åŸåˆ™"}},[s._v("#")]),s._v(" GCè°ƒä¼˜åŸåˆ™")]),s._v(" "),t("p",[s._v("GC æ˜¯æœ‰ä»£ä»·çš„, å› æ­¤è°ƒä¼˜çš„æ ¹æœ¬åŸåˆ™æ˜¯"),t("strong",[s._v("æ¯ä¸€æ¬¡ GC éƒ½å›æ”¶å°½å¯èƒ½å¤šçš„å¯¹è±¡")]),s._v(", ä¹Ÿå°±æ˜¯å‡å°‘æ— ç”¨åŠŸ. å› æ­¤åœ¨åšå…·ä½“è°ƒä¼˜çš„æ—¶å€™, é’ˆå¯¹ CMS å’Œ G1 ä¸¤ç§åƒåœ¾æ”¶é›†å™¨, åˆ†åˆ«æœ‰ä¸€äº›ç›¸åº”çš„ç­–ç•¥.")]),s._v(" "),t("p",[t("strong",[s._v("CMSæ”¶é›†å™¨")])]),s._v(" "),t("p",[s._v("å¯¹äº CMS æ”¶é›†å™¨æ¥è¯´, æœ€é‡è¦çš„æ˜¯"),t("strong",[s._v("åˆç†åœ°è®¾ç½®å¹´è½»ä»£å’Œå¹´è€ä»£çš„å¤§å°")]),s._v(". å¹´è½»ä»£å¤ªå°çš„è¯, ä¼šå¯¼è‡´é¢‘ç¹çš„ Minor GC, å¹¶ä¸”å¾ˆæœ‰å¯èƒ½å­˜æ´»æœŸçŸ­çš„å¯¹è±¡ä¹Ÿä¸èƒ½è¢«å›æ”¶, GC çš„æ•ˆç‡å°±ä¸é«˜. è€Œå¹´è€ä»£å¤ªå°çš„è¯, å®¹çº³ä¸ä¸‹ä»å¹´è½»ä»£è¿‡æ¥çš„æ–°å¯¹è±¡, ä¼šé¢‘ç¹è§¦å‘å•çº¿ç¨‹ Full GC, å¯¼è‡´è¾ƒé•¿æ—¶é—´çš„ GC æš‚åœ, å½±å“ Web åº”ç”¨çš„å“åº”æ—¶é—´.")]),s._v(" "),t("p",[t("strong",[s._v("G1æ”¶é›†å™¨")])]),s._v(" "),t("p",[s._v("å¯¹äº G1 æ”¶é›†å™¨æ¥è¯´, ä¸æ¨èç›´æ¥è®¾ç½®å¹´è½»ä»£çš„å¤§å°, è¿™ä¸€ç‚¹è·Ÿ CMS æ”¶é›†å™¨ä¸ä¸€æ ·, è¿™æ˜¯å› ä¸º G1 æ”¶é›†å™¨ä¼šæ ¹æ®ç®—æ³•åŠ¨æ€å†³å®šå¹´è½»ä»£å’Œå¹´è€ä»£çš„å¤§å°. å› æ­¤å¯¹äº G1 æ”¶é›†å™¨, éœ€è¦å…³å¿ƒçš„æ˜¯ "),t("strong",[s._v("Java å †çš„æ€»å¤§å°")]),s._v("("),t("code",[s._v("-Xmx")]),s._v("â€‹).")]),s._v(" "),t("p",[s._v("æ­¤å¤– G1 è¿˜æœ‰ä¸€ä¸ªè¾ƒå…³é”®çš„å‚æ•°æ˜¯ "),t("code",[s._v("-XX:MaxGCPauseMillis = n")]),s._v("â€‹, è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥é™åˆ¶æœ€å¤§çš„ GC æš‚åœæ—¶é—´, ç›®çš„æ˜¯å°½é‡ä¸å½±å“è¯·æ±‚å¤„ç†çš„å“åº”æ—¶é—´. G1 å°†æ ¹æ®å…ˆå‰æ”¶é›†çš„ä¿¡æ¯ä»¥åŠæ£€æµ‹åˆ°çš„åƒåœ¾é‡, ä¼°è®¡å®ƒå¯ä»¥ç«‹å³æ”¶é›†çš„æœ€å¤§åŒºåŸŸæ•°é‡, ä»è€Œå°½é‡ä¿è¯ GC æ—¶é—´ä¸ä¼šè¶…å‡ºè¿™ä¸ªé™åˆ¶. å› æ­¤ G1 ç›¸å¯¹æ¥è¯´æ›´åŠ æ™ºèƒ½, ä½¿ç”¨èµ·æ¥æ›´åŠ ç®€å•.")]),s._v(" "),t("h5",{attrs:{id:"å†…å­˜è°ƒä¼˜å®æˆ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜è°ƒä¼˜å®æˆ˜"}},[s._v("#")]),s._v(" å†…å­˜è°ƒä¼˜å®æˆ˜")]),s._v(" "),t("p",[s._v("ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­å®æˆ˜ä¸€ä¸‹ Java å †è®¾ç½®å¾—è¿‡å°, å¯¼è‡´é¢‘ç¹çš„ GC, ä¸‹é¢é€šè¿‡ GC æ—¥å¿—åˆ†æå·¥å…·æ¥è§‚å¯Ÿ GC æ´»åŠ¨å¹¶å®šä½é—®é¢˜.")]),s._v(" "),t("ol",[t("li",[s._v("é¦–å…ˆå»ºç«‹ä¸€ä¸ª Spring Boot ç¨‹åº, ä½œä¸ºè°ƒä¼˜å¯¹è±¡, ä»£ç å¦‚ä¸‹:")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GcTestController")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Queue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Greeting")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" objCache "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentLinkedDeque")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/greeting"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Greeting")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("greeting")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Greeting")]),s._v(" greeting "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Greeting")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("objCache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            objCache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("clear")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            objCache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("greeting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" greeting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Data")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@AllArgsConstructor")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Greeting")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä»£ç å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡æ± , å½“å¯¹è±¡æ± ä¸­çš„å¯¹è±¡æ•°åˆ°è¾¾ 200000 æ—¶æ‰æ¸…ç©ºä¸€æ¬¡, ç”¨æ¥æ¨¡æ‹Ÿå¹´è€ä»£å¯¹è±¡.")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨æµ‹è¯•ç¨‹åº:")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("java -Xmx32m -Xss256k -verbosegc -Xlog:gc*,gc+ref=debug,gc+heap=debug,gc+age=trace:file=gc-%p-%t.log:tags,uptime,time,level:filecount=2,filesize=100m -jar target/demo-0.0.1-SNAPSHOT.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç»™ç¨‹åºè®¾ç½®çš„å †çš„å¤§å°ä¸º 32MB, ç›®çš„æ˜¯èƒ½çœ‹åˆ° Full GC. é™¤æ­¤ä¹‹å¤–, è¿˜æ‰“å¼€äº† verbosegc æ—¥å¿—, æ³¨æ„è¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ Java 12, é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨æ˜¯ G1.")]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("ä½¿ç”¨ JMeter å‹æµ‹å·¥å…·å‘ç¨‹åºå‘é€æµ‹è¯•è¯·æ±‚, è®¿é—®çš„è·¯å¾„æ˜¯ "),t("code",[s._v("/greeting")]),s._v("â€‹.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162238-68cyxrn.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[s._v("ä½¿ç”¨ GCViewer å·¥å…·æ‰“å¼€ GC æ—¥å¿—, å¯ä»¥çœ‹åˆ°è¿™æ ·çš„å›¾:")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162238-xb85yys.png",alt:""}})]),s._v(" "),t("p",[s._v("è§£é‡Šä¸€ä¸‹è¿™å¼ å›¾:")]),s._v(" "),t("ul",[t("li",[s._v("å›¾ä¸­ä¸Šéƒ¨çš„è“çº¿è¡¨ç¤ºå·²ä½¿ç”¨å †çš„å¤§å°, å¯ä»¥çœ‹åˆ°å®ƒå‘¨æœŸçš„ä¸Šä¸‹éœ‡è¡, è¿™æ˜¯å¯¹è±¡æ± è¦æ‰©å±•åˆ° 200000 æ‰ä¼šæ¸…ç©º.")]),s._v(" "),t("li",[s._v("å›¾åº•éƒ¨çš„ç»¿çº¿è¡¨ç¤ºå¹´è½»ä»£ GC æ´»åŠ¨, ä»å›¾ä¸Šçœ‹åˆ°å½“å †çš„ä½¿ç”¨ç‡ä¸Šå»äº†, ä¼šè§¦å‘é¢‘ç¹çš„ GC æ´»åŠ¨.")]),s._v(" "),t("li",[s._v("å›¾ä¸­çš„ç«–çº¿è¡¨ç¤º Full GC, ä»å›¾ä¸Šçœ‹åˆ°, ä¼´éšç€ Full GC, è“çº¿ä¼šä¸‹é™, è¿™è¯´æ˜ Full GC æ”¶é›†äº†å¹´è€ä»£ä¸­çš„å¯¹è±¡.")])]),s._v(" "),t("p",[s._v("åŸºäºä¸Šé¢çš„åˆ†æ, å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®º, é‚£å°±æ˜¯ Java å †çš„å¤§å°ä¸å¤Ÿ. è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆå¾—å‡ºè¿™ä¸ªç»“è®º:")]),s._v(" "),t("ul",[t("li",[s._v("GC æ´»åŠ¨é¢‘ç¹: å¹´è½»ä»£ GC(ç»¿è‰²çº¿)å’Œå¹´è€ä»£ GC(é»‘è‰²çº¿)éƒ½æ¯”è¾ƒå¯†é›†. è¿™è¯´æ˜å†…å­˜ç©ºé—´ä¸å¤Ÿ, ä¹Ÿå°±æ˜¯ Java å †çš„å¤§å°ä¸å¤Ÿ.")]),s._v(" "),t("li",[s._v("Java çš„å †ä¸­å¯¹è±¡åœ¨ GC ä¹‹åèƒ½å¤Ÿè¢«å›æ”¶, è¯´æ˜ä¸æ˜¯å†…å­˜æ³„æ¼.")])]),s._v(" "),t("p",[s._v("é€šè¿‡ GCViewer è¿˜å‘ç°ç´¯è®¡ GC æš‚åœæ—¶é—´æœ‰ 55.57 ç§’, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162238-r5luoqv.png",alt:""}})]),s._v(" "),t("p",[s._v("å› æ­¤çš„è§£å†³æ–¹æ¡ˆæ˜¯è°ƒå¤§ Java å †çš„å¤§å°, åƒä¸‹é¢è¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("java -Xmx2048m -Xss256k -verbosegc -Xlog:gc*,gc+ref=debug,gc+heap=debug,gc+age=trace:file=gc-%p-%t.log:tags,uptime,time,level:filecount=2,filesize=100m -jar target/demo-0.0.1-SNAPSHOT.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç”Ÿæˆçš„æ–°çš„ GC log åˆ†æå›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162238-cum3ngs.png",alt:""}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹åˆ°, æ²¡æœ‰å‘ç”Ÿ Full GC, å¹¶ä¸”å¹´è½»ä»£ GC ä¹Ÿæ²¡æœ‰é‚£ä¹ˆé¢‘ç¹äº†, å¹¶ä¸”ç´¯è®¡ GC æš‚åœæ—¶é—´åªæœ‰ 3.05 ç§’.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162238-onegv55.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_35-å¦‚ä½•ç›‘æ§tomcatçš„æ€§èƒ½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_35-å¦‚ä½•ç›‘æ§tomcatçš„æ€§èƒ½"}},[s._v("#")]),s._v(" 35.å¦‚ä½•ç›‘æ§Tomcatçš„æ€§èƒ½?")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ¥èŠå¦‚ä½•ç›‘æ§ Tomcat çš„å„ç§æŒ‡æ ‡, å› ä¸ºåªæœ‰æŒæ¡äº†è¿™äº›æŒ‡æ ‡å’Œä¿¡æ¯, æ‰èƒ½å¯¹ Tomcat å†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ä¸€ç›®äº†ç„¶, æ˜ç™½ç³»ç»Ÿçš„ç“¶é¢ˆåœ¨å“ªé‡Œ, è¿›è€Œåšå‡ºè°ƒä¼˜çš„å†³ç­–.")]),s._v(" "),t("p",[s._v("é¦–å…ˆæ¥çœ‹çœ‹åˆ°åº•éƒ½éœ€è¦ç›‘æ§ Tomcat å“ªäº›å…³é”®æŒ‡æ ‡, æ¥ç€æ¥å…·ä½“å­¦ä¹ å¦‚ä½•é€šè¿‡ JConsole æ¥ç›‘æ§å®ƒä»¬. å¦‚æœç³»ç»Ÿæ²¡æœ‰æš´éœ² JMX æ¥å£, è¿˜å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥æŸ¥çœ‹ Tomcat çš„æ€§èƒ½æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("Web åº”ç”¨çš„å“åº”æ—¶é—´æ˜¯å…³æ³¨çš„ä¸€ä¸ªé‡ç‚¹, æœ€åé€šè¿‡ä¸€ä¸ªå®æˆ˜æ¡ˆä¾‹, æ¥çœ‹çœ‹ Web åº”ç”¨çš„ä¸‹æ¸¸æœåŠ¡å“åº”æ—¶é—´æ¯”è¾ƒé•¿çš„æƒ…å†µä¸‹, Tomcat çš„å„é¡¹æŒ‡æ ‡æ˜¯ä»€ä¹ˆæ ·å­çš„.")]),s._v(" "),t("h5",{attrs:{id:"tomcatçš„å…³é”®æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatçš„å…³é”®æŒ‡æ ‡"}},[s._v("#")]),s._v(" Tomcatçš„å…³é”®æŒ‡æ ‡")]),s._v(" "),t("p",[s._v("Tomcat çš„å…³é”®æŒ‡æ ‡æœ‰"),t("strong",[s._v("ååé‡, å“åº”æ—¶é—´, é”™è¯¯æ•°, çº¿ç¨‹æ± , CPU ä»¥åŠ JVM å†…å­˜")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶ä¸­å‰ä¸‰ä¸ªæŒ‡æ ‡æ˜¯æœ€å…³å¿ƒçš„"),t("strong",[s._v("ä¸šåŠ¡æŒ‡æ ‡")]),s._v(", Tomcat ä½œä¸ºæœåŠ¡å™¨, å°±æ˜¯è¦èƒ½å¤Ÿåˆå¿«æœ‰å¥½åœ°å¤„ç†è¯·æ±‚, å› æ­¤ååé‡è¦å¤§, å“åº”æ—¶é—´è¦çŸ­, å¹¶ä¸”é”™è¯¯æ•°è¦å°‘.")]),s._v(" "),t("p",[s._v("è€Œåé¢ä¸‰ä¸ªæŒ‡æ ‡æ˜¯è·Ÿ"),t("strong",[s._v("ç³»ç»Ÿèµ„æº")]),s._v("æœ‰å…³çš„, å½“æŸä¸ªèµ„æºå‡ºç°ç“¶é¢ˆå°±ä¼šå½±å“å‰é¢çš„ä¸šåŠ¡æŒ‡æ ‡, æ¯”å¦‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ä¸è¶³ä¼šå½±å“ååé‡å’Œå“åº”æ—¶é—´; ä½†æ˜¯çº¿ç¨‹æ•°å¤ªå¤šä¼šè€—è´¹å¤§é‡ CPU, ä¹Ÿä¼šå½±å“ååé‡; å½“å†…å­˜ä¸è¶³æ—¶ä¼šè§¦å‘é¢‘ç¹åœ° GC, è€—è´¹ CPU, æœ€åä¹Ÿä¼šåæ˜ åˆ°ä¸šåŠ¡æŒ‡æ ‡ä¸Šæ¥.")]),s._v(" "),t("p",[s._v("é‚£å¦‚ä½•ç›‘æ§è¿™äº›æŒ‡æ ‡å‘¢? Tomcat å¯ä»¥é€šè¿‡ "),t("strong",[s._v("JMX")]),s._v(" å°†ä¸Šè¿°æŒ‡æ ‡æš´éœ²å‡ºæ¥çš„. JMX(Java Management Extensions, å³ Java ç®¡ç†æ‰©å±•)æ˜¯ä¸€ä¸ªä¸ºåº”ç”¨ç¨‹åº, è®¾å¤‡, ç³»ç»Ÿç­‰æ¤å…¥ç›‘æ§ç®¡ç†åŠŸèƒ½çš„æ¡†æ¶. JMX ä½¿ç”¨ç®¡ç† MBean æ¥ç›‘æ§ä¸šåŠ¡èµ„æº, è¿™äº› MBean åœ¨ JMX MBean æœåŠ¡å™¨ä¸Šæ³¨å†Œ, ä»£è¡¨ JVM ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡. æ¯ä¸ª MBean éƒ½æœ‰ä¸€ä¸ªå±æ€§åˆ—è¡¨. JMX å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ° MBean Server æ¥è¯»å†™ MBean çš„å±æ€§å€¼. å¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¼ å›¾æ¥ç†è§£ä¸€ä¸‹ JMX çš„å·¥ä½œåŸç†:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-wtmtkez.png",alt:""}})]),s._v(" "),t("p",[s._v("Tomcat å®šä¹‰äº†ä¸€ç³»åˆ— MBean æ¥å¯¹å¤–æš´éœ²ç³»ç»ŸçŠ¶æ€, æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡ JConsole æ¥ç›‘æ§è¿™äº›æŒ‡æ ‡.")]),s._v(" "),t("h5",{attrs:{id:"é€šè¿‡jconsoleç›‘æ§tomcat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é€šè¿‡jconsoleç›‘æ§tomcat"}},[s._v("#")]),s._v(" é€šè¿‡JConsoleç›‘æ§Tomcat")]),s._v(" "),t("p",[s._v("é¦–å…ˆéœ€è¦å¼€å¯ JMX çš„è¿œç¨‹ç›‘å¬ç«¯å£, å…·ä½“æ¥è¯´å°±æ˜¯è®¾ç½®è‹¥å¹² JVM å‚æ•°. å¯ä»¥åœ¨ Tomcat çš„ bin ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸º "),t("code",[s._v("setenv.sh")]),s._v("â€‹ çš„æ–‡ä»¶(æˆ–è€… "),t("code",[s._v("setenv.bat")]),s._v("â€‹, æ ¹æ®æ“ä½œç³»ç»Ÿç±»å‹), ç„¶åè¾“å…¥ä¸‹é¢çš„å†…å®¹:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('export JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote"export JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.port=9001"export JAVA_OPTS="${JAVA_OPTS} -Djava.rmi.server.hostname=x.x.x.x"export JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.ssl=false"export JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.authenticate=false"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("é‡å¯ Tomcat, è¿™æ · JMX çš„ç›‘å¬ç«¯å£ 9001 å°±å¼€å¯äº†, æ¥ä¸‹æ¥é€šè¿‡ JConsole æ¥è¿æ¥è¿™ä¸ªç«¯å£.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("jconsole x.x.x.x:9001\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ° JConsole çš„ä¸»ç•Œé¢:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-82gv2n0.png",alt:""}})]),s._v(" "),t("p",[s._v("å‰é¢æåˆ°çš„éœ€è¦ç›‘æ§çš„å…³é”®æŒ‡æ ‡æœ‰"),t("strong",[s._v("ååé‡, å“åº”æ—¶é—´, é”™è¯¯æ•°, çº¿ç¨‹æ± , CPU ä»¥åŠ JVM å†…å­˜")]),s._v(", æ¥ä¸‹æ¥çœ‹çœ‹æ€ä¹ˆåœ¨ JConsole ä¸Šæ‰¾åˆ°è¿™äº›æŒ‡æ ‡.")]),s._v(" "),t("p",[t("strong",[s._v("ååé‡, å“åº”æ—¶é—´, é”™è¯¯æ•°")])]),s._v(" "),t("p",[s._v('åœ¨ MBeans æ ‡ç­¾é¡µä¸‹é€‰æ‹© GlobalRequestProcessor, è¿™é‡Œæœ‰ Tomcat è¯·æ±‚å¤„ç†çš„ç»Ÿè®¡ä¿¡æ¯. å¯ä»¥çœ‹åˆ° Tomcat ä¸­çš„å„ç§è¿æ¥å™¨, å±•å¼€"http-nio-8080", å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿æ¥å™¨ä¸Šçš„ç»Ÿè®¡ä¿¡æ¯, å…¶ä¸­ maxTime è¡¨ç¤ºæœ€é•¿çš„å“åº”æ—¶é—´, processingTime è¡¨ç¤ºå¹³å‡å“åº”æ—¶é—´, requestCount è¡¨ç¤ºååé‡, errorCount å°±æ˜¯é”™è¯¯æ•°.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-zx5xjbq.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("çº¿ç¨‹æ± ")])]),s._v(" "),t("p",[s._v('é€‰æ‹©"çº¿ç¨‹"æ ‡ç­¾é¡µ, å¯ä»¥çœ‹åˆ°å½“å‰ Tomcat è¿›ç¨‹ä¸­æœ‰å¤šå°‘çº¿ç¨‹, å¦‚ä¸‹å›¾æ‰€ç¤º:')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-5yudkqb.png",alt:""}})]),s._v(" "),t("p",[s._v("å›¾çš„å·¦ä¸‹æ–¹æ˜¯çº¿ç¨‹åˆ—è¡¨, å³è¾¹æ˜¯çº¿ç¨‹çš„è¿è¡Œæ ˆ, è¿™äº›éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ä¿¡æ¯. å¦‚æœå¤§é‡çº¿ç¨‹é˜»å¡, é€šè¿‡è§‚å¯Ÿçº¿ç¨‹æ ˆ, èƒ½çœ‹åˆ°çº¿ç¨‹é˜»å¡åœ¨å“ªä¸ªå‡½æ•°, æœ‰å¯èƒ½æ˜¯ I/O ç­‰å¾…, æˆ–è€…æ˜¯æ­»é”.")]),s._v(" "),t("p",[t("strong",[s._v("CPU")])]),s._v(" "),t("p",[s._v("åœ¨ä¸»ç•Œé¢å¯ä»¥æ‰¾åˆ° CPU ä½¿ç”¨ç‡æŒ‡æ ‡, è¯·æ³¨æ„è¿™é‡Œçš„ CPU ä½¿ç”¨ç‡æŒ‡çš„æ˜¯ Tomcat è¿›ç¨‹å ç”¨çš„ CPU, ä¸æ˜¯ä¸»æœºæ€»çš„ CPU ä½¿ç”¨ç‡.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-iowmjst.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("JVM å†…å­˜")])]),s._v(" "),t("p",[s._v('é€‰æ‹©"å†…å­˜"æ ‡ç­¾é¡µ, èƒ½çœ‹åˆ° Tomcat è¿›ç¨‹çš„ JVM å†…å­˜ä½¿ç”¨æƒ…å†µ.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-wq7qshv.png",alt:""}})]),s._v(" "),t("p",[s._v('è¿˜å¯ä»¥æŸ¥çœ‹ JVM å„å†…å­˜åŒºåŸŸçš„ä½¿ç”¨æƒ…å†µ, å¤§çš„å±‚é¢åˆ†å †åŒºå’Œéå †åŒº. å †åŒºé‡Œæœ‰åˆ†ä¸º Eden, Survivor å’Œ Old. é€‰æ‹© "VM Summary" æ ‡ç­¾, å¯ä»¥çœ‹åˆ°è™šæ‹Ÿæœºå†…çš„è¯¦ç»†ä¿¡æ¯.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-meinc5r.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"å‘½ä»¤è¡ŒæŸ¥çœ‹tomcatæŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘½ä»¤è¡ŒæŸ¥çœ‹tomcatæŒ‡æ ‡"}},[s._v("#")]),s._v(" å‘½ä»¤è¡ŒæŸ¥çœ‹TomcatæŒ‡æ ‡")]),s._v(" "),t("p",[s._v("æç«¯æƒ…å†µä¸‹å¦‚æœ Web åº”ç”¨å ç”¨è¿‡å¤š CPU æˆ–è€…å†…å­˜, åˆæˆ–è€…ç¨‹åºä¸­å‘ç”Ÿäº†æ­»é”, å¯¼è‡´ Web åº”ç”¨å¯¹å¤–æ²¡æœ‰å“åº”, ç›‘æ§ç³»ç»Ÿä¸Šçœ‹ä¸åˆ°æ•°æ®, è¿™ä¸ªæ—¶å€™éœ€è¦ç™»é™†åˆ°ç›®æ ‡æœºå™¨, é€šè¿‡å‘½ä»¤è¡Œæ¥æŸ¥çœ‹å„ç§æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("(1) é¦–å…ˆé€šè¿‡ ps å‘½ä»¤æ‰¾åˆ° Tomcat è¿›ç¨‹, æ‹¿åˆ°è¿›ç¨‹ ID.")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" tomcat\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("(2) æ¥ç€æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€çš„å¤§è‡´ä¿¡æ¯, é€šè¿‡ "),t("code",[s._v("cat/proc/<pid>/status")]),s._v("â€‹ å‘½ä»¤:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-5rygbma.png",alt:""}})]),s._v(" "),t("p",[s._v("(3) ç›‘æ§è¿›ç¨‹çš„ CPU å’Œå†…å­˜èµ„æºä½¿ç”¨æƒ…å†µ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-cz4qiar.png",alt:""}})]),s._v(" "),t("p",[s._v("(4) æŸ¥çœ‹ Tomcat çš„ç½‘ç»œè¿æ¥, æ¯”å¦‚ Tomcat åœ¨ 8080 ç«¯å£ä¸Šç›‘å¬è¿æ¥è¯·æ±‚, é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹è¿æ¥åˆ—è¡¨:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-l4hlmeo.png",alt:""}})]),s._v(" "),t("p",[s._v('è¿˜å¯ä»¥åˆ†åˆ«ç»Ÿè®¡å¤„åœ¨ "å·²è¿æ¥" çŠ¶æ€å’Œ "TIME_WAIT" çŠ¶æ€çš„è¿æ¥æ•°:')]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-na")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ESTAB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-na")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" TIME_WAIT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("(5) é€šè¿‡ ifstat æ¥æŸ¥çœ‹ç½‘ç»œæµé‡, å¤§è‡´å¯ä»¥çœ‹å‡º Tomcat å½“å‰çš„è¯·æ±‚æ•°å’Œè´Ÿè½½çŠ¶å†µ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-77iof34.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"å®æˆ˜æ¡ˆä¾‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®æˆ˜æ¡ˆä¾‹"}},[s._v("#")]),s._v(" å®æˆ˜æ¡ˆä¾‹")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸ªå®æˆ˜æ¡ˆä¾‹ä¸­, ä¼šåˆ›å»ºä¸€ä¸ª Web åº”ç”¨, æ ¹æ®ä¼ å…¥çš„å‚æ•° latency æ¥ä¼‘çœ ç›¸åº”çš„ç§’æ•°, ç›®çš„æ˜¯æ¨¡æ‹Ÿå½“å‰çš„ Web åº”ç”¨åœ¨è®¿é—®ä¸‹æ¸¸æœåŠ¡æ—¶é‡åˆ°çš„å»¶è¿Ÿ. ç„¶åç”¨ JMeter æ¥å‹æµ‹è¿™ä¸ªæœåŠ¡, é€šè¿‡ JConsole æ¥è§‚å¯Ÿ Tomcat çš„å„é¡¹æŒ‡æ ‡, åˆ†æå’Œå®šä½é—®é¢˜.")]),s._v(" "),t("p",[s._v("ä¸»è¦çš„æ­¥éª¤æœ‰:")]),s._v(" "),t("p",[s._v("(1) åˆ›å»ºä¸€ä¸ª Spring Boot ç¨‹åº, åŠ å…¥ä¸‹é¢ä»£ç æ‰€ç¤ºçš„ä¸€ä¸ª RestController:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DownStreamLatency")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/greeting/latency/{seconds}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Greeting")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("greeting")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PathVariable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" seconds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("seconds "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Greeting")]),s._v(" greeting "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Greeting")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" greeting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ç¨‹åºä¼šè¯»å– URL ä¼ è¿‡æ¥çš„ seconds å‚æ•°, å…ˆä¼‘çœ ç›¸åº”çš„ç§’æ•°, å†è¿”å›è¯·æ±‚. è¿™æ ·åšçš„ç›®çš„æ˜¯, å®¢æˆ·ç«¯å‹æµ‹å·¥å…·èƒ½å¤Ÿæ§åˆ¶æœåŠ¡ç«¯çš„å»¶è¿Ÿ.")]),s._v(" "),t("p",[s._v("ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿ Tomcat çš„çº¿ç¨‹æ•°è·Ÿå»¶è¿Ÿä¹‹é—´çš„å…³ç³», è¿˜éœ€è¦åŠ å¤§ Tomcat çš„æœ€å¤§çº¿ç¨‹æ•°, å¯ä»¥åœ¨ "),t("code",[s._v("application.properties")]),s._v("â€‹ æ–‡ä»¶ä¸­åŠ å…¥è¿™æ ·ä¸€è¡Œ:")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server.tomcat.max-threads")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server.tomcat.max-threads")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("(2) å¯åŠ¨ JMeter å¼€å§‹å‹æµ‹, è¿™é‡Œå°†å‹æµ‹çš„çº¿ç¨‹æ•°è®¾ç½®ä¸º 100:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-pvhfecw.png",alt:""}})]),s._v(" "),t("p",[s._v("æ³¨æ„, è¿˜éœ€è¦å°†å®¢æˆ·ç«¯çš„ Timeout è®¾ç½®ä¸º 1000 æ¯«ç§’, è¿™æ˜¯å› ä¸º JMeter çš„æµ‹è¯•çº¿ç¨‹åœ¨æ”¶åˆ°å“åº”ä¹‹å‰, "),t("strong",[s._v("ä¸ä¼šå‘å‡ºä¸‹ä¸€æ¬¡è¯·æ±‚")]),s._v(", è¿™å°±æ„å‘³æ²¡æ³•æŒ‰ç…§å›ºå®šçš„ååé‡å‘æœåŠ¡ç«¯åŠ å‹. è€ŒåŠ äº† Timeout ä»¥å, JMeter ä¼šæœ‰å›ºå®šçš„ååé‡å‘ Tomcat å‘é€è¯·æ±‚.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-3eve09q.png",alt:""}})]),s._v(" "),t("p",[s._v("(3) å¼€å¯æµ‹è¯•, è¿™é‡Œåˆ†ä¸‰ä¸ªé˜¶æ®µ, ç¬¬ä¸€ä¸ªé˜¶æ®µå°†æœåŠ¡ç«¯ä¼‘çœ æ—¶é—´è®¾ä¸º 2 ç§’, ç„¶åæš‚åœä¸€æ®µæ—¶é—´. ç¬¬äºŒå’Œç¬¬ä¸‰é˜¶æ®µåˆ†åˆ«å°†ä¼‘çœ æ—¶é—´è®¾ç½®æˆ 4 ç§’å’Œ 6 ç§’.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-li13uu9.png",alt:""}})]),s._v(" "),t("p",[s._v("(4) æœ€åé€šè¿‡ JConsole æ¥è§‚å¯Ÿç»“æœ:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162457-j4uljme.png",alt:""}})]),s._v(" "),t("p",[s._v("ä¸‹é¢ä»çº¿ç¨‹æ•°, å†…å­˜å’Œ CPU è¿™ä¸‰ä¸ªæŒ‡æ ‡æ¥åˆ†æ Tomcat çš„æ€§èƒ½é—®é¢˜.")]),s._v(" "),t("ul",[t("li",[s._v("é¦–å…ˆçœ‹çº¿ç¨‹æ•°, åœ¨ç¬¬ä¸€é˜¶æ®µæ—¶é—´ä¹‹å‰, çº¿ç¨‹æ•°å¤§æ¦‚æ˜¯ 40, ç¬¬ä¸€é˜¶æ®µå‹æµ‹å¼€å§‹å, çº¿ç¨‹æ•°å¢é•¿åˆ° 250. ä¸ºä»€ä¹ˆæ˜¯ 250 å‘¢? è¿™æ˜¯å› ä¸º JMeter æ¯ç§’ä¼šå‘å‡º 100 ä¸ªè¯·æ±‚, æ¯ä¸€ä¸ªè¯·æ±‚ä¼‘çœ  2 ç§’, å› æ­¤ Tomcat éœ€è¦ 200 ä¸ªå·¥ä½œçº¿ç¨‹æ¥å¹²æ´»; æ­¤å¤– Tomcat è¿˜æœ‰ä¸€äº›å…¶ä»–çº¿ç¨‹ç”¨æ¥å¤„ç†ç½‘ç»œé€šä¿¡å’Œåå°ä»»åŠ¡, æ‰€ä»¥æ€»æ•°æ˜¯ 250 å·¦å³. ç¬¬ä¸€é˜¶æ®µå‹æµ‹æš‚åœå, çº¿ç¨‹æ•°åˆä¸‹é™åˆ° 40, è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ± ä¼šå›æ”¶ç©ºé—²çº¿ç¨‹. ç¬¬äºŒé˜¶æ®µæµ‹è¯•å¼€å§‹å, çº¿ç¨‹æ•°æ¶¨åˆ°äº† 420, è¿™æ˜¯å› ä¸ºæ¯ä¸ªè¯·æ±‚ä¼‘çœ äº† 4 ç§’; åŒç†, çœ‹åˆ°ç¬¬ä¸‰é˜¶æ®µæµ‹è¯•çš„çº¿ç¨‹æ•°æ˜¯ 620.")]),s._v(" "),t("li",[s._v("å†æ¥çœ‹ CPU, åœ¨ä¸‰ä¸ªé˜¶æ®µçš„æµ‹è¯•ä¸­, CPU çš„å³°å€¼å§‹ç»ˆæ¯”è¾ƒç¨³å®š, è¿™æ˜¯å› ä¸º JMeter æ§åˆ¶äº†æ€»ä½“çš„ååé‡, å› ä¸ºæœåŠ¡ç«¯ç”¨æ¥å¤„ç†è¿™äº›è¯·æ±‚æ‰€éœ€è¦æ¶ˆè€—çš„ CPU åŸºæœ¬ä¹Ÿæ˜¯ä¸€æ ·çš„.")]),s._v(" "),t("li",[s._v("å„æµ‹è¯•é˜¶æ®µçš„å†…å­˜ä½¿ç”¨é‡ç•¥æœ‰å¢åŠ , è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ•°å¢åŠ äº†, åˆ›å»ºçº¿ç¨‹ä¹Ÿéœ€è¦æ¶ˆè€—å†…å­˜.")])]),s._v(" "),t("p",[s._v("ä»ä¸Šé¢çš„æµ‹è¯•ç»“æœå¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®º: "),t("strong",[s._v("å¯¹äºä¸€ä¸ª Web åº”ç”¨æ¥è¯´, ä¸‹æ¸¸æœåŠ¡çš„å»¶è¿Ÿè¶Šå¤§, Tomcat æ‰€éœ€è¦çš„çº¿ç¨‹æ•°è¶Šå¤š, ä½†æ˜¯ CPU ä¿æŒç¨³å®š")]),s._v(". æ‰€ä»¥å¦‚æœç¢°åˆ°çº¿ç¨‹æ•°é£™å‡ä½†æ˜¯ CPU æ²¡æœ‰å¢åŠ çš„æƒ…å†µ, è¿™ä¸ªæ—¶å€™å¯ä»¥æ€€ç–‘ Web åº”ç”¨æ‰€ä¾èµ–çš„ä¸‹æ¸¸æœåŠ¡æ˜¯ä¸æ˜¯å‡ºäº†é—®é¢˜, å“åº”æ—¶é—´æ˜¯å¦å˜é•¿äº†.")]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-17"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-17"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Tomcat çš„å…³é”®çš„æ€§èƒ½æŒ‡æ ‡ä¸»è¦æœ‰**ååé‡, å“åº”æ—¶é—´, é”™è¯¯æ•°, çº¿ç¨‹æ± , CPU ä»¥åŠ JVM å†…å­˜. **")]),s._v(" "),t("p",[s._v("åœ¨å®é™…å·¥ä½œä¸­, éœ€è¦é€šè¿‡è§‚å¯Ÿè¿™äº›æŒ‡æ ‡æ¥è¯Šæ–­ç³»ç»Ÿé‡åˆ°çš„æ€§èƒ½é—®é¢˜, æ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆ. å¦‚æœç›‘æ§åˆ° CPU ä¸Šå‡, è¿™æ—¶å¯ä»¥çœ‹çœ‹ååé‡æ˜¯ä¸æ˜¯ä¹Ÿä¸Šå‡äº†, å¦‚æœæ˜¯é‚£è¯´æ˜æ­£å¸¸; å¦‚æœä¸æ˜¯çš„è¯, å¯ä»¥çœ‹çœ‹ GC çš„æ´»åŠ¨, å¦‚æœ GC æ´»åŠ¨é¢‘ç¹, å¹¶ä¸”å†…å­˜å±…é«˜ä¸ä¸‹, åŸºæœ¬å¯ä»¥æ–­å®šæ˜¯å†…å­˜æ³„æ¼.")]),s._v(" "),t("h4",{attrs:{id:"_36-tomcat-ioå’Œçº¿ç¨‹æ± çš„å¹¶å‘è°ƒä¼˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_36-tomcat-ioå’Œçº¿ç¨‹æ± çš„å¹¶å‘è°ƒä¼˜"}},[s._v("#")]),s._v(" 36.Tomcat IOå’Œçº¿ç¨‹æ± çš„å¹¶å‘è°ƒä¼˜")]),s._v(" "),t("p",[s._v("Tomcat çš„è°ƒä¼˜æ¶‰åŠ "),t("mark",[t("strong",[s._v("I/O æ¨¡å‹å’Œçº¿ç¨‹æ± è°ƒä¼˜, JVM å†…å­˜è°ƒä¼˜ä»¥åŠç½‘ç»œä¼˜åŒ–")])]),s._v("ç­‰, æœ¬èŠ‚åˆ†æ I/O æ¨¡å‹å’Œçº¿ç¨‹æ± è°ƒä¼˜, ç”±äº Web åº”ç”¨ç¨‹åºè·‘åœ¨ Tomcat çš„å·¥ä½œçº¿ç¨‹ä¸­, å› æ­¤ Web åº”ç”¨å¯¹è¯·æ±‚çš„å¤„ç†æ—¶é—´ä¹Ÿç›´æ¥å½±å“ Tomcat æ•´ä½“çš„æ€§èƒ½, è€Œ Tomcat å’Œ Web åº”ç”¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰€ç”¨åˆ°çš„èµ„æºéƒ½æ¥è‡ªäºæ“ä½œç³»ç»Ÿ, å› æ­¤è°ƒä¼˜éœ€è¦å°†æœåŠ¡ç«¯çœ‹ä½œæ˜¯ä¸€ä¸ªæ•´ä½“æ¥è€ƒè™‘.")]),s._v(" "),t("p",[s._v("**æ‰€è°“çš„ I/O è°ƒä¼˜æŒ‡çš„æ˜¯é€‰æ‹© NIO, NIO.2 è¿˜æ˜¯ APR, è€Œçº¿ç¨‹æ± è°ƒä¼˜æŒ‡çš„æ˜¯ç»™ Tomcat çš„çº¿ç¨‹æ± è®¾ç½®åˆé€‚çš„å‚æ•°, ä½¿å¾— Tomcat èƒ½å¤Ÿåˆå¿«åˆå¥½åœ°å¤„ç†è¯·æ±‚. **")]),s._v(" "),t("h5",{attrs:{id:"i-oæ¨¡å‹çš„é€‰æ‹©"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#i-oæ¨¡å‹çš„é€‰æ‹©"}},[s._v("#")]),s._v(" I/Oæ¨¡å‹çš„é€‰æ‹©")]),s._v(" "),t("p",[t("strong",[s._v("I/O è°ƒä¼˜å®é™…ä¸Šæ˜¯è¿æ¥å™¨ç±»å‹çš„é€‰æ‹©, ä¸€èˆ¬æƒ…å†µä¸‹é»˜è®¤éƒ½æ˜¯ NIO")]),s._v(", åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å¤Ÿç”¨çš„, é™¤éä½ çš„ Web åº”ç”¨ç”¨åˆ°äº† TLS åŠ å¯†ä¼ è¾“, è€Œä¸”å¯¹æ€§èƒ½è¦æ±‚æé«˜, è¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘ APR, å› ä¸º APR é€šè¿‡ OpenSSL æ¥å¤„ç† TLS æ¡æ‰‹å’ŒåŠ  / è§£å¯†. OpenSSL æœ¬èº«ç”¨ C è¯­è¨€å®ç°, å®ƒè¿˜å¯¹ TLS é€šä¿¡åšäº†ä¼˜åŒ–, æ‰€ä»¥æ€§èƒ½æ¯” Java è¦é«˜.")]),s._v(" "),t("p",[s._v("ä»€ä¹ˆæ—¶å€™è€ƒè™‘é€‰æ‹© NIO.2? ä¸€èˆ¬å»ºè®®æ˜¯å¦‚æœ Tomcat è·‘åœ¨ Windows å¹³å°ä¸Š, å¹¶ä¸” HTTP è¯·æ±‚çš„æ•°æ®é‡æ¯”è¾ƒå¤§, å¯ä»¥è€ƒè™‘ NIO.2, è¿™æ˜¯å› ä¸º Windows ä»æ“ä½œç³»ç»Ÿå±‚é¢å®ç°äº†çœŸæ­£æ„ä¹‰ä¸Šçš„å¼‚æ­¥ I/O, å¦‚æœä¼ è¾“çš„æ•°æ®é‡æ¯”è¾ƒå¤§, å¼‚æ­¥ I/O çš„æ•ˆæœå°±èƒ½æ˜¾ç°å‡ºæ¥.")]),s._v(" "),t("p",[s._v("å¦‚æœ "),t("strong",[s._v("Tomcat è·‘åœ¨ Linux å¹³å°ä¸Š, å»ºè®®ä½¿ç”¨ NIO")]),s._v(", è¿™æ˜¯å› ä¸º Linux å†…æ ¸æ²¡æœ‰å¾ˆå®Œå–„åœ°æ”¯æŒå¼‚æ­¥ I/O æ¨¡å‹, å› æ­¤ JVM å¹¶æ²¡æœ‰é‡‡ç”¨åŸç”Ÿçš„ Linux å¼‚æ­¥ I/O, è€Œæ˜¯åœ¨åº”ç”¨å±‚é¢é€šè¿‡ epoll æ¨¡æ‹Ÿäº†å¼‚æ­¥ I/O æ¨¡å‹, åªæ˜¯ Java NIO çš„ä½¿ç”¨è€…æ„Ÿè§‰ä¸åˆ°è€Œå·². å› æ­¤å¯ä»¥è¿™æ ·ç†è§£, åœ¨ Linux å¹³å°ä¸Š, "),t("strong",[s._v("Java NIO å’Œ Java NIO.2 åº•å±‚éƒ½æ˜¯é€šè¿‡ epoll æ¥å®ç°çš„, ä½†æ˜¯ Java NIO æ›´åŠ ç®€å•é«˜æ•ˆ")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"çº¿ç¨‹æ± è°ƒä¼˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#çº¿ç¨‹æ± è°ƒä¼˜"}},[s._v("#")]),s._v(" çº¿ç¨‹æ± è°ƒä¼˜")]),s._v(" "),t("p",[t("strong",[s._v("è·Ÿ I/O æ¨¡å‹ç´§å¯†ç›¸å…³çš„æ˜¯çº¿ç¨‹æ± , çº¿ç¨‹æ± çš„è°ƒä¼˜å°±æ˜¯è®¾ç½®åˆç†çš„çº¿ç¨‹æ± å‚æ•°")]),s._v(". å…ˆæ¥çœ‹çœ‹ Tomcat çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å…³é”®å‚æ•°:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162514-3jn10hn.jpg",alt:""}})]),s._v(" "),t("p",[s._v("**è¿™é‡Œé¢æœ€æ ¸å¿ƒçš„å°±æ˜¯å¦‚ä½•ç¡®å®š **â€‹"),t("mark",[t("strong",[s._v("maxThreads")])]),s._v("â€‹ ** çš„å€¼, å¦‚æœè¿™ä¸ªå‚æ•°è®¾ç½®å°äº†, Tomcat ä¼šå‘ç”Ÿçº¿ç¨‹é¥¥é¥¿, å¹¶ä¸”è¯·æ±‚çš„å¤„ç†ä¼šåœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…, å¯¼è‡´å“åº”æ—¶é—´å˜é•¿; å¦‚æœ maxThreads å‚æ•°å€¼è¿‡å¤§, åŒæ ·ä¹Ÿä¼šæœ‰é—®é¢˜, å› ä¸ºæœåŠ¡å™¨çš„ CPU çš„æ ¸æ•°æœ‰é™, çº¿ç¨‹æ•°å¤ªå¤šä¼šå¯¼è‡´çº¿ç¨‹åœ¨ CPU ä¸Šæ¥å›åˆ‡æ¢, è€—è´¹å¤§é‡çš„åˆ‡æ¢å¼€é”€. **")]),s._v(" "),t("p",[s._v("é‚£ maxThreads è®¾ç½®æˆå¤šå°‘æ‰ç®—æ˜¯åˆé€‚å‘¢? ä¸ºäº†ç†è§£æ¸…æ¥šè¿™ä¸ªé—®é¢˜, å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯åˆ©ç‰¹å°”æ³•åˆ™(Littleâ€™s Law).")]),s._v(" "),t("p",[t("strong",[s._v("åˆ©ç‰¹å°”æ³•åˆ™")])]),s._v(" "),t("blockquote",[t("p",[s._v("ç³»ç»Ÿä¸­çš„è¯·æ±‚æ•° = è¯·æ±‚çš„åˆ°è¾¾é€Ÿç‡ Ã— æ¯ä¸ªè¯·æ±‚å¤„ç†æ—¶é—´")])]),s._v(" "),t("p",[s._v("å…¶å®è¿™ä¸ªå…¬å¼å¾ˆå¥½ç†è§£, ä¸¾ä¸ªä¾‹å­: æˆ‘ä»¬å»è¶…å¸‚è´­ç‰©ç»“è´¦éœ€è¦æ’é˜Ÿ, å¦‚ä½•ä¼°ç®—ä¸€ä¸ªé˜Ÿåˆ—æœ‰å¤šé•¿å‘¢? é˜Ÿåˆ—ä¸­å¦‚æœæ¯ä¸ªäººéƒ½ä¹°å¾ˆå¤šä¸œè¥¿, é‚£ä¹ˆç»“è´¦çš„æ—¶é—´å°±è¶Šé•¿, é˜Ÿåˆ—ä¹Ÿä¼šè¶Šé•¿; åŒç†, çŸ­æ—¶é—´ä¸€ä¸‹æœ‰å¾ˆå¤šäººæ¥æ”¶é“¶å°ç»“è´¦, é˜Ÿåˆ—ä¹Ÿä¼šå˜é•¿. å› æ­¤é˜Ÿåˆ—çš„é•¿åº¦ç­‰äºæ–°äººåŠ å…¥é˜Ÿåˆ—çš„é¢‘ç‡ä¹˜ä»¥å¹³å‡æ¯ä¸ªäººå¤„ç†çš„æ—¶é—´.")]),s._v(" "),t("p",[s._v("**è®¡ç®—å‡ºäº†é˜Ÿåˆ—çš„é•¿åº¦, é‚£ä¹ˆå°±åˆ›å»ºç›¸åº”æ•°é‡çš„çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚, è¿™æ ·æ—¢èƒ½ä»¥æœ€å¿«çš„é€Ÿåº¦å¤„ç†å®Œæ‰€æœ‰è¯·æ±‚, åŒæ—¶åˆæ²¡æœ‰é¢å¤–çš„çº¿ç¨‹èµ„æºé—²ç½®å’Œæµªè´¹. **")]),s._v(" "),t("p",[s._v("å‡è®¾ä¸€ä¸ªå•æ ¸æœåŠ¡å™¨åœ¨æ¥æ”¶è¯·æ±‚:")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æœæ¯ç§’ 10 ä¸ªè¯·æ±‚åˆ°è¾¾, å¹³å‡å¤„ç†ä¸€ä¸ªè¯·æ±‚éœ€è¦ 1 ç§’, é‚£ä¹ˆæœåŠ¡å™¨ä»»ä½•æ—¶å€™éƒ½æœ‰ 10 ä¸ªè¯·æ±‚åœ¨å¤„ç†, å³éœ€è¦ 10 ä¸ªçº¿ç¨‹.")]),s._v(" "),t("li",[s._v("å¦‚æœæ¯ç§’ 10 ä¸ªè¯·æ±‚åˆ°è¾¾, å¹³å‡å¤„ç†ä¸€ä¸ªè¯·æ±‚éœ€è¦ 2 ç§’, é‚£ä¹ˆæœåŠ¡å™¨åœ¨æ¯ä¸ªæ—¶åˆ»éƒ½æœ‰ 20 ä¸ªè¯·æ±‚åœ¨å¤„ç†, å› æ­¤éœ€è¦ 20 ä¸ªçº¿ç¨‹.")]),s._v(" "),t("li",[s._v("å¦‚æœæ¯ç§’ 10000 ä¸ªè¯·æ±‚åˆ°è¾¾, å¹³å‡å¤„ç†ä¸€ä¸ªè¯·æ±‚éœ€è¦ 1 ç§’, é‚£ä¹ˆæœåŠ¡å™¨åœ¨æ¯ä¸ªæ—¶åˆ»éƒ½æœ‰ 10000 ä¸ªè¯·æ±‚åœ¨å¤„ç†, å› æ­¤éœ€è¦ 10000 ä¸ªçº¿ç¨‹.")])]),s._v(" "),t("p",[s._v("å› æ­¤å¯ä»¥æ€»ç»“å‡ºä¸€ä¸ªå…¬å¼:")]),s._v(" "),t("blockquote",[t("p",[s._v("çº¿ç¨‹æ± å¤§å° = æ¯ç§’è¯·æ±‚æ•° Ã— å¹³å‡è¯·æ±‚å¤„ç†æ—¶é—´")])]),s._v(" "),t("p",[s._v("è¿™æ˜¯"),t("strong",[s._v("ç†æƒ³")]),s._v("çš„æƒ…å†µ, ä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹ä¸€ç›´åœ¨å¿™ç€å¹²æ´», æ²¡æœ‰è¢«é˜»å¡åœ¨ I/O ç­‰å¾…ä¸Š. å®é™…ä¸Šä»»åŠ¡åœ¨æ‰§è¡Œä¸­, çº¿ç¨‹ä¸å¯é¿å…ä¼šå‘ç”Ÿé˜»å¡, æ¯”å¦‚é˜»å¡åœ¨ I/O ç­‰å¾…ä¸Š, ç­‰å¾…æ•°æ®åº“æˆ–è€…ä¸‹æ¸¸æœåŠ¡çš„æ•°æ®è¿”å›, è™½ç„¶é€šè¿‡éé˜»å¡ I/O æ¨¡å‹å¯ä»¥å‡å°‘çº¿ç¨‹çš„ç­‰å¾…, ä½†æ˜¯æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´æ‹·è´è¿‡ç¨‹ä¸­, çº¿ç¨‹è¿˜æ˜¯é˜»å¡çš„. çº¿ç¨‹ä¸€é˜»å¡å°±ä¼šè®©å‡º CPU, çº¿ç¨‹é—²ç½®ä¸‹æ¥, å°±å¥½åƒå·¥ä½œäººå‘˜ä¸å¯èƒ½ 24 å°æ—¶ä¸é—´æ–­åœ°å¤„ç†å®¢æˆ·çš„è¯·æ±‚, è§£å†³åŠæ³•å°±æ˜¯å¢åŠ å·¥ä½œäººå‘˜çš„æ•°é‡, ä¸€ä¸ªäººå»ä¼‘æ¯å¦ä¸€ä¸ªäººå†é¡¶ä¸Š. "),t("strong",[s._v("å¯¹åº”åˆ°çº¿ç¨‹æ± å°±æ˜¯å¢åŠ çº¿ç¨‹æ•°é‡, å› æ­¤ I/O å¯†é›†å‹åº”ç”¨éœ€è¦è®¾ç½®æ›´å¤šçš„çº¿ç¨‹")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("çº¿ç¨‹ I/O æ—¶é—´ä¸ CPU æ—¶é—´")])]),s._v(" "),t("p",[s._v("è‡³æ­¤åˆå¾—åˆ°ä¸€ä¸ªçº¿ç¨‹æ± ä¸ªæ•°çš„è®¡ç®—å…¬å¼, å‡è®¾æœåŠ¡å™¨æ˜¯å•æ ¸çš„:")]),s._v(" "),t("blockquote",[t("p",[s._v("çº¿ç¨‹æ± å¤§å° = (çº¿ç¨‹ I/O é˜»å¡æ—¶é—´ + çº¿ç¨‹ CPU æ—¶é—´ )/ çº¿ç¨‹ CPU æ—¶é—´")])]),s._v(" "),t("p",[s._v("å…¶ä¸­: "),t("strong",[s._v("çº¿ç¨‹ I/O é˜»å¡æ—¶é—´ + çº¿ç¨‹ CPU æ—¶é—´ = å¹³å‡è¯·æ±‚å¤„ç†æ—¶é—´")])]),s._v(" "),t("p",[s._v("å¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªå…¬å¯ä»¥å‘ç°, "),t("strong",[s._v("å¹³å‡è¯·æ±‚å¤„ç†æ—¶é—´")]),s._v("åœ¨ä¸¤ä¸ªå…¬å¼é‡Œéƒ½å‡ºç°äº†, è¿™è¯´æ˜è¯·æ±‚æ—¶é—´è¶Šé•¿, éœ€è¦æ›´å¤šçš„çº¿ç¨‹æ˜¯æ¯«æ— ç–‘é—®çš„.")]),s._v(" "),t("p",[s._v("ä¸åŒçš„æ˜¯ç¬¬ä¸€ä¸ªå…¬å¼æ˜¯ç”¨"),t("strong",[s._v("æ¯ç§’è¯·æ±‚æ•°")]),s._v("æ¥ä¹˜ä»¥è¯·æ±‚å¤„ç†æ—¶é—´; è€Œç¬¬äºŒä¸ªå…¬å¼ç”¨"),t("strong",[s._v("è¯·æ±‚å¤„ç†æ—¶é—´")]),s._v("æ¥é™¤ä»¥"),t("strong",[s._v("çº¿ç¨‹ CPU æ—¶é—´")]),s._v(", è¯·æ³¨æ„ CPU æ—¶é—´æ˜¯å°äºè¯·æ±‚å¤„ç†æ—¶é—´çš„.")]),s._v(" "),t("p",[s._v("è™½ç„¶è¿™ä¸¤ä¸ªå…¬å¼æ˜¯ä»ä¸åŒçš„è§’åº¦æ¥çœ‹å¾…é—®é¢˜çš„, ä½†éƒ½æ˜¯"),t("strong",[s._v("ç†æƒ³æƒ…å†µ")]),s._v(", éƒ½æœ‰ä¸€å®šçš„å‰ææ¡ä»¶.")]),s._v(" "),t("ol",[t("li",[s._v("è¯·æ±‚å¤„ç†æ—¶é—´è¶Šé•¿, éœ€è¦çš„çº¿ç¨‹æ•°è¶Šå¤š, ä½†å‰ææ˜¯ CPU æ ¸æ•°è¦è¶³å¤Ÿ, å¦‚æœä¸€ä¸ª CPU æ¥æ”¯æ’‘ 10000 TPS å¹¶å‘, åˆ›å»º 10000 ä¸ªçº¿ç¨‹, æ˜¾ç„¶ä¸åˆç†, ä¼šé€ æˆå¤§é‡çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢.")]),s._v(" "),t("li",[s._v("è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­, I/O ç­‰å¾…æ—¶é—´è¶Šé•¿, éœ€è¦çš„çº¿ç¨‹æ•°è¶Šå¤š, å‰ææ˜¯ CUP æ—¶é—´å’Œ I/O æ—¶é—´çš„æ¯”ç‡è¦è®¡ç®—çš„è¶³å¤Ÿå‡†ç¡®.")]),s._v(" "),t("li",[s._v("è¯·æ±‚è¿›æ¥çš„é€Ÿç‡è¶Šå¿«, éœ€è¦çš„çº¿ç¨‹æ•°è¶Šå¤š, å‰ææ˜¯ CPU æ ¸æ•°ä¹Ÿè¦è·Ÿä¸Š.")])]),s._v(" "),t("h5",{attrs:{id:"å®é™…åœºæ™¯ä¸‹å¦‚ä½•ç¡®å®šçº¿ç¨‹æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®é™…åœºæ™¯ä¸‹å¦‚ä½•ç¡®å®šçº¿ç¨‹æ•°"}},[s._v("#")]),s._v(" å®é™…åœºæ™¯ä¸‹å¦‚ä½•ç¡®å®šçº¿ç¨‹æ•°")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆåœ¨å®é™…æƒ…å†µä¸‹, çº¿ç¨‹æ± çš„ä¸ªæ•°å¦‚ä½•ç¡®å®šå‘¢? "),t("mark",[t("strong",[s._v("è¿™æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹, å…ˆç”¨ä¸Šé¢ä¸¤ä¸ªå…¬å¼å¤§æ¦‚ç®—å‡ºç†æƒ³çš„çº¿ç¨‹æ•°, å†åå¤å‹æµ‹è°ƒæ•´, ä»è€Œè¾¾åˆ°æœ€ä¼˜")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬æ¥è¯´, å¦‚æœç³»ç»Ÿçš„ TPS è¦æ±‚è¶³å¤Ÿå¤§, ç”¨ç¬¬ä¸€ä¸ªå…¬å¼ç®—å‡ºæ¥çš„çº¿ç¨‹æ•°å¾€å¾€ä¼šæ¯”å…¬å¼äºŒç®—å‡ºæ¥çš„è¦å¤§. å»ºè®®é€‰å–è¿™ä¸¤ä¸ªå€¼ä¸­é—´æ›´é è¿‘å…¬å¼äºŒçš„å€¼. ä¹Ÿå°±æ˜¯"),t("strong",[s._v("å…ˆè®¾ç½®ä¸€ä¸ªè¾ƒå°çš„çº¿ç¨‹æ•°, ç„¶åè¿›è¡Œå‹æµ‹, å½“è¾¾åˆ°ç³»ç»Ÿæé™æ—¶(é”™è¯¯æ•°å¢åŠ , æˆ–è€…å“åº”æ—¶é—´å¤§å¹…å¢åŠ ), å†é€æ­¥åŠ å¤§çº¿ç¨‹æ•°, å½“å¢åŠ åˆ°æŸä¸ªå€¼, å†å¢åŠ çº¿ç¨‹æ•°ä¹Ÿæ— æµäºäº‹, ç”šè‡³ TPS åè€Œä¸‹é™, é‚£è¿™ä¸ªå€¼å¯ä»¥è®¤ä¸ºæ˜¯æœ€ä½³çº¿ç¨‹æ•°")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("çº¿ç¨‹æ± ä¸­å…¶ä»–çš„å‚æ•°, æœ€å¥½å°±ç”¨é»˜è®¤å€¼, èƒ½ä¸æ”¹å°±ä¸æ”¹, é™¤éåœ¨å‹æµ‹çš„è¿‡ç¨‹å‘ç°äº†ç“¶é¢ˆ")]),s._v(". å¦‚æœå‘ç°äº†é—®é¢˜å°±éœ€è¦è°ƒæ•´, æ¯”å¦‚ maxQueueSize, å¦‚æœå¤§é‡ä»»åŠ¡æ¥ä¸åŠå¤„ç†éƒ½å †ç§¯åœ¨ maxQueueSize ä¸­, ä¼šå¯¼è‡´å†…å­˜è€—å°½, è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç»™ maxQueueSize è®¾ä¸€ä¸ªé™åˆ¶. å½“ç„¶, è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæç«¯çš„æƒ…å†µäº†.")]),s._v(" "),t("p",[s._v("å†æ¯”å¦‚ minSpareThreads å‚æ•°, é»˜è®¤æ˜¯ 25 ä¸ªçº¿ç¨‹, å¦‚æœä½ å‘ç°ç³»ç»Ÿåœ¨é—²çš„æ—¶å€™ç”¨ä¸åˆ° 25 ä¸ªçº¿ç¨‹, å°±å¯ä»¥è°ƒå°ä¸€ç‚¹; å¦‚æœç³»ç»Ÿåœ¨å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ¯”è¾ƒå¿™, çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ€»æ˜¯è¿œè¿œå¤šäº 25 ä¸ª, è¿™ä¸ªæ—¶å€™å°±å¯ä»¥æŠŠè¿™ä¸ªå‚æ•°è°ƒå¤§ä¸€ç‚¹, å› ä¸ºè¿™æ ·çº¿ç¨‹æ± å°±ä¸éœ€è¦åå¤åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹äº†.")]),s._v(" "),t("h4",{attrs:{id:"_37-tomcatå†…å­˜æº¢å‡ºçš„åŸå› åˆ†æåŠè°ƒä¼˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_37-tomcatå†…å­˜æº¢å‡ºçš„åŸå› åˆ†æåŠè°ƒä¼˜"}},[s._v("#")]),s._v(" 37.Tomcatå†…å­˜æº¢å‡ºçš„åŸå› åˆ†æåŠè°ƒä¼˜")]),s._v(" "),t("p",[s._v("ç¨‹åºå‘˜å‡ ä¹éƒ½ä¼šç¢°åˆ° java.lang.OutOfMemoryError å¼‚å¸¸, JVM åœ¨æŠ›å‡º java.lang.OutOfMemoryError æ—¶, é™¤äº†ä¼šæ‰“å°å‡ºä¸€è¡Œæè¿°ä¿¡æ¯, è¿˜ä¼šæ‰“å°å †æ ˆè·Ÿè¸ª, å› æ­¤å¯ä»¥é€šè¿‡è¿™äº›ä¿¡æ¯æ¥æ‰¾åˆ°å¯¼è‡´å¼‚å¸¸çš„åŸå› . åœ¨å¯»æ‰¾åŸå› å‰, å…ˆæ¥çœ‹çœ‹æœ‰å“ªäº›å› ç´ ä¼šå¯¼è‡´ OutOfMemoryError, å…¶ä¸­å†…å­˜æ³„æ¼æ˜¯å¯¼è‡´ OutOfMemoryError çš„ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åŸå› , æœ€åé€šè¿‡ä¸€ä¸ªå®æˆ˜æ¡ˆä¾‹æ¥å®šä½å†…å­˜æ³„æ¼.")]),s._v(" "),t("h5",{attrs:{id:"å†…å­˜æº¢å‡ºåœºæ™¯åŠæ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜æº¢å‡ºåœºæ™¯åŠæ–¹æ¡ˆ"}},[s._v("#")]),s._v(" å†…å­˜æº¢å‡ºåœºæ™¯åŠæ–¹æ¡ˆ")]),s._v(" "),t("blockquote",[t("p",[s._v("java.lang.OutOfMemoryError: Java heap space")])]),s._v(" "),t("p",[s._v("JVM æ— æ³•åœ¨å †ä¸­åˆ†é…å¯¹è±¡æ—¶, ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸, å¯¼è‡´è¿™ä¸ªå¼‚å¸¸çš„åŸå› å¯èƒ½æœ‰ä¸‰ç§:")]),s._v(" "),t("p",[s._v("(1) å†…å­˜æ³„æ¼. Java åº”ç”¨ç¨‹åºä¸€ç›´æŒæœ‰ Java å¯¹è±¡çš„å¼•ç”¨, å¯¼è‡´å¯¹è±¡æ— æ³•è¢« GC å›æ”¶, æ¯”å¦‚å¯¹è±¡æ± å’Œå†…å­˜æ± ä¸­çš„å¯¹è±¡æ— æ³•è¢« GC å›æ”¶.")]),s._v(" "),t("p",[s._v("(2) é…ç½®é—®é¢˜. æœ‰å¯èƒ½æ˜¯é€šè¿‡ JVM å‚æ•°æŒ‡å®šçš„å †å¤§å°(æˆ–è€…æœªæŒ‡å®šçš„é»˜è®¤å¤§å°), å¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´æ˜¯ä¸å¤Ÿçš„. è§£å†³åŠæ³•æ˜¯é€šè¿‡ JVM å‚æ•°åŠ å¤§å †çš„å¤§å°.")]),s._v(" "),t("p",[s._v('(3) finalize() æ–¹æ³•çš„è¿‡åº¦ä½¿ç”¨. å¦‚æœæƒ³åœ¨ Java ç±»å®ä¾‹è¢« GC ä¹‹å‰æ‰§è¡Œä¸€äº›é€»è¾‘, æ¯”å¦‚æ¸…ç†å¯¹è±¡æŒæœ‰çš„èµ„æº, å¯ä»¥åœ¨ Java ç±»ä¸­å®šä¹‰ finalize() æ–¹æ³•, è¿™æ · JVM GC ä¸ä¼šç«‹å³å›æ”¶è¿™äº›å¯¹è±¡å®ä¾‹, è€Œæ˜¯å°†å¯¹è±¡å®ä¾‹æ·»åŠ åˆ°ä¸€ä¸ªå« "java.lang.ref.Finalizer.ReferenceQueue" çš„é˜Ÿåˆ—ä¸­, æ‰§è¡Œå¯¹è±¡çš„ finalize() æ–¹æ³•, ä¹‹åæ‰ä¼šå›æ”¶è¿™äº›å¯¹è±¡. Finalizer çº¿ç¨‹ä¼šå’Œä¸»çº¿ç¨‹ç«äº‰ CPU èµ„æº, ä½†ç”±äºä¼˜å…ˆçº§ä½, æ‰€ä»¥å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šä¸»çº¿ç¨‹åˆ›å»ºå¯¹è±¡çš„é€Ÿåº¦, å› æ­¤ ReferenceQueue é˜Ÿåˆ—ä¸­çš„å¯¹è±¡å°±è¶Šæ¥è¶Šå¤š, æœ€ç»ˆä¼šæŠ›å‡º OutOfMemoryError. è§£å†³åŠæ³•æ˜¯å°½é‡ä¸è¦ç»™ Java ç±»å®šä¹‰ finalize() æ–¹æ³•.')]),s._v(" "),t("blockquote",[t("p",[s._v("java.lang.OutOfMemoryError: GC overhead limit exceeded")])]),s._v(" "),t("p",[s._v("å‡ºç°è¿™ç§ OutOfMemoryError çš„åŸå› æ˜¯, åƒåœ¾æ”¶é›†å™¨ä¸€ç›´åœ¨è¿è¡Œ, ä½†æ˜¯ GC æ•ˆç‡å¾ˆä½, æ¯”å¦‚ Java è¿›ç¨‹èŠ±è´¹è¶…è¿‡ 98ï¼… çš„ CPU æ—¶é—´æ¥è¿›è¡Œä¸€æ¬¡ GC, ä½†æ˜¯"),t("strong",[s._v("å›æ”¶çš„å†…å­˜å°‘äº 2ï¼… çš„ JVM å †, å¹¶ä¸”è¿ç»­ 5 æ¬¡ GC éƒ½æ˜¯è¿™ç§æƒ…å†µ")]),s._v(", å°±ä¼šæŠ›å‡º OutOfMemoryError.")]),s._v(" "),t("p",[s._v("è§£å†³åŠæ³•æ˜¯æŸ¥çœ‹ GC æ—¥å¿—æˆ–è€…ç”Ÿæˆ Heap Dump, ç¡®è®¤ä¸€ä¸‹æ˜¯ä¸æ˜¯å†…å­˜æ³„æ¼, å¦‚æœä¸æ˜¯å†…å­˜æ³„æ¼å¯ä»¥è€ƒè™‘å¢åŠ  Java å †çš„å¤§å°. å½“ç„¶è¿˜å¯ä»¥é€šè¿‡å‚æ•°é…ç½®æ¥å‘Šè¯‰ JVM æ— è®ºå¦‚ä½•ä¹Ÿä¸è¦æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸, æ–¹æ³•æ˜¯é…ç½® "),t("code",[s._v("-XX:-UseGCOverheadLimit")]),s._v("â€‹, ä½†æ˜¯ä¸æ¨èè¿™ä¹ˆåš, å› ä¸ºè¿™åªæ˜¯å»¶è¿Ÿäº† OutOfMemoryError çš„å‡ºç°.")]),s._v(" "),t("blockquote",[t("p",[s._v("java.lang.OutOfMemoryError: Requested array size exceeds VM limit")])]),s._v(" "),t("p",[s._v('ä»é”™è¯¯æ¶ˆæ¯ä¹Ÿèƒ½çŒœåˆ°, æŠ›å‡ºè¿™ç§å¼‚å¸¸çš„åŸå› æ˜¯"'),t("strong",[s._v("è¯·æ±‚çš„æ•°ç»„å¤§å°è¶…è¿‡ JVM é™åˆ¶")]),s._v('", åº”ç”¨ç¨‹åºå°è¯•åˆ†é…ä¸€ä¸ªè¶…å¤§çš„æ•°ç»„. æ¯”å¦‚åº”ç”¨ç¨‹åºå°è¯•åˆ†é… 512MB çš„æ•°ç»„, ä½†æœ€å¤§å †å¤§å°ä¸º 256MB, åˆ™å°†æŠ›å‡º OutOfMemoryError, å¹¶ä¸”è¯·æ±‚çš„æ•°ç»„å¤§å°è¶…è¿‡ VM é™åˆ¶.')]),s._v(" "),t("p",[s._v("é€šå¸¸è¿™ä¹Ÿæ˜¯ä¸€ä¸ªé…ç½®é—®é¢˜(JVM å †å¤ªå°), æˆ–è€…æ˜¯åº”ç”¨ç¨‹åºçš„ä¸€ä¸ª Bug, æ¯”å¦‚ç¨‹åºé”™è¯¯åœ°è®¡ç®—äº†æ•°ç»„çš„å¤§å°, å¯¼è‡´å°è¯•åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 1GB çš„æ•°ç»„.")]),s._v(" "),t("blockquote",[t("p",[s._v("java.lang.OutOfMemoryError: MetaSpace")])]),s._v(" "),t("p",[t("strong",[s._v("å¦‚æœ JVM çš„å…ƒç©ºé—´ç”¨å°½")]),s._v(", åˆ™ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸. ç”±äº JVM å…ƒç©ºé—´çš„å†…å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­åˆ†é…, ä½†æ˜¯å®ƒçš„å¤§å°å—å‚æ•° MaxMetaSpaceSize çš„é™åˆ¶. å½“å…ƒç©ºé—´å¤§å°è¶…è¿‡ MaxMetaSpaceSize æ—¶, JVM å°†æŠ›å‡ºå¸¦æœ‰ MetaSpace å­—æ ·çš„ OutOfMemoryError. è§£å†³åŠæ³•æ˜¯åŠ å¤§ MaxMetaSpaceSize å‚æ•°çš„å€¼.")]),s._v(" "),t("blockquote",[t("p",[s._v("java.lang.OutOfMemoryError: Request size bytes for reason. Out of swap space")])]),s._v(" "),t("p",[t("strong",[s._v("å½“æœ¬åœ°å †å†…å­˜åˆ†é…å¤±è´¥æˆ–è€…æœ¬åœ°å†…å­˜å¿«è¦è€—å°½æ—¶")]),s._v(', Java HotSpot VM ä»£ç ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸, VM ä¼šè§¦å‘ "è‡´å‘½é”™è¯¯å¤„ç†æœºåˆ¶", å®ƒä¼šç”Ÿæˆ "è‡´å‘½é”™è¯¯" æ—¥å¿—æ–‡ä»¶, å…¶ä¸­åŒ…å«å´©æºƒæ—¶çº¿ç¨‹, è¿›ç¨‹å’Œæ“ä½œç³»ç»Ÿçš„æœ‰ç”¨ä¿¡æ¯. å¦‚æœç¢°åˆ°æ­¤ç±»å‹çš„ OutOfMemoryError, éœ€è¦æ ¹æ® JVM æŠ›å‡ºçš„é”™è¯¯ä¿¡æ¯æ¥è¿›è¡Œè¯Šæ–­; æˆ–è€…ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ DTrace å·¥å…·æ¥è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨, çœ‹çœ‹æ˜¯ä»€ä¹ˆæ ·çš„ç¨‹åºä»£ç åœ¨ä¸æ–­åœ°åˆ†é…æœ¬åœ°å†…å­˜.')]),s._v(" "),t("blockquote",[t("p",[s._v("java.lang.OutOfMemoryError: Unable to create native threads")])]),s._v(" "),t("p",[s._v("æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸çš„è¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·çš„:")]),s._v(" "),t("p",[s._v("(1) Java ç¨‹åºå‘ JVM è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ Java çº¿ç¨‹.")]),s._v(" "),t("p",[s._v("(2) JVM æœ¬åœ°ä»£ç (Native Code)ä»£ç†è¯¥è¯·æ±‚, é€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿ API å»åˆ›å»ºä¸€ä¸ªæ“ä½œç³»ç»Ÿçº§åˆ«çš„çº¿ç¨‹ Native Thread.")]),s._v(" "),t("p",[s._v("(3) æ“ä½œç³»ç»Ÿå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„ Native Thread, éœ€è¦åŒæ—¶åˆ†é…ä¸€äº›å†…å­˜ç»™è¯¥çº¿ç¨‹, æ¯ä¸€ä¸ª Native Thread éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ ˆ, çº¿ç¨‹æ ˆçš„å¤§å°ç”± JVM å‚æ•° "),t("code",[s._v("-Xss")]),s._v("â€‹ å†³å®š.")]),s._v(" "),t("p",[s._v("(4) ç”±äºå„ç§åŸå› , æ“ä½œç³»ç»Ÿåˆ›å»ºæ–°çš„çº¿ç¨‹å¯èƒ½ä¼šå¤±è´¥, ä¸‹é¢ä¼šè¯¦ç»†è°ˆåˆ°.")]),s._v(" "),t("p",[s._v('(5) JVM æŠ›å‡º "java.lang.OutOfMemoryError: Unable to create new native thread" é”™è¯¯.')]),s._v(" "),t("p",[s._v("å› æ­¤å…³é”®åœ¨äºç¬¬å››æ­¥çº¿ç¨‹åˆ›å»ºå¤±è´¥, JVM å°±ä¼šæŠ›å‡º OutOfMemoryError, é‚£å…·ä½“æœ‰"),t("strong",[s._v("å“ªäº›å› ç´ ä¼šå¯¼è‡´çº¿ç¨‹åˆ›å»ºå¤±è´¥")]),s._v("å‘¢?")]),s._v(" "),t("p",[s._v("(1) "),t("strong",[s._v("å†…å­˜å¤§å°é™åˆ¶")]),s._v(": å‰é¢æåˆ°, Java åˆ›å»ºä¸€ä¸ªçº¿ç¨‹éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ ˆç©ºé—´, å¹¶é€šè¿‡ "),t("code",[s._v("-Xss")]),s._v("â€‹ å‚æ•°æŒ‡å®š. æ³¨æ„æ ˆç©ºé—´å¦‚æœè¿‡å°, å¯èƒ½ä¼šå¯¼è‡´ StackOverflowError, å°¤å…¶æ˜¯åœ¨é€’å½’è°ƒç”¨çš„æƒ…å†µä¸‹; ä½†æ˜¯æ ˆç©ºé—´è¿‡å¤§ä¼šå ç”¨è¿‡å¤šå†…å­˜, è€Œå¯¹äºä¸€ä¸ª 32 ä½ Java åº”ç”¨æ¥è¯´, ç”¨æˆ·è¿›ç¨‹ç©ºé—´æ˜¯ 4GB, å†…æ ¸å ç”¨ 1GB, é‚£ä¹ˆç”¨æˆ·ç©ºé—´å°±å‰©ä¸‹ 3GB, å› æ­¤å®ƒèƒ½åˆ›å»ºçš„çº¿ç¨‹æ•°å¤§è‡´å¯ä»¥é€šè¿‡è¿™ä¸ªå…¬å¼ç®—å‡ºæ¥:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Max memory(3GB) = [-Xmx] + [-XX:MaxMetaSpaceSize] + number_of_threads * [-Xss]\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¸è¿‡å¯¹äº 64 ä½çš„åº”ç”¨, ç”±äºè™šæ‹Ÿè¿›ç¨‹ç©ºé—´è¿‘ä¹æ— é™å¤§, å› æ­¤ä¸ä¼šå› ä¸ºçº¿ç¨‹æ ˆè¿‡å¤§è€Œè€—å°½è™šæ‹Ÿåœ°å€ç©ºé—´. æ³¨æ„, 64 ä½çš„ Java è¿›ç¨‹èƒ½åˆ†é…çš„æœ€å¤§å†…å­˜æ•°ä»ç„¶å—ç‰©ç†å†…å­˜å¤§å°çš„é™åˆ¶.")]),s._v(" "),t("p",[s._v("(2) "),t("strong",[s._v("ulimit é™åˆ¶")]),s._v(", åœ¨ Linux ä¸‹æ‰§è¡Œ "),t("code",[s._v("ulimit -a")]),s._v("â€‹, å¯ä»¥çœ‹åˆ° ulimit å¯¹å„ç§èµ„æºçš„é™åˆ¶.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\ncore "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" size          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("blocks, -c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unlimited\ndata seg size           "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes, -d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unlimited\nscheduling priority             "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" size               "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("blocks, -f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unlimited\npending signals                 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1028666")]),s._v("\nmax locked memory       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes, -l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\nmax memory size         "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes, -m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unlimited\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" files                      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),s._v("\npipe size            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(" bytes, -p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nPOSIX message queues     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes, -q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("819200")]),s._v("\nreal-time priority              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nstack size              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes, -s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# çº¿ç¨‹æ ˆå¤§å°")]),s._v("\ncpu "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("seconds, -t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unlimited\nmax user processes              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-u"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unlimited    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸€ä¸ªè¿›ç¨‹èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°")]),s._v("\nvirtual memory          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes, -v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unlimited\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" locks                      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unlimited\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v('å…¶ä¸­çš„ "max user processes" å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°, å¯ä»¥ä¿®æ”¹è¿™ä¸ªå‚æ•°:')]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ulimit -u 65535")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("(3) "),t("strong",[s._v("å‚æ•° "),t("strong",[s._v("â€‹")]),s._v("â€‹"),t("code",[s._v("sys.kernel.threads-max")]),s._v("â€‹")]),s._v("â€‹ "),t("strong",[s._v("é™åˆ¶")]),s._v(". è¿™ä¸ªå‚æ•°é™åˆ¶æ“ä½œç³»ç»Ÿå…¨å±€çš„çº¿ç¨‹æ•°, é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹å®ƒçš„å€¼.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/kernel/threads-max\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1030516")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™è¡¨æ˜å½“å‰ç³»ç»Ÿèƒ½åˆ›å»ºçš„æ€»çš„çº¿ç¨‹æ˜¯ 1030516. å½“ç„¶è°ƒæ•´è¿™ä¸ªå‚æ•°, å…·ä½“åŠæ³•æ˜¯:")]),s._v(" "),t("p",[s._v("åœ¨ "),t("code",[s._v("/etc/sysctl.conf")]),s._v("â€‹ é…ç½®æ–‡ä»¶ä¸­, åŠ å…¥ "),t("code",[s._v("sys.kernel.threads-max = 999999")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("(4) "),t("strong",[s._v("å‚æ•° "),t("strong",[s._v("â€‹")]),s._v("â€‹"),t("code",[s._v("sys.kernel.pid_max")]),s._v("â€‹")]),s._v("â€‹ "),t("strong",[s._v("é™åˆ¶")]),s._v(", è¿™ä¸ªå‚æ•°è¡¨ç¤ºç³»ç»Ÿå…¨å±€çš„ PID å·æ•°å€¼çš„é™åˆ¶, æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ ID, ID çš„å€¼è¶…è¿‡è¿™ä¸ªæ•°, çº¿ç¨‹å°±ä¼šåˆ›å»ºå¤±è´¥. è·Ÿ "),t("code",[s._v("sys.kernel.threads-max")]),s._v("â€‹ å‚æ•°ä¸€æ ·, ä¹Ÿå¯ä»¥å°† "),t("code",[s._v("sys.kernel.pid_max")]),s._v("â€‹ è°ƒå¤§, æ–¹æ³•æ˜¯åœ¨ "),t("code",[s._v("/etc/sysctl.conf")]),s._v("â€‹ é…ç½®æ–‡ä»¶ä¸­, åŠ å…¥ "),t("code",[s._v("sys.kernel.pid_max = 999999")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("å¯¹äºçº¿ç¨‹åˆ›å»ºå¤±è´¥çš„ OutOfMemoryError, é™¤äº†è°ƒæ•´å„ç§å‚æ•°, è¿˜éœ€è¦ä»ç¨‹åºæœ¬èº«æ‰¾æ‰¾åŸå› , çœ‹çœ‹æ˜¯å¦çœŸçš„éœ€è¦è¿™ä¹ˆå¤šçº¿ç¨‹, æœ‰å¯èƒ½æ˜¯ç¨‹åºçš„ Bug å¯¼è‡´åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹.")]),s._v(" "),t("h5",{attrs:{id:"å†…å­˜æ³„æ¼å®šä½å®æˆ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜æ³„æ¼å®šä½å®æˆ˜"}},[s._v("#")]),s._v(" å†…å­˜æ³„æ¼å®šä½å®æˆ˜")]),s._v(" "),t("p",[s._v("å…ˆåˆ›å»ºä¸€ä¸ª Web åº”ç”¨, ä¸æ–­åœ° new æ–°å¯¹è±¡æ”¾åˆ°ä¸€ä¸ª List ä¸­, æ¥æ¨¡æ‹Ÿ Web åº”ç”¨ä¸­çš„å†…å­˜æ³„æ¼. ç„¶åé€šè¿‡å„ç§å·¥å…·æ¥è§‚å¯Ÿ GC çš„è¡Œä¸º, æœ€åé€šè¿‡ç”Ÿæˆ Heap Dump æ¥æ‰¾åˆ°æ³„æ¼ç‚¹.")]),s._v(" "),t("p",[s._v("å†…å­˜æ³„æ¼æ¨¡æ‹Ÿç¨‹åºæ¯”è¾ƒç®€å•, åˆ›å»ºä¸€ä¸ª Spring Boot åº”ç”¨, å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºçš„ç±»:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scheduling"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Scheduled")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stereotype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Component")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedList")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MemLeaker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" objs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Scheduled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fixedRate "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            objs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("è¿™ä¸ªç¨‹åºåšçš„äº‹æƒ…å°±æ˜¯æ¯éš” 1 ç§’å‘ä¸€ä¸ª List ä¸­æ·»åŠ  50000 ä¸ªå¯¹è±¡. æ¥ä¸‹æ¥è¿è¡Œå¹¶é€šè¿‡å·¥å…·è§‚å¯Ÿå®ƒçš„ GC è¡Œä¸º:")]),s._v(" "),t("p",[s._v("(1) è¿è¡Œç¨‹åºå¹¶æ‰“å¼€ verbosegc, å°† GC çš„æ—¥å¿—è¾“å‡ºåˆ° gc.log æ–‡ä»¶ä¸­.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("java -verbose:gc -Xloggc:gc.log -XX:+PrintGCDetails -jar mem-0.0.1-SNAPSHOT.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("(2) ä½¿ç”¨"),t("code",[s._v("jstat")]),s._v("â€‹å‘½ä»¤è§‚å¯Ÿ GC çš„è¿‡ç¨‹:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("jstat -gc 94223 2000 1000\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("94223 æ˜¯ç¨‹åºçš„è¿›ç¨‹ ID, 2000 è¡¨ç¤ºæ¯éš” 2 ç§’æ‰§è¡Œä¸€æ¬¡, 1000 è¡¨ç¤ºæŒç»­æ‰§è¡Œ 1000 æ¬¡. ä¸‹é¢æ˜¯å‘½ä»¤çš„è¾“å‡º:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162534-2mas2x2.png",alt:""}})]),s._v(" "),t("p",[s._v("å…¶ä¸­æ¯ä¸€åˆ—çš„å«ä¹‰æ˜¯:")]),s._v(" "),t("ul",[t("li",[s._v("S0C: ç¬¬ä¸€ä¸ª Survivor åŒºæ€»çš„å¤§å°;")]),s._v(" "),t("li",[s._v("S1C: ç¬¬äºŒä¸ª Survivor åŒºæ€»çš„å¤§å°;")]),s._v(" "),t("li",[s._v("S0U: ç¬¬ä¸€ä¸ª Survivor åŒºå·²ä½¿ç”¨å†…å­˜çš„å¤§å°;")]),s._v(" "),t("li",[s._v("S1U: ç¬¬äºŒä¸ª Survivor åŒºå·²ä½¿ç”¨å†…å­˜çš„å¤§å°.")])]),s._v(" "),t("p",[s._v("åé¢çš„åˆ—ä¸­ E ä»£è¡¨ Eden, O ä»£è¡¨ Old, M ä»£è¡¨ Metadata; YGC è¡¨ç¤º Minor GC çš„æ€»æ—¶é—´, YGCT è¡¨ç¤º Minor GC çš„æ¬¡æ•°; FGC è¡¨ç¤º Full GC.")]),s._v(" "),t("p",[s._v("é€šè¿‡è¿™ä¸ªå·¥å…·èƒ½å¤§æ¦‚çœ‹åˆ°å„ä¸ªå†…å­˜åŒºåŸŸçš„å¤§å°, å·²ç» GC çš„æ¬¡æ•°å’Œæ‰€èŠ±çš„æ—¶é—´. verbosegc å‚æ•°å¯¹ç¨‹åºçš„å½±å“æ¯”è¾ƒå°, å› æ­¤å¾ˆé€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒç°åœºä½¿ç”¨.")]),s._v(" "),t("p",[s._v("(3) é€šè¿‡ GCViewer å·¥å…·æŸ¥çœ‹ GC æ—¥å¿—, ç”¨ GCViewer æ‰“å¼€ç¬¬ä¸€æ­¥äº§ç”Ÿçš„ gc.log, ä¼šçœ‹åˆ°è¿™æ ·çš„å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162534-3n59227.png",alt:""}})]),s._v(" "),t("p",[s._v("å›¾ä¸­çº¢è‰²çš„çº¿è¡¨ç¤ºå¹´è€ä»£å ç”¨çš„å†…å­˜, å¯ä»¥çœ‹åˆ°å®ƒä¸€ç›´åœ¨å¢åŠ , è€Œé»‘è‰²çš„ç«–çº¿è¡¨ç¤ºä¸€æ¬¡ Full GC. å¯ä»¥çœ‹åˆ°åæœŸ JVM åœ¨é¢‘ç¹åœ° Full GC, ä½†æ˜¯"),t("strong",[s._v("å¹´è€ä»£çš„å†…å­˜å¹¶æ²¡æœ‰é™ä¸‹æ¥, è¿™æ˜¯å…¸å‹çš„å†…å­˜æ³„æ¼çš„ç‰¹å¾")]),s._v(".")]),s._v(" "),t("p",[s._v("é™¤äº†å†…å­˜æ³„æ¼, è¿˜å¯ä»¥é€šè¿‡ GCViewer æ¥è§‚å¯Ÿ Minor GC å’Œ Full GC çš„é¢‘æ¬¡, å·²åŠæ¯æ¬¡çš„å†…å­˜å›æ”¶é‡.")]),s._v(" "),t("p",[s._v("(4) ä¸ºäº†æ‰¾åˆ°å†…å­˜æ³„æ¼ç‚¹, é€šè¿‡ jmap å·¥å…·ç”Ÿæˆ Heap Dump:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("jmap -dump:live,format=b,file=94223.bin 94223\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("(5) ç”¨ Eclipse Memory Analyzer æ‰“å¼€ Dump æ–‡ä»¶, é€šè¿‡å†…å­˜æ³„æ¼åˆ†æ, å¾—åˆ°è¿™æ ·ä¸€ä¸ªåˆ†ææŠ¥å‘Š:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162534-2iypr18.png",alt:""}})]),s._v(" "),t("p",[s._v("ä»æŠ¥å‘Šä¸­å¯ä»¥çœ‹åˆ°, JVM å†…å­˜ä¸­æœ‰ä¸€ä¸ªé•¿åº¦ä¸º 4000 ä¸‡çš„ List, è‡³æ­¤ä¹Ÿå°±æ‰¾åˆ°äº†æ³„æ¼ç‚¹.")]),s._v(" "),t("h4",{attrs:{id:"_38-tomcatæ‹’ç»è¿æ¥åŸå› åˆ†æåŠç½‘ç»œä¼˜åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_38-tomcatæ‹’ç»è¿æ¥åŸå› åˆ†æåŠç½‘ç»œä¼˜åŒ–"}},[s._v("#")]),s._v(" 38.Tomcatæ‹’ç»è¿æ¥åŸå› åˆ†æåŠç½‘ç»œä¼˜åŒ–")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ¥çœ‹çœ‹ç½‘ç»œé€šä¿¡ä¸­å¯èƒ½ä¼šç¢°åˆ°çš„å„ç§é”™è¯¯. ç½‘ç»œé€šä¿¡æ–¹é¢çš„é”™è¯¯å’Œå¼‚å¸¸ä¹Ÿæ˜¯åœ¨å®é™…å·¥ä½œä¸­ç»å¸¸ç¢°åˆ°çš„, éœ€è¦ç†è§£å¼‚å¸¸èƒŒåçš„åŸç†, æ‰èƒ½æ›´å¿«æ›´ç²¾å‡†åœ°å®šä½é—®é¢˜, ä»è€Œæ‰¾åˆ°è§£å†³åŠæ³•.")]),s._v(" "),t("p",[s._v("ä¸‹é¢ä¼šå…ˆè®²è®² Java Socket ç½‘ç»œç¼–ç¨‹å¸¸è§çš„å¼‚å¸¸æœ‰å“ªäº›, ç„¶åé€šè¿‡ä¸€ä¸ªå®éªŒæ¥é‡ç°å…¶ä¸­çš„ Connection reset å¼‚å¸¸, å¹¶ä¸”é€šè¿‡é…ç½® Tomcat çš„å‚æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"å¸¸è§å¼‚å¸¸"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¸¸è§å¼‚å¸¸"}},[s._v("#")]),s._v(" å¸¸è§å¼‚å¸¸")]),s._v(" "),t("blockquote",[t("p",[s._v("java.net.SocketTimeoutException")])]),s._v(" "),t("p",[t("strong",[s._v("æŒ‡è¶…æ—¶é”™è¯¯")]),s._v(". è¶…æ—¶åˆ†ä¸º"),t("strong",[s._v("è¿æ¥è¶…æ—¶")]),s._v("å’Œ"),t("strong",[s._v("è¯»å–è¶…æ—¶")]),s._v(", è¿æ¥è¶…æ—¶æ˜¯æŒ‡åœ¨è°ƒç”¨ Socket.connect æ–¹æ³•çš„æ—¶å€™è¶…æ—¶, è€Œè¯»å–è¶…æ—¶æ˜¯è°ƒç”¨ Socket.read æ–¹æ³•æ—¶è¶…æ—¶. è¿æ¥è¶…æ—¶å¾€å¾€æ˜¯ç”±äºç½‘ç»œä¸ç¨³å®šé€ æˆçš„, ä½†æ˜¯è¯»å–è¶…æ—¶ä¸ä¸€å®šæ˜¯ç½‘ç»œå»¶è¿Ÿé€ æˆçš„, å¾ˆæœ‰å¯èƒ½æ˜¯ä¸‹æ¸¸æœåŠ¡çš„å“åº”æ—¶é—´è¿‡é•¿.")]),s._v(" "),t("blockquote",[t("p",[s._v("java.net.BindException: Address already in use: JVM_Bind")])]),s._v(" "),t("p",[t("strong",[s._v("æŒ‡ç«¯å£è¢«å ç”¨")]),s._v(". å½“æœåŠ¡å™¨ç«¯è°ƒç”¨ new ServerSocket(port) æˆ–è€… Socket.bind å‡½æ•°æ—¶, å¦‚æœç«¯å£å·²ç»è¢«å ç”¨, å°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸. å¯ä»¥ç”¨ "),t("code",[s._v("netstat â€“an")]),s._v("â€‹ å‘½ä»¤æ¥æŸ¥çœ‹ç«¯å£è¢«è°å ç”¨äº†, æ¢ä¸€ä¸ªæ²¡æœ‰è¢«å ç”¨çš„ç«¯å£å°±èƒ½è§£å†³.")]),s._v(" "),t("blockquote",[t("p",[s._v("java.net.ConnectException: Connection refused: connect")])]),s._v(" "),t("p",[t("strong",[s._v("æŒ‡è¿æ¥è¢«æ‹’ç»")]),s._v(". å½“å®¢æˆ·ç«¯è°ƒç”¨ new Socket(ip, port) æˆ–è€… Socket.connect å‡½æ•°æ—¶, å¯èƒ½ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸. åŸå› æ˜¯æŒ‡å®š IP åœ°å€çš„æœºå™¨æ²¡æœ‰æ‰¾åˆ°; æˆ–è€…æ˜¯æœºå™¨å­˜åœ¨, ä½†è¿™ä¸ªæœºå™¨ä¸Šæ²¡æœ‰å¼€å¯æŒ‡å®šçš„ç›‘å¬ç«¯å£.")]),s._v(" "),t("p",[s._v("è§£å†³åŠæ³•æ˜¯ä»å®¢æˆ·ç«¯æœºå™¨ ping ä¸€ä¸‹æœåŠ¡ç«¯ IP, å‡å¦‚ ping ä¸é€š, å¯ä»¥çœ‹çœ‹ IP æ˜¯ä¸æ˜¯å†™é”™äº†; å‡å¦‚èƒ½ ping é€š, éœ€è¦ç¡®è®¤æœåŠ¡ç«¯çš„æœåŠ¡æ˜¯ä¸æ˜¯å´©æºƒäº†.")]),s._v(" "),t("blockquote",[t("p",[s._v("java.net.SocketException: Socket is closed")])]),s._v(" "),t("p",[t("strong",[s._v("æŒ‡è¿æ¥å·²å…³é—­")]),s._v(". å‡ºç°è¿™ä¸ªå¼‚å¸¸çš„åŸå› æ˜¯"),t("strong",[s._v("é€šä¿¡çš„ä¸€æ–¹ä¸»åŠ¨å…³é—­äº† Socket è¿æ¥(è°ƒç”¨äº† Socket çš„ close æ–¹æ³•), æ¥ç€åˆå¯¹ Socket è¿æ¥è¿›è¡Œäº†è¯»å†™æ“ä½œ")]),s._v(', è¿™æ—¶æ“ä½œç³»ç»Ÿä¼šæŠ¥ "Socket è¿æ¥å·²å…³é—­" çš„é”™è¯¯.')]),s._v(" "),t("blockquote",[t("p",[s._v("java.net.SocketException: Connection reset/Connect reset by peer: Socket write error")])]),s._v(" "),t("p",[t("strong",[s._v("æŒ‡è¿æ¥è¢«é‡ç½®")]),s._v(". è¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µ, åˆ†åˆ«å¯¹åº”ä¸¤ç§é”™è¯¯, "),t("strong",[s._v("é€šä¿¡çš„ä¸€æ–¹å·²ç»å°† Socket å…³é—­, å¯èƒ½æ˜¯ä¸»åŠ¨å…³é—­æˆ–è€…æ˜¯å› ä¸ºå¼‚å¸¸é€€å‡º")]),s._v(", (1) è¿™æ—¶å¦‚æœé€šä¿¡çš„å¦ä¸€æ–¹è¿˜åœ¨"),t("strong",[s._v("å†™æ•°æ®")]),s._v(", å°±ä¼šè§¦å‘è¿™ä¸ªå¼‚å¸¸(Connect reset by peer); (2) å¦‚æœå¯¹æ–¹è¿˜åœ¨å°è¯•ä» TCP è¿æ¥ä¸­"),t("strong",[s._v("è¯»æ•°æ®")]),s._v(", åˆ™ä¼šæŠ›å‡º Connection reset å¼‚å¸¸.")]),s._v(" "),t("p",[s._v("ä¸ºäº†é¿å…è¿™äº›å¼‚å¸¸å‘ç”Ÿ, åœ¨ç¼–å†™ç½‘ç»œé€šä¿¡ç¨‹åºæ—¶è¦ç¡®ä¿:")]),s._v(" "),t("ul",[t("li",[s._v("**ç¨‹åºé€€å‡ºå‰è¦ä¸»åŠ¨å…³é—­æ‰€æœ‰çš„ç½‘ç»œè¿æ¥. **")]),s._v(" "),t("li",[s._v("**æ£€æµ‹é€šä¿¡çš„å¦ä¸€æ–¹çš„å…³é—­è¿æ¥æ“ä½œ, å½“å‘ç°å¦ä¸€æ–¹å…³é—­è¿æ¥åè‡ªå·±ä¹Ÿè¦å…³é—­è¯¥è¿æ¥. **")])]),s._v(" "),t("blockquote",[t("p",[s._v("java.net.SocketException: Broken pipe")])]),s._v(" "),t("p",[t("strong",[s._v("æŒ‡é€šä¿¡ç®¡é“å·²å")]),s._v('. å‘ç”Ÿè¿™ä¸ªå¼‚å¸¸çš„åœºæ™¯æ˜¯, é€šä¿¡çš„ä¸€æ–¹åœ¨æ”¶åˆ° "Connect reset by peer: Socket write error" å, å¦‚æœ'),t("strong",[s._v("å†ç»§ç»­å†™æ•°æ®")]),s._v("åˆ™ä¼šæŠ›å‡º Broken pipe å¼‚å¸¸, è§£å†³æ–¹æ³•åŒä¸Š.")]),s._v(" "),t("blockquote",[t("p",[s._v("java.net.SocketException: Too many open files")])]),s._v(" "),t("p",[t("strong",[s._v("æŒ‡è¿›ç¨‹æ‰“å¼€æ–‡ä»¶å¥æŸ„æ•°è¶…è¿‡é™åˆ¶")]),s._v(". å½“å¹¶å‘ç”¨æˆ·æ•°æ¯”è¾ƒå¤§æ—¶, æœåŠ¡å™¨å¯èƒ½ä¼šæŠ¥è¿™ä¸ªå¼‚å¸¸. è¿™æ˜¯å› ä¸ºæ¯åˆ›å»ºä¸€ä¸ª Socket è¿æ¥å°±éœ€è¦ä¸€ä¸ªæ–‡ä»¶å¥æŸ„, æ­¤å¤–æœåŠ¡ç«¯ç¨‹åºåœ¨å¤„ç†è¯·æ±‚æ—¶å¯èƒ½ä¹Ÿéœ€è¦æ‰“å¼€ä¸€äº›æ–‡ä»¶.")]),s._v(" "),t("p",[s._v("å¯ä»¥é€šè¿‡ "),t("code",[s._v("lsof -p pid")]),s._v("â€‹ å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€äº†å“ªäº›æ–‡ä»¶, æ˜¯ä¸æ˜¯æœ‰èµ„æºæ³„éœ², ä¹Ÿå°±æ˜¯è¯´è¿›ç¨‹æ‰“å¼€çš„è¿™äº›æ–‡ä»¶æœ¬åº”è¯¥è¢«å…³é—­, ä½†ç”±äºç¨‹åºçš„ Bug è€Œæ²¡æœ‰è¢«å…³é—­.")]),s._v(" "),t("p",[s._v("å¦‚æœæ²¡æœ‰èµ„æºæ³„éœ², å¯ä»¥é€šè¿‡è®¾ç½®å¢åŠ æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°. å…·ä½“æ–¹æ³•æ˜¯é€šè¿‡ "),t("code",[s._v("ulimit -a")]),s._v("â€‹ æ¥æŸ¥çœ‹ç³»ç»Ÿç›®å‰èµ„æºé™åˆ¶, é€šè¿‡ "),t("code",[s._v("ulimit -n 10240")]),s._v("â€‹ ä¿®æ”¹æœ€å¤§æ–‡ä»¶æ•°.")]),s._v(" "),t("h5",{attrs:{id:"tomcatç½‘ç»œå‚æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatç½‘ç»œå‚æ•°"}},[s._v("#")]),s._v(" Tomcatç½‘ç»œå‚æ•°")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥çœ‹çœ‹ Tomcat ä¸¤ä¸ªæ¯”è¾ƒå…³é”®çš„å‚æ•°: "),t("mark",[t("strong",[s._v("maxConnections å’Œ acceptCount")])]),s._v(". åœ¨è§£é‡Šè¿™ä¸ªå‚æ•°ä¹‹å‰, å…ˆç®€å•å›é¡¾ä¸‹ TCP è¿æ¥çš„å»ºç«‹è¿‡ç¨‹: å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ SYN åŒ…, æœåŠ¡ç«¯å›å¤ SYNï¼‹ACK, åŒæ—¶å°†è¿™ä¸ªå¤„äº SYN_RECV çŠ¶æ€çš„è¿æ¥ä¿å­˜åˆ°"),t("strong",[s._v("åŠè¿æ¥é˜Ÿåˆ—")]),s._v(". å®¢æˆ·ç«¯è¿”å› ACK åŒ…å®Œæˆä¸‰æ¬¡æ¡æ‰‹, æœåŠ¡ç«¯å°† ESTABLISHED çŠ¶æ€çš„è¿æ¥ç§»å…¥"),t("strong",[s._v("accept é˜Ÿåˆ—")]),s._v(", ç­‰å¾…åº”ç”¨ç¨‹åº(Tomcat)è°ƒç”¨ accept æ–¹æ³•å°†è¿æ¥å–èµ°. è¿™é‡Œæ¶‰åŠä¸¤ä¸ªé˜Ÿåˆ—:")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("åŠè¿æ¥é˜Ÿåˆ—")]),s._v(": ä¿å­˜ SYN_RECV çŠ¶æ€çš„è¿æ¥. é˜Ÿåˆ—é•¿åº¦ç”± "),t("code",[s._v("net.ipv4.tcp_max_syn_backlog")]),s._v("â€‹ è®¾ç½®.")]),s._v(" "),t("li",[t("strong",[s._v("accept é˜Ÿåˆ—")]),s._v(": ä¿å­˜ ESTABLISHED çŠ¶æ€çš„è¿æ¥. é˜Ÿåˆ—é•¿åº¦ä¸º "),t("code",[s._v("min(net.core.somaxconn, backlog)")]),s._v("â€‹. å…¶ä¸­ backlog æ˜¯åˆ›å»º ServerSocket æ—¶æŒ‡å®šçš„å‚æ•°, æœ€ç»ˆä¼šä¼ é€’ç»™ listen æ–¹æ³•:")])]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" backlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æœè®¾ç½®çš„ backlog å¤§äº "),t("code",[s._v("net.core.somaxconn")]),s._v("â€‹, accept é˜Ÿåˆ—çš„é•¿åº¦å°†è¢«è®¾ç½®ä¸º "),t("code",[s._v("net.core.somaxconn")]),s._v("â€‹, è€Œè¿™ä¸ª backlog å‚æ•°å°±æ˜¯ Tomcat ä¸­çš„ "),t("strong",[s._v("acceptCount ** å‚æ•°, é»˜è®¤å€¼æ˜¯ 100, ä½†è¯·æ³¨æ„ "),t("code",[s._v("net.core.somaxconn")]),s._v("â€‹ çš„é»˜è®¤å€¼æ˜¯ 128. å¯ä»¥æƒ³è±¡åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹å½“ Tomcat æ¥ä¸åŠå¤„ç†æ–°çš„è¿æ¥æ—¶, è¿™äº›")]),s._v("è¿æ¥éƒ½è¢«å †ç§¯åœ¨ accept é˜Ÿåˆ—**ä¸­, è€Œ **acceptCount ** å‚æ•°å¯ä»¥æ§åˆ¶ accept é˜Ÿåˆ—çš„é•¿åº¦, è¶…è¿‡è¿™ä¸ªé•¿åº¦æ—¶, å†…æ ¸ä¼šå‘å®¢æˆ·ç«¯å‘é€ RST, è¿™æ ·å®¢æˆ·ç«¯ä¼šè§¦å‘ä¸Šæ–‡æåˆ°çš„  "),t("strong",[s._v('"Connection reset" å¼‚å¸¸')]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œ Tomcat ä¸­çš„ "),t("strong",[s._v("maxConnections ** æ˜¯")]),s._v("æŒ‡ Tomcat åœ¨ä»»æ„æ—¶åˆ»æ¥æ”¶å’Œå¤„ç†çš„æœ€å¤§è¿æ¥æ•°**. å½“ Tomcat æ¥æ”¶çš„è¿æ¥æ•°è¾¾åˆ° maxConnections æ—¶, Acceptor çº¿ç¨‹ä¸ä¼šå†ä» accept é˜Ÿåˆ—ä¸­å–èµ°è¿æ¥, è¿™æ—¶ accept é˜Ÿåˆ—ä¸­çš„è¿æ¥ä¼šè¶Šç§¯è¶Šå¤š.")]),s._v(" "),t("p",[s._v("maxConnections çš„é»˜è®¤å€¼ä¸è¿æ¥å™¨ç±»å‹æœ‰å…³: NIO çš„é»˜è®¤å€¼æ˜¯ 10000, APR é»˜è®¤æ˜¯ 8192.")]),s._v(" "),t("p",[s._v("**æ‰€ä»¥å¯ä»¥å‘ç° Tomcat çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ç­‰äº **â€‹"),t("mark",[t("strong",[s._v("maxConnections + acceptCount")])]),s._v("â€‹ "),t("strong",[s._v(". å¦‚æœ acceptCount è®¾ç½®å¾—è¿‡å¤§, è¯·æ±‚ç­‰å¾…æ—¶é—´ä¼šæ¯”è¾ƒé•¿; å¦‚æœ acceptCount è®¾ç½®è¿‡å°, é«˜å¹¶å‘æƒ…å†µä¸‹, å®¢æˆ·ç«¯ä¼šç«‹å³è§¦å‘ Connection reset å¼‚å¸¸.")])]),s._v(" "),t("h5",{attrs:{id:"tomcatç½‘ç»œè°ƒä¼˜å®æˆ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcatç½‘ç»œè°ƒä¼˜å®æˆ˜"}},[s._v("#")]),s._v(" Tomcatç½‘ç»œè°ƒä¼˜å®æˆ˜")]),s._v(" "),t("p",[s._v('æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªç›´è§‚çš„ä¾‹å­æ¥åŠ æ·±å¯¹ä¸Šé¢ä¸¤ä¸ªå‚æ•°çš„ç†è§£. å…ˆé‡ç°æµé‡é«˜å³°æ—¶ accept é˜Ÿåˆ—å †ç§¯çš„æƒ…å†µ, è¿™æ ·ä¼šå¯¼è‡´å®¢æˆ·ç«¯è§¦å‘ "Connection reset" å¼‚å¸¸, ç„¶åé€šè¿‡è°ƒæ•´å‚æ•°è§£å†³è¿™ä¸ªé—®é¢˜. ä¸»è¦æ­¥éª¤æœ‰:')]),s._v(" "),t("p",[s._v("(1) é€šè¿‡ JMeter åˆ›å»ºä¸€ä¸ªæµ‹è¯•è®¡åˆ’, ä¸€ä¸ªçº¿ç¨‹ç»„, ä¸€ä¸ªè¯·æ±‚, å¦‚ä¸‹å›¾æ‰€ç¤º.")]),s._v(" "),t("p",[t("strong",[s._v("æµ‹è¯•è®¡åˆ’")]),s._v(":")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162552-ek8x6vq.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("çº¿ç¨‹ç»„")]),s._v("(çº¿ç¨‹æ•°è¿™é‡Œè®¾ç½®ä¸º 1000, æ¨¡æ‹Ÿå¤§æµé‡):")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162552-xjskmao.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("è¯·æ±‚")]),s._v("(è¯·æ±‚çš„è·¯å¾„æ˜¯ Tomcat è‡ªå¸¦çš„ä¾‹å­ç¨‹åº):")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162553-b88ed3i.png",alt:""}})]),s._v(" "),t("p",[s._v("(2) å¯åŠ¨ Tomcat.")]),s._v(" "),t("p",[s._v('(3) å¼€å¯ JMeter æµ‹è¯•, åœ¨ View Results Tree ä¸­ä¼šçœ‹åˆ°å¤§é‡å¤±è´¥çš„è¯·æ±‚, è¯·æ±‚çš„å“åº”é‡Œæœ‰ "Connection reset" å¼‚å¸¸, ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„, å½“ accept é˜Ÿåˆ—æº¢å‡ºæ—¶, æœåŠ¡ç«¯çš„å†…æ ¸å‘é€äº† RST ç»™å®¢æˆ·ç«¯, ä½¿å¾—å®¢æˆ·ç«¯æŠ›å‡ºäº†è¿™ä¸ªå¼‚å¸¸.')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162553-581oils.png",alt:""}})]),s._v(" "),t("p",[s._v("(4) ä¿®æ”¹å†…æ ¸å‚æ•°, åœ¨ "),t("code",[s._v("/etc/sysctl.conf")]),s._v("â€‹ ä¸­å¢åŠ ä¸€è¡Œ "),t("code",[s._v("net.core.somaxconn=2048")]),s._v("â€‹, ç„¶åæ‰§è¡Œå‘½ä»¤ "),t("code",[s._v("sysctl -p")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("(5) ä¿®æ”¹ Tomcat å‚æ•° acceptCount ä¸º 2048, é‡å¯ Tomcat.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162553-eebcvda.png",alt:""}})]),s._v(" "),t("p",[s._v("(6) å†æ¬¡å¯åŠ¨ JMeter æµ‹è¯•, è¿™ä¸€æ¬¡æ‰€æœ‰çš„è¯·æ±‚ä¼šæˆåŠŸ, ä¹Ÿçœ‹ä¸åˆ°å¼‚å¸¸äº†. å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤çœ‹åˆ°ç³»ç»Ÿä¸­ ESTABLISHED çš„è¿æ¥æ•°å¢å¤§äº†, è¿™æ˜¯å› ä¸ºåŠ å¤§äº† accept é˜Ÿåˆ—çš„é•¿åº¦.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162553-z8bo9vz.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-18"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-18"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("Tomcat ä¸­ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°: acceptCount å’Œ maxConnections. acceptCount ç”¨æ¥æ§åˆ¶å†…æ ¸çš„ TCP è¿æ¥é˜Ÿåˆ—é•¿åº¦, maxConnections ç”¨äºæ§åˆ¶ Tomcat å±‚é¢çš„æœ€å¤§è¿æ¥æ•°. åœ¨å®æˆ˜ç¯èŠ‚, é€šè¿‡è°ƒæ•´ acceptCount å’Œç›¸å…³çš„å†…æ ¸å‚æ•° "),t("code",[s._v("somaxconn")]),s._v("â€‹, å¢åŠ äº†ç³»ç»Ÿçš„å¹¶å‘åº¦.")]),s._v(" "),t("h4",{attrs:{id:"_39-tomcatè¿›ç¨‹å ç”¨cpuè¿‡é«˜æ€ä¹ˆåŠ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_39-tomcatè¿›ç¨‹å ç”¨cpuè¿‡é«˜æ€ä¹ˆåŠ"}},[s._v("#")]),s._v(" 39.Tomcatè¿›ç¨‹å ç”¨CPUè¿‡é«˜æ€ä¹ˆåŠ?")]),s._v(" "),t("p",[s._v("CPU èµ„æºç»å¸¸ä¼šæˆä¸ºç³»ç»Ÿæ€§èƒ½çš„ä¸€ä¸ªç“¶é¢ˆ, è¿™å…¶ä¸­çš„åŸå› æ˜¯å¤šæ–¹é¢çš„, å¯èƒ½æ˜¯å†…å­˜æ³„éœ²å¯¼è‡´é¢‘ç¹ GC, è¿›è€Œå¼•èµ· CPU ä½¿ç”¨ç‡è¿‡é«˜; åˆå¯èƒ½æ˜¯ä»£ç ä¸­çš„ Bug åˆ›å»ºäº†å¤§é‡çš„çº¿ç¨‹, å¯¼è‡´ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å°±æ¥èŠèŠ Tomcat è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠ, ä»¥åŠæ€æ ·ä¸€æ­¥ä¸€æ­¥æ‰¾åˆ°é—®é¢˜çš„æ ¹å› .")]),s._v(" "),t("h5",{attrs:{id:"javaè¿›ç¨‹cpuä½¿ç”¨ç‡é«˜-çš„è§£å†³æ€è·¯æ˜¯ä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javaè¿›ç¨‹cpuä½¿ç”¨ç‡é«˜-çš„è§£å†³æ€è·¯æ˜¯ä»€ä¹ˆ"}},[s._v("#")]),s._v(' "Javaè¿›ç¨‹CPUä½¿ç”¨ç‡é«˜"çš„è§£å†³æ€è·¯æ˜¯ä»€ä¹ˆ?')]),s._v(" "),t("p",[s._v("é€šå¸¸æ‰€è¯´çš„ CPU ä½¿ç”¨ç‡è¿‡é«˜, è¿™é‡Œé¢å…¶å®éšå«ç€ä¸€ä¸ªç”¨æ¥æ¯”è¾ƒé«˜ä¸ä½çš„"),t("strong",[s._v("åŸºå‡†å€¼")]),s._v(", æ¯”å¦‚ JVM åœ¨å³°å€¼è´Ÿè½½ä¸‹çš„å¹³å‡ CPU åˆ©ç”¨ç‡ä¸º 40ï¼…, å¦‚æœ CPU ä½¿ç”¨ç‡é£™åˆ° 80% å°±å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸æ­£å¸¸çš„.")]),s._v(" "),t("p",[s._v("å…¸å‹çš„ JVM è¿›ç¨‹åŒ…å«å¤šä¸ª Java çº¿ç¨‹, å…¶ä¸­ä¸€äº›åœ¨ç­‰å¾…å·¥ä½œ, å¦ä¸€äº›åˆ™æ­£åœ¨æ‰§è¡Œä»»åŠ¡. åœ¨å•ä¸ª Java ç¨‹åºçš„æƒ…å†µä¸‹, çº¿ç¨‹æ•°å¯ä»¥éå¸¸ä½, è€Œå¯¹äºå¤„ç†å¤§é‡å¹¶å‘äº‹åŠ¡çš„äº’è”ç½‘åå°æ¥è¯´, çº¿ç¨‹æ•°å¯èƒ½ä¼šæ¯”è¾ƒé«˜.")]),s._v(" "),t("p",[s._v("å¯¹äº CPU çš„é—®é¢˜, "),t("mark",[t("strong",[s._v("æœ€é‡è¦çš„æ˜¯è¦æ‰¾åˆ°æ˜¯å“ªäº›çº¿ç¨‹åœ¨æ¶ˆè€— CPU, é€šè¿‡çº¿ç¨‹æ ˆå®šä½åˆ°é—®é¢˜ä»£ç ; å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸ªåˆ«çº¿ç¨‹çš„ CPU ä½¿ç”¨ç‡ç‰¹åˆ«é«˜, å°±å¯ä»¥è€ƒè™‘æ˜¯ä¸æ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´äº† CPU ä½¿ç”¨ç‡è¿‡é«˜")])]),s._v(". ä¸‹é¢é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥å­¦ä¹  CPU é—®é¢˜å®šä½çš„è¿‡ç¨‹.")]),s._v(" "),t("h5",{attrs:{id:"å®šä½é«˜cpuä½¿ç”¨ç‡çš„çº¿ç¨‹å’Œä»£ç "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®šä½é«˜cpuä½¿ç”¨ç‡çš„çº¿ç¨‹å’Œä»£ç "}},[s._v("#")]),s._v(" å®šä½é«˜CPUä½¿ç”¨ç‡çš„çº¿ç¨‹å’Œä»£ç ")]),s._v(" "),t("p",[s._v("(1) å†™ä¸€ä¸ªæ¨¡æ‹Ÿç¨‹åºæ¥æ¨¡æ‹Ÿ CPU ä½¿ç”¨ç‡è¿‡é«˜çš„é—®é¢˜, è¿™ä¸ªç¨‹åºä¼šåœ¨çº¿ç¨‹æ± ä¸­åˆ›å»º 4096 ä¸ªçº¿ç¨‹. ä»£ç å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootApplication")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@EnableScheduling")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DemoApplication")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹æ± , å…¶ä¸­æœ‰ 4096 ä¸ªçº¿ç¨‹. ")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…¨å±€å˜é‡, è®¿é—®å®ƒéœ€è¦åŠ é”. ")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¥å›ºå®šçš„é€Ÿç‡å‘çº¿ç¨‹æ± ä¸­åŠ å…¥ä»»åŠ¡")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Scheduled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fixedRate "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lockContention")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IntStream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("range")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…·ä½“ä»»åŠ¡, å°±æ˜¯å°† count æ•°åŠ ä¸€")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DemoApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("(2) åœ¨ Linux ç¯å¢ƒä¸‹å¯åŠ¨ç¨‹åº:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("java -Xss256k -jar demo-0.0.1-SNAPSHOT.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¯·æ³¨æ„, è¿™é‡Œå°†çº¿ç¨‹æ ˆå¤§å°æŒ‡å®šä¸º 256KB. å¯¹äºæµ‹è¯•ç¨‹åºæ¥è¯´, æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ 8192KB è¿‡å¤§, å› ä¸ºéœ€è¦åˆ›å»º 4096 ä¸ªçº¿ç¨‹.")]),s._v(" "),t("p",[s._v("(3) ä½¿ç”¨ top å‘½ä»¤, å¯ä»¥çœ‹åˆ° Java è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡è¾¾åˆ°äº† 262.3%, æ³¨æ„åˆ°è¿›ç¨‹ ID æ˜¯ 4361.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162626-jxhv490.png",alt:""}})]),s._v(" "),t("p",[s._v("(4) æ¥ç€ç”¨æ›´ç²¾ç»†åŒ–çš„ top å‘½ä»¤æŸ¥çœ‹è¿™ä¸ª Java è¿›ç¨‹ä¸­å„çº¿ç¨‹ä½¿ç”¨ CPU çš„æƒ…å†µ:")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# top -H -p 4361")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/image-20230405162626-56eqgtb.png",alt:""}})]),s._v(" "),t("p",[s._v('ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°, æœ‰ä¸ªå« "scheduling-1" çš„çº¿ç¨‹å ç”¨äº†è¾ƒå¤šçš„ CPU, è¾¾åˆ°äº† 42.5%. å› æ­¤ä¸‹ä¸€æ­¥è¦æ‰¾å‡ºè¿™ä¸ªçº¿ç¨‹åœ¨åšä»€ä¹ˆäº‹æƒ….')]),s._v(" "),t("p",[s._v("(5) ä¸ºäº†æ‰¾å‡ºçº¿ç¨‹åœ¨åšä»€ä¹ˆäº‹æƒ…, éœ€è¦ç”¨ jstack å‘½ä»¤ç”Ÿæˆçº¿ç¨‹å¿«ç…§, å…·ä½“æ–¹æ³•æ˜¯:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("jstack 4361\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("jstack çš„è¾“å‡ºæ¯”è¾ƒå¤§, å¯ä»¥å°†è¾“å‡ºå†™å…¥æ–‡ä»¶:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("jstack 4361 > 4361.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v('ç„¶åæ‰“å¼€ 4361.log, å®šä½åˆ°ç¬¬ 4 æ­¥ä¸­æ‰¾åˆ°çš„åä¸º "scheduling-1" çš„çº¿ç¨‹, å‘ç°å®ƒçš„çº¿ç¨‹æ ˆå¦‚ä¸‹:')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162626-g49iue1.png",alt:""}})]),s._v(" "),t("p",[s._v("ä»çº¿ç¨‹æ ˆä¸­çœ‹åˆ°äº† "),t("code",[s._v("AbstractExecutorService.submit")]),s._v("â€‹ è¿™ä¸ªå‡½æ•°è°ƒç”¨, è¯´æ˜å®ƒæ˜¯ Spring Boot å¯åŠ¨çš„"),t("strong",[s._v("å‘¨æœŸæ€§")]),s._v("ä»»åŠ¡çº¿ç¨‹, å‘çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡, è¿™ä¸ªçº¿ç¨‹æ¶ˆè€—äº†å¤§é‡ CPU.")]),s._v(" "),t("h5",{attrs:{id:"è¿›ä¸€æ­¥åˆ†æä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿›ä¸€æ­¥åˆ†æä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€"}},[s._v("#")]),s._v(" è¿›ä¸€æ­¥åˆ†æä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€")]),s._v(" "),t("p",[s._v('ä¸€èˆ¬æ¥è¯´, é€šè¿‡ä¸Šé¢çš„è¿‡ç¨‹å°±èƒ½å®šä½åˆ°å¤§é‡æ¶ˆè€— CPU çš„çº¿ç¨‹ä»¥åŠæœ‰é—®é¢˜çš„ä»£ç , æ¯”å¦‚æ­»å¾ªç¯. ä½†æ˜¯å¯¹äºè¿™ä¸ªå®ä¾‹çš„é—®é¢˜, å¯ä»¥å‘ç°è¿™æ ·ä¸€ä¸ªæƒ…å†µ: Java è¿›ç¨‹å ç”¨çš„ CPU æ˜¯ 262.3%,  è€Œ "scheduling-1" çº¿ç¨‹åªå ç”¨äº† 42.5% çš„ CPU, é‚£è¿˜æœ‰å°†è¿‘ 220% çš„ CPU è¢«è°å ç”¨äº†å‘¢?')]),s._v(" "),t("p",[s._v("å‰é¢åœ¨ç¬¬ 4 æ­¥ç”¨ "),t("code",[s._v("top -H -p 4361")]),s._v('â€‹ å‘½ä»¤çœ‹åˆ°çš„çº¿ç¨‹åˆ—è¡¨ä¸­è¿˜æœ‰è®¸å¤šåä¸º "pool-1-thread-x" çš„çº¿ç¨‹, å®ƒä»¬å•ä¸ªçš„ CPU ä½¿ç”¨ç‡ä¸é«˜, ä½†æ˜¯ä¼¼ä¹'),t("strong",[s._v("æ•°é‡æ¯”è¾ƒå¤š")]),s._v(". å…¶å®è¿™äº›å°±æ˜¯çº¿ç¨‹æ± ä¸­å¹²æ´»çš„çº¿ç¨‹. é‚£å‰©ä¸‹çš„ 220% çš„ CPU æ˜¯ä¸æ˜¯è¢«è¿™äº›çº¿ç¨‹æ¶ˆè€—äº†å‘¢?")]),s._v(" "),t("p",[s._v('è¦å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜, è¿˜éœ€è¦çœ‹ jstack çš„è¾“å‡ºç»“æœ, ä¸»è¦æ˜¯çœ‹è¿™äº›çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯ä¸æ˜¯çœŸçš„åœ¨å¹²æ´», è¿˜æ˜¯åœ¨"ä¼‘æ¯"å‘¢?')]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162626-it84tut.png",alt:""}})]),s._v(" "),t("p",[s._v('é€šè¿‡ä¸Šé¢çš„å›¾å¯ä»¥å‘ç°è¿™äº› "pool-1-thread-x" çº¿ç¨‹'),t("strong",[s._v("åŸºæœ¬éƒ½å¤„äº WAITING çš„çŠ¶æ€")]),s._v(", é‚£ä»€ä¹ˆæ˜¯ WAITING çŠ¶æ€å‘¢? æˆ–è€…è¯´ Java çº¿ç¨‹éƒ½æœ‰å“ªäº›çŠ¶æ€å‘¢? å¯ä»¥é€šè¿‡ä¸‹é¢çš„å›¾æ¥ç†è§£ä¸€ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162626-r87lrn9.png",alt:""}})]),s._v(" "),t("p",[s._v('ä»å›¾ä¸Šçœ‹åˆ°"Blocking"å’Œ"Waiting"æ˜¯ä¸¤ä¸ªä¸åŒçš„çŠ¶æ€, è¦æ³¨æ„å®ƒä»¬çš„åŒºåˆ«:')]),s._v(" "),t("ul",[t("li",[s._v("Blocking æŒ‡çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹å› ä¸ºç­‰å¾…ä¸´ç•ŒåŒºçš„é”(Lock æˆ–è€… synchronized å…³é”®å­—)è€Œè¢«é˜»å¡çš„çŠ¶æ€, éœ€è¦æ³¨æ„å¤„äºè¿™ä¸ªçŠ¶æ€çš„çº¿ç¨‹**è¿˜æ²¡æœ‰æ‹¿åˆ°é”. **")]),s._v(" "),t("li",[s._v("Waiting æŒ‡çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹"),t("strong",[s._v("æ‹¿åˆ°äº†é”")]),s._v(", ä½†æ˜¯éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡ŒæŸäº›æ“ä½œ. æ¯”å¦‚è°ƒç”¨äº† Object.wait(), Thread.join() æˆ–è€… LockSupport.park() æ–¹æ³•æ—¶, è¿›å…¥ Waiting çŠ¶æ€. "),t("strong",[s._v("å‰ææ˜¯è¿™ä¸ªçº¿ç¨‹å·²ç»æ‹¿åˆ°é”äº†")]),s._v(", å¹¶ä¸”åœ¨è¿›å…¥ Waiting çŠ¶æ€å‰, æ“ä½œç³»ç»Ÿå±‚é¢ä¼šè‡ªåŠ¨é‡Šæ”¾é”, å½“ç­‰å¾…æ¡ä»¶æ»¡è¶³, å¤–éƒ¨è°ƒç”¨äº† Object.notify() æˆ–è€… LockSupport.unpark() æ–¹æ³•, çº¿ç¨‹ä¼šé‡æ–°ç«äº‰é”, æˆåŠŸè·å¾—é”åæ‰èƒ½è¿›å…¥åˆ° Runnable çŠ¶æ€ç»§ç»­æ‰§è¡Œ.")])]),s._v(" "),t("p",[s._v('å›åˆ° "pool-1-thread-x" çº¿ç¨‹, è¿™äº›çº¿ç¨‹éƒ½å¤„åœ¨ "Waiting" çŠ¶æ€, ä»çº¿ç¨‹æ ˆå¯ä»¥çœ‹åˆ°, è¿™äº›çº¿ç¨‹ "ç­‰å¾…" åœ¨ getTask() æ–¹æ³•è°ƒç”¨ä¸Š, '),t("strong",[s._v("çº¿ç¨‹å°è¯•ä»çº¿ç¨‹æ± çš„é˜Ÿåˆ—ä¸­å–ä»»åŠ¡")]),s._v(', ä½†æ˜¯é˜Ÿåˆ—ä¸ºç©º, æ‰€ä»¥é€šè¿‡ LockSupport.park() è°ƒç”¨è¿›åˆ°äº† "Waiting" çŠ¶æ€. é‚£ "pool-1-thread-x" çº¿ç¨‹æœ‰å¤šå°‘ä¸ªå‘¢? é€šè¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤æ¥ç»Ÿè®¡ä¸€ä¸‹, ç»“æœæ˜¯ 4096, æ­£å¥½è·Ÿçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›¸ç­‰.')]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep -o 'pool-1-thread' 4361.log | wc -l")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å›åˆ°å‰é¢, é‚£å‰©ä¸‹çš„ 220% çš„ CPU åˆ°åº•è¢«è°æ¶ˆè€—äº†å‘¢? åˆ†æåˆ°è¿™é‡Œ, åº”è¯¥æ€€ç–‘ "),t("strong",[s._v("CPU çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€äº†")]),s._v(", å¯ä»¥çœ‹åˆ° Java è¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•°æ¯”è¾ƒå¤š. ä¸‹é¢é€šè¿‡ vmstat å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹æ“ä½œç³»ç»Ÿå±‚é¢çš„"),t("strong",[s._v("çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ´»åŠ¨")]),s._v(":")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162626-l8yho7i.png",alt:""}})]),s._v(" "),t("p",[s._v("å…¶ä¸­ "),t("strong",[s._v("cs é‚£ä¸€æ è¡¨ç¤ºçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°, in è¡¨ç¤º CPU ä¸­æ–­æ¬¡æ•°")]),s._v(", å¯ä»¥å‘ç°è¿™ä¸¤ä¸ªæ•°å­—éå¸¸é«˜, åŸºæœ¬è¯å®äº†çŒœæµ‹, çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡åˆ‡æ¢æ¶ˆè€—äº†å¤§é‡ CPU. é‚£ä¹ˆé—®é¢˜æ¥äº†, å…·ä½“æ˜¯å“ªä¸ªè¿›ç¨‹å¯¼è‡´çš„å‘¢?")]),s._v(" "),t("p",[s._v("åœæ­¢ Spring Boot æµ‹è¯•ç¨‹åº, å†æ¬¡è¿è¡Œ vmstat å‘½ä»¤, ä¼šçœ‹åˆ° in å’Œ cs éƒ½å¤§å¹…ä¸‹é™äº†, è¿™æ ·å°±è¯å®äº†å¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€çš„ Java è¿›ç¨‹æ­£æ˜¯ "),t("strong",[s._v("4361")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405162626-6ki4o8h.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"æ€»ç»“-19"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“-19"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("å½“é‡åˆ° CPU è¿‡é«˜çš„é—®é¢˜æ—¶, é¦–å…ˆè¦å®šä½æ˜¯å“ªä¸ªè¿›ç¨‹çš„å¯¼è‡´çš„, ä¹‹åå¯ä»¥é€šè¿‡ "),t("code",[s._v("top -H -p pid")]),s._v("â€‹ å‘½ä»¤å®šä½åˆ°å…·ä½“çš„çº¿ç¨‹. å…¶æ¬¡è¿˜è¦é€š jstack æŸ¥çœ‹çº¿ç¨‹çš„çŠ¶æ€, çœ‹çœ‹çº¿ç¨‹çš„ä¸ªæ•°æˆ–è€…çº¿ç¨‹çš„çŠ¶æ€, å¦‚æœçº¿ç¨‹æ•°è¿‡å¤š, å¯ä»¥æ€€ç–‘æ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€, å¯ä»¥é€šè¿‡ vmstat å’Œ pidstat è¿™ä¸¤ä¸ªå·¥å…·è¿›è¡Œç¡®è®¤.")]),s._v(" "),t("h4",{attrs:{id:"_41-çƒ­ç‚¹ç­”ç–‘-4-tomcatå’Œjettyæœ‰å“ªäº›ä¸åŒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_41-çƒ­ç‚¹ç­”ç–‘-4-tomcatå’Œjettyæœ‰å“ªäº›ä¸åŒ"}},[s._v("#")]),s._v(" 41.çƒ­ç‚¹ç­”ç–‘(4):Tomcatå’ŒJettyæœ‰å“ªäº›ä¸åŒ?")]),s._v(" "),t("p",[s._v("è¿™é‡Œæ€»ç»“ä¸€ä¸‹ Tomcat å’Œ Jetty çš„åŒºåˆ«, å¹¶é€šè¿‡ä¸€ä¸ªå®æˆ˜æ¡ˆä¾‹æ¥æ¯”è¾ƒä¸€ä¸‹ Tomcat å’Œ Jetty åœ¨å®é™…åœºæ™¯ä¸‹çš„è¡¨ç°, å¸®ä½ åœ¨åšé€‰å‹æ—¶æœ‰æ›´æ·±çš„ç†è§£.")]),s._v(" "),t("p",[s._v("å…ˆæ¥æ¦‚æ‹¬ä¸€ä¸‹ Tomcat å’Œ Jetty ä¸¤è€…æœ€å¤§çš„åŒºåˆ«. å¤§ä½“æ¥è¯´, Tomcat çš„æ ¸å¿ƒç«äº‰åŠ›æ˜¯"),t("strong",[s._v("æˆç†Ÿç¨³å®š")]),s._v(", å› ä¸ºå®ƒç»è¿‡äº†å¤šå¹´çš„å¸‚åœºè€ƒéªŒ, åº”ç”¨ä¹Ÿç›¸å½“å¹¿æ³›, å¯¹äºæ¯”è¾ƒå¤æ‚çš„ä¼ä¸šçº§åº”ç”¨æ”¯æŒå¾—æ›´åŠ å…¨é¢. ä¹Ÿå› ä¸ºå¦‚æ­¤, Tomcat åœ¨æ•´ä½“ç»“æ„ä¸Šæ¯” Jetty æ›´åŠ å¤æ‚, åŠŸèƒ½æ‰©å±•æ–¹é¢å¯èƒ½ä¸å¦‚ Jetty é‚£ä¹ˆæ–¹ä¾¿.")]),s._v(" "),t("p",[s._v("è€Œ Jetty æ¯”è¾ƒå¹´è½», è®¾è®¡ä¸Šæ›´åŠ "),t("strong",[s._v("ç®€æ´å°å·§")]),s._v(", é…ç½®ä¹Ÿæ¯”è¾ƒç®€å•, åŠŸèƒ½ä¹Ÿæ”¯æŒæ–¹ä¾¿åœ°æ‰©å±•å’Œè£å‰ª, æ¯”å¦‚å¯ä»¥æŠŠ Jetty çš„ SessionHandler å»æ‰, ä»¥èŠ‚çœå†…å­˜èµ„æº, å› æ­¤ Jetty è¿˜å¯ä»¥è¿è¡Œåœ¨å°å‹çš„åµŒå…¥å¼è®¾å¤‡ä¸­, æ¯”å¦‚æ‰‹æœºå’Œæœºé¡¶ç›’. å½“ç„¶, ä¹Ÿå¯ä»¥è‡ªå·±å¼€å‘ä¸€ä¸ª Handler, åŠ å…¥ Handler é“¾ä¸­ç”¨æ¥æ‰©å±• Jetty çš„åŠŸèƒ½. å€¼å¾—ä¸€æçš„æ˜¯, Hadoop å’Œ Solr éƒ½åµŒå…¥äº† Jetty ä½œä¸º Web æœåŠ¡å™¨.")]),s._v(" "),t("p",[s._v("ä»è®¾è®¡çš„è§’åº¦æ¥çœ‹, Tomcat çš„æ¶æ„åŸºäºä¸€ç§"),t("strong",[s._v("å¤šçº§å®¹å™¨çš„æ¨¡å¼")]),s._v(", è¿™äº›å®¹å™¨ç»„ä»¶å…·æœ‰çˆ¶å­å…³ç³», æ‰€æœ‰ç»„ä»¶ä¾é™„äºè¿™ä¸ªéª¨æ¶, è€Œä¸”è¿™ä¸ªéª¨æ¶æ˜¯ä¸å˜çš„, åœ¨æ‰©å±• Tomcat çš„åŠŸèƒ½æ—¶ä¹Ÿéœ€è¦åŸºäºè¿™ä¸ªéª¨æ¶, å› æ­¤ Tomcat åœ¨è®¾è®¡ä¸Šç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤æ‚. å½“ç„¶ Tomcat ä¹Ÿæä¾›äº†è¾ƒå¥½çš„æ‰©å±•æœºåˆ¶, æ¯”å¦‚å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª Valve, ä½†ç›¸å¯¹æ¥è¯´å­¦ä¹ æˆæœ¬è¿˜æ˜¯æ¯”è¾ƒå¤§çš„. è€Œ Jetty é‡‡ç”¨ Handler "),t("strong",[s._v("è´£ä»»é“¾æ¨¡å¼")]),s._v(". ç”±äº Handler ä¹‹é—´çš„å…³ç³»æ¯”è¾ƒæ¾æ•£, Jetty æä¾› HandlerCollection å¯ä»¥å¸®åŠ©å¼€å‘è€…æ–¹ä¾¿åœ°æ„å»ºä¸€ä¸ª Handler é“¾, åŒæ—¶ä¹Ÿæä¾›äº† ScopeHandler å¸®åŠ©å¼€å‘è€…æ§åˆ¶ Handler é“¾çš„è®¿é—®é¡ºåº.")]),s._v(" "),t("p",[s._v("è¯´äº†ä¸€å †ç†è®º, ä½ å¯èƒ½è§‰å¾—è¿˜æ˜¯æœ‰ç‚¹æŠ½è±¡, æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªå®ä¾‹, æ¥å‹æµ‹ä¸€ä¸‹ Tomcat å’Œ Jetty, çœ‹çœ‹åœ¨åŒç­‰æµé‡å‹åŠ›ä¸‹, Tomcat å’Œ Jetty åˆ†åˆ«åœ¨ååé‡, å»¶è¿Ÿå’Œé”™è¯¯ç‡çš„è¡¨ç°å¦‚ä½•.")]),s._v(" "),t("p",[s._v("æµ‹è¯•çš„è®¡åˆ’æ˜¯è¿™æ ·çš„, è¿™é‡Œç”¨ IO ä¸å¹¶å‘è°ƒä¼˜å°èŠ‚çš„ Spring Boot åº”ç”¨ç¨‹åº. é¦–å…ˆç”¨ Spring Boot é»˜è®¤çš„ Tomcat ä½œä¸ºå†…åµŒå¼ Web å®¹å™¨, ç»è¿‡ä¸€è½®å‹æµ‹å, å°†å†…åµŒå¼çš„ Web å®¹å™¨æ¢æˆ Jetty, å†åšä¸€è½®æµ‹è¯•, ç„¶åæ¯”è¾ƒç»“æœ.")]),s._v(" "),t("p",[s._v("è¿™é‡Œä¼šåœ¨æ¯ä¸ªè¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ä¸­ä¼‘çœ  1 ç§’, é€‚å½“åœ°æ¨¡æ‹Ÿ Web åº”ç”¨çš„ I/O ç­‰å¾…æ—¶é—´. JMeter å®¢æˆ·ç«¯çš„çº¿ç¨‹æ•°ä¸º 100, å‹æµ‹æŒç»­ 10 åˆ†é’Ÿ. åœ¨ JMeter ä¸­åˆ›å»ºä¸€ä¸ª Summary Report, åœ¨è¿™ä¸ªé¡µé¢ä¸Š, å¯ä»¥çœ‹åˆ°å„ç§ç»Ÿè®¡æŒ‡æ ‡.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405164102-i23825n.png",alt:""}})]),s._v(" "),t("p",[s._v("ç¬¬ä¸€æ­¥, å‹æµ‹ Tomcat. å¯åŠ¨ Spring Boot ç¨‹åºå’Œ JMeter, æŒç»­ 10 åˆ†é’Ÿ, ä»¥ä¸‹æ˜¯æµ‹è¯•ç»“æœ, ç»“æœåˆ†ä¸ºä¸¤éƒ¨åˆ†:")]),s._v(" "),t("p",[t("strong",[s._v("ååé‡, å»¶è¿Ÿå’Œé”™è¯¯ç‡")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405164102-sbluqm6.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("èµ„æºä½¿ç”¨æƒ…å†µ")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405164102-okyeyfz.png",alt:""}})]),s._v(" "),t("p",[s._v("ç¬¬äºŒæ­¥, å°† Spring Boot çš„ Web å®¹å™¨æ›¿æ¢æˆ Jetty, å…·ä½“æ­¥éª¤æ˜¯åœ¨ pom.xml æ–‡ä»¶ä¸­çš„ spring-boot-starter-web ä¾èµ–ä¿®æ”¹ä¸‹é¢è¿™æ ·:")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-web"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclusions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclusion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-tomcat"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclusion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclusions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-jetty"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("ç¼–è¯‘æ‰“åŒ…, å¯åŠ¨ Spring Boot, å†å¯åŠ¨ JMeter å‹æµ‹, ä»¥ä¸‹æ˜¯æµ‹è¯•ç»“æœ:")]),s._v(" "),t("p",[t("strong",[s._v("ååé‡, å»¶è¿Ÿå’Œé”™è¯¯ç‡")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405164102-jp640x6.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("èµ„æºä½¿ç”¨æƒ…å†µ")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405164102-pnofrdr.png",alt:""}})]),s._v(" "),t("p",[s._v("ä¸‹é¢é€šè¿‡ä¸€ä¸ªè¡¨æ ¼æ¥å¯¹æ¯” Tomcat å’Œ Jetty:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20230405164102-6beqtux.jpg",alt:""}})]),s._v(" "),t("p",[s._v("ä»è¡¨æ ¼ä¸­çš„æ•°æ®å¯ä»¥çœ‹åˆ°:")]),s._v(" "),t("ul",[t("li",[s._v("**Jetty åœ¨ååé‡å’Œå“åº”é€Ÿåº¦æ–¹é¢ç¨æœ‰ä¼˜åŠ¿, å¹¶ä¸” Jetty æ¶ˆè€—çš„çº¿ç¨‹å’Œå†…å­˜èµ„æºæ˜æ˜¾æ¯” Tomcat è¦å°‘, è¿™ä¹Ÿæ°å¥½è¯´æ˜äº† Jetty åœ¨è®¾è®¡ä¸Šæ›´åŠ å°å·§å’Œè½»é‡çº§çš„ç‰¹ç‚¹. **")]),s._v(" "),t("li",[s._v("**ä½†æ˜¯ Jetty æœ‰ 2.45% çš„é”™è¯¯ç‡, è€Œ Tomcat æ²¡æœ‰ä»»ä½•é”™è¯¯, å¹¶ä¸”ç»è¿‡å¤šæ¬¡æµ‹è¯•éƒ½æ˜¯è¿™ä¸ªç»“æœ. å› æ­¤å¯ä»¥è®¤ä¸º Tomcat æ¯” Jetty æ›´åŠ æˆç†Ÿå’Œç¨³å®š. **")])]),s._v(" "),t("p",[s._v("å½“ç„¶ç”±äºæµ‹è¯•åœºæ™¯çš„é™åˆ¶, ä»¥ä¸Šæ•°æ®å¹¶ä¸èƒ½å®Œå…¨åæ˜  Tomcat å’Œ Jetty çš„çœŸå®èƒ½åŠ›. ä½†æ˜¯å®ƒå¯ä»¥åœ¨åšå®é™…é€‰å‹çš„æ—¶å€™æä¾›ä¸€äº›å‚è€ƒ: "),t("strong",[s._v("å¦‚æœç³»ç»Ÿçš„ç›®æ ‡æ˜¯èµ„æºæ¶ˆè€—å°½é‡å°‘, å¹¶ä¸”å¯¹ç¨³å®šæ€§è¦æ±‚æ²¡æœ‰é‚£ä¹ˆé«˜, å¯ä»¥é€‰æ‹©è½»é‡çº§çš„ Jetty; å¦‚æœç³»ç»Ÿæ˜¯æ¯”è¾ƒå…³é”®çš„ä¼ä¸šçº§åº”ç”¨, å»ºè®®è¿˜æ˜¯é€‰æ‹© Tomcat æ¯”è¾ƒç¨³å¦¥")]),s._v(".")]),s._v(" "),t("p",[s._v("æœ€åç”¨ä¸€å¥è¯æ€»ç»“ Tomcat å’Œ Jetty çš„åŒºåˆ«: **Tomcat å¥½æ¯”æ˜¯ä¸€ä½å·¥ä½œå¤šå¹´æ¯”è¾ƒæˆç†Ÿçš„å·¥ç¨‹å¸ˆ, è½»æ˜“ä¸ä¼šå‡ºé”™, ä¸ä¼šæ‰é“¾å­, ä½†æ˜¯ä»–æœ‰è‡ªå·±çš„æƒ³æ³•, ä¸ä¼šè½»æ˜“åšå‡ºæ”¹å˜. è€Œ Jetty æ›´åƒæ˜¯ä¸€ä½å¹´è½»çš„åèµ·ä¹‹ç§€, è„‘å­è½¬å¾—å¾ˆå¿«, å¯å¡‘æ€§ä¹Ÿå¾ˆå¼º, ä½†æœ‰æ—¶å€™ä¹Ÿä¼šçŠ¯ä¸€ç‚¹å°é”™è¯¯. **")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")])])}),[],!1,null,null,null);t.default=e.exports}}]);