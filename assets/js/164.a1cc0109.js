(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{475:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_100-nginx基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_100-nginx基础"}},[s._v("#")]),s._v(" 100.Nginx基础")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://nginx.org/en/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx"),t("OutboundLink")],1),s._v(" 是一款面向性能设计的 HTTP 服务器, 能反向代理 HTTP, HTTPS 和邮件相关(SMTP, POP3, IMAP)的协议链接. 并且提供了负载均衡以及 HTTP 缓存. 它的设计充分使用"),t("strong",[s._v("异步事件模型, 削减上下文调度")]),s._v("的开销, 提高服务器并发能力. 采用了"),t("strong",[s._v("模块化设计")]),s._v(", 提供了丰富模块的第三方模块.")]),s._v(" "),t("p",[s._v("所以关于 Nginx, 有这些标签:  "),t("strong",[s._v("「异步」「事件」「模块化」「高性能」「高并发」「反向代理」「负载均衡」.")])]),s._v(" "),t("p",[s._v("Linux系统: "),t("code",[s._v("Centos 7 x64")]),s._v("​")]),s._v(" "),t("p",[s._v("Nginx版本: "),t("code",[s._v("1.11.5")]),s._v("​")]),s._v(" "),t("h4",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("h5",{attrs:{id:"安装依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[s._v("#")]),s._v(" 安装依赖")]),s._v(" "),t("blockquote",[t("p",[s._v("prce(重定向支持)和openssl(https支持, 如果不需要https可以不安装. )")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" pcre-devel \nyum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" gcc-c++ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssl openssl-devel \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v('CentOS 6.5 我安装的时候是选择的 "基本服务器", 默认这两个包都没安装全, 所以这两个都运行安装即可.')]),s._v(" "),t("h5",{attrs:{id:"下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[s._v("#")]),s._v(" 下载")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://nginx.org/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx的所有版本在这里"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.13.3.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.13.7.tar.gz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有安装wget")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载已编译版本")]),s._v("\n$ yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压压缩包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf nginx-1.13.3.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h5",{attrs:{id:"编译安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译安装"}},[s._v("#")]),s._v(" 编译安装")]),s._v(" "),t("p",[s._v("然后进入目录编译安装, configure 参数说明参考下面对应的部分.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.11.5\n./configure\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nConfiguration summary\n  + using system PCRE library\n  + OpenSSL library is not used\n  + using system zlib library\n\n  nginx path prefix: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx"')]),s._v("\n  nginx binary file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/sbin/nginx"')]),s._v("\n  nginx modules path: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/modules"')]),s._v("\n  nginx configuration prefix: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/conf"')]),s._v("\n  nginx configuration file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/conf/nginx.conf"')]),s._v("\n  nginx pid file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/logs/nginx.pid"')]),s._v("\n  nginx error log file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/logs/error.log"')]),s._v("\n  nginx http access log file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/logs/access.log"')]),s._v("\n  nginx http client request body temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_body_temp"')]),s._v("\n  nginx http proxy temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"proxy_temp"')]),s._v("\n  nginx http fastcgi temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fastcgi_temp"')]),s._v("\n  nginx http uwsgi temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uwsgi_temp"')]),s._v("\n  nginx http scgi temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scgi_temp"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v('安装报错误的话比如: "C compiler cc is not found", 这个就是缺少编译环境, 安装一下就可以了 **yum -y install gcc make gcc-c++ openssl-devel. **')]),s._v(" "),t("p",[s._v("如果没有 error 信息, 就可以执行下边的安装了:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h5",{attrs:{id:"nginx测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx测试"}},[s._v("#")]),s._v(" nginx测试")]),s._v(" "),t("p",[s._v("运行下面命令会出现两个结果, 一般情况 nginx 会安装在 "),t("code",[s._v("/usr/local/nginx")]),s._v("​ 目录中.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx/sbin/\n./nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h5",{attrs:{id:"设置全局nginx命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置全局nginx命令"}},[s._v("#")]),s._v(" 设置全局nginx命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" ~/.bash_profile\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("将下面内容添加到 "),t("code",[s._v("~/.bash_profile")]),s._v(" 文件中")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/bin:/usr/local/nginx/sbin/\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("运行命令 "),t("strong",[s._v("​"),t("code",[s._v("source ~/.bash_profile")]),s._v("​")]),s._v("​ 让配置立即生效. 这样就可以全局运行 "),t("code",[s._v("nginx")]),s._v("​ 命令了.")]),s._v(" "),t("h5",{attrs:{id:"mac安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mac安装"}},[s._v("#")]),s._v(" Mac安装")]),s._v(" "),t("p",[s._v("Mac OSX 安装特别简单, 首先需要安装 "),t("a",{attrs:{href:"https://brew.sh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Brew"),t("OutboundLink")],1),s._v(", 通过 "),t("code",[s._v("brew")]),s._v("​ 快速安装 "),t("code",[s._v("nginx")]),s._v("​.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("brew "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Updating Homebrew...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <mark>> Auto-updated Homebrew!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Updated 2 taps (homebrew/core, homebrew/cask).")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# </mark>> Updated Formulae")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <mark>> Installing dependencies for nginx: openssl, pcre")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# </mark>> Installing nginx dependency: openssl")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <mark>> Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ######################################################################## 100.0%")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# </mark>> Pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Caveats")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A CA file has been bootstrapped using certificates from the SystemRoots")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# keychain. To add additional certificates (e.g. the certificates added in")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the System keychain), place .pem files in")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   /usr/local/etc/openssl/certs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# and run")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   /usr/local/opt/openssl/bin/c_rehash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This formula is keg-only, which means it was not symlinked into /usr/local,")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If you need to have this software first in your PATH run:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   echo 'export PATH=\"/usr/local/opt/openssl/bin:$PATH\"' >> ~/.zshrc")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For compilers to find this software you may need to set:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     LDFLAGS:  -L/usr/local/opt/openssl/lib")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     CPPFLAGS: -I/usr/local/opt/openssl/include")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For pkg-config to find this software you may need to set:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     PKG_CONFIG_PATH: /usr/local/opt/openssl/lib/pkgconfig")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <mark>> Summary")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 🍺  /usr/local/Cellar/openssl/1.0.2o_1: 1,791 files, 12.3MB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# </mark>> Installing nginx dependency: pcre")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <mark>> Downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ######################################################################## 100.0%")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# </mark>> Pouring pcre-8.42.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 🍺  /usr/local/Cellar/pcre/8.42: 204 files, 5.3MB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <mark>> Installing nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# </mark>> Downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ######################################################################## 100.0%")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <mark>> Pouring nginx-1.13.12.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# </mark>> Caveats")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Docroot is: /usr/local/var/www")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx can run without sudo.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx will load all files in /usr/local/etc/nginx/servers/.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# To have launchd start nginx now and restart at login:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   brew services start nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Or, if you don't wacd /usr/local/Cellar/nginx/1.13.12/n just run:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /usr/local/Cellar/nginx/1.13.12/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("blockquote",[t("p",[s._v("启动服务")])]),s._v(" "),t("p",[s._v("注意默认端口不是 "),t("code",[s._v("8080")]),s._v(" 查看确认端口是否被占用.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("brew services start nginx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://localhost:8080/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"运维"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运维"}},[s._v("#")]),s._v(" 运维")]),s._v(" "),t("h5",{attrs:{id:"开机自启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开机自启动"}},[s._v("#")]),s._v(" 开机自启动")]),s._v(" "),t("p",[s._v("**开机自启动方法一: **")]),s._v(" "),t("p",[s._v("编辑 "),t("strong",[s._v("vi /lib/systemd/system/nginx.service")]),s._v(" 文件, 没有创建一个 "),t("strong",[s._v("touch nginx.service")]),s._v(" 然后将如下内容根据具体情况进行修改后, 添加到 nginx.service 文件中:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target remote-fs.target nss-lookup.target\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PIDFile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/nginx.pid\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /usr/local/nginx/conf/nginx.conf\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /usr/local/nginx/conf/nginx.conf\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" HUP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" QUIT "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PrivateTmp")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ul",[t("li",[s._v("​"),t("code",[s._v("[Unit]")]),s._v("​: 服务的说明")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("Description")]),s._v("​: 描述服务")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("After")]),s._v("​: 描述服务类别")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("[Service]")]),s._v("​: 服务运行参数的设置")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("Type=forking")]),s._v("​: 是后台运行的形式")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("ExecStart")]),s._v("​: 为服务的具体运行命令")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("ExecReload")]),s._v("​: 为重启命令")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("ExecStop")]),s._v("​: 为停止命令")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("PrivateTmp=True")]),s._v("​: 表示给服务分配独立的临时空间")])]),s._v(" "),t("p",[s._v("注意: "),t("code",[s._v("[Service]")]),s._v("​ 的启动, 重启, 停止命令全部要求使用绝对路径.")]),s._v(" "),t("p",[s._v("​"),t("code",[s._v("[Install]")]),s._v("​ 运行级别下服务安装的相关设置, 可设置为多用户, 即系统运行级别为 "),t("code",[s._v("3")]),s._v("​.")]),s._v(" "),t("p",[s._v("保存退出.")]),s._v(" "),t("p",[s._v("设置"),t("strong",[s._v("开机启动, 使配置生效")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动nginx服务")]),s._v("\nsystemctl start nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止开机自启动")]),s._v("\nsystemctl disable nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务当前状态")]),s._v("\nsystemctl status nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有已启动的服务")]),s._v("\nsystemctl list-units "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新启动服务")]),s._v("\nsystemctl restart nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开机自启动")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出下面内容表示成功了")]),s._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl is-enabled servicename.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询服务是否开机启动")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" *.service  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开机运行服务")]),s._v("\nsystemctl disable *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消开机运行")]),s._v("\nsystemctl start *.service   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动服务")]),s._v("\nsystemctl stop *.service    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止服务")]),s._v("\nsystemctl restart *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启服务")]),s._v("\nsystemctl reload *.service  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载服务配置文件")]),s._v("\nsystemctl status *.service  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询服务运行状态")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--failed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示启动失败的服务")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("注: * 代表某个服务的名字, 如 http 的服务名为 httpd.")]),s._v(" "),t("p",[s._v("**开机自启动方法二: **")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/rc.local\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 rc.local 文件中, 添加下面这条命令")]),s._v("\n/usr/local/nginx/sbin/nginx start\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("如果开机后发现自启动脚本没有执行, 要去确认一下 rc.local 这个文件的访问权限是否是可执行的, 因为 rc.local 默认是不可执行的. 修改 rc.local 访问权限, 增加可执行权限:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/rc.local是/etc/rc.d/rc.local的软连接, ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/rc.d/rc.local\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("官方脚本 "),t("a",{attrs:{href:"https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ed Hat NGINX Init Script"),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"服务管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务管理"}},[s._v("#")]),s._v(" 服务管理")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\n/usr/local/nginx/sbin/nginx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\n/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭进程")]),s._v("\n/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" stop\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 平滑关闭nginx")]),s._v("\n/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" quit\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看nginx的安装状态, ")]),s._v("\n/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("strong",[s._v("关闭防火墙, 或者添加防火墙规则就可以测试了.")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables stop\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或者编辑配置文件:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/sysconfig/iptables\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("添加这样一条"),t("strong",[s._v("开放 80 端口的规则")]),s._v("后保存:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" state "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--state")]),s._v(" NEW "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dport")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" ACCEPT\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("重启服务即可:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables restart\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 命令进行查看目前nat")]),s._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h5",{attrs:{id:"重启服务防火墙报错解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启服务防火墙报错解决"}},[s._v("#")]),s._v(" 重启服务防火墙报错解决")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables restart\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redirecting to /bin/systemctl restart  iptables.service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("在 CentOS 7 或 RHEL 7 或 Fedora 中防火墙由 "),t("strong",[s._v("firewalld")]),s._v(" 来管理, 当然可以还原传统的管理方式. 或则使用新的命令进行管理.")]),s._v(" "),t("p",[s._v("假如采用传统请执行一下命令:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传统命令")]),s._v("\nsystemctl stop firewalld\nsystemctl mask firewalld\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装命令")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iptables-services\n\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" iptables \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h5",{attrs:{id:"nginx卸载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx卸载"}},[s._v("#")]),s._v(" nginx卸载")]),s._v(" "),t("p",[s._v("如果通过 yum 安装, 使用下面命令安装.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum remove nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("编译安装, 删除 "),t("code",[s._v("/usr/local/nginx")]),s._v("​ 目录即可.")]),s._v(" "),t("p",[s._v("如果配置了自启动脚本, 也需要删除.")]),s._v(" "),t("h5",{attrs:{id:"安装第三方模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装第三方模块"}},[s._v("#")]),s._v(" 安装第三方模块")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("./configure --prefix=/你的安装目录  --add-module=/第三方模块目录\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[s._v("#")]),s._v(" 参数说明")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("--prefix="),t("code",[s._v("<path>")]),s._v("​")]),s._v(" "),t("td",[s._v("Nginx 安装路径. 如果没有指定, 默认为 "),t("code",[s._v("/usr/local/nginx")]),s._v("​.")])]),s._v(" "),t("tr",[t("td",[s._v("--sbin-path="),t("code",[s._v("<path>")]),s._v("​")]),s._v(" "),t("td",[s._v("Nginx 可执行文件安装路径. 只能安装时指定, 如果没有指定, 默认为 "),t("code",[s._v("<prefix>")]),s._v("​/sbin/nginx.")])]),s._v(" "),t("tr",[t("td",[s._v("--conf-path="),t("code",[s._v("<path>")]),s._v("​")]),s._v(" "),t("td",[s._v("在没有给定 -c 选项下默认的 "),t("strong",[s._v("nginx.conf")]),s._v(" 的路径. 如果没有指定, 默认为 "),t("code",[s._v("<prefix>")]),s._v("​/conf/nginx.conf.")])]),s._v(" "),t("tr",[t("td",[s._v("--pid-path="),t("code",[s._v("<path>")]),s._v("​")]),s._v(" "),t("td",[s._v("在 nginx.conf 中没有指定 pid 指令的情况下, 默认的 nginx.pid 的路径. 如果没有指定, 默认为 "),t("code",[s._v("<prefix>")]),s._v("​/logs/nginx.pid.")])]),s._v(" "),t("tr",[t("td",[s._v("--lock-path="),t("code",[s._v("<path>")]),s._v("​")]),s._v(" "),t("td",[s._v("nginx.lock 文件的路径.")])]),s._v(" "),t("tr",[t("td",[s._v("--error-log-path="),t("code",[s._v("<path>")]),s._v("​")]),s._v(" "),t("td",[s._v("在 nginx.conf 中没有指定 error_log 指令的情况下, 默认的错误日志的路径. 如果没有指定, 默认为 "),t("code",[s._v("<prefix>")]),s._v("​/- logs/error.log.")])]),s._v(" "),t("tr",[t("td",[s._v("--http-log-path="),t("code",[s._v("<path>")]),s._v("​")]),s._v(" "),t("td",[s._v("在 nginx.conf 中没有指定 access_log 指令的情况下, 默认的访问日志的路径. 如果没有指定, 默认为 "),t("code",[s._v("<prefix>")]),s._v("​/- logs/access.log.")])]),s._v(" "),t("tr",[t("td",[s._v("--user="),t("code",[s._v("<user>")]),s._v("​")]),s._v(" "),t("td",[s._v("在 nginx.conf 中没有指定 user 指令的情况下, 默认的 nginx 使用的用户. 如果没有指定, 默认为 nobody.")])]),s._v(" "),t("tr",[t("td",[s._v("--group="),t("code",[s._v("<group>")]),s._v("​")]),s._v(" "),t("td",[s._v("在 nginx.conf 中没有指定 user 指令的情况下, 默认的 nginx 使用的组. 如果没有指定, 默认为 nobody.")])]),s._v(" "),t("tr",[t("td",[s._v("--builddir=DIR")]),s._v(" "),t("td",[s._v("指定编译的目录")])]),s._v(" "),t("tr",[t("td",[s._v("--with-rtsig_module")]),s._v(" "),t("td",[s._v("启用 rtsig 模块")])]),s._v(" "),t("tr",[t("td",[s._v("--with-select_module --without-select_module")]),s._v(" "),t("td",[s._v("允许或不允许开启 SELECT 模式, 如果 configure 没有找到更合适的模式, 比如: kqueue(sun os), epoll (linux kenel 2.6+), rtsig(- 实时信号)或者 /dev/poll(一种类似 select 的模式, 底层实现与 SELECT 基本相同, 都是采用轮训方法) SELECT 模式将是默认安装模式")])]),s._v(" "),t("tr",[t("td",[s._v("--with-poll_module --without-poll_module")]),s._v(" "),t("td",[s._v("Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or /dev/poll is not discovered by configure.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_ssl_module")]),s._v(" "),t("td",[s._v("Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. "),t("strong",[s._v("开启 HTTP SSL 模块, 使 NGINX 可以支持 HTTPS 请求")]),s._v(". 这个模块需要已经安装了 "),t("strong",[s._v("OPENSSL")]),s._v(", 在 DEBIAN 上是libssl")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_realip_module")]),s._v(" "),t("td",[s._v("启用 ngx_http_realip_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_addition_module")]),s._v(" "),t("td",[s._v("启用 ngx_http_addition_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_sub_module")]),s._v(" "),t("td",[s._v("启用 ngx_http_sub_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_dav_module")]),s._v(" "),t("td",[s._v("启用 ngx_http_dav_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_flv_module")]),s._v(" "),t("td",[s._v("启用 ngx_http_flv_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_stub_status_module")]),s._v(" "),t("td",[s._v('启用 "server status" 页')])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_charset_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_charset_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_gzip_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_gzip_module. 如果启用, 需要 zlib.")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_ssi_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_ssi_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_userid_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_userid_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_access_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_access_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_auth_basic_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_auth_basic_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_autoindex_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_autoindex_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_geo_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_geo_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_map_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_map_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_referer_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_referer_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_rewrite_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_rewrite_module. 如果启用需要 PCRE.")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_proxy_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_proxy_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_fastcgi_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_fastcgi_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_memcached_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_memcached_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_limit_zone_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_limit_zone_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_empty_gif_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_empty_gif_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_browser_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_browser_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_upstream_ip_hash_module")]),s._v(" "),t("td",[s._v("禁用 ngx_http_upstream_ip_hash_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_perl_module")]),s._v(" "),t("td",[s._v("启用 ngx_http_perl_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-perl_modules_path=PATH")]),s._v(" "),t("td",[s._v("指定 perl 模块的路径")])]),s._v(" "),t("tr",[t("td",[s._v("--with-perl=PATH")]),s._v(" "),t("td",[s._v("指定 perl 执行文件的路径")])]),s._v(" "),t("tr",[t("td",[s._v("--http-log-path=PATH")]),s._v(" "),t("td",[s._v("Set path to the http access log")])]),s._v(" "),t("tr",[t("td",[s._v("--http-client-body-temp-path=PATH")]),s._v(" "),t("td",[s._v("Set path to the http client request body temporary files")])]),s._v(" "),t("tr",[t("td",[s._v("--http-proxy-temp-path=PATH")]),s._v(" "),t("td",[s._v("Set path to the http proxy temporary files")])]),s._v(" "),t("tr",[t("td",[s._v("--http-fastcgi-temp-path=PATH")]),s._v(" "),t("td",[s._v("Set path to the http fastcgi temporary files")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http")]),s._v(" "),t("td",[s._v("禁用 HTTP server")])]),s._v(" "),t("tr",[t("td",[s._v("--with-mail")]),s._v(" "),t("td",[s._v("启用 IMAP4/POP3/SMTP 代理模块")])]),s._v(" "),t("tr",[t("td",[s._v("--with-mail_ssl_module")]),s._v(" "),t("td",[s._v("启用 ngx_mail_ssl_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-cc=PATH")]),s._v(" "),t("td",[s._v("指定 C 编译器的路径")])]),s._v(" "),t("tr",[t("td",[s._v("--with-cpp=PATH")]),s._v(" "),t("td",[s._v("指定 C 预处理器的路径")])]),s._v(" "),t("tr",[t("td",[s._v("--with-cc-opt=OPTIONS")]),s._v(" "),t("td",[s._v('Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate --with-cc-opt="-I /usr/local/include". If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: --with-cc-opt="-D FD_SETSIZE=2048".')])]),s._v(" "),t("tr",[t("td",[s._v("--with-ld-opt=OPTIONS")]),s._v(" "),t("td",[s._v('Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate --with-ld-opt="-L /usr/local/lib".')])]),s._v(" "),t("tr",[t("td",[s._v("--with-cpu-opt=CPU")]),s._v(" "),t("td",[s._v("为特定的 CPU 编译, 有效的值包括: pentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64")])]),s._v(" "),t("tr",[t("td",[s._v("--without-pcre")]),s._v(" "),t("td",[s._v('禁止 PCRE 库的使用. 同时也会禁止 HTTP rewrite 模块. 在 "location" 配置指令中的正则表达式也需要 PCRE.')])]),s._v(" "),t("tr",[t("td",[s._v("--with-pcre=DIR")]),s._v(" "),t("td",[s._v("指定 PCRE 库的源代码的路径.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-pcre-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for PCRE building.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-md5=DIR")]),s._v(" "),t("td",[s._v("Set path to md5 library sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-md5-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for md5 building.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-md5-asm")]),s._v(" "),t("td",[s._v("Use md5 assembler sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-sha1=DIR")]),s._v(" "),t("td",[s._v("Set path to sha1 library sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-sha1-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for sha1 building.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-sha1-asm")]),s._v(" "),t("td",[s._v("Use sha1 assembler sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-zlib=DIR")]),s._v(" "),t("td",[s._v("Set path to zlib library sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-zlib-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for zlib building.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-zlib-asm=CPU")]),s._v(" "),t("td",[s._v("Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro")])]),s._v(" "),t("tr",[t("td",[s._v("--with-openssl=DIR")]),s._v(" "),t("td",[s._v("Set path to OpenSSL library sources")])]),s._v(" "),t("tr",[t("td",[s._v("--with-openssl-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for OpenSSL building")])]),s._v(" "),t("tr",[t("td",[s._v("--with-debug")]),s._v(" "),t("td",[s._v("启用调试日志")])]),s._v(" "),t("tr",[t("td",[s._v("--add-module=PATH")]),s._v(" "),t("td",[s._v("Add in a third-party module found in directory PATH")])])])]),s._v(" "),t("h4",{attrs:{id:"nginx配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置"}},[s._v("#")]),s._v(" Nginx配置")]),s._v(" "),t("p",[s._v("在 Centos 默认配置文件在  "),t("strong",[s._v("/usr/local/nginx-1.5.1/conf/nginx.conf.")]),s._v("  要在这里配置一些文件. "),t("strong",[s._v("nginx.conf 是主配置文件")]),s._v(", 由若干个部分组成, 每个大括号 "),t("code",[s._v("{}")]),s._v("​ 表示一个部分. 每一行指令都由分号结束 "),t("code",[s._v(";")]),s._v("​, 标志着一行的结束.")]),s._v(" "),t("h5",{attrs:{id:"常用正则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用正则"}},[s._v("#")]),s._v(" 常用正则")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("正则")]),s._v(" "),t("th",[s._v("说明")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("正则")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v(".")]),s._v("​")]),s._v(" "),t("td",[s._v("匹配除换行符以外的任意字符")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("$")]),s._v("​")]),s._v(" "),t("td",[s._v("匹配字符串的结束")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("?")]),s._v("​")]),s._v(" "),t("td",[s._v("重复 0 次或 1 次")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("{n}")]),s._v("​")]),s._v(" "),t("td",[s._v("重复 n 次")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("+")]),s._v("​")]),s._v(" "),t("td",[s._v("重复 1 次或更多次")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("{n,}")]),s._v("​")]),s._v(" "),t("td",[s._v("重复 n 次或更多次")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("*")]),s._v("​")]),s._v(" "),t("td",[s._v("重复 0 次或更多次")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("[c]")]),s._v("​")]),s._v(" "),t("td",[s._v("匹配单个字符 c")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("\\d")]),s._v("​")]),s._v(" "),t("td",[s._v("匹配数字")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("[a-z]")]),s._v("​")]),s._v(" "),t("td",[s._v("匹配 a-z 小写字母的任意一个")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("​"),t("code",[s._v("^")]),s._v("​")]),s._v(" "),t("td",[s._v("匹配字符串的开始")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")]),s._v(" "),t("td",[s._v("-")])])])]),s._v(" "),t("h5",{attrs:{id:"全局变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全局变量"}},[s._v("#")]),s._v(" 全局变量")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("变量")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("​"),t("code",[s._v("$args")]),s._v("​")]),s._v(" "),t("td",[s._v("这个变量等于请求行中的参数, 同 "),t("code",[s._v("$query_string")]),s._v("​")])]),s._v(" "),t("tr",[t("td",[s._v("​ "),t("strong",[s._v("​"),t("code",[s._v("$content_length")]),s._v("​")]),s._v("​")]),s._v(" "),t("td",[s._v("请求头中的 Content-length 字段.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$content_type")]),s._v("​")]),s._v(" "),t("td",[s._v("请求头中的 Content-Type 字段.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$document_root")]),s._v("​")]),s._v(" "),t("td",[s._v("当前请求在 root 指令中指定的值.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$host")]),s._v("​")]),s._v(" "),t("td",[s._v("请求主机头字段, 否则为服务器名称.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$http_user_agent")]),s._v("​")]),s._v(" "),t("td",[s._v("客户端 agent 信息")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$http_cookie")]),s._v("​")]),s._v(" "),t("td",[s._v("客户端 cookie 信息")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$limit_rate")]),s._v("​")]),s._v(" "),t("td",[s._v("这个变量可以限制连接速率.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$request_method")]),s._v("​")]),s._v(" "),t("td",[s._v("客户端请求的动作, 通常为 GET 或 POST.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$remote_addr")]),s._v("​")]),s._v(" "),t("td",[s._v("客户端的 IP 地址.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$document_uri")]),s._v("​")]),s._v(" "),t("td",[s._v("与 $uri 相同.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$remote_port")]),s._v("​")]),s._v(" "),t("td",[s._v("客户端的端口.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$remote_user")]),s._v("​")]),s._v(" "),t("td",[s._v("已经经过 Auth Basic Module 验证的用户名.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$request_filename")]),s._v("​")]),s._v(" "),t("td",[s._v("当前请求的文件路径, 由 root 或 alias 指令与 URI 请求生成.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$scheme")]),s._v("​")]),s._v(" "),t("td",[s._v("HTTP 方法(如 http, https).")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$server_protocol")]),s._v("​")]),s._v(" "),t("td",[s._v("请求使用的协议, 通常是 HTTP/1.0 或 HTTP/1.1.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$server_addr")]),s._v("​")]),s._v(" "),t("td",[s._v("服务器地址, 在完成一次系统调用后可以确定这个值.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$server_name")]),s._v("​")]),s._v(" "),t("td",[s._v("服务器名称.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$server_port")]),s._v("​")]),s._v(" "),t("td",[s._v("请求到达服务器的端口号.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$request_uri")]),s._v("​")]),s._v(" "),t("td",[s._v("包含请求参数的原始 URI, 不包含主机名, 如: "),t("code",[s._v("/foo/bar.php?arg=baz")]),s._v("​.")])]),s._v(" "),t("tr",[t("td",[s._v("​"),t("code",[s._v("$uri")]),s._v("​")]),s._v(" "),t("td",[s._v("不带请求参数的当前 URI, $uri 不包含主机名, 如 "),t("code",[s._v("/foo/bar.html")]),s._v("​.")])])])]),s._v(" "),t("p",[s._v("例如请求: "),t("code",[s._v("http://localhost:3000/test1/test2/test.php")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$host: localhost\n$server_port: 3000\n$request_uri: /test1/test2/test.php\n$document_uri: /test1/test2/test.php\n$document_root: /var/www/html\n$request_filename: /var/www/html/test1/test2/test.php\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"符号参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#符号参考"}},[s._v("#")]),s._v(" 符号参考")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("符号")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("说明")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("符号")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("说明")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("符号")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("k,K")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("千字节")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("m,M")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("兆字节")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("ms")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("毫秒")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("s")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("秒")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("m")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("分钟")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("h")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("小时")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("d")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("日")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("w")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("周")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("M")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("一个月, 30天")])])])]),s._v(" "),t("p",[s._v('例如, "8k", "1m" 代表'),t("strong",[s._v("字节数计量")]),s._v('.\n例如, "1h 30m", "1y 6M". 代表 "1 小时 30 分", "1 年零 6 个月".')]),s._v(" "),t("h5",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),t("p",[t("strong",[s._v("nginx 的配置系统由一个主配置文件和其他一些辅助的配置文件构成. 这些配置文件均是纯文本文件, 全部位于 nginx 安装目录下的 conf 目录下")]),s._v(".")]),s._v(" "),t("p",[s._v("指令由 nginx 的各个模块提供, 不同的模块会提供不同的指令来实现配置. 指令除了 Key-Value 的形式, 还有作用域指令.")]),s._v(" "),t("p",[s._v("nginx.conf 中的配置信息, 根据其逻辑上的意义, 对它们进行了"),t("strong",[s._v("分类")]),s._v(", 也就是分成了"),t("strong",[s._v("多个作用域")]),s._v(", 或者称之为配置指令上下文. 不同的作用域含有一个或者多个配置项.")]),s._v(" "),t("p",[s._v("下面的这些上下文指令是用的比较多:")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("Directive")]),s._v(" "),t("th",[s._v("Description")]),s._v(" "),t("th",[s._v("Contains Directive")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("main")]),s._v(" "),t("td",[s._v("nginx 在"),t("strong",[s._v("运行时与具体业务功能(比如 http 服务或者 email 服务代理)无关")]),s._v("的一些参数, 比如工作进程数, 运行的身份等.")]),s._v(" "),t("td",[s._v("user, worker_processes, error_log, events, http, mail")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("http")]),s._v(" "),t("td",[s._v("与"),t("mark",[t("strong",[s._v("提供 http 服务相关的一些配置参数")])]),s._v(". 例如: 是否使用 keepalive, 是否使用 gzip 进行压缩等.")]),s._v(" "),t("td",[s._v("server")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("server")]),s._v(" "),t("td",[t("mark",[t("strong",[s._v("http 服务上支持若干虚拟主机. 每个虚拟主机一个对应的 server 配置项, 配置项里面包含该虚拟主机相关的配置")])]),s._v(". 在提供 mail 服务的代理时, 也可以建立若干 server. 每个 server 通过监听的地址来区分.")]),s._v(" "),t("td",[s._v("listen, server_name, access_log, location, protocol, proxy, smtp_auth, xclient")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("location")]),s._v(" "),t("td",[t("mark",[s._v("**http 服务中, 某些特定的 URL 对应的一系列配置项. **")])]),s._v(" "),t("td",[s._v("index, root")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("mail")]),s._v(" "),t("td",[s._v("实现 email 相关的 SMTP/IMAP/POP3 代理时, 共享的一些配置项(因为可能实现多个代理, 工作在多个监听地址上).")]),s._v(" "),t("td",[s._v("server, http, imap_capabilities")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("include")]),s._v(" "),t("td",[s._v("以便增强配置文件的可读性, "),t("strong",[s._v("使得部分配置文件可以重新使用")]),s._v(".")]),s._v(" "),t("td",[s._v("-")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("valid_referers")]),s._v(" "),t("td",[s._v("用来校验 Http 请求头 Referer 是否有效.")]),s._v(" "),t("td",[s._v("-")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("try_files")]),s._v(" "),t("td",[s._v("用在 server 部分, 不过最常见的还是用在 location 部分, 它会按照给定的参数顺序进行尝试, 第一个被匹配到的将会被使用.")]),s._v(" "),t("td",[s._v("-")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("if")]),s._v(" "),t("td",[s._v("当在 location 块中使用 if 指令, 在某些情况下它并不按照预期运行, 一般来说"),t("strong",[s._v("避免使用 if 指令")]),s._v(".")]),s._v(" "),t("td",[s._v("-")])])])]),s._v(" "),t("p",[s._v("例如在 "),t("strong",[s._v("nginx.conf")]),s._v(" 里面引用两个配置 "),t("code",[s._v("vhost/example.com.conf")]),s._v("​ 和 "),t("code",[s._v("vhost/gitlab.com.conf")]),s._v("​ 它们都被放在一个自己新建的目录 vhost 下面. nginx.conf 配置如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/access.log  main;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive_timeout  0;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听80端口")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("  vhost/example.com.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("  vhost/gitlab.com.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("p",[s._v("简单的配置: example.com.conf")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 侦听的80端口")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  baidu.com app.baidu.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里指定域名")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("        index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里指定默认入口页面")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/www/app.baidu.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里指定目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"内置预定义变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内置预定义变量"}},[s._v("#")]),s._v(" 内置预定义变量")]),s._v(" "),t("p",[s._v("Nginx 提供了许多预定义的变量, 也可以通过使用 set 来设置变量. 可以在 if 中使用预定义变量, 也可以"),t("strong",[s._v("将它们传递给代理服务器")]),s._v(". 以下是一些常见的预定义变量, "),t("a",{attrs:{href:"http://nginx.org/en/docs/varindex.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("更多详见"),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("变量名称")]),s._v(" "),t("th",[s._v("值")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("$args_name")]),s._v(" "),t("td",[s._v("在请求中的 name 参数")])]),s._v(" "),t("tr",[t("td",[s._v("$args")]),s._v(" "),t("td",[s._v("所有请求参数")])]),s._v(" "),t("tr",[t("td",[s._v("$query_string")]),s._v(" "),t("td",[s._v("$args 的别名")])]),s._v(" "),t("tr",[t("td",[s._v("$content_length")]),s._v(" "),t("td",[s._v("请求头 Content-Length 的值")])]),s._v(" "),t("tr",[t("td",[s._v("$content_type")]),s._v(" "),t("td",[s._v("请求头 Content-Type 的值")])]),s._v(" "),t("tr",[t("td",[s._v("$host")]),s._v(" "),t("td",[s._v("如果当前有 Host, 则为请求头 Host 的值; 如果没有这个头, 那么该值等于匹配该请求的 server_name 的值")])]),s._v(" "),t("tr",[t("td",[s._v("$remote_addr")]),s._v(" "),t("td",[s._v("客户端的 IP 地址")])]),s._v(" "),t("tr",[t("td",[s._v("$request")]),s._v(" "),t("td",[s._v("完整的请求, 从客户端收到, 包括 Http 请求方法, URI, Http 协议, 头, 请求体")])]),s._v(" "),t("tr",[t("td",[s._v("$request_uri")]),s._v(" "),t("td",[s._v("完整请求的 URI, 从客户端来的请求, 包括参数")])]),s._v(" "),t("tr",[t("td",[s._v("$scheme")]),s._v(" "),t("td",[s._v("当前请求的协议")])]),s._v(" "),t("tr",[t("td",[s._v("$uri")]),s._v(" "),t("td",[s._v("当前请求的标准化 URI")])])])]),s._v(" "),t("h5",{attrs:{id:"反向代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),t("p",[s._v("反向代理是一个 Web 服务器, 它"),t("mark",[t("strong",[s._v("接受客户端的连接请求, 然后将请求转发给上游服务器, 并将从服务器得到的结果返回给连接的客户端")])]),s._v(". 下面简单的反向代理的例子:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                                        \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                              \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024M")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许客户端请求的最大单文件字节数")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("                         http://localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host              "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP的请求端真实的IP")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为了正确地识别实际用户发出的协议是 http 还是 https")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("复杂的配置: gitlab.com.conf.")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 侦听的80端口")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  git.example.cn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("   http://localhost:3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下是一些反向代理的配置可删除")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后端的Web服务器可以通过X-Forwarded-For获取用户真实IP")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("           Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许客户端请求的最大单文件字节数")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_body_buffer_size")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓冲区代理缓冲用户端请求的最大字节数")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx跟后端服务器连接超时时间(代理连接超时)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后端服务器数据回传时间(代理发送超时)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接成功后, 后端服务器响应时间(代理接收超时)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffer_size")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置代理服务器(nginx)保存用户头信息的缓冲区大小")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffers")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_buffers缓冲区, 网页平均在32k以下的话, 这样设置")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_busy_buffers_size")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 高负荷下缓冲大小(proxy_buffers*2)")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[t("strong",[s._v("代理到上游服务器的配置中, 最重要的是 proxy_pass 指令")]),s._v(". 以下是代理模块中的一些常用指令:")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("指令")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("mark",[t("strong",[s._v("proxy_connect_timeout")])])]),s._v(" "),t("td",[t("strong",[s._v("Nginx 从接受请求至连接到上游服务器的最长等待时间")])])]),s._v(" "),t("tr",[t("td",[t("mark",[t("strong",[s._v("proxy_send_timeout")])])]),s._v(" "),t("td",[t("strong",[s._v("后端服务器数据回传时间(代理发送超时)")])])]),s._v(" "),t("tr",[t("td",[t("mark",[t("strong",[s._v("proxy_read_timeout")])])]),s._v(" "),t("td",[t("strong",[s._v("连接成功后, 后端服务器响应时间(代理接收超时)")])])]),s._v(" "),t("tr",[t("td",[s._v("proxy_cookie_domain")]),s._v(" "),t("td",[s._v("替代从上游服务器来的 Set-Cookie 头的 domain 属性")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_cookie_path")]),s._v(" "),t("td",[s._v("替代从上游服务器来的 Set-Cookie 头的 path 属性")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_buffer_size")]),s._v(" "),t("td",[s._v("设置代理服务器(nginx)保存用户头信息的缓冲区大小")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_buffers")]),s._v(" "),t("td",[s._v("proxy_buffers 缓冲区, 网页平均在多少 k 以下")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_set_header")]),s._v(" "),t("td",[s._v("重写发送到上游服务器头的内容, 也可以通过将某个头部的值设置为空字符串, 而不发送某个头部的方法实现")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_ignore_headers")]),s._v(" "),t("td",[s._v("这个指令禁止处理来自代理服务器的应答.")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_intercept_errors")]),s._v(" "),t("td",[s._v("使 nginx 阻止 HTTP 应答代码为 400 或者更高的应答.")])])])]),s._v(" "),t("h5",{attrs:{id:"负载均衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("upstream 指令启用一个新的配置区段, 在该区段定义一组上游服务器")])]),s._v(". 这些服务器可能被设置不同的权重, 也可能出于对服务器进行维护, 标记为 down.")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" gitlab")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ip_hash")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# upstream的负载均衡, weight是权重, 可以根据机器配置定义权重. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# weigth参数表示权值, 权值越高被分配到的几率越大. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.122.11:8081")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:82 weight=3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:83 weight=3 down")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:84 weight=3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("max_fails=3")]),s._v("  fail_timeout=20s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:85 weight=4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 侦听的80端口")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  git.example.cn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("   http://gitlab")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在这里设置一个代理, 和upstream的名字一样")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下是一些反向代理的配置可删除")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后端的Web服务器可以通过X-Forwarded-For获取用户真实IP")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("           Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("           X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("           X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许客户端请求的最大单文件字节数")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_body_buffer_size")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓冲区代理缓冲用户端请求的最大字节数")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx跟后端服务器连接超时时间(代理连接超时)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端服务器数据回传时间(代理发送超时)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接成功后, 后端服务器响应时间(代理接收超时)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffer_size")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置代理服务器(nginx)保存用户头信息的缓冲区大小")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffers")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓冲区, 网页平均在32k以下的话, 这样设置")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_busy_buffers_size")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#高负荷下缓冲大小(proxy_buffers*2)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_temp_file_write_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定缓存文件夹大小, 大于这个值, 将从upstream服务器传")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("每个请求按时间顺序逐一分配到不同的后端服务器, 如果后端服务器 down 掉, 能自动剔除.")]),s._v(" "),t("p",[s._v("**负载均衡: **")]),s._v(" "),t("p",[s._v("upstream 模块能够使用 3 种负载均衡算法: "),t("strong",[s._v("轮询, IP哈希, 最少连接数")]),s._v(".")]),s._v(" "),t("ul",[t("li",[s._v("**轮询(RR): ** 默认情况下使用轮询算法, 不需要配置指令来激活它, 它是基于在队列中谁是下一个的原理确保访问均匀地分布到每个上游服务器;")]),s._v(" "),t("li",[s._v("**IP哈希: **  通过 ip_hash 指令来激活, Nginx 通过 IPv4 地址的前 3 个字节或者整个 IPv6 地址作为哈希键来实现, 同一个 IP 地址总是能被映射到同一个上游服务器;")]),s._v(" "),t("li",[t("strong",[s._v("最少连接数: **  通过 least_conn 指令来激活, 该算法")]),s._v("通过选择一个活跃数最少的上游服务器进行连接**. 如果上游服务器处理能力不同, 可以通过给 server 配置 weight 权重来说明, 该算法将考虑到不同服务器的加权最少连接数.")])]),s._v(" "),t("h6",{attrs:{id:"轮询-rr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#轮询-rr"}},[s._v("#")]),s._v(" 轮询(RR)")]),s._v(" "),t("p",[t("strong",[s._v("简单配置")]),s._v(", 这里配置了 2 台服务器, 当然实际上是一台, 只是端口不一样而已, 而 8081 的服务器是不存在的, 也就是说访问不到, 但是访问 "),t("code",[s._v("http://localhost")]),s._v("​ 的时候, 也不会有问题, 会默认跳转到 "),t("code",[s._v("http://localhost:8080")]),s._v("​ 具体是因为 Nginx 会自动判断服务器的状态, 如果服务器处于不能访问(服务器挂了), 就不会跳转到这台服务器, 所以也避免了一台服务器挂了影响使用的情况, 由于 "),t("strong",[s._v("Nginx 默认是 RR 策略")]),s._v(", 所以不需要其他更多的设置.")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024M")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("strong",[s._v("负载均衡的核心代码为:")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h6",{attrs:{id:"权重"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#权重"}},[s._v("#")]),s._v(" 权重")]),s._v(" "),t("p",[s._v("指定轮询几率, "),t("strong",[s._v("weight 和访问比率成正比, 用于后端服务器性能不均")]),s._v("的情况. 例如:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080 weight=9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081 weight=1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("那么 10 次一般只会有 1 次会访问到 8081, 而有 9 次会访问到 8080.")]),s._v(" "),t("h6",{attrs:{id:"ip-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ip-hash"}},[s._v("#")]),s._v(" ip_hash")]),s._v(" "),t("p",[s._v("上面的 2 种方式都有一个问题, 那就是下一个请求来的时候请求可能分发到另外一个服务器, 当程序不是无状态的时候(采用了 session 保存数据), 这时候就有一个很大的很问题了, 比如把登录信息保存到了 session 中, 那么跳转到另外一台服务器的时候就需要重新登录了, 所以很多时候需要一个客户只访问一个服务器, 那么就需要用 iphash 了, "),t("strong",[s._v("iphash 的每个请求按访问 ip 的 hash 结果分配, 这样每个访客固定访问一个后端服务器, 可以解决 session 的问题")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ip_hash")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h6",{attrs:{id:"fair"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fair"}},[s._v("#")]),s._v(" fair")]),s._v(" "),t("p",[s._v("这是个第三方模块, "),t("strong",[s._v("按后端服务器的响应时间来分配请求, 响应时间短的优先分配")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backend")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fair")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h6",{attrs:{id:"url-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url-hash"}},[s._v("#")]),s._v(" url_hash")]),s._v(" "),t("p",[s._v("这是个第三方模块, "),t("strong",[s._v("按访问 url 的 hash 结果来分配请求")]),s._v(", 使每个 url 定向到同一个后端服务器, 后端服务器为缓存时比较有效. 在 upstream 中加入 hash 语句, server 语句中不能写入 weight 等其他的参数, hash_method 是使用的 hash 算法")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backend")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("hash")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("hash_method")]),s._v(" crc32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("以上 5 种负载均衡各自适用不同情况下使用, 所以可以根据实际情况选择使用哪种策略模式, 不过 fair 和 url_hash 需要安装第三方模块才能使用.")]),s._v(" "),t("p",[s._v("**server 指令可选参数: **")]),s._v(" "),t("ol",[t("li",[t("mark",[t("strong",[s._v("weight")])]),s._v(": 设置一个服务器的"),t("strong",[s._v("访问权重")]),s._v(", 数值越高, 收到的请求也越多;")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("fail_timeout")])]),s._v(": 在这个指定的时间内服务器必须提供响应, 如果在这个时间内没有收到响应, 那么服务器将会被标记为 down 状态;")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("max_fails")])]),s._v(": 设置在 fail_timeout 时间之内尝试对一个服务器连接的最大次数, 如果超过这个次数, 那么服务器将会被标记为 down;")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("down")])]),s._v(": 标记一个服务器不再接受任何请求;")]),s._v(" "),t("li",[t("mark",[t("strong",[s._v("backup")])]),s._v(": 一旦其他服务器宕机, 那么有该标记的机器将会接收请求.")])]),s._v(" "),t("p",[s._v("**keepalive 指令: **")]),s._v(" "),t("p",[s._v("**Nginx 服务器将会为每一个 worker 进行保持同上游服务器的连接. **")]),s._v(" "),t("h6",{attrs:{id:"屏蔽ip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#屏蔽ip"}},[s._v("#")]),s._v(" 屏蔽ip")]),s._v(" "),t("p",[s._v("在 nginx 的配置文件 "),t("code",[s._v("nginx.conf")]),s._v("​ 中加入如下配置, 可以放到 http, server, location, limit_except语句块, 需要注意相对路径, 本例当中 "),t("code",[s._v("nginx.conf")]),s._v("​, "),t("code",[s._v("blocksip.conf")]),s._v("​ 在同一个目录中.")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" blockip.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在 blockip.conf 里面输入内容, 如:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" 165.91.122.67")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" IP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽单个ip访问")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" IP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许单个ip访问")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽所有ip访问")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许所有ip访问")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" 123.0.0.0/8   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽整个段即从123.0.0.1到123.255.255.254访问的命令")]),s._v("\ndeny 124.45.0.0/16 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽IP段即从123.45.0.1到123.45.255.254访问的命令")]),s._v("\ndeny 123.45.6.0/24 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽IP段即从123.45.6.1到123.45.6.254访问的命令")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果想实现这样的应用, 除了几个IP外, 其他全部拒绝")]),s._v("\nallow 1.1.1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 1.1.1.2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h4",{attrs:{id:"重定向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重定向"}},[s._v("#")]),s._v(" 重定向")]),s._v(" "),t("ul",[t("li",[s._v("​"),t("code",[s._v("permanent")]),s._v("​ 永久性重定向. 请求日志中的状态码为 301.")]),s._v(" "),t("li",[s._v("​"),t("code",[s._v("redirect")]),s._v("​ 临时重定向. 请求日志中的状态码为 302.")])]),s._v(" "),t("blockquote",[t("p",[s._v("重定向整个网站")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" old-site.com\n    return "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),s._v("://new-site.com"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[s._v("重定向单页")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /oldpage.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" http://example.org/newpage.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("blockquote",[t("p",[s._v("重定向整个子路径")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /old-site")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/old-site/(.*) http://example.org/new-site/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"性能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#性能"}},[s._v("#")]),s._v(" 性能")]),s._v(" "),t("h5",{attrs:{id:"内容缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内容缓存"}},[s._v("#")]),s._v(" 内容缓存")]),s._v(" "),t("p",[s._v("允许浏览器基本上永久地缓存静态内容.  Nginx 将为您"),t("strong",[s._v("设置 Expires 和 Cache-Control 头")]),s._v("信息.")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("如果"),t("strong",[s._v("要求浏览器永远不会缓存响应(例如用于跟踪请求), 请使用 -1")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /empty.gif")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("empty_gif")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" -1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"gzip压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gzip压缩"}},[s._v("#")]),s._v(" Gzip压缩")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_buffers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" 1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_min_length")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_proxied")]),s._v(" any")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_vary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v("\n    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml\n    text/javascript application/javascript application/x-javascript\n    text/x-json application/json application/x-web-app-manifest+json\n    text/css text/plain text/x-component\n    font/opentype application/x-font-ttf application/vnd.ms-fontobject\n    image/x-icon")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_disable")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msie6"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h5",{attrs:{id:"打开文件缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打开文件缓存"}},[s._v("#")]),s._v(" 打开文件缓存")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache")]),s._v(" max=1000 inactive=20s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_valid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30s")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_min_uses")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_errors")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"ssl缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssl缓存"}},[s._v("#")]),s._v(" SSL缓存")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_cache")]),s._v(" shared:SSL:10m")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h5",{attrs:{id:"上游keepalive"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上游keepalive"}},[s._v("#")]),s._v(" 上游Keepalive")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backend")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ...\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /api/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_http_version")]),s._v(" 1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h5",{attrs:{id:"监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控"}},[s._v("#")]),s._v(" 监控")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("ngxtop")]),s._v("​ 实时解析 nginx 访问日志, 并且将处理结果输出到终端, 功能类似于系统命 令top. 所有示例都读取 nginx 配置文件的访问日志位置和格式. 如果要指定访问日志文件和/或日志格式, 请使用 -f 和 -a 选项.")]),s._v(" "),t("p",[s._v("注意: 在 nginx 配置中 "),t("code",[s._v("/usr/local/nginx/conf/nginx.conf")]),s._v("​ 日志文件必须是"),t("strong",[s._v("绝对路径")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 ngxtop")]),s._v("\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ngxtop\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实时状态")]),s._v("\nngxtop\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 状态为404的前10个请求的路径: ")]),s._v("\nngxtop "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" request_path "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status == 404'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送总字节数最多的前10个请求")]),s._v("\nngxtop --order-by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'avg(bytes_sent) * count'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 排名前十位的IP, 例如, 谁攻击你最多")]),s._v("\nngxtop --group-by remote_addr\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印具有4xx或5xx状态的请求, 以及status和http referer")]),s._v("\nngxtop "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status >= 400'")]),s._v(" print request status http_referer\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由200个请求路径响应发送的平均正文字节以'foo'开始: ")]),s._v("\nngxtop avg bytes_sent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status == 200 and request_path.startswith(\"foo\")'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用“common”日志格式从远程机器分析apache访问日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" remote "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /var/log/apache2/access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ngxtop "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" common\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h4",{attrs:{id:"常见使用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见使用场景"}},[s._v("#")]),s._v(" 常见使用场景")]),s._v(" "),t("h5",{attrs:{id:"跨域问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题"}},[s._v("#")]),s._v(" 跨域问题")]),s._v(" "),t("p",[s._v("在工作中, 有时候会遇到一些接口不支持跨域, 这时候可以"),t("strong",[s._v("简单的添加 add_headers 来支持 cors 跨域")]),s._v(". 配置如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" api.xxx.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Credentials'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'true'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Methods'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET,POST,HEAD'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("上面更改头信息, 还有一种, 使用 "),t("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_rewrite_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("rewrite"),t("OutboundLink")],1),s._v(" 指令"),t("strong",[s._v("重定向 URI 来解决跨域问题")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" api.xxx.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#去请求../html文件夹里的文件")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#首页响应地址")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于拦截请求, 匹配任何以 /api/开头的地址, ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配符合以后, 停止往下搜索正则. ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/api/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代表重写拦截进来的请求, 并且只能对域名后边的除去传递的参数外的字符串起作用, ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如www.a.com/proxy/api/msg?meth=1&par=2重写, 只对/proxy/api/msg重写. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rewrite后面的参数是一个简单的正则 ^/api/(.*)$, ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $1代表正则中的第一个(), $2代表第二个()的值, 以此类推. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/api/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把请求代理到其他主机 ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中 http://www.b.com/ 写法和 http://www.b.com写法的区别如下")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果你的请求地址是他 http://server/html/test.jsp")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置一:  http://www.b.com/ 后面有“/” ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#         将反向代理成 http://www.b.com/html/test.jsp 访问")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置一:  http://www.b.com 后面没有有“/” ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#         将反向代理成 http://www.b.com/test.jsp 访问")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果 proxy_pass  URL 是 http://a.xx.com/platform/ 这种情况")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_cookie_path应该设置成 /platform/ / (注意两个斜杠之间有空格). ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_cookie_path")]),s._v(" /platfrom/ /")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 Cookie 头通过")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass_header")]),s._v(" Set-Cookie")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("h5",{attrs:{id:"跳转到带www的域上面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#跳转到带www的域上面"}},[s._v("#")]),s._v(" 跳转到带www的域上面")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置正常的带www的域名")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" www.wangchujiang.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/www/wabg/download")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html =404")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个要放到下面, ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将不带www的 wangchujiang.com 永久性重定向到  https://www.wangchujiang.com")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" wangchujiang.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^(.*) https://www.wangchujiang.com"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h5",{attrs:{id:"代理转发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代理转发"}},[s._v("#")]),s._v(" 代理转发")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" server-api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# api 代理服务地址")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:3110")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" server-resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 静态资源 代理服务地址")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:3120")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3111")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里指定域名")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/www/server-statics")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 api 路由的反向代理到API服务")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/api/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://server-api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 假设这里验证码也在API服务中")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/captcha")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://server-api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 假设你的图片资源全部在另外一个服务上面")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/img/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://server-resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由在前端, 后端没有真实路由, 在路由不存在的 404状态的页面返回 /index.html")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个方式使用场景, 你在写React或者Vue项目的时候, 没有真实路由")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html =404")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                               ^ 空格很重要")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("h5",{attrs:{id:"监控状态信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控状态信息"}},[s._v("#")]),s._v(" 监控状态信息")]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("nginx -V")]),s._v(" 来查看是否有 "),t("code",[s._v("with-http_stub_status_module")]),s._v(" 该模块.")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("nginx -V")]),s._v(" 这里 "),t("code",[s._v("V")]),s._v(" 是大写的, 如果是小写的 "),t("code",[s._v("v")]),s._v(" 即 "),t("code",[s._v("nginx -v")]),s._v(", 则不会出现有哪些模块, 只会出现 "),t("code",[s._v("nginx")]),s._v(" 的版本")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /nginx_status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("stub_status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("通过 "),t("code",[s._v("http://127.0.0.1/nginx_status")]),s._v("​ 访问出现下面结果.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Active connections: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nserver accepts handled requests\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" \nReading: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Writing: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Waiting: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[s._v("主动连接(第 1 行)")])]),s._v(" "),t("p",[s._v("当前与 http 建立的连接数, 包括等待的客户端连接: 3")]),s._v(" "),t("blockquote",[t("p",[s._v("服务器接受处理的请求(第 2~3 行)")])]),s._v(" "),t("p",[s._v("接受的客户端连接总数目: 7")]),s._v(" "),t("p",[s._v("处理的客户端连接总数目: 7")]),s._v(" "),t("p",[s._v("客户端总的请求数目: 5")]),s._v(" "),t("blockquote",[t("p",[s._v("读取其它信(第 4 行)")])]),s._v(" "),t("p",[s._v("当前, nginx 读请求连接")]),s._v(" "),t("p",[s._v("当前, nginx 写响应返回给客户端")]),s._v(" "),t("p",[s._v("目前有多少空闲客户端请求连接")]),s._v(" "),t("h5",{attrs:{id:"代理转发连接替换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代理转发连接替换"}},[s._v("#")]),s._v(" 代理转发连接替换")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/api/upload")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)$ /wfs/v1/upload break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://wfs-api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"ssl配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssl配置"}},[s._v("#")]),s._v(" ssl配置")]),s._v(" "),t("p",[s._v("超文本传输安全协议(缩写: HTTPS)是超文本传输协议和 SSL/TLS 的组合, 用以提供加密通讯及对网络服务器身份的鉴定. HTTPS 连接经常被用于万维网上的交易支付和企业信息系统中敏感信息的传输. HTTPS 目前已经是所有注重隐私和安全的网站的首选, 随着技术的不断发展, HTTPS 网站已不再是大型网站的专利, 所有普通的个人站长和博客均可以自己动手搭建一个安全的加密的网站.")]),s._v(" "),t("p",[t("strong",[s._v("创建 SSL 证书")]),s._v(", 如果你购买的证书, 就可以直接下载.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/nginx/ssl\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建了有效期100年, 加密强度为RSA2048的SSL密钥key和X509证书文件. ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" openssl req "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x509")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nodes")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-days")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("36500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-newkey")]),s._v(" rsa:2048 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-keyout")]),s._v(" /etc/nginx/ssl/nginx.key "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" /etc/nginx/ssl/nginx.crt\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上面命令, 会有下面需要填写内容")]),s._v("\nCountry Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" letter code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("AU"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":US\nState or Province Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("full name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Some-State"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":New York\nLocality Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":New York City\nOrganization Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, company"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Internet Widgits Pty Ltd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":Bouncy Castles, Inc.\nOrganizational Unit Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, section"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":Ministry of Water Slides\nCommon Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g. server FQDN or YOUR name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":your_domain.com\nEmail Address "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":admin@your_domain.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("创建自签证书:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("首先, 创建证书和私钥的目录\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /etc/nginx/cert")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/nginx/cert")]),s._v("\n创建服务器私钥, 命令会让你输入一个口令: \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl genrsa -des3 -out nginx.key 2048")]),s._v("\n创建签名请求的证书"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CSR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl req -new -key nginx.key -out nginx.csr")]),s._v("\n在加载SSL支持的Nginx并使用上述私钥时除去必须的口令: \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp nginx.key nginx.key.org")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl rsa -in nginx.key.org -out nginx.key")]),s._v("\n最后标记证书使用上述私钥和CSR: \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("查看目前 nginx 编译选项")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/nginx -V\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出下面内容:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("nginx version: nginx/1.7.8\nbuilt by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("如果依赖的模块不存在, 可以进入安装目录, 输入下面命令重新编译安装.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./configure "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("运行完成之后还需要 "),t("code",[s._v("make")]),s._v("​ (不用 make install)")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份nginx的二进制文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /usr/local/nginx/sbin/nginx　 /usr/local/nginx/sbin/nginx.bak\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 覆盖nginx的二进制文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" objs/nginx   /usr/local/nginx/sbin/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("HTTPS server:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听443端口")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v(" /etc/nginx/ssl/nginx.crt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v(" /etc/nginx/ssl/nginx.key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止在header中出现服务器版本, 防止黑客利用版本漏洞攻击")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_tokens")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置ssl/tls会话缓存的类型和大小. 如果设置了这个参数一般是shared, buildin可能会参数内存碎片, 默认是none, 和off差不多, 停用缓存. 如shared:SSL:10m表示我所有的nginx工作进程共享ssl会话缓存, 官网介绍说1M可以存放约4000个sessions.  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_cache")]),s._v("    shared:SSL:1m")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端可以重用会话缓存中ssl参数的过期时间, 内网系统默认5分钟太短了, 可以设成30m即30分钟甚至4h. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择加密套件, 不同的浏览器所支持的套件(和顺序)可能会不同. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里指定的是OpenSSL库能够识别的写法, 你可以通过 openssl -v cipher 'RC4:HIGH:!aNULL:!MD5'(后面是你所指定的套件加密算法) 来看所支持算法. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_ciphers")]),s._v("  HIGH:!aNULL:!MD5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置协商加密算法时, 优先使用我们服务端的加密套件, 而不是客户端浏览器的加密套件. ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_prefer_server_ciphers")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h5",{attrs:{id:"强制将http重定向到https"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#强制将http重定向到https"}},[s._v("#")]),s._v(" 强制将http重定向到https")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^ https://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri?")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制将http重定向到https")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在错误页面和“服务器”响应头字段中启用或禁用发射nginx版本.  防止黑客利用版本漏洞攻击")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_tokens")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"两个虚拟主机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#两个虚拟主机"}},[s._v("#")]),s._v(" 两个虚拟主机")]),s._v(" "),t("p",[s._v("纯静态 -html 支持")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("     www.domain1.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("      logs/domain1.access.log main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  /var/www/domain1.com/htdocs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("     www.domain2.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("      logs/domain2.access.log main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  /var/www/domain2.com/htdocs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h5",{attrs:{id:"虚拟主机标准配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机标准配置"}},[s._v("#")]),s._v(" 虚拟主机标准配置")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("     _ *")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("      logs/default.access.log main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  /var/www/default/htdocs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h5",{attrs:{id:"爬虫过滤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#爬虫过滤"}},[s._v("#")]),s._v(" 爬虫过滤")]),s._v(" "),t("p",[s._v("根据 "),t("code",[s._v("User-Agent")]),s._v("​ 过滤请求, 通过一个简单的正则表达式, 就可以"),t("strong",[s._v("过滤不符合要求的爬虫请求")]),s._v("(初级爬虫).")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("~*")]),s._v(" 表示不区分大小写的正则匹配")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v(" ~* "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python|curl|java|wget|httpclient|okhttp"')]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正常处理")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"防盗链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防盗链"}},[s._v("#")]),s._v(" 防盗链")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~* \\.(gif|jpg|png|swf|flv)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html\n   valid_referers none blocked *.nginxcn.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$invalid_referer")]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     rewrite ^/ www.nginx.cn\n     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#return 404;")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h5",{attrs:{id:"虚拟目录配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#虚拟目录配置"}},[s._v("#")]),s._v(" 虚拟目录配置")]),s._v(" "),t("p",[s._v("alias 指定的目录是准确的, root 是指定目录的上级目录, 并且该上级目录要含有 location 指定名称的同名目录.")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /img/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /var/www/image/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问/img/目录里面的文件时, ningx会自动去/var/www/image/目录找文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /img/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /var/www/image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问/img/目录下的文件时, nginx会去/var/www/image/img/目录下找文件. ]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h5",{attrs:{id:"防盗图配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防盗图配置"}},[s._v("#")]),s._v(" 防盗图配置")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ \\/public\\/(css|js|img)\\/.*\\.(js|css|gif|jpg|jpeg|png|bmp|swf)")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" none blocked *.jslite.io")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$invalid_referer")]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/  http://wangchujiang.com/piratesp.png")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"屏蔽-git等文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#屏蔽-git等文件"}},[s._v("#")]),s._v(" 屏蔽.git等文件")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ (.git|.gitattributes|.gitignore|.svn)")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h5",{attrs:{id:"域名路径加不加需要都能正常访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#域名路径加不加需要都能正常访问"}},[s._v("#")]),s._v(" 域名路径加不加需要都能正常访问")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("http://wangchujiang.com/api/index.php?a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("wcj\n                                  ^ 有后缀\n\nhttp://wangchujiang.com/api/index?a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("wcj\n                                 ^ 没有后缀\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("nginx rewrite 规则如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)/$ /index.php?/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" (!-d "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")]),s._v(" 1"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" (!-f "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")]),s._v(" 2"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"21"')]),s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/ /index.php last")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h5",{attrs:{id:"cockpit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cockpit"}},[s._v("#")]),s._v(" cockpit")]),s._v(" "),t("p",[s._v("https://github.com/cockpit-project/cockpit")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" cockpit.xxxxxxx.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" cockpit.xxxxxxx.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssl on;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v(" /etc/nginx/cert/cockpit.xxxxxxx.com.pem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v(" /etc/nginx/cert/cockpit.xxxxxxx.com.key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://websocket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_http_version")]),s._v(" 1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Upgrade "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("这时输入域名, 能看到登录页面, 但登录后, 显示不出内容, 页面全白. 这里要对 "),t("code",[s._v("cockpit.conf")]),s._v(" 进行设置修改.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/cockpit/cockpit.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("参照如下配置修改, 注意域名替换为 "),t("code",[s._v("your_domain_host")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("WebService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("Origins")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" https://cockpit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xxxxxxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com https://"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("ProtocolHeader")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" X-Forwarded-Proto\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("AllowUnencrypted")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("‍")]),s._v(" "),t("p",[s._v("‍")]),s._v(" "),t("h4",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://my.oschina.net/u/3341316/blog/877206",target:"_blank",rel:"noopener noreferrer"}},[s._v("负载均衡原理的解析"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://blog.githuber.cn/posts/73",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx泛域名解析, 实现多个二级域名 "),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/",target:"_blank",rel:"noopener noreferrer"}},[s._v("深入 NGINX: 我们如何设计性能和扩展"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Inside NGINX: How We Designed for Performance & Scale"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://tengine.taobao.org/book/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx开发从入门到精通"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://os.51cto.com/art/201703/535326.htm#topx",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx的优化与防盗链"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://segmentfault.com/a/1190000009769143",target:"_blank",rel:"noopener noreferrer"}},[s._v("实战开发一个Nginx扩展 (Nginx Module)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://my.oschina.net/xshuai/blog/917097",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx+Keepalived(双机热备)搭建高可用负载均衡环境(HA)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://www.huxd.org/articles/2017/07/24/1500890692329.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx 平滑升级"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&mid=2247483708&idx=1&sn=90b0b1dccd9c337922a0588245277666&chksm=97f38cf7a08405e1928e0b46d923d630e529e7db8ac7ca2a91310a075986f8bcb2cee5b4953d#rd",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx最新模块—ngx_http_mirror_module分析可以做版本发布前的预先验证, 进行流量放大后的压测等等"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("‍")])])}),[],!1,null,null,null);t.default=e.exports}}]);