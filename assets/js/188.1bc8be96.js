(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{499:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_411-è¿ç»´ç›‘æ§ç³»ç»Ÿå®æˆ˜-æå®¢æ—¶é—´-ğŸŒ¸"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_411-è¿ç»´ç›‘æ§ç³»ç»Ÿå®æˆ˜-æå®¢æ—¶é—´-ğŸŒ¸"}},[s._v("#")]),s._v(" 411.è¿ç»´ç›‘æ§ç³»ç»Ÿå®æˆ˜(æå®¢æ—¶é—´)ğŸŒ¸")]),s._v(" "),t("h2",{attrs:{id:"å¼€ç¯‡è¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼€ç¯‡è¯"}},[s._v("#")]),s._v(" å¼€ç¯‡è¯")]),s._v(" "),t("h3",{attrs:{id:"_0-æ¯ä¸ªå…³æ³¨é«˜å¯ç”¨çš„äºº-éƒ½åº”è¯¥äº†è§£ç›‘æ§çŸ¥è¯†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0-æ¯ä¸ªå…³æ³¨é«˜å¯ç”¨çš„äºº-éƒ½åº”è¯¥äº†è§£ç›‘æ§çŸ¥è¯†"}},[s._v("#")]),s._v(" 0.æ¯ä¸ªå…³æ³¨é«˜å¯ç”¨çš„äºº,éƒ½åº”è¯¥äº†è§£ç›‘æ§çŸ¥è¯†")]),s._v(" "),t("p",[s._v("ç°åœ¨ ** Prometheus ç”Ÿæ€éšç€ Kubernetes çš„æµè¡Œ, å·²æˆä¸ºäº‘åŸç”Ÿç›‘æ§äº‹å®ä¸Šçš„æ ‡å‡†**.")]),s._v(" "),t("p",[s._v("Categraf åˆ™æ˜¯ä¸€æ¬¾ç›‘æ§æ•°æ®é‡‡é›†å™¨, æ˜¯ç±»ä¼¼ Telegraf, Datadog-agent, Grafana-agent çš„ä¸€ä¸ª Agent, å¯ä»¥é‡‡é›† metrics, logs, traces, å°è¯•åšä¸€ä¸ªå¤§ä¸€ç»Ÿçš„é‡‡é›†è§£å†³æ–¹æ¡ˆ, åŒæ—¶å¸Œæœ›åœ¨é¡¹ç›®é‡Œæ²‰æ·€å‡ºå„ä¸ªç›‘æ§ç›®æ ‡çš„æœ€ä½³å®è·µ, åšåˆ°å¼€ç®±å³ç”¨.")]),s._v(" "),t("p",[s._v("çº¿ä¸Šç»å¸¸æœ‰å„ç§ç›‘æ§é—®é¢˜. æ¯”å¦‚:")]),s._v(" "),t("ul",[t("li",[s._v("æŒ‡æ ‡æœ‰å“ªäº›ç±»å‹, å“ªç±»æŒ‡æ ‡æ¯”è¾ƒå…³é”®?")]),s._v(" "),t("li",[s._v("å¦‚ä½•éƒ¨ç½²ä¸€å¥—é«˜å¯ç”¨çš„ç›‘æ§ç³»ç»Ÿ, å­˜å‚¨åº”è¯¥å¦‚ä½•é€‰å‹?")]),s._v(" "),t("li",[s._v("å¦‚ä½•ç›‘æ§ MySQL, Redis, Kafka, ElasticSearch?")]),s._v(" "),t("li",[s._v("å¦‚ä½•ç›‘æ§ Kubernetes è¿™ä¹ˆå¤æ‚çš„å¹³å°?")]),s._v(" "),t("li",[s._v("å¦‚ä½•åŸ‹ç‚¹, å¦‚ä½•åˆ†ææ—¥å¿—?")]),s._v(" "),t("li",[s._v("å¦‚ä½•åšåˆ°äº‹ä»¶é—­ç¯å’Œå‘Šè­¦è‡ªæ„ˆ?")]),s._v(" "),t("li",[s._v("...")])]),s._v(" "),t("p",[s._v("æé—®çš„è¿™äº›äººå½“ä¸­, å¤§éƒ¨åˆ†æ˜¯è¿ç»´å·¥ç¨‹å¸ˆ, ä¸šåŠ¡ç ”å‘, è¿˜æœ‰ç›‘æ§å’Œç¨³å®šæ€§ç³»ç»Ÿå»ºè®¾äººå‘˜, å¯¹ä»–ä»¬æ¥è¯´è¿ç»´ç›‘æ§ç›¸å…³çš„çŸ¥è¯†æ˜¯å·¥ä½œä¸­å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†. é‚£æ˜¯ä¸æ˜¯å…¶ä»–é¢†åŸŸçš„äººå°±æ²¡å¿…è¦äº†è§£ç›‘æ§ç›¸å…³çš„çŸ¥è¯†äº†å‘¢? ä¸æ˜¯çš„.")]),s._v(" "),t("h4",{attrs:{id:"å“ªäº›äººåº”è¯¥å­¦ä¹ ç›‘æ§ç›¸å…³çš„çŸ¥è¯†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å“ªäº›äººåº”è¯¥å­¦ä¹ ç›‘æ§ç›¸å…³çš„çŸ¥è¯†"}},[s._v("#")]),s._v(" å“ªäº›äººåº”è¯¥å­¦ä¹ ç›‘æ§ç›¸å…³çš„çŸ¥è¯†?")]),s._v(" "),t("p",[s._v("åº”è¯¥è¯´æ¯ä¸ªå…³æ³¨é«˜å¯ç”¨, å…³æ³¨æœåŠ¡ç¨³å®šæ€§çš„æŠ€æœ¯äººå‘˜éƒ½åº”è¯¥å­¦ä¹ ç›‘æ§ç›¸å…³çš„çŸ¥è¯†. åœ¨ç¨³å®šæ€§ä¿éšœä½“ç³»ä¸­, æ ¸å¿ƒå°±æ˜¯åœ¨å¹²ä¸€ä»¶äº‹, å‡å°‘æ•…éšœ. å¯ä»¥çœ‹ä¸€ä¸‹æ•…éšœçš„ç”Ÿå‘½å‘¨æœŸ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5a01b06a48274f14eb39e0e483ee98e2-20230719203435-gyb1raf.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å‡å°‘æ•…éšœæœ‰ä¸¤ä¸ªå±‚é¢çš„æ„æ€, ä¸€ä¸ªæ˜¯åšå¥½å¸¸æ€é¢„é˜², ä¸è®©æ•…éšœå‘ç”Ÿ; å¦ä¸€ä¸ªæ˜¯å¦‚æœæ•…éšœå‘ç”Ÿ, è¦èƒ½å°½å¿«æ­¢æŸ, å‡å°‘æ•…éšœæ—¶é•¿. è€Œç›‘æ§çš„å…¸å‹ä½œç”¨, å°±æ˜¯å¸®åŠ©æˆ‘ä»¬"),t("strong",[s._v("å‘ç°åŠå®šä½æ•…éšœ")]),s._v(", è¿™ä¸¤ä¸ªç¯èŠ‚å¯¹äºå‡å°‘æ•…éšœæ—¶é•¿è‡³å…³é‡è¦.")]),s._v(" "),t("p",[s._v('è¿ç»´äººå‘˜å’Œç ”å‘äººå‘˜æ˜¯å…¸å‹çš„å…³æ³¨ç¨³å®šæ€§çš„äºº, ä¸è¿‡ä¾§é‡ç‚¹ä¸åŒ. ä¸€èˆ¬æ¥è¯´, è¿ç»´äººå‘˜è´Ÿè´£å…¨å…¬å¸æ‰€æœ‰ä¸šåŠ¡çš„è¿ç»´å·¥ä½œ, ç ”å‘äººå‘˜åªè´Ÿè´£è‡ªå·±ä¸šåŠ¡çº¿çš„ç ”å‘å·¥ä½œ, æ‰€ä»¥å‘ç”Ÿæ•…éšœçš„æ—¶å€™, è¿ç»´äººå‘˜æ›´å¸Œæœ›å¿«é€Ÿæ‰¾åˆ°é—®é¢˜æ ¹å› , åŠæ—¶æ­¢æŸ. è€Œç ”å‘äººå‘˜, æ›´å¸Œæœ›èƒ½ "è‡ªè¯æ¸…ç™½". ä¸ç®¡å‡ºäºä½•ç§ç›®çš„, ç›‘æ§éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„å·¥å…·.')]),s._v(" "),t("p",[s._v("å½“ç„¶ç›‘æ§çš„ä½œç”¨è¿˜æœ‰å¾ˆå¤š, æ¯”å¦‚ç”¨äºæ—¥å¸¸å·¡æ£€, ä½œä¸ºæ€§èƒ½è°ƒä¼˜çš„æ•°æ®ä½è¯, æå‰å‘ç°ä¸€äº›è®¾å¤‡, ä¸­é—´ä»¶ä¸åˆç†çš„é…ç½®. ä¹‹æ‰€ä»¥èƒ½åšåˆ°è¿™äº›, æ˜¯å› ä¸ºæ‰€æœ‰ä¼˜ç§€çš„è½¯ä»¶, éƒ½å†…ç½®äº†ç›‘æ§æ•°æ®çš„æš´éœ²æ–¹æ³•, è®©ç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œè§‚æµ‹, äº†è§£å…¶å¥åº·çŠ¶å†µ. **å¯è¢«ç›‘æ§å’Œè§‚æµ‹, ä¹Ÿæ˜¯å¼€å‘è½¯ä»¶æ—¶å¿…é¡»è€ƒè™‘çš„ä¸€ç¯. **")]),s._v(" "),t("h4",{attrs:{id:"ç›‘æ§æ˜¯åšå¥½è½¯ä»¶æ¶æ„çš„é‡è¦ä¸€ç¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§æ˜¯åšå¥½è½¯ä»¶æ¶æ„çš„é‡è¦ä¸€ç¯"}},[s._v("#")]),s._v(" ç›‘æ§æ˜¯åšå¥½è½¯ä»¶æ¶æ„çš„é‡è¦ä¸€ç¯")]),s._v(" "),t("p",[s._v("å¥½çš„è½¯ä»¶æ¶æ„, ä¸€å®šæ˜¯è€ƒè™‘äº†é«˜å¯ç”¨çš„, ä¸€å®šæ˜¯è€ƒè™‘äº†å„ç±»æ•…éšœçš„å‘ç°å’Œåº”å¯¹æ‰‹æ®µçš„. ä¸€ååˆæ ¼çš„æ¶æ„å¸ˆ, ç†åº”å¯¹å„ç§ç›‘æ§æ‰‹æ®µéƒ½ç†Ÿç¨”äºå¿ƒ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e6273f4cc906de0a1e9f3c62951b2e41-20230719203435-tca9q4t.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("æ¯”å¦‚å„ç±»å¼€æºç»„ä»¶, æœ‰çš„æ˜¯ç›´æ¥æš´éœ²äº† Prometheus metrics æ¥å£, æœ‰çš„æ˜¯æš´éœ²äº† HTTP JSON æ¥å£, æœ‰çš„æ˜¯é€šè¿‡ JMX æš´éœ²ç›‘æ§æ•°æ®, æœ‰çš„åˆ™éœ€è¦è¿ä¸Šå»æ‰§è¡Œå‘½ä»¤, è™½ç„¶å¤§å®¶çš„æŒ‡æ ‡æš´éœ²æ–¹å¼ä¸ä¸€æ ·, ä½†æ²¡æœ‰å“ªä¸ªæ˜¯ç¼ºå°‘ç›‘æ§èƒ½åŠ›çš„.")])]),s._v(" "),t("p",[t("strong",[s._v("ä¸šåŠ¡ç¨‹åºä¹Ÿæœ‰å¤šç§æš´éœ²æ–¹å¼")]),s._v(", æ¯”è¾ƒçŸ¥åçš„åŸ‹ç‚¹å·¥å…·æ˜¯ StatsD, "),t("strong",[s._v("Prometheus")]),s._v(". å½“ç„¶æœ‰äº›è¯­è¨€ä¼šæœ‰é€‚åˆè‡ªå·±çš„æ›´æ˜“ç”¨çš„åŸ‹ç‚¹å·¥å…·, æ¯”å¦‚ Java ç”Ÿæ€çš„ Micrometer. ä¸šåŠ¡ç¨‹åºé™¤äº†æŒ‡æ ‡åŸ‹ç‚¹ç›‘æ§, é€šå¸¸è¿˜æœ‰æ›´ä¸°å¯Œçš„è§‚æµ‹æ‰‹æ®µ, æ¯”å¦‚å¼•å…¥é“¾è·¯è¿½è¸ªçš„æ¡†æ¶: Zipkin, Jaeger, "),t("strong",[s._v("Skywalking")]),s._v(" ç­‰. å½“ç„¶æ‰€æœ‰è½¯ä»¶éƒ½å¯ä»¥ä½¿ç”¨æ—¥å¿—çš„æ–¹å¼æ¥æš´éœ²å¥åº·çŠ¶å†µ, ä¸è¿‡è¿™ç§æ–¹å¼æœ€æ˜‚è´µ, æ•°æ®éç»“æ„åŒ–, é€‚åˆæ’æŸ¥é—®é¢˜, ä½†ä¸é€‚åˆä½œä¸ºæŒ‡æ ‡æ•°æ®çš„æ¥æº.")]),s._v(" "),t("p",[t("strong",[s._v("æƒ³è¦åœ¨æŠ€æœ¯è¿™æ¡è·¯ä¸Šèµ°å¾—æ›´è¿œ, ç›‘æ§ç›¸å…³çš„çŸ¥è¯†å¿…ä¸å¯å°‘")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"è¿™é—¨è¯¾çš„ç»“æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿™é—¨è¯¾çš„ç»“æ„"}},[s._v("#")]),s._v(" è¿™é—¨è¯¾çš„ç»“æ„")]),s._v(" "),t("p",[s._v("æœ¬è¯¾ç¨‹åˆ†æˆäº† 4 ä¸ªéƒ¨åˆ†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4976be7b4ce5737515539f4a3824yycb-20230719203435-ddsglqb.jpg",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("ç¬¬ä¸€éƒ¨åˆ†: åŸºç¡€çŸ¥è¯†")])]),s._v(" "),t("p",[s._v("å­¦ä¹ ç›‘æ§çŸ¥è¯†, å¾—å…ˆäº†è§£ä¸ºä»€ä¹ˆ, ä¹Ÿå°±æ˜¯ç›‘æ§æ˜¯å› ä½•äº§ç”Ÿçš„, è§£å†³äº†ä»€ä¹ˆé—®é¢˜, æœ‰å“ªäº›å…¸å‹çš„æ–¹æ¡ˆ, åˆ†åˆ«æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹. æœ€åä¼šç»™æ€»ç»“é€šç”¨çš„ç›‘æ§ç³»ç»Ÿæ¶æ„, æå‰æ‰“å¥½é“ºå«, ä¸ºåé¢çš„å­¦ä¹ å¥ å®šç†è®ºåŸºç¡€.")]),s._v(" "),t("blockquote",[t("p",[s._v("ç¬¬äºŒéƒ¨åˆ†: æ­å»ºå¹¶ä¼˜åŒ– Prometheus")])]),s._v(" "),t("p",[s._v("äº†è§£äº†åŸºç¡€çŸ¥è¯†ä¹‹å, å°±éœ€è¦åŠ¨æ‰‹å®è·µ. ç¬¬äºŒéƒ¨åˆ†ä¼šæ­å»º Prometheus è¿™ä¸ªç›‘æ§ç³»ç»Ÿ, å¯¹ç›‘æ§ç³»ç»Ÿæœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†. ä¸ºä»€ä¹ˆé€‰æ‹© Prometheus è€Œä¸æ˜¯å…¶ä»–ç›‘æ§ç³»ç»Ÿ, æœ€æ ¸å¿ƒçš„åŸå› æ˜¯ Prometheus åœ¨å½“ä¸‹äº‘åŸç”Ÿçš„ç¯å¢ƒä¸‹çœŸçš„å¤ªæµè¡Œäº†, å…¶æ¬¡æ˜¯ Prometheus æ­å»ºç®€å•, ä½¿ç”¨çµæ´», ä½“ç°äº†å¾ˆå¤šè®¾è®¡å“²å­¦, æœ‰åŠ©äºç†è§£ç›‘æ§ç³»ç»Ÿçš„ç›¸å…³è®¾è®¡.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªéƒ¨åˆ†è¿˜ä¼šå‰–æ Prometheus çš„ä¸€äº›å…³é”®è®¾è®¡, å°±æ˜¯è¿™äº›å…³é”®è®¾è®¡å¥ å®šäº†å®ƒçš„æ±Ÿæ¹–åœ°ä½. ä½†æ˜¯ Prometheus ä¹Ÿä¸æ˜¯å°½å–„å°½ç¾çš„, çœŸæ­£åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨, è¿˜éœ€è¦è§£å†³å­˜å‚¨æ‰©å±•é—®é¢˜, è§„åˆ™ç®¡ç†çš„ååŒé—®é¢˜, å¯¹æ­¤ç¤¾åŒºæœ‰ä¸€äº›è§£å†³æ–¹æ¡ˆ, ä¼šä¸€èµ·æ¯”è¾ƒé€‰å‹.")]),s._v(" "),t("blockquote",[t("p",[s._v("ç¬¬ä¸‰éƒ¨åˆ†: ç›‘æ§å®æˆ˜, æå®šå¸¸è§çš„ç›‘æ§éœ€æ±‚")])]),s._v(" "),t("p",[s._v("æ“ä½œç³»ç»Ÿ, ç½‘ç»œè®¾å¤‡, MySQL, Redis, Kafka, ElasticSearch, Kubernetes, åº”ç”¨, æ—¥å¿—ç­‰ç­‰, æ‰€æœ‰å¸¸è§ç›‘æ§çš„éœ€æ±‚ç»Ÿç»Ÿæå®š, è¿™éƒ¨åˆ†ä¼šè®²è§£å„ä¸ªç›‘æ§ç›®æ ‡æ˜¯å¦‚ä½•é‡‡é›†ç›‘æ§æ•°æ®çš„, å“ªäº›æŒ‡æ ‡æœ€å…³é”®. ä¸­é—´ç©¿æ’ä¸€äº›é—®é¢˜æ’æŸ¥æ‰‹æ®µ, å¹¶æä¾›é…ç½®å¥½çš„ä»ªè¡¨ç›˜, åœ¨å¼€ç®±å³ç”¨çš„åŒæ—¶, çŸ¥å…¶ç„¶å¹¶çŸ¥å…¶æ‰€ä»¥ç„¶.")]),s._v(" "),t("blockquote",[t("p",[s._v("ç¬¬å››éƒ¨åˆ†: å‘Šè­¦å®æˆ˜, è®¾è®¡è‰¯å¥½çš„å‘Šè­¦ç³»ç»Ÿåº”è¯¥å…·å¤‡å“ªäº›èƒ½åŠ›")])]),s._v(" "),t("p",[s._v("ç›‘æ§æ•°æ®é‡‡é›†ä¸Šæ¥ä¹‹å, ä¸‹ä¸€æ­¥å°±æ˜¯è¦ç”„åˆ«å¼‚å¸¸æ•°æ®å¹¶å‘å‡ºå‘Šè­¦äº†. è¿™ä¸ªéƒ¨åˆ†åŒ…æ‹¬"),t("strong",[s._v("å‘Šè­¦è§„åˆ™, å±è”½è§„åˆ™, æŠ‘åˆ¶è§„åˆ™, è®¢é˜…è§„åˆ™çš„ç®¡ç†, è¿˜æœ‰å‘Šè­¦äº‹ä»¶çš„ç®¡ç†ä»¥åŠå‘Šè­¦äº‹ä»¶è§¦å‘åçš„è‡ªæ„ˆé€»è¾‘")]),s._v(". ä¸€èˆ¬ç›‘æ§ç³»ç»Ÿéƒ½æ”¯æŒé…ç½®å‘Šè­¦è§„åˆ™, å¯ä»¥äº§ç”Ÿå‘Šè­¦äº‹ä»¶, ä½†æ˜¯é’ˆå¯¹å‘Šè­¦äº‹ä»¶åç»­çš„æ”¯æŒåå¼±, æ²¡æœ‰å¾ˆå¥½çš„èšåˆæ”¶æ•›, äº‹ä»¶é—­ç¯çš„èƒ½åŠ›.")]),s._v(" "),t("h2",{attrs:{id:"ç›‘æ§æ¦‚è¿°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§æ¦‚è¿°"}},[s._v("#")]),s._v(" ç›‘æ§æ¦‚è¿°")]),s._v(" "),t("h3",{attrs:{id:"_1-èƒŒæ™¯ä¿¡æ¯-ç›‘æ§éœ€æ±‚ä»¥åŠå¼€æºæ–¹æ¡ˆçš„æ¨ªè¯„å¯¹æ¯”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-èƒŒæ™¯ä¿¡æ¯-ç›‘æ§éœ€æ±‚ä»¥åŠå¼€æºæ–¹æ¡ˆçš„æ¨ªè¯„å¯¹æ¯”"}},[s._v("#")]),s._v(" 1.èƒŒæ™¯ä¿¡æ¯-ç›‘æ§éœ€æ±‚ä»¥åŠå¼€æºæ–¹æ¡ˆçš„æ¨ªè¯„å¯¹æ¯”")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚å…ˆäº†è§£ä¸€ä¸‹ç›‘æ§ç›¸å…³çš„èƒŒæ™¯ä¿¡æ¯, å¯¹ç›‘æ§ç³»ç»Ÿæœ‰ä¸€ä¸ªæ•´ä½“æ€§çš„äº†è§£. æ‰€ä»¥è¿™é‡Œä¼šå…ˆèŠä¸€èŠç›‘æ§çš„éœ€æ±‚æ¥æº, ä¹Ÿå°±æ˜¯è¯´ç›‘æ§ç³»ç»Ÿéƒ½å¯ä»¥ç”¨æ¥åšä»€ä¹ˆ, ç„¶åå†è·³å‡ºç›‘æ§, ä»å¯è§‚æµ‹æ€§æ¥çœ‹, ç›‘æ§ä¸æ—¥å¿—, é“¾è·¯ä¹‹é—´çš„å…³ç³»ä»¥åŠå®ƒä»¬å„è‡ªçš„ä½œç”¨. æœ€åä¼šä»‹ç»å¼€æºç¤¾åŒºå‡ ä¸ªæœ‰ä»£è¡¨æ€§çš„æ–¹æ¡ˆä»¥åŠå®ƒä»¬å„è‡ªçš„ä¼˜ç¼ºç‚¹, ä¾¿äºåšæŠ€æœ¯é€‰å‹.")]),s._v(" "),t("h4",{attrs:{id:"ç›‘æ§éœ€æ±‚æ¥æº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§éœ€æ±‚æ¥æº"}},[s._v("#")]),s._v(" ç›‘æ§éœ€æ±‚æ¥æº")]),s._v(" "),t("p",[s._v("ç›‘æ§æœ€åˆå§‹çš„éœ€æ±‚, å…¶å®å°±æ˜¯ä¸€å¥è¯: "),t("strong",[s._v("ç³»ç»Ÿå‡ºé—®é¢˜äº†èƒ½åŠæ—¶æ„ŸçŸ¥åˆ°")]),s._v(". éšç€æ—¶ä»£çš„å‘å±•, å¤§å®¶å¯¹ç›‘æ§ç³»ç»Ÿæå‡ºäº†æ›´å¤šçš„è¯‰æ±‚, æ¯”å¦‚:")]),s._v(" "),t("ul",[t("li",[s._v("é€šè¿‡ç›‘æ§äº†è§£æ•°æ®è¶‹åŠ¿, çŸ¥é“ç³»ç»Ÿåœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»å¯èƒ½å‡ºé—®é¢˜, é¢„çŸ¥é—®é¢˜.")]),s._v(" "),t("li",[s._v("é€šè¿‡ç›‘æ§äº†è§£ç³»ç»Ÿçš„æ°´ä½æƒ…å†µ, ä¸ºæœåŠ¡æ‰©ç¼©å®¹æä¾›æ•°æ®æ”¯æ’‘.")]),s._v(" "),t("li",[s._v("é€šè¿‡ç›‘æ§æ¥ç»™ç³»ç»ŸæŠŠè„‰, æ„ŸçŸ¥åˆ°å“ªé‡Œéœ€è¦ä¼˜åŒ–, æ¯”å¦‚ä¸€äº›ä¸­é—´ä»¶å‚æ•°çš„è°ƒä¼˜.")]),s._v(" "),t("li",[s._v("é€šè¿‡ç›‘æ§æ¥æ´å¯Ÿä¸šåŠ¡, æä¾›ä¸šåŠ¡å†³ç­–çš„æ•°æ®ä¾æ®, åŠæ—¶æ„ŸçŸ¥ä¸šåŠ¡å¼‚å¸¸.")])]),s._v(" "),t("p",[s._v("ç›®å‰ç›‘æ§ç³»ç»Ÿè¶Šæ¥è¶Šé‡è¦, åŒæ—¶ä¹Ÿè¶Šæ¥è¶Šå®Œå¤‡. ä¸ä½†èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³ä¸Šé¢è¿™å‡ ç‚¹è¯‰æ±‚, è¿˜æ²‰æ·€å‡ºäº†å¾ˆå¤šç›‘æ§ç³»ç»Ÿä¸­çš„ç¨³å®šæ€§ç›¸å…³çš„çŸ¥è¯†.")]),s._v(" "),t("h4",{attrs:{id:"å¯è§‚æµ‹æ€§ä¸‰å¤§æ”¯æŸ±"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯è§‚æµ‹æ€§ä¸‰å¤§æ”¯æŸ±"}},[s._v("#")]),s._v(" å¯è§‚æµ‹æ€§ä¸‰å¤§æ”¯æŸ±")]),s._v(" "),t("h5",{attrs:{id:"_1-æŒ‡æ ‡ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æŒ‡æ ‡ç›‘æ§"}},[s._v("#")]),s._v(" 1.æŒ‡æ ‡ç›‘æ§")]),s._v(" "),t("p",[s._v("ç›‘æ§ç³»ç»Ÿä¸€èˆ¬åªæ˜¯"),t("strong",[s._v("æŒ‡æ ‡ç›‘æ§")]),s._v(", é€šå¸¸ä½¿ç”¨æŠ˜çº¿å›¾å½¢æ€å‘ˆç°åœ¨å›¾è¡¨ä¸Š, æ¯”å¦‚æŸä¸ªæœºå™¨çš„ CPU åˆ©ç”¨ç‡, æŸä¸ªæ•°æ®åº“å®ä¾‹çš„æµé‡æˆ–è€…ç½‘ç«™çš„åœ¨çº¿äººæ•°, éƒ½å¯ä»¥ä½“ç°ä¸ºéšç€æ—¶é—´è€Œå˜åŒ–çš„è¶‹åŠ¿å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://nano-note.oss-cn-beijing.aliyuncs.com/images/44623a474780c33b25b04398a5a4cc3f.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("æŒ‡æ ‡ç›‘æ§")])]),s._v(" åªèƒ½å¤„ç†æ•°å­—, ä½†å®ƒçš„"),t("strong",[s._v("å†å²æ•°æ®å­˜å‚¨æˆæœ¬è¾ƒä½, å®æ—¶æ€§å¥½, ç”Ÿæ€åºå¤§")]),s._v(", æ˜¯å¯è§‚æµ‹æ€§é¢†åŸŸé‡Œæœ€é‡è¦çš„ä¸€æ ¹æ”¯æŸ±. èšç„¦åœ¨"),t("strong",[s._v("æŒ‡æ ‡ç›‘æ§")]),s._v("é¢†åŸŸçš„å¼€æºäº§å“æœ‰ Zabbix, Open-Falcon, "),t("strong",[s._v("Prometheus")]),s._v(", Nightingale ç­‰.")]),s._v(" "),t("p",[s._v("ç”±äºæŒ‡æ ‡ç›‘æ§å› å†å²æ•°æ®å­˜å‚¨æˆæœ¬è¾ƒä½, å®æ—¶æ€§å¥½, ç”Ÿæ€åºå¤§, æ˜¯å¯è§‚æµ‹æ€§é¢†åŸŸé‡Œæœ€é‡è¦çš„ä¸€æ ¹æ”¯æŸ±, ä¹Ÿæ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹.")]),s._v(" "),t("h5",{attrs:{id:"_2-æ—¥å¿—"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ—¥å¿—"}},[s._v("#")]),s._v(" 2.æ—¥å¿—")]),s._v(" "),t("p",[s._v("é™¤äº†æŒ‡æ ‡ç›‘æ§, å¦ä¸€ä¸ªé‡è¦çš„å¯è§‚æµ‹æ€§æ”¯æŸ±æ˜¯ "),t("mark",[t("strong",[s._v("æ—¥å¿—")])]),s._v(". ä»æ—¥å¿—ä¸­å¯ä»¥å¾—åˆ°å¾ˆå¤šä¿¡æ¯, å¯¹äºäº†è§£è½¯ä»¶çš„è¿è¡Œæƒ…å†µ, ä¸šåŠ¡çš„è¿è¥æƒ…å†µéƒ½å¾ˆå…³é”®. æ¯”å¦‚æ“ä½œç³»ç»Ÿçš„æ—¥å¿—, æ¥å…¥å±‚çš„æ—¥å¿—, æœåŠ¡è¿è¡Œæ—¥å¿—, éƒ½æ˜¯é‡è¦çš„æ•°æ®æº.")]),s._v(" "),t("p",[s._v("ä»æ“ä½œç³»ç»Ÿçš„æ—¥å¿—ä¸­, å¯ä»¥å¾—çŸ¥å¾ˆå¤šç³»ç»Ÿçº§äº‹ä»¶çš„å‘ç”Ÿ; ä»æ¥å…¥å±‚çš„æ—¥å¿—ä¸­, å¯ä»¥å¾—çŸ¥æœ‰å“ªäº›åŸŸå, IP, URL æ”¶åˆ°äº†è®¿é—®, æ˜¯å¦æˆåŠŸä»¥åŠå»¶è¿Ÿæƒ…å†µç­‰; ä»æœåŠ¡æ—¥å¿—ä¸­å¯ä»¥æŸ¥åˆ° Exception çš„ä¿¡æ¯, è°ƒç”¨å †æ ˆç­‰, å¯¹äºæ’æŸ¥é—®é¢˜æ¥è¯´éå¸¸å…³é”®. ä½†æ˜¯"),t("strong",[s._v("æ—¥å¿—æ•°æ®é€šå¸¸é‡æ¯”è¾ƒå¤§, ä¸å¤Ÿç»“æ„åŒ–, å­˜å‚¨æˆæœ¬è¾ƒé«˜")]),s._v(".")]),s._v(" "),t("p",[s._v("å¤„ç†æ—¥å¿—è¿™ä¸ªåœºæ™¯, ä¹Ÿæœ‰å¾ˆå¤šä¸“é—¨çš„ç³»ç»Ÿ, æ¯”å¦‚å¼€æºäº§å“ ELK å’Œ Loki, å•†ä¸šäº§å“ Splunk å’Œ Datadog, ä¸‹é¢æ˜¯åœ¨ Kibana ä¸­æŸ¥è¯¢æ—¥å¿—çš„ä¸€ä¸ªé¡µé¢.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1ff853edd518a6f1bf5f2a038ff9a99c-20230719203435-zqqxcdi.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("h5",{attrs:{id:"_3-é“¾è·¯è¿½è¸ª"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-é“¾è·¯è¿½è¸ª"}},[s._v("#")]),s._v(" 3.é“¾è·¯è¿½è¸ª")]),s._v(" "),t("p",[s._v("å¯è§‚æµ‹æ€§æœ€åä¸€å¤§æ”¯æŸ±æ˜¯ "),t("mark",[t("strong",[s._v("é“¾è·¯è¿½è¸ª")])]),s._v(". éšç€å¾®æœåŠ¡çš„æ™®åŠ, åŸæœ¬çš„å•ä½“åº”ç”¨è¢«æ‹†åˆ†æˆå¾ˆå¤šä¸ªå°çš„æœåŠ¡, æœåŠ¡ä¹‹é—´æœ‰é”™ç»¼å¤æ‚çš„è°ƒç”¨å…³ç³», ä¸€ä¸ªé—®é¢˜å…·ä½“æ˜¯å“ªä¸ªæ¨¡å—å¯¼è‡´çš„, æ’æŸ¥èµ·æ¥å…¶å®éå¸¸å›°éš¾.")]),s._v(" "),t("p",[t("strong",[s._v("é“¾è·¯è¿½è¸ªçš„æ€è·¯æ˜¯ä»¥è¯·æ±‚ä¸²è”ä¸Šä¸‹æ¸¸æ¨¡å—, ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ä½œä¸ºè¯·æ±‚ ID. æœåŠ¡ä¹‹é—´äº’ç›¸è°ƒç”¨çš„æ—¶å€™, æŠŠè¿™ä¸ª ID é€å±‚å¾€ä¸‹ä¼ é€’, æ¯å±‚åˆ†åˆ«è€—è´¹äº†å¤šé•¿æ—¶é—´, æ˜¯å¦æ­£å¸¸å¤„ç†, éƒ½å¯ä»¥æ”¶é›†èµ·æ¥é™„åˆ°è¿™ä¸ªè¯·æ±‚ ID ä¸Š. åé¢è¿½æŸ¥é—®é¢˜æ—¶, æ‹¿ç€è¯·æ±‚ ID å°±å¯ä»¥æŠŠä¸²è”çš„æ‰€æœ‰ä¿¡æ¯æå–å‡ºæ¥")]),s._v(". é“¾è·¯è¿½è¸ªè¿™ä¸ªé¢†åŸŸä¹Ÿæœ‰å¾ˆå¤šäº§å“, æ¯”å¦‚ "),t("strong",[s._v("Skywalking")]),s._v(", Jaeger, Zipkin ç­‰. ä¸‹é¢æ˜¯ Zipkin çš„ä¸€ä¸ªé¡µé¢.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/019923edea67c1363ba080dc129a3594-20230719203435-zarxgto.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("è™½ç„¶æŠŠ"),t("strong",[s._v("å¯è§‚æµ‹æ€§é¢†åŸŸåˆ’åˆ†æˆäº† 3 å¤§æ”¯æŸ±")]),s._v(", ä½†å®é™…ä¸Šå®ƒä»¬ä¹‹é—´æ˜¯æœ‰å¾ˆå¼ºçš„å…³è”å…³ç³»çš„. æ¯”å¦‚ç»å¸¸ä¼šä»æ—¥å¿—ä¸­æå–æŒ‡æ ‡, è½¬å­˜åˆ°æŒ‡æ ‡ç›‘æ§ç³»ç»Ÿ, æˆ–è€…ä»æ—¥å¿—ä¸­æå–é“¾è·¯ä¿¡æ¯æ¥åšåˆ†æ, è¿™åœ¨ä¸šç•Œéƒ½æœ‰å¾ˆå¤šå®è·µ.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ¥ä¸€èµ·æ¢³ç†ä¸€ä¸‹ä¸šç•Œå¸¸è§çš„å¼€æºè§£å†³æ–¹æ¡ˆ.")]),s._v(" "),t("h4",{attrs:{id:"ä¸šç•Œæ–¹æ¡ˆæ¨ªè¯„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸šç•Œæ–¹æ¡ˆæ¨ªè¯„"}},[s._v("#")]),s._v(" ä¸šç•Œæ–¹æ¡ˆæ¨ªè¯„")]),s._v(" "),t("p",[s._v("äº†è§£ä¸šç•Œå…¸å‹æ–¹æ¡ˆçš„ä¸€äº›ä¼˜ç¼ºç‚¹, å¯¹é€‰å‹æœ‰å¾ˆå¤§å¸®åŠ©. è¿™é‡Œä¸»è¦æ˜¯è¯„ä»·å¼€æºæ–¹æ¡ˆ, å•†ä¸šäº§å“æ¥è§¦çš„äººç›¸å¯¹è¾ƒå°‘, è¿™é‡Œå°±ä¸ç‚¹è¯„äº†.")]),s._v(" "),t("h5",{attrs:{id:"_1-è€ä¸€ä»£æ•´ä½“æ–¹æ¡ˆçš„ä»£è¡¨zabbix"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-è€ä¸€ä»£æ•´ä½“æ–¹æ¡ˆçš„ä»£è¡¨zabbix"}},[s._v("#")]),s._v(" 1.è€ä¸€ä»£æ•´ä½“æ–¹æ¡ˆçš„ä»£è¡¨Zabbix")]),s._v(" "),t("p",[s._v("Zabbix æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆ, æ“…é•¿è®¾å¤‡, ç½‘ç»œ, ä¸­é—´ä»¶çš„ç›‘æ§. å› ä¸ºå‰å‡ å¹´ä½¿ç”¨çš„ç›‘æ§ç³»ç»Ÿä¸»è¦å°±æ˜¯ç”¨æ¥ç›‘æ§è®¾å¤‡å’Œä¸­é—´ä»¶çš„, æ‰€ä»¥ Zabbix åœ¨å›½å†…åº”ç”¨éå¸¸å¹¿æ³›.")]),s._v(" "),t("p",[s._v("Zabbix æ ¸å¿ƒç”±ä¸¤éƒ¨åˆ†æ„æˆ, Zabbix Server ä¸å¯é€‰ç»„ä»¶ Zabbix Agent. Zabbix Server å¯ä»¥é€šè¿‡ SNMP, Zabbix Agent, JMX, IPMI ç­‰å¤šç§æ–¹å¼é‡‡é›†æ•°æ®. Zabbix è¿˜æœ‰ä¸€äº›é…å¥—ç»„ä»¶, Zabbix Proxy, Zabbix Java Gateway, Zabbix Get, Zabbix WEB ç­‰, å…±åŒç»„æˆäº† Zabbix æ•´ä½“æ¶æ„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/078c1b5f6d0d0382d742fb4049feff6d-20230719203435-n8frk7p.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("Zabbixçš„ä¼˜ç‚¹")])]),s._v(" "),t("ul",[t("li",[s._v("å¯¹å„ç§è®¾å¤‡çš„å…¼å®¹æ€§è¾ƒå¥½, Agentd å¯ä»¥åœ¨ Windows, Linuxä¸Šè¿è¡Œ.")]),s._v(" "),t("li",[s._v("æ¶æ„ç®€å•, ä½¿ç”¨æ•°æ®åº“åšæ—¶åºæ•°æ®å­˜å‚¨, æ˜“äºç»´æŠ¤, å¤‡ä»½å’Œè½¬å‚¨éƒ½æ¯”è¾ƒå®¹æ˜“.")]),s._v(" "),t("li",[s._v("ç¤¾åŒºåºå¤§, èµ„æ–™å¤š.")])]),s._v(" "),t("p",[t("strong",[s._v("Zabbixçš„ç¼ºç‚¹")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ä½¿ç”¨æ•°æ®åº“åšå­˜å‚¨")]),s._v(", æ— æ³•æ°´å¹³æ‰©å±•, å®¹é‡æœ‰é™. å¦‚æœé‡‡é›†é¢‘ç‡è¾ƒé«˜, æ¯”å¦‚ 10 ç§’é‡‡é›†ä¸€æ¬¡, ä¸Šé™å¤§çº¦å¯ä»¥ç›‘æ§ 600 å°è®¾å¤‡, è¿˜éœ€è¦æŠŠæ•°æ®åº“éƒ¨ç½²åœ¨ä¸€ä¸ªå¾ˆé«˜é…çš„æœºå™¨ä¸Š, æ¯”å¦‚ SSD æˆ–è€… NVMe çš„ç›˜æ‰å¯ä»¥.")]),s._v(" "),t("li",[s._v("Zabbix é¢å‘èµ„äº§çš„ç®¡ç†é€»è¾‘, ç›‘æ§æŒ‡æ ‡çš„æ•°æ®ç»“æ„è¾ƒä¸ºå›ºåŒ–, æ²¡æœ‰çµæ´»çš„æ ‡ç­¾è®¾è®¡, "),t("strong",[s._v("é¢å¯¹äº‘åŸç”Ÿæ¶æ„ä¸‹åŠ¨æ€å¤šå˜çš„ç¯å¢ƒ, æ˜¾å¾—åŠ›ä¸ä»å¿ƒ")]),s._v(".")])]),s._v(" "),t("h5",{attrs:{id:"_2-è€ä¸€ä»£å›½äº§ä»£è¡¨open-falcon"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-è€ä¸€ä»£å›½äº§ä»£è¡¨open-falcon"}},[s._v("#")]),s._v(" 2.è€ä¸€ä»£å›½äº§ä»£è¡¨Open-Falcon")]),s._v(" "),t("p",[s._v("Open-Falcon å‡ºç°åœ¨ Zabbix ä¹‹å, å¼€å‘çš„åˆè¡·å°±æ˜¯æƒ³è¦è§£å†³ Zabbix çš„å®¹é‡é—®é¢˜. Open-Falcon æœ€åˆæ¥è‡ªå°ç±³, Open-Falconçš„åˆè¡·æ˜¯æƒ³åšä¸€å¥—å¤§ä¸€ç»Ÿçš„æ–¹æ¡ˆ, æ¥è§£å†³è¿™ä¸ªä¹±å±€. å¯ä»¥çœ‹ä¸€ä¸‹Open-Falconçš„æ¶æ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/faf28d6c6409936a0300a36d914f4f84-20230719203435-23329d2.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("Open-Falcon åŸºäº RRDtool åšäº†ä¸€ä¸ªåˆ†å¸ƒå¼æ—¶åºå­˜å‚¨ç»„ä»¶ Graph. è¿™ç§åšæ³•å¯ä»¥æŠŠå¤šå°æœºå™¨ç»„æˆä¸€ä¸ªé›†ç¾¤, å¤§å¹…æå‡æµ·é‡æ•°æ®çš„å¤„ç†èƒ½åŠ›. å‰é¢è´Ÿè´£è½¬å‘çš„ç»„ä»¶æ˜¯ Transfer, Transfer å¯¹ç›‘æ§æ•°æ®æ±‚å–ä¸€ä¸ªå”¯ä¸€ ID, å†å¯¹ ID åšå“ˆå¸Œ, å°±å¯ä»¥ç”Ÿæˆç›‘æ§æ•°æ®å’Œ Graph å®ä¾‹çš„å¯¹åº”å…³ç³», è¿™å°±æ˜¯ Open-Falcon æ¶æ„ä¸­æœ€æ ¸å¿ƒçš„åˆ†ç‰‡é€»è¾‘.")]),s._v(" "),t("p",[s._v("ç»“åˆç»™å‡ºçš„æ¶æ„å›¾æ¥çœ‹, å‘Šè­¦éƒ¨åˆ†æ˜¯ä½¿ç”¨ Judge æ¨¡å—æ¥åšçš„, å‘é€å‘Šè­¦äº‹ä»¶çš„æ˜¯ Alarm æ¨¡å—, é‡‡é›†æ•°æ®çš„æ˜¯ Agent, è´Ÿè´£å¿ƒè·³çš„æ¨¡å—æ˜¯ HBS, è´Ÿè´£èšåˆç›‘æ§æ•°æ®çš„æ¨¡å—æ˜¯ Aggregator, è´Ÿè´£å¤„ç†æ•°æ®ç¼ºå¤±çš„æ¨¡å—æ˜¯ Nodata. å½“ç„¶è¿˜æœ‰ç”¨äºå’Œç”¨æˆ·äº¤äº’çš„ Portal/Dashboard æ¨¡å—.")]),s._v(" "),t("p",[s._v("Open-Falcon æŠŠç»„ä»¶æ‹†å¾—æ¯”è¾ƒæ•£, ç»„ä»¶æ¯”è¾ƒå¤š, éƒ¨ç½²èµ·æ¥ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦. ä¸è¿‡æ¯ä¸ªç»„ä»¶çš„èŒèƒ½å•ä¸€, äºŒæ¬¡å¼€å‘ä¼šæ¯”è¾ƒå®¹æ˜“, å¾ˆå¤šäº’è”ç½‘å…¬å¸éƒ½æ˜¯åŸºäº Open-Falcon åšäº†äºŒæ¬¡å¼€å‘, æ¯”å¦‚ç¾å›¢, æ–°æµªå¾®åš, çˆ±å¥‡è‰ºç­‰.")]),s._v(" "),t("p",[t("strong",[s._v("Open-Falconçš„ä¼˜ç‚¹")])]),s._v(" "),t("ul",[t("li",[s._v("å¯ä»¥å¤„ç†å¤§è§„æ¨¡ç›‘æ§åœºæ™¯, æ¯” Zabbix çš„å®¹é‡è¦å¤§å¾—å¤š, ä¸ä»…å¯ä»¥å¤„ç†è®¾å¤‡, ä¸­é—´ä»¶å±‚é¢çš„ç›‘æ§, ä¹Ÿå¯ä»¥å¤„ç†åº”ç”¨å±‚é¢çš„ç›‘æ§.")]),s._v(" "),t("li",[s._v("ç»„ä»¶æ‹†åˆ†å¾—æ¯”è¾ƒæ•£, å¤§éƒ½æ˜¯ç”¨ Go è¯­è¨€å¼€å‘çš„, Web éƒ¨åˆ†æ˜¯ç”¨ Python, æ˜“äºåšäºŒæ¬¡å¼€å‘.")])]),s._v(" "),t("p",[t("strong",[s._v("Open-Falconçš„ç¼ºç‚¹")])]),s._v(" "),t("ul",[t("li",[s._v("ç”Ÿæ€ä¸å¤Ÿåºå¤§, æœ‰ä¸€äº›è´¡çŒ®è€…, ä½†æ•°é‡ç›¸å¯¹è¾ƒå°‘.")]),s._v(" "),t("li",[s._v("å¼€æºè½¯ä»¶çš„æ²»ç†æ¶æ„ä¸å¤Ÿä¼˜ç§€, å°ç±³å…¬å¸çš„æ ¸å¿ƒå¼€å‘äººå‘˜ç¦»èŒ, é¡¹ç›®å°±åœæ»ä¸å‰äº†, ç¼ºå°‘äº†ç”Ÿå‘½åŠ›.")])]),s._v(" "),t("h5",{attrs:{id:"_3-æ–°ä¸€ä»£æ•´ä½“æ–¹æ¡ˆä»£è¡¨prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ–°ä¸€ä»£æ•´ä½“æ–¹æ¡ˆä»£è¡¨prometheus"}},[s._v("#")]),s._v(" 3.æ–°ä¸€ä»£æ•´ä½“æ–¹æ¡ˆä»£è¡¨Prometheus")]),s._v(" "),t("p",[s._v("Prometheus çš„è®¾è®¡æ€è·¯æ¥è‡ª Google çš„ Borgmon, "),t("strong",[s._v("è€Œ Prometheus å°±æ˜¯ä¸º Kubernetes è€Œç”Ÿçš„. å®ƒé’ˆå¯¹ Kubernetes åšäº†ç›´æ¥çš„æ”¯æŒ, æä¾›äº†å¤šç§æœåŠ¡å‘ç°æœºåˆ¶, å¤§å¹…ç®€åŒ–äº† Kubernetes çš„ç›‘æ§")]),s._v(".")]),s._v(" "),t("p",[s._v("åœ¨ Kubernetes ç¯å¢ƒä¸‹, Pod åˆ›å»ºå’Œé”€æ¯éå¸¸é¢‘ç¹, ç›‘æ§æŒ‡æ ‡ç”Ÿå‘½å‘¨æœŸå¤§å¹…ç¼©çŸ­, è¿™å¯¼è‡´ç±»ä¼¼ Zabbix è¿™ç§é¢å‘èµ„äº§çš„ç›‘æ§ç³»ç»ŸåŠ›ä¸ä»å¿ƒ, è€Œä¸”äº‘åŸç”Ÿç¯å¢ƒä¸‹å¤§éƒ½æ˜¯å¾®æœåŠ¡è®¾è®¡, æœåŠ¡æ•°é‡å˜å¤š, æŒ‡æ ‡é‡ä¹Ÿå‘ˆçˆ†ç‚¸æ€åŠ¿, è¿™å°±å¯¹æ—¶åºæ•°æ®å­˜å‚¨æå‡ºäº†éå¸¸é«˜çš„è¦æ±‚.")]),s._v(" "),t("p",[s._v("Prometheus 1.0 ä» 2.0 å¼€å§‹é‡æ–°è®¾è®¡äº†æ—¶åºåº“, æ€§èƒ½, å¯é æ€§éƒ½æœ‰å¤§å¹…æå‡, å¦å¤–ç¤¾åŒºæ¶Œç°äº†è¶Šæ¥è¶Šå¤šçš„ Exporter é‡‡é›†å™¨, éå¸¸ç¹è£. å¯ä»¥çœ‹ä¸€ä¸‹ Prometheus çš„æ¶æ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e679ea2310fd68aa7391b018382c3d13-20230719203435-oida9z0.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[t("strong",[s._v("Prometheusçš„ä¼˜ç‚¹")])]),s._v(" "),t("ul",[t("li",[s._v("å¯¹ Kubernetes æ”¯æŒå¾—å¾ˆå¥½, ç›®å‰æ¥çœ‹, Prometheus å°±æ˜¯ Kubernetes ç›‘æ§çš„æ ‡é….")]),s._v(" "),t("li",[s._v("ç”Ÿæ€åºå¤§, æœ‰å„ç§å„æ ·çš„ Exporter, æ”¯æŒå„ç§å„æ ·çš„æ—¶åºåº“ä½œä¸ºåç«¯çš„ Backend å­˜å‚¨, ä¹Ÿæœ‰å¾ˆå¥½çš„æ”¯æŒå¤šç§ä¸åŒè¯­è¨€çš„ SDK, ä¾›ä¸šåŠ¡ä»£ç åµŒå…¥åŸ‹ç‚¹.")])]),s._v(" "),t("p",[t("strong",[s._v("Prometheusçš„ç¼ºç‚¹")])]),s._v(" "),t("ul",[t("li",[s._v("æ˜“ç”¨æ€§å·®ä¸€äº›, æ¯”å¦‚å‘Šè­¦ç­–ç•¥éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶, ååŒèµ·æ¥æ¯”è¾ƒéº»çƒ¦. å½“ç„¶äº†, å¯¹äº IaC è½åœ°è¾ƒå¥½çš„å…¬å¸, åè€Œè®¤ä¸ºè¿™æ ·æ›´å¥½, ä¸è¿‡åœ¨å›½å†…å½“ä¸‹çš„ç¯å¢ƒæ¥çœ‹, è¿˜æ— æ³•èµ°å¾—è¿™ä¹ˆé å‰, å¤§å®¶è¿˜æ˜¯æ›´å–œæ¬¢ç”¨ Web ç•Œé¢æ¥æŸ¥çœ‹ç›‘æ§æ•°æ®, ç®¡ç†å‘Šè­¦è§„åˆ™.")]),s._v(" "),t("li",[s._v("Exporter å‚å·®ä¸é½, é€šå¸¸æ˜¯ä¸€ä¸ªç›‘æ§ç›®æ ‡ä¸€ä¸ª Exporter, ç®¡ç†èµ·æ¥æˆæœ¬æ¯”è¾ƒé«˜.")]),s._v(" "),t("li",[s._v("å®¹é‡é—®é¢˜, Prometheus é»˜è®¤åªæä¾›å•æœºæ—¶åºåº“, é›†ç¾¤æ–¹æ¡ˆéœ€è¦ä¾èµ–å…¶ä»–çš„æ—¶åºåº“.")])]),s._v(" "),t("h5",{attrs:{id:"_4-æ–°ä¸€ä»£å›½äº§ä»£è¡¨-nightingale"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ–°ä¸€ä»£å›½äº§ä»£è¡¨-nightingale"}},[s._v("#")]),s._v(" 4.æ–°ä¸€ä»£å›½äº§ä»£è¡¨ Nightingale")]),s._v(" "),t("p",[s._v("Nightingale å¯ä»¥çœ‹åšæ˜¯ Open-Falcon çš„ä¸€ä¸ªå»¶ç»­, å› ä¸ºå¼€å‘äººå‘˜æ˜¯ä¸€æ‹¨äºº, ä¸è¿‡ä¸¤ä¸ªè½¯ä»¶çš„å®šä½æˆªç„¶ä¸åŒ, Open-Falcon ç±»ä¼¼ Zabbix, æ›´å¤šçš„æ˜¯é¢å‘æœºå™¨è®¾å¤‡, è€Œ Nightingale ä¸æ­¢è§£å†³è®¾å¤‡å’Œä¸­é—´ä»¶çš„ç›‘æ§, ä¹Ÿå¸Œæœ›èƒ½ä¸€å¹¶è§£å†³"),t("strong",[s._v("äº‘åŸç”Ÿ")]),s._v("ç¯å¢ƒä¸‹çš„ç›‘æ§é—®é¢˜.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯åœ¨ Kubernetes ç¯å¢ƒä¸‹, Prometheus å·²ç»å¤§è¡Œå…¶é“, å†é‡å¤é€ è½®å­æ„ä¹‰ä¸å¤§, æ‰€ä»¥ "),t("strong",[s._v("NightingaleÂ çš„åšæ³•æ˜¯å’ŒÂ PrometheusÂ åšè‰¯å¥½çš„æ•´åˆ, æ‰“é€ ä¸€ä¸ªæ›´å®Œå¤‡çš„æ–¹æ¡ˆ")]),s._v(". å½“ä¸‹çš„æ¶æ„, ä¸»è¦æ˜¯æŠŠ Prometheus å½“æˆä¸€ä¸ª"),t("strong",[s._v("æ—¶åºåº“")]),s._v(", ä½œä¸º Nightingale çš„ä¸€ä¸ªæ•°æ®æº. å¦‚æœä¸ä½¿ç”¨ Prometheus ä¹Ÿæ²¡é—®é¢˜, æ¯”å¦‚ä½¿ç”¨ VictoriaMetrics ä½œä¸ºæ—¶åºåº“, ä¹Ÿæ˜¯å¾ˆå¤šå…¬å¸çš„é€‰æ‹©.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c9236a33aba494eb22e9f068efafe791-20230719203435-7fj8xzu.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[t("strong",[s._v("Nightingaleçš„ä¼˜ç‚¹")])]),s._v(" "),t("ul",[t("li",[s._v("æœ‰æ¯”è¾ƒå®Œå¤‡çš„ UI, æœ‰æƒé™æ§åˆ¶, äº§å“åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡, å¯ä»¥ä½œä¸ºå…¬å¸çº§ç»Ÿä¸€çš„ç›‘æ§äº§å“è®©æ‰€æœ‰å›¢é˜Ÿå…±åŒä½¿ç”¨. Prometheus ä¸€èˆ¬æ˜¯æ¯ä¸ªå›¢é˜Ÿè‡ªå·±ç”¨è‡ªå·±çš„, æ¯”è¾ƒæ–¹ä¾¿. å¦‚æœä¸€ä¸ªå…¬å¸ç”¨åŒä¸€å¥— Prometheus ç³»ç»Ÿæ¥è§£å†³ç›‘æ§éœ€æ±‚ä¼šæ¯”è¾ƒéº»çƒ¦, å®¹æ˜“å‡ºç°ä¸Šé¢è¯´çš„ååŒé—®é¢˜, è€Œ Nightingale åœ¨ååŒæ–¹é¢åšå¾—ç›¸å¯¹å¥½ä¸€äº›.")]),s._v(" "),t("li",[s._v("å…¼å®¹å¹¶åŒ…, è®¾è®¡ä¸Šæ¯”è¾ƒå¼€æ”¾, æ”¯æŒå¯¹æ¥ Categraf, Telegraf, Grafana-Agent, Datadog-Agent ç­‰é‡‡é›†å™¨, è¿˜æœ‰ Prometheus ç”Ÿæ€çš„å„ç§ Exporter, æ—¶åºåº“æ”¯æŒå¯¹æ¥ Prometheus, VictoriaMetrics, M3DB, Thanos ç­‰.")])]),s._v(" "),t("p",[t("strong",[s._v("Nightingaleçš„ç¼ºç‚¹")])]),s._v(" "),t("ul",[t("li",[s._v("è€ƒè™‘åˆ°æœºæˆ¿ç½‘ç»œå‰²è£‚é—®é¢˜, å‘Šè­¦å¼•æ“å•ç‹¬æ‹†å‡ºä¸€ä¸ªæ¨¡å—ä¸‹æ²‰éƒ¨ç½²åˆ°å„ä¸ªæœºæˆ¿, ä½†æ˜¯å¾ˆå¤šä¸­å°å…¬å¸æ— éœ€è¿™ä¹ˆå¤æ‚çš„æ¶æ„, éƒ¨ç½²ç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦.")]),s._v(" "),t("li",[s._v("å‘Šè­¦äº‹ä»¶å‘é€ç¼ºå°‘èšåˆé™å™ªæ”¶æ•›é€»è¾‘, å®˜æ–¹çš„è§£é‡Šæ˜¯æœªæ¥ä¼šå•ç‹¬åšä¸€ä¸ªäº‹ä»¶ä¸­å¿ƒçš„äº§å“, æ”¯æŒ Nightingale, Zabbix, Prometheus ç­‰å¤šç§æ•°æ®æºçš„å‘Šè­¦äº‹ä»¶, ä½†ç›®å‰è¿˜æ²¡æœ‰æ”¾å‡º.")])]),s._v(" "),t("p",[t("strong",[s._v("ä¸Šé¢ä»‹ç»äº†å‡ ç§å…¸å‹æ–¹æ¡ˆ, æ¯ç§æ–¹æ¡ˆå„æœ‰ä¼˜ç¼ºç‚¹, å¦‚æœä¸»è¦éœ€æ±‚æ˜¯ç›‘æ§è®¾å¤‡, æ¨èä½¿ç”¨ Zabbix; å¦‚æœä¸»è¦éœ€æ±‚æ˜¯ç›‘æ§ Kubernetes, å¯ä»¥é€‰æ‹© Prometheus+Grafana; å¦‚æœæ—¢è¦å…¼é¡¾ä¼ ç»Ÿè®¾å¤‡, ä¸­é—´ä»¶ç›‘æ§åœºæ™¯, åˆè¦å…¼é¡¾ Kubernetes, åšæˆå…¬å¸çº§æ–¹æ¡ˆ, æ¨èä½ ä½¿ç”¨ Nightingale.")])]),s._v(" "),t("h5",{attrs:{id:"_5-å¯¹æ¯”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-å¯¹æ¯”"}},[s._v("#")]),s._v(" 5.å¯¹æ¯”")]),s._v(" "),t("p",[s._v("æœ€åå¯¹æŒ‡æ ‡ç›‘æ§é¢†åŸŸçš„å¤šä¸ªå¼€æºè§£å†³æ–¹æ¡ˆåšäº†æ¨ªè¯„å¯¹æ¯”, å¸®åŠ©ä½ åšæŠ€æœ¯æ–¹æ¡ˆçš„é€‰å‹. é’ˆå¯¹æŒ‡æ ‡ç›‘æ§çš„å‡ ä¸ªå¼€æºæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cb513a55f60ed2c684b06639bafda446-20230719203435-pcy0w1s.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_2-åŸºæœ¬æ¦‚å¿µ-ç›‘æ§åœˆå­æœ‰å“ªäº›è¡Œä¸šé»‘è¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-åŸºæœ¬æ¦‚å¿µ-ç›‘æ§åœˆå­æœ‰å“ªäº›è¡Œä¸šé»‘è¯"}},[s._v("#")]),s._v(" 2.åŸºæœ¬æ¦‚å¿µ-ç›‘æ§åœˆå­æœ‰å“ªäº›è¡Œä¸šé»‘è¯?")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ç»§ç»­å­¦ä¹ ç›‘æ§çš„ç›¸å…³æ¦‚å¿µ, åŒ…æ‹¬ç›‘æ§, ç›‘æ§æŒ‡æ ‡, æŒ‡æ ‡ç±»å‹, æ—¶åºåº“, è¿˜æœ‰å‘Šè­¦æ”¶æ•›ä¸é—­ç¯ç­‰. ç†æ¸…ç›‘æ§åœˆå­çš„è¿™äº›å¸¸ç”¨æœ¯è¯­ä¹‹å, å­¦ä¹ èµ·æ¥ä¼šæ›´è½»æ¾ä¸€äº›.")]),s._v(" "),t("p",[s._v("ç›‘æ§è¿™ä¸ªè¯åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­å«ä¹‰ä¼šæœ‰ä¸€äº›åŒºåˆ«, ä¸€èˆ¬è¯´ç›‘æ§ MySQL, ç›‘æ§ Redis çš„æ—¶å€™, éƒ½æ˜¯æŒ‡èƒ½å¤Ÿé‡‡é›†åˆ° MySQL, Redis çš„ç›‘æ§æ•°æ®, å¹¶èƒ½å¯è§†åŒ–å±•ç¤º. è¿™æ—¶å€™ç›‘æ§è¡¨ç¤ºæ•°æ®é‡‡é›†å’Œå¯è§†åŒ–, ä¸åŒ…æ‹¬å‘Šè­¦å¼•æ“å’Œäº‹ä»¶å¤„ç†. ä½†å½“è®²ç›‘æ§ç³»ç»Ÿçš„æ—¶å€™, å› ä¸ºè¯´çš„æ˜¯æ•´ä¸ªç³»ç»Ÿ, æ‰€ä»¥ä¹Ÿä¼šåŒ…å«å‘Šè­¦å’Œäº‹ä»¶å‘é€ç­‰ç›¸å…³åŠŸèƒ½.")]),s._v(" "),t("p",[s._v("ç›‘æ§ä½“ç³»ä¸­æœ€åŸºç¡€çš„æ˜¯ç›‘æ§æŒ‡æ ‡, "),t("strong",[s._v("ç›‘æ§ç³»ç»Ÿå°±æ˜¯å›´ç»•æŒ‡æ ‡çš„é‡‡é›†, ä¼ è¾“, å­˜å‚¨, åˆ†æ, å¯è§†åŒ–çš„ä¸€ä¸ªç³»ç»Ÿ")]),s._v(", ä¸‹é¢å°±ä»ç›‘æ§æŒ‡æ ‡è¿™ä¸ªæ¦‚å¿µè®²èµ·.")]),s._v(" "),t("h4",{attrs:{id:"ç›‘æ§æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§æŒ‡æ ‡"}},[s._v("#")]),s._v(" ç›‘æ§æŒ‡æ ‡")]),s._v(" "),t("p",[t("strong",[s._v("ç›‘æ§æŒ‡æ ‡æ˜¯æŒ‡æ•°å€¼ç±»å‹çš„ç›‘æ§æ•°æ®")]),s._v(", æ¯”å¦‚æŸä¸ªæœºå™¨çš„å†…å­˜åˆ©ç”¨ç‡, æŸä¸ª MySQL å®ä¾‹çš„å½“å‰è¿æ¥æ•°, æŸä¸ª Redis çš„æœ€å¤§å†…å­˜ä¸Šé™ç­‰ç­‰. ä¸åŒçš„ç›‘æ§ç³»ç»Ÿ, å¯¹äºç›‘æ§æŒ‡æ ‡æœ‰ä¸åŒçš„æè¿°æ–¹å¼, å…¸å‹çš„æ–¹å¼æœ‰ä¸‰ç§, ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"_1-å…¨å±€å”¯ä¸€å­—ç¬¦ä¸²ä½œä¸ºæŒ‡æ ‡æ ‡è¯†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å…¨å±€å”¯ä¸€å­—ç¬¦ä¸²ä½œä¸ºæŒ‡æ ‡æ ‡è¯†"}},[s._v("#")]),s._v(" 1.å…¨å±€å”¯ä¸€å­—ç¬¦ä¸²ä½œä¸ºæŒ‡æ ‡æ ‡è¯†")]),s._v(" "),t("p",[t("strong",[s._v("ç›‘æ§æŒ‡æ ‡é€šå¸¸æ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å­—ç¬¦ä¸²")]),s._v(", æ¯”å¦‚æŸæœºå™¨çš„å†…å­˜åˆ©ç”¨ç‡  host.10.2.3.4.mem_used_percent, è¿™ä¸ªå­—ç¬¦ä¸²ä¸­åŒ…å«äº†æœºå™¨çš„ä¿¡æ¯, ä¹ŸåŒ…å«äº†æŒ‡æ ‡å, å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€æ¡ç›‘æ§æŒ‡æ ‡. å‡è®¾ç›‘æ§æ•°æ®é‡‡é›†çš„é¢‘ç‡æ˜¯ 30 ç§’, 2 åˆ†é’Ÿå†…é‡‡é›†äº† 4 ä¸ªæ•°æ®ç‚¹, ä¸€ä¸ªæ•°æ®ç‚¹åŒ…å«ä¸€ä¸ªæ—¶é—´æˆ³å’Œä¸€ä¸ªå€¼, å¯ä»¥ç”¨ JSON è¡¨ç¤ºè¿™ä¸ªç›‘æ§æŒ‡æ ‡åŠå…¶ç›‘æ§æ•°æ®.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host.10.2.3.4.mem_used_percent"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"points"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clock"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1662449136")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"value"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45.4")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clock"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1662449166")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"value"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43.2")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clock"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1662449196")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"value"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44.9")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clock"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1662449226")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"value"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44.8")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("ç›¸å¯¹è€ä¸€äº›çš„ç›‘æ§ç³»ç»Ÿ, æ¯”å¦‚ Graphite, å°±æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼æ¥æ ‡è¯†ç›‘æ§æŒ‡æ ‡çš„. ä¸€äº›è€çš„ç›‘æ§æ•°æ®é‡‡é›†å™¨, æ¯”å¦‚ Collectd, ä¹Ÿæ˜¯è¿™æ ·æ ‡è¯†ç›‘æ§æŒ‡æ ‡çš„.")]),s._v(" "),t("p",[s._v("è™½ç„¶è¿™ç§æ–¹å¼ä¸€ç›®äº†ç„¶, éå¸¸æ¸…æ™°, ä½†æ˜¯"),t("strong",[s._v("ç¼ºå°‘å¯¹ç»´åº¦ä¿¡æ¯çš„æè¿°, ä¸ä¾¿äºåšèšåˆè®¡ç®—")]),s._v(". æ¯”å¦‚ä¸‹é¢å‡ æ¡ç”¨äºæè¿° HTTP è¯·æ±‚çŠ¶æ€ç çš„æŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("myhost.service1.http_request.200.get\nmyhost.service1.http_request.200.post\nmyhost.service1.http_request.500.get\nmyhost.service1.http_request.500.post\nmyhost.service2.http_request.200.get\nmyhost.service2.http_request.500.post\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("myhost è¿™ä¸ªæœºå™¨ä¸Šéƒ¨ç½²äº†ä¸¤ä¸ªæœåŠ¡, åˆ†åˆ«æ˜¯ service1 å’Œ service2. æœ‰äº›è¯·æ±‚çŠ¶æ€ç æ˜¯ 200, æœ‰äº›æ˜¯ 500, æœ‰äº› HTTP method æ˜¯ get, æœ‰äº›æ˜¯ post. "),t("strong",[s._v("å¦‚æœæƒ³åˆ†åˆ«ç»Ÿè®¡è¿™äº›æŒ‡æ ‡çš„æ•°é‡, å°±è¦æŠŠè¿™äº›åˆ†ç±»ç»´åº¦ä¿¡æ¯éƒ½æ‹¼åˆ°æŒ‡æ ‡æ ‡è¯†ä¸­. ä½†æ˜¯è¿™æ ·åšä¼šäº§ç”Ÿä¸¤ä¸ªå¼Šç«¯: ä¸€æ˜¯çœ‹èµ·æ¥æ¯”è¾ƒæ··ä¹±, äºŒæ˜¯ä¸æ–¹ä¾¿èšåˆç»Ÿè®¡")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸¾ä¸ªä¾‹å­, æ¯”å¦‚æƒ³è®¡ç®— service1 è¿™ä¸ªæœåŠ¡çš„æˆåŠŸç‡, è¦æŠŠ service1 é‡Œæ‰€æœ‰çŠ¶æ€ç ä¸º 200 çš„è¯·æ±‚æ•°é‡æ‹¿åˆ°, é™¤ä»¥ service1 æ‰€æœ‰è¯·æ±‚çš„æ•°é‡. å¦‚æœé¢„å…ˆçŸ¥é“æ‰€æœ‰çŠ¶æ€ç , æ‰€æœ‰ HTTP method, åˆ™å¯ä»¥æšä¸¾æŒ‡æ ‡åç§°, æ‹‰å–ç›‘æ§æ•°æ®. å¦‚æœ"),t("strong",[s._v("ä¸çŸ¥é“æ‰€æœ‰çŠ¶æ€ç å’Œ HTTP method, å°±è¦å…ˆç”¨æ­£åˆ™åŒ¹é…æŒ‡æ ‡æ ‡è¯†, æŸ¥è¯¢å‡ºæŒ‡æ ‡åˆ—è¡¨å†æ‹‰å–ç›‘æ§æ•°æ®åšè®¡ç®—, å¤„ç†èµ·æ¥éå¸¸éº»çƒ¦")]),s._v(".")]),s._v(" "),t("p",[s._v("å…¶å®è¿™æ˜¯ç”¨é©¬åç‚®è§†è§’è§£é‡Šè¿™ä¸ªé—®é¢˜çš„, å®é™…ä¸Š, åœ¨ Graphite, Collectd, Zabbix è¿™äº›è½¯ä»¶ç››è¡Œçš„æ—¶ä»£, è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜æ˜¾. å› ä¸ºé‚£ä¸ªæ—¶ä»£ä¸»è¦å…³æ³¨çš„æ˜¯æœºå™¨è®¾å¤‡, æ•°æ®åº“, ä¸­é—´ä»¶çš„ç›‘æ§, ä¸ä¼šæœ‰å¾ˆå¤šç»´åº¦çš„ä¿¡æ¯. "),t("strong",[s._v("ç›´åˆ°ä¸šç•Œå¼€å§‹å…³æ³¨åº”ç”¨å±‚é¢ç›‘æ§çš„æ—¶å€™, æ‰æš´éœ²å‡ºè¿™ä¸ªé—®é¢˜")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"_2-æ ‡ç­¾é›†çš„ç»„åˆä½œä¸ºæŒ‡æ ‡æ ‡è¯†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ ‡ç­¾é›†çš„ç»„åˆä½œä¸ºæŒ‡æ ‡æ ‡è¯†"}},[s._v("#")]),s._v(" 2.æ ‡ç­¾é›†çš„ç»„åˆä½œä¸ºæŒ‡æ ‡æ ‡è¯†")]),s._v(" "),t("p",[s._v("2010 å¹´å·¦å³, æœ‰ä¸€æ¬¾åå« "),t("a",{attrs:{href:"http://opentsdb.net/",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenTSDB"),t("OutboundLink")],1),s._v(" çš„æ—¶åºæ•°æ®åº“è¯ç”Ÿäº†. è™½ç„¶ç°åœ¨å·²ç»è¾ƒå°‘ä½¿ç”¨äº†, ä½†æ˜¯ OpenTSDB æè¿°æŒ‡æ ‡çš„æ–¹å¼, å¯¹ä¸šç•Œæœ‰å¾ˆå¤§å½±å“. ä¸‹é¢æ˜¯é€šè¿‡æ–‡æœ¬åè®®æ¨ç»™ OpenTSDB çš„æ•°æ®ç¤ºä¾‹, å¯ä»¥ä»ä¸­çœ‹å‡ºæŒ‡æ ‡æ ‡è¯†çš„å®šä¹‰æ–¹å¼.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("mysql.bytes_received 1287333217 327810227706 schema=foo host=db1\nmysql.bytes_sent 1287333217 6604859181710 schema=foo host=db1\nmysql.bytes_received 1287333232 327812421706 schema=foo host=db1\nmysql.bytes_sent 1287333232 6604901075387 schema=foo host=db1\nmysql.bytes_received 1287333321 340899533915 schema=foo host=db2\nmysql.bytes_sent 1287333321 5506469130707 schema=foo host=db2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä¸Šé¢è¿™ 6 æ¡ç›‘æ§æŒ‡æ ‡, "),t("strong",[s._v("éƒ½é€šè¿‡ç©ºæ ¼æŠŠæŒ‡æ ‡åˆ†éš”æˆäº†å¤šä¸ªå­—æ®µ. ç¬¬ä¸€æ®µæ˜¯æŒ‡æ ‡å, ç¬¬äºŒæ®µæ˜¯æ—¶é—´æˆ³(å•ä½æ˜¯ç§’), ç¬¬ä¸‰æ®µæ˜¯æŒ‡æ ‡å€¼, å‰©ä¸‹çš„éƒ¨åˆ†æ˜¯å¤šä¸ªæ ‡ç­¾(tags/labels), æ¯ä¸ªæ ‡ç­¾éƒ½æ˜¯ key=value çš„æ ¼å¼, å¤šä¸ªæ ‡ç­¾ä¹‹é—´ä½¿ç”¨ç©ºæ ¼åˆ†éš”")]),s._v(".")]),s._v(" "),t("p",[s._v("é™¤äº† OpenTSDB, æ–°æ—¶ä»£çš„æ—¶åºåº“å¤§éƒ½å¼•å…¥äº†"),t("mark",[t("strong",[s._v("æ ‡ç­¾")])]),s._v("çš„æ¦‚å¿µ, æ¯”å¦‚ Prometheus, å®ƒä»¬ç”šè‡³è®¤ä¸ºæŒ‡æ ‡åä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‡ç­¾(å…¶æ ‡ç­¾ key æ˜¯ __name__ ), æ‰€ä»¥ "),t("mark",[t("strong",[s._v("Prometheus ä»…ä»…ä½¿ç”¨æ ‡ç­¾é›†ä½œä¸ºæŒ‡æ ‡æ ‡è¯†")])]),s._v(", ä» Prometheus çš„æ•°æ®ç»“æ„å®šä¹‰ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("message Sample {\n  double value    = 1;\n  int64 timestamp = 2;\n}\n\nmessage Label {\n  string name  = 1;\n  string value = 2;\n}\n\nmessage TimeSeries {\n  repeated Label labels   = 1 [(gogoproto.nullable) = false];\n  repeated Sample samples = 2 [(gogoproto.nullable) = false];\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("TimeSeries è¿™ä¸ªç»“æ„ä¸­å¹¶æ²¡æœ‰ä¸€ä¸ªå•ç‹¬çš„ metric å­—æ®µ, æŒ‡æ ‡åçš„ä¿¡æ¯å®é™…æ˜¯æ”¾åˆ°äº†  labels æ•°ç»„ä¸­äº†.")]),s._v(" "),t("h5",{attrs:{id:"_3-ä¼˜é›…é«˜æ•ˆçš„influxæŒ‡æ ‡æ ¼å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¼˜é›…é«˜æ•ˆçš„influxæŒ‡æ ‡æ ¼å¼"}},[s._v("#")]),s._v(" 3.ä¼˜é›…é«˜æ•ˆçš„InfluxæŒ‡æ ‡æ ¼å¼")]),s._v(" "),t("p",[s._v("InfluxData å…¬å¸æœ‰ä¸€æ¬¾å¼€æºæ—¶åºåº“éå¸¸æœ‰å, å« "),t("a",{attrs:{href:"https://www.influxdata.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("InfluxDB"),t("OutboundLink")],1),s._v(", InfluxDB åœ¨æ¥æ”¶ç›‘æ§æ•°æ®å†™å…¥æ—¶, è®¾è®¡äº†ä¸€ä¸ªéå¸¸ç²¾å·§çš„æŒ‡æ ‡æ ¼å¼, ä¸€è¡Œå¯ä»¥ä¼ è¾“å¤šä¸ªæŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("mesurement,labelkey1=labelval1,labelkey2=labelval2 field1=1.2,field2=2.3 timestamp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ€»ä½“æ¥çœ‹, åˆ†ä¸º 4 ä¸ªéƒ¨åˆ†, "),t("strong",[s._v("measurement, tag_set field_set timestamp")]),s._v(", å…¶ä¸­ tag_set æ˜¯å¯é€‰çš„, tag_set ä¸å‰é¢çš„ measurement ä¹‹é—´ç”¨"),t("strong",[s._v("é€—å·")]),s._v("åˆ†éš”, å…¶ä»–å„ä¸ªéƒ¨åˆ†ä¹‹é—´éƒ½æ˜¯ç”¨"),t("strong",[s._v("ç©ºæ ¼")]),s._v("æ¥åˆ†éš”çš„. å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä¾‹å­æ¥ç†è§£.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("weather,location=us-midwest temperature=82 1465839830100400200\n  |    -------------------- --------------  |\n  |             |             |             |\n  |             |             |             |\n+-----------+--------+-+---------+-+---------+\n|measurement|,tag_set| |field_set| |timestamp|\n+-----------+--------+-+---------+-+---------+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("æŠŠä¸Šé¢ OpenTSDB çš„æŒ‡æ ‡ç¤ºä¾‹æ”¹å†™æˆ Influx æ ¼å¼, ç»“æœæ˜¯è¿™æ ·çš„.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("mysql,schema=foo,host=db1 bytes_received=327810227706,bytes_sent=6604859181710 1287333217000000000\nmysql,schema=foo,host=db1 bytes_received=327812421706,bytes_sent=6604901075387 1287333232000000000\nmysql,schema=foo,host=db2 bytes_received=340899533915,bytes_sent=5506469130707 1287333321000000000\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("æ³¨æ„, æ—¶é—´æˆ³çš„å•ä½æ˜¯çº³ç§’. "),t("strong",[s._v("è¿™ç§å†™æ³•è®¾è®¡å¾ˆç²¾å·§, æ ‡ç­¾é‡å¤åº¦ä½, field è¶Šå¤šçš„æƒ…å†µä¸‹å®ƒçš„ä¼˜åŠ¿è¶Šæ˜æ˜¾, ç½‘ç»œä¼ è¾“çš„æ—¶å€™å¯ä»¥èŠ‚çœæ›´å¤šå¸¦å®½")]),s._v(". å½“ç„¶äº†, OpenTSDB çš„æ ¼å¼æˆ–è€… Prometheus çš„æ ¼å¼å¦‚æœåšäº†æ•°æ®å‹ç¼©, èŠ‚çœå¸¦å®½çš„æ•ˆæœä¹Ÿæ˜¯ä¸é”™çš„, å› ä¸ºå­—ç¬¦çš„å‹ç¼©æ•ˆæœä¸€èˆ¬æ¯”è¾ƒæ˜æ˜¾. ç°å¦‚ä»Šæœºæˆ¿å†…éƒ¨é€šä¿¡åŠ¨è¾„ä¸‡å…†ç½‘å¡, è¿™ä¸ªæµé‡çš„å¤§å°åŒºåˆ«å€’ä¹Ÿä¸ç”¨å¤ªå…³æ³¨.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ee5a62f16cb36b57cf560c1b00e41822-20230719203435-tq4c6ha.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("ç›‘æ§æŒ‡æ ‡çš„æ¦‚å¿µéå¸¸é‡è¦, å¯ä»¥è¯´ç›‘æ§ç³»ç»Ÿä¸­çš„ä¸€åˆ‡éƒ½æ˜¯å›´ç»•ç›‘æ§æŒ‡æ ‡æ¥çš„, æ‰€ä»¥ç”¨äº†å¤§é‡ç¯‡å¹…æ¥è§£é‡Šç›‘æ§æŒ‡æ ‡, è¿˜è®²è§£äº†å‡ ç§ä¸åŒæŒ‡æ ‡çš„æè¿°æ–¹å¼. é™¤äº†è¿™äº›æè¿°æ–¹å¼ä¹‹å¤–, "),t("strong",[s._v("ç›‘æ§æŒ‡æ ‡è¿˜åˆ†ä¸ºå„ç§ä¸åŒçš„ç±»å‹")]),s._v(", ä¸‹é¢ä¸€èµ·æ¥çœ‹ä¸€ä¸‹.")]),s._v(" "),t("h4",{attrs:{id:"æŒ‡æ ‡ç±»å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æŒ‡æ ‡ç±»å‹"}},[s._v("#")]),s._v(" æŒ‡æ ‡ç±»å‹")]),s._v(" "),t("p",[s._v("æœ‰äº›ç›‘æ§ç³»ç»Ÿæ˜¯ä¸åŒºåˆ†æŒ‡æ ‡ç±»å‹çš„, æœ‰äº›ä¼šåšåŒºåˆ†. 90 å¹´ä»£å‡ºç°äº† "),t("a",{attrs:{href:"https://oss.oetiker.ch/rrdtool/",target:"_blank",rel:"noopener noreferrer"}},[s._v("RRDtool"),t("OutboundLink")],1),s._v(", å®ƒæ˜¯ä¸€ä¸ªç¯å½¢æ•°æ®åº“, ä¹Ÿæ˜¯ä¸€ä¸ªç»˜å›¾å¼•æ“, å¾ˆå¤šç›‘æ§å·¥å…·éƒ½æ˜¯ä½¿ç”¨ RRDtool æ¥å­˜å‚¨æˆ–ç»˜åˆ¶ç›‘æ§è¶‹åŠ¿å›¾çš„, æ¯”å¦‚ Cacti, MRTG, Zabbix ç­‰ç­‰. RRDtool è¿˜æå‡ºäº†æ•°æ®ç±»å‹çš„æ¦‚å¿µ, æ”¯æŒGAUGE, COUNTER, DERIVE, DCOUNTER, DDERIVE, ABSOLUTE ç­‰å¤šç§æ•°æ®ç±»å‹.")]),s._v(" "),t("p",[t("strong",[s._v("Prometheus ç”Ÿæ€ä¹Ÿæ”¯æŒæ•°æ®ç±»å‹, åˆ†ä¸º Gauge, Counter, Histogram, Summary 4 ç§, ä¸‹é¢ç®€å•äº†è§£ä¸€ä¸‹ Prometheus çš„è¿™ 4 ç§ç±»å‹.")])]),s._v(" "),t("h5",{attrs:{id:"_1-gauge"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-gauge"}},[s._v("#")]),s._v(" 1.Gauge")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("æµ‹é‡å€¼ç±»å‹, å¯å¤§å¯å°, å¯æ­£å¯è´Ÿ")])]),s._v(". è¿™ç§ç±»å‹çš„æ•°æ®, é€šå¸¸å…³æ³¨çš„æ˜¯ "),t("mark",[t("strong",[s._v("å½“å‰å€¼")])]),s._v(", æ¯”å¦‚æˆ¿é—´é‡Œçš„äººæ•°, é˜Ÿåˆ—ç§¯å‹çš„æ¶ˆæ¯æ•°, ä»Šå¹´å…¬å¸çš„æ”¶å…¥å’Œå‡€åˆ©æ¶¦.")]),s._v(" "),t("h5",{attrs:{id:"_2-counter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-counter"}},[s._v("#")]),s._v(" 2.Counter")]),s._v(" "),t("p",[t("mark",[s._v("è¡¨ç¤º")]),s._v("â€‹"),t("mark",[t("strong",[s._v("å•è°ƒé€’å¢çš„å€¼")])]),s._v(", æ¯”å¦‚æ“ä½œç³»ç»Ÿè‡ªå¯åŠ¨ä»¥æ¥ç½‘å¡æ¥æ”¶åˆ°çš„æ‰€æœ‰æµé‡åŒ…çš„æ•°é‡. æ¯æ¥æ”¶åˆ°ä¸€ä¸ªåŒ…, æ“ä½œç³»ç»Ÿå°±ä¼šåŠ  1, æ‰€ä»¥è¿™ä¸ªå€¼æ˜¯æŒç»­é€’å¢çš„. ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šé‡å¯, å¯¼è‡´è¿™ä¸ªå€¼å‡ºç°é‡ç½®, æ¯”å¦‚ç¬¬ä¸€æ¬¡æ˜¯ä» 0 ä¸€ç›´æ¶¨åˆ°äº† 239423423, ç„¶åæœºå™¨é‡å¯, æ–°é‡‡é›†çš„æ•°æ®æ˜¯ä¸€äº›æ¯” 239423423 å°å¾ˆå¤šçš„å€¼, è¿™ç§æƒ…å†µæ€ä¹ˆåŠ? æ­¤æ—¶ Prometheus çœ‹åˆ°å€¼æ²¡æœ‰é€’å¢, å°±èƒ½æ„ŸçŸ¥åˆ°é‡ç½®çš„æƒ…å†µ, ä¼šæŠŠæ–°é‡‡é›†çš„å€¼åŠ ä¸Š 239423423 å†åšè®¡ç®—.")]),s._v(" "),t("h5",{attrs:{id:"_3-histogram"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-histogram"}},[s._v("#")]),s._v(" 3.Histogram")]),s._v(" "),t("p",[t("mark",[s._v("ç›´æ–¹å›¾ç±»å‹, ç”¨äº")]),s._v("â€‹"),t("mark",[t("strong",[s._v("æè¿°æ•°æ®åˆ†å¸ƒ")])]),s._v("â€‹"),t("mark",[s._v(", æœ€å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯ç›‘æ§å»¶è¿Ÿæ•°æ®")]),s._v(", è®¡ç®— 90 åˆ†ä½, 99 åˆ†ä½çš„å€¼. æ‰€è°“çš„åˆ†ä½å€¼, å°±æ˜¯æŠŠä¸€æ‰¹æ•°æ®ä»å°åˆ°å¤§æ’åº, ç„¶åå– X% ä½ç½®çš„æ•°æ®, 90 åˆ†ä½å°±æ˜¯æŒ‡æ ·æœ¬æ•°æ®ç¬¬ 90% ä½ç½®çš„å€¼.")]),s._v(" "),t("p",[s._v("æœ‰äº›æœåŠ¡è®¿é—®é‡å¾ˆé«˜, æ¯ç§’å‡ ç™¾ä¸‡æ¬¡, å¦‚æœè¦æŠŠæ‰€æœ‰è¯·æ±‚çš„å»¶è¿Ÿæ•°æ®å…¨éƒ¨æ‹¿åˆ°, æ’åºä¹‹åå†è®¡ç®—åˆ†ä½å€¼, è¿™ä¸ªä»£ä»·å°±å¤ªé«˜äº†. ä½¿ç”¨ Histogram ç±»å‹, å¯ä»¥ç”¨è¾ƒå°çš„ä»£ä»·è®¡ç®—ä¸€ä¸ªå¤§æ¦‚å€¼. å½“ç„¶ä¸æ˜¯ç‰¹åˆ«å‡†ç¡®, ä½†æ˜¯åœ¨ç›‘æ§åœºæ™¯è¶³å¤Ÿç”¨äº†, ç›‘æ§æ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªé‡‡æ ·çš„ç³»ç»Ÿ, å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚æ²¡æœ‰é‚£ä¹ˆé«˜.")]),s._v(" "),t("p",[t("strong",[s._v("Histogram çš„åšæ³•æ˜¯æ ¹æ®æ•°æ®çš„ value èŒƒå›´, è§„åˆ’å¤šä¸ªæ¡¶(bucket), æŠŠæ ·æœ¬æ•°æ®ç‚¹æ”¾å…¥ä¸åŒçš„æ¡¶æ¥ç»Ÿè®¡")]),s._v(". æ¯”å¦‚æœ‰ä¸ªæœåŠ¡ service1, å®ƒçš„æ¥å£å»¶è¿Ÿæœ€å°çš„é€šå¸¸åœ¨ä¸€ä¸¤ç™¾æ¯«ç§’, æœ€å¤§çš„é€šå¸¸åœ¨ 1 ç§’, å¦‚æœè¶…è¿‡ 3 ç§’, å¤§æ¦‚ç‡å°±æ˜¯ç³»ç»Ÿä¸æ­£å¸¸äº†. æ­¤æ—¶å¯ä»¥è§„åˆ’ 4 ä¸ªæ¡¶, å‡è®¾æœ‰ 1000 ä¸ªè¯·æ±‚, æ¥çœ‹ä¸‹å„ä¸ªæ¡¶å’Œå¯¹åº”çš„æ ·æœ¬ç»Ÿè®¡å€¼.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f0a3eca509ac8bebcdb07685c4ba3d28-20230719203435-fm80l2y.png",alt:""}})]),s._v(" "),t("ul",[t("li",[s._v("å»¶è¿Ÿå°äº 200 æ¯«ç§’çš„, æœ‰ 600 ä¸ªè¯·æ±‚è½åˆ°äº†è¿™ä¸ªåŒºé—´.")]),s._v(" "),t("li",[s._v("å»¶è¿Ÿå°äº 1 ç§’çš„, æœ‰ 850 ä¸ªè¯·æ±‚è½åˆ°äº†è¿™ä¸ªåŒºé—´, å…¶ä¸­å¤§äº 200 æ¯«ç§’çš„æœ‰ 250 ä¸ªè¯·æ±‚.")]),s._v(" "),t("li",[s._v("å»¶è¿Ÿå°äº 3 ç§’çš„, æœ‰ 1000 ä¸ªè¯·æ±‚è½åˆ°äº†è¿™ä¸ªåŒºé—´, å…¶ä¸­å¤§äº 1 ç§’çš„æœ‰ 150 ä¸ªè¯·æ±‚.")]),s._v(" "),t("li",[s._v("å»¶è¿Ÿå°äºæ­£æ— ç©·çš„, ä¹Ÿå°±æ˜¯æ€»é‡, æœ‰ 1000 ä¸ªè¯·æ±‚è½åˆ°äº†è¿™ä¸ªåŒºé—´, è¯´æ˜æ²¡æœ‰å¤§äº 3 ç§’çš„è¯·æ±‚.")])]),s._v(" "),t("p",[s._v("ç°åœ¨æ¥è®¡ç®— 90 åˆ†ä½å€¼, ä¹Ÿå°±æ˜¯ç¬¬ 900 ä¸ªè¯·æ±‚, è¯´æ˜è¿™ä¸ªå€¼è½åˆ°äº†ç¬¬ 3 ä¸ªæ¡¶, å»¶è¿Ÿå°äº 3 ç§’çš„æ¡¶, äºæ˜¯å¯ä»¥å¾—å‡ºç»“è®º, 90 åˆ†ä½çš„å»¶è¿Ÿå¤§å°æ˜¯ 1~3 ç§’ä¹‹é—´.")]),s._v(" "),t("p",[s._v("è™½ç„¶çŸ¥é“äº†"),t("strong",[s._v("åŒºé—´èŒƒå›´")]),s._v(", ä½†æ˜¯è¿˜æ— æ³•å¾—å‡ºå…·ä½“çš„å€¼. **ä¸ºäº†è®¡ç®—å‡ºå…·ä½“çš„å€¼, Prometheus æœ‰ä¸ªå‡è®¾, **â€‹"),t("mark",[t("strong",[s._v("å®ƒè®¤ä¸ºå„ä¸ªæ¡¶é‡Œçš„æ ·æœ¬æ•°æ®æ˜¯å‡åŒ€åˆ†å¸ƒçš„")])]),s._v(", å³ç¬¬ä¸‰ä¸ªæ¡¶çš„è¿™ 150 ä¸ªè¯·æ±‚, å»¶è¿Ÿæœ€å°çš„è¯·æ±‚æ°å¥½å»¶è¿Ÿäº† 1 ç§’, å»¶è¿Ÿæœ€å¤§çš„æ°å¥½å»¶è¿Ÿäº† 3 ç§’, æ€»é‡çš„ç¬¬ 900 ä¸ªè¯·æ±‚, æ˜¯è¿™ä¸ªæ¡¶é‡Œçš„ç¬¬ 50 ä¸ªè¯·æ±‚, æœ€ç»ˆ 90 åˆ†ä½çš„å»¶è¿Ÿæ•°æ®è®¡ç®—æ–¹æ³•æ˜¯:")]),s._v(" "),t("p",[s._v("$$\n(3-1)\\times(50\\div150)+1=1.67 ç§’\n$$")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0bb6b97835f11ae512517eb2040df30f-20230719203435-er0mzxj.png",alt:""}})]),s._v(" "),t("p",[s._v("è¿™å°±æ˜¯ "),t("strong",[s._v("histogram_quantile")]),s._v(" çš„è®¡ç®—æ–¹æ³•. histogram_quantile æ˜¯ Prometheus çš„ä¸€ä¸ªå‡½æ•°, è¿™é‡Œä¸ºäº†è¯´æ˜ Histogram ç±»å‹, æå‰è®²ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„è®¡ç®—é€»è¾‘.")]),s._v(" "),t("p",[s._v("è™½ç„¶ Histogram è¿™ç§åšæ³•ç›¸æ¯”äºæŠŠæ‰€æœ‰è¯·æ±‚å»¶è¿Ÿæ•°æ®éƒ½å­˜å‚¨èµ·æ¥å†è®¡ç®—å»¶è¿Ÿ, æ€§èƒ½æœ‰äº†å·¨å¤§çš„æå‡, ä½†æ˜¯è¦åŒæ—¶è®¡ç®—æˆåƒä¸Šä¸‡ä¸ªæ¥å£çš„åˆ†ä½å€¼å»¶è¿Ÿæ•°æ®, è¿˜æ˜¯éå¸¸è€—è´¹èµ„æºçš„, ç”šè‡³ä¼šé€ æˆæœåŠ¡ç«¯ OOM. äºæ˜¯å°±æœ‰äº† "),t("strong",[s._v("Summary")]),s._v(" ç±»å‹.")]),s._v(" "),t("h5",{attrs:{id:"_4-summary"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-summary"}},[s._v("#")]),s._v(" 4.Summary")]),s._v(" "),t("p",[t("mark",[s._v("Summary è¿™ç§ç±»å‹æ˜¯ ")]),s._v("â€‹"),t("mark",[t("strong",[s._v("åœ¨å®¢æˆ·ç«¯è®¡ç®—åˆ†ä½å€¼")])]),s._v("â€‹"),t("mark",[s._v(", ç„¶åæŠŠè®¡ç®—ä¹‹åçš„ç»“æœæ¨ç»™æœåŠ¡ç«¯å­˜å‚¨, å±•ç¤ºçš„æ—¶å€™ç›´æ¥æŸ¥è¯¢å³å¯, ä¸éœ€è¦åšå¾ˆé‡çš„è®¡ç®—, æ€§èƒ½å¤§å¹…æå‡.")])]),s._v(" "),t("p",[s._v("å¬èµ·æ¥ä¸é”™, ä½†æ˜¯æœ‰ä¸ªé—®é¢˜, Summary çš„è®¡ç®—æ˜¯åœ¨å®¢æˆ·ç«¯è®¡ç®—çš„, ä¹Ÿå°±æ„å‘³ç€"),t("strong",[s._v("ä¸æ˜¯å…¨å±€çš„åˆ†ä½å€¼")]),s._v(", æ¯”å¦‚æŸä¸ªæœåŠ¡ service1, éƒ¨ç½²åœ¨ä¸¤ä¸ªæœºå™¨ä¸Š, æœåŠ¡ä»£ç é‡Œé€šè¿‡å†…åµŒ Prometheus çš„ SDK åšäº†åŸ‹ç‚¹ç›‘æ§, SDK é‡Œä¼šè®¡ç®— Summary æ•°æ®. ä¹Ÿå°±æ˜¯è¯´, "),t("strong",[s._v("åˆ†ä½å€¼å»¶è¿Ÿæ•°æ®æ˜¯è¿›ç¨‹ç²’åº¦çš„, ä¸æ˜¯æ•´ä¸ªæœåŠ¡ç²’åº¦çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜å¾ˆä¸¥é‡å—? å…¶å®ä¹Ÿæ²¡ä»€ä¹ˆå¤§ä¸äº†çš„, è¿™ä¸¤ä¸ªæœºå™¨å‰é¢è‚¯å®šæœ‰è´Ÿè½½å‡è¡¡, è´Ÿè½½å‡è¡¡ä¼šä¿è¯æŠŠè¯·æ±‚å‡åŒ€åœ°æ‰“ç»™åç«¯çš„ä¸¤ä¸ªå®ä¾‹. "),t("strong",[s._v("ä¸€ä¸ªå®ä¾‹å†…éƒ¨è®¡ç®—çš„åˆ†ä½å€¼, ç†è®ºä¸Šå’Œå…¨å±€è®¡ç®—çš„åˆ†ä½å€¼å·®åˆ«ä¸ä¼šå¾ˆå¤§")]),s._v(". å¦å¤–å¦‚æœæŸä¸ªå®ä¾‹æœ‰æ•…éšœ, æ¯”å¦‚ç¡¬ç›˜é—®é¢˜, å¯¼è‡´è½åœ¨è¿™ä¸ªå®ä¾‹çš„è¯·æ±‚å»¶è¿Ÿå¤§å¢, åœ¨å®ä¾‹ç²’åº¦è®¡ç®—çš„å»¶è¿Ÿæ•°æ®åè€Œæ›´å®¹æ˜“å‘ç°é—®é¢˜.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œå°±æŠŠ Prometheus çš„å››ç§æ•°æ®ç±»å‹ä»‹ç»å®Œäº†, ç°åœ¨å›é¡¾ä¸€ä¸‹è¿™ 4 ç§ç±»å‹, å†å¾€ä¸Šç¿»ä¸€ä¸‹ Prometheus çš„æ•°æ®ä¼ è¾“ç»“æ„, å°±æ˜¯é‚£ä¸ª TimeSeries çš„ Proto ç»“æ„, çœ‹çœ‹èƒ½å¦å‘ç°ä¸€äº›é—®é¢˜?")]),s._v(" "),t("h5",{attrs:{id:"_5-ç±»å‹æ‰©å±•çŸ¥è¯†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-ç±»å‹æ‰©å±•çŸ¥è¯†"}},[s._v("#")]),s._v(" 5.ç±»å‹æ‰©å±•çŸ¥è¯†")]),s._v(" "),t("p",[t("strong",[s._v("TimeSeries æ•°æ®ç»“æ„ä¸­æ²¡æœ‰åŒ…å«ç±»å‹ä¿¡æ¯! ç°åœ¨é‡‡é›†äº†ä¸€äº›ç›‘æ§æ•°æ®, ä¼ ç»™ Prometheus(æ¯”å¦‚é€šè¿‡ remote write åè®®), æ•°æ®æ˜¯åˆ†äº†å¤šç§ç±»å‹çš„, ä¼ è¾“çš„æ—¶å€™å´æ²¡æœ‰åŠæ³•å‘Šè¯‰ Prometheusè¿™äº›æ•°æ®çš„ç±»å‹æ˜¯ä»€ä¹ˆ, éš¾é“å®ƒä¸éœ€è¦çŸ¥é“æˆ‘çš„æ•°æ®ç±»å‹å—?")])]),s._v(" "),t("p",[t("strong",[s._v("å…¶å®ä»å­˜å‚¨è§’åº¦è¿˜çœŸçš„ä¸éœ€è¦çŸ¥é“, å­˜å‚¨çš„æ—¶å€™åªè¦çŸ¥é“æŒ‡æ ‡æ ‡è¯†, æ—¶é—´æˆ³, å€¼")]),s._v(", å°±è¶³å¤Ÿäº†. åç»­åš "),t("mark",[t("strong",[s._v("PromQL æŸ¥è¯¢è®¡ç®—çš„æ—¶å€™, ä¸åŒçš„å‡½æ•°æœ‰ä¸åŒçš„è¡Œä¸º")])]),s._v(", æ¯”å¦‚ rate, increase å‡½æ•°, å°±ç»™å®ƒä¼ å…¥ Counter ç±»å‹çš„æ•°æ®ä½œä¸ºå‚æ•°å³å¯. å¯¹äº histogram_quantile å‡½æ•°, å°±ä¼ å…¥å¸¦æœ‰ le æ ‡ç­¾çš„ bucket æŒ‡æ ‡. å…¶å®ç»™ rate å‡½æ•°ä¼ å…¥ä¸€ä¸ª Gauge ç±»å‹çš„æŒ‡æ ‡, ä¹Ÿç…§æ ·å¯ä»¥æ‹¿åˆ°å€¼, è™½ç„¶è¿™ä¸ªå€¼æ²¡æœ‰åˆä¹æƒ…ç†çš„ä¸šåŠ¡è¯­ä¹‰.")]),s._v(" "),t("p",[s._v("é‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦åˆ’åˆ†è¿™ä¹ˆå¤šç±»å‹å‘¢? "),t("mark",[s._v("æœ€ä¸»è¦çš„ä½œç”¨æ˜¯ ")]),s._v("â€‹"),t("mark",[t("strong",[s._v("åœ¨é‡‡é›†ä¾§åŸ‹ç‚¹çš„æ—¶å€™, SDK ä¼šæ ¹æ®æ•°æ®ç±»å‹åšä¸åŒçš„è®¡ç®—é€»è¾‘")])]),s._v(", æ¯”å¦‚ Histogram ç±»å‹, æ¯æ¬¡è¯·æ±‚è¿›æ¥çš„æ—¶å€™, ä»£ç é‡Œè°ƒç”¨ä¸€ä¸‹ SDK çš„ Observe æ–¹æ³•é€šçŸ¥ SDK, SDK å°±ä¼šè‡ªåŠ¨è®¡ç®—ç”Ÿæˆå¤šä¸ªæŒ‡æ ‡, æå‡åŸ‹ç‚¹ä¾¿åˆ©æ€§.")]),s._v(" "),t("h4",{attrs:{id:"æ—¶åºåº“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ—¶åºåº“"}},[s._v("#")]),s._v(" æ—¶åºåº“")]),s._v(" "),t("p",[s._v("äº†è§£äº†ç›‘æ§ç³»ç»Ÿä¸­æŒ‡æ ‡çš„é‡‡é›†å’Œä¼ è¾“ä¹‹å, æ¥ä¸‹æ¥å°±æ˜¯"),t("strong",[s._v("å¦‚ä½•å­˜å‚¨è¿™äº›æ•°æ®")]),s._v("äº†. ç›‘æ§æ•°æ®æ˜¯å‘¨æœŸæ€§é‡‡é›†çš„, æ¯æ¡æ•°æ®éƒ½å…³è”ä¸€ä¸ªæ—¶é—´æˆ³, æ‰€ä»¥"),t("strong",[s._v("éƒ½æ˜¯æ—¶åºæ•°æ®, ä½¿ç”¨æ—¶åºåº“å­˜å‚¨")]),s._v(", ä¸‹é¢å°±æ¥çœ‹çœ‹æ—¶åºåº“çš„æ¦‚å¿µ.")]),s._v(" "),t("p",[t("strong",[s._v("æ—¶åºåº“(Time series database)æ˜¯ä¸€ç§ä¸“é—¨å¤„ç†æ—¶åºæ•°æ®çš„æ•°æ®åº“")]),s._v(". å¸¸è§çš„æ•°æ®åº“ä¸­, MySQL æ˜¯å…³ç³»å‹æ•°æ®åº“, Redis æ˜¯ KV æ•°æ®åº“, MongoDB æ˜¯æ–‡æ¡£æ•°æ®åº“, è€Œ "),t("strong",[s._v("InfluxDB")]),s._v(", VictoriaMetrics, M3DB ç­‰éƒ½æ˜¯æ—¶åºåº“, Prometheus å…¶å®ä¹Ÿ"),t("strong",[s._v("å†…ç½®å®ç°äº†ä¸€ä¸ªæ—¶åºå­˜å‚¨æ¨¡å—")]),s._v(".")]),s._v(" "),t("p",[s._v("é‚£ä»€ä¹ˆæ˜¯ "),t("strong",[s._v("æ—¶åºæ•°æ®")]),s._v(" å‘¢? "),t("mark",[t("strong",[s._v("æ—¶åºæ•°æ®æœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ¯ä¸€æ¡æ•°æ®éƒ½å¸¦æœ‰æ—¶é—´æˆ³, é€šå¸¸æ˜¯å•è°ƒé¡ºåº, ä¸ä¼šä¹±åº, æµå¼å‘ç»™æœåŠ¡ç«¯, é€šå¸¸ä¸ä¼šä¿®æ”¹, æ¯”å¦‚æŒ‡æ ‡æ•°æ®å’Œæ—¥å¿—æ•°æ®, éƒ½æ˜¯å…¸å‹çš„æ—¶åºæ•°æ®")])]),s._v(". å­˜å‚¨é¢†åŸŸæ²¡æœ‰é“¶å¼¹, ä¸åŒçš„æ•°æ®åœºæ™¯ä¾§é‡ç‚¹ä¸åŒ, æ‰€ä»¥é’ˆå¯¹æ—¶åºæ•°æ®è¿™ä¸ªç‰¹å®šåœºæ™¯, äº§ç”Ÿäº†æ—¶åºåº“è¿™ä¸ªä¸“é—¨çš„ç»†åˆ†é¢†åŸŸ. åœ¨ DB-Engines ç½‘ç«™ä¸Š, æœ‰ä¸€ä¸ª "),t("a",{attrs:{href:"https://db-engines.com/en/ranking/time+series+dbms",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ—¶åºåº“çš„æµè¡Œåº¦æ’åº"),t("OutboundLink")],1),s._v(", å¯ä»¥äº†è§£åˆ°å½“ä¸‹å“ªäº›æ—¶åºåº“æ¯”è¾ƒæµè¡Œ.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦æ”¶æ•›"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦æ”¶æ•›"}},[s._v("#")]),s._v(" å‘Šè­¦æ”¶æ•›")]),s._v(" "),t("p",[s._v("ä¹‹å‰æåˆ°ç›‘æ§ç³»ç»Ÿæœ‰"),t("strong",[s._v("ä¸¤ä¸ªæ ¸å¿ƒèƒ½åŠ›, ä¸€ä¸ªæ˜¯ç›‘æ§, ä¸€ä¸ªæ˜¯å‘Šè­¦")]),s._v(". å‘Šè­¦éƒ¨åˆ†ä¹Ÿæœ‰ä¸€äº›å…³é”®æ¦‚å¿µ, æ¯”å¦‚å‘Šè­¦æ”¶æ•›, å‘Šè­¦é—­ç¯, ä¸‹é¢ä¸€èµ·æ¥çœ‹ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("åŸºç¡€è®¾æ–½å±‚é¢çš„æ•…éšœ, æ¯”å¦‚åŸºç¡€ç½‘ç»œé—®é¢˜, å¯èƒ½ä¼šç¬é—´äº§ç”Ÿå¾ˆå¤šå‘Šè­¦äº‹ä»¶, å½¢æˆ"),t("strong",[s._v("å‘Šè­¦é£æš´")]),s._v(", å¯¼è‡´æ¥æ”¶å‘Šè­¦çš„åª’ä»‹æ‹¥å¡, æ¯”å¦‚æ‰‹æœºä¸åœæ¥æ”¶åˆ°çŸ­ä¿¡å’Œç”µè¯å‘¼å…¥, æ²¡åŠæ³•ä½¿ç”¨. è¿™ä¸ªæ—¶å€™, å°±è¦æƒ³åŠæ³• "),t("strong",[s._v("è®©å‘Šè­¦äº‹ä»¶å˜å°‘")]),s._v(", ç”¨çš„æ–¹æ³•å°±æ˜¯"),t("strong",[s._v("å‘Šè­¦æ”¶æ•›")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("æœ€å…¸å‹çš„æ‰‹æ®µæ˜¯å‘Šè­¦èšåˆå‘é€, èšåˆå¯ä»¥é‡‡ç”¨ä¸åŒçš„ç»´åº¦, æ¯”å¦‚æ—¶é—´ç»´åº¦, ç­–ç•¥ç»´åº¦, ç›‘æ§å¯¹è±¡ç»´åº¦ç­‰ç­‰")]),s._v(". å¦‚æœ 100 å°æœºå™¨åŒæ—¶æŠ¥å¤±è”, å°±å¯ä»¥åˆå¹¶æˆä¸€æ¡å‘Šè­¦é€šçŸ¥, å‡å°‘æ‰“æ‰°.")]),s._v(" "),t("p",[t("strong",[s._v("å¦å¤–ä¸€ä¸ªå…¸å‹çš„æ”¶æ•›æ‰‹æ®µæ˜¯æŠŠå¤šä¸ªäº‹ä»¶èšåˆæˆå‘Šè­¦, æŠŠå¤šä¸ªå‘Šè­¦èšåˆæˆæ•…éšœ")]),s._v(". æ¯”å¦‚æŸä¸ªæœºå™¨çš„ CPU åˆ©ç”¨ç‡å‘Šè­¦, ç›‘æ§ç³»ç»Ÿå¯èƒ½æ¯åˆ†é’Ÿéƒ½ä¼šäº§ç”Ÿä¸€æ¡äº‹ä»¶, è¿™å¤šä¸ªäº‹ä»¶çš„å‘Šè­¦è§„åˆ™, ç›‘æ§å¯¹è±¡, ç›‘æ§æŒ‡æ ‡éƒ½ç›¸åŒ, æ‰€ä»¥å¯ä»¥æ”¶æ•›ä¸ºä¸€æ¡å‘Šè­¦. å‡è®¾æœ‰ 100 å°æœºå™¨éƒ½å‘Šè­¦äº†, å…¶ä¸­ 50 å°å±äºä¸šåŠ¡ A, å¦å¤– 50 å°å±äºä¸šåŠ¡ B, å¯ä»¥æŒ‰ç…§ä¸šåŠ¡æ¥åšèšåˆ, èšåˆä¹‹åäº§ç”Ÿä¸¤ä¸ªæ•…éšœ, è¿™æ ·å°±å¯ä»¥èµ·åˆ°å¾ˆå¥½çš„æ”¶æ•›æ•ˆæœ.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦é—­ç¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦é—­ç¯"}},[s._v("#")]),s._v(" å‘Šè­¦é—­ç¯")]),s._v(" "),t("p",[s._v("é—­ç¯è¿™ä¸ªè¯æ˜¯ä¸ªäº’è”ç½‘é»‘è¯, è¡¨ç¤ºæŸä¸ªäº‹æƒ…æœ‰å§‹æœ‰ç»ˆ, å‘Šè­¦æ€ä¹ˆåˆ¤æ–­æ˜¯å¦é—­ç¯äº†å‘¢? é—®é¢˜æœ€ç»ˆè¢«è§£å†³, å‘Šè­¦æ¢å¤, å°±ç®—æ˜¯é—­ç¯äº†. äº§å“æ€ä¹ˆè®¾è®¡æ‰èƒ½ä¿è¯å‘Šè­¦é—­ç¯å‘¢? é€šå¸¸æ¥è®², æ²¡äººå“åº”çš„å‘Šè­¦èƒ½å¤Ÿå‡çº§é€šçŸ¥, "),t("strong",[s._v("å‘Šè­¦ oncall äººå‘˜å¯ä»¥è®¤é¢†å‘Šè­¦")]),s._v(", åŸºæœ¬å°±æœ‰æ¯”è¾ƒå¥½çš„ä¿éšœäº†.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²ä¸»è¦è®²è§£ä¸€äº›ç›‘æ§é¢†åŸŸçš„å…³é”®æ¦‚å¿µ, è¿™äº›åŸºç¡€çŸ¥è¯†æ˜¯æ•´ä¸ªç›‘æ§ä½“ç³»çŸ¥è¯†è“å›¾çš„æ ¹åŸº, ä¸€å®šè¦æŒæ¡. ä¸‹é¢å¯¹è¿™ä¸€è®²çš„å†…å®¹åšä¸€ä¸ªç®€å•æ€»ç»“.")]),s._v(" "),t("ul",[t("li",[s._v("**ç›‘æ§: ** è¿™ä¸ªè¯åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¼šæœ‰ä¸åŒçš„è¯­ä¹‰, æœ‰çš„æ—¶å€™è¡¨ç¤ºæ•°æ®é‡‡é›†å’Œå¯è§†åŒ–, æœ‰çš„æ—¶å€™è¡¨ç¤ºæ•´ä¸ªç›‘æ§ç³»ç»Ÿ. ä¸è¿‡ä¸ç®¡æ€ä¹ˆç†è§£, é€šå¸¸éƒ½ä¸å½±å“äº¤æµ.")]),s._v(" "),t("li",[s._v("**ç›‘æ§æŒ‡æ ‡: ** è¿™ä¸ªæ¦‚å¿µå¾ˆå…³é”®, ä¸åŒçš„ç›‘æ§äº§å“æœ‰ä¸åŒçš„æè¿°æ–¹å¼, ä¸è¿‡éšç€ OpenMetrics æ ‡å‡†çš„å»ºç«‹, æŒ‡æ ‡æè¿°æ–¹å¼ä¼šæ¸æ¸è¶‹äºä¸€è‡´. é‡ç‚¹è¦äº†è§£ Prometheus çš„æŒ‡æ ‡æè¿°æ–¹å¼ "),t("strong",[s._v("metric + labels")]),s._v(", å½“ç„¶ metric ä¹Ÿå¯ä»¥çœ‹ä½œä¸€ä¸ªç‰¹æ®Šçš„ label. Influx æ ¼å¼ä¹Ÿå¾ˆé‡è¦, å»ºè®®æŒæ¡, å¦‚æœä½¿ç”¨ Telegraf ä½œä¸ºé‡‡é›†å™¨, å°±ç»•ä¸è¿‡å»è¿™ä¸ªæ ¼å¼.")]),s._v(" "),t("li",[t("strong",[s._v("æŒ‡æ ‡ç±»å‹")]),s._v(": é’ˆå¯¹æ—¶ä¸‹æµè¡Œçš„ Prometheus, è®²è§£äº† 4 ç§æŒ‡æ ‡ç±»å‹åŠæ¯ä¸ªç±»å‹çš„é€‚ç”¨åœºæ™¯, æœ€åæ˜ç¡®äº†"),t("strong",[s._v("æŒ‡æ ‡ç±»å‹æœ€æ ¸å¿ƒçš„ä½œç”¨: åœ¨é‡‡é›†ä¾§åŸ‹ç‚¹æ—¶, SDK ä¼šæ ¹æ®æ•°æ®ç±»å‹åšä¸åŒçš„è®¡ç®—é€»è¾‘")]),s._v(".")]),s._v(" "),t("li",[s._v("**æ—¶åºåº“: ** å­˜å‚¨æ—¶åºåºåˆ—æ•°æ®çš„æ•°æ®åº“, å®ƒå·²ç»æˆä¸ºäº†ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“ç»†åˆ†æ–¹å‘, è€Œä¸”éšç€ IoT çš„åœºæ™¯è¶Šæ¥è¶Šå¤š, ä»¥åŠå¾®æœåŠ¡çš„å‘å±•, æ—¶åºåº“è¿™ä¸ªè¯é¢˜ä¹Ÿè¶Šæ¥è¶Šæµè¡Œ.")]),s._v(" "),t("li",[s._v("**å‘Šè­¦æ”¶æ•›å’Œå‘Šè­¦é—­ç¯: ** å‘Šè­¦äº‹ä»¶å±‚é¢çš„è¯é¢˜æ˜¯æ‰€æœ‰ç›‘æ§ç³»ç»Ÿéƒ½éœ€è¦å¤„ç†çš„. å½“ç„¶ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªä¸“é—¨çš„äº§å“å’Œå¤šç§ç›‘æ§ç³»ç»Ÿå¯¹æ¥, ä¸“æ³¨å¤„ç†å‘Šè­¦äº‹ä»¶, å¸Œæœ›å›½å†…èƒ½æœ‰è¶…è¶Š  Bigpanda, Pagerduty çš„äº§å“å‡ºç°.")])]),s._v(" "),t("p",[s._v("æœ¬èŠ‚çš„é‡ç‚¹æ€»ç»“å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b2a5d68462fa2yy22615720ee10fe2f9-20230719203435-ikwa5na.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_3-æ¶æ„æ¦‚è¿°-ä¸€ä¸ªç›‘æ§ç³»ç»Ÿçš„å…¸å‹æ¶æ„æ˜¯ä»€ä¹ˆæ ·çš„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¶æ„æ¦‚è¿°-ä¸€ä¸ªç›‘æ§ç³»ç»Ÿçš„å…¸å‹æ¶æ„æ˜¯ä»€ä¹ˆæ ·çš„"}},[s._v("#")]),s._v(" 3.æ¶æ„æ¦‚è¿°-ä¸€ä¸ªç›‘æ§ç³»ç»Ÿçš„å…¸å‹æ¶æ„æ˜¯ä»€ä¹ˆæ ·çš„?")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²æ¥èŠèŠç›‘æ§ç³»ç»Ÿçš„å…¸å‹æ¶æ„, çœ‹çœ‹ç›‘æ§ç³»ç»Ÿç”±å“ªäº›æ¨¡å—ç»„æˆ, å„ä¸ªæ¨¡å—æ˜¯å¦‚ä½•ç›¸äº’ååŒçš„. ä¸šç•Œç›‘æ§ç³»ç»Ÿæ•°é‡è¾ƒå¤š, å¦‚æœä¸€ä¸Šæ¥å°±é™·å…¥æŸä¸ªå…·ä½“çš„ç³»ç»Ÿä¸­, å®¹æ˜“ä¸€å¶éšœç›®, ä¸è§æ³°å±±. è¿™é‡ŒæŠŠä¼—å¤šç›‘æ§ç³»ç»Ÿçš„æ¶æ„åšäº†ä¸€ä¸ªç»Ÿä¸€çš„æŠ½è±¡å’Œæ¦‚æ‹¬, åé¢å†çœ‹åˆ°ä»»ä½•ä¸€ä¸ªç›‘æ§ç³»ç»Ÿ, éƒ½èƒ½å¿«é€Ÿç†è§£äº†.")]),s._v(" "),t("h4",{attrs:{id:"å…¸å‹æ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¸å‹æ¶æ„"}},[s._v("#")]),s._v(" å…¸å‹æ¶æ„")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/9edcfef623ea9583134533c3b4c477f5-20230719203435-t4yuumu.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ç›‘æ§ç³»ç»Ÿçš„å…¸å‹æ¶æ„å›¾, ä»å·¦å¾€å³çœ‹, "),t("strong",[s._v("é‡‡é›†å™¨æ˜¯è´Ÿè´£é‡‡é›†ç›‘æ§æ•°æ®çš„, é‡‡é›†åˆ°æ•°æ®ä¹‹åä¼ è¾“ç»™æœåŠ¡ç«¯, é€šå¸¸æ˜¯ç›´æ¥å†™å…¥æ—¶åºåº“")]),s._v(". ç„¶åå°±æ˜¯å¯¹æ—¶åºåº“çš„æ•°æ®è¿›è¡Œåˆ†æå’Œå¯è§†åŒ–, åˆ†æéƒ¨åˆ†æœ€å…¸å‹çš„å°±æ˜¯å‘Šè­¦è§„åˆ™åˆ¤æ–­(å¤æ‚ä¸€äº›çš„ä¼šå¼•å…¥ç»Ÿè®¡ç®—æ³•å’Œæœºå™¨å­¦ä¹ çš„èƒ½åŠ›åšé¢„åˆ¤), å³å›¾ä¸Šçš„å‘Šè­¦å¼•æ“, å‘Šè­¦å¼•æ“äº§ç”Ÿå‘Šè­¦äº‹ä»¶ä¹‹åäº¤ç»™å‘Šè­¦å‘é€æ¨¡å—åšä¸åŒåª’ä»‹çš„é€šçŸ¥. å¯è§†åŒ–æ¯”è¾ƒç®€å•, å°±æ˜¯å›¾ä¸Šçš„æ•°æ®å±•ç¤º, é€šè¿‡å„ç§å›¾è¡¨æ¥åˆç†åœ°æ¸²æŸ“å„ç±»ç›‘æ§æ•°æ®, ä¾¿äºç”¨æˆ·æŸ¥çœ‹æ¯”è¾ƒ, æ—¥å¸¸å·¡æ£€.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å°±æ¥é€ä¸€åˆ†æä¸€ä¸‹æ¯ä¸ªæ¨¡å—çš„èŒèƒ½å’Œè®¾è®¡.")]),s._v(" "),t("h4",{attrs:{id:"é‡‡é›†å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡‡é›†å™¨"}},[s._v("#")]),s._v(" é‡‡é›†å™¨")]),s._v(" "),t("p",[t("strong",[s._v("é‡‡é›†å™¨è´Ÿè´£é‡‡é›†ç›‘æ§æ•°æ®")]),s._v(", æœ‰ä¸¤ç§å…¸å‹çš„éƒ¨ç½²æ–¹å¼, "),t("strong",[s._v("ä¸€ç§æ˜¯è·Ÿéšç›‘æ§å¯¹è±¡éƒ¨ç½²")]),s._v(", æ¯”å¦‚æ‰€æœ‰çš„æœºå™¨ä¸Šéƒ½éƒ¨ç½²ä¸€ä¸ªé‡‡é›†å™¨, é‡‡é›†æœºå™¨çš„ CPU, å†…å­˜, ç¡¬ç›˜, IO, ç½‘ç»œç›¸å…³çš„æŒ‡æ ‡; "),t("strong",[s._v("å¦ä¸€ç§æ˜¯è¿œç¨‹æ¢é’ˆå¼")]),s._v(", æ¯”å¦‚é€‰å–ä¸€ä¸ªä¸­å¿ƒæœºå™¨åšæ¢é’ˆ, åŒæ—¶æ¢æµ‹å¾ˆå¤šä¸ªæœºå™¨çš„ PING è¿é€šæ€§, æˆ–è€…è¿åˆ°å¾ˆå¤š MySQL å®ä¾‹ä¸Šå», æ‰§è¡Œå‘½ä»¤é‡‡é›†æ•°æ®.")]),s._v(" "),t("p",[s._v("ä¸šç•Œæœ‰å¤šæ¬¾å¼€æºé‡‡é›†å™¨å¯ä¾›é€‰æ‹©, ä¸‹é¢åšä¸€ä¸ªç®€è¦ç‚¹è¯„, ä¾¿äºä½ åšé€‰å‹.")]),s._v(" "),t("h5",{attrs:{id:"_1-telegraf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-telegraf"}},[s._v("#")]),s._v(" 1.Telegraf")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/influxdata/telegraf",target:"_blank",rel:"noopener noreferrer"}},[s._v("Telegraf"),t("OutboundLink")],1),s._v(" æ˜¯ InfluxData å…¬å¸çš„äº§å“, å¼€æºåè®®æ˜¯ MIT, éå¸¸å¼€æ”¾, æœ‰å¾ˆå¤šå¤–éƒ¨è´¡çŒ®è€…, ä¸»è¦é…åˆ InfluxDB ä½¿ç”¨. å½“ç„¶ Telegraf ä¹Ÿå¯ä»¥æŠŠç›‘æ§æ•°æ®æ¨ç»™ Prometheus, Graphite, Datadog, OpenTSDB ç­‰å¾ˆå¤šå…¶ä»–å­˜å‚¨, ä½†å’Œ InfluxDB çš„å¯¹æ¥æ˜¯æœ€ä¸æ»‘çš„.")]),s._v(" "),t("p",[s._v("InfluxDB æ”¯æŒå­˜å‚¨å­—ç¬¦ä¸², è€Œ Telegraf é‡‡é›†çš„å¾ˆå¤šæ•°æ®éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹, ä½†å¦‚æœæŠŠè¿™ç±»æ•°æ®æ¨ç»™ Prometheus ç”Ÿæ€çš„æ—¶åºåº“, æ¯”å¦‚ VictoriaMetrics, M3DB, Thanosç­‰, å®ƒå°±ä¼šæŠ¥é”™. å› ä¸ºè¿™äº›æ—¶åºåº“åªèƒ½å­˜å‚¨æ•°å€¼å‹æ—¶åºæ•°æ®. å¦å¤– Telegraf é‡‡é›†çš„å¾ˆå¤šæ•°æ®åœ¨æˆåŠŸå’Œå¤±è´¥çš„æ—¶å€™ä¼šæ‰“ä¸Šä¸åŒçš„æ ‡ç­¾, æ¯”å¦‚æˆåŠŸçš„æ—¶å€™ä¼šæ‰“ä¸Š "),t("code",[s._v("result=success")]),s._v("â€‹ æ ‡ç­¾, å¤±è´¥çš„æ—¶å€™æ‰“ä¸Š "),t("code",[s._v("result=failed")]),s._v("â€‹ æ ‡ç­¾.")]),s._v(" "),t("p",[s._v("åœ¨ InfluxDB ä¸­è¿™ç§æƒ…å†µæ˜¯å¯ä»¥çš„, ä½†æ˜¯åœ¨ Prometheus ç”Ÿæ€é‡Œ, æ ‡ç­¾å˜åŒ–å°±è¡¨ç¤ºä¸åŒçš„æŒ‡æ ‡, è¿™ç§æƒ…å†µå¯ä»¥ç§°ä¸º"),t("strong",[s._v("æ ‡ç­¾éç¨³æ€ç»“æ„")]),s._v(", ä½¿ç”¨ Prometheus ç”Ÿæ€çš„æ—¶åºåº“ä¸ Telegraf å¯¹æ¥æ—¶éœ€è¦ "),t("strong",[s._v("æŠŠè¿™ç±»æ ‡ç­¾ä¸¢å¼ƒæ‰")]),s._v(".")]),s._v(" "),t("p",[s._v("Telegraf æ˜¯æŒ‡æ ‡é¢†åŸŸçš„ All-In-One é‡‡é›†å™¨, æ”¯æŒå„ç§é‡‡é›†æ’ä»¶, åªéœ€è¦ä½¿ç”¨ Telegraf è¿™ä¸€ä¸ªé‡‡é›†å™¨, å°±èƒ½è§£å†³ç»å¤§éƒ¨åˆ†é‡‡é›†éœ€æ±‚.")]),s._v(" "),t("h5",{attrs:{id:"_2-exporters"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-exporters"}},[s._v("#")]),s._v(" 2.Exporters")]),s._v(" "),t("p",[t("strong",[s._v("Exporter æ˜¯ä¸“é—¨ç”¨äº Prometheus ç”Ÿæ€çš„ç»„ä»¶, Prometheus ç”Ÿæ€çš„é‡‡é›†å™¨æ¯”è¾ƒé›¶æ•£, æ¯ä¸ªé‡‡é›†ç›®æ ‡éƒ½æœ‰å¯¹åº”çš„ Exporter ç»„ä»¶, æ¯”å¦‚ MySQL æœ‰ mysqld_exporter, Redis æœ‰ redis_exporter, äº¤æ¢æœºæœ‰ snmp_exporter, JVM æœ‰ jmx_exporter.")])]),s._v(" "),t("p",[s._v("è¿™äº› Exporter çš„æ ¸å¿ƒé€»è¾‘, å°±æ˜¯"),t("mark",[t("strong",[s._v("å»è¿™äº›ç›‘æ§å¯¹è±¡é‡Œé‡‡é›†æ•°æ®, ç„¶åæš´éœ²ä¸º Prometheus åè®®çš„ç›‘æ§æ•°æ®")])]),s._v(". æ¯”å¦‚ mysqld_exporter, å°±æ˜¯è¿ä¸Š MySQL, æ‰§è¡Œä¸€äº›ç±»ä¼¼äº "),t("code",[s._v("show global status")]),s._v("â€‹, "),t("code",[s._v("show global variables")]),s._v("â€‹, "),t("code",[s._v("show slave status")]),s._v("â€‹ è¿™æ ·çš„å‘½ä»¤, æ‹¿åˆ°è¾“å‡º, å†è½¬æ¢ä¸º Prometheus åè®®çš„æ•°æ®; è¿˜æœ‰ redis_exporter, å®ƒæ˜¯è¿ä¸Š Redis, æ‰§è¡Œä¸€äº›ç±»ä¼¼äº "),t("code",[s._v("info")]),s._v("â€‹ çš„å‘½ä»¤, æ‹¿åˆ°è¾“å‡º, è½¬æ¢ä¸º Prometheus åè®®çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("éšç€ Prometheus çš„å½±å“è¶Šæ¥è¶Šå¤§, å¾ˆå¤šä¸­é—´ä»¶éƒ½å†…ç½®æ”¯æŒäº† Prometheus, ç›´æ¥é€šè¿‡è‡ªèº«çš„ "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£æš´éœ²ç›‘æ§æ•°æ®, ä¸ç”¨å†å•ç‹¬ä¼´ç”Ÿ Exporter, ç®€åŒ–äº†æ¶æ„. æ¯”å¦‚ Kubernetes ä¸­çš„å„ç±»ç»„ä»¶: kube-apiserver, kube-proxy, kube-scheduler ç­‰ç­‰, æ¯”å¦‚ etcd, è¿˜æœ‰æ–°ç‰ˆæœ¬çš„ ZooKeeper, RabbitMQ, HAProxy, éƒ½"),t("strong",[s._v("å¯ä»¥ç›´æ¥æš´éœ² Prometheus åè®®çš„ç›‘æ§æ•°æ®, æ— éœ€ Exporter")]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸ç®¡æ˜¯ Exporter è¿˜æ˜¯ç›´æ¥å†…ç½®æ”¯æŒ Prometheus åè®®çš„å„ç±»ç»„ä»¶, éƒ½æä¾› HTTP æ¥å£(é€šå¸¸æ˜¯ "),t("code",[s._v("/metrics")]),s._v("â€‹)æ¥æš´éœ²ç›‘æ§æ•°æ®, "),t("strong",[s._v("è®©ç›‘æ§ç³»ç»Ÿæ¥æ‹‰, è¿™å«åš PULL æ¨¡å‹")]),s._v(". è€Œåƒ Telegraf é‚£ç§åˆ™æ˜¯ PUSH æ¨¡å‹, é‡‡é›†äº†æ•°æ®ä¹‹åè°ƒç”¨æœåŠ¡ç«¯çš„æ¥å£æ¥æ¨é€æ•°æ®. å…³äºPULL æ¨¡å‹å’Œ PUSH æ¨¡å‹è¿˜ä¼šå†è¯¦ç»†åœ°è®²ä¸€ä¸‹, è¿™é‡Œå…ˆæœ‰ä¸ªå°è±¡å³å¯.")]),s._v(" "),t("p",[s._v("Telegraf ä»¥åŠåé¢å³å°†è®²åˆ°çš„ Grafana-Agent, ä¹Ÿå¯ä»¥ç›´æ¥æŠ“å– Prometheus åè®®çš„ç›‘æ§æ•°æ®, ç„¶åç»Ÿä¸€æ¨ç»™æ—¶åºåº“, è¿™ç§æ¶æ„æ¯”è¾ƒæ¸…æ™°, æ€»ä¹‹è·Ÿæ•°æ®é‡‡é›†ç›¸å…³çš„éƒ½ç”±é‡‡é›†å™¨æ¥è´Ÿè´£.")]),s._v(" "),t("h5",{attrs:{id:"_3-grafana-agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-grafana-agent"}},[s._v("#")]),s._v(" 3.Grafana-Agent")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/grafana/agent",target:"_blank",rel:"noopener noreferrer"}},[s._v("Grafana-Agent"),t("OutboundLink")],1),s._v(" æ˜¯ Grafana å…¬å¸æ¨å‡ºçš„ä¸€æ¬¾ All-In-One é‡‡é›†å™¨, ä¸ä½†å¯ä»¥ "),t("strong",[s._v("é‡‡é›†æŒ‡æ ‡æ•°æ®")]),s._v(", ä¹Ÿå¯ä»¥ "),t("strong",[s._v("é‡‡é›†æ—¥å¿—æ•°æ®å’Œé“¾è·¯æ•°æ®")]),s._v(". å¼€æºåè®®æ˜¯ Apache 2.0, æ¯”è¾ƒå¼€æ”¾.")]),s._v(" "),t("p",[s._v("Grafana-Agent ä½œä¸ºåæ¥è€…, æ˜¯å¦‚ä½•å¿«é€Ÿé›†æˆå„ç±»é‡‡é›†èƒ½åŠ›çš„å‘¢? Grafana-Agent å†™äº†ä¸ªæ¡†æ¶, æ–¹ä¾¿å¯¼å…¥å„ç±» Exporter, æŠŠå„ä¸ª Exporter å½“åš "),t("strong",[s._v("Lib")]),s._v(" ä½¿ç”¨, å¸¸è§çš„ Node-Exporter, Kafka-Exporter, Elasticsearch-Exporter, Mysqld-Exporter ç­‰, éƒ½å·²ç»å®Œæˆäº†é›†æˆ. è¿™æ ·å°±ä¸ç”¨åˆ°å¤„å»æ‰¾å„ç±» Exporter, åªä½¿ç”¨ Grafana-Agent è¿™ä¸€ä¸ªäºŒè¿›åˆ¶å°±å¯ä»¥æå®šä¼—å¤šé‡‡é›†èƒ½åŠ›äº†.")]),s._v(" "),t("p",[t("strong",[s._v("Grafana-Agent è¿™ç§é›†æˆ Exporter çš„æ–¹å¼, å®Œå…¨å…¼å®¹ Exporter çš„æŒ‡æ ‡ä½“ç³»")]),s._v(", æ¯”å¦‚ Node-Exporter. å¦‚æœåœºæ™¯ä¸æ–¹ä¾¿ä½¿ç”¨ PULL çš„æ–¹å¼æ¥æŠ“å–æ•°æ®, å°±å¯ä»¥æ¢æˆ Grafana-Agent, é‡‡ç”¨ "),t("strong",[s._v("PUSH çš„æ–¹å¼æ¨é€ç›‘æ§æ•°æ®")]),s._v(", å®Œå…¨å…¼å®¹ Node-Exporter çš„æŒ‡æ ‡. å½“ç„¶, Exporter ç§ç±»ç¹å¤š, Grafana-Agent ä¸å¯èƒ½å…¨éƒ¨é›†æˆ, å¯¹äºé»˜è®¤æ²¡æœ‰é›†æˆè¿›å»çš„ Exporter, Grafana-Agent ä¹Ÿæ”¯æŒç”¨ PULL çš„æ–¹å¼å»æŠ“å–å…¶ä»– Exporter çš„æ•°æ®, ç„¶åå†é€šè¿‡ Remote Write çš„æ–¹å¼, å°†é‡‡é›†åˆ°çš„æ•°æ®è½¬å‘ç»™æœåŠ¡ç«¯.")]),s._v(" "),t("p",[s._v("å¯¹äºæ—¥å¿—é‡‡é›†, Grafana-Agent é›†æˆäº† Loki ç”Ÿæ€çš„æ—¥å¿—é‡‡é›†å™¨ Promtail. å¯¹äºé“¾è·¯æ•°æ®, Grafana-Agent é›†æˆäº† OpenTelemetry Collector. ç›¸å½“äºæŠŠå¯è§‚æµ‹æ€§ä¸‰å¤§æ”¯æŸ±çš„é‡‡é›†èƒ½åŠ›éƒ½å»ºå…¨äº†. ä¸€ä¸ª Agent æå®šæ‰€æœ‰é‡‡é›†èƒ½åŠ›æœ‰ä¸ªæ˜¾è€Œæ˜“è§çš„å¥½å¤„, å°±æ˜¯ä¾¿äºé™„åŠ ä¸€äº›é€šç”¨æ ‡ç­¾, æ¯”å¦‚æŸä¸ªæœºå™¨çš„æ‰€æœ‰å¯è§‚æµ‹æ€§æ•°æ®, éƒ½ç»Ÿä¸€æ‰“ä¸Šæœºå™¨åçš„æ ‡ç­¾, åé¢å°±å¯ä»¥ä½¿ç”¨è¿™ç§ç»Ÿä¸€çš„æ ‡ç­¾åšå…³è”æŸ¥è¯¢, è¿™ä¸ªå…³è”èƒ½åŠ›æ˜¯è¿™ç±» All-In-One é‡‡é›†å™¨å¸¦æ¥çš„æœ€å¤§å¥½å¤„.")]),s._v(" "),t("h5",{attrs:{id:"_4-categraf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-categraf"}},[s._v("#")]),s._v(" 4.Categraf")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf",target:"_blank",rel:"noopener noreferrer"}},[s._v("Categraf"),t("OutboundLink")],1),s._v(" æ˜¯å¿«çŒ«å›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾ç›‘æ§é‡‡é›†å™¨, å¼€æºåè®®æ˜¯ MIT, éå¸¸å¼€æ”¾.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šæƒ³, å·²ç»æœ‰è¿™ä¹ˆå¤šé‡‡é›†å™¨äº†, ä¸ºä½•è¿˜è¦å†é€ ä¸€ä¸ªè½®å­å‘¢? Categraf çš„å®šä½ç±»ä¼¼ Grafana-Agent, æ”¯æŒ metrics, logs, traces çš„é‡‡é›†, æœªæ¥ä¹Ÿä¼šæ”¯æŒäº‹ä»¶çš„é‡‡é›†, å¯¹äºåŒç±»ç›‘æ§ç›®æ ‡çš„å¤šä¸ªå®ä¾‹çš„åœºæ™¯, åˆå¸Œæœ›åšå‡º Telegraf çš„ä½“éªŒ. åŒæ—¶å¯¹äºæ‰€æœ‰çš„é‡‡é›†æ’ä»¶, ä¸ä½†ä¼šæä¾›é‡‡é›†èƒ½åŠ›, ä¹Ÿä¼šæä¾›ç›‘æ§å¤§ç›˜, å‘Šè­¦è§„åˆ™, è®©ç¤¾åŒºå¼€ç®±å³ç”¨.")]),s._v(" "),t("p",[s._v("Categraf åé‡ Prometheus ç”Ÿæ€, "),t("strong",[s._v("æ ‡ç­¾æ˜¯ç¨³æ€ç»“æ„, åªé‡‡é›†æ•°å€¼å‹æ—¶åºæ•°æ®")]),s._v(", é€šè¿‡ Remote Write æ–¹å¼æ¨é€æ•°æ®ç»™åç«¯å­˜å‚¨, æ‰€æœ‰æ”¯æŒ Remote Write åè®®çš„æ—¶åºåº“éƒ½å¯ä»¥å¯¹æ¥, æ¯”å¦‚ Prometheus, VictoriaMetrics, M3DB, Thanos ç­‰ç­‰.")]),s._v(" "),t("p",[s._v("å¯¹äºä¹ æƒ¯ä½¿ç”¨ Prometheus çš„ç”¨æˆ·, Categraf ä¹Ÿæ”¯æŒç›´æ¥è¯»å– prometheus.yml ä¸­çš„ scrape é…ç½®, å¯¹æ¥å„ç±»æœåŠ¡å‘ç°æœºåˆ¶, å®ç°ä¸Šå°±æ˜¯æŠŠ Prometheus agent mode çš„ä»£ç å¼•å…¥è¿›æ¥äº†.")]),s._v(" "),t("p",[s._v("æœºå™¨å±‚é¢çš„ç›‘æ§, æ¨è Telegraf å’Œ Categraf, å†…ç½®äº†ç›‘æ§è„šæœ¬, è¿›ç¨‹/ç«¯å£ç›‘æ§, CPU, å†…å­˜ä¹‹ç±»çš„ä¹Ÿéƒ½å¾ˆå®Œå¤‡; æ¢é’ˆç±»çš„ç›‘æ§è‡ªç”±åº¦å°±å¾ˆé«˜äº†, ä¸åŒçš„ä¸­é—´ä»¶, æ•°æ®åº“ç›‘æ§, ä¹ æƒ¯ç”¨å“ªä¸ªé‡‡é›†å™¨å°±å¯ä»¥ç”¨å“ªä¸ª.")]),s._v(" "),t("p",[s._v("é’ˆå¯¹ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„å‡ ç§å¸¸è§çš„é‡‡é›†å™¨, åšäº†ä¸€ä¸ªè¡¨æ ¼ä¾›é€‰å‹å‚è€ƒ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5b1f1aa6b8276c07bd0e2d9bcbbcae24-20230719203435-rt5ejht.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[t("strong",[s._v("é‡‡é›†å™¨é‡‡é›†åˆ°æ•°æ®ä¹‹å, è¦æ¨ç»™æœåŠ¡ç«¯")]),s._v(". é€šå¸¸æœ‰ä¸¤ç§åšæ³•, "),t("strong",[s._v("ä¸€ä¸ªæ˜¯ç›´æ¥æ¨ç»™æ—¶åºåº“, ä¸€ä¸ªæ˜¯å…ˆæ¨ç»™ Kafka, å†ç»ç”± Kafka å†™åˆ°æ—¶åºåº“")]),s._v(". å½“ç„¶, ä¸€äº›å¤æ‚çš„æƒ…å†µ, å¯èƒ½ä¼šåœ¨ Kafka å’Œæ—¶åºåº“ä¹‹é—´åŠ ä¸€ä¸ª"),t("strong",[s._v("æµå¼è®¡ç®—å¼•æ“")]),s._v(", æ¯”å¦‚ Flink, åšä¸€äº›"),t("strong",[s._v("é¢„èšåˆè®¡ç®—")]),s._v(". ä½†ç»å¤§éƒ¨åˆ†å…¬å¸éƒ½ç”¨ä¸åˆ°, æ‰€ä»¥è¿™é‡Œå…ˆä¸ç®¡å¤æ‚æµå¼è®¡ç®—çš„é—®é¢˜, é‡ç‚¹æ¥çœ‹ä¸€ä¸‹æ—¶åºåº“.")]),s._v(" "),t("h4",{attrs:{id:"æ—¶åºåº“-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ—¶åºåº“-2"}},[s._v("#")]),s._v(" æ—¶åºåº“")]),s._v(" "),t("p",[s._v("ç›‘æ§ç³»ç»Ÿçš„æ¶æ„ä¸­, æœ€æ ¸å¿ƒçš„å°±æ˜¯"),t("strong",[s._v("æ—¶åºåº“")]),s._v(". è€ä¸€äº›çš„ç›‘æ§ç³»ç»Ÿç›´æ¥å¤ç”¨å…³ç³»å‹æ•°æ®åº“, æ¯”å¦‚ Zabbix ç›´æ¥ä½¿ç”¨ MySQL å­˜å‚¨æ—¶åºæ•°æ®, MySQL æ“…é•¿å¤„ç†äº‹åŠ¡åœºæ™¯, æ²¡æœ‰é’ˆå¯¹æ—¶åºåœºæ™¯åšä¼˜åŒ–, å®¹é‡ä¸Šæœ‰æ˜æ˜¾çš„ç“¶é¢ˆ. Open-Falcon æ˜¯ç”¨ RRDtool æ”’äº†ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç»„ä»¶ Falcon-Graph, ä½†æ˜¯ RRDTool æœ¬èº«çš„è®¾è®¡å°±æœ‰é—®é¢˜, æ•£æ–‡ä»¶å¾ˆå¤š, å¯¹ç¡¬ç›˜çš„ IO è¦æ±‚å¤ªé«˜, æ€§èƒ½è¾ƒå·®. Falcon-Graph æ˜¯åˆ†å¸ƒå¼çš„, å¯ä»¥é€šè¿‡å †æœºå™¨æ¥è§£å†³å¤§è§„æ¨¡çš„é—®é¢˜, ä½†æ˜¾ç„¶ä¸æ˜¯æœ€ä¼˜è§£.")]),s._v(" "),t("p",[s._v("åæ¥, å„ç§ä¸“é—¨è§£å†³æ—¶åºå­˜å‚¨é—®é¢˜çš„æ•°æ®åº“æ¨ªç©ºå‡ºä¸–, æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„æœ‰: InfluxDB, TDEngine, M3DB, VictoriaMetrics, TimescaleDBç­‰. ä¸‹é¢é€ä¸€ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"_1-influxdb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-influxdb"}},[s._v("#")]),s._v(" 1.InfluxDB")]),s._v(" "),t("p",[s._v("InfluxDB æ¥è‡ª InfluxData, æ˜¯é’ˆå¯¹æ—¶åºå­˜å‚¨åœºæ™¯ä¸“é—¨è®¾è®¡äº†å­˜å‚¨å¼•æ“, æ•°æ®ç»“æ„, å­˜å–æ¥å£, å›½å†…ä½¿ç”¨èŒƒå›´æ¯”è¾ƒå¹¿æ³›, è€Œä¸” InfluxDB å¯ä»¥å’Œ Grafana, Telegraf ç­‰è‰¯å¥½æ•´åˆ, ç”Ÿæ€æ˜¯éå¸¸å®Œå¤‡çš„. ä¸è¿‡ InfluxDB å¼€æºç‰ˆæœ¬æ˜¯å•æœºçš„, æ²¡æœ‰å¼€æºé›†ç¾¤ç‰ˆæœ¬. æ¯•ç«Ÿæ˜¯å•†ä¸šå…¬å¸, éœ€è¦èµšé’±å®ç°è‰¯æ€§å‘å±•, è¿™ä¸ªç‚¹æ˜¯éœ€è¦æ–Ÿé…Œçš„.")]),s._v(" "),t("h5",{attrs:{id:"_2-tdengine"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-tdengine"}},[s._v("#")]),s._v(" 2.TDEngine")]),s._v(" "),t("p",[s._v("TDEngine å§‘ä¸”å¯ä»¥çœ‹åšæ˜¯å›½äº§ç‰ˆ InfluxDB, GitHub çš„ Star æ•°ä¸Šä¸‡, é’ˆå¯¹"),t("strong",[s._v("ç‰©è”ç½‘è®¾å¤‡")]),s._v("çš„åœºæ™¯åšäº†ä¼˜åŒ–, æ€§èƒ½å¾ˆå¥½, ä¹Ÿå¯ä»¥å’Œ Grafana, Telegraf æ•´åˆ, å¯¹äºåè®¾å¤‡ç›‘æ§çš„åœºæ™¯, TDEngine æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©.")]),s._v(" "),t("p",[s._v("TDEngine çš„é›†ç¾¤ç‰ˆæ˜¯å¼€æºçš„, ç›¸æ¯” InfluxDB, TDEngine è¿™ç‚¹å¾ˆæœ‰å¸å¼•åŠ›. TDEngine ä¸æ­¢æ˜¯åšæ—¶åºæ•°æ®å­˜å‚¨, è¿˜å†…ç½®æ”¯æŒäº†æµå¼è®¡ç®—, å¯ä»¥è®©ç”¨æˆ·å°‘éƒ¨ç½²ä¸€äº›ç»„ä»¶.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/13331964742c055805cd4b1d83547ddb-20230719203435-ne4oisw.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("é€šè¿‡ TDEngine çš„å®˜ç½‘å¯ä»¥å¾—çŸ¥, TDEngine æ˜¯æ”¯æŒ Prometheus çš„ remote_read å’Œ remote_write æ¥å£çš„. ä¸è¿‡ä¸æ”¯æŒ Prometheus çš„ Query ç±»æ¥å£, è¿™ç‚¹éœ€è¦æ³¨æ„.")]),s._v(" "),t("p",[s._v("æ³¨: Thanos, M3DB, VictoriaMetrics éƒ½ç›´æ¥å…¼å®¹ Prometheus çš„ Query ç±»æ¥å£, ä¸Šå±‚ç¨‹åºå¯ä»¥æŠŠè¿™äº›æ—¶åºåº“å½“åš Prometheus æ¥ä½¿ç”¨.")]),s._v(" "),t("h5",{attrs:{id:"_3-m3db"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-m3db"}},[s._v("#")]),s._v(" 3.M3DB")]),s._v(" "),t("p",[s._v("M3DB æ˜¯æ¥è‡ª Uber çš„æ—¶åºæ•°æ®åº“, M3 å£°ç§°åœ¨ Uber æŠ—ä½äº† 66 äº¿ç›‘æ§æŒ‡æ ‡, è¿™ä¸ªé‡éå¸¸åºå¤§. è€Œä¸” M3DB æ˜¯å…¨å¼€æºçš„, åŒ…æ‹¬é›†ç¾¤ç‰ˆ, ä¸è¿‡æ¶æ„åŸç†æ¯”è¾ƒå¤æ‚, CPU å’Œå†…å­˜å ç”¨è¾ƒé«˜, åœ¨å›½å†…æ²¡æœ‰å¤§è§„æ¨¡æ¨å¹¿èµ·æ¥. M3DB çš„æ¶æ„ä»£ç ä¸­åŒ…å«å¾ˆå¤šåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„çŸ¥è¯†, æ˜¯ä¸ªå¯ä»¥æ‹¿æ¥å­¦ä¹ çš„å¥½é¡¹ç›®.")]),s._v(" "),t("h5",{attrs:{id:"_4-victoriametrics"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-victoriametrics"}},[s._v("#")]),s._v(" 4.VictoriaMetrics")]),s._v(" "),t("p",[s._v("VictoriaMetrics, ç®€ç§° VM, æ¶æ„éå¸¸ç®€å•æ¸…æ™°, é‡‡ç”¨ merge read æ–¹å¼, é¿å…äº†æ•°æ®è¿ç§»é—®é¢˜, æä¸€æ‰¹äº‘ä¸Šè™šæ‹Ÿæœº, æŒ‚ä¸Šäº‘ç¡¬ç›˜, éƒ¨ç½² VM é›†ç¾¤, ä½¿ç”¨å•å‰¯æœ¬, æ˜¯éå¸¸è½»é‡å¯é çš„é›†ç¾¤æ–¹å¼. å¯ä»¥çœ‹ä¸€ä¸‹ VM æ¶æ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/85yy905fa9f7b5d8c16f6019053cbf3e-20230719203435-mkzc8l5.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("VM å®ç°äº† Prometheus çš„ Query ç±»æ¥å£, å³ "),t("code",[s._v("/api/v1/query")]),s._v("â€‹, "),t("code",[s._v("/api/v1/query_range")]),s._v("â€‹, "),t("code",[s._v("/api/v1/label/<label-key>/values")]),s._v("â€‹ ç›¸å…³çš„æ¥å£, æ˜¯ Prometheus ä¸€ä¸ªéå¸¸å¥½çš„ Backend, ç”šè‡³å¯ä»¥è¯´æ˜¯ Prometheus çš„ä¸€ä¸ªæ›¿ä»£å“. å…¶å® VM çš„åˆè¡·å°±æ˜¯æƒ³è¦æ›¿æ¢æ‰ Prometheus çš„.")]),s._v(" "),t("h5",{attrs:{id:"_5-timescaledb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-timescaledb"}},[s._v("#")]),s._v(" 5.TimescaleDB")]),s._v(" "),t("p",[s._v("TimescaleDB æ˜¯ timescale.inc å¼€å‘çš„ä¸€æ¬¾æ—¶åºæ•°æ®åº“, ä½œä¸ºä¸€ä¸ª PostgreSQL çš„æ‰©å±•æä¾›æœåŠ¡.")]),s._v(" "),t("p",[s._v("å®ƒæ˜¯åŸºäº PostgreSQL è®¾è®¡è€Œæˆçš„, è€Œ PostgreSQL ç”Ÿæ€å››åå¹´çš„ç§¯ç´¯, å°±æ˜¯å·¨äººçš„è‚©è†€, å¾ˆå¤šåº•å±‚çš„å·¥ä½œ PostgreSQL å…¶å®å·²ç»å®Œæˆäº†. å°±æ‹¿ä¿éšœæ•°æ®å®‰å…¨æ¥è¯´å§, å› ä¸ºç¨‹åºå¯èƒ½éšæ—¶ä¼šå´©æºƒ, æœåŠ¡å™¨å¯èƒ½ä¼šé‡åˆ°ç”µæºé—®é¢˜æˆ–ç¡¬ä»¶æ•…éšœ, ç£ç›˜å¯èƒ½æŸåæˆ–è€…å¤¯ä½, è¿™äº›æç«¯åœºæ™¯éƒ½éœ€è¦å®Œå–„çš„è§£å†³æ–¹æ¡ˆæ¥å¤„ç†. PostgreSQL ç¤¾åŒºå·²ç»æœ‰äº†ç°æˆçš„é«˜å¯ç”¨ç‰¹æ€§, åŒ…æ‹¬å®Œå–„çš„æµå¤åˆ¶å’Œåªè¯»å‰¯æœ¬, æ•°æ®åº“å¿«ç…§åŠŸèƒ½, å¢é‡å¤‡ä»½å’Œä»»æ„æ—¶é—´ç‚¹æ¢å¤, wal æ”¯æŒ, å¿«é€Ÿå¯¼å…¥å¯¼å‡ºå·¥å…·ç­‰. è€Œå…¶ä»–æ—¶åºåº“, è¿™äº›é—®é¢˜éƒ½è¦ä»å¤´è§£å†³.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯ä¼ ç»Ÿæ•°æ®åº“æ˜¯åŸºäº btree åšç´¢å¼•çš„, æ•°æ®é‡åˆ°ç™¾äº¿æˆ–è€…åƒäº¿è¡Œ, btree ä¼šå¤§åˆ°å†…å­˜éƒ½å­˜ä¸ä¸‹, äº§ç”Ÿé¢‘ç¹çš„ç£ç›˜äº¤æ¢, æ•°æ®åº“æ€§èƒ½ä¼šæ˜¾è‘—ä¸‹é™. å¦å¤–æ—¶åºæ•°æ®çš„å†™å…¥é‡ç‰¹åˆ«å¤§, PostgreSQL é¢å¯¹å¤§é‡çš„æ’å…¥, æ€§èƒ½ä¹Ÿä¸ç†æƒ³.")]),s._v(" "),t("p",[s._v("ä¸Šé¢ç½—åˆ—äº†ä¸šç•Œå¸¸ç”¨çš„å‡ ä¸ªæ—¶åºåº“, å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªè¡Œé€‰æ‹©. æ•°æ®ä¸€æ—¦è¿›å…¥æ—¶åºåº“, åé¢å°±å¯ä»¥å¯¹æ¥å‘Šè­¦å¼•æ“å’Œå¯è§†åŒ–äº†, è¿™ä¸¤éƒ¨åˆ†åˆ†åˆ«è§£å†³äº†ä»€ä¹ˆé—®é¢˜, æ¶æ„åŸç†å¦‚ä½•? ä¸€èµ·çœ‹ä¸€ä¸‹.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦å¼•æ“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦å¼•æ“"}},[s._v("#")]),s._v(" å‘Šè­¦å¼•æ“")]),s._v(" "),t("p",[s._v("å‘Šè­¦å¼•æ“çš„æ ¸å¿ƒèŒè´£å°±æ˜¯ "),t("mark",[t("strong",[s._v("å¤„ç†å‘Šè­¦è§„åˆ™, ç”Ÿæˆå‘Šè­¦äº‹ä»¶")])]),s._v(". é€šå¸¸æ¥è®², ç”¨æˆ·ä¼šé…ç½®æ•°ç™¾ç”šè‡³æ•°åƒæ¡å‘Šè­¦è§„åˆ™, ä¸€äº›è¶…å¤§å‹çš„å…¬å¸å¯èƒ½è¦é…ç½®æ•°ä¸‡æ¡å‘Šè­¦è§„åˆ™. æ¯ä¸ªè§„åˆ™é‡Œå«æœ‰æ•°æ®è¿‡æ»¤æ¡ä»¶, é˜ˆå€¼, æ‰§è¡Œé¢‘ç‡ç­‰, æœ‰ä¸€äº›é…ç½®ä¸°å¯Œçš„ç›‘æ§ç³»ç»Ÿ, è¿˜æ”¯æŒé…ç½®è§„åˆ™ç”Ÿæ•ˆæ—¶æ®µ, æŒç»­æ—¶é•¿, ç•™è§‚æ—¶é•¿ç­‰.")]),s._v(" "),t("p",[s._v("**å‘Šè­¦å¼•æ“é€šå¸¸æœ‰ä¸¤ç§æ¶æ„, ä¸€ç§æ˜¯æ•°æ®è§¦å‘å¼, ä¸€ç§æ˜¯å‘¨æœŸè½®è¯¢å¼. **")]),s._v(" "),t("p",[t("strong",[s._v("æ•°æ®è§¦å‘å¼")]),s._v(", æ˜¯æŒ‡æœåŠ¡ç«¯æ¥æ”¶åˆ°ç›‘æ§æ•°æ®ä¹‹å, é™¤äº†å­˜å‚¨åˆ°æ—¶åºåº“, è¿˜ä¼šè½¬å‘ä¸€ä»½æ•°æ®ç»™å‘Šè­¦å¼•æ“, å‘Šè­¦å¼•æ“æ¯æ”¶åˆ°ä¸€æ¡ç›‘æ§æ•°æ®, å°±è¦åˆ¤æ–­æ˜¯å¦å…³è”äº†å‘Šè­¦è§„åˆ™, åšå‘Šè­¦åˆ¤æ–­. å› ä¸ºç›‘æ§æ•°æ®é‡æ¯”è¾ƒå¤§, å‘Šè­¦è§„åˆ™çš„é‡ä¹Ÿå¯èƒ½æ¯”è¾ƒå¤§, æ‰€ä»¥å‘Šè­¦å¼•æ“æ˜¯ä¼šåšåˆ†ç‰‡éƒ¨ç½²çš„, å³éƒ¨ç½²å¤šä¸ªå®ä¾‹. è¿™æ ·çš„æ¶æ„, å³æ—¶æ€§å¾ˆå¥½, ä½†æ˜¯æƒ³è¦åšæŒ‡æ ‡å…³è”è®¡ç®—å°±å¾ˆéº»çƒ¦, å› ä¸ºä¸åŒçš„æŒ‡æ ‡å“ˆå¸Œåå¯èƒ½ä¼šè½åˆ°ä¸åŒçš„å‘Šè­¦å¼•æ“å®ä¾‹.")]),s._v(" "),t("p",[s._v("æ³¨: åˆ†ç‰‡çš„å¸¸è§åšæ³•æ˜¯æ ¹æ®æŒ‡æ ‡æ ‡è¯†åšå“ˆå¸Œ.")]),s._v(" "),t("p",[t("strong",[s._v("å‘¨æœŸè½®è¯¢å¼, æ¶æ„ç®€å•, é€šå¸¸æ˜¯ä¸€ä¸ªè§„åˆ™ä¸€ä¸ªåç¨‹, æŒ‰ç…§ç”¨æˆ·é…ç½®çš„æ‰§è¡Œé¢‘ç‡, å‘¨æœŸæ€§æŸ¥è¯¢åˆ¤æ–­å³å¯, å› ä¸ºæ˜¯ä¸»åŠ¨æŸ¥è¯¢çš„, åšæŒ‡æ ‡å…³è”è®¡ç®—å°±ä¼šå¾ˆå®¹æ˜“")]),s._v(". åƒ Prometheus, Nightingale, Grafana ç­‰, éƒ½æ˜¯è¿™æ ·çš„æ¶æ„.")]),s._v(" "),t("p",[s._v("ç”Ÿæˆäº‹ä»¶ä¹‹å, é€šå¸¸æ˜¯äº¤ç»™ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—æ¥åšå‘Šè­¦å‘é€, è¿™ä¸ªæ¨¡å—è´Ÿè´£äº‹ä»¶èšåˆ, æ”¶æ•›, æ ¹æ®ä¸åŒçš„æ¡ä»¶å‘é€ç»™ä¸åŒçš„æ¥æ”¶è€…å’Œä¸åŒçš„é€šçŸ¥åª’ä»‹. å‘Šè­¦äº‹ä»¶çš„å¤„ç†, æ˜¯ä¸€ä¸ªéå¸¸é€šç”¨çš„éœ€æ±‚, è€Œä¸”éå¸¸é›¶ç¢, å¤æ‚, æ¯ä¸ªç›‘æ§ç³»ç»Ÿéƒ½å»å®ç°ä¸€å¥—, é€šå¸¸ä¸ä¼šåšå¾—å¾ˆå®Œå¤‡. äºæ˜¯å°±æœ‰äº†ä¸“é—¨å¤„ç†è¿™ç±»éœ€æ±‚çš„äº§å“, æœ€å…¸å‹çš„æ¯”å¦‚ PagerDuty, å¯ä»¥æ¥æ”¶å„ç±»äº‹ä»¶æºçš„äº‹ä»¶, ç”¨æˆ·å°±åªéœ€è¦åœ¨ PagerDuty åš OnCall å“åº”å³å¯, éå¸¸æ–¹ä¾¿.")]),s._v(" "),t("h4",{attrs:{id:"æ•°æ®å±•ç¤º"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®å±•ç¤º"}},[s._v("#")]),s._v(" æ•°æ®å±•ç¤º")]),s._v(" "),t("p",[s._v("ç›‘æ§æ•°æ®çš„å¯è§†åŒ–ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸é€šç”¨ä¸”é‡è¦çš„éœ€æ±‚, ä¸šç•Œåšå¾—æœ€æˆåŠŸçš„å½“æ•° "),t("strong",[s._v("Grafana")]),s._v(". "),t("strong",[s._v("Grafana é‡‡ç”¨æ’ä»¶å¼æ¶æ„, å¯ä»¥æ”¯æŒä¸åŒç±»å‹çš„æ•°æ®æº, å›¾è¡¨éå¸¸ä¸°å¯Œ, åŸºæœ¬å¯ä»¥çœ‹åšæ˜¯å¼€æºé¢†åŸŸçš„äº‹å®æ ‡å‡†")]),s._v(". å¾ˆå¤šå…¬å¸çš„å•†ä¸šåŒ–äº§å“ä¸­, ç”šè‡³ç›´æ¥å†…åµŒäº† Grafana, å¯è§å®ƒæ˜¯å¤šä¹ˆæµè¡Œ. å½“ç„¶, Grafana æ–°ç‰ˆæœ¬å·²ç»ä¿®æ”¹äº†å¼€æºåè®®, ä½¿ç”¨ AGPLv3, è¿™å°±æ„å‘³ç€å¦‚æœæŸå…¬å¸çš„äº§å“åŸºäº Grafana åšäº†äºŒæ¬¡å¼€å‘, å°±å¿…é¡»å…¬å¼€ä»£ç , æœ‰äº›å‚å•†æƒ³è¦ Fork Grafana, ç„¶åè¿›è¡Œé—­æºå•†ä¸šåˆ†å‘, å°±è¡Œä¸é€šäº†.")]),s._v(" "),t("p",[s._v("ç›‘æ§æ•°æ®å¯è§†åŒ–, é€šå¸¸æœ‰ä¸¤ç±»éœ€æ±‚, "),t("strong",[s._v("ä¸€ä¸ªæ˜¯å³æ—¶æŸ¥è¯¢, ä¸€ä¸ªæ˜¯ç›‘æ§å¤§ç›˜(Dashboard)")]),s._v(" . å³æ—¶æŸ¥è¯¢æ˜¯ä¸´æ—¶èµ·æ„, æ¯”å¦‚çº¿ä¸Šæœ‰ä¸ªé—®é¢˜, éœ€è¦è¿½æŸ¥ç›‘æ§æ•°æ®, è¿˜åŸç°åœºæ’æŸ¥é—®é¢˜, è¿™å°±éœ€è¦æœ‰ä¸ªæ–¹ä¾¿æŸ¥çœ‹çš„æŒ‡æ ‡æµè§ˆåŠŸèƒ½, å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„æŒ‡æ ‡. ç›‘æ§å¤§ç›˜é€šå¸¸ç”¨äºæ—¥å¸¸å·¡æ£€å’Œé—®é¢˜æ’æŸ¥, ç”±èµ„æ·±å·¥ç¨‹å¸ˆåˆ›å»º, æ”¾ç½®äº†ä¸€äº›ç‰¹åˆ«å€¼å¾—é‡ç‚¹å…³æ³¨çš„æŒ‡æ ‡, ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å¼•å‘æˆ‘ä»¬æ€è€ƒ, å…·æœ‰å¾ˆå¼ºçš„çŸ¥è¯†æ²‰æ·€æ•ˆæœ. å¦‚æœæƒ³è¦äº†è§£æŸä¸ªç»„ä»¶çš„åŸç†, è¿™ä¸ªç»„ä»¶çš„ç›‘æ§å¤§ç›˜é€šå¸¸å¯ä»¥å¸¦ç»™ä½ ä¸€äº›å¯å‘.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-2"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬è®²å›´ç»•ç›‘æ§ç³»ç»Ÿçš„å…¸å‹æ¶æ„, é˜è¿°äº†å„ä¸ªåŠŸèƒ½æ¨¡å—çš„èŒèƒ½.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("é‡‡é›†å™¨")]),s._v(": "),t("strong",[s._v("ç”¨äºæ”¶é›†ç›‘æ§æ•°æ®")]),s._v(", ä¸šç•Œæœ‰ä¸å°‘å¼€æºè§£å†³æ–¹æ¡ˆ, å¤§åŒå°å¼‚, æ€»ä½“åˆ†ä¸ºæ¨æ‹‰ä¸¤ç§æ¨¡å¼, å„æœ‰åº”ç”¨åœºæ™¯. Telegraf, Exporters ç”¨å¾—æœ€å¹¿æ³›, Grafana-Agent å’Œ Categraf æ˜¯åæ¥è€…, å½“ç„¶è¿˜æœ‰ Datadog-Agent è¿™ç§å•†ä¸šè§£å†³æ–¹æ¡ˆ, å»ºè®®æ˜¯ä¼˜å…ˆè€ƒè™‘ Categraf, ç›¸å¯¹è€Œè¨€, å®ƒä½¿ç”¨èµ·æ¥æ›´åŠ ä¾¿æ·. å¦‚æœæœ‰äº›åœºæ™¯ Categraf æ²¡æœ‰è¦†ç›–, å¯ä»¥è€ƒè™‘è¾…ä»¥ä¸€äº›ç‰¹å®šçš„ Exporter.")]),s._v(" "),t("li",[t("strong",[s._v("æ—¶åºåº“")]),s._v(": "),t("strong",[s._v("ç”¨äºå­˜å‚¨æ—¶åºæ•°æ®")]),s._v(", æ˜¯ä¸€ä¸ªéå¸¸å†…å·çš„è¡Œä¸š, æœ‰å¾ˆå¤šå¼€æºæ–¹æ¡ˆå¯ä¾›é€‰æ‹©. å¦‚æœè§„æ¨¡æ¯”è¾ƒå°, 1000 å°æœºå™¨ä»¥ä¸‹, é€šå¸¸ä¸€ä¸ªå•æœºç‰ˆæœ¬çš„ Prometheus å°±å¤Ÿç”¨äº†. å¦‚æœè§„æ¨¡å†å¤§ä¸€äº›, å»ºè®®è€ƒè™‘ VictoriaMetrics, æ¯•ç«Ÿæ¶æ„ç®€å•, ç®€å•çš„ä¸œè¥¿å¯èƒ½ä¸å®Œå¤‡, ä½†æ˜¯å‡ºäº†é—®é¢˜å®¹æ˜“æ’æŸ¥, æ›´åŠ å¯æ§.")]),s._v(" "),t("li",[t("strong",[s._v("å‘Šè­¦å¼•æ“")]),s._v(": "),t("strong",[s._v("ç”¨äºåšå‘Šè­¦è§„åˆ™åˆ¤æ–­, ç”Ÿæˆå‘Šè­¦äº‹ä»¶")]),s._v(". è¿™æ˜¯ç›‘æ§ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†, é€šå¸¸æ˜¯åŸºäºå›ºå®šé˜ˆå€¼è§„åˆ™æ¥å‘Šè­¦. å½“ç„¶éšç€æ—¶ä»£çš„å‘å±•, ä¹Ÿæœ‰ç³»ç»Ÿæ”¯æŒç»Ÿè®¡ç®—æ³•å’Œæœºå™¨å­¦ä¹ çš„æ–¹å¼åšå‘Šè­¦é¢„åˆ¤, ä¹Ÿæ˜¯å¯ä»¥å°è¯•çš„. AiOps æ¦‚å¿µä¸­æœ€å®¹æ˜“è½åœ°, æˆ–è€…è¯´è½åœ°ä¹‹åæœ€å®¹æ˜“æœ‰æ•ˆæœçš„, å°±æ˜¯å‘Šè­¦å¼•æ“. ä¸è¿‡ Google SRE çš„è§‚ç‚¹æ˜¯ä¸å¸Œæœ›åœ¨å‘Šè­¦ä¸­ä½¿ç”¨å¤ªå¤š magic çš„æ‰‹æ®µ, è¿™ä¸ªå°±è§ä»è§æ™ºäº†.")]),s._v(" "),t("li",[t("strong",[s._v("æ•°æ®å±•ç¤º")]),s._v(": "),t("strong",[s._v("ç”¨äºæ¸²æŸ“å±•ç¤ºç›‘æ§æ•°æ®")]),s._v(". æœ€å¸¸è§çš„å›¾è¡¨å°±æ˜¯æŠ˜çº¿å›¾, å¯ä»¥æ¸…æ™°æ˜äº†åœ°çœ‹åˆ°æ•°æ®å˜åŒ–è¶‹åŠ¿, æœ‰äº›äººä¼šæŠŠç›‘æ§å¤§ç›˜é…ç½®å¾—ç‰¹åˆ«èŠ±å“¨, å„ç§èƒ½ç”¨çš„å›¾è¡¨ç±»å‹éƒ½ç”¨ä¸€ä¸‹, å…¶å®å®ç”¨æ€§æ‰æ˜¯æœ€æ ¸å¿ƒçš„è¯‰æ±‚. å¾ˆå¤šç›‘æ§ç³»ç»Ÿä¼šå†…ç½®çœ‹å›¾åŠŸèƒ½, å¼€æºé¢†åŸŸæœ€æˆç†Ÿçš„å°±æ˜¯ Grafana, å¦‚æœæŸä¸ªå­˜å‚¨æ— æ³•å’Œ Grafana å¯¹æ¥, å…¶æµè¡Œæ€§éƒ½ä¼šå¤§æ‰“æŠ˜æ‰£.")])]),s._v(" "),t("p",[s._v("æ€»ç»“å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6fc697bd0378f55d42043ef25982b155-20230719203435-5804o6e.jpg",alt:"å›¾ç‰‡"}})]),s._v(" "),t("h2",{attrs:{id:"æ­å»ºå¹¶å¢å¼ºprometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ­å»ºå¹¶å¢å¼ºprometheus"}},[s._v("#")]),s._v(" æ­å»ºå¹¶å¢å¼ºPrometheus")]),s._v(" "),t("h3",{attrs:{id:"_4-å¦‚ä½•å¿«é€Ÿæ­å»ºprometheusç³»ç»Ÿ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-å¦‚ä½•å¿«é€Ÿæ­å»ºprometheusç³»ç»Ÿ"}},[s._v("#")]),s._v(" 4.å¦‚ä½•å¿«é€Ÿæ­å»ºPrometheusç³»ç»Ÿ?")]),s._v(" "),t("p",[s._v("å‰é¢ä¸‰è®²ä»‹ç»äº†ç›‘æ§ç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ, è¿™ä¸€è®²å¼€å§‹è¿›å…¥å®æ“ç¯èŠ‚, éƒ¨ç½²ç›‘æ§ç³»ç»Ÿ. ä¸šç•Œå¯é€‰çš„å¼€æºæ–¹æ¡ˆå¾ˆå¤š, éšç€äº‘åŸç”Ÿçš„æµè¡Œ, è¶Šæ¥è¶Šå¤šçš„å…¬å¸å¼€å§‹æ‹¥æŠ±äº‘åŸç”Ÿ, è€Œäº‘åŸç”Ÿæ ‡é…çš„ç›‘æ§ç³»ç»Ÿæ˜¾ç„¶å°±æ˜¯ Prometheus, è€Œä¸” Prometheus çš„éƒ¨ç½²éå¸¸ç®€å•, æ‰€ä»¥è¿™ä¸€è®²å°±å…ˆæ¥è‡ªå·±åŠ¨æ‰‹æ­å»º Prometheus.")]),s._v(" "),t("h4",{attrs:{id:"é€šç”¨æ¶æ„å›é¡¾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é€šç”¨æ¶æ„å›é¡¾"}},[s._v("#")]),s._v(" é€šç”¨æ¶æ„å›é¡¾")]),s._v(" "),t("p",[s._v("å›é¡¾ä¸€ä¸‹ä¸Šä¸€è®²ä»‹ç»çš„ç›‘æ§ç³»ç»Ÿé€šç”¨æ¶æ„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/9edcfef623ea9583134533c3b4c477f5-20230719203435-kcoq5ye.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("ä¹‹æ‰€ä»¥è¯´ Prometheus æ¯”è¾ƒå®¹æ˜“æ­å»º, æ˜¯å› ä¸º"),t("strong",[s._v("å®ƒæŠŠæœåŠ¡ç«¯ç»„ä»¶, åŒ…æ‹¬æ—¶åºåº“, å‘Šè­¦å¼•æ“, æ•°æ®å±•ç¤ºä¸‰å¤§å—, æ•´åˆæˆäº†ä¸€ä¸ªè¿›ç¨‹")]),s._v(", ç»„ä»¶çš„æ•°é‡å¤§å¹…å‡å°‘. "),t("strong",[s._v("Prometheus ç”Ÿæ€çš„é‡‡é›†å™¨å°±æ˜¯å„ç§ Exporter, å‘Šè­¦å‘é€é çš„æ˜¯ AlertManager ç»„ä»¶")]),s._v(", ä¸‹é¢å…ˆæ¥éƒ¨ç½²  Prometheus æ¨¡å—.")]),s._v(" "),t("h4",{attrs:{id:"éƒ¨ç½²prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²prometheus"}},[s._v("#")]),s._v(" éƒ¨ç½²Prometheus")]),s._v(" "),t("p",[s._v("å› ä¸ºç”Ÿäº§ç¯å¢ƒå¤§æ¦‚ç‡æ˜¯ Linux çš„, æ‰€ä»¥é€‰æ‹© Linux ä¸‹çš„å‘å¸ƒåŒ…, æŠŠ Prometheus å’Œ Alertmanager ä¸¤ä¸ªåŒ…éƒ½ä¸‹è½½ä¸‹æ¥.")]),s._v(" "),t("p",[s._v("Prometheus çš„ä¸‹è½½åœ°å€:  "),t("a",{attrs:{href:"https://prometheus.io/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://prometheus.io/download/"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cf6af0ffc5f3be2867f8a18d0cd254f7-20230719203435-r0scmyn.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("ä¸‹è½½ä¹‹åè§£å‹ç¼©, ä½¿ç”¨ systemd æ‰˜ç®¡å¯åŠ¨, å¯ä»¥å‚è€ƒä¸‹é¢çš„å‘½ä»¤.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /opt/prometheus\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/prometheus/prometheus/releases/download/v2.37.1/prometheus-2.37.1.linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf prometheus-2.37.1.linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-far")]),s._v(" prometheus-2.37.1.linux-amd64/*  /opt/prometheus/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/etc/systemd/system/prometheus.service")]),s._v('\n[Unit]\nDescription="prometheus"\nDocumentation=https://prometheus.io/\nAfter=network.target\n\n[Service]\nType=simple\n\nExecStart=/opt/prometheus/prometheus  --config.file=/opt/prometheus/prometheus.yml --storage.tsdb.path=/opt/prometheus/data --web.enable-lifecycle --enable-feature=remote-write-receiver --query.lookback-delta=2m --web.enable-admin-api\n\nRestart=on-failure\nSuccessExitStatus=0\nLimitNOFILE=65536\nStandardOutput=syslog\nStandardError=syslog\nSyslogIdentifier=prometheus\n\n[Install]\nWantedBy=multi-user.target\nEOF')]),s._v("\n\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" prometheus\nsystemctl start prometheus\nsystemctl status prometheus\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[s._v("è¿™é‡Œéœ€è¦é‡ç‚¹å…³æ³¨çš„æ˜¯ Prometheus è¿›ç¨‹çš„å¯åŠ¨å‚æ•°, è¿™é‡Œåœ¨æ¯ä¸ªå‚æ•°ä¸‹é¢éƒ½åšå‡ºäº†è§£é‡Š.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æŒ‡å®š Prometheus çš„é…ç½®æ–‡ä»¶è·¯å¾„")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config.file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/prometheus/prometheus.yml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŒ‡å®š Prometheus æ—¶åºæ•°æ®çš„ç¡¬ç›˜å­˜å‚¨è·¯å¾„")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--storage.tsdb.path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/prometheus/data\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ç›¸å…³çš„ API, æ¯”å¦‚è°ƒç”¨ /-/reload æ¥å£å°±éœ€è¦å¯ç”¨è¯¥é¡¹")]),s._v("\n--web.enable-lifecycle\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯ç”¨ remote write æ¥æ”¶æ•°æ®çš„æ¥å£, å¯ç”¨è¯¥é¡¹ä¹‹å, categraf, grafana-agent ç­‰ agent å°±å¯ä»¥é€šè¿‡ /api/v1/write æ¥å£æ¨é€æ•°æ®ç»™ Prometheus")]),s._v("\n--enable-feature"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("remote-write-receiver\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å³æ—¶æŸ¥è¯¢åœ¨æŸ¥è¯¢å½“å‰æœ€æ–°å€¼çš„æ—¶å€™, åªè¦å‘ç°è¿™ä¸ªå‚æ•°æŒ‡å®šçš„æ—¶é—´æ®µå†…æœ‰æ•°æ®, å°±å–æœ€æ–°çš„é‚£ä¸ªç‚¹è¿”å›, è¿™ä¸ªæ—¶é—´æ®µå†…æ²¡æ•°æ®, å°±ä¸è¿”å›äº†")]),s._v("\n--query.lookback-delta"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("2m\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯ç”¨ç®¡ç†æ€§ API, æ¯”å¦‚åˆ é™¤æ—¶é—´åºåˆ—æ•°æ®çš„ /api/v1/admin/tsdb/delete_series æ¥å£")]),s._v("\n--web.enable-admin-api\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("å¦‚æœæ­£å¸¸å¯åŠ¨, Prometheus é»˜è®¤ä¼šåœ¨ 9090 ç«¯å£ç›‘å¬, è®¿é—®è¿™ä¸ªç«¯å£å°±å¯ä»¥çœ‹åˆ° Prometheus çš„ Web é¡µé¢, è¾“å…¥ä¸‹é¢çš„  PromQL å¯ä»¥æŸ¥åˆ°ä¸€äº›ç›‘æ§æ•°æ®.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/91652cc17442bcb51df6230624d0a21a-20230719203435-c0fryk6.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ•°æ®æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢? å…¶å®æ˜¯ Prometheus "),t("strong",[s._v("è‡ªå·±æŠ“å–è‡ªå·±")]),s._v("çš„, Prometheus ä¼šåœ¨ "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£æš´éœ²ç›‘æ§æ•°æ®, å¯ä»¥è®¿é—®è¿™ä¸ªæ¥å£çœ‹ä¸€ä¸‹è¾“å‡º. åŒæ—¶ Prometheus åœ¨é…ç½®æ–‡ä»¶é‡Œé…ç½®äº†"),t("strong",[s._v("æŠ“å–è§„åˆ™")]),s._v(", æ‰“å¼€ "),t("strong",[s._v("prometheus.yml")]),s._v(" å°±å¯ä»¥çœ‹åˆ°äº†.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("scrape_configs:\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prometheus'")]),s._v("\n    static_configs:\n    - targets: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9090'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("localhost:9090 æ˜¯æš´éœ²ç›‘æ§æ•°æ®çš„åœ°å€, æ²¡æœ‰æŒ‡å®šæ¥å£è·¯å¾„, é»˜è®¤ä½¿ç”¨ "),t("code",[s._v("/metrics")]),s._v("â€‹, æ²¡æœ‰æŒ‡å®š scheme, é»˜è®¤ä½¿ç”¨ HTTP, æ‰€ä»¥å®é™…è¯·æ±‚çš„æ˜¯ "),t("code",[s._v("http://localhost:9090/metrics")]),s._v("â€‹. äº†è§£äº† Prometheus è‡ªç›‘æ§çš„æ–¹å¼, ä¸‹é¢æ¥çœ‹ä¸€ä¸‹æœºå™¨ç›‘æ§.")]),s._v(" "),t("h4",{attrs:{id:"éƒ¨ç½²node-exporter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²node-exporter"}},[s._v("#")]),s._v(" éƒ¨ç½²Node-Exporter")]),s._v(" "),t("p",[s._v("Prometheus ç”Ÿæ€çš„æœºå™¨ç›‘æ§æ¯”è¾ƒç®€å•, å°±æ˜¯"),t("strong",[s._v("åœ¨æ‰€æœ‰çš„ç›®æ ‡æœºå™¨ä¸Šéƒ¨ç½² Node-Exporter, ç„¶ååœ¨æŠ“å–è§„åˆ™ä¸­ç»™å‡ºæ‰€æœ‰ Node-Exporter çš„åœ°å€")]),s._v("å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("é¦–å…ˆä¸‹è½½ "),t("a",{attrs:{href:"https://prometheus.io/download/#node_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node-Exporter"),t("OutboundLink")],1),s._v(". å¯ä»¥é€‰æ‹©å½“ä¸‹æ¯”è¾ƒç¨³å®šçš„ç‰ˆæœ¬ 1.3.1, ä¸‹è½½ä¹‹åè§£å‹å°±å¯ä»¥ç›´æ¥è¿è¡Œäº†, æ¯”å¦‚ä½¿ç”¨ nohup(ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ systemd æ‰˜ç®¡) ç®€å•å¯åŠ¨çš„è¯, å¯ä»¥è¾“å…¥ä¸‹é¢è¿™ä¸€è¡Œå‘½ä»¤.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./node_exporter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" output.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Node-Exporter é»˜è®¤çš„ç›‘å¬ç«¯å£æ˜¯ 9100, å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤çœ‹åˆ° Node-Exporter é‡‡é›†çš„æŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" localhost:9100/metrics\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç„¶å"),t("strong",[s._v("æŠŠ Node-Exporter çš„åœ°å€é…ç½®åˆ° prometheus.yml")]),s._v(" ä¸­å³å¯. ä¿®æ”¹äº†é…ç½®ä¹‹å, è®°å¾—ç»™ Prometheus å‘ä¸ª HUP ä¿¡å·, è®© Prometheus é‡æ–°è¯»å–é…ç½®: "),t("code",[s._v("kill -HUP <prometheus pid>")]),s._v("â€‹. æœ€ç»ˆ scrape_configs éƒ¨åˆ†å˜æˆä¸‹é¢è¿™æ®µå†…å®¹.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("scrape_configs:\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prometheus'")]),s._v("\n    static_configs:\n    - targets: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9090'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node_exporter'")]),s._v("\n    static_configs:\n    - targets: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9100'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("å…¶ä¸­ targets æ˜¯ä¸ªæ•°ç»„, å¦‚æœè¦ç›‘æ§æ›´å¤šæœºå™¨, å°±åœ¨ targets ä¸­å†™ä¸Šå¤šä¸ª Node-Exporter çš„åœ°å€, ç”¨é€—å·éš”å¼€. ä¹‹ååœ¨ Prometheus çš„ Web ä¸Š(èœå•ä½ç½®Status -> Targets), å°±å¯ä»¥çœ‹åˆ°ç›¸å…³çš„ Targets ä¿¡æ¯äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f572c8cf62d7b52668c6fd71cdb7887c-20230719203435-lhefdo7.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("åœ¨æŸ¥è¯¢ç›‘æ§æ•°æ®çš„æ¡†é‡Œè¾“å…¥ node, å°±ä¼šè‡ªåŠ¨æç¤ºå¾ˆå¤š node æ‰“å¤´çš„æŒ‡æ ‡. è¿™äº›æŒ‡æ ‡éƒ½æ˜¯ Node-Exporter é‡‡é›†çš„, é€‰æ‹©å…¶ä¸­æŸä¸€ä¸ªå°±å¯ä»¥æŸ¥åˆ°å¯¹åº”çš„ç›‘æ§æ•°æ®, æ¯”å¦‚æŸ¥çœ‹ä¸åŒç¡¬ç›˜åˆ†åŒºçš„ä½™é‡å¤§å°.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/44d2bc07de0a62299bb38e910010fbfd-20230719203435-t99bakl.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("Node-Exporter é»˜è®¤å†…ç½®äº†å¾ˆå¤š collector, æ¯”å¦‚ cpu, loadavg, filesystem ç­‰, å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨å‚æ•°æ¥æ§åˆ¶è¿™äº› collector, æ¯”å¦‚è¦å…³æ‰æŸä¸ª collector, ä½¿ç”¨ "),t("code",[s._v("--no-collector.<name>")]),s._v("â€‹, å¦‚æœè¦å¼€å¯æŸä¸ª collector, ä½¿ç”¨ "),t("code",[s._v("--collector.<name>")]),s._v("â€‹. å…·ä½“å¯ä»¥å‚è€ƒ Node-Exporter çš„ "),t("a",{attrs:{href:"https://github.com/prometheus/node_exporter#collectors",target:"_blank",rel:"noopener noreferrer"}},[s._v("README"),t("OutboundLink")],1),s._v(". Node-Exporter é»˜è®¤é‡‡é›†å‡ ç™¾ä¸ªæŒ‡æ ‡, æœ‰äº†è¿™äº›æ•°æ®, æˆ‘ä»¬å°±å¯ä»¥æ¼”ç¤ºå‘Šè­¦è§„åˆ™çš„é…ç½®äº†.")]),s._v(" "),t("h4",{attrs:{id:"é…ç½®å‘Šè­¦è§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®å‘Šè­¦è§„åˆ™"}},[s._v("#")]),s._v(" é…ç½®å‘Šè­¦è§„åˆ™")]),s._v(" "),t("p",[s._v("Prometheus è¿›ç¨‹å†…ç½®äº†å‘Šè­¦åˆ¤æ–­å¼•æ“, prometheus.yml ä¸­å¯ä»¥æŒ‡å®šå‘Šè­¦è§„åˆ™é…ç½®æ–‡ä»¶, é»˜è®¤é…ç½®ä¸­æœ‰ä¸ªä¾‹å­.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule_files")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "first_rules.yml"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "second_rules.yml"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å¯ä»¥æŠŠä¸åŒç±»å‹çš„"),t("strong",[s._v("å‘Šè­¦è§„åˆ™")]),s._v("æ‹†åˆ†åˆ°ä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­, ç„¶ååœ¨ prometheus.yml ä¸­å¼•ç”¨. æ¯”å¦‚ Node-Exporter ç›¸å…³çš„è§„åˆ™, å‘½åä¸º node_exporter.yml, æœ€ç»ˆè¿™ä¸ª rule_files å°±å˜æˆäº†å¦‚ä¸‹é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule_files")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_exporter.yml"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™é‡Œè®¾è®¡äº†ä¸€ä¸ªä¾‹å­, ç›‘æ§ Node-Exporter æŒ‚æ‰ä»¥åŠå†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 1% è¿™ä¸¤ç§æƒ…å†µ. è¿™é‡Œæ•…æ„è®¾ç½®äº†ä¸€ä¸ªå¾ˆå°çš„é˜ˆå€¼, ç¡®ä¿èƒ½å¤Ÿè§¦å‘å‘Šè­¦.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter\n  rules"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HostDown\n    expr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('job="node_exporter"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" == 0\n    for"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1m\n    labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      severity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" critical\n    annotations"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      summary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Host down "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" $labels.instance "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MemUtil\n    expr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 100 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" 1\n    for"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1m\n    labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      severity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" warn\n    annotations"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      summary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Mem usage larger than 1%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" $labels.instance "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("æœ€å, ç»™ Prometheus è¿›ç¨‹å‘ä¸ª HUP ä¿¡å·, è®©å®ƒé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("kill "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("HUP `pidof prometheus`\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¹‹åå°±å¯ä»¥å» Prometheus çš„ Web ä¸Š(Alertsèœå•)æŸ¥çœ‹å‘Šè­¦è§„åˆ™çš„åˆ¤å®šç»“æœäº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/bfb533fd9a65c0df2872cea67817f0b3-20230719203435-4d9oyev.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("ä»å›¾ä¸­å¯ä»¥çœ‹å‡º, å‘Šè­¦åˆ†æˆ 3 ä¸ªçŠ¶æ€, "),t("strong",[s._v("Inactive, Pending, Firing")]),s._v(". HostDown è¿™ä¸ªè§„åˆ™å½“å‰æ˜¯ Inactive çŠ¶æ€, è¡¨ç¤ºæ²¡æœ‰è§¦å‘ç›¸å…³çš„å‘Šè­¦äº‹ä»¶, MemUtil è¿™ä¸ªè§„åˆ™è§¦å‘äº†ä¸€ä¸ªäº‹ä»¶, å¤„äº Firing çŠ¶æ€. é‚£ä»€ä¹ˆæ˜¯ Pending çŠ¶æ€å‘¢? è§¦å‘è¿‡é˜ˆå€¼ä½†æ˜¯è¿˜æ²¡æœ‰æ»¡è¶³æŒç»­æ—¶é•¿( for å…³é”®å­—åé¢æŒ‡å®šçš„æ—¶é—´æ®µ)çš„è¦æ±‚, å°±æ˜¯ Pending çŠ¶æ€. æ¯”å¦‚ for 1m, å°±è¡¨ç¤ºè§¦å‘é˜ˆå€¼çš„æ—¶é—´æŒç»­ 1 åˆ†é’Ÿæ‰ç®—æ»¡è¶³æ¡ä»¶, å¦‚æœè§„åˆ™åˆ¤å®šæ‰§è¡Œé¢‘ç‡æ˜¯ 10 ç§’, å°±ç›¸å½“äºè¿ç»­ 6 æ¬¡éƒ½è§¦å‘é˜ˆå€¼æ‰å¯ä»¥.")]),s._v(" "),t("p",[s._v("åœ¨é¡µé¢ä¸Š"),t("strong",[s._v("çœ‹åˆ°å‘Šè­¦")]),s._v("äº†, å°±æ˜¯ä¸€ä¸ªå·¨å¤§çš„è¿›æ­¥, å¦‚æœè¿˜å¸Œæœ›åœ¨å‘Šè­¦çš„æ—¶å€™æ”¶åˆ°æ¶ˆæ¯é€šçŸ¥, æ¯”å¦‚é‚®ä»¶, çŸ­ä¿¡ç­‰, å°±éœ€è¦å¼•å…¥  AlertManager ç»„ä»¶äº†.")]),s._v(" "),t("h4",{attrs:{id:"éƒ¨ç½²alertmanager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²alertmanager"}},[s._v("#")]),s._v(" éƒ¨ç½²Alertmanager")]),s._v(" "),t("p",[s._v("éƒ¨ç½² Prometheus çš„æ—¶å€™, å·²ç»é¡ºä¾¿æŠŠ Alertmanager çš„åŒ…ä¸‹è½½ä¸‹æ¥äº†, ä¸‹é¢å°±å®‰è£…ä¸€ä¸‹. å®‰è£…è¿‡ç¨‹å¾ˆç®€å•, æŠŠä¸Šé¢çš„  prometheus.service æ‹¿è¿‡æ¥æ”¹ä¸€ä¸‹ç»™ Alertmanager ä½¿ç”¨å³å¯, ä¸‹é¢æ˜¯æ”¹å¥½çš„ alertmanager.service.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v('\nDescription="alertmanager"\nAfter=network.target\n\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nType=simple\n\nExecStart=/usr/local/alertmanager/alertmanager\nWorkingDirectory=/usr/local/alertmanager\n\nRestart=on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure\nSuccessExitStatus=0\nLimitNOFILE=65536\nStandardOutput=syslog\nStandardError=syslog\nSyslogIdentifier=alertmanager\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy=multi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("user.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("æŠŠ Alertmanager è§£å‹åˆ° /usr/local/alertmanager ç›®å½•, é€šè¿‡ ExecStart å¯ä»¥çœ‹å‡º, ç›´æ¥æ‰§è¡ŒäºŒè¿›åˆ¶å°±å¯ä»¥, å®é™… Alertmanager ä¼šè¯»å–äºŒè¿›åˆ¶åŒçº§ç›®å½•ä¸‹çš„ alertmanager.yml é…ç½®æ–‡ä»¶. è¿™é‡Œä½¿ç”¨ 163 é‚®ç®±ä½œä¸º SMTP å‘ä»¶æœåŠ¡å™¨, ä¸‹é¢æ˜¯å…·ä½“çš„é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("smtp_from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username@163.com'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("smtp_smarthost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'smtp.163.com:465'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("smtp_auth_username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username@163.com'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("smtp_auth_password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'è¿™é‡Œå¡«å†™æˆæƒç '")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("smtp_require_tls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  group_by"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  group_wait"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30s\n  group_interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1m\n  repeat_interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1h\n  receiver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("receivers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web.hook'")]),s._v("\n    webhook_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://127.0.0.1:5001/'")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),s._v("\n    email_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ulricqin@163.com'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("inhibit_rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      severity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'critical'")]),s._v("\n    target_match"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      severity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'warning'")]),s._v("\n    equal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'instance'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("é¦–å…ˆé…ç½®ä¸€ä¸ªå…¨å±€ SMTP, ç„¶åä¿®æ”¹ receivers. receivers æ˜¯ä¸ªæ•°ç»„, é»˜è®¤ä¾‹å­é‡Œæœ‰ä¸ª web.hook, ç„¶ååˆåŠ äº†ä¸€ä¸ª email çš„ receiver, ç„¶åé…ç½® route.receiver å­—æ®µçš„å€¼ä¸º email. email_configs ä¸­çš„ to è¡¨ç¤ºæ”¶ä»¶äºº, å¤šä¸ªäººç”¨é€—å·åˆ†éš”, æ¯”å¦‚ "),t("code",[s._v("to: 'user1@163.com, user2@163.com'")]),s._v("â€‹, æœ€åæ”¶åˆ°çš„é‚®ä»¶å†…å®¹å¤§æ¦‚æ˜¯è¿™æ ·çš„, å¯ä»¥çœ‹ä¸€ä¸‹æ ·ä¾‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/bf8a77d0640d97415205c662f50069d2-20230719203435-8pw1d27.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("æ”¶åˆ°å‘Šè­¦é‚®ä»¶, å°±è¯´æ˜è¿™æ•´ä¸ª"),t("strong",[s._v("å‘Šè­¦é“¾è·¯")]),s._v("èµ°é€šäº†. æœ€åå†çœ‹ä¸€ä¸‹æ•°æ®å¯è§†åŒ–çš„é—®é¢˜. Prometheus è‡ªå¸¦çš„çœ‹å›¾å·¥å…·, æ˜¯ç»™ä¸“å®¶ç”¨çš„, éœ€è¦å¯¹æŒ‡æ ‡ä½“ç³»éå¸¸äº†è§£, ç»éªŒæ²¡æ³•æ²‰æ·€, è€Œä¸”ç»˜å›¾å·¥å…·å•ä¸€, åªæœ‰æŠ˜çº¿å›¾. å¦‚æœå¸Œæœ›æœ‰ä¸€ä¸ªæ›´å¥½ç”¨çš„ UI å·¥å…·, å¯ä»¥è¯•è¯• Grafana.")]),s._v(" "),t("h4",{attrs:{id:"éƒ¨ç½²grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²grafana"}},[s._v("#")]),s._v(" éƒ¨ç½²Grafana")]),s._v(" "),t("p",[s._v("Grafana æ˜¯ä¸€ä¸ªæ•°æ®å¯è§†åŒ–å·¥å…·, æœ‰ä¸°å¯Œçš„å›¾è¡¨ç±»å‹, è§†è§‰æ•ˆæœå¾ˆæ£’, æ’ä»¶å¼æ¶æ„, æ”¯æŒå„ç§æ•°æ®æº, æ˜¯å¼€æºç›‘æ§æ•°æ®å¯è§†åŒ–çš„æ ‡æ†ä¹‹ä½œ. Grafana å¯ä»¥ç›´æ¥å¯¹æ¥ Prometheus, å¤§éƒ¨åˆ†ä½¿ç”¨ Prometheus çš„ç”¨æˆ·, ä¹Ÿéƒ½ä¼šä½¿ç”¨ Grafana, ä¸‹é¢å°±æ¥éƒ¨ç½²ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("å¯ä»¥å…ˆæŠŠ "),t("a",{attrs:{href:"https://grafana.com/grafana/download?pg=get&plcmt=selfmanaged-box1-cta1&edition=oss",target:"_blank",rel:"noopener noreferrer"}},[s._v("Grafana"),t("OutboundLink")],1),s._v(" ä¸‹è½½ä¸‹æ¥, å®ƒåˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬, ä¼ä¸šç‰ˆå’Œå¼€æºç‰ˆ, å¼€æºç‰ˆæœ¬éµç…§ AGPLV3 åè®®, åªè¦ä¸åšäºŒæ¬¡å¼€å‘å•†ä¸šåŒ–åˆ†å‘, æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„. è¿™é‡Œå°±ä¸‹è½½äº†å¼€æºç‰ˆæœ¬, é€‰æ‹© "),t("a",{attrs:{href:"https://dl.grafana.com/oss/release/grafana-9.1.5.linux-amd64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("tar.gz åŒ…"),t("OutboundLink")],1),s._v(", ä¸‹è½½ä¹‹åè§£å‹ç¼©, æ‰§è¡Œ "),t("code",[s._v("./bin/grafana-server")]),s._v("â€‹ å³å¯ä¸€é”®å¯åŠ¨, Grafana é»˜è®¤çš„ç›‘å¬ç«¯å£æ˜¯ 3000, è®¿é—®åå°±å¯ä»¥çœ‹åˆ°ç™»å½•é¡µé¢äº†, é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ admin.")]),s._v(" "),t("p",[s._v("è¦çœ‹å›¾é¦–å…ˆè¦"),t("strong",[s._v("é…ç½®æ•°æ®æº")]),s._v(", åœ¨èœå•ä½ç½®: Configuration -> Data sources, ç‚¹å‡» "),t("strong",[s._v("Add data source")]),s._v(" å°±èƒ½è¿›å…¥æ•°æ®æºç±»å‹é€‰æ‹©é¡µé¢, é€‰æ‹© Prometheus, å¡«å†™ Prometheus çš„é“¾æ¥ä¿¡æ¯, ä¸»è¦æ˜¯ URL, ç‚¹å‡» "),t("strong",[s._v("Save & test")]),s._v(" å®Œæˆæ•°æ®æºé…ç½®.")]),s._v(" "),t("p",[s._v("Grafana æä¾›äº†å’Œ Prometheus çœ‹å›¾é¡µé¢ç±»ä¼¼çš„åŠŸèƒ½, å«åš Explore, å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢ç‚¹é€‰æŒ‡æ ‡çœ‹å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7dd10e1295567613329a7c06eb873872-20230719203435-e0vf8mq.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("ä½† Explore åŠŸèƒ½ä¸æ˜¯æœ€æ ¸å¿ƒçš„, ä½¿ç”¨ Grafana, ä¸»è¦æ˜¯ä½¿ç”¨ Dashboard çœ‹å›¾. Grafana ç¤¾åŒºæœ‰å¾ˆå¤šäººåˆ¶ä½œäº†å„å¼å„æ ·çš„å¤§ç›˜, ä»¥ JSON æ ¼å¼ä¸Šä¼ ä¿å­˜åœ¨äº† "),t("a",{attrs:{href:"https://grafana.com/grafana/dashboards/",target:"_blank",rel:"noopener noreferrer"}},[s._v("grafana.com"),t("OutboundLink")],1),s._v(", å¦‚æœæƒ³è¦æŸä¸ª Dashboard, å¯ä»¥å…ˆå»è¿™ä¸ªç½‘ç«™æœç´¢ä¸€ä¸‹, çœ‹çœ‹æ˜¯å¦æœ‰äººåˆ†äº«è¿‡. å› ä¸ºå·²ç»éƒ¨ç½²äº† Node-Exporter, é‚£è¿™é‡Œå°±å¯ä»¥ç›´æ¥å¯¼å…¥ Node-Exporter çš„å¤§ç›˜, å¤§ç›˜ ID æ˜¯ 1860, å†™åˆ°å›¾ä¸­å¯¹åº”çš„ä½ç½®, ç‚¹å‡» Load, ç„¶åé€‰æ‹©æ•°æ®æºç‚¹å‡» Import å³å¯.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ed4598ac72020b58e03b84152ea2185e-20230719203435-st0zian.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å¯¼å…¥æˆåŠŸçš„è¯ä¼šè‡ªåŠ¨æ‰“å¼€ Dashboard, Node-Exporter çš„å¤§ç›˜é•¿è¿™ä¸ªæ ·å­.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/24b12129c46b572f84c2f6550cf394b7-20230719203435-2l9xvkl.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("èµ°åˆ°è¿™ä¸ªç›‘æ§çœ‹å›¾çš„éƒ¨åˆ†, ä¹Ÿèµ°å®Œäº†æ•´ä¸ªæµç¨‹.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-3"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬è®²çš„æ ¸å¿ƒå†…å®¹å°±æ˜¯æ¼”ç¤º Prometheus ç”Ÿæ€ç›¸å…³ç»„ä»¶çš„éƒ¨ç½². å­¦å®Œè¿™äº›å†…å®¹å†æ¥çœ‹ä¸€ä¸‹ Prometheus çš„æ¶æ„å›¾, å’Œç›‘æ§ç³»ç»Ÿé€šç”¨æ¶æ„å›¾ç›¸äº’åšä¸€ä¸ªå°è¯, åŠ æ·±ç†è§£.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8e7bcb19da502cbe4cc811f60be871d6-20230719203435-qn9231m.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å›¾ä¸Šæœ‰ä¸¤ä¸ªéƒ¨åˆ†æ²¡æœ‰è®²åˆ°, ä¸€ä¸ªæ˜¯ Pushgateway ç»„ä»¶, å¦ä¸€ä¸ªæ˜¯ Service discovery éƒ¨åˆ†. è¿™é‡Œå†åšä¸€ä¸ªç®€å•çš„è¡¥å…….")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Pushgateway")]),s._v(": ç”¨äºæ¥æ”¶çŸ­ç”Ÿå‘½å‘¨æœŸä»»åŠ¡çš„æŒ‡æ ‡ä¸ŠæŠ¥, æ˜¯ PUSH çš„æ¥æ”¶æ–¹å¼. å› ä¸º Prometheus ä¸»è¦æ˜¯ PULL çš„æ–¹å¼æ‹‰å–ç›‘æ§æ•°æ®, è¿™å°±è¦æ±‚åœ¨æ‹‰å–çš„æ—¶åˆ», ç›‘æ§å¯¹è±¡å¾—æ´»ç€, ä½†æ˜¯å¾ˆå¤šçŸ­å‘¨æœŸä»»åŠ¡, æ¯”å¦‚ cronjob, å¯èƒ½åŠç§’å°±è¿è¡Œç»“æŸäº†, å°±æ²¡æ³•æ‹‰å–äº†. ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µ, æ‰å•ç‹¬åšäº† Pushgateway ç»„ä»¶ä½œä¸ºæ•´ä¸ªç”Ÿæ€çš„è¡¥å…….")]),s._v(" "),t("li",[t("strong",[s._v("Service discovery")]),s._v(": å‰é¢æ¼”ç¤ºæŠ“å–æ•°æ®æ—¶, æ˜¯ç›´æ¥åœ¨ prometheus.yml ä¸­é…ç½®çš„å¤šä¸ª Targets. è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ç›´è§‚, ä½†æ˜¯ä¹Ÿæœ‰å¼Šç«¯, å…¸å‹çš„é—®é¢˜å°±æ˜¯å¦‚æœ Targets æ˜¯"),t("strong",[s._v("åŠ¨æ€å˜åŒ–")]),s._v("çš„, è€Œä¸”å˜åŒ–å¾—æ¯”è¾ƒé¢‘ç¹, é‚£å°±ä¼šé€ æˆç®¡ç†ä¸Šçš„ç¾éš¾. æ‰€ä»¥ Prometheus æä¾›äº†å¤šç§"),t("strong",[s._v("æœåŠ¡å‘ç°æœºåˆ¶")]),s._v(", å¯ä»¥åŠ¨æ€è·å–è¦ç›‘æ§çš„ç›®æ ‡, æ¯”å¦‚ Kubernetes çš„æœåŠ¡å‘ç°, å¯ä»¥é€šè¿‡è°ƒç”¨ kube-apiserver åŠ¨æ€è·å–åˆ°éœ€è¦ç›‘æ§çš„ç›®æ ‡å¯¹è±¡, å¤§å¹…é™ä½äº†æŠ“å–ç›®æ ‡çš„ç®¡ç†æˆæœ¬.")])]),s._v(" "),t("p",[s._v("æ€»ç»“å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/57d84b93f63dbc1dc5779ba257c48235-20230719203435-wuzvq3m.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_5-prometheusä¸­æœ‰å“ªäº›å…³é”®è®¾è®¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-prometheusä¸­æœ‰å“ªäº›å…³é”®è®¾è®¡"}},[s._v("#")]),s._v(" 5.Prometheusä¸­æœ‰å“ªäº›å…³é”®è®¾è®¡?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€è®²ä»‹ç»äº†å¦‚ä½•æ­å»º Prometheus ç³»ç»Ÿ, æ¼”ç¤ºäº†åŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•, è¿™ä¸€è®²æ·±å…¥è¿›å», æ¢³ç†ä¸€ä¸‹ Prometheus çš„å…³é”®è®¾è®¡, çœ‹çœ‹è¿™äº›è®¾è®¡æ˜¯å¦‚ä½•å¥ å®š Prometheus æ±Ÿæ¹–åœ°ä½çš„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c2c67694da6bb16fa0cf7318abd0c5b2-20230719203435-wxj5zcx.jpg",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"æ ‡å‡†å…ˆè¡Œä¸æ³¨é‡ç”Ÿæ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ ‡å‡†å…ˆè¡Œä¸æ³¨é‡ç”Ÿæ€"}},[s._v("#")]),s._v(" æ ‡å‡†å…ˆè¡Œä¸æ³¨é‡ç”Ÿæ€")]),s._v(" "),t("p",[s._v("Prometheus æœ€é‡è¦çš„è§„èŒƒå°±æ˜¯ "),t("mark",[t("strong",[s._v("æŒ‡æ ‡å‘½åæ–¹å¼")])]),s._v(", æ•°æ®æ ¼å¼ç®€å•æ˜“è¯», åœ¨å‰é¢å·²ç»èŠè¿‡äº†, å®ƒç”¨æ ‡ç­¾é›†æ¥æ ‡è¯†æŒ‡æ ‡. æœ‰äº›ç›‘æ§ç³»ç»Ÿä¼šæŠŠä¸€äº›ç‰¹æ®Šçš„å­—æ®µå•ç‹¬æå‡ºæ¥, æœ€å…¸å‹çš„å°±æ˜¯ hostname å­—æ®µ, è¿™ç§åšæ³•åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¼šæ˜¾å¾—æ›´æœ‰æ•ˆ. ä½†æ˜¯æ˜¾ç„¶, **ç»Ÿä¸€çš„æ ‡ç­¾é›†è¡¨è¾¾æ–¹å¼æ˜¯æœ€é€šç”¨, æœ€çµæ´»çš„. **")]),s._v(" "),t("p",[s._v("è™½ç„¶æ ‡ç­¾é›†å¾ˆçµæ´», ä½†æ˜¯åœ¨å®é™…è½åœ°æ—¶, å¼ºçƒˆå»ºè®®"),t("strong",[s._v("åœ¨å…¬å¸æ¨è¡Œä¸€ä¸ªæ ‡ç­¾å®šä¹‰è§„èŒƒ, æ ‡ç­¾ Key ä¸èƒ½éšä¾¿èµ·å, è¯¥æœ‰çš„æ ‡ç­¾ä¹Ÿä¸èƒ½ç¼ºå¤±")]),s._v(". æ—¢å‡å°‘äº†ç†è§£æˆæœ¬, ä¹Ÿä¿è¯äº†æ•°æ®çš„è§„æ•´å®Œå¤‡, ä¾¿äºåç»­åšæ•°æ®åˆ†æ. æ¯”å¦‚å¯¹äºåº”ç”¨å±‚é¢çš„ç›‘æ§, å¯ä»¥è¦æ±‚å¿…é¡»å…·å¤‡è¿™å‡ ä¸ªä¿¡æ¯.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("æŒ‡æ ‡åç§° metric")])])]),s._v(" "),t("p",[s._v("Prometheus å†…ç½®å»ºç«‹çš„è§„èŒƒå°±æ˜¯å« metric(å³ __name__). å¦‚æœæ˜¯ Counter ç±»å‹, å•è°ƒé€’å¢çš„å€¼, æŒ‡æ ‡åç§°ä»¥ _total ç»“å°¾.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("æœåŠ¡åç§° service")])])]),s._v(" "),t("p",[s._v("æœåŠ¡åç§° service è¦å…¨å±€å”¯ä¸€, æ¯”å¦‚ n9e-webapi, p8s-alertmanager, ä¸€èˆ¬æ˜¯"),t("strong",[s._v("ç³»ç»Ÿåç§°åŠ ä¸Šæ¨¡å—åç§°")]),s._v(", ç»„æˆæœ€ç»ˆçš„æœåŠ¡åç§°. å¦‚æœå…¬å¸æ¯”è¾ƒå¤§, å°±éœ€è¦ä¸€ä¸ªå…¨å±€çš„æœåŠ¡ç›®å½•åšå‚è€ƒ, å¦åˆ™ä¸åŒçš„å›¢é˜Ÿå¯èƒ½ä¼šèµ·ç›¸åŒçš„åç§°, å¯ä»¥è€ƒè™‘ä½¿ç”¨ Git é‡Œçš„ GroupName + RepoName. ç³»ç»Ÿåç§°æœ€å¥½ä¹Ÿå•ç‹¬åšæˆä¸€ä¸ªæ ‡ç­¾, æ¯”å¦‚ system=n9e system=p8s.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å®ä¾‹åç§° instance")])])]),s._v(" "),t("p",[s._v("ä¸€ä¸ªæœåŠ¡ä¸€èˆ¬ä¼šéƒ¨ç½²å¤šä¸ªå®ä¾‹, å¯ä»¥ç›´æ¥ä½¿ç”¨æœºå™¨åæˆ– Pod åä½œä¸º instance åç§°. å¦‚æœåœ¨ç‰©ç†æœºéƒ¨ç½², æœ‰å®ä¾‹æ··éƒ¨çš„æƒ…å†µ, å°±è¦æŠŠç«¯å£åŠ ä¸Š, æ¯”å¦‚å®ä¾‹ä¸€æ˜¯ 10.1.2.3:3306, å®ä¾‹äºŒæ˜¯ 10.1.2.3:3307.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("æœåŠ¡ç±»å‹ job")])])]),s._v(" "),t("p",[s._v("æ¯”å¦‚æ‰€æœ‰çš„ MySQL çš„ç›‘æ§æ•°æ®, éƒ½ç»Ÿä¸€æ‰“ä¸Š job=mysql çš„æ ‡ç­¾, Redis çš„ç›‘æ§æ•°æ®, å°±æ‰“ä¸Š job=redis çš„æ ‡ç­¾. å¦‚æœæ˜¯è‡ªç ”çš„æ¨¡å—, ä¹Ÿå¯ä»¥ä½¿ç”¨ webserver backend frontend è¿™ç§åˆ†ç±»æ–¹å¼.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("åœ°åŸŸå¯ç”¨åŒº zone")])])]),s._v(" "),t("p",[s._v("æŠŠåœ°åŸŸä¿¡æ¯æ”¾åˆ°æ ‡ç­¾é‡Œ, æœ‰ä¸ªå·¨å¤§çš„å¥½å¤„, æ¯”å¦‚æŸä¸ª zone å‡ºé—®é¢˜äº†, å°±æ¯”è¾ƒå®¹æ˜“çœ‹å‡ºæ¥, å¸¦æœ‰æŸä¸ªç‰¹å®šçš„ zone çš„æŒ‡æ ‡æ•°æ®å¼‚å¸¸, å¿«é€Ÿæ‰§è¡Œåˆ‡æµæ­¢æŸå³å¯. æœ‰äº† zone çš„ä¿¡æ¯, region å°±å¯æœ‰å¯æ— äº†, zone çš„å‰ç¼€ä¸€èˆ¬å°±æ˜¯ region.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("é›†ç¾¤åç§° cluster")])])]),s._v(" "),t("p",[s._v("æœ‰çš„æ—¶å€™ä¸€ä¸ªå¯ç”¨åŒºä¼šéƒ¨ç½²å¤šä¸ªé›†ç¾¤, ç‰¹åˆ«æ˜¯ä¸€äº›ä¸­é—´ä»¶, æ¯”å¦‚ ElasticSearch, ç»™æ¯ä¸ªé‡è¦çš„ä¸šåŠ¡å•ç‹¬éƒ¨ç½²ä¸€ä¸ªé›†ç¾¤, ä¸€ä¸ªå¤§å…¬å¸å¯èƒ½æœ‰å‡ ç™¾å¥— ElasticSearch é›†ç¾¤, å‡ åƒå¥— ZooKeeper é›†ç¾¤.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ç¯å¢ƒç±»å‹ env")])])]),s._v(" "),t("p",[s._v("ç¯å¢ƒç±»å‹ env ç”¨æ¥æ ‡è¯†æ˜¯ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯æµ‹è¯•ç¯å¢ƒ. å½“ç„¶äº†, å¦‚æœç›‘æ§ç³»ç»Ÿä¸å¤ç”¨(æ¨èè¿™ä¹ˆåš), ç”Ÿäº§ç”¨ç”Ÿäº§çš„ç›‘æ§ç³»ç»Ÿ, æµ‹è¯•ç”¨æµ‹è¯•çš„ç›‘æ§ç³»ç»Ÿ, å°±æ— éœ€è¿™ä¸ªæ ‡ç­¾äº†.")]),s._v(" "),t("p",[s._v("æŒ‡æ ‡çš„æ•°æ®æ ¼å¼å’Œä¼ è¾“åè®®åˆ¶å®šå¥½ä¹‹å, å„ç§ Exporter, å„ç§æ”¯æŒ Remote Read/Write çš„åç«¯å­˜å‚¨å°±å¯ä»¥æ¥å…¥è¿›æ¥äº†, è€Œè¿™äº› Exporter, å­˜å‚¨çš„ä¸°å¯Œå’Œç¹è£, åˆåå‘æ¨åŠ¨äº† Prometheus çš„æµè¡Œ, å½¢æˆæ­£å‘å¾ªç¯.")]),s._v(" "),t("h4",{attrs:{id:"ä¸»è¦ä½¿ç”¨æ‹‰æ¨¡å¼ä¸è§£è€¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»è¦ä½¿ç”¨æ‹‰æ¨¡å¼ä¸è§£è€¦"}},[s._v("#")]),s._v(" ä¸»è¦ä½¿ç”¨æ‹‰æ¨¡å¼ä¸è§£è€¦")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("Prometheus ä¸»è¦ä½¿ç”¨æ‹‰æ¨¡å¼è·å–æŒ‡æ ‡, è¾…ä»¥æ¨æ¨¡å¼(Pushgateway çš„èŒèƒ½)")])]),s._v(" . å¾ˆå¤šç›‘æ§ç³»ç»Ÿéƒ½æ˜¯æ¨æ¨¡å¼, æ¯”å¦‚ Datadog, Open-Falcon, Telegraf+InfluxDB ç»„åˆ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/dfdb90a4651ba7d88dc878072550357f-20230719203435-jdcgg7t.jpg",alt:""}})]),s._v(" "),t("p",[s._v("æ¨æ‹‰ä¸¤ç§æ–¹å¼, åœ¨ç›‘æ§é¢†åŸŸè®¨è®ºä¹Ÿæ¯”è¾ƒå¤š, å®ƒä»¬å„æœ‰ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯:")]),s._v(" "),t("p",[t("strong",[s._v("æ‹‰æ¨¡å¼æœ‰ä¸ªæœ€é‡è¦çš„ä¼˜åŠ¿, å°±æ˜¯è§£è€¦")]),s._v(". ä½ å¯èƒ½ä¹‹å‰å¬å¾ˆå¤šäººè¯´è¿‡è¿™ä¸ªä¼˜åŠ¿, ä½†æœªå¿…èƒ½ä½“ä¼šåˆ°è§£è€¦è§£åœ¨äº†å“ªé‡Œ, ä¸¾ä¸€ä¸ªä¾‹å­å°±çŸ¥é“äº†.")]),s._v(" "),t("p",[s._v("å¯¹äºå„ç±»ä¸­é—´ä»¶, ç‰¹åˆ«æ˜¯éå¸¸åŸºç¡€çš„é‚£äº›, å¾ˆå¤§æ¦‚ç‡æ˜¯å…ˆäºç›‘æ§ç³»ç»Ÿéƒ¨ç½²çš„. å¦‚æœæ˜¯æ‹‰æ¨¡å¼, éƒ¨ç½²å¥½ç›‘æ§ç³»ç»Ÿä¹‹å, å†æ¥è°ƒç”¨ä¸­é—´ä»¶çš„æ¥å£è·å–æ•°æ®å³å¯. å¦‚æœæ˜¯æ¨æ¨¡å¼, å°±éœ€è¦åœ¨ä¸­é—´ä»¶é‡Œé‡æ–°é…ç½®ç›‘æ§æ•°æ®ä¸ŠæŠ¥åœ°å€, ç„¶åé‡å¯ä¸­é—´ä»¶, è¿™ä¸ªä»£ä»·å°±å¤ªé«˜äº†.")]),s._v(" "),t("p",[s._v("ä½†æ˜¯æ‹‰æ¨¡å¼éœ€è¦æœ‰å¾ˆå¥½çš„æœåŠ¡å‘ç°æœºåˆ¶, å¦‚æœåªæœ‰å°‘é‡çš„å‡ ä¸ªç›®æ ‡è¦é‡‡é›†, æ€ä¹ˆæéƒ½å¯ä»¥, ä½†æ˜¯æœ‰å‡ ç™¾ä¸ªçš„æ—¶å€™, æ‰‹å·¥é…ç½®å°±æ¯”è¾ƒéº»çƒ¦äº†. "),t("strong",[s._v("æ‰€ä»¥ Prometheus æ”¯æŒå„ç§æœåŠ¡å‘ç°æœºåˆ¶, å°¤å…¶æ˜¯åŸºäº Kubernetes çš„æœåŠ¡å‘ç°æœºåˆ¶, æ˜¯æœ€å¸¸è§çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æœæœåŠ¡æ²¡æœ‰éƒ¨ç½²åœ¨ Kubernetes ä¸­, è€Œæ˜¯éƒ¨ç½²åœ¨ä¼ ç»Ÿç‰©ç†æœºæˆ–è™šæ‹Ÿæœºä¸Š, è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ Consul ä¹‹ç±»çš„æœåŠ¡å‘ç°æœºåˆ¶. ä½†å¦‚æœåœ¨ç›‘æ§ä½“ç³»å»ºè®¾ä¹‹å‰, æœåŠ¡æ²¡æœ‰æ¥å…¥æ³¨å†Œä¸­å¿ƒ, ä¸ºäº†æ»¡è¶³ç›‘æ§éœ€æ±‚è€Œæ¥å…¥æ³¨å†Œä¸­å¿ƒ, ç”¨æˆ·ä¼šè§‰å¾—æˆæœ¬å¤ªé«˜. æ­¤æ—¶æ¨æ¨¡å¼å°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°, è¿™å°±æ˜¯å¾ˆå¤šå…¬å¸çš„è‡ªç ”æœåŠ¡éƒ½ä½¿ç”¨æ¨æ¨¡å¼å‘é€ç›‘æ§æ•°æ®çš„åŸå› .")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ç»“è®ºå°±æ¥äº†: "),t("strong",[s._v("ä¸­é—´ä»¶ç±»ä½¿ç”¨æ‹‰æ¨¡å¼, è‡ªç ”çš„æœåŠ¡ä½¿ç”¨æ¨æ¨¡å¼, è‡ªç ”çš„æœåŠ¡å¦‚æœéƒ½æ¥å…¥äº†æ³¨å†Œä¸­å¿ƒ, åˆ™ä¹Ÿå¯ä»¥ä½¿ç”¨æ‹‰æ¨¡å¼")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶, æ¨æ‹‰çš„é€‰æ‹©è¿˜æœ‰ä¸€ä¸ªç‚¹æ¯”è¾ƒå…³é”®, å°±æ˜¯ "),t("strong",[s._v("ç½‘ç»œé€šè·¯é—®é¢˜")]),s._v(", ç‰¹åˆ«æ˜¯ç½‘ç»œ ACL é™åˆ¶æ¯”è¾ƒä¸¥æ ¼çš„ç¯å¢ƒ, å¾ˆå¤šéƒ½æ˜¯å¯å‡ºä¸å¯è¿›, æ¯”å¦‚å…¸å‹çš„ NAT å‡ºç½‘, è¿™ç§æƒ…å†µä¸‹æ¨æ¨¡å¼çš„é€‚é…æ€§æ›´å¥½, ä¹Ÿå°±æ˜¯è¯´å¯¹ ACL æ›´å‹å¥½ä¸€äº›. å¦ä¸€ä¸ªå…³é”®ç‚¹æ˜¯ "),t("strong",[s._v("çŸ­å‘¨æœŸä»»åŠ¡æˆ–æ‰¹å¤„ç†ä»»åŠ¡")]),s._v(", é€šå¸¸ä¸å¤ªå¯èƒ½ç›‘å¬ HTTP ç«¯å£, è¿™ç§å¤§æ¦‚ç‡ä¹Ÿæ˜¯æ¨æ¨¡å¼.")]),s._v(" "),t("p",[s._v("æ¨æ‹‰æ¨¡å¼çš„é€‰æ‹©, è¿˜æœ‰ä¸€äº›å…¶ä»–å½±å“å› ç´ , æ¯”å¦‚æ¨æ¨¡å¼æœåŠ¡ç«¯é€šå¸¸æ¯”è¾ƒå®¹æ˜“å¤„ç†, å› ä¸ºæ•°æ®æ¥æ”¶æ˜¯æ— çŠ¶æ€çš„. ä½†æ˜¯æ‹‰æ¨¡å¼åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™è¦è€ƒè™‘åˆ†ç‰‡çš„é—®é¢˜, è¿˜æœ‰å°±æ˜¯å¤±è”å‘Šè­¦é—®é¢˜, æ‹‰æ¨¡å¼å¾ˆå®¹æ˜“æ„ŸçŸ¥åˆ°ç›®æ ‡å¤±è”. æ¨æ¨¡å¼å°±æ¯”è¾ƒå¤æ‚äº†, éœ€è¦å¯¹æ•°æ®ç¼ºå¤±åšå‘Šè­¦, æ¯”å¦‚  Prometheus çš„ absent å‡½æ•°, absent å‡½æ•°éœ€è¦æŠŠæŒ‡æ ‡çš„æ¯ä¸ªæ ‡ç­¾éƒ½å†™å…¨, æ‰èƒ½è¾¾åˆ°é¢„æœŸæ•ˆæœ. è€ŒæŒ‡æ ‡æ•°é‡ä½•æ­¢åƒä¸‡, å‡ ä¹ä¸å¯èƒ½å®Œæˆ.")]),s._v(" "),t("p",[s._v('æœ€åå°±æ˜¯å¯æ§æ€§é—®é¢˜, æ‹‰æ¨¡å¼, ç›‘æ§ç³»ç»Ÿæ˜¯ä¸»åŠ¨çš„ä¸€æ–¹, å¯ä»¥æ§åˆ¶é¢‘ç‡; æ¨æ¨¡å¼, å®¢æˆ·ç«¯æ˜¯ä¸»åŠ¨çš„ä¸€æ–¹, å¦‚æœä»£ç å†™"æŒ«"äº†, å°±ä¼šç»™ç›‘æ§ç³»ç»Ÿé€ æˆå¾ˆå¤§å‹åŠ›.')]),s._v(" "),t("p",[s._v("å‰é¢æˆ‘ä»¬æåˆ°æ‹‰æ¨¡å¼éœ€è¦æœ‰å¾ˆå¥½çš„æœåŠ¡å‘ç°æœºåˆ¶, Prometheus é‡‡å–çš„å°±æ˜¯æ‹‰æ¨¡å¼, å› æ­¤å®ƒå¯¹ç›‘æ§ç›®æ ‡åŠ¨æ€å‘ç°æœºåˆ¶çš„è‹›æ±‚åº¦å¾ˆé«˜.")]),s._v(" "),t("h4",{attrs:{id:"ç›‘æ§ç›®æ ‡åŠ¨æ€å‘ç°æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§ç›®æ ‡åŠ¨æ€å‘ç°æœºåˆ¶"}},[s._v("#")]),s._v(" ç›‘æ§ç›®æ ‡åŠ¨æ€å‘ç°æœºåˆ¶")]),s._v(" "),t("p",[s._v("ç›‘æ§ç›®æ ‡åŠ¨æ€å‘ç°æœºåˆ¶, è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆæ—©å°±æœ‰, è€ä¸€äº›çš„ç›‘æ§ç³»ç»Ÿ, æ¯”å¦‚ Zabbix, æ˜¯èµ„äº§ç®¡ç†å¼, è¦ç›‘æ§çš„ç›®æ ‡éƒ½éœ€è¦åœ¨æœåŠ¡ç«¯æ³¨å†Œ, é…ç½®. è¿™ç§æ–¹å¼åœ¨ç›‘æ§ç›®æ ‡åé™æ€çš„åœºæ™¯è¿˜æ˜¯æ¯”è¾ƒå¥½ç”¨çš„, ä½†æ˜¯"),t("strong",[s._v("äº‘åŸç”Ÿä¹‹å, åŸºç¡€è®¾æ–½åŠ¨æ€åŒ–, ç›‘æ§ç›®æ ‡çš„åˆ›å»º, é”€æ¯éƒ½æ¯”è¾ƒé¢‘ç¹, å°±éœ€è¦æœ‰ä¸€ä¸ªæ›´è‡ªåŠ¨åŒ–çš„æœºåˆ¶æ¥è·å–ç›‘æ§ç›®æ ‡åˆ—è¡¨")]),s._v(".")]),s._v(" "),t("p",[s._v("Prometheus å†…ç½®äº†å¤šç§æœåŠ¡å‘ç°æœºåˆ¶, æœ€å¸¸è§çš„æœ‰å››ç§.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("åŸºäºé…ç½®æ–‡ä»¶çš„å‘ç°æœºåˆ¶")]),s._v(": è¿™ç§æ–¹å¼çœ‹èµ·æ¥å¾ˆä½ç«¯, å…¶å®éå¸¸å¸¸ç”¨, å› ä¸ºå¯ä»¥é…åˆé…ç½®ç®¡ç†å·¥å…·ä¸€èµ·ä½¿ç”¨, éå¸¸æ–¹ä¾¿. ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·æ‰¹é‡æ›´æ–°é…ç½®, ç„¶åè®©ç›‘æ§ç³»ç»Ÿé‡æ–°åŠ è½½ä¸€ä¸‹å°±å¯ä»¥äº†, æ¯”è¾ƒä¸æ»‘.")]),s._v(" "),t("li",[t("strong",[s._v("åŸºäº Kubernetes çš„å‘ç°æœºåˆ¶")]),s._v(": Kubernetes ä¸­æœ‰å¾ˆå¤šå…ƒä¿¡æ¯, é€šè¿‡è°ƒç”¨ kube-apiserver, å¯ä»¥è½»æ˜“æ‹¿åˆ° Pod, Node, Endpoint ç­‰åˆ—è¡¨, Prometheus å†…ç½®æ”¯æŒäº† Kubernetes çš„æœåŠ¡å‘ç°æœºåˆ¶, è®©è¿™ä¸ªè¿‡ç¨‹å˜å¾—æ›´ç®€å•, Prometheus åŸºæœ¬æˆä¸ºäº† Kubernetes ç›‘æ§çš„æ ‡é….")]),s._v(" "),t("li",[t("strong",[s._v("åŸºäºå…¬æœ‰äº‘ API çš„å‘ç°æœºåˆ¶")]),s._v(": æ¯”å¦‚è¦ç›‘æ§å…¬æœ‰äº‘ä¸Šæ‰€æœ‰çš„ RDS æœåŠ¡, ä¸€æ¡ä¸€æ¡é…ç½®æ¯”è¾ƒéº»çƒ¦, è¿™ä¸ªæ—¶å€™å°±å¯ä»¥åŸºäºå…¬æœ‰äº‘çš„ OpenAPI åšä¸€ä¸ªæœåŠ¡å‘ç°æœºåˆ¶, è‡ªåŠ¨æ‹‰å–ç›¸å…³è´¦å·ä¸‹æ‰€æœ‰ RDS å®ä¾‹åˆ—è¡¨, å¤§å¹…é™ä½ç®¡ç†æˆæœ¬.")]),s._v(" "),t("li",[t("strong",[s._v("åŸºäºæ³¨å†Œä¸­å¿ƒçš„å‘ç°æœºåˆ¶")]),s._v(": ç¤¾åŒºé‡Œæœ€ä¸ºå¸¸ç”¨çš„æ˜¯ Consul, å…¸å‹åœºæ™¯æ˜¯ PING ç›‘æ§å’Œ HTTP ç›‘æ§, æŠŠæ‰€æœ‰ç›®æ ‡æ³¨å†Œåˆ° Consul ä¸­, ç„¶åè¯»å– Consul ç”Ÿæˆç›‘æ§å¯¹è±¡åˆ—è¡¨å³å¯.")])]),s._v(" "),t("p",[s._v("è¿™å°±æ˜¯ Prometheus æ”¯æŒçš„å‡ ä¸ªä¸»è¦çš„æœåŠ¡å‘ç°æœºåˆ¶, å½“ç„¶è¿˜æœ‰å…¶ä»–æ–¹å¼, ä½†ç”¨å¾—æ²¡é‚£ä¹ˆå¤š, è¿™é‡Œå°±å…ˆä¸ä»‹ç»äº†.")]),s._v(" "),t("h4",{attrs:{id:"åŸºäºé…ç½®æ–‡ä»¶çš„ç®¡ç†æ–¹å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºé…ç½®æ–‡ä»¶çš„ç®¡ç†æ–¹å¼"}},[s._v("#")]),s._v(" åŸºäºé…ç½®æ–‡ä»¶çš„ç®¡ç†æ–¹å¼")]),s._v(" "),t("p",[t("strong",[s._v("Prometheus çš„å‘Šè­¦è§„åˆ™ç®¡ç†, è®°å½•è§„åˆ™ç®¡ç†, æŠ“å–é…ç½®ç®¡ç†ä¸å‘é€ç­–ç•¥ç®¡ç†, å…¨éƒ¨æ˜¯åŸºäºé…ç½®æ–‡ä»¶çš„")]),s._v(", è¿™è™½ç„¶ä¸æ˜¯ä¸€ä¸ªå…³é”®è®¾è®¡, ä½†ç¡®å®æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç‰¹è‰²çš„è®¾è®¡, è¿™é‡Œä¹Ÿç®€å•èŠä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ–¹å¼æœ‰ä¸¤ä¸ªå¥½å¤„, ä¸€ä¸ªæ˜¯ç®€å•, ç®€å•åˆ°ä»¤äººå‘æŒ‡, å¾ˆå¤šç›‘æ§ç³»ç»Ÿéƒ½æ˜¯ä½¿ç”¨æ•°æ®åº“æ¥å­˜å‚¨å„ç±»é…ç½®çš„, Prometheus åˆ™ç›´æ¥ä½¿ç”¨ Yaml æ–‡ä»¶, éå¸¸ç›´è§‚. ç¬¬äºŒä¸ªå¥½å¤„å°±æ˜¯ä¾¿äºè‡ªåŠ¨åŒ–, é…åˆé…ç½®ç®¡ç†å·¥å…·, Git, Kubernetes ç­‰, ä¸ Infrastructure as Code  çš„ç®¡ç†é£æ½®éå¸¸å¥‘åˆ.")]),s._v(" "),t("p",[s._v("å½“ç„¶è¿™æ ·ç®¡ç†ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜, å°±æ˜¯ä¸ä¾¿äºå…¬å¸çº§åä½œ, æ¯”å¦‚å…¬å¸æœ‰ 30 æ¡ä¸šåŠ¡çº¿, æ•°ç™¾ä¸ªæœåŠ¡, ä¸Šåƒä¸ªç ”å‘, å¤§å®¶éƒ½æ¥ç®¡ç†ä¸€å¥—é…ç½®, ä¼šéå¸¸æ··ä¹±. æ‰€ä»¥å¾ˆå¤šå…¬å¸çš„åšæ³•æ˜¯ç”±ä¸€ä¸ªä¸“èŒçš„è¿ç»´å›¢é˜Ÿæ¥ç®¡ç†è¿™å¥—é…ç½®, å…¶ä»–ä¸šåŠ¡çº¿ç ”å‘æœ‰éœ€æ±‚äº†å°±ç»™è¿™ä¸ªè¿ç»´å›¢é˜Ÿæå·¥å•, è¿™ç§åšæ³•ä¹Ÿå‡‘åˆèƒ½ç”¨, åªæ˜¯è‹¦äº†è¿™ä¸ªè¿ç»´å›¢é˜Ÿ, å›¢é˜Ÿæˆå‘˜æ¯”è¾ƒå®¹æ˜“äº§ç”Ÿç„¦èºæƒ…ç»ª.")]),s._v(" "),t("p",[s._v("å¦å¤–, Prometheus é»˜è®¤æ˜¯"),t("strong",[s._v("å•æœºæ—¶åºå­˜å‚¨")]),s._v(', å®¹é‡æœ‰ä¸Šé™, åŸºäºé…ç½®ç®¡ç†çš„é—®é¢˜å’Œå®¹é‡é—®é¢˜, éå¸¸å»ºè®®é‚£äº›æ¨è¡Œ DevOps çš„å›¢é˜Ÿæ¥ä½¿ç”¨, è€Œä¸”æ˜¯æ¯ä¸ªå›¢é˜Ÿè‡ªå·±æœ‰ä¸€å¥—å•ç‹¬çš„ Prometheus, äº’ä¸å¹²æ‰°, æ­£æ‰€è°“ "You build it. You Run it. You monitor it. You own it".')]),s._v(" "),t("p",[s._v("å½“ç„¶è¿™æ ·ä¹Ÿä¼šå¸¦æ¥é—®é¢˜, æœ€å…¸å‹çš„æ˜¯æ•°æ®å­¤å²›é—®é¢˜, ä¸è¿‡å¯ä»¥æŠŠå„ä¸ª Prometheus ä¸­çš„æ ¸å¿ƒå…³é”®æŒ‡æ ‡æŠ½å–åˆ°ä¸€ä¸ªç»Ÿä¸€çš„åœ°æ–¹æ¥å‘ˆç°, æ¯”å¦‚ä½¿ç”¨ Prometheus è”é‚¦æœºåˆ¶, "),t("strong",[s._v("åªå…±äº«æ ¸å¿ƒæŒ‡æ ‡")]),s._v(", å…¶ä½™æŒ‡æ ‡ä¸éœ€è¦æŠ½å–åˆ°ä¸­å¿ƒ, è‡ªå·±å›¢é˜Ÿæ¶ˆåŒ–å°±å¥½.")]),s._v(" "),t("p",[s._v("åé¢ä¹Ÿä¼šä½¿ç”¨ Nightingale æ¥å¢å¼º Prometheus çš„é…ç½®ç®¡ç†é—®é¢˜, ç®—æ˜¯å¦ä¸€ä¸ªæ€è·¯.")]),s._v(" "),t("h4",{attrs:{id:"çµæ´»çš„æŸ¥è¯¢è¯­è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#çµæ´»çš„æŸ¥è¯¢è¯­è¨€"}},[s._v("#")]),s._v(" çµæ´»çš„æŸ¥è¯¢è¯­è¨€")]),s._v(" "),t("p",[t("strong",[s._v("PromQL")]),s._v("(Prometheus Query Language)æ˜¯ Prometheus çš„æŸ¥è¯¢è¯­è¨€, éå¸¸çµæ´». è¿™ä¹Ÿæ˜¯ Prometheus çš„ä¸€ä¸ªå…³é”®è®¾è®¡.")]),s._v(" "),t("p",[s._v("å¾ˆå¤šè€ä¸€ä»£ç›‘æ§ç³»ç»Ÿéƒ½åªèƒ½å¯¹æ•°æ®åšç®€å•è¿‡æ»¤åˆ¤æ–­é˜ˆå€¼, æ²¡æœ‰ QL çš„æ”¯æŒ. å½“æƒ³è¦æŸä¸ªæ•°æ®å´å‘ç°æ²¡æœ‰çš„æ—¶å€™, å°±å¤©ç„¶å€¾å‘äºåœ¨é‡‡é›†ä¾§å¤„ç†, ä½†æ˜¯ "),t("mark",[t("strong",[s._v("é‡‡é›†ä¾§æ˜¯æ— æ³•ç©·ä¸¾æ‰€æœ‰è®¡ç®—åœºæ™¯çš„, é‡‡é›†ä¾§åº”è¯¥é‡‡é›†åŸå§‹æ•°æ®, åç»­çš„äºŒæ¬¡è®¡ç®—è¿˜æ˜¯åº”è¯¥æ”¾åˆ°ä¸­å¿ƒæ¥æå®š")])]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚æœºå™¨çš„å†…å­˜æŒ‡æ ‡, å¯ä»¥ä» "),t("code",[s._v("cat /proc/meminfo")]),s._v("â€‹ ä¸­çœ‹åˆ°å¾ˆå¤šå†…å­˜ç›¸å…³çš„ç›‘æ§æŒ‡æ ‡, é‡‡é›†å™¨å¯ä»¥è½»æ˜“æ‹¿åˆ° MemAvailable å’Œ MemTotal è¿™æ ·çš„å­—æ®µ, ä½†æ˜¯æ“ä½œç³»ç»Ÿä¸ä¼šç›´æ¥æš´éœ²å†…å­˜å¯ç”¨ç‡, æ­¤æ—¶å°±éœ€è¦ä½¿ç”¨ PromQL: MemAvailable / MemTotal * 100  åšäºŒæ¬¡è®¡ç®—äº†. å› ä¸ºè¿™ä¸ªåœºæ™¯å¾ˆå¸¸è§, æœ‰çš„é‡‡é›†å™¨å°±ç›´æ¥è‡ªåŠ¨åšäº†è®¡ç®—, è¾“å‡º mem_available_percent è¿™æ ·çš„æŒ‡æ ‡. ä½†æ˜¯è¿˜æœ‰å¾ˆå¤šåœºæ™¯æ˜¯ä¸å¥½ç©·ä¸¾çš„, ä¸‹é¢å†ä¸¾ä¸ªä¾‹å­.")]),s._v(" "),t("p",[s._v("æœ‰ä¸€äº›ç›‘æ§æ•°æ®çš„é‡‡é›†, æ˜¯"),t("strong",[s._v("å®Œå…¨ç”±ç”¨æˆ·é…ç½®")]),s._v("å‡ºæ¥çš„, æ¯”å¦‚ SNMP æ•°æ®é‡‡é›†, é‡‡é›†å“ªäº› OID æ˜¯ç”¨æˆ·é…ç½®çš„; JMX æ•°æ®é‡‡é›†, é‡‡é›†å“ªäº› MBean, å“ªäº› Pattern ä¹Ÿæ˜¯ç”¨æˆ·é…ç½®çš„. ç›‘æ§é‡‡é›†å™¨å‹æ ¹å°±ä¸çŸ¥é“è¿™äº›æ•°æ®çš„å…·ä½“è¯­ä¹‰, åªæœ‰é…ç½®é‡‡é›†è§„åˆ™çš„äººçŸ¥é“, è¿™ç§æƒ…å†µæ›´ä¸å¯èƒ½è‡ªåŠ¨è®¡ç®—, é‡‡é›†å™¨åªèƒ½é‡‡é›†åŸå§‹æ•°æ®, å¦‚æœæœ‰äºŒæ¬¡è®¡ç®—çš„éœ€æ±‚, æœ€å¥½æ˜¯è®¾è®¡åˆ°æœåŠ¡ç«¯, è®©æœåŠ¡ç«¯æ¥åš.")]),s._v(" "),t("p",[s._v("PromQL ä¸ºäºŒæ¬¡è®¡ç®—"),t("strong",[s._v("æä¾›äº†èƒ½åŠ›æ”¯æŒ, å¤šä¸ªæŒ‡æ ‡çš„å…³è”è®¡ç®—, å¤šæ¡ä»¶è”åˆå‘Šè­¦, éƒ½å¯ä»¥ç”¨ PromQL æ¥å®ç°")]),s._v(", ä½œä¸ºç°ä»£ç›‘æ§ç³»ç»Ÿ, Query Language å·²ç»æ˜¯å¿…å¤‡è¦æ±‚äº†.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-4"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²ä»‹ç»äº†ä¸€äº› Prometheus çš„å…³é”®è®¾è®¡, è¿™äº›è®¾è®¡æˆå°±äº† Prometheus. ä¸‹é¢å¯¹è¿™ä¸€è®²çš„å†…å®¹åšä¸€ä¸ªç®€å•çš„å›é¡¾.")]),s._v(" "),t("ul",[t("li",[s._v("Prometheus éå¸¸æ³¨é‡æ ‡å‡†åˆ¶å®šå’Œç”Ÿæ€å»ºè®¾, è€Œä¸”æ ‡å‡†å¾ˆç¨³å®š, æ²¡æœ‰å˜æ¥å˜å», ç¤¾åŒºæœ‰å¾ˆå¤šäººå‚ä¸å…¶ä¸­, å…±å»ºæ•´å¥—ç”Ÿæ€. Prometheus ä¸æœŸæœ›è§£å†³æ‰€æœ‰é—®é¢˜, ä½†æ˜¯å½±å“åŠ›å·¨å¤§, å°±æ˜¯å› ä¸ºæ ‡å‡†å’Œç”Ÿæ€çš„å¼ºå¤§.")]),s._v(" "),t("li",[s._v("Prometheus ä¸»è¦ä½¿ç”¨æ‹‰æ¨¡å¼, è¾…ä»¥æ¨æ¨¡å¼. è¿™é‡Œæ¯”è¾ƒäº†æ¨æ‹‰ä¸¤ç§æ¨¡å¼, ç®€å•æ¥çœ‹, "),t("strong",[s._v("æ‹‰æ¨¡å¼ä¾¿äºè§£è€¦, æ¨æ¨¡å¼åˆ™æ›´ç®€å•")]),s._v(". ä¸­é—´ä»¶ç›‘æ§é€‚åˆæ‹‰æ¨¡å¼, è‡ªç ”æ¨¡å—é€‚åˆæ¨æ¨¡å¼. å½“ç„¶å¦‚æœæ³¨å†Œä¸­å¿ƒå®Œå¤‡, æœåŠ¡éƒ½æ¥å…¥äº†æ³¨å†Œä¸­å¿ƒ, æœåŠ¡ç›‘æ§çš„æ•°æ®é‡‡é›†ä¹Ÿå¯ä»¥ä½¿ç”¨æ‹‰æ¨¡å¼.")]),s._v(" "),t("li",[s._v("æ‹‰æ¨¡å¼æ›´éœ€è¦ç›‘æ§ç›®æ ‡åŠ¨æ€å‘ç°æœºåˆ¶, ä¸»è¦ä½¿ç”¨æ‹‰æ¨¡å‹çš„ Prometheus å†…ç½®äº†å¤šç§å‘ç°æœºåˆ¶, æœ€å¸¸ç”¨çš„æ˜¯åŸºäºé…ç½®æ–‡ä»¶,  Kubernetes, å…¬æœ‰äº‘ API, Consul å››ç§å‘ç°æœºåˆ¶.")]),s._v(" "),t("li",[s._v("Prometheus çš„é…ç½®ç®¡ç†éå¸¸ç®€å•, ç›´æ¥ä½¿ç”¨ Yaml æ–‡ä»¶, å¾ˆç›´è§‚, ä¾¿äºæ¨è¡Œ laC ç®¡ç†æ¨¡å¼, åªæ˜¯åœ¨å…¬å¸çº§å¤§è§„æ¨¡ååŒçš„æ—¶å€™ä¼šæœ‰äº›ä¸æ–¹ä¾¿. å½“ç„¶å›½å†…çš„å¤§éƒ¨åˆ†ä¼ä¸šæ²¡æœ‰è·µè¡Œ IaC, Yaml é…ç½®çš„æ–¹å¼ä¼šç›¸å¯¹éš¾æä¸€äº›.")]),s._v(" "),t("li",[s._v("Prometheus æŸ¥è¯¢è¯­è¨€å°±æ˜¯ PromQL, è¿™ä¹Ÿæ˜¯å®ƒæœ€åä¸€ä¸ªå…³é”®è®¾è®¡, è®©é‡‡é›†ä¾§ä¸“æ³¨é‡‡é›†, æœåŠ¡ç«¯æä¾›çµæ´»çš„è®¡ç®—èƒ½åŠ›, æœ‰äº›åä¼ ç»Ÿçš„ä¼ä¸šéš¾ä»¥æ¥å—è¿™ç§åšæ³•, åªæƒ³ç®€å•è¿‡æ»¤æŒ‡æ ‡æ¥é…ç½®é˜ˆå€¼, å¾ˆéš¾æŠŠ PromQL çš„ä¼˜åŠ¿å‘æŒ¥å‡ºæ¥, éå¸¸å¯æƒœ.")])]),s._v(" "),t("p",[s._v("è„‘å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/717634c46dbb97da5484ce6411ef1c4b-20230719203435-8wnrdj6.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_6-promqlæœ‰å“ªäº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-promqlæœ‰å“ªäº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯"}},[s._v("#")]),s._v(" 6.PromQLæœ‰å“ªäº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€è®²ä»‹ç»äº† Prometheus ä¸­çš„ä¸€äº›å…³é”®è®¾è®¡, æ¯”å¦‚æ³¨é‡æ ‡å‡†å’Œç”Ÿæ€, ç›‘æ§ç›®æ ‡åŠ¨æ€å‘ç°æœºåˆ¶, PromQL ç­‰, å…¶ä¸­ PromQL æ˜¯ Prometheus çš„æŸ¥è¯¢è¯­è¨€, ä½¿ç”¨èµ·æ¥éå¸¸çµæ´»æ–¹ä¾¿, ä½†å¾ˆå¤šäººä¸çŸ¥é“å¦‚ä½•æ›´å¥½åœ°åˆ©ç”¨å®ƒ, å‘æŒ¥ä¸å‡ºå®ƒçš„ä¼˜åŠ¿. æ‰€ä»¥è¿™ä¸€è®²å°±æ¥æ¢³ç†ä¸€ä¸‹ PromQL çš„å…¸å‹åº”ç”¨åœºæ™¯.")]),s._v(" "),t("p",[t("strong",[s._v("PromQL ä¸»è¦ç”¨äºæ—¶åºæ•°æ®çš„æŸ¥è¯¢å’ŒäºŒæ¬¡è®¡ç®—åœºæ™¯")]),s._v(". å…ˆæ¥å›é¡¾ä¸€ä¸‹æ—¶åºæ•°æ®, åœ¨è„‘å­é‡Œå»ºç«‹èµ·æ—¶åºæ•°æ®çš„å…·è±¡è§†å›¾.")]),s._v(" "),t("h4",{attrs:{id:"æ—¶åºæ•°æ®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ—¶åºæ•°æ®"}},[s._v("#")]),s._v(" æ—¶åºæ•°æ®")]),s._v(" "),t("p",[s._v("å¯ä»¥æŠŠæ—¶åºæ•°æ®ç†è§£æˆä¸€ä¸ª**ä»¥æ—¶é—´ä¸ºè½´çš„çŸ©é˜µ. ** å¦‚ä¸‹æœ‰ä¸‰ä¸ªæ—¶é—´åºåˆ—, åœ¨æ—¶é—´è½´ä¸Šåˆ†åˆ«å¯¹åº”ä¸åŒçš„å€¼.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("^\nâ”‚     . . . . . . . . . .   node_load1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('host="host01"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('zone="bj"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nâ”‚     . . . . . . . . . .   node_load1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('host="host02"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('zone="sh"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nâ”‚     . . . . . . . . . .   node_load1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('host="host11"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('zone="sh"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nv\n<"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" æ—¶é—´ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("æ¯ä¸€ä¸ªç‚¹ç§°ä¸ºä¸€ä¸ª"),t("strong",[s._v("æ ·æœ¬")]),s._v("(sample), æ ·æœ¬ç”±ä¸‰éƒ¨åˆ†ç»„æˆ.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("æŒ‡æ ‡(metric)")]),s._v(" : metric name å’Œæè¿°å½“å‰æ ·æœ¬ç‰¹å¾çš„ labelsets.")]),s._v(" "),t("li",[t("strong",[s._v("æ—¶é—´æˆ³(timestamp)")]),s._v(" : ä¸€ä¸ªç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³.")]),s._v(" "),t("li",[t("strong",[s._v("å€¼(value)")]),s._v(" : è¡¨ç¤ºè¯¥æ—¶é—´æ ·æœ¬çš„å€¼.")])]),s._v(" "),t("p",[t("strong",[s._v("PromQL å°±æ˜¯å¯¹è¿™æ ·ä¸€æ‰¹æ ·æœ¬æ•°æ®åšæŸ¥è¯¢å’Œè®¡ç®—æ“ä½œ.")])]),s._v(" "),t("h4",{attrs:{id:"promqlå…¸å‹åº”ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promqlå…¸å‹åº”ç”¨åœºæ™¯"}},[s._v("#")]),s._v(" PromQLå…¸å‹åº”ç”¨åœºæ™¯")]),s._v(" "),t("p",[s._v("PromQL å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯æ—¶åºæ•°æ®çš„æŸ¥è¯¢å’ŒäºŒæ¬¡è®¡ç®—, è¿™ä¹Ÿæ˜¯ PromQL çš„ä¸¤ä¸ªæ ¸å¿ƒä»·å€¼, å…¶ä¸­æŸ¥è¯¢æ“ä½œé çš„å°±æ˜¯æŸ¥è¯¢é€‰æ‹©å™¨, ä¸‹é¢å°±æ¥è¯¦ç»†åœ°çœ‹ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"_1-æŸ¥è¯¢é€‰æ‹©å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æŸ¥è¯¢é€‰æ‹©å™¨"}},[s._v("#")]),s._v(" 1.æŸ¥è¯¢é€‰æ‹©å™¨")]),s._v(" "),t("p",[s._v("éšä¾¿ä¸€ä¸ªå…¬å¸, æ—¶åºæ•°æ®è‡³å°‘éƒ½æœ‰æˆåƒä¸Šä¸‡æ¡, è€Œæ¯ä¸ªç›‘æ§å›¾è¡¨çš„æ¸²æŸ“æˆ–è€…æ¯æ¡å‘Šè­¦è§„åˆ™çš„å¤„ç†, éƒ½åªæ˜¯é’ˆå¯¹æœ‰é™çš„å‡ æ¡æ•°æ®, æ‰€ä»¥  "),t("strong",[s._v("PromQL ç¬¬ä¸€ä¸ªéœ€æ±‚å°±æ˜¯è¿‡æ»¤")]),s._v(". å‡è®¾æœ‰ä¸¤ä¸ªéœ€æ±‚, ä¸€æ˜¯æŸ¥è¯¢ä¸Šæµ·æ‰€æœ‰æœºå™¨ 1 åˆ†é’Ÿçš„è´Ÿè½½, äºŒæ˜¯æŸ¥è¯¢æ‰€æœ‰ä»¥ host0 ä¸ºå‰ç¼€çš„æœºå™¨ 1 åˆ†é’Ÿçš„è´Ÿè½½. PromQL çš„å†™æ³•æ˜¯æ€æ ·çš„å‘¢? å¯ä»¥çœ‹ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é€šè¿‡ = æ¥åš zone çš„åŒ¹é…è¿‡æ»¤")]),s._v("\nnode_load1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('zone="sh"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é€šè¿‡ =~ æ¥åš host çš„æ­£åˆ™è¿‡æ»¤")]),s._v("\nnode_load1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('host=~"host0.'),t("span",{pre:!0,attrs:{class:"token important"}},[s._v('*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("mark",[t("strong",[s._v("å¤§æ‹¬å·é‡Œå†™è¿‡æ»¤æ¡ä»¶, ä¸»è¦æ˜¯é’ˆå¯¹æ ‡ç­¾è¿‡æ»¤")])]),s._v(", æ“ä½œç¬¦é™¤äº†ç­‰äºå·å’Œæ­£åˆ™åŒ¹é…ä¹‹å¤–, è¿˜æœ‰ä¸ç­‰äº "),t("code",[s._v("!=")]),s._v("â€‹ å’Œæ­£åˆ™é "),t("code",[s._v("!~")]),s._v("â€‹. éœ€è¦æ³¨æ„çš„æ˜¯, metric name ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è¿‡æ»¤æ¡ä»¶, å¯ä»¥å†™åˆ°å¤§æ‹¬å·é‡Œ, æ¯”å¦‚æƒ³åŒæ—¶æŸ¥çœ‹ä¸Šæµ·æœºå™¨çš„ load1, load5, load15 ä¸‰ä¸ªæŒ‡æ ‡, å¯ä»¥å¯¹ "),t("code",[s._v("__name__")]),s._v("â€‹, ä¹Ÿå°±æ˜¯ "),t("strong",[s._v("metric åå­—åšæ­£åˆ™è¿‡æ»¤")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('__name__=~"node_load.'),t("span",{pre:!0,attrs:{class:"token important"}},[s._v('*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' zone="sh"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä¾‹å­ä¸­, ç»™å‡ºçš„ 3 æ¡ PromQL éƒ½å«åš"),t("mark",[t("strong",[s._v("å³æ—¶æŸ¥è¯¢")])]),s._v("â€‹"),t("mark",[s._v("(Instant Query)")]),s._v(", è¿”å›çš„å†…å®¹å«åš"),t("strong",[s._v("å³æ—¶å‘é‡")]),s._v("(Instant Vector).")]),s._v(" "),t("p",[t("strong",[s._v("å³æ—¶æŸ¥è¯¢è¿”å›çš„æ˜¯å½“å‰çš„æœ€æ–°å€¼")]),s._v(", æ¯”å¦‚ 10 ç‚¹æ•´å‘èµ·çš„æŸ¥è¯¢, è¿”å›çš„å°±æ˜¯ 10 ç‚¹æ•´è¿™ä¸€æ—¶åˆ»å¯¹åº”çš„æ•°æ®. ä½†æ˜¯ç›‘æ§æ•°æ®æ˜¯å‘¨æœŸæ€§ä¸ŠæŠ¥çš„, å¹¶éæ¯æ—¶æ¯åˆ»éƒ½æœ‰æ•°æ®ä¸ŠæŠ¥, 10 ç‚¹æ•´çš„æ—¶å€™å¯èƒ½æ°æ°æ²¡æœ‰æ•°æ®è¿›æ¥, æ­¤æ—¶ Prometheus å°±ä¼šå¾€å‰çœ‹, çœ‹çœ‹ 9 ç‚¹ 59, 9 ç‚¹ 58, 9 ç‚¹ 57 ç­‰æ—¶é—´ç‚¹æœ‰æ²¡æœ‰ä¸ŠæŠ¥æ•°æ®. æœ€å¤šå¾€å‰çœ‹å¤šä¹…å‘¢?")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ•°æ®ç”± Prometheus çš„å¯åŠ¨å‚æ•° "),t("code",[s._v("--query.lookback-delta")]),s._v("â€‹ æ§åˆ¶, è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯ 5 åˆ†é’Ÿ. ä»ç›‘æ§çš„è§’åº¦æ¥çœ‹, å»ºè®®è°ƒçŸ­ä¸€äº›, æ¯”å¦‚æ”¹æˆ 1 åˆ†é’Ÿ "),t("code",[s._v("--query.lookback-delta=1m")]),s._v("â€‹. ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹, æœ‰ä¸ªå®¢æˆ·ä½¿ç”¨ Telegraf åš HTTP æ¢æµ‹, é…ç½®äº†ä¸€ä¸ªå‘Šè­¦è§„åˆ™, è¯´ response_code è¿ç»­ 3 åˆ†é’Ÿéƒ½ä¸ç­‰äº 200 æ‰å‘Šè­¦. å®é™…ä¸Šåªæœ‰ä¸€ä¸ªæ•°æ®ç‚¹çš„ response_code ä¸ç­‰äº200, è¿‡äº† 3 åˆ†é’Ÿè¿˜æ˜¯æŠ¥è­¦äº†. è¿™æ˜¯ä¸ºä»€ä¹ˆ?")]),s._v(" "),t("p",[s._v("å®é™…ä¸Š, ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› , ä¸€æ˜¯å› ä¸º Telegraf çš„ HTTP æ¢æµ‹, ä¼šé»˜è®¤æŠŠ status code æ”¾åˆ°æ ‡ç­¾é‡Œ, è¿™ä¼šå¯¼è‡´æ ‡ç­¾éç¨³æ€ç»“æ„(è¿™ä¸ªè¡Œä¸ºä¸å¤ªå¥½, æœ€å¥½æ˜¯æŠŠè¿™ç±»æ ‡ç­¾ç›´æ¥ä¸¢å¼ƒæ‰, æˆ–è€…ä½¿ç”¨ categraf, blackbox_exporter åšé‡‡é›†å™¨), å¹³æ—¶ code=200, å‡ºé—®é¢˜çš„æ—¶å€™ code=500, åœ¨ Prometheus ç”Ÿæ€é‡Œ, "),t("strong",[s._v("æ ‡ç­¾å˜äº†å°±æ˜¯æ–°çš„æ—¶é—´åºåˆ—")]),s._v("äº†.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒä¸ªåŸå› å°±è·Ÿ "),t("code",[s._v("query.lookback-delta")]),s._v("â€‹ æœ‰å…³äº†, è™½ç„¶åªæœ‰ä¸€ä¸ªç‚¹å¼‚å¸¸, ä¹Ÿå°±æ˜¯è¯´ code=500 çš„è¿™ä¸ªæ—¶é—´åºåˆ—åªæœ‰ä¸€ä¸ªç‚¹, ä½†æ˜¯å‘Šè­¦è§„åˆ™æ¯æ¬¡æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™, éƒ½æ˜¯æŸ¥åˆ°è¿™ä¸ªå¼‚å¸¸ç‚¹, è¿ç»­ 5 åˆ†é’Ÿéƒ½æ˜¯å¦‚æ­¤. æ‰€ä»¥å°±æ»¡è¶³äº†è§„åˆ™é‡Œè¿ç»­ 3 åˆ†é’Ÿæ‰å‘Šè­¦çš„è¿™ä¸ªæ¡ä»¶, è§¦å‘äº†å‘Šè­¦. è¿™å°±æ˜¯å»ºè®®æŠŠ "),t("code",[s._v("--query.lookback-delta")]),s._v("â€‹ è°ƒçŸ­çš„åŸå› .")]),s._v(" "),t("p",[s._v("é™¤äº†å³æ—¶æŸ¥è¯¢, PromQL ä¸­è¿˜æœ‰ä¸€ç§æŸ¥è¯¢, å«åš"),t("mark",[t("strong",[s._v("èŒƒå›´æŸ¥è¯¢")])]),s._v("â€‹"),t("mark",[s._v("(Range Query)")]),s._v(", è¿”å›çš„å†…å®¹å«åš Range Vector, æ¯”å¦‚ä¸‹é¢çš„ PromQL.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('__name__=~"node_load.'),t("span",{pre:!0,attrs:{class:"token important"}},[s._v('*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' zone="sh"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç›¸æ¯”å³æ—¶æŸ¥è¯¢, èŒƒå›´æŸ¥è¯¢å°±æ˜¯"),t("strong",[s._v("å¤šåŠ äº†ä¸€ä¸ªæ—¶é—´èŒƒå›´ 1 åˆ†é’Ÿ")]),s._v(". "),t("strong",[s._v("å³æ—¶æŸ¥è¯¢æ¯ä¸ªæŒ‡æ ‡è¿”å›ä¸€ä¸ªç‚¹, èŒƒå›´æŸ¥è¯¢ä¼šè¿”å›å¤šä¸ªç‚¹")]),s._v(". å‡è®¾æ•°æ® 10 ç§’é’Ÿé‡‡é›†ä¸€æ¬¡, 1 åˆ†é’Ÿæœ‰ 6 ä¸ªç‚¹, éƒ½ä¼šè¿”å›.")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://prometheus.io/docs/prometheus/latest/querying/functions/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus å®˜æ–¹æ–‡æ¡£"),t("OutboundLink")],1),s._v(" åœ¨ä»‹ç»å„ä¸ªå‡½æ•°çš„ä½¿ç”¨æ–¹æ³•çš„æ—¶å€™, éƒ½ä¼šè®²è§£"),t("strong",[s._v("å‡½æ•°å‚æ•°")]),s._v(", æ ‡æ˜æ˜¯ Range Vector è¿˜æ˜¯ Instant Vector, è¿™ä¸¤ç§æŸ¥è¯¢æ–¹å¼æ˜¯åŸºç¡€çŸ¥è¯†, éœ€è¦ç‰¢ç‰¢æŒæ¡.")]),s._v(" "),t("p",[s._v("ä¸Šé¢è¯´çš„å°±æ˜¯ PromQL ç¬¬ä¸€ä¸ªæ ¸å¿ƒä»·å€¼---"),t("mark",[t("strong",[s._v("ç­›é€‰")])]),s._v(". æ¥ä¸‹æ¥çœ‹ PromQL çš„å¦ä¸€ä¸ªæ ¸å¿ƒä»·å€¼---"),t("mark",[t("strong",[s._v("è®¡ç®—")])]),s._v(". è®¡ç®—éƒ¨åˆ†å†…å®¹æ¯”è¾ƒå¤š, æœ‰ç®—æœ¯, æ¯”è¾ƒ, é€»è¾‘, èšåˆè¿ç®—ç¬¦ç­‰, ä¸‹é¢æ¥ä¸€ä¸€çœ‹ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"_2-ç®—æœ¯è¿ç®—ç¬¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç®—æœ¯è¿ç®—ç¬¦"}},[s._v("#")]),s._v(" 2.ç®—æœ¯è¿ç®—ç¬¦")]),s._v(" "),t("p",[s._v("ç®—æœ¯è¿ç®—ç¬¦æ¯”è¾ƒç®€å•, å°±æ˜¯å¸¸ç”¨çš„åŠ å‡ä¹˜é™¤, å–æ¨¡ä¹‹ç±»çš„ç¬¦å·. è¿™é‡Œç»™å‡ºäº†ä¸¤ä¸ªä¾‹å­, å¯ä»¥ç»“åˆè¿™ä¸¤ä¸ªä¾‹å­æ¥äº†è§£å®ƒçš„åº”ç”¨åœºæ™¯.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®¡ç®—å†…å­˜å¯ç”¨ç‡, å°±æ˜¯å†…å­˜å¯ç”¨é‡é™¤ä»¥å†…å­˜æ€»é‡, åˆå¸Œæœ›æŒ‰ç…§ç™¾åˆ†æ¯”å‘ˆç°, æ‰€ä»¥æœ€åä¹˜ä»¥100")]),s._v("\nmem_available"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('app="clickhouse"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" / mem_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('app="clickhouse"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" * 100\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®¡ç®—åŒ—äº¬åŒºç½‘å£å‡ºå‘çš„é€Ÿç‡, åŸå§‹æ•°æ®çš„å•ä½æ˜¯byte, ç½‘ç»œæµé‡å•ä½ä¸€èˆ¬ç”¨bit, æ‰€ä»¥ä¹˜ä»¥8")]),s._v("\nirate(net_sent_bytes_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('zone="beijing"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(") * 8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"_3-æ¯”è¾ƒè¿ç®—ç¬¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¯”è¾ƒè¿ç®—ç¬¦"}},[s._v("#")]),s._v(" 3.æ¯”è¾ƒè¿ç®—ç¬¦")]),s._v(" "),t("p",[s._v("æ¯”è¾ƒè¿ç®—ç¬¦å°±æ˜¯å¤§äº, å°äº, ç­‰äº, ä¸ç­‰äºä¹‹ç±»çš„, ç†è§£èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•, ä½†æ˜¯æ„ä¹‰é‡å¤§, "),t("mark",[t("strong",[s._v("å‘Šè­¦è§„åˆ™çš„é€»è¾‘å°±æ˜¯é æ¯”è¾ƒè¿ç®—ç¬¦æ¥æ”¯æ’‘çš„")])]),s._v(". è¿™é‡Œä¹Ÿä¸¾ä¸¤ä¸ªä¾‹å­, ç»“åˆä¸‹é¢çš„ä¾‹å­æ¥ç†è§£ä¼šæ›´å®¹æ˜“.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("mem_available"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('app="clickhouse"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" / mem_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('app="clickhouse"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" * 100 < 20\nirate(net_sent_bytes_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('zone="beijing"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(") * 8 / 1024 / 1024 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" 700\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("å¸¦æœ‰æ¯”è¾ƒè¿ç®—ç¬¦çš„ PromQL å°±æ˜¯å‘Šè­¦è§„åˆ™çš„æ ¸å¿ƒ, æ¯”å¦‚å†…å­˜å¯ç”¨ç‡çš„å‘Šè­¦, åœ¨ Prometheus ä¸­å¯ä»¥è¿™æ ·é…ç½®")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n  rules"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MemUtil\n    expr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mem_available"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('app="clickhouse"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" / mem_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('app="clickhouse"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" * 100 < 20\n    for"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1m\n    labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      severity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" warn\n    annotations"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      summary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Mem available less than 20%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" $labels.ident "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("ä¾‹å­ä¸­çš„ "),t("strong",[s._v("expr æŒ‡å®šäº†æŸ¥è¯¢ç”¨çš„ PromQL")]),s._v(". å‘Šè­¦å¼•æ“ä¼šæ ¹æ®ç”¨æˆ·çš„é…ç½®, å‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸ¥è¯¢. å¦‚æœæŸ¥ä¸åˆ°å°±è¯´æ˜ä¸€åˆ‡æ­£å¸¸, æ²¡æœ‰æœºå™¨çš„å†…å­˜å¯ç”¨ç‡ä½äº 20%. å¦‚æœæŸ¥åˆ°äº†, å°±è¯´æ˜è§¦å‘äº†å‘Šè­¦, æŸ¥åˆ°å‡ æ¡å°±è§¦å‘å‡ æ¡å‘Šè­¦. å½“ç„¶å¶å°”ä¸€æ¬¡ä½äº 20% ä¸æ˜¯ä»€ä¹ˆå¤§äº‹, åªæœ‰è¿ç»­ 1åˆ†é’Ÿæ¯æ¬¡æŸ¥è¯¢éƒ½ä½äº 20% æ‰ä¼šå‘Šè­¦, è¿™å°±æ˜¯ "),t("code",[s._v("for: 1m")]),s._v("â€‹ å­˜åœ¨çš„æ„ä¹‰.")]),s._v(" "),t("h5",{attrs:{id:"_4-é€»è¾‘è¿ç®—ç¬¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-é€»è¾‘è¿ç®—ç¬¦"}},[s._v("#")]),s._v(" 4.é€»è¾‘è¿ç®—ç¬¦")]),s._v(" "),t("p",[s._v("é€»è¾‘è¿ç®—ç¬¦æœ‰ 3 ä¸ª, "),t("mark",[t("strong",[s._v("and, or å’Œ unless")])]),s._v(", ç”¨äº instant-vector ä¹‹é—´çš„è¿ç®—. "),t("strong",[s._v("and æ˜¯æ±‚äº¤é›†, or æ˜¯æ±‚å¹¶é›†, unless æ˜¯æ±‚å·®é›†")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¥çœ‹ä¸€ä¸ª and çš„ä½¿ç”¨åœºæ™¯.")]),s._v(" "),t("p",[s._v("å…³äºç£ç›˜çš„ä½¿ç”¨ç‡é—®é¢˜, æœ‰çš„åˆ†åŒºå¾ˆå¤§, æ¯”å¦‚ 16T, æœ‰çš„åˆ†åŒºå¾ˆå°, æ¯”å¦‚ 50G, åƒè¿™ç§æƒ…å†µå¦‚æœåªæ˜¯ç”¨ç£ç›˜çš„ä½¿ç”¨ç‡åšå‘Šè­¦å°±ä¸å¤ªåˆç†, æ¯”å¦‚ "),t("code",[s._v('disk_used_percent{app="clickhouse"} > 70')]),s._v("â€‹ è¡¨ç¤ºç£ç›˜ä½¿ç”¨ç‡å¤§äº 70% å°±å‘Šè­¦. å¯¹äºå°ç›˜, è¿™ä¸ªç­–ç•¥æ˜¯åˆç†çš„, ä½†å¯¹äºå¤§ç›˜, 70% çš„ä½¿ç”¨ç‡è¡¨ç¤ºè¿˜æœ‰éå¸¸å¤šçš„ç©ºé—´, å°±ä¸å¤ªåˆç†. è¿™æ—¶å¸Œæœ›ç»™è¿™ä¸ªç­–ç•¥åŠ ä¸€ä¸ªé™åˆ¶, åªæœ‰å°äº 200G çš„ç¡¬ç›˜åœ¨ä½¿ç”¨ç‡è¶…è¿‡ 70% çš„æ—¶å€™, æ‰éœ€è¦å‘Šè­¦, è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ and è¿ç®—ç¬¦, å¯ä»¥çœ‹ä¸€ä¸‹æœ€ç»ˆ PromQL.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("disk_used_percent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('app="clickhouse"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" 70 and disk_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('app="clickhouse"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/1024/1024/1024 < 200\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç®—æœ¯, æ¯”è¾ƒ, é€»è¾‘è¿ç®—ç¬¦, åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç®€å•, ä½†å¦‚æœè¿ç®—ç¬¦ä¸¤ä¾§çš„å‘é‡æ ‡ç­¾ä¸ç»Ÿä¸€, å°±ä¼šé¢ä¸´ä¸€äº›æ›´å¤æ‚çš„å¤„ç†é€»è¾‘, éœ€è¦åœ¨ PromQL ä¸­ç»™å‡º"),t("strong",[s._v("å‘é‡åŒ¹é…è§„åˆ™")]),s._v(", ä¸‹é¢å°±æ¥ä¸€èµ·çœ‹ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"_5-å‘é‡åŒ¹é…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-å‘é‡åŒ¹é…"}},[s._v("#")]),s._v(" 5.å‘é‡åŒ¹é…")]),s._v(" "),t("p",[t("strong",[s._v("å‘é‡ä¹‹é—´çš„æ“ä½œæ˜¯æƒ³è¦åœ¨å³ä¾§çš„å‘é‡ä¸­, ä¸ºå·¦ä¾§å‘é‡çš„æ¯ä¸ªæ¡ç›®æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ , åŒ¹é…è¡Œä¸ºåˆ†ä¸º: one-to-one, many-to-one, one-to-many")]),s._v(". åˆšæ‰ä»‹ç»çš„ç£ç›˜ä½¿ç”¨ç‡çš„ä¾‹å­, å°±æ˜¯å…¸å‹çš„ one-to-one ç±»å‹, å·¦å³ä¸¤ä¾§çš„æŒ‡æ ‡, é™¤äº†æŒ‡æ ‡å, å…¶ä½™æ ‡ç­¾éƒ½æ˜¯ä¸€æ ·çš„, éå¸¸å®¹æ˜“æ‰¾åˆ°å¯¹åº”å…³ç³». ä½†æ˜¯æœ‰æ—¶å€™å¸Œæœ›ç”¨ and æ±‚äº¤é›†, ä½†æ˜¯ä¸¤ä¾§å‘é‡æ ‡ç­¾ä¸åŒ, æ€ä¹ˆåŠå‘¢?")]),s._v(" "),t("p",[s._v("æ­¤æ—¶å¯ä»¥ä½¿ç”¨å…³é”®å­— "),t("strong",[s._v("on")]),s._v(" å’Œ "),t("strong",[s._v("ignoring")]),s._v(" æ¥é™åˆ¶ç”¨äºåšåŒ¹é…çš„æ ‡ç­¾é›†.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("mysql_slave_status_slave_sql_running == 0\nand ON (instance)\nmysql_slave_status_master_server_id > 0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™ä¸ª PromQL æƒ³è¡¨è¾¾çš„æ„æ€æ˜¯å¦‚æœè¿™ä¸ª MySQL å®ä¾‹æ˜¯ä¸ª slave(master_server_id>0), å°±æ£€æŸ¥å…¶ slave_sql_running çš„å€¼, å¦‚æœ slave_sql_running==0, å°±è¡¨ç¤º slave sql çº¿ç¨‹æ²¡æœ‰åœ¨è¿è¡Œ.")]),s._v(" "),t("p",[s._v("ä½† mysql_slave_status_slave_sql_running å’Œ mysql_slave_status_master_server_id è¿™ä¸¤ä¸ª metric çš„æ ‡ç­¾, å¯èƒ½å¹¶éå®Œå…¨ä¸€è‡´. ä¸è¿‡å¥½åœ¨äºŒè€…éƒ½æœ‰ä¸ª instance æ ‡ç­¾, ä¸”ç›¸åŒçš„ instance æ ‡ç­¾çš„æ•°æ®ä»è¯­ä¹‰ä¸Šæ¥çœ‹å°±è¡¨ç¤ºä¸€ä¸ªå®ä¾‹çš„å¤šä¸ªæŒ‡æ ‡æ•°æ®, é‚£å°±å¯ä»¥ç”¨å…³é”®å­— on æ¥æŒ‡å®šåªä½¿ç”¨ instance æ ‡ç­¾åšåŒ¹é…, å¿½ç•¥å…¶ä»–æ ‡ç­¾.")]),s._v(" "),t("p",[s._v("ä¸ on ç›¸åçš„æ˜¯å…³é”®å­— ignoring, é¡¾åæ€ä¹‰, ignoring æ˜¯å¿½ç•¥æ‰æŸäº›æ ‡ç­¾, ç”¨å‰©ä¸‹çš„æ ‡ç­¾æ¥åšåŒ¹é…. æ‹¿ Prometheus æ–‡æ¡£ä¸­çš„ä¾‹å­æ¥è¯´æ˜.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v('## example series\nmethod_code:http_errors:rate5m{method="get", code="500"}  24\nmethod_code:http_errors:rate5m{method="get", code="404"}  30\nmethod_code:http_errors:rate5m{method="put", code="501"}  3\nmethod_code:http_errors:rate5m{method="post", code="500"} 6\nmethod_code:http_errors:rate5m{method="post", code="404"} 21\nmethod:http_requests:rate5m{method="get"}  600\nmethod:http_requests:rate5m{method="del"}  34\nmethod:http_requests:rate5m{method="post"} 120\n\n## promql\nmethod_code:http_errors:rate5m{code="500"}\n/ ignoring(code)\nmethod:http_requests:rate5m\n\n## result\n{method="get"}  0.04            //  24 / 600\n{method="post"} 0.05            //   6 / 120\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("ä¾‹å­é‡Œéƒ½æ˜¯ one-to-one çš„å¯¹åº”å…³ç³», è¿™ä¸ªå¥½ç†è§£. éš¾ç†è§£çš„æ˜¯ one-to-many å’Œ many-to-one, è¿™ç§æƒ…å†µä¸‹, åšæŒ‡æ ‡è¿ç®—æ—¶å°±è¦å€ŸåŠ©å…³é”®å­— "),t("strong",[s._v("groupleft å’Œ groupright")]),s._v(" äº†. left, right æŒ‡å‘é«˜åŸºæ•°é‚£ä¸€ä¾§çš„å‘é‡. è¿˜æ˜¯ç”¨ä¸Šé¢method_code:http_errors:rate5m å’Œ method:http_requests:rate5m è¿™ä¸¤ä¸ªæŒ‡æ ‡æ¥ä¸¾ä¾‹, å¯ä»¥çœ‹ä¸€ä¸‹ä½¿ç”¨ group_left  çš„ PromQL å’Œè¾“å‡ºçš„ç»“æœ.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v('## promql\nmethod_code:http_errors:rate5m\n/ ignoring(code) group_left\nmethod:http_requests:rate5m\n\n## result\n{method="get", code="500"}  0.04            //  24 / 600\n{method="get", code="404"}  0.05            //  30 / 600\n{method="post", code="500"} 0.05            //   6 / 120\n{method="post", code="404"} 0.175           //  21 / 120\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("æ¯”å¦‚é’ˆå¯¹ "),t("code",[s._v('method="get"')]),s._v("â€‹ çš„æ¡ç›®, å³ä¾§çš„å‘é‡ä¸­åªæœ‰ä¸€ä¸ªè®°å½•, ä½†æ˜¯å·¦ä¾§çš„å‘é‡ä¸­æœ‰ä¸¤ä¸ªè®°å½•, æ‰€ä»¥é«˜åŸºæ•°çš„ä¸€ä¾§æ˜¯å·¦ä¾§, æ•…è€Œä½¿ç”¨ group_left.")]),s._v(" "),t("p",[s._v("è¿™é‡Œå†ä¸¾ä¸€ä¸ªä¾‹å­, æ¥è¯´æ˜ group_left, group_right çš„ä¸€ä¸ªå¸¸è§ç”¨æ³•. æ¯”å¦‚ä½¿ç”¨ kube-state-metrics æ¥é‡‡é›† Kubernetes å„ä¸ªå¯¹è±¡çš„æŒ‡æ ‡æ•°æ®, å…¶ä¸­é’ˆå¯¹ pod æœ‰ä¸ªæŒ‡æ ‡æ˜¯ kube_pod_labels, è¯¥æŒ‡æ ‡ä¼šæŠŠ pod çš„ä¸€äº›ä¿¡æ¯æ”¾åˆ°æ ‡ç­¾é‡Œ, æŒ‡æ ‡å€¼æ˜¯ 1, ç›¸å½“äºä¸€ä¸ªå…ƒä¿¡æ¯.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v('kube_pod_labels{\n[...]\n  label_name="frontdoor",\n  label_version="1.0.1",\n  label_team="blue"\n  namespace="default",\n  pod="frontdoor-xxxxxxxxx-xxxxxx",\n} = 1\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("å‡è®¾æŸä¸ª Pod æ˜¯æ¥å…¥å±‚çš„, ç»Ÿè®¡äº†å¾ˆå¤š HTTP è¯·æ±‚ç›¸å…³çš„æŒ‡æ ‡, æƒ³ç»Ÿè®¡ 5xx çš„è¯·æ±‚æ•°é‡, å¸Œæœ›èƒ½æŒ‰ Pod çš„ version ç”»ä¸€ä¸ªé¥¼å›¾. è¿™é‡Œæœ‰ä¸ªéš¾ç‚¹: æ¥å…¥å±‚çš„è¯·æ±‚ç±»æŒ‡æ ‡æ²¡æœ‰ version æ ‡ç­¾, version ä¿¡æ¯åªå‡ºç°åœ¨ kube_pod_labels é‡Œ, é‚£æ€ä¹ˆè®©äºŒè€…è”åŠ¨å‘¢? å¦‚ä¸‹æ‰€ç¤º:")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v('sum(\n  rate(http_request_count{code=~"^(?:5..)$"}[5m])) by (pod)\n*\non (pod) group_left(label_version) kube_pod_labels\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("æŠŠè¿™ä¸ª PromQL æ°å¼€æ‰ç¢, çœ‹ä¸€ä¸‹å…·ä½“çš„æ„æ€, ä¹˜å·å‰é¢çš„éƒ¨åˆ†, æ˜¯ä¸€ä¸ªç»Ÿè®¡æ¯ç§’ 5xx æ•°é‡çš„å…¸å‹è¯­æ³•, æŒ‰ç…§ pod ç»´åº¦åšåˆ†ç»„ç»Ÿè®¡.")]),s._v(" "),t("p",[s._v("ç„¶åä¹˜ä»¥ kube_pod_labels, è¿™ä¸ªå€¼æ˜¯ 1. ä»»ä½•å€¼ä¹˜ä»¥ 1 éƒ½æ˜¯åŸæ¥çš„å€¼, æ‰€ä»¥å¯¹æ•´ä½“æ•°å€¼æ²¡æœ‰å½±å“, è€Œ kube_pod_labels æœ‰å¤šä¸ªæ ‡ç­¾, è€Œä¸”å’Œ sum è¯­å¥çš„ç»“æœå‘é‡çš„æ ‡ç­¾ä¸ä¸€è‡´, æ‰€ä»¥é€šè¿‡ on(pod) è¯­æ³•æ¥æŒ‡å®šåªæŒ‰ç…§ pod æ ‡ç­¾æ¥å»ºç«‹å¯¹åº”å…³ç³».")]),s._v(" "),t("p",[s._v("æœ€å, åˆ©ç”¨ group_left(label_version), æŠŠ label_version é™„åŠ åˆ°äº†ç»“æœå‘é‡é‡Œ, é«˜åŸºæ•°çš„éƒ¨åˆ†æ˜¾ç„¶æ˜¯ sum çš„éƒ¨åˆ†, æ‰€ä»¥ä½¿ç”¨ group_left è€Œé group_right.")]),s._v(" "),t("h5",{attrs:{id:"_6-èšåˆè¿ç®—"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-èšåˆè¿ç®—"}},[s._v("#")]),s._v(" 6.èšåˆè¿ç®—")]),s._v(" "),t("p",[s._v("é™¤äº†å‰é¢è¯´çš„æŸ¥è¯¢éœ€æ±‚å¤–, é’ˆå¯¹å•ä¸ªæŒ‡æ ‡çš„å¤šä¸ª series, è¿˜ä¼šæœ‰ä¸€äº›"),t("strong",[s._v("èšåˆéœ€æ±‚")]),s._v(". æ¯”å¦‚è¯´æƒ³æŸ¥çœ‹ 100 å°æœºå™¨çš„å¹³å‡å†…å­˜å¯ç”¨ç‡, æˆ–è€…æƒ³è¦æ’ä¸ªåº, å–æ•°å€¼æœ€å°çš„ 10 å°. è¿™ç§éœ€æ±‚å¯ä»¥ä½¿ç”¨ PromQL "),t("strong",[s._v("å†…ç½®çš„èšåˆå‡½æ•°")]),s._v("æ¥å®ç°.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v('# æ±‚å– clickhouse çš„æœºå™¨çš„å¹³å‡å†…å­˜å¯ç”¨ç‡\navg(mem_available_percent{app="clickhouse"})\n\n# æŠŠ clickhouse çš„æœºå™¨çš„å†…å­˜å¯ç”¨ç‡æ’ä¸ªåº, å–æœ€å°çš„ä¸¤æ¡è®°å½•\nbottomk(2, mem_available_percent{app="clickhouse"})\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("å¦å¤–, æœ‰æ—¶ä¼šæœ‰"),t("strong",[s._v("åˆ†ç»„ç»Ÿè®¡")]),s._v("çš„éœ€æ±‚, æ¯”å¦‚æƒ³åˆ†åˆ«ç»Ÿè®¡ clickhouse å’Œ canal çš„æœºå™¨å†…å­˜å¯ç”¨ç‡, å¯ä»¥"),t("strong",[s._v("ä½¿ç”¨å…³é”®å­— by æŒ‡å®šåˆ†ç»„ç»Ÿè®¡çš„ç»´åº¦(ä¸ by ç›¸åçš„æ˜¯ without)")]),s._v(" .")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v('avg(mem_available_percent{app=~"clickhouse|canal"}) by (app)\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ³¨æ„: è¿™äº›èšåˆè¿ç®—, å¯ä»¥ç†è§£ä¸º "),t("mark",[t("strong",[s._v("çºµå‘æ‹Ÿåˆ")])]),s._v(". å¯ä»¥æƒ³è±¡ä¸€ä¸‹, 100 å°æœºå™¨çš„å†…å­˜å¯ç”¨ç‡, åœ¨æŠ˜çº¿å›¾ä¸Šæœ‰ 100 æ¡çº¿, å¦‚æœæƒ³è¦æŠŠè¿™ 100 æ¡çº¿æ‹Ÿåˆæˆä¸€æ¡çº¿, å°±ç›¸å½“äºæŠŠæ¯ä¸ªæ—¶åˆ»çš„ 100 ä¸ªç‚¹æ‹Ÿåˆæˆ 1 ä¸ªç‚¹. é‚£æ€ä¹ˆè®© 100 ä¸ªç‚¹å˜æˆ 1 ä¸ªç‚¹å‘¢? æ±‚ä¸ªå¹³å‡å€¼æˆ–æœ€å¤§å€¼ä¹‹ç±»çš„, å°±å¯ä»¥å®ç°, æ‰€ä»¥å°±æœ‰äº†è¿™äº›èšåˆè¿ç®—ç¬¦.")]),s._v(" "),t("p",[s._v("è¿˜æœ‰ä¸€ç±»èšåˆè¿ç®—å‡½æ•°, å¯ä»¥çœ‹ä½œæ˜¯ "),t("strong",[s._v("æ¨ªå‘æ‹Ÿåˆ")]),s._v(", ä¹Ÿå°±æ˜¯ "),t("code",[s._v("<aggregation>_over_time")]),s._v("â€‹ ç±»çš„å‡½æ•°. è¿™äº›å‡½æ•°æ¥æ”¶èŒƒå›´å‘é‡, å› ä¸ºèŒƒå›´å‘é‡æ˜¯ä¸€ä¸ªæ—¶æ®µå†…æœ‰å¤šä¸ªå€¼, "),t("code",[s._v("<aggregation>")]),s._v("â€‹ å°±æ˜¯å¯¹è¿™å¤šä¸ªå€¼åšè¿ç®—.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("max_over_time(target_up[2m])\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("target_up æŒ‡æ ‡åé¢åŠ äº† [2m], æŒ‡çš„å°±æ˜¯è·å–è¿™ä¸ªæŒ‡æ ‡æœ€è¿‘ 2 åˆ†é’Ÿçš„æ‰€æœ‰æ•°æ®ç‚¹, å¦‚æœ 15 ç§’é‡‡é›†ä¸€ä¸ªç‚¹, 2 åˆ†é’Ÿå°±æ˜¯ 8 ä¸ªç‚¹, max_over_time å°±æ˜¯å¯¹è¿™ 8 ä¸ªç‚¹æ±‚æœ€å¤§å€¼, ç›¸å½“äºå¯¹å„ä¸ªæ—¶é—´åºåˆ—åšæ¨ªå‘æ‹Ÿåˆ.")]),s._v(" "),t("h4",{attrs:{id:"å®¹æ˜“è¯¯è§£çš„å‡½æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®¹æ˜“è¯¯è§£çš„å‡½æ•°"}},[s._v("#")]),s._v(" å®¹æ˜“è¯¯è§£çš„å‡½æ•°")]),s._v(" "),t("p",[s._v("é™¤äº†ä¸Šé¢è¯´çš„è¿™äº›å¸¸ç”¨çš„èšåˆå‡½æ•°å¤–, Prometheus è¿˜å†…ç½®äº†å¾ˆå¤šå…¶ä»–å‡½æ•°, å…¶ä¸­ç”¨å¾—æœ€å¹¿å¹¶ä¸”æœ€å®¹æ˜“è¢«äººè¯¯è§£çš„æ˜¯ increase å’Œ rate å‡½æ•°, è¿™é‡Œè®²ä¸€è®²è¿™ä¸¤ä¸ªå‡½æ•°.")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ "),t("strong",[s._v("increase")]),s._v(" å‡½æ•°, å­—é¢æ„æ€ä¸Šè¡¨ç¤ºæ±‚å–ä¸€ä¸ªå¢é‡, æ¥æ”¶ä¸€ä¸ª range-vector, range-vector æ˜¾ç„¶æ˜¯ä¼šè¿”å›å¤šä¸ª value+timestamp çš„ç»„åˆ. ç›´è§‚åœ°ç†è§£å°±æ˜¯, ç›´æ¥æŠŠæ—¶é—´èŒƒå›´å†…çš„æœ€åä¸€ä¸ªå€¼å‡å»ç¬¬ä¸€ä¸ªå€¼, ä¸å°±å¯ä»¥å¾—åˆ°å¢é‡äº†å—? éä¹Ÿ!")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5fe64d3408bba9b26b88f556865b2983-20230719203435-laot7e5.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹ä¸€ä¸‹è¿™å¼ å›¾, å›¾é‡Œçš„ä¸€äº›å…³é”®ä¿¡æ¯, è¿™é‡Œæ‘˜å½•æˆäº†æ–‡æœ¬, å¯ä»¥çœ‹ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v('promql: net_bytes_recv{interface="eth0"}[1m] @ 1661570908\n965304237246 @1661570850\n965307953982 @1661570860\n965311949925 @1661570870\n965315732812 @1661570880\n965319998347 @1661570890\n965323899880 @1661570900\n\npromql: increase(net_bytes_recv{interface="eth0"}[1m]) @1661570909\n23595160.8\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("ç›‘æ§æ•°æ®æ˜¯ 10 ç§’ä¸ŠæŠ¥ä¸€æ¬¡, æ‰€ä»¥è™½ç„¶ä¸¤æ¬¡ PromQL æŸ¥è¯¢æ—¶é—´ä¸åŒ, ä¸€æ¬¡æ˜¯ 1661570908, ä¸€æ¬¡æ˜¯ 1661570909, ä½†æ˜¯æ‰€æŸ¥è¯¢çš„åŸå§‹æ•°æ®å†…å®¹æ˜¯ä¸€æ ·çš„, å°±æ˜¯ 1661570850~1661570900 è¿™å‡ ä¸ªæ—¶é—´ç‚¹å¯¹åº”çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("ç›´è§‚ä¸Šç†è§£, åœ¨è¿™å‡ ä¸ªæ—¶é—´ç‚¹å¯¹åº”çš„æ•°æ®ä¸Šæ±‚å– increase, æ— éå°±æ˜¯æœ€åä¸€ä¸ªå€¼å‡å»ç¬¬ä¸€ä¸ªå€¼, å³ 965323899880-965304237246=19662634. ä¸è¿‡å¾ˆé—æ†¾, å®é™…ç»“æœæ˜¯ 23595160.8, å·®åˆ«æœ‰ç‚¹å¤§, æ˜¾ç„¶è¿™ä¸ªç›´è§‚ç†è§£çš„ç®—æ³•æ˜¯é”™çš„.")]),s._v(" "),t("p",[s._v("å®é™…ä¸Š, "),t("strong",[s._v("increase è¿™ä¸ª PromQL å‘èµ·è¯·æ±‚çš„æ—¶é—´æ˜¯ 1661570909, æ—¶é—´èŒƒå›´æ˜¯ [1m], ç›¸å½“äºå‘Šè¯‰ Prometheus, éœ€è¦æŸ¥è¯¢1661570849(ç”± 1661570909-60 å¾—å‡º)~1661570909 ä¹‹é—´çš„ increase æ•°å€¼")]),s._v(". ä½†æ˜¯åŸå§‹ç›‘æ§æ•°æ®å¹¶æ²¡æœ‰ 1661570849, 1661570909 è¿™ä¸¤ä¸ªæ—¶åˆ»çš„æ•°å€¼, æ€ä¹ˆåŠå‘¢?")]),s._v(" "),t("p",[s._v("Prometheus åªèƒ½"),t("strong",[s._v("åŸºäºç°æœ‰çš„æ•°æ®")]),s._v("åšå¤–æ¨, ä¹Ÿå°±æ˜¯ä½¿ç”¨æœ€åä¸€ä¸ªç‚¹çš„æ•°å€¼å‡å»ç¬¬ä¸€ä¸ªç‚¹çš„æ•°å€¼, å¾—åˆ°çš„ç»“æœé™¤ä»¥æ—¶é—´å·®, å†ä¹˜ä»¥ 60.")]),s._v(" "),t("p",[s._v("$$\n(965323899880.0-965304237246.0)\\div(1661570900.0-1661570850.0)\\times60=23595160.8\n$$")]),s._v(" "),t("p",[s._v("è¿™æ ·æœ€ç»ˆå°±å¾—åˆ°äº† 1 åˆ†é’Ÿçš„ increase å€¼, æ˜¯ä¸ªå°æ•°.")]),s._v(" "),t("p",[s._v("å†è¯´ä¸€ä¸‹ rate å‡½æ•°, increase å‡½æ•°æ˜¯æ±‚å–çš„æ—¶é—´æ®µå†…çš„å¢é‡, è€Œä¸”æœ‰æ•°æ®å¤–æ¨, rate å‡½æ•°åˆ™æ±‚å–çš„æ˜¯æ¯ç§’å˜åŒ–ç‡, ä¹Ÿæœ‰æ•°æ®å¤–æ¨çš„é€»è¾‘, "),t("strong",[s._v("increase çš„ç»“æœé™¤ä»¥ range-vector çš„æ—¶é—´æ®µçš„å¤§å°")]),s._v(", å°±æ˜¯ rate çš„å€¼. ç”¨ä¸‹é¢çš„ PromQL éªŒè¯ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v('rate(net_bytes_recv{interface="eth0"}[1m])\n== bool\nincrease(net_bytes_recv{interface="eth0"}[1m])/60.0\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™é‡Œ == åé¢è·Ÿäº†ä¸€ä¸ª bool ä¿®é¥°ç¬¦, è¡¨ç¤ºå¸Œæœ›è¿”å›ä¸€ä¸ª bool å€¼, å¦‚æœæ˜¯ True å°±ä¼šè¿”å› 1, å¦‚æœæ˜¯ False å°±è¿”å› 0. è§‚å¯Ÿç»“æœåå‘ç°, è¿™ä¸ªè¡¨è¾¾å¼æ°¸è¿œéƒ½ä¼šè¿”å› 1, å³ç­‰å·å‰åçš„ä¸¤ä¸ª PromQL è¯­ä¹‰ä¸Šæ˜¯ç›¸åŒçš„.")]),s._v(" "),t("p",[t("strong",[s._v("rate å‡½æ•°æ±‚å–çš„å˜åŒ–ç‡, ç›¸å¯¹å¹³æ»‘")]),s._v(". å› ä¸º"),t("strong",[s._v("æ˜¯æ‹¿æ—¶é—´èŒƒå›´å†…çš„æœ€åä¸€ä¸ªå€¼å’Œç¬¬ä¸€ä¸ªå€¼åšæ•°æ®å¤–æ¨, ä¸€äº›æ¯›åˆºç°è±¡å°±ä¼šè¢«å¹³æ»‘æ‰")]),s._v(". å¦‚æœæƒ³è¦å¾—åˆ°æ›´æ•æ„Ÿçš„æ•°æ®, å¯ä»¥ä½¿ç”¨ irate å‡½æ•°. irate æ˜¯æ‹¿æ—¶é—´èŒƒå›´å†…çš„æœ€åä¸¤ä¸ªå€¼æ¥åšè®¡ç®—, å˜åŒ–å°±ä¼šæ›´å‰§çƒˆ, æ‹¿ç½‘å¡å…¥å‘æµé‡è¿™ä¸ªæŒ‡æ ‡æ¥åšä¸ªå¯¹æ¯”.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/68ac7b49091b60970b9a8f8a106500c3-20230719203435-55cibpc.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("è“è‰²çš„å˜åŒ–å¾—æ›´å‰§çƒˆçš„çº¿æ˜¯ç”¨ irate å‡½æ•°è®¡ç®—å¾—åˆ°çš„, è€Œç´«è‰²çš„ç›¸å¯¹å¹³æ»‘çš„çº¿æ˜¯ç”¨ rate å‡½æ•°è®¡ç®—å¾—åˆ°çš„, å¯¹æ¯”è¿˜æ˜¯å¾ˆå¼ºçƒˆçš„.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-5"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²ä»¥å®é™…åœºæ™¯ä¸ºå‡ºå‘ç‚¹, ä»‹ç»äº†ä¸åŒåœºæ™¯ä¸‹å¦‚ä½•ä½¿ç”¨ PromQL.")]),s._v(" "),t("p",[s._v("é‡ç‚¹è®²è§£äº† PromQL çš„ä¸¤ä¸ªæ ¸å¿ƒä»·å€¼, ä¸€ä¸ªæ˜¯ç­›é€‰, ä¸€ä¸ªæ˜¯è®¡ç®—. ç­›é€‰æ˜¯é æŸ¥è¯¢é€‰æ‹©å™¨, æŸ¥è¯¢åˆ†ä¸ºå³æ—¶æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢. è®¡ç®—éƒ¨åˆ†å†…å®¹è¾ƒå¤š, æœ‰ç®—æœ¯, æ¯”è¾ƒ, é€»è¾‘, èšåˆè¿ç®—ç¬¦, è¿˜æœ‰å‘é‡åŒ¹é…é€»è¾‘, ç‰¹åˆ«æ˜¯ group_left å’Œ group_right, æ¯”è¾ƒéš¾ç†è§£, éœ€è¦ä»”ç»†æ¨æ•².")]),s._v(" "),t("p",[s._v("å‡½æ•°éƒ¨åˆ†æ¯”è¾ƒé‡è¦çš„æ˜¯ increase å’Œ rate, å…¶å® histogram_quantile ä¹Ÿå¾ˆå¸¸ç”¨è€Œä¸”æ¯”è¾ƒéš¾ç†è§£, ä¸è¿‡åœ¨å‰é¢ä¸­å·²ç»ä»‹ç»è¿‡ histogram_quantile çš„è®¡ç®—é€»è¾‘äº†, è¿™é‡Œå°±ä¸å†é‡å¤.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6075e00c54589543091e7e15yy04a43e-20230719203435-5k5riuc.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_7-å¦‚ä½•è§£å†³prometheusçš„å­˜å‚¨å®¹é‡é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-å¦‚ä½•è§£å†³prometheusçš„å­˜å‚¨å®¹é‡é—®é¢˜"}},[s._v("#")]),s._v(" 7.å¦‚ä½•è§£å†³Prometheusçš„å­˜å‚¨å®¹é‡é—®é¢˜?")]),s._v(" "),t("p",[s._v("å‰å‡ è®²ä»‹ç»äº† Prometheus çš„å…³é”®è®¾è®¡, è¿™äº›è®¾è®¡éƒ½éå¸¸ä¼˜ç§€. åœ¨äº‘åŸç”Ÿç›‘æ§é¢†åŸŸ, æœ‰ä¸å¯æ’¼åŠ¨çš„æ±Ÿæ¹–åœ°ä½, é‚£è¿™æ ·è¯´æ¥ Prometheus æ˜¯ä¸æ˜¯å°±æ²¡æœ‰ç¼ºç‚¹äº†å‘¢? æ˜¯å¦å¯ä»¥æ»¡è¶³æ‰€æœ‰ä½¿ç”¨åœºæ™¯å‘¢? æ˜¾ç„¶ä¹Ÿä¸æ˜¯.")]),s._v(" "),t("p",[s._v("ä¸€ä¸ªè½¯ä»¶å¦‚æœä»€ä¹ˆé—®é¢˜éƒ½æƒ³è§£å†³, å°±ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜éƒ½è§£å†³ä¸å¥½. æ‰€ä»¥ Prometheus ä¹Ÿå­˜åœ¨ä¸€äº›ä¸è¶³ä¹‹å¤„, å…¶ä¸­ä¸€ä¸ªå¹¿å—è¯Ÿç—…çš„é—®é¢˜å°±æ˜¯ "),t("mark",[t("strong",[s._v("å•æœºå­˜å‚¨ä¸å¥½æ‰©å±•")])]),s._v(". æ‰€ä»¥è¿™ä¸€è®²å°±é’ˆå¯¹è¿™ä¸ªé—®é¢˜æ¥èŠèŠå¦‚ä½•æ‰©å±• Prometheus çš„å­˜å‚¨.")]),s._v(" "),t("h4",{attrs:{id:"æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦æ‰©å±•å®¹é‡å—"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦æ‰©å±•å®¹é‡å—"}},[s._v("#")]),s._v(" æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦æ‰©å±•å®¹é‡å—?")]),s._v(" "),t("p",[s._v("è™½ç„¶èŠçš„æ˜¯ Prometheus å®¹é‡æ‰©å±•é—®é¢˜, ä¸è¿‡å¿…é¡»å…ˆè¯´æ˜ä¸€ç‚¹, å¤§éƒ¨åˆ†åœºæ™¯å…¶å®ä¸éœ€è¦æ‰©å±•, å› ä¸ºä¸€èˆ¬çš„æ•°æ®é‡å‹æ ¹è¾¾ä¸åˆ° Prometheus çš„å®¹é‡ä¸Šé™. "),t("strong",[s._v("å¾ˆå¤šä¸­å°å‹å…¬å¸ä½¿ç”¨å•æœºç‰ˆæœ¬çš„ Prometheus å°±è¶³å¤Ÿäº†, è¿™ä¸ªæ—¶å€™ä¸è¦æƒ³ç€å»æ‰©å±•, å®¹æ˜“è¿‡åº¦è®¾è®¡, å¼•å…¥æ¶æ„ä¸Šçš„å¤æ‚åº¦é—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("Prometheus å•æœºå®¹é‡ä¸Šé™æ˜¯å¤šå°‘? æ ¹æ®ç»éªŒ, "),t("strong",[s._v("æ¯ç§’æ¥æ”¶ 80 ä¸‡ä¸ªæ•°æ®ç‚¹, ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥åº·çš„ä¸Šé™")]),s._v(", ä¸€å¼€å§‹ä¹Ÿæ— éœ€ç”¨ä¸€å°é…ç½®ç‰¹åˆ«é«˜çš„æœºå™¨, éšç€æ•°æ®é‡çš„å¢é•¿, å¯ä»¥å†å‡çº§ç¡¬ä»¶çš„é…ç½®. å½“ç„¶å¦‚æœæƒ³è¦ç¡¬ä»¶æ–¹ä¾¿å‡é…, å°±éœ€è¦å€ŸåŠ©è™šæ‹Ÿæœºæˆ–å®¹å™¨, åŒæ—¶éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼å—å­˜å‚¨.")]),s._v(" "),t("p",[s._v("æ¯ç§’æ¥æ”¶ 80 ä¸‡ä¸ªæ•°æ®ç‚¹æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢? æ¯å°æœºå™¨æ¯ä¸ªå‘¨æœŸå¤§æ¦‚é‡‡é›† 200 ä¸ªç³»ç»Ÿçº§æŒ‡æ ‡, æ¯”å¦‚ CPU, å†…å­˜, ç£ç›˜ç­‰ç›¸å…³çš„æŒ‡æ ‡. å‡è®¾é‡‡é›†é¢‘ç‡æ˜¯ 10 ç§’, å¹³å‡æ¯ç§’ä¸ŠæŠ¥ 20 ä¸ªæ•°æ®ç‚¹, å¯ä»¥æ”¯æŒåŒæ—¶ç›‘æ§çš„æœºå™¨é‡æ˜¯ 4 ä¸‡å°.")]),s._v(" "),t("p",[s._v("$$\n800000\\div20=40000\n$$")]),s._v(" "),t("p",[s._v("å¯ä»¥çœ‹å‡º, æ¯ç§’æ¥æ”¶ 80 ä¸‡æ•°æ®ç‚¹, å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å®¹é‡äº†. å½“ç„¶å¦‚æœä½¿ç”¨ node-exporter, æŒ‡æ ‡æ•°é‡è¦å¤šäº 200, 800 å·¦å³, é‚£ä¹Ÿèƒ½æ”¯æŒ 1 ä¸‡å°æœºå™¨çš„ç›‘æ§.")]),s._v(" "),t("p",[s._v("ä¸è¿‡åˆšåˆšåªè®¡ç®—äº†æœºå™¨ç›‘æ§æ•°æ®, å¦‚æœè¿˜è¦ç”¨è¿™ä¸ª Prometheus ç›‘æ§å„ç±»ä¸­é—´ä»¶, é‚£å°±å¾—å†åšé¢„ä¼°è®¡ç®—äº†. æœ‰äº›ä¸­é—´ä»¶ä¼šåå‡ºæ¯”è¾ƒå¤šçš„æŒ‡æ ‡, æœ‰äº›æŒ‡æ ‡å…¶å®ç”¨å¤„ä¸å¤§, å¯ä»¥ä¸¢æ‰(drop), å½“ç„¶è¿™å°±æ˜¯å¦ä¸€ä¸ªè¯é¢˜äº†, åé¢ç›‘æ§å®æˆ˜éƒ¨åˆ†ä¼šè¯¦ç»†è®²è§£, è¿™é‡Œæš‚ä¸å±•å¼€.")]),s._v(" "),t("p",[s._v("å¦‚æœå•ä¸ª Prometheus å®åœ¨æ˜¯æ‰›ä¸ä½, ä¹Ÿå¯ä»¥"),t("strong",[s._v("æ‹†æˆå¤šä¸ª Prometheus, æ ¹æ®ä¸šåŠ¡æˆ–è€…åœ°åŸŸæ¥æ‹†")]),s._v("éƒ½æ˜¯å¯ä»¥çš„, è¿™å°±æ˜¯ä¸‹é¢è¦ä»‹ç»çš„ "),t("strong",[s._v("Prometheus è”é‚¦æœºåˆ¶")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"prometheus-è”é‚¦æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-è”é‚¦æœºåˆ¶"}},[s._v("#")]),s._v(" Prometheus è”é‚¦æœºåˆ¶")]),s._v(" "),t("p",[s._v("è”é‚¦æœºåˆ¶å¯ä»¥ç†è§£ä¸ºæ˜¯ Prometheus "),t("strong",[s._v("å†…ç½®æ”¯æŒçš„ä¸€ç§é›†ç¾¤æ–¹å¼")]),s._v(", æ ¸å¿ƒå°±æ˜¯ Prometheus æ•°æ®çš„"),t("strong",[s._v("çº§è”æŠ“å–")]),s._v(". æ¯”å¦‚æŸå…¬å¸æœ‰ 8 å¥— Kubernetes, æ¯å¥— Kubernetes é›†ç¾¤éƒ½éƒ¨ç½²äº†ä¸€ä¸ª Prometheus, è¿™ 8 ä¸ª Prometheus å°±å½¢æˆäº† 8 ä¸ªæ•°æ®å­¤å²›, æ²¡æ³•åœ¨ä¸€ä¸ªåœ°æ–¹çœ‹åˆ° 8 ä¸ª Prometheus çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("å½“ç„¶, ç”¨ Grafana æˆ– Nightingale, æŠŠè¿™ 8 ä¸ª Prometheus ä½œä¸ºæ•°æ®æºæ¥å…¥, ç„¶åå°±å¯ä»¥åœ¨ä¸€ä¸ª Web ä¸Šé€šè¿‡"),t("strong",[s._v("åˆ‡æ¢æ•°æ®æº")]),s._v("çš„æ–¹å¼æŸ¥çœ‹ä¸åŒçš„æ•°æ®äº†, ä½†æœ¬è´¨è¿˜æ˜¯åˆ†åˆ«æŸ¥çœ‹, "),t("strong",[s._v("æ²¡æ³•åšå¤šä¸ª Prometheus æ•°æ®çš„è”åˆè¿ç®—")]),s._v(".")]),s._v(" "),t("p",[s._v("è€Œ"),t("strong",[s._v("è”é‚¦æœºåˆ¶, ä¸€å®šç¨‹åº¦ä¸Šå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜, æŠŠä¸åŒçš„ Prometheus æ•°æ®èšæ‹¢åˆ°ä¸€ä¸ªä¸­å¿ƒçš„ Prometheus ä¸­,")]),s._v("  æ¶æ„å¤§ä½“å¦‚ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/f40db5919edc384c17fc2e148c2ayy53-20230719203435-touh3q5.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("åŸæœ¬ä¸€ä¸ª Prometheus è§£å†³ä¸äº†çš„é—®é¢˜, æ‹†æˆäº†å¤šä¸ª, ç„¶ååˆæŠŠå¤šä¸ª Prometheus çš„æ•°æ®èšæ‹¢åˆ°ä¸­å¿ƒçš„ Prometheus ä¸­. ä½†æ˜¯, ä¸­å¿ƒçš„ Prometheus ä»ç„¶æ˜¯ä¸ªç“¶é¢ˆ. æ‰€ä»¥åœ¨è”é‚¦æœºåˆ¶ä¸­, ä¸­å¿ƒç«¯çš„ Prometheus å»æŠ“å–è¾¹ç¼˜ Prometheus æ•°æ®æ—¶, ä¸åº”è¯¥æŠŠæ‰€æœ‰æ•°æ®éƒ½æŠ“å–åˆ°ä¸­å¿ƒ, è€Œæ˜¯åº”è¯¥ "),t("mark",[t("strong",[s._v("åªæŠ“å–é‚£äº›éœ€è¦åšèšåˆè®¡ç®—æˆ–å…¶ä»–å›¢é˜Ÿä¹Ÿå…³æ³¨çš„æŒ‡æ ‡")])]),s._v(", å¤§éƒ¨åˆ†æ•°æ®è¿˜æ˜¯åº”è¯¥ä¸‹æ²‰åœ¨å„ä¸ªè¾¹ç¼˜ Prometheus å†…éƒ¨æ¶ˆåŒ–æ‰, ä¸ç„¶ä¸­å¿ƒç«¯çš„ Prometheus ä¹Ÿé¡¶ä¸ä½.")]),s._v(" "),t("p",[s._v("æ€ä¹ˆåšåˆ°åªæŠ“å–ç‰¹å®šçš„æŒ‡æ ‡åˆ°ä¸­å¿ƒç«¯å‘¢? é€šè¿‡ "),t("code",[s._v("match[]")]),s._v("â€‹ å‚æ•°, æŒ‡å®šè¿‡æ»¤æ¡ä»¶å°±å¯ä»¥å®ç°, ä¸‹é¢æ˜¯ä¸­å¿ƒ Prometheus çš„æŠ“å–è§„åˆ™.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'federate'")]),s._v("\n    scrape_interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30s\n    honor_labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    metrics_path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/federate'")]),s._v("\n    params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      'match"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{__name__=~\"aggr:.*\"}'")]),s._v("\n    static_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.1.2.3:9090'")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.1.2.4:9090'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("è¾¹ç¼˜ Prometheus ä¼šåœ¨ "),t("code",[s._v("/federate")]),s._v("â€‹ æ¥å£æš´éœ²ç›‘æ§æ•°æ®, æ‰€ä»¥è®¾ç½®äº†metrics_path, honor_labels è®¾ç½®ä¸º true, æ„æ€æ˜¯åœ¨æ ‡ç­¾é‡å¤æ—¶, ä»¥æºæ•°æ®çš„æ ‡ç­¾ä¸ºå‡†. è¿‡æ»¤æ¡ä»¶ä¸­é€šè¿‡æ­£åˆ™åŒ¹é…è¿‡æ»¤å‡ºæ‰€æœ‰ "),t("code",[s._v("aggr:")]),s._v("â€‹ æ‰“å¤´çš„æŒ‡æ ‡, è¿™ç±»æŒ‡æ ‡éƒ½æ˜¯é€šè¿‡ Recoding Rules èšåˆå‡ºæ¥çš„å…³é”®æŒ‡æ ‡. å½“ç„¶, è¿™æ˜¯å‡è®¾çš„ä¸€ä¸ªè§„èŒƒ.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("è”é‚¦è¿™ç§æœºåˆ¶å¯ä»¥è½åœ°çš„æ ¸å¿ƒè¦æ±‚æ˜¯, è¾¹ç¼˜ Prometheus åŸºæœ¬æ¶ˆåŒ–äº†ç»å¤§éƒ¨åˆ†æŒ‡æ ‡æ•°æ®")])]),s._v(", æ¯”å¦‚å‘Šè­¦, çœ‹å›¾ç­‰, éƒ½åœ¨è¾¹ç¼˜çš„ Prometheus ä¸Šæå®šäº†. åªæœ‰å°‘é‡æ•°æ®, æ¯”å¦‚éœ€è¦åšèšåˆè®¡ç®—æˆ–å…¶ä»–å›¢é˜Ÿä¹Ÿå…³æ³¨çš„æŒ‡æ ‡, è¢«æ‹‰åˆ°ä¸­å¿ƒ, è¿™æ ·å°±ä¸ä¼šè§¦è¾¾ä¸­å¿ƒç«¯ Prometheus çš„å®¹é‡ä¸Šé™. è¿™å°±è¦æ±‚å…¬å¸åœ¨ä½¿ç”¨ Prometheus ä¹‹å‰å…ˆåšå¥½è§„åˆ’, å»ºç«‹è§„èŒƒ. è¯´å®è¯å¯èƒ½å®æ–½èµ·æ¥ä¼šæœ‰ç‚¹å„¿éš¾, æ‰€ä»¥æ›´æ¨èä¸‹é¢çš„è¿œç¨‹å­˜å‚¨æ–¹æ¡ˆ.")]),s._v(" "),t("h4",{attrs:{id:"è¿œç¨‹å­˜å‚¨æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿œç¨‹å­˜å‚¨æ–¹æ¡ˆ"}},[s._v("#")]),s._v(" è¿œç¨‹å­˜å‚¨æ–¹æ¡ˆ")]),s._v(" "),t("p",[s._v("é»˜è®¤æƒ…å†µä¸‹, Prometheus æ”¶é›†åˆ°ç›‘æ§æ•°æ®ä¹‹åæ˜¯"),t("strong",[s._v("å­˜å‚¨åœ¨æœ¬åœ°")]),s._v(", åœ¨æœ¬åœ°æŸ¥è¯¢è®¡ç®—. ç”±äºå•æœºå®¹é‡æœ‰é™, å¯¹äºæµ·é‡æ•°æ®åœºæ™¯, éœ€è¦æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆ. æœ€ç›´è§‚çš„æƒ³æ³•å°±æ˜¯: "),t("strong",[s._v("æ—¢ç„¶æœ¬åœ°æä¸å®š, é‚£å°±åœ¨è¿œç«¯åšä¸€ä¸ªé›†ç¾¤, åˆ†æ²»å¤„ç†")]),s._v(".")]),s._v(" "),t("p",[s._v("Prometheus æœ¬èº«ä¸æä¾›é›†ç¾¤å­˜å‚¨èƒ½åŠ›, å¯ä»¥å¤ç”¨å…¶ä»–æ—¶åºåº“æ–¹æ¡ˆ. æ—¶åºåº“æŒºå¤šçš„, å¦‚æœæŒ¨ä¸ªå„¿å»å¯¹æ¥æ¯”è¾ƒè´¹åŠ², äºæ˜¯ Prometheus å»ºç«‹äº†ç»Ÿä¸€çš„ "),t("strong",[s._v("Remote Read")]),s._v(", Remote Write æ¥å£åè®®, åªè¦æ»¡è¶³è¿™ä¸ªæ¥å£åè®®çš„æ—¶åºåº“éƒ½å¯ä»¥å¯¹æ¥è¿›æ¥, ä½œä¸º Prometheus remote storage ä½¿ç”¨.")]),s._v(" "),t("p",[s._v("ç›®å‰å›½å†…ä½¿ç”¨æœ€å¹¿æ³›çš„è¿œç¨‹å­˜å‚¨ä¸»è¦æ˜¯ "),t("strong",[s._v("VictoriaMetrics å’Œ Thanos")]),s._v(". ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"_1-victoriametrics"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-victoriametrics"}},[s._v("#")]),s._v(" 1.VictoriaMetrics")]),s._v(" "),t("p",[s._v("VM è™½ç„¶å¯ä»¥ä½œä¸º Prometheus çš„è¿œç¨‹å­˜å‚¨, ä½†å®ƒå¿—ä¸åœ¨æ­¤. VM æ˜¯å¸Œæœ›æˆä¸ºä¸€ä¸ªæ›´å¥½çš„ Prometheus, æ‰€ä»¥å®ƒä¸åªæ˜¯æ—¶åºåº“, å®ƒè¿˜æœ‰æŠ“å–å™¨, å‘Šè­¦ç­‰å„ä¸ªç»„ä»¶, ä½“ç³»éå¸¸å®Œå¤‡, ä¸è¿‡ç°åœ¨å›½å†…åŸºæœ¬ä¸Šè¿˜åªæ˜¯æŠŠå®ƒå½“åšæ—¶åºåº“åœ¨ç”¨.")]),s._v(" "),t("p",[s._v("VM ä½œä¸ºæ—¶åºåº“, æ ¸å¿ƒç»„ä»¶åªæœ‰ 3 ä¸ª, vmstorage, vminsert å’Œ vmselect. å…¶ä¸­ vmstorage ç”¨äºå­˜å‚¨æ—¶åºæ•°æ®, vminsert  ç”¨äºæ¥æ”¶æ—¶åºæ•°æ®å¹¶å†™å…¥åˆ°åç«¯çš„ vmstorage, Prometheus ä½¿ç”¨ Remote Write å¯¹æ¥çš„å°±æ˜¯ vminsert çš„åœ°å€, vmselect ç”¨äºæŸ¥è¯¢æ—¶åºæ•°æ®, å®ƒæ²¡æœ‰å®ç° Remote Readæ¥å£, åå€’å®ç°äº† Prometheus çš„ Querier æ¥å£. è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?")]),s._v(" "),t("p",[s._v("å› ä¸º VM è§‰å¾— Remote Read è®¾è®¡å¤ªæŒ«äº†, æ€§èƒ½ä¸å¥½, è¿˜ä¸å¦‚ç›´æ¥å®ç° Querier æ¥å£. è¿™æ ·è®¾è®¡çš„è¯, Grafana è¿™ç±»å‰ç«¯åº”ç”¨ç›´æ¥å¯ä»¥å’Œ vmselect å¯¹æ¥, è€Œä¸ç”¨åœ¨ä¸­é—´åŠ ä¸€å±‚ Prometheus, å¯ä»¥çœ‹ä¸€ä¸‹ VM çš„æ¶æ„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0056079fe57dde7d00e03355b35765e8-20230719203435-pns7cud.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("n9e-webapi å’Œ n9e-server æ˜¯ Nightingale çš„ä¸¤ä¸ªæ¨¡å—, éƒ½å¯ä»¥çœ‹åš VM çš„ä¸Šå±‚åº”ç”¨. é€šè¿‡è¿™å¼ å›¾ç‰‡, å¯ä»¥æ¯”è¾ƒæ¸…æ¥šåœ°çœ‹å‡º VM çš„æ¶æ„ä»¥åŠä¸ä¸Šå±‚åº”ç”¨çš„äº¤äº’æ–¹å¼.")]),s._v(" "),t("p",[s._v("n9e-webapi é€šè¿‡ vmselect æŸ¥è¯¢æ—¶åºæ•°æ®, vmselect æ˜¯æ— çŠ¶æ€æ¨¡å—, å¯ä»¥æ°´å¹³æ‰©å±•, é€šå¸¸éƒ¨ç½²å¤šä¸ªå®ä¾‹, å‰é¢æ¶è®¾è´Ÿè½½å‡è¡¡, æ‰€ä»¥ n9e-webapi é€šå¸¸æ˜¯å¯¹æ¥ vmselect çš„è´Ÿè½½å‡è¡¡. n9e-server ä¹Ÿæœ‰ä¸€äº›æŸ¥è¯¢VMçš„éœ€æ±‚, å…ˆä¸ç”¨å…³æ³¨, é‡ç‚¹å…³æ³¨ Remote Write é‚£æ¡çº¿, n9e-server é€šè¿‡ Remote Write åè®®, æŠŠæ•°æ®è½¬å‘ç»™ vminsert çš„è´Ÿè½½å‡è¡¡, vminsert ä¹Ÿæ˜¯æ— çŠ¶æ€çš„, å¯ä»¥æ°´å¹³æ‰©å±•.")]),s._v(" "),t("p",[s._v("vmstorage æ˜¯å­˜å‚¨æ¨¡å—, å¯ä»¥éƒ¨ç½²å¤šä¸ªç»„æˆé›†ç¾¤, åªè¦æŠŠæ‰€æœ‰ vmstorage çš„åœ°å€å‘Šè¯‰ vmselect å’Œ vminsert, æ•´ä¸ªé›†ç¾¤å°±è·‘èµ·æ¥äº†, éå¸¸ç®€å•.")]),s._v(" "),t("p",[s._v("é—®é¢˜æ˜¯æ•°æ®é€šè¿‡ vminsert è¿›æ¥ä¹‹å, å¦‚ä½•åˆ†ç‰‡? vmselect å’Œ vminsert ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³», vmselect åœ¨æŸ¥è¯¢å…·ä½“æŸä¸ªæŒ‡æ ‡æ•°æ®çš„æ—¶å€™, æ€ä¹ˆçŸ¥é“æ•°æ®ä½äºå“ªä¸ª vmstorage å‘¢? è¿™ä¸ªæ¶æ„è™½ç„¶çœ‹èµ·æ¥ç®€å•, ä½†æ€»æ„Ÿè§‰è·Ÿå¸¸è§çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¤ªä¸€æ ·å‘¢.")]),s._v(" "),t("p",[s._v("ä¸»è¦æ˜¯å› ä¸º VM é‡‡ç”¨äº†ä¸€ç§å«åš merge read çš„æ–¹æ¡ˆ, ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚å‘ç»™ vmselect ä¹‹å, vmselect ä¼šå‘æ‰€æœ‰çš„ vmstorage å‘èµ·æŸ¥è¯¢è¯·æ±‚. æ³¨æ„, æ˜¯æ‰€æœ‰çš„ vmstorage, ç„¶åæŠŠç»“æœåˆå¹¶åœ¨ä¸€èµ·, è¿”å›ç»™å‰ç«¯. æ‰€ä»¥ vmselect å‹æ ¹å°±ä¸ç”¨å…³å¿ƒæ•°æ®ä½äºå“ªä¸ª vmstorage. æ­¤æ—¶ vminsert ç”¨ä»€ä¹ˆåˆ†ç‰‡ç®—æ³•éƒ½æ— æ‰€è°“äº†, æ•°æ®å†™åˆ°å“ªä¸ª vmstorage éƒ½è¡Œ, åæ­£æœ€åéƒ½ä¼š merge read.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªå¥‡è‘©è®¾è®¡, çœ‹èµ·æ¥è¿˜æŒºæœ‰æ•ˆçš„. æœ‰æ²¡æœ‰é—®é¢˜å‘¢? æ˜¾ç„¶æ˜¯æœ‰çš„, å°±æ˜¯ vmstorage é›†ç¾¤"),t("strong",[s._v("ä¸èƒ½å¤ªå¤§")]),s._v(". å¦‚æœæœ‰å‡ åƒä¸ªèŠ‚ç‚¹, éšä¾¿ä¸€ä¸ªæŸ¥è¯¢è¿‡æ¥, vmselect éƒ½ä¼šå‘æ‰€æœ‰ vmstorage å‘èµ·æŸ¥è¯¢, ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æ…¢äº†éƒ½ä¼šæ‹–æ…¢æ•´ä½“é€Ÿåº¦, è¿™å°±è®©äººæ— æ³•æ¥å—äº†. ä¸€èˆ¬æ¥è®², ä¸€ä¸ª vmstorage é›†ç¾¤, æœ‰ä¸€äºŒåä¸ªèŠ‚ç‚¹è¿˜æ˜¯æ¯”è¾ƒå¥åº·çš„, è¿™ä¸ªå®¹é‡å°±å·²ç»éå¸¸å¤§äº†, èƒ½æ»¡è¶³å¤§éƒ¨åˆ†å…¬å¸çš„éœ€æ±‚, æ‰€ä»¥è¿™ä¸æ˜¯ä¸ªå¤§é—®é¢˜.")]),s._v(" "),t("p",[s._v("ä¸ªäººæ¯”è¾ƒå»ºè®®åœ¨é€‰å‹è¿œç¨‹å­˜å‚¨çš„æ—¶å€™ä½¿ç”¨ "),t("strong",[s._v("VictoriaMetrics")]),s._v(", æ¶æ„ç®€å•, æ›´æœ‰æŒæ§åŠ›. åƒ M3 è™½ç„¶å®¹é‡æ¯” VM å¤§å¾—å¤š, ä½†æ˜¯æ¶æ„å¤æ‚, å‡ºäº†é—®é¢˜åè€Œæ— ä»ç€æ‰‹, ä¸å»ºè®®ä½¿ç”¨.")]),s._v(" "),t("p",[s._v("åœ¨ Prometheus å­˜å‚¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¸­, é™¤äº† VM, è¿˜æœ‰ä¸€ä¸ªå½±å“åŠ›æ¯”è¾ƒå¤§çš„å°±æ˜¯ Thanos, ä¹Ÿå°±æ˜¯ä¼ è¯´ä¸­çš„ç­éœ¸.")]),s._v(" "),t("h5",{attrs:{id:"_2-thanos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-thanos"}},[s._v("#")]),s._v(" 2.Thanos")]),s._v(" "),t("p",[s._v("Thanos çš„åšæ³•å’Œ VM ä¸åŒ, Thanos å®Œå…¨æ‹¥æŠ± Prometheus, å¯¹ Prometheus åšäº†ä¸€ä¸ª"),t("strong",[s._v("å¢å¼º")]),s._v(", æ ¸å¿ƒç‰¹ç‚¹æ˜¯ä½¿ç”¨ "),t("strong",[s._v("å¯¹è±¡å­˜å‚¨")]),s._v(" åšæµ·é‡æ—¶åºå­˜å‚¨. æ¶æ„å›¾å¦‚ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/cfbc6d548944f7b169bc469255e1ea4d-20230719203435-y9jq7ak.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ¶æ„å›¾åˆçœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚, "),t("strong",[s._v("é»„è‰²éƒ¨åˆ†æ˜¯ Prometheus è‡ªèº«, è“è‰²éƒ¨åˆ†æ˜¯Thanos, é»‘è‰²éƒ¨åˆ†æ˜¯å­˜å‚¨")]),s._v(". è¿™é‡Œè¾¹æœ‰å‡ ä¸ªæ ¸å¿ƒç‚¹.")]),s._v(" "),t("ol",[t("li",[s._v("æ¯ä¸ª Prometheus éƒ½è¦ä¼´ç”Ÿä¸€ä¸ª Thanos Sidecar ç»„ä»¶, è¿™ä¸ªç»„ä»¶æœ‰ä¸¤ä¸ªä½œç”¨, ä¸€æ˜¯å“åº” Thanos Query çš„æŸ¥è¯¢è¯·æ±‚, äºŒæ˜¯æŠŠ Prometheus äº§ç”Ÿçš„å—æ•°æ®ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨.")]),s._v(" "),t("li",[s._v("Thanos Sidecar è°ƒç”¨ Prometheus çš„æ¥å£æŸ¥è¯¢æ•°æ®, æš´éœ²ä¸º StoreAPI, Thanos Store Gateway è°ƒç”¨å¯¹è±¡å­˜å‚¨çš„æ¥å£æŸ¥è¯¢æ•°æ®, ä¹Ÿæš´éœ²ä¸º StoreAPI. Thanos Query å°±å¯ä»¥ä»è¿™ä¸¤ä¸ªåœ°æ–¹æŸ¥è¯¢æ•°æ®äº†, ç›¸å½“äºè¿‘æœŸæ•°æ®ä» Prometheus è·å–, æ¯”è¾ƒä¹…è¿œçš„æ•°æ®ä»å¯¹è±¡å­˜å‚¨è·å–.")])]),s._v(" "),t("p",[s._v("è™½ç„¶å¯¹è±¡å­˜å‚¨æ¯”è¾ƒå»‰ä»·, ä½†è¿™ä¸ªæ¶æ„çœ‹èµ·æ¥è¿˜æ˜¯è¿‡äºå¤æ‚äº†, æ²¡æœ‰ VM çœ‹èµ·æ¥å¹²å‡€. å¦å¤–è¿™ä¸ªæ¶æ„æ˜¯"),t("strong",[s._v("å’Œ Prometheus å¼ºç»‘å®š")]),s._v("çš„, æ²¡æ³•ç”¨ä½œå•ç‹¬çš„æ—¶åºå­˜å‚¨, æ¯”è¾ƒé—æ†¾. ä¸è¿‡å¥½åœ¨ Thanos è¿˜æœ‰å¦ä¸€ç§æ–¹æ¡ˆ, ä¸ç”¨ Sidecar, ä½¿ç”¨ Receive æ¨¡å—, æ¥æ¥æ”¶ Remote Write åè®®çš„æ•°æ®, å†™å…¥æœ¬åœ°, åŒæ—¶ä¸Šä¼ å¯¹è±¡å­˜å‚¨, çœ‹ä¸€ä¸‹è¿™ä¸ªæ¶æ„.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/25a79b6dfeeaf07e41810f283057d128-20230719203435-6hbdmz9.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("ä»å­˜å‚¨è§’åº¦æ¥çœ‹, è¿™ä¸ªæ¶æ„å’Œ Prometheus å°±æ²¡æœ‰é‚£ä¹ˆå¼ºçš„ç»‘å®šå…³ç³»äº†, å¯ä»¥"),t("strong",[s._v("å•ç‹¬ç”¨ä½œæ—¶åºåº“")]),s._v(". å…³é”®ç‚¹è¿˜æ˜¯å¯¹è±¡å­˜å‚¨, è™½ç„¶å¯¹è±¡å­˜å‚¨æ˜¯æµ·é‡, å»‰ä»·çš„, ä½†æ˜¯å»¶è¿Ÿè¾ƒé«˜, è€Œä¸”ä¸€ä¸ªè¯·æ±‚æ‹†æˆä¸¤éƒ¨åˆ†, ä¸€éƒ¨åˆ†æŸ¥æœ¬åœ°, ä¸€éƒ¨åˆ†æŸ¥å¯¹è±¡å­˜å‚¨, ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¯é .")]),s._v(" "),t("p",[s._v("ç›¸æ¯”æ—¥å¿—ä¹‹ç±»çš„æ•°æ®, æŒ‡æ ‡æ•°æ®çš„ä½“é‡è¾ƒå°, ä¸€èˆ¬å­˜å‚¨ 3 ä¸ªæœˆå°±å¤Ÿäº†, æ‰€ä»¥å¯¹è±¡å­˜å‚¨çš„ä¼˜åŠ¿å°±æ˜¾å¾—æ²¡é‚£ä¹ˆå¤§äº†. å¦‚æœæ˜¯æˆ‘æ¥é€‰å‹, VictoriaMetrics å’Œ Thanos ä¹‹é—´, æˆ‘ä¼šé€‰æ‹©å‰è€….")]),s._v(" "),t("p",[s._v("æ‰€è°“çš„è¿œç¨‹å­˜å‚¨æ–¹æ¡ˆ, æ ¸å¿ƒå°±æ˜¯ Remote Read/Write, å…¶å® Prometheus è‡ªèº«ä¹Ÿå¯ä»¥è¢«åˆ«çš„ Prometheus å½“åš Remote storage, åªè¦å¼€å¯ "),t("code",[s._v("--enable-feature=remote-write-receiver")]),s._v("â€‹ è¿™ä¸ªå‚æ•°å³å¯. ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ Prometheus è‡ªèº«æ€ä¹ˆæ¥æ­å»ºé›†ç¾¤.")]),s._v(" "),t("h4",{attrs:{id:"prometheusè‡ªèº«æ­å»ºé›†ç¾¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheusè‡ªèº«æ­å»ºé›†ç¾¤"}},[s._v("#")]),s._v(" Prometheusè‡ªèº«æ­å»ºé›†ç¾¤")]),s._v(" "),t("p",[s._v("åºŸè¯ä¸å¤šè¯´, ç›´æ¥ä¸Šæ¶æ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/71d8011b147069ac5e477086bd954da0-20230719203435-eu5s8s8.jpg",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("**å›¾ä¸Šæœ‰ä¸‰ä¸ª Prometheus è¿›ç¨‹, æœ‰ä¸¤ä¸ªç”¨ä½œå­˜å‚¨, æœ‰ä¸€ä¸ªç”¨ä½œæŸ¥è¯¢å™¨, ç”¨ä½œæŸ¥è¯¢å™¨çš„ Prometheus é€šè¿‡ Remote Read çš„æ–¹å¼è¯»å–åç«¯å¤šä¸ª Prometheus çš„æ•°æ®, é€šè¿‡å‡ è¡Œ remote_read çš„é…ç½®å°±èƒ½å®ç°. **")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://prometheus01:9090/api/v1/read"')]),s._v("\n    read_recent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://prometheus02:9090/api/v1/read"')]),s._v("\n    read_recent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("Prometheus çš„ remote_read ä¹Ÿæ˜¯ merge read, è·Ÿ vmselect é€»è¾‘ç±»ä¼¼. ä¸è¿‡ VM é›†ç¾¤æ˜¯æœ‰å‰¯æœ¬æœºåˆ¶çš„, ä½¿ç”¨ Prometheus æ¥åšé›†ç¾¤, ä¸å¤ªå¥½åšå‰¯æœ¬. å½“ç„¶å¯ä»¥ç²—æš´åœ°ä¸ºæ¯ä¸ªåˆ†ç‰‡æ•°æ®éƒ¨ç½²å¤šä»½é‡‡é›†å™¨å’Œ PromTSDB, ä¹ŸåŸºæœ¬å¯ä»¥è§£å†³é«˜å¯ç”¨çš„é—®é¢˜.")]),s._v(" "),t("p",[s._v("åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­, å¦‚æœæ‰€æœ‰æ•°æ®éƒ½æ˜¯é€šè¿‡æ‹‰çš„æ–¹å¼æ¥æ”¶é›†, è¿™ç§æ¶æ„ä¹Ÿæ˜¯å¯ä»¥å°è¯•çš„, ä¸è¿‡å¤§éƒ¨åˆ†ä¼ä¸šéƒ½æ˜¯æ¨æ‹‰ç»“åˆ, ç”šè‡³æ¨æ˜¯ä¸»æµ, Remote Write åˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ—¶åºåº“é›†ç¾¤, æ˜¯ä¸€ä¸ªæ›´åŠ é¡ºç•…çš„æ–¹æ¡ˆ.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-6"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²é‡ç‚¹å…³æ³¨äº† Prometheus ç”Ÿæ€å¸¸è§çš„å­˜å‚¨æ‰©å±•é—®é¢˜, å¹¶ç»™å‡ºäº† 3 ç§é›†ç¾¤è§£å†³æ–¹æ¡ˆ.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Prometheus è”é‚¦é›†ç¾¤")]),s._v(": æŒ‰ç…§ä¸šåŠ¡æˆ–è€…åœ°åŸŸ, æ‹†æˆå¤šä¸ªè¾¹ç¼˜Prometheus, ç„¶ååœ¨ä¸­å¿ƒæ­å»ºä¸€ä¸ª Prometheus, æŠŠä¸€äº›é‡è¦çš„å¤šå›¢é˜Ÿå…³æ³¨çš„æŒ‡æ ‡æˆ–éœ€è¦äºŒæ¬¡è®¡ç®—çš„æŒ‡æ ‡æ‹‰åˆ°ä¸­å¿ƒ.")]),s._v(" "),t("li",[t("strong",[s._v("è¿œç¨‹å­˜å‚¨æ–¹æ¡ˆ")]),s._v(": é€šè¿‡ Remote Read/Write åè®®, Prometheus å¯ä»¥å’Œç¬¬ä¸‰æ–¹å­˜å‚¨å¯¹æ¥, æŠŠå­˜å‚¨çš„éš¾é¢˜æŠ›ç»™äº†ç¬¬ä¸‰æ–¹æ¥è§£å†³, å¸¸ç”¨æ–¹æ¡ˆæ˜¯ M3DB, VictoriaMetrics, Thanos. æœ€æ¨èçš„æ˜¯ "),t("strong",[s._v("VictoriaMetrics")]),s._v(", æ¶æ„ç®€å•, æ›´å¯æ§ä¸€äº›.")]),s._v(" "),t("li",[t("strong",[s._v("Prometheus è‡ªèº«æ­å»ºé›†ç¾¤")]),s._v(": ä¹Ÿæ˜¯åˆ©ç”¨äº† Remote Read/Write æœºåˆ¶, åªæ˜¯æŠŠå­˜å‚¨æ¢æˆäº†å¤šä¸ª Prometheus, å¯¹äºå…¨éƒ¨é‡‡ç”¨æ‹‰æ¨¡å‹æŠ“å–æ•°æ®çš„å…¬å¸, æ˜¯å¯ä»¥è€ƒè™‘çš„æ–¹æ¡ˆ.")])]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("è¿™ä¸‰ç§æ–¹æ¡ˆå¾ˆå¥½åœ°è§£å†³äº† Prometheus çš„å­˜å‚¨é—®é¢˜, å¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ¥é€‰ç”¨. ä½†è¿˜æ˜¯è¦æ³¨æ„ä¸€ç‚¹, ä¸è¦åšè¿‡åº¦è®¾è®¡. å¦‚æœæ•°æ®é‡ä¸å¤§, å°±æ— éœ€æ­å»ºæ—¶åºé›†ç¾¤, å¾’å¢ç»´æŠ¤æˆæœ¬.")])])]),s._v(" "),t("p",[s._v("æœ¬èŠ‚çš„æ€ç»´å¯¼å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5ae33622ee24e67036ffe9dae1e92594-20230719203435-l4g0t5c.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_8-å¦‚ä½•ç”¨nightingaleè§£å†³prometheusçš„å‘Šè­¦ç®¡ç†é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-å¦‚ä½•ç”¨nightingaleè§£å†³prometheusçš„å‘Šè­¦ç®¡ç†é—®é¢˜"}},[s._v("#")]),s._v(" 8.å¦‚ä½•ç”¨Nightingaleè§£å†³Prometheusçš„å‘Šè­¦ç®¡ç†é—®é¢˜?")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²ç»§ç»­å…³æ³¨ Prometheus çš„å¦ä¸€ä¸ªé—®é¢˜---"),t("strong",[s._v("å‘Šè­¦ç®¡ç†")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("Prometheus çš„å‘Šè­¦è§„åˆ™, è®°å½•è§„åˆ™éƒ½æ˜¯é‡‡ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼ç®¡ç†çš„")]),s._v(", éå¸¸é€‚åˆå¥‰è¡Œ Infrastructure as Code çš„å…¬å¸æˆ–å›¢é˜Ÿå†…éƒ¨ä½¿ç”¨. ä½†å¦‚æœè¦æŠŠç›‘æ§èƒ½åŠ›å¼€æ”¾ç»™å…¨å…¬å¸, å°±éœ€è¦æœ‰è¾ƒå¥½çš„æ”¯æŒååŒæ“ä½œçš„ UI, è®©å„ä¸ªå›¢é˜Ÿäº’ä¸å¹²æ‰°çš„åŒæ—¶å…±äº«ä¸€äº›é€šç”¨çš„æˆæœ.")]),s._v(" "),t("p",[s._v("è§£å†³è¿™ä¸ªéœ€æ±‚çš„å¼€æºäº§å“, æœ‰ä¸¤æ¬¾å¤‡é€‰, "),t("strong",[s._v("ä¸€ä¸ªæ˜¯ Grafana, å¦ä¸€ä¸ªæ˜¯å¤œèº(Nightingale)")]),s._v(" . Grafana æ“…é•¿å¯è§†åŒ–, æ˜¯ç›‘æ§ç»˜å›¾é¢†åŸŸäº‹å®ä¸Šçš„æ ‡å‡†, è€Œå¤œèºçš„ä¾§é‡ç‚¹æ˜¯å‘Šè­¦ç®¡ç†, æ‰€ä»¥è¿™ä¸€è®²é‡ç‚¹æ¥ä»‹ç»ä¸€ä¸‹å¤œèº, **å¯ä»¥é€šè¿‡å¤œèºæ­å»ºå…¬å¸çº§çš„ç›‘æ§ç³»ç»Ÿ, æŠŠç›‘æ§å‘Šè­¦èƒ½åŠ›èµ‹äºˆå…¬å¸æ‰€æœ‰çš„å›¢é˜Ÿ. **")]),s._v(" "),t("h4",{attrs:{id:"å¤œèºç®€ä»‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¤œèºç®€ä»‹"}},[s._v("#")]),s._v(" å¤œèºç®€ä»‹")]),s._v(" "),t("p",[s._v("å¤œèºæœ€åˆæ˜¯æ»´æ»´å¼€æºçš„, ä¹‹åæèµ ç»™äº†ä¸­å›½è®¡ç®—æœºå­¦ä¼šå¼€æºå‘å±•å§”å‘˜ä¼š(CCF ODC), ç›®æ ‡æ˜¯æ•´åˆäº‘åŸç”Ÿå¼€æºç”Ÿæ€çš„ä¼—å¤šèƒ½åŠ›, ä¸ºç”¨æˆ·æä¾›å¼€ç®±å³ç”¨, ä¸€ä½“åŒ–å…¨æ–¹ä½çš„äº‘åŸç”Ÿç›‘æ§è§£å†³æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("æ³¨: "),t("a",{attrs:{href:"https://github.com/ccfos/nightingale",target:"_blank",rel:"noopener noreferrer"}},[s._v("å¤œèºçš„GitHubåœ°å€"),t("OutboundLink")],1),s._v(" å’Œ "),t("a",{attrs:{href:"https://n9e.github.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ–‡æ¡£åœ°å€"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ä¸€ä¸‹å¤œèºçš„æ¶æ„, å¯¹å¤œèºçš„å·¥ä½œæ¨¡å¼æœ‰ä¸ªåŸºæœ¬çš„è®¤è¯†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/41a846502810df2e0dyyac2a4yy978f9-20230719203435-mme8eph.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å·¦ä¸‹è§’ Agents è¡¨ç¤ºç›‘æ§æ•°æ®é‡‡é›†å™¨, å¤œèºå¯ä»¥å¯¹æ¥å¤šç§ Agent, æ¯”å¦‚ Categraf, Telegraf, Grafana-Agent, Datadog-Agent. è¿™äº› Agent éƒ½æ˜¯ "),t("strong",[s._v("PUSH æ¨¡å‹, å‘¨æœŸæ€§é‡‡é›†ç›‘æ§æ•°æ®, ç„¶åæ¨ç»™ Server çš„ HTTP æ¥å£")]),s._v(".")]),s._v(" "),t("p",[s._v("Server æ¥æ”¶åˆ°æ•°æ®ä¹‹å, ä¼šé€šè¿‡ Remote Write åè®®æŠŠæ•°æ®è½¬å‘ç»™"),t("strong",[s._v("æ—¶åºåº“")]),s._v(", è¿™é‡Œæ—¶åºåº“ä½¿ç”¨çš„æ˜¯ Prometheus, Prometheus è¦æƒ³æ¥æ”¶ Remote Write åè®®çš„æ•°æ®, éœ€è¦åœ¨å¯åŠ¨å‚æ•°ä¸­å¼€å¯ "),t("code",[s._v("--enable-feature=remote-write-receiver")]),s._v("â€‹. é™¤äº†Prometheus, ä¹Ÿå¯ä»¥ä½¿ç”¨ M3DB, VictoriaMetrics, Thanos ç­‰ä½œä¸ºæ—¶åºåº“.")]),s._v(" "),t("p",[s._v("Server çš„èŒèƒ½ç›¸å½“äºä¸€ä¸ª "),t("strong",[s._v("Pushgateway")]),s._v(", åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª"),t("strong",[s._v("å‘Šè­¦å¼•æ“")]),s._v(", å®ƒä¼šå‘¨æœŸæ€§åœ°ä» MySQL ä¸­åŒæ­¥å‘Šè­¦è§„åˆ™, åšè§„åˆ™åˆ¤æ–­ç”Ÿæˆå‘Šè­¦äº‹ä»¶å¹¶å‘é€, å¯¹æ ‡ Prometheus çš„å‘Šè­¦å¼•æ“å’Œ Alertmanager æ¨¡å—. Server è¿˜ä¼šå¾€ Redis å‘é€å¿ƒè·³ä¿¡æ¯, ä¸è¿‡åé¢çš„ç‰ˆæœ¬æœ‰è®¡åˆ’ä¸‹æ‰ Redis, ç›´æ¥ä½¿ç”¨ MySQL å¤„ç†å¿ƒè·³.")]),s._v(" "),t("p",[s._v("Webapi æ¨¡å—æä¾› HTTP æ¥å£, ä¸å‰ç«¯ JavaScript äº¤äº’, ä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½, ä¸€ä¸ªæ˜¯å“åº”ç®¡ç†è¯·æ±‚, æ¯”å¦‚å‘Šè­¦è§„åˆ™, å±è”½è§„åˆ™, ç›‘æ§å¤§ç›˜çš„å¢åˆ æ”¹æŸ¥; ä¸€ä¸ªæ˜¯å“åº”æ—¶åºæ•°æ®æŸ¥è¯¢, ä½œä¸ºä¸€ä¸ª Proxy æŠŠè¯·æ±‚è½¬å‘ç»™åé¢çš„æ—¶åºåº“, ç­‰æ—¶åºåº“è¿”å›ç»“æœä¹‹åå†è½¬å‘ç»™å‰ç«¯.")]),s._v(" "),t("p",[s._v("å¦‚æœæœ‰äº›ç›‘æ§æ•°æ®æ˜¯ä½¿ç”¨ Exporter é‡‡é›†çš„, å°±éœ€è¦ PULL æ¨¡å‹çš„é‡‡é›†æ”¯æŒ. é€šå¸¸æœ‰ 3 ç§åšæ³•, ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨ Prometheus æœ¬èº«, é…ç½® Scrape è§„åˆ™; ä¹Ÿå¯ä»¥å•ç‹¬éƒ¨ç½²ä¸€ä¸ª agent mode æ¨¡å¼çš„ Prometheus ä½œä¸ºæŠ“å–å™¨, å’Œæ—¶åºåº“çš„èŒèƒ½åšè¿›ç¨‹çº§åˆ«çš„æ‹†åˆ†; è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æ”¯æŒ PULL æ¨¡å¼çš„æŠ“å–å™¨, æ¯”å¦‚ Categraf, Grafana-Agent.")]),s._v(" "),t("h4",{attrs:{id:"éƒ¨ç½²å¤œèº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²å¤œèº"}},[s._v("#")]),s._v(" éƒ¨ç½²å¤œèº")]),s._v(" "),t("p",[s._v("äº†è§£äº†å¤œèºçš„æ¶æ„ä¹‹å, ä¸‹é¢ç®€å•èŠä¸€ä¸‹å¦‚ä½•éƒ¨ç½²å¤œèº, æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ "),t("strong",[s._v("Docker compose")]),s._v(", ä¸€è¡Œå‘½ä»¤å°±èƒ½æå®š.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("git clone https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//github.com/ccfos/nightingale.git\ncd docker\ndocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("æµè§ˆå™¨è®¿é—® nwebapi æä¾›çš„ 18000 ç«¯å£å°±èƒ½çœ‹åˆ°ç™»å½•é¡µé¢, é»˜è®¤ç”¨æˆ·æ˜¯ root, é»˜è®¤å¯†ç æ˜¯ root.2020.")]),s._v(" "),t("p",[s._v("å¦‚æœå¯¹ Kubernetes å’Œ Helm æ¯”è¾ƒç†Ÿæ‚‰, ä¹Ÿå¯ä»¥é‡‡ç”¨ "),t("a",{attrs:{href:"https://n9e.github.io/docs/install/helm/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Helm çš„æ–¹å¼éƒ¨ç½²"),t("OutboundLink")],1),s._v(". å½“ç„¶æœ€å¸¸ç”¨çš„å®é™…æ˜¯ "),t("a",{attrs:{href:"https://n9e.github.io/docs/install/server/",target:"_blank",rel:"noopener noreferrer"}},[s._v("äºŒè¿›åˆ¶çš„æ–¹å¼éƒ¨ç½²"),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("p",[s._v("æœåŠ¡ç«¯éƒ¨ç½²å®Œæˆä¹‹å, å¯ä»¥é‡‡é›†ä¸€äº›ç›‘æ§æ•°æ®çœ‹çœ‹çœŸå®æ•ˆæœ, æ¨è "),t("a",{attrs:{href:"https://n9e.github.io/docs/agent/categraf/",target:"_blank",rel:"noopener noreferrer"}},[s._v("å®‰è£… Categraf"),t("OutboundLink")],1),s._v(". å½“ç„¶, å› ä¸ºå¤œèºæ”¯æŒå¤šç§é‡‡é›†å™¨, ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–è‡ªå·±ç†Ÿæ‚‰çš„é‡‡é›†å™¨. å®‰è£…å®Œæˆä¹‹å, æ¥çœ‹ä¸€ä¸‹å¤œèºå…·ä½“æ˜¯å¦‚ä½•ç®¡ç†å‘Šè­¦çš„.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦ç®¡ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦ç®¡ç†"}},[s._v("#")]),s._v(" å‘Šè­¦ç®¡ç†")]),s._v(" "),t("p",[t("strong",[s._v("Prometheus çš„å‘Šè­¦ç®¡ç†æ˜¯åœ¨ prometheus.yml ä¸­é…ç½®å‘Šè­¦è§„åˆ™, åœ¨ alertmanager.yml ä¸­é…ç½®å‘é€è§„åˆ™, éƒ½æ˜¯éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶çš„, ä¸Šç™¾äººä½¿ç”¨çš„è¯ä¸å¤ªå¥½ååŒç®¡ç†")]),s._v(". è€Œå¤œèºæä¾›äº† UI é…ç½®èƒ½åŠ›(å½“ç„¶ä¹Ÿæœ‰ API), å¹¶ä¸”åœ¨ä¸€äº›æ–¹é¢åšäº†å¢å¼º, æ¯”å¦‚æ›´ä¸°å¯Œçš„å‘Šè­¦è§„åˆ™é…ç½®, å†å²äº‹ä»¶å­˜æ¡£, æ´»è·ƒäº‹ä»¶èšåˆæŸ¥çœ‹, å¯¹æ¥å‘Šè­¦è‡ªæ„ˆç­‰. ä¸‹é¢ä¸€èµ·æ¥çœ‹ä¸€ä¸‹å¤œèºå‘Šè­¦ç®¡ç†çš„æ€è·¯.")]),s._v(" "),t("h5",{attrs:{id:"_1-è§„åˆ™ç®¡ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-è§„åˆ™ç®¡ç†"}},[s._v("#")]),s._v(" 1.è§„åˆ™ç®¡ç†")]),s._v(" "),t("p",[s._v("ä¸€ä¸ªå…¬å¸å¯èƒ½ä¼šæœ‰å‡ åä¸Šç™¾å›¢é˜Ÿé…ç½®æˆåƒä¸Šä¸‡æ¡å‘Šè­¦è§„åˆ™, æ˜¾ç„¶ä¸èƒ½ç”¨ä¸€ä¸ªæ‰å¹³åŒ–çš„è¡¨æ ¼æ¥ç½—åˆ—ç®¡ç†, å¤œèºå¼•å…¥äº†ä¸€ä¸ª "),t("strong",[s._v("ä¸šåŠ¡ç»„")]),s._v(" çš„æ¦‚å¿µ, æ¯ä¸€æ¡è§„åˆ™éƒ½è¦å½’å±äºæŸä¸€ä¸ªä¸šåŠ¡ç»„, åªæœ‰è¿™ä¸ªä¸šåŠ¡ç»„çš„äººå¯ä»¥ç®¡ç†ç»„å†…çš„è§„åˆ™.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/03bcf4b6c36a6229c0ed988d2b2c8db3-20230719203435-v4ja9pw.png",alt:""}})]),s._v(" "),t("p",[s._v("å½“ç„¶, ä¸šåŠ¡ç»„ä¸‹é¢ä¸ä»…æœ‰"),t("strong",[s._v("å‘Šè­¦è§„åˆ™, è¿˜æœ‰ç›‘æ§å¤§ç›˜, ç›‘æ§å¯¹è±¡, å±è”½è§„åˆ™, è®¢é˜…è§„åˆ™, å‘Šè­¦è‡ªæ„ˆè„šæœ¬")]),s._v("ç­‰ç­‰. ä¸šåŠ¡ç»„æ˜¯å¤œèºé‡Œæœ€é‡è¦çš„ä¸€ä¸ªç®¡ç†æ¦‚å¿µ.")]),s._v(" "),t("h5",{attrs:{id:"_2-è§„åˆ™é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-è§„åˆ™é…ç½®"}},[s._v("#")]),s._v(" 2.è§„åˆ™é…ç½®")]),s._v(" "),t("p",[s._v("å‘Šè­¦è§„åˆ™çš„é…ç½®, æ ¸å¿ƒè¿˜æ˜¯ "),t("mark",[t("strong",[s._v("PromQL å’ŒæŒç»­æ—¶é•¿")])]),s._v(". å½“ç„¶å¤œèºä¼šæœ‰ä¸€äº›é¢å¤–çš„å¢å¼ºé…ç½®, æ¯”å¦‚è§„åˆ™çš„ç”Ÿæ•ˆæ—¶é—´æ®µ, æ˜¯å¦ä»…åœ¨æœ¬ä¸šåŠ¡ç»„ç”Ÿæ•ˆ, æ˜¯å¦å¯ç”¨æ¢å¤é€šçŸ¥, ç•™è§‚æ—¶é•¿, æœ€å¤§å‘é€æ¬¡æ•°ç­‰ç­‰.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/745bc53a10935d4b8515a9ayyd999961-20230719203435-eq514mk.png",alt:""}})]),s._v(" "),t("p",[s._v("å¤œèºçš„å‘Šè­¦è§„åˆ™æ˜¯æŠŠ PromQL å’Œå‘é€æ–¹å¼æ•´åˆåˆ°äº†ä¸€æ¡è§„åˆ™ä¸­, è¿™ä¸ªåšæ³•å’Œ Alertmanager æ˜¯ä¸åŒçš„, Prometheus çš„å‘Šè­¦è§„åˆ™åªæœ‰ PromQL, æŒç»­æ—¶é•¿, é™„åŠ æ ‡ç­¾, æ³¨è§£è¿™äº›åŸºæœ¬ä¿¡æ¯, è‡³äºå‘ç»™è°, æ€ä¹ˆå‘, éƒ½æ˜¯åœ¨ Alertmanager ä¸­é…ç½®çš„. å¦‚ä½•è¯„ä»·è¿™ä¸¤ç§æ–¹å¼å‘¢?")]),s._v(" "),t("p",[s._v("Prometheus+Alertmanager çš„æ–¹å¼, å¯ä»¥çœ‹åšæ˜¯è®¢é˜…å¼, å‘Šè­¦è§„åˆ™ä¸­ä¸æŒ‡å®šæ¥æ”¶è€…, åœ¨ Alertmanager çš„é…ç½®ä¸­ç»Ÿä¸€è®¾ç½®è¿‡æ»¤æ¡ä»¶å’Œå¯¹åº”çš„æ¥æ”¶è€…. è¿™ç§æ–¹å¼éå¸¸çµæ´», ä½†çµæ´»çš„ä¸œè¥¿å¾€å¾€éœ€è¦å®šè§„èŒƒ, å¦åˆ™å®¹æ˜“æ··ä¹±, æ¯”å¦‚å¤§å®¶ç»Ÿä¸€æŒ‰ç…§ä¸šåŠ¡çº¿çš„æ ‡ç­¾æ¥åšè®¢é˜…, è¿™å°±è¦æ±‚æ—¶åºæ•°æ®éƒ½è¦æ‰“ä¸Šä¸šåŠ¡çº¿çš„æ ‡ç­¾, æˆ–è€…æŠŠä¸šåŠ¡çº¿çš„æ ‡ç­¾æ”¾åˆ°å‘Šè­¦è§„åˆ™çš„é™„åŠ æ ‡ç­¾ä¸­, éœ€è¦ä»˜å‡ºä¸€äº›é¢å¤–çš„å¿ƒåŠ›.")]),s._v(" "),t("p",[s._v("Alertmanager çš„æ–¹å¼ç‰¹åˆ«é€‚åˆä»€ä¹ˆåœºæ™¯å‘¢? å°±æ˜¯æ‰€æœ‰çš„å‘Šè­¦éƒ½ç»Ÿä¸€ç”±æŸä¸€ä¸ªå›¢é˜Ÿæ¥è´Ÿè´£, åœ¨è¿™ç§åœºæ™¯ä¸‹,  Prometheus+Alertmanager ä¸å¤±ä¸ºä¸€ç§æœ€ä½³å®è·µ.")]),s._v(" "),t("p",[s._v("å¤œèºçš„å¤„ç†æ–¹å¼å’Œ Datadog å¾ˆåƒ, "),t("strong",[s._v("æ¯ä¸ªå›¢é˜Ÿé…ç½®è‡ªå·±çš„å‘Šè­¦è§„åˆ™, å‘ç»™è‡ªå·±è¿™ä¸ªå›¢é˜Ÿ, å³è‡ªå·±ç®¡è‡ªå·±çš„, ä¸éœ€è¦æŠŠå‘Šè­¦è§„åˆ™å’Œæ¥æ”¶è§„åˆ™æ‹†åˆ°ä¸¤ä¸ªåœ°æ–¹åˆ†åˆ«é…ç½®")]),s._v(", è€Œä¸”å¤œèºä¹Ÿæ”¯æŒè®¢é˜…æ–¹å¼, åé¢ä¼šä»‹ç».")]),s._v(" "),t("h5",{attrs:{id:"_3-å‘Šè­¦å±è”½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-å‘Šè­¦å±è”½"}},[s._v("#")]),s._v(" 3.å‘Šè­¦å±è”½")]),s._v(" "),t("p",[s._v("å‘Šè­¦å±è”½è¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒç®€å•, æ˜¯"),t("strong",[s._v("æŒ‡å¯¹ä¸€äº›å‘Šè­¦äº‹ä»¶åšé™é»˜å¤„ç†")]),s._v(". å¯¹äºé‚£äº›é¢„æœŸå†…çš„å‘Šè­¦, å¤„ç†äººä¸å¸Œæœ›è¢«æ‰“æ‰°å°±ä¼šçŸ­æ—¶é—´åšä¸€ä¸‹å±è”½, é€šå¸¸æ˜¯æ ¹æ®æ ‡ç­¾å¯¹äº‹ä»¶åšè¿‡æ»¤.")]),s._v(" "),t("p",[s._v("å¤œèºç›®å‰çš„ç‰ˆæœ¬, åªèƒ½æŒ‰ç…§æ—¶é—´æ®µå±è”½, æ¯”å¦‚å±è”½å‡Œæ™¨ 0 ç‚¹åˆ°æ—©ä¸Š 7 ç‚¹çš„æ‰€æœ‰å‘Šè­¦, ä¸èƒ½åšå‘¨æœŸæ€§å±è”½, åé¢çš„ç‰ˆæœ¬ä¼šè€ƒè™‘å¢åŠ è¿™ä¸ªåŠŸèƒ½.")]),s._v(" "),t("h5",{attrs:{id:"_4-å‘Šè­¦è®¢é˜…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-å‘Šè­¦è®¢é˜…"}},[s._v("#")]),s._v(" 4.å‘Šè­¦è®¢é˜…")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæœºåˆ¶å’Œ Alertmanager æœ‰ç‚¹å„¿åƒ, "),t("strong",[s._v("å¯ä»¥æ ¹æ®å‘Šè­¦è§„åˆ™æˆ–æ ‡ç­¾åšäº‹ä»¶è®¢é˜…, ç±»ä¼¼äºé‚®ä»¶çš„æŠ„é€åŠŸèƒ½")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚æˆ‘æ˜¯ä¸šåŠ¡æ–¹, ä¸šåŠ¡è·‘åœ¨ Kubernetes ä¸­, Kubernetes å¹³å°å¦‚æœå‘ç”Ÿé‡å¤§æ•…éšœ, æˆ‘æ˜¯å¸Œæœ›èƒ½åŠæ—¶çŸ¥é“çš„, æ‰€ä»¥å¯ä»¥è®¢é˜… Kubernetes çš„æ‰€æœ‰ä¸¥é‡å‘Šè­¦. å¦å¤–, è™½ç„¶æˆ‘å¸Œæœ›å¾—çŸ¥ Kubernetes çš„ä¸¥é‡å‘Šè­¦, ä½†æˆ‘æ¯•ç«Ÿä¸æ˜¯ Kubernetes çš„è¿ç»´äººå‘˜, æ‰€ä»¥æˆ‘åœ¨è®¢é˜…è¿™ç±»äº‹ä»¶çš„æ—¶å€™, ä¸å¸Œæœ›ç”¨ç”µè¯è¿™ç§æ–¹å¼æ¥æ”¶å‘Šè­¦(å¤ªé‡äº†), åªå¸Œæœ›ç”¨é‚®ä»¶ä¹‹ç±»çš„è½»é‡çº§æ–¹å¼, æ‰€ä»¥è®¢é˜…è§„åˆ™ä¸­é€šå¸¸å¯ä»¥é‡æ–°å®šä¹‰å‘é€åª’ä»‹, é‡æ–°å®šä¹‰äº‹ä»¶çº§åˆ«.")]),s._v(" "),t("h5",{attrs:{id:"_5-å†å²å‘Šè­¦å­˜æ¡£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-å†å²å‘Šè­¦å­˜æ¡£"}},[s._v("#")]),s._v(" 5.å†å²å‘Šè­¦å­˜æ¡£")]),s._v(" "),t("p",[s._v("å› ä¸ºå¤œèºä¾èµ– MySQL åšæ•°æ®æŒä¹…åŒ–, æ‰€ä»¥"),t("strong",[s._v("å‘Šè­¦äº‹ä»¶å¯ä»¥ç›´æ¥å­˜å…¥æ•°æ®åº“")]),s._v(", æ‰€æœ‰çš„å†å²å‘Šè­¦éƒ½å¯ä»¥è¿½è¸ªæŸ¥è¯¢. è™½ç„¶è¿™ä¸ªåŠŸèƒ½å¾ˆç®€å•, ä½†å¾ˆå¤šä¼ä¸šéƒ½éœ€è¦, åœ¨è‡ªè¯æ¸…ç™½çš„æ—¶å€™æ˜¾å¾—å°¤ä¸ºé‡è¦.")]),s._v(" "),t("p",[s._v("å½“ç„¶, æ‰€æœ‰å†å²å‘Šè­¦å­˜æ¡£, ä¹Ÿå¯ä»¥ç”¨äºåç»­åˆ†æ, ä»è¿™äº›æ•°æ®ä¸­å¯ä»¥è½»æ˜“å¾—çŸ¥å“ªäº›ä¸šåŠ¡çº¿çš„å‘Šè­¦å‘é€å¾—æœ€å¤š, æ¶ˆè€—ç”µè¯, çŸ­ä¿¡è´¹ç”¨æœ€å¤š, å“ªäº›ä¸šåŠ¡çº¿çš„å‘Šè­¦è§£å†³å¾—æœ€å¿«, å“ªäº›äººæ˜¯æ¥æ”¶å‘Šè­¦çš„åŠ³æ¨¡ç­‰ç­‰. å…¶å®ä¹Ÿèƒ½ä»ä¾§é¢åæ˜ å‡ºè¿™ä¸ªå›¢é˜Ÿçš„å‘Šè­¦ç­–ç•¥éœ€è¦ä¼˜åŒ–, æˆ–è€…ä¸šåŠ¡ç¨³å®šæ€§éœ€è¦ä¼˜åŒ–.")]),s._v(" "),t("h5",{attrs:{id:"_6-æ´»è·ƒå‘Šè­¦èšåˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-æ´»è·ƒå‘Šè­¦èšåˆ"}},[s._v("#")]),s._v(" 6.æ´»è·ƒå‘Šè­¦èšåˆ")]),s._v(" "),t("p",[s._v("æ‰€è°“"),t("strong",[s._v("æ´»è·ƒå‘Šè­¦å°±æ˜¯æœªæ¢å¤çš„å‘Šè­¦")]),s._v(", æ´»è·ƒå‘Šè­¦åŠŸèƒ½å¾ˆé‡è¦, åº”è¯¥ä½œä¸ºæ—¥å¸¸å·¡æ£€å¿…é¡»è¦å…³æ³¨çš„é¡µé¢.")]),s._v(" "),t("p",[s._v("ä¸ºäº†å‡å°‘æŸ¥çœ‹çš„å¿ƒç†è´Ÿæ‹…, ä¾¿äºç»™å‘Šè­¦äº‹ä»¶åˆ†ç±», å¤œèºæ”¯æŒèšåˆå¡ç‰‡è§†å›¾, è€Œä¸”èšåˆè§„åˆ™æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„, æ¯”å¦‚å½“å‰æœ‰ 300 æ¡æœªæ¢å¤çš„å‘Šè­¦, å¯ä»¥æ ¹æ®å‘Šè­¦è§„åˆ™èšåˆæŸ¥çœ‹, ä¹Ÿå¯ä»¥æ ¹æ®åœ°åŸŸ, ä¸šåŠ¡çº¿, æœåŠ¡, æœºå™¨ç­‰ç»´åº¦èšåˆæŸ¥çœ‹, ä¸€ç›®äº†ç„¶éå¸¸æ–¹ä¾¿.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5390bd7d2ba815323acdcbe81d0dee45-20230719203435-ojzp68f.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"_7-å‘Šè­¦è‡ªæ„ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-å‘Šè­¦è‡ªæ„ˆ"}},[s._v("#")]),s._v(" 7.å‘Šè­¦è‡ªæ„ˆ")]),s._v(" "),t("p",[t("strong",[s._v("å½“å‘Šè­¦äº‹ä»¶è§¦å‘ä¹‹å, èƒ½è‡ªåŠ¨è§¦å‘ä¸€ä¸ªæ¢å¤åŠ¨ä½œæ¥æ­¢æŸ, è¿™å°±æ˜¯æ‰€è°“çš„å‘Šè­¦è‡ªæ„ˆ")]),s._v(". ä¸€èˆ¬ç›‘æ§ç³»ç»Ÿéƒ½ä¼šæ”¯æŒ Webhook, å‘Šè­¦è§¦å‘ä¹‹åè‡ªåŠ¨å›è°ƒæŸä¸ªæ¥å£, å°±å¯ä»¥åœ¨è¿™ä¸ªæ¥å£é‡Œå†™ä¸€äº›è‡ªåŠ¨åŒ–é€»è¾‘, ä½†æ˜¯è¿™ç§æ–¹å¼è¿˜æ˜¯è¦å†™ä¸ª HTTP Server çš„, æˆæœ¬ç•¥é«˜. å¤œèºé™¤äº†æ”¯æŒ Webhook ä¹‹å¤–, è¿˜å¯ä»¥"),t("strong",[s._v("åœ¨å‘Šè­¦æ—¶è‡ªåŠ¨æ‰§è¡ŒæŸä¸ªè„šæœ¬")]),s._v(", ç”¨æˆ·å°±å¯ä»¥ç›´æ¥åœ¨è„šæœ¬é‡Œå†™é€»è¾‘äº†.")]),s._v(" "),t("p",[s._v("å‘Šè­¦è‡ªæ„ˆä¾èµ– "),t("a",{attrs:{href:"https://github.com/flashcatcloud/ibex",target:"_blank",rel:"noopener noreferrer"}},[s._v("ibex"),t("OutboundLink")],1),s._v(" æ¨¡å—, è¿™æ˜¯ä¸€ä¸ªæ‰¹é‡æ‰§è¡Œè„šæœ¬çš„å°å·¥å…·, å¯ä»¥å®‰è£…æµ‹è¯•ä¸€ä¸‹. ä¸è¿‡æœ‰äº›å…¬å¸ä¼šè§‰å¾—æœ‰å®‰å…¨éšæ‚£, ä¸æ•¢å¼€å¯è¿™ä¸ªåŠŸèƒ½, å¦‚æœå¼€æ”¾åˆ°å…¬ç½‘çš„è¯ç¡®å®éœ€è¦å°å¿ƒ.")]),s._v(" "),t("p",[s._v("è‡ªæ„ˆè„šæœ¬è¦èƒ½å¤Ÿåœ¨æœºå™¨ä¸Šè¿è¡Œ, éœ€è¦æœ‰è¾ƒå¼ºçš„æƒé™ç®¡æ§, è¿™ä¸ªæƒé™ä¹Ÿæ˜¯ä¾èµ–ä¸šåŠ¡ç»„çš„æœºåˆ¶, åªæœ‰è¿™ä¸ªä¸šåŠ¡ç»„çš„ç®¡ç†äººå‘˜, æ‰èƒ½å»è¿™ä¸ªç»„å†…çš„æœºå™¨ä¸Šè·‘è„šæœ¬. å¤œèºé‡Œæœ‰ä¸ªå¯¹è±¡ç®¡ç†, ä¸»è¦å°±æ˜¯ç®¡æœºå™¨çš„, è®¾è®¡å¯¹è±¡ç®¡ç†åŠŸèƒ½å¾ˆé‡è¦çš„ä¸€ä¸ªåŸå› å°±æ˜¯ä¸ºäº†æ”¯æŒå‘Šè­¦è‡ªæ„ˆ.")]),s._v(" "),t("h5",{attrs:{id:"_8-å¤±è”å‘Šè­¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-å¤±è”å‘Šè­¦"}},[s._v("#")]),s._v(" 8.å¤±è”å‘Šè­¦")]),s._v(" "),t("p",[s._v("å¤œèºä¸»è¦æ˜¯ç”¨æ¨æ¨¡å¼æ¥æ¥æ”¶ç›‘æ§æ•°æ®, æ‰€ä»¥å¦‚ä½•æ„ŸçŸ¥ç›‘æ§å¯¹è±¡å¤±è”æ˜¯ä¸ªæ¯”è¾ƒéº»çƒ¦çš„é—®é¢˜. PromQL ä¸­æœ‰ absent å‡½æ•°, ä½†æ˜¯è¿™ä¸ªå‡½æ•°ä½¿ç”¨èµ·æ¥éå¸¸éº»çƒ¦, å¦‚æœè¦ä¸º 100 å°æœºå™¨é…ç½®å¤±è”å‘Šè­¦, å°±è¦é…ç½® 100 æ¡å‘Šè­¦è§„åˆ™, åŸºæœ¬æ— æ³•ç®¡ç†.")]),s._v(" "),t("p",[s._v("å¤œèºåœ¨æœåŠ¡ç«¯åŠ äº†ä¸€ä¸ªé€»è¾‘, æ¥æ”¶åˆ°ç›‘æ§æ•°æ®ä¹‹å, ä¼šè‡ªåŠ¨ä»æ•°æ®ä¸­è§£æå‡º ident æ ‡ç­¾å½“åšæœºå™¨æ ‡è¯†, ç„¶åä¸ºè¿™ä¸ªæœºå™¨ç”Ÿæˆ target_up æŒ‡æ ‡. è¿™ä¸ªæœºå™¨æœ‰ç›‘æ§æ•°æ®ä¸ŠæŠ¥, åˆ™ target_up çš„å€¼è®¾ç½®ä¸º 1; å¦‚æœé•¿æ—¶é—´æ”¶ä¸åˆ°æœºå™¨çš„æŒ‡æ ‡ä¸ŠæŠ¥, åˆ™ target_up çš„å€¼è®¾ç½®ä¸º 0. é€šè¿‡è¿™ç§æ–¹å¼, åªéœ€è¦é…ç½®ä¸€æ¡å‘Šè­¦è§„åˆ™å°±å¯ä»¥è¦†ç›–æ‰€æœ‰çš„ç›‘æ§å¯¹è±¡.")]),s._v(" "),t("p",[s._v("ä»¥ä¸Šå°±æ˜¯å¤œèºæ‰€æœ‰å‘Šè­¦ç›¸å…³çš„åŠŸèƒ½, æœ‰äº›äººäº†è§£äº†å¤œèºä¹‹åè§‰å¾—ä¸é”™, æƒ³è¦å»å°è¯•, ä½†æ˜¯ä¹‹å‰å¾ˆå¤šè§„åˆ™å·²ç»ç”¨ Prometheus Yaml æ–‡ä»¶ç®¡ç†äº†, æ„Ÿè§‰è¿ç§»èµ·æ¥æ¯”è¾ƒéº»çƒ¦, æ€ä¹ˆææ¯”è¾ƒåˆé€‚?")]),s._v(" "),t("p",[s._v("å…¶å® è€çš„ Yaml æ–‡ä»¶ç®¡ç†çš„è§„åˆ™å…¶å®å¯ä»¥ä¸ç”¨åŠ¨, ç”šè‡³å¦‚æœ Prometheus åªæ˜¯ç»™è‡ªå·±å›¢é˜Ÿä½¿ç”¨çš„è¯ä¹Ÿä¸å¤ªéœ€è¦å¼•å…¥å¤œèº, åªæœ‰é‚£äº›æƒ³è¦ "),t("strong",[s._v("æŠŠç›‘æ§èƒ½åŠ›å¼€æ”¾ç»™å…¨å…¬å¸ç”¨çš„åœºæ™¯")]),s._v(" æ‰éœ€è¦å¼•å…¥å¤œèº, è€Œä¸”æ–°è§„åˆ™å¯ä»¥ç”¨å¤œèºç®¡ç†, è€çš„è§„åˆ™ä¸è¿ç§»æˆ–è€…æ…¢æ…¢è¿ç§»éƒ½æ˜¯å¯ä»¥çš„. è¿˜æ˜¯é‚£å¥è¯, "),t("mark",[t("strong",[s._v("æŠ€æœ¯æ˜¯ä¸ºäº†è§£å†³ç°å®é—®é¢˜, æ²¡æœ‰ä»€ä¹ˆéé»‘å³ç™½")])]),s._v("â€‹ **. **")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-7"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²è¦è§£å†³çš„é—®é¢˜æ˜¯å¢å¼º Prometheus çš„å‘Šè­¦ç®¡ç†èƒ½åŠ›, å› ä¸º Prometheus çš„ Yaml æ–‡ä»¶ç®¡ç†æ–¹å¼ä¸å¤ªæ–¹ä¾¿åšå…¬å¸çº§ååŒç®¡ç†. "),t("strong",[s._v("Grafana å’Œå¤œèºéƒ½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜, ä¸è¿‡ Grafana æ›´æ“…é•¿çœ‹å›¾, å¤œèºæ›´æ“…é•¿å‘Šè­¦ç®¡ç†")]),s._v(", æ‰€ä»¥è¿™ä¸€è®²é‡ç‚¹è®²è§£äº†å¤œèºçš„å‘Šè­¦åŠŸèƒ½.")]),s._v(" "),t("p",[s._v("å¤œèºå‘Šè­¦ç®¡ç†èƒ½åŠ›åˆ†ä¸‰ç±», ä¸€ä¸ªæ˜¯è§„åˆ™ç®¡ç†, åŒ…æ‹¬å‘Šè­¦è§„åˆ™, å±è”½è§„åˆ™, è®¢é˜…è§„åˆ™, ä¸€ä¸ªæ˜¯äº‹ä»¶ç®¡ç†, åŒ…æ‹¬å†å²äº‹ä»¶, æ´»è·ƒäº‹ä»¶, æœ€åä¸€ä¸ªæ˜¯å‘Šè­¦è‡ªæ„ˆ.")]),s._v(" "),t("p",[s._v("æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/07b303cb4458f66d42669953e737c2f2-20230719203435-fpo4a64.jpg",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"ç›‘æ§å®æˆ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§å®æˆ˜"}},[s._v("#")]),s._v(" ç›‘æ§å®æˆ˜")]),s._v(" "),t("h3",{attrs:{id:"_9-ç›‘æ§æ¦‚è®º-æœ‰å“ªäº›æ–¹æ³•å¯ä»¥æŒ‡å¯¼ç›‘æ§æ•°æ®é‡‡é›†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-ç›‘æ§æ¦‚è®º-æœ‰å“ªäº›æ–¹æ³•å¯ä»¥æŒ‡å¯¼ç›‘æ§æ•°æ®é‡‡é›†"}},[s._v("#")]),s._v(" 9.ç›‘æ§æ¦‚è®º-æœ‰å“ªäº›æ–¹æ³•å¯ä»¥æŒ‡å¯¼ç›‘æ§æ•°æ®é‡‡é›†?")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²å¼€å§‹è¿›å…¥ç›‘æ§å®æˆ˜éƒ¨åˆ†, çœ‹çœ‹å…·ä½“æ€ä¹ˆç›‘æ§ä¸åŒç±»å‹çš„ç›®æ ‡å¯¹è±¡. è¿™é‡Œå…ˆç”¨ä¸¤è®²è®²ä¸€ä¸‹ç›‘æ§æ–¹æ³•è®ºå’Œå…¸å‹çš„ç›‘æ§æ•°æ®é‡‡é›†åŸç†.")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²ä¸»è¦ä»‹ç»"),t("strong",[s._v("ç›‘æ§æ–¹æ³•è®º")]),s._v(", å› ä¸ºè¦ç›‘æ§çš„ç›®æ ‡äº”èŠ±å…«é—¨, æ€æ ·æ‰èƒ½è®©ç›‘æ§æ•°æ®æ›´åŠ å®Œå¤‡, æ€æ ·æ‰èƒ½çŸ¥é“å“ªäº›æŒ‡æ ‡æ›´åŠ é‡è¦, è§£å†³è¿™äº›é—®é¢˜éƒ½éœ€è¦ç›‘æ§æ–¹æ³•è®ºçš„æŒ‡å¯¼. ç›®å‰ä¸šç•Œæ¯”è¾ƒæµè¡Œçš„æ–¹æ³•è®ºæœ‰ Google çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡, RED æ–¹æ³•, USE æ–¹æ³•, ä¸‹é¢ä¸€ä¸€ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),t("h4",{attrs:{id:"googleçš„å››ä¸ªé»„é‡‘æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#googleçš„å››ä¸ªé»„é‡‘æŒ‡æ ‡"}},[s._v("#")]),s._v(" Googleçš„å››ä¸ªé»„é‡‘æŒ‡æ ‡")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("Google çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡ç€çœ¼ç‚¹åœ¨æœåŠ¡ç›‘æ§, è¿™å››ä¸ªæŒ‡æ ‡åˆ†åˆ«æ˜¯å»¶è¿Ÿ, æµé‡, é”™è¯¯å’Œé¥±å’Œåº¦.")])])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å»¶è¿Ÿ")]),s._v(": æœåŠ¡è¯·æ±‚æ‰€èŠ±è´¹çš„æ—¶é—´, æ¯”å¦‚ç”¨æˆ·è·å–å•†å“åˆ—è¡¨é¡µé¢è°ƒç”¨çš„æŸä¸ªæ¥å£, èŠ±è´¹ 30 æ¯«ç§’. è¿™ä¸ªæŒ‡æ ‡éœ€è¦åŒºåˆ†æˆåŠŸè¯·æ±‚å’Œå¤±è´¥è¯·æ±‚, å› ä¸ºå¤±è´¥çš„è¯·æ±‚å¯èƒ½ä¼šç«‹åˆ»è¿”å›, å»¶è¿Ÿå¾ˆå°, ä¼šæ‰°ä¹±æ­£å¸¸çš„è¯·æ±‚å»¶è¿Ÿæ•°æ®.")]),s._v(" "),t("li",[t("strong",[s._v("æµé‡")]),s._v(": HTTP æœåŠ¡çš„è¯å°±æ˜¯æ¯ç§’ HTTP è¯·æ±‚æ•°, RPC æœåŠ¡çš„è¯å°±æ˜¯æ¯ç§’ RPCCall çš„æ•°é‡, å¦‚æœæ˜¯æ•°æ®åº“, å¯èƒ½ç”¨æ•°æ®åº“ç³»ç»Ÿçš„äº‹åŠ¡é‡æ¥ä½œä¸ºæµé‡æŒ‡æ ‡.")]),s._v(" "),t("li",[t("strong",[s._v("é”™è¯¯")]),s._v(": è¯·æ±‚å¤±è´¥çš„é€Ÿç‡, å³æ¯ç§’æœ‰å¤šå°‘è¯·æ±‚å¤±è´¥, æ¯”å¦‚ HTTP è¯·æ±‚è¿”å›äº† 500 é”™è¯¯ç , è¯´æ˜è¿™ä¸ªè¯·æ±‚æ˜¯å¤±è´¥çš„, æˆ–è€…è™½ç„¶è¿”å›çš„çŠ¶æ€ç æ˜¯ 200, ä½†æ˜¯è¿”å›çš„å†…å®¹ä¸ç¬¦åˆé¢„æœŸ, ä¹Ÿè®¤ä¸ºæ˜¯è¯·æ±‚å¤±è´¥.")]),s._v(" "),t("li",[t("strong",[s._v("é¥±å’Œåº¦")]),s._v(': æè¿°åº”ç”¨ç¨‹åºæœ‰å¤š"æ»¡", æˆ–è€…æè¿°å—é™çš„èµ„æº, æ¯”å¦‚ CPU å¯†é›†å‹åº”ç”¨, CPU ä½¿ç”¨ç‡å°±å¯ä»¥ä½œä¸ºé¥±å’Œåº¦æŒ‡æ ‡.')])]),s._v(" "),t("p",[s._v("æœ‰äº†è¿™ä¸ªæ–¹æ³•è®ºçš„æŒ‡å¯¼, å°±çŸ¥é“æœåŠ¡ç›‘æ§åº”è¯¥é‡ç‚¹å…³æ³¨å“ªäº›æŒ‡æ ‡äº†. å¦‚æœè¦ä¸ºæŸä¸ªæœåŠ¡é…ç½®ç›‘æ§å¤§ç›˜, ç›‘æ§å¤§ç›˜é‡Œå°±è¦åŒ…å«ä¸Šè¿°è¿™å‡ ç±»æŒ‡æ ‡. å¦‚æœè¦é…ç½®å‘Šè­¦è§„åˆ™, ä¹Ÿè¦é‡ç‚¹ç…§é¡¾è¿™å‡ ç±»æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("å¯ä»¥è¿™ä¹ˆè¯´, åªè¦ä¸Šè¿°è¿™äº›æŒ‡æ ‡éƒ½æ˜¯æ­£å¸¸çš„, è¿™ä¸ªæœåŠ¡å°±æ˜¯å¥åº·çš„. åä¹‹å¦‚æœè¿™äº›æŒ‡æ ‡æœ‰é—®é¢˜, æœåŠ¡å°±æ˜¯ä¸å¥åº·çš„, å¹¶ä¸”å¤§æ¦‚ç‡å·²ç»å½±å“äº†ä¸Šæ¸¸æœåŠ¡ç”šè‡³ç»ˆç«¯ç”¨æˆ·.")]),s._v(" "),t("p",[s._v("Google çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡ä¸»è¦æ˜¯"),t("strong",[s._v("é’ˆå¯¹æœåŠ¡çš„ç›‘æ§")]),s._v(", Weaveworks çš„å·¥ç¨‹å¸ˆè®¤ä¸ºé¥±å’Œåº¦è¿™ä¸ªæŒ‡æ ‡æ¯”è¾ƒé«˜çº§, å»¶è¿Ÿ, æµé‡, é”™è¯¯è¿™ä¸‰ä¸ªæŒ‡æ ‡ç›¸å¯¹æ›´é‡è¦, æ‰€ä»¥å°†å…¶ç®€åŒ–ä¸º RED æ–¹æ³•, ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ RED æ–¹æ³•çš„å®šä¹‰.")]),s._v(" "),t("h4",{attrs:{id:"redæ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redæ–¹æ³•"}},[s._v("#")]),s._v(" REDæ–¹æ³•")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("(Request)Rate")]),s._v(": è¯·æ±‚é€Ÿç‡, æ¯ç§’è¯·æ±‚æ•°.")]),s._v(" "),t("li",[t("strong",[s._v("(Request)Errors")]),s._v(": é”™è¯¯, æ¯ç§’é”™è¯¯è¯·æ±‚æ•°.")]),s._v(" "),t("li",[t("strong",[s._v("(Request)Duration")]),s._v(": å»¶è¿Ÿ, æ¯ä¸ªè¯·æ±‚çš„å»¶è¿Ÿåˆ†å¸ƒæƒ…å†µ.")])]),s._v(" "),t("p",[s._v("ä¸‰ä¸ªè‹±æ–‡å•è¯å–é¦–å­—æ¯ç»„æˆ RED æ–¹æ³•, å§‘ä¸”å¯ä»¥çœ‹åšæ˜¯ Google å››ä¸ªé»„é‡‘æŒ‡æ ‡çš„ç®€åŒ–ç‰ˆ, ä½œè€…å¾ˆé€—, è¯´ä¸ºä»€ä¹ˆèµ·åä¸º RED å‘¢? å› ä¸ºä»–ä»¬å†…éƒ¨æ™®éåº”ç”¨ USE æ–¹æ³•, ä¸ºäº†å’Œ USE ç›¸å‘¼åº”, æ‰€ä»¥å–äº† RED è¿™ä¸ªè‡ªè®¤ä¸ºå“äº®çš„åå­—. è¿™ä¸ª USE åˆæ˜¯ä»€ä¹ˆæ–¹æ³•å‘¢?")]),s._v(" "),t("h4",{attrs:{id:"useæ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#useæ–¹æ³•"}},[s._v("#")]),s._v(" USEæ–¹æ³•")]),s._v(" "),t("p",[s._v("USE æ–¹æ³•çš„æå‡ºè€…æ˜¯å¤§åé¼é¼çš„ Brendan Gregg, æ€§èƒ½åˆ†æç”¨çš„ç«ç„°å›¾å°±æ˜¯è¿™ä½å¤§å“¥å‘æ˜çš„. å¯ä»¥ç‚¹å¼€ "),t("a",{attrs:{href:"https://www.brendangregg.com/usemethod.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("USE æ–¹æ³•"),t("OutboundLink")],1),s._v(" çš„å®˜æ–¹ä»‹ç»çœ‹çœ‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8f5c3de1e0d1873bacb68a5748deef73-20230719203435-wayhgj0.jpg",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("USE æ˜¯ä½¿ç”¨ç‡(Utilization), é¥±å’Œåº¦(Saturation), é”™è¯¯(Error)çš„ç¼©å†™, ä¸»è¦ç”¨äºåˆ†æèµ„æºé—®é¢˜")])]),s._v(". ä»€ä¹ˆæ˜¯èµ„æº? åœ¨ Greggå¯¹æ¨¡å‹çš„å®šä¹‰ä¸­, æ˜¯æŒ‡ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ç‰©ç†æœåŠ¡å™¨ç»„ä»¶, æ¯”å¦‚ CPU, ç¡¬ç›˜ç­‰, ä½†ç°åœ¨å¾ˆå¤šäººå·²ç»æ‰©å±•äº†èµ„æºçš„èŒƒå›´, æŠŠä¸€äº›è½¯ä»¶èµ„æºä¹ŸåŒ…å«åœ¨å†…. ä¸‹é¢å¯¹ä½¿ç”¨ç‡, é¥±å’Œåº¦, é”™è¯¯åšä¸€ä¸ªæ›´è¯¦ç»†çš„è§£é‡Š.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ä½¿ç”¨ç‡")]),s._v(": æ¯”å¦‚å†…å­˜ä½¿ç”¨ç‡, CPUä½¿ç”¨ç‡ç­‰, æ˜¯ä¸€ä¸ªç™¾åˆ†æ¯”.")]),s._v(" "),t("li",[t("strong",[s._v("é¥±å’Œåº¦")]),s._v(": èµ„æºæ’é˜Ÿå·¥ä½œçš„æŒ‡æ ‡, æ— æ³•å†å¤„ç†é¢å¤–çš„å·¥ä½œ. é€šå¸¸ç”¨é˜Ÿåˆ—é•¿åº¦è¡¨ç¤º, æ¯”å¦‚åœ¨ iostat é‡Œçœ‹åˆ°çš„ aqu-sz å°±æ˜¯é˜Ÿåˆ—é•¿åº¦.")]),s._v(" "),t("li",[t("strong",[s._v("é”™è¯¯")]),s._v(": èµ„æºé”™è¯¯äº‹ä»¶çš„è®¡æ•°. æ¯”å¦‚ malloc() å¤±è´¥æ¬¡æ•°, é€šè¿‡ ifconfig çœ‹åˆ°çš„ errors, dropped åŒ…é‡. æœ‰å¾ˆå¤šé”™è¯¯æ˜¯ä»¥ç³»ç»Ÿé”™è¯¯æ—¥å¿—çš„æ–¹å¼æš´éœ²çš„, æ²¡æ³•ç›´æ¥æ‹¿åˆ°æŸä¸ªç»Ÿè®¡æŒ‡æ ‡, æ­¤æ—¶å¯ä»¥è¿›è¡Œæ—¥å¿—å…³é”®å­—ç›‘æ§.")])]),s._v(" "),t("p",[t("strong",[s._v("USE æ–¹æ³•å’Œ Google å››ä¸ªé»„é‡‘æŒ‡æ ‡é…åˆä½¿ç”¨")]),s._v(", å°±å¯ä»¥çŸ¥é“ä¸åŒç±»åˆ«çš„ç›‘æ§å¯¹è±¡åº”è¯¥å…³æ³¨çš„æ ¸å¿ƒæŒ‡æ ‡æ˜¯ä»€ä¹ˆäº†. é‚£ç›‘æ§å¯¹è±¡éƒ½æœ‰å“ªäº›ç±»åˆ«å‘¢? æ¢å¥è¯è¯´, åšäº†å“ªäº›æ–¹é¢çš„ç›‘æ§æ‰ç®—æ˜¯æŠŠç›‘æ§ä½“ç³»å»ºè®¾å®Œå¤‡äº†? ä¸‹é¢å°±æ¥æ¢³ç†ä¸€ä¸‹ç›‘æ§å¯¹è±¡çš„ç±»åˆ«.")]),s._v(" "),t("h4",{attrs:{id:"ç›‘æ§åˆ†ç±»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§åˆ†ç±»"}},[s._v("#")]),s._v(" ç›‘æ§åˆ†ç±»")]),s._v(" "),t("p",[s._v("ä¸ºäº†æ–¹ä¾¿ç†è§£, ä¸‹å›¾æŠŠç›‘æ§åˆ†æˆ 4 ä¸ªç±»åˆ«.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0f6091c107b263bcd481c278d821ee32-20230719203435-hhm0dfq.jpg",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"_1-ä¸šåŠ¡ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä¸šåŠ¡ç›‘æ§"}},[s._v("#")]),s._v(" 1.ä¸šåŠ¡ç›‘æ§")]),s._v(" "),t("p",[s._v("è¿™ç±»æŒ‡æ ‡æ˜¯"),t("strong",[s._v("ç®¡ç†å±‚")]),s._v("éå¸¸å…³æ³¨çš„, ä»£è¡¨ä¼ä¸šè¥æ”¶, æˆ–è€…è·Ÿå®¢æˆ·ä¸»æµç¨‹ç›¸å…³, ç±»ä¼¼ BI æ•°æ®. ä¸è¿‡ç›¸æ¯” BI æ•°æ®, ä¸šåŠ¡ç›‘æ§æŒ‡æ ‡æœ‰ä¸¤ç‚¹ä¸åŒ.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å¯¹ç²¾ç¡®åº¦è¦æ±‚æ²¡æœ‰é‚£ä¹ˆé«˜")]),s._v(": å› ä¸ºç›‘æ§åªè¦å‘ç°è¶‹åŠ¿å¼‚å¸¸å°±å¯ä»¥, è‡³äºæ˜¯ä» 5000 å˜æˆäº† 1000 è¿˜æ˜¯å˜æˆäº† 1001, æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«.")]),s._v(" "),t("li",[t("strong",[s._v("å¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜")]),s._v(": å¾ˆå¤š BI æ•°æ®å¯èƒ½æ˜¯å°æ—¶çº§åˆ«æˆ–å¤©çº§åˆ«çš„, è¿™ä¸ªæ—¶æ•ˆæ€§æ— æ³•æ»¡è¶³ç›‘æ§çš„éœ€æ±‚, ç›‘æ§æ˜¯å¸Œæœ›è¶Šæ—©å‘ç°é—®é¢˜è¶Šå¥½, è¦æ˜¯ä¸€ä¸ªå°æ—¶æ‰å‘ç°é—®é¢˜, é»„èŠ±èœéƒ½å‡‰äº†.")])]),s._v(" "),t("p",[t("mark",[s._v("æŠ€æœ¯äººå‘˜åº”è¯¥é’ˆå¯¹è¿™ç±»æŒ‡æ ‡åšé«˜ä¼˜ä¿éšœ, å¦‚æœæ‰€æœ‰çš„æŒ‡æ ‡éƒ½åŒç­‰å¯¹å¾…, é‡è¦çš„å‘Šè­¦å°±å®¹æ˜“è¢«æ™®é€šå‘Šè­¦æ·¹æ²¡, æ‰€ä»¥ å‘Šè­¦ä¸€å®šè¦åˆ†çº§å¯¹å¾…. ")])]),s._v(" "),t("p",[s._v("å¾ˆå¤šå…¬å¸çš„æ•…éšœç®¡ç†æ¯”è¾ƒç²—æ”¾, åªè¦æœ‰æŠ¥è­¦äº‹ä»¶äº§ç”Ÿ, å°±è®¤ä¸ºæ˜¯æœ‰æ•…éšœ, è¿™æ˜¯ä¸å¯¹çš„. åœ¨å¾®æœåŠ¡å’Œäº‘åŸç”ŸæŠ€æœ¯ç››è¡Œçš„å½“ä¸‹, æŸä¸ªæœºå™¨çš„ CPU é£™é«˜äº†, æˆ–è€… IO æ‰“æ»¡äº†, å¯¹æœ€ç»ˆç”¨æˆ·çš„ä½“éªŒå¯èƒ½æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„, ä½†æ˜¯æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡å¼‚å¸¸, ä¸€å®šæ˜¯æ•…éšœ, å› ä¸ºè¿™ç±»æŒ‡æ ‡å¼‚å¸¸ä»£è¡¨ç€æœ€ç»ˆç”¨æˆ·ä½“éªŒå—æŸ, æˆ–è€…é€ æˆäº†ç›´æ¥èµ„æŸ.")]),s._v(" "),t("p",[s._v("ä½œä¸ºä¸­åå°çš„å›¢é˜Ÿ, åšçš„å¾ˆå¤šç¨³å®šæ€§ä¿éšœçš„å·¥ä½œä¸å®¹æ˜“è®©ç®¡ç†å±‚çœ‹åˆ°, ä¸šåŠ¡æŒ‡æ ‡æ˜¯ä¸€ä¸ªçªç ´å£, å¦‚æœèƒ½å¤ŸæŠŠè¿™ç±»æŒ‡æ ‡æ¢³ç†æ¸…æ¥š, æ˜¯å¾ˆå®¹æ˜“è®©è€æ¿çœ‹åˆ°æˆ‘çš„ä»·å€¼çš„.")]),s._v(" "),t("h5",{attrs:{id:"_2-åº”ç”¨ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-åº”ç”¨ç›‘æ§"}},[s._v("#")]),s._v(" 2.åº”ç”¨ç›‘æ§")]),s._v(" "),t("p",[t("strong",[s._v("åº”ç”¨ç›‘æ§å°±æ˜¯æŒ‡å¯¹åº”ç”¨ç¨‹åº(Application)çš„ç›‘æ§, Google çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡, RED æ–¹æ³•ä¸»è¦å°±æ˜¯é’ˆå¯¹åº”ç”¨ç›‘æ§çš„.")])]),s._v(" "),t("p",[s._v("æ¯ä¸ªå…¬å¸éƒ½åº”è¯¥æœ‰ç»Ÿä¸€çš„ APM(Application Performance Management), ä¹Ÿå°±æ˜¯åº”ç”¨æ€§èƒ½ç®¡ç†æ–¹æ¡ˆ, ä»æŒ‡æ ‡ç€æ‰‹çš„è¯ä¸€èˆ¬ä½¿ç”¨"),t("strong",[s._v("åŸ‹ç‚¹æœºåˆ¶")]),s._v("æ¥åš, æ¯”å¦‚ StatsD, Prometheus SDK ç­‰, æˆ–è€…ç›´æ¥åˆ†ææ¥å…¥å±‚æ—¥å¿—, ä»æ—¥å¿—æå–æŒ‡æ ‡; ä»"),t("strong",[s._v("é“¾è·¯è¿½è¸ª")]),s._v("ç€æ‰‹çš„è¯å¯ä»¥ä½¿ç”¨ Zipkin, SkyWalking ç­‰.")]),s._v(" "),t("p",[s._v("åƒ Java è¿™ç§å­—èŠ‚ç æŠ€æœ¯çš„è¯­è¨€, "),t("strong",[s._v("é‡‡ç”¨ JavaAgent æŠ€æœ¯å¯ä»¥åšåˆ°ä»£ç æ— ä¾µå…¥åŸ‹ç‚¹")]),s._v(". ä½†æ˜¯åƒ Go, C++è¿™ç±»è¯­è¨€, ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨åŸ‹ç‚¹æœºåˆ¶æ¥åš, ç”±ç»Ÿä¸€çš„å·¥å…·å›¢é˜Ÿæä¾›ä¸€äº›æ¡†æ¶, åœ¨æ¡†æ¶é‡Œå†…ç½®åŸ‹ç‚¹é€»è¾‘, è¿™æ ·æ™®é€šç ”å‘äººå‘˜ä¹Ÿå°±åŸºæœ¬ä¸ä¼šæœ‰ä»£ç ä¾µå…¥çš„æ„Ÿè§‰äº†.")]),s._v(" "),t("h5",{attrs:{id:"_3-ç»„ä»¶ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç»„ä»¶ç›‘æ§"}},[s._v("#")]),s._v(" 3.ç»„ä»¶ç›‘æ§")]),s._v(" "),t("p",[s._v("è¿™é‡ŒæŠŠå„ç±»"),t("strong",[s._v("æ•°æ®åº“, ä¸­é—´ä»¶, äº‘å¹³å°, ç»Ÿç§°ä¸ºç»„ä»¶")]),s._v(", ç»„ä»¶ç›‘æ§æ˜¯éå¸¸è€ƒéªŒçŸ¥è¯†å¹¿åº¦çš„. ä¸€èˆ¬ç›‘æ§ç³»ç»Ÿçš„ç ”å‘äººå‘˜, å¾ˆéš¾æŠŠæ¯ä¸ªç»„ä»¶çš„æœºç†éƒ½ææ¸…æ¥š, æ‰€ä»¥å®šä¹‰ç»Ÿä¸€çš„æ¥å…¥æ•°æ®è§„èŒƒ, è®©ä¸“ä¸šçš„äººå»é‡‡é›†å„ä¸ªç»„ä»¶çš„æ•°æ®æ˜¯æ›´åˆç†çš„åšæ³•.")]),s._v(" "),t("p",[s._v("æœ‰ä¸ªå¥½ç°è±¡æ˜¯, å¾ˆå¤šç»„ä»¶çš„ç ”å‘äººå‘˜, å·²ç»å¼€å§‹è®©ç»„ä»¶è‡ªèº«ç›´æ¥æ”¯æŒ Prometheus åè®®, åå‡º metrics æ•°æ®, é™¤äº† etcd, Kubernetes è¿™äº›äº‘åŸç”Ÿæ—¶ä»£çš„ç»„ä»¶, ä¸€äº›è€çš„ç»„ä»¶, æ¯”å¦‚ RabbitMQ, ZooKeeper ç­‰, ä¹Ÿåœ¨æ–°ç‰ˆæœ¬é‡Œç›´æ¥åšäº†æ”¯æŒ, å®å±è¡Œä¸šå¹¸äº‹.")]),s._v(" "),t("h5",{attrs:{id:"_4-èµ„æºç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-èµ„æºç›‘æ§"}},[s._v("#")]),s._v(" 4.èµ„æºç›‘æ§")]),s._v(" "),t("p",[s._v("åŸºç¡€èµ„æºçš„ç›‘æ§, ä¸»è¦æ˜¯é’ˆå¯¹"),t("strong",[s._v("è®¾å¤‡å’Œç½‘ç»œ")]),s._v(", è®¾å¤‡åˆåˆ†ä¸ºæœåŠ¡å™¨, ç½‘ç»œè®¾å¤‡, ç½‘ç»œç›‘æ§åˆåˆ†ä¸ºè¿é€šæ€§ç›‘æ§, è´¨é‡ç›‘æ§, æµé‡ç›‘æ§. ä¸‹é¢åˆ†åˆ«åšä¸ªç®€å•ä»‹ç».")]),s._v(" "),t("h6",{attrs:{id:"_1-è®¾å¤‡ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-è®¾å¤‡ç›‘æ§"}},[s._v("#")]),s._v(" (1)è®¾å¤‡ç›‘æ§")]),s._v(" "),t("p",[s._v("ä¸€æèµ·è®¾å¤‡ç›‘æ§, å¯èƒ½ç«‹é©¬ä¼šæƒ³åˆ° CPU, å†…å­˜ä½¿ç”¨ç‡ç›‘æ§, é™¤äº†è¿™äº›ä¹‹å¤–, å¦‚æœæƒ³è·å–ç¡¬ä»¶æ¨¡å—çš„å¥åº·çŠ¶å†µ, æ¯”å¦‚ç”µæºç”µå‹, é£æ‰‡è½¬é€Ÿ, ä¸»æ¿ç¯å¢ƒæ¸©åº¦ç­‰, å°±éœ€è¦èµ° IPMI åè®®, é€šè¿‡å¸¦å¤–ç½‘ç»œé‡‡é›†.")]),s._v(" "),t("p",[s._v("ç½‘ç»œè®¾å¤‡, å…¸å‹çš„å°±æ˜¯äº¤æ¢æœº, é˜²ç«å¢™, ä¸€èˆ¬æ˜¯é€šè¿‡ "),t("strong",[s._v("SNMP åè®®")]),s._v("è·å–æŒ‡æ ‡, æ¯”å¦‚äº¤æ¢æœºå„ä¸ªç½‘å£çš„æµé‡, åŒ…é‡. ä¹Ÿå¯ä»¥é€šè¿‡ syslog çš„æ–¹å¼, æŠŠäº¤æ¢æœºçš„æ—¥å¿—è½¬å­˜å‡ºæ¥, åˆ°æœåŠ¡å™¨ä¸Šåˆ†æ.")]),s._v(" "),t("h6",{attrs:{id:"_2-ç½‘ç»œç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç½‘ç»œç›‘æ§"}},[s._v("#")]),s._v(" (2)ç½‘ç»œç›‘æ§")]),s._v(" "),t("p",[t("strong",[s._v("ç½‘ç»œè¿é€šæ€§ç›‘æ§æœ€ä¸ºå¸¸è§, é€šè¿‡ ICMP åè®®")]),s._v(", éƒ¨ç½²æ¢é’ˆæœºå™¨, å¯¹ç›®æ ‡è®¾å¤‡åš PING æ¢æµ‹, èƒ½æ¢é€šå°±è¡¨ç¤ºèƒ½è¿é€š, æ¢æµ‹å¤±è´¥å°±æ˜¯è¿ä¸é€š. å½“ç„¶, æœ‰äº›æœºå™¨å¯èƒ½æ˜¯ç¦ PING çš„, æ­¤æ—¶å°±éœ€è¦ç”¨ TCP æˆ– HTTP ä¹‹ç±»çš„åè®®å»æ¢æµ‹äº†.")]),s._v(" "),t("p",[s._v("PING æ¢æµ‹å¯ä»¥æ‹¿åˆ°ä¸¢åŒ…ç‡å’Œå»¶è¿Ÿæ•°æ®, å¯ä»¥ç”¨è¿™äº›æ•°æ®åˆ†æç½‘ç»œè´¨é‡. æ¯”å¦‚ä¸¤ä¸ªæœºæˆ¿ä¹‹é—´çš„ä¸“çº¿, ç”¨ A æœºæˆ¿çš„æ¢é’ˆå»æ¢æµ‹ B æœºæˆ¿çš„ç›®çš„è®¾å¤‡, å°±èƒ½è½»æ˜“çŸ¥é“æœºæˆ¿ä¹‹é—´çš„ç½‘ç»œè´¨é‡æƒ…å†µ.")]),s._v(" "),t("p",[s._v("æœ€åæ˜¯æµé‡ç›‘æ§, ä¹Ÿä¼šç”¨åœ¨å¤šä¸ªåœ°æ–¹, æ¯”å¦‚æœºå™¨çš„ç½‘å¡æµé‡, äº¤æ¢æœºçš„ç½‘å£æµé‡, æœºæˆ¿å‡ºå£æµé‡, ä¹Ÿæ˜¯æ•´ä¸ªç›‘æ§ä½“ç³»çš„é‡è¦ä¸€ç¯.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œ, ç›‘æ§çš„åˆ†ç±»å°±ä»‹ç»å®Œäº†, å¯ä»¥çœ‹ä¸€ä¸‹è‡ªå·±å…¬å¸çš„ç›‘æ§æ•°æ®, æŸ¥æ¼è¡¥ç¼º. ä¸Šé¢çš„åˆ†ç±»ä¸»è¦æ˜¯é’ˆå¯¹æœåŠ¡ç«¯çš„ç›‘æ§, è¿˜æœ‰ä¸€ä¸ªå¤§ç±»æ˜¯ç«¯ç›‘æ§, æ¯”å¦‚ iOS åº”ç”¨, ä¼šå…³æ³¨æ˜¯å¦å¡é¡¿, æœ‰æ²¡æœ‰å´©æºƒ, ç™½å±ä¹‹ç±»çš„, è¿™ç®—æ˜¯å¦ä¸€ä¸ªé¢†åŸŸ, è¿™é‡Œå°±ä¸å±•å¼€ä»‹ç»äº†.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-8"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²å…³æ³¨çš„æ˜¯ç›‘æ§æ–¹æ³•è®º, å› ä¸ºç›‘æ§å¯¹è±¡å¾ˆå¤š, ç›‘æ§æŒ‡æ ‡ä¹Ÿå¾ˆå¤š, å“ªäº›æŒ‡æ ‡æ¯”è¾ƒé‡è¦å°±éœ€è¦æœ‰ä¸€ä¸ªæŒ‡å¯¼æ€§ç†è®º. ä»å¤§ç±»ä¸Šæ¥çœ‹, åˆ†ä¸ºé’ˆå¯¹æœåŠ¡çš„ Google å››ä¸ªé»„é‡‘æŒ‡æ ‡å’Œ RED æ–¹æ³•, ä»¥åŠé’ˆå¯¹èµ„æºçš„ USE æ–¹æ³•. è¿™äº›æ–¹æ³•å¯ä»¥è§£ç­”å“ªäº›æŒ‡æ ‡æ›´ä¸ºé‡è¦è¿™ä¸ªé—®é¢˜.")]),s._v(" "),t("p",[s._v("å¯¹äºç›‘æ§è¦†ç›–å®Œå¤‡æ€§é—®é¢˜, å…±æœ‰ä¸šåŠ¡, åº”ç”¨, ç»„ä»¶, èµ„æºå››ä¸ªå¤§ç±», å½“ç„¶è¿˜æœ‰ç«¯ç›‘æ§, å¦‚æœè¿™äº›ç±»åˆ«çš„ç›‘æ§éƒ½å»ºç«‹èµ·æ¥äº†, ç›‘æ§ä½“ç³»å°±æ˜¯ç›¸å¯¹å®Œå¤‡çš„.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2yy1d9787ac328fc1c245f4dae0dfb78-20230719203435-ny9pbx1.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_10-ç›‘æ§æ¦‚è®º-ç›‘æ§æ•°æ®çš„é‡‡é›†æ–¹å¼åŠåŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-ç›‘æ§æ¦‚è®º-ç›‘æ§æ•°æ®çš„é‡‡é›†æ–¹å¼åŠåŸç†"}},[s._v("#")]),s._v(" 10.ç›‘æ§æ¦‚è®º-ç›‘æ§æ•°æ®çš„é‡‡é›†æ–¹å¼åŠåŸç†")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº†ç›‘æ§çš„å‡ ä¸ªæ–¹æ³•è®º, çŸ¥é“äº†å“ªäº›æŒ‡æ ‡æ¯”è¾ƒå…³é”®, ä½†æ˜¯"),t("strong",[s._v("å…·ä½“å¦‚ä½•é‡‡é›†")]),s._v("å‘¢? è¿™åˆæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è¯é¢˜. è¿™ä¸€è®²å°±æ¥å‰–æä¸€ä¸‹å¸¸è§çš„é‡‡é›†æ•°æ®çš„æŠ€æœ¯æ‰‹æ®µ, äº†è§£äº†è¿™äº›, å°±å¯ä»¥å†™è‡ªå·±çš„é‡‡é›†å™¨, æˆ–è€…æ‰©å±•å¾ˆå¤šé‡‡é›†å™¨çš„èƒ½åŠ›äº†, å¯¹å¾ˆå¤šç›‘æ§æ•°æ®ä¹Ÿä¼šæ‹¥æœ‰åŸç†å±‚é¢çš„ç†è§£.")]),s._v(" "),t("p",[s._v("é‡‡é›†æ–¹æ³•æ˜¯å¤šç§å¤šæ ·çš„, æ¯”å¦‚è¯»å– "),t("code",[s._v("/proc")]),s._v("â€‹ ç›®å½•, æ‰§è¡Œç³»ç»Ÿè°ƒç”¨, æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·, è¿œç¨‹é»‘ç›’æ¢æµ‹, è¿œç¨‹æ‹‰å–ç‰¹å®šåè®®çš„æ•°æ®, è¿åˆ°ç›®æ ‡ä¸Šå»æ‰§è¡ŒæŒ‡ä»¤è·å–è¾“å‡º, ä»£ç åŸ‹ç‚¹, æ—¥å¿—åˆ†ææå–ç­‰å„ç§å„æ ·çš„æ–¹æ³•. è¿™ä¸€è®²ä¼šä»ä¸­æŒ‘é€‰ä¸€äº›æ¯”è¾ƒå…¸å‹çš„æ‰‹æ®µ. ä¸‹é¢å°±æŒ‰ç…§"),t("strong",[s._v("ä½¿ç”¨é¢‘ç‡ä»é«˜åˆ°ä½")]),s._v("ä¾æ¬¡çœ‹ä¸€ä¸‹, å…ˆæ¥çœ‹è¯»å– "),t("code",[s._v("/proc")]),s._v("â€‹ ç›®å½•çš„æ–¹å¼.")]),s._v(" "),t("h4",{attrs:{id:"è¯»å–-procç›®å½•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¯»å–-procç›®å½•"}},[s._v("#")]),s._v(" è¯»å–/procç›®å½•")]),s._v(" "),t("p",[s._v("â€‹"),t("code",[s._v("/proc")]),s._v("â€‹ æ˜¯ä¸€ä¸ªä½äº"),t("strong",[s._v("å†…å­˜ä¸­çš„ä¼ªæ–‡ä»¶ç³»ç»Ÿ")]),s._v(', è¯¥ç›®å½•ä¸‹ä¿å­˜çš„ä¸æ˜¯çœŸæ­£çš„æ–‡ä»¶å’Œç›®å½•, è€Œæ˜¯ä¸€äº›"è¿è¡Œæ—¶"ä¿¡æ¯, ** Linux æ“ä½œç³»ç»Ÿå±‚é¢çš„å¾ˆå¤šç›‘æ§æ•°æ®, æ¯”å¦‚å†…å­˜æ•°æ®, ç½‘å¡æµé‡, æœºå™¨è´Ÿè½½ç­‰**, éƒ½æ˜¯ä» '),t("code",[s._v("/proc")]),s._v("â€‹ ä¸­è·å–çš„ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ä¸€ä¸‹å†…å­˜ç›¸å…³çš„æŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nano~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/meminfo")]),s._v("\nMemTotal:        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7954676")]),s._v(" kB\nMemFree:          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("211136")]),s._v(" kB\nMemAvailable:    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2486688")]),s._v(" kB\nBuffers:          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("115068")]),s._v(" kB\nCached:          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2309836")]),s._v(" kB\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("å†…å­˜æ€»é‡, å‰©ä½™é‡, å¯ç”¨é‡, Buffer, Cached ç­‰æ•°æ®éƒ½å¯ä»¥è½»æ˜“æ‹¿åˆ°. å½“ç„¶, "),t("code",[s._v("/proc/meminfo")]),s._v("â€‹ æ²¡æœ‰ä½¿ç”¨ç‡, å¯ç”¨ç‡è¿™æ ·çš„ç™¾åˆ†æ¯”æŒ‡æ ‡, è¿™ç±»æŒ‡æ ‡éœ€è¦"),t("strong",[s._v("äºŒæ¬¡è®¡ç®—")]),s._v(", å¯ä»¥åœ¨å®¢æˆ·ç«¯é‡‡é›†å™¨ä¸­å®Œæˆ, ä¹Ÿå¯ä»¥åœ¨æœåŠ¡ç«¯æŸ¥è¯¢æ—¶ç°ç®—.")]),s._v(" "),t("p",[t("strong",[s._v("å†…å­˜ç›¸å…³çš„æŒ‡æ ‡éƒ½æ˜¯ Gauge ç±»å‹")]),s._v("çš„, ä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹ç½‘å¡æµé‡ç›¸å…³çš„æŒ‡æ ‡, ç½‘å¡ç›¸å…³çš„æ•°æ®éƒ½æ˜¯ Counter ç±»å‹çš„æ•°æ®.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# head -n3 /proc/net/dev")]),s._v("\nInter-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   Receive                                                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  Transmit\n face "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bytes    packets errs drop fifo frame compressed multicast"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bytes    packets errs drop fifo colls carrier compressed\n  eth0: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("697407964307")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2580235035")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1969289573661")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3137865547")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("æˆ‘çš„æœºå™¨ä¸Šç½‘å¡æ¯”è¾ƒå¤š, æ‰€ä»¥è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æœ‰å¾ˆå¤šè¡Œ, é€šè¿‡ head å‘½ä»¤åªæŸ¥çœ‹å‰é¢å‡ è¡Œ, å¯ä»¥çœ‹åˆ° eth0 ç½‘å¡çš„æŒ‡æ ‡å€¼. æ•´ä½“ä¸Šåˆ†ä¸¤éƒ¨åˆ†, å‰ä¸€éƒ¨åˆ†æ˜¯ Receive, è¡¨ç¤ºå…¥æ–¹å‘, åä¸€éƒ¨åˆ†æ˜¯ Transmit, è¡¨ç¤ºå‡ºæ–¹å‘. 697407964307 è¿™ä¸ªå€¼è¡¨ç¤º eth0 ç½‘å¡å…¥æ–¹å‘æ”¶åˆ°çš„ byte æ€»é‡, 2580235035 åˆ™è¡¨ç¤º eth0 ç½‘å¡å…¥æ–¹å‘æ”¶åˆ°çš„ packet æ€»é‡.")]),s._v(" "),t("p",[s._v("æ³¨æ„äº†, è¿™é‡Œæ‰€è°“çš„æ€»é‡, æ˜¯æŒ‡æ“ä½œç³»ç»Ÿå¯åŠ¨ä»¥æ¥çš„ç´¯è®¡å€¼. ä»ç›‘æ§è§’åº¦, é€šå¸¸ä¸å…³æ³¨è¿™ä¸ªæ€»é‡, è€Œæ˜¯å…³æ³¨æœ€è¿‘ä¸€åˆ†é’Ÿæˆ–è€…æœ€è¿‘ä¸€ç§’é’Ÿçš„æµé‡æ˜¯å¤šå°‘, æ‰€ä»¥åœ¨æœåŠ¡ç«¯çœ‹å›¾çš„æ—¶å€™, é€šå¸¸è¦ä½¿ç”¨ irate å‡½æ•°åšäºŒæ¬¡è®¡ç®—.")]),s._v(" "),t("p",[s._v("åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šè§‰å¾—, OS å±‚é¢çš„ç›‘æ§å¾ˆç®€å•, ä¸å°±æ˜¯è¯»å– "),t("code",[s._v("/proc")]),s._v("â€‹ ç›®å½•ä¸‹çš„å†…å®¹å—? ä¹Ÿä¸æ˜¯, æœ‰äº›æ•°æ®ä» "),t("code",[s._v("/proc")]),s._v("â€‹ ä¸‹é¢æ˜¯æ‹¿ä¸åˆ°çš„, æ¯”å¦‚ç¡¬ç›˜ä½¿ç”¨ç‡. å¯ä»¥ä» "),t("code",[s._v("/proc/mounts")]),s._v("â€‹ æ‹¿åˆ°æœºå™¨çš„æŒ‚è½½ç‚¹åˆ—è¡¨, ä½†å…·ä½“æ¯ä¸ªæŒ‚è½½ç‚¹çš„ä½¿ç”¨ç‡, å°±éœ€è¦ç³»ç»Ÿè°ƒç”¨äº†.")]),s._v(" "),t("h4",{attrs:{id:"æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·"}},[s._v("#")]),s._v(" æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·")]),s._v(" "),t("p",[s._v("OS å†…çš„æ•°æ®é‡‡é›†, é™¤äº†è¯»å– "),t("code",[s._v("/proc")]),s._v("â€‹ ç›®å½•ä¹‹å¤–, ä¹Ÿç»å¸¸ä¼šé€šè¿‡"),t("strong",[s._v("æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·")]),s._v("çš„æ–¹å¼é‡‡é›†æŒ‡æ ‡, ä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹è¿™ç§æ–¹å¼.")]),s._v(" "),t("p",[s._v("è¿™ç§æ–¹å¼éå¸¸ç®€å•, å°±æ˜¯è°ƒç”¨ä¸€ä¸‹ç³»ç»Ÿå‘½ä»¤, è§£æè¾“å‡ºå°±å¯ä»¥äº†. æ¯”å¦‚æƒ³è·å– 9090 ç«¯å£çš„ç›‘å¬çŠ¶æ€, å¯ä»¥ä½¿ç”¨ ss å‘½ä»¤ "),t("code",[s._v("ss -tln|grep 9090")]),s._v("â€‹, æƒ³è¦æ‹¿åˆ°å„ä¸ªåˆ†åŒºçš„ä½¿ç”¨ç‡å¯ä»¥é€šè¿‡ df å‘½ä»¤ "),t("code",[s._v("df -k")]),s._v("â€‹. ä½†æ˜¯è¿™ä¸ªæ–¹å¼ä¸å¤ªé€šç”¨, æ€§èƒ½ä¹Ÿä¸å¥½.")]),s._v(" "),t("p",[s._v("å…ˆè¯´é€šç”¨æ€§é—®é¢˜, å°±æ‹¿ ss å‘½ä»¤æ¥è¯´å§, ä¸æ˜¯æ‰€æœ‰çš„æœºå™¨éƒ½å®‰è£…äº†è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·, è€Œä¸”ä¸åŒçš„å‘è¡Œç‰ˆæˆ–ä¸åŒ ss ç‰ˆæœ¬, å‘½ä»¤è¾“å‡ºå†…å®¹æ ¼å¼å¯èƒ½ä¸åŒ. æ€§èƒ½é—®é¢˜ä¹Ÿå®¹æ˜“ç†è§£, è°ƒç”¨å‘½ä»¤è¡Œå·¥å…·æ˜¯éœ€è¦ fork ä¸€ä¸ªè¿›ç¨‹çš„, ç›¸æ¯”äºè¿›ç¨‹å†…çš„é€»è¾‘, æ•ˆç‡å¤§æ‰“æŠ˜æ‰£, ä¸è¿‡ç›‘æ§é‡‡é›†é¢‘ç‡ä¸€èˆ¬éƒ½æ˜¯ 10 ç§’èµ·æ­¥, ä¸é¢‘ç¹, æ‰€ä»¥è¿™ä¸ªæ€§èƒ½é—®é¢˜å€’ä¸æ˜¯ä»€ä¹ˆå¤§äº‹, å…³é”®è¿˜æ˜¯é€šç”¨æ€§é—®é¢˜.")]),s._v(" "),t("h4",{attrs:{id:"è¿œç¨‹é»‘ç›’æ¢æµ‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿œç¨‹é»‘ç›’æ¢æµ‹"}},[s._v("#")]),s._v(" è¿œç¨‹é»‘ç›’æ¢æµ‹")]),s._v(" "),t("p",[s._v("è¯»å–æœ¬åœ° "),t("code",[s._v("/proc")]),s._v("â€‹ ç›®å½•æˆ–æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·, éƒ½æ˜¯åœ¨ç›®æ ‡ç›‘æ§æœºå™¨ä¸Šè¿›è¡Œçš„æ“ä½œ. æœ‰çš„æ—¶å€™, æ— æ³•åœ¨ç›®æ ‡æœºå™¨ä¸Šéƒ¨ç½²å®¢æˆ·ç«¯ç¨‹åº, è¿™æ—¶å€™å°±éœ€è¦"),t("strong",[s._v("é»‘ç›’æ¢æµ‹")]),s._v("æ‰‹æ®µäº†.")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("å…¸å‹çš„æ¢æµ‹æ‰‹æ®µæœ‰ä¸‰ç±», ICMP, TCP å’Œ HTTP")])]),s._v(". æœ‰ä¸€ä¸ªè½¯ä»¶å« Blackbox Exporter, å°±æ˜¯ä¸“é—¨ç”¨æ¥æ¢æµ‹çš„, Categraf, Datadog-Agent ç­‰é‡‡é›†å™¨ä¹Ÿéƒ½å¯ä»¥åšè¿™ç§æ¢æµ‹.")]),s._v(" "),t("p",[s._v("åŸºäº ICMP åè®®, å¯ä»¥é€šè¿‡ Ping å·¥å…·åšæµ‹è¯•, å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nano ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping -c 3 www.baidu.com")]),s._v("\nPING www.a.shifen.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.13"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.13 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.13"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("251")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.41")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.13 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.13"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("251")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.39")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.13 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.13"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("251")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.38")]),s._v(" ms\n\n--- www.a.shifen.com "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 2003ms\nrtt min/avg/max/mdev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.382")]),s._v("/1.393/1.405/0.009 ms\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("è¿™é‡Œä½¿ç”¨ Ping å·¥å…·å‘ Baidu å‘äº† 3 ä¸ªæ•°æ®åŒ…, å¾—åˆ°äº†å¤šä¸ªæŒ‡æ ‡æ•°æ®.")]),s._v(" "),t("ul",[t("li",[s._v("ä¸¢åŒ…ç‡: 0%")]),s._v(" "),t("li",[s._v("min rtt: 1.382")]),s._v(" "),t("li",[s._v("avg rtt: 1.393")]),s._v(" "),t("li",[s._v("max rtt: 1.405")]),s._v(" "),t("li",[s._v("ttl: 251")])]),s._v(" "),t("p",[s._v("ç›‘æ§é‡‡é›†å™¨å’Œæ‰‹å·¥ Ping æµ‹è¯•çš„åŸç†æ˜¯ä¸€æ ·çš„, ä¹Ÿæ˜¯å‘å‡ ä¸ªåŒ…åšç»Ÿè®¡. ä¸è¿‡æœ‰äº›æœºå™¨æ˜¯ç¦ Ping çš„, è¿™æ—¶å€™å°±å¯ä»¥é€šè¿‡ TCP æˆ– HTTP æ¥æ¢æµ‹. å¯¹äº Linux æœºå™¨, ä¸€èˆ¬æ˜¯ä¼šå¼€æ”¾ sshd çš„ 22 ç«¯å£, é‚£å°±å¯ä»¥ç”¨ç±»ä¼¼ telnet çš„æ–¹å¼æ¢æµ‹æœºå™¨çš„ 22ç«¯å£, å¦‚æœæˆåŠŸå°±è®¤ä¸ºæœºå™¨å­˜æ´».")]),s._v(" "),t("p",[s._v("å¯¹äº HTTP åè®®çš„æ¢æµ‹, é™¤äº†åŸºæœ¬çš„è¿é€šæ€§æµ‹è¯•, è¿˜å¯ä»¥æ£€æŸ¥åè®®å†…å®¹, æ¯”å¦‚è¦æ±‚è¿”å›çš„ status code å¿…é¡»æ˜¯ 200, è¿”å›çš„ response body å¿…é¡»åŒ…å« success å­—ç¬¦ä¸², å¦‚æœä»»ä½•ä¸€ä¸ªæ¡ä»¶æ²¡æœ‰æ»¡è¶³, ä»ç›‘æ§çš„è§’åº¦å°±è®¤ä¸ºæ˜¯å¼‚å¸¸çš„.")]),s._v(" "),t("p",[s._v("æœ‰é»‘ç›’ç›‘æ§, è‡ªç„¶å°±æœ‰"),t("strong",[s._v("ç™½ç›’ç›‘æ§")]),s._v(". é»‘ç›’ç›‘æ§æ˜¯æŠŠç›‘æ§å¯¹è±¡å½“æˆä¸€ä¸ªé»‘ç›’å­, ä¸å»äº†è§£å…¶å†…éƒ¨è¿è¡Œæœºç†, åªæ˜¯é€šè¿‡å‡ ç§åè®®åšç®€å•æ¢æµ‹. ç™½ç›’ç›‘æ§ä¸ä¹‹ç›¸å, å®ƒè¦æ”¶é›†èƒ½å¤Ÿåæ˜ ç›‘æ§å¯¹è±¡å†…éƒ¨è¿è¡Œå¥åº·åº¦çš„æŒ‡æ ‡. ä½†æ˜¯ç›‘æ§å¯¹è±¡çš„å†…éƒ¨æŒ‡æ ‡, ä»å¤–éƒ¨å…¶å®æ˜¯æ— æ³•æ‹¿åˆ°çš„, æ‰€ä»¥ç™½ç›’ç›‘æ§çš„æŒ‡æ ‡, éœ€è¦ç›‘æ§å¯¹è±¡è‡ªèº«æƒ³åŠæ³•æš´éœ²å‡ºæ¥. æœ€å…¸å‹çš„æš´éœ²æ–¹å¼, å°±æ˜¯æä¾›ä¸€ä¸ª HTTP æ¥å£, åœ¨ response body ä¸­è¿”å›ç›‘æ§æŒ‡æ ‡çš„æ•°æ®. ä¸‹é¢å°±æ¥çœ‹ä¸€ä¸‹è¿™ç§é‡‡é›†æ–¹å¼.")]),s._v(" "),t("h4",{attrs:{id:"æ‹‰å–ç‰¹å®šåè®®çš„æ•°æ®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ‹‰å–ç‰¹å®šåè®®çš„æ•°æ®"}},[s._v("#")]),s._v(" æ‹‰å–ç‰¹å®šåè®®çš„æ•°æ®")]),s._v(" "),t("p",[s._v("æœ‰å¾ˆå¤šç»„ä»¶éƒ½é€šè¿‡ HTTP æ¥å£çš„æ–¹å¼, æš´éœ²äº†è‡ªèº«çš„ç›‘æ§æŒ‡æ ‡. è¿™é‡Œä¸¾å‡ ä¸ªä¾‹å­, æ¯”å¦‚ Elasticsearch çš„ "),t("code",[s._v("/_cluster/health")]),s._v("â€‹ æ¥å£.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nano ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -uelastic:Pass1223 http://10.206.0.7:9200/_cluster/health -s | jq .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster_name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elasticsearch-cluster"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yellow"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timed_out"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_nodes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_data_nodes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active_primary_shards"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("430")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active_shards"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("430")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"relocating_shards"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"initializing_shards"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unassigned_shards"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("430")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delayed_unassigned_shards"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_pending_tasks"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_in_flight_fetch"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"task_max_waiting_in_queue_millis"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active_shards_percent_as_number"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°, è¿”å›çš„å†…å®¹å¤§å¤šæ˜¯"),t("strong",[s._v("æŒ‡æ ‡æ•°å€¼")]),s._v(", è½¬æ¢æˆç›‘æ§æœåŠ¡ç«¯è¦æ±‚çš„æ•°æ®æ ¼å¼, ä¼ ä¸Šå»å³å¯.")]),s._v(" "),t("p",[s._v("é™¤äº† Elasticsearch, è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç»„ä»¶ä¹Ÿæ˜¯ç”¨è¿™ç§æ–¹å¼æ¥æš´éœ²æŒ‡æ ‡çš„, æ¯”å¦‚ RabbitMQ, è®¿é—® "),t("code",[s._v("/api/overview")]),s._v("â€‹ å¯ä»¥æ‹¿åˆ° Message æ•°é‡, Connection æ•°é‡ç­‰æ¦‚è¦ä¿¡æ¯. å†æ¯”å¦‚ Kubelet, è®¿é—® "),t("code",[s._v("/stats/summary")]),s._v("â€‹ å¯ä»¥æ‹¿åˆ° Node å’Œ Pod ç­‰å¾ˆå¤šæ¦‚è¦ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("ä¸åŒçš„æ¥å£è¿”å›çš„å†…å®¹è™½ç„¶éƒ½æ˜¯æŒ‡æ ‡æ•°æ®, ä½†æ˜¯è¦æ¨ç»™ç›‘æ§æœåŠ¡ç«¯, è¿˜æ˜¯è¦åšä¸€æ¬¡æ ¼å¼è½¬æ¢, æ¯”å¦‚ç»Ÿä¸€è½¬æ¢ä¸º Prometheus çš„æ–‡æœ¬æ ¼å¼. "),t("strong",[s._v("è¦æ˜¯è¿™äº›ç»„ä»¶éƒ½ç›´æ¥æš´éœ² Prometheus çš„åè®®æ•°æ®å°±å¥½äº†")]),s._v(", ä½¿ç”¨ç»Ÿä¸€çš„è§£æå™¨, å°±èƒ½å¤§å¤§ç®€åŒ–ç›‘æ§é‡‡é›†é€»è¾‘. æ‰€å¹¸è¿™ä¸ªè¶‹åŠ¿æ­£åœ¨å‘ç”Ÿ, å‰é¢ä¹Ÿæåˆ°äº†, åƒ etcd, CoreDNS, æ–°ç‰ˆ ZooKeeper, æ–°ç‰ˆ RabbitMQ, nginx-vts ç­‰, éƒ½å†…ç½®æš´éœ²äº† Prometheus  åè®®æ•°æ®, å¯è°“è¡Œä¸šå¹¸äº‹.")]),s._v(" "),t("p",[s._v("è¿™ç§æ‹‰å–ç›‘æ§æ•°æ®çš„æ–¹å¼è™½ç„¶éœ€è¦åšä¸€äº›æ•°æ®æ ¼å¼çš„è½¬æ¢, ä½†å¹¶ä¸å¤æ‚. å› ä¸ºç›®æ ‡å¯¹è±¡ä¼šæŠŠéœ€è¦ç›‘æ§çš„æ•°æ®ç›´æ¥é€šè¿‡æ¥å£æš´éœ²å‡ºæ¥, ç›‘æ§é‡‡é›†å™¨æŠŠæ•°æ®æ‹‰åˆ°æœ¬åœ°åšæ ¼å¼è½¬æ¢å³å¯.")]),s._v(" "),t("h4",{attrs:{id:"è¿æ¥åˆ°ç›®æ ‡å¯¹è±¡æ‰§è¡Œå‘½ä»¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥åˆ°ç›®æ ‡å¯¹è±¡æ‰§è¡Œå‘½ä»¤"}},[s._v("#")]),s._v(" è¿æ¥åˆ°ç›®æ ‡å¯¹è±¡æ‰§è¡Œå‘½ä»¤")]),s._v(" "),t("p",[s._v("æ›´å¤æ‚çš„æ–¹å¼æ˜¯"),t("strong",[s._v("éœ€è¦è¿æ¥åˆ°ç›®æ ‡å¯¹è±¡ä¸Šæ‰§è¡ŒæŒ‡ä»¤")]),s._v(", MySQL, Redis, MongoDB ç­‰éƒ½æ˜¯è¿™ç§æ–¹å¼, ä¸‹é¢å°±æ¥ä¸€èµ·çœ‹ä¸€ä¸‹è¿™ç§é‡‡é›†æ–¹å¼çš„å·¥ä½œåŸç†.")]),s._v(" "),t("p",[s._v("ç›®å‰æœ€å¸¸ç”¨çš„æ•°æ®åº“å°±æ˜¯ MySQL å’Œ Redis äº†, å°±æ‹¿è¿™ä¸¤ä¸ªç»„ä»¶æ¥ä¸¾ä¾‹. å…ˆè¯´ MySQL, ç»å¸¸éœ€è¦è·å–ä¸€äº›è¿æ¥ç›¸å…³çš„æŒ‡æ ‡æ•°æ®, æ¯”å¦‚å½“å‰æœ‰å¤šå°‘è¿æ¥, æ€»å…±æ‹’ç»äº†å¤šå°‘è¿æ¥, æ€»å…±æ¥æ”¶è¿‡å¤šå°‘è¿æ¥, ç™»å½• MySQL å‘½ä»¤è¡Œ, ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥è·å–.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show global status like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%onn%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-----------------------------------------------+---------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------------------------------+---------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Aborted_connects                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3212")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connection_errors_accept                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connection_errors_internal                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connection_errors_max_connections             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connection_errors_peer_address                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connection_errors_select                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connection_errors_tcpwrap                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connections                                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3281")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Locked_connects                               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Max_used_connections                          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Max_used_connections_time                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-10-30 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":41:35 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Performance_schema_session_connect_attrs_lost "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Ssl_client_connects                           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Ssl_connect_renegotiates                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Ssl_finished_connects                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Threads_connected                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------------------------------+---------------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" rows "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("Threads_connected è¡¨ç¤ºå½“å‰æœ‰å¤šå°‘è¿æ¥, Max_used_connections è¡¨ç¤ºæ›¾ç»"),t("strong",[s._v("æœ€å¤šæœ‰å¤šå°‘è¿æ¥")]),s._v(", Connections è¡¨ç¤ºæ€»è®¡æ¥æ”¶è¿‡å¤šå°‘è¿æ¥. å½“ç„¶é™¤äº†è¿æ¥æ•°ç›¸å…³çš„æŒ‡æ ‡, é€šè¿‡ "),t("code",[s._v("show global status")]),s._v("â€‹ è¿˜å¯ä»¥è·å–å¾ˆå¤šå…¶ä»–çš„æŒ‡æ ‡, è¿™äº›æŒ‡æ ‡ç”¨äºè¡¨ç¤º MySQL çš„è¿è¡ŒçŠ¶æ€, éšç€å®ä¾‹è¿è¡Œ, è¿™äº›æ•°æ®ä¼šåŠ¨æ€å˜åŒ–.")]),s._v(" "),t("p",[s._v("è¿˜æœ‰å¦ä¸€ä¸ªå‘½ä»¤ "),t("code",[s._v("show global variables")]),s._v("â€‹ å¯ä»¥è·å–ä¸€äº›"),t("strong",[s._v("å…¨å±€å˜é‡ä¿¡æ¯")]),s._v(", æ¯”å¦‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥è·å– MySQL æœ€å¤§è¿æ¥æ•°.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show global variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%onn%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-----------------------------------------------+-----------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------------------------------+-----------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" character_set_connection                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" utf8            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" collation_connection                          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" utf8_general_ci "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" connect_timeout                               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" disconnect_on_expired_password                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ON              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" init_connect                                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" max_connect_errors                            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" max_connections                               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" max_user_connections                          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" performance_schema_session_connect_attrs_size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------------------------------+-----------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" rows "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[t("strong",[s._v("å…¶ä¸­ max_connections å°±æ˜¯æœ€å¤§è¿æ¥æ•°, è¿™ä¸ªæ•°å€¼é»˜è®¤æ˜¯ 151. åœ¨å¾ˆå¤šç”Ÿäº§ç¯å¢ƒä¸‹, éƒ½åº”è¯¥è°ƒå¤§, æ‰€ä»¥è¦æŠŠè¿™ä¸ªæŒ‡æ ‡ä½œä¸ºä¸€ä¸ªå‘Šè­¦è§„åˆ™ç›‘æ§èµ·æ¥, å¦‚æœå‘ç°è¿™ä¸ªæ•°å€¼å¤ªå°è¦åŠæ—¶å‘Šè­¦.")])]),s._v(" "),t("p",[s._v("é™¤äº†åˆšæ‰ä»‹ç»çš„ä¸¤ä¸ªå‘½ä»¤, è¿˜å¯ä»¥æ‰§è¡Œå…¶ä»–å‘½ä»¤è·å–å…¶ä»–æ•°æ®åº“æŒ‡æ ‡, æ¯”å¦‚ "),t("code",[s._v("show slave status")]),s._v("â€‹ å¯ä»¥è·å– Slave èŠ‚ç‚¹çš„ä¿¡æ¯. æ€»çš„æ¥çœ‹, "),t("mark",[t("strong",[s._v("MySQL ç›‘æ§çš„åŸç†å°±æ˜¯, è¿ä¸Š MySQL åæ‰§è¡Œå„ç§ SQL è¯­å¥, è§£æç»“æœ, è½¬æ¢ä¸ºç›‘æ§æ—¶åºæ•°æ®")])]),s._v(".")]),s._v(" "),t("p",[s._v("ä¸Šé¢ä¾‹å­ä¸­çš„ SQL è¯­å¥éƒ½æ˜¯ç”¨æ¥è·å– MySQL å®ä¾‹è¿è¡ŒçŠ¶æ€çš„. å®é™…ä¸Š, æ—¢ç„¶å¯ä»¥æ‰§è¡Œ SQL è¯­å¥, å°±å¯ä»¥è‡ªå®šä¹‰ä¸€äº› SQL æ¥æŸ¥è¯¢ä¸šåŠ¡æ•°æ®, è·å–ä¸šåŠ¡æŒ‡æ ‡. å‰é¢ä¹Ÿæåˆ°è¿‡, ä¸šåŠ¡æŒ‡æ ‡æ•°æ®æ˜¯æ•´ä¸ªç›‘æ§ä½“ç³»ä¸­ä»·å€¼æœ€å¤§çš„, è¦å¥½å¥½åˆ©ç”¨è¿™ä¸ªèƒ½åŠ›.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚æœ‰ä¸ª orders è¡¨å­˜å‚¨äº†è®¢å•æ•°æ®, é‚£å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­å¥è·å–è®¢å•æ€»é‡.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as order_total from orders\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("æŠŠ order_total è¿™ä¸ªè¿”å›å€¼ä½œä¸ºæœ€ç»ˆçš„ç›‘æ§æ•°æ®ä¸ŠæŠ¥å³å¯")]),s._v(". è¿™ç§æ–¹å¼å¯¹äºä¸€äº›æ¯”è¾ƒç®€å•çš„å•è¡¨åœºæ™¯è¿˜æ˜¯æŒºå¥½ç”¨çš„. ä½†å¦‚æœä¸šåŠ¡ä¾§æœ‰åˆ†åº“åˆ†è¡¨, å°±éœ€è¦ç”¨ä¸€äº›æ›´å¤æ‚çš„æ‰‹æ®µæ¥è§£å†³äº†.")]),s._v(" "),t("p",[s._v("Redis ä¹Ÿæ˜¯ç±»ä¼¼çš„, æ¯”å¦‚é€šè¿‡ redis-cli ç™»å½•åˆ°å‘½ä»¤è¡Œ, æ‰§è¡Œ "),t("code",[s._v("info memory")]),s._v("â€‹ å‘½ä»¤, å°±å¯ä»¥çœ‹åˆ°å¾ˆå¤šå†…å­˜ç›¸å…³çš„æŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" info memory\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Memory")]),s._v("\nused_memory:1345568\nused_memory_human:1.28M\nused_memory_rss:3653632\nused_memory_rss_human:3.48M\nused_memory_peak:1504640\nused_memory_peak_human:1.43M\nused_memory_peak_perc:89.43%\nused_memory_overhead:1103288\nused_memory_startup:1095648\nused_memory_dataset:242280\nused_memory_dataset_perc:96.94%\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("è™½ç„¶è¿™é‡ŒæŠŠè¾“å‡ºæˆªæ–­äº†, ä½†ä¹Ÿå¾ˆå®¹æ˜“çœ‹å‡ºæ‰€ä»¥ç„¶, è¾“å‡ºçš„æŒ‡æ ‡æ˜¯ "),t("strong",[s._v("Key:Value")]),s._v(" çš„æ ¼å¼, Value éƒ¨åˆ†æœ‰çš„å¸¦ç€å•ä½, è§£æçš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€ä¸‹, åšä¸€ä¸ªæ ¼å¼è½¬æ¢.")]),s._v(" "),t("p",[s._v("æœ‰äº›ä¸šåŠ¡æ•°æ®å¯èƒ½æ˜¯å­˜åœ¨ Redis é‡Œçš„, æ‰€ä»¥ç›‘æ§ Redis ä¸åªæ˜¯è·å– Redis è‡ªèº«çš„æŒ‡æ ‡, è¿˜åº”è¯¥æ”¯æŒè‡ªå®šä¹‰å‘½ä»¤, è·å–ä¸€äº›ä¸šåŠ¡æ•°æ®, æ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤, ç”¨äºè·å–è®¢å•æ€»é‡.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("get /orders/total\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ä¸ªä¾‹å­æ˜¯å‡è®¾ä¸šåŠ¡ç¨‹åºä¼šè‡ªåŠ¨æ›´æ–° "),t("strong",[s._v("Redis Key: /orders/total")]),s._v(", ç”¨è¿™ä¸ª Key æ¥å­˜æ”¾è®¢å•æ€»é‡.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/0f6091c107b263bcd481c278d821ee32-20230719203435-noophhq.jpg",alt:""}})]),s._v(" "),t("p",[s._v("è®²åˆ°è¿™é‡Œ, å°±æŠŠå¸¸è§çš„ OS å’Œä¸­é—´ä»¶çš„ç›‘æ§è®²å®Œäº†, æŒ‰ç…§ä¸Šä¸€è®²çš„ç›‘æ§åˆ†å±‚æ¶æ„å›¾, æ¥ä¸‹æ¥å°±æ˜¯åº”ç”¨ç›‘æ§å’Œä¸šåŠ¡ç›‘æ§, "),t("mark",[t("strong",[s._v("åº”ç”¨ç›‘æ§å’Œä¸šåŠ¡ç›‘æ§æœ‰ä¸¤ç§å…¸å‹çš„é‡‡é›†æ‰‹æ®µ, ä¸€ä¸ªæ˜¯åŸ‹ç‚¹, ä¸€ä¸ªæ˜¯æ—¥å¿—è§£æ")])]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"ä»£ç åŸ‹ç‚¹ä¸æ—¥å¿—è§£æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»£ç åŸ‹ç‚¹ä¸æ—¥å¿—è§£æ"}},[s._v("#")]),s._v(" ä»£ç åŸ‹ç‚¹ä¸æ—¥å¿—è§£æ")]),s._v(" "),t("p",[s._v("æ‰€è°“çš„ä»£ç åŸ‹ç‚¹æ–¹å¼, æ˜¯æŒ‡åº”ç”¨ç¨‹åºå†…åµŒä¸€äº›ç›‘æ§ç›¸å…³çš„ SDK, åœ¨è¯·æ±‚çš„å…³é”®é“¾è·¯ä¸Šè°ƒç”¨ SDK çš„æ–¹æ³•, å‘Šè¯‰ SDK å½“å‰æ˜¯ä¸ªä»€ä¹ˆè¯·æ±‚, è€—æ—¶å¤šå°‘, æ˜¯å¦æˆåŠŸä¹‹ç±»çš„, SDK æ±‡æ€»è¿™äº›æ•°æ®å¹¶äºŒæ¬¡è®¡ç®—, æœ€ç»ˆæ¨ç»™ç›‘æ§æœåŠ¡ç«¯.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸€ä¸ªç”¨ Go å†™çš„ Web ç¨‹åº, æä¾›äº† 10 ä¸ª HTTP æ¥å£, æƒ³è·å–è¿™ 10 ä¸ªæ¥å£çš„æˆåŠŸç‡å’Œå»¶è¿Ÿæ•°æ®, é‚£å°±è¦å†™ç¨‹åºå®ç°è¿™äº›é€»è¾‘, åŒ…æ‹¬æ•°æ®é‡‡é›†, ç»Ÿè®¡, è½¬å‘ç»™æœåŠ¡ç«¯ç­‰. è¿™äº›ç›‘æ§ç›¸å…³çš„é€»è¾‘æ˜¯å…¸å‹çš„æ¨ªå‘éœ€æ±‚, è¿™ä¸ª Web ç¨‹åºæœ‰éœ€æ±‚, å…¶ä»–çš„ç¨‹åºä¹Ÿæœ‰è¿™ä¸ªéœ€æ±‚, æ‰€ä»¥å°±æŠŠè¿™éƒ¨åˆ†"),t("strong",[s._v("ä»£ç æŠ½è±¡æˆä¸€ä¸ªç»Ÿä¸€çš„ Lib")]),s._v(", å³ä¸Šé¢æåˆ°çš„è¿™ä¸ª SDK, æ¯ä¸ªéœ€è¦ç›‘æ§é€»è¾‘çš„ç¨‹åºéƒ½å¯ä»¥å¤ç”¨è¿™ä¸ª SDK, æå‡æ•ˆç‡.")]),s._v(" "),t("p",[t("strong",[s._v("ä½†æ˜¯æ¯ä¸ªé¡¹ç›®éƒ½è¦è°ƒç”¨è¿™ä¸ª SDK çš„æ–¹æ³•ä»ç„¶æ˜¾å¾—å¾ˆå†—ä½™, æ˜¯å¦æœ‰æ›´ç®€å•çš„åŠæ³•å‘¢? æœ‰! æ¯ä¸ªå…¬å¸å¯ä»¥å»ºç«‹ç»Ÿä¸€çš„æ¡†æ¶å¼€å‘å›¢é˜Ÿ, å¼€å‘ç»Ÿä¸€çš„ HTTP æ¡†æ¶, åœ¨æ¡†æ¶é‡Œä½¿ç”¨ AOP çš„ç¼–ç¨‹æ–¹å¼, å†…ç½®é‡‡é›†è¿™äº›ç›‘æ§æ•°æ®. è¿™æ ·ä¸€æ¥, åªè¦æŸä¸ªå›¢é˜Ÿç”¨äº†è¿™ä¸ªç»Ÿä¸€çš„ HTTP æ¡†æ¶, å°±è‡ªåŠ¨å…·å¤‡äº†ç›‘æ§åŸ‹ç‚¹èƒ½åŠ›. åŒç†ä¹Ÿå¯ä»¥æ„å»ºç»Ÿä¸€çš„ RPC è°ƒç”¨æ¡†æ¶, ç»Ÿä¸€çš„ MySQL è°ƒç”¨æ¡†æ¶, è¿™æ ·å°±é€æ­¥æ„å»ºäº†ç»Ÿä¸€ä¸”å®Œå¤‡çš„åº”ç”¨ç›‘æ§æ•°æ®æ”¶é›†ä½“ç³».")])]),s._v(" "),t("p",[s._v("è¿™ç§æ–¹å¼éœ€è¦å†…åµŒ SDK, å¯¹ä»£ç æœ‰ä¾µå…¥æ€§, æ˜¯å¦æœ‰æ›´ç®€å•çš„åŠæ³•å‘¢? æœ‰! å¯¹äº Java è¿™ç§å­—èŠ‚ç è¯­è¨€, "),t("strong",[s._v("å¯ä»¥ä½¿ç”¨ JavaAgent æŠ€æœ¯, åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç , è‡ªåŠ¨è·å–ç›‘æ§æ•°æ®")]),s._v(".")]),s._v(" "),t("p",[s._v("å½“ç„¶ç°åœ¨ä¹Ÿ"),t("strong",[s._v("å¼€å§‹æµè¡Œ eBPF æŠ€æœ¯")]),s._v(", æœ‰äº›å‚å•†åœ¨å°è¯•, ä¹Ÿå¯ä»¥å…³æ³¨ä¸‹. ä¸è¿‡åœ¨ç”Ÿäº§å®è·µä¸­, å¤§éƒ¨åˆ†å‚å•†è¿˜æ˜¯åœ¨ç”¨åŸ‹ç‚¹çš„æ–¹å¼é‡‡é›†ç›‘æ§æ•°æ®, åé¢ä¼šä¸“é—¨æ¼”ç¤ºå¦‚ä½•åšåŸ‹ç‚¹.")]),s._v(" "),t("p",[s._v("å¯¹äºè‡ªç ”çš„ç¨‹åº, ä»£ç åŸ‹ç‚¹æ˜¯æ²¡é—®é¢˜çš„, ä½†æ˜¯å¾ˆå¤šç¨‹åºå¯èƒ½æ˜¯å¤–é‡‡çš„, æ²¡æ³•ä¿®æ”¹å®ƒçš„æºä»£ç , è¿™æ—¶å€™å°±è¦ä½¿ç”¨ "),t("strong",[s._v("æ—¥å¿—è§£æ")]),s._v(" çš„æ–¹å¼äº†. ä¸€èˆ¬ç¨‹åºéƒ½ä¼šæ‰“å°æ—¥å¿—, å¯ä»¥å†™æ—¥å¿—è§£æç¨‹åº, ä»æ—¥å¿—ä¸­æå–ä¸€äº›å…³é”®ä¿¡æ¯, æ¯”å¦‚ä»ä¸šåŠ¡æ—¥å¿—ä¸­å¾ˆå®¹æ˜“æ‹¿åˆ° Exception å…³é”®å­—å‡ºç°çš„æ¬¡æ•°, ä»æ¥å…¥å±‚æ—¥å¿—ä¸­å¾ˆå®¹æ˜“å°±èƒ½æ‹¿åˆ°æŸä¸ªæ¥å£çš„è®¿é—®æ¬¡æ•°. è¿™éƒ¨åˆ†å†…å®¹åé¢ä¼šè¯¦ç»†æ¼”ç¤º, è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-9"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº†å¤šç§ç›‘æ§æ•°æ®çš„é‡‡é›†æ–¹å¼, å¯ä»¥ä»åŸç†çš„è§’åº¦æ¥ç†è§£ç›‘æ§æ•°æ®é‡‡é›†è¿™éƒ¨åˆ†å†…å®¹, åé¢å†é‡åˆ°ç›‘æ§æŒ‡æ ‡è·å–ä¸åˆ°çš„é—®é¢˜, ä¹Ÿå¯ä»¥ä»åŸç†ä¸Šåšä¸€äº›æ’æŸ¥.")]),s._v(" "),t("p",[t("mark",[s._v("**æ€»çš„æ¥çœ‹, OS å±‚é¢çš„ç›‘æ§éœ€è¦æŠŠ Agent éƒ¨ç½²åˆ°æœºå™¨é‡Œ, è¯»å–ä¸€äº›æœ¬åœ°çš„ç‰¹æ®Šæ–‡ä»¶, æ‰§è¡Œä¸€äº›å‘½ä»¤æ¥è·å–ç›‘æ§æ•°æ®; æ•°æ®åº“, ä¸­é—´ä»¶çš„ç›‘æ§, å¤§éƒ½æ˜¯è¿œç¨‹é‡‡é›†, åªæ˜¯åè®®å„å¼‚, éœ€è¦åšä¸€å®šçš„é€‚é…; åº”ç”¨ç›‘æ§çš„è¯, å…¸å‹çš„é‡‡é›†æ–¹å¼æœ‰ä¸¤ç§, ä¸€ä¸ªæ˜¯ä»£ç åŸ‹ç‚¹, ä¸€ä¸ªæ˜¯æ—¥å¿—è§£æ. **")])]),s._v(" "),t("p",[s._v("æœ¬èŠ‚çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/24f725a7d2cff0e1a0e4e799d68cf54d-20230719203435-him2pce.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_11-æœºå™¨ç›‘æ§-æ“ä½œç³»ç»Ÿæœ‰å“ªäº›æŒ‡æ ‡éœ€è¦é‡ç‚¹å…³æ³¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-æœºå™¨ç›‘æ§-æ“ä½œç³»ç»Ÿæœ‰å“ªäº›æŒ‡æ ‡éœ€è¦é‡ç‚¹å…³æ³¨"}},[s._v("#")]),s._v(" 11.æœºå™¨ç›‘æ§-æ“ä½œç³»ç»Ÿæœ‰å“ªäº›æŒ‡æ ‡éœ€è¦é‡ç‚¹å…³æ³¨?")]),s._v(" "),t("p",[s._v("å‰ä¸¤è®²ä»æ–¹æ³•è®ºå’ŒæŠ€æœ¯å®ç°è§’åº¦ç»™ä»‹ç»äº†ç›‘æ§æ•°æ®çš„é‡‡é›†åŸç†åŠæ–¹æ³•, è¿™äº›æ–¹æ³•è®ºæ˜¯æå®šåé¢å„ç§ç›‘æ§éœ€æ±‚çš„åŸºç¡€, è¿™é‡Œå¯ä»¥å†ç»“åˆæ€»ç»“å›¾å¤ä¹ ä¸€ä¸‹. æœ‰äº†è¿™äº›ç†è®ºåŸºç¡€ä¹‹å, å°±å¯ä»¥åŠ¨æ‰‹å®æ“äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2a99224e4000699bc14fe6d5445a93ef-20230719203435-cokk2lv.png",alt:""}})]),s._v(" "),t("p",[s._v("ç›‘æ§æ–¹å‘é‡Œæœ€è€³ç†Ÿèƒ½è¯¦çš„, å°±æ˜¯æœºå™¨ç›‘æ§, ä¹Ÿå°±æ˜¯å‰é¢è¯´çš„è®¾å¤‡ç›‘æ§ä¸­çš„ä¸€ç§. æœºå™¨æ˜¯è¿›ç¨‹è¿è¡Œçš„åŸºç¡€ç¯å¢ƒ, åœ¨åˆ¶ä½œä¸­é—´ä»¶, åº”ç”¨ç›‘æ§ä»ªè¡¨ç›˜çš„æ—¶å€™, ä¸€èˆ¬ä¼šæŠŠæœºå™¨æ ¸å¿ƒæŒ‡æ ‡, æ¯”å¦‚ CPU, å†…å­˜, ç£ç›˜, ç½‘ç»œ, IO ç­‰, ä½œä¸ºä»ªè¡¨ç›˜çš„ä¸€éƒ¨åˆ†, USE æ–¹æ³•è®ºä¸»è¦å°±æ˜¯é’ˆå¯¹æœºå™¨ç›‘æ§æå‡ºçš„, å…¶é‡è¦æ€§ä¸è¨€è€Œå–», æ‰€ä»¥ä»Šå¤©å°±ä»æœºå™¨ç›‘æ§å¼€å§‹èŠèµ·.")]),s._v(" "),t("h4",{attrs:{id:"æœºå™¨ç›‘æ§æ‰‹æ®µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœºå™¨ç›‘æ§æ‰‹æ®µ"}},[s._v("#")]),s._v(" æœºå™¨ç›‘æ§æ‰‹æ®µ")]),s._v(" "),t("p",[s._v("æœºå™¨å±‚é¢çš„ç›‘æ§åˆ†ä¸ºä¸¤éƒ¨åˆ†, "),t("strong",[s._v("å¸¦å†…ç›‘æ§å’Œå¸¦å¤–ç›‘æ§")]),s._v(". "),t("strong",[s._v("å¸¦å†…ç›‘æ§å°±æ˜¯é€šè¿‡å¸¦å†…ç½‘ç»œæ¥ç›‘æ§, ä¸»è¦æ˜¯ä»¥åœ¨ OS é‡Œéƒ¨ç½² Agent çš„æ–¹å¼, æ¥è·å– OS çš„ CPU, å†…å­˜, ç£ç›˜, IO, ç½‘ç»œ, è¿›ç¨‹ç­‰ç›¸å…³ç›‘æ§æŒ‡æ ‡")]),s._v(". éšç€äº‘æ—¶ä»£çš„åˆ°æ¥, æ™®é€šè¿ç»´ç ”å‘äººå‘˜ä¸»è¦å…³æ³¨å¸¦å†…ç›‘æ§å³å¯, IDCè¿ç»´äººå‘˜æ‰ä¼šå…³æ³¨å¸¦å¤–ç›‘æ§.")]),s._v(" "),t("p",[s._v("å¯¹äºå¸¦å†…ç›‘æ§, å¸¸è§çš„ Agent æœ‰ Categraf, Telegraf, Grafana-agent, Datadog-agent, Node-exporter ç­‰, è¿™ä¸€è®²é™¤äº†ä»‹ç»åŸºæœ¬çš„CPU, å†…å­˜, ç¡¬ç›˜ç›¸å…³çš„ç›‘æ§, è¿˜ä¼šä»‹ç»ä¸€ä¸‹è¿›ç¨‹ç›‘æ§å’Œè‡ªå®šä¹‰ç›‘æ§è„šæœ¬, æ‰€ä»¥é€‰æ‹© Categraf, ç›¸å¯¹æ¯”è¾ƒæ–¹ä¾¿.")]),s._v(" "),t("h4",{attrs:{id:"categrafä»‹ç»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#categrafä»‹ç»"}},[s._v("#")]),s._v(" Categrafä»‹ç»")]),s._v(" "),t("p",[t("strong",[s._v("Categraf ä½œä¸ºä¸€æ¬¾ Agent éœ€è¦éƒ¨ç½²åˆ°æ‰€æœ‰ç›®æ ‡æœºå™¨ä¸Š")]),s._v(", å› ä¸ºé‡‡é›† CPU, å†…å­˜, è¿›ç¨‹ç­‰æŒ‡æ ‡, æ˜¯éœ€è¦è¯»å– OS é‡Œçš„ä¸€äº›ä¿¡æ¯çš„, è¿œç¨‹è¯»å–ä¸äº†. é‡‡é›†åˆ°æ•°æ®ä¹‹å, è½¬æ¢æ ¼å¼, ä¼ è¾“ç»™ç›‘æ§æœåŠ¡ç«¯.")]),s._v(" "),t("p",[s._v("**Categraf æ¨é€ç›‘æ§æ•°æ®åˆ°æœåŠ¡ç«¯, èµ°çš„æ˜¯ Prometheus çš„ RemoteWrite åè®®, æ˜¯åŸºäº Protobuf çš„ HTTP åè®®, æ‰€ä»¥æ‰€æœ‰æ”¯æŒ RemoteWrite çš„åç«¯, éƒ½å¯ä»¥å’Œ Categraf å¯¹æ¥, æ¯”å¦‚ Prometheus, Nightingale, TDEngine ç­‰. **")]),s._v(" "),t("h4",{attrs:{id:"categrafé…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#categrafé…ç½®"}},[s._v("#")]),s._v(" Categrafé…ç½®")]),s._v(" "),t("p",[s._v("ä¸ºäº†æ–¹ä¾¿çœ‹åˆ°æ•ˆæœ, å¯ä»¥æŠŠ Categraf é‡‡é›†çš„æ•°æ®æ¨é€ç»™ Nightingale, å³ n9e-server çš„ "),t("code",[s._v("/prometheus/v1/write")]),s._v("â€‹ åœ°å€, å¯ä»¥çœ‹ä¸€ä¸‹ç›¸å…³çš„é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("writers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nurl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:19000/prometheus/v1/write"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("æ³¨: Categraf çš„ä¸»é…ç½®æ–‡ä»¶æ˜¯åœ¨ conf ç›®å½•ä¸‹çš„ config.toml, è§£å‹ç¼©å‘å¸ƒåŒ…å°±å¯ä»¥çœ‹åˆ°äº†.")]),s._v(" "),t("p",[s._v("å½“ç„¶, å¦‚æœæƒ³è®© Categraf æŠŠæ•°æ®æ¨ç»™ Prometheus, ä¹Ÿå¯ä»¥. ä½†éœ€è¦æŠŠ 127.0.0.1:19000 ä¿®æ”¹ä¸º Prometheus åœ°å€, è¿˜è¦ä¿®æ”¹ URL è·¯å¾„, å› ä¸º Prometheus çš„ RemoteWrite æ•°æ®æ¥æ”¶åœ°å€æ˜¯ /api/v1/write.")]),s._v(" "),t("p",[s._v("æœ€åè¿˜è¦æ³¨æ„, Prometheus è¿›ç¨‹å¯åŠ¨çš„æ—¶å€™, éœ€è¦å¢åŠ ä¸€ä¸ªå¯åŠ¨å‚æ•° "),t("code",[s._v("--enable-feature=remote-write-receiver")]),s._v("â€‹, é‡å¯ Prometheus å°±èƒ½æ¥æ”¶ RemoteWrite æ•°æ®äº†.")]),s._v(" "),t("p",[s._v("é…ç½®å®Œå°±å¯ä»¥å¯åŠ¨äº†, ä¸è¿‡å¯åŠ¨ä¹‹å‰, å…ˆæ¥ç®€å•æµ‹è¯•ä¸€ä¸‹. é€šè¿‡ "),t("code",[s._v("./categraf --test")]),s._v("â€‹ çœ‹çœ‹ Categraf æœ‰æ²¡æœ‰æŠ¥é”™, æ­£å¸¸æƒ…å†µä¼šåœ¨å‘½ä»¤è¡Œè¾“å‡ºé‡‡é›†åˆ°çš„ç›‘æ§æ•°æ®, ä¸‹é¢æ˜¯è¿è¡Œç»“æœ, å¯ä»¥å‚è€ƒä¸‹.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt-fc-dev01.nj categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./categraf --test --inputs mem:system")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 main.go:110: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" runner.binarydir: /home/work/go/src/categraf\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 main.go:111: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" runner.hostname: tt-fc-dev01.nj\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 main.go:112: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" runner.fd_limits: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("soft"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hard")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 main.go:113: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" runner.vm_limits: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("soft"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unlimited, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hard")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unlimited"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 config.go:33: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" tracing disabled\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 provider.go:63: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" use input provider: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 agent.go:85: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" agent starting\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 metrics_agent.go:93: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.mem started\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 metrics_agent.go:93: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" input: local.system started\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 prometheus_scrape.go:14: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" prometheus scraping disabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/11/05 09:14:31 agent.go:96: I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" agent started\n09:14:31 system_load_norm_5 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v("\n09:14:31 system_load_norm_15 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2675")]),s._v("\n09:14:31 system_uptime "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7307063")]),s._v("\n09:14:31 system_load1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.66")]),s._v("\n09:14:31 system_load5 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v("\n09:14:31 system_load15 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.07")]),s._v("\n09:14:31 system_n_cpus "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n09:14:31 system_load_norm_1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.415")]),s._v("\n09:14:31 mem_swap_free "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n09:14:31 mem_used "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5248593920")]),s._v("\n09:14:31 mem_high_total "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n09:14:31 mem_huge_pages_total "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n09:14:31 mem_low_free "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt-fc-dev01.nj "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("æµ‹è¯•æ²¡é—®é¢˜, å°±å¯ä»¥å¯åŠ¨äº†. é€šè¿‡ "),t("code",[s._v("nohup ./categraf &> stdout.log &")]),s._v("â€‹ ç®€å•å¯åŠ¨å³å¯, å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒ, å»ºè®®ä½¿ç”¨ systemd æˆ– supervisor ç­‰æ‰˜ç®¡è¿›ç¨‹.")]),s._v(" "),t("h4",{attrs:{id:"å¯¼å…¥é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯¼å…¥é…ç½®"}},[s._v("#")]),s._v(" å¯¼å…¥é…ç½®")]),s._v(" "),t("p",[s._v("Categraf å†…ç½® "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/system/dashboard.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux ç›‘æ§å¤§ç›˜"),t("OutboundLink")],1),s._v(", å¯¼å…¥ Nightingale å°±èƒ½çœ‹åˆ°æ•ˆæœ, å½“ç„¶å®ƒä¹Ÿå†…ç½®äº†å‘Šè­¦è§„åˆ™, å¯ä»¥çœ‹ä¸€ä¸‹è§„åˆ™çš„ "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/system/alerts-linux.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("JSON æ–‡ä»¶"),t("OutboundLink")],1),s._v(". ä¸‹é¢æ˜¯å¤§ç›˜æ•ˆæœå›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/b9e1c30f7cce7a92byye0acd1cdc09b7-20230719203435-n2uudm0.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("èµ°å®Œä¸Šé¢çš„å‡ æ­¥, å°±å¯ä»¥çœ‹åˆ°ç›‘æ§æ•ˆæœäº†. ä¸‹é¢å°±æ¥çœ‹ä¸€ä¸‹è¿™äº›æ•°æ®æ˜¯æ€ä¹ˆæ¥çš„.")]),s._v(" "),t("h4",{attrs:{id:"categrafæ’ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#categrafæ’ä»¶"}},[s._v("#")]),s._v(" Categrafæ’ä»¶")]),s._v(" "),t("p",[s._v("Categraf å’Œ Telegraf, Datadog-agent ç±»ä¼¼, éƒ½æ˜¯æ’ä»¶æ¶æ„, é‡‡é›† CPU æŒ‡æ ‡çš„æ˜¯ cpu æ’ä»¶, é‡‡é›†å†…å­˜æŒ‡æ ‡çš„æ˜¯ mem æ’ä»¶, é‡‡é›†è¿›ç¨‹æŒ‡æ ‡çš„æ˜¯ procstat æ’ä»¶, "),t("strong",[s._v("æ¯ä¸ªæ’ä»¶éƒ½æœ‰ä¸€ä¸ªé…ç½®ç›®å½•, åœ¨ conf ç›®å½•ä¸‹, ä»¥ input. æ‰“å¤´")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\ncategraf.service            input.exec                  input.mem                   input.ntp                   input.redis_sentinel\nconfig.toml                 input.greenplum             input.mongodb               input.nvidia_smi            input.rocketmq_offset\nexample.input.jolokia_agent input.http_response         input.mtail                 input.oracle                input.snmp\ninput.arp_packet            input.ipvs                  input.mysql                 input.phpfpm                input.sqlserver\ninput.conntrack             input.jenkins               input.net                   input.ping                  input.switch_legacy\ninput.cpu                   input.kafka                 input.net_response          input.postgresql            input.system\ninput.disk                  input.kernel                input.netstat               input.processes             input.tomcat\ninput.diskio                input.kernel_vmstat         input.netstat_filter        input.procstat              input.zookeeper\ninput.dns_query             input.kubernetes            input.nfsclient             input.prometheus            logs.toml\ninput.docker                input.linux_sysctl_fs       input.nginx                 input.rabbitmq              prometheus.toml\ninput.elasticsearch         input.logstash              input.nginx_upstream_check  input.redis                 traces.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("OS çš„å„ç±»æŒ‡æ ‡é‡‡é›†, å¤§éƒ½æ˜¯è¯»å–çš„ "),t("code",[s._v("/proc")]),s._v("â€‹ ç›®å½•, å‰é¢å·²ç»ä»‹ç»è¿‡äº†, è¿™é‡Œä¸å†èµ˜è¿°. å¯¹äºå¸¸è§çš„æ’ä»¶, Categraf ä¸­æœ‰å“ªäº›é…ç½®å¯ä»¥æ§åˆ¶å…¶è¡Œä¸º, ä¸‹é¢ä¸€èµ·çœ‹ä¸€ä¸‹.")]),s._v(" "),t("h5",{attrs:{id:"_1-cpu"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-cpu"}},[s._v("#")]),s._v(" 1.cpu")]),s._v(" "),t("p",[s._v("cpu æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.cpu ç›®å½•, åªæœ‰ä¸¤ä¸ªé…ç½®é¡¹, "),t("strong",[s._v("interval å’Œ collect_per_cpu")]),s._v(", å…¶ä¸­ interval è¡¨ç¤ºé‡‡é›†é¢‘ç‡, æ‰€æœ‰çš„æ’ä»¶éƒ½æœ‰è¿™ä¸ªé…ç½®. è€Œå’Œ CPU é‡‡é›†ç›¸å…³çš„é…ç½®å®é™…åªæœ‰ä¸€ä¸ª, å°±æ˜¯ collect_per_cpu, å®ƒç”¨äºæ§åˆ¶æ˜¯å¦é‡‡é›†æ¯ä¸ªå•æ ¸çš„æŒ‡æ ‡. é»˜è®¤å€¼æ˜¯ false, è¡¨ç¤ºä¸é‡‡é›†å•æ ¸çš„æŒ‡æ ‡, åªé‡‡é›†æ•´æœºçš„æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("CPU ç›¸å…³çš„æŒ‡æ ‡, æœ€æ ¸å¿ƒçš„å°±æ˜¯"),t("strong",[s._v("ä½¿ç”¨ç‡")]),s._v(". å¤§å‹äº’è”ç½‘å…¬å¸, ä¸ºäº†åº”å¯¹çªå‘æµé‡, CPU çš„å¹³å‡åˆ©ç”¨ç‡ä¸€èˆ¬å°±æ˜¯ 30% å·¦å³. å¦‚æœå¹³æ—¶ CPU åˆ©ç”¨ç‡æ€»æ˜¯è¶…è¿‡ 60%, å°±æ¯”è¾ƒå±é™©äº†.")]),s._v(" "),t("h5",{attrs:{id:"_2-mem"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-mem"}},[s._v("#")]),s._v(" 2.mem")]),s._v(" "),t("p",[s._v("mem æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.mem ç›®å½•, æ ¸å¿ƒé…ç½®åªæœ‰ä¸€ä¸ª "),t("strong",[s._v("collect_platform_fields")]),s._v(", å®ƒè¡¨ç¤ºæ˜¯å¦é‡‡é›†å„ä¸ªå¹³å°ç‰¹æœ‰çš„æŒ‡æ ‡, ä»€ä¹ˆæ„æ€å‘¢? å†…å­˜ç›¸å…³çš„æŒ‡æ ‡, Linux, Windows, BSD, Darwin éƒ½ä¸æ˜¯å®Œå…¨ä¸€æ ·çš„, å†…å­˜æ€»é‡, ä½¿ç”¨é‡è¿™ç±»æŒ‡æ ‡æ‰€æœ‰å¹³å°éƒ½æœ‰, ä½†æ˜¯å…¶ä½™å¾ˆå¤šæŒ‡æ ‡éƒ½æ˜¯å’Œå¹³å°ç›¸å…³çš„, æ¯”å¦‚ Linux ä¸‹ç‰¹æœ‰çš„ swap, huge_page ç›¸å…³çš„æŒ‡æ ‡, å…¶ä»–å¹³å°å°±æ˜¯æ²¡æœ‰çš„.")]),s._v(" "),t("p",[s._v("å†…å­˜ç›¸å…³çš„æŒ‡æ ‡, æœ€æ ¸å¿ƒçš„æ˜¯"),t("strong",[s._v("å¯ç”¨ç‡")]),s._v(", å³ "),t("strong",[s._v("mem_available_percent")]),s._v(". æ–°ç‰ˆæœ¬çš„ OS å†…ç½® available æŒ‡æ ‡, è€ç‰ˆæœ¬çš„å§‘ä¸”å¯ä»¥æŠŠ free + cached + buffer çœ‹åš available. è¿™ä¸ªå€¼å¦‚æœå°äº 30% å°±å¯ä»¥å‘ä¸ªä½çº§åˆ«å‘Šè­¦å‡ºæ¥äº†, ç„¶åç€æ‰‹æ‰©å®¹.")]),s._v(" "),t("h5",{attrs:{id:"_3-disk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-disk"}},[s._v("#")]),s._v(" 3.disk")]),s._v(" "),t("p",[s._v("disk æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.disk ç›®å½•, é»˜è®¤ä¸ç”¨è°ƒæ•´, å¦‚æœæŸä¸ªæŒ‚è½½ç‚¹ä¸æƒ³é‡‡é›†, å¯ä»¥é…ç½®åˆ° ignore_mount_points ä¸­, è¿™æ ·å°±ä¼šè‡ªåŠ¨å¿½ç•¥æ‰å¯¹åº”çš„æŒ‚è½½ç‚¹.")]),s._v(" "),t("p",[s._v("ç¡¬ç›˜ç›¸å…³çš„æŒ‡æ ‡, ä¸»è¦å…³æ³¨"),t("strong",[s._v("ç©ºé—´ä½¿ç”¨ç‡å’Œ inode ä½¿ç”¨ç‡")]),s._v(". å¯¹äºç©ºé—´ä½¿ç”¨ç‡, "),t("strong",[s._v("85% ä¸€åˆ€åˆ‡çš„å‘Šè­¦è§„åˆ™ä¸åˆé€‚")]),s._v(", å»ºè®®è€ƒè™‘å¤§ç©ºé—´çš„ç›˜å’Œå°ç©ºé—´çš„ç›˜åˆ†åˆ«å¯¹åº”ä¸åŒçš„å‘Šè­¦è§„åˆ™. æ¯”å¦‚:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("disk_used_percent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clickhouse"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("85")]),s._v("\nand\ndisk_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clickhouse"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/1024/1024/1024 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™ä¸ªè§„åˆ™ç”¨äº† and å…³é”®å­—, é™¤äº†ä½¿ç”¨ç‡å¤§äº 85 ä¹‹å¤–, åˆåŠ äº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶: æ€»é‡å°äº 300G.")]),s._v(" "),t("h5",{attrs:{id:"_4-diskio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-diskio"}},[s._v("#")]),s._v(" 4.diskio")]),s._v(" "),t("p",[s._v("diskio æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.diskio ç›®å½•, é»˜è®¤ä¸ç”¨è°ƒæ•´, å¦‚æœåªæƒ³é‡‡é›†æŸå‡ ä¸ªç›˜çš„ IO æ•°æ®, å¯ä»¥ä½¿ç”¨ devices é…ç½®è¿›è¡Œé™åˆ¶.")]),s._v(" "),t("p",[s._v("ç¡¬ç›˜ IO ç›¸å…³çš„æŒ‡æ ‡, ä¸»è¦å…³æ³¨è¯»å†™å»¶è¿Ÿ, æ‰€è°“çš„ IO.UTIL è¿™ç§æŒ‡æ ‡åŸºæœ¬ä¸ç”¨å¤ªå…³æ³¨.")]),s._v(" "),t("h5",{attrs:{id:"_5-net"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-net"}},[s._v("#")]),s._v(" 5.net")]),s._v(" "),t("p",[s._v("net æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.net ç›®å½•, é»˜è®¤ä¸ç”¨è°ƒæ•´, å¦‚æœåªæƒ³é‡‡é›†æŸä¸ªç‰¹å®šç½‘å¡çš„æ•°æ®, å¯ä»¥ä¿®æ”¹ interfaces é…ç½®.")]),s._v(" "),t("p",[s._v("ç°åœ¨çš„ IDC ç¯å¢ƒ, åŠ¨è¾„ä¸‡å…†ç½‘å¡, æ™®é€šä¸šåŠ¡æ ¹æœ¬ä¸ç”¨æ‹…å¿ƒç½‘å¡è·‘æ»¡çš„é—®é¢˜, åªæœ‰ä¸“é—¨ä½œä¸ºæ¥å…¥å±‚çš„æœºå™¨æ‰éœ€è¦é‡ç‚¹å…³æ³¨. ä¸è¿‡ç½‘å¡ä¸¢åŒ…æ˜¯éœ€è¦å…³æ³¨çš„, æ¯”å¦‚é•¿æœŸæ¯ç§’å‡ åä¸ªä¸¢åŒ…, å°±æœ‰ç†ç”±æ€€ç–‘æ˜¯ç¡¬ä»¶çš„é—®é¢˜äº†.")]),s._v(" "),t("h5",{attrs:{id:"_6-netstat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-netstat"}},[s._v("#")]),s._v(" 6.netstat")]),s._v(" "),t("p",[s._v("netstat æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.netstat ç›®å½•, é»˜è®¤ä¸ç”¨è°ƒæ•´, tcp_time_wait æŒ‡æ ‡å°±æ˜¯é è¿™ä¸ªæ’ä»¶é‡‡é›†çš„.")]),s._v(" "),t("h5",{attrs:{id:"_7-processes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-processes"}},[s._v("#")]),s._v(" 7.processes")]),s._v(" "),t("p",[s._v("processes æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.processes ç›®å½•, é»˜è®¤ä¸ç”¨è°ƒæ•´. æœ€å¸¸è§çš„æŒ‡æ ‡æ˜¯"),t("strong",[s._v("è¿›ç¨‹æ€»é‡")]),s._v(", å¦‚æœæŸä¸ªæœºå™¨è¿›ç¨‹æ€»é‡è¶…è¿‡600, å¤§æ¦‚ç‡æ˜¯æœ‰é—®é¢˜çš„, å¸¸è§çš„åŸå› æ¯”å¦‚æŸä¸ª cron å†™æŒ«äº†, æ¯åˆ†é’Ÿ fork ä¸€ä¸ªè¿›ç¨‹, ä½†å°±æ˜¯ä¸é€€å‡º, æ—¶é—´é•¿äº†å°±æŠŠæœºå™¨å‹å®äº†.")]),s._v(" "),t("h5",{attrs:{id:"_8-conntrack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-conntrack"}},[s._v("#")]),s._v(" 8.conntrack")]),s._v(" "),t("p",[s._v("conntrack æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.conntrack ç›®å½•, é»˜è®¤ä¸ç”¨è°ƒæ•´. å¦‚æœå·¥ä½œæ—¶é—´æ¯”è¾ƒä¹…, åº”è¯¥é‡åˆ°è¿‡ conntrack table full çš„æŠ¥é”™å§. è¿™ä¸ªæ’ä»¶å°±æ˜¯ç”¨æ¥ç›‘æ§ conntrack çš„æƒ…å†µçš„. å¯ä»¥é…ç½®ä¸€æ¡è¿™æ ·çš„å‘Šè­¦è§„åˆ™åŠæ—¶å‘ç°é—®é¢˜:  "),t("code",[s._v("conntrack_ip_conntrack_count / ip_conntrack_max > 0.8")]),s._v("â€‹ å°±å¯ä»¥å‘Šè­¦.")]),s._v(" "),t("h5",{attrs:{id:"_9-kernel-vmstat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-kernel-vmstat"}},[s._v("#")]),s._v(" 9.kernel_vmstat")]),s._v(" "),t("p",[s._v("kernel_vmstat æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.kernel_vmstat, é‡‡é›†çš„æ˜¯ "),t("code",[s._v("/proc/vmstat")]),s._v('â€‹ çš„æŒ‡æ ‡æ•°æ®. è¿™ä¸ªæ–‡ä»¶å†…å®¹æ¯”è¾ƒå¤š, æ‰€ä»¥é…ç½®æ–‡ä»¶ä¸­ç»™äº†ä¸€ä¸ªç™½åå•, å¯ä»¥æŒ‰éœ€å¯ç”¨, é»˜è®¤å¯ç”¨äº† oom_kill. è¿™æ ·ä¸€æ¥, OS å‘ç”Ÿ OOM, å¯ä»¥åŠæ—¶çŸ¥é“. ä¸è¿‡è¿™éœ€è¦é«˜ç‰ˆæœ¬çš„å†…æ ¸, ä½ç‰ˆæœ¬æ˜¯æ²¡æœ‰çš„. ä½ç‰ˆæœ¬çš„ OS å¯ä»¥é€šè¿‡ç›‘æ§å†…æ ¸æ—¥å¿—çš„ "Out of memory" å…³é”®å­—æ¥å®ç° OOM ç›‘æ§.')]),s._v(" "),t("h5",{attrs:{id:"_10-ntp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-ntp"}},[s._v("#")]),s._v(" 10.ntp")]),s._v(" "),t("p",[s._v("ntp æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.ntp ç›®å½•, éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ç»™å‡º ntp server çš„åœ°å€. æ¯ä¸ªå…¬å¸éƒ½åº”è¯¥æœ‰å¯¹æ—¶æœºåˆ¶, å¾ˆå¤šåˆ†å¸ƒå¼ç¨‹åºéƒ½æ˜¯é‡åº¦ä¾èµ–æ—¶é—´çš„. ç›‘æ§æŒ‡æ ‡æ˜¯ ntp_offset_ms, é¡¾åæ€ä¹‰, å•ä½æ˜¯æ¯«ç§’, ä¸€èˆ¬è¿™ä¸ªå€¼ä¸èƒ½è¶…è¿‡ 1000, ä¹Ÿä¸èƒ½å°äº -1000, éœ€è¦é…ç½®å‘Šè­¦è§„åˆ™.")]),s._v(" "),t("h5",{attrs:{id:"_11-procstat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-procstat"}},[s._v("#")]),s._v(" 11.procstat")]),s._v(" "),t("p",[s._v("procstat æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.procstat ç›®å½•, ç”¨äº"),t("strong",[s._v("ç›‘æ§è¿›ç¨‹")]),s._v(". è¿›ç¨‹ç›‘æ§ä¸»è¦æ˜¯ä¸¤ä¸ªæ–¹é¢, ä¸€ä¸ªæ˜¯è¿›ç¨‹å­˜æ´»æ€§, ä¸€ä¸ªæ˜¯è¿›ç¨‹å ç”¨çš„ CPU, å†…å­˜, æ–‡ä»¶å¥æŸ„ç­‰æ•°æ®.")]),s._v(" "),t("p",[s._v("å…¶ä¸­ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯æ–‡ä»¶å¥æŸ„, ä¹Ÿå°±æ˜¯ fd ç›¸å…³çš„æŒ‡æ ‡. Linux é»˜è®¤ç»™è¿›ç¨‹åˆ†é…çš„ fd æ•°é‡æ˜¯ 1024, æœ‰äº›äººè°ƒæ•´äº† ulimit ä¹‹åå‘ç°ä¸å¥½ä½¿, æ ¸å¿ƒåŸå› æ˜¯è¿›ç¨‹åœ¨ ulimit è°ƒæ•´ä¹‹å‰å°±å¯åŠ¨äº†, æˆ–è€…æ˜¯å› ä¸º systemd å±‚é¢æ²¡æœ‰è°ƒå¥½. æ²¡å…³ç³», é€šè¿‡ fd è¿™ä¸ªç›‘æ§æŒ‡æ ‡, æœ€ç»ˆéƒ½å¯ä»¥å‘ç°é—®é¢˜. procstat_rlimit_num_fds_soft < 2048 å°±å‘Šè­¦, éœ€è¦é…ç½®è¿™ä¸ªè§„åˆ™.")]),s._v(" "),t("h5",{attrs:{id:"_12-exec"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-exec"}},[s._v("#")]),s._v(" 12.exec")]),s._v(" "),t("p",[s._v("exec æ’ä»¶çš„é…ç½®æ–‡ä»¶åœ¨ input.exec ç›®å½•, ç”¨äºè‡ªå®šä¹‰ç›‘æ§è„šæœ¬. å› ä¸º Agent è™½ç„¶å†…ç½®äº†å¾ˆå¤šæ’ä»¶, ä½†æœ‰äº›é•¿å°¾éœ€æ±‚ä»ç„¶æ˜¯è§£å†³ä¸äº†çš„, æ­¤æ—¶å°±éœ€è¦é€šè¿‡"),t("strong",[s._v("è‡ªå®šä¹‰ç›‘æ§è„šæœ¬æ¥æ‰©å±•ç›‘æ§é‡‡é›†èƒ½åŠ›")]),s._v(".")]),s._v(" "),t("p",[s._v("ç›‘æ§è„šæœ¬å¯ä»¥æ˜¯ Shell çš„, ä¹Ÿå¯ä»¥æ˜¯ Python, Perl, Ruby çš„, åªè¦æœºå™¨ä¸Šæœ‰å¯¹åº”çš„æ‰§è¡Œç¯å¢ƒå°±å¯ä»¥. Agent ä¼š fork ä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œ, æˆªè·è¿›ç¨‹çš„ stdout(æ ‡å‡†è¾“å‡º), è§£ææˆç›‘æ§æ•°æ®ç„¶åä¸ŠæŠ¥. æ‰€ä»¥è„šæœ¬é‡‡é›†åˆ°æ•°æ®ä¹‹å, è¦æ ¼å¼åŒ–æˆæŸä¸ªç‰¹å®šçš„æ ¼å¼, æ‰“å°åˆ° stdout. Categraf æ”¯æŒä¸‰ç§æ ¼å¼: Prometheus, Influx, Falcon, é»˜è®¤æ˜¯ Influx æ ¼å¼.")]),s._v(" "),t("p",[s._v("ç®€å•ä¸¾ä¸ªä¾‹å­, ç›‘æ§æŸä¸ªç›®å½•çš„å¤§å°.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("data1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("du")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sb")]),s._v(" /data1"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("data2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("du")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sb")]),s._v(" /data2"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"du,dir=/data1 size='),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$data1")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"du,dir=/data2 size='),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$data2")]),s._v('"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("è¿™ä¸ªä¾‹å­ä½¿ç”¨çš„å°±æ˜¯ "),t("strong",[s._v("Influx")]),s._v(" è¾“å‡ºæ ¼å¼, è¿™ä¸ªæ ¼å¼æ¯”è¾ƒç®€å•, å‰é¢å·²ç»è¯¦ç»†ä»‹ç»è¿‡äº†, è¿™é‡Œå°±ä¸å†èµ˜è¿°. å½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨ Prometheus çš„æ ¼å¼æˆ– Falcon çš„æ ¼å¼. æŠŠè¿™ä¸ªè„šæœ¬çš„è·¯å¾„é…ç½®åˆ° exec.toml ä¸­, Categraf å°±ä¼šå‘¨æœŸæ€§åœ°æ‰§è¡Œè¿™ä¸ªè„šæœ¬, é‡‡é›†è¿™ä¸¤ä¸ªç›®å½•çš„å¤§å°äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/38a4ab67bb925eca00cba12e75794804-20230719203435-ww9059o.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("Categraf é‡Œä¸€äº›å¸¸è§çš„è·Ÿæœºå™¨ç›¸å…³çš„æ’ä»¶åŠé‡ç‚¹å…³æ³¨çš„æŒ‡æ ‡å°±ä»‹ç»å®Œäº†, æ€»ç»“ä¸€ä¸‹å¦‚ä¸Šé¢çš„è¡¨æ ¼æ‰€ç¤º.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-10"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-10"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚é‡ç‚¹ä»‹ç»äº†æœºå™¨ç›‘æ§, æœºå™¨ç›‘æ§çš„æ‰‹æ®µæœ‰ä¸¤ç§, "),t("strong",[s._v("åŸºäº Agent çš„è¿™ç§ç›‘æ§æ‰‹æ®µèµ°çš„æ˜¯å¸¦å†…ä¸šåŠ¡ç½‘ç»œ, ä¹Ÿå°±æ˜¯å¸¦å†…ç›‘æ§, è¿™ç§æ–¹å¼æœ€ä¸ºå¸¸ç”¨")]),s._v("; å¦å¤–ä¸€ç§æœºå™¨ç›‘æ§æ‰‹æ®µæ˜¯å¸¦å¤–ç›‘æ§, èµ°çš„æ˜¯å¸¦å¤–ç½‘ç»œ. ç°åœ¨å·²ç»æ˜¯äº‘æ—¶ä»£, å°±ç®—ä¸äº†è§£å¸¦å¤–ç›‘æ§, ä¹Ÿæ²¡å…³ç³».")]),s._v(" "),t("p",[t("strong",[s._v("ä½¿ç”¨ Categraf ä½œä¸ºé‡‡é›†å™¨")]),s._v(", æŠŠ Categraf é‡Œå¸¸è§çš„æœºå™¨ç›‘æ§æ’ä»¶éƒ½ä»‹ç»äº†ä¸€ä¸‹, è¿™äº›æ’ä»¶å¯ä»¥æå®šæœºå™¨å¸¸è§„æŒ‡æ ‡çš„é‡‡é›†. æ¯”å¦‚ cpu æ’ä»¶å¯ä»¥ç›‘æ§ CPU çš„ä½¿ç”¨ç‡, mem æ’ä»¶å¯ä»¥ç”¨æ¥ç›‘æ§å†…å­˜çš„å¯ç”¨ç‡, disk æ’ä»¶å¯ä»¥ç”¨æ¥ç›‘æ§ç©ºé—´ä½¿ç”¨ç‡, diskio æ’ä»¶å¯ä»¥é‡‡é›†ç¡¬ç›˜ IO ç›¸å…³çš„æŒ‡æ ‡, è¿˜æœ‰ exec å¯ä»¥ç”¨æ¥è‡ªå®šä¹‰ç›‘æ§è„šæœ¬, ç­‰ç­‰. æå®šè¿™äº›æ’ä»¶, æœºå™¨æ–¹é¢çš„ç›‘æ§ä¹Ÿå°±ä¸æˆé—®é¢˜äº†.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/yyb2dbda85b408350ccc0a57a0ae15cb-20230719203435-q2ib8ko.jpg",alt:"å›¾ç‰‡"}})]),s._v(" "),t("h3",{attrs:{id:"_12-ç½‘ç»œç›‘æ§-å¦‚ä½•ç›‘æ§ç½‘ç»œé“¾è·¯å’Œç½‘ç»œè®¾å¤‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-ç½‘ç»œç›‘æ§-å¦‚ä½•ç›‘æ§ç½‘ç»œé“¾è·¯å’Œç½‘ç»œè®¾å¤‡"}},[s._v("#")]),s._v(" 12.ç½‘ç»œç›‘æ§-å¦‚ä½•ç›‘æ§ç½‘ç»œé“¾è·¯å’Œç½‘ç»œè®¾å¤‡?")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº†æœºå™¨ç›‘æ§, æœºå™¨å±äºåŸºç¡€è®¾æ–½. é™¤äº†æœºå™¨ä¹‹å¤–, è¿˜æœ‰ä¸€ä¸ªå¸¸è§çš„åŸºç¡€è®¾æ–½, å°±æ˜¯"),t("strong",[s._v("ç½‘ç»œ")]),s._v(".")]),s._v(" "),t("p",[t("mark",[t("strong",[s._v("ç½‘ç»œç›‘æ§ä¸»è¦åŒ…æ‹¬ç½‘ç»œé“¾è·¯ç›‘æ§å’Œç½‘ç»œè®¾å¤‡ç›‘æ§")])]),s._v(", é€šå¸¸ç³»ç»Ÿè¿ç»´äººå‘˜ä¼šæ¯”è¾ƒå…³æ³¨. æœ¬èŠ‚æ¥çœ‹çœ‹å…¶ä¸­æ¶‰åŠäº†å“ªäº›å…³é”®æŠ€æœ¯å’Œå®è·µæ–¹æ³•.")]),s._v(" "),t("h4",{attrs:{id:"ç½‘ç»œé“¾è·¯ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘ç»œé“¾è·¯ç›‘æ§"}},[s._v("#")]),s._v(" ç½‘ç»œé“¾è·¯ç›‘æ§")]),s._v(" "),t("p",[t("mark",[s._v("**ç½‘ç»œé“¾è·¯ç›‘æ§ä¸»è¦åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†, ç½‘ç»œè¿é€šæ€§, ç½‘ç»œè´¨é‡, ç½‘ç»œæµé‡. **")])]),s._v(" "),t("p",[t("strong",[s._v("è¿é€šæ€§å’Œè´¨é‡çš„ç›‘æ§æ‰‹æ®µéå¸¸ç®€å•, å°±æ˜¯åœ¨é“¾è·¯ä¸€ä¾§éƒ¨ç½²æ¢é’ˆ, å»æ¢æµ‹é“¾è·¯å¦ä¸€ä¾§çš„ç›®æ ‡, é€šè¿‡ ICMP, TCP, HTTP ç­‰åè®®å‘é€æ¢æµ‹æ•°æ®åŒ…, åˆ†æå›åŒ…çš„ç»“æœ. å…¸å‹çš„æŒ‡æ ‡æœ‰ä¸¢åŒ…ç‡, å»¶è¿Ÿ, å›åŒ…æ˜¯å¦åŒ¹é…é¢„æœŸæ¡ä»¶ç­‰.")])]),s._v(" "),t("p",[s._v("ç½‘ç»œæµé‡ç›‘æ§, åˆ™å…³æ³¨æµé‡å¤§å°ä»¥åŠæµé‡å†…å®¹. æµé‡å¤§å°å¹¿æ³›åº”ç”¨äºæ°´ä½ç®¡ç†, æ¯”å¦‚æœºå™¨ç½‘å¡, äº¤æ¢æœºçš„æ¥å£, å¤–ç½‘å‡ºå£, ä¸“çº¿å¸¦å®½ç­‰, åŠæ—¶å‘ç°ç½‘ç»œç“¶é¢ˆ. åˆ†ææµé‡å†…å®¹, åˆ™å¯ä»¥è¯†åˆ«è¿‡åº¦è€—ç”¨å¸¦å®½çš„ç”¨æˆ·å’Œåº”ç”¨ç¨‹åº, éªŒè¯ç½‘ç»œ QoS ç­–ç•¥ç­‰.")]),s._v(" "),t("p",[s._v("è¿™ä¸€è®²ä½¿ç”¨ Categraf æ¥æ¼”ç¤ºä¸€ä¸‹å¸¸ç”¨"),t("strong",[s._v("æ¢é’ˆçš„é…ç½®æ–¹å¼")]),s._v(", è¿›è¡Œç½‘ç»œè¿é€šæ€§å’Œè´¨é‡ç›‘æ§. ç½‘ç»œæµé‡å¤§å°, å¯ä»¥ä½¿ç”¨ SNMP é‡‡é›†æ•°æ®, ç›¸å…³æ–¹æ³•ä¼šåœ¨åé¢ä»‹ç»ç½‘ç»œè®¾å¤‡ç›‘æ§æ—¶è®²è§£.")]),s._v(" "),t("h5",{attrs:{id:"_1-icmpæ¢æµ‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-icmpæ¢æµ‹"}},[s._v("#")]),s._v(" 1.ICMPæ¢æµ‹")]),s._v(" "),t("p",[s._v("Categraf çš„ ICMP æ¢æµ‹ä½¿ç”¨ Ping æ’ä»¶, ç›¸å…³é…ç½®åœ¨ "),t("code",[s._v("conf/input.ping/ping.toml")]),s._v("â€‹, ä¸»è¦æ˜¯é…ç½®è¦æ¢æµ‹çš„ç›®æ ‡åœ°å€, å¯ä»¥çœ‹çœ‹æ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntargets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.4.5.6"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.4.5.7"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlabels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("region")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cloud"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("product")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"n9e"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntargets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.4.5.8"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlabels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("region")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cloud"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("product")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zbx"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("ä¾‹å­ä¸­æ˜¯ Ping 3 ä¸ªåœ°å€, å…¶ä¸­æœ‰ä¸¤ä¸ªæœºå™¨æ˜¯ Nightingale äº§å“ä½¿ç”¨çš„, æœ‰ä¸€ä¸ªæœºå™¨æ˜¯ Zabbix äº§å“ä½¿ç”¨çš„, éƒ½ä½äº cloud è¿™ä¸ªåŒºåŸŸ(region)é‡Œ, æ‰€ä»¥æ‰“äº†ä¸åŒçš„æ ‡ç­¾æ¥ä¸°å¯Œå…¶ç»´åº¦ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("å¦‚æœè¦åŒæ—¶ Ping å¾ˆå¤šå°æœºå™¨, å°±ä¼šå ç”¨å¾ˆå¤šæ–‡ä»¶å¥æŸ„, éœ€è¦æå‰è°ƒå¤§ Categraf çš„æ–‡ä»¶å¥æŸ„é™åˆ¶. å¦‚æœæ˜¯ç”¨ systemd æ¥æ‰˜ç®¡, å¯ä»¥åœ¨ categraf.service æ–‡ä»¶ä¸­æ·»åŠ  LimitNOFILE é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitNOFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å¦ä¸€ä¸ªå‘æ˜¯ "),t("strong",[s._v("CAP")]),s._v(" é—®é¢˜, å¦‚æœä½¿ç”¨é root è´¦å·æ¥è¿è¡Œ Categraf, éœ€è¦åœ¨ categraf.service æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CapabilityBoundingSet")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CAP_NET_RAW\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AmbientCapabilities")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CAP_NET_RAW\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("**Ping æ’ä»¶å¯ä»¥é‡‡é›†åˆ°ç›®æ ‡æ˜¯å¦è¿é€š, å»¶è¿Ÿæ—¶é—´, ä¸¢åŒ…ç‡ç­‰æŒ‡æ ‡, å¯ä»¥æ®æ­¤åšç½‘ç»œé“¾è·¯çš„ç›‘æ§. æ¯”å¦‚æœºæˆ¿ä¸“çº¿çš„æ¢æµ‹, åªéœ€è¦åœ¨æŸä¸ªæœºæˆ¿éƒ¨ç½² Categraf, æ¥æ¢æµ‹å¦ä¸€ä¸ªæœºæˆ¿çš„è®¾å¤‡. **")]),s._v(" "),t("p",[s._v("æœ€åæ˜¯ "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/tree/main/inputs/ping",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä»ªè¡¨ç›˜å’Œå‘Šè­¦è§„åˆ™"),t("OutboundLink")],1),s._v(", dashboard.json æ˜¯ä»ªè¡¨ç›˜é…ç½®, alerts.json æ˜¯å‘Šè­¦è§„åˆ™é…ç½®, å¯¼å…¥å¤œèºå°±å¯ä»¥ä½¿ç”¨. å¦‚æœæ˜¯ç›´æ¥ä½¿ç”¨çš„ Prometheus, ä¹Ÿå¯ä»¥å‚è€ƒ JSON æ–‡ä»¶ä¸­çš„ PromQL, å¹¶å°†å…¶æ”¹é€ æˆ Prometheus yaml é…ç½®.")]),s._v(" "),t("h5",{attrs:{id:"_2-tcpæ¢æµ‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-tcpæ¢æµ‹"}},[s._v("#")]),s._v(" 2.TCPæ¢æµ‹")]),s._v(" "),t("p",[s._v("å¾ˆå¤šæ—¶å€™æœºå™¨æ˜¯"),t("strong",[s._v("ç¦ Ping")]),s._v(" çš„, æ­¤æ—¶ TCP æ¢æµ‹å°±æ´¾ä¸Šç”¨åœºäº†. TCP æ¢æµ‹ç”¨çš„æ˜¯ Categraf çš„ net_response æ’ä»¶, é…ç½®æ–‡ä»¶åœ¨ "),t("code",[s._v("conf/input.net_response/net_response.toml")]),s._v("â€‹. å®é™…è¿™ä¸ªæ’ä»¶æ—¢å¯ä»¥æ¢æµ‹ TCP çš„å“åº”, ä¹Ÿå¯ä»¥æ¢æµ‹ UDP çš„å“åº”. é…ç½®ä¸­æœ€æ ¸å¿ƒçš„æ˜¯ targets éƒ¨åˆ†, æŒ‡å®šæ¢æµ‹çš„ç›®æ ‡, ä¾‹å­å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntargets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.2.3.4:22"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:6379"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":9090"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("â€‹"),t("code",[s._v("10.2.3.4:22")]),s._v("â€‹ è¡¨ç¤ºæ¢æµ‹ 10.2.3.4 è¿™ä¸ªæœºå™¨çš„ 22 ç«¯å£æ˜¯å¦å¯ä»¥è¿é€š.")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v("localhost:6379")]),s._v("â€‹ è¡¨ç¤ºæ¢æµ‹æœ¬æœºçš„ 6379 ç«¯å£æ˜¯å¦å¯ä»¥è¿é€š.")]),s._v(" "),t("li",[s._v("â€‹"),t("code",[s._v(":9090")]),s._v("â€‹ è¡¨ç¤ºæ¢æµ‹æœ¬æœºçš„ 9090 ç«¯å£æ˜¯å¦å¯ä»¥è¿é€š, æ²¡æœ‰å†™ IP æˆ–ä¸»æœºåçš„å°±é»˜è®¤ä½¿ç”¨ localhost.")])]),s._v(" "),t("p",[s._v("åŸç†ä¹Ÿå¾ˆç®€å•, å°±æ˜¯ Categraf å‘ç›®æ ‡åœ°å€å‘èµ·ç½‘ç»œè¿æ¥. å¦‚æœèƒ½è¿é€š, å°±è®¤ä¸ºæ˜¯æ­£å¸¸çš„, æŒ‡æ ‡å€¼ä¸ŠæŠ¥ä¸º 0, å¦‚æœå¤±è´¥å°±æ˜¯é 0 çš„å€¼. ç›‘æ§æŒ‡æ ‡åå­—æ˜¯ net_response_result_code.")]),s._v(" "),t("p",[s._v("å¦‚æœæ˜¯ UDP çš„ç«¯å£, æ˜¯æ— æ³•å‘èµ·è¿æ¥æ¢æµ‹çš„. æ­¤æ—¶é‡‡ç”¨å†…å®¹åŒ¹é…æ¢æµ‹, å³é€šè¿‡ UDP å‘ä¸ªå­—ç¬¦ä¸²ç»™æ¢æµ‹ç›®æ ‡, ç†è®ºä¸Šæ¢æµ‹ç›®æ ‡å¾ˆå¿«å°±ä¼šç»™å‡ºå›å¤. æ£€æŸ¥å›å¤å†…å®¹, å¦‚æœå›å¤å†…å®¹åŒ…å«ç‰¹å®šå­—ç¬¦ä¸², å°±è¡¨ç¤ºæ¢æµ‹ç›®æ ‡æ´»ç€. ç›¸å…³é…ç½®æ˜¯ send å’Œ expect å­—æ®µ, é…ç½®æ ·ä¾‹å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## The following options are required for UDP checks. For TCP, they are")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## optional. The plugin will send the given string to the server and then")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## expect to receive the given 'expect' string back.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## string sent to the server")]),s._v("\nsend "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ping"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## expected string in answer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pong"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("net_response æ’ä»¶ä¹Ÿå†…ç½®äº†ä»ªè¡¨ç›˜å’Œå‘Šè­¦è§„åˆ™, å¯ä»¥åœ¨ "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/tree/main/inputs/net_response",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä»£ç ç›®å½•"),t("OutboundLink")],1),s._v(" ä¸­æ‰¾åˆ°, å¯¼å…¥å¤œèºå°±å¯ä»¥ä½¿ç”¨.")]),s._v(" "),t("h5",{attrs:{id:"_3-httpæ¢æµ‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-httpæ¢æµ‹"}},[s._v("#")]),s._v(" 3.HTTPæ¢æµ‹")]),s._v(" "),t("p",[s._v("HTTP æ¢æµ‹å’Œ TCP çš„æ¢æµ‹é€»è¾‘å‡ ä¹å®Œå…¨ä¸€è‡´, åªä¸è¿‡ HTTP æ˜¯ä¸ƒå±‚åè®®, Categraf å¯ä»¥è§£æåˆ° Status code, Response body è¿™äº›æ›´ç»†ç²’åº¦çš„ä¿¡æ¯. ç›¸å…³é…ç½®åœ¨ "),t("code",[s._v("conf/input.http_response/http_response.toml")]),s._v("â€‹, ä¸€ä¸ªé…ç½®æ ·ä¾‹å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntargets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://www.baidu.com"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("å¾ˆå¤šå…¬å¸éƒ½ä¼šåœ¨æ‰€æœ‰çš„æœºå™¨ä¸Šéƒ¨ç½² Agent, Agent ä¼šå¼€ä¸€ä¸ª HTTP ç«¯å£, è¿™æ ·å°±å¯ä»¥é€šè¿‡æ¢æµ‹è¿™äº› HTTP ç«¯å£, çŸ¥é“ Agent æ˜¯å¦å­˜æ´», è¿›è€Œåæ¨æœºå™¨çš„å­˜æ´»æ€§.")]),s._v(" "),t("p",[s._v("HTTP æ’ä»¶å¯ä»¥å¯¹è¿”å›çš„ Response åšè§„åˆ™åŒ¹é…, æ¯”å¦‚åˆ¤æ–­ Response body ä¸­æ˜¯å¦åŒ…å«ç‰¹å®šçš„å­—ç¬¦ä¸², æˆ–è€… Status code æ˜¯å¦æ˜¯æŒ‡å®šçš„å€¼ç­‰, å¯ä»¥çœ‹ä¸‹ç›¸å…³é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Optional substring match in body of the response (case sensitive)")]),s._v("\nexpect_response_substring "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ok"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Optional expected response status code.")]),s._v("\nexpect_response_status_code "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("å¦‚æœç›®æ ‡åœ°å€æ˜¯ HTTPS çš„, Categraf ä¹Ÿä¼šè‡ªåŠ¨æ£€æŸ¥è¯ä¹¦è¿‡æœŸæ—¶é—´, æŒ‡æ ‡åæ˜¯ cert_expire_timestamp, è¯ä¹¦è¿‡æœŸæ—¶é—´ä¸€å®šè¦è®°å¾—åŠ ä¸ªå‘Šè­¦è§„åˆ™, å¾ˆå¤šå…¬å¸å‘ç”Ÿè¿‡å› ä¸ºè¯ä¹¦è¿‡æœŸè€Œå¯¼è‡´çº¿ä¸Šæ•…éšœ.")]),s._v(" "),t("p",[s._v("ç½‘ç»œé“¾è·¯çš„å‡ ç§æ¢æµ‹æ–¹å¼å°±è®²åˆ°è¿™é‡Œ, ä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹ç½‘ç»œä¸­çš„"),t("strong",[s._v("èŠ‚ç‚¹, ç½‘ç»œè®¾å¤‡çš„ç›‘æ§")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"ç½‘ç»œè®¾å¤‡ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘ç»œè®¾å¤‡ç›‘æ§"}},[s._v("#")]),s._v(" ç½‘ç»œè®¾å¤‡ç›‘æ§")]),s._v(" "),t("p",[s._v("ç½‘ç»œè®¾å¤‡ç›‘æ§çš„å…¸å‹æ‰‹æ®µæœ‰ä¸‰ä¸ª, "),t("strong",[s._v("ä¸€ä¸ªæ˜¯ Ping ç›‘æ§")]),s._v(", æ¢æµ‹æ˜¯å¦å­˜æ´», åˆšåˆšå·²ç»ä»‹ç»è¿‡äº†. "),t("strong",[s._v("å¦ä¸€ä¸ªæ˜¯é€šè¿‡ SNMP è·å–æŒ‡æ ‡")]),s._v(", æ¯”å¦‚å„ä¸ªç½‘å£çš„çŠ¶æ€, æµé‡, åŒ…é‡ç­‰. "),t("strong",[s._v("æœ€åä¸€ä¸ªæ˜¯ SNMP Trap")]),s._v(", ä¸€èˆ¬ç½‘ç»œè®¾å¤‡æœ‰é—®é¢˜, éƒ½ä¼šå‘å‡º Trap æ¶ˆæ¯, è¿™äº› Trap æ¶ˆæ¯å¾ˆæœ‰ä»·å€¼, åˆ†æè¿™äº› Trap æ¶ˆæ¯æ˜¯å¸¸ç”¨ä¸”æœ‰æ•ˆçš„ç›‘æ§æ‰‹æ®µ. å…ˆæ¥çœ‹ä¸€ä¸‹ SNMP è·å–æŒ‡æ ‡çš„æ–¹å¼.")]),s._v(" "),t("h5",{attrs:{id:"_1-snmpæŒ‡æ ‡è·å–æ–¹å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-snmpæŒ‡æ ‡è·å–æ–¹å¼"}},[s._v("#")]),s._v(" 1.SNMPæŒ‡æ ‡è·å–æ–¹å¼")]),s._v(" "),t("p",[s._v("è¦é‡‡é›†ç½‘ç»œè®¾å¤‡çš„ç›‘æ§æŒ‡æ ‡, ä¸€å®šè¦äº†è§£ SNMP åè®®. è¿™ä¸ªå†…å®¹æ¯”è¾ƒå¤š, å¯ä»¥ç»“åˆ "),t("a",{attrs:{href:"https://flashcat.cloud/blog/snmp-introduction/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ã€ŠSNMP(ç®€å•ç½‘ç»œç®¡ç†åè®®)ç®€ä»‹ã€‹"),t("OutboundLink")],1),s._v("æ¥ç†è§£. ç®€å•æ¥è®², å°±æ˜¯äº¤æ¢æœºä¸Šæœ‰ä¸ªç»„ä»¶å« SNMP agent(å³ snmpd), ç›‘å¬ UDP 161 ç«¯å£, æä¾›æŸ¥è¯¢æœåŠ¡. SNMP manager, æ¯”å¦‚ Categraf, å¯ä»¥å‘ SNMP agent å‘èµ·æŸ¥è¯¢è¯·æ±‚, ä¼ å…¥çš„å‚æ•°æ˜¯ OID, SNMP agent è¿”å› OID å¯¹åº”çš„ç›‘æ§æ•°æ®.")]),s._v(" "),t("p",[s._v("Categraf æä¾›äº† SNMP æ’ä»¶, é…ç½®æ–‡ä»¶åœ¨ "),t("code",[s._v("conf/input.snmp/snmp.toml")]),s._v("â€‹, æ ¸å¿ƒé…ç½®å°±æ˜¯ SNMP agent çš„è¿æ¥åœ°å€ä»¥åŠè¦é‡‡é›†çš„ OID åˆ—è¡¨.")]),s._v(" "),t("p",[s._v("ä¸¾ä¸ªä¾‹å­.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("interval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nagents "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"udp://172.30.15.189:161"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5s"')]),s._v("\nversion "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\ncommunity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public"')]),s._v("\nagent_host_tag "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ident"')]),s._v("\nretries "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.field"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\noid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RFC1213-MIB::sysUpTime.0"')]),s._v("\nname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uptime"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.field"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\noid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RFC1213-MIB::sysName.0"')]),s._v("\nname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),s._v("\nis_tag "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.table"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\noid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IF-MIB::ifTable"')]),s._v("\nname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"interface"')]),s._v("\ninherit_tags "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.table.field"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\noid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IF-MIB::ifDescr"')]),s._v("\nname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ifDescr"')]),s._v("\nis_tag "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("ä¾‹å­ä¸­, é…ç½®çš„äº¤æ¢æœºåœ°å€æ˜¯ 172.30.15.189, è®¤è¯ç‰ˆæœ¬æ˜¯ version 2, è®¤è¯å›¢ä½“åæ˜¯ public. å¦‚æœæ˜¯ v3 ç‰ˆæœ¬, å¯èƒ½å’Œä¸‹é¢çš„è®¤è¯é…ç½®å·®ä¸å¤š.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("version "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nsec_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"managev3user"')]),s._v("\nauth_protocol "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SHA"')]),s._v("\nauth_password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example.Demo.c0m"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("è¦é‡‡é›†å“ªäº›æŒ‡æ ‡, æ˜¯é€šè¿‡ OID å­—æ®µæ¥æŒ‡å®šçš„, instances.field æœ‰ä¸¤ä¸ª, ä¸€ä¸ªæ˜¯è·å–ç³»ç»Ÿå¯åŠ¨æ—¶é—´(OID æ˜¯ RFC1213-MIB::sysUpTime.0), ä¸€ä¸ªæ˜¯è·å–ç³»ç»Ÿåç§°(OID æ˜¯ RFC1213-MIB::sysName.0), è¿™ä¸¤ä¸ª OID éƒ½æ˜¯ Scalar ç±»å‹, å¯ä»¥ä½¿ç”¨ snmpget è¿›è¡Œæµ‹è¯•.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("snmpget "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v2c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" public "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.30")]),s._v(".15.189 RFC1213-MIB::sysUpTime.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v('å› ä¸º name = "uptime" è¿™ä¸ªé…ç½®, æŒ‡æ ‡ä¼šå‘½åæˆ snmp_uptime, snmp æ˜¯æ’ä»¶å‰ç¼€, uptime å°±æ˜¯ name å­—æ®µæŒ‡å®šçš„. çœ‹èµ·æ¥æŒºé¡ºç•…, ä½†æ˜¯ä¸ºä»€ä¹ˆ sysName è¿™ä¸ª field å¤šäº†ä¸€ä¸ª is_tag = true çš„é…ç½®å‘¢? å› ä¸º sysName æ˜¯ä¸ªå­—ç¬¦ä¸², ä¸æ˜¯è¦ä¸ŠæŠ¥çš„ç›‘æ§æ•°æ®, å®ƒä¼šä½œä¸ºä¸€ä¸ªæ ‡ç­¾ source=$sysName é™„åˆ°æ‰€æœ‰æ—¶åºæ•°æ®ä¸Š.')]),s._v(" "),t("p",[s._v("instances.table éƒ¨åˆ†é‡‡é›†çš„æ˜¯ Table ç±»å‹çš„æ•°æ®, Table çš„ OID æ˜¯ IF-MIB::ifTable, Table é‡Œæœ‰å¤šåˆ—æ•°æ®å’Œç´¢å¼•, Categraf ä¼šè‡ªåŠ¨è·å– Table ä¸­æ‰€æœ‰çš„ç´¢å¼•å­—æ®µ, åšæˆæ—¶åºæ•°æ®çš„æ ‡ç­¾, è¿˜ä¼šè‡ªåŠ¨è·å–æ‰€æœ‰çš„æ•°æ®åˆ—, ä½œä¸ºæŒ‡æ ‡ä¸ŠæŠ¥. ä½†æ˜¯æœ‰äº›åˆ—å¯èƒ½ä¸æ˜¯æ•°å€¼, æ¯”å¦‚ ifDescr å°±æ˜¯å­—ç¬¦ä¸², è¿™ä¸ªåˆ—æ— éœ€ä½œä¸ºæŒ‡æ ‡ä¸ŠæŠ¥, ä½œä¸ºæ ‡ç­¾ä¸ŠæŠ¥æ›´åˆé€‚, æ‰€ä»¥æœ‰ä¸ª is_tag=true çš„é…ç½®. inherit_tags è¡¨ç¤ºç»§æ‰¿ä¸‹æ¥çš„æ ‡ç­¾, ifTable æ”¶é›†åˆ°çš„æ•°æ®å°±ä¼šè‡ªåŠ¨é™„ä¸Š source æ ‡ç­¾.")]),s._v(" "),t("p",[s._v("ifTable å¯ä»¥æ‹¿åˆ°å„ä¸ªç½‘å£çš„å‡ºå…¥å‘æµé‡, åŒ…é‡ç­‰, å¯¹åšå®¹é‡ç›‘æ§å¾ˆæœ‰å¸®åŠ©, å½“ç„¶ä¹Ÿå¯ä»¥æ‹¿åˆ°é”™åŒ…, ä¸¢åŒ…çš„æƒ…å†µ, è¿™äº›éƒ½æ˜¯å¾ˆé‡è¦çš„ç›‘æ§æŒ‡æ ‡. è¿™é‡Œè´´å‡ æ¡ç›‘æ§æ•°æ®, å¯ä»¥æœ‰ä¸€ä¸ªç›´è§‚çš„è®¤è¯†.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":01:36 snmp_interface_ifInNUcastPkts "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prober01 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ident")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.30")]),s._v(".15.189 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ifIndex")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SW01 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":01:36 snmp_interface_ifInErrors "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prober01 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ident")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.30")]),s._v(".15.189 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ifIndex")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SW01 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":01:36 snmp_interface_ifOutDiscards "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prober01 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ident")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.30")]),s._v(".15.189 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ifIndex")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SW01 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":01:36 snmp_interface_ifOutErrors "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agent_hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prober01 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ident")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.30")]),s._v(".15.189 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ifIndex")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SW01 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("é™¤äº†è·å–æŒ‡æ ‡ä¹‹å¤–, SNMP Trap ä¹Ÿæ˜¯å¾ˆå…³é”®çš„ç›‘æ§æ‰‹æ®µ, **SNMP æŒ‡æ ‡ç›‘æ§æ˜¯è½®è¯¢å¼, å®šæœŸé‡‡é›†, è€Œ Trap æ˜¯åªè¦æœ‰æ¶ˆæ¯å°±è‡ªåŠ¨é€šçŸ¥, å³æ—¶æ€§æ›´å¥½. ** ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ Trap çš„ç›¸å…³æŠ€æœ¯æ–¹æ¡ˆ.")]),s._v(" "),t("h5",{attrs:{id:"_2-snmp-trap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-snmp-trap"}},[s._v("#")]),s._v(" 2.SNMP Trap")]),s._v(" "),t("p",[s._v("ä¸ SNMP é‡‡é›†æŒ‡æ ‡çš„æ–¹å¼ä¸åŒ, Trap æ¶ˆæ¯æ˜¯ç”±äº¤æ¢æœºé‡Œçš„ SNMP agent å‘æ¶ˆæ¯ç»™ SNMP manager(ä¹Ÿæ˜¯èµ°çš„ UDP åè®®), ä¸æŒ‡æ ‡é‡‡é›†çš„æ•°æ®æµå‘ç›¸å. ç›®å‰ Categraf å°šä¸æ”¯æŒ Trap æ¶ˆæ¯æ¥æ”¶, å¯ä»¥å…ˆç”¨ Telegraf çš„ snmp_trap æ’ä»¶åšæµ‹è¯•.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/76d4a3ccc578339427e36d5f5db03d09-20230719203435-d9cu60r.jpg",alt:""}})]),s._v(" "),t("p",[s._v("ç”¨ Trap æœºåˆ¶åšäº‹ä»¶ç›‘æ§æ˜¯æ¯”è¾ƒä¾¿æ·çš„æ–¹å¼, äº¤æ¢æœºå‡ºç°å…³é”®é—®é¢˜çš„æ—¶å€™, éƒ½ä¼šç«‹åˆ»å‘å‡º Trap æ¶ˆæ¯. åªè¦åœ¨ Trap Receiver ä¸­é…ç½®æ¶ˆæ¯åŒ¹é…è§„åˆ™, æŒ‡å®šä»€ä¹ˆæ ·çš„æ¶ˆæ¯åº”è¯¥äº§ç”Ÿå‘Šè­¦å³å¯. ä½†æ˜¯, åŒ¹é…è§„åˆ™è‚¯å®šæ˜¯éœ€è¦ç”¨äººç±»æ˜“è¯»çš„æ–¹å¼, è¿™å°±éœ€è¦å€ŸåŠ© MIB åº“, æŠŠ Trap ä¸­çš„ OID ç¿»è¯‘æˆäººç±»æ˜“è¯»çš„å­—ç¬¦ä¸². ä¸ç¿»è¯‘çš„è¯, åŸå§‹çš„ Trap æ¶ˆæ¯å¯èƒ½æ˜¯è¿™æ ·çš„, å¾ˆéš¾è¯»æ‡‚.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"TrapType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"OID"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Other"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Community"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Username"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Address"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.16.1.64:49692"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"VarBinds"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('".1.3.6.1.2.1.1.3.0"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7908527690000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('".1.3.6.1.2.1.2.2.1.1.18"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('".1.3.6.1.2.1.2.2.1.2.18"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Vlanif103"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('".1.3.6.1.2.1.2.2.1.7.18"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('".1.3.6.1.2.1.2.2.1.8.18"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('".1.3.6.1.6.3.1.1.4.1.0"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"VarBindOIDs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".1.3.6.1.2.1.1.3.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".1.3.6.1.6.3.1.1.4.1.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".1.3.6.1.2.1.2.2.1.1.18"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".1.3.6.1.2.1.2.2.1.7.18"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".1.3.6.1.2.1.2.2.1.8.18"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".1.3.6.1.2.1.2.2.1.2.18"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("h4",{attrs:{id:"å°ç»“-11"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-11"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»ç½‘ç»œé“¾è·¯å’Œç½‘ç»œè®¾å¤‡ä¸¤ä¸ªæ–¹é¢ä»‹ç»äº†ç½‘ç»œç›‘æ§çš„æ–¹æ³•.")]),s._v(" "),t("p",[t("strong",[s._v("ç½‘ç»œé“¾è·¯ç›‘æ§")]),s._v(", åŒ…æ‹¬è¿é€šæ€§å’Œè´¨é‡ç›‘æ§, æµé‡å’Œå†…å®¹ç›‘æ§, å…¸å‹çš„æ¢æµ‹åè®®æ˜¯ ICMP, TCP, HTTP. Categraf æœ‰å¯¹åº”çš„é‡‡é›†æ’ä»¶å¯ä»¥ä½¿ç”¨, Prometheus ç”Ÿæ€çš„ Blackbox-Exporter ä¹Ÿå¯ä»¥åšè¿™ä¸ªäº‹æƒ….")]),s._v(" "),t("p",[s._v("ç½‘è·¯æµé‡åŒ…å«å¤šä¸ªæ–¹é¢, æ¯”å¦‚æœºå™¨ç½‘å¡æ˜¯å¦è·‘æ»¡, å¯ä»¥ç”¨ Categraf é‡‡é›†ç½‘å¡æµé‡æ•°æ®, è€Œäº¤æ¢æœºçš„ç½‘å£æµé‡éœ€è¦ç”¨ SNMP åè®®è·å–. ç½‘ç»œå†…å®¹ç›‘æ§, å¯ä»¥ä½¿ç”¨ NetFlow, J-Flow, sFlow, NetStream, IPFIX ç­‰æ‰‹æ®µ, æ‰¾å‡ºå ç”¨å¸¦å®½æœ€å¤šçš„ç”¨æˆ·, åº”ç”¨ç¨‹åºå’Œåè®®.")]),s._v(" "),t("p",[t("strong",[s._v("ç½‘ç»œè®¾å¤‡ç›‘æ§")]),s._v(", ç”¨é€”å¾ˆå¹¿æ³›, é™¤äº†äº¤æ¢æœº, è·¯ç”±å™¨å¤–, UPS, æ‰“å°æœº, å­˜å‚¨ç­‰éƒ½æ”¯æŒ SNMP åè®®, å¯ä»¥é€šè¿‡ SNMP è·å–åˆ°è®¾å¤‡çš„å„ç§ç›‘æ§æŒ‡æ ‡. ä¸è¿‡è¦æ³¨æ„, å¯¹äºä¸€äº›è€å¼äº¤æ¢æœº, SNMP é‡‡é›†ä¸èƒ½å¤ªé¢‘ç¹, ä¸ç„¶æœ‰å¯èƒ½å½±å“äº¤æ¢æœºçš„æ€§èƒ½.")]),s._v(" "),t("p",[s._v("å¦ä¸€ä¸ªç½‘ç»œè®¾å¤‡ç›‘æ§æ‰‹æ®µå°±æ˜¯ Trap äº†, é€šè¿‡ SNMP agent ä¸»åŠ¨å‘æ¶ˆæ¯ç»™ SNMP manager, å³æ—¶æ€§å¾ˆå¥½, åªè¦å†™ä¸€ä¸ª Trap Receiver, åšåè®®ç¿»è¯‘å’Œè§„åˆ™åŒ¹é…, å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç›‘æ§æ‰‹æ®µ. ä¸è¿‡è¿™ä¸ªæ–¹å‘ç¡®å®æ˜¯éå¸¸ç»†åˆ†çš„é¢†åŸŸ, ç›®å‰è¿˜æ²¡æœ‰çœ‹åˆ°ç›¸å…³çš„å¼€æºäº§å“.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚çš„æ€ç»´å¯¼å›¾:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/78444e966a71be9f7877eb7ef44f5aeb-20230719203435-v92onyt.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_13-ç»„ä»¶ç›‘æ§-mysqlçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13-ç»„ä»¶ç›‘æ§-mysqlçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›"}},[s._v("#")]),s._v(" 13.ç»„ä»¶ç›‘æ§-MySQLçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›?")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚è¿›å…¥æ•°æ®åº“ä¸­é—´ä»¶ç›‘æ§å®æˆ˜ç¯èŠ‚. è¿™äº›ç»„ä»¶é‡Œæœ€å¸¸ç”¨çš„é MySQL è«å±, è¿™ä¸€è®²å°±æ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•ç›‘æ§ MySQL. å­¦å®Œæœ¬èŠ‚å°±çŸ¥é“ MySQL ä¸­å“ªäº›æŒ‡æ ‡æ¯”è¾ƒå…³é”®ä»¥åŠå¦‚ä½•é‡‡é›†è¿™äº›æŒ‡æ ‡äº†. é€šè¿‡è¿™äº›æŒ‡æ ‡èƒ½å¤Ÿææ—©å‘ç°é—®é¢˜, æå‡æ•°æ®åº“çš„å¯ç”¨æ€§.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1c26d8db1e861c007a1a362db13ace61-20230719203435-hk9bqvf.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("h4",{attrs:{id:"æ•´ä½“æ€è·¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•´ä½“æ€è·¯"}},[s._v("#")]),s._v(" æ•´ä½“æ€è·¯")]),s._v(" "),t("p",[s._v("é¦–å…ˆè¦å…ˆç†æ¸…ä¸¤ä¸ªé—®é¢˜: "),t("strong",[s._v("ç›‘æ§å“ªç±»æŒ‡æ ‡? å¦‚ä½•é‡‡é›†æ•°æ®?")]),s._v("  å‰é¢ç³»ç»Ÿåœ°ä»‹ç»è¿‡ç›‘æ§æ–¹æ³•è®º, è¿™äº›æ–¹æ³•è®ºåº”è¯¥å¦‚ä½•è½åœ°å‘¢? æœ¬èŠ‚å°±å¯ä»¥åœ¨ MySQL ä¸­åº”ç”¨èµ·æ¥. MySQL æ˜¯ä¸ªæœåŠ¡, æ‰€ä»¥å¯ä»¥å€Ÿç”¨ Google å››ä¸ªé»„é‡‘æŒ‡æ ‡çš„æ€è·¯æ¥è§£å†³é—®é¢˜. ä¸‹é¢ä¸€èµ·æ¢³ç†ä¸€ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/fb5a50e976687376703a0b44c3166344-20230719203435-vdlfzht.jpg",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"_1-å»¶è¿Ÿ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å»¶è¿Ÿ"}},[s._v("#")]),s._v(" 1.å»¶è¿Ÿ")]),s._v(" "),t("p",[s._v("åº”ç”¨ç¨‹åºä¼šå‘ MySQL å‘èµ· SELECT, UPDATE ç­‰æ“ä½œ, å¤„ç†è¿™äº›è¯·æ±‚èŠ±è´¹äº†å¤šä¹…, æ˜¯éå¸¸å…³é”®çš„, ç”šè‡³è¿˜æƒ³çŸ¥é“å…·ä½“æ˜¯å“ªä¸ª SQL æœ€æ…¢, è¿™æ ·å°±å¯ä»¥æœ‰é’ˆå¯¹æ€§åœ°è°ƒä¼˜. åº”è¯¥å¦‚ä½•é‡‡é›†è¿™äº›å»¶è¿Ÿæ•°æ®å‘¢? å…¸å‹çš„æ–¹æ³•æœ‰ä¸‰ç§.")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("åœ¨å®¢æˆ·ç«¯åŸ‹ç‚¹")]),s._v(". å³ä¸Šå±‚ä¸šåŠ¡ç¨‹åºåœ¨è¯·æ±‚ MySQL çš„æ—¶å€™, è®°å½•ä¸€ä¸‹æ¯ä¸ª SQL çš„è¯·æ±‚è€—æ—¶, æŠŠè¿™äº›æ•°æ®ç»Ÿä¸€æ¨ç»™ç›‘æ§ç³»ç»Ÿ, ç›‘æ§ç³»ç»Ÿå°±å¯ä»¥è®¡ç®—å‡ºå¹³å‡å»¶è¿Ÿ, 95 åˆ†ä½, 99 åˆ†ä½çš„å»¶è¿Ÿæ•°æ®äº†. ä¸è¿‡å› ä¸ºè¦åŸ‹ç‚¹, å¯¹ä¸šåŠ¡ä»£ç æœ‰ä¸€å®š"),t("strong",[s._v("ä¾µå…¥æ€§")]),s._v(".")]),s._v(" "),t("li",[t("strong",[s._v("Slow queries")]),s._v(". MySQL æä¾›äº†æ…¢æŸ¥è¯¢æ•°é‡çš„ç»Ÿè®¡æŒ‡æ ‡, é€šè¿‡ä¸‹é¢è¿™æ®µå‘½ä»¤å°±å¯ä»¥æ‹¿åˆ°.")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("show global status like 'Slow_queries';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| Slow_queries  | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("107")]),s._v("   |\n+---------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row in set ("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" sec)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("strong",[s._v("è¿™ä¸ªæŒ‡æ ‡æ˜¯ Counter ç±»å‹çš„, å³å•è°ƒé€’å¢")]),s._v(", å¦‚æœæƒ³çŸ¥é“æœ€è¿‘ä¸€åˆ†é’Ÿæœ‰å¤šå°‘æ…¢æŸ¥è¯¢, éœ€è¦ä½¿ç”¨ increase å‡½æ•°åšäºŒæ¬¡è®¡ç®—.")]),s._v(" "),t("p",[s._v("æ€ä¹ˆç®—æ…¢æŸ¥è¯¢å‘¢? å®é™…æ˜¯æœ‰ä¸€ä¸ªå…¨å±€å˜é‡çš„ long_query_time, é»˜è®¤æ˜¯ 10 ç§’, ä¸è¿‡ä¹Ÿå¯ä»¥è°ƒæ•´. æ¯å½“æŸ¥è¯¢æ—¶é—´è¶…è¿‡äº†  long_query_time æŒ‡å®šçš„æ—¶é—´, Slow_queries å°±ä¼š +1, å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µå‘½ä»¤è·å– long_query_time çš„å€¼.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("SHOW VARIABLES LIKE 'long_query_time';\n+-----------------+-----------+\n| Variable_name   | Value     |\n+-----------------+-----------+\n| long_query_time | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.000000")]),s._v(" |\n+-----------------+-----------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row in set ("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" sec)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[t("strong",[s._v("é€šè¿‡ performance schema å’Œ sys schema æ‹¿åˆ°ç»Ÿè®¡æ•°æ®")]),s._v(". æ¯”å¦‚ performance schema çš„ events_statements_summary_by_digest è¡¨, è¿™ä¸ªè¡¨æ•è·äº†å¾ˆå¤šå…³é”®ä¿¡æ¯, æ¯”å¦‚"),t("strong",[s._v("å»¶è¿Ÿ, é”™è¯¯é‡, æŸ¥è¯¢é‡")]),s._v(". çœ‹ä¸‹é¢çš„ä¾‹å­, SQL æ‰§è¡Œäº† 2 æ¬¡, å¹³å‡æ‰§è¡Œæ—¶é—´æ˜¯ 325 æ¯«ç§’, è¡¨é‡Œçš„æ—¶é—´åº¦é‡æŒ‡æ ‡éƒ½æ˜¯ä»¥çš®ç§’ä¸ºå•ä½.")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("*************************** "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". row ***************************\n                SCHEMA_NAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" employees\n                     DIGEST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 0c6318da9de53353a3a1bacea70b4fce\n                DIGEST_TEXT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SELECT * FROM `employees` WHERE `emp_no` > ?\n                 COUNT_STAR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n             SUM_TIMER_WAIT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("650358383000")]),s._v("\n             MIN_TIMER_WAIT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("292045159000")]),s._v("\n             AVG_TIMER_WAIT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("325179191000")]),s._v("\n             MAX_TIMER_WAIT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("358313224000")]),s._v("\n              SUM_LOCK_TIME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("520000000")]),s._v("\n                 SUM_ERRORS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n               SUM_WARNINGS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          SUM_ROWS_AFFECTED"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n              SUM_ROWS_SENT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("520048")]),s._v("\n          SUM_ROWS_EXAMINED"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("520048")]),s._v("\n...\n          SUM_NO_INDEX_USED"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     SUM_NO_GOOD_INDEX_USED"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                 FIRST_SEEN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-03")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\n                  LAST_SEEN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-03")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("é’ˆå¯¹å³æ—¶æŸ¥è¯¢, è¯Šæ–­é—®é¢˜çš„åœºæ™¯, è¿˜å¯ä»¥ä½¿ç”¨ sys schema, sys schema æä¾›äº†ä¸€ç§ç»„ç»‡è‰¯å¥½, äººç±»æ˜“è¯»çš„æŒ‡æ ‡æŸ¥è¯¢æ–¹å¼, æŸ¥è¯¢èµ·æ¥æ›´ç®€å•. æ¯”å¦‚å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•æ‰¾åˆ°æœ€æ…¢çš„ SQL. è¿™ä¸ªæ•°æ®åœ¨ statements_with_runtimes_in_95th_percentile è¡¨ä¸­.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("SELECT * FROM sys.statements_with_runtimes_in_95th_percentile;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æœæƒ³äº†è§£æ›´å¤šçš„ä¾‹å­, å¯ä»¥æŸ¥çœ‹ "),t("a",{attrs:{href:"https://github.com/mysql/mysql-sys",target:"_blank",rel:"noopener noreferrer"}},[s._v("sys schema çš„æ–‡æ¡£"),t("OutboundLink")],1),s._v(". ä¸è¿‡è¦æ³¨æ„çš„æ˜¯, MySQL ä» 5.7.7 ç‰ˆæœ¬å¼€å§‹, æ‰åŒ…å«äº† sys schema.")]),s._v(" "),t("h5",{attrs:{id:"_2-æµé‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æµé‡"}},[s._v("#")]),s._v(" 2.æµé‡")]),s._v(" "),t("p",[s._v("å…³äºæµé‡, æœ€è€³ç†Ÿèƒ½è¯¦çš„æ˜¯ç»Ÿè®¡ SELECT, UPDATE, DELETE, INSERT ç­‰è¯­å¥æ‰§è¡Œçš„æ•°é‡. å¦‚æœæµé‡å¤ªé«˜, è¶…è¿‡äº†ç¡¬ä»¶æ‰¿è½½èƒ½åŠ›, æ˜¾ç„¶æ˜¯éœ€è¦ç›‘æ§, éœ€è¦æ‰©å®¹çš„. è¿™äº›ç±»å‹çš„æŒ‡æ ‡åœ¨ MySQL çš„"),t("strong",[s._v("å…¨å±€å˜é‡")]),s._v("ä¸­éƒ½å¯ä»¥æ‹¿åˆ°. æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("show global status where Variable_name regexp 'Com_insert|Com_update|Com_delete|Com_select|Questions|Queries';\n+-------------------------+-----------+\n| Variable_name           | Value     |\n+-------------------------+-----------+\n| Com_delete              | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2091033")]),s._v("   |\n| Com_delete_multi        | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         |\n| Com_insert              | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8837007")]),s._v("   |\n| Com_insert_select       | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         |\n| Com_select              | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("226099709")]),s._v(" |\n| Com_update              | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24218879")]),s._v("  |\n| Com_update_multi        | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         |\n| Empty_queries           | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25455182")]),s._v("  |\n| Qcache_queries_in_cache | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         |\n| Queries                 | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("704921835")]),s._v(" |\n| Questions               | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("461095549")]),s._v(" |\n| Slow_queries            | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("107")]),s._v("       |\n+-------------------------+-----------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" rows in set ("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" sec)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("ä¾‹å­ä¸­çš„è¿™äº›æŒ‡æ ‡éƒ½æ˜¯ "),t("strong",[s._v("Counter ç±»å‹, å•è°ƒé€’å¢")]),s._v(", å¦å¤– Com_ æ˜¯ Command çš„å‰ç¼€, å³å„ç±»å‘½ä»¤çš„æ‰§è¡Œæ¬¡æ•°. "),t("strong",[s._v("æ•´ä½“ååé‡ä¸»è¦æ˜¯çœ‹ Questions æŒ‡æ ‡")]),s._v(", ä½† Questions å¾ˆå®¹æ˜“å’Œå®ƒä¸Šé¢çš„ Queries æ··æ·†. ä»ä¾‹å­é‡Œå¯ä»¥æ˜æ˜¾çœ‹å‡º Questions çš„æ•°é‡æ¯” Queries å°‘. Questions è¡¨ç¤ºå®¢æˆ·ç«¯å‘ç»™ MySQL çš„è¯­å¥æ•°é‡, è€Œ Queries è¿˜ä¼šåŒ…å«åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­æ‰§è¡Œçš„è¯­å¥, ä»¥åŠ PREPARE è¿™ç§å‡†å¤‡è¯­å¥, æ‰€ä»¥ç›‘æ§æ•´ä½“ååä¸€èˆ¬æ˜¯çœ‹ Questions.")]),s._v(" "),t("p",[t("strong",[s._v("æµé‡æ–¹é¢çš„æŒ‡æ ‡, ä¸€èˆ¬ä¼šç»Ÿè®¡å†™æ•°é‡(Com_insert + Com_update + Com_delete), è¯»æ•°é‡(Com_select), è¯­å¥æ€»é‡(Questions).")])]),s._v(" "),t("h5",{attrs:{id:"_3-é”™è¯¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-é”™è¯¯"}},[s._v("#")]),s._v(" 3.é”™è¯¯")]),s._v(" "),t("p",[s._v("é”™è¯¯é‡è¿™ç±»æŒ‡æ ‡æœ‰å¤šä¸ªåº”ç”¨åœºæ™¯, æ¯”å¦‚å®¢æˆ·ç«¯è¿æ¥ MySQL å¤±è´¥äº†, æˆ–è€…è¯­å¥å‘ç»™ MySQL, æ‰§è¡Œçš„æ—¶å€™å¤±è´¥äº†, éƒ½éœ€è¦æœ‰å¤±è´¥è®¡æ•°. å…¸å‹çš„é‡‡é›†æ‰‹æ®µæœ‰ä¸¤ç§.")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("åœ¨å®¢æˆ·ç«¯é‡‡é›†, åŸ‹ç‚¹")]),s._v(", ä¸ç®¡æ˜¯ MySQL çš„é—®é¢˜è¿˜æ˜¯ç½‘ç»œçš„é—®é¢˜, äº¦æˆ–è€…ä¸­é—´è´Ÿè½½å‡è¡¡çš„é—®é¢˜æˆ– DNS è§£æçš„é—®é¢˜, åªè¦è¿æ¥å¤±è´¥äº†, éƒ½å¯ä»¥å‘ç°. ç¼ºç‚¹ä¾ç„¶æ˜¯ä¼šæœ‰ä»£ç ä¾µå…¥æ€§.")]),s._v(" "),t("li",[t("strong",[s._v("ä» MySQL ä¸­é‡‡é›†ç›¸å…³é”™è¯¯")]),s._v(", æ¯”å¦‚è¿æ¥é”™è¯¯å¯ä»¥é€šè¿‡ Aborted_connects å’Œ Connection_errors_max_connections æ‹¿åˆ°.")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("show global status where Variable_name regexp 'Connection_errors_max_connections|Aborted_connects';\n+-----------------------------------+--------+\n| Variable_name                     | Value  |\n+-----------------------------------+--------+\n| Aborted_connects                  | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("785546")]),s._v(" |\n| Connection_errors_max_connections | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      |\n+-----------------------------------+--------+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("åªè¦è¿æ¥å¤±è´¥, ä¸ç®¡æ˜¯ä»€ä¹ˆåŸå› , Aborted_connects éƒ½ä¼š +1, è€Œæ›´å¸¸ç”¨çš„æ˜¯ Connection_errors_max_connections , å®ƒè¡¨ç¤ºè¶…è¿‡äº†æœ€å¤§è¿æ¥æ•°, æ‰€ä»¥ MySQL æ‹’ç»è¿æ¥. MySQL é»˜è®¤çš„æœ€å¤§è¿æ¥æ•°åªæœ‰ 151, åœ¨ç°åœ¨è¿™æ ·çš„ç¡¬ä»¶æ¡ä»¶ä¸‹, å®åœ¨æ˜¯å¤ªå°äº†, å› æ­¤å‡ºç°è¿™ç§æƒ…å†µçš„é¢‘ç‡æ¯”è¾ƒé«˜, éœ€è¦å¤šå¤šå…³æ³¨, åŠæ—¶å‘ç°è¿™ä¸€æƒ…å†µ.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("SHOW VARIABLES LIKE 'max_connections';\n+-----------------+-------+\n| Variable_name   | Value |\n+-----------------+-------+\n| max_connections | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("151")]),s._v("   |\n+-----------------+-------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row in set ("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" sec)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("å¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤æ¥è°ƒæ•´æœ€å¤§è¿æ¥æ•°.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SET GLOBAL max_connections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è™½ç„¶å¯ä»¥é€šè¿‡å‘½ä»¤ä¸´æ—¶è°ƒæ•´æœ€å¤§è¿æ¥æ•°, ä½†ä¸€æ—¦é‡å¯çš„è¯å°±å¤±æ•ˆäº†. ä¸ºäº†æ°¸ä¹…ä¿®æ”¹è¿™ä¸ªé…ç½®, éœ€è¦è°ƒæ•´ "),t("strong",[s._v("my.cnf")]),s._v(", åœ¨é‡Œé¢å¢åŠ è¿™ä¹ˆä¸€è¡Œå†…å®¹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("max_connections = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("åˆšåˆšåœ¨ä»‹ç»å»¶è¿ŸæŒ‡æ ‡çš„æ—¶å€™, æåˆ°äº† events_statements_summary_by_digest è¡¨, ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªè¡¨æ‹¿åˆ°é”™è¯¯æ•°é‡.")]),s._v(" "),t("p",[s._v("ä¸¾ä¸ªä¾‹å­.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("SELECT schema_name\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SUM(sum_errors) err_count\n  FROM performance_schema.events_statements_summary_by_digest\n WHERE schema_name IS NOT NULL\n GROUP BY schema_name;\n+--------------------+-----------+\n| schema_name        | err_count |\n+--------------------+-----------+\n| employees          |         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" |\n| performance_schema |         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" |\n| sys                |         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" |\n+--------------------+-----------+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h5",{attrs:{id:"_4-é¥±å’Œåº¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-é¥±å’Œåº¦"}},[s._v("#")]),s._v(" 4.é¥±å’Œåº¦")]),s._v(" "),t("p",[s._v('å¯¹äº MySQL è€Œè¨€, ç”¨ä»€ä¹ˆæŒ‡æ ‡æ¥åæ˜ èµ„æºæœ‰å¤š"æ»¡"å‘¢? é¦–å…ˆè¦å…³æ³¨ MySQL æ‰€åœ¨æœºå™¨çš„ '),t("strong",[s._v("CPU, å†…å­˜, ç¡¬ç›˜I/O, ç½‘ç»œæµé‡")]),s._v("è¿™äº›åŸºç¡€æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("MySQL æœ¬èº«ä¹Ÿæœ‰ä¸€äº›æŒ‡æ ‡æ¥åæ˜ é¥±å’Œåº¦, æ¯”å¦‚åˆšæ‰è®²åˆ°çš„è¿æ¥æ•°, å½“å‰è¿æ¥æ•°(Threads_connected)é™¤ä»¥æœ€å¤§è¿æ¥æ•°(max_connections)å¯ä»¥å¾—åˆ° "),t("strong",[s._v("è¿æ¥æ•°ä½¿ç”¨ç‡")]),s._v(", æ˜¯ä¸€ä¸ªéœ€è¦é‡ç‚¹ç›‘æ§çš„é¥±å’Œåº¦æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("å¦å¤–å°±æ˜¯ "),t("strong",[s._v("InnoDB Buffer pool")]),s._v(" ç›¸å…³çš„æŒ‡æ ‡, ä¸€ä¸ªæ˜¯ Buffer pool çš„ä½¿ç”¨ç‡, ä¸€ä¸ªæ˜¯ Buffer pool çš„å†…å­˜å‘½ä¸­ç‡. Buffer pool æ˜¯ä¸€å—å†…å­˜, ä¸“é—¨ç”¨æ¥ç¼“å­˜ Table, Index ç›¸å…³çš„æ•°æ®, æå‡æŸ¥è¯¢æ€§èƒ½. å¯¹ InnoDB å­˜å‚¨å¼•æ“è€Œè¨€, Buffer pool æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„è®¾è®¡.")]),s._v(" "),t("p",[s._v("ä¸‹é¢æŸ¥çœ‹ä¸€ä¸‹ Buffer pool ç›¸å…³çš„æŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("MariaDB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("(none)"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("> show global status like '%buffer%';\n+---------------------------------------+--------------------------------------------------+\n| Variable_name                         | Value                                            |\n+---------------------------------------+--------------------------------------------------+\n| Innodb_buffer_pool_dump_status        |                                                  |\n| Innodb_buffer_pool_load_status        | Buffer pool(s) load completed at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("220825")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" |\n| Innodb_buffer_pool_resize_status      |                                                  |\n| Innodb_buffer_pool_load_incomplete    | OFF                                              |\n| Innodb_buffer_pool_pages_data         | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5837")]),s._v("                                             |\n| Innodb_buffer_pool_bytes_data         | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("95633408")]),s._v("                                         |\n| Innodb_buffer_pool_pages_dirty        | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("                                               |\n| Innodb_buffer_pool_bytes_dirty        | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("524288")]),s._v("                                           |\n| Innodb_buffer_pool_pages_flushed      | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("134640371")]),s._v("                                        |\n| Innodb_buffer_pool_pages_free         | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1036")]),s._v("                                             |\n| Innodb_buffer_pool_pages_misc         | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1318")]),s._v("                                             |\n| Innodb_buffer_pool_pages_total        | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8191")]),s._v("                                             |\n| Innodb_buffer_pool_read_ahead_rnd     | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                                                |\n| Innodb_buffer_pool_read_ahead         | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("93316")]),s._v("                                            |\n| Innodb_buffer_pool_read_ahead_evicted | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("203")]),s._v("                                              |\n| Innodb_buffer_pool_read_requests      | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8667876784")]),s._v("                                       |\n| Innodb_buffer_pool_reads              | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("236654")]),s._v("                                           |\n| Innodb_buffer_pool_wait_free          | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("                                                |\n| Innodb_buffer_pool_write_requests     | "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("533520851")]),s._v("                                        |\n+---------------------------------------+--------------------------------------------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" rows in set ("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" sec)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("è¿™é‡Œæœ‰ 4 ä¸ªæŒ‡æ ‡é‡ç‚¹è®²ä¸€ä¸‹. "),t("strong",[s._v("Innodbbufferpoolpagestotal")]),s._v(" è¡¨ç¤º InnoDB Buffer pool çš„"),t("strong",[s._v("é¡µæ€»é‡")]),s._v(", é¡µ(page) æ˜¯ Buffer pool çš„ä¸€ä¸ªåˆ†é…å•ä½, é»˜è®¤çš„ page size æ˜¯ 16KB, å¯ä»¥é€šè¿‡ "),t("code",[s._v('show variables like "innodb_page_size"')]),s._v("â€‹ æ‹¿åˆ°.")]),s._v(" "),t("p",[t("strong",[s._v("Innodbbufferpoolpagesfree")]),s._v(" æ˜¯å‰©ä½™é¡µæ•°é‡, é€šè¿‡ total å’Œ free å¯ä»¥è®¡ç®—å‡º used, ç”¨ used é™¤ä»¥ total å°±å¯ä»¥å¾—åˆ°ä½¿ç”¨ç‡. å½“ç„¶, ä½¿ç”¨ç‡é«˜å¹¶ä¸æ˜¯è¯´æœ‰é—®é¢˜, å› ä¸º InnoDB æœ‰ LRU ç¼“å­˜æ¸…ç†æœºåˆ¶, åªè¦å“åº”å¾—å¤Ÿå¿«, é«˜ä½¿ç”¨ç‡ä¹Ÿä¸æ˜¯é—®é¢˜.")]),s._v(" "),t("p",[t("strong",[s._v("Innodbbufferpoolreadrequests")]),s._v(" å’Œ "),t("strong",[s._v("Innodbbufferpoolreads")]),s._v(" æ˜¯å¦å¤–ä¸¤ä¸ªå…³é”®æŒ‡æ ‡. read_requests è¡¨ç¤ºå‘ Buffer pool å‘èµ·çš„æŸ¥è¯¢æ€»é‡, å¦‚æœ Buffer pool ç¼“å­˜äº†ç›¸å…³æ•°æ®ç›´æ¥è¿”å›å°±å¥½, å¦‚æœ Buffer pool æ²¡æœ‰ç›¸å…³æ•°æ®, å°±è¦ç©¿é€å†…å­˜å»æŸ¥è¯¢ç¡¬ç›˜äº†. æœ‰å¤šå°‘è¯·æ±‚æ»¡è¶³ä¸äº†éœ€è¦å»æŸ¥è¯¢ç¡¬ç›˜å‘¢?")]),s._v(" "),t("p",[s._v("è¿™å°±è¦çœ‹ "),t("strong",[s._v("Innodb_buffer_pool_reads")]),s._v(" æŒ‡æ ‡ç»Ÿè®¡çš„æ•°é‡. æ‰€ä»¥, reads è¿™ä¸ªæŒ‡æ ‡é™¤ä»¥ read_requests å°±å¾—åˆ°äº†ç©¿é€æ¯”ä¾‹, è¿™ä¸ª"),t("strong",[s._v("æ¯”ä¾‹è¶Šé«˜, æ€§èƒ½è¶Šå·®, ä¸€èˆ¬å¯ä»¥é€šè¿‡è°ƒæ•´ Buffer pool çš„å¤§å°æ¥è§£å†³")]),s._v(".")]),s._v(" "),t("p",[s._v("å‰é¢æ ¹æ® Google å››ä¸ªé»„é‡‘æŒ‡æ ‡çš„æ–¹æ³•è®º, æ¢³ç†äº† MySQL ç›¸å…³çš„æŒ‡æ ‡, è¿™äº›æŒ‡æ ‡å¤§å¤šæ˜¯"),t("strong",[s._v("å¯ä»¥é€šè¿‡ global status å’Œ variables æ‹¿åˆ°")]),s._v("çš„. performance schema å’Œ sys schema ç›¸å¯¹éš¾æ, ä¸€æ˜¯ sys schema éœ€è¦è¾ƒé«˜ç‰ˆæœ¬æ‰èƒ½æ”¯æŒ, äºŒæ˜¯è¿™ä¸¤ä¸ª schema çš„æ•°æ®ä¸å¤ªé€‚åˆæ”¾åˆ° metrics åº“é‡Œ. å¸¸è§åšæ³•æ˜¯é€šè¿‡ä¸€äº›åå…¨å±€çš„ç»Ÿè®¡æŒ‡æ ‡, æ¯”å¦‚ Slow_queries, å…ˆå‘ç°é—®é¢˜, å†é€šè¿‡è¿™ä¸¤ä¸ª schema çš„æ•°æ®åˆ†æç»†èŠ‚.")]),s._v(" "),t("p",[s._v("ä¸åŒçš„é‡‡é›†å™¨é‡‡é›†çš„æŒ‡æ ‡, å‘½åæ–¹å¼ä¼šæœ‰å·®åˆ«, ä¸è¿‡å¤§åŒå°å¼‚, å…³é”®æ˜¯ç†è§£æ€è·¯å’ŒåŸç†. ä¸‹é¢è¿˜æ˜¯åˆ©ç”¨ Categraf æ¥é…ç½®é‡‡é›†, æ¼”ç¤ºä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹.")]),s._v(" "),t("h4",{attrs:{id:"é‡‡é›†é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡‡é›†é…ç½®"}},[s._v("#")]),s._v(" é‡‡é›†é…ç½®")]),s._v(" "),t("p",[s._v("Categraf é’ˆå¯¹ MySQL çš„é‡‡é›†æ’ä»¶é…ç½®, åœ¨ "),t("code",[s._v("conf/input.mysql/mysql.toml")]),s._v("â€‹ é‡Œ. å‡†å¤‡äº†ä¸€ä¸ªé…ç½®æ ·ä¾‹ä¾›å‚è€ƒ.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\naddress = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:3306"')]),s._v("\nusername = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("\npassword = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1234"')]),s._v("\n\nextra_status_metrics = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nextra_innodb_metrics = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ngather_processlist_processes_by_state = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\ngather_processlist_processes_by_user = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\ngather_schema_size = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\ngather_table_size = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\ngather_system_table_size = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\ngather_slave_status = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n# # timeout\n# timeout_seconds = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n# labels = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" instance="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"n9e-dev-mysql"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("æœ€å…³é”®çš„é…ç½®æ˜¯ "),t("strong",[s._v("æ•°æ®åº“è¿æ¥åœ°å€å’Œè®¤è¯ä¿¡æ¯")]),s._v(", å…·ä½“é‡‡é›†å“ªäº›å†…å®¹ç”±ä¸€å †å¼€å…³æ¥æ§åˆ¶. ä¸€èˆ¬å»ºè®®æŠŠ extra_status_metrics, extra_innodb_metrics, gather_slave_status è®¾ç½®ä¸º true, å…¶ä»–çš„éƒ½ä¸å¤ªéœ€è¦é‡‡é›†. labels éƒ¨åˆ†, å»ºè®®åŠ ä¸ª instance æ ‡ç­¾, ç»™è¿™ä¸ªæ•°æ®åº“å–ä¸€ä¸ªè¡¨æ„æ€§æ›´å¼ºçš„åç§°, æœªæ¥æ”¶åˆ°å‘Šè­¦æ¶ˆæ¯çš„æ—¶å€™, å¯ä»¥ä¸€çœ¼çŸ¥é“æ˜¯å“ªä¸ªæ•°æ®åº“çš„é—®é¢˜. instances éƒ¨åˆ†æ˜¯ä¸ªæ•°ç»„, å¦‚æœè¦ç›‘æ§å¤šä¸ªæ•°æ®åº“, å°±é…ç½®å¤šä¸ª instances å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("Categraf ä½œä¸ºé‡‡é›†æ¢é’ˆ, é‡‡é›† MySQL æ—¶, æœ‰ä¸¤ç§æ–¹æ¡ˆ, "),t("strong",[s._v("ä¸€ä¸ªæ˜¯ä¸­å¿ƒåŒ–æ¢æµ‹æ–¹æ¡ˆ, ä¸€ä¸ªæ˜¯åˆ†å¸ƒå¼æœ¬åœ°é‡‡é›†çš„æ–¹æ¡ˆ")]),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"_1-ä¸­å¿ƒåŒ–æ¢æµ‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä¸­å¿ƒåŒ–æ¢æµ‹"}},[s._v("#")]),s._v(" 1.ä¸­å¿ƒåŒ–æ¢æµ‹")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸“é—¨æ‰¾ä¸€å°æœºå™¨ä½œä¸ºæ¢é’ˆæœºå™¨, éƒ¨ç½²ä¸€ä¸ªå•ç‹¬çš„ Categraf, åªç”¨æ¥é‡‡é›† MySQL ç›¸å…³çš„æŒ‡æ ‡, åŒæ—¶é‡‡é›†æ‰€æœ‰çš„ MySQL å®ä¾‹, å³è¿™ä¸ª Categraf çš„ mysql.toml ä¸­ä¼šæœ‰å¾ˆå¤š instances é…ç½®æ®µ.")]),s._v(" "),t("p",[s._v("è¿™ç§æ–¹æ¡ˆå¯¹ MySQL å®ä¾‹æ•°é‡è¾ƒå°‘ä»¥åŠäº‘ä¸Šçš„ RDS æœåŠ¡çš„åœºæ™¯, éƒ½æ˜¯é€‚ç”¨çš„. ä¸è¿‡ç›¸å¯¹ä¸å¤ªæ–¹ä¾¿åšè‡ªåŠ¨åŒ–, æ¯”å¦‚è¦æ–°å»ºä¸€ä¸ª MySQL, è¿˜éœ€è¦åˆ°è¿™ä¸ªæ¢é’ˆæœºå™¨é‡Œé…ç½®ç›¸å…³çš„é‡‡é›†è§„åˆ™, æœ‰ä¸€äº›éº»çƒ¦.")]),s._v(" "),t("h5",{attrs:{id:"_2-åˆ†å¸ƒå¼æœ¬åœ°é‡‡é›†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-åˆ†å¸ƒå¼æœ¬åœ°é‡‡é›†"}},[s._v("#")]),s._v(" 2.åˆ†å¸ƒå¼æœ¬åœ°é‡‡é›†")]),s._v(" "),t("p",[s._v("æ›´æ¨èç¬¬äºŒç§æ–¹æ¡ˆ---åˆ†å¸ƒå¼æœ¬åœ°é‡‡é›†. è¿™ä¸ªæ–¹æ¡ˆæ˜¯æŠŠ Categraf éƒ¨ç½²åˆ°éƒ¨ç½² MySQL çš„é‚£å°æœºå™¨ä¸Š, è®© Categraf é‡‡é›† 127.0.0.1:3306 çš„å®ä¾‹. å¯¹äº MySQL è¿™ä¸ªæœåŠ¡, å»ºè®®ä¸è¦æ··éƒ¨, ä¸€å°å®¿ä¸»æœºå°±éƒ¨ç½²ä¸€ä¸ª MySQL å°±å¯ä»¥äº†, InnoDB Buffer pool è®¾ç½®å¾—å¤§ä¸€äº›, 80% ç‰©ç†å†…å­˜, æ€§èƒ½æ æ çš„.")]),s._v(" "),t("p",[s._v("DBA ç®¡ç† MySQL çš„æ—¶å€™è¦ç»å¸¸åˆ›å»ºé›†ç¾¤, é€šå¸¸ä¼šæ²‰æ·€å‡ºä¸€äº›è‡ªåŠ¨åŒ–å·¥å…·, åœ¨è‡ªåŠ¨åŒ–å·¥å…·é‡ŒæŠŠéƒ¨ç½² Categraf, é…ç½® Categraf çš„ mysql.toml çš„é€»è¾‘éƒ½åŠ ä¸Š, ä¸€é”®æå®š, æ¯”è¾ƒæ–¹ä¾¿. ç›‘æ§åªéœ€è¦è¯»æƒé™, å»ºè®®ä¸ºç›‘æ§ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“è´¦å·, ç»Ÿä¸€è´¦å·, ç»Ÿä¸€å¯†ç , ç»Ÿä¸€æˆæƒ, è¿™æ · mysql.toml çš„é…ç½®ä¹Ÿæ¯”è¾ƒä¸€è‡´.")]),s._v(" "),t("p",[s._v("é‡‡ç”¨è¿™ç§éƒ¨ç½²æ–¹å¼çš„è¯, ä¸€èˆ¬å°±ç”¨æœºå™¨ååšæ ‡è¯†å°±å¯ä»¥äº†, ä¸å¤ªéœ€è¦å•ç‹¬çš„ instance æ ‡ç­¾. Categraf å†…ç½®äº†ä¸€ä¸ª "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/mysql/dashboard-by-ident.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("å¤œèºç›‘æ§å¤§ç›˜"),t("OutboundLink")],1),s._v(", å¤§ç›˜å˜é‡ä½¿ç”¨æœºå™¨åæ¥åšè¿‡æ»¤. å¦‚æœç”¨çš„æ˜¯ Grafana, å¯ä»¥å» Grafana å®˜ç½‘æœä¸€ä¸‹ "),t("a",{attrs:{href:"https://grafana.com/grafana/dashboards/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Dashboard"),t("OutboundLink")],1),s._v(", å¤§åŒå°å¼‚. æ³¨æ„ä¸€ä¸‹, åˆšåˆšæåˆ°çš„é‚£äº›å…³é”®æŒ‡æ ‡, æœ€å¥½éƒ½è¦æ”¾åˆ° Dashboard é‡Œ. æ•ˆæœå›¾å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5bde0eb16882569f58f10309a9b75a3f-20230719203435-qsf2ssu.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("h4",{attrs:{id:"ä¸šåŠ¡æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸šåŠ¡æŒ‡æ ‡"}},[s._v("#")]),s._v(" ä¸šåŠ¡æŒ‡æ ‡")]),s._v(" "),t("p",[s._v("MySQL çš„æŒ‡æ ‡é‡‡é›†, "),t("mark",[t("strong",[s._v("æ ¸å¿ƒåŸç†å…¶å®å°±æ˜¯è¿ä¸Š MySQL æ‰§è¡Œä¸€äº› SQL, æŸ¥è¯¢æ€§èƒ½æ•°æ®")])]),s._v(". Categraf å†…ç½®äº†ä¸€äº›æŸ¥è¯¢ SQL, é‚£èƒ½å¦è‡ªå®šä¹‰ä¸€äº› SQL, æŸ¥è¯¢ä¸€äº›ä¸šåŠ¡æŒ‡æ ‡å‘¢? æ¯”å¦‚æŸ¥è¯¢ä¸€ä¸‹ä¸šåŠ¡ç³»ç»Ÿçš„ç”¨æˆ·é‡, æŠŠç”¨æˆ·é‡ä½œä¸ºæŒ‡æ ‡ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿ, è¿˜æ˜¯éå¸¸æœ‰ä»·å€¼çš„. å‰é¢è®²è¿‡ç›‘æ§åˆ†ç±», å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªç±»åˆ«, å°±æ˜¯ä¸šåŠ¡ç›‘æ§.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªéœ€æ±‚ä»ç„¶å¯ä»¥ä½¿ç”¨ Categraf çš„ "),t("strong",[s._v("MySQL é‡‡é›†æ’ä»¶")]),s._v("å®ç°, æŸ¥çœ‹ mysql.toml é‡Œçš„é»˜è®¤é…ç½®, å¯ä»¥çœ‹åˆ°è¿™æ ·ä¸€æ®µå†…å®¹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.queries"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nmesurement = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"users"')]),s._v("\nmetric_fields = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlabel_fields = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nfield_to_append = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\ntimeout = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3s"')]),s._v("\nrequest = '''\nselect 'n9e' as service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" count(*) as total from n9e_v5.users\n'''\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("è¿™å°±æ˜¯è‡ªå®šä¹‰ SQL çš„é…ç½®, æƒ³è¦æŸ¥è¯¢å“ªä¸ªæ•°æ®åº“å®ä¾‹, å°±åœ¨å¯¹åº”çš„ [[instances]] ä¸‹é¢å¢åŠ  [[instances.queries]]. çœ‹ä¸‹è¿™å‡ ä¸ªé…ç½®å‚æ•°çš„è§£é‡Š.")]),s._v(" "),t("ul",[t("li",[s._v("mesurement æŒ‡æ ‡ç±»åˆ«, ä¼šä½œä¸º metric name çš„å‰ç¼€.")]),s._v(" "),t("li",[s._v("metric_fields æŸ¥è¯¢è¿”å›çš„ç»“æœ, å¯èƒ½æœ‰å¤šåˆ—æ˜¯æ•°å€¼, æŒ‡å®šå“ªäº›åˆ—ä½œä¸ºæŒ‡æ ‡ä¸ŠæŠ¥.")]),s._v(" "),t("li",[s._v("label_fields æŸ¥è¯¢è¿”å›çš„ç»“æœ, å¯èƒ½æœ‰å¤šåˆ—æ˜¯å­—ç¬¦ä¸², æŒ‡å®šå“ªäº›åˆ—ä½œä¸ºæ ‡ç­¾ä¸ŠæŠ¥.")]),s._v(" "),t("li",[s._v("field_to_append æŒ‡å®šæŸä¸€åˆ—çš„å†…å®¹ä½œä¸º metric name çš„åç¼€.")]),s._v(" "),t("li",[s._v("timeout è¯­å¥æ‰§è¡Œè¶…æ—¶æ—¶é—´.")]),s._v(" "),t("li",[s._v("request æŸ¥è¯¢è¯­å¥, è¿ç»­ä¸‰ä¸ªå•å¼•å·, å’Œ Python çš„ä¸‰ä¸ªå•å¼•å·è¯­ä¹‰ç±»ä¼¼, é‡Œè¾¹çš„å†…å®¹å°±ä¸ç”¨è½¬ä¹‰äº†.")])]),s._v(" "),t("p",[s._v("MySQL ç›¸å…³çš„ç›‘æ§å®è·µ, åŒ…æ‹¬æ€§èƒ½ç›‘æ§å’Œä¸šåŠ¡ç›‘æ§, æ ¸å¿ƒå°±æ˜¯ä¸Šé¢è¯´çš„è¿™äº›å†…å®¹, ä¸‹é¢åšä¸€ä¸ªæ€»ç»“.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-12"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-12"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ ¹æ® Google å››ä¸ªé»„é‡‘æŒ‡æ ‡çš„æ–¹æ³•è®º, æ¥æŒ‡å¯¼ MySQL ç›‘æ§æ•°æ®çš„é‡‡é›†, ä»å»¶è¿Ÿ, æµé‡, é”™è¯¯, é¥±å’Œåº¦å››ä¸ªæ–¹é¢åˆ†åˆ«è®²è§£äº†å…·ä½“çš„æŒ‡æ ‡æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•è·å–è¿™äº›æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/992e7988a1e10e9395bd771cf1314327-20230719203435-70hixq7.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_14-ç»„ä»¶ç›‘æ§-redisçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14-ç»„ä»¶ç›‘æ§-redisçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›"}},[s._v("#")]),s._v(" 14.ç»„ä»¶ç›‘æ§-Redisçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›?")]),s._v(" "),t("p",[s._v("Redis ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹å¤–æœåŠ¡, æ‰€ä»¥ Google çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡åŒæ ·é€‚ç”¨äºRedis, ä¸ä¸Šä¸€è®²ä¸€æ ·, è¿˜æ˜¯ä»"),t("strong",[s._v("å»¶è¿Ÿ, æµé‡, é”™è¯¯, é¥±å’Œåº¦")]),s._v("è¿™äº›æ–¹é¢, æ¥åˆ†æ Redis çš„å…³é”®æŒ‡æ ‡.")]),s._v(" "),t("h4",{attrs:{id:"å»¶è¿Ÿ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å»¶è¿Ÿ"}},[s._v("#")]),s._v(" å»¶è¿Ÿ")]),s._v(" "),t("p",[s._v("åœ¨è½¯ä»¶å·¥ç¨‹æ¶æ„ä¸­, ä¹‹æ‰€ä»¥é€‰æ‹© Redis ä½œä¸ºæŠ€æœ¯å †æ ˆçš„ä¸€å‘˜, å¤§æ¦‚ç‡æ˜¯æƒ³è¦å¾—åˆ°æ›´å¿«çš„å“åº”é€Ÿåº¦å’Œæ›´é«˜çš„ååé‡, æ‰€ä»¥å»¶è¿Ÿæ•°æ®å¯¹ä½¿ç”¨ Redis çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦. é€šå¸¸ä¼šé€šè¿‡ä¸‹é¢è¿™ä¸¤ç§æ–¹å¼æ¥ç›‘æ§å»¶è¿Ÿ.")]),s._v(" "),t("ol",[t("li",[s._v("å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåŸ‹ç‚¹. æ¯”å¦‚æŸä¸ª Java æˆ– Go çš„ç¨‹åºåœ¨è°ƒç”¨ Redis çš„æ—¶å€™, è®¡ç®—ä¸€ä¸‹å„ä¸ªå‘½ä»¤èŠ±è´¹äº†å¤šä¹…, ç„¶åæŠŠè€—æ—¶æ•°æ®æ¨ç»™ç›‘æ§ç³»ç»Ÿå³å¯. è¿™ç§æ–¹å¼å¥½å¤„æ˜¯éå¸¸çµæ´», æƒ³è¦æŒ‰ç…§ä»€ä¹ˆç»´åº¦ç»Ÿè®¡å°±æŒ‰ç…§ä»€ä¹ˆç»´åº¦ç»Ÿè®¡, ç¼ºç‚¹è‡ªç„¶æ˜¯ä»£ç "),t("strong",[s._v("ä¾µå…¥æ€§")]),s._v(", å’Œå®¢æˆ·ç«¯åŸ‹ç‚¹ç›‘æ§ MySQL çš„åŸç†æ˜¯ä¸€æ ·çš„.")]),s._v(" "),t("li",[s._v("ä½¿ç”¨ redis-cli çš„ "),t("code",[s._v("--latency")]),s._v("â€‹ å‘½ä»¤, è¿™ä¸ªåŸç†æ¯”è¾ƒç®€å•, å°±æ˜¯å®¢æˆ·ç«¯è¿ä¸Š redis-server, ç„¶åä¸æ–­å‘é€ ping å‘½ä»¤, ç»Ÿè®¡è€—æ—¶. æ¯”å¦‚è¿œç«¯æœºå™¨å¯¹æŸä¸ª redis-server åšæ¢æµ‹, å¯ä»¥çœ‹ä¸€ä¸‹æ¢æµ‹çš„ç»“æœ.")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("redis-cli --latency -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.206")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.16")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\nmin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("58")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" avg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.30")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1013")]),s._v(" samples)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("ç„¶ååˆè·‘åˆ° 10.206.0.16 è¿™ä¸ªæœºå™¨ä¸Š, å¯¹æœ¬æœºçš„ redis-server åšæ¢æµ‹, ç»“æœæ˜¯è¿™æ ·çš„.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("redis-cli --latency -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\nmin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" avg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.19")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1415")]),s._v(" samples)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿œç«¯æœºå™¨å¹³å‡å»¶è¿Ÿæ˜¯ 35.3 æ¯«ç§’, æœ¬åœ°æ¢æµ‹å¹³å‡å»¶è¿Ÿæ˜¯ 0.19 æ¯«ç§’, ç›¸å·®å·¨å¤§, æ—¶é—´ä¸»è¦æ˜¯èŠ±è´¹åœ¨"),t("strong",[s._v("ç½‘ç»œ I/O")]),s._v(" ä¸Šäº†, Redis æœ¬èº«æ‰§è¡Œæ•ˆç‡æ˜¯å¾ˆé«˜çš„.")]),s._v(" "),t("p",[t("strong",[s._v("ä¸ºä»€ä¹ˆåªä½¿ç”¨ ping å‘½ä»¤å¯¹ redis-server åšæ¢æµ‹, æ€ä¹ˆèƒ½åæ˜ å‡ºçœŸå®çš„å·¥ä½œè´Ÿè½½å‘¢? ä¼šä¸ä¼šå‡ºç° ping å‘½ä»¤æ‰§è¡Œå¾—å¾ˆå¿«, åº”ç”¨å‘èµ·çš„çœŸå®è¯·æ±‚å´å¾ˆæ…¢çš„æƒ…å†µå‘¢?")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜å¾ˆå¥½, ä¸è¿‡ "),t("strong",[s._v("Redis æ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œçš„æ¨¡å‹, å¦‚æœæŸä¸ªè¯·æ±‚æ‰§è¡Œå¾—æ…¢, å…¶ä»–æ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¾—ç­‰ç€, æ‰€ä»¥ä½¿ç”¨ ping å‘½ä»¤å¯¹ redis-server åšæ¢æµ‹, ç†è®ºä¸Šæ¢æµ‹ç»“æœæ˜¯å¯ä»¥åæ˜  redis-server çš„çœŸå®å·¥å†µçš„")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æœå‘ç° Redis å˜æ…¢äº†, åº”è¯¥æ€ä¹ˆæ‰¾åˆ°é‚£äº›æ‰§è¡Œå¾—å¾ˆæ…¢çš„å‘½ä»¤å‘¢? è¿™å°±è¦æ±‚åŠ©äº "),t("strong",[s._v("slowlog")]),s._v(" äº†. è¯´åˆ°æ…¢æ—¥å¿—, é¦–å…ˆè¦å®šä¹‰æ‰§è¡Œæ—¶é—´è¶…è¿‡å¤šä¹…ç®—æ…¢, Redis é»˜è®¤çš„é…ç½®æ˜¯ 10 æ¯«ç§’, æ¯”å¦‚è°ƒæ•´æˆ 5 æ¯«ç§’.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# grep slower /etc/redis.conf\nslowlog-log-slower-than "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# redis-cli\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("> config set slowlog-log-slower-than "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("> config get slowlog-log-slower-than\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"slowlog-log-slower-than"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5000"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("> config rewrite\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("> quit\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt-fc-dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# grep slower /etc/redis.conf\nslowlog-log-slower-than "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("ä¹‹åä¸€äº›æ‰§è¡Œæ—¶é—´è¶…è¿‡ 5 æ¯«ç§’çš„å‘½ä»¤å°±ä¼šè¢«è®°å½•ä¸‹æ¥, ç„¶åä½¿ç”¨ "),t("code",[s._v("slowlog get [count]")]),s._v("â€‹ å°±èƒ½æŸ¥çœ‹ count å‡ºæ¥çš„ slowlog æ¡æ•°äº†. è¿™é‡Œè·å– 2 æ¡ä½œä¸ºæ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("> SLOWLOG get "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(") (integer) "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(") (integer) "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1668743666")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(") (integer) "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13168")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hset"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/idents/Default"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tt-fc-dev01.nj"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1668743666"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:43172"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(") (integer) "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(") (integer) "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1668646906")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(") (integer) "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13873")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hset"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/idents/Default"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.206.16.3"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1668646906"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:44612"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("å¯¹äºæ¯ä¸€æ¡ slowlog, å…¶å„ä¸ªå­—æ®µçš„å«ä¹‰æ˜¯: åºå·, æ—¶é—´æˆ³, æ‰§è¡Œæ—¶é—´(å•ä½æ˜¯å¾®ç§’), å‘½ä»¤åŠå…¶å‚æ•°, å®¢æˆ·ç«¯ IP å’Œç«¯å£ç­‰.")]),s._v(" "),t("h4",{attrs:{id:"æµé‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æµé‡"}},[s._v("#")]),s._v(" æµé‡")]),s._v(" "),t("p",[s._v("Redis æ¯ç§’å¤„ç†å¤šå°‘è¯·æ±‚, æ¯ç§’æ¥æ”¶å¤šå°‘å­—èŠ‚, è¿”å›å¤šå°‘å­—èŠ‚, åœ¨ Redis é‡Œéƒ½å†…ç½®äº†ç›¸å…³æŒ‡æ ‡, é€šè¿‡ redis-cli è¿ä¸Š Redis, æ‰§è¡Œ "),t("code",[s._v("info all")]),s._v("â€‹ å‘½ä»¤å¯ä»¥çœ‹åˆ°å¾ˆå¤šæŒ‡æ ‡, ç»å¤§éƒ¨åˆ†ç›‘æ§ç³»ç»Ÿ, éƒ½æ˜¯ä» info å‘½ä»¤çš„è¿”å›å†…å®¹ä¸­æå–çš„æŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" info all | grep instantaneous\ninstantaneous_ops_per_sec"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ninstantaneous_input_kbps"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\ninstantaneous_output_kbps"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("ops_per_sec è¡¨ç¤ºæ¯ç§’æ‰§è¡Œå¤šå°‘æ¬¡æ“ä½œ, input_kbps è¡¨ç¤ºæ¯ç§’æ¥æ”¶å¤šå°‘ KB, output_kbps è¡¨ç¤ºæ¯ç§’è¿”å›å¤šå°‘ KB. å› ä¸ºè¿æ¥çš„è¿™ä¸ª Redis å‡ ä¹æ²¡æœ‰ä»€ä¹ˆæµé‡, æ‰€ä»¥è¿”å›çš„éƒ½æ˜¯ 0, æ­£å¸¸æ¥è®², ä¸€ä¸ª Redis å®ä¾‹æ¯ç§’å¤„ç†å‡ ä¸‡ä¸ªè¯·æ±‚éƒ½æ˜¯å¾ˆæ­£å¸¸çš„.")]),s._v(" "),t("p",[s._v("æ¯ç§’å¤„ç†çš„æ“ä½œå¦‚æœè¾ƒä¸ºæ’å®š, æ˜¯éå¸¸å¥åº·çš„. å¦‚æœå‘ç° ops_per_sec å˜å°‘äº†, å°±è¦æ³¨æ„äº†, æœ‰å¯èƒ½æ˜¯æŸä¸ªè€—æ—¶æ“ä½œå¯¼è‡´çš„å‘½ä»¤é˜»å¡, ä¹Ÿæœ‰å¯èƒ½æ˜¯å®¢æˆ·ç«¯å‡ºäº†é—®é¢˜, ä¸å‘è¯·æ±‚è¿‡æ¥äº†.")]),s._v(" "),t("p",[s._v("å¦‚æœæŠŠ Redis å½“åšç¼“å­˜æ¥ä½¿ç”¨, è¿˜éœ€å…³æ³¨ keyspace_hits å’Œ keyspace_misses ä¸¤ä¸ªæŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" info all | grep keyspace\nkeyspace_hits"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("62033897")]),s._v("\nkeyspace_misses"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10489649")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™ä¸¤ä¸ªæŒ‡æ ‡éƒ½æ˜¯ "),t("strong",[s._v("Counter ç±»å‹, å•è°ƒé€’å¢")]),s._v(", å³ Redis å®ä¾‹å¯åŠ¨ä»¥æ¥, ç»Ÿè®¡çš„æ‰€æœ‰å‘½ä¸­çš„æ•°é‡å’Œæœªå‘½ä¸­çš„æ•°é‡. å¦‚æœ"),t("strong",[s._v("è¦ç»Ÿè®¡æ€»ä½“çš„å‘½ä¸­ç‡, ä½¿ç”¨ hits é™¤ä»¥æ€»é‡å³å¯")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("hit rate = keyspace_hits / (keyspace_hits + keyspace_misses)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æœè¦å…³æ³¨è¿‘æœŸçš„å‘½ä¸­ç‡, æ¯”å¦‚æœ€è¿‘ 10 åˆ†é’Ÿ, å°±è¦é€šè¿‡ PromQL increase å‡½æ•°ç­‰åš"),t("strong",[s._v("äºŒæ¬¡è¿ç®—")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("increase(keyspace_hits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(")\n/\n(increase(keyspace_hits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(") + increase(keyspace_misses"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("))\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å¦‚æœå‘½ä¸­ç‡ä½äº 0.8 å°±è¦æ³¨æ„äº†, æœ‰å¯èƒ½æ˜¯å†…å­˜ä¸å¤Ÿç”¨, å¾ˆå¤š Key è¢«æ¸…ç†äº†. å½“ç„¶ä¹Ÿå¯èƒ½æ˜¯æ•°æ®æ²¡æœ‰åŠæ—¶å¡«å……æˆ–è¿‡æœŸäº†. è¾ƒä½çš„å‘½ä¸­ç‡æ˜¾ç„¶ä¼šå¯¹åº”ç”¨ç¨‹åºçš„å»¶è¿Ÿæœ‰å½±å“, å› ä¸ºé€šå¸¸æ¥è®², å½“åº”ç”¨ç¨‹åºæ— æ³•ä» Redis ä¸­è·å–ç¼“å­˜æ•°æ®æ—¶, å°±è¦ç©¿é€åˆ°æ›´æ…¢çš„å­˜å‚¨ä»‹è´¨å»è·å–æ•°æ®äº†.")]),s._v(" "),t("h4",{attrs:{id:"é”™è¯¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é”™è¯¯"}},[s._v("#")]),s._v(" é”™è¯¯")]),s._v(" "),t("p",[s._v("Redis åœ¨å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶, é€šå¸¸ä¸ä¼šæœ‰ä»€ä¹ˆå†…éƒ¨é”™è¯¯äº§ç”Ÿ, æ¯•ç«Ÿåªæ˜¯æ“ä½œå†…å­˜, ä¾èµ–æ¯”è¾ƒå°‘, å‡ºé—®é¢˜çš„æ¦‚ç‡å°±å¾ˆå°äº†. å¦‚æœå®¢æˆ·ç«¯æ“ä½œ Redis è¿”å›äº†é”™è¯¯, å¤§æ¦‚ç‡æ˜¯ç½‘ç»œé—®é¢˜æˆ–å‘½ä»¤å†™é”™äº†å¯¼è‡´çš„. æœ€å¥½æ˜¯åšå®¢æˆ·ç«¯åŸ‹ç‚¹ç›‘æ§, è‡ªå·±å‘ç°äº†ç„¶åè‡ªå·±å»è§£å†³.")]),s._v(" "),t("p",[s._v("Redis å¯¹å®¢æˆ·ç«¯çš„æ•°é‡ä¹Ÿæœ‰ä¸€ä¸ªæœ€å¤§æ•°å€¼çš„é™åˆ¶, é»˜è®¤æ˜¯ 10 ä¸‡, å¦‚æœè¶…è¿‡äº†è¿™ä¸ªæ•°é‡, rejected_connections æŒ‡æ ‡å°±ä¼š +1. å’Œ MySQ Lä¸ä¸€æ ·çš„æ˜¯, Redis ä½¿ç”¨è¿‡ç¨‹ä¸­, åº”è¯¥å¾ˆå°‘é‡åˆ°è¶…è¿‡æœ€å¤§è¿æ¥æ•°(maxclients) çš„æƒ…å†µ, ä¸è¿‡è°¨æ…èµ·è§, ä¹Ÿå¯ä»¥å¯¹ rejected_connections åšä¸€ä¸‹ç›‘æ§.")]),s._v(" "),t("h4",{attrs:{id:"é¥±å’Œåº¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é¥±å’Œåº¦"}},[s._v("#")]),s._v(" é¥±å’Œåº¦")]),s._v(" "),t("p",[t("strong",[s._v("Redis é‡åº¦ä½¿ç”¨å†…å­˜, å†…å­˜çš„ä½¿ç”¨ç‡, ç¢ç‰‡ç‡, ä»¥åŠå› ä¸ºå†…å­˜ä¸å¤Ÿç”¨è€Œæ¸…ç†çš„ Key æ•°é‡")]),s._v(", éƒ½æ˜¯éœ€è¦é‡ç‚¹å…³æ³¨çš„. é€šè¿‡ "),t("code",[s._v("info memory")]),s._v("â€‹ å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹è¿™å‡ ä¸ªå…³é”®æŒ‡æ ‡.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# Memory\nused_memory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26276368")]),s._v("\nused_memory_human"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(".06M\nused_memory_rss"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39575552")]),s._v("\nused_memory_rss_human"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v(".74M\nused_memory_peak"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33979824")]),s._v("\nused_memory_peak_human"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(".41M\n...\nmaxmemory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmaxmemory_human"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("0B\n...\nmem_fragmentation_ratio"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.51")]),s._v("\n...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("used_memory é¡¾åæ€ä¹‰å°±æ˜¯ä½¿ç”¨äº†å¤šå°‘å†…å­˜, æ˜¯ä» Redis è‡ªèº«è§†è§’æ¥çœ‹çš„, human åç¼€è¡¨ç¤ºç”¨äººç±»æ˜“è¯»çš„æ–¹å¼æ¥è¡¨ç¤º. used_memory_rss è¡¨ç¤ºä»æ“ä½œç³»ç»Ÿè§†è§’æ¥çœ‹åˆ†é…äº†å¤šå°‘å†…å­˜ç»™ Redis. used_memory_rss é™¤ä»¥ used_memory å°±æ˜¯"),t("strong",[s._v("å†…å­˜ç¢ç‰‡ç‡, å³ mem_fragmentation_ratio")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("used_memory_rss("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39575552")]),s._v(") / used_memory("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26276368")]),s._v(") = mem_fragmentation_ratio("),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.51")]),s._v(")\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æœç¢ç‰‡åŒ–ç‡æ¯”è¾ƒé«˜, è¯´æ˜ used_memory_rss ç›¸å¯¹æ›´å¤§, used_memory ç›¸å¯¹æ›´å°, å³ OS ç»™ Redis åˆ†é…äº†å¾ˆå¤šå†…å­˜, ä½† Redis åˆ©ç”¨å¾—ä¸å¥½. æ­£å¸¸æ¥è®², OS åˆ†é…å†…å­˜çš„æ—¶å€™å› ä¸ºæœ‰åˆ†é…å•ä½(æ¯”å¦‚ 8byte, 16byte, 32byte, 64byte)å¤§å°çš„é™åˆ¶, ä¸å¯èƒ½è¯´è¿›ç¨‹è¦å¤šå¤§å°±èƒ½å‡†ç¡®åˆ†é…å¤šå¤§, å‡è®¾ Redis æ¥ç”³è¯· 222 ä¸ªå­—èŠ‚, OS ä¼šç›´æ¥åˆ†é… 256 ä¸ªå­—èŠ‚, è¿™å°±ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡, ä½†æ˜¯è¿™ç§å†…å­˜ç¢ç‰‡ä¸ä¼šå¾ˆå¤š, è¦ä¸ç„¶ OS ä¼šæµªè´¹å¾ˆå¤šå†…å­˜, æ‰€ä»¥å¤šç»™ä¸€äº›å†…å­˜ç®—æ˜¯æ­£å¸¸æƒ…å†µ, "),t("strong",[s._v("å³ mem_fragmentation_ratio ç¨å¾®å¤§äº 1 æ˜¯æ²¡é—®é¢˜çš„")]),s._v(".")]),s._v(" "),t("p",[t("strong",[s._v("å¦å¤–å¦‚æœæ‰§è¡Œ Flushdb, Flushdb ä¼šè®© Redis æŠŠæ•°æ®åˆ æ‰, è€Œ Redis ä¸ä¼šç«‹é©¬æŠŠè¿™éƒ¨åˆ†å†…å­˜å½’è¿˜ç»™ OS, ç¢ç‰‡åŒ–ç‡çš„æŒ‡æ ‡å°±ä¼šå·¨é«˜æ— æ¯”, æ­¤æ—¶å»ºè®®é‡å¯ Redis. æ¯•ç«Ÿ, éƒ½å·²ç» Flushdb äº†, è¯´æ˜ Redis é‡Œå·²ç»æ²¡æœ‰æ•°æ®äº†.")])]),s._v(" "),t("p",[s._v("éšç€åº”ç”¨ç¨‹åºä¸æ–­åˆ é™¤, ä¿®æ”¹ Redis ä¸­çš„æ•°æ®, å†…å­˜ç¢ç‰‡åŒ–ç‡ä¹Ÿä¼šä¸Šå‡. æœ‰äººè¯´ mem_fragmentation_ratio è¶…è¿‡ 1.5 äº†, å°±è¯´æ˜ç¢ç‰‡ç‡å¤ªé«˜, éœ€è¦é‡å¯ Redis æˆ–ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è®© Redis æ¸…ç†ç¢ç‰‡(è¿™ä¸ªå‘½ä»¤ä» Redis V4 æ‰å¼€å§‹å¼•å…¥), æå¾—éå¸¸ç´§å¼ çš„æ ·å­.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("CONFIG SET activedefrag yes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å…¶å®å¤§å¯ä¸å¿…, å°±åƒä¸Šé¢è¿™ä¸ªä¾‹å­, RSS æ‰å ç”¨ 37M, Redis å®é™…ä½¿ç”¨ 25M, ç¢ç‰‡ 12M, å°å¾—å¯æ€œ, è™½ç„¶  mem_fragmentation_ratio å·²ç» 1.51 äº†, ä½†æ˜¯å®Œå…¨ä¸éœ€è¦å¤„ç†. used_memory_peak æ˜¯ 32.41M, è¯´æ˜æ›¾ç»ç”¨åˆ°è¿‡è¿™ä¹ˆå¤š, åæ¥æœ‰äº› Key è¿‡æœŸäº†æˆ–è€…åˆ é™¤/ä¿®æ”¹äº†, æ‰å¯¼è‡´ç¢ç‰‡ç‡é«˜äº†ç‚¹.")]),s._v(" "),t("p",[s._v("é‚£ä»€ä¹ˆæ—¶å€™éœ€è¦å¤„ç†ç¢ç‰‡å‘¢? "),t("strong",[s._v("æœºå™¨å†…å­˜ä¸å¤Ÿç”¨äº†, ç¢ç‰‡åŒ–çš„å†…å­˜æµªè´¹å¤ªå¤š, å¹¶ä¸”ç¢ç‰‡åŒ–ç‡å¾ˆé«˜çš„æ—¶å€™æ‰éœ€è¦å¤„ç†")]),s._v(". å¯ä»¥é€šè¿‡è°ƒæ•´ä¸‹é¢çš„å‚æ•°æ¥æ§åˆ¶ç¢ç‰‡å¤„ç†è¿‡ç¨‹.")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¼€å¯è‡ªåŠ¨å†…å­˜ç¢ç‰‡æ•´ç†(æ€»å¼€å…³)")]),s._v("\nactivedefrag "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å½“ç¢ç‰‡è¾¾åˆ° 100mb æ—¶, å¼€å¯å†…å­˜ç¢ç‰‡æ•´ç†")]),s._v("\nactive-defrag-ignore-bytes 100mb\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å½“ç¢ç‰‡è¶…è¿‡ 10% æ—¶, å¼€å¯å†…å­˜ç¢ç‰‡æ•´ç†")]),s._v("\nactive-defrag-threshold-lower "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å†…å­˜ç¢ç‰‡è¶…è¿‡ 100%, åˆ™å°½æœ€å¤§åŠªåŠ›æ•´ç†")]),s._v("\nactive-defrag-threshold-upper "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å†…å­˜è‡ªåŠ¨æ•´ç†å ç”¨èµ„æºæœ€å°ç™¾åˆ†æ¯”")]),s._v("\nactive-defrag-cycle-min "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å†…å­˜è‡ªåŠ¨æ•´ç†å ç”¨èµ„æºæœ€å¤§ç™¾åˆ†æ¯”")]),s._v("\nactive-defrag-cycle-max "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("ä¸Šé¢è®¨è®ºçš„æ˜¯ mem_fragmentation_ratio è¿‡å¤§çš„æƒ…å†µ, å®é™…ä¸Šè¿™ä¸ªå€¼è¿˜æœ‰"),t("strong",[s._v("å¯èƒ½å°äº 1")]),s._v(", è¡¨ç¤º Redis ä½¿ç”¨äº†è¶…è¿‡ RSS æ•°é‡çš„å†…å­˜, è¯´æ˜"),t("strong",[s._v("æ­¤æ—¶éƒ¨åˆ†å†…å­˜å·²ç»è¢«æ”¾åˆ°äº¤æ¢åˆ†åŒºä¸Š")]),s._v("äº†, è€Œç£ç›˜çš„æ€§èƒ½ç›¸æ¯”å†…å­˜å·®äº†å¤§æ¦‚ 5 ä¸ªæ•°é‡çº§, æ‰€ä»¥å‡ºç°è¿™ç§æƒ…å†µæ—¶ä¼šä¸¥é‡å½±å“æ€§èƒ½.")]),s._v(" "),t("p",[s._v("é¥±å’Œåº¦çš„åº¦é‡æ–¹é¢, è¿˜æœ‰ä¸€ä¸ªæŒ‡æ ‡æ˜¯ evicted_keys, è¡¨ç¤ºå½“"),t("strong",[s._v("å†…å­˜å ç”¨è¶…è¿‡äº† maxmemory çš„æ—¶å€™, Redis æ¸…ç†çš„ Key çš„æ•°é‡")]),s._v(". å®é™…ä¸Š, å†…å­˜è¾¾åˆ° maxmemory çš„æ—¶å€™, å…·ä½“æ˜¯æ€ä¹ˆä¸€ä¸ªå¤„ç†ç­–ç•¥, æ˜¯å¯ä»¥é…ç½®çš„, é»˜è®¤çš„ç­–ç•¥æ˜¯ noeviction.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt-fc-dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# redis-cli\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("> config get maxmemory-policy\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"maxmemory-policy"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"noeviction"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("å…¶ä»–å¸¸è§ç­–ç•¥æœ‰: volatile-lru, è¡¨ç¤ºä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„å†…å­˜æ•°æ®é›†é‡Œ, æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°æ‰; volatile-ttl, è¡¨ç¤ºä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„å†…å­˜æ•°æ®é›†é‡Œ, æŒ‘é€‰å³å°†è¿‡æœŸçš„æ•°æ®æ·˜æ±°.")]),s._v(" "),t("p",[s._v('"Google çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡" é‡ç‚¹è¦å…³æ³¨çš„æŒ‡æ ‡å°±æè¿°åˆ°è¿™é‡Œ, å¦‚æœè¿™äº›æŒ‡æ ‡å‡ºé—®é¢˜, ä¸Šæ¸¸çš„æœåŠ¡å¤§æ¦‚ç‡ä¼šå—åˆ°å½±å“, è¿˜æœ‰ä¸€äº›æŒ‡æ ‡è™½ç„¶çŸ­æœŸä¸ä¼šå½±å“ä¸Šæ¸¸æœåŠ¡, ä½†æ˜¯å¦‚æœä¸åŠæ—¶å¤„ç†æœªæ¥ä¹Ÿä¼šå‡ºç°å¤§éº»çƒ¦, è¿™ç±»æŒ‡æ ‡é€šå¸¸ç”¨äºè¡¡é‡ Redis å†…éƒ¨çš„ä¸€äº›è¿è¡Œå·¥å†µ, æ¯”å¦‚:')]),s._v(" "),t("ul",[t("li",[s._v("æŒä¹…åŒ–ç›¸å…³çš„æŒ‡æ ‡: rdb_changes_since_last_save è¡¨ç¤ºè‡ªä»ä¸Šæ¬¡è½ç›˜ä»¥æ¥åˆæœ‰å¤šå°‘æ¬¡å˜æ›´.")]),s._v(" "),t("li",[s._v("ä¸»ä»ç›¸å…³çš„æŒ‡æ ‡: master_link_down_since_seconds è¡¨ç¤ºä¸»ä»è¿æ¥å·²ç»æ–­å¼€çš„æ—¶é•¿.")])]),s._v(" "),t("p",[s._v("è¿™äº›éƒ½å±äºè§åçŸ¥ä¹‰çš„æŒ‡æ ‡, å°±ä¸å±•å¼€äº†.")]),s._v(" "),t("h4",{attrs:{id:"é‡‡é›†é…ç½®-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡‡é›†é…ç½®-2"}},[s._v("#")]),s._v(" é‡‡é›†é…ç½®")]),s._v(" "),t("p",[s._v("ä¸‹é¢çœ‹ä¸€ä¸‹ Redis çš„ç›‘æ§æ•°æ®å¦‚ä½•é‡‡é›†.")]),s._v(" "),t("p",[s._v("Categraf ä¹Ÿæä¾›äº† Redis é‡‡é›†æ’ä»¶, é…ç½®æ ·ä¾‹åœ¨ "),t("code",[s._v("conf/input.redis/redis.toml")]),s._v("â€‹, çœ‹ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n# address = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:6379"')]),s._v("\n# username = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n# password = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n# pool_size = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n# # Optional. Specify redis commands to retrieve values\n# commands = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n#     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("command = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sample-key1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" metric = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"custom_metric_name1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n#     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("command = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sample-key2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" metric = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"custom_metric_name2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n# labels = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" instance="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"n9e-dev-redis"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("æœ€æ ¸å¿ƒçš„é…ç½®å°±æ˜¯ address, ä¹Ÿå°±æ˜¯ Redis çš„è¿æ¥åœ°å€, ç„¶åæ˜¯è®¤è¯ä¿¡æ¯, username å­—æ®µä½ç‰ˆæœ¬çš„ Redis æ˜¯ä¸éœ€è¦çš„, å¦‚æœæ˜¯ 6.0 ä»¥ä¸Šçš„ç‰ˆæœ¬å¹¶ä¸”å¯ç”¨äº† ACL çš„æ‰éœ€è¦.")]),s._v(" "),t("p",[s._v("commands çš„ä½œç”¨æ˜¯è‡ªå®šä¹‰ä¸€äº›å‘½ä»¤æ¥è·å–æŒ‡æ ‡, å’Œ MySQL é‡‡é›†å™¨ä¸­çš„ queries ç±»ä¼¼, åœ¨ä¸šåŠ¡æŒ‡æ ‡é‡‡é›†çš„åœºæ™¯, é€šå¸¸èƒ½å‘æŒ¥å¥‡æ•ˆ.")]),s._v(" "),t("p",[s._v("labels æ˜¯ä¸ªé€šç”¨é…ç½®, æ‰€æœ‰çš„ Categraf çš„é‡‡é›†å™¨, éƒ½æ”¯æŒåœ¨ "),t("code",[s._v("[[instances]]")]),s._v("â€‹ ä¸‹é¢è‡ªå®šä¹‰æ ‡ç­¾. å¦‚æœä½¿ç”¨æœºå™¨åæ¥è¿‡æ»¤, è¿™æ ·ä¾¿äºæŠŠ Redis çš„æŒ‡æ ‡å’Œ Redis æ‰€åœ¨æœºå™¨çš„æŒ‡æ ‡æ”¾åˆ°ä¸€å¼ å¤§ç›˜é‡Œå±•ç¤º. è¿™é‡Œæä¾›äº†ä¸€ä¸ª "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/redis/dashboard.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä»ªè¡¨ç›˜æ ·ä¾‹"),t("OutboundLink")],1),s._v(" ä¾›å‚è€ƒ.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/429ae1a1c2e6fa1f457b409267ea312f-20230719203435-od4hrl2.png",alt:""}})]),s._v(" "),t("p",[s._v("Redis ç›‘æ§çš„åŸç†, é‡‡é›†æ–¹æ³•, ä»ªè¡¨ç›˜ç›¸å…³çš„çŸ¥è¯†å°±è®²è§£å®Œäº†, ä¸‹é¢åšä¸€ä¸ªæ€»ç»“.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-13"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-13"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("å› ä¸º Redis ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹å¤–æœåŠ¡, æ‰€ä»¥è¿™é‡Œè¿˜æ˜¯æŒ‰ç…§ Google çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡çš„æ³•åˆ™æ¥æ¢³ç†é‡è¦æŒ‡æ ‡.")]),s._v(" "),t("ul",[t("li",[s._v("å»¶è¿Ÿæ–¹é¢å¯ä»¥ä½¿ç”¨ "),t("code",[s._v("redis-cli --latency")]),s._v("â€‹ æ¥æ¢æµ‹, ä¸è¿‡é‡‡é›†å™¨ä¸€èˆ¬ä¸ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·, è€Œæ˜¯é‡‡é›†çš„æ—¶å€™å…ˆå‘ä¸ª ping å‘½ä»¤æ¥è·å–ä¸€ä¸‹å»¶è¿Ÿ.")]),s._v(" "),t("li",[s._v("æµé‡æ–¹é¢é‡ç‚¹å…³æ³¨æ¯ç§’å¤„ç†å¤šå°‘ä¸ª command, æ¯ç§’æ”¶åˆ°å¤šå°‘ç½‘ç»œæµé‡, è¿”å›å¤šå°‘ç½‘ç»œæµé‡.")]),s._v(" "),t("li",[s._v("Redis å› ä¸ºåªæ˜¯æ“ä½œå†…å­˜, æ‰€ä»¥åŸºæœ¬ä¸ä¼šé‡åˆ°é”™è¯¯, å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯åŸ‹ç‚¹æ–¹å¼, æ¥é‡‡é›†ç½‘ç»œé”™è¯¯, å‘½ä»¤é”™è¯¯.")]),s._v(" "),t("li",[s._v("é¥±å’Œåº¦æ–¹é¢, åˆ™é‡ç‚¹å…³æ³¨å†…å­˜é¥±å’Œåº¦, å°¤å…¶æ˜¯å†…å­˜ç¢ç‰‡ç‡, å°äº 1 ä¸è¡Œ, å¤ªå¤§äº†ä¹Ÿä¸å¤ªå¥½.")])]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6c59e45ed77817e05003e5888853b228-20230719203435-94ykff4.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_15-ç»„ä»¶ç›‘æ§-kafkaçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15-ç»„ä»¶ç›‘æ§-kafkaçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›"}},[s._v("#")]),s._v(" 15.ç»„ä»¶ç›‘æ§-Kafkaçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›?")]),s._v(" "),t("p",[s._v("å¯¹äº MySQL å’Œ Redis çš„ç›‘æ§, æ ¸å¿ƒåŸç†å°±æ˜¯è¿åˆ°å®ä¾‹ä¸Šæ‰§è¡Œç‰¹å®šè¯­å¥å‘½ä»¤æ‹‰å–æ•°æ®, ç±»ä¼¼çš„è¿˜æœ‰ MongoDB, è¿™ç®—æ˜¯ä¸€ç±»ç›‘æ§åœºæ™¯. æœ¬èŠ‚ä»‹ç»ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éå¸¸å¸¸ç”¨çš„ç»„ä»¶---Kafka, åŒæ—¶å¼•å‡º JMX ç›‘æ§åœºæ™¯.")]),s._v(" "),t("p",[s._v("è¦åšå¥½ Kafka çš„ç›‘æ§, é¦–å…ˆè¦äº†è§£ Kafka çš„ "),t("a",{attrs:{href:"https://time.geekbang.org/column/article/99318",target:"_blank",rel:"noopener noreferrer"}},[s._v("åŸºç¡€æ¦‚å¿µ"),t("OutboundLink")],1),s._v(", æ¯”å¦‚ Topic(ä¸»é¢˜), Partition(åˆ†åŒº), Replica(å‰¯æœ¬), AR(Assigned Replicas), ISR(In-Sync Replicas), OSR(Out-of-Sync Replicas), HW(High Watermark), LEO(Log End Offset)ç­‰ç­‰. å…¶æ¬¡æ˜¯è¦äº†è§£ Kafka çš„æ¶æ„, é€šè¿‡æ¶æ„æ‰èƒ½çŸ¥é“è¦é‡ç‚¹ç›‘æ§å“ªäº›ç»„ä»¶.")]),s._v(" "),t("h4",{attrs:{id:"kafkaæ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafkaæ¶æ„"}},[s._v("#")]),s._v(" Kafkaæ¶æ„")]),s._v(" "),t("p",[s._v("ä¸‹é¢çœ‹çœ‹çœ‹ä¸€ä¸‹ Kafka çš„æ¶æ„å›¾")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d691yye35395bb878227c002dfcc7a84-20230719203435-sll7ep9.png",alt:""}})]),s._v(" "),t("p",[s._v("ä¸Šé¢ç»¿è‰²éƒ¨åˆ† PRODUCER(ç”Ÿäº§è€…)å’Œä¸‹é¢ç´«è‰²éƒ¨åˆ† CONSUMER(æ¶ˆè´¹è€…)æ˜¯"),t("strong",[s._v("ä¸šåŠ¡ç¨‹åº")]),s._v(", é€šå¸¸ç”±ç ”å‘äººå‘˜åŸ‹ç‚¹è§£å†³ç›‘æ§é—®é¢˜, å¦‚æœæ˜¯ Java å®¢æˆ·ç«¯ä¹Ÿä¼šæš´éœ² JMX æŒ‡æ ‡. ç»„ä»¶è¿ç»´ç›‘æ§å±‚é¢ç€é‡å…³æ³¨è“è‰²éƒ¨åˆ†çš„ BROKER(Kafka èŠ‚ç‚¹)å’Œçº¢è‰²éƒ¨åˆ†çš„ ZOOKEEPER.")]),s._v(" "),t("p",[s._v("ZooKeeper ä¹Ÿæ˜¯ Java è¯­è¨€å†™çš„, ç›‘æ§ç›¸å¯¹ç®€å•, å¯ä»¥å¤ç”¨ä¸‹é¢ä»‹ç»çš„ "),t("strong",[s._v("JMX ç›‘æ§æ–¹å¼")]),s._v(", å¦å¤– ZooKeeper æ”¯æŒ mntr å››å­—å‘½ä»¤, å¯ä»¥è·å– ZooKeeper å†…éƒ¨å¥åº·çŠ¶å†µ. æ–°ç‰ˆ ZooKeeper è¿å››å­—å‘½ä»¤éƒ½ä¸éœ€è¦äº†, "),t("strong",[s._v("ç›´æ¥å†…ç½®æš´éœ²äº† Prometheus åè®®çš„ metrics æ¥å£, ç›´æ¥æŠ“å–å³å¯")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™é‡Œé‡ç‚¹å…³æ³¨ Broker èŠ‚ç‚¹çš„ç›‘æ§, ä¹Ÿå°±æ˜¯ "),t("strong",[s._v("Kafka è‡ªèº«çš„ç›‘æ§")]),s._v(", é€šå¸¸ä»å››ä¸ªæ–¹é¢ç€æ‰‹.")]),s._v(" "),t("ul",[t("li",[s._v("Kafka è¿›ç¨‹æ‰€åœ¨æœºå™¨çš„ç›‘æ§, è¿™ä¸ªå‚è€ƒå‰é¢çš„å†…å®¹, é‡ç‚¹å…³æ³¨ CPU, ç¡¬ç›˜ I/O, ç½‘ç»œ I/O.")]),s._v(" "),t("li",[s._v("JVM ç›‘æ§, Kafka æ˜¯ä¸ª Java è¿›ç¨‹, æ‰€ä»¥éœ€è¦"),t("strong",[s._v("å¸¸è§„çš„ JVM ç›‘æ§, é€šè¿‡ JMX æ–¹å¼æš´éœ²")]),s._v(".")]),s._v(" "),t("li",[s._v("Kafka è‡ªèº«çš„æŒ‡æ ‡, ä¹Ÿæ˜¯é€šè¿‡ JMX æ–¹å¼æš´éœ², æ¯”å¦‚æ¶ˆæ¯æ•°é‡, æµé‡, åˆ†åŒº, å‰¯æœ¬çš„æ•°é‡ç­‰.")]),s._v(" "),t("li",[s._v("å„ä¸ª consumer çš„ lag ç›‘æ§, å³æ¶ˆæ¯å †ç§¯é‡, æ˜¯å„ç±» MQ éƒ½åº”è¯¥ç›‘æ§çš„æŒ‡æ ‡.")])]),s._v(" "),t("p",[s._v("JVM å’Œ Kafka ç›¸å…³çš„æŒ‡æ ‡, éƒ½é€šè¿‡ JMX æ–¹å¼æš´éœ², å°±å…ˆæ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯ JMX, ä»¥åŠ Kafka å¦‚ä½•å¼€å¯ JMX.")]),s._v(" "),t("h4",{attrs:{id:"jmxç®€ä»‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jmxç®€ä»‹"}},[s._v("#")]),s._v(" JMXç®€ä»‹")]),s._v(" "),t("p",[s._v("**JMX(Java Management Extensions)æ˜¯ä¸€ä¸ªä¸ºåº”ç”¨ç¨‹åºæ¤å…¥ç®¡ç†åŠŸèƒ½çš„æ¡†æ¶. Java ç¨‹åºæ¥å…¥ JMX æ¡†æ¶ä¹‹å, å¯ä»¥æŠŠä¸€äº›ç±»çš„å±æ€§å’Œæ–¹æ³•æš´éœ²å‡ºæ¥, ç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨ JMX ç›¸å…³å·¥å…·æ¥è¯»å–æˆ–æ“ä½œè¿™äº›ç±». **")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ä¸€ä¸ªç±»æ˜¯ Person, æœ‰ Name å’Œ Age ä¸¤ä¸ªå±æ€§, å¦‚æœæŠŠ Person åšæˆä¸€ä¸ª MBean, å°±å¯ä»¥åœ¨ JConsole é‡Œç›´æ¥æŸ¥åˆ° Person å±æ€§çš„å€¼, ä¹Ÿå¯ä»¥ä¿®æ”¹è¿™äº›å±æ€§.")]),s._v(" "),t("p",[s._v("æ³¨: MBean è¢«ç®¡ç†çš„ Java å¯¹è±¡, JConsole æ˜¯ JMX çš„ä¸€ä¸ªç®¡ç†å·¥å…·.")]),s._v(" "),t("p",[s._v("å¯ä»¥é€šè¿‡ JConsole ç›´æ¥æ“ä½œ JavaBean, é‚£ JConsole å¯¹ JavaBean æ¥è¯´æ˜¯ä»€ä¹ˆ?")]),s._v(" "),t("p",[s._v("æ‰“ä¸ªæ¯”æ–¹, å…¶å®å°±åƒæ˜¯ PHPMyAdmin ä¹‹äº MySQL, å¯ä»¥é€šè¿‡ PHPMyAdmin ç›´æ¥æ“ä½œæ•°æ®åº“, è¿™æ ·æ›´å®¹æ˜“ç†è§£. å¦‚æœæ²¡æœ‰ç†è§£ä¹Ÿæ²¡å…³ç³», ä»ç›‘æ§çš„è§’åº¦, åªè¦çŸ¥é“å¦‚ä½•é€šè¿‡ JMX è¯»å– Kafka çš„æŒ‡æ ‡å³å¯. ä¸‹é¢å°±æ¥çœ‹ä¸€ä¸‹ "),t("strong",[s._v("Kafka å¦‚ä½•å¼€å¯ JMX ç«¯å£")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"kafkaå¼€å¯jmx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafkaå¼€å¯jmx"}},[s._v("#")]),s._v(" Kafkaå¼€å¯JMX")]),s._v(" "),t("p",[s._v("Kafka çš„é…ç½®æ–‡ä»¶åœ¨ config ç›®å½•, å„ç§è„šæœ¬åœ¨ bin ç›®å½•, è¦è®© Kafka å¼€å¯ JMX, è‚¯å®šæ˜¯è¦ä¿®æ”¹æŸä¸ªé…ç½®é¡¹æˆ–è€…è°ƒæ•´æŸä¸ªè„šæœ¬çš„, å…·ä½“è°ƒæ•´å“ªé‡Œå‘¢? åœ¨ Kafka çš„éƒ¨ç½²ç›®å½•æœç´¢ä¸€ä¸‹çœ‹çœ‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("grep -i jmx -r config\ngrep -i jmx -r bin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("åœ¨ config ç›®å½•æœç´¢ jmx å‘ç°ä»€ä¹ˆéƒ½æ‰¾ä¸åˆ°, çœ‹æ¥ä¸æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æ¥å¤„ç†çš„. åœ¨ bin ç›®å½•ä¸‹æœç´¢ jmx, å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªè„šæœ¬å‡ºç°äº†è¿™ä¸ªå…³é”®å­—, ä¸€ä¸ªæ˜¯ bin/kafka-run-class.sh, å¦ä¸€ä¸ªæ˜¯ bin/windows/kafka-run-class.bat. æ˜¾ç„¶ bat ç»“å°¾çš„æ–‡ä»¶æ˜¯ Windows ç¯å¢ƒçš„æ‰¹å¤„ç†æ–‡ä»¶, sh ç»“å°¾çš„æ‰æ˜¯ Linux, Mac ä¸‹ä½¿ç”¨çš„è„šæœ¬æ–‡ä»¶. æ‰“å¼€ kafka-run-class.sh çœ‹ä¸€ä¸‹é‡Œè¾¹çš„å…³é”®é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# JMX settings\nif "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$KAFKA_JMX_OPTS"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n  KAFKA_JMX_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false  -Dcom.sun.management.jmxremote.ssl=false "')]),s._v("\nfi\n\n# JMX port to use\nif "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  $JMX_PORT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n  KAFKA_JMX_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$KAFKA_JMX_OPTS -Dcom.sun.management.jmxremote.port=$JMX_PORT "')]),s._v("\nfi\n\n...\n\n# Launch mode\nif "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x$DAEMON_MODE"')]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xtrue"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n  nohup "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$JAVA"')]),s._v(" $KAFKA_HEAP_OPTS $KAFKA_JVM_PERFORMANCE_OPTS $KAFKA_GC_LOG_OPTS $KAFKA_JMX_OPTS $KAFKA_LOG4J_OPTS -cp "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$CLASSPATH"')]),s._v(" $KAFKA_OPTS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$@"')]),s._v(" > "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$CONSOLE_OUTPUT_FILE"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(">&"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" < /dev/"),t("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" &\nelse\n  exec "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$JAVA"')]),s._v(" $KAFKA_HEAP_OPTS $KAFKA_JVM_PERFORMANCE_OPTS $KAFKA_GC_LOG_OPTS $KAFKA_JMX_OPTS $KAFKA_LOG4J_OPTS -cp "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$CLASSPATH"')]),s._v(" $KAFKA_OPTS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$@"')]),s._v("\nfi\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[t("strong",[s._v("å¦‚æœ KAFKA_JMX_OPTS å˜é‡ä¸ºç©º, å°±ç»™å®ƒèµ‹å€¼, èµ‹å€¼çš„é‚£ä¸€è¡Œå†…å®¹, å®é™…å°±æ˜¯å¼€å¯ JMX çš„å…³é”®å‚æ•°")]),s._v(". å¦‚æœ JMX_PORT å˜é‡ä¸ä¸ºç©º, å°±å†åŠ ä¸Š -Dcom.sun.management.jmxremote.port è¿™ä¸ªå‚æ•°, é€šè¿‡æŸä¸ªç«¯å£æš´éœ² JMX æ•°æ®, æœ€åæŠŠ KAFKA_JMX_OPTS æ”¾åˆ°å¯åŠ¨å‘½ä»¤é‡Œ.")]),s._v(" "),t("p",[s._v("è¿™å°±å¾ˆæ¸…æ™°äº†, åªè¦å¯åŠ¨ Kafka ä¹‹å‰, åœ¨ç¯å¢ƒå˜é‡é‡ŒåµŒå…¥ JMX_PORT å˜é‡, Kafka å°±ä¼šç›‘å¬è¿™ä¸ªç«¯å£, æš´éœ² JMX æ•°æ®, ä¸‹é¢è¯•è¯•.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("export JMX_PORT="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3457")]),s._v("; ./bin/kafka-server-start.sh config/server.properties\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¯åŠ¨ä¹‹å, æ£€æŸ¥ Kafka çš„ç«¯å£ç›‘å¬, å°±ä¼šå‘ç°é™¤äº†åŸæœ¬ç›‘å¬çš„ 9092 ç«¯å£, ç°åœ¨ä¹Ÿç›‘å¬äº† 3457 ç«¯å£, ä½¿ç”¨ JConsole å·¥å…·è¿ä¸Šæ¥çœ‹çœ‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/3760f24d0d92d5d5db79edb58d8fbca5-20230719203435-15fxqpc.png",alt:""}})]),s._v(" "),t("p",[s._v("é€‰æ‹©è¿œç¨‹è¿›ç¨‹, è¾“å…¥ localhost:3457, ç„¶åç‚¹å‡»è¿æ¥, é€‰æ‹©ä¸å®‰å…¨çš„è¿æ¥, å°±è¿›å…¥äº† JConsole ä¸»é¡µé¢. é»˜è®¤è¿›æ¥æ˜¯æ¦‚è§ˆé¡µé¢, é€‰æ‹© "),t("strong",[s._v("MBean")]),s._v(", å·¦ä¾§å°±çœ‹åˆ°äº†ä¸€ä¸ªæ ‘å½¢ç»“æ„çš„å¤šä¸ªå¯¹è±¡. ä¸¾ä¸ªä¾‹å­, ä¾æ¬¡ç‚¹å‡» kafka.server, ReplicaManager, OfflineReplicaCount, å³ä¾§ä¼šå±•ç¤º MBeanInfo, é‡Œè¾¹å°¤å…¶è¦æ³¨æ„çš„æ˜¯ ObjectName, åé¢è·å– JMX æ•°æ®çš„æ—¶å€™, ä¼šé¢‘ç¹ç”¨åˆ°è¿™ä¸ªå±æ€§.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/638d5f5c37f17d920e036dd14fcf33a6-20230719203435-ric1968.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[t("strong",[s._v("OfflineReplicaCount")]),s._v(" æ˜¯ Broker çš„ä¸€ä¸ªå…³é”®æŒ‡æ ‡, ç‚¹å‡»ä¸‹é¢çš„å±æ€§, å°±å¯ä»¥çœ‹åˆ°å…·ä½“çš„å€¼.")]),s._v(" "),t("p",[s._v("é€šè¿‡ JConsole çš„é¡µé¢ç¡®å®å¯ä»¥æŸ¥åˆ°å„ä¸ªç›‘æ§æŒ‡æ ‡çš„æ•°æ®, ä½†çœŸæ­£å’Œç›‘æ§ç³»ç»Ÿå¯¹æ¥çš„è¯, è¿˜æ˜¯éœ€è¦ä½¿ç”¨"),t("strong",[s._v("ç¼–ç¨‹çš„æ–¹å¼")]),s._v("æ¥è·å–. "),t("strong",[s._v("JMX çš„ç«¯å£èµ°çš„æ˜¯ RMI åè®®")]),s._v(", æ˜¯ Java ç‹¬æœ‰çš„ RPC åè®®, å…¶ä»–è¯­è¨€æ²¡æ³•è°ƒç”¨. å¥½åœ¨æœ‰å·¥å…·å¯ä»¥æŠŠå®ƒè½¬ä¸º HTTP åè®®, å¸¸è§çš„å·¥å…·æœ‰ä¸¤ä¸ª, ä¸€ä¸ªæ˜¯ Prometheus ç”Ÿæ€çš„ "),t("a",{attrs:{href:"https://github.com/prometheus/jmx_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("jmxexporterjavaagent"),t("OutboundLink")],1),s._v(", ä¸€ä¸ªæ˜¯ "),t("a",{attrs:{href:"https://jolokia.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Jolokia"),t("OutboundLink")],1),s._v(". Jolokia ä¹Ÿæ˜¯ä¸ª JavaAgent, jmx_exporter å¯ä»¥æŠŠ JMX æŒ‡æ ‡å¯¼å‡ºä¸º Prometheus metrics æ ¼å¼, Jolokia å¯ä»¥æŠŠ JMX æŒ‡æ ‡å¯¼å‡ºä¸º JSON æ ¼å¼, å·®åˆ«ä¸å¤§.")]),s._v(" "),t("p",[s._v("ä¸è¿‡ Kafka æš´éœ²çš„ JMX æŒ‡æ ‡å®åœ¨æ˜¯å¤ªå¤šäº†, å¦‚æœä¸è¿‡æ»¤å…¨éƒ¨å¯¼å‡º, æ¯ä¸ª Broker è½»è½»æ¾æ¾å°±å‡ ä¸‡ä¸ªJMX æŒ‡æ ‡, å¤§å‹äº’è”ç½‘å…¬å¸çš„è¯, åŸºæœ¬ä¸Šéƒ½æœ‰å‡ ç™¾ä¸ª Broker, è¿™ä¸ªé‡å°±æœ‰ç‚¹å„¿å¤§äº†.")]),s._v(" "),t("p",[s._v("è¿‡æ»¤æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§, "),t("strong",[s._v("ä¸€ç§æ˜¯è¿‡æ»¤ MBean")]),s._v(", é€šè¿‡ç™½åå•çš„æ–¹å¼æŒ‡å®š, è¿™äº› MBean é‡‡é›†çš„æ•°æ®å¦‚æœæœ‰äº›è¿˜ä¸æƒ³è¦, å°±åšäºŒæ¬¡è¿‡æ»¤, é€šè¿‡é»‘åå•çš„æ–¹å¼æŒ‡å®š, æ¯”å¦‚æ ¹æ®æŒ‡æ ‡åå­—åšè¿‡æ»¤. jmx_exporter æŒ‡å®š MBean è¿‡æ»¤è§„åˆ™æ˜¯é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶å®ç°çš„, å¦‚æœè¿™ä¸ªé…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–, å°±è¦é‡å¯ Java è¿›ç¨‹, åŠ¨ä½œæœ‰ç‚¹å„¿é‡.")]),s._v(" "),t("p",[s._v("è€Œ Jolokia çš„è¿‡æ»¤è§„åˆ™éƒ½å¯ä»¥åœ¨é‡‡é›†å™¨ agent ä¾§å®ç°, ä¿®æ”¹è¿‡æ»¤è§„åˆ™åªéœ€è¦é‡å¯é‡‡é›†å™¨å³å¯, ä¸éœ€è¦é‡å¯è¦ç›‘æ§çš„ Java è¿›ç¨‹, åŠ¨ä½œç›¸å¯¹è½»ä¸€äº›. ä¸‹é¢å°±æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä¸º Kafka å¼•å…¥ Jolokia æ”¯æŒ.")]),s._v(" "),t("h4",{attrs:{id:"kafkaå¼€å¯jolokia"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafkaå¼€å¯jolokia"}},[s._v("#")]),s._v(" Kafkaå¼€å¯Jolokia")]),s._v(" "),t("p",[s._v("é¦–å…ˆä¸‹è½½ Jolokia çš„ "),t("a",{attrs:{href:"https://download.flashcat.cloud/jolokia-jvm-1.6.2-agent.jar.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("javaagent jar åŒ…"),t("OutboundLink")],1),s._v(", è§£å‹åˆ° /opt/jolokia ç›®å½•ä¸‹. ç„¶ååœ¨ kafka-run-class.sh æ‰¾åˆ° JMX ç›¸å…³çš„é…ç½®, åœ¨ JMX_PORT ç›¸å…³é€»è¾‘ä¸‹é¢å¢åŠ ä¸‰è¡Œ.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# JMX settings\nif "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$KAFKA_JMX_OPTS"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n  KAFKA_JMX_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false  -Dcom.sun.management.jmxremote.ssl=false "')]),s._v("\nfi\n\n# JMX port to use\nif "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  $JMX_PORT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n  KAFKA_JMX_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$KAFKA_JMX_OPTS -Dcom.sun.management.jmxremote.port=$JMX_PORT "')]),s._v("\nfi\n\n########## adding lines\nif "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x$JOLOKIA"')]),s._v(" != "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n  KAFKA_JMX_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$KAFKA_JMX_OPTS -javaagent:/opt/jolokia/jolokia-jvm-1.6.2-agent.jar=host=0.0.0.0,port=3456"')]),s._v("\nfi\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("ä¾‹å­é‡Œçš„ 3456 æ˜¯ Jolokia ç›‘å¬çš„ç«¯å£, å¯ä»¥æ¢æˆåˆ«çš„, åªè¦åˆ«è·Ÿæœºå™¨ä¸Šçš„å…¶ä»–ç«¯å£å†²çªå°±è¡Œ. åŠ äº†ä¸€ä¸ª JOLOKIA å˜é‡çš„åˆ¤æ–­, å¦‚æœè¿™ä¸ªå˜é‡ä¸ä¸ºç©º, å°±å¼€å¯ Jolokia; å¦‚æœå˜é‡ä¸ºç©ºå°±ä¸å¼€å¯, æ–¹ä¾¿åœ¨å¤–éƒ¨æ§åˆ¶. æ­¤æ—¶å¯ä»¥é‡æ–°å¯åŠ¨ Kafka.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("export JOLOKIA="),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("; export JMX_PORT="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3457")]),s._v("; nohup ./bin/kafka-server-start.sh config/server.properties &> stdout.log &\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("éªŒè¯ Jolokia æ˜¯å¦åœ¨æ­£å¸¸å·¥ä½œ, è¯·æ±‚å…¶ /jolokia/version æ¥å£å³å¯. ä¸‹é¢æ˜¯è¯·æ±‚ç¤ºä¾‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# curl -s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.206")]),s._v("."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.8")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3456")]),s._v("/jolokia/version | jq .\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"request"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"value"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"agent"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.6.2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"protocol"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"config"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"listenForHttpService"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"maxCollectionSize"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"authIgnoreCerts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"agentId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.206.16.8-2012615-50134894-jvm"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"debug"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"agentType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jvm"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"policyLocation"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"classpath:/jolokia-access.xml"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"agentContext"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/jolokia"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"serializeException"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"mimeType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/plain"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"maxDepth"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"15"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"authMode"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"basic"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"authMatch"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"any"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"discoveryEnabled"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"streaming"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"canonicalNaming"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"historyMaxEntries"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"allowErrorDetails"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"allowDnsReverseLookup"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"realm"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jolokia"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"includeStackTrace"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"maxObjects"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"useRestrictorService"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"debugMaxEntries"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"info"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"product"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jetty"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"vendor"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Eclipse"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.4.43.v20210629"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"timestamp"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1669277907")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"status"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("p",[s._v("ä¸Šé¢è¿”å›çš„å†…å®¹è¡¨ç¤º Jolokia åœ¨æ­£å¸¸å·¥ä½œ, ä¸‹é¢å°±å¯ä»¥"),t("strong",[s._v("ä½¿ç”¨ç›‘æ§ agent æ¥é‡‡é›† Jolokia çš„æ•°æ®")]),s._v("äº†. "),t("strong",[s._v("JMX æ•°æ®åˆ†ä¸¤ç±», ä¸€ç±»æ˜¯å’Œ JVM ç›¸å…³çš„, ä¸€ç±»æ˜¯å’Œ Kafka ç›¸å…³")]),s._v("çš„.")]),s._v(" "),t("h4",{attrs:{id:"jvmæŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvmæŒ‡æ ‡"}},[s._v("#")]),s._v(" JVMæŒ‡æ ‡")]),s._v(" "),t("p",[s._v("å…ˆæ¥çœ‹ä¸€ä¸‹ JVM ç›¸å…³çš„é‡‡é›†è§„åˆ™.")]),s._v(" "),t("p",[s._v("Categraf çš„é…ç½®ç›®å½• conf ä¸‹é¢, é»˜è®¤æœ‰ä¸€ä¸ª input.jolokia_agent_kafka çš„ç›®å½•, æ”¾ç½®äº† Kafka çš„ Jolokia æ‹‰å–è§„åˆ™çš„æ ·ä¾‹. æŠŠ input.jolokia_agent_kafka é‡å‘½åä¸º input.jolokia_agent, ç„¶åä¿®æ”¹æ­¤ç›®å½•ä¸‹é¢çš„ kafka.toml, é‡ç‚¹å…³æ³¨ urls å’Œ labels ä¸¤ä¸ªé…ç½®.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nurls = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:3456/jolokia"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlabels = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" cluster = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kafka-cluster-demo"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™é‡Œå»ºè®®ç”¨ Categraf é‡‡é›†æœ¬æœºçš„ Kafka, å¹¶ä¸ºé‡‡é›†çš„æ•°æ®é™„åŠ ä¸€ä¸ªåä¸º cluster çš„æ ‡ç­¾. å› ä¸ºä¸€ä¸ªå…¬å¸é€šå¸¸æœ‰å¤šä¸ª Kafka é›†ç¾¤, ä½¿ç”¨ cluster æ ‡ç­¾å¯ä»¥åšå‡ºåŒºåˆ†. é€šè¿‡ test å‚æ•°æµ‹è¯•ä¸€ä¸‹é‡‡é›†çš„æŒ‡æ ‡æ˜¯å¦æ­£å¸¸.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("./categraf --test --inputs jolokia_agent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æœè¾“å‡ºå¤§é‡çš„æŒ‡æ ‡, å°±è¯´æ˜é‡‡é›†é€»è¾‘æ˜¯æ­£å¸¸çš„, ç¨ç­‰ç‰‡åˆ», é‡å¯ Categraf, å†å»ç›‘æ§ç³»ç»ŸæŸ¥è¯¢ä¸€ä¸‹, çœ‹çœ‹æ•°æ®æ˜¯å¦æ­£å¸¸ä¸ŠæŠ¥äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6232732758e3d64f9ba42c1d9ce497c4-20230719203435-hk4j0gh.png",alt:""}})]),s._v(" "),t("p",[s._v("çœ‹ä¸‹å›¾ä¸­çš„æŒ‡æ ‡, ThreadCount è¡¨ç¤º JVM é‡Œçš„çº¿ç¨‹æ•°, ç±»ä¼¼çš„è¿˜æœ‰ DaemonThreadCount, è¡¨ç¤ºåå°çº¿ç¨‹æ•°, PeakThreadCount è¡¨ç¤ºå†å²å³°å€¼çº¿ç¨‹æ•°. JVM è¦é‡ç‚¹å…³æ³¨ GC çš„æƒ…å†µå’Œå†…å­˜çš„æƒ…å†µ, çœ‹ä¸‹ç›¸å…³æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("GC ä¸»è¦çœ‹æ¬¡æ•°å’Œæ—¶é—´, åˆ†ä¸º YongGC å’Œ FullGC, YongGC å¾ˆæ­£å¸¸, é¢‘ç‡ä¹Ÿæ¯”è¾ƒé«˜, FullGC æ­£å¸¸æƒ…å†µä¸‹å¾ˆå°‘å‘ç”Ÿ, å¦‚æœç»å¸¸å‘ç”Ÿ, FullGC ç¨‹åºçš„æ€§èƒ½å°±ä¼šå—å½±å“. GC æ¬¡æ•°çš„æŒ‡æ ‡æ˜¯ kafka_java_garbage_collector_CollectionCount, æ˜¯ä¸€ä¸ª Counter ç±»å‹å•è°ƒé€’å¢çš„å€¼. GC æ—¶é—´çš„æŒ‡æ ‡æ˜¯ kafka_java_garbage_collector_CollectionTime, ä¹Ÿæ˜¯ä¸€ä¸ª Counter ç±»å‹å•è°ƒé€’å¢çš„å€¼. è¿™ç±»æŒ‡æ ‡é€šå¸¸ä½¿ç”¨ increase æˆ– irate å‡½æ•°è®¡ç®—å¢é‡æˆ–é€Ÿç‡, ä¸å…³å¿ƒå½“å‰å€¼æ˜¯å¤šå°‘.")]),s._v(" "),t("p",[s._v("å†…å­˜çš„æŒ‡æ ‡æ˜¯ kafka_java_memory_pool_Usage_used, å•ä½æ˜¯ byte. æœ‰ä¸ª name æ ‡ç­¾æ ‡è¯†äº†å…·ä½“æ˜¯å“ªä¸ªåŒºåŸŸçš„å†…å­˜å¤§å°, æ¯”å¦‚ Eden åŒº, Survivor åŒº, Old åŒº. ä¸‹é¢ä»ªè¡¨ç›˜çš„ä¸­é—´éƒ¨åˆ†, å°±æ˜¯è¿™ä¸ªå†…å­˜æŒ‡æ ‡, å˜åŒ–æ¯”è¾ƒå‰§çƒˆçš„æ˜¯ Eden åŒº, æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼š GC ä¸€æ¬¡, Eden åŒºçš„å†…å­˜ä½¿ç”¨é‡å°±ä¼šé™ä¸‹æ¥, è¿‡æ®µæ—¶é—´åˆä¼šéšç€ä½¿ç”¨è€Œä¸Šå‡, ç„¶åå†æ¬¡ GC, é‡åˆä¼šé™ä¸‹æ¥, å¾ªç¯å¾€å¤.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c969cb5166a66c3a6a02f907c9f2fc18-20230719203435-4y6nmgc.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("æ‰€æœ‰ Java ç±»ç¨‹åº, éƒ½éœ€è¦å…³æ³¨è¿™äº› JVM çš„æŒ‡æ ‡")]),s._v(", ç›¸å…³æŒ‡æ ‡çš„é‡‡é›†æ–¹æ³•åœ¨ kafka.toml ä¸­æœ‰æ ·ä¾‹, å°±æ˜¯è¿™äº› java.lang æ‰“å¤´çš„ MBean.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.metric"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name  = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java_runtime"')]),s._v("\n  mbean = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.lang:type=Runtime"')]),s._v("\n  paths = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Uptime"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.metric"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name  = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java_memory"')]),s._v("\n  mbean = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.lang:type=Memory"')]),s._v("\n  paths = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HeapMemoryUsage"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NonHeapMemoryUsage"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ObjectPendingFinalizationCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.metric"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name     = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java_garbage_collector"')]),s._v("\n  mbean    = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.lang:name=*,type=GarbageCollector"')]),s._v("\n  paths    = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CollectionTime"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CollectionCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  tag_keys = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.metric"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name  = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java_last_garbage_collection"')]),s._v("\n  mbean = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.lang:name=G1 Young Generation,type=GarbageCollector"')]),s._v("\n  paths = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LastGcInfo/duration"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  # paths = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LastGcInfo/duration"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LastGcInfo/GcThreadCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LastGcInfo/memoryUsageAfterGc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.metric"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name  = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java_threading"')]),s._v("\n  mbean = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.lang:type=Threading"')]),s._v("\n  paths = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TotalStartedThreadCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ThreadCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DaemonThreadCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PeakThreadCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.metric"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name  = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java_class_loading"')]),s._v("\n  mbean = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.lang:type=ClassLoading"')]),s._v("\n  paths = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LoadedClassCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UnloadedClassCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TotalLoadedClassCount"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances.metric"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name     = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java_memory_pool"')]),s._v("\n  mbean    = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.lang:name=*,type=MemoryPool"')]),s._v("\n  paths    = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PeakUsage"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CollectionUsage"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  tag_keys = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("p",[s._v("åˆ°è¿™é‡Œ, JVM çš„å¸¸è§„æŒ‡æ ‡å°±è®²å®Œäº†. å¦‚æœæƒ³é‡‡é›†å…¶ä»–æŒ‡æ ‡, å¯ä»¥ä½¿ç”¨ JConsole è¿åˆ° JMX ç«¯å£, æŸ¥çœ‹ç›¸å…³ MBean çš„ä¿¡æ¯, åœ¨ Categraf é‡Œæ–°å¢ "),t("code",[s._v("[[instances.metric]]")]),s._v("â€‹ çš„é…ç½®å³å¯.")]),s._v(" "),t("h4",{attrs:{id:"kafkaæŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafkaæŒ‡æ ‡"}},[s._v("#")]),s._v(" KafkaæŒ‡æ ‡")]),s._v(" "),t("p",[s._v("kafka.toml ä¸­è¿˜æœ‰å¾ˆå¤š Kafka Broker çš„ JMX æŒ‡æ ‡. ç„¶è€Œ Kafka çš„æŒ‡æ ‡å®åœ¨æ˜¯å¤ªå¤šäº†, å…¶ä¸­æœ‰äº›æŒ‡æ ‡åªæ˜¯ä¸ºäº†è°ƒè¯•è€Œè®¾ç½®çš„. å“ªäº›æŒ‡æ ‡æ›´ä¸ºå…³é”®, åº”è¯¥é…ç½®å‘Šè­¦, å“ªäº›åº”è¯¥æ”¾åˆ°ä»ªè¡¨ç›˜é‡Œ, å“ªäº›å‹æ ¹å°±æ— éœ€å…³æ³¨, æ¯”è¾ƒéš¾æ¢³ç†, å¥½åœ¨ç›®å‰è¿™æ–¹é¢çš„èµ„æ–™æ¯”è¾ƒä¸°å¯Œ, ä¸€å®šç¨‹åº¦ä¸Šæ˜¯æœ‰å…±è¯†çš„, ä¸‹é¢å°±æ¥è®²ä¸€ä¸‹è¿™äº›å…±è¯†æ€§çš„å…³é”®æŒ‡æ ‡.")]),s._v(" "),t("h5",{attrs:{id:"_1-æ´»è·ƒæ§åˆ¶å™¨æ•°é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ´»è·ƒæ§åˆ¶å™¨æ•°é‡"}},[s._v("#")]),s._v(" 1.æ´»è·ƒæ§åˆ¶å™¨æ•°é‡")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: broker kafka.controller:type=KafkaController,name=ActiveControllerCount")])]),s._v(" "),t("p",[s._v("ä¸€ä¸ª Kafka é›†ç¾¤æœ‰å¤šä¸ª Broker, æ­£å¸¸æ¥è®²å…¶ä¸­ä¸€ä¸ª Broker ä¼šæ˜¯æ´»è·ƒæ§åˆ¶å™¨, ä¸”åªèƒ½æœ‰ä¸€ä¸ª. ä»æ•´ä¸ªé›†ç¾¤è§’åº¦æ¥çœ‹, SUM æ‰€æœ‰ Broker çš„è¿™ä¸ªæŒ‡æ ‡, ç»“æœåº”è¯¥ä¸º 1. å¦‚æœ SUM çš„ç»“æœä¸º 2, ä¹Ÿå°±æ˜¯è¯´, æœ‰ä¸¤ä¸ª Broker éƒ½è®¤ä¸ºè‡ªå·±æ˜¯æ´»è·ƒæ§åˆ¶å™¨. è¿™å¯èƒ½æ˜¯ç½‘ç»œåˆ†åŒºå¯¼è‡´çš„, éœ€è¦é‡å¯ Kafka Broker è¿›ç¨‹. å¦‚æœé‡å¯äº†ä¸å¥½ä½¿, å¯èƒ½æ˜¯ä¾èµ–çš„ ZooKeeper å‡ºç°äº†ç½‘ç»œåˆ†åŒº, éœ€è¦å…ˆå»è§£å†³ ZooKeeper çš„é—®é¢˜, ç„¶åé‡å¯ Broker è¿›ç¨‹.")]),s._v(" "),t("h5",{attrs:{id:"_2-éåŒæ­¥åˆ†åŒºæ•°é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-éåŒæ­¥åˆ†åŒºæ•°é‡"}},[s._v("#")]),s._v(" 2.éåŒæ­¥åˆ†åŒºæ•°é‡")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: kafka.server:type=ReplicaManager,name=UnderReplicatedPartitions")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæŒ‡æ ‡æ˜¯å¯¹æ¯ä¸ª Topic çš„æ¯ä¸ªåˆ†åŒºçš„ç»Ÿè®¡, å¦‚æœæŸä¸ªåˆ†åŒºä¸»ä»åŒæ­¥å‡ºç°é—®é¢˜, å¯¹åº”çš„æ•°å€¼å°±ä¼šå¤§äº 0. å¸¸è§çš„åŸå› æ¯”å¦‚æŸä¸ª Broker å‡ºé—®é¢˜äº†, ä¸€èˆ¬æ˜¯ Kafka è¿›ç¨‹é—®é¢˜æˆ–è€…æ‰€åœ¨æœºå™¨çš„ç¡¬ä»¶é—®é¢˜, é‚£ä¹ˆè·Ÿè¿™ä¸ª Broker ç›¸å…³çš„åˆ†åŒºå°±å…¨éƒ¨éƒ½æœ‰é—®é¢˜, è¿™ä¸ªæ—¶å€™å‡ºé—®é¢˜çš„åˆ†åŒºæ•°é‡å¤§è‡´æ˜¯æ’å®šçš„. å¦‚æœå‡ºé—®é¢˜çš„åˆ†åŒºæ•°é‡ä¸æ’å®š, å¯èƒ½æ˜¯é›†ç¾¤æ€§èƒ½é—®é¢˜å¯¼è‡´çš„, éœ€è¦æ£€æŸ¥ç¡¬ç›˜ I/O, CPU ä¹‹ç±»çš„æŒ‡æ ‡.")]),s._v(" "),t("h5",{attrs:{id:"_3-ç¦»çº¿åˆ†åŒºæ•°é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç¦»çº¿åˆ†åŒºæ•°é‡"}},[s._v("#")]),s._v(" 3.ç¦»çº¿åˆ†åŒºæ•°é‡")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: kafka.controller:type=KafkaController,name=OfflinePartitionsCount")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæŒ‡æ ‡åªæœ‰é›†ç¾¤æ§åˆ¶å™¨æ‰æœ‰, å…¶ä»– Broker è¿™ä¸ªæŒ‡æ ‡çš„å€¼æ˜¯ 0, è¡¨ç¤ºé›†ç¾¤é‡Œæ²¡æœ‰ leader çš„åˆ†åŒºæ•°é‡. Kafka ä¸»è¦é  leader å‰¯æœ¬æä¾›è¯»å†™èƒ½åŠ›, å¦‚æœæœ‰äº›åˆ†åŒºæ²¡æœ‰ leader å‰¯æœ¬äº†, æ˜¾ç„¶å°±æ— æ³•è¯»å†™äº†, æ˜¯ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜.")]),s._v(" "),t("h5",{attrs:{id:"_4-ç¦»çº¿æ—¥å¿—ç›®å½•æ•°é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç¦»çº¿æ—¥å¿—ç›®å½•æ•°é‡"}},[s._v("#")]),s._v(" 4.ç¦»çº¿æ—¥å¿—ç›®å½•æ•°é‡")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: kafka.log:type=LogManager,name=OfflineLogDirectoryCount")])]),s._v(" "),t("p",[s._v('Kafka æ˜¯æŠŠæ”¶åˆ°çš„æ¶ˆæ¯å­˜å…¥ log ç›®å½•, å¦‚æœ log ç›®å½•æœ‰é—®é¢˜, æ¯”å¦‚å†™æ»¡äº†, å°±ä¼šè¢«ç½®ä¸º Offline, åŠæ—¶ç›‘æ§ç¦»çº¿æ—¥å¿—ç›®å½•çš„æ•°é‡æ˜¾ç„¶éå¸¸æœ‰å¿…è¦. å¦‚æœè¿™ä¸ªå€¼å¤§äº 0, æƒ³è¿›ä¸€æ­¥çŸ¥é“å…·ä½“æ˜¯å“ªä¸ªç›®å½•å‡ºé—®é¢˜äº†, å¯ä»¥æŸ¥è¯¢ MBean: kafka.log:type=LogManager,name=LogDirectoryOffline,logDirectory=*", LogDirectory å­—æ®µä¼šæ ‡æ˜å…·ä½“æ˜¯å“ªä¸ªç›®å½•.')]),s._v(" "),t("h5",{attrs:{id:"_5-æµå…¥æµå‡ºå­—èŠ‚å’Œæµå…¥æ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-æµå…¥æµå‡ºå­—èŠ‚å’Œæµå…¥æ¶ˆæ¯"}},[s._v("#")]),s._v(" 5.æµå…¥æµå‡ºå­—èŠ‚å’Œæµå…¥æ¶ˆæ¯")]),s._v(" "),t("p",[s._v("è¿™æ˜¯å…¸å‹çš„ååæŒ‡æ ‡, æ—¢æœ‰ Broker ç²’åº¦çš„, ä¹Ÿæœ‰ Topic ç²’åº¦çš„, åå­—éƒ½ä¸€æ ·, Topic ç²’åº¦çš„æŒ‡æ ‡æ•°æ® MBean ObjectName ä¼šå¤šä¸€ä¸ª topic=xx çš„åç¼€.")]),s._v(" "),t("h5",{attrs:{id:"_6-æµå…¥å­—èŠ‚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-æµå…¥å­—èŠ‚"}},[s._v("#")]),s._v(" 6.æµå…¥å­—èŠ‚")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæŒ‡æ ‡ Kafka åœ¨ä½¿ç”¨ Yammer Metrics åŸ‹ç‚¹çš„æ—¶å€™, è®¾ç½®ä¸ºäº† Meter ç±»å‹, æ‰€ä»¥ Yammer ä¼šè‡ªåŠ¨è®¡ç®—å‡º Count, OneMinuteRate, FiveMinuteRate, FifteenMinuteRate, MeanRate ç­‰æŒ‡æ ‡, ä¹Ÿå°±æ˜¯ 1 åˆ†é’Ÿ, 5 åˆ†é’Ÿ, 15 åˆ†é’Ÿå†…çš„å¹³å‡æµå…¥é€Ÿç‡, ä»¥åŠæ•´ä½“å¹³å‡æµå…¥é€Ÿç‡. è€Œ Count è¡¨ç¤ºæ€»é‡, å¦‚æœæ—¶åºåº“æ”¯æŒ PromQL, å°±åªé‡‡é›† Count, å…¶ä»–çš„ä¸ç”¨é‡‡é›†, åé¢ä½¿ç”¨ PromQL å¯¹ Count å€¼åš irate è®¡ç®—å³å¯.")]),s._v(" "),t("h5",{attrs:{id:"_7-æµå‡ºå­—èŠ‚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-æµå‡ºå­—èŠ‚"}},[s._v("#")]),s._v(" 7.æµå‡ºå­—èŠ‚")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec")])]),s._v(" "),t("p",[s._v("å’Œ BytesInPerSec ç±»ä¼¼, è¡¨ç¤ºå‡ºå‘æµé‡. ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯, æµå‡ºå­—èŠ‚é™¤äº†æ™®é€šæ¶ˆè´¹è€…çš„æ¶ˆè´¹æµé‡, ä¹ŸåŒ…å«äº†å‰¯æœ¬åŒæ­¥æµé‡.")]),s._v(" "),t("h5",{attrs:{id:"_8-æµå…¥æ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-æµå…¥æ¶ˆæ¯"}},[s._v("#")]),s._v(" 8.æµå…¥æ¶ˆæ¯")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec")])]),s._v(" "),t("p",[s._v("BytesInPerSec å’Œ BytesOutPerSec éƒ½æ˜¯ä»¥ byte ä¸ºå•ä½ç»Ÿè®¡çš„, è€Œ MessagesInPerSec æ˜¯ä»¥æ¶ˆæ¯ä¸ªæ•°ä¸ºå•ä½ç»Ÿè®¡çš„, ä¹Ÿæ˜¯ Meter ç±»å‹, ç›¸å…³å±æ€§éƒ½ä¸€æ ·.")]),s._v(" "),t("p",[s._v('éœ€è¦è§£é‡Šä¸€ä¸‹çš„æ˜¯, Kafka ä¸æä¾› MessagesOutPerSec, ä½ å¯èƒ½è§‰å¾—æœ‰ç‚¹å„¿å¥‡æ€ª, æœ‰å…¥å°±å¾—æœ‰å‡ºæ‰æ­£å¸¸å˜›. è¿™æ˜¯å› ä¸ºæ¶ˆæ¯è¢«æ‹‰å–çš„æ—¶å€™, Broker ä¼šæŠŠæ•´ä¸ª"æ¶ˆæ¯æ‰¹æ¬¡"å‘é€ç»™æ¶ˆè´¹è€…, å¹¶ä¸ä¼šå±•å¼€"æ‰¹æ¬¡", ä¹Ÿå°±æ²¡æ³•è®¡ç®—å…·ä½“æœ‰å¤šå°‘æ¡æ¶ˆæ¯äº†.')]),s._v(" "),t("h5",{attrs:{id:"_9-åˆ†åŒºæ•°é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-åˆ†åŒºæ•°é‡"}},[s._v("#")]),s._v(" 9.åˆ†åŒºæ•°é‡")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: kafka.server:type=ReplicaManager,name=PartitionCount")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæŒ‡æ ‡è¡¨ç¤ºæŸä¸ª Broker ä¸Šé¢æ€»å…±æœ‰å¤šå°‘ä¸ªåˆ†åŒº, åŒ…æ‹¬ leader åˆ†åŒºå’Œ follower åˆ†åŒº. å¦‚æœå¤šä¸ª Broker åˆ†åŒºä¸å‡è¡¡, å¯èƒ½ä¼šé€ æˆæœ‰äº› Broker æ¶ˆè€—ç¡¬ç›˜ç©ºé—´è¿‡å¿«, è¿™æ˜¯éœ€è¦æ³¨æ„çš„.")]),s._v(" "),t("h5",{attrs:{id:"_10-leaderåˆ†åŒºæ•°é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-leaderåˆ†åŒºæ•°é‡"}},[s._v("#")]),s._v(" 10.leaderåˆ†åŒºæ•°é‡")]),s._v(" "),t("blockquote",[t("p",[s._v("MBean: kafka.server:type=ReplicaManager,name=LeaderCount")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæŒ‡æ ‡è¡¨ç¤ºæŸä¸ª Broker ä¸Šé¢æ€»å…±æœ‰å¤šå°‘ä¸ª leader åˆ†åŒº, leader åˆ†åŒºè´Ÿè´£æ•°æ®è¯»å†™, æ‰¿æ¥æµé‡, æ‰€ä»¥ leader åˆ†åŒºå¦‚æœä¸å‡è¡¡, ä¼šå¯¼è‡´æŸäº› Broker è¿‡åˆ†ç¹å¿™è€Œå¦ä¸€äº› Broker è¿‡åˆ†ç©ºé—², è¿™ç§æƒ…å†µä¹Ÿæ˜¯éœ€è¦æ³¨æ„çš„.")]),s._v(" "),t("p",[s._v("é’ˆå¯¹ä»¥ä¸Šå…³é”®æŒ‡æ ‡çš„å‚è€ƒ"),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/kafka/dashboard-key-metrics.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä»ªè¡¨ç›˜"),t("OutboundLink")],1),s._v("å¦‚ä¸‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/63e093297a9a094fb706e9660a9f0e5a-20230719203435-gfl9nny.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"lagç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lagç›‘æ§"}},[s._v("#")]),s._v(" Lagç›‘æ§")]),s._v(" "),t("p",[s._v("æœ€åä¸€ä¸ªå…³é”®ç‚¹æ˜¯ "),t("strong",[s._v("consumer lag ç›‘æ§")]),s._v(", ä¿—ç§°"),t("strong",[s._v("æ¶ˆæ¯é˜Ÿåˆ—å †ç§¯")]),s._v(", ä¸€èµ·æ¥çœ‹ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("æ¯ä¸ª Topic ä¼šåˆ†æˆå¤šä¸ª Partition, æ¯ä¸ª Partition éƒ½æœ‰ä¸€ä¸ªå½“å‰çš„ offset, è¡¨ç¤ºç”Ÿäº§çš„æ¶ˆæ¯å·²ç»å †ç§¯åˆ°äº†ä»€ä¹ˆä½ç½®. æ¯ä¸ª Partition å¯ä»¥è¢«å¤šä¸ª consumergroup æ¶ˆè´¹, consumergroup æ¶ˆè´¹çš„æ—¶å€™, é’ˆå¯¹æŸä¸ª Partition ä¹Ÿä¼šæœ‰ä¸€ä¸ª offset è¡¨ç¤ºæ¶ˆè´¹ä½ç½®. ç”Ÿäº§è€…çš„ offset å‡å» consumergroup çš„ offset, å°±è¡¨ç¤ºæ»åé‡.")]),s._v(" "),t("p",[t("strong",[s._v("è¿™ä¸ªæ»åé‡å¦‚æœè¿‡å¤§, å°±è¡¨ç¤ºæ¶ˆè´¹è€…å¯èƒ½é‡åˆ°äº†é—®é¢˜")]),s._v(", æ²¡æœ‰åŠæ—¶å¹²æ´», è¿™æ˜¯ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜. æ¯”å¦‚ç›‘æ§æ•°æ®å¯¹å³æ—¶æ€§è¦æ±‚å°±å¾ˆé«˜, å¦‚æœé€šè¿‡ Kafka ä¼ è¾“ç›‘æ§æ•°æ®, ä½†æ»åé‡å¾ˆå¤§, æœ€åå‘ˆç°ç»™ç”¨æˆ·çš„å›¾è¡¨å¯èƒ½æ˜¯å‡ åˆ†é’Ÿä¹‹å‰çš„æ•°æ®, é‚£æ„ä¹‰å°±ä¸å¤§äº†.")]),s._v(" "),t("p",[s._v("ç›‘æ§ Lag æ•°æ®æœ‰ä¸¤ä¸ªåŠæ³•, ä¸€ä¸ªæ˜¯ä» consumer çš„ JMX ä¸­è·å–, ä¸è¿‡åªæœ‰ Java çš„ç¨‹åºæ‰èƒ½è¿™ä¹ˆåš; ä¸€ä¸ªæ˜¯é€šè¿‡ç½‘ç»œä¸Šçš„ä¸€äº›  "),t("strong",[s._v("Exporter è·å–")]),s._v(", å› ä¸º Lag æ•°æ®å¤ªé‡è¦äº†, æ‰€ä»¥æœ‰äººä¸“é—¨å†™äº† Exporter æ¥é‡‡é›†. å¾ˆå¤š consumer éƒ½æ˜¯é Java è¯­è¨€å®ç°çš„, æ‰€ä»¥è¿™é‡Œé‡ç‚¹ä»‹ç» Exporter çš„æ–¹æ¡ˆ.")]),s._v(" "),t("p",[s._v("æ»åæ€§, è¡¨ç¤ºæ¶ˆæ¯å·®å€¼æ•°é‡, è¿™ä¸ªä¸å¤ªæ–¹ä¾¿è®¾ç½®å‘Šè­¦è§„åˆ™, å› ä¸ºä¸€äº›æ¶ˆæ¯é‡å·¨å¤§çš„ Topic Lag å€¼çœ‹èµ·æ¥å¾ˆå¤§, ä½†æ˜¯å¾ˆå¿«å°±æ¶ˆè´¹å®Œäº†, æœ‰äº›æ¶ˆæ¯é‡å¾ˆå°çš„ Topic, consumer å¯èƒ½éƒ½æŒ‚äº†, ä½†æ˜¯ Lag å€¼ä»ç„¶å¾ˆå°. è¦æ˜¯èƒ½é¢„ä¼°ä¸€ä¸‹é˜Ÿåˆ—é‡Œçš„æ¶ˆè´¹æ—¶é•¿å°±å¥½äº†, å‚è€ƒå†å²æ•°æ®æƒ…å†µè¿›è¡Œé¢„ä¼°, å¦‚æœè¿™ä¸ªé¢„ä¼°çš„æ—¶é•¿å˜å¤§äº†, å°±è¡¨ç¤ºæœ‰é—®é¢˜äº†. å…¶å®è¿˜çœŸæœ‰è¿™æ ·çš„ "),t("a",{attrs:{href:"https://github.com/davidmparrott/kafka_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("Exporter"),t("OutboundLink")],1),s._v(", Categraf å°±ç›´æ¥é›†æˆçš„è¿™ä¸ª Exporter çš„ä»£ç , å¯ä»¥ç›´æ¥ä½¿ç”¨.")]),s._v(" "),t("p",[s._v("Categraf ä¸­æ€ä¹ˆé…ç½® Kafka çš„ Lag ç›‘æ§å‘¢? ä½¿ç”¨ kafka é‡‡é›†æ’ä»¶, é…ç½®æ–‡ä»¶åœ¨ conf/input.kafka/kafka.toml, æœ€æ ¸å¿ƒçš„é…ç½®æœ‰ä¸¤ä¸ª, ä¸€ä¸ªæ˜¯ labels, ä¸€ä¸ªæ˜¯ kafka_uris, å¯ä»¥çœ‹ä¸‹é…ç½®æ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlabels = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" cluster="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tencent-dev"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nlog_level = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error"')]),s._v("\nkafka_uris = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.206.16.3:9092"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("åœ¨ labels ä¸­, å»ºè®®åŠ ä¸€ä¸ª cluster æ ‡ç­¾. å› ä¸ºä¸€ä¸ªå…¬å¸ä¸€èˆ¬æœ‰å¤šä¸ª Kafka é›†ç¾¤, è¿™æ ·å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡ç­¾åŒºåˆ†, å…¶æ¬¡å°±æ˜¯ kafka_uris, ä¸€èˆ¬å†™ä¸€ä¸¤ä¸ªå°±å¯ä»¥äº†, ä¸ç”¨æŠŠæ‰€æœ‰ Broker åœ°å€å…¨éƒ¨å†™ä¸Š, Categraf ä¼šä½œä¸ºä¸€ä¸ª Kafka client è¿ä¸Šé›†ç¾¤, è¯»å– offset æ•°æ®. å¦‚æœæ˜¯è€é›†ç¾¤, offset ä¿¡æ¯å­˜åœ¨ ZooKeeper ä¸Š, è¿™ä¸ªæ—¶å€™å°±è¦è®¾ç½® use_zookeeper_lag = true, å¹¶é€šè¿‡ zookeeper_uris æ”¹å†™ ZooKeeper çš„è¿æ¥åœ°å€.")]),s._v(" "),t("p",[s._v("Kafka è¿™ä¸ªé‡‡é›†æ’ä»¶, é‡‡é›†çš„æœ€æ ¸å¿ƒçš„æŒ‡æ ‡æ˜¯ kafka_consumer_lag_millis, å¯ä»¥çœ‹ä¸€ä¸‹æ ·ä¾‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/13e9c573061a675a223131cfd18bd7fb-20230719203435-4jksro8.png",alt:""}})]),s._v(" "),t("p",[s._v("æŒ‡æ ‡å•ä½æ˜¯æ¯«ç§’, å°±æ˜¯ä¸€ä¸ªé¢„ä¼°æ¶ˆè´¹æ—¶é•¿, è¿™ä¸ªæŒ‡æ ‡ä¹Ÿæ”¾åˆ°äº† "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/kafka/dashboard-key-metrics.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä»ªè¡¨ç›˜"),t("OutboundLink")],1),s._v(" ä¸­, å¯ä»¥ç›´æ¥å¯¼å…¥å¤œèºä½¿ç”¨, æˆ–è€…å‚è€ƒé‡Œè¾¹çš„ PromQL è‡ªå·±åˆ¶ä½œ Grafana å¤§ç›˜.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-14"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-14"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("Kafka æ˜¯ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­éå¸¸å¸¸è§çš„ç»„ä»¶, Kafka è¿è¡Œæ˜¯å¦æ­£å¸¸, æ¶ˆæ¯æ¶ˆè´¹æ˜¯å¦æ­£å¸¸, éƒ½éœ€è¦é‡ç‚¹å…³æ³¨. ç›‘æ§å¯ä»¥ä» 4 ä¸ªå±‚é¢ç€æ‰‹, æœºå™¨, JVM, Kafka Broker, Lag. å½“ç„¶ ZooKeeper ä½œä¸º Kafka é‡åº¦ä¾èµ–ç»„ä»¶, ä¹Ÿéœ€è¦ç›‘æ§, è¿˜æœ‰å°±æ˜¯ producer å’Œ consumer ä¹Ÿæ˜¯éœ€è¦ç›‘æ§çš„. ä¸è¿‡é‚£æ˜¯åº”ç”¨ç¨‹åºå±‚é¢çš„ç›‘æ§äº†, éœ€è¦ç ”å‘äººå‘˜ååŒæ¥åš, ä½œä¸ºç»„ä»¶å¹³å°æ–¹æ¥è®², é‡ç‚¹è¿˜æ˜¯æ”¾åœ¨ Broker å±‚é¢.")]),s._v(" "),t("p",[s._v("æœºå™¨ç›‘æ§å±‚é¢, åº”è¯¥é‡ç‚¹å…³æ³¨ CPU, ç¡¬ç›˜I/O, ç½‘ç»œI/O, ä»¥åŠ Kafka è¿›ç¨‹å±‚é¢å ç”¨çš„èµ„æº, æ¯”å¦‚æ‰“å¼€äº†å¤šå°‘æ–‡ä»¶å¥æŸ„, æœ€å¤§å¯ä»¥æ‰“å¼€å¤šå°‘å¥æŸ„ç­‰.")]),s._v(" "),t("p",[s._v("JVM ç›‘æ§å±‚é¢, é‡ç‚¹å…³æ³¨ GC å’Œå†…å­˜çš„æƒ…å†µ, å¦‚æœé¢‘ç¹å‘ç”Ÿ Old åŒº Full GC, Kafka æ€§èƒ½è‚¯å®šä¼šå—å½±å“. æ‰€æœ‰ Java ç¨‹åºéƒ½åº”è¯¥ç›‘æ§ JVM, æ¯”å¦‚ Tomcat, JBoss, Hadoop, èµ° JMX è¿™ä¸ªè·¯å¾„æ˜¯ä¸€ä¸ªå…¸å‹çš„æ–¹å¼.")]),s._v(" "),t("p",[s._v("Kafka Broker JMX æŒ‡æ ‡, é‡ç‚¹å…³æ³¨ä¸€äº›å¤§é¢ä¸Šçš„å¼‚å¸¸æŒ‡æ ‡, Kafka æš´éœ²äº†å¤ªå¤šçš„ JMX æŒ‡æ ‡, å¦‚æœæ— æ³•æŠ“å–åˆ°å…³é”®æŒ‡æ ‡, Kafka ç›‘æ§ç»å¯¹æ˜¯å™©æ¢¦.")]),s._v(" "),t("p",[s._v("Lag ç›‘æ§, ä¹Ÿå°±æ˜¯ Topic Partition çš„æ¶ˆè´¹è€…æ»åç›‘æ§, æ˜¯ Queue ç±»ç¨‹åºéœ€è¦å…³æ³¨çš„å…¸å‹æŒ‡æ ‡. å› ä¸ºä¸€æ—¦æ¶ˆè´¹è€…è·Ÿä¸ä¸Šç”Ÿäº§è€…çš„é€Ÿåº¦, æ¶ˆæ¯å°±ä¼šç§¯å‹, æ•°æ®å³æ—¶æ€§ä¹Ÿå°±ä¼šå—å¾ˆå¤§å½±å“.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4yy986291dd9dfe6976d839bcbcc9161-20230719203435-qtci8dx.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_16-ç»„ä»¶ç›‘æ§-elasticsearchçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-ç»„ä»¶ç›‘æ§-elasticsearchçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›"}},[s._v("#")]),s._v(" 16.ç»„ä»¶ç›‘æ§-Elasticsearchçš„å…³é”®æŒ‡æ ‡åŠé‡‡é›†æ–¹æ³•æœ‰å“ªäº›?")]),s._v(" "),t("p",[s._v("Kafka æ˜¯ Java ç»„ä»¶, ä¸»è¦ä½¿ç”¨ JMX çš„æ–¹å¼é‡‡é›†æŒ‡æ ‡. æœ¬èŠ‚ä»‹ç»å¦ä¸€ä¸ª Java ç»„ä»¶: Elasticsearch(ç®€ç§° ES), Elasticsearch ç›´æ¥é€šè¿‡ HTTP æ¥å£æš´éœ²æŒ‡æ ‡, ç›¸æ¯” Kafka çœŸæ˜¯ç®€å•å¤ªå¤šäº†.")]),s._v(" "),t("p",[s._v("Elasticsearch çš„ç›‘æ§åŒæ ·åŒ…å«å¤šä¸ªæ–¹é¢, æ“ä½œç³»ç»Ÿ, JVM å±‚é¢çš„å…³æ³¨ç‚¹å’Œ Kafka æ˜¯ä¸€æ ·çš„, è¿™é‡Œä¸å†èµ˜è¿°. é‡ç‚¹å…³æ³¨ Elasticsearch æœ¬èº«çš„æŒ‡æ ‡, å®ƒè‡ªèº«çš„æŒ‡æ ‡æœ‰å¾ˆå¤š, å“ªäº›ç›¸å¯¹æ›´å…³é”®å‘¢? è¿™å°±è¦ä» Elasticsearch çš„èŒèƒ½å’Œæ¶æ„è¯´èµ·äº†.")]),s._v(" "),t("h4",{attrs:{id:"elasticsearch-çš„èŒèƒ½å’Œæ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-çš„èŒèƒ½å’Œæ¶æ„"}},[s._v("#")]),s._v(" Elasticsearch çš„èŒèƒ½å’Œæ¶æ„")]),s._v(" "),t("p",[s._v("Elasticsearch çš„æ ¸å¿ƒèŒèƒ½å°±æ˜¯å¯¹å¤–æä¾›æœç´¢æœåŠ¡, æ‰€ä»¥ "),t("mark",[t("strong",[s._v("æœç´¢è¯·æ±‚çš„ååå’Œå»¶è¿Ÿ")])]),s._v(" æ˜¯éå¸¸å…³é”®çš„, æœç´¢æ˜¯é åº•å±‚çš„ç´¢å¼•å®ç°çš„, æ‰€ä»¥ "),t("mark",[t("strong",[s._v("ç´¢å¼•çš„æ€§èƒ½æŒ‡æ ‡")])]),s._v(" ä¹Ÿéå¸¸å…³é”®, Elasticsearch ç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆé›†ç¾¤, "),t("strong",[s._v("é›†ç¾¤è‡ªèº«æ˜¯å¦å¥åº·")]),s._v(" ä¹Ÿæ˜¯éœ€è¦ç›‘æ§çš„.")]),s._v(" "),t("p",[s._v("ElasticSearch çš„æ¶æ„éå¸¸ç®€å•, ä¸€ä¸ªèŠ‚ç‚¹å°±å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡, ä¸è¿‡å•ç‚¹çš„é›†ç¾¤æ˜¾ç„¶æœ‰å®¹ç¾é—®é¢˜, å¦‚æœæŒ‚æ‰äº†å°±ä¸‡äº‹çš†ä¼‘äº†. ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒ, è‡³å°‘æ­å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„é›†ç¾¤.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/06dfyy8f73ae4cfe9b2f071ee2646d01-20230719203435-u37npiu.jpg",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«éƒ¨ç½²ä¸‰ä¸ª Elasticsearch è¿›ç¨‹, è¿™ä¸‰ä¸ªè¿›ç¨‹æŠŠ cluster.name éƒ½è®¾ç½®æˆç›¸åŒçš„å€¼, å°±å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤. Elasticsearch ä¼šè‡ªåŠ¨é€‰å‡ºä¸€ä¸ª master èŠ‚ç‚¹, è´Ÿè´£ç®¡ç†é›†ç¾¤èŒƒå›´å†…æ‰€æœ‰çš„å˜æ›´, æ•´ä¸ªé€‰ä¸»è¿‡ç¨‹æ˜¯è‡ªåŠ¨çš„, ä¸éœ€è¦æ“å¿ƒ.")]),s._v(" "),t("p",[s._v("æ¶æ„å›¾é‡Œç»¿è‰²çš„ P0, P1, P2 è¡¨ç¤ºä¸‰ä¸ªåˆ†ç‰‡, R0, R1, R2 ä»£è¡¨åˆ†ç‰‡å‰¯æœ¬, æ¯ä¸ªåˆ†ç‰‡æœ‰ä¸¤ä¸ªå‰¯æœ¬, ä¹Ÿå°±æ˜¯è¯´ P0 å¯¹åº”ä¸¤ä¸ª R0, P1 å¯¹åº”ä¸¤ä¸ª R1, P2 å¯¹åº”ä¸¤ä¸ª R2. è¿™äº›åˆ†ç‰‡å’Œå‰¯æœ¬æ˜¯å¦æˆåŠŸåˆ†é…åˆ° Node ä¸Šå¹¶è½ç›˜å†™å…¥, ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„ç›‘æ§æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("å‰é¢çŸ¥é“ Elasticsearch å“ªäº›æ–¹é¢çš„æŒ‡æ ‡æ¯”è¾ƒå…³é”®äº†, ä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹è¿™äº›æŒ‡æ ‡æ˜¯æ€ä¹ˆè·å–çš„.")]),s._v(" "),t("h4",{attrs:{id:"elasticsearchæš´éœ²æŒ‡æ ‡çš„æ–¹å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearchæš´éœ²æŒ‡æ ‡çš„æ–¹å¼"}},[s._v("#")]),s._v(" Elasticsearchæš´éœ²æŒ‡æ ‡çš„æ–¹å¼")]),s._v(" "),t("p",[t("strong",[s._v("Elasticsearch é€šè¿‡ HTTP æ¥å£æ–¹å¼æš´éœ²æŒ‡æ ‡")]),s._v(", é›†ç¾¤æ•´ä½“çš„å¥åº·çŠ¶å†µä½¿ç”¨ "),t("code",[s._v("/_cluster/health")]),s._v("â€‹ è·å–, è¿™é‡Œä½¿ç”¨ curl æµ‹è¯•ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("ulric@localhost ~ % curl -s -uelastic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("Pass1234 'http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//10.206.16.3:9200/_cluster/health?pretty'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cluster_name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elasticsearch-cluster"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"status"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"green"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"timed_out"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"number_of_nodes"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"number_of_data_nodes"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"active_primary_shards"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("216")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"active_shards"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("432")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"relocating_shards"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"initializing_shards"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"unassigned_shards"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"delayed_unassigned_shards"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"number_of_pending_tasks"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"number_of_in_flight_fetch"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"task_max_waiting_in_queue_millis"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"active_shards_percent_as_number"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("è¿™é‡Œæœ€å…³é”®çš„ä¿¡æ¯æ˜¯ status å­—æ®µ, å¦‚æœæ˜¯ green, è¡¨ç¤ºä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å¤„äºæ­£å¸¸çŠ¶æ€; å¦‚æœ status æ˜¯ yellow, è¡¨ç¤ºä¸»åˆ†ç‰‡å¤„äºæ­£å¸¸çŠ¶æ€, ä½†å‰¯æœ¬åˆ†ç‰‡æœ‰å¼‚å¸¸çŠ¶æ€; å¦‚æœ status æ˜¯ red, åˆ™è¡¨ç¤ºæœ‰ä¸»åˆ†ç‰‡æ˜¯å¼‚å¸¸çŠ¶æ€.")]),s._v(" "),t("p",[s._v("å…¶ä»–å­—æ®µå¤§éƒ½æ˜¯é›†ç¾¤ç»Ÿè®¡æ•°æ®, æ¯”å¦‚ number_of_nodes è¡¨ç¤ºé›†ç¾¤å…±æœ‰ 3 ä¸ªèŠ‚ç‚¹, number_of_data_nodes è¡¨ç¤ºé›†ç¾¤å…±æœ‰ 3 ä¸ªæ•°æ®èŠ‚ç‚¹, active_primary_shards è¡¨ç¤ºå…±æœ‰ 216 ä¸ªæ´»è·ƒä¸»åˆ†åŒº, active_shards è¡¨ç¤ºå…±æœ‰ 432 ä¸ªæ´»è·ƒåˆ†åŒº.")]),s._v(" "),t("p",[s._v("æ³¨æ„åœ¨é›†ç¾¤æ­£å¸¸çš„æƒ…å†µä¸‹, å¯¹é›†ç¾¤é‡Œçš„æ‰€æœ‰èŠ‚ç‚¹è¯·æ±‚è¿™ä¸ªæ¥å£, éƒ½ä¼šè¿”å›ç›¸åŒçš„ä¿¡æ¯, æ‰€ä»¥è¦è·å–é›†ç¾¤å¥åº·çŠ¶å†µåªéœ€è¦è¯·æ±‚æŸä¸€ä¸ªèŠ‚ç‚¹å³å¯, æˆ–è€…éƒ½è¯·æ±‚ä¸€ä¸‹ä¹Ÿæ²¡å•¥å¤§ä¸äº†çš„, æ•°æ®é‡ä¹Ÿä¸å¤§.")]),s._v(" "),t("p",[s._v("é™¤äº† "),t("code",[s._v("/_cluster/health")]),s._v("â€‹ ä¹‹å¤–, å…¶ä»–å¸¸è§çš„æ¥å£è¿˜æœ‰ "),t("code",[s._v("/_cluster/health?level=indices")]),s._v("â€‹, "),t("code",[s._v("/_nodes/stats")]),s._v("â€‹, "),t("code",[s._v("/_nodes/_local/stats")]),s._v("â€‹, "),t("code",[s._v("/_cluster/stats")]),s._v("â€‹, "),t("code",[s._v("/_all/_stats")]),s._v("â€‹, å…¶ä¸­æœ€æœ‰ç”¨çš„æ˜¯ "),t("strong",[s._v("è·å–èŠ‚ç‚¹ç»Ÿè®¡æ•°æ®çš„æ¥å£")]),s._v(", ä¸‹é¢é‡ç‚¹ä»‹ç»ä¸€ä¸‹.")]),s._v(" "),t("h4",{attrs:{id:"è·å–èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è·å–èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯"}},[s._v("#")]),s._v(" è·å–èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯")]),s._v(" "),t("p",[t("strong",[s._v("è·å–èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯")]),s._v("å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ¥å£, "),t("code",[s._v("/_nodes/stats")]),s._v("â€‹ ä¼šè¿”å›é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯, "),t("code",[s._v("/_nodes/_local/stats")]),s._v("â€‹ åˆ™åªè¿”å›è¯·æ±‚çš„é‚£ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯.")]),s._v(" "),t("p",[s._v("è¿™æ ·çš„è®¾è®¡, ä»ç›‘æ§è§’åº¦å°±æœ‰ä¸¤ç§é‡‡é›†æ–¹å¼, ä¸€ç§æ˜¯"),t("strong",[s._v("åœ¨ä¸­å¿ƒéƒ¨ç½²ç›‘æ§é‡‡é›†å™¨")]),s._v(", è¿ä¸ŠæŸä¸€å° Elasticsearch èŠ‚ç‚¹, ä»è¿™ä¸ªèŠ‚ç‚¹è·å–æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹çš„ä¿¡æ¯, å¯ä»¥çœ‹ä¸€ä¸‹æ¶æ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/7c9a200d6bebba9d69705678ea06b799-20230719203435-4yw5lnz.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å¦ä¸€ç§æ–¹å¼, æ˜¯æŠŠ"),t("strong",[s._v("ç›‘æ§é‡‡é›†å™¨éƒ¨ç½²åœ¨æ‰€æœ‰èŠ‚ç‚¹")]),s._v("ä¸Š, è°ƒç”¨å„è‡ªèŠ‚ç‚¹ä¸Š ES è¿›ç¨‹çš„ local æ¥å£, å¯ä»¥çœ‹ä¸€ä¸‹æ¶æ„å›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/yy228e4d6378f7ffc7bac3765b5525a9-20230719203435-ku4dihh.png",alt:""}})]),s._v(" "),t("p",[s._v("â€‹"),t("code",[s._v("/_nodes/stats")]),s._v("â€‹ æ¥å£è¿”å›çš„å†…å®¹éå¸¸ä¸°å¯Œ, çœ‹ä¸€ä¸ªæ ·ä¾‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/aa98cf47e4067d8584547d83a6683cfd-20230719203435-31t1ab3.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("nodes å­—æ®µæ˜¯ä¸ªå¤§ map, map çš„ key æ˜¯ node_id, map çš„ value å°±æ˜¯å„ç±»ç»Ÿè®¡æŒ‡æ ‡, å…¶ä¸­æœ€å…³é”®çš„æ˜¯ "),t("strong",[s._v("indices")]),s._v(", ä¹Ÿå°±æ˜¯ç´¢å¼•ç›¸å…³çš„. é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰ os æ“ä½œç³»ç»Ÿç›¸å…³çš„, process è¿›ç¨‹ç›¸å…³çš„, jvm ç›¸å…³çš„, thread_pool çº¿ç¨‹æ± ç›¸å…³çš„, fs æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„, transport ç½‘ç»œååç›¸å…³çš„, http å„ä¸ªæ¥å£è¯·æ±‚ç›¸å…³çš„å„ç±»æŒ‡æ ‡. æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ URL ä¸­ä¼ å‚çš„æ–¹å¼å‘Šè¯‰ ES åªè¿”å›æŸäº›ç‰¹å®šæ•°æ®, æ¯”å¦‚:")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("/_nodes/stats/indices"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("os\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ç§æ¥å£è°ƒç”¨æ–¹å¼, åªä¼šè¿”å›ç´¢å¼•å’Œæ“ä½œç³»ç»Ÿç›¸å…³çš„æŒ‡æ ‡. è¿™ä¸ªæ¥å£è¿”å›çš„å†…å®¹éå¸¸å…³é”®, ä¸‹é¢æ¥æŒ‘é€‰ä¸€äº›å…³é”®ä¿¡æ¯è¿›è¡Œè§£è¯»ä¸€ä¸‹.")]),s._v(" "),t("h4",{attrs:{id:"èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯è§£è¯»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯è§£è¯»"}},[s._v("#")]),s._v(" èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯è§£è¯»")]),s._v(" "),t("p",[s._v("ç´¢å¼•éƒ¨åˆ†æ˜¯æœ€å…³é”®çš„, å…ˆæ¥çœ‹ç´¢å¼•éƒ¨åˆ†.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"indices"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"docs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45339548")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"deleted"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"shard_stats"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("144")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"store"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"size_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15882899598")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_data_set_size_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15882899598")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"reserved_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("docs ç»Ÿè®¡äº†"),t("strong",[s._v("æ–‡æ¡£çš„æ•°é‡")]),s._v(", åŒ…æ‹¬è¿˜æ²¡æœ‰ä»æ®µ(segments)é‡Œæ¸…é™¤çš„å·²åˆ é™¤æ–‡æ¡£æ•°é‡.")]),s._v(" "),t("li",[s._v("shard_stats ç»Ÿè®¡äº†"),t("strong",[s._v("åˆ†ç‰‡çš„æ•°é‡")]),s._v(".")]),s._v(" "),t("li",[s._v("store ç»Ÿè®¡äº†"),t("strong",[s._v("å­˜å‚¨çš„æƒ…å†µ")]),s._v(", åŒ…æ‹¬ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡æ€»å…±è€—è´¹äº†å¤šå°‘ç‰©ç†å­˜å‚¨.")])]),s._v(" "),t("p",[s._v("indexing, get, search, merges, refresh, flush ç­‰, éƒ½æ˜¯ç±»ä¼¼çš„, ç»Ÿè®¡äº† Elasticsearch å„ä¸ªå…³é”®ç¯èŠ‚çš„ååå’Œè€—æ—¶, å…¶ä¸­æ¯”è¾ƒå…³é”®çš„æ˜¯ indexing, search, merge, ä¸‹é¢æ˜¯æ•°æ®æ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"indexing"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index_total"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18595844")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1868991")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index_current"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index_failed"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"delete_total"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"delete_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"delete_current"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"noop_update_total"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"is_throttled"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"throttle_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"search"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"open_contexts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query_total"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140847")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59976")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"query_current"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"fetch_total"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1333")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"fetch_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("990")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"fetch_current"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scroll_total"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scroll_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scroll_current"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"suggest_total"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"suggest_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"suggest_current"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"merges"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"current"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"current_docs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"current_size_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64937")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7170896")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_docs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1341992706")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_size_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140455785325")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_stopped_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_throttled_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("160061")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_auto_throttle_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6707112372")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("p",[t("strong",[s._v("indexing")]),s._v(" æ˜¯ç»Ÿè®¡ç´¢å¼•è¿‡ç¨‹, ES çš„æ¶æ„é‡Œ, ç´¢å¼•æ˜¯éå¸¸å…³é”®çš„ä¸€ä¸ªä¸œè¥¿, ç´¢å¼•çš„ååå’Œè€—æ—¶éƒ½åº”è¯¥å¯†åˆ‡å…³æ³¨, index_total å’Œ index_time_in_millis éƒ½æ˜¯ Counter ç±»å‹çš„æŒ‡æ ‡, å•è°ƒé€’å¢. å¦‚æœè¦æ±‚å–æœ€è¿‘ä¸€åˆ†é’Ÿçš„ç´¢å¼•æ•°é‡å’Œå¹³å‡å»¶è¿Ÿ, å°±éœ€è¦ä½¿ç”¨ increase å‡½æ•°æ±‚å¢é‡. throttle_time_in_millis è¡¨ç¤ºå—é™çš„æ—¶é—´, ç´¢å¼•ä¸èƒ½è€—è´¹å¤ªå¤šèµ„æº, å¦‚æœå ç”¨äº†å¤ªå¤šèµ„æºå°±å½±å“å…¶ä»–çš„æ“ä½œ, åº”è¯¥é™åˆ¶ä¸€ä¸‹, è¿™ä¸ªæŒ‡æ ‡å°±è¡¨ç¤ºæ€»è®¡è¢«é™åˆ¶çš„æ—¶é—´.")]),s._v(" "),t("p",[t("strong",[s._v("search")]),s._v(" æè¿°åœ¨æ´»è·ƒä¸­çš„æœç´¢(open_contexts)æ•°é‡, æŸ¥è¯¢çš„æ€»æ•°é‡, ä»¥åŠè‡ªèŠ‚ç‚¹å¯åŠ¨ä»¥æ¥åœ¨æŸ¥è¯¢ä¸Šæ¶ˆè€—çš„æ€»æ—¶é—´. ç”¨ increase(query_time_in_millis[1m]) / increase(query_total[1m]) è®¡ç®—å‡ºæ¥çš„æ¯”å€¼, å¯ä»¥ç”¨æ¥ç²—ç•¥åœ°è¯„ä»·æŸ¥è¯¢æœ‰å¤šé«˜æ•ˆ. æ¯”å€¼è¶Šå¤§, æ¯ä¸ªæŸ¥è¯¢èŠ±è´¹çš„æ—¶é—´è¶Šå¤š, åˆ°ä¸€å®šç¨‹åº¦å°±è¦è€ƒè™‘è°ƒä¼˜äº†.")]),s._v(" "),t("p",[t("strong",[s._v("fetch")]),s._v(" ç»Ÿè®¡å€¼å±•ç¤ºäº†æŸ¥è¯¢å¤„ç†çš„åä¸€åŠæµç¨‹, ä¹Ÿå°±æ˜¯ query-then-fetch é‡Œçš„ fetch éƒ¨åˆ†. å¦‚æœ fetch è€—æ—¶æ¯” query è¿˜å¤š, è¯´æ˜ç£ç›˜è¾ƒæ…¢, å¯èƒ½æ˜¯è·å–äº†å¤ªå¤šæ–‡æ¡£, æˆ–è€…æœç´¢è¯·æ±‚è®¾ç½®äº†å¤ªå¤§çš„åˆ†é¡µ.")]),s._v(" "),t("p",[t("strong",[s._v("merges")]),s._v(" åŒ…æ‹¬äº† Lucene æ®µåˆå¹¶ç›¸å…³çš„ä¿¡æ¯. å®ƒä¼šå‘Šè¯‰ä½ ç›®å‰åœ¨è¿è¡Œå‡ ä¸ªåˆå¹¶, åˆå¹¶æ¶‰åŠçš„æ–‡æ¡£æ•°é‡, æ­£åœ¨åˆå¹¶çš„æ®µçš„æ€»å¤§å°, ä»¥åŠåœ¨åˆå¹¶æ“ä½œä¸Šæ¶ˆè€—çš„æ€»æ—¶é—´. åˆå¹¶è¦æ¶ˆè€—å¤§é‡çš„ç£ç›˜ I/O å’Œ CPU èµ„æº, å¦‚æœ merge æ“ä½œè€—è´¹å¤ªå¤šèµ„æº, ä¹Ÿä¼šè¢«é™åˆ¶, å³ total_throttled_time_in_millis æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("é™¤äº†ç´¢å¼•ä¿¡æ¯ä¹‹å¤–,  è¿˜ç›´æ¥åœ¨ HTTP æ¥å£ä¸­æš´éœ²äº†æ“ä½œç³»ç»Ÿ, è¿›ç¨‹, JVM ç›¸å…³çš„æŒ‡æ ‡, ä¸‹é¢ä¹Ÿç®€å•çœ‹ä¸€ä¸‹.")]),s._v(" "),t("p",[s._v("æ“ä½œç³»ç»Ÿå±‚é¢çš„æŒ‡æ ‡, æ—¢å¯ä»¥ä½¿ç”¨ Elasticsearch è‡ªå·±æš´éœ²çš„æ•°æ®, ä¹Ÿå¯ä»¥ä½¿ç”¨ç›‘æ§é‡‡é›†å™¨ç›´æ¥é‡‡é›†çš„æ•°æ®, æ¯”å¦‚ Categraf é»˜è®¤ä¼šé‡‡é›† CPU, å†…å­˜, ç£ç›˜, IO, ç½‘ç»œ, è¿›ç¨‹ç­‰å¤šç§ä¿¡æ¯. è¿™é‡Œè¦è§£å†³çš„å…³é”®é—®é¢˜æ˜¯, **å¦‚ä½•é€šè¿‡ç›¸åŒçš„å¤§ç›˜å˜é‡è¿‡æ»¤ Elasticsearch çš„æŒ‡æ ‡å’Œæ“ä½œç³»ç»Ÿçš„æŒ‡æ ‡? **  ä» Elasticsearch æ¥å£é‡‡é›†åˆ°çš„æŒ‡æ ‡, ä¼šå¸¦æœ‰ä¸€ä¸ª node_host æ ‡ç­¾, æ”¾ç½®çš„æ˜¯æœºå™¨çš„ IP, ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªæ ‡ç­¾è¿‡æ»¤æ•°æ®, æ¯”å¦‚ä¸‹é¢è¿™ä¸ªæ ·ä¾‹.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/26395b87fefdba2025068214e666329d-20230719203435-lv06nsw.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("è¦æƒ³ä½¿ç”¨æœºå™¨ IP è¿‡æ»¤æ“ä½œç³»ç»Ÿçš„æŒ‡æ ‡, å°±éœ€è¦åœ¨é‡‡é›†å™¨ä¸ŠæŠ¥æ•°æ®çš„æ—¶å€™, åŒæ—¶æŠŠæœºå™¨ IP ä½œä¸ºæ ‡ç­¾ä¸ŠæŠ¥. å¦‚æœæ˜¯ Categraf çš„è¯, hostname è¦é…ç½®ä¸º "),t("code",[s._v('"$ip"')]),s._v("â€‹, å¦‚æœæ˜¯ Telegraf çš„è¯, å°±éœ€è¦æ‰‹å·¥é…ç½®å†™æ­»æœ¬æœº IP äº†. å½“ç„¶,å¦‚æœä¸ä½¿ç”¨ç›‘æ§é‡‡é›†å™¨é‡‡é›†çš„æ“ä½œç³»ç»ŸæŒ‡æ ‡, ç›´æ¥å¤ç”¨ Elasticsearch æ¥å£ä¸­åå‡ºçš„é‚£äº›æŒ‡æ ‡, å°±æ²¡æœ‰è¿™ä¸ªè¿‡æ»¤é—®é¢˜äº†, å› ä¸º Elasticsearch çš„æ•°æ®æ ‡ç­¾å¤©ç„¶å°±æ˜¯ç»Ÿä¸€çš„.")]),s._v(" "),t("p",[s._v("JVM ç›¸å…³çš„æŒ‡æ ‡, ä¸Šä¸€è®² Kafka ç›‘æ§å·²ç»ä»‹ç»è¿‡äº†, ä¸è¿‡å½“æ—¶æ˜¯é‡‡ç”¨ JMX æ–¹å¼è·å–çš„, Elasticsearch åˆ™æ›´ä¸ºç®€å•, åœ¨ "),t("code",[s._v("/_nodes/stats")]),s._v("â€‹ æ¥å£ä¸­ç›´æ¥æš´éœ²äº† JVM æŒ‡æ ‡, GC, å†…å­˜æ± ç­‰æ•°æ®éƒ½æœ‰, åªæ˜¯æœ€ç»ˆçš„æŒ‡æ ‡å‘½åæ–¹å¼å’Œ Kafka ä¸åŒ. ä¸‹é¢æ˜¯ JVM ç›¸å…³æŒ‡æ ‡çš„æ ·ä¾‹ä¾›å‚è€ƒ.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"timestamp"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1670041198455")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"uptime_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("92165514")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"mem"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"heap_used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("752914744")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"heap_used_percent"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"heap_committed_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2147483648")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"heap_max_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2147483648")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"non_heap_used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("265504880")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"non_heap_committed_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("269877248")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pools"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"young"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("289406976")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"max_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"peak_used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1283457024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"peak_max_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"old"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("419899904")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"max_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2147483648")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"peak_used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("641861120")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"peak_max_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2147483648")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"survivor"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43607864")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"max_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"peak_used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("115343360")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"peak_max_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"threads"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"peak_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("161")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"gc"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"collectors"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"young"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"collection_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8501")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"collection_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("157112")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"old"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"collection_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"collection_time_in_millis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"buffer_pools"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"mapped"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2490")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9927166600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_capacity_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9927166600")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"direct"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("129")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6017066")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_capacity_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6017065")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("\"mapped - 'non-volatile memory'\"")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"used_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_capacity_in_bytes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"classes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"current_loaded_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28215")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_loaded_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28291")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total_unloaded_count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("76")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br")])]),t("h4",{attrs:{id:"elasticsearch-æŒ‡æ ‡é‡‡é›†é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-æŒ‡æ ‡é‡‡é›†é…ç½®"}},[s._v("#")]),s._v(" Elasticsearch æŒ‡æ ‡é‡‡é›†é…ç½®")]),s._v(" "),t("p",[s._v("ä¸‹é¢è¿›å…¥é‡‡é›†ç¯èŠ‚, çœ‹çœ‹æ€ä¹ˆé€šè¿‡ Categraf æ”¶é›†è¿™äº›æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("Categraf é‡‡é›† Elasticsearch çš„é…ç½®æ–‡ä»¶åœ¨ "),t("code",[s._v("conf/input.elasticsearch/elasticsearch.toml")]),s._v("â€‹, çœ‹é‡Œè¾¹çš„ä¸€äº›å…³é”®é…ç½®.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("labels = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" cluster="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cloud-n9e-es"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å…ˆçœ‹æ ‡ç­¾é…ç½®, è¿™é‡Œå»ºè®®æ‰‹å·¥åŠ ä¸€ä¸ª cluster æ ‡ç­¾, å› ä¸ºä¸€ä¸ªå…¬å¸é€šå¸¸æœ‰å¤šä¸ª Elasticsearch é›†ç¾¤, å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡ç­¾æ¥åŒºåˆ†. å®é™…ä¸Š, æ¯ä¸ª Elasticsearch é›†ç¾¤éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„åå­—, ä¼šæ”¾åˆ° cluster_name æ ‡ç­¾ä¸­, ä¸è¿‡æœ‰å¯èƒ½å¤šä¸ªé›†ç¾¤å¯èƒ½ä½¿ç”¨äº†ç›¸åŒçš„ cluster.name, è¿™æ ·å°±æ²¡æ³•é€šè¿‡å†…ç½®çš„åå­—åŒºåˆ†äº†, è¿˜æ˜¯åœ¨æ ‡ç­¾ä¸­ç›´æ¥æ–°å¢ä¸€ä¸ª cluster æ ‡ç­¾æ¯”è¾ƒç¨³å¦¥.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("servers = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlocal = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("servers ç”¨æ¥é…ç½® Elasticsearch èŠ‚ç‚¹çš„åœ°å€, å¦‚æœåé¢çš„ local é…ç½®ä¸º false, è¿™é‡Œå°±åªéœ€è¦é…ç½®ä¸€å° Elasticsearch çš„åœ°å€, é€šè¿‡è¿™ä¸€ä¸ªåœ°å€æ‹‰å–æ•´ä¸ªé›†ç¾¤çš„ç›‘æ§æŒ‡æ ‡, è¿˜æœ‰å…¶ä»–æœºå™¨çš„èŠ‚ç‚¹æŒ‡æ ‡. è¿™ç§æ–¹å¼è™½ç„¶ç®€å•, ä½†æ˜¯å¯èƒ½ä¼šå¯¹é›†ç¾¤æ€§èƒ½æœ‰äº›å½±å“, é›†ç¾¤èŠ‚ç‚¹æ•°é‡ä¸å¤šæ˜¯å¯ä»¥çš„, ä½†å¦‚æœé›†ç¾¤æœ‰å¤§å‡ åä¸ªèŠ‚ç‚¹, å°±è¦æ³¨æ„ä¸€ä¸‹äº†.")]),s._v(" "),t("p",[s._v("å¦‚æœ local é…ç½®ä¸º true, å°±è¡¨ç¤ºä» "),t("code",[s._v("/_nodes/_local/stats")]),s._v("â€‹ è·å–æœ¬åœ°èŠ‚ç‚¹çš„ä¿¡æ¯, é‚£å°±è¦åˆ†åˆ«é‡‡é›†æ‰€æœ‰çš„èŠ‚ç‚¹äº†. è¦ä¹ˆåœ¨ servers ä¸­é…ç½®æ‰€æœ‰çš„ Elasticsearch èŠ‚ç‚¹åˆ—è¡¨åšè¿œç¨‹æ‹‰å–, è¦ä¹ˆå°±æ˜¯æŠŠ Elasticsearch å’Œ Categraf åšæˆä¸€å¯¹ä¸€çš„å…³ç³», è®© Categraf é‡‡é›† localhost ä¸Šçš„ Elasticsearch.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("cluster_health = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n## Adjust cluster_health_level when you want to obtain detailed health stats\n## The options are\n##  - indices (default)\n##  - cluster\ncluster_health_level = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("cluster_health ç”¨æ¥æ§åˆ¶æ˜¯å¦é‡‡é›†é›†ç¾¤å¥åº·æŒ‡æ ‡, å³æ˜¯å¦æ‹‰å– "),t("code",[s._v("/_cluster/health")]),s._v("â€‹ æ¥å£çš„æ•°æ®. è¿™ä¸ªæ¥å£å¯ä»¥ä¼ å…¥ level å‚æ•°, ç”¨ cluster_health_level æ¥æ§åˆ¶æ˜¯æ‹‰å– cluster é›†ç¾¤çº§åˆ«çš„æ•°æ®, è¿˜æ˜¯æ‹‰å– indices ç´¢å¼•çº§åˆ«çš„æ•°æ®. å¹³æ—¶ç›‘æ§ cluster çº§åˆ«å°±å¤Ÿäº†, å¦‚æœ cluster çº§åˆ«æ˜¯ yellow æˆ– red äº†, å¯ä»¥å†æ‰‹å·¥æŸ¥çœ‹ç´¢å¼•çº§åˆ«çš„æ•°æ®, æ’æŸ¥å…·ä½“æ˜¯å“ªä¸ªç´¢å¼•çš„é—®é¢˜.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("cluster_stats = "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("cluster_stats ç”¨äºæ§åˆ¶æ˜¯å¦é‡‡é›†é›†ç¾¤å±‚é¢çš„ç»Ÿè®¡æŒ‡æ ‡, é»˜è®¤é‡‡é›†å³å¯, è¿™ä¸ªæ•°é‡ä¸ç®—å¤§. è¿™ä¸ªæ•°æ®åªä»ä¸»èŠ‚ç‚¹æ‹‰å–, å¦‚æœå½“å‰èŠ‚ç‚¹ä¸æ˜¯ä¸»èŠ‚ç‚¹, ä¼šè·³è¿‡è¿™ä¸ªé‡‡é›†é€»è¾‘.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("## Indices to collect; can be one or more indices names or _all\n## Use of wildcards is allowed. Use a wildcard at the end to retrieve index names that end with a changing value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" like a date.\n# indices_include = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zipkin*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n## use "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shards"')]),s._v(" or blank string for indices level\nindices_level = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("indices_include æ”¯æŒé€šé…ç¬¦, é…ç½®è¦é‡‡é›†å“ªäº›ç´¢å¼•çš„ _stats ä¿¡æ¯, å¦‚æœæƒ³é‡‡é›†æ‰€æœ‰çš„ç´¢å¼•, è®¾ç½®ä¸º _all å°±å¯ä»¥. ç´¢å¼•çš„ _stats æ¥å£ä¹Ÿæ”¯æŒ level å‚æ•°, å¯ä»¥ç”¨ indices_level æ¥æ§åˆ¶æ˜¯è·å–ç´¢å¼•é¢—ç²’åº¦çš„æ•°æ®, è¿˜æ˜¯åˆ†ç‰‡é¢—ç²’åº¦çš„æ•°æ®.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("node_stats = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jvm"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"breaker"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"process"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"os"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fs"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"indices"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread_pool"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transport"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("node_stats ç”¨æ¥é€‰æ‹©æ‹‰å–èŠ‚ç‚¹çš„å“ªäº›ä¿¡æ¯, å°±æ˜¯ "),t("code",[s._v("/_nodes/stats/indices,os")]),s._v("â€‹ æ¥å£æœ€åé¢é‚£éƒ¨åˆ†å‚æ•°. é»˜è®¤é…ç½®å°±å¤Ÿç”¨äº†, é‡Œè¾¹æœ‰ä¸ª HTTP éƒ¨åˆ†, æŒ‡æ ‡éå¸¸å¤š, ä¸å»ºè®®é‡‡é›†, é»˜è®¤é…ç½®é‡Œä¹Ÿæ²¡æœ‰.")]),s._v(" "),t("p",[s._v("å…¶ä»–çš„é…ç½®ä¸æ˜¯å¾ˆå…³é”®, å°±ä¸è¿‡å¤šä»‹ç»äº†, è¿™é‡ŒæŠŠå‰é¢è¿™äº›å…³é”®æŒ‡æ ‡åšæˆäº†ä¸€ä¸ª "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/elasticsearch/dashboard.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›‘æ§å¤§ç›˜"),t("OutboundLink")],1),s._v(", ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹æ•ˆæœå›¾.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d11aaeeaf950179e02026fe4f5915d0b-20230719203435-5mh9esi.png",alt:""}}),t("img",{attrs:{src:"/img/0c34c70a6a2571ea0b3e849f7797088c-20230719203435-kdfu2qd.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-15"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-15"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("Elasticsearch çš„æ ¸å¿ƒèŒèƒ½å°±æ˜¯æä¾›æœç´¢æœåŠ¡, æœç´¢çš„æ•°æ®è¦æå‰å»ºç«‹ç´¢å¼•, ä¸ºäº†æ”¯æŒæµ·é‡æ•°æ®, Elasticsearch è¿˜èƒ½ç»„æˆé›†ç¾¤, æ‰€ä»¥ **æœç´¢æ€§èƒ½, ç´¢å¼•æ€§èƒ½, é›†ç¾¤å¥åº·çŠ¶å†µä»¥åŠé›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çš„å¥åº·çŠ¶å†µ, å°±æ˜¯æˆ‘ä»¬è¦ç›‘æ§çš„æ ¸å¿ƒæŒ‡æ ‡. **")]),s._v(" "),t("p",[s._v("Elasticsearch æš´éœ²æŒ‡æ ‡çš„æ–¹å¼éå¸¸ç®€å•, å°±æ˜¯"),t("strong",[s._v("å‡ ä¸ª HTTP æ¥å£, è¿”å› JSON æ•°æ®, ç›´æ¥æ‹‰å–è§£æ")]),s._v("å³å¯, æ¯” JMX æ–¹å¼ç®€å•å¾—å¤š. è¦å…³æ³¨çš„æ ¸å¿ƒæ˜¯ "),t("code",[s._v("/_cluster/health")]),s._v("â€‹ å’Œ "),t("code",[s._v("/_nodes/stats")]),s._v("â€‹ è¿™ä¸¤ä¸ªæ¥å£, ä¸€ä¸ªç”¨æ¥è·å–"),t("strong",[s._v("æ•´ä¸ªé›†ç¾¤çš„ç›‘æ§æ•°æ®, ä¸€ä¸ªç”¨æ¥è·å–èŠ‚ç‚¹ç²’åº¦çš„ç›‘æ§æ•°æ®")]),s._v(". "),t("code",[s._v("/_nodes/stats")]),s._v("â€‹ æ¥å£è¿”å›çš„æ•°æ®éå¸¸ä¸°å¯Œ, ä¸ä½†æœ‰ç´¢å¼•ç±»æŒ‡æ ‡, è¿˜æœ‰ OS, JVM, Process, ThreadPool æŒ‡æ ‡, é‡ç‚¹å…³æ³¨ç´¢å¼•ç›¸å…³çš„æŒ‡æ ‡å’Œ JVM ç›¸å…³çš„æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/dd6c9e2770e228674223681470bf02a0-20230719203435-iwmjbot.jpg",alt:"å›¾ç‰‡"}})]),s._v(" "),t("h3",{attrs:{id:"_17-ç»„ä»¶ç›‘æ§-kubernetesnodeç»„ä»¶çš„å…³é”®æŒ‡æ ‡ä¸æ•°æ®é‡‡é›†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_17-ç»„ä»¶ç›‘æ§-kubernetesnodeç»„ä»¶çš„å…³é”®æŒ‡æ ‡ä¸æ•°æ®é‡‡é›†"}},[s._v("#")]),s._v(" 17.ç»„ä»¶ç›‘æ§-KubernetesNodeç»„ä»¶çš„å…³é”®æŒ‡æ ‡ä¸æ•°æ®é‡‡é›†")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»çš„æ˜¯äº‘åŸç”Ÿæ—¶ä»£çš„æ‰›æŠŠå­ Kubernetes çš„ç›‘æ§, äº‘åŸç”Ÿè¿™ä¸ªè¯å°±æ˜¯éšç€ Kubernetes ç«èµ·æ¥çš„. Kubernetes æ¶æ„æ¯”è¾ƒå¤æ‚, è¿™é‡Œä¼šç”¨ä¸¤è®²çš„æ—¶é—´æ¥åˆ†äº«.")]),s._v(" "),t("p",[s._v("è™½ç„¶ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°åŸºäº Prometheus åšçš„ Operator, ä¸€é”®ç›‘æ§ Kubernetes, ä½†æ˜¯å¾ˆå¤šäººä»ç„¶ä¸çŸ¥å…¶æ‰€ä»¥ç„¶, è¿™ä¸¤è®²ä¼šæŒ‰ç…§ç»„ä»¶ç²’åº¦æ¥è®², äº‰å–è®©ä½ ç†è§£å…¶ä¸­çš„åŸç†, è‡³äºåé¢ç”¨ä»€ä¹ˆå·¥å…·æ¥è½åœ°, é‚£éƒ½æ˜¯æŠ€æœ¯çš„å±‚é¢äº†, å¥½åŠ.")]),s._v(" "),t("p",[s._v("è¦ç›‘æ§ Kubernetes, å¾—å…ˆå¼„æ˜ç™½ Kubernetes æœ‰å“ªäº›æ¨¡å—è¦ç›‘æ§, æ‰€ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹ Kubernetes çš„æ¶æ„.")]),s._v(" "),t("h4",{attrs:{id:"kubernetesæ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetesæ¶æ„"}},[s._v("#")]),s._v(" Kubernetesæ¶æ„")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ˜¯ Kubernetes çš„æ¶æ„å›¾, ç”¨æˆ·äº¤äº’éƒ¨åˆ†æ˜¯ UI å’Œ CLI, è¿™ä¸¤ä¸ªä¸éœ€è¦ç›‘æ§, å…³é”®æ˜¯ "),t("strong",[s._v("Control plane(æ§åˆ¶é¢)å’Œ Worker node(å·¥ä½œè´Ÿè½½èŠ‚ç‚¹)")]),s._v(" . æ§åˆ¶é¢çš„ç»„ä»¶æä¾›äº†ç®¡ç†å’Œè°ƒåº¦èƒ½åŠ›, å¦‚æœæ§åˆ¶é¢ç»„ä»¶å‡ºäº†é—®é¢˜, å°±æ²¡æ³•ç»™ Kubernetes ä¸‹å‘æŒ‡ä»¤äº†. å·¥ä½œè´Ÿè½½èŠ‚ç‚¹è¿è¡Œäº†å®¹å™¨, ä»¥åŠç®¡ç†è¿™äº›å®¹å™¨çš„è¿è¡Œæ—¶å¼•æ“(å›¾ä¸Šçš„ Docker), ç®¡ç† Pod çš„ Kubelet, ä»¥åŠè½¬å‘è§„åˆ™çš„ Kube-Proxy. å·¥ä½œè´Ÿè½½èŠ‚ç‚¹å¦‚æœå‡ºé—®é¢˜, å¯èƒ½ä¼šç›´æ¥å½±å“ä¸šåŠ¡æµé‡, æ‰€ä»¥å¯¹è¿™ç±»èŠ‚ç‚¹çš„ç›‘æ§å°±æ˜¾å¾—æ›´ä¸ºé‡è¦äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5b1e70e4d2b006ef451e7689086b2e99-20230719203435-blq7xrg.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å½“ç„¶, é™¤äº†æ§åˆ¶é¢ç»„ä»¶å’Œå·¥ä½œè´Ÿè½½èŠ‚ç‚¹çš„ç›‘æ§, æ•´ä¸ª Kubernetes ç›‘æ§ä½“ç³»è¿˜åº”è¯¥åŒ…å«å¦å¤–ä¸‰éƒ¨åˆ†, ä¸€ä¸ªæ˜¯ Kubernetes æ‰€åœ¨"),t("strong",[s._v("å®¿ä¸»")]),s._v("çš„ç›‘æ§, ä¸€ä¸ªæ˜¯ Kubernetes ä¸Šé¢"),t("strong",[s._v("è¿è¡Œå¯¹è±¡")]),s._v("çš„ç›‘æ§, è¿˜æœ‰ä¸€ä¸ª"),t("strong",[s._v("æ˜¯ Pod å†…ä¸šåŠ¡")]),s._v("çš„ç›‘æ§. å®¿ä¸»çš„ç›‘æ§å°±æ˜¯æœºå™¨çš„ç›‘æ§, å‰é¢å·²ç»ä»‹ç»è¿‡. Kubernetes çš„å¯¹è±¡ç›‘æ§, ä½¿ç”¨ kube-state-metrics(ç®€ç§° KSM) ç›‘æ§. Pod å†…çš„ä¸šåŠ¡çš„ç›‘æ§, å·²ç»è¶…è¿‡äº†ç»„ä»¶ç›‘æ§çš„èŒƒç•´, åé¢ä¼šè¯¦ç»†ä»‹ç».")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ Kubernetes ç»„ä»¶ç›‘æ§çš„è¿™ä¸¤è®², ä¼šé‡ç‚¹ä»‹ç»æ§åˆ¶é¢, å·¥ä½œè´Ÿè½½, KSM ä¸‰ä¸ªæ–¹é¢çš„ç›‘æ§. éšç€è¶Šæ¥è¶Šå¤šå…¬å¸é€‰æ‹©å…¬æœ‰äº‘çš„ Kubernetes æ‰˜ç®¡æœåŠ¡, æ§åˆ¶é¢çš„ç»„ä»¶ç›´æ¥äº¤ç»™äº‘å‚å•†æ¥æ‰˜ç®¡äº†, åªéœ€è¦å…³æ³¨å·¥ä½œè´Ÿè½½èŠ‚ç‚¹, æ‰€ä»¥è¿™ä¸€è®²å…ˆæ¥ä»‹ç»å·¥ä½œè´Ÿè½½èŠ‚ç‚¹çš„ç›‘æ§.")]),s._v(" "),t("p",[s._v("å·¥ä½œè´Ÿè½½èŠ‚ç‚¹é‡ç‚¹å…³æ³¨ä¸¤éƒ¨åˆ†, ä¸€ä¸ªæ˜¯"),t("strong",[s._v("å®¹å™¨è´Ÿè½½")]),s._v(", ä¸€ä¸ªæ˜¯"),t("strong",[s._v("ç»„ä»¶")]),s._v(", ç»„ä»¶åˆåŒ…æ‹¬ "),t("strong",[s._v("Kube-Proxy, Kubelet, å®¹å™¨å¼•æ“")]),s._v(". å®¹å™¨å¼•æ“ä¸€èˆ¬ä¸ä¼šå‡ºé—®é¢˜, æ‰€ä»¥é‡ç‚¹å…³æ³¨ Kubernetes çš„ä¸¤ä¸ªç»„ä»¶ "),t("strong",[s._v("Kube-Proxy å’Œ Kubelet")]),s._v(". æŒ‰ç…§å…ˆæ˜“åéš¾, å¾ªåºæ¸è¿›çš„é¡ºåº, å…ˆæ¥çœ‹ä¸€ä¸‹ Kube-Proxy çš„ç›‘æ§æ–¹æ¡ˆ.")]),s._v(" "),t("h4",{attrs:{id:"ç›‘æ§kube-proxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§kube-proxy"}},[s._v("#")]),s._v(" ç›‘æ§Kube-Proxy")]),s._v(" "),t("p",[s._v("æ‰€æœ‰çš„ Kubernetes ç»„ä»¶, éƒ½æä¾›äº† "),t("code",[s._v("/metrics")]),s._v("â€‹ "),t("strong",[s._v("æ¥å£")]),s._v("ç”¨æ¥æš´éœ²ç›‘æ§æ•°æ®, Kube-Proxy ä¹Ÿä¸ä¾‹å¤–. é€šè¿‡ "),t("code",[s._v("ss")]),s._v("â€‹ æˆ–è€… "),t("code",[s._v("netstat")]),s._v("â€‹ å‘½ä»¤å¯ä»¥çœ‹åˆ° Kube-Proxy ç›‘å¬çš„ç«¯å£, ä¸€ä¸ªæ˜¯ 10249, ç”¨æ¥æš´éœ²ç›‘æ§æŒ‡æ ‡, ä¸€ä¸ªæ˜¯ 10256, ä½œä¸ºå¥åº·æ£€æŸ¥çš„ç«¯å£, ä¸€èˆ¬åªå…³æ³¨å‰ä¸€ä¸ªç«¯å£. ä¸‹é¢æ¥æµ‹è¯•ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt-fc-dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# curl -s localhost"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10249")]),s._v("/metrics | head -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n# HELP apiserver_audit_event_total "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ALPHA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Counter of audit events generated and sent to the audit backend.\n# TYPE apiserver_audit_event_total counter\napiserver_audit_event_total "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n# HELP apiserver_audit_requests_rejected_total "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ALPHA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Counter of apiserver requests rejected due to an error in audit logging backend.\n# TYPE apiserver_audit_requests_rejected_total counter\napiserver_audit_requests_rejected_total "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("ä¸éœ€è¦è®¤è¯ç›´æ¥å°±å¯ä»¥æ‹¿åˆ°æŒ‡æ ‡, å¾ˆç®€å•, åªè¦æœ‰ä¸ª"),t("strong",[s._v("é‡‡é›†å™¨")]),s._v("èƒ½å¤ŸæŠ“å–è¿™ä¸ªæ•°æ®å°±å¯ä»¥äº†. æ”¯æŒ Prometheus åè®®æ•°æ®æŠ“å–çš„é‡‡é›†å™¨æŒºå¤šçš„, è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨ Categraf è¿›è¡Œæ¼”ç¤º.")]),s._v(" "),t("h5",{attrs:{id:"_1-é…ç½®é‡‡é›†è§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-é…ç½®é‡‡é›†è§„åˆ™"}},[s._v("#")]),s._v(" 1.é…ç½®é‡‡é›†è§„åˆ™")]),s._v(" "),t("p",[s._v("æŠ“å– Prometheus åè®®çš„æ•°æ®, ä½¿ç”¨ Categraf çš„ input.prometheus æ’ä»¶, é…ç½®æ–‡ä»¶åœ¨ "),t("code",[s._v("conf/input.prometheus/prometheus.toml")]),s._v("â€‹, è¦æŠ“å–å“ªä¸ªç›®æ ‡åœ°å€, å°±ç›´æ¥æŠŠ URL é…ç½®åˆ°æŠ“å–åœ°å€ä¸­, å¯ä»¥å‚è€ƒä¸‹é¢çš„æ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("interval = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("instances"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nurls = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:10249/metrics"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlabels = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" job="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-proxy"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ "),t("code",[s._v("./categraf --test --inputs prometheus")]),s._v("â€‹ æµ‹è¯•äº†, å¦‚æœä¸€åˆ‡æ­£å¸¸, åœ¨æ§åˆ¶å°å°±èƒ½çœ‹åˆ°é‡‡é›†åˆ°çš„ Kube-Proxy ç›¸å…³çš„æŒ‡æ ‡, å…·ä½“å“ªäº›æŒ‡æ ‡æ¯”è¾ƒå…³é”®å‘¢? å…ˆä¸æ€¥, åé¢æˆ‘ä¼šè°ˆåˆ°.")]),s._v(" "),t("p",[s._v("Kube-Proxy åœ¨ Kubernetes é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ¨ç½², å¦‚æœä½¿ç”¨ä¸Šé¢çš„é‡‡é›†è§„åˆ™é…ç½®æ–¹å¼, å°±éœ€è¦åœ¨æ‰€æœ‰ Kubernetes èŠ‚ç‚¹çš„ Categraf ä¸Šé…ç½®é‡‡é›†è§„åˆ™, æœªæ¥æ‰©å®¹èŠ‚ç‚¹çš„æ—¶å€™, ä¹Ÿè¦è®°å¾—åœ¨æ–°èŠ‚ç‚¹é…ç½®é‡‡é›†è§„åˆ™. å¦‚æœæœºå™¨åˆå§‹åŒ–æµç¨‹åšå¾—ä¸é”™, ä¹Ÿè¿˜å¥½, å¦åˆ™çš„è¯å°±ä¼šæ¯”è¾ƒéº»çƒ¦. æˆ‘æ›´æ¨èçš„æ–¹å¼, æ˜¯æŠŠ Categraf ä½œä¸º Daemonset éƒ¨ç½², è¿™æ ·æ¯æ¬¡æ–°èŠ‚ç‚¹æ‰©å®¹, Kubernetes ä¼šè‡ªåŠ¨è°ƒåº¦, çœäº‹ä¸å°‘. ä¸‹é¢æˆ‘æ¥æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•éƒ¨ç½² Categraf Daemonset.")]),s._v(" "),t("h5",{attrs:{id:"_2-ä½¿ç”¨daemonsetéƒ¨ç½²é‡‡é›†å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-ä½¿ç”¨daemonsetéƒ¨ç½²é‡‡é›†å™¨"}},[s._v("#")]),s._v(" 2.ä½¿ç”¨Daemonsetéƒ¨ç½²é‡‡é›†å™¨")]),s._v(" "),t("p",[s._v("è¦æŠŠ Categraf éƒ¨ç½²ä¸º Daemonset, éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª namespace, ç„¶åæŠŠç›¸å…³çš„é…ç½®åšæˆ ConfigMap, ä¸‹é¢åšä¸€ä¸ªæ¼”ç¤º, å…ˆåˆ›å»º namespace.")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ›å»º namespace")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt-fc-dev01.nj categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl create namespace flashcat\nnamespace/flashcat created\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥è¯¢åˆšåˆšåˆ›å»ºçš„namespace, çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt-fc-dev01.nj categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl get ns "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" flashcat\nflashcat                                 Active   29s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("ç„¶ååˆ›å»º ConfigMap, ConfigMap ç”¨æ¥æ”¾ç½® Categraf çš„ä¸»é…ç½® config.toml, ä»¥åŠ input.prometheus æ’ä»¶çš„é…ç½® prometheus.toml, å¯ä»¥çœ‹ä¸€ä¸‹ç›¸å…³çš„ YAML å†…å®¹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config.toml")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n    [global]\n    hostname = "$HOSTNAME"\n    interval = 15\n    providers = ["local"]\n    [writer_opt]\n    batch = 2000\n    chan_size = 10000\n    [[writers]]\n    url = "http://10.206.0.16:19000/prometheus/v1/write"\n    timeout = 5000\n    dial_timeout = 2500\n    max_idle_conns_per_host = 100')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("input"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prometheus\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prometheus.toml")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n    [[instances]]\n    urls = ["http://127.0.0.1:10249/metrics"]\n    labels = { job="kube-proxy" }')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("ä¸Šä¾‹ä¸­çš„ "),t("code",[s._v("http://10.206.0.16:19000/prometheus/v1/write")]),s._v("â€‹ æ˜¯ä¸€ä¸ªæ”¯æŒ Prometheus Remote Write åè®®çš„æ•°æ®æ¥æ”¶åœ°å€, å¯ä»¥ä½¿ç”¨ä½ çš„ n9e-server, ä¹Ÿå¯ä»¥ä½¿ç”¨ vminsert, prometheus ç­‰å…¶ä»–æ”¯æŒ RemoteWrite åè®®çš„åœ°å€. "),t("code",[s._v('hostname = "$HOSTNAME"')]),s._v("â€‹ è¿™ä¸ªé…ç½®ç”¨äº† "),t("code",[s._v("$")]),s._v("â€‹ ç¬¦å·, åé¢åˆ›å»º Daemonset çš„æ—¶å€™ä¼šæ³¨å…¥ HOSTNAME è¿™ä¸ªç¯å¢ƒå˜é‡, è®© Categraf è‡ªåŠ¨æ‹¿åˆ°.")]),s._v(" "),t("p",[s._v("prometheus.toml çš„é…ç½®ä¸­, é™¤äº†ç»™å‡º Kube-Proxy çš„æŠ“å–åœ°å€, è¿˜æ‰‹å·¥æŒ‡å®šäº†ä¸€ä¸ª "),t("strong",[s._v("job æ ‡ç­¾")]),s._v(", ç”¨æ¥æ ‡è¯†è¿™ä¸ªæ•°æ®æ¥è‡ªå“ªä¸ªç»„ä»¶. å¦‚æœå…¬å¸æœ‰å¤šå¥— Kubernetes é›†ç¾¤, æ‰€æœ‰ç›‘æ§æ•°æ®éƒ½ä¼šè¿›åˆ°ä¸€ä¸ªæ—¶åºåº“, "),t("strong",[s._v("ä¸ºäº†åŒºåˆ†ä¸åŒçš„é›†ç¾¤, å»ºè®®åœ¨æ ‡ç­¾é‡Œå†åŠ ä¸€ä¸ª cluster çš„æ ‡ç­¾")]),s._v(".")]),s._v(" "),t("p",[s._v("æ¯”å¦‚:")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("labels = "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(' job="kube'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('proxy"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' cluster="beijing01" '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¸‹é¢æŠŠ ConfigMap åˆ›å»ºå‡ºæ¥.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt-fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl apply "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" categraf-configmap-v1.yaml "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" flashcat\nconfigmap/categraf-config created\nconfigmap/categraf-input-prometheus created\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt-fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl get configmap "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" flashcat\nNAME                        DATA   AGE\ncategraf-config             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      19s\ncategraf-input-prometheus   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      19s\nkube-root-ca.crt            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      22m\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("é…ç½®æ–‡ä»¶å‡†å¤‡å¥½äº†, æ¥ä¸‹æ¥å°±å¯ä»¥åˆ›å»º Daemonset äº†. è¿™é‡Œè¦æ³¨æ„, æŠŠ HOSTNAME ä½œä¸ºç¯å¢ƒå˜é‡æ³¨å…¥è¿›å», å¯ä»¥å‚è€ƒä¸‹é¢ Daemonset çš„ YAML æ–‡ä»¶.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DaemonSet\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TZ\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Asia/Shanghai\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HOSTNAME\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" spec.nodeName\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HOSTIP\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" status.hostIP\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flashcatcloud/categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.2.18\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/categraf/conf\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/categraf/conf/input.prometheus\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("input"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prometheus\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostNetwork")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NoSchedule\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Exists\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("input"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prometheus\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("input"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prometheus\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br")])]),t("p",[s._v("æœ€åä¸€æ­¥, apply ä¸€ä¸‹è¿™ä¸ª Daemonset çš„ YAML æ–‡ä»¶.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj yamls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl apply "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1.yaml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("n flashcat\ndaemonset.apps/categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset created\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj yamls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl get ds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o wide "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("n flashcat\nNAME                 DESIRED   CURRENT   READY   UP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("TO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("DATE   AVAILABLE   NODE SELECTOR   AGE     CONTAINERS   IMAGES                           SELECTOR\ncategraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset   6         6         6       6            6           <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("          2m20s   categraf     flashcatcloud/categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.2.17   app=categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj yamls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl get pods "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o wide "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("n flashcat\nNAME                       READY   STATUS    RESTARTS   AGE     IP            NODE          NOMINATED NODE   READINESS GATES\ncategraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4qlt9   1/1     Running   0          2m10s   10.206.0.7    10.206.0.7    <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("           <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\ncategraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s9bk2   1/1     Running   0          2m10s   10.206.0.11   10.206.0.11   <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("           <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\ncategraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("w77lt   1/1     Running   0          2m10s   10.206.16.3   10.206.16.3   <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("           <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\ncategraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("xgwf5   1/1     Running   0          2m10s   10.206.0.16   10.206.0.16   <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("           <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\ncategraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("z9rk5   1/1     Running   0          2m10s   10.206.16.8   10.206.16.8   <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("           <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\ncategraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zdp8v   1/1     Running   0          2m10s   10.206.0.17   10.206.0.17   <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("           <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("çœ‹èµ·æ¥ä¸€åˆ‡æ­£å¸¸, å»ç›‘æ§æœåŠ¡ç«¯æŸ¥è¯¢ä¸€ä¸‹ kubeproxy æ‰“å¤´çš„æŒ‡æ ‡, ç†è®ºä¸Šå°±èƒ½çœ‹åˆ°é‡‡é›†åˆ°çš„æ•°æ®äº†. Kube-Proxy æš´éœ²äº†ä¸å°‘æŒ‡æ ‡, ä¸‹é¢æŒ‘é€‰ä¸€äº›å…³é”®æŒ‡æ ‡ç¨ä½œè§£é‡Š.")]),s._v(" "),t("h5",{attrs:{id:"_3-kube-proxyæŒ‡æ ‡è§£é‡Š"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-kube-proxyæŒ‡æ ‡è§£é‡Š"}},[s._v("#")]),s._v(" 3.Kube-ProxyæŒ‡æ ‡è§£é‡Š")]),s._v(" "),t("blockquote",[t("p",[s._v("é€šç”¨çš„Goç¨‹åºç›¸å…³çš„æŒ‡æ ‡")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/50c462b926b60257743242d6e425801c-20230719203435-jpyabej.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("ä»¥ä¸ŠæŒ‡æ ‡, åªè¦æ˜¯é€šè¿‡ Prometheus Go SDK åŸ‹ç‚¹çš„ç¨‹åºéƒ½ä¼šæœ‰, é™¤äº† Kube-Proxy, åé¢ä»‹ç»çš„ Kubelet, APIServer, Scheduler ç­‰, ä¹Ÿå…¨éƒ¨éƒ½æœ‰, è¿™é‡Œéœ€è¦è®°ä½.")]),s._v(" "),t("blockquote",[t("p",[s._v("è¯·æ±‚APIServerçš„æŒ‡æ ‡")])]),s._v(" "),t("p",[s._v("Kubernetes ä¸­å¤šä¸ªç»„ä»¶éƒ½è¦è°ƒç”¨ APIServer çš„æ¥å£, æ¯ç§’è°ƒç”¨å¤šå°‘æ¬¡, æœ‰å¤šå°‘æˆåŠŸå¤šå°‘å¤±è´¥, è€—æ—¶æƒ…å†µå¦‚ä½•, è¿™äº›æŒ‡æ ‡ä¹Ÿæ¯”è¾ƒå…³é”®.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚:")]),s._v(" "),t("ul",[t("li",[s._v("rest_client_request_duration_seconds: è¯·æ±‚ APIServer çš„è€—æ—¶ç»Ÿè®¡")]),s._v(" "),t("li",[s._v("rest_client_requests_total: è¯·æ±‚ APIServer çš„è°ƒç”¨é‡ç»Ÿè®¡")])]),s._v(" "),t("blockquote",[t("p",[s._v("è§„åˆ™åŒæ­¥ç±»æŒ‡æ ‡")])]),s._v(" "),t("p",[s._v("Kube-Proxy çš„æ ¸å¿ƒèŒèƒ½, å°±æ˜¯å» APIServer è·å–è½¬å‘è§„åˆ™, ä¿®æ”¹æœ¬åœ°çš„ iptables æˆ–è€… ipvs çš„è§„åˆ™, æ‰€ä»¥è¿™äº›è§„åˆ™åŒæ­¥ç›¸å…³çš„æŒ‡æ ‡, å°±è‡³å…³é‡è¦äº†. è¿™é‡Œåˆ—å‡ºå‡ ä¸ªæ ¸å¿ƒæŒ‡æ ‡.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/d8d8db1e76df059c540c67f6928bf030-20230719203435-pg230x7.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("Categraf å†…ç½®äº† Kube-Proxy çš„ "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/kube_proxy/dashboard-by-ident.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›‘æ§å¤§ç›˜"),t("OutboundLink")],1),s._v(", å…³é”®çš„æ ¸å¿ƒæŒ‡æ ‡éƒ½å·²ç»åšåˆ°ç›‘æ§å¤§ç›˜é‡Œäº†, å¯¼å…¥å¤œèºå°±èƒ½ä½¿ç”¨.")]),s._v(" "),t("h4",{attrs:{id:"ç›‘æ§kubelet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§kubelet"}},[s._v("#")]),s._v(" ç›‘æ§Kubelet")]),s._v(" "),t("p",[s._v("ä¸‹é¢ç»§ç»­çœ‹å·¥ä½œè´Ÿè½½èŠ‚ç‚¹çš„ç¬¬äºŒä¸ªç»„ä»¶ Kubelet åº”è¯¥å¦‚ä½•ç›‘æ§.")]),s._v(" "),t("p",[s._v("Kubelet ä¹Ÿæ˜¯åœ¨æ‰€æœ‰ Kubernetes èŠ‚ç‚¹ä¸Šéƒ¨ç½²çš„, ç†è®ºä¸Šå¯ä»¥é‡‡ç”¨å’Œ Kube-Proxy å®Œå…¨ä¸€æ ·çš„ç›‘æ§æ–¹æ³•, ä½†æ˜¯ Kubelet çš„æ¥å£éœ€è¦è®¤è¯, æ¥æµ‹è¯•ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps aux|grep kubelet")]),s._v("\nroot      163490  0.0  0.0  12136  1064 pts/1    S+   13"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("34   0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("00 grep "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("color=auto kubelet\nroot      166673  3.2  1.0 3517060 81336 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("       Ssl  Aug16 4176"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("52 /usr/bin/kubelet "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bootstrap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kubeconfig=/etc/kubernetes/bootstrap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kubelet.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kubeconfig=/etc/kubernetes/kubelet.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config=/var/lib/kubelet/config.yaml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("override=10.206.0.16 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("plugin=cni "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("infra"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("image=registry.aliyuncs.com/google_containers/pause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /var/lib/kubelet/config.yaml | grep 102")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("healthzPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10248")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:10248/healthz")]),s._v("\nok\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:10250/metrics")]),s._v("\nClient sent an HTTP request to an HTTPS server.\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl https://localhost:10250/metrics")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("curl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("(60) SSL certificate problem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self signed certificate in certificate chain\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("More details here")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//curl.haxx.se/docs/sslcerts.html\n\ncurl failed to verify the legitimacy of the server and therefore could not\nestablish a secure connection to it. To learn more about this situation and\nhow to fix it"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" please visit the web page mentioned above.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -k https://localhost:10250/metrics")]),s._v("\nUnauthorized\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("è¿™å‡ æ¡æµ‹è¯•å‘½ä»¤å¯ä»¥è¯´æ˜å¾ˆå¤šé—®é¢˜, é¦–å…ˆæ˜¯ Kubelet ç›‘å¬äº†ä¸¤ä¸ªç«¯å£, ä¸€ä¸ªæ˜¯ 10248, æ˜¯ä¸ªå¥åº·æ£€æŸ¥ç«¯å£, å¦ä¸€ä¸ªæ˜¯ 10250, æš´éœ² metrics æŒ‡æ ‡, ä½†æ˜¯è®¿é—®è¿™ä¸ªæ¥å£éœ€è¦ä¼ å…¥ Authorization çš„ Token, ä¸‹é¢å°±æ¥åˆ›å»º ServiceAccount. Kubernetes ä¼šä¸º ServiceAccount è‡ªåŠ¨åˆ†é… Token.")]),s._v(" "),t("h5",{attrs:{id:"_1-å¼•å…¥è®¤è¯ä¿¡æ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å¼•å…¥è®¤è¯ä¿¡æ¯"}},[s._v("#")]),s._v(" 1.å¼•å…¥è®¤è¯ä¿¡æ¯")]),s._v(" "),t("p",[s._v("åªåˆ›å»º ServiceAccount æ²¡ä»€ä¹ˆç”¨, è¿˜éœ€è¦ä¸ºè¿™ä¸ªè´¦å·ç»‘å®šæƒé™, Kubernetes ä¸­ä½¿ç”¨ ClusterRole æ¥å®šä¹‰æƒé™, ä½¿ç”¨ ClusterRoleBinding æ¥ç»‘å®š ClusterRole å’Œ ServiceAccount, ä¸‹é¢æ˜¯ç›¸å…³ YAML å®šä¹‰.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes/metrics\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes/stats\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes/proxy\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" get\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flashcat\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRoleBinding\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flashcat\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("æŠŠä¸Šé¢çš„å†…å®¹ä¿å­˜ä¸º auth.yaml, apply ä¸€ä¸‹, ç„¶åä» ServiceAccount ä¸­æå– Token, åšä¸€ä¸‹ metrics æ¥å£çš„è¯·æ±‚æµ‹è¯•.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj yamls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl apply "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f auth.yaml\nclusterrole.rbac.authorization.k8s.io/categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset created\nserviceaccount/categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset created\nclusterrolebinding.rbac.authorization.k8s.io/categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset created\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("work@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj yamls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl get sa "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("n flashcat\nNAME                 SECRETS   AGE\ncategraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset   1         90m\ndefault              1         4d23h\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj qinxiaohui"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get sa categraf-daemonset -n flashcat -o yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubectl.kubernetes.io/last-applied-configuration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n      {"apiVersion":"v1","kind":"ServiceAccount","metadata":{"annotations":{},"name":"categraf-daemonset","namespace":"flashcat"}}')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-11-14T03:53:54Z"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flashcat\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"120570510"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 22f5a785"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("871c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4454"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("b82e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("12bf104450a0\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secrets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("7mccq\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj qinxiaohui"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# token=`kubectl get secret categraf-daemonset-token-7mccq -n flashcat -o jsonpath={.data.token} | base64 -d`")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj qinxiaohui"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# curl -s -k -H "Authorization: Bearer $token" https://localhost:10250/metrics > aaaa')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev01.nj qinxiaohui"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# head -n 5 aaaa")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP apiserver_audit_event_total [ALPHA] Counter of audit events generated and sent to the audit backend.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE apiserver_audit_event_total counter")]),s._v("\napiserver_audit_event_total 0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP apiserver_audit_requests_rejected_total [ALPHA] Counter of apiserver requests rejected due to an error in audit logging backend.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE apiserver_audit_requests_rejected_total counter")]),s._v("\napiserver_audit_requests_rejected_total 0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[s._v("è¿™å‡ ä¸ªå‘½ä»¤çœ‹èµ·æ¥æ¯”è¾ƒæ¸…æ™°äº†, åˆ›å»ºçš„ ServiceAccount åä¸º categraf-daemonset, å¯¼å‡ºä¸º YAML ä¹‹å, çœ‹åˆ° secret çš„ name æ˜¯ categraf-daemonset-token-7mccq, ç„¶åä»è¿™ä¸ª secret ä¸­è§£å‡º Token, æ”¾åˆ° Header é‡Œ, è¯·æ±‚ Kubelet çš„ metrics æ¥å£, æœ€ç»ˆæ‹¿åˆ°äº†æ•°æ®, æå®šæ”¶å·¥.")]),s._v(" "),t("p",[s._v("åé¢æŠŠ Categraf ä½œä¸ºé‡‡é›†å™¨åšæˆ Daemonset, å†ä¸º Categraf è¿™ä¸ª Daemonset æŒ‡å®š ServiceAccountName, Kuberneteså°±ä¼šè‡ªåŠ¨æŠŠ Token çš„å†…å®¹æŒ‚åˆ° Daemonset çš„ç›®å½•é‡Œ, ä¸‹é¢å¼€å§‹å®æ“.")]),s._v(" "),t("h5",{attrs:{id:"_2-å‡çº§categraf-daemonset"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å‡çº§categraf-daemonset"}},[s._v("#")]),s._v(" 2.å‡çº§Categraf Daemonset")]),s._v(" "),t("p",[s._v("é‡‡é›† Kube-Proxy çš„æ—¶å€™, å·²ç»å‡†å¤‡å¥½äº† Categraf Daemonset ç”¨åˆ°çš„ ConfigMap, å½“æ—¶åªæ˜¯æŠ“å–äº† Kube-Proxy çš„ metrics æ•°æ®, ä¸‹é¢å‡çº§ä¸€ä¸‹è¿™ä¸ª ConfigMap çš„å†…å®¹, åŠ ä¸Šå¯¹ Kubelet çš„æ•°æ®æŠ“å–è§„åˆ™.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config.toml")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n    [global]\n    hostname = "$HOSTNAME"\n    interval = 15\n    providers = ["local"]\n    [writer_opt]\n    batch = 2000\n    chan_size = 10000\n    [[writers]]\n    url = "http://10.206.0.16:19000/prometheus/v1/write"\n    timeout = 5000\n    dial_timeout = 2500\n    max_idle_conns_per_host = 100')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("input"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prometheus\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prometheus.toml")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n    [[instances]]\n    urls = ["http://127.0.0.1:10249/metrics"]\n    labels = { job="kube-proxy" }\n    [[instances]]\n    urls = ["https://127.0.0.1:10250/metrics"]\n    bearer_token_file = "/var/run/secrets/kubernetes.io/serviceaccount/token"\n    use_tls = true\n    insecure_skip_verify = true\n    labels = { job="kubelet" }\n    [[instances]]\n    urls = ["https://127.0.0.1:10250/metrics/cadvisor"]\n    bearer_token_file = "/var/run/secrets/kubernetes.io/serviceaccount/token"\n    use_tls = true\n    insecure_skip_verify = true\n    labels = { job="cadvisor" }')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("p",[s._v("Kubelet åœ¨ 10250 ç«¯å£æš´éœ²äº†ä¸¤ç±» metrics æ•°æ®, ä¸€ä¸ªæ˜¯ "),t("code",[s._v("/metrics")]),s._v("â€‹, æš´éœ²çš„æ˜¯ Kubelet è‡ªèº«çš„ç›‘æ§æ•°æ®, å¦ä¸€ä¸ªæ˜¯ "),t("code",[s._v("/metrics/cadvisor")]),s._v("â€‹, æš´éœ²çš„æ˜¯å®¹å™¨çš„ç›‘æ§æ•°æ®.")]),s._v(" "),t("p",[s._v("ç„¶åä¿®æ”¹ä¸€ä¸‹ä¹‹å‰çš„ Daemonset çš„ yaml æ–‡ä»¶, åœ¨ hostNetwork è¿™ä¸€è¡Œä¸‹é¢å¢åŠ  ServiceAccountName é…ç½®, å¯ä»¥çœ‹ä¸‹ç¤ºä¾‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostNetwork")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccountName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("daemonset\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å¯ä»¥æŠŠä¹‹å‰çš„ Daemonset ç›´æ¥åˆ é™¤, ä½¿ç”¨æ–°çš„ yaml é‡æ–°åˆ›å»º, ç¨ç­‰ç‰‡åˆ», å°±èƒ½åœ¨æœåŠ¡ç«¯æŸ¥è¯¢åˆ° Kubelet å’Œå®¹å™¨çš„ç›‘æ§æ•°æ®äº†.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/6a51byye73ef6ae2bdc1888d0df8d5ac-20230719203435-5v1tqpt.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("h5",{attrs:{id:"_3-kubeletå…³é”®æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-kubeletå…³é”®æŒ‡æ ‡"}},[s._v("#")]),s._v(" 3.Kubeletå…³é”®æŒ‡æ ‡")]),s._v(" "),t("p",[s._v("Kubelet ä¹Ÿä¼šåå‡º "),t("strong",[s._v("Go è¿›ç¨‹")]),s._v("ç›¸å…³çš„é€šç”¨æŒ‡æ ‡ä»¥åŠå’Œ APIServer é€šä¿¡ç›¸å…³çš„åº¦é‡æŒ‡æ ‡, å’Œ Kube-Proxy ç±»ä¼¼. Kubelet æ ¸å¿ƒèŒèƒ½æ˜¯ç®¡ç† Pod, æ“ä½œå„ç§ CNI, CSI ç›¸å…³çš„æ¥å£, å’Œå®¹å™¨å¼•æ“æ‰“äº¤é“, åº¦é‡è¿™ç±»æ“ä½œçš„æŒ‡æ ‡å°±æ˜¾å¾—å°¤ä¸ºå…³é”®.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/ab350235163ca9f4b0b0af717765fe85-20230719203435-ukgee4v.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("Categraf å†…ç½®äº† Kubelet çš„ "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/inputs/kubelet/dashboard-by-ident.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›‘æ§å¤§ç›˜"),t("OutboundLink")],1),s._v(", å…³é”®çš„æ ¸å¿ƒæŒ‡æ ‡éƒ½å·²ç»åšåˆ°ç›‘æ§å¤§ç›˜é‡Œäº†, å¯¼å…¥å¤œèºå°±èƒ½ä½¿ç”¨.")]),s._v(" "),t("p",[s._v("åˆšæ‰åœ¨å‡çº§ Categraf Daemonset çš„ ConfigMap çš„æ—¶å€™, ä¸åªé‡‡é›†äº† Kubelet çš„æŒ‡æ ‡, è¿˜ä¸€å¹¶é‡‡é›†äº†å®¹å™¨çš„æŒ‡æ ‡, Categraf ä¹Ÿæä¾›äº†å®¹å™¨çš„ "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/k8s/pod-dash.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›‘æ§å¤§ç›˜"),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("h5",{attrs:{id:"_4-å®¹å™¨è´Ÿè½½æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-å®¹å™¨è´Ÿè½½æŒ‡æ ‡"}},[s._v("#")]),s._v(" 4.å®¹å™¨è´Ÿè½½æŒ‡æ ‡")]),s._v(" "),t("p",[s._v("å…³äºå®¹å™¨, è¿™é‡Œä¹Ÿé€‰å‡ ä¸ªæ ¸å¿ƒçš„æŒ‡æ ‡è§£é‡Šä¸€ä¸‹. "),t("strong",[s._v("å®¹å™¨è´Ÿè½½ä¸»è¦æ˜¯å…³å¿ƒ CPU, å†…å­˜, ç½‘ç»œ, IO, å°¤å…¶æ˜¯ CPU å’Œå†…å­˜")]),s._v(", ä¸€èµ·çœ‹ä¸€ä¸‹ç›¸å…³æŒ‡æ ‡çš„è¯´æ˜.")]),s._v(" "),t("h6",{attrs:{id:"_1-cpuæŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-cpuæŒ‡æ ‡"}},[s._v("#")]),s._v(" (1)CPUæŒ‡æ ‡")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("sum(\nirate(container_cpu_usage_seconds_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("3m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(")\n) by (pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ident"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("image)\n/\nsum(\ncontainer_spec_cpu_quota/container_spec_cpu_period\n) by (pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ident"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("image)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("è¿™æ˜¯è®¡ç®— CPU ä½¿ç”¨ç‡, æ•´ä½“æ˜¯ä¸€ä¸ªé™¤æ³•è¿ç®—, åˆ†å­éƒ¨åˆ†æ˜¯å®¹å™¨æ¯ç§’è€—è´¹çš„ CPU æ—¶é—´, åˆ†æ¯éƒ¨åˆ†æ˜¯æ¯ç§’åˆ†é…ç»™å®¹å™¨çš„ CPU æ—¶é—´. é‡Œè¾¹çš„ ident æ ‡ç­¾æ˜¯ Categraf é‡‡é›†æ—¶è‡ªåŠ¨åŠ çš„, å¦‚æœé‡‡é›†æ–¹å¼ä¸åŒ, å¯èƒ½è¦é€‚å½“è°ƒæ•´ by åé¢çš„æ ‡ç­¾é›†.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("increase(container_cpu_cfs_throttled_periods_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(")\n/\nincrease(container_cpu_cfs_periods_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(") * 100\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("è¿™æ˜¯åœ¨è®¡ç®— CPU è¢«é™åˆ¶çš„æ—¶é—´æ¯”ä¾‹, å¦‚æœè¿™ä¸ªå€¼å¾ˆé«˜, è¯´æ˜å®¹å™¨åœ¨ä½¿ç”¨ CPU èµ„æºçš„æ—¶å€™ç»å¸¸è¢«é™åˆ¶, éœ€è¦æé«˜è¿™ä¸ªå®¹å™¨çš„ CPU Quota. å»¶è¿Ÿæ•æ„Ÿå‹çš„åº”ç”¨, éœ€è¦ç‰¹åˆ«å…³æ³¨è¿™ä¸ªæŒ‡æ ‡.")]),s._v(" "),t("h6",{attrs:{id:"_2-å†…å­˜æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†…å­˜æŒ‡æ ‡"}},[s._v("#")]),s._v(" (2)å†…å­˜æŒ‡æ ‡")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("container_memory_working_set_bytes\n/\ncontainer_spec_memory_limit_bytes\nand\ncontainer_spec_memory_limit_bytes "),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!=")]),s._v(" 0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("è®¡ç®—å†…å­˜ä½¿ç”¨ç‡çš„æ—¶å€™, æ ¸å¿ƒä¹Ÿæ˜¯ä¸€ä¸ªé™¤æ³•è¿ç®—, åˆ†å­æ˜¯å®¹å™¨çš„å†…å­˜å ç”¨, åˆ†æ¯æ˜¯å†…å­˜ Limit å¤§å°. å½“ç„¶, æœ‰äº›å®¹å™¨æ²¡æœ‰æŒ‡å®šå†…å­˜Limit, æ‰€ä»¥è¿˜éœ€è¦æœ‰ä¸ª and è¯­å¥æ¥åšé™åˆ¶, åªæœ‰ limit_bytes ä¸ç­‰äº 0, è¿™ä¸ªé™¤æ³•è¿ç®—æ‰æœ‰æ„ä¹‰.")]),s._v(" "),t("h6",{attrs:{id:"_3-podç½‘ç»œæµé‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-podç½‘ç»œæµé‡"}},[s._v("#")]),s._v(" (3)Podç½‘ç»œæµé‡")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("irate(container_network_transmit_bytes_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(") * 8\nirate(container_network_receive_bytes_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(") * 8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™ä¸ªæŒ‡æ ‡åå­—éå¸¸æ¸…æ™°, transmit æ˜¯å‡ºå‘, receive æ˜¯å…¥å‘, è¿™ä¸¤ä¸ªæŒ‡æ ‡éƒ½æ˜¯ Counter ç±»å‹çš„å€¼, å•è°ƒé€’å¢, æ‰€ä»¥ä½¿ç”¨ irate è®¡ç®—æ¯ç§’é€Ÿç‡. å› ä¸ºç½‘ç»œæµé‡ä¸€èˆ¬éƒ½æ˜¯ç”¨ bit ä½œä¸ºå•ä½, æ‰€ä»¥æœ€åä¹˜ä»¥ 8, æŠŠ byte æ¢ç®—æˆ bit.")]),s._v(" "),t("h6",{attrs:{id:"_4-podç¡¬ç›˜ioè¯»å†™æµé‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-podç¡¬ç›˜ioè¯»å†™æµé‡"}},[s._v("#")]),s._v(" (4)Podç¡¬ç›˜IOè¯»å†™æµé‡")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("irate(container_fs_reads_bytes_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(")\nirate(container_fs_writes_bytes_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(")\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿™ä¸ªæŒ‡æ ‡åå­—ä¸€çœ‹å°±çŸ¥é“æ˜¯ Counter ç±»å‹, ä¸å…³å¿ƒå½“å‰å€¼æ˜¯å¤šå°‘, è€Œæ˜¯å…³å¿ƒ"),t("strong",[s._v("æœ€è¿‘ä¸€æ®µæ—¶é—´")]),s._v("æ¯ç§’çš„é€Ÿç‡æ˜¯å¤šå°‘, æ‰€ä»¥ä½¿ç”¨ irate åšäº†äºŒæ¬¡è®¡ç®—.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-16"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-16"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä»‹ç»äº† Kubernetes çš„ç›‘æ§, Kubernetes ç»„ä»¶ä¼—å¤š, é€šè¿‡æ¶æ„å›¾å¯ä»¥çœ‹å‡º, å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†, ä¸€ä¸ªæ˜¯æ§åˆ¶é¢ç»„ä»¶, ä¸€ä¸ªæ˜¯å·¥ä½œè´Ÿè½½èŠ‚ç‚¹ç›¸å…³ç»„ä»¶. æœ¬èŠ‚é‡ç‚¹ä»‹ç»äº†å·¥ä½œè´Ÿè½½èŠ‚ç‚¹ç›¸å…³çš„ç»„ä»¶, åŒ…æ‹¬ Kube-Proxy, Kubelet, å®¹å™¨è´Ÿè½½. å½“ç„¶, å®¹å™¨å¼•æ“æ˜¯å¦å­˜æ´»ä¹Ÿæ˜¯éœ€è¦å…³æ³¨çš„, ä¸è¿‡å®¹å™¨å¼•æ“ä¸€èˆ¬éƒ½é€šè¿‡ systemd æ‰˜ç®¡, æŒ‚æ‰ä¹‹åä¼šè‡ªåŠ¨æ‹‰èµ·, å‡ºé—®é¢˜çš„æ¦‚ç‡å¾ˆå°.")]),s._v(" "),t("p",[t("strong",[s._v("Kube-Proxy çš„ç›‘æ§æ¯”è¾ƒç®€å•, é€šè¿‡ metrics æ¥å£ç›´æ¥æš´éœ²ç›‘æ§æŒ‡æ ‡, æ²¡æœ‰è®¤è¯é‰´æƒ, ä½¿ç”¨ Categraf ç›´æ¥æ‹‰å–å°±å¯ä»¥äº†")]),s._v(". ä¸ºäº†ä¾¿äºç®¡ç†, å»ºè®®æŠŠ Categraf åšæˆ Daemonset. Kube-Proxy çš„å…³é”®æŒ‡æ ‡åˆ†ä¸‰ç±»: "),t("strong",[s._v("ä¸€æ˜¯é€šç”¨çš„ Go ç¨‹åºç›¸å…³çš„æŒ‡æ ‡, æ‰€æœ‰çš„ Kubernetes ç»„ä»¶éƒ½æœ‰è¿™ç±»æŒ‡æ ‡; äºŒæ˜¯è¯·æ±‚ APIServer ç›¸å…³çš„æŒ‡æ ‡, æ‰€æœ‰è¯·æ±‚ APIServer çš„æ¨¡å—éƒ½æœ‰è¿™ç±»æŒ‡æ ‡; ä¸‰æ˜¯è§„åˆ™åŒæ­¥ç±»æŒ‡æ ‡, å› ä¸º Kube-Proxy æ ¸å¿ƒèŒèƒ½å°±æ˜¯è¦åšå¥½è§„åˆ™åŒæ­¥, æ‰€ä»¥è¿™ç±»æŒ‡æ ‡æ˜¯æœ€å…³é”®çš„")]),s._v(".")]),s._v(" "),t("p",[s._v("Kubelet çš„ç›‘æ§, ç›¸å¯¹æ›´å¤æ‚, å› ä¸ºæœ‰è®¤è¯é‰´æƒçš„è¦æ±‚, éœ€è¦åˆ›å»º ServiceAccount, ClusterRole, ClusterRoleBinding ç­‰å¯¹è±¡. å› ä¸º Kubelet ä¹Ÿæ˜¯åœ¨æ‰€æœ‰å®¿ä¸»ä¸Šçš„, æ‰€ä»¥é‡‡é›†å™¨ä¹Ÿå¯ä»¥éƒ¨ç½²ä¸º Daemonset. Kubelet çš„å…³é”®æŒ‡æ ‡æ˜¯è·Ÿæ“ä½œç›¸å…³çš„, æ¯”å¦‚æ“ä½œ Docker å¼•æ“, æ“ä½œç½‘ç»œæ’ä»¶ç­‰, è¿™äº›æ“ä½œçš„æ¬¡æ•°, æˆåŠŸä¸å¦, éƒ½éå¸¸å…³é”®.")]),s._v(" "),t("p",[s._v("Kubelet çš„æ¥å£è¿˜æš´éœ²äº†å®¹å™¨è´Ÿè½½æŒ‡æ ‡, é€šè¿‡ /metrics/cadvisor æ¥æŠ“å–, é‡ç‚¹å…³æ³¨ CPU, å†…å­˜, ç½‘ç»œ, ç¡¬ç›˜ IO ç­‰æŒ‡æ ‡. CPU æ–¹é¢å°¤å…¶è¦æ³¨æ„å®¹å™¨è¢«é™åˆ¶çš„æ—¶é—´æ¯”ä¾‹, å¯¹äºå»¶è¿Ÿæ•æ„Ÿå‹ä¸šåŠ¡æœ‰è¾ƒå¤§å½±å“.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/bcd9aa98db0acb107db94c63db1yy3f1-20230719203435-fvzwy7g.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_18-ç»„ä»¶ç›‘æ§-kubernetesæ§åˆ¶é¢ç»„ä»¶çš„å…³é”®æŒ‡æ ‡ä¸æ•°æ®é‡‡é›†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_18-ç»„ä»¶ç›‘æ§-kubernetesæ§åˆ¶é¢ç»„ä»¶çš„å…³é”®æŒ‡æ ‡ä¸æ•°æ®é‡‡é›†"}},[s._v("#")]),s._v(" 18.ç»„ä»¶ç›‘æ§-Kubernetesæ§åˆ¶é¢ç»„ä»¶çš„å…³é”®æŒ‡æ ‡ä¸æ•°æ®é‡‡é›†")]),s._v(" "),t("p",[s._v("å‰é¢ä»‹ç»äº† Kubernetes "),t("strong",[s._v("å·¥ä½œè´Ÿè½½èŠ‚ç‚¹")]),s._v(" çš„ç›‘æ§, äº†è§£äº† Kube-Proxy, Kubelet, å®¹å™¨è´Ÿè½½ç›‘æ§çš„æ–¹æ³•. æœ¬èŠ‚ä»‹ç» "),t("strong",[s._v("æ§åˆ¶é¢ç»„ä»¶")]),s._v(" çš„ç›‘æ§, åŒ…æ‹¬ "),t("strong",[s._v("APIServer, Controller-manager(ç®€ç§°CM), Scheduler, etcd")]),s._v(" å››ä¸ªç»„ä»¶, æœ¬èŠ‚ä¼šè®²è§£è¿™å‡ ä¸ªç»„ä»¶ç›‘æ§æ•°æ®çš„é‡‡é›†æ–¹æ³•å’Œå…³é”®æŒ‡æ ‡, å¹¶ç»™å‡ºç›‘æ§å¤§ç›˜. æ­¤å¤–è¿˜ä¼šå­¦ä¹ å¦‚ä½•ä½¿ç”¨ kube-state-metrics(ç®€ç§° KSM)æ¥ç›‘æ§ Kubernetes çš„å„ç±»å¯¹è±¡.")]),s._v(" "),t("h4",{attrs:{id:"æ•°æ®é‡‡é›†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®é‡‡é›†"}},[s._v("#")]),s._v(" æ•°æ®é‡‡é›†")]),s._v(" "),t("p",[s._v("è‡ªè¡Œæ­å»º Kubernetes æ§åˆ¶é¢çš„æœ‹å‹, å¤§éƒ½æ˜¯é€‰æ‹© "),t("strong",[s._v("Kubeadm")]),s._v(" è¿™æ ·çš„å·¥å…·, Kubeadm ä¼šæŠŠæ§åˆ¶é¢çš„ç»„ä»¶ä»¥é™æ€å®¹å™¨çš„æ–¹å¼æ”¾åˆ°å®¹å™¨é‡Œè¿è¡Œ, ä¹‹åä¼šé‡ç‚¹æ¼”ç¤ºåœ¨è¿™ç§éƒ¨ç½²æ–¹å¼ä¸‹å¦‚ä½•é‡‡é›†ç›‘æ§æ•°æ®.")]),s._v(" "),t("p",[s._v("ä¸è¿‡å¾ˆå¤šå¤§ä¸€äº›çš„äº’è”ç½‘å…¬å¸ä¼šé€‰æ‹©ç›´æ¥ä½¿ç”¨"),t("strong",[s._v("äºŒè¿›åˆ¶")]),s._v("çš„æ–¹å¼æ¥éƒ¨ç½², å› ä¸ºäºŒè¿›åˆ¶çš„æ–¹å¼å¯¹äºç›‘æ§æ•°æ®é‡‡é›†æ¥è¯´å…¶å®æ›´ç®€å•, ç›´æ¥åœ¨é‡‡é›†å™¨é‡Œé…ç½®è¦æŠ“å–çš„è¿™å‡ ä¸ªç»„ä»¶çš„ç›®æ ‡åœ°å€å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("å¦‚æœæƒ³è¦è°ƒç”¨ Kubernetes æœåŠ¡ç«¯ APIServer, Controller-manager, Scheduler è¿™ä¸‰ä¸ªç»„ä»¶çš„ "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£, éœ€è¦æœ‰ Token åšé‰´æƒ, å› æ­¤è¿˜æ˜¯é€šè¿‡åˆ›å»º ServiceAccount çš„æ–¹å¼æ‹¿åˆ° Token, åé¢ä¹Ÿä¼šæŠŠé‡‡é›†å™¨ç›´æ¥éƒ¨ç½²åˆ° Kubernetes å®¹å™¨é‡Œ, è¿™æ · Token ä¿¡æ¯å°±å¯ä»¥è‡ªåŠ¨ mount åˆ°å®¹å™¨é‡Œ, æ¯”è¾ƒæ–¹ä¾¿.")]),s._v(" "),t("h5",{attrs:{id:"_1-åˆ›å»ºè®¤è¯ä¿¡æ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-åˆ›å»ºè®¤è¯ä¿¡æ¯"}},[s._v("#")]),s._v(" 1.åˆ›å»ºè®¤è¯ä¿¡æ¯")]),s._v(" "),t("p",[s._v("ç›¸æ¯”å‰é¢ä¸º Categraf å‡†å¤‡çš„ "),t("strong",[s._v("ServiceAccount")]),s._v(", ç”¨äºè®¿é—®æ§åˆ¶é¢ç»„ä»¶çš„ ServiceAccount ä¼šè¦æ±‚æ›´å¤šæƒé™, è¿™é‡Œé‡æ–°ç»™å‡ºä¸€ä¸ªå‡çº§åçš„ YAML æ–‡ä»¶ä¾›å‚è€ƒ.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes/metrics\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes/stats\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nodes/proxy\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" services\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" endpoints\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pods\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" extensions\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" networking.k8s.io\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ingresses\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nonResourceURLs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics/cadvisor"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flashcat\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRoleBinding\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flashcat\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("p",[s._v("ä½¿ç”¨ "),t("code",[s._v("kubectl apply")]),s._v("â€‹ ä¸€ä¸‹è¿™ä¸ªYAML æ–‡ä»¶å³å¯. æœ‰äº†è®¤è¯ä¿¡æ¯, åé¢å°±æ˜¯é€‰å‹å¹¶éƒ¨ç½²é‡‡é›†å™¨äº†.")]),s._v(" "),t("h5",{attrs:{id:"_2-éƒ¨ç½²é‡‡é›†å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-éƒ¨ç½²é‡‡é›†å™¨"}},[s._v("#")]),s._v(" 2.éƒ¨ç½²é‡‡é›†å™¨")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿè‡ªåŠ¨æ„ŸçŸ¥åˆ°ç»„ä»¶å®ä¾‹çš„å˜åŒ–, ä¹Ÿå°±æ˜¯è¦æŠ“å–çš„ç›®æ ‡åœ°å€çš„å˜åŒ–. æ¯«æ— ç–‘é—®è¦è¯»å– Kubernetes çš„å…ƒä¿¡æ¯, å°±éœ€è¦å…·å¤‡ç±»ä¼¼ Prometheus çš„ Kubernetes æœåŠ¡å‘ç°èƒ½åŠ›. "),t("strong",[s._v("æ”¯æŒè¿™ä¸ªæœåŠ¡å‘ç°èƒ½åŠ›çš„é‡‡é›†å™¨, æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ Telegraf, Prometheus, Categraf, Grafana-agent, vmagent ç­‰, è¿™é‡Œæœ€åŸæ±åŸå‘³çš„æ˜¾ç„¶æ˜¯ Prometheus è‡ªèº«")]),s._v(".")]),s._v(" "),t("p",[s._v("Prometheus ä» v2.32.0 å¼€å§‹æ”¯æŒ agent mode æ¨¡å¼, "),t("strong",[s._v("ç›¸å½“äºæŠŠ Prometheus å½“åšä¸€ä¸ªé‡‡é›† agent æ¥ä½¿ç”¨, åªè´Ÿè´£é‡‡é›†æ•°æ®")]),s._v(", è¿™é‡Œå°±ä½¿ç”¨è¿™ä¸ªæ–¹å¼æ¥é‡‡é›†æ•°æ®.")]),s._v(" "),t("p",[s._v("agent mode æ¨¡å¼çš„ Prometheus, é‡ç‚¹è¦é…ç½® scrape è§„åˆ™å’Œ remote write åœ°å€, è¿™é‡ŒæŠŠé…ç½®æ–‡ä»¶åšæˆ ConfigMap, å‚è€ƒçš„ YAML æ–‡ä»¶å¦‚ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("conf\n  labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("conf\n  namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flashcat\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  prometheus.yml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n    global"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      scrape_interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s\n      evaluation_interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s\n\n    scrape_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apiserver'")]),s._v("\n        kubernetes_sd_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" endpoints\n        scheme"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n        tls_config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          insecure_skip_verify"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n        authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          credentials_file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n        relabel_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_service_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_endpoint_port_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" keep\n          regex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default;kubernetes;https\n\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'controller-manager'")]),s._v("\n        kubernetes_sd_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" endpoints\n        scheme"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n        tls_config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          insecure_skip_verify"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n        authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          credentials_file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n        relabel_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_service_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_endpoint_port_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" keep\n          regex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system;kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("manager;https\n\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'scheduler'")]),s._v("\n        kubernetes_sd_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" endpoints\n        scheme"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n        tls_config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          insecure_skip_verify"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n        authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          credentials_file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n        relabel_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_service_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_endpoint_port_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" keep\n          regex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system;kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("scheduler;https\n\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'etcd'")]),s._v("\n        kubernetes_sd_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" endpoints\n        scheme"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n        relabel_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_service_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_endpoint_port_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" keep\n          regex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system;etcd;http\n\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kube-state-metrics'")]),s._v("\n        kubernetes_sd_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" endpoints\n        scheme"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n        relabel_configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_service_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_endpoint_port_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" keep\n          regex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system;kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics;http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics\n\n    remote_write"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.206.0.16:19000/prometheus/v1/write'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br")])]),t("p",[s._v("è¯´æ˜ä¸€ä¸‹, è¿™æ®µä»£ç ä¸­åŒ…å«äº† 5 ä¸ªæŠ“å– job, åˆ†åˆ«æ˜¯ "),t("strong",[s._v("APIServer, Controller-manager, Scheduler, ectd, KSM")]),s._v(". å‰é¢ 3 ä¸ªèµ°çš„æ˜¯ HTTPS , åé¢ä¸¤ä¸ªèµ°çš„æ˜¯ HTTP, é‡ç‚¹å…³æ³¨ relabel è§„åˆ™. keep çš„è§„åˆ™å®é™…å°±æ˜¯åœ¨åšè¿‡æ»¤, åªè¿‡æ»¤è‡ªå·± job æ„Ÿå…´è¶£çš„é‚£äº› endpoint. æœ€åä¸¤è¡Œé…ç½®äº† remote write åœ°å€, é‡‡é›†åˆ°çš„æ•°æ®é€šè¿‡ remote write åè®®æ¨ç»™è¿œç«¯, è¿™é‡Œæ˜¯æ¨ç»™äº† n9e-server, n9e-server åé¢æ˜¯ VictoriaMetrics é›†ç¾¤.")]),s._v(" "),t("p",[s._v("å‡†å¤‡å¥½é…ç½®æ–‡ä»¶ä¹‹å, æ¥ä¸‹æ¥éƒ¨ç½² Prometheus. å› ä¸ºåªæ˜¯æŠ“å–å‡ ä¸ªæœåŠ¡ç«¯ç»„ä»¶, æŠ“å–é‡ä¸å¤§, ä¸ç”¨åšåˆ†ç‰‡, è¿™é‡ŒæŠŠ Prometheus agent mode åšæˆå•å‰¯æœ¬çš„ Deployment, å¯ä»¥çœ‹ä¸€ä¸‹ YAML æ–‡ä»¶.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent\n  namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flashcat\n  labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  replicas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  selector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    matchLabels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent\n  template"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    metadata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent\n    spec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      serviceAccountName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" categraf\n      containers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus\n          image"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prom/prometheus\n          args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--config.file=/etc/prometheus/prometheus.yml"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--web.enable-lifecycle"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--enable-feature=agent"')]),s._v("\n          ports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v("\n          resources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            requests"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              cpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 500m\n              memory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 500M\n            limits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              cpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n              memory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1Gi\n          volumeMounts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n              mountPath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/prometheus/\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n              mountPath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /prometheus/\n      volumes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n          configMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            defaultMode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("420")]),s._v("\n            name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("conf\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n          emptyDir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("p",[s._v("è¿™é‡Œè¦æ³¨æ„çš„å…³é”®ç‚¹, ä¸€ä¸ªæ˜¯ serviceAccountName, é…ç½®æ˜¯ categraf, å’Œå‰é¢åˆ›å»ºçš„ ServiceAccount å¯¹åº”, å¦ä¸€ä¸ªæ˜¯ args éƒ¨åˆ†, ç»™å‡ºäº†ç›¸å…³çš„å¯åŠ¨å‚æ•°, "),t("code",[s._v("--enable-feature=agent")]),s._v("â€‹ å°±æ˜¯ä½œä¸º agent mode æ¨¡å¼è¿è¡Œ.")]),s._v(" "),t("p",[s._v("æœ€åæ‰§è¡Œ "),t("code",[s._v("kubectl apply -f prometheus-agent-deployment.yaml")]),s._v("â€‹, è®© Kubernetes æŠŠ Deployment æ‹‰èµ·æ¥å°±å¯ä»¥äº†. ç¨ç­‰ç‰‡åˆ», å»é¡µé¢ä¸ŠæŸ¥è¯¢ä¸€ä¸‹ APIServer çš„ç›‘æ§æ•°æ®, ç†è®ºä¸Šæ˜¯å¯ä»¥æŸ¥åˆ°çš„, ä½†æ˜¯å…¶ä»–ç»„ä»¶çš„ç›‘æ§æ•°æ®, å¤§æ¦‚ç‡æ˜¯æ²¡æœ‰çš„, ä¸‹é¢æ¥ä¸€ä¸€ä¿®å¤.")]),s._v(" "),t("h5",{attrs:{id:"_3-ä¿®å¤controller-managerå’Œscheduler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¿®å¤controller-managerå’Œscheduler"}},[s._v("#")]),s._v(" 3.ä¿®å¤Controller-managerå’ŒScheduler")]),s._v(" "),t("p",[s._v("ä¸Šé¢çš„æŠ“å–è§„åˆ™èµ°çš„éƒ½æ˜¯ Kubernetes æœåŠ¡å‘ç°æœºåˆ¶, å‘ç° endpoint, ç„¶åè¿‡æ»¤. å…ˆé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ kube-system è¿™ä¸ª namespace ä¸‹æœ‰å“ªäº› endpoint.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("kubectl get endpoints "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("n kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å¦‚æœæœ‰ kube-controller-manager, kube-scheduler è¿™ä¸¤ä¸ª endpoint, ç†è®ºä¸Šé€šè¿‡ä¸Šé¢çš„æŠ“å–è§„åˆ™å°±å¯ä»¥æŠ“åˆ°æ•°æ®, å¦‚æœæ²¡æœ‰çš„è¯, å¯ä»¥åˆ›å»ºç›¸å…³çš„ service.")]),s._v(" "),t("p",[s._v("å¯ä»¥å‚è€ƒæˆ‘ç»™å‡ºçš„è¿™ä¸¤ä¸ª YAML æ–‡ä»¶æ¥åˆ›å»º service.")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/k8s/controller-service.yaml",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/flashcatcloud/categraf/blob/main/k8s/controller-service.yaml"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/k8s/scheduler-service.yaml",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/flashcatcloud/categraf/blob/main/k8s/scheduler-service.yaml"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("å¦å¤–å°±æ˜¯å¾—ç¡®ä¿ Controller-manager å’Œ Scheduler æ²¡æœ‰ç›‘å¬åœ¨ 127.0.0.1, å¦åˆ™é‡‡é›†å™¨è½åœ¨å…¶ä»–æœºå™¨ä¸Šå°±è®¿é—®ä¸é€šäº†. å…·ä½“æ€ä¹ˆåšå‘¢?")]),s._v(" "),t("p",[s._v("åœ¨è¿™ä¸¤ä¸ªç»„ä»¶çš„å¯åŠ¨å‚æ•°é‡ŒåŠ ä¸Š "),t("code",[s._v("--bind-address=0.0.0.0")]),s._v("â€‹ å°±å¯ä»¥äº†. å¦‚æœæ˜¯ Kubeadm å®‰è£…çš„, å¯ä»¥åœ¨ /etc/kubernetes/manifests/kube-controller-manager.yaml å’Œ /etc/kubernetes/manifests/kube-scheduler.yaml é‡Œè°ƒæ•´å‚æ•°. è°ƒæ•´å®Œä¹‹å, ç†è®ºä¸Šå°±å¯ä»¥æŠ“åˆ°æ•°æ®äº†.")]),s._v(" "),t("h5",{attrs:{id:"_4-ä¿®å¤etcd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-ä¿®å¤etcd"}},[s._v("#")]),s._v(" 4.ä¿®å¤etcd")]),s._v(" "),t("p",[s._v("etcd é»˜è®¤ç«¯å£æ˜¯ 2379, å¦‚æœä»è¿™ä¸ªç«¯å£è·å–ç›‘æ§æ•°æ®, å°±éœ€è¦æœ‰æ¯”è¾ƒå¤æ‚çš„è®¤è¯é‰´æƒ. ä½†å…¶å® etcd çš„ç›‘æ§æ•°æ®ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤ªå…³é”®çš„ä¿¡æ¯, è€Œä¸”æ˜¯å†…ç½‘, ç›´æ¥å¼€æ”¾å°±å¯ä»¥äº†. etcd æä¾›äº†ä¸€ä¸ªå¯åŠ¨å‚æ•°, å¯ä»¥ä¸ºæš´éœ²ç›‘æ§æŒ‡æ ‡å•ç‹¬ç›‘å¬ä¸€ä¸ªåœ°å€.")]),s._v(" "),t("p",[s._v("å…·ä½“å‚æ•°æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("listen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("urls=http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//0.0.0.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2381")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä¹‹ååˆ›å»ºç›¸å…³çš„ "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/k8s/etcd-service-http.yaml",target:"_blank",rel:"noopener noreferrer"}},[s._v("service"),t("OutboundLink")],1),s._v(", prometheus agent å°±å¯ä»¥å‘ç°è¿™ä¸ª HTTP çš„ endpoint äº†.")]),s._v(" "),t("h5",{attrs:{id:"_5-ä¿®å¤ksm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-ä¿®å¤ksm"}},[s._v("#")]),s._v(" 5.ä¿®å¤KSM")]),s._v(" "),t("p",[s._v("KSM æ˜¯ç›‘æ§å„ç±» Kubernetes å¯¹è±¡çš„ç»„ä»¶, é€šè¿‡ KSM å¯ä»¥çŸ¥é“ Service, Deployment, Statefulset, Node ç­‰ç»„ä»¶çš„å„ç±»å…ƒä¿¡æ¯, æ¯”å¦‚æŸä¸ª Deployment æœŸæœ›æœ‰å‡ ä¸ªå‰¯æœ¬, å®é™…æœ‰å‡ ä¸ª Pod åœ¨è¿è¡Œè¿™ç§é—®é¢˜, å°±æ˜¯é  KSM æ¥å›ç­”çš„. KSM æ˜¯å¦‚ä½•çŸ¥é“è¿™äº›ä¿¡æ¯çš„å‘¢? å®ƒéœ€è¦è·Ÿ APIServer é€šä¿¡, è®¢é˜…å„ç±»èµ„æºå¯¹è±¡çš„å˜æ›´. ä¸‹é¢å®‰è£…ä¸€ä¸‹ KSM, ç›¸å…³æŒ‡æ ‡å°±æœ‰äº†.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("git clone https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//github.com/kubernetes/kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics\nkubectl apply "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics/examples/standard/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("KSM åœ¨ä»£ç ä»“åº“é‡Œæä¾›äº†ç›¸å…³çš„ YAML æ–‡ä»¶, å¯ä»¥ clone ä¸‹æ¥ç›´æ¥ apply å°±å¯ä»¥. KSM é»˜è®¤æš´éœ²äº†ä¸¤ä¸ªç«¯å£, 8080 ç”¨äºè¿”å›å„ç±» Kubernetes å¯¹è±¡ä¿¡æ¯, 8081 ç”¨äºè¿”å› KSM è‡ªèº«çš„æŒ‡æ ‡, åœ¨æŠ“å–è§„åˆ™é‡Œé‡ç‚¹æŠ“å–çš„æ˜¯ 8080 çš„æ•°æ®.")]),s._v(" "),t("p",[s._v("KSM è¦è¿”å›æ‰€æœ‰ Kubernetes å¯¹è±¡çš„æŒ‡æ ‡, æ•°æ®é‡æ¯”è¾ƒå¤§, ä» 8080 æ‹‰å–ç›‘æ§æ•°æ®å¯èƒ½ä¼šæ‹‰å–åå‡ ç§’ç”šè‡³å‡ åç§’, KSM ä¸ºæ­¤æ”¯æŒäº†åˆ†ç‰‡é€»è¾‘, examples/standard ä¸‹é¢æä¾›çš„ YAML æ–‡ä»¶æ˜¯æŠŠ KSM éƒ¨ç½²ä¸ºå•å‰¯æœ¬çš„ Deployment, åˆ†ç‰‡çš„è¯ä½¿ç”¨ Daemonset, æ¯ä¸ª Node ä¸Šéƒ½è·‘ä¸€ä¸ª KSM, è¿™ä¸ª KSM åªåŒæ­¥ä¸è‡ªèº«èŠ‚ç‚¹ç›¸å…³çš„æ•°æ®, KSM çš„å®˜æ–¹ README é‡Œè¯´å¾—å¾ˆæ¸…æ¥šäº†, å¯ä»¥çœ‹ä¸€ä¸‹Daemonset æ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DaemonSet\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry.k8s.io/kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics/kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("IMAGE_TAG\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("resource=pods\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node=$(NODE_NAME)\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NODE_NAME\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fieldPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" spec.nodeName\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("å¦å¤–, KSM æä¾›äº†ä¸¤ç§æ–¹å¼æ¥è¿‡æ»¤è¦ watch çš„å¯¹è±¡ç±»å‹, ä¸€ä¸ªæ˜¯é€šè¿‡ç™½åå•çš„æ–¹å¼æŒ‡å®šå…·ä½“è¦ watch å“ªç±»å¯¹è±¡, é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨å‚æ•°ä¸­çš„ "),t("code",[s._v("--resources=daemonsets,deployments")]),s._v("â€‹, è¡¨ç¤ºåª watch daemonsets å’Œ deployments. è™½ç„¶å·²ç»é™åˆ¶äº†å¯¹è±¡èµ„æºç±»å‹, ä½†å¦‚æœé‡‡é›†çš„æŸäº›æŒ‡æ ‡ä»ç„¶ä¸æƒ³è¦, å¯ä»¥é‡‡ç”¨é»‘åå•çš„æ–¹å¼æ¥è¿‡æ»¤æŒ‡æ ‡:  "),t("code",[s._v("--metric-denylist=kube_deployment_spec_.*")]),s._v("â€‹. è¿™ä¸ªè¿‡æ»¤è§„åˆ™æ”¯æŒæ­£åˆ™å†™æ³•, å¤šä¸ªæ­£åˆ™ä¹‹é—´å¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”.")]),s._v(" "),t("p",[s._v("åšå®Œè¿™äº›æ“ä½œä¹‹å, å°±å¯ä»¥é‡‡é›†åˆ°è¿™äº›ç»„ä»¶çš„ç›‘æ§æ•°æ®äº†, ä¸‹é¢ç»§ç»­çœ‹å“ªäº›æŒ‡æ ‡æ›´ä¸ºå…³é”®.")]),s._v(" "),t("h4",{attrs:{id:"å…³é”®æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…³é”®æŒ‡æ ‡"}},[s._v("#")]),s._v(" å…³é”®æŒ‡æ ‡")]),s._v(" "),t("p",[s._v("Categraf çš„ä»£ç ä»“åº“é‡Œå·²ç»å†…ç½®äº† Kubernetes å„ä¸ªç»„ä»¶çš„ç›‘æ§å¤§ç›˜, åªè¦æ˜¯å‡ºç°åœ¨ç›‘æ§å¤§ç›˜ä¸Šçš„æŒ‡æ ‡, ç†è®ºä¸Šå°±æ˜¯ç›¸å¯¹æ¯”è¾ƒé‡è¦çš„, è¦ä¸ç„¶ä¹Ÿæ²¡æœ‰å¿…è¦æ”¾åˆ°å¤§ç›˜ä¸Šäº†. å¯ä»¥çœ‹ä¸€ä¸‹ "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/k8s/apiserver-dash.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("APIServer"),t("OutboundLink")],1),s._v(", "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/k8s/cm-dash.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("Controller-manager"),t("OutboundLink")],1),s._v(", "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/k8s/scheduler-dash.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("Scheduler"),t("OutboundLink")],1),s._v(", "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/blob/main/k8s/etcd-dash.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("etcd"),t("OutboundLink")],1),s._v(", "),t("a",{attrs:{href:"https://github.com/flashcatcloud/categraf/tree/main/inputs/kube_state_metrics",target:"_blank",rel:"noopener noreferrer"}},[s._v("KSM"),t("OutboundLink")],1),s._v(" çš„å¤§ç›˜.")]),s._v(" "),t("p",[s._v("å¦‚æœä½¿ç”¨ Grafana æ¥åšå¯è§†åŒ–, å¯ä»¥å‚è€ƒä¸‹é¢ä¸¤ä¸ªé¡¹ç›®ä¸­æä¾›çš„ Dashboard.")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/kubernetes-monitoring/kubernetes-mixin",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/kubernetes-monitoring/kubernetes-mixin"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/dotdc/grafana-dashboards-kubernetes",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/dotdc/grafana-dashboards-kubernetes"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("å› ä¸ºæ‰€æœ‰ç»„ä»¶éƒ½æ˜¯ Go å®ç°çš„, éƒ½æš´éœ²äº† Go ç¨‹åºé€šç”¨çš„é‚£äº› CPU, å†…å­˜, Goroutine, å¥æŸ„ç­‰æŒ‡æ ‡, è¿™ä¸€éƒ¨åˆ†å†…å®¹åœ¨ä¸Šä¸€è®²å·²ç»ä»‹ç»è¿‡, è¿™é‡Œä¸å†èµ˜è¿°. ä¸‹é¢åˆ†åˆ«çœ‹ä¸€ä¸‹è¿™å‡ ä¸ªç»„ä»¶ä¸€äº›å…¶ä»–ç±»å‹çš„å…³é”®æŒ‡æ ‡.")]),s._v(" "),t("h5",{attrs:{id:"_1-apiserver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-apiserver"}},[s._v("#")]),s._v(" 1.APIServer")]),s._v(" "),t("p",[s._v("**APIServer çš„æ ¸å¿ƒèŒèƒ½æ˜¯ Kubernetes é›†ç¾¤çš„ API æ€»å…¥å£, Kube-Proxy, Kubelet, Controller-Manager, Scheduler ç­‰éƒ½éœ€è¦è°ƒç”¨ APIServer, æ‰€ä»¥ APIServer çš„ç›‘æ§, å®Œå…¨æŒ‰ç…§ RED æ–¹æ³•è®ºæ¥æ¢³ç†å³å¯, æœ€æ ¸å¿ƒçš„å°±æ˜¯è¯·æ±‚ååå’Œå»¶è¿Ÿ. **")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("apiserver_request_total")]),s._v(": è¯·æ±‚é‡çš„æŒ‡æ ‡, å¯ä»¥ç»Ÿè®¡æ¯ç§’è¯·æ±‚æ•°, æˆåŠŸç‡.")]),s._v(" "),t("li",[t("strong",[s._v("apiserver_request_duration_seconds")]),s._v(": è¯·æ±‚è€—æ—¶çš„æŒ‡æ ‡.")]),s._v(" "),t("li",[t("strong",[s._v("apiserver_current_inflight_requests")]),s._v(": APIServer å½“å‰å¤„ç†çš„è¯·æ±‚æ•°, åˆ†ä¸º mutating(é get, list, watchçš„è¯·æ±‚)å’Œ readOnly(get, list, watchè¯·æ±‚)ä¸¤ç§, è¯·æ±‚é‡è¿‡å¤§å°±ä¼šè¢«é™æµ, æ‰€ä»¥è¿™ä¸ªæŒ‡æ ‡å¯¹è§‚å¯Ÿå®¹é‡æ°´ä½å¾ˆæœ‰å¸®åŠ©.")])]),s._v(" "),t("h5",{attrs:{id:"_2-controller-manager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-controller-manager"}},[s._v("#")]),s._v(" 2.Controller-manager")]),s._v(" "),t("p",[s._v("Controller-manager è´Ÿè´£ç›‘å¬å¯¹è±¡çŠ¶æ€, å¹¶ä¸æœŸæœ›çŠ¶æ€åšå¯¹æ¯”. å¦‚æœçŠ¶æ€ä¸ä¸€è‡´åˆ™è¿›è¡Œè°ƒè°, é‡ç‚¹å…³æ³¨çš„æ˜¯"),t("strong",[s._v("ä»»åŠ¡æ•°é‡, é˜Ÿåˆ—æ·±åº¦")]),s._v(" ç­‰.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("workqueue_adds_total")]),s._v(": å„ä¸ª controller æ¥æ”¶åˆ°çš„ä»»åŠ¡æ€»æ•°.")]),s._v(" "),t("li",[t("strong",[s._v("workqueue_depth")]),s._v(": å„ä¸ª controller çš„é˜Ÿåˆ—æ·±åº¦, è¡¨ç¤ºå„ä¸ª controller ä¸­çš„ä»»åŠ¡çš„æ•°é‡, æ•°é‡è¶Šå¤§è¡¨ç¤ºè¶Šç¹å¿™.")]),s._v(" "),t("li",[t("strong",[s._v("workqueue_queue_duration_seconds")]),s._v(": ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­çš„ç­‰å¾…è€—æ—¶, æŒ‰ç…§æ§åˆ¶å™¨åˆ†åˆ«ç»Ÿè®¡.")]),s._v(" "),t("li",[t("strong",[s._v("workqueue_work_duration_seconds")]),s._v(": ä»»åŠ¡å‡ºé˜Ÿåˆ°è¢«å¤„ç†å®Œæˆçš„æ—¶é—´, æŒ‰ç…§æ§åˆ¶å™¨åˆ†åˆ«ç»Ÿè®¡.")]),s._v(" "),t("li",[t("strong",[s._v("workqueue_retries_total")]),s._v(": ä»»åŠ¡è¿›å…¥é˜Ÿåˆ—çš„é‡è¯•æ¬¡æ•°.")])]),s._v(" "),t("h5",{attrs:{id:"_3-scheduler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-scheduler"}},[s._v("#")]),s._v(" 3.Scheduler")]),s._v(" "),t("p",[s._v("Scheduler åœ¨ Kubernetes æ¶æ„ä¸­è´Ÿè´£æŠŠå¯¹è±¡è°ƒåº¦åˆ°åˆé€‚çš„ Node ä¸Š, åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šæœ‰ä¸€ç³»åˆ—çš„è§„åˆ™è®¡ç®—å’Œç­›é€‰, é‡ç‚¹å…³æ³¨ "),t("strong",[s._v("è°ƒåº¦")]),s._v(" è¿™ä¸ªåŠ¨ä½œçš„ç›¸å…³æŒ‡æ ‡.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("leader_election_master_status")]),s._v(": è°ƒåº¦å™¨çš„é€‰ä¸»çŠ¶æ€, 1 è¡¨ç¤º master, 0 è¡¨ç¤º backup.")]),s._v(" "),t("li",[t("strong",[s._v("scheduler_queue_incoming_pods_total")]),s._v(": è¿›å…¥è°ƒåº¦é˜Ÿåˆ—çš„ Pod æ•°é‡.")]),s._v(" "),t("li",[t("strong",[s._v("scheduler_pending_pods")]),s._v(": Pending çš„ Pod æ•°é‡.")]),s._v(" "),t("li",[t("strong",[s._v("scheduler_pod_scheduling_attempts")]),s._v(": Pod è°ƒåº¦æˆåŠŸå‰, è°ƒåº¦é‡è¯•çš„æ¬¡æ•°åˆ†å¸ƒ.")]),s._v(" "),t("li",[t("strong",[s._v("scheduler_framework_extension_point_duration_seconds")]),s._v(": è°ƒåº¦æ¡†æ¶çš„æ‰©å±•ç‚¹å»¶è¿Ÿåˆ†å¸ƒ, æŒ‰ extension_point ç»Ÿè®¡.")]),s._v(" "),t("li",[t("strong",[s._v("scheduler_schedule_attempts_total")]),s._v(': æŒ‰ç…§è°ƒåº¦ç»“æœç»Ÿè®¡çš„å°è¯•æ¬¡æ•°, "unschedulable" è¡¨ç¤ºæ— æ³•è°ƒåº¦, "error" è¡¨ç¤ºè°ƒåº¦å™¨å†…éƒ¨é”™è¯¯.')])]),s._v(" "),t("h5",{attrs:{id:"_4-etcd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-etcd"}},[s._v("#")]),s._v(" 4.etcd")]),s._v(" "),t("p",[s._v("etcdåœ¨ Kubernetes çš„æ¶æ„ä¸­ä½œç”¨å·¨å¤§, ç›¸å¯¹ä¹Ÿæ¯”è¾ƒç¨³å®š, ä¸è¿‡ etcd å¯¹ç¡¬ç›˜ IO è¦æ±‚è¾ƒé«˜, å› æ­¤éœ€è¦ç€é‡å…³æ³¨ IO ç›¸å…³çš„æŒ‡æ ‡, ç”Ÿäº§ç¯å¢ƒå»ºè®®è‡³å°‘ä½¿ç”¨ SSD çš„ç›˜åšå­˜å‚¨.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("etcd_server_has_leader")]),s._v(": etcd æ˜¯å¦æœ‰ leader.")]),s._v(" "),t("li",[t("strong",[s._v("etcd_server_leader_changes_seen_total")]),s._v(": å¶å°”åˆ‡ä¸»é—®é¢˜ä¸å¤§, é¢‘ç¹åˆ‡ä¸»å°±è¦å…³æ³¨äº†.")]),s._v(" "),t("li",[t("strong",[s._v("etcd_server_proposals_failed_total")]),s._v(": ææ¡ˆå¤±è´¥æ¬¡æ•°.")]),s._v(" "),t("li",[t("strong",[s._v("etcd_disk_backend_commit_duration_seconds")]),s._v(": æäº¤èŠ±è´¹çš„è€—æ—¶.")]),s._v(" "),t("li",[t("strong",[s._v("etcd_disk_wal_fsync_duration_seconds")]),s._v(": wal æ—¥å¿—åŒæ­¥è€—æ—¶.")])]),s._v(" "),t("h5",{attrs:{id:"_5-ksm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-ksm"}},[s._v("#")]),s._v(" 5.KSM")]),s._v(" "),t("p",[s._v("Kube-state-metrics è¿™ä¸ªç»„ä»¶, é‡‡é›†çš„å¾ˆå¤šæŒ‡æ ‡éƒ½åªæ˜¯å……å½“å…ƒä¿¡æ¯, å•ç‹¬æ‹¿å‡ºæ¥æœªå¿…é‚£ä¹ˆæœ‰ç”¨, ä½†æ˜¯å’Œå…¶ä»–æŒ‡æ ‡åš group_left, group_right è¿æ¥çš„æ—¶å€™å¯èƒ½åˆä¼šå¾ˆæœ‰ç”¨. ä¸‹é¢æŒ‘é€‰ä¸€äº›ç›¸å¯¹å¸¸ç”¨çš„æŒ‡æ ‡è§£é‡Šä¸€ä¸‹.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("kube_node_status_condition")]),s._v(": Node èŠ‚ç‚¹çŠ¶æ€, çŠ¶æ€ä¸æ­£å¸¸, æœ‰ç£ç›˜å‹åŠ›ç­‰éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæŒ‡æ ‡å‘ç°.")]),s._v(" "),t("li",[t("strong",[s._v("kube_pod_container_status_last_terminated_reason")]),s._v(": å®¹å™¨åœæ­¢åŸå› .")]),s._v(" "),t("li",[t("strong",[s._v("kube_pod_container_status_waiting_reason")]),s._v(": å®¹å™¨å¤„äº waiting çŠ¶æ€çš„åŸå› .")]),s._v(" "),t("li",[t("strong",[s._v("kube_pod_container_status_restarts_total")]),s._v(": å®¹å™¨é‡å¯æ¬¡æ•°.")]),s._v(" "),t("li",[t("strong",[s._v("kube_deployment_spec_replicas")]),s._v(": deploymenté…ç½®æœŸæœ›çš„å‰¯æœ¬æ•°.")]),s._v(" "),t("li",[t("strong",[s._v("kube_deployment_status_replicas_available")]),s._v(": deployment å®é™…å¯ç”¨çš„å‰¯æœ¬æ•°.")])]),s._v(" "),t("p",[s._v("åŸºäº KSM æ•°æ®çš„æ¯”è¾ƒå…¸å‹çš„å‘Šè­¦è§„åˆ™, ä¹Ÿä¸¾ä¸ªä¾‹å­.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é•¿æ—¶é—´ç‰ˆæœ¬ä¸ä¸€è‡´éœ€è¦å‘Šè­¦")]),s._v("\nkube_deployment_status_observed_generation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('job="kube'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('metrics"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!=")]),s._v("\nkube_deployment_metadata_generation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('job="kube'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('metrics"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# deployment å‰¯æœ¬æ•°ä¸ä¸€è‡´")]),s._v("\n(\nkube_deployment_spec_replicas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('job="kube'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('metrics"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!=")]),s._v("\nkube_deployment_status_replicas_available"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('job="kube'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('metrics"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n)\nand\n(\nchanges(kube_deployment_status_replicas_updated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('job="kube'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('metrics"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(") == 0\n)\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®¹å™¨æœ‰ Error æˆ–è€… OOM å¯¼è‡´çš„é€€å‡º")]),s._v("\n(sum(kube_pod_container_status_last_terminated_reason"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('reason=~"Error'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v('OOMKilled"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(") by (namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("container) "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" 0)\n* on(namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("container)\nsum(increase(kube_pod_container_status_restarts_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(") "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" 0) by(namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("container)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("ä¸Šé¢åªæ˜¯ä¸¾äº† Deployment çš„ä¾‹å­, Statefulset ä¹Ÿæ˜¯ç±»ä¼¼çš„.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-17"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-17"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("Kubernetes ä½“ç³»ç¡®å®éå¸¸åºå¤§, è¿™ä¸€è®²é‡ç‚¹ä»‹ç»æ§åˆ¶é¢çš„ç»„ä»¶ç›‘æ§, åŒ…æ‹¬ APIServer, Controller-manager, Scheduler, etcdç­‰. å½“ç„¶, Kubernetes å¯¹è±¡çš„ç›‘æ§ä¹Ÿå¾ˆå…³é”®, å¯ä»¥ä½¿ç”¨ KSM å®Œæˆ.")]),s._v(" "),t("p",[t("strong",[s._v("æ ¸å¿ƒå†…å®¹ä¸»è¦æ˜¯ä¸¤éƒ¨åˆ†, ä¸€ä¸ªæ˜¯æ•°æ®é‡‡é›†, ä¸€ä¸ªæ˜¯å…³é”®æŒ‡æ ‡")]),s._v(". æ•°æ®é‡‡é›†å¼•å…¥äº† prometheus agent mode, æ”¯æŒ Kubernetes æœåŠ¡å‘ç°, éå¸¸è½»é‡, é€šè¿‡ remote write åè®®æŠŠæ•°æ®æ¨ç»™åç«¯å­˜å‚¨. å…³é”®æŒ‡æ ‡çš„è¯éœ€è¦çœ‹å„ä¸ªæ¨¡å—çš„æ ¸å¿ƒèŒèƒ½ä»¥åŠé‡ç‚¹ä¾èµ–, æ¯”å¦‚ Scheduler æ˜¯åšè°ƒåº¦çš„, é‚£å°±è¦çœ‹è°ƒåº¦ç›¸å…³çš„æŒ‡æ ‡, etcd å¼ºä¾èµ–ç¡¬ç›˜, å°±è¦å¤šå…³æ³¨ç¡¬ç›˜ IO ç›¸å…³çš„æŒ‡æ ‡.")]),s._v(" "),t("p",[s._v("Kubernetes æ§åˆ¶é¢çš„ç»„ä»¶å…¨éƒ¨éƒ½è¦"),t("strong",[s._v("è®¤è¯é‰´æƒ")]),s._v(", ç›¸æ¯”ä¹‹å‰æ¼”ç¤ºçš„ Kubelet æ•°æ®é‡‡é›†, éœ€è¦ç»™æ›´å¤šçš„æƒé™. Controller-manager, Scheduler å¯èƒ½é»˜è®¤æ²¡æœ‰åˆ›å»º Service, éœ€è¦æ‰‹å·¥åˆ›å»ºå¹¶ä¸”ä¿®æ”¹ç›‘å¬åœ°å€, etcd è¦å¼€å¯ HTTP åè®®çš„æŒ‡æ ‡æš´éœ²ç«¯å£, è¿™äº›éƒ½æ˜¯å‘, éœ€è¦ä¾æ¬¡ä¿®å¤.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/c183a43526b4bea24c42d6fec3774ccd-20230719203435-mb8h5ht.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_19-åº”ç”¨ç›‘æ§-å¦‚ä½•ä½¿ç”¨åŸ‹ç‚¹æ–¹å¼å¯¹åº”ç”¨ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_19-åº”ç”¨ç›‘æ§-å¦‚ä½•ä½¿ç”¨åŸ‹ç‚¹æ–¹å¼å¯¹åº”ç”¨ç›‘æ§"}},[s._v("#")]),s._v(" 19.åº”ç”¨ç›‘æ§-å¦‚ä½•ä½¿ç”¨åŸ‹ç‚¹æ–¹å¼å¯¹åº”ç”¨ç›‘æ§?")]),s._v(" "),t("p",[s._v("å‰é¢å‡ è®²ä¸»è¦æ˜¯ä»‹ç»äº†å¸¸è§çš„ä¸­é—´ä»¶, æ•°æ®åº“çš„ç›‘æ§, ç»Ÿç§°ä¸ºç»„ä»¶ç›‘æ§, æ ¹æ®å‰é¢å¯¹ç›‘æ§åšçš„åˆ†ç±», è¿˜æœ‰"),t("strong",[s._v("åº”ç”¨å’Œä¸šåŠ¡å±‚é¢")]),s._v("çš„ç›‘æ§æ²¡æœ‰ä»‹ç», æ¥ä¸‹æ¥ä¼šç”¨ä¸¤è®²æ¥ä»‹ç»è¿™éƒ¨åˆ†å†…å®¹.")]),s._v(" "),t("blockquote",[t("p",[s._v("ğŸ’¡å› ä¸ºä¸šåŠ¡æŒ‡æ ‡çš„ç”Ÿæˆä¹Ÿéœ€è¦åº”ç”¨ç¨‹åºä¾§æ¥å®ç°, æ‰€ä»¥è¿™ä¸¤ä¸ªå±‚é¢çš„ç›‘æ§å¯ä»¥ç»Ÿç§°ä¸ºåº”ç”¨ç›‘æ§.")])]),s._v(" "),t("p",[s._v("åœ¨æŒ‡æ ‡ç›‘æ§çš„ä¸–ç•Œé‡Œ, "),t("mark",[t("strong",[s._v("åº”ç”¨å’Œä¸šåŠ¡å±‚é¢çš„ç›‘æ§æœ‰ä¸¤ç§å…¸å‹æ‰‹æ®µ, ä¸€ç§æ˜¯åœ¨åº”ç”¨ç¨‹åºé‡ŒåŸ‹ç‚¹, å¦ä¸€ç§æ˜¯åˆ†ææ—¥å¿—, ä»æ—¥å¿—ä¸­æå–æŒ‡æ ‡")])]),s._v(". åŸ‹ç‚¹çš„æ–¹å¼æ€§èƒ½æ›´å¥½, ä¹Ÿæ›´çµæ´», åªæ˜¯å¯¹åº”ç”¨ç¨‹åºæœ‰ä¸€å®šä¾µå…¥æ€§, è€Œåˆ†ææ—¥å¿—çš„è¯å¯¹åº”ç”¨ç¨‹åºä¾µå…¥æ€§è¾ƒå°, ä½†ç”±äºé“¾è·¯è¾ƒé•¿, éœ€è¦åšæ–‡æœ¬åˆ†æå¤„ç†, æ€§èƒ½è¾ƒå·®, éœ€è¦æ›´å¤šç®—åŠ›æ”¯æŒ. è¿™ä¸€è®²å…ˆæ¥ä»‹ç»ç¬¬ä¸€ç§æ–¹å¼, ä½¿ç”¨åŸ‹ç‚¹çš„æ–¹å¼åšåº”ç”¨å’Œä¸šåŠ¡ç›‘æ§.")]),s._v(" "),t("h4",{attrs:{id:"åŸ‹ç‚¹æ–¹å¼ä»‹ç»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸ‹ç‚¹æ–¹å¼ä»‹ç»"}},[s._v("#")]),s._v(" åŸ‹ç‚¹æ–¹å¼ä»‹ç»")]),s._v(" "),t("p",[s._v("æ‰€è°“çš„åŸ‹ç‚¹, å°±æ˜¯æŒ‡åº”ç”¨ç¨‹åº"),t("strong",[s._v("å†…åµŒäº†åŸ‹ç‚¹çš„ SDK")]),s._v("(ä¸€ä¸ª lib åº“), ç„¶ååœ¨ä¸€äº›å…³é”®ä»£ç æµç¨‹é‡Œè°ƒç”¨ SDK æä¾›çš„æ–¹æ³•, è®°å½•ä¸‹å„ç§å…³é”®æŒ‡æ ‡. æ¯”å¦‚æŸä¸ª HTTP æœåŠ¡, æä¾›äº† 10 ä¸ªæ¥å£, æ¯ä¸ªæ¥å£çš„å¤„ç†èŠ±è´¹äº†å¤šå°‘æ¯«ç§’, å°±å¯ä»¥ä½œä¸ºæŒ‡æ ‡è®°å½•ä¸‹æ¥.")]),s._v(" "),t("p",[s._v("ä½ å¯èƒ½ä¼šç–‘æƒ‘, å¦‚æœç›‘æ§ç³»ç»Ÿå·²ç»æä¾›äº† PUSH æ¥å£äº†, æ¯”å¦‚ Prometheus çš„ Pushgateway ç»„ä»¶, åœ¨åº”ç”¨ç¨‹åºé‡Œç›´æ¥è°ƒç”¨ Pushgateway æ¥å£æ¨æ•°æ®ä¸å°±è¡Œäº†å—? ä¸ºä»€ä¹ˆè¿˜éœ€è¦ SDK å‘¢?")]),s._v(" "),t("p",[t("strong",[s._v("æ ¸å¿ƒåŸå› æ˜¯ SDK å¯ä»¥å°è£…ä¸€äº›é€šç”¨çš„è®¡ç®—é€»è¾‘")]),s._v(". æ¯”å¦‚æœ‰ä¸ªæŒ‡æ ‡æ˜¯ Summary ç±»å‹, å¯ä»¥æä¾›æŸä¸ªæ¥å£ 99 åˆ†ä½çš„å»¶è¿Ÿæ•°æ®. å¦‚æœæ²¡æœ‰ SDK, éœ€è¦æ€ä¹ˆåšå‘¢? æ¯å½“è¿™ä¸ªæ¥å£å“åº”ä¸€æ¬¡è¯·æ±‚, å°±è®°å½•ä¸€ä¸ªå»¶è¿Ÿæ—¶é—´, ç„¶åå­˜å…¥ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„, ç­‰åˆ°ä¸€ä¸ªæ—¶é—´é—´éš”, æ¯”å¦‚ 10 ç§’é’Ÿ, å°±æŠŠè¿™æ®µæ—¶é—´å†…æ‰€æœ‰çš„å»¶è¿Ÿæ•°æ®æ’ä¸ªåº, ç„¶åå– 99 åˆ†ä½çš„å€¼, æœ€åè°ƒç”¨ Pushgateway çš„æ¥å£æ¨è¿‡å». å¾ˆéº»çƒ¦æ˜¯ä¸æ˜¯?")]),s._v(" "),t("p",[s._v("è¿™é‡Œéœ€è¦å‡†å¤‡è¿™ä¸ªæ•°æ®ç»“æ„, è¿™ä¸ªæ•°æ®ç»“æ„è¿˜éœ€è¦çº¿ç¨‹å®‰å…¨. å¦‚æœè¯·æ±‚éå¸¸é¢‘ç¹, è€—æ—¶æ•°æ®å¾ˆå¤š, è¿˜å¾—è¿›è¡Œé™åˆ¶, æ¯”å¦‚è¿™ä¸ªæ•°æ®ç»“æ„åªä¿å­˜ 1000 ä¸ªè€—æ—¶æ•°æ®. ç„¶ååˆ°äº†æ—¶é—´é—´éš”ä¹‹åéœ€è¦æ’åº, è¿˜è¦ç»„ç»‡æˆç›‘æ§ç³»ç»Ÿéœ€è¦çš„æ•°æ®æ ¼å¼, è¿˜éœ€è¦è°ƒç”¨ HTTP æ¥å£æ¨é€æ•°æ®.")]),s._v(" "),t("p",[t("strong",[s._v("è€Œ SDK å°±æ˜¯åšè¿™äº›é€šç”¨é€»è¾‘çš„")]),s._v(", åº”ç”¨ç¨‹åºè¦åšçš„, å°±æ˜¯æ‹¿åˆ°å»¶è¿Ÿæ•°æ®ä¹‹å, è°ƒç”¨ SDK çš„æ–¹æ³•å‘ŠçŸ¥ SDK, è¯´åˆæœ‰ä¸€æ¬¡æ–°çš„æ¥å£è°ƒç”¨, å»¶è¿Ÿæ•°æ®æ˜¯å¤šå°‘, å“¥ä»¬åç»­å°±äº¤ç»™ä½ äº†, SDK å°±èƒ½å®Œæˆå‰©ä½™æ‰€æœ‰çš„äº‹æƒ….")]),s._v(" "),t("p",[s._v("ä¸šç•Œæ¯”è¾ƒçŸ¥åçš„"),t("strong",[s._v("è·¨è¯­è¨€åŸ‹ç‚¹å·¥å…·")]),s._v("æ˜¯ "),t("a",{attrs:{href:"https://github.com/statsd/statsd",target:"_blank",rel:"noopener noreferrer"}},[s._v("StatsD"),t("OutboundLink")],1),s._v(" å’Œ "),t("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/clientlibs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus"),t("OutboundLink")],1),s._v(". å½“ç„¶æœ‰äº›è¯­è¨€æœ‰è‡ªå·±ç”Ÿæ€çš„å¸¸ç”¨å·¥å…·, æ¯”å¦‚ Java ç”Ÿæ€çš„ Micrometer, ä¸è¿‡ä¸€èˆ¬å…¬å¸éƒ½ä¼šä½¿ç”¨å¤šç§è¯­è¨€, è¿™äº›è·¨è¯­è¨€çš„åŸ‹ç‚¹æ–¹æ¡ˆé€šå¸¸ä½¿ç”¨é¢‘ç‡ä¼šæ›´é«˜. æ‰€ä»¥è¿™é‡Œåˆ†åˆ«ä»‹ç»è¿™ä¸¤ä¸ªæ–¹å¼.")]),s._v(" "),t("h4",{attrs:{id:"statsd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#statsd"}},[s._v("#")]),s._v(" StatsD")]),s._v(" "),t("p",[s._v("StatsD æœ‰ä¸ªå¾ˆå¤§çš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨ "),t("strong",[s._v("UDP ä¼ è¾“åè®®")]),s._v(", å¤§éƒ¨åˆ†è®¡ç®—é€»è¾‘éƒ½æŒªåˆ°äº† StatsD çš„ Server, SDK å±‚é¢çš„å·¥ä½œéå¸¸è½»é‡.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/94e9f7d2251d6241bb0f83308810230d-20230719203435-bfmdxcf.png",alt:""}})]),s._v(" "),t("p",[s._v("StatsD SDK ä¸ StatsD Server ä¹‹é—´é€šä¿¡ä½¿ç”¨çš„æ˜¯ UDP åè®®, UDP åè®®æ— éœ€å»ºç«‹è¿æ¥, å³ä½¿ StatsD Server æŒ‚äº†, ä¹Ÿä¸å½±å“åº”ç”¨ç¨‹åº, è€Œå¯¹äºå»¶è¿Ÿåˆ†å¸ƒåŒºé—´è¿™æ ·çš„è®¡ç®—é€»è¾‘, æ˜¯åœ¨ StatsD Server é‡Œè®¡ç®—çš„, ä¹Ÿä¸ä¼šå½±å“åº”ç”¨ç¨‹åº, æ‰€ä»¥æ•´ä¸ª StatsD çš„è®¾è®¡æ˜¯éå¸¸è½»é‡çš„, å¯¹åº”ç”¨ç¨‹åºåŸºæœ¬æ²¡æœ‰å½±å“.")]),s._v(" "),t("p",[s._v("ç”±äº StatsD ç›¸å½“çŸ¥å, æ‰€ä»¥å¾ˆå¤šé‡‡é›†å™¨éƒ½å®ç°äº† StatsD çš„åè®®, æ¯”å¦‚ Telegraf, Datadog-agent, ä¹Ÿå°±æ˜¯è¯´, å›¾ä¸Šçš„ StatsD Server æ˜¯å¯ä»¥æ¢æˆ Telegraf æˆ– Datadog-agent çš„. è¿™æ ·å°±ä¸ç”¨éƒ¨ç½²å¤ªå¤šè¿›ç¨‹, ä¸€ä¸ªé‡‡é›†å™¨åŒ…æ‰“å¤©ä¸‹, å°±æ‹¿ Telegraf æ¥è¯´å§, æ›¿æ¢åæ¶æ„å°±å˜æˆäº†è¿™æ ·.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/e45a7a5926bb491c5560bc16a5189cfb-20230719203435-17j46y9.png",alt:""}})]),s._v(" "),t("p",[s._v("ä¸‹é¢æ¥æ¼”ç¤ºä¸€ä¸‹, ç”¨ä¸€ä¸ªå°ç¨‹åºåšä¸ªåŸ‹ç‚¹. å°±æŠŠ Telegraf å½“åš StatsD Server æ¥æ¥æ”¶åŸ‹ç‚¹æ•°æ®, Telegraf æ˜¯ InfluxData ä¸»å¯¼å¼€æºçš„ç›‘æ§é‡‡é›†å™¨.")]),s._v(" "),t("p",[s._v("Telegraf æä¾› StatsD çš„ input æ’ä»¶, åœ¨é…ç½®æ–‡ä»¶ä¸­æœç´¢ inputs.statsd å°±èƒ½æ‰¾åˆ°ç›¸å…³çš„é…ç½®æ®µäº†, é‡Œè¾¹æœ‰è¯¦å°½çš„æ³¨é‡Š, ç›´æ¥ä¸Šé…ç½®æ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("inputs.statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v('\nprotocol = "udp"\nservice_address = "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('8125"\npercentiles = '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.95")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v('\nmetric_separator = "_"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("Telegraf é‡å¯ä¹‹åå°±ä¼šåœ¨ 8125 å¼€å¯ UDP ç›‘å¬, åº”ç”¨ç¨‹åºå°±å¯ä»¥å¾€è¿™ä¸ªåœ°å€æ¨é€ç›‘æ§æ•°æ®äº†. è¿™é‡Œæä¾›ä¸€ä¸ª Go åŸ‹ç‚¹çš„ä¾‹å­.")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"math/rand"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/smira/go-statsd"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Client\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("homeHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ResponseWriter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// random sleep")]),s._v("\n    num "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Int31n")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Duration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Millisecond"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    fmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Fprintf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"duration: %d"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Incr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"requests.counter,page=home"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("PrecisionTiming")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"requests.latency,page=home"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Since")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// init client")]),s._v("\n    client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewClient")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:8125"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TagStyle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TagFormatInfluxDB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("MaxPacketSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("MetricPrefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("DefaultTags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("StringTag")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"n9e-webapi"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" statsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("StringTag")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"region"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bj"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("defer")]),s._v(" client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" homeHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ListenAndServe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":8000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[s._v("è¿™ä¸ª Web æœåŠ¡åªæœ‰ä¸€ä¸ªæ ¹è·¯å¾„, é€»è¾‘ä¹Ÿå¾ˆç®€å•, å°±æ˜¯éšæœº sleep å‡ åä¸ªæ¯«ç§’å½“åšä¸šåŠ¡å¤„ç†æ—¶é—´. æ•´ä½“é€»è¾‘æ˜¯è¿™æ ·çš„: é¦–å…ˆ, è¦é€šè¿‡ statsd.NewClient åˆå§‹åŒ–ä¸€ä¸ª StatsD çš„å®¢æˆ·ç«¯, å‚æ•°ä¸­æŒ‡å®šäº† StatsD çš„ Server åœ°å€(åœ¨è¿™ä¸ªä¾‹å­é‡Œå°±æ˜¯ Telegraf çš„ 8125), æŒ‡å®šäº†æ‰€æœ‰ç›‘æ§æŒ‡æ ‡çš„å‰ç¼€æ˜¯ "),t("code",[s._v("http.")]),s._v("â€‹, è¿˜æŒ‡å®šäº†ä¸¤ä¸ªå…¨å±€ Tag, ä¸€ä¸ªæ˜¯ "),t("code",[s._v("service=n9e-webapi")]),s._v("â€‹, å¦ä¸€ä¸ªæ˜¯ "),t("code",[s._v("region=bj")]),s._v("â€‹. é€šè¿‡ TagStyle æŒ‡å®šè¦å‘é€çš„æ˜¯ InfluxDB æ ·å¼çš„æ ‡ç­¾.")]),s._v(" "),t("p",[s._v("ç„¶å, åœ¨è¯·æ±‚çš„å…·ä½“å¤„ç†é€»è¾‘é‡Œä¸ŠæŠ¥äº†ä¸¤ä¸ªç›‘æ§æŒ‡æ ‡, ä¸€ä¸ªæ˜¯ "),t("code",[s._v("requests.counter")]),s._v("â€‹, å¦ä¸€ä¸ªæ˜¯ "),t("code",[s._v("requests.latency")]),s._v("â€‹, å¹¶ä¸ºå®ƒä»¬æŒ‡å®šäº†ä¸€ä¸ªæŒ‡æ ‡çº§åˆ«çš„æ ‡ç­¾ "),t("code",[s._v("page=home")]),s._v("â€‹, æ•´ä½“çœ‹èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„.")]),s._v(" "),t("p",[s._v("Telegraf æ”¯æŒå¤šç§ output æ’ä»¶, å¯ä»¥ä½¿ç”¨æ¯”è¾ƒå¿«æ·çš„ outputs.file æ’ä»¶, æŠŠç”Ÿæˆçš„æŒ‡æ ‡å†™åˆ° stdout, æ¥éªŒè¯æ•ˆæœ.")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("outputs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nfiles "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stdout"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("è¯·æ±‚æ•°é‡å’Œè¯·æ±‚å»¶æ—¶éƒ½æ˜¯å…¸å‹çš„åº”ç”¨å±‚é¢çš„ç›‘æ§æŒ‡æ ‡")]),s._v(", å¦‚æœæƒ³è¦åšä¸šåŠ¡æŒ‡æ ‡ç›‘æ§, æ¯”å¦‚è®¢å•é‡ç›‘æ§, åº”è¯¥æ€ä¹ˆåšå‘¢? å…¶å®é€»è¾‘æ˜¯å®Œå…¨ä¸€æ ·çš„, ä»¿ç…§ "),t("code",[s._v("requests.counter")]),s._v("â€‹ çš„å†™æ³•, åšä¸€ä¸ªè®¢å•é‡çš„æŒ‡æ ‡, æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°è®¢å•çš„æ—¶å€™, å°±ç»™è®¢å•é‡æŒ‡æ ‡ "),t("code",[s._v("+1")]),s._v("â€‹. ä¸€èˆ¬ä¸€ä¸ªæœåŠ¡ä¼šéƒ¨ç½²å¤šä¸ªå®ä¾‹, æ¯ä¸ªå®ä¾‹éƒ½ç»Ÿè®¡äº†è‡ªå·±çš„è®¢å•é‡, è¦è®¡ç®—æœ€è¿‘ä¸€åˆ†é’Ÿçš„è®¢å•æ•°é‡çš„è¯, åªéœ€è¦åœ¨æœåŠ¡ç«¯ä½¿ç”¨ PromQL åšäºŒæ¬¡æ±‡æ€»è®¡ç®—.")]),s._v(" "),t("h4",{attrs:{id:"prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[s._v("#")]),s._v(" Prometheus")]),s._v(" "),t("p",[s._v("Prometheus çš„åŸ‹ç‚¹æ–¹å¼è·Ÿ StatsD å¾ˆåƒ, "),t("strong",[s._v("å¯¹äºè¯·æ±‚æ•°é‡å’Œå»¶è¿Ÿè¿™æ ·çš„ç›‘æ§æŒ‡æ ‡, ä¹Ÿæ˜¯åœ¨è¯·æ±‚å¤„ç†å®Œæˆä¹‹å, è°ƒç”¨ SDK çš„æ–¹æ³•è¿›è¡Œè®°å½•çš„")]),s._v(". ä¸è¿‡, å¦‚æœæ¯ä¸ªæ–¹æ³•éƒ½è¦åŠ è¿™ä¹ˆå‡ è¡Œä»£ç å°±æ˜¾å¾—å¤ªå†—ä½™äº†, æœ€å¥½è¿˜æ˜¯é€šè¿‡ AOP çš„æ–¹å¼åšä¸€äº›åˆ‡é¢é€»è¾‘, Nightingale çš„ Webapi æ¨¡å—å°±æ˜¯è¿™ä¹ˆå¹²çš„, ç›´æ¥ç”¨è¿™ä¸ª "),t("a",{attrs:{href:"https://github.com/ccfos/nightingale",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä»£ç "),t("OutboundLink")],1),s._v(" è¿›è¡Œè®²è§£.")]),s._v(" "),t("p",[s._v("Webapi çš„èŒèƒ½æ˜¯æä¾›ä¸€ç³»åˆ— HTTP æ¥å£ç»™ JavaScript è°ƒç”¨, éœ€è¦ç›‘æ§è¿™äº›æ¥å£çš„è°ƒç”¨é‡, æˆåŠŸç‡, å»¶è¿Ÿæ•°æ®. åŸ‹ç‚¹ä¹‹å‰å…ˆè§„åˆ’ä¸€ä¸‹æ ‡ç­¾, ç»™æ¯ä¸ª HTTP æ¥å£è§„åˆ’ 4 ä¸ªæ ‡ç­¾.")]),s._v(" "),t("ul",[t("li",[s._v("service: æœåŠ¡åç§°, è¦æ±‚å…¨å±€å”¯ä¸€, å¯ä»¥å’Œå…¶ä»–æœåŠ¡åŒºåˆ†å¼€.")]),s._v(" "),t("li",[s._v("code: HTTP è¿”å›çŠ¶æ€ç , å¯ä»¥æ ¹æ®è¿™ä¸ªä¿¡æ¯å¾—çŸ¥ 4xx çš„æ¯”ä¾‹æ˜¯å¤šå°‘, 5xx çš„æ¯”ä¾‹æ˜¯å¤šå°‘, è®¡ç®—æˆåŠŸç‡.")]),s._v(" "),t("li",[s._v("path: æ¥å£è·¯å¾„, æ¯”å¦‚ "),t("code",[s._v("/api/v1/users")]),s._v("â€‹, æœ‰æ—¶å€™ä¼šåœ¨æ¥å£è·¯å¾„ä¸­æ”¾ç½® URL å‚æ•°, æ¯”å¦‚ "),t("code",[s._v("/api/v1/user/23")]),s._v("â€‹,  "),t("code",[s._v("/api/v1/user/12")]),s._v("â€‹ æ˜¯è¯·æ±‚ id ä¸º 23 å’Œ 12 çš„ç”¨æˆ·ä¿¡æ¯. è¿™ä¸ªæ—¶å€™ä¸èƒ½ç›´æ¥æŠŠè¿™ä¸ª URL ä½œä¸ºæ¥å£è·¯å¾„çš„æ ‡ç­¾å€¼, å¦åˆ™è¿™ä¸ªæŒ‡æ ‡é¢—ç²’åº¦å°±å¤ªç»†äº†, åº”è¯¥æŠŠæ¥å£è·¯å¾„çš„æ ‡ç­¾å€¼è®¾ç½®æˆ "),t("code",[s._v("/api/v1/user/:id")]),s._v("â€‹.")]),s._v(" "),t("li",[s._v("method: HTTP æ–¹æ³•, GET, POST, DELETE, PUT ç­‰.")])]),s._v(" "),t("p",[t("strong",[s._v("Prometheus åŸ‹ç‚¹éœ€è¦æå‰æŠŠæŒ‡æ ‡å˜é‡å®šä¹‰å‡ºæ¥")]),s._v(", ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„åŒ…æ¥æ”¾ç½®, å¯ä»¥çœ‹ä¸€ä¸‹ "),t("a",{attrs:{href:"https://github.com/ccfos/nightingale/blob/main/src/webapi/stat/stat.go",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›¸å…³ä»£ç "),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" stat\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/prometheus/client_golang/prometheus"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"n9e-webapi"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    labels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"method"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    uptime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewCounterVec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CounterOpts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        \t\tName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uptime"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\t\tHelp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP service uptime."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    RequestCounter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewCounterVec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    \tprometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CounterOpts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http_request_count_total"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tHelp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Total number of HTTP requests made."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    RequestDuration "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewHistogramVec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tprometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HistogramOpts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        \t\tBuckets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("float64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".01")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\t\tName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http_request_duration_seconds"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\t\tHelp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP request latencies in seconds."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Register the summary and the histogram with Prometheus's default registry.")]),s._v("\n    prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("MustRegister")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    \tuptime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tRequestCounter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tRequestDuration"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("recordUptime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// recordUptime increases service uptime per second.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("recordUptime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("range")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Tick")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tuptime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("WithLabelValues")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Inc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br")])]),t("p",[s._v("uptime å˜é‡æ˜¯é¡ºæ‰‹ä¸ºä¹‹, ç»Ÿè®¡è¿›ç¨‹å¯åŠ¨äº†å¤šé•¿æ—¶é—´, ä¸ç”¨å¤ªå…³æ³¨, RequestCounter å’Œ RequestDuration, åˆ†åˆ«ç»Ÿè®¡è¯·æ±‚æµé‡å’Œè¯·æ±‚å»¶è¿Ÿ. Init æ–¹æ³•æ˜¯åœ¨ Webapi æ¨¡å—è¿›ç¨‹åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨, æ‰€ä»¥è¿›ç¨‹ä¸€èµ·, å°±ä¼šè‡ªåŠ¨æ³¨å†Œå¥½.")]),s._v(" "),t("p",[s._v("ç„¶åå†™ä¸€ä¸ª middleware, "),t("strong",[s._v("åœ¨è¯·æ±‚è¿›æ¥çš„æ—¶å€™æ‹¦æˆªä¸€ä¸‹, çœå¾—æ¯ä¸ªè¯·æ±‚éƒ½è¦å»ç»Ÿè®¡")]),s._v(", å¯ä»¥çœ‹ä¸€ä¸‹ middleware æ–¹æ³•çš„ "),t("a",{attrs:{href:"https://github.com/ccfos/nightingale/blob/main/src/webapi/router/router.go#L20",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä»£ç "),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" gin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HandlerFunc "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("gin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tstart "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tcode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" fmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sprintf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%d"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Writer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tmethod "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Method\n\tlabels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("promstat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FullPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\tpromstat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RequestCounter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("WithLabelValues")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("labels"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Inc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tpromstat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RequestDuration"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("WithLabelValues")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("labels"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Observe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("float64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Since")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Seconds")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("æœ‰äº†è¿™ä¸ª middleware ä¹‹å, new å‡º gin çš„ engine çš„æ—¶å€™, å°±ç«‹é©¬ Use ä¸€ä¸‹.")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\nr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" gin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("New")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Use")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("æœ€å, ç›‘æ§æ•°æ®è¦é€šè¿‡/metricsæ¥å£æš´éœ²å‡ºå», è¦æš´éœ²è¿™ä¸ªè¯·æ±‚ç«¯ç‚¹.")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/prometheus/client_golang/prometheus/promhttp"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configRoute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("gin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Engine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" version "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n    r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" gin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("WrapH")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("promhttp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Handler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("è¿™æ ·, æ¯ä¸ª Webapi æ¥å£çš„æµé‡å’ŒæˆåŠŸç‡éƒ½å¯ä»¥ç›‘æ§åˆ°äº†. å¦‚æœä½ ä¹Ÿéƒ¨ç½²äº† Nightingale, è¯·æ±‚ Webapi(é»˜è®¤æ˜¯18000)çš„ /metrics æ¥å£çœ‹çœ‹è¿”å›çš„å†…å®¹å§.")]),s._v(" "),t("h4",{attrs:{id:"æ•°æ®ä¼ è¾“é€šè·¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®ä¼ è¾“é€šè·¯"}},[s._v("#")]),s._v(" æ•°æ®ä¼ è¾“é€šè·¯")]),s._v(" "),t("p",[s._v("æ— è®ºæ˜¯ StatsD, è¿˜æ˜¯ä½¿ç”¨ Prometheus, æ€»ä¹‹é€šè¿‡åŸ‹ç‚¹é‡‡é›†åˆ°äº†ç›‘æ§æŒ‡æ ‡. æ¥ä¸‹æ¥è¿™äº›æ•°æ®"),t("strong",[s._v("å¦‚ä½•è¿›å…¥ç›‘æ§æœåŠ¡ç«¯")]),s._v("å‘¢? çœ‹ä¸€ä¸‹è¿™ä¸ªé€šè·¯å…¸å‹çš„æ„å»ºæ–¹å¼.")]),s._v(" "),t("p",[s._v("ä½¿ç”¨ StatsD çš„åŸ‹ç‚¹æ–¹å¼, æ•°æ®é€šè¿‡ UDP æ¨ç»™ Telegraf, Telegraf æ¨ç»™åç«¯ç›‘æ§ç³»ç»Ÿ. å¦‚æœæ˜¯é€šè¿‡ Prometheus çš„æ–¹å¼æ¥åŸ‹ç‚¹, å°±æ˜¯æš´éœ² "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£, "),t("strong",[s._v("ç­‰å¾…ç›‘æ§ç³»ç»Ÿæ¥æ‹‰")]),s._v(". å¦‚æœåº”ç”¨æ˜¯éƒ¨ç½²åœ¨ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºä¸Š, ç›´æ¥é€šè¿‡æœ¬åœ°çš„ç›‘æ§ agent æ¥æ‹‰å–å³å¯. å¦‚æœåº”ç”¨æ˜¯éƒ¨ç½²åœ¨ Kubernetes çš„ Pod é‡Œ, åˆ™æœ‰ä¸¤ç§åŠæ³•æ¥æ‹‰å–æ•°æ®, ä¸€ä¸ªæ˜¯ Sidecar æ¨¡å¼, ä¸€ä¸ªæ˜¯ä¸­å¿ƒç«¯æœåŠ¡å‘ç°çš„æ¨¡å¼. ä¸‹é¢è¿™ä¸ªç¤ºæ„å›¾å±•ç¤ºçš„æ˜¯ Sidecar æ¨¡å¼.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/1309313e94e9a9f8a88344d74d3762d1-20230719203435-5qjvn16.png",alt:""}})]),s._v(" "),t("p",[s._v("å·¦ä¾§ Pod1 é‡Œæœ‰ä¸¤ä¸ªå®¹å™¨, App é€šè¿‡ StatsD åŸ‹ç‚¹, ç„¶åé€šè¿‡ UDP æ¨ç»™ Telegraf, Telegraf æ¥æ”¶åˆ°æ•°æ®ä¹‹ååšäºŒæ¬¡è®¡ç®—, æŠŠç»“æœæ¨ç»™ç›‘æ§æœåŠ¡ç«¯; å³ä¾§ Pod2 é‡Œä¹Ÿæœ‰ä¸¤ä¸ªå®¹å™¨, App é€šè¿‡ Prometheus SDK åŸ‹ç‚¹, æš´éœ² "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£, Categraf é€šè¿‡è¿™ä¸ªæ¥å£æ‹‰å–æ•°æ®, ç„¶åæ¨ç»™ç›‘æ§æœåŠ¡ç«¯.")]),s._v(" "),t("p",[s._v("è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒçµæ´», Pod å†…æ€ä¹ˆåšåº”ç”¨è‡ªå·±è¯´äº†ç®—. å³ä½¿ç»™ "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£å¢åŠ ä¸€äº›è®¤è¯é‰´æƒ, æŒ‡æ ‡è¿‡æ»¤, æ‰©å±•æ ‡ç­¾çš„é€»è¾‘, éƒ½ä¸å½±å“å…¶ä»–çš„ Pod. æ•°æ®æ˜¯æ¨ç»™ç›‘æ§æœåŠ¡ç«¯çš„, ç›‘æ§æœåŠ¡ç«¯æ¥æ”¶æ•°æ®çš„ç»„ä»¶å¯ä»¥åšæˆæ— çŠ¶æ€é›†ç¾¤, å‰é¢æ¶è®¾è´Ÿè½½å‡è¡¡, æ•´ä¸ªæ¶æ„éå¸¸ç®€å•, æ‰©å±•æ€§ä¹Ÿå¾ˆå¥½. å½“ç„¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾, æ¯ä¸ª Pod é‡Œéƒ½ä¼´ç”Ÿ Sidecar agent, æµªè´¹èµ„æº.")]),s._v(" "),t("p",[s._v("StatsD åŸ‹ç‚¹çš„æ–¹å¼åªèƒ½ä½¿ç”¨ Sidecar æ¨¡å¼ä¼ è¾“æ•°æ®, è€Œ Prometheus SDK åŸ‹ç‚¹è¿˜æœ‰ç¬¬äºŒç§æ•°æ®æŠ“å–æ–¹å¼: "),t("strong",[s._v("ä¸­å¿ƒç«¯æœåŠ¡å‘ç°æ¨¡å¼")]),s._v(".")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/a4e052ddd462710c05d2c21db88388d8-20230719203435-2emyvcq.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("æ¯ä¸ªåº”ç”¨å®¹å™¨éƒ½ç»Ÿä¸€æš´éœ² "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£, "),t("strong",[s._v("ç›‘æ§æŠ“å–å™¨é€šè¿‡ Kubernetes æœåŠ¡å‘ç°æœºåˆ¶, æ‰¾åˆ°æ‰€æœ‰çš„ Pod, åˆ†åˆ«æŠ“å–")]),s._v("å³å¯. ä¸è¿‡å¹¶ä¸æ˜¯æ‰€æœ‰çš„ Pod éƒ½æš´éœ²æŒ‡æ ‡æ•°æ®, å³ä½¿æš´éœ²äº†, æ¥å£è·¯å¾„ä¹Ÿæœªå¿…ä¸€å®šæ˜¯ "),t("code",[s._v("/metrics")]),s._v("â€‹, è¿™å°±éœ€è¦æœ‰ä¸€ä¸ªæœºåˆ¶å’Œè§„èŒƒ, é€šè¿‡è¿™ä¸ªæœºåˆ¶å‘Šè¯‰æŒ‡æ ‡æŠ“å–å™¨, é€‰æ‹©å“ªä¸ªç±»å‹çš„ Pod æŠ“æ•°æ®, æŠ“æ•°æ®çš„æ—¶å€™ä½¿ç”¨å“ªä¸ªç«¯å£, å“ªä¸ªæ¥å£è·¯å¾„æ¥æŠ“.")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬"),t("strong",[s._v("ä½¿ç”¨ Pod æ³¨è§£")]),s._v("æ¥æ‰¿æ¥è¿™ä¸ªè§„èŒƒ, æ¯”å¦‚åˆ¶å®šæ ‡å‡†: æ‰€æœ‰æƒ³è¦è¢«æŠ“å–ç›‘æ§æ•°æ®çš„ Pod éƒ½ç»Ÿä¸€æš´éœ²å¦‚ä¸‹æ³¨è§£.")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("scrape"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nprometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("metric_path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nprometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("scrape_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("ç„¶åå°±å¯ä»¥å†™æŠ“å– Job æ¥æŠ“å–è¿™ç±»æ•°æ®äº†, ä¸‹é¢ç»™å‡ºä¸€ä¸ªæ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes-pods"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes_sd_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("relabel_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "prometheus.io/scrape = true" annotation.')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_pod_annotation_prometheus_io_scrape"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" keep\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "prometheus.io/metric_path = <metric path>" annotation.')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_pod_annotation_prometheus_io_metric_path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" replace\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target_label")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" __metrics_path__\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" (.+)\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "prometheus.io/scrape_port = <port>" annotation.')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __meta_kubernetes_pod_annotation_prometheus_io_scrape_port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" replace\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("+)("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\\d+)"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v(";(\\d+)\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replacement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$2\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target_label")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" __address__\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" labelmap\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" __meta_kubernetes_pod_label_(.+)\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" replace\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target_label")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" namespace\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_kubernetes_pod_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" replace\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target_label")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("åˆ†æä¸€ä¸‹ä¸­å¿ƒç«¯æœåŠ¡å‘ç°æœºåˆ¶çš„ä¼˜ç¼ºç‚¹. ä¼˜ç‚¹å¾ˆæ˜æ˜¾, ä¸éœ€è¦ sidecar çš„ agent äº†, å¤§å¹…èŠ‚çœèµ„æº, ç¼ºç‚¹æ˜¯æ‰€æœ‰çš„æŠ“å–è§„åˆ™éƒ½æ˜¯ç»Ÿä¸€çš„, ä¸å¥½ä¸ºæ¯ä¸ª Pod å•ç‹¬æŒ‡å®šä¸€äº›è®¤è¯æœºåˆ¶, è¿‡æ»¤è§„åˆ™ç­‰. ä¸æ˜¯è¯´ä¸èƒ½å¹², è€Œæ˜¯è¦åšçš„è¯å°±å¾—ä¿®æ”¹ä¸­å¿ƒç«¯è¿™ä¸ªç»Ÿä¸€çš„æŠ“å–è§„åˆ™, éå¸¸ä¸æ–¹ä¾¿, ç¨æœ‰ä¸æ…è¿˜å®¹æ˜“æ”¹é”™, å½±å“åˆ°åˆ«çš„ Pod.")]),s._v(" "),t("p",[s._v("å½“ç„¶äº†, ä¸€èˆ¬æ¥è¯´ä¸æä¾›è¿™ä¸ªçµæ´»æ€§ä¹Ÿä¸æ˜¯å¤ªå¤§çš„é—®é¢˜, å¤§å®¶éµç…§ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒä¹ŸæŒºå¥½çš„, å¦‚æœçœŸçš„æœ‰æŸä¸ª Pod éœ€è¦é¢å¤–åšä¸€äº›çµæ´»é…ç½®, å¤§ä¸äº†å°±ä¸å¼€é‚£äº›æ³¨è§£, ä»ä½¿ç”¨ sidecar æ¨¡å¼å°±å¥½. è¿™ä¸¤ç§æ–¹å¼å¹¶ä¸ä¸€å®šè¦äºŒé€‰ä¸€, åŒæ—¶å¹¶ç”¨ä¹Ÿæ²¡æœ‰ä»»ä½•é—®é¢˜.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-18"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-18"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[t("strong",[s._v("æœ¬èŠ‚ä»‹ç»äº†ä¸¤ç§åŸ‹ç‚¹ç›‘æ§åº”ç”¨çš„æ–¹å¼, ä¸€ä¸ªæ˜¯ StatsD, ä¸€ä¸ªæ˜¯ Prometheus, è¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯è·¨è¯­è¨€çš„åŸ‹ç‚¹æ–¹æ¡ˆ, ä¸šç•Œåº”ç”¨å¹¿æ³›")]),s._v(". StatsD æ˜¯æ¨æ¨¡å¼, é‡‡ç”¨ UDP åè®®, å„ç±»è®¡ç®—é€»è¾‘æŒªåˆ°äº† StatsD Server ä¸­, å¯¹åº”ç”¨æœ¬èº«ä¸ä¼šé€ æˆå½±å“. Prometheus æ˜¯æ‹‰æ¨¡å¼, SDK çš„é€»è¾‘è·‘åœ¨åº”ç”¨è¿›ç¨‹é‡Œ, å¯èƒ½å¯¹åº”ç”¨é€ æˆä¸€å®šå½±å“, ä¸è¿‡å·²ç»æœ‰å¾ˆå¤šå…¬å¸åšäº†ç”Ÿäº§éªŒè¯, Prometheus çš„ SDK è¿˜æ˜¯å¾ˆç¨³å®šçš„, å¤§å¯æ”¾å¿ƒä½¿ç”¨.")]),s._v(" "),t("p",[s._v("**å¯¹äº Prometheus SDK çš„åŸ‹ç‚¹æ–¹æ¡ˆ, æœ‰ä¸¤ç§æ•°æ®æŠ“å–æ–¹å¼, ä¸€ä¸ªæ˜¯ Sidecar æ¨¡å¼, çµæ´»ä½†æ˜¯å ç”¨èµ„æºå¤š; ä¸€ä¸ªæ˜¯ä¸­å¿ƒç«¯æœåŠ¡å‘ç°æ¨¡å¼, ä¸é‚£ä¹ˆçµæ´»ä½†æ˜¯èµ„æºå ç”¨å¾—å°‘, æŠ€æœ¯ä¸Šæ²¡æœ‰éé»‘å³ç™½, å»ºè®®æ ¹æ®å…·ä½“åœºæ™¯çµæ´»é€‰æ‹©. **")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/8f8c77346f64b8f850798a08238c0a6c-20230719203435-o1tg85o.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_20-åº”ç”¨ç›‘æ§-å¦‚ä½•ä½¿ç”¨æ—¥å¿—æ¥ç›‘æ§åº”ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_20-åº”ç”¨ç›‘æ§-å¦‚ä½•ä½¿ç”¨æ—¥å¿—æ¥ç›‘æ§åº”ç”¨"}},[s._v("#")]),s._v(" 20.åº”ç”¨ç›‘æ§-å¦‚ä½•ä½¿ç”¨æ—¥å¿—æ¥ç›‘æ§åº”ç”¨?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€è®²ä»‹ç»äº†åº”ç”¨åŸ‹ç‚¹ç›‘æ§, å¯¹äºè‡ªç ”çš„è½¯ä»¶, åœ¨ä¸€å¼€å§‹å°±å»ºç«‹å¯è§‚æµ‹èƒ½åŠ›æ˜¯éå¸¸å¥½çš„é€‰æ‹©, ä½†æ˜¯å¾ˆå¤šè½¯ä»¶å¯èƒ½æ— æ³•ä¿®æ”¹æºä»£ç , æ¯”å¦‚ä¸€äº›å¤–é‡‡çš„è½¯ä»¶, é‚£å°±åªèƒ½ç”¨ä¸€äº›å¤–æŒ‚å¼çš„æ‰‹æ®µ, æ¯”å¦‚åœ¨è¯·æ±‚é“¾è·¯ä¸Šæ’å…¥ä¸€äº›ä»£ç†é€»è¾‘, æˆ–è€…è¯»å–åˆ†æåº”ç”¨æ—¥å¿—.")]),s._v(" "),t("p",[s._v("å…¸å‹çš„ä»£ç†æ–¹å¼æ˜¯ Nginx, å¦‚æœæ˜¯ HTTP æœåŠ¡, ä» Nginx çš„ Access æ—¥å¿—ä¸­å¯ä»¥è·å–å¾ˆå¤šä¿¡æ¯, æ¯”å¦‚è®¿é—®çš„æ˜¯å“ªä¸ªæ¥å£, ç”¨çš„ä»€ä¹ˆ HTTP æ–¹æ³•, è¿”å›çš„çŠ¶æ€ç æ˜¯ä»€ä¹ˆ, è€—æ—¶å¤šä¹…ç­‰ç­‰. è¿™äº›ä¿¡æ¯å¯¹åº”ç”¨çš„ç›‘æ§å¾ˆæœ‰å¸®åŠ©.")]),s._v(" "),t("p",[s._v("é™¤æ­¤ä¹‹å¤–, ä¹Ÿå¯ä»¥ä½¿ç”¨ eBPF æŠ€æœ¯ä¸ºç½‘ç»œåŒ…å¢åŠ ä¸€äº›è¿‡æ»¤åˆ†æé€»è¾‘, ä¸è¿‡ eBPF è¦æ±‚çš„å†…æ ¸ç‰ˆæœ¬è¾ƒé«˜. è€Œé€šè¿‡æ—¥å¿—å¯¹åº”ç”¨åšç›‘æ§, æ˜¾ç„¶æ˜¯ç›¸å¯¹ç›´è§‚å’Œå»‰ä»·çš„æ–¹å¼, è¿™ä¸€è®²å°±æ¥çœ‹çœ‹"),t("strong",[s._v("æ€ä¹ˆä»æ—¥å¿—ä¸­æå–æŒ‡æ ‡")]),s._v(".")]),s._v(" "),t("h4",{attrs:{id:"æå–æŒ‡æ ‡çš„å…¸å‹åšæ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æå–æŒ‡æ ‡çš„å…¸å‹åšæ³•"}},[s._v("#")]),s._v(" æå–æŒ‡æ ‡çš„å…¸å‹åšæ³•")]),s._v(" "),t("p",[s._v("æ ¹æ®æå–è§„åˆ™è¿è¡Œçš„ä½ç½®å¯ä»¥åˆ†ä¸ºä¸¤ç±»åšæ³•, ä¸€ä¸ªæ˜¯åœ¨ä¸­å¿ƒç«¯, ä¸€ä¸ªæ˜¯åœ¨æ—¥å¿—ç«¯.")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ä¸­å¿ƒç«¯")]),s._v(" å°±æ˜¯"),t("strong",[s._v("æŠŠè¦å¤„ç†çš„æ‰€æœ‰æœºå™¨çš„æ—¥å¿—éƒ½ç»Ÿä¸€ä¼ åˆ°ä¸­å¿ƒ")]),s._v(", æ¯”å¦‚é€šè¿‡ Kafka ä¼ è¾“, æœ€ç»ˆè½åˆ° Elasticsearch, æŒ‡æ ‡æå–è§„åˆ™å¯ä»¥ä½œä¸ºæµè®¡ç®—ä»»åŠ¡æ’åˆ° Kafka é€šé“ä¸Š, æ€§èƒ½å’Œå®æ—¶æ€§éƒ½ç›¸å¯¹æ›´å¥½. æˆ–è€…ç›´æ¥å†™ä¸ªå®šæ—¶ä»»åŠ¡, è°ƒç”¨ Elasticsearch çš„æ¥å£æŸ¥è¯¢æ—¥å¿—, åŒæ—¶ç»™å‡ºèšåˆè®¡ç®—å‡½æ•°, è®© Elasticsearch è¿”å›æŒ‡æ ‡æ•°æ®, ç„¶åå†™å…¥æ—¶åºåº“, å®æ—¶æ€§ä¼šå·®ä¸€äº›, ä½†ä¹ŸåŸºæœ¬å¤Ÿç”¨.")]),s._v(" "),t("li",[t("strong",[s._v("æ—¥å¿—ç«¯")]),s._v(" å¤„ç†æ˜¯æŒ‡"),t("strong",[s._v("æå–è§„åˆ™ç›´æ¥è¿è¡Œåœ¨äº§ç”Ÿæ—¥å¿—çš„æœºå™¨ä¸Š")]),s._v(", æµå¼è¯»å–æ—¥å¿—, åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼. å¯¹äºå‘½ä¸­çš„æ—¥å¿—, æå–å…¶ä¸­çš„æ•°å­—éƒ¨åˆ†ä½œä¸ºæŒ‡æ ‡ä¸ŠæŠ¥, æˆ–è€…ä¸æå–ä»»ä½•æ•°å­—, åªç»Ÿè®¡ä¸€ä¸‹å‘½ä¸­çš„æ—¥å¿—è¡Œæ•°æœ‰æ—¶ä¹Ÿå¾ˆæœ‰ä»·å€¼, æ¯”å¦‚ç»Ÿè®¡ä¸€ä¸‹ "),t("code",[s._v("Error")]),s._v("â€‹ æˆ– "),t("code",[s._v("Exception")]),s._v("â€‹ å…³é”®å­—å‡ºç°çš„æ¬¡æ•°, å°±çŸ¥é“ç³»ç»Ÿæ˜¯ä¸æ˜¯æŠ¥é”™äº†.")])]),s._v(" "),t("p",[s._v("ä¸­å¿ƒç«¯å¤„ç†çš„æ–¹å¼, å¼€æºè§£å†³æ–¹æ¡ˆæ¯”è¾ƒå°‘. æ—¥å¿—ç«¯å¤„ç†çš„æ–¹å¼, å€’æ˜¯æœ‰å¾ˆå¤šå¼€æºæ–¹æ¡ˆ, æ¯”è¾ƒæœ‰åçš„æ˜¯ "),t("a",{attrs:{href:"https://github.com/google/mtail",target:"_blank",rel:"noopener noreferrer"}},[s._v("mtail"),t("OutboundLink")],1),s._v(" å’Œ "),t("a",{attrs:{href:"https://github.com/fstab/grok_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("grokexporter"),t("OutboundLink")],1),s._v(", mtail å‘å¸ƒæ—¶é—´æ›´ä¹…, ä¸è¿‡å®ƒä»¬åŸç†ä¸Šæ˜¯ç±»ä¼¼çš„, è¿™é‡Œé‡ç‚¹ä»‹ç» mtail çš„ç”¨æ³•.")]),s._v(" "),t("h4",{attrs:{id:"å¿«é€Ÿä¸Šæ‰‹mtail"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¿«é€Ÿä¸Šæ‰‹mtail"}},[s._v("#")]),s._v(" å¿«é€Ÿä¸Šæ‰‹mtail")]),s._v(" "),t("p",[s._v("ç±»ä¼¼äº Linux ä¸‹çš„ tail å‘½ä»¤, mtail, grok_exporter ç­‰å·¥å…·å°±åƒæ˜¯å¯¹æ—¥å¿—æ–‡ä»¶æ‰§è¡Œ "),t("code",[s._v("tail -f")]),s._v("â€‹, ç„¶åæ¯æ”¶åˆ°ä¸€æ¡æ—¥å¿—, å°±å»åŒ¹é…é¢„å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼, å¦‚æœåŒ¹é…æˆåŠŸ, å°±æ‰§è¡ŒæŸäº›åŠ¨ä½œ, å¦åˆ™è·³è¿‡ç­‰å¾…ä¸‹ä¸€æ¡æ—¥å¿—.")]),s._v(" "),t("p",[s._v("ä¸‹é¢ä½¿ç”¨ mtail ç»Ÿè®¡ä¸€ä¸‹ /var/log/messages ä¸­ Out of memory å…³é”®å­—å‡ºç°çš„æ¬¡æ•°, ä½œä¸ºä¸€ä¸ªé‡è¦çš„ç›‘æ§æŒ‡æ ‡ä¸ŠæŠ¥.")]),s._v(" "),t("p",[s._v("å¦‚æœæƒ³ç»Ÿè®¡ /var/log/messages ä¸­ Out of memory å…³é”®å­—å‡ºç°çš„æ¬¡æ•°, é‚£å°±å¾—é€šè¿‡æŸç§æœºåˆ¶å‘Šè¯‰ mtail æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ, æå–è§„åˆ™æ˜¯ä»€ä¹ˆ, è¿™ä¸ªè§„åˆ™æ–‡ä»¶å«åš program, ä¸€èˆ¬å‘½åä¸º xyz.mtail, ä¸‹é¢æ˜¯ä¸€ä¸ªæ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨ mtail äºŒè¿›åˆ¶åŒçº§ç›®å½•ä¸‹åˆ›å»º progs ç›®å½•, ä¸‹é¢æ”¾ç½® syslogs å­ç›®å½•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# syslogs å­ç›®å½•ç”¨äºæ”¾ç½®ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶å¯¹åº”çš„æå–è§„åˆ™")]),s._v("\nmkdir "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p progs/syslogs\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”¨äºç»Ÿè®¡ Out of memory å…³é”®å­—çš„ mtail è§„åˆ™æ–‡ä»¶å†…å®¹å¦‚ä¸‹(æˆ‘å‘½åä¸º")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# syslogs.mtail): ")]),s._v("\ncounter oom_total\n/Out of memory/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  oom_total++\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("æ–‡ä»¶å†…å®¹çœ‹èµ·æ¥å¾ˆç®€å•, åªæœ‰ 4 è¡Œ, ç¬¬ä¸€è¡Œæ˜¯å£°æ˜äº†ä¸€ä¸ªå˜é‡, ç±»å‹æ˜¯ counter, å˜é‡åæ˜¯ oom_total, ç¬¬äºŒè¡Œæ˜¯åœ¨ "),t("code",[s._v("//")]),s._v("â€‹ ä¹‹é—´å®šä¹‰äº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼, ç”¨æ¥åŒ¹é… Out of memory, å¦‚æœåŒ¹é…æˆåŠŸ, å°±æ‰§è¡Œå¤§æ‹¬å·é‡Œçš„å†…å®¹, å¯¹ oom_total å˜é‡åŠ  1.")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥æŠŠ mtail è¿è¡Œèµ·æ¥, çœ‹çœ‹æ•ˆæœå¦‚ä½•.")]),s._v(" "),t("p",[s._v("å¯åŠ¨å‘½ä»¤:")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("./mtail "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("progs ./progs/syslogs/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("logs /var/log/messages\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("é€šè¿‡ -progs å‚æ•°æŒ‡å®š mtail æ–‡ä»¶æ‰€åœ¨ç›®å½•, å½“ç„¶æŒ‡å®šå…·ä½“çš„æ–‡ä»¶ä¹Ÿå¯ä»¥, é€šè¿‡ -logs å‚æ•°æŒ‡å®šè¦æå–çš„æ—¥å¿—æ–‡ä»¶æ˜¯å“ªä¸ª, æ”¯æŒ glob åŒ¹é…, ä¹Ÿæ”¯æŒä¼ å…¥å¤šæ¬¡ -logs å‚æ•°. mtail å¯åŠ¨ä¹‹åä¼šé»˜è®¤ç›‘å¬åœ¨ 3903 ç«¯å£, è¯·æ±‚ 3903 çš„ "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£å°±èƒ½æ‹¿åˆ° Prometheus åè®®çš„ç›‘æ§æ•°æ®.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("02 qinxiaohui"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -tlnp|grep mtail")]),s._v("\nLISTEN     0      128       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3903                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("*                   users"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('(("mtail"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid=18972"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd=7))\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("02 qinxiaohui"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -s localhost:3903/metrics | grep oom_total")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP oom_total defined at syslogs.mtail:1:9-17")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE oom_total counter")]),s._v("\noom_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('prog="syslogs.mtail"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ grep å‘½ä»¤åšäº†è¿‡æ»¤, åªå±•ç¤ºäº† oom_total ç›¸å…³çš„å†…å®¹, å®é™…ä¸Š mtail ä¼šè¾“å‡ºå¾ˆå¤šæŒ‡æ ‡. æœ‰äº†è¿™ä¸ª /metrics æ¥å£, æ€ä¹ˆå’Œç›‘æ§ç³»ç»Ÿå¯¹æ¥å°±å¾ˆæ˜æ˜¾äº†, ç›´æ¥ç”±æŠ“å–å™¨æ¥è¿™ä¸ªåœ°å€æŠ“å–æ•°æ®å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("ä¸‹é¢ç»§ç»­è®²è§£ mtail æœ¬èº«çš„ç”¨æ³•.")]),s._v(" "),t("p",[s._v("ä¾‹å­é‡Œ mtail è‡ªåŠ¨åŠ äº†ä¸€ä¸ª prog æ ‡ç­¾, æŠŠ mtail æ–‡ä»¶åä½œä¸ºæ ‡ç­¾åŠ ä¸Šäº†, å¯¹äºä¸€äº› access.log ç±»å‹çš„æ—¥å¿—, ç»å¸¸ç”¨äºç»Ÿè®¡æ¥å£çš„åå, å»¶è¿Ÿç­‰, éœ€è¦æŠŠæ¥å£è·¯å¾„, method, statuscode ç­‰ä½œä¸ºæ ‡ç­¾, åº”è¯¥å¦‚ä½•é…ç½®å‘¢? è¿™é‡Œä»¥ Nginx çš„ access æ—¥å¿—ä½œä¸ºæ ·ä¾‹æ¥æ¼”ç¤º, å¯ä»¥çœ‹ä¸€ä¸‹ Nginx çš„ logformat.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("    log_format  main  '$remote_addr "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $remote_user "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$time_local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("å¯¹åº”çš„å‡ æ¡æ ·ä¾‹æ—¥å¿—å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail -n 5 /var/log/nginx/access.log")]),s._v("\n119.45.249.92 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("17/Dec/2022"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("22"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("35"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("39 +0800"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' "GET / HTTP/1.1" 200 14849 "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('" "clb'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('healthcheck" "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('"\n119.45.249.92 '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("17/Dec/2022"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("22"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("35"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("40 +0800"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' "GET / HTTP/1.1" 200 14849 "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('" "clb'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('healthcheck" "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('"\n119.45.249.92 '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("17/Dec/2022"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("22"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("35"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("40 +0800"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' "GET / HTTP/1.1" 200 14849 "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('" "clb'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('healthcheck" "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('"\n119.45.249.92 '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("17/Dec/2022"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("22"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("35"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("41 +0800"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' "GET / HTTP/1.1" 200 14849 "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('" "clb'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('healthcheck" "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('"\n119.45.249.92 '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("17/Dec/2022"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("22"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("35"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("41 +0800"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' "GET / HTTP/1.1" 200 14849 "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('" "clb'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('healthcheck" "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("è¿™ä¸ª logformat ç€å®ç®€å•, è¿å“åº”å»¶è¿Ÿéƒ½æ²¡æœ‰æ‰“å°, è¿™æ˜¯ Nginx é»˜è®¤çš„ logformat, ä¹Ÿå…ˆç»´æŒç°çŠ¶, ç»Ÿè®¡ä¸€ä¸‹è¯·æ±‚æ•°é‡ä»¥åŠå“åº”ä½“çš„å¤§å°, ä¸‹é¢æ˜¯å…·ä½“çš„ mtail æ–‡ä»¶å†…å®¹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("counter request_total by method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code\ncounter body_bytes_sent_total by method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' code\n\n/"('),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\S+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v('\\S+) HTTP\\/1.1" ('),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\d+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<body_bytes_sent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\d+)/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\trequest_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("++\n\tbody_bytes_sent_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" += $body_bytes_sent\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("è¿™ä¸ªæ­£åˆ™çœ‹èµ·æ¥å°±å¤æ‚å¤šäº†, æ¯”å¦‚è·å– statuscode çš„åœ°æ–¹å†™çš„æ­£åˆ™æ˜¯ "),t("code",[s._v("(?P<code>\\d+)")]),s._v("â€‹, è¿™ä¸ªå«åš "),t("strong",[s._v("å‘½åæ•è·")]),s._v(", æ ¸å¿ƒçš„æ­£åˆ™å°±æ˜¯ "),t("code",[s._v("\\d+")]),s._v("â€‹, ä½†æ˜¯åé¢æƒ³ç”¨è¿™ä¸ªå†…å®¹, å°±ç»™å®ƒè®¾ç½®äº†ä¸€ä¸ªå˜é‡å« code, è€Œ method, url, body_bytes_sent éƒ½æ˜¯åŒæ ·çš„é“ç†.")]),s._v(" "),t("p",[s._v("åŒ¹é…äº†æ­£åˆ™ä¹‹å, åšäº†ä¸¤ä¸ªåŠ¨ä½œ, request_total å˜é‡åŠ ä¸€, ç›¸å½“äºåœ¨ç»Ÿè®¡è¯·æ±‚æ¬¡æ•°, body_bytes_sent_total å˜é‡åŠ ä¸Šæ—¥å¿—è¿™è¡Œæå–çš„ $body_bytes_sent å˜é‡çš„å€¼, æ˜¯åœ¨ç»Ÿè®¡å“åº”æ€»å¤§å°.")]),s._v(" "),t("p",[s._v("è¿™é‡Œ request_total å’Œ body_bytes_sent_total è¿™ä¸¤ä¸ªæŒ‡æ ‡éƒ½æ˜¯å¸¦æœ‰æ ‡ç­¾çš„, ä¸”éƒ½æ˜¯ 3 ä¸ªæ ‡ç­¾: method, url, code, å£°æ˜ä¹‹åå°±å¯ä»¥ä½¿ç”¨, é€šè¿‡å‘½åæ•è·çš„æ–¹å¼ç»™çš„å˜é‡åä¹Ÿå¯ä»¥åœ¨åé¢ä½¿ç”¨, éå¸¸çµæ´». ä¸‹é¢æ˜¯æµ‹è¯•è¾“å‡º.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é€šè¿‡ä¸‹é¢çš„å‘½ä»¤åŠ è½½ nginx çš„ mtail, æŒ‡å®š nginx çš„ access.log")]),s._v("\n./mtail "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("progs ./progs/nginx/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("logs /var/log/nginx/access.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸‹é¢è¯·æ±‚ä¸€ä¸‹ /metrics æ¥å£, çœ‹çœ‹æ˜¯å¦é‡‡é›†æˆåŠŸ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("02 qinxiaohui"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -s localhost:3903/metrics | grep -P 'request_total|body_bytes_sent_total'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP body_bytes_sent_total defined at nginx.mtail:2:9-29")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE body_bytes_sent_total counter")]),s._v("\nbody_bytes_sent_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('code="200"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('method="GET"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('prog="nginx.mtail"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('url="/"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 1.143373e+06\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP request_total defined at nginx.mtail:1:9-21")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE request_total counter")]),s._v("\nrequest_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('code="200"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('method="GET"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('prog="nginx.mtail"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('url="/"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 77\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("çœ‹èµ·æ¥ä¸€åˆ‡æ­£å¸¸, ä¸Šé¢è¿™äº›æ ‡ç­¾éƒ½æ˜¯ä»æ—¥å¿—ä¸­ç›´æ¥æå–çš„, å¦‚æœæƒ³é™„åŠ ä¸€äº›é™æ€æ ‡ç­¾åº”è¯¥æ€ä¹ˆåšå‘¢? æ¯”å¦‚æŠŠæœºæˆ¿ä¿¡æ¯ä½œä¸ºæ ‡ç­¾é™„åˆ°æ—¶åºæ•°æ®ä¸Š, å¯ä»¥çœ‹ä¸€ä¸‹æ ·ä¾‹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v('hidden text zone\nzone = "beijing"\n\ncounter request_total by method'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" zone\ncounter body_bytes_sent_total by method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' zone\n\n/"('),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\S+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v('\\S+) HTTP\\/1.1" ('),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\d+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<body_bytes_sent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\d+)/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\trequest_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("zone"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("++\n\tbody_bytes_sent_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("zone"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" += $body_bytes_sent\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v('è¿™é‡ŒåŠ äº†ä¸€ä¸ªå…¨å±€çš„ zone="beijing" çš„æ ‡ç­¾, å†™æ³•ä¸€ç›®äº†ç„¶, ä¸è¿‡å¤šè§£é‡Š. å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯åœ¨å¼•ç”¨ zone å˜é‡çš„æ—¶å€™, å‰é¢ä¸è¦åŠ  '),t("code",[s._v("$")]),s._v("â€‹ ç¬¦å·. è¿™é‡Œåƒä¸‡åˆ«å†™é¡ºæ‰‹äº†, çœ‹åˆ°å…¶ä»–å˜é‡éƒ½åŠ  "),t("code",[s._v("$")]),s._v("â€‹ å°±æŠŠ zone ä¹ŸåŠ ä¸Šäº†, åŠ ä¸Šå°±è¯†åˆ«ä¸äº†äº†.")]),s._v(" "),t("p",[s._v("ä¸Šé¢ä¸¤ä¸ªä¾‹å­æ¼”ç¤ºçš„éƒ½æ˜¯ Counter ç±»å‹çš„å˜é‡, å…¶å® mtail è¿˜æ”¯æŒ Gauge å’Œ Histogram ç±»å‹, å¹¶ä¸”åœ¨ä»“åº“çš„ "),t("a",{attrs:{href:"https://github.com/google/mtail/tree/main/examples",target:"_blank",rel:"noopener noreferrer"}},[s._v("examples"),t("OutboundLink")],1),s._v(" ç›®å½•ä¸‹æä¾›äº†å¾ˆå¤šæ ·ä¾‹, å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨, æ³¨æ„ Histogram ç±»å‹åœ¨å®šä¹‰çš„æ—¶å€™è¦ç»™å‡º Bucket çš„åˆ†å¸ƒèŒƒå›´, è¦ä¸ç„¶ mtail ä¸çŸ¥é“å¦‚ä½•æ”¾ç½®ç»Ÿè®¡æ•°æ®.")]),s._v(" "),t("p",[s._v("ä¸‹é¢æ¥çœ‹ä¸€ä¸ªç”Ÿäº§çº§çš„ä¾‹å­, ç”¨äºåˆ†æ lighttpd çš„è®¿é—®æ—¥å¿—, ä»ä¸­å¯ä»¥å­¦åˆ°æ›´å¤šç”Ÿäº§çº§çš„å†™æ³•.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright 2010 Google Inc. All Rights Reserved.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file is available under the Apache license.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mtail module for a lighttpd server")]),s._v("\n\ncounter request by status\ncounter time_taken by status\ncounter bytes_out by subtotal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" status\ncounter bytes_in by status\ncounter requests by proxy_cache\n\nconst ACCESSLOG_RE // +\n    /("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<proxied_for"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\S+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<request_ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\S+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<authuser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\S+)/ +\n    / \\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<access_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("+)\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' "('),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<http_method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\S+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(".+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v(") / +\n    /("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<protocol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v('\\S+)" ('),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\d+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<bytes_body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\d+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<bytes_in"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\d+)/ +\n    / ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<bytes_out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\d+) ("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<time_taken"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v('\\d+) "('),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<referer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v('^"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v('+)" / +\n    /"('),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<agent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v('^"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v('+)"/\n\n'),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /var/log/lighttpd/access.log")]),s._v("\ngetfilename() =~ /lighttpd.access.log/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  // + ACCESSLOG_RE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Parse an accesslog entry.")]),s._v('\n    $url == "/healthz" '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nothing")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    otherwise "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      strptime($access_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "02/Jan/2006'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("15"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("04"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("05 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('0700")\n\n      request'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("++\n      time_taken"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" += $time_taken\n      bytes_out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resp_body"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" += $bytes_body\n      bytes_out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resp_header"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" += $bytes_out "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $bytes_body\n      bytes_in"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" += $bytes_in\n\n      $proxied_for "),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!=")]),s._v(' "'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('" '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        requests"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$request_ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("++\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("p",[s._v("è¿™ä¸ª program ä¸€å¼€å§‹, å®šä¹‰äº†å¾ˆå¤š counter ç±»å‹çš„å˜é‡, è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆæ–°çŸ¥è¯†, ç•¥è¿‡. ç„¶åå®šä¹‰äº†ä¸€ä¸ªå¸¸é‡ ACCESSLOG_RE, è¿™ä¸ªæ­£åˆ™å¾ˆå¤æ‚, å¯¹äºè¿™ç±»å¤æ‚çš„æ­£åˆ™, å¯ä»¥æ‹†æˆå¾ˆå¤šä¸ªå°çš„éƒ¨åˆ†, ç›¸äº’ä¹‹é—´ç”¨ + è¿æ¥, è¿™ç§åšæ³•æ—¢å®¹æ˜“é˜…è¯», åˆå®¹æ˜“ä¸ºæ¯ä¸ªç‰‡æ®µå¢åŠ æ³¨é‡Š, ä¾¿äºåæœŸç»´æŠ¤, åé¢ä»‹ç»çš„ grok_exporter åˆ™æ›´è¿›ä¸€æ­¥, æŠŠè¿™äº›æ­£åˆ™ç‰‡æ®µç›´æ¥åšæˆ pattern å•ç‹¬ç»´æŠ¤äº†.")]),s._v(" "),t("p",[s._v("ç»§ç»­å¾€ä¸‹çœ‹, getfilename() æ˜¯ä¸ªå†…ç½®å‡½æ•°, è·å–æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„, å¯¹è¿™ä¸ªå†…å®¹åšäº†ä¸€ä¸ªæ­£åˆ™åˆ¤æ–­, å¦‚æœåŒ¹é…æ‰å»èµ°æ ¸å¿ƒé€»è¾‘, è¿™é‡Œæ˜¯ä¸æ˜¯æœ‰äº›å¤šæ­¤ä¸€ä¸¾äº†å‘¢? æˆ‘çŒœæµ‹, è¿™ä¸ªå†™æ³•çš„åˆè¡·æ˜¯è§‰å¾—è¿™æ®µå†…å®¹å¯èƒ½ä¼šå’Œå…¶ä»–çš„æå–è§„åˆ™æ··åœ¨ä¸€èµ·, åŒæ—¶æå–å¤šä¸ªæ—¥å¿—æ–‡ä»¶æ—¶, ä¸ºäº†é¿å…è¿™æ®µé€»è¾‘è·‘åœ¨ä¸€äº›æ— å…³çš„æ—¥å¿—ä¸Š, å°±åŠ äº†è¿™ä¹ˆä¸€å¥åˆ¤æ–­, è€ƒè™‘å¾—å¾ˆå‘¨å…¨. ä¸è¿‡, å¦‚æœåœ¨ä½¿ç”¨çš„æ—¶å€™, å¯ä»¥ä¿è¯è¿™æ®µé€»è¾‘åªç”¨äºå¤„ç† lighttpd çš„è®¿é—®æ—¥å¿—, è¿™ä¸ªåˆ¤æ–­å°±æ˜¯å¯ä»¥å»æ‰çš„.")]),s._v(" "),t("p",[s._v("getfilename() çš„åˆ¤æ–­é€šè¿‡ä¹‹å, å°±å¼€å§‹æ ¡éªŒä¸»æ­£åˆ™äº†. ä¸»æ­£åˆ™åŒ¹é…å°±å¼€å§‹åˆ¤æ–­è¯·æ±‚çš„ url æ˜¯ä¸æ˜¯ "),t("code",[s._v("/healthz")]),s._v('â€‹, å¦‚æœæ˜¯å°±ä»€ä¹ˆéƒ½ä¸å¹²(ç©ºé€»è¾‘), å› ä¸ºè¿™ä¸ªæ˜¯å¥åº·æ£€æŸ¥çš„æ¥å£, æ²¡å¿…è¦æå–æŒ‡æ ‡. å¦åˆ™è¿›è¡Œä¸»é€»è¾‘å¤„ç†, "å¦åˆ™"çš„å…³é”®è¯æ˜¯ otherwise, ç›¸å½“äº else. ä¸»é€»è¾‘éƒ¨åˆ†ä½ åº”è¯¥ä¸€çœ¼å°±èƒ½æ˜ç™½æ˜¯ä»€ä¹ˆæ„æ€, æ ¸å¿ƒç‚¹æ˜¯è¿™ä¸ª strptime å‡½æ•°, å®ƒå…¶å®æ˜¯åœ¨å‘Šè¯‰ mtail ç”¨ä»€ä¹ˆæ—¶é—´æ ¼å¼æ¥è½¬æ¢æ—¶é—´æˆ³, ç¬¬äºŒä¸ªå‚æ•°æ˜¯ Go å†™æ³•çš„ format pattern, è¿™äº›å…¶å®éƒ½å¥½ç†è§£, æ¯”è¾ƒå®¹æ˜“æ‰å‘é‡Œçš„æ˜¯ '),t("strong",[s._v("æ—¶åŒºé—®é¢˜")]),s._v(".")]),s._v(" "),t("p",[s._v("å¦‚æœæ—¥å¿—é‡Œçš„æ—¶é—´æˆ³æ²¡æœ‰æ‰“å°æ—¶åŒºä¿¡æ¯, mtail åœ¨å¤„ç†çš„æ—¶å€™ä¼šæŠŠå®ƒä»¬ç»Ÿä¸€å½“åš UTC æ—¶é—´æ¥å¯¹å¾…, è¿™åœ¨å…¶ä»–æ—¶åŒºçš„åœºæ™¯æ˜¾ç„¶æ˜¯é”™è¯¯çš„, è¿™ä¸ªæ—¶å€™å°±è¦æ‰‹å·¥æŒ‡å®šæ—¶åŒº, æ¯”å¦‚é€šè¿‡ "),t("code",[s._v("-override_timezone=Asia/Shanghai")]),s._v("â€‹ å¯åŠ¨å‚æ•°å¯ä»¥è®© mtail ä½¿ç”¨ä¸œå…«åŒº.")]),s._v(" "),t("p",[s._v("å½“ç„¶, å¦‚æœå‹æ ¹å°±ä¸åœ¨ "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£ä¸­æš´éœ²æ—¶é—´æˆ³ä¿¡æ¯, é‚£æŠ“å–å™¨æŠ“å–æ•°æ®çš„æ—¶å€™åªèƒ½ä½¿ç”¨æŠ“å–çš„æ—¶é—´, æ—¶åŒºè¿™ä¸ªå‚æ•°æœ‰æ²¡æœ‰éƒ½æ— æ‰€è°“äº†, ä½†å¦‚æœåœ¨ "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£ä¸­è¿”å›æ—¶é—´æˆ³ä¿¡æ¯, å°±ä¸€å®šè¦åœ¨å¯åŠ¨å‚æ•°ä¸­æ§åˆ¶æ—¶åŒº, æ˜¯å¦åœ¨ "),t("code",[s._v("/metrics")]),s._v("â€‹ æ¥å£ä¸­è¿”å›æ—¶é—´æˆ³ä¿¡æ¯, ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªå¯åŠ¨å‚æ•°æ¥æ§åˆ¶çš„,  "),t("code",[s._v("emit_metric_timestamp")]),s._v("â€‹ è®¾ç½®ä¸º true çš„æ—¶å€™æ‰ä¼šè¿”å›æ—¶é—´æˆ³.")]),s._v(" "),t("p",[s._v("æœ€åè¯´ä¸€ä¸‹ mtail çš„"),t("strong",[s._v("éƒ¨ç½²")]),s._v(", å¦‚æœä¸€ä¸ªæœºå™¨ä¸Šæœ‰ 5 ä¸ªåº”ç”¨ç¨‹åºéƒ½è¦ç”¨ mtail æ¥æå–æŒ‡æ ‡, å„ä¸ªåº”ç”¨çš„æ—¥å¿—æ ¼å¼åˆä¸ä¸€æ ·, å»ºè®®å¯åŠ¨ 5 ä¸ª mtail è¿›ç¨‹åˆ†åˆ«æ¥å¤„ç†. è™½ç„¶ç®¡ç†èµ·æ¥éº»çƒ¦, ä½†æ˜¯æ€§èƒ½å¥½, ç›¸äº’ä¹‹é—´æ²¡æœ‰å½±å“.")]),s._v(" "),t("p",[s._v("å¦‚æœæŠŠæ‰€æœ‰æå–è§„åˆ™éƒ½æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹, ç„¶åé€šè¿‡å¤šæ¬¡ -logs å‚æ•°çš„æ–¹å¼åŒæ—¶æŒ‡å®šè¿™å¤šä¸ªåº”ç”¨çš„æ—¥å¿—è·¯å¾„, ä¸€ä¸ª mtail è¿›ç¨‹ä¹Ÿèƒ½å¤„ç†, ä½†æ˜¯å¯¹äºæ¯ä¸€è¡Œæ—¥å¿—, mtail è¦æŠŠæ‰€æœ‰æå–è§„åˆ™éƒ½è·‘ä¸€é, ååˆ†æµªè´¹æ€§èƒ½, è€Œä¸”æ­£åˆ™æå–, é€Ÿåº¦æœ¬æ¥å°±ä¸å¿«. å¦å¤–æœ‰äº›æŒ‡æ ‡å¯èƒ½æ˜¯æ‰€æœ‰åº”ç”¨éƒ½å¯ä»¥å¤ç”¨çš„, å¦‚æœæ”¾åœ¨ä¸€èµ·å¤„ç†, è¿˜å®¹æ˜“ç›¸äº’å¹²æ‰°, å¯¼è‡´ç»Ÿè®¡æ•°æ®ä¸å‡†. ä»è¿™ä¸¤ç‚¹æ¥çœ‹, å°½é‡è¿˜æ˜¯è¦æ‹†å¼€åˆ†åˆ«å¤„ç†, è™½ç„¶ç®¡ç†èµ·æ¥éº»çƒ¦ä¸€äº›, ä½†ä¹Ÿæ˜¯å€¼å¾—çš„.")]),s._v(" "),t("p",[s._v("åœ¨å®¹å™¨åœºæ™¯ä¸­å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜, å®¹å™¨åœºæ™¯ç›´æ¥ä½¿ç”¨ sidecar éƒ¨ç½²å°±å¥½äº†, æ¯ä¸ª Pod å¿…ç„¶åªæœ‰ä¸€ä¸ªåº”ç”¨, ä¼´ç”Ÿçš„ mtail å°±ä¸“æ³¨å»å¤„ç†è¿™ä¸ªåº”ç”¨çš„æ—¥å¿—å°±å¥½äº†.")]),s._v(" "),t("h4",{attrs:{id:"å¿«é€Ÿä¸Šæ‰‹grok-exporter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¿«é€Ÿä¸Šæ‰‹grok-exporter"}},[s._v("#")]),s._v(" å¿«é€Ÿä¸Šæ‰‹grok_exporter")]),s._v(" "),t("p",[s._v("mtail åŸºæœ¬ç”¨æ³•å°±ä»‹ç»è¿™ä¹ˆå¤š, ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æ„Ÿå—åˆ°, å¾—å†™è¿™ä¹ˆå¤šæ­£åˆ™, å¤ªéº»çƒ¦äº†. æœ‰æ²¡æœ‰ä¸€äº›å·¥å…·å¯ä»¥å¤ç”¨è¿™äº›æ­£åˆ™è¡¨è¾¾å¼å‘¢? æ¯•ç«Ÿæœ‰å¾ˆå¤šç›¸åŒçš„æ­£åˆ™éœ€æ±‚, æ²¡å¿…è¦é‡å¤é€ è½®å­. çš„ç¡®æœ‰, é™¤äº†åˆšæ‰ä»‹ç»çš„ mtail è‡ªå¸¦çš„ "),t("a",{attrs:{href:"https://github.com/google/mtail/tree/main/examples",target:"_blank",rel:"noopener noreferrer"}},[s._v("examples"),t("OutboundLink")],1),s._v(" ä¹‹å¤–, grok_exporter æŠŠæ¯ä¸ªæ­£åˆ™éƒ½æ‹†æ•£äº†, å¤ç”¨æ€§æ›´å¥½, ä¸‹é¢çœ‹ä¸€ä¸‹ grok_exporter æ˜¯å¦‚ä½•ä½¿ç”¨çš„.")]),s._v(" "),t("p",[t("strong",[s._v("grok_exporter çš„æ ¸å¿ƒé€»è¾‘å’Œ mtail ä¸€æ ·, å°±æ˜¯é€šè¿‡æ­£åˆ™ä»æ—¥å¿—ä¸­æå–æŒ‡æ ‡")]),s._v(", ä¹‹å‰å·²ç»ä»‹ç»è¿‡ mtail çš„æ ¸å¿ƒé€»è¾‘äº†, æ‰€ä»¥å…³äº grok_exporter çš„ä»‹ç»ä¼šç›¸å¯¹ç®€æ˜ä¸€äº›.")]),s._v(" "),t("p",[s._v("grok_exporter æ˜¾ç„¶æ˜¯ç”¨åˆ°äº† Grok, Grok åœ¨ logstash ä¸­è¢«é‡åº¦ä½¿ç”¨, å†…ç½®äº† 100 å¤šä¸ªé¢„å®šä¹‰çš„æ­£åˆ™(å«åš pattern), åœ¨ grok_exporter çš„ä»£ç ä»“åº“é‡Œç›´æ¥ä½œä¸º submodule çš„æ–¹å¼å¼•ç”¨äº† "),t("a",{attrs:{href:"https://github.com/logstash-plugins/logstash-patterns-core/tree/6d25c13c15f98843513f7cdc07f0fb41fbd404ef",target:"_blank",rel:"noopener noreferrer"}},[s._v("logstash-patterns-core"),t("OutboundLink")],1),s._v(", é¢„å®šä¹‰çš„æ­£åˆ™æ”¾åœ¨äº† "),t("a",{attrs:{href:"https://github.com/logstash-plugins/logstash-patterns-core/tree/6d25c13c15f98843513f7cdc07f0fb41fbd404ef/patterns",target:"_blank",rel:"noopener noreferrer"}},[s._v("patterns"),t("OutboundLink")],1),s._v(" ç›®å½•ä¸‹, å¯ä»¥ç‚¹å‡»æŸ¥é˜….")]),s._v(" "),t("p",[s._v("ä» grok_exporter çš„ "),t("a",{attrs:{href:"https://github.com/fstab/grok_exporter/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("releases"),t("OutboundLink")],1),s._v(" é¡µé¢ä¸‹è½½å‘å¸ƒåŒ…, è§£å‹ç¼©, ç›´æ¥è¿è¡Œå°±å¯ä»¥.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("./grok_exporter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config ./example/config.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("grok_exporter é»˜è®¤ç›‘å¬åœ¨ 9144 ç«¯å£, çœ‹ä¸‹è®¿é—®æµ‹è¯•æ•ˆæœ.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("flashcat@fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("02 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ curl "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s 10.100.0.7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("9144/metrics "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" head "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("n 6\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP exim_rejected_rcpt_total Total number of rejected recipients, partitioned by error message.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE exim_rejected_rcpt_total counter")]),s._v("\nexim_rejected_rcpt_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('error_message="Sender verify failed"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('logfile="exim'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rejected"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("RCPT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('examples.log"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 2000\nexim_rejected_rcpt_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('error_message="Unrouteable address"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('logfile="exim'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rejected"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("RCPT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('examples.log"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 32\nexim_rejected_rcpt_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('error_message="relay not permitted"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('logfile="exim'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rejected"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("RCPT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('examples.log"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 165\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("é€šè¿‡ä»£ç , å¯ä»¥çœ‹åˆ° grok_exporter å¯ä»¥æ­£å¸¸æ‹¿åˆ°ç›‘æ§æ•°æ®äº†. ä¸‹é¢æä¸€ä¸‹æµ‹è¯•æ•°æ®, æŠŠå®ƒæ”¾åˆ° example ç›®å½•ä¸‹, ä¿å­˜ä¸º login.log.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("12.12.2022 04"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("33"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('03 10.1.2.1 user=Ulric message="logged in"\n12.12.2022 06'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("47"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('03 10.1.2.2 user=Qin message="logged failed"\n12.12.2022 06'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("55"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('03 10.1.2.2 user=Qin message="logged in"\n12.12.2022 07'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("03"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('03 10.1.2.3 user=Sofia message="logged in"\n12.12.2022 07'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("37"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('03 10.1.2.1 user=Ulric message="logged out"\n12.12.2022 08'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("47"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('03 10.1.2.2 user=Qin message="logged out"\n12.12.2022 14'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("34"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('03 10.1.2.3 user=Sofia message="logged out"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("ä¹‹åä¿®æ”¹ config.yml æ¥è§£ælogin.log.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  config_version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("input")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" file\n  path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./example/login.log\n  readall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Read from the beginning of the file? False means we start at the end of the file and read only new lines.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" grok_patterns\n  dir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./patterns\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" counter\n  name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" user_activity\n  help"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Counter metric example with labels.\n  match"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%{DATE} %{TIME} %{HOSTNAME:instance} user=%{USER:user} message=\"%{GREEDYDATA:data}\"'")]),s._v("\n  labels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.user}}'")]),s._v("\n    logfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{base .logfile}}'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  protocol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n  port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9144")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("ä½¿ç”¨è¿™ä¸ªæ–°çš„é…ç½®æ–‡ä»¶åšä¸ªæµ‹è¯•, ä¸‹é¢æ˜¯è¿”å›å†…å®¹.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("flashcat@fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("02 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ curl "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s 10.100.0.7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("9144/metrics "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" grep user_activity\ngrok_exporter_line_processing_errors_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('metric="user_activity"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 0\ngrok_exporter_lines_matching_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('metric="user_activity"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 7\ngrok_exporter_lines_processing_time_microseconds_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('metric="user_activity"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 106\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP user_activity Counter metric example with labels.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE user_activity counter")]),s._v("\nuser_activity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('logfile="login.log"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('user="Qin"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 3\nuser_activity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('logfile="login.log"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('user="Sofia"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 2\nuser_activity"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('logfile="login.log"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('user="Ulric"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("strong",[s._v("çœ‹èµ·æ¥ grok_exporter è¦æ¯” mtail çš„æ–¹å¼æ›´æ˜“ç”¨, ä¸è¿‡å’Œ mtail ä¸€æ ·, å¦‚æœè¦å¯¹å¤šä¸ªåº”ç”¨ç¨‹åºåˆ†åˆ«è¿›è¡Œæ—¥å¿—åˆ†æå¤„ç†, å°±è¦å¯åŠ¨å¤šä¸ª grok_exporter å®ä¾‹, è¿™ç‚¹è¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿")]),s._v(". å½“ç„¶, åœ¨è¿ç®—æ–¹é¢, grok_exporter æ²¡æœ‰ mtail è¿™ç§ç±»è¯­è¨€å¼çš„å¤„ç†æ¥å¾—çµæ´»æ–¹ä¾¿. è‡³äºé€‰ç”¨å“ªä¸ª, å°ºæœ‰æ‰€çŸ­å¯¸æœ‰æ‰€é•¿, éƒ½å­¦ä¼š, å…·ä½“ä½¿ç”¨åœºæ™¯å…·ä½“å†³ç­–.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-19"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-19"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬è®²ä»‹ç»çš„æ‰‹æ®µ, ä»æ ‡é¢˜ä¸Šæ¥çœ‹æ˜¯æœåŠ¡äºåº”ç”¨ç›‘æ§, ä¸è¿‡å®é™…ä¸Šä¹Ÿå¯ä»¥ç”¨äºæ“ä½œç³»ç»Ÿ, ä¸­é—´ä»¶, æ•°æ®åº“ç­‰å…¶ä»–ç›‘æ§åœºæ™¯, è€Œåº”ç”¨ç›‘æ§æœ¬èº«, åå€’ä¸æ¨èæ—¥å¿—ç›‘æ§æ–¹å¼, è€Œæ˜¯æ›´æ¨èä¸Šä¸€è®²ä»‹ç»çš„åŸ‹ç‚¹ç›‘æ§æ–¹å¼. è¿™ä¸€ç‚¹ä¸€å®šè¦æ³¨æ„, "),t("strong",[s._v("æ¯•ç«Ÿç›¸æ¯”åŸ‹ç‚¹æ–¹å¼, æ—¥å¿—æ–¹å¼é“¾è·¯åˆé•¿, æ€§èƒ½åˆå·®, ç®—æ˜¯ä¸€ä¸ªä¸å¾—å·²è€Œä¸ºä¹‹çš„æ–¹å¼")]),s._v(".")]),s._v(" "),t("p",[s._v("æŒ‡æ ‡æå–çš„å‡ ç§æ–¹å¼, æ€»ä½“ä¸Šæ¥çœ‹å°±æ˜¯"),t("strong",[s._v("ä¸­å¿ƒç«¯å’Œæ—¥å¿—ç«¯")]),s._v("ä¸¤ç§, ç”±äºä¸­å¿ƒç«¯çš„å¤„ç†æ–¹å¼å¤šè§äºå•†ä¸šè½¯ä»¶, æ²¡æœ‰çœ‹åˆ°å¼€æºè§£å†³æ–¹æ¡ˆ, æ‰€ä»¥é‡ç‚¹ä»‹ç»çš„æ˜¯æ—¥å¿—ç«¯çš„å¤„ç†æ–¹å¼, æ—¥å¿—ç«¯çš„å¤„ç†æ ¸å¿ƒé€»è¾‘éƒ½æ˜¯ä¸€æ ·çš„, é€šè¿‡ç±»ä¼¼ "),t("code",[s._v("tail -f")]),s._v("â€‹ çš„æ–¹å¼ä¸æ–­è¯»å–æ—¥å¿—å†…å®¹, "),t("strong",[s._v("ç„¶åå¯¹æ¯è¡Œæ—¥å¿—åšæ­£åˆ™åŒ¹é…æå–, ç”±äºæ—¥å¿—æ ¼å¼ä¸å›ºå®š, å¾ˆéš¾æœ‰ç»“æ„åŒ–çš„å¤„ç†æ‰‹æ®µ, æ‰€ä»¥è¿™äº›å·¥å…·éƒ½æ˜¯é€‰æ‹©ä½¿ç”¨æ­£åˆ™çš„æ–¹å¼æ¥æå–è¿‡æ»¤æŒ‡æ ‡")]),s._v(".")]),s._v(" "),t("p",[s._v("mtail å’Œ grok_exporter æ˜¯æ—¥å¿—ç«¯å¤„ç†å·¥å…·çš„ä½¼ä½¼è€…, mtail ç›´æ¥å†™æ­£åˆ™, è™½ç„¶å¯é˜…è¯»æ€§ä¸Šç¨å¾®å·®äº†ç‚¹å„¿, ä½†æ˜¯èƒœåœ¨é€»è¾‘å¤„ç†èƒ½åŠ›, å¯ä»¥å¯¹æå–çš„å˜é‡åšè¿ç®—, å°±åƒä¸€é—¨å°è¯­è¨€, æ‰€ä»¥ mtail æŠŠè¿™äº›æå–è§„åˆ™çš„æ–‡ä»¶å«åš program. grok_exporter å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„ pattern åç§°é…ç½®åŒ¹é…è§„åˆ™, æ›´æ˜“è¯», æ˜“ç»´æŠ¤, è¿ç®—æ–¹é¢åˆ™æ˜¾å¾—ç¨å¼±.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/4704d08fdbdb7a7af28a13d906yybeaf-20230719203435-lafdp75.jpg",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"ç›‘æ§å‘Šè­¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§å‘Šè­¦"}},[s._v("#")]),s._v(" ç›‘æ§å‘Šè­¦")]),s._v(" "),t("h3",{attrs:{id:"_21-äº‹ä»¶ç®¡ç†-äº‹ä»¶é™å™ªçš„å‡ ä¸ªå…¸å‹æ‰‹æ®µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_21-äº‹ä»¶ç®¡ç†-äº‹ä»¶é™å™ªçš„å‡ ä¸ªå…¸å‹æ‰‹æ®µ"}},[s._v("#")]),s._v(" 21.äº‹ä»¶ç®¡ç†-äº‹ä»¶é™å™ªçš„å‡ ä¸ªå…¸å‹æ‰‹æ®µ")]),s._v(" "),t("p",[s._v("å‰é¢ä¸€ç« ä»‹ç»äº†å„ä¸ªéƒ¨åˆ†çš„ç›‘æ§å®æˆ˜, åé‡å¦‚ä½•é‡‡é›†æ•°æ®, å¦‚ä½•æ„å»ºä»ªè¡¨ç›˜. æœ‰äº†è¿™äº›ç›‘æ§æ•°æ®ä¹‹å, ä¸‹ä¸€æ­¥å°±æ˜¯å‘Šè­¦äº†, å‡ ä¹æ‰€æœ‰çš„ç›‘æ§ç³»ç»Ÿéƒ½å…·å¤‡ç”Ÿæˆå‘Šè­¦äº‹ä»¶çš„èƒ½åŠ›, ä½†é€šå¸¸éƒ½ä¸å…·æœ‰å®Œå¤‡çš„äº‹ä»¶åç»­å¤„ç†èƒ½åŠ›. è¿™é‡Œè¯´çš„åç»­å¤„ç†ä¸»è¦åŒ…æ‹¬: "),t("strong",[s._v("å¤šæ¸ é“åˆ†çº§é€šçŸ¥, å‘Šè­¦é™é»˜, æŠ‘åˆ¶, æ”¶æ•›èšåˆ, é™å™ª, æ’ç­, è®¤é¢†å‡çº§, ååŒé—­ç¯å¤„ç†")]),s._v("ç­‰ç­‰. ç›‘æ§ç³»ç»Ÿæˆ–å¤šæˆ–å°‘éƒ½æœ‰ä¸€äº›è¿™æ–¹é¢çš„èƒ½åŠ›, ä½†æ˜¯é€šå¸¸éƒ½ä¸å®Œå¤‡, è€Œè¿™æ­£æ˜¯ "),t("a",{attrs:{href:"https://www.pagerduty.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("PagerDuty"),t("OutboundLink")],1),s._v(" è¿™ç§äº§å“å­˜åœ¨çš„ä»·å€¼.")]),s._v(" "),t("p",[t("strong",[s._v("åœ¨äº‹ä»¶å¤„ç†æ–¹é¢, ä¸€èˆ¬ä¼šé‡åˆ°ä¸¤ä¸ªç—›ç‚¹, ä¸€ä¸ªæ˜¯å‘Šè­¦äº‹ä»¶å¤ªå¤š, è¢«è¿‡åº¦æ‰“æ‰°, å¦ä¸€ä¸ªæ˜¯é‡è¦å‘Šè­¦ç–æ¼, æ— æ³•é—­ç¯å¤„ç†")]),s._v(". è¿™ä¸ªéƒ¨åˆ†ä¼šç”¨ä¸¤è®²å†…å®¹æ¥ä»‹ç»è¿™ä¸¤ä¸ªç—›ç‚¹çš„è§£æ³•.")]),s._v(" "),t("p",[s._v("ä¸‹é¢å…ˆæ¥èŠä¸€èŠå‘Šè­¦äº‹ä»¶å¤ªå¤šçš„é—®é¢˜, çœ‹çœ‹é€šå¸¸æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦å¤ªå¤šçš„å¸¸è§åŸå› "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦å¤ªå¤šçš„å¸¸è§åŸå› "}},[s._v("#")]),s._v(" å‘Šè­¦å¤ªå¤šçš„å¸¸è§åŸå› ")]),s._v(" "),t("p",[s._v("æœ€å¸¸è§çš„åŸå› , æ˜¯ "),t("strong",[s._v("å‘Šè­¦è§„åˆ™è®¾ç½®å¾—ä¸åˆç†")]),s._v(". æ¯”å¦‚å¾ˆå¤šè§„åˆ™è§¦å‘äº†å‘Šè­¦ä¹‹å, å®é™…æ²¡æœ‰åç»­åŠ¨ä½œ, åªæ˜¯èµ·åˆ°å¸¸æ€åŒ–é€šçŸ¥çš„æ•ˆæœ, ä¸éœ€è¦æ’æŸ¥, ä¹Ÿä¸éœ€è¦æ­¢æŸ, ç”šè‡³è¿ä¸ªé•¿çº¿çš„ TODO éƒ½æ²¡æœ‰. è¿™ç±»å‘Šè­¦å¤šäº†äººå°±ç–²äº†, å½“é‡è¦çš„å‘Šè­¦æ¥ä¸´çš„æ—¶å€™, ä¹Ÿå®¹æ˜“å¿½ç•¥. è¿™æ ·çš„è§„åˆ™å¦‚æœä¸ç»è¿‡æ²»ç†, æ—¥ç§¯æœˆç´¯, å°±ä¼šäº§ç”Ÿå¾ˆå¤šæ— ç”¨çš„å‘Šè­¦.")]),s._v(" "),t("p",[s._v("ç¬¬äºŒä¸ªå¸¸è§çš„åŸå› æ˜¯ "),t("strong",[s._v("åº•å±‚å‡ºé—®é¢˜å¯¼è‡´æ‰€æœ‰çš„ä¸Šå±‚ä¾èµ–éƒ½å‘Šè­¦")]),s._v(", è¶Šæ˜¯åº•å±‚å½±å“è¶Šå¤§, æ¯”å¦‚åŸºç¡€ç½‘ç»œå¦‚æœå‡ºé—®é¢˜, å‘å‡ºå‡ ä¸‡æ¡å‘Šè­¦éƒ½æ˜¯æ­£å¸¸çš„.")]),s._v(" "),t("p",[s._v("ç¬¬ä¸‰ä¸ªåŸå› æ˜¯ "),t("strong",[s._v("æ¸ é“é”™é…")]),s._v(". ä¸€äº›ä¸é‡è¦çš„å‘Šè­¦ä¹Ÿä½¿ç”¨æ‰“æ‰°æ€§å¾ˆé«˜çš„æ¸ é“å‘å‡º, ç”¨æˆ·å¯èƒ½ä¼šè§‰å¾—å•ä¸€æ¸ é“ä¸å¯é , æƒ³ç”¨å¤šä¸ªæ¸ é“åŒæ—¶å‘é€çš„æ–¹å¼æ¥ä¿éšœå‘Šè­¦è§¦è¾¾ç‡, è¿™ä¹Ÿå±äºå‘Šè­¦è§„åˆ™é…ç½®ä¸åˆç†çš„èŒƒç•´.")]),s._v(" "),t("p",[s._v("ç¬¬å››ä¸ªåŸå› æ˜¯ "),t("strong",[s._v("é¢„æœŸå†…çš„ç»´æŠ¤åŠ¨ä½œ")]),s._v(" å¯¼è‡´çš„. æ¯”å¦‚ç¨‹åºå‡çº§å˜æ›´, å¦‚æœè¿›ç¨‹é‡å¯æ—¶é—´è¿‡é•¿, å¯èƒ½ä¼šå¯¼è‡´å…³è”çš„æœåŠ¡å‘Šè­¦, æˆ–è€…æŸä¸ªæœºå™¨é‡å¯, å¿˜è®°æå‰å±è”½äº†, ä¹Ÿä¼šäº§ç”Ÿä¸€å †å…³è”å‘Šè­¦.")]),s._v(" "),t("p",[s._v("äº†è§£äº†å¸¸è§åŸå› , ä¸‹é¢æ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›å¸¸è§è§£æ³•.")]),s._v(" "),t("h4",{attrs:{id:"ä¼˜åŒ–å‘Šè­¦è§„åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŒ–å‘Šè­¦è§„åˆ™"}},[s._v("#")]),s._v(" ä¼˜åŒ–å‘Šè­¦è§„åˆ™")]),s._v(" "),t("p",[s._v("ç±»ä¼¼ PagerDuty è¿™æ ·çš„å‘Šè­¦äº‹ä»¶ä¸­å¿ƒçš„äº§å“, ä¸€å®šç¨‹åº¦ä¸Šæ˜¯å¯ä»¥è§£å†³ä¸€äº›å‘Šè­¦è¿‡å¤šçš„é—®é¢˜, ä½†å¦‚æœèƒ½"),t("strong",[s._v("ä»å‘Šè­¦è§„åˆ™çš„æºå¤´åšå¥½ä¼˜åŒ–")]),s._v(", è‡ªç„¶æ˜¯äº‹åŠåŠŸå€. å¾ˆå¤šå…¬å¸çš„å‘Šè­¦è§„åˆ™é…ç½®æ²¡æœ‰åŸåˆ™å¯å¾ª, æ¯æ¬¡æ•…éšœå¤ç›˜å…ˆçœ‹å‘Šè­¦æ˜¯å¦æ¼æŠ¥, ä¸€çº¿å·¥ç¨‹å¸ˆä¸ºäº†ä¸èƒŒé”…, è‡ªç„¶æ˜¯å°½é‡å¤šåœ°æé«˜å‘Šè­¦è¦†ç›–é¢, ä½†è¿™ä¹ˆåšçš„åæœ, å°±æ˜¯å‘Šè­¦è¿‡å¤š, æ— æ•ˆå‘Šè­¦å å¤šæ•°, é•¿æ­¤ä»¥å¾€, å·¥ç¨‹å¸ˆç–²æƒ«ä¸å ª.")]),s._v(" "),t("p",[s._v("é‚£ä¹ˆå‘Šè­¦è§„åˆ™çš„é…ç½®åº”è¯¥éµç…§ä¸€ä¸ªä»€ä¹ˆåŸåˆ™å‘¢? è™½ç„¶æ¯ä¸ªå…¬å¸ä¸šåŠ¡ä¸åŒ, æ€»æœ‰ä¸€äº›é€šç”¨çš„åŸåˆ™å¯å¾ªå§? çš„ç¡®å¦‚æ­¤, è¿™é‡Œæˆ‘åˆ†äº«ä¸€ä¸‹ç»éªŒåšæ³•.")]),s._v(" "),t("h5",{attrs:{id:"_1-æ¯ä¸ªè§„åˆ™éƒ½åº”è¯¥å¯¹åº”å…·ä½“çš„runbook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¯ä¸ªè§„åˆ™éƒ½åº”è¯¥å¯¹åº”å…·ä½“çš„runbook"}},[s._v("#")]),s._v(" 1.æ¯ä¸ªè§„åˆ™éƒ½åº”è¯¥å¯¹åº”å…·ä½“çš„Runbook")]),s._v(" "),t("p",[s._v("Runbook å°±æ˜¯"),t("strong",[s._v("å‘Šè­¦å¤„ç†æ‰‹å†Œ")]),s._v(", ä¹Ÿå°±æ˜¯å‘Šè­¦è§¦å‘ä¹‹å, åº”è¯¥ç»†åŒ–æ’æŸ¥å“ªäº›æ–¹é¢, æŒ‰ç…§ä¸€ä¸ªä»€ä¹ˆæ–¹å¼æ‰§è¡ŒåŠ¨ä½œ, åº”è¯¥æœ‰ä¸€ä¸ªæ‰‹å†Œå‚è€ƒ. å¦‚æœå‘Šè­¦å‘ç”Ÿä¹‹åæ²¡æœ‰åç»­åŠ¨ä½œ, é‚£è¿™ä¸ªå‘Šè­¦çš„æ„ä¹‰å°±ä¸å¤§äº†. åœ¨ Nightingale çš„å‘Šè­¦è§„åˆ™é…ç½®é¡µé¢, å¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¸“é—¨çš„ Runbook é…ç½®, Grafana çš„å‘Šè­¦é…ç½®é¡µé¢, ä¹Ÿæœ‰ä¸€ä¸ª Runbook çš„é€‰é¡¹, å°±èƒ½çœ‹å‡ºä»–ä»¬å¯¹å®ƒçš„é‡è§†ç¨‹åº¦.")]),s._v(" "),t("p",[s._v("è¿™ä¸ªåŸåˆ™çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆåˆç†? ä½†æ˜¯çœŸè¦è½åœ°çš„æ—¶å€™, åˆä¼šå‘ç°ç´§æ€¥éœ€è¦å¤„ç†çš„å‘Šè­¦äº‹ä»¶é€šå¸¸å®¹æ˜“å¯¹åº” Runbook, ä½†æ˜¯æœ‰äº›å‘Šè­¦è§„åˆ™äº§ç”Ÿçš„å‘Šè­¦ç¡®å®æ²¡æœ‰é‚£ä¹ˆç´§æ€¥, æœ‰äº›åªæ˜¯æƒ³ä½œä¸ºä¸€ä¸ªé€šçŸ¥, å¥½åƒåˆç¡®å®éš¾ä»¥å¯¹åº”ä¸€ä¸ªå›ºå®šçš„ Runbook.")]),s._v(" "),t("p",[s._v("é’ˆå¯¹è¿™ä¸¤ç§æƒ…å†µ, ä¸€èˆ¬çš„åšæ³•æ˜¯: "),t("strong",[s._v("ä¸ç´§æ€¥çš„å‘Šè­¦, ä¹Ÿå¿…é¡»è¦æœ‰åŠ¨ä½œ, è™½ç„¶è¿™ä¸ªåŠ¨ä½œå¯èƒ½ä¸æ˜¯ç«‹é©¬æ‰§è¡Œå¤„ç†, ä½†è‡³å°‘è¦åˆ›å»ºä¸ªä½ä¼˜å…ˆçº§çš„å·¥å•ä¹‹ç±»çš„, æˆ–è€…æé«˜å‘Šè­¦é˜ˆå€¼, ç­‰é—®é¢˜ä¸¥é‡ä¸€äº›å†å‘Šè­¦")]),s._v('. å¯¹äºåªæ˜¯æƒ³é€šçŸ¥ä¸€ä¸‹çš„å‘Šè­¦, å…¶å®éƒ½ä¸ç®—å‘Šè­¦, åªèƒ½çœ‹åšæ˜¯ä¸€ç§å¦ç±»çš„æŠ¥è¡¨å’Œå·¡æ£€æ‰‹æ®µ, è¿™æ ·çš„ "å‘Šè­¦" å°±æŒ‰ç…§æŠ¥è¡¨å’Œå·¡æ£€çš„é€»è¾‘æ¥å¤„ç†, æ¯”å¦‚æŠŠè¿™ç±» "å‘Šè­¦" å‘åˆ°ä¸€ä¸ªå•ç‹¬çš„é‚®ä»¶ç»„æˆ–è€…å•ç‹¬çš„èŠå¤©ç¾¤ç»„, å¹³æ—¶éƒ½ä¸ç”¨å…³æ³¨, åªè¦æ¯å¤©æ—©ä¸Šä¸Šç­æˆ–æ™šä¸Šä¸‹ç­ä¹‹å‰ç¨å¾®çœ‹ä¸€çœ¼å°±è¡Œ, è¿™æ ·å°±å¯ä»¥å‡å°‘æ‰“æ‰°.')]),s._v(" "),t("p",[s._v('åˆ¶å®šäº†è¿™ä¸ªåŸåˆ™ä¹‹å, å¦‚æœå¤§å®¶ä¸éµå®ˆæ€ä¹ˆåŠå‘¢? è¿˜æ˜¯æœ‰å¾ˆå¤šå‘Šè­¦æ²¡æœ‰å¯¹åº”çš„ Runbook, ä½œä¸ºç®¡ç†äººå‘˜åº”è¯¥æ€ä¹ˆå¤„ç†? å»ºè®®æ˜¯åˆ†äº§å“çº¿ç»Ÿè®¡ä¸€ä¸ªæŒ‡æ ‡: "Runbook é¢„ç½®ç‡", å°±æ˜¯å„ä¸ªäº§å“çº¿æœ‰å¤šå°‘å‘Šè­¦è§„åˆ™é…ç½®äº† Runbook, æœ‰å¤šå°‘æ²¡æœ‰é…ç½®, è¿™ä¸ªæ¯”ä¾‹è¦ç»Ÿè®¡å‡ºæ¥, ç„¶ååšæˆçº¢é»‘æ¦œ, è®©å¤§å®¶å»æ²»ç†, æ²»ç†ä¸€æ®µæ—¶é—´ä¹‹åæœ‰ç»éªŒäº†, çŸ¥é“é¢„ç½®ç‡å¤§æ¦‚åœ¨ä¸€ä¸ªä»€ä¹ˆèŒƒå›´æ˜¯åˆç†çš„, ç„¶åå°±å¯ä»¥è¦æ±‚å¤§å®¶è‡³å°‘è¾¾åˆ°é¢„ç½®ç‡ä¸‹é™çš„å€¼. å¦åˆ™, å°±ä¸€å®šæ˜¯æœ‰é—®é¢˜çš„.')]),s._v(" "),t("p",[t("strong",[s._v("Runbook è¿™ä¸ªé…ç½®åŸåˆ™, æ˜¯æœ€ä¸ºæ¨èçš„åŸåˆ™, æ•ˆæœéå¸¸æ˜æ˜¾, å…¶æ¬¡å°±æ˜¯å‘Šè­¦åˆ†çº§åŸåˆ™.")])]),s._v(" "),t("h5",{attrs:{id:"_2-æ¯ä¸ªå‘Šè­¦éƒ½åº”è¯¥åˆç†åˆ†çº§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¯ä¸ªå‘Šè­¦éƒ½åº”è¯¥åˆç†åˆ†çº§"}},[s._v("#")]),s._v(" 2.æ¯ä¸ªå‘Šè­¦éƒ½åº”è¯¥åˆç†åˆ†çº§")]),s._v(" "),t("p",[t("strong",[s._v("åŸºæœ¬æ¯ä¸ªç›‘æ§ç³»ç»Ÿéƒ½æ”¯æŒä¸ºå‘Šè­¦è§„åˆ™é…ç½®ä¸åŒçš„çº§åˆ«, åŸºæœ¬ä¸Šæ¯ä¸ªç›‘æ§ç³»ç»Ÿçš„ç”¨æˆ·ä¹Ÿéƒ½çŸ¥é“åº”è¯¥åšåˆ†çº§å‘Šè­¦")]),s._v(". ä½†æ˜¯å…·ä½“æ€ä¹ˆåˆ†çº§, å´æ²¡æœ‰ä¸€ä¸ªè¡Œä¸šå…±è¯†, å¤§å®¶å„åšå„çš„. è¿™é‡Œåˆ†äº«ä¸€ä¸‹ä¸ªäººç†è§£, å¯ä»¥å‚è€ƒå€Ÿé‰´.")]),s._v(" "),t("p",[t("strong",[s._v("é¦–å…ˆ, ä¸åŒçº§åˆ«çš„å‘Šè­¦åº”è¯¥å¯¹åº”ä¸åŒçš„å¤„ç†é€»è¾‘, è¿™æ ·åˆ†çº§æ‰æœ‰æ„ä¹‰")]),s._v(", æ¯”å¦‚é€šçŸ¥æ¸ é“ä¸åŒ, é€šçŸ¥èŒƒå›´ä¸åŒ, æˆ–è€…ä»‹å…¥å¤„ç†çš„äººçš„èŒƒå›´ä¸åŒ, å¤„ç†æ—¶æ•ˆä¸åŒ, å¦‚æœæŸä¸¤ä¸ªçº§åˆ«å¯¹åº”å®Œå…¨ä¸€æ ·çš„å¤„ç†é€»è¾‘, å°±å¯ä»¥åˆå¹¶æˆä¸€ä¸ªçº§åˆ«.")]),s._v(" "),t("p",[s._v("é€šå¸¸çš„åšæ³•æ˜¯æŠŠå‘Šè­¦åˆ†æˆ 3 ä¸ªçº§åˆ«.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/5eabb0b2bb8bedeaa32cb18eb3935963-20230719203435-d80jp1w.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å¦å¤–, å¦‚æœ Critical çš„å‘Šè­¦è§„åˆ™å¾ˆå¤š, å¤§æ¦‚ç‡ä¹Ÿæœ‰é—®é¢˜, è¯´æ˜ç³»ç»Ÿæ¶æ„ä¸å¤Ÿé²æ£’, å‡ºç‚¹ä»€ä¹ˆäº‹éƒ½è¦ç«‹åˆ»ä»‹å…¥, ç³»ç»Ÿæ²¡æœ‰è‡ªæ„ˆèƒ½åŠ›. è¿™æ ·çš„ç³»ç»Ÿ, éœ€è¦é…å¤‡æ›´å¤šè¿ç»´äººå‘˜, è€Œä¸”è¿˜å¾ˆéš¾è·Ÿè€æ¿è®²æ¸…æ¥šä»·å€¼. æ€ä¹ˆåŠ? è¿™å°±éœ€è¦"),t("strong",[s._v("åˆ¶å®šè¿ç»´å‡†å…¥è§„åˆ™")]),s._v(", å“ªä¸ªç³»ç»Ÿè¦äº¤ç»™è¿ç»´äººå‘˜æ¥è¿ç»´, é¦–å…ˆè¦æä¾›ä¸€äº›ä¿¡æ¯.")]),s._v(" "),t("ul",[t("li",[s._v("ç›¸å…³è”ç³»äºº, å‡ºäº†é—®é¢˜èƒ½å¤ŸåŠæ—¶æ‰¾åˆ°äºº, è”ç³»ä¸ä¸Šçš„è¯å¾—èƒ½ç›´æ¥è”ç³»ç ”å‘é¢†å¯¼.")]),s._v(" "),t("li",[s._v("æœåŠ¡ç›¸å…³ä¿¡æ¯, æ¯”å¦‚ä»£ç ä»“åº“, ç³»ç»Ÿæ¶æ„, ä¾èµ–å“ªäº›æœåŠ¡, ä¾èµ–å“ªäº›ç³»ç»Ÿå‚æ•°, å“ªäº› JVM å‚æ•°, å¸¸è§é—®é¢˜è¿˜æœ‰å¤„ç†åŠæ³•ç­‰ç­‰.")])]),s._v(" "),t("p",[s._v("ç„¶åè¿›è¡Œå‡†å…¥è¯„å®¡, å¦‚æœç³»ç»Ÿæ¶æ„æœ‰æ˜æ˜¾é—®é¢˜, å°±æ²¡åŠæ³•é€šè¿‡å‡†å…¥è¦æ±‚, ä¸æ¥å—è¿ç»´, å¦‚æœè€æ¿è¦æ±‚å¿…é¡»æ¥, é‚£å°±åªèƒ½åŠ äººäº†, æˆ–è€…æ˜ç¡®è¯´æ˜åœ¨æ¶æ„è°ƒæ•´å¥½ä¹‹å‰, ä¸è´Ÿè´£ SLA. å¦‚æœè€æ¿ä¸æ¥å—æ²Ÿé€š, é‚£å°±è·³æ§½å§, è€æ¿æ ¹æœ¬ä¸æ‡‚è¿ç»´, ä¸æ‡‚ç¨³å®šæ€§è¿˜ä¸ä¿¡ä»»ä½ .")]),s._v(" "),t("p",[s._v("ä¸Šé¢ä»‹ç»çš„ä¸¤ä¸ªå‘Šè­¦è§„åˆ™ä¼˜åŒ–åŸåˆ™, æ˜¯æœ€é‡è¦çš„ä¸¤ä¸ªåŸåˆ™. ç…§åšçš„è¯, å¯ä»¥æå®šå¤§éƒ¨åˆ†æ— æ•ˆå‘Šè­¦, ä¸‹é¢å†"),t("strong",[s._v("ä»å‘Šè­¦äº§å“çš„è§’åº¦")]),s._v("æ¥çœ‹, æœ‰å“ªäº›æ‰‹æ®µå¯ä»¥è§£å†³å‘Šè­¦å¤ªå¤šçš„é—®é¢˜.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦è§„åˆ™æ”¯æŒç”Ÿæ•ˆæ—¶é—´çš„é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦è§„åˆ™æ”¯æŒç”Ÿæ•ˆæ—¶é—´çš„é…ç½®"}},[s._v("#")]),s._v(" å‘Šè­¦è§„åˆ™æ”¯æŒç”Ÿæ•ˆæ—¶é—´çš„é…ç½®")]),s._v(" "),t("p",[s._v("ä¸åŒå…¬å¸çš„ä¸šåŠ¡ç›¸å·®å¾ˆå¤§, æ¯”å¦‚åˆ¸å•†, äº¤æ˜“æ—¶é—´æ®µå†…éœ€è¦é«˜ä¼˜ä¿éšœç¨³å®šæ€§, ä½†æ˜¯éäº¤æ˜“æ—¶æ®µ, æœ‰äº›è¿›ç¨‹ç›´æ¥åœæ‰ä¹Ÿæ— æ‰€è°“. ä½†å¦‚æœæ˜¯ç›‘æ§ç³»ç»Ÿ, æ•°æ®æ˜¯æ—¶æ—¶åˆ»åˆ»éƒ½åœ¨ä¸ŠæŠ¥çš„, æ²¡æœ‰é«˜å³°ä½è°·, éœ€è¦æ—¶åˆ»ä¿è¯é«˜å¯ç”¨. å¯ä»¥çœ‹ä¸‹å…¸å‹çš„ç”Ÿæ•ˆæ—¶é—´é…ç½®, å¯ä»¥é…ç½®ä¸€å‘¨å½“ä¸­å“ªäº›å¤©ç”Ÿæ•ˆ, å“ªäº›æ—¶é—´æ®µç”Ÿæ•ˆ. å½“ç„¶æ•´ä½“æ˜¯å¦å¯ç”¨çš„å¼€å…³ä¹Ÿå¿…ä¸å¯å°‘.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/aca64e9cb797f790d41666eb53903183-20230719203435-unhnkrk.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v("å›¾ç‰‡ä¸­çš„é…ç½®å…¶å®å¯ä»¥ç»§ç»­ä¼˜åŒ–, ç°åœ¨æ˜¯åªèƒ½é…ç½®ä¸€ä¸ªæ—¶é—´æ®µ, å¦‚æœèƒ½å¤Ÿé…ç½®å¤šä¸ªæ—¶é—´æ®µå°±æ›´å¥½äº†.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦è§„åˆ™æ”¯æŒåˆ†çº§å’Œä¸åŒçš„è§¦è¾¾æ¸ é“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦è§„åˆ™æ”¯æŒåˆ†çº§å’Œä¸åŒçš„è§¦è¾¾æ¸ é“"}},[s._v("#")]),s._v(" å‘Šè­¦è§„åˆ™æ”¯æŒåˆ†çº§å’Œä¸åŒçš„è§¦è¾¾æ¸ é“")]),s._v(" "),t("p",[t("strong",[s._v("æœ‰çš„ç³»ç»Ÿä¼šæŠŠè§¦è¾¾æ¸ é“å’Œå‘Šè­¦çº§åˆ«å¼ºç»‘å®š")]),s._v(", ç”¨æˆ·åªéœ€è¦é€‰æ‹©çº§åˆ«, å°±è‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„é€šçŸ¥åª’ä»‹, æœ‰çš„ç³»ç»Ÿä¼šæŠŠäºŒè€…æ‹†å¼€, ä¸ªäººå¯¹è¿™ä¸ªæ²¡æœ‰å€¾å‘æ€§, Open-Falcon æ˜¯ç»‘å®šçš„, Nightingale æ˜¯åˆ†åˆ«é…ç½®çš„, åˆ†åˆ«é…ç½®çš„æ–¹å¼ä¼šç›¸å¯¹çµæ´»ä¸€ç‚¹.")]),s._v(" "),t("p",[t("strong",[s._v("ä¸€äº›ä½ä¼˜å…ˆçº§çš„å‘Šè­¦å°±ç”¨æ‰“æ‰°æ€§ä½çš„é€šçŸ¥åª’ä»‹æ¥é€šçŸ¥")]),s._v(", æ¯”å¦‚é‚®ä»¶, ä¸è¦ä»€ä¹ˆéƒ½æ‰“ç”µè¯å‘çŸ­ä¿¡, å¦‚æœæŸä¸ªé€šçŸ¥æ¸ é“ç»å¸¸ç”¨æ¥é€šçŸ¥ä¸€äº›ä½ä¼˜å…ˆçº§çš„å‘Šè­¦, æ—¶é—´ä¹…äº†è¿™ä¸ªé€šçŸ¥åª’ä»‹å‘å‡ºçš„å‘Šè­¦å°±ä¸è¢«é‡è§†äº†.")]),s._v(" "),t("h4",{attrs:{id:"é‡å¤å‘Šè­¦æ”¯æŒæœ€å¤§æ¬¡æ•°å’Œå‘é€é¢‘ç‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡å¤å‘Šè­¦æ”¯æŒæœ€å¤§æ¬¡æ•°å’Œå‘é€é¢‘ç‡"}},[s._v("#")]),s._v(" é‡å¤å‘Šè­¦æ”¯æŒæœ€å¤§æ¬¡æ•°å’Œå‘é€é¢‘ç‡")]),s._v(" "),t("p",[s._v("æœ‰äº›å‘Šè­¦çŸ­æ—¶é—´æ²¡æ³•æ¢å¤, å¯èƒ½ä¼šé‡å¤å‘é€. æ¯”å¦‚ä¸€åˆ†é’Ÿæ£€æŸ¥ä¸€ä¸‹æŸä¸ªæŒ‡æ ‡, å¦‚æœè¶…è¿‡é˜ˆå€¼å°±å‘Šè­¦, ä»æŸä¸ªæ—¶åˆ»å¼€å§‹, è§¦å‘äº†é˜ˆå€¼, ä¸€åˆ†é’Ÿä¹‹åå‘å‡ºç¬¬ä¸€æ¡å‘Šè­¦, ä½†æ˜¯çŸ­æ—¶é—´æ²¡æœ‰æ¢å¤, æŒç»­äº† 10 åˆ†é’Ÿ, ç›‘æ§ç³»ç»Ÿåœ¨ç¬¬äºŒåˆ†é’Ÿæ£€æŸ¥çš„æ—¶å€™å‘ç°è¿˜æ˜¯å‘Šè­¦çŠ¶æ€, å¯èƒ½è¿˜ä¼šå‘å‡ºä¸€æ¡å‘Šè­¦, ä½†æ˜¯è¿™ä¸ªå‘Šè­¦çš„é‡è¦æ€§å°±è¿œä¸å¦‚ç¬¬ä¸€æ¡, å®Œå…¨å¯ä»¥ä¸ç”¨é€šçŸ¥. é€šè¿‡è®¾ç½®å‘é€é¢‘ç‡, å¯ä»¥åšåˆ°æ¯”å¦‚ 1 å°æ—¶ä¹‹åå†æ£€æŸ¥, å¦‚æœ 1 å°æ—¶ä¹‹åè¿˜æ˜¯æ²¡æœ‰æ¢å¤, å†å‘å‡ºç¬¬äºŒæ¡å‘Šè­¦, è¿™æ ·å‘Šè­¦æ•°é‡å°±å¤§å¹…å‡å°‘äº†. å½“ç„¶, å¦‚æœå¥½å‡ å¤©æ²¡æœ‰æ¢å¤, ä¹Ÿæ²¡æœ‰å¿…è¦æ¯ä¸ªå°æ—¶å‘ä¸€æ¬¡, åº”è¯¥æ”¯æŒæœ€å¤§å‘é€æ¬¡æ•°, é™åˆ¶ä¸€ä¸‹æœªæ¢å¤ä¹‹å‰çš„é€šçŸ¥æ€»æ¬¡æ•°. æ¯”å¦‚ Nightingale å¯¹è¿™ä¸¤é¡¹çš„é…ç½®.")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2f0d3e38edb15c6606ee25b696b9b669-20230719203435-bty60r4.png",alt:"å›¾ç‰‡"}})]),s._v(" "),t("p",[s._v('çœ‹å›¾ç‰‡é‡Œè¿˜æœ‰ä¸€ä¸ªå¯ç”¨æ¢å¤é€šçŸ¥å’Œç•™è§‚æ—¶é•¿, è¿™é‡Œä¹Ÿè§£é‡Šä¸€ä¸‹, è¿™ä¹Ÿæ˜¯å‡å°‘é€šçŸ¥æ¬¡æ•°çš„å…¸å‹æ‰‹æ®µ. å‘Šè­¦ä¹‹åä¸€èˆ¬ä¼šå‘ä¸€æ¡ "Triggered" çš„æ¶ˆæ¯, å¦‚æœæ¢å¤äº†, æœ‰äº›ç”¨æˆ·ä¹Ÿå¸Œæœ›å¾—åˆ°é€šçŸ¥, è¿™ä¸ªæ—¶å€™ä¼šæ”¶åˆ°ä¸€æ¡ "Resolved" æ¶ˆæ¯. ä½†æ˜¯é‡è¦çš„å‘Šè­¦åªè¦æ”¶åˆ°äº†, ä¸€èˆ¬å°±ä¼šç«‹é©¬åˆ°å¹³å°ä¸Šå»æ’æŸ¥, æ—¢ç„¶ç”¨æˆ·å·²ç»ç™»å½•å¹³å°äº†, å‘Šè­¦æ˜¯å¦æ¢å¤å…¶å®å·²ç»å¯ä»¥åœ¨å¹³å°ä¸Šçœ‹åˆ°äº†, ä¸ç”¨å†é€šçŸ¥, æ‰€ä»¥æœ‰äº›ç”¨æˆ·å°±æŠŠ "å¯ç”¨æ¢å¤é€šçŸ¥" ç»™å…³é—­äº†, è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥å‡å°‘æ¶ˆæ¯é€šçŸ¥æ¬¡æ•°.')]),s._v(" "),t("p",[s._v("ç•™è§‚æ—¶é•¿æœ‰ç‚¹å„¿åƒæ˜¯å»çœ‹ç—…, å‘Šè­¦äº†å°±ç›¸å½“äºå¾—ç—…äº†, æ¯”å¦‚é«˜çƒ§ 39 åº¦, è§¦å‘äº†å‘Šè­¦, è¿™ä¸ªæ—¶å€™åƒåŒ»ç”Ÿä¸€æ ·è¿›è¡Œä¸€ç³»åˆ—è¯Šæ–­å’Œä¿®å¤çš„åŠ¨ä½œ, å‘ç°ä½“æ¸©é€€åˆ° 37 åº¦, è¿™ä¸ªæ—¶å€™åº”è¯¥å‡ºé™¢å—? æœ‰çš„æ—¶å€™æ˜¯ä¸è¡Œçš„, éœ€è¦è§‚å¯Ÿä¸€æ®µæ—¶é—´, ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰å†æ¬¡é«˜çƒ§å†å‡ºé™¢, è¿™å°±æ˜¯ç•™è§‚æ—¶é•¿çš„è®¾è®¡é€»è¾‘.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦äº‹ä»¶æ”¯æŒå±è”½é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦äº‹ä»¶æ”¯æŒå±è”½é…ç½®"}},[s._v("#")]),s._v(" å‘Šè­¦äº‹ä»¶æ”¯æŒå±è”½é…ç½®")]),s._v(" "),t("p",[s._v("å‘Šè­¦å±è”½ä¸€èˆ¬å°±æ˜¯åœ¨åšä¸€ä¸ªé¢„æœŸçš„ç»´æŠ¤åŠ¨ä½œä¹‹å‰, æå‰æŠŠç›¸å…³å‘Šè­¦å±è”½æ‰, å…å¾—åœ¨ç»´æŠ¤æœŸé—´åˆæ”¶åˆ°å‘Šè­¦.")]),s._v(" "),t("p",[s._v("å‘Šè­¦å±è”½ä¸€èˆ¬æœ‰ä¸¤ç§é…ç½®æ–¹å¼, ä¸€ä¸ªæ˜¯é…ç½®æˆæœªæ¥çš„ä¸€ä¸ªæ—¶é—´æ®µ, ä¸€ä¸ªæ˜¯é…ç½®æˆå‘¨æœŸæ€§æ—¶é—´æ®µ. æœªæ¥çš„ä¸€ä¸ªæ—¶é—´æ®µ, å°±æ˜¯ç”¨æ¥åº”å¯¹åˆšæ‰ä»‹ç»çš„é¢„æœŸå†…ç»´æŠ¤è¡Œä¸ºçš„, å‘¨æœŸæ€§æ—¶é—´æ®µæ¯”è¾ƒç‰¹æ®Š, æ¯”å¦‚æ¯å¤©å‡Œæ™¨ 1 ç‚¹åˆ° 5 ç‚¹ä¸éœ€è¦å‘Šè­¦, æˆ–è€…å‘¨æœ«ä¸éœ€è¦å‘Šè­¦, å°±å¯ä»¥é…ç½®æˆå‘¨æœŸæ€§å±è”½è§„åˆ™.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦äº‹ä»¶æ”¯æŒæŠ‘åˆ¶é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦äº‹ä»¶æ”¯æŒæŠ‘åˆ¶é…ç½®"}},[s._v("#")]),s._v(" å‘Šè­¦äº‹ä»¶æ”¯æŒæŠ‘åˆ¶é…ç½®")]),s._v(" "),t("p",[s._v("å‘Šè­¦æŠ‘åˆ¶çš„å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ä¸€ä¸ªæŒ‡æ ‡é…ç½®ä¸¤æ¡ç­–ç•¥, ä¸åŒçš„ä¼˜å…ˆçº§å’Œé˜ˆå€¼, å¦‚æœé«˜ä¼˜å…ˆçº§çš„å‘Šè­¦è§¦å‘äº†, ä½ä¼˜å…ˆçº§çš„å‘Šè­¦å°±è¢«æŠ‘åˆ¶, ä¸å†é‡å¤å‘é€äº†.")]),s._v(" "),t("p",[s._v("æ¯”å¦‚ç£ç›˜ä½¿ç”¨ç‡å¤§äº 88% å°±å‘ä¸€ä¸ª Warning çº§åˆ«çš„å‘Šè­¦, å¤§äº 99% åˆ™å‘ä¸€ä¸ª Critical çº§åˆ«çš„å‘Šè­¦, ç°åœ¨ç£ç›˜ä½¿ç”¨ç‡åœ¨ 85%, çªç„¶ä¸€ä¸‹å­å†™åˆ°äº† 99.1%, ç†è®ºä¸Šè¿™ä¸ªæ—¶å€™ä¸¤ä¸ªå‘Šè­¦éƒ½ä¼šè§¦å‘, ä½†æ˜¯åªå¸Œæœ›æ”¶åˆ° Critical çº§åˆ«çš„å‘Šè­¦. è¿™å°±éœ€è¦å‘Šè­¦æŠ‘åˆ¶è§„åˆ™çš„æ”¯æŒäº†.")]),s._v(" "),t("p",[s._v("æœ‰äº›ç›‘æ§ç”¨æˆ·ä¼šè¡¨è¾¾è¿™ç§éœ€æ±‚: æŸä¸ªæ ¸å¿ƒæ•°æ®åº“å‘Šè­¦äº†, ä¾èµ–è¿™ä¸ªæ ¸å¿ƒæ•°æ®åº“çš„å‘Šè­¦éƒ½ä¼šå‘å‡ºæ¥, å¸Œæœ›è¿™ä¸ªåœºæ™¯ä¹Ÿåšä¸ªæŠ‘åˆ¶, åªæ”¶åˆ°æ•°æ®åº“é‚£æ¡å‘Šè­¦, ä¸Šæ¸¸æœåŠ¡å‘Šè­¦å°±ä¸è¦å†å‘å‡ºæ¥äº†. è¿™ä¸ªéœ€æ±‚åˆç†å—?")]),s._v(" "),t("p",[s._v("æˆ‘è§‰å¾—æœ‰å¾…å•†æ¦·. æ‰€æœ‰çš„ä¸Šæ¸¸æœåŠ¡éƒ½å‘å‡ºå‘Šè­¦, è™½ç„¶å‘Šè­¦æ¶ˆæ¯å˜å¤šäº†, ä½†æ˜¯å¯ä»¥é€šè¿‡èšåˆå‘é€çš„æ–¹å¼å‡å°‘æ‰“æ‰°, ä¼—å¤šæœåŠ¡å‘Šè­¦, ä¹Ÿæ­£å¥½å¯ä»¥è®©æˆ‘ä»¬çŸ¥é“å½±å“èŒƒå›´. å¦å¤–, æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»é”™ç»¼å¤æ‚, ä¾èµ–è¿™ä¸ªæ•°æ®åº“çš„æœåŠ¡å‡ºäº†é—®é¢˜, ç¡®å®å¯èƒ½æ˜¯æ•°æ®åº“å¯¼è‡´çš„, ä½†ä¹Ÿå¯èƒ½æ˜¯å…¶ä»–ä¾èµ–å¯¼è‡´çš„, å¦‚æœè¿™ä¸ªæ—¶å€™é€šè¿‡æŠ‘åˆ¶è§„åˆ™åªå‘å‡ºæ•°æ®åº“å‘Šè­¦, å¯èƒ½å°±ä¼šå¿½ç•¥ä¸€äº›é—®é¢˜.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦äº‹ä»¶èšåˆå‘é€é€»è¾‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦äº‹ä»¶èšåˆå‘é€é€»è¾‘"}},[s._v("#")]),s._v(" å‘Šè­¦äº‹ä»¶èšåˆå‘é€é€»è¾‘")]),s._v(" "),t("p",[s._v("äº‹ä»¶é™å™ªå‘é€æœ€æœ‰æ•ˆçš„æŠ€æœ¯æ‰‹æ®µ, å…¶å®å°±æ˜¯"),t("strong",[s._v("èšåˆå‘é€")]),s._v(", èƒ½å¤Ÿèµ·åˆ°ç«‹ç«¿è§å½±çš„æ•ˆæœ. ç”¨æˆ·çš„å‘Šè­¦è§„åˆ™é…ç½®å¾—å¤ªä¹±, ç³»ç»Ÿæ˜¯æ²¡åŠæ³•å·¦å³çš„, ä½†æ˜¯çŸ­æ—¶é—´è§¦å‘å¾ˆå¤šå‘Šè­¦, ç³»ç»Ÿæ˜¯å¯ä»¥é€šè¿‡æŠ€æœ¯æ‰‹æ®µèšåˆä¹‹åå†å‘é€çš„.")]),s._v(" "),t("p",[s._v("äº‹ä»¶èšåˆä¸€èˆ¬æ˜¯æ ¹æ®ä¸¤ä¸‰ä¸ªç»´åº¦çš„ä¿¡æ¯è¿›è¡Œèšåˆè¿ç®—, æ¯”å¦‚å‘Šè­¦æ¥æ”¶è€…çš„ç»´åº¦, æ—¶é—´çš„ç»´åº¦, æŒ‡å®šçš„æŸä¸ªæ ‡ç­¾çš„ç»´åº¦(æ¯”å¦‚äº§å“çº¿), ä¹Ÿå¯èƒ½ä¸æŒ‡å®šèšåˆæ ‡ç­¾, åªä½¿ç”¨æ¥æ”¶è€…ç»´åº¦å’Œæ—¶é—´ç»´åº¦, è¿™æ ·èšåˆç‡ä¼šæ›´é«˜. ä»€ä¹ˆæ„æ€å‘¢, ä¸¾ä¸ªä¾‹å­.")]),s._v(" "),t("p",[s._v("å¼ ä¸‰åŒå­¦, åœ¨ä¸€åˆ†é’Ÿå†…, æ”¶åˆ° 10 æ¡ Kafka å‘Šè­¦, 10 æ¡ Elasticsearch å‘Šè­¦. å¦‚æœåªæŒ‰ç…§æ¥æ”¶è€…ç»´åº¦å’Œæ—¶é—´ç»´åº¦èšåˆ, å°±å¯ä»¥æŠŠè¿™ 20 æ¡å‘Šè­¦èšåˆæˆ 1 æ¡é€šçŸ¥å¼ ä¸‰, é€šçŸ¥æ¶ˆæ¯å¯èƒ½æ˜¯è¿™ä¹ˆå†™çš„.")]),s._v(" "),t("blockquote",[t("p",[s._v("å¼ ä¸‰æ‚¨å¥½, æœ€è¿‘ä¸€åˆ†é’Ÿæ‚¨æœ‰ 20 æ¡å‘Šè­¦, æœ€é«˜çº§åˆ«æ˜¯ Warning, ç›¸å…³å‘Šè­¦ä¸¾ä¾‹:")]),s._v(" "),t("p",[s._v("10.2.3.4 Kafka æœ‰ç›®å½• Offline")]),s._v(" "),t("p",[s._v("10.2.3.5 Kafka æœ‰ç›®å½• Offline")]),s._v(" "),t("p",[s._v("10.2.3.6 ElasticSearch æµé‡è¿‡å¤§")]),s._v(" "),t("p",[s._v("æ›´å¤šè¯¦ç»†å‘Šè­¦ä¿¡æ¯, è¯·ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹")])]),s._v(" "),t("p",[s._v("å¦‚æœæŠŠäº§å“ç»´åº¦ä¹ŸåŠ ä¸Š, è¿™ 20 æ¡å‘Šè­¦å°±ä¼šèšåˆæˆ 2 æ¡, 1 æ¡æŠ¥çš„æ˜¯ Kafka, 1 æ¡æŠ¥çš„æ˜¯ Elasticsearch. æ‰€æœ‰èšåˆå‘é€çš„äº‹ä»¶ä¸­å¿ƒå¤§éƒ½æ˜¯ç±»ä¼¼çš„é€»è¾‘, å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®æ–‡æœ¬ç›¸ä¼¼æ€§ä¹‹ç±»çš„åšèšåˆ.")]),s._v(" "),t("p",[s._v("å¦å¤–ä¹Ÿå¯ä»¥å¢åŠ æ›´å¤šç»´åº¦æ¥èšåˆ. é‚£æ€ä¹ˆåšæ‰æ˜¯æœ€ä½³å®è·µå‘¢?")]),s._v(" "),t("p",[s._v("åˆ†äº«ä¸€ä¸‹ä¸ªäººçœ‹æ³•: ä»å‘Šè­¦èšåˆé€šçŸ¥è§’åº¦æ¥çœ‹, åªæ ¹æ®"),t("strong",[s._v("æ¥æ”¶äººå’Œæ—¶é—´")]),s._v("ä¸¤ä¸ªç»´åº¦åšèšåˆå°±å¤Ÿäº†, è¿™æ ·çš„èšåˆç‡æœ€é«˜, è¢«æ‰“æ‰°çš„æ¬¡æ•°æœ€å°‘. è™½ç„¶ä¼šæŠŠå¤šç§å‘Šè­¦æ¶ˆæ¯æ··æ‚åœ¨ä¸€èµ·é€šçŸ¥ç»™ç”¨æˆ·, æ˜¾å¾—æœ‰äº›æ··ä¹±, ä½†æ˜¯ç”¨æˆ·ä¸€èˆ¬ä¹Ÿä¸ä¼šåœ¨çŸ­ä¿¡, é‚®ä»¶, å³æ—¶é€šä¿¡è½¯ä»¶é‡ŒæœŸå¾…åˆ†é—¨åˆ«ç±»çš„äº‹ä»¶æŸ¥çœ‹æ•ˆæœ. æƒ³è¦æ›´å¥½çš„æŸ¥çœ‹æ•ˆæœ, å¯ä»¥å»é¡µé¢ä¸Šçœ‹, é¡µé¢ä¸Šæœ‰æ›´å¤§çš„æ“ä½œåŒº, æƒ³æ€ä¹ˆèšåˆå°±æ€ä¹ˆèšåˆ, æƒ³æ€ä¹ˆçœ‹å°±æ€ä¹ˆçœ‹. å‘Šè­¦éƒ½å·²ç»å‘ç”Ÿäº†, å¤§æ¦‚ç‡æ˜¯è¦æ‰“å¼€ç”µè„‘å¤„ç†çš„, éƒ½å·²ç»æ‰“å¼€ç”µè„‘äº†, åœ¨é¡µé¢ä¸ŠæŸ¥çœ‹ä¸€ä¸‹ä¹Ÿæ˜¯é¡ºå…¶è‡ªç„¶çš„.")]),s._v(" "),t("p",[s._v("é’ˆå¯¹å‘Šè­¦äº‹ä»¶å¤ªå¤šçš„é—®é¢˜, ä¸»è¦å°±æ˜¯ä¸Šé¢è¿™äº›è§£å†³åŠæ³•. å¸‚é¢ä¸Šçš„å¼€æºäº§å“, åªæœ‰ Prometheus ç”Ÿæ€çš„ Alertmanager åšå¾—ç›¸å¯¹å®Œå¤‡ä¸€ç‚¹, ä½†æ˜¯ä¹Ÿä¸å…·å¤‡ä¸Šé¢è¯´çš„æ‰€æœ‰çš„èƒ½åŠ›. ä¸»è¦æ˜¯ç›‘æ§ç³»ç»Ÿçš„é‡å¿ƒ, å¤§éƒ½æ”¾åˆ°äº†æ•°æ®é‡‡é›†, æ•°æ®å­˜å‚¨, å‘Šè­¦è§¦å‘å¼•æ“ä¸Šé¢äº†, å¯¹äºå‘Šè­¦å‘é€è¿™å—, å…³æ³¨ç›¸å¯¹æ¯”è¾ƒå°‘. è€Œä¸”, å‘Šè­¦å‘é€æ˜¯ä¸ªé€šç”¨éœ€æ±‚, Zabbix éœ€è¦, Prometheus éœ€è¦, Open-Falcon, Nightingale, å„ç±»äº‘ç›‘æ§å…¶å®éƒ½éœ€è¦, åšä¸€ä¸ªç»Ÿä¸€çš„äº§å“å¯¹æ¥æ‰€æœ‰è¿™äº›äº‹ä»¶æº, æ˜¯ä¸ªæ›´åˆç†çš„åšæ³•.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-20"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-20"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("å‘Šè­¦äº‹ä»¶å¤ªå¤šçš„å¸¸è§åŸå› , åŒ…æ‹¬å‘Šè­¦è§„åˆ™è®¾ç½®ä¸åˆç†, åº•å±‚æœåŠ¡å‘Šè­¦å¯¼è‡´ä¸Šæ¸¸å¤§é‡å‘Šè­¦, æ¸ é“é”™é…, é¢„æœŸå†…ç»´æŠ¤ç­‰å‡ ç±». å¯¹äºæ€ä¹ˆæ”¹è¿›è¿™äº›é—®é¢˜, æœ€æ¨èçš„æ–¹å¼æ˜¯ä¼˜åŒ–å‘Šè­¦è§„åˆ™, æå®šé—®é¢˜æºå¤´, è¿™éœ€è¦ä¾èµ–ä¸€äº›åŸåˆ™, å…¸å‹çš„åŸåˆ™æœ‰ä¸¤ä¸ª, ä¸€æ˜¯è¦æ±‚æ‰€æœ‰çš„å‘Šè­¦éƒ½æœ‰ Runbook, äºŒæ˜¯è¦æ±‚åˆ†çº§åˆç†. å¯¹äºå‘Šè­¦è§„åˆ™, è¿˜è¦æ³¨æ„ç”Ÿæ•ˆæ—¶é—´çš„é…ç½®, å‘é€é¢‘ç‡, æœ€å¤§å‘é€æ¬¡æ•°çš„é…ç½®. å¯¹äºå‘Šè­¦äº‹ä»¶, è¦åšå¥½é¢„å…ˆå±è”½, æŠ‘åˆ¶, å¯¹äºæœ€åäº§ç”Ÿçš„å‘Šè­¦, è¦åšåˆ°èšåˆå‘é€, å‡å°‘æ‰“æ‰°.")]),s._v(" "),t("p",[s._v("å¦å¤–æ‰€æœ‰çš„å‘Šè­¦äº‹ä»¶, å»ºè®®éƒ½è¦æŒä¹…åŒ–ä¿å­˜, è‡³å°‘ä¿å­˜å‡ ä¸ªæœˆ. é€šè¿‡è¿™äº›å†å²èµ„æ–™, å¯ä»¥åˆ†æå‡ºå¾ˆå¤šä¿¡æ¯, æ¯”å¦‚å“ªä¸ªå›¢é˜Ÿæ¥æ”¶å‘Šè­¦æœ€å¤š, å“ªä¸ªå‘Šè­¦è§„åˆ™å‘å‡ºçš„å‘Šè­¦æœ€å¤š, å“ªäº›å‘Šè­¦é•¿æ—¶é—´éƒ½æ²¡æœ‰æ¢å¤, å¹³å‡å‘Šè­¦æ¢å¤æ—¶é•¿æ˜¯å¤šå°‘, å¯ä»¥æ ¹æ®è¿™äº›æ•°æ®åšå‘Šè­¦ä¼˜åŒ–.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/b61c5f7e372e5bc4fd0833de5ba06d35-20230719203435-s8edbw2.jpg",alt:""}}),s._v("â€‹")]),s._v(" "),t("h3",{attrs:{id:"_22-äº‹ä»¶ç®¡ç†-å¦‚ä½•ä¿è¯äº‹ä»¶çš„é—­ç¯å¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_22-äº‹ä»¶ç®¡ç†-å¦‚ä½•ä¿è¯äº‹ä»¶çš„é—­ç¯å¤„ç†"}},[s._v("#")]),s._v(" 22.äº‹ä»¶ç®¡ç†-å¦‚ä½•ä¿è¯äº‹ä»¶çš„é—­ç¯å¤„ç†?")]),s._v(" "),t("p",[s._v("ä¸Šä¸€è®²ä»‹ç»äº†äº‹ä»¶é™å™ªçš„å‡ ä¸ªå…¸å‹æ‰‹æ®µ, å…¶å®å°±æ˜¯æ€ä¹ˆè®©å‘Šè­¦å‘å¾—å°‘ç‚¹å„¿. æœ¬èŠ‚ä»‹ç»äº‹ä»¶é—­ç¯ç®¡ç†, å°±æ˜¯å‘Šè­¦å‘å‡ºæ¥å¾—æœ‰äººå¤„ç†, æ‰€è°“çš„é—­ç¯, å°±æ˜¯æŒ‡"),t("strong",[s._v("å‘Šè­¦å‘å‡º, è®¤é¢†, åä½œå¤„ç†, é—®é¢˜æ¢å¤, å¤ç›˜æ”¹è¿›")]),s._v("çš„æ•´ä¸ªè¿‡ç¨‹.")]),s._v(" "),t("p",[s._v("è™½ç„¶äº‹ä»¶é™å™ªçš„å‡ ä¸ªæ‰‹æ®µè½å®ä¹‹å, äº‹ä»¶æ•°é‡ç¡®å®å˜å°‘äº†, ä½†æ˜¯å¤„ç†å‘Šè­¦äº‹ä»¶æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªè®©äººæ„‰å¿«çš„äº‹æƒ…, ä¸æ„‰å¿«çš„äº‹æƒ…å°±è¦å›¢é˜Ÿå…±æ‹…, æ‰€ä»¥ç¬¬ä¸€ä¸ªæ‰‹æ®µå°±æ˜¯æ’ç­, ä¸“äººåšä¸“äº‹.")]),s._v(" "),t("h4",{attrs:{id:"æ’ç­-ä¸“äººåšä¸“äº‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ’ç­-ä¸“äººåšä¸“äº‹"}},[s._v("#")]),s._v(" æ’ç­,ä¸“äººåšä¸“äº‹")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ‰‹æ®µå¬èµ·æ¥å¹¶ä¸é«˜å¤§ä¸Š, ä½†ç¡®å®éå¸¸æœ‰æ•ˆ. å€¼ç­æœŸé—´è™½ç„¶æå¿ƒåŠèƒ†çš„, ç”Ÿæ€•èƒŒé”…, ä½†å› ä¸ºæ˜¯è½®ç­åˆ¶, å¿ƒé‡Œæ€»æœ‰ä¸ªç›¼å¤´, æŒºè¿‡è¿™ä¸ªå‘¨æœŸå°±å¥½äº†.")]),s._v(" "),t("p",[s._v("è½®ç­çš„äººåœ¨å€¼ç­æœŸé—´æ˜¯ç¬¬ä¸€è´£ä»»äºº, ä¼šæ‹¿å‡º 120% çš„ç²¾åŠ›æ¥å¤„ç†é—®é¢˜, è´£ä»»åˆ°äººæ˜¾ç„¶æ›´å®¹æ˜“æ¨è¿›é—®é¢˜è§£å†³, å…¶ä»–ä¸å€¼ç­çš„äººåˆ™å¯ä»¥å¿ƒæ— æ—éª›åœ°åšä¸€äº›é•¿çº¿çš„äº‹æƒ…, ä¸è‡³äºæ€»æ˜¯è¢«å‘Šè­¦æ‰“æ–­.")]),s._v(" "),t("p",[s._v("æ’ç­ç³»ç»Ÿé€šå¸¸ä¸å¼€æº, é€šå¸¸æ˜¯ä½œä¸ºäº‹ä»¶ä¸­å¿ƒçš„ä¸€ä¸ªåŠŸèƒ½, PagerDuty å°±æä¾›äº†æ’ç­èƒ½åŠ›, å³ä½¿æ²¡æœ‰ç³»ç»Ÿæ”¯æŒ, ä¹Ÿå»ºè®®äººä¸ºåˆ¶å®šä¸€ä¸ªæ’ç­è¡¨, æŠŠè¿™ä¸ªåˆ¶åº¦è½å®ä¸‹å», å¯¹å‘Šè­¦é—­ç¯å¤„ç†ä¹Ÿä¼šæœ‰å¾ˆå¤§å¸®åŠ©.")]),s._v(" "),t("p",[s._v("å€¼ç­äººå‘˜åœ¨å€¼ç­æœŸé—´, è™½ç„¶å·²ç»é«˜åº¦é‡è§†äº†, ä½†ä¹Ÿéš¾å…ç–æ¼, è¿™å°±éœ€è¦å‘Šè­¦å‡çº§æœºåˆ¶äº†.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦å‡çº§æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦å‡çº§æœºåˆ¶"}},[s._v("#")]),s._v(" å‘Šè­¦å‡çº§æœºåˆ¶")]),s._v(" "),t("p",[s._v("å‘Šè­¦å‡çº§æ˜¯æŒ‡åœ¨ç¬¬ä¸€è´£ä»»äººæ”¶åˆ°å‘Šè­¦ä¹‹åæ²¡æœ‰åŠæ—¶å“åº”, ç„¶åç³»ç»Ÿè‡ªåŠ¨é€šçŸ¥äºŒçº¿, ä¸‰çº¿äººå‘˜çš„ä¸€ç§æœºåˆ¶. ä¸€çº¿äººå‘˜æ²¡æœ‰åŠæ—¶å“åº”çš„åŸå› å¯èƒ½æœ‰å¾ˆå¤š, æ¯”å¦‚æ‰‹æœºé™éŸ³äº†æ²¡æœ‰å¬åˆ°, æ™šä¸Šç¡ç€äº†, æˆ–è€…ä¸´æ—¶å‡ºå»æœ‰äº‹å¿˜å¸¦æ‰‹æœºäº†ç­‰ç­‰. è¿™ä¸ªæ—¶å€™ç³»ç»Ÿå‘ç°æŸä¸ªå‘Šè­¦ä¸€ç›´æ²¡æœ‰æ¢å¤, ä¹Ÿæ²¡æœ‰è¢«è®¤é¢†, ä¸€æ®µæ—¶é—´ä¹‹å, å°±åº”è¯¥é€šçŸ¥å€¼ç­äººå‘˜çš„é¢†å¯¼æˆ–è€…äºŒçº¿å¤‡ä»½äººå‘˜, å¦‚æœäºŒçº¿äººå‘˜ä¹Ÿè¿Ÿè¿Ÿæ²¡æœ‰å“åº”, å°±åº”è¯¥ç»§ç»­å¾€ä¸Šå‡çº§.")]),s._v(" "),t("p",[s._v('å‘Šè­¦å‡çº§æœºåˆ¶éœ€è¦è®¤é¢†åŠŸèƒ½çš„é…åˆ, ä¹Ÿå°±æ˜¯ä¸€çº¿äººå‘˜æ”¶åˆ°å‘Šè­¦ä¹‹åè¦é€šè¿‡æŸç§æœºåˆ¶å‘Šè¯‰ç³»ç»Ÿ: "æˆ‘å·²çŸ¥æ™“å‘Šè­¦, ç°åœ¨æˆ‘å¼€å§‹å¤„ç†äº†, ä½ ä¸è¦å‡çº§äº†". å…¸å‹çš„è®¤é¢†åŠŸèƒ½ä¸€èˆ¬æ˜¯åšåœ¨é¡µé¢ä¸Šçš„, å‘Šè­¦åæ‰“å¼€å‘Šè­¦äº‹ä»¶ç®¡ç†ä¸­å¿ƒ, é€‰ä¸­ç›¸å…³å‘Šè­¦ä¸€é”®è®¤é¢†, ä¹Ÿå¯ä»¥é€šè¿‡ä¸Šè¡ŒçŸ­ä¿¡æˆ–å³æ—¶é€šè®¯å·¥å…·ä¸­çš„ä¸Šè¡Œå›è°ƒæœºåˆ¶æ¥å®Œæˆ.')]),s._v(" "),t("p",[s._v("å‡çº§æœºåˆ¶ä¼šç»™å€¼ç­äººå‘˜å¾ˆå¤§çš„å‹åŠ›, æ¯•ç«Ÿè°ä¹Ÿä¸æƒ³ç¨ä¸ç•™ç¥å°±æŠŠç”µè¯æ‰“åˆ°è€æ¿é‚£é‡Œ, æ‰€ä»¥ä¸€èˆ¬åªæœ‰ä¸¥é‡çš„å‘Šè­¦æ‰ä¼šå¯ç”¨å‡çº§æœºåˆ¶, è­¦å‘Šæˆ–è€…é€šçŸ¥æ€§è´¨çš„å‘Šè­¦éƒ½ä¸ç”¨å¯ç”¨å‡çº§æœºåˆ¶. å½“ç„¶, è¿™ä¸ªè§„èŒƒæ€ä¹ˆå®š, å„ä¸ªå›¢é˜Ÿå¯ä»¥è‡ªè¡Œå•†å®š.")]),s._v(" "),t("p",[s._v("é€šè¿‡æ’ç­, è®¤é¢†, å‡çº§è¿™äº›æœºåˆ¶, å¯ä»¥ç¡®ä¿å‘Šè­¦é€’è¾¾æŒ‡å®šçš„äºº, ä½†è¦å¤„ç†å‘Šè­¦çš„è¯, åªæœ‰å€¼ç­äººå‘˜è‡ªå·±å°±æœªå¿…æå¾—å®šäº†, éœ€è¦æœ‰ååŒæœºåˆ¶æŠŠç›¸å…³äººéƒ½æ‹‰è¿›æ¥ä¸€èµ·å¤„ç†æ‰å¯ä»¥. å¯¹äºæŸä¸ªæ•…éšœ, å¯èƒ½åŒæ—¶æœ‰å¤šä¸ªå‘Šè­¦äº‹ä»¶äº§ç”Ÿ, å¤§å®¶åŸºäºä¸€ä¸ªç»Ÿä¸€çš„æ•…éšœååŒ, è€Œä¸æ˜¯åŸºäºä¸€å †äº‹ä»¶åˆ†åˆ«ååŒ, è¿™å°±éœ€è¦æŠŠè¿™å¤šä¸ªäº‹ä»¶æ”¶æ•›æˆä¸€ä¸ªæ•…éšœ, ä¸‹é¢æˆ‘ä»¬æ¥èŠä¸€ä¸‹è¿™ä¸ªæ”¶æ•›é€»è¾‘.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦æ”¶æ•›é€»è¾‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦æ”¶æ•›é€»è¾‘"}},[s._v("#")]),s._v(" å‘Šè­¦æ”¶æ•›é€»è¾‘")]),s._v(" "),t("p",[s._v("ä¸€èˆ¬æ”¶æ•›é€»è¾‘æ˜¯ä¸‰çº§æ”¶æ•›, event -> alert -> incident. ä¸¾ä¸ªä¾‹å­, æœ€åŸå§‹çš„å‘Šè­¦äº‹ä»¶, æ¯”å¦‚ host1 åœ¨ timestamp1 äº§ç”Ÿäº†ä¸€æ¡ cpu_usage_idle çš„å‘Šè­¦, æˆ‘ä»¬ç§°ä¸ºä¸€ä¸ª event. å¦‚æœæ²¡æœ‰æ¢å¤, ä¸€æ®µæ—¶é—´ä¹‹å, æ¯”å¦‚ timestamp1 + 60min, ä¸€èˆ¬ä¼šå†å‘å‡ºä¸€ä¸ªå‘Šè­¦, è¿˜æ˜¯ host1, è¿˜æ˜¯ cpu_usage_idle è¿™ä¸ªæŒ‡æ ‡. å¾ˆæ˜æ˜¾, è¿™ä¸¤ä¸ªå‘Šè­¦äº‹ä»¶æ˜¯æœ‰å…³è”å…³ç³»çš„, æŒ‡ä»£çš„æ˜¯ä¸€ä¸ªé—®é¢˜, åªæ˜¯æ—¶é—´æˆ³ä¸åŒ, è¿™æ ·çš„ä¸¤ä¸ª event, å°±å¯ä»¥æ”¶æ•›ä¸ºä¸€ä¸ª alert.")]),s._v(" "),t("p",[s._v("ä»å®ç°ä¸Šæ¥è¯´, "),t("strong",[s._v("å‘Šè­¦ç­–ç•¥(ä¹Ÿç§°å‘Šè­¦è§„åˆ™) + æŒ‡æ ‡æ ‡ç­¾é›†çš„å“ˆå¸Œå€¼")]),s._v(', å¯ä»¥ä½œä¸º alert çš„å”¯ä¸€æ ‡è¯†. æ¯”å¦‚åˆšæ‰çš„ä¾‹å­, å‘Šè­¦ç­–ç•¥çš„ ID å‡è®¾ä¸º 32, æ ‡ç­¾é›†æ˜¯: ["name =cpu_usage_idle", "host=host1"], è¿™ä¸¤ä¸ªæ—¶é—´æˆ³äº§ç”Ÿçš„å‘Šè­¦äº‹ä»¶, å“ˆå¸Œå€¼éƒ½æ˜¯ä¸€æ ·çš„.')]),s._v(" "),t("p",[s._v("è®¡ç®—æ–¹æ³•æ˜¯:")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("hash(32 + "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__name__=cpu_usage_idle"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host=host1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(")\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ä» event åˆ° alert çš„è¿™ä¸ªæ”¶æ•›é€»è¾‘, å«åšä¸€çº§æ”¶æ•›. åªæœ‰è¿™ä¸ªæ”¶æ•›é€»è¾‘è¿˜ä¸å¤Ÿ, å‘Šè­¦ä¿¡æ¯è¿˜æ˜¯æ¯”è¾ƒæ•£, ä¸å¥½åŸºäºè¿™äº›æ•£ä¹±çš„å‘Šè­¦åˆ†åˆ«åšååŒ, æŠŠå¤šä¸ª alert æ”¶æ•›æˆä¸€ä¸ª incident(æ•…éšœ), åŸºäº incident åšååŒæ‰æ¯”è¾ƒæ–¹ä¾¿. ä½†æ˜¯, event åˆ° alert æ˜¯æœ‰ä¸€ä¸ªå›ºå®šçš„æ”¶æ•›é€»è¾‘çš„, å¯ä»¥é€šè¿‡ç¨‹åºè‡ªåŠ¨æ”¶æ•›, è€Œ alert åˆ° incident å´å¾ˆéš¾è‡ªåŠ¨æ”¶æ•›. ä¸è¿‡ä¸šç•Œä¹Ÿä¼šæœ‰ä¸€äº›å¸¸è§çš„åšæ³•, ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­.")]),s._v(" "),t("blockquote",[t("p",[s._v("æ ¹æ®æ—¶é—´åšæ”¶æ•›")])]),s._v(" "),t("p",[s._v("æŠŠå‘Šè­¦ä¸­å¿ƒæ”¶åˆ°çš„æ‰€æœ‰å‘Šè­¦, æŒ‰ç…§æ—¶é—´ç»´åº¦åšæ”¶æ•›, æ¯”å¦‚æŒ‰ç…§åˆ†é’Ÿé¢—ç²’åº¦, ä¸€åˆ†é’Ÿå†…æ‰€æœ‰å‘Šè­¦æ”¶æ•›æˆä¸€ä¸ªæ•…éšœ, ä¸‹ä¸€åˆ†é’Ÿæ‰€æœ‰å‘Šè­¦æ”¶æ•›æˆå¦ä¸€ä¸ªæ•…éšœ. æ˜¾ç„¶, ä¸€ä¸ªæ•…éšœå†…çš„å¤šä¸ªå‘Šè­¦ç›¸äº’ä¹‹é—´å¯èƒ½æ²¡æœ‰å…³è”å…³ç³», æ‰€ä»¥è¿™ç§æ”¶æ•›æ–¹æ³•ä¸æ˜¯å¤ªå¥½.")]),s._v(" "),t("blockquote",[t("p",[s._v("æ ¹æ®æ—¶é—´+æ ‡ç­¾åšæ”¶æ•›")])]),s._v(" "),t("p",[s._v("é™¤äº†æ—¶é—´ç»´åº¦, å†åŠ ä¸ŠæŸä¸ªæ ‡ç­¾ä½œä¸ºæ”¶æ•›ç»´åº¦, æ¯”å¦‚æœºå™¨æ ‡ç­¾, æŸä¸ªæ—¶é—´æ®µå†…æ‰€æœ‰ A æœºå™¨çš„å‘Šè­¦æ”¶æ•›æˆä¸€ä¸ªæ•…éšœ, æ‰€æœ‰ B æœºå™¨çš„å‘Šè­¦æ”¶æ•›æˆå¦ä¸€ä¸ªæ•…éšœ. æˆ–è€…æŒ‰ç…§æœåŠ¡ç»´åº¦, æŸä¸ªæ—¶é—´æ®µå†…æ‰€æœ‰ A æœåŠ¡çš„å‘Šè­¦æ”¶æ•›æˆä¸€ä¸ªæ•…éšœ, æ‰€æœ‰ B æœåŠ¡çš„å‘Šè­¦æ”¶æ•›æˆå¦ä¸€ä¸ªæ•…éšœ. çœ‹èµ·æ¥æ•ˆæœå¥½å¤šäº†, ä¸è¿‡è¿˜æ˜¯æ²¡åŠæ³•å’Œç°å®ä¸­çš„å‘Šè­¦å’Œæ•…éšœå»ºç«‹å®Œç¾çš„å¯¹åº”å…³ç³».")]),s._v(" "),t("blockquote",[t("p",[s._v("æ ¹æ®æ—¶é—´+æ–‡æœ¬ç›¸ä¼¼åº¦åšæ”¶æ•›")])]),s._v(" "),t("p",[s._v("æ–‡æœ¬ç›¸ä¼¼åº¦éœ€è¦å¼•å…¥ç®—æ³•, ä½†æ˜¯ç®—æ³•æ€»å¾—æœ‰ä¸ªè§„å¾‹, å¾ˆæƒ³æŠŠæŸä¸ªæ•…éšœç›¸å…³çš„å‘Šè­¦èšæ‹¢åˆ°ä¸€èµ·, ä½†æ˜¯æ˜¾ç„¶, å¾ˆéš¾æœ‰ä¸ªè¡Œä¹‹æœ‰æ•ˆçš„è§„å¾‹, æ²¡æœ‰è§„å¾‹çš„ç®—æ³•æ•ˆæœè‡ªç„¶å¥½ä¸åˆ°å“ªå„¿å».")]),s._v(" "),t("p",[s._v("æ—¢ç„¶æ²¡åŠæ³•æŠŠå‘Šè­¦è‡ªåŠ¨æ”¶æ•›æˆæ•…éšœ, é‚£å°±æ‰‹å·¥æ¥åš. ä¸€ä¸ªæ•…éšœå…³è”çš„å…³é”®å‘Šè­¦, è¿˜æ˜¯ç›¸å¯¹å®¹æ˜“åŒºåˆ†çš„, åªè¦æŠŠå…³é”®å‘Šè­¦å…³è”åˆ°æ•…éšœ, åç»­åŸºäºè¿™ä¸ªæ•…éšœåšååŒå°±å¯ä»¥äº†. æ‰€è°“ååŒ, ä¸€ä¸ªæ˜¯ä¿¡æ¯åŒæ­¥, ååŒå¤„ç†, ä¸€ä¸ªæ˜¯å…±åŒå¤ç›˜, ç®¡ç†è·Ÿè¿›é¡¹.")]),s._v(" "),t("h4",{attrs:{id:"æ•…éšœååŒå¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ•…éšœååŒå¤„ç†"}},[s._v("#")]),s._v(" æ•…éšœååŒå¤„ç†")]),s._v(" "),t("p",[s._v("é¦–å…ˆ, å¹¶ä¸æ˜¯æ‰€æœ‰çš„å‘Šè­¦éƒ½éœ€è¦å‡çº§æˆæ•…éšœååŒå¤„ç†. ä¸€èˆ¬æ¥è®², å¦‚æœå‘Šè­¦å¯ä»¥è¢«å€¼ç­äººå‘˜ç›´æ¥å¤„ç†æ‰, å¯¹åˆ«çš„å›¢é˜Ÿè´Ÿè´£çš„æœåŠ¡æ²¡æœ‰å½±å“, ä¸éœ€è¦é€šçŸ¥åˆ«çš„å›¢é˜Ÿ, é€šå¸¸æ˜¯ä¸éœ€è¦å‡çº§æˆæ•…éšœçš„, åœ¨å‘Šè­¦å±‚é¢æ¥ååŒå°±å¯ä»¥äº†, è‡ªå·±å›¢é˜Ÿå†…éƒ¨æ¶ˆåŒ–æ‰; å¦‚æœå€¼ç­äººå‘˜å’Œä»–æ‰€åœ¨çš„å›¢é˜Ÿæ²¡åŠæ³•ç‹¬è‡ªå¤„ç†å‘Šè­¦, æ‰éœ€è¦å‡çº§æˆæ•…éšœ, æ‹‰å…¶ä»–å›¢é˜Ÿçš„äººè¿›æ¥ä¸€èµ·å¤„ç†.")]),s._v(" "),t("p",[s._v("å¤šä¸ªå›¢é˜Ÿå…±åŒå¤„ç†ä¸€ä¸ªæ•…éšœ, ä¸åŒå›¢é˜Ÿçš„äººä¼šå‘ç°ä¸€äº›ä¸åŒçš„çº¿ç´¢, éœ€è¦åŠæ—¶åŒæ­¥ç»™æ‰€æœ‰ç›¸å…³çš„äºº, è¿™ä¸ªæ—¶å€™å°±å¯ä»¥åœ¨æ•…éšœä¸‹é¢æ·»åŠ è¯„è®º, å…¶ä»–äººå°±å¯ä»¥åŠæ—¶çœ‹åˆ°. ç­‰åˆ°æ­¢æŸä¹‹å, å¤§å®¶è¿˜è¦æ ¹æ®æ•…éšœæ—¶é—´çº¿å¤ç›˜, äº§å‡ºä¸€ç³»åˆ—è·Ÿè¿›é¡¹, è¿™ä¸ªæ—¶å€™å°±éœ€è¦è¿™ä¸ªæ•…éšœç®¡ç†æ¨¡å—å…·å¤‡è·Ÿè¿›é¡¹ç®¡ç†çš„åŠŸèƒ½, æˆ–è€…è‡³å°‘èƒ½å¤Ÿè·Ÿä»»åŠ¡ç®¡ç†ç³»ç»Ÿè‰¯å¥½æ‰“é€š.")]),s._v(" "),t("p",[s._v("æœ‰äº†è¿™æ ·ä¸€ä¸ªæ•…éšœååŒçš„æœºåˆ¶ä¹‹å, æ•…éšœè¢«å¤„ç†æ‰çš„æ¦‚ç‡å°±å¤§å¹…æå‡äº†, åç»­å†é…åˆä¸€äº›è¿è¥ç»Ÿè®¡æ‰‹æ®µ, ç»Ÿè®¡å„ä¸ªå›¢é˜Ÿçš„å¹³å‡æ•…éšœæ­¢æŸæ—¶é—´, å»ºç«‹çº¢é»‘æ¦œ, å¤§å®¶å°±ä¼šæœ‰æ›´é«˜çš„çƒ­æƒ…æ¥å¤„ç†æ•…éšœ. å½“ç„¶, äººçš„çƒ­æƒ…å†é«˜, ä¹Ÿä¸å¦‚æœºå™¨æ¥å¾—å¿«, å¦‚æœæœ‰äº›å‘Šè­¦èƒ½å¤Ÿç›´æ¥å…³è”è‡ªåŠ¨åŒ–å¤„ç†é€»è¾‘, æ— ç–‘å¯ä»¥å¤§å¤§å¢åŠ äº‹ä»¶é—­ç¯ç‡.")]),s._v(" "),t("h4",{attrs:{id:"å‘Šè­¦è‡ªåŠ¨å¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‘Šè­¦è‡ªåŠ¨å¤„ç†"}},[s._v("#")]),s._v(" å‘Šè­¦è‡ªåŠ¨å¤„ç†")]),s._v(" "),t("p",[s._v("å¾ˆå¤šç›‘æ§ç³»ç»Ÿéƒ½å¯ä»¥é…ç½® Webhook, å½“å‘Šè­¦è§¦å‘ä¹‹åè‡ªåŠ¨å›è°ƒæŸä¸ª HTTP æ¥å£, æ¥ä¸²è”ä¸€äº›è‡ªåŠ¨åŒ–çš„é€»è¾‘, è®©å‘Šè­¦äº‹ä»¶æ— äººå€¼å®ˆè‡ªåŠ¨å¤„ç†. æ¯”å¦‚æŸä¸ªæœºæˆ¿çš„æŸä¸ªæœåŠ¡æŒ‚æ‰äº†, Webhook çš„é€»è¾‘æ˜¯è‡ªåŠ¨è°ƒç”¨åˆ‡æµçš„æ¥å£, æŠŠæœåŠ¡æµé‡åˆ‡èµ°, è¿™æ ·æ¥è¾¾åˆ°æ­¢æŸçš„ç›®çš„.")]),s._v(" "),t("p",[s._v("ä¸è¿‡å¯¹äºå¾ˆå¤šè¿ç»´å·¥ç¨‹å¸ˆæ¥è¯´, å†™ä¸€ä¸ª HTTP æ¥å£è¿˜æ˜¯æœ‰ç‚¹å„¿éº»çƒ¦, å¦‚æœå¯ä»¥åœ¨å‘Šè­¦ä¹‹åç›´æ¥è°ƒç”¨ä¸€ä¸ªè„šæœ¬, åœ¨è¿™ä¸ªè„šæœ¬é‡Œå†™è‡ªæ„ˆé€»è¾‘å°±å¥½äº†. Nightingale å°±å¯ä»¥è¿™ä¹ˆå¹², é…åˆ ibex æ¨¡å—, å¯ä»¥åœ¨å‘Šè­¦çš„æ—¶å€™è‡ªåŠ¨å»å‘Šè­¦çš„æœºå™¨ä¸Šè·‘ä¸ªè„šæœ¬, æ¯”å¦‚ç£ç›˜æ»¡äº†è‡ªåŠ¨è·‘ä¸ªè„šæœ¬æ¸…ç†ä¸€ä¸‹æ— ç”¨çš„æ—¥å¿—, åªè¦åœ¨å‘Šè­¦è§„åˆ™çš„å›è°ƒåœ°å€é‡Œé…ç½®ç±»ä¼¼ "),t("code",[s._v("${ibex}/35")]),s._v("â€‹ çš„ä¿¡æ¯å°±å¯ä»¥äº†.")]),s._v(" "),t("p",[s._v("â€‹"),t("code",[s._v("${ibex}/35")]),s._v("â€‹ å°±è¡¨ç¤ºå‘Šè­¦è§¦å‘ä¹‹åè‡ªåŠ¨æ‰§è¡Œ ID ä¸º 35 çš„è‡ªæ„ˆè„šæœ¬, é»˜è®¤åœ¨å‘Šè­¦çš„æœºå™¨ä¸Šæ‰§è¡Œ. å¦‚æœæƒ³åˆ°å›ºå®šçš„æœºå™¨ä¸Šæ‰§è¡Œ, æ¯”å¦‚å»æŸä¸ªä¸­æ§æœºä¸Šæ‰§è¡Œ, åªéœ€è¦æŠŠæœºå™¨æ ‡è¯†ä¿¡æ¯æ‹¼æ¥åˆ° URL åé¢, æ¯”å¦‚ "),t("code",[s._v("${ibex}/35/cloud-center01.bj")]),s._v("â€‹.")]),s._v(" "),t("p",[s._v("æ–°ç‰ˆæœ¬çš„ Categraf å·²ç»å†…ç½®äº† ibex-agent, ä¸ç”¨å†å•ç‹¬å®‰è£…ä»»åŠ¡æ‰§è¡Œçš„ agent äº†, åªè¦åœ¨æœåŠ¡ç«¯å•ç‹¬éƒ¨ç½² ibex-server æ¨¡å—, å’Œ n9e-server ååŒæ‰“é€šå³å¯, éå¸¸ç®€å•.")]),s._v(" "),t("p",[s._v("å¦å¤–, å‘Šè­¦è‡ªåŠ¨å¤„ç†çš„è¿™æ®µé€»è¾‘, æœªå¿…ä¸€å®šèƒ½å¤Ÿåšåˆ°å‘Šè­¦è‡ªæ„ˆ, æœ‰çš„æ—¶å€™åªæ˜¯ä½¿ç”¨è¿™ä¸ªæœºåˆ¶æ¥æŠ“ç°åœº, ä¹Ÿæ˜¯éå¸¸æœ‰ä»·å€¼çš„. æ¯”å¦‚æŸä¸ªè¿›ç¨‹æŒ‚æ‰äº†, åœ¨æŒ‚æ‰çš„æ—¶å€™æˆ‘æƒ³çŸ¥é“å½“æ—¶æœºå™¨çš„ä¸€äº›è¿è¡Œæƒ…å†µ, æ¯”å¦‚å„é¡¹èµ„æºçš„å ç”¨æƒ…å†µ, ç³»ç»Ÿæ—¥å¿—çš„ä¿¡æ¯ç­‰ç­‰, æˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©å‘Šè­¦è‡ªåŠ¨å¤„ç†çš„è¿™ä¸ªæ–¹å¼, æ¥è‡ªåŠ¨è·‘ä¸ªè„šæœ¬æŠ“å–å½“æ—¶æœºå™¨ä¸Šçš„ä¸€äº›ç°åœºä¿¡æ¯, ç›¸æ¯”æ”¶åˆ°å‘Šè­¦ä¹‹åæ‰‹å·¥ç™»å½•æœºå™¨æŸ¥çœ‹è¦é«˜æ•ˆå¾—å¤š.")]),s._v(" "),t("h4",{attrs:{id:"å°ç»“-21"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“-21"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚ä¸»è¦æƒ³è§£å†³ä¸€ä¸ªé—®é¢˜, å°±æ˜¯å‘Šè­¦äº‹ä»¶å‘å‡ºä¹‹å, æ€ä¹ˆä¿è¯ä¸€å®šæœ‰äººè·Ÿè¿›å¤„ç†, è€Œä¸”æ˜¯å¾ˆå¿«åœ°è·Ÿè¿›. é¦–å…ˆæ˜¯é€šè¿‡æ’ç­è¿™ä¸ªåç®¡ç†çš„æ‰‹æ®µè®©å¤§å®¶å…±åŒæ‰¿æ‹…ä¸€ä¸ªä¸é‚£ä¹ˆè®©äººæ„‰å¿«çš„äº‹æƒ…, ä¸ºäº†ä¿è¯å€¼ç­äººå‘˜èƒ½åŠæ—¶å“åº”, å¼•å…¥äº† "),t("strong",[s._v("å‘Šè­¦å‡çº§é€šçŸ¥æœºåˆ¶")]),s._v(". ç¡®ä¿äº‹ä»¶æœ‰äººè®¤é¢†ä¹‹å, å°±ç›¸å½“äºç¡®ç«‹äº†äº‹ä»¶çš„è·Ÿè¿›è´Ÿè´£äºº, åŒ…äº§åˆ°æˆ·äº†, é‚£åé¢çš„äº‹æƒ…æ¨è¿›èµ·æ¥å°±å¿«å¾—å¤šäº†.")]),s._v(" "),t("p",[s._v("å‘Šè­¦äº‹ä»¶çš„è·Ÿè¿›è´Ÿè´£äººå¦‚æœå¯ä»¥å¤„ç†æ¶ˆåŒ–æ‰ç›¸å…³çš„å‘Šè­¦, é‚£æ˜¯å†å¥½ä¸è¿‡. å¦‚æœä»–ä¸ªäººå’Œå›¢é˜Ÿæ²¡åŠæ³•ç‹¬è‡ªå¤„ç†, å°±éœ€è¦æ‹‰æ›´å¤šçš„äººè¿›æ¥äº†. å¤§å®¶åŸºäºä¸€ä¸ªç»Ÿä¸€çš„æ•…éšœååŒæœºåˆ¶ä¸€èµ·æ’æŸ¥, æ•…éšœæ˜¯ä¸€ä¸ªåŒ…å«äº†å¤šæ¡å‘Šè­¦çš„å®ä½“, å¤§å®¶åœ¨è¿™ä¸ªæ•…éšœä¸‹é€šè¿‡è¯„è®ºçš„æ–¹å¼å‘è¡¨çœ‹æ³•, æä¾›çº¿ç´¢, æ­¢æŸä¹‹åè¿˜è¦å¤ç›˜, äº§å‡ºæ•…éšœå¯¹åº”çš„æœªæ¥æ”¹è¿›é¡¹.")]),s._v(" "),t("p",[s._v("æ­¤å¤–, è¿˜æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ç­–ç•¥â€”â€” "),t("strong",[s._v("å‘Šè­¦è‡ªåŠ¨å¤„ç†æœºåˆ¶")]),s._v(", ä¸€èˆ¬é€šè¿‡ Webhook æ¥å®ç°, Nightingale åˆ™æ›´è¿›ä¸€æ­¥, å†…ç½®å‘Šè­¦è‡ªæ„ˆè„šæœ¬çš„ç®¡ç†, å¯ä»¥å’Œ ibex æ‰“é€šåšåˆ°å‘Šè­¦çš„æ—¶å€™è‡ªåŠ¨å»æœºå™¨ä¸Šè·‘ä¸ªè„šæœ¬.")]),s._v(" "),t("p",[s._v("æœ¬èŠ‚çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹:")]),s._v(" "),t("p",[s._v("â€‹"),t("img",{attrs:{src:"/img/1289b2583a4d718b064d1f746a98857e-20230719203435-wzmexl1.jpg",alt:""}}),s._v("â€‹")]),s._v(" "),t("h2",{attrs:{id:"ç»“æŸè¯­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“æŸè¯­"}},[s._v("#")]),s._v(" ç»“æŸè¯­")]),s._v(" "),t("h3",{attrs:{id:"_23-å¼±æ°´ä¸‰åƒ-åªå–ä¸€ç“¢é¥®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_23-å¼±æ°´ä¸‰åƒ-åªå–ä¸€ç“¢é¥®"}},[s._v("#")]),s._v(" 23.å¼±æ°´ä¸‰åƒ,åªå–ä¸€ç“¢é¥®")]),s._v(" "),t("h4",{attrs:{id:"æœ¯ä¸šæœ‰ä¸“æ”»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœ¯ä¸šæœ‰ä¸“æ”»"}},[s._v("#")]),s._v(" æœ¯ä¸šæœ‰ä¸“æ”»")]),s._v(" "),t("p",[s._v("ä¸è¦æƒ³ç€è¿™ä¹Ÿè¦å­¦å¥½é‚£ä¹Ÿè¦æå®š, å»çœ‹ä¸€ä¸‹å¤§å‚çš„æ‹›è˜è¦æ±‚, "),t("strong",[s._v("å…¨éƒ½æ˜¯è¦ä¸“æ‰, è€Œä¸æ˜¯ä»€ä¹ˆéƒ½ç¨€æ¾å¹³å¸¸çš„é€šæ‰")]),s._v(". è¯•æƒ³ä¸€ä¸‹, ä¸€ä¸ªå¯¹ Kafka æœ‰æºç çº§æŒæ§åŠ›çš„æŠ€æœ¯ä¸“å®¶, å’Œä¸€ä¸ªå£°ç§°è‡ªå·±æ—¢æ‡‚ Java, Python, åˆæ‡‚ Kafka, Elasticsearch, è¿˜æ‡‚ Kubernetes, H5, Android å¼€å‘çš„å…¨æ‰, å“ªä¸€ä¸ªä¼šæ›´å€¼é’±?")]),s._v(" "),t("p",[s._v("å›æƒ³æˆ‘å¤§å­¦çš„ç¬¬ä¸€ä¸ªå¯’å‡, å»å›¾ä¹¦é¦†å€Ÿäº†å¾ˆå¤šä¹¦, Java å¼€å‘ç›¸å…³çš„, .NET å¼€å‘ç›¸å…³çš„, ç”šè‡³è¿˜æœ‰è®¡ç®—æœºç¡¬ä»¶, Photoshop, Word çš„ä¹¦, ä½†è´ªå¤šåš¼ä¸çƒ‚, å¾ˆå¤šæˆ‘éƒ½åªæ˜¯æ³›æ³›åœ°è¯»äº†è¯», æœ€åè„‘å­é‡Œä»€ä¹ˆéƒ½æ²¡æœ‰å‰©ä¸‹, æƒ³æ¥å½“æ—¶ç¡®å®æ˜¯æœ‰äº›å¤©çœŸ.")]),s._v(" "),t("p",[s._v("æŠ€æœ¯ç»†åˆ†é¢†åŸŸå¤ªå¤šäº†, åˆ°åº•é€‰æ‹©å“ªä¸ªæ–¹å‘æ·±è€•å‘¢? ä¸€å¥è¯æ¦‚æ‹¬:  "),t("strong",[s._v("è¦é€‰æ‹©æœ‰å¤åˆ©æ•ˆåº”ä¸”å¤©èŠ±æ¿é«˜çš„é¢†åŸŸ")]),s._v(". å¤åˆ©æ•ˆåº”æ˜¯è¯´ä½ åœ¨è¿™ä¸ªé¢†åŸŸé‡Œç»éªŒè¶Šä¸°å¯Œ, å°±è¶Šèƒ½æ‹¿åˆ°å¥½çš„ç»“æœ, è€Œå¤©èŠ±æ¿é«˜, æ˜¯è¯´è¿™ä¸ªé¢†åŸŸé‡Œçš„ç»éªŒå°‘çš„æ–°äººå¾ˆéš¾åœ¨çŸ­çŸ­å‡ å¹´ä¹‹å†…å°±å–ä»£ç»éªŒä¸°å¯Œçš„è€äºº, ä¿—ç§°è¶Šè€è¶Šåƒé¦™.")]),s._v(" "),t("p",[s._v("é€‰å¥½æ–¹å‘ä¹‹å, å¦‚ä½•æ›´å¿«åœ°æˆé•¿å°±æ˜¯æ¥ä¸‹æ¥è¦é‡ç‚¹æ€è€ƒçš„é—®é¢˜äº†. ä½ åº”è¯¥è§è¿‡åŒæ ·å·¥ä½œ 6 å¹´çš„äºº, ä¸€ä¸ªP9, è€Œå¦ä¸€ä¸ªå´æ˜¯ P6 å§?")]),s._v(" "),t("h4",{attrs:{id:"æˆé•¿è®²æ±‚æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æˆé•¿è®²æ±‚æ–¹æ³•"}},[s._v("#")]),s._v(" æˆé•¿è®²æ±‚æ–¹æ³•")]),s._v(" "),t("p",[t("strong",[s._v("æœ‰äº›äººå£°ç§°æœ‰ 5 å¹´çš„ç»éªŒ, å…¶å®åªæœ‰ 1 å¹´çš„ç»éªŒ, é‡å¤ç”¨äº† 5 å¹´; æœ‰äº›äººæ¯å¤©å¿™å¿™ç¢Œç¢Œè§£å†³ç”Ÿäº§é—®é¢˜, é˜…è¯», ç¼–å†™å¤§é‡ä»£ç , å­¦ä¹ é¢†åŸŸå¤§å’–çš„å„ç§å¸ƒé“åˆ†äº«, ç»éªŒè¹­è¹­åœ°æ¶¨, å·¥ä½œ 2 å¹´å¯èƒ½å°±èƒ½è¾¾åˆ°æ™®é€šäººå·¥ä½œ 5 å¹´æ‰æœ‰çš„æ°´å¹³.")])]),s._v(" "),t("p",[s._v("æ‰€åœ¨çš„å›¢é˜Ÿä¸åŒ, é¡¹ç›®ä¸åŒ, ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“ä¸ªäººçš„æˆé•¿, ä¸è¿‡è¿™äº›å¤–éƒ¨å› ç´ å¤§æ¦‚åªèƒ½å†³å®š 20%, 80% éƒ½æ˜¯ç”±ä¸ªäººçš„åŠªåŠ›ç¨‹åº¦å’Œå­¦ä¹ æ–¹æ³•å†³å®šçš„. æ­£æ‰€è°“æ–¹å‘ä¸å¯¹, åŠªåŠ›ç™½è´¹, æ–¹æ³•ä¸è¡Œ, å•¥éƒ½ä¸çµ. è¿™é‡Œæ€»ç»“äº†å‡ æ¡è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•, åˆ†äº«ç»™ä½ , å¸Œæœ›å¯¹ä½ æœ‰äº›å¯å‘.")]),s._v(" "),t("blockquote",[t("p",[s._v("ä¼˜å…ˆæ‰“ç£¨å·¥ä½œä¸­ç”¨å¾—åˆ°çš„æŠ€æœ¯, ç”¨ä¸åˆ°çš„æŠ€æœ¯å­¦äº†ä¹Ÿå®¹æ˜“å¿˜è®°")])]),s._v(" "),t("p",[s._v("è®¡ç®—æœºå®é™…æ˜¯ä¸€é—¨å·¥ç§‘, æ‰€è°“å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´, çƒ‚ç¬”å¤´ä¸å¦‚åŠ¨æ‰‹å®æ“. ä½ ç†Ÿæ‚‰çš„é‚£ä¸ªè¯­è¨€çš„æ¡ä»¶è¯­å¥å’Œå¾ªç¯è¯­å¥, åº”è¯¥éƒ½å†™å¾—å¾ˆæºœå§? ä½†ä½  N å¹´å‰å­¦ä¹ çš„ PL/SQL çš„å­˜å‚¨è¿‡ç¨‹, ä¸çŸ¥é“æ˜¯å¦è¿˜èƒ½å†™å‡º hello world. è¿™äº›æ·¡å¿˜çš„æŠ€æœ¯å¤§éƒ½æ˜¯å·¥ä½œä¸­ç”¨ä¸åˆ°çš„æŠ€æœ¯, æŠ›å´äº†ä¹ŸæŒºå¥½, é‡ç‚¹å­¦ä¹ å·¥ä½œä¸­ç”¨å¾—åˆ°çš„æŠ€æœ¯, ä»¥åŠè¿™äº›æŠ€æœ¯çš„å»¶å±•çŸ¥è¯†, æ—¢èƒ½è§£å†³å·¥ä½œä¸­çš„é—®é¢˜, åˆèƒ½å¿«é€Ÿæå‡æŠ€æœ¯èƒ½åŠ›, è€Œä¸”è¿˜è®°å¾—ç‰¢, ä¸€ä¸¾å¤šå¾—!")]),s._v(" "),t("blockquote",[t("p",[s._v("å…è´¹çš„æ‰æ˜¯æœ€è´µçš„, èŠ‚çœæ—¶é—´çš„æ‰æ˜¯æœ€ä¾¿å®œçš„")])]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™å¥è¯, ä½ å¯èƒ½ä¼šæƒ³: â€œä½ å‡ºè¯¾ç¨‹è‚¯å®šä¼šæ¨èçŸ¥è¯†ä»˜è´¹å•¦! â€æœ¬æ¥æˆ‘ä¸æƒ³å†™è¿™ä¸€æ¡, å°±æ˜¯æ‹…å¿ƒå¼•èµ·ä¸å¿…è¦çš„å£æ°´æˆ˜. ä¸è¿‡åœ¨æˆ‘å®é™…çš„å†™ä½œè¿‡ç¨‹ä¸­, è¿™ä¸€ç‚¹è®©æˆ‘æ·±æœ‰ä½“ä¼š, æ‰€ä»¥ä¸åä¸å¿«. å› ä¸ºæˆ‘å†™æ–‡ç« è¦æŸ¥é˜…å¤§é‡çŸ¥è¯†, åœ¨æœé›†èµ„æ–™çš„è¿‡ç¨‹ä¸­, æˆ‘å‘ç°ä»˜è´¹çŸ¥è¯†çš„æ°´å‡†æ™®éæ¯”å…è´¹çš„é«˜å‡ºä¸€å¤§æˆª. å¾ˆå¤šçŸ¥è¯†æŸ¥ä¸€å‘¨æŸ¥ä¸å‡ºä¸ªæ‰€ä»¥ç„¶, èŠ±ä¸€å¤©æ—¶é—´æŸ¥æŸ¥ç”µå­ä¹¦, æŸ¥æŸ¥ä¸“æ , å°±èƒ½ç”¨æ›´å°‘çš„æ—¶é—´å¾—åˆ°æ›´ä½“ç³»åŒ–çš„çŸ¥è¯†, å…¶å®è¿™æ‰æ˜¯æˆ‘ä»¬éœ€è¦çš„.")]),s._v(" "),t("p",[s._v("äººç”ŸçŸ­çŸ­ä¸‰ä¸‡å¤©, å­¦ä¹ è¿™ä¸ªäº‹, è¿˜æ˜¯è¦è®²ç©¶æ•ˆç‡çš„. ç›¸æ¯”ä»˜å‡ºçš„æ—¶é—´æˆæœ¬, é‚£å‡ ç™¾å—çŸ¥è¯†çš„è´¹ç”¨, çœŸçš„æ˜¯æ¯›æ¯›é›¨.")]),s._v(" "),t("blockquote",[t("p",[s._v("è‡ªä»¥ä¸ºä¼šçš„ä¸ä¸€å®šçœŸä¼š, èƒ½è®²å‡ºæ¥çš„çŸ¥è¯†æ‰æ˜¯è‡ªå·±çš„")])]),s._v(" "),t("p",[s._v("æ‰€è°“å°ä¸Šä¸€åˆ†é’Ÿå°ä¸‹åå¹´åŠŸ, æ‡‚å¾— 10 åˆ†å¯èƒ½åªèƒ½è®²æ¸…æ¥š 2 åˆ†, åªæ‡‚ 2 åˆ†åˆ™ 1 åˆ†éƒ½è®²ä¸æ¸…æ¥š. æ‰€ä»¥å¦‚æœæœ‰äººå‘ä½ æé—®, é‚£å°±æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è¾“å‡ºæœºä¼š, å³ä½¿ä½ ç­”ä¸ä¸Šæ¥ä¹Ÿæ²¡æœ‰å…³ç³», å› ä¸ºè¿™äº›é—®é¢˜æ˜¯ä½ è‡ªå·±çš„çŸ¥è¯†ç›²åŒº, è§£å†³è¿™äº›é—®é¢˜èƒ½å¤Ÿè®©ä½ æˆé•¿å¾—æ›´å¿«.")]),s._v(" "),t("blockquote",[t("p",[s._v("æ—¶é—´ä¸€å®šæ˜¯æœ‰çš„, å…³é”®çœ‹ä½ æœ‰å¤šå°‘çƒ­æƒ…")])]),s._v(" "),t("p",[s._v("è™½ç„¶æˆ‘ä»¬å·²ç»æ•²å®šäº†ä¸€ä¸ªç»†åˆ†é¢†åŸŸ, ä½†æ˜¯ä»ç„¶æœ‰å¾ˆå¤šçŸ¥è¯†è¦å­¦, æ˜¯ä¸æ˜¯æ„Ÿè§‰å­¦ä¸è¿‡æ¥? å¦‚æœä½ ç¡®å®æœ‰è¿™ç§æ„Ÿå—, è¯´æ˜ä½ çš„çƒ­æƒ…è¿˜æ²¡æœ‰å®Œå…¨æ¿€å‘å‡ºå‘. æ‰“æ¸¸æˆ, çœ‹å°è¯´å¯ä»¥åˆ°å‡Œæ™¨ 1 ç‚¹è€Œä¸è§‰å¾—ç´¯, å­¦ä¹ æ€ä¹ˆå°±ä¸è¡Œå‘¢? 14 å¹´æˆ‘ä»¬å†™ Open-Falcon é‚£ä¼šå„¿, ç»å¸¸æ˜¯å·¥ä½œ 5 å¤©, å‘¨æœ« 2 å¤©æ‹¿æ¥é‡æ„ä»£ç , ä¸‹å‘¨ç»§ç»­å†™æ–°åŠŸèƒ½, å®Œå…¨ä¸è§‰å¾—ç´¯, é‚£ç§å·¨å¤§çš„çƒ­æƒ…, è®©ä¸€åˆ‡çš†æœ‰å¯èƒ½.")]),s._v(" "),t("blockquote",[t("p",[s._v("ç«™åœ¨é«˜ä¸€ä¸ªå±‚çº§æ€è€ƒé—®é¢˜, æŠŠè‡ªå·±å½“ä½œé¡¹ç›®è´Ÿè´£äºº")])]),s._v(" "),t("p",[t("strong",[s._v("è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¥‡æ‹›, éå¸¸æœ‰ç”¨. å½“æŠŠè‡ªå·±çš„ä½ç½®æ‘†é«˜, è§†é‡è‡ªç„¶å°±ä¸ä¸€æ ·äº†, ç«™åœ¨å…¨å±€æ€è€ƒ, å°±æ˜¯ä¼šè€ƒè™‘å¾—æ›´å…¨é¢")]),s._v(". æ¯”å¦‚ä¸€ä¸ªå‰åç«¯åˆä½œå¼€å‘çš„é¡¹ç›®, ä¸€èˆ¬æ˜¯åç«¯äººå‘˜å‡ºæ¥å£æ–‡æ¡£, ç„¶åç»™å‰ç«¯äººå‘˜è®²è§£äº§å“è®¾è®¡å’Œæ¥å£è®¾è®¡, å¯ä»¥ç»Ÿè®¡è¿™ç±»é¡¹ç›®çš„ Bug ç‡, ä¸€èˆ¬å‰ç«¯ Bug ç‡ä¼šæ›´é«˜, åŸå› å¾ˆå®¹æ˜“ç†è§£, åç«¯äººå‘˜å¿ƒé‡Œè£…ç€å…¨å±€, è€ƒè™‘å¾—ä¼šæ›´å‘¨å…¨, è€Œè¿™ä¸ªå‘¨å…¨çš„æ€è€ƒä¸å¯èƒ½ 100% ä¼ è¾¾ç»™å‰ç«¯, æ‰€ä»¥å‰ç«¯å¦‚æœä¸èƒ½ä¸»åŠ¨æ€è€ƒ, å°±å®¹æ˜“å‡ºçº°æ¼.")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")]),s._v(" "),t("p",[s._v("â€")])])}),[],!1,null,null,null);t.default=e.exports}}]);