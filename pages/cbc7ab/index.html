<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL优化 | Pangolin</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="大道至简">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.76d9f797.css" as="style"><link rel="preload" href="/assets/js/app.5bc2c979.js" as="script"><link rel="preload" href="/assets/js/2.eccd4273.js" as="script"><link rel="preload" href="/assets/js/181.b4744ee7.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8038d8.js"><link rel="prefetch" href="/assets/js/100.db890b43.js"><link rel="prefetch" href="/assets/js/101.9b9a913e.js"><link rel="prefetch" href="/assets/js/102.b98098b4.js"><link rel="prefetch" href="/assets/js/103.20eafae5.js"><link rel="prefetch" href="/assets/js/104.5f942f86.js"><link rel="prefetch" href="/assets/js/105.a443c173.js"><link rel="prefetch" href="/assets/js/106.6530e112.js"><link rel="prefetch" href="/assets/js/107.7b05a1d1.js"><link rel="prefetch" href="/assets/js/108.8c45adc4.js"><link rel="prefetch" href="/assets/js/109.ea29e43c.js"><link rel="prefetch" href="/assets/js/11.8d2b228f.js"><link rel="prefetch" href="/assets/js/110.0765054b.js"><link rel="prefetch" href="/assets/js/111.ae06b85d.js"><link rel="prefetch" href="/assets/js/112.b27bb80e.js"><link rel="prefetch" href="/assets/js/113.592e5b3f.js"><link rel="prefetch" href="/assets/js/114.677c3c60.js"><link rel="prefetch" href="/assets/js/115.fb35062d.js"><link rel="prefetch" href="/assets/js/116.19de2d57.js"><link rel="prefetch" href="/assets/js/117.ac783334.js"><link rel="prefetch" href="/assets/js/118.06b27dd3.js"><link rel="prefetch" href="/assets/js/119.cf6bb932.js"><link rel="prefetch" href="/assets/js/12.8764d408.js"><link rel="prefetch" href="/assets/js/120.ba8e09a5.js"><link rel="prefetch" href="/assets/js/121.bc501a72.js"><link rel="prefetch" href="/assets/js/122.c9a3dd47.js"><link rel="prefetch" href="/assets/js/123.b474c20b.js"><link rel="prefetch" href="/assets/js/124.f405a8c5.js"><link rel="prefetch" href="/assets/js/125.24083f67.js"><link rel="prefetch" href="/assets/js/126.3c5c6c33.js"><link rel="prefetch" href="/assets/js/127.b561056f.js"><link rel="prefetch" href="/assets/js/128.58891fb1.js"><link rel="prefetch" href="/assets/js/129.5073fbfd.js"><link rel="prefetch" href="/assets/js/13.1034e1a1.js"><link rel="prefetch" href="/assets/js/130.ca12ca1d.js"><link rel="prefetch" href="/assets/js/131.8e520e7f.js"><link rel="prefetch" href="/assets/js/132.0f186ee2.js"><link rel="prefetch" href="/assets/js/133.1d8479f7.js"><link rel="prefetch" href="/assets/js/134.9c30d69b.js"><link rel="prefetch" href="/assets/js/135.91463dab.js"><link rel="prefetch" href="/assets/js/136.5e57454a.js"><link rel="prefetch" href="/assets/js/137.1d4e51f0.js"><link rel="prefetch" href="/assets/js/138.6cd3ac7f.js"><link rel="prefetch" href="/assets/js/139.7bd789a6.js"><link rel="prefetch" href="/assets/js/14.ead46968.js"><link rel="prefetch" href="/assets/js/140.e1d92390.js"><link rel="prefetch" href="/assets/js/141.23e11057.js"><link rel="prefetch" href="/assets/js/142.c8cc0f38.js"><link rel="prefetch" href="/assets/js/143.fc738cb7.js"><link rel="prefetch" href="/assets/js/144.67c64203.js"><link rel="prefetch" href="/assets/js/145.cc73ed45.js"><link rel="prefetch" href="/assets/js/146.adaac4c0.js"><link rel="prefetch" href="/assets/js/147.0e83b5c1.js"><link rel="prefetch" href="/assets/js/148.1f253a46.js"><link rel="prefetch" href="/assets/js/149.ab428593.js"><link rel="prefetch" href="/assets/js/15.198f32e1.js"><link rel="prefetch" href="/assets/js/150.64cd514e.js"><link rel="prefetch" href="/assets/js/151.ca1ae55a.js"><link rel="prefetch" href="/assets/js/152.4119b23d.js"><link rel="prefetch" href="/assets/js/153.ed663263.js"><link rel="prefetch" href="/assets/js/154.71b836f6.js"><link rel="prefetch" href="/assets/js/155.c47e2e88.js"><link rel="prefetch" href="/assets/js/156.3e91e0f4.js"><link rel="prefetch" href="/assets/js/157.811b1421.js"><link rel="prefetch" href="/assets/js/158.71193c19.js"><link rel="prefetch" href="/assets/js/159.f09778fd.js"><link rel="prefetch" href="/assets/js/16.03096de2.js"><link rel="prefetch" href="/assets/js/160.15d99de4.js"><link rel="prefetch" href="/assets/js/161.813166a0.js"><link rel="prefetch" href="/assets/js/162.c52bbf77.js"><link rel="prefetch" href="/assets/js/163.ada6991a.js"><link rel="prefetch" href="/assets/js/164.d8ceba57.js"><link rel="prefetch" href="/assets/js/165.a645ef3a.js"><link rel="prefetch" href="/assets/js/166.995d24ad.js"><link rel="prefetch" href="/assets/js/167.d7278e80.js"><link rel="prefetch" href="/assets/js/168.e388905a.js"><link rel="prefetch" href="/assets/js/169.52edabbb.js"><link rel="prefetch" href="/assets/js/17.a49f9c19.js"><link rel="prefetch" href="/assets/js/170.0b62c5b4.js"><link rel="prefetch" href="/assets/js/171.017c8997.js"><link rel="prefetch" href="/assets/js/172.f0763c39.js"><link rel="prefetch" href="/assets/js/173.c961bf43.js"><link rel="prefetch" href="/assets/js/174.395224c0.js"><link rel="prefetch" href="/assets/js/175.52fbdc96.js"><link rel="prefetch" href="/assets/js/176.14e0a3b2.js"><link rel="prefetch" href="/assets/js/177.78f7d89f.js"><link rel="prefetch" href="/assets/js/178.c08bdd65.js"><link rel="prefetch" href="/assets/js/179.b634397c.js"><link rel="prefetch" href="/assets/js/18.9786a034.js"><link rel="prefetch" href="/assets/js/180.284b6c99.js"><link rel="prefetch" href="/assets/js/182.8bfd08cd.js"><link rel="prefetch" href="/assets/js/183.59b0b92b.js"><link rel="prefetch" href="/assets/js/184.a5fae95c.js"><link rel="prefetch" href="/assets/js/185.dcf55c72.js"><link rel="prefetch" href="/assets/js/186.6b1cf319.js"><link rel="prefetch" href="/assets/js/187.312708d0.js"><link rel="prefetch" href="/assets/js/188.71de21d0.js"><link rel="prefetch" href="/assets/js/189.7d72c108.js"><link rel="prefetch" href="/assets/js/19.089d6618.js"><link rel="prefetch" href="/assets/js/190.85dce0bd.js"><link rel="prefetch" href="/assets/js/191.08f7136b.js"><link rel="prefetch" href="/assets/js/192.6a155217.js"><link rel="prefetch" href="/assets/js/193.64f71670.js"><link rel="prefetch" href="/assets/js/194.c4d60c72.js"><link rel="prefetch" href="/assets/js/195.748850e9.js"><link rel="prefetch" href="/assets/js/196.887ef31c.js"><link rel="prefetch" href="/assets/js/197.4473c177.js"><link rel="prefetch" href="/assets/js/198.ea53a990.js"><link rel="prefetch" href="/assets/js/199.886f6490.js"><link rel="prefetch" href="/assets/js/20.a52783e8.js"><link rel="prefetch" href="/assets/js/200.7619a798.js"><link rel="prefetch" href="/assets/js/201.d3f5de5f.js"><link rel="prefetch" href="/assets/js/202.ed4c18cc.js"><link rel="prefetch" href="/assets/js/203.7937068e.js"><link rel="prefetch" href="/assets/js/204.3dbdd61c.js"><link rel="prefetch" href="/assets/js/205.52bc6fdf.js"><link rel="prefetch" href="/assets/js/206.4393998f.js"><link rel="prefetch" href="/assets/js/207.ec8e121d.js"><link rel="prefetch" href="/assets/js/208.f54d4e42.js"><link rel="prefetch" href="/assets/js/209.1bc5d06d.js"><link rel="prefetch" href="/assets/js/21.2e3bed21.js"><link rel="prefetch" href="/assets/js/210.2a3dc088.js"><link rel="prefetch" href="/assets/js/211.7084c526.js"><link rel="prefetch" href="/assets/js/212.de742850.js"><link rel="prefetch" href="/assets/js/213.fc775028.js"><link rel="prefetch" href="/assets/js/214.e338168c.js"><link rel="prefetch" href="/assets/js/215.3e89c57e.js"><link rel="prefetch" href="/assets/js/216.ecfe7587.js"><link rel="prefetch" href="/assets/js/217.14dcd4a2.js"><link rel="prefetch" href="/assets/js/218.ee7d57f7.js"><link rel="prefetch" href="/assets/js/219.c263c1e8.js"><link rel="prefetch" href="/assets/js/22.3d09766f.js"><link rel="prefetch" href="/assets/js/220.33f2bfd2.js"><link rel="prefetch" href="/assets/js/221.cd55e739.js"><link rel="prefetch" href="/assets/js/222.63107647.js"><link rel="prefetch" href="/assets/js/223.768ef403.js"><link rel="prefetch" href="/assets/js/224.54357078.js"><link rel="prefetch" href="/assets/js/225.b8e46582.js"><link rel="prefetch" href="/assets/js/226.1d0dcae9.js"><link rel="prefetch" href="/assets/js/227.a351c0a1.js"><link rel="prefetch" href="/assets/js/228.f7b8c278.js"><link rel="prefetch" href="/assets/js/229.8e4aba4d.js"><link rel="prefetch" href="/assets/js/23.b87e3933.js"><link rel="prefetch" href="/assets/js/230.186bd7a5.js"><link rel="prefetch" href="/assets/js/231.dad483e1.js"><link rel="prefetch" href="/assets/js/232.26555358.js"><link rel="prefetch" href="/assets/js/233.658ba0e4.js"><link rel="prefetch" href="/assets/js/234.7994cee0.js"><link rel="prefetch" href="/assets/js/235.3934d057.js"><link rel="prefetch" href="/assets/js/236.59cb6eac.js"><link rel="prefetch" href="/assets/js/237.baa1c655.js"><link rel="prefetch" href="/assets/js/238.8ee9f8ae.js"><link rel="prefetch" href="/assets/js/239.b0fe3966.js"><link rel="prefetch" href="/assets/js/24.afe2a3c4.js"><link rel="prefetch" href="/assets/js/240.d06483fa.js"><link rel="prefetch" href="/assets/js/241.81a2223e.js"><link rel="prefetch" href="/assets/js/242.8f6eee74.js"><link rel="prefetch" href="/assets/js/243.874461fa.js"><link rel="prefetch" href="/assets/js/244.ec0bb622.js"><link rel="prefetch" href="/assets/js/245.2ecf61f8.js"><link rel="prefetch" href="/assets/js/246.e7f6e55c.js"><link rel="prefetch" href="/assets/js/247.f32a1a4b.js"><link rel="prefetch" href="/assets/js/248.4302c4d8.js"><link rel="prefetch" href="/assets/js/249.9b0a4d9f.js"><link rel="prefetch" href="/assets/js/25.a22777b8.js"><link rel="prefetch" href="/assets/js/250.1295326c.js"><link rel="prefetch" href="/assets/js/251.d1cdb160.js"><link rel="prefetch" href="/assets/js/252.4e9d56fe.js"><link rel="prefetch" href="/assets/js/253.5a23b42d.js"><link rel="prefetch" href="/assets/js/254.8777547c.js"><link rel="prefetch" href="/assets/js/255.b8825033.js"><link rel="prefetch" href="/assets/js/256.0ee3689d.js"><link rel="prefetch" href="/assets/js/257.4a684795.js"><link rel="prefetch" href="/assets/js/258.ca696e72.js"><link rel="prefetch" href="/assets/js/259.fdf867d0.js"><link rel="prefetch" href="/assets/js/26.c84357e5.js"><link rel="prefetch" href="/assets/js/260.d35d60d5.js"><link rel="prefetch" href="/assets/js/261.c162cef5.js"><link rel="prefetch" href="/assets/js/262.8cbc5289.js"><link rel="prefetch" href="/assets/js/263.c05bbe4c.js"><link rel="prefetch" href="/assets/js/264.2e7c8f69.js"><link rel="prefetch" href="/assets/js/265.372a0632.js"><link rel="prefetch" href="/assets/js/266.49c38b9d.js"><link rel="prefetch" href="/assets/js/267.f7406d35.js"><link rel="prefetch" href="/assets/js/268.c7846c3e.js"><link rel="prefetch" href="/assets/js/269.e30bdc7f.js"><link rel="prefetch" href="/assets/js/27.0b3da7b9.js"><link rel="prefetch" href="/assets/js/270.8a3786ce.js"><link rel="prefetch" href="/assets/js/271.4b771c95.js"><link rel="prefetch" href="/assets/js/272.c710d2d6.js"><link rel="prefetch" href="/assets/js/273.43fb2872.js"><link rel="prefetch" href="/assets/js/274.d8a9dff2.js"><link rel="prefetch" href="/assets/js/275.c2812b68.js"><link rel="prefetch" href="/assets/js/276.406503c4.js"><link rel="prefetch" href="/assets/js/277.10c29e54.js"><link rel="prefetch" href="/assets/js/278.5f4b657a.js"><link rel="prefetch" href="/assets/js/279.84b86ae8.js"><link rel="prefetch" href="/assets/js/28.1c1fd5a6.js"><link rel="prefetch" href="/assets/js/280.8a2ba3b2.js"><link rel="prefetch" href="/assets/js/281.4a7f2b91.js"><link rel="prefetch" href="/assets/js/282.7b2f2668.js"><link rel="prefetch" href="/assets/js/283.455f93df.js"><link rel="prefetch" href="/assets/js/284.1a448478.js"><link rel="prefetch" href="/assets/js/285.19eebc05.js"><link rel="prefetch" href="/assets/js/286.5423cfc6.js"><link rel="prefetch" href="/assets/js/287.afbe115e.js"><link rel="prefetch" href="/assets/js/288.d4f4f247.js"><link rel="prefetch" href="/assets/js/289.da477465.js"><link rel="prefetch" href="/assets/js/29.103209e9.js"><link rel="prefetch" href="/assets/js/290.abf99800.js"><link rel="prefetch" href="/assets/js/291.71fe3ae6.js"><link rel="prefetch" href="/assets/js/292.455169ca.js"><link rel="prefetch" href="/assets/js/293.d23ffed4.js"><link rel="prefetch" href="/assets/js/294.1a753204.js"><link rel="prefetch" href="/assets/js/295.badfa110.js"><link rel="prefetch" href="/assets/js/296.344206a1.js"><link rel="prefetch" href="/assets/js/297.29e4f914.js"><link rel="prefetch" href="/assets/js/298.f9db8940.js"><link rel="prefetch" href="/assets/js/299.2253c1e7.js"><link rel="prefetch" href="/assets/js/3.e5ca1c51.js"><link rel="prefetch" href="/assets/js/30.e76a827e.js"><link rel="prefetch" href="/assets/js/300.e5bfd607.js"><link rel="prefetch" href="/assets/js/301.cc3e786e.js"><link rel="prefetch" href="/assets/js/302.7fdc62b6.js"><link rel="prefetch" href="/assets/js/303.b1db491f.js"><link rel="prefetch" href="/assets/js/304.18917b0f.js"><link rel="prefetch" href="/assets/js/305.d352aeb5.js"><link rel="prefetch" href="/assets/js/306.8bc72324.js"><link rel="prefetch" href="/assets/js/307.854b4037.js"><link rel="prefetch" href="/assets/js/308.6a0e4a18.js"><link rel="prefetch" href="/assets/js/309.d184df6f.js"><link rel="prefetch" href="/assets/js/31.7e4b200d.js"><link rel="prefetch" href="/assets/js/310.8e0af1ab.js"><link rel="prefetch" href="/assets/js/311.00bae85e.js"><link rel="prefetch" href="/assets/js/312.bc92cba9.js"><link rel="prefetch" href="/assets/js/313.8f70a987.js"><link rel="prefetch" href="/assets/js/314.8f190f1f.js"><link rel="prefetch" href="/assets/js/315.4b8506c7.js"><link rel="prefetch" href="/assets/js/316.5911c1f9.js"><link rel="prefetch" href="/assets/js/317.58cca547.js"><link rel="prefetch" href="/assets/js/318.4f23c053.js"><link rel="prefetch" href="/assets/js/319.941f5d3e.js"><link rel="prefetch" href="/assets/js/32.9c188bac.js"><link rel="prefetch" href="/assets/js/320.a3f15adc.js"><link rel="prefetch" href="/assets/js/321.14c74686.js"><link rel="prefetch" href="/assets/js/322.5f7b1b87.js"><link rel="prefetch" href="/assets/js/323.ab05eccb.js"><link rel="prefetch" href="/assets/js/324.292806ba.js"><link rel="prefetch" href="/assets/js/325.b96314dd.js"><link rel="prefetch" href="/assets/js/326.3d8f6329.js"><link rel="prefetch" href="/assets/js/327.49cf9268.js"><link rel="prefetch" href="/assets/js/328.be56ec05.js"><link rel="prefetch" href="/assets/js/329.8c390111.js"><link rel="prefetch" href="/assets/js/33.2435d797.js"><link rel="prefetch" href="/assets/js/330.b961e5fd.js"><link rel="prefetch" href="/assets/js/331.24ce8c0b.js"><link rel="prefetch" href="/assets/js/332.115b7546.js"><link rel="prefetch" href="/assets/js/333.957e0728.js"><link rel="prefetch" href="/assets/js/334.68825ff7.js"><link rel="prefetch" href="/assets/js/335.b662f33d.js"><link rel="prefetch" href="/assets/js/336.d8818747.js"><link rel="prefetch" href="/assets/js/337.9d24e096.js"><link rel="prefetch" href="/assets/js/338.3b669645.js"><link rel="prefetch" href="/assets/js/339.51cc2773.js"><link rel="prefetch" href="/assets/js/34.d57f3bb9.js"><link rel="prefetch" href="/assets/js/340.28cfadfb.js"><link rel="prefetch" href="/assets/js/341.4e6b0bdd.js"><link rel="prefetch" href="/assets/js/342.310c1a3e.js"><link rel="prefetch" href="/assets/js/343.0e61677a.js"><link rel="prefetch" href="/assets/js/344.340a39bd.js"><link rel="prefetch" href="/assets/js/345.fff51053.js"><link rel="prefetch" href="/assets/js/346.93c709db.js"><link rel="prefetch" href="/assets/js/347.dc863ac9.js"><link rel="prefetch" href="/assets/js/348.13c191d7.js"><link rel="prefetch" href="/assets/js/349.8aea43f7.js"><link rel="prefetch" href="/assets/js/35.e20cb4ac.js"><link rel="prefetch" href="/assets/js/350.49b72b87.js"><link rel="prefetch" href="/assets/js/351.3e6e6379.js"><link rel="prefetch" href="/assets/js/352.e2524a53.js"><link rel="prefetch" href="/assets/js/353.b71b2a33.js"><link rel="prefetch" href="/assets/js/354.a4720902.js"><link rel="prefetch" href="/assets/js/355.5a8970e1.js"><link rel="prefetch" href="/assets/js/356.353f0a9c.js"><link rel="prefetch" href="/assets/js/357.648060ca.js"><link rel="prefetch" href="/assets/js/358.643b787c.js"><link rel="prefetch" href="/assets/js/359.b1bc0c81.js"><link rel="prefetch" href="/assets/js/36.6a79f8ad.js"><link rel="prefetch" href="/assets/js/360.748faf07.js"><link rel="prefetch" href="/assets/js/361.cddfbfab.js"><link rel="prefetch" href="/assets/js/362.46990756.js"><link rel="prefetch" href="/assets/js/363.f4846a88.js"><link rel="prefetch" href="/assets/js/364.e7fd6af2.js"><link rel="prefetch" href="/assets/js/365.41693194.js"><link rel="prefetch" href="/assets/js/366.60931b9e.js"><link rel="prefetch" href="/assets/js/367.c7a310db.js"><link rel="prefetch" href="/assets/js/368.cae4028a.js"><link rel="prefetch" href="/assets/js/369.e3bcd2c2.js"><link rel="prefetch" href="/assets/js/37.4ccc31d6.js"><link rel="prefetch" href="/assets/js/370.2ea3b181.js"><link rel="prefetch" href="/assets/js/371.978056e5.js"><link rel="prefetch" href="/assets/js/372.aa13db83.js"><link rel="prefetch" href="/assets/js/373.f3791afe.js"><link rel="prefetch" href="/assets/js/374.b108af2d.js"><link rel="prefetch" href="/assets/js/375.dc75d5b1.js"><link rel="prefetch" href="/assets/js/376.8a663da6.js"><link rel="prefetch" href="/assets/js/38.9816dff1.js"><link rel="prefetch" href="/assets/js/39.03d551c0.js"><link rel="prefetch" href="/assets/js/4.611d42c4.js"><link rel="prefetch" href="/assets/js/40.ce442bf2.js"><link rel="prefetch" href="/assets/js/41.d596832c.js"><link rel="prefetch" href="/assets/js/42.29309c56.js"><link rel="prefetch" href="/assets/js/43.d47b7a06.js"><link rel="prefetch" href="/assets/js/44.87716237.js"><link rel="prefetch" href="/assets/js/45.d5ef3d2b.js"><link rel="prefetch" href="/assets/js/46.21cef7ff.js"><link rel="prefetch" href="/assets/js/47.75c67941.js"><link rel="prefetch" href="/assets/js/48.b94040d3.js"><link rel="prefetch" href="/assets/js/49.507fb28d.js"><link rel="prefetch" href="/assets/js/5.e6d623f8.js"><link rel="prefetch" href="/assets/js/50.4013f17e.js"><link rel="prefetch" href="/assets/js/51.6e81cba9.js"><link rel="prefetch" href="/assets/js/52.07e4aadf.js"><link rel="prefetch" href="/assets/js/53.1d325b49.js"><link rel="prefetch" href="/assets/js/54.79ff5e8c.js"><link rel="prefetch" href="/assets/js/55.77160bdd.js"><link rel="prefetch" href="/assets/js/56.a3041056.js"><link rel="prefetch" href="/assets/js/57.b7c0602c.js"><link rel="prefetch" href="/assets/js/58.a4af9a23.js"><link rel="prefetch" href="/assets/js/59.61a80d59.js"><link rel="prefetch" href="/assets/js/6.dc644b59.js"><link rel="prefetch" href="/assets/js/60.4ae1e1f0.js"><link rel="prefetch" href="/assets/js/61.b733273a.js"><link rel="prefetch" href="/assets/js/62.63b8d77d.js"><link rel="prefetch" href="/assets/js/63.46a84bd8.js"><link rel="prefetch" href="/assets/js/64.ce8c5891.js"><link rel="prefetch" href="/assets/js/65.8abe6836.js"><link rel="prefetch" href="/assets/js/66.6f9a9cf9.js"><link rel="prefetch" href="/assets/js/67.6bc415b9.js"><link rel="prefetch" href="/assets/js/68.b100ab24.js"><link rel="prefetch" href="/assets/js/69.5d9ed0d7.js"><link rel="prefetch" href="/assets/js/7.7da3e776.js"><link rel="prefetch" href="/assets/js/70.f213eb63.js"><link rel="prefetch" href="/assets/js/71.9dbed333.js"><link rel="prefetch" href="/assets/js/72.1129fb4b.js"><link rel="prefetch" href="/assets/js/73.7459f6b0.js"><link rel="prefetch" href="/assets/js/74.2364da14.js"><link rel="prefetch" href="/assets/js/75.72e5d347.js"><link rel="prefetch" href="/assets/js/76.7f1bc93d.js"><link rel="prefetch" href="/assets/js/77.7f9bb46a.js"><link rel="prefetch" href="/assets/js/78.16497536.js"><link rel="prefetch" href="/assets/js/79.1598ba88.js"><link rel="prefetch" href="/assets/js/8.91ce867e.js"><link rel="prefetch" href="/assets/js/80.d7595902.js"><link rel="prefetch" href="/assets/js/81.c808c887.js"><link rel="prefetch" href="/assets/js/82.49dc6011.js"><link rel="prefetch" href="/assets/js/83.6e151bae.js"><link rel="prefetch" href="/assets/js/84.9d3d5086.js"><link rel="prefetch" href="/assets/js/85.2c4d111e.js"><link rel="prefetch" href="/assets/js/86.cff98baa.js"><link rel="prefetch" href="/assets/js/87.655584a0.js"><link rel="prefetch" href="/assets/js/88.109ad4f1.js"><link rel="prefetch" href="/assets/js/89.46f7ed5c.js"><link rel="prefetch" href="/assets/js/9.8a2e5f54.js"><link rel="prefetch" href="/assets/js/90.1a91e9ca.js"><link rel="prefetch" href="/assets/js/91.26a98055.js"><link rel="prefetch" href="/assets/js/92.6ed9cb6e.js"><link rel="prefetch" href="/assets/js/93.14253412.js"><link rel="prefetch" href="/assets/js/94.54415bcf.js"><link rel="prefetch" href="/assets/js/95.0e1c9d0a.js"><link rel="prefetch" href="/assets/js/96.8654188f.js"><link rel="prefetch" href="/assets/js/97.d338a1d8.js"><link rel="prefetch" href="/assets/js/98.efa1e5c5.js"><link rel="prefetch" href="/assets/js/99.83fa6575.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76d9f797.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/magic.png" alt="Pangolin" class="logo"> <span class="site-name can-hide">Pangolin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpeg"> <div class="blogger-info"><h3>达尔文的猹</h3> <span>大道至简 悟在天成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ORM框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/4553db/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/d426ff/" class="sidebar-link">Spring集成MyBatis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/45687a/" class="sidebar-link">基础</a></li><li><a href="/pages/669da3/" class="sidebar-link">Java基础</a></li><li><a href="/pages/06424b/" class="sidebar-link">类与继承</a></li><li><a href="/pages/a29a57/" class="sidebar-link">抽象类与接口</a></li><li><a href="/pages/575ca7/" class="sidebar-link">内部类</a></li><li><a href="/pages/1d42f5/" class="sidebar-link">枚举类</a></li><li><a href="/pages/68df7d/" class="sidebar-link">常用类</a></li><li><a href="/pages/208d9a/" class="sidebar-link">关键字</a></li><li><a href="/pages/19431a/" class="sidebar-link">注解</a></li><li><a href="/pages/98c0c9/" class="sidebar-link">异常</a></li><li><a href="/pages/a08fb2/" class="sidebar-link">泛型</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>集合类</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e52b1c/" class="sidebar-link">集合类</a></li><li><a href="/pages/20a058/" class="sidebar-link">集合容器类概述</a></li><li><a href="/pages/71ab62/" class="sidebar-link">ArrayList与LinkedList</a></li><li><a href="/pages/dd747b/" class="sidebar-link">ArrayDeque</a></li><li><a href="/pages/f0ecf7/" class="sidebar-link">PriorityQueue</a></li><li><a href="/pages/a577c4/" class="sidebar-link">HashMap与HashSet</a></li><li><a href="/pages/b65f71/" class="sidebar-link">LinkedHashMap</a></li><li><a href="/pages/02deb8/" class="sidebar-link">TreeMap与TreeSet</a></li><li><a href="/pages/8b70b6/" class="sidebar-link">WeakHashMap</a></li><li><a href="/pages/098b2b/" class="sidebar-link">CopyOnWriteArrayList</a></li><li><a href="/pages/380128/" class="sidebar-link">ConcurrentHashMap</a></li><li><a href="/pages/b23642/" class="sidebar-link">BlockingQueue</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/5d5b55/" class="sidebar-link">并发</a></li><li><a href="/pages/ef591d/" class="sidebar-link">多线程基础</a></li><li><a href="/pages/870f46/" class="sidebar-link">JMM与Volatile</a></li><li><a href="/pages/70bfda/" class="sidebar-link">JUC与AQS</a></li><li><a href="/pages/60c2c3/" class="sidebar-link">锁与互斥同步</a></li><li><a href="/pages/6e4dfa/" class="sidebar-link">显式锁与ReetrantLock</a></li><li><a href="/pages/a0d56d/" class="sidebar-link">线程安全总结</a></li><li><a href="/pages/b92a49/" class="sidebar-link">JUC组件与线程协作</a></li><li><a href="/pages/103bb5/" class="sidebar-link">Atomic原子变量与Unsafe类与CAS</a></li><li><a href="/pages/065f55/" class="sidebar-link">线程池与定时任务</a></li><li><a href="/pages/dd3660/" class="sidebar-link">ThreadLocal</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>IO</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/7db050/" class="sidebar-link">IO</a></li><li><a href="/pages/ccb0a7/" class="sidebar-link">文件操作</a></li><li><a href="/pages/45bc73/" class="sidebar-link">IO流操作</a></li><li><a href="/pages/404e82/" class="sidebar-link">网络IO操作</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Java高级特性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/396bd1/" class="sidebar-link">Java高级特性</a></li><li><a href="/pages/eaa98b/" class="sidebar-link">Lambda表达式</a></li><li><a href="/pages/40af88/" class="sidebar-link">流Stream</a></li><li><a href="/pages/402b10/" class="sidebar-link">反射</a></li><li><a href="/pages/a5ebcd/" class="sidebar-link">代理</a></li><li><a href="/pages/b48bfe/" class="sidebar-link">Java性能问题定位分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/20204f/" class="sidebar-link">其他</a></li><li><a href="/pages/e4cde0/" class="sidebar-link">杂记</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>规范&amp;amp;风格</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ee7259/" class="sidebar-link">规范&amp;amp;风格</a></li><li><a href="/pages/139e3f/" class="sidebar-link">代码整洁之道</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ed8d11/" class="sidebar-link">Web基础</a></li><li><a href="/pages/a228d7/" class="sidebar-link">Spring(Boot)基础</a></li><li><a href="/pages/ecd8b6/" class="sidebar-link">Spring Boot应用整合</a></li><li><a href="/pages/76dc08/" class="sidebar-link">Spring MVC</a></li><li><a href="/pages/b9aa73/" class="sidebar-link">Spring AOP</a></li><li><a href="/pages/dc74be/" class="sidebar-link">Spring事务</a></li><li><a href="/pages/b43c8c/" class="sidebar-link">Spring IOC源码分析-概览</a></li><li><a href="/pages/d9b4a5/" class="sidebar-link">Spring IOC源码分析-getBean()</a></li><li><a href="/pages/59dd3e/" class="sidebar-link">Spring IOC源码分析-createBean()</a></li><li><a href="/pages/691b21/" class="sidebar-link">Spring AOP源码分析</a></li><li><a href="/pages/d31e18/" class="sidebar-link">Spring事务源码分析</a></li><li><a href="/pages/f16cdb/" class="sidebar-link">Spring Boot源码分析</a></li><li><a href="/pages/b13a90/" class="sidebar-link">Spring MVC源码分析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/943c23/" class="sidebar-link">JVM内存区域与对象解析</a></li><li><a href="/pages/05acae/" class="sidebar-link">内存分配与垃圾收集</a></li><li><a href="/pages/d09a16/" class="sidebar-link">JVM监控与故障处理工具</a></li><li><a href="/pages/06e4ad/" class="sidebar-link">类文件结构与类加载机制</a></li><li><a href="/pages/3d00d5/" class="sidebar-link">虚拟机方法调用与指令执行引擎</a></li><li><a href="/pages/eba070/" class="sidebar-link">程序编译与代码优化</a></li><li><a href="/pages/83896f/" class="sidebar-link">虚拟机调优及参数总结</a></li><li><a href="/pages/8a0034/" class="sidebar-link">GraalVM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f6cd57/" class="sidebar-link">数据库系统原理</a></li><li><a href="/pages/410bf5/" class="sidebar-link">MySQL必知必会</a></li><li><a href="/pages/495264/" class="sidebar-link">MySQL开发与优化</a></li><li><a href="/pages/ec7e76/" class="sidebar-link">MySQL架构与日志</a></li><li><a href="/pages/4dbe1f/" class="sidebar-link">MySQL索引</a></li><li><a href="/pages/cbc7ab/" aria-current="page" class="active sidebar-link">MySQL优化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/4afd3a/" class="sidebar-link">MySQL锁机制与事务并发控制</a></li><li><a href="/pages/412461/" class="sidebar-link">MySQL高级特性</a></li><li><a href="/pages/41888c/" class="sidebar-link">MySQL设计规范</a></li><li><a href="/pages/087de5/" class="sidebar-link">MySQL架构篇</a></li><li><a href="/pages/b0952c/" class="sidebar-link">MySQL复制</a></li><li><a href="/pages/ee884d/" class="sidebar-link">MySQL高可用</a></li><li><a href="/pages/6d4f47/" class="sidebar-link">MySQL运维篇</a></li><li><a href="/pages/b8bad7/" class="sidebar-link">MySQL常用工具</a></li><li><a href="/pages/8bd691/" class="sidebar-link">MySQL日志</a></li><li><a href="/pages/5db7ef/" class="sidebar-link">MySQL备份与恢复</a></li><li><a href="/pages/3e3d3a/" class="sidebar-link">MySQL权限与安全</a></li><li><a href="/pages/5f2a5c/" class="sidebar-link">MySQL监控</a></li><li><a href="/pages/bf28eb/" class="sidebar-link">数据库LeetCode题目</a></li><li><a href="/pages/d4f878/" class="sidebar-link">数据库面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2bed26/" class="sidebar-link">Arthas</a></li><li><a href="/pages/84ff17/" class="sidebar-link">CICD</a></li><li><a href="/pages/a7e6ff/" class="sidebar-link">Maven</a></li><li><a href="/pages/2a3f45/" class="sidebar-link">Typora主题</a></li><li><a href="/pages/f28f56/" class="sidebar-link">VuePress</a></li><li><a href="/pages/9d673a/" class="sidebar-link">思源笔记</a></li><li><a href="/pages/538b8a/" class="sidebar-link">环境搭建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ORM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c83270/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/29ba44/" class="sidebar-link">Spring集成MyBatis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e55b6f/" class="sidebar-link">测试基础</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/develop/#开发" data-v-06225672>开发</a></li><li data-v-06225672><a href="/develop/#数据库" data-v-06225672>数据库</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/nanodaemony" target="_blank" title="作者" class="beLink" data-v-06225672>NanoDaemony</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-06-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->MySQL优化<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_303-mysql优化"><a href="#_303-mysql优化" class="header-anchor">#</a> 303.MySQL优化</h1> <h3 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h3> <p>下图是优化的手段及其收益成本的经验图, 可以看出 SQL 及索引的优化效果是最好的, 而且成本最低, 所以工作中要在这块花更多时间.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/202303202155477.png" alt=""></p> <h4 id="优化工具"><a href="#优化工具" class="header-anchor">#</a> 优化工具</h4> <p>先来个表:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>position<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'职位'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>hire_time<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'入职时间'</span><span class="token punctuation">,</span> 
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 联合索引</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_name_age_position<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>position<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'员工表'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这里创建了<strong>联合索引</strong>: idx_name_age_position, 共三个字段 <strong>name, age 和 position</strong>.</p> <h5 id="_1-explain关键字⭐️"><a href="#_1-explain关键字⭐️" class="header-anchor">#</a> 1.EXPLAIN关键字⭐️</h5> <p>使用 EXPLAIN 关键字可以<strong>模拟优化器执行 SQL 语句</strong>, 分析查询语句或结构的性能瓶颈. <strong>在 SELECT 语句之前加 EXPLAIN 关键字</strong>, MySQL 会在查询上设置一个<strong>标记</strong>, 执行查询会<strong>返回执行计划的信息</strong>, 而<strong>不是执行</strong>这条 SQL. 如果包含子查询, 仍会执行该子查询, 将结果放入临时表中.</p> <p>如果一条 SQL 包含子查询等较复杂的查询, 那么 Explain 的结果可能有多行, 每行都可能各自有下面的属性.</p> <p>Explain 分析结果中比较重要的<strong>属性</strong>如下:</p> <p><strong>(1) select_type</strong></p> <p>SELECT 查询的类型. 主要是区别普通查询和联合查询, 子查询之类的复杂查询. (1) simple: 简单查询, 查询不包含子查询和 union. (2) subquery: 子查询. 还有一些不列了.</p> <p><strong>(2) table</strong></p> <p>表示正在访问哪个表.</p> <p><strong>(3) ​</strong>​**==type==**</p> <p>表示<strong>访问类型</strong>, 即表示 MySQL 如何查找表中的行, 是<strong>较为重要</strong>的一个指标. 从**==最优到最差==**依次为: <strong>system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL. ​</strong>一般来说, <strong>得保证查询达到 range 级别, 最好达到 ref, ​</strong>如果达不到则可以考虑进行 SQL 优化.</p> <ul><li><p><strong>const, system</strong>: 当 <strong>MySQL 能对查询的某部分进行优化并将其转化成一个常量时, type 取值为 const 或 system. 用于 primary key 或 unique key 的所有列与常数</strong>比较时, 所以表最多有一个匹配行, 读取 1 次, 速度比较快. system 是 const 的特例, 表里只有一条元组匹配时为 system.</p></li> <li><p><strong>eq_ref</strong>: 使用这种索引查找, MySQL 知道<strong>最多只返回一条符合条件</strong>的记录. 这种访问方法可以在 MySQL 使用主键或者唯一性索引查找时看到, 它会将它们与某个参考值做比较. primary key 或 unique key 索引的所有部分被连接使用, 最多只会返回一条符合条件的记录. 简单的 SELECT 查询不会出现这种 type.</p></li> <li><p><strong>ref</strong>: 相比 eq_ref, 不使用唯一索引, 而是使用<strong>普通索引或唯一索引</strong>的部分前缀. 索引要和某个值相比较, 可能会找到<strong>多个符合条件的行, 因此它是查找和扫描的混合体</strong>. 这是一种索引访问(有时也叫做索引查找), 它返回<strong>所有匹配某个单个值</strong>的行. 此类索引访问只有当使用非唯一性索引或唯一性索引的非唯一性前缀时才会发生.</p></li> <li><p><strong>range</strong>: 使用一个<strong>索引来检索给定范围的行</strong>. 范围扫描通常出现在 in(), between ,&gt; ,&lt;, &gt;= 等操作中.</p></li> <li><p><strong>index</strong>: <strong>扫描全索引就能拿到结果</strong>, 一般是扫描某个<strong>二级索引</strong>, 这种扫描不会从索引树根节点开始快速查找, 而是直接对二级索引的叶子节点遍历和扫描, 速度还是比较慢的, 这种查询一般为使用<strong>覆盖索引</strong>, 二级索引一般比较小, 所以这种通常比 ALL 快一些. 这种情况虽然使用了索引, 但是其实是在遍历索引进行查找, 所以通常需要避免.</p></li> <li><p><strong>ALL</strong>: 全表扫描. 扫描聚簇索引的所有叶子节点. 通常情况下这需要增加索引来进行优化.</p></li></ul> <p><strong>(4) possible_keys</strong></p> <p>表示本次查询<strong>可能会使用哪些索引</strong>来进行查找. 当 key 为 NULL 时, 可能是因为表中数据不多, MySQL 认为索引对此查询帮助不大, 选择了全表查询.</p> <p><strong>(5) key</strong></p> <p>表示查询<strong>实际采用哪个索引</strong>来进行查找. 如果<strong>没有选择使用所以, 键是 NULL</strong>. <strong>key = primary</strong> 表示使用了<strong>主键</strong>; <strong>key = null</strong> 表示<strong>没用到索引</strong>. 有时候可能出现 possible_key 有值但是 key 没有值的情况, 就是实际上并没有用到索引.</p> <p><strong>(6) key_len</strong></p> <p>表示<strong>在索引里使用的字节数</strong>. 如果键是 NULL, 长度就是 NULL. 比如查询用到了联合索引, 那么从 key_len 就可以推算出使用到的联合索引的前缀长度. 举例: film_actor 表的联合索引 idx_film_actor_id 由 film_id 和 actor_id 两个 int 列组成, 并且每个 int 是 4 字节. 通过结果中的 key_len = 4 可推断出查询使用了联合索引的第一个列即 film_id 列来执行索引查找.</p> <p><strong>(7) ref</strong></p> <p>表示哪个字段或常数与 key 一起被使用.</p> <p><strong>(8) rows</strong></p> <p>MySQL <strong>估计</strong>要读取的行数, 注意这个不是结果集里的行数.</p> <p><strong>(9) Extra</strong></p> <p>额外信息, 常见重要值如下:</p> <ul><li><strong>Using index</strong>: 使用了<strong>覆盖索引</strong>.</li> <li><strong>Using where</strong>: 使用 WHERE 语句来处理结果, 并且查询的列未被索引覆盖.</li> <li>Using index condition: 查询的列不完全被索引覆盖, WHERE 条件中是一个前导列的范围.</li> <li>Using temporary: 需要创建一张临时表来处理查询. 出现这种情况一般是要进行优化.</li> <li><strong>Using filesort</strong>: 使用了外部磁盘排序而不是索引排序. 在没有索引的情况下, 数据较小时可以在内存进行排序, 否则需要<strong>在磁盘完成排序</strong>. 这种情况下一般也要考虑使用索引来优化.</li></ul> <h5 id="_2-trace工具"><a href="#_2-trace工具" class="header-anchor">#</a> 2.Trace工具</h5> <p>对于 name &gt; 'a' 和 name &gt; 'zzz' 这种<strong>范围查询</strong>的执行结果, MySQL <strong>最终</strong>是否会选择走索引可能是<strong>无法轻易判断</strong>的, 可以使用 <strong>trace 工具</strong>来看看 MySQL <strong>最终如何选择索引</strong>. 注意开启 trace 工具会<strong>影响 MySQL 性能</strong>, 所以只能<strong>临时分析</strong> SQL 使用, <strong>用完后应立即关闭</strong>.</p> <p>开启 trace 工具.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">session</span> optimizer_trace <span class="token operator">=</span> <span class="token string">&quot;enabled=on&quot;</span><span class="token punctuation">,</span> end_markers_in_json <span class="token operator">=</span> <span class="token keyword">on</span><span class="token punctuation">;</span>    <span class="token comment"># 开启trace</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行语句.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> name <span class="token operator">&gt;</span> <span class="token string">'a'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> position<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>分析结果</strong>存放到了下面的表中.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>OPTIMIZER_TRACE<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>得到 trace 字段:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;steps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;join_preparation&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ‐‐第一阶段<span class="token operator">:</span> SQL准备阶段
                 <span class="token property">&quot;select#&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                 <span class="token property">&quot;steps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                 <span class="token punctuation">{</span>
                 <span class="token property">&quot;expanded_query&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/* select#1 */ select `employees`.`id` AS `id`,`employees`.`name` AS `name`,`employees`.`age` AS `age`,`employees`.`position` AS `position`,`employees`.`hire_time` AS `hire_time` from`employees` where (`employees`.`name` &gt; 'a') order by `employees`.`position`&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* steps */</span>
<span class="token punctuation">}</span><span class="token comment">/* join_preparation */</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;join_optimization&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ‐‐第二阶段<span class="token operator">:</span> SQL优化阶段
<span class="token property">&quot;select#&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token property">&quot;steps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;condition_processing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ‐‐条件处理
<span class="token property">&quot;condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WHERE&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;original_condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(`employees`.`name` &gt; 'a')&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;steps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;transformation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;equality_propagation&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;resulting_condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(`employees`.`name` &gt; 'a')&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;transformation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;constant_propagation&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;resulting_condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(`employees`.`name` &gt; 'a')&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;transformation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;trivial_condition_removal&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;resulting_condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(`employees`.`name` &gt; 'a')&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* steps */</span>
<span class="token punctuation">}</span><span class="token comment">/* condition_processing */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;substitute_generated_columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token comment">/* substitute_generated_columns */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;table_dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> ‐‐表依赖详情
<span class="token punctuation">{</span>
<span class="token property">&quot;table&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;row_may_be_null&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token property">&quot;map_bit&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token property">&quot;depends_on_map_bits&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token comment">/* depends_on_map_bits */</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* table_dependencies */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;ref_optimizer_key_uses&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token comment">/* ref_optimizer_key_uses */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;rows_estimation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> ‐‐预估表的访问成本
<span class="token punctuation">{</span>
<span class="token property">&quot;table&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;range_analysis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token property">&quot;table_scan&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>     ‐‐全表扫描情况
<span class="token property">&quot;rows&quot;</span><span class="token operator">:</span> <span class="token number">10123</span><span class="token punctuation">,</span>      ‐‐扫描行数
<span class="token property">&quot;cost&quot;</span><span class="token operator">:</span> <span class="token number">2054.7</span>      ‐‐查询成本
<span class="token punctuation">}</span><span class="token comment">/* table_scan */</span><span class="token punctuation">,</span><span class="token number">70</span> <span class="token property">&quot;potential_range_indexes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> ‐‐查询可能使用的索引
<span class="token punctuation">{</span>
<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PRIMARY&quot;</span><span class="token punctuation">,</span> ‐‐主键索引
<span class="token property">&quot;usable&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token property">&quot;cause&quot;</span><span class="token operator">:</span> <span class="token string">&quot;not_applicable&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;idx_name_age_position&quot;</span><span class="token punctuation">,</span> ‐‐辅助索引
<span class="token property">&quot;usable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token property">&quot;key_parts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;position&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;id&quot;</span>
<span class="token punctuation">]</span><span class="token comment">/* key_parts */</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* potential_range_indexes */</span><span class="token punctuation">,</span>
<span class="token property">&quot;setup_range_conditions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token comment">/* setup_range_conditions */</span><span class="token punctuation">,</span>
<span class="token property">&quot;group_index_range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token property">&quot;chosen&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token property">&quot;cause&quot;</span><span class="token operator">:</span> <span class="token string">&quot;not_group_by_or_distinct&quot;</span>
<span class="token punctuation">}</span><span class="token comment">/* group_index_range */</span><span class="token punctuation">,</span>
<span class="token property">&quot;analyzing_range_alternatives&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ‐‐分析各个索引使用成本
<span class="token property">&quot;range_scan_alternatives&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;idx_name_age_position&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;ranges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token string">&quot;a &lt; name&quot;</span> ‐‐索引使用范围
<span class="token punctuation">]</span><span class="token comment">/* ranges */</span><span class="token punctuation">,</span>
<span class="token property">&quot;index_dives_for_eq_ranges&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token property">&quot;rowid_ordered&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> ‐‐使用该索引获取的记录是否按照主键排序
<span class="token property">&quot;using_mrr&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token property">&quot;index_only&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> ‐‐是否使用覆盖索引
<span class="token property">&quot;rows&quot;</span><span class="token operator">:</span> <span class="token number">5061</span><span class="token punctuation">,</span>        ‐‐索引扫描行数
<span class="token property">&quot;cost&quot;</span><span class="token operator">:</span> <span class="token number">6074.2</span><span class="token punctuation">,</span>      ‐‐索引使用成本
<span class="token property">&quot;chosen&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>     ‐‐是否选择该索引
<span class="token property">&quot;cause&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cost&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* range_scan_alternatives */</span><span class="token punctuation">,</span>
<span class="token property">&quot;analyzing_roworder_intersect&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token property">&quot;usable&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token property">&quot;cause&quot;</span><span class="token operator">:</span> <span class="token string">&quot;too_few_roworder_scans&quot;</span>
<span class="token punctuation">}</span><span class="token comment">/* analyzing_roworder_intersect */</span>
<span class="token punctuation">}</span><span class="token comment">/* analyzing_range_alternatives */</span>
<span class="token punctuation">}</span><span class="token comment">/* range_analysis */</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* rows_estimation */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;considered_execution_plans&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span> <span class="token property">&quot;plan_prefix&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token comment">/* plan_prefix */</span><span class="token punctuation">,</span>
<span class="token property">&quot;table&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;best_access_path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ‐‐最优访问路径
<span class="token property">&quot;considered_access_paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> ‐‐最终选择的访问路径
<span class="token punctuation">{</span>
<span class="token property">&quot;rows_to_scan&quot;</span><span class="token operator">:</span> <span class="token number">10123</span><span class="token punctuation">,</span>
<span class="token property">&quot;access_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scan&quot;</span><span class="token punctuation">,</span> ‐‐访问类型<span class="token operator">:</span> 为scan<span class="token punctuation">,</span> 全表扫描
<span class="token property">&quot;resulting_rows&quot;</span><span class="token operator">:</span> <span class="token number">10123</span><span class="token punctuation">,</span>
<span class="token property">&quot;cost&quot;</span><span class="token operator">:</span> <span class="token number">2052.6</span><span class="token punctuation">,</span>
<span class="token property">&quot;chosen&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ‐‐确定选择
<span class="token property">&quot;use_tmp_table&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* considered_access_paths */</span>
<span class="token punctuation">}</span><span class="token comment">/* best_access_path */</span><span class="token punctuation">,</span>
<span class="token property">&quot;condition_filtering_pct&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
<span class="token property">&quot;rows_for_plan&quot;</span><span class="token operator">:</span> <span class="token number">10123</span><span class="token punctuation">,</span>
<span class="token property">&quot;cost_for_plan&quot;</span><span class="token operator">:</span> <span class="token number">2052.6</span><span class="token punctuation">,</span>
<span class="token property">&quot;sort_cost&quot;</span><span class="token operator">:</span> <span class="token number">10123</span><span class="token punctuation">,</span>
<span class="token property">&quot;new_cost_for_plan&quot;</span><span class="token operator">:</span> <span class="token number">12176</span><span class="token punctuation">,</span>
<span class="token property">&quot;chosen&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* considered_execution_plans */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;attaching_conditions_to_tables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token property">&quot;original_condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(`employees`.`name` &gt; 'a')&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;attached_conditions_computation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token comment">/* attached_conditions_computation */</span><span class="token punctuation">,</span>
<span class="token property">&quot;attached_conditions_summary&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;table&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;attached&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(`employees`.`name` &gt; 'a')&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* attached_conditions_summary */</span>
<span class="token punctuation">}</span><span class="token comment">/* attaching_conditions_to_tables */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;clause_processing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token property">&quot;clause&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ORDER BY&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;original_clause&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`.`position`&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;items&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;item&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`.`position`&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* items */</span><span class="token punctuation">,</span>
<span class="token property">&quot;resulting_clause_is_simple&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token property">&quot;resulting_clause&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`.`position`&quot;</span>
<span class="token punctuation">}</span><span class="token comment">/* clause_processing */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;reconsidering_access_paths_for_index_ordering&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token property">&quot;clause&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ORDER BY&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;steps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token comment">/* steps */</span><span class="token punctuation">,</span>
<span class="token property">&quot;index_order_summary&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token property">&quot;table&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;index_provides_order&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token property">&quot;order_direction&quot;</span><span class="token operator">:</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;plan_changed&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token comment">/* index_order_summary */</span>
<span class="token punctuation">}</span><span class="token comment">/* reconsidering_access_paths_for_index_ordering */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;refine_plan&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;table&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`employees`&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* refine_plan */</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* steps */</span>
<span class="token punctuation">}</span><span class="token comment">/* join_optimization */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;join_execution&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> ‐‐第三阶段<span class="token operator">:</span> SQL执行阶段
<span class="token property">&quot;select#&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token property">&quot;steps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token comment">/* steps */</span>
<span class="token punctuation">}</span><span class="token comment">/* join_execution */</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token comment">/* steps */</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br></div></div><p>上述的 SQL 语句中<strong>全表扫描的成本低于索引扫描, 所以最终选择全表扫描.</strong></p> <p>trace 工具会<strong>分析并预估</strong>走索引和全表扫描的<strong>成本</strong>, 进行对比, 然后进行选择执行.</p> <h3 id="数据类型优化"><a href="#数据类型优化" class="header-anchor">#</a> 数据类型优化</h3> <h4 id="数据类型优化原则"><a href="#数据类型优化原则" class="header-anchor">#</a> 数据类型优化原则</h4> <p>不管存储哪种类型的数据, 下面几个简单的原则都有助于做出更好的选择.</p> <blockquote><p>更小的通常更好</p></blockquote> <p>一般情况下, 应该尽量使用可以正确存储数据的最小数据类型. 更小的数据类型通常更快, 因为它们占用更少的磁盘, 内存和 CPU 缓存, 并且处理时需要的 CPU 周期也更少.</p> <p>如果整形数据没有负数, 如 ID 号, 建议指定为 UNSIGNED 无符号类型, 容量可以扩大一倍.</p> <p>建议使用 TINYINT 代替 ENUM, BITENUM, SET.</p> <blockquote><p>简单就好</p></blockquote> <p>简单数据类型的操作通常需要更少的 CPU 周期. 例如, 整型比字符操作代价更低, 因为字符集和校对规则(排序规则)使字符比较比整型比较更复杂.</p> <blockquote><p>尽量避免NULL</p></blockquote> <p>通常情况下最好指定列为 <strong>NOT NULL</strong>, 除非真的需要存储 NULL 值. 如果查询中包含可为 NULL 的列, 对 MySQL 来说更难优化, 因为可为 NULL 的列使得索引, 索引统计和值比较都更复杂.</p> <h4 id="char与varchar"><a href="#char与varchar" class="header-anchor">#</a> CHAR与VARCHAR</h4> <p>VARCHAR 类型用于存储可变长字符串, 是最常见的字符串数据类型. 它比定长类型更节省空间, 因为它仅使用必要的空间(例如, 越短的字符串使用越少的空间). VARCHAR 需要使用 1 或 2 个额外字节记录字符串的长度: 如果列的最大长度小于等于 255 字节, 则只使用 1 个字节表示, 否则使用 2 个字节.</p> <p>下面这些情况下使用 VARCHAR 是合适的: <strong>字符串列的最大长度比平均长度大很多</strong>; 列的更新很少, 所以碎片不是问题; 使用了像 UTF-8 这样复杂的字符集, 每个字符都使用不同的字节数进行存储.</p> <p>CHAR 适合存储很短的字符串, 或者所有值都接近同一个长度. 例如, CHAR 非常适合存储密码的 MD5 值, 因为这是一个定长的值. 对于经常变更的数据, CHAR 也比 VARCHAR 更好, 因为定长的 CHAR 类型不容易产生碎片.</p> <h4 id="blob与text"><a href="#blob与text" class="header-anchor">#</a> BLOB与TEXT</h4> <p>BLOB 和 TEXT 都是为存储很大的数据而设计的字符串数据类型, 分别采用二进制和字符方式存储.</p> <p>MySQL 不能将 BLOB 和 TEXT 列全部长度的字符串进行索引, 也不能使用这些索引消除排序.</p> <p>尽量少用 BLOB 和 TEXT, 如果实在要用可以考虑将 BLOB 和 TEXT 字段单独存一张表, 用 id 关联, 或者把大量数据放到 OSS 中.</p> <p>BLOB 和 TEXT 都不能有默认值.</p> <h3 id="查询性能优化"><a href="#查询性能优化" class="header-anchor">#</a> 查询性能优化</h3> <h4 id="查询优化"><a href="#查询优化" class="header-anchor">#</a> 查询优化</h4> <h5 id="_1-优化数据访问"><a href="#_1-优化数据访问" class="header-anchor">#</a> 1.优化数据访问</h5> <h6 id="_1-减少请求数据量"><a href="#_1-减少请求数据量" class="header-anchor">#</a> (1)减少请求数据量</h6> <p>查询性能低下最基本的原因是访问的数据太多. 确认应用程序是否在检索大量超过需要的数据. 这通常意味着访问了太多的行, 但有时候也可能是访问了太多的列.</p> <ul><li>只返回<strong>必要的列</strong>: 最好<strong>不要使用 &quot;SELECT *&quot; 语句, 而只查询需要的字段, 使用</strong>覆盖索引.</li> <li>只返回<strong>必要的行</strong>: 使用 <strong>LIMIT</strong> 限制返回的数据量. 可以自己封装一层默认加上 LIMIT 参数.</li> <li><strong>缓存</strong>重复查询的数据: 使用<strong>缓存</strong>可以避免在数据库中进行查询, 缓存带来的查询性能提升将会非常明显.</li> <li><strong>禁止不带任何限制</strong>数据范围条件的查询语句. 比如: 当用户在查询订单历史的时候, 可以控制在一个月的范围内.</li></ul> <h6 id="_2-减少服务器端扫描行数"><a href="#_2-减少服务器端扫描行数" class="header-anchor">#</a> (2)减少服务器端扫描行数</h6> <p>最有效的方式是<strong>使用索引来覆盖查询</strong>.</p> <h5 id="_2-重构查询方式"><a href="#_2-重构查询方式" class="header-anchor">#</a> 2.重构查询方式</h5> <h6 id="_1-切分大查询"><a href="#_1-切分大查询" class="header-anchor">#</a> (1)切分大查询</h6> <p>一个<strong>大查询</strong>如果<strong>一次性执行</strong>的话, 可能一次<strong>锁住</strong>很多数据, 导致占满整个事务日志, 耗尽系统资源, 阻塞很多小但重要的查询.</p> <p>有时候对于一个大查询可以&quot;分而治之&quot;, 将大查询切分成小查询, 每个查询功能完全一样, 只完成一小部分, 每次只返回一小部分查询结果.</p> <p>比如删除数据.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> messages <span class="token keyword">WHERE</span> createTime <span class="token operator">&lt;</span> DATE_SUB<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">3</span> <span class="token keyword">MONTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>切分一下:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>rows_affected <span class="token operator">=</span> <span class="token number">0</span>
do <span class="token punctuation">{</span>
    rows_affected <span class="token operator">=</span> do_query<span class="token punctuation">(</span>
        <span class="token string">&quot;DELETE FROM messages WHERE create  &lt; DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> rows_affected <span class="token operator">&gt;</span> <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h6 id="_2-分解联结查询"><a href="#_2-分解联结查询" class="header-anchor">#</a> (2)分解联结查询</h6> <p>将一个<strong>联结</strong>查询分解成对每一个表进行<strong>一次单表查询</strong>, 然后在<strong>应用程序中进行关联</strong>, 这样做的好处有: (1) 减少锁竞争; (2) 在<strong>应用层进行联结</strong>, 可以更容易对数据库进行拆分, 从而更容易做到高性能和可伸缩(阿里推荐).</p> <h5 id="_3-范围查询优化"><a href="#_3-范围查询优化" class="header-anchor">#</a> 3.范围查询优化</h5> <p>MySQL 内部优化器会<strong>根据检索比例, 表大小等多个因素整体评估是否使用索引</strong>. 如果使用范围查询, 可能会因为<strong>范围问题</strong>使得优化器觉得全表扫描的效率还高, 进而使得索引失效. 具体的情况还得靠优化器根据实际场景自己分析.</p> <p><strong>例 1</strong>: 给年龄添加单值索引.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>idx_age<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面的<strong>范围查询</strong>, 实际上<strong>没有走索引</strong>.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> age <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">AND</span> age <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>本例可能是由于单次数据量<strong>查询过大</strong>导致优化器最终选择不走索引.</p> <p>优化方法: <strong>可以将大的范围拆分成多个小范围</strong>. 比如改成下面的两个范围查询, 可能就会走索引.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> age <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">AND</span> age <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> age <span class="token operator">&gt;=</span> <span class="token number">1001</span> <span class="token operator">AND</span> age <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>例 2</strong>: 看下面的 SQL 语句执行后是没走索引的.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> name <span class="token operator">&gt;</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果用 name 索引需要遍历 name 字段<strong>联合索引树</strong>, 然后还需要根据<strong>遍历出来的主键值</strong>去主键索引树里再去查出最终数据, 相当于<strong>遍历了两棵索引树</strong>(一颗联合索引树, 一颗主键聚簇索引树), 成本比全表扫描还高, 所以就不走索引了.</p> <p>可以用<strong>覆盖索引</strong>优化, 这样<strong>只需要遍历 name 字段</strong>的<strong>联合索引树</strong>就能拿到所有结果, 如下:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> age <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> name <span class="token operator">&gt;</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>再看下面的 SQL. 这一条其实跟上面的类似, 只是 name 的范围不同, 这里 MySQL 发现这里数据量较少, 于是<strong>走了索引</strong>. 这里就是引擎执行的<strong>过程中</strong>根据数据情况进行优化.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> name <span class="token operator">&gt;</span> <span class="token string">'zzz'</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_4-排序优化-order-by"><a href="#_4-排序优化-order-by" class="header-anchor">#</a> 4.排序优化(ORDER BY)</h5> <h6 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> (1)概述</h6> <p>MySQL 支持两种排序方式: <strong>index 和 filesort</strong>. Using index 指 MySQL <strong>扫描索引</strong>本身完成排序, 效率高; <strong>filesort 即加载数据</strong>之后再进行<strong>重新排序</strong>, 效率低.</p> <p>ORDER BY 满足两种情况会使用 <strong>Using index</strong>.</p> <ul><li>ORDER BY 语句使用<strong>索引最左前列</strong>.</li> <li>使用 WHERE 子句与 ORDER BY子句<strong>条件列组合满足索引最左前列</strong>.</li></ul> <p>所以尽量在<strong>索引列上完成排序</strong>, 遵循<strong>最左前缀法则</strong>. 如果 ORDER BY 的<strong>条件不在索引列上</strong>, 就会产生 <strong>Using filesort</strong>. 所以能用覆盖索引尽量用覆盖索引.</p> <p>GROUP BY 与 ORDER BY 很类似, 其实质是<strong>先排序后分组</strong>, 遵照索引创建顺序的<strong>最左前缀法则</strong>. 对于 GROUP BY 的优化如果不需要排序的可以<strong>加上 OEDER BY NULL 禁止排序</strong>. 注意, <strong>WHERE 筛选先于 HAVING</strong>, 能写在 WHERE 中的限定条件就不要去用 HAVING 限定.</p> <h6 id="_2-文件排序-filesort"><a href="#_2-文件排序-filesort" class="header-anchor">#</a> (2)文件排序(filesort)</h6> <p>当<strong>不能使用索引生成排序结果</strong>的时候, MySQL 需要自己进行排序, 如果数据量小则在内存中进行, 如果数据量大则需要使用磁盘排序, 不过 MySQL 将这个过程统一称为<strong>文件排序(filesort)</strong>, 即使完全是内存排序不需要磁盘文件时也叫文件排序.</p> <p>当查询数据后, 如果需要排序的<strong>数据量小于 &quot;排序缓冲区(Sort Buffer, 这是一块内存区域)&quot;</strong>, MySQL 将使用此<strong>内存</strong>进行 &quot;快速排序&quot; 操作. 如果内存不够排序, 那么 MySQL 会先将数据分块, 对每个独立的块使用 &quot;快速排序&quot; 进行排序, 并将各个块的排序结果存放在磁盘上, 然后将各个排好序的块进行合并(merge), 最后返回排序结果.</p> <p>filesort 排序算法有:</p> <ul><li><strong>双路排序</strong>(又叫回表排序): 首先根据相应的条件<strong>仅取出需要排序的字段和数据行 ID</strong>, 然后在 <strong>sort buffer</strong> 中进行排序, 排序完后需要<strong>再次回表查询得到其它需要的字段</strong>. 由于只把一部分数据加载到内存排序, 所以占用的内存小一点, 但是排序完成需要回表查询.</li> <li><strong>单路排序</strong>: 一次性取出满足条件行的<strong>所有字段</strong>, 然后在 <strong>sort buffer(排序缓冲区)</strong> 中进行排序. 由于把全部需要的数据都加载到了内存, 所以占用内存较大, 但是排序完成后不需要进行回表了.</li></ul> <p>MySQL 通过比较系统变量 <strong>max_length_for_sort_data ​</strong>(默认 1024 字节) 的大小和需要查询的字段总大小来判断使用哪种排序模式.</p> <ul><li>如果 max_length_for_sort_data 比查询字段的总长度<strong>小</strong>, 使用<strong>双路排序</strong>模式.</li> <li>如果 max_length_for_sort_data 比查询字段的总长度<strong>大</strong>, 使用<strong>单路排序</strong>模式.</li></ul> <p>其实就是如果需要回表的数据行太多或者字段较多, 双路排序的内存开销已经接近单路排序了, 这时候还不如直接用单路排序减少一次回表查询.</p> <p>如果<strong>使用了 filesort</strong>, 那么 <strong>trace</strong> 工具的分析结果中会有 <strong>filesort_summary</strong> 的信息. 双路排序的 sort_mode 信息里显示 &lt;sort_key, rowid&gt;. 单路排序时 sort_mode 信息里显示 &lt;sort_key, additional_fields&gt; 或 &lt;sort_key, packed_additional_fields&gt;.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;filesort_summary&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token property">&quot;rows&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>          <span class="token comment">// 预计扫描行数</span>
    <span class="token property">&quot;examined_rows&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token comment">// 参数排序的行</span>
    <span class="token property">&quot;number_of_tmp_files&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;sort_buffer_size&quot;</span><span class="token operator">:</span> <span class="token number">262056</span><span class="token punctuation">,</span> <span class="token comment">// 排序缓存的大小</span>
    <span class="token property">&quot;sort_mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;sort_key, packed_additional_fields&gt;&quot;</span> <span class="token comment">// 排序方式, 这里用的单路排序</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果内存不够用时, 可能使用磁盘排序. number_of_tmp_files 表示使用的<strong>临时文件</strong>数, 如果值为 0 代表全部使用 <strong>sort_buffer 进行内存排序</strong>, 否则使用磁盘文件排序.</p> <p>查询例子如下:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Tom'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> position<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>双路排序</strong>过程:</p> <ul><li>从索引 name 找到第一个满足 name = 'Tom' 的主键 <strong>id.</strong></li> <li>根据主键 id 取出排序字段 position 和主键 id 这<strong>两个字段</strong>放到 sort buffer 中.</li> <li>从索引 name 取下一个满足 name = 'Tom' 记录的主键 id.</li> <li>重复上述步骤直到不满足 name = 'Tom'.</li> <li>对 <strong>sort_buffer 中的字段 position 和主键 id 按照字段 position 进行排序</strong>.</li> <li>遍历排序好的 id 和字段 position, 按照 id 的值<strong>回到原表</strong>中取出所有字段的值返回给客户端.</li></ul> <p><strong>单路排序</strong>过程:</p> <ul><li>从索引 name 找到第一个满足 name = 'Tom' 条件的主键 id.</li> <li>根据主键 id 取出<strong>整行</strong>, 取出所有字段的值, 存入 <strong>sort_buffer</strong> 中.</li> <li>从索引 name 找到下一个满足 name = 'Tom' 条件的主键 id.</li> <li>重复上述步骤直到不满足 name = 'Tom'.</li> <li>对 sort_buffer 中的数据按照字段 position 进行排序.</li> <li>返回结果给客户端.</li></ul> <p>对比两个排序模式, <strong>单路排序</strong>会把所有需要查询的字段<strong>都放到 sort buffer</strong> 中, 而双路排序只会把<strong>主键和需要排序的字段</strong>放到 sort buffer 中进行排序, 然后再通过主键<strong>回到原表</strong>查询需要的字段.</p> <p>如果 MySQL <strong>排序内存比较小</strong>并且没有条件继续增加了, 可以适当把 <strong>max_length_for_sort_data</strong> 配置小点, 让优化器选择使用双路排序算法, 可以在 sort_buffer 中一次排序更多的行, 只是需要<strong>再根据主键回到原表取数据</strong>.</p> <p>如果 MySQL <strong>排序内存</strong>有条件可以配置比较大, 可以适当增大 <strong>max_length_for_sort_data</strong> 的值, 让优化器优先选择全字段排序(单路排序), 把需要的字段放到 sort_buffer 中, 这样排序后就能直接从<strong>内存</strong>里返回查询结果.</p> <p>所以 MySQL 通过 <strong>max_length_for_sort_data</strong> 这个参数来控制排序, 在不同场景使用不同的排序模式, 从而提升排序效率.</p> <p>注意, 如果<strong>全部使用 sort_buffer 内存排序一般情况下效率会高于磁盘文件排序</strong>, 但不能因为这个就随便增大 sort_buffer(默认 1M), MySQL 很多参数设置都是做过优化的, 不要轻易调整.</p> <h5 id="_5-分页查询优化"><a href="#_5-分页查询优化" class="header-anchor">#</a> 5.分页查询优化</h5> <p>一个常见的分页查询:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">LIMIT</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>表示从表 employees 中取出<strong>从 10001 行开始的 10 行记录</strong>. 如果<strong>没有索引</strong>, 这里看似只查询了 10 条记录, 实际这条 SQL 是<strong>先读取 10010 条记录</strong>, 然后<strong>抛弃</strong>前 10000 条记录, 然后读到后面 10 条想要的数据. 因此要查询一张大表比较靠后的数据, 执行效率是非常低的.</p> <p>优化此类分页查询的一个<strong>最简单的办法就是尽可能地使用索引覆盖扫描</strong>, 而不是查询所有的列. 然后根据需要做一次<strong>关联操作</strong>再返回所需的列. 比如使用主键来限定范围 (WHERE id &gt; 10000 LIMIT 10) 进行查找.</p> <p>看一个根据<strong>非主键字段排序</strong>的分页查询, SQL 如下:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> NAME <span class="token keyword">LIMIT</span> <span class="token number">90000</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>发现<strong>并没有使用 name 字段的索引</strong>(key 字段对应的值为 null), 具体原因是<strong>扫描整个索引并查找到没索引的行(<strong>​<strong><strong>可能要遍历多个索引树)的成本比扫描全表的成本更高, 所以优化器</strong></strong>​</strong>放弃使用索引</strong>.</p> <p>这里优化关键是让<strong>排序时返回的字段尽可能少</strong>, 所以可以<strong>让排序和分页操作先查出主键</strong>, 然后根据<strong>主键</strong>查到对应的记录, SQL 改写如下:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> employees <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> NAME <span class="token keyword">LIMIT</span> <span class="token number">90000</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> ed <span class="token keyword">ON</span> e<span class="token punctuation">.</span>id <span class="token operator">=</span> ed<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>观察<strong>执行计划</strong>之后可以发现, 原 SQL 使用的是 <strong>filesort 排序</strong>, 而优化后的 SQL 使用的是<strong>索引排序</strong>.</p> <h5 id="_6-join联结查询优化"><a href="#_6-join联结查询优化" class="header-anchor">#</a> 6.JOIN联结查询优化</h5> <p><strong>少用 JOIN, JOIN 操作一般都是放到业务层</strong>进行.</p> <p>建个表:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>b<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token comment"># 创建一个与 t1 表结构一样的表 t2</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t2 <span class="token operator">like</span> t1<span class="token punctuation">;</span>
<span class="token comment"># 然后在 t1 表插入 10000 行数据, 在 t2 表插入 100 条数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>MySQL 的<strong>表关联</strong>常见有两种算法:</p> <ul><li><strong>Nested-Loop Join</strong> 算法.</li> <li><strong>Block Nested-Loop Join</strong> 算法.</li></ul> <h6 id="_1-嵌套循环连接-nlj-算法"><a href="#_1-嵌套循环连接-nlj-算法" class="header-anchor">#</a> (1)嵌套循环连接(NLJ)算法</h6> <p>嵌套循环连接 (NLJ) 算法即<strong>一次一行循环</strong>地从第一张表(称为驱动表)中读取行, 在这行数据中取到关联字段, 根据关联字段在另一张表(被驱动表)里取出满足条件的行, 然后取出两张表的结果合集.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>a <span class="token operator">=</span> t2<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>驱动表是 t2</strong>, 被驱动表是 t1. <strong>先执行的就是驱动表</strong>(执行计划结果的 id 如果一样则按从上到下顺序执行 SQL); 优化器<strong>一般会优先选择小表做驱动表</strong>. 所以使用 INNER JOIN 时, 排在前面的表并不一定就是驱动表. 一般 JOIN 语句中, 如果执行计划 Extra 中未出现 Using join buffer 则表示使用的 JOIN 算法是 NLJ.</p> <p>上面 SQL 的大致流程如下:</p> <ul><li>从表 t2 中读取一行数据;</li> <li>从第 1 步的数据中, 取出关联字段 a, 到表 t1 中查找;</li> <li>取出表 t1 中满足条件的行, 跟 t2 中获取到的结果合并, 作为结果返回给客户端;</li> <li>重复上面 3 步.</li></ul> <p>整个过程会读取 t2 表的<strong>所有数据</strong>(扫描 100 行), 然后遍历这每行数据中<strong>字段 a 的值</strong>, 根据 t2 表中 a 的值索引扫描 t1 表中的对应行(扫描 100 次 t1 表的索引, 1 次扫描可以认为最终只扫描 t1 表一行完整数据, 也就是总共 t1 表也扫描了 100 行). 因此整个过程扫描了 200 行. 如果被驱动表的关联字段没索引, 使用 NLJ 算法<strong>性能会比较低</strong> (下面有详细解释), MySQL 会选择 Block Nested-Loop Join 算法.</p> <h6 id="_2-基于块的嵌套循环连接-bnl-算法"><a href="#_2-基于块的嵌套循环连接-bnl-算法" class="header-anchor">#</a> (2)基于块的嵌套循环连接(BNL)算法</h6> <p>把驱动表的数据读入到 <strong>join_buffer</strong> 中, 然后<strong>扫描被驱动表</strong>, 把被驱动表每一行取出来跟 join_buffer 中的数据做对比.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>b <span class="token operator">=</span> t2<span class="token punctuation">.</span>b<span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>EXPLAIN 结果的 Extra 字段中的 <strong>Using join buffer(Block Nested Loop)</strong> 说明该关联查询使用的是 <strong>BNL 算法</strong>.</p> <p>上面 SQL 的大致流程如下:</p> <ul><li>把 t2 的所有数据放入到 join_buffer 中</li> <li>把表 t1 中每一行取出来, 跟 join_buffer 中的数据做对比</li> <li>返回满足 join 条件的数据</li></ul> <p>整个过程对表 t1 和 t2 都做了<strong>一次全表扫描</strong>, 因此扫描的总行数为10000(表 t1 的数据总量) + 100(表 t2 的数据总量) = 10100. 并且 join_buffer 里的数据是<strong>无序</strong>的, 因此对表 t1 中的每一行, 都要做 <strong>100 次判断</strong>, 所以内存中的判断次数是 100 * 10000= <strong>100 万次</strong>.</p> <p>被驱动表的关联字段<strong>没索引</strong>为什么要选择<strong>使用 BNL 算法</strong>而不使用 Nested-Loop Join 呢?  如果上面第二条 SQL 使用 Nested-Loop Join, 那么扫描行数为 100 * 10000 = 100万次, 这个是<strong>磁盘扫描</strong>. 很显然, 用 BNL 磁盘扫描次数少很多, 相比于磁盘扫描, BNL 的<strong>内存计算</strong>会快得多. 因此 MySQL 对于被驱动表的<strong>关联字段没索引的关联查询, 一般都会使用 BNL 算法. 如果有索引一般选择 NLJ 算法, 有索引的情况下 NLJ 算法比 BNL算法性能更高.</strong></p> <h6 id="_3-联结查询优化建议"><a href="#_3-联结查询优化建议" class="header-anchor">#</a> (3)联结查询优化建议</h6> <p>对关联字段加<strong>索引</strong>, 然关联操作尽量走索引, 让 MySQL 做 JOIN 操作时尽量选择 <strong>NLJ 算法</strong>. 驱动表因为需要全部查询出来, 所以过滤的条件也尽量要走索引, 避免全表扫描, 总之能走索引的过滤条件尽量都走索引.</p> <p>让<strong>小表驱动大表</strong>, 写多表联结 SQL 时如果明确知道哪张表是小表可以用 <strong>straight_join</strong> 写法固定连接驱动方式, 省去 MySQL 优化器自己判断的时间. SRTAIGHT_JOIN 解释: SRTAIGHT_JOIN 功能同 JOIN 类似, 但<strong>能让左边的表来驱动右边的表</strong>, 能改表优化器对于联表查询的执行顺序. 比如: 代表制定 MySQL 选 t2 表作为驱动表. <strong>小表的判断方式</strong>: 在决定哪个表做驱动表的时候, 应该是两个表按照各自的条件过滤, 过滤完成之后, 计算参与 JOIN 的各个字段的总数据量, 数据量小的那个表, 就是 &quot;小表&quot;, 应该作为驱动表.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t2 SRTAIGHT_JOIN t1 <span class="token keyword">ON</span> t2<span class="token punctuation">.</span>a <span class="token operator">=</span> t1<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_7-count-查询优化"><a href="#_7-count-查询优化" class="header-anchor">#</a> 7.count(*)查询优化</h5> <p>对于下面的语句.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>四个 SQL 的<strong>执行计划一样</strong>, 说明这四个 SQL 执行效率应该<strong>差不多</strong>, 区别在于根据某个字段 count <strong>会不会统计字段为 NULL 值的数据行</strong>.</p> <p><strong>常见优化方法:</strong></p> <ul><li>查询 MySQL <strong>自己维护的总行数</strong>. 对于 MyISAM 存储引擎的表做不带 WHERE 条件的 count 查询性能很高, 因为 MyISAM 存储引擎的表的<strong>总行数</strong>会被 MySQL 存储在磁盘上, 查询不需要计算. 对于 InnoDB 存储引擎的表 MySQL 不会存储表的总记录行数(因为有 MVCC 机制), 查询 count 需要<strong>实时计算</strong>.</li> <li>将<strong>总数</strong>维护到 <strong>Redis 里</strong>. 插入或删除表数据行的时候同时维护 Redis 里的表总行数 key 的计数值(用 INCR 或 DECR 命令). 但这可能存在数据不一致.</li></ul> <h5 id="_8-group-by优化"><a href="#_8-group-by优化" class="header-anchor">#</a> 8.GROUP BY优化</h5> <p>在MySQL中, 当无法使用索引的时候, GROUP BY使用两种策略来完成: 使用临时表或者文件排序来做分组. 为了避免文件排序, 可以使用索引来优化, 这也是最有效的优化办法.</p> <h4 id="分库分表"><a href="#分库分表" class="header-anchor">#</a> 分库分表</h4> <p>当 MySQL <strong>单表记录数过大</strong>时, 数据库的性能会明显下降, 可以进行分库分表操作. 分表可以进行水平切分与垂直切分.</p> <h5 id="_1-垂直切分"><a href="#_1-垂直切分" class="header-anchor">#</a> 1.垂直切分</h5> <p><strong>根据数据表的相关性进行拆分</strong>.</p> <p>例如, 用户表中既有用户登录信息又有用户基本信息, 可以将用户不同信息拆分成两个单独的表, 甚至放到单独的库做分库. <strong>简单来说垂直拆分是指数据表列的拆分, 把一张列比较多的表拆分为多张表</strong>. 通常是按照列的<strong>关系密集程度</strong>进行切分, 也可以利用垂直切分将<strong>经常被使用的列和不经常被使用的列</strong>切分到不同的表中.</p> <div><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210905104435153.png" alt="image-20210905104435153" style="zoom:36%;"></div> <p>如果一个表中某个字段的<strong>内容长度过长</strong>, 通常需要单独切分出去, 比如 TEXT 类型的字段, 可以考虑单独切分.</p> <ul><li><strong>垂直拆分的优点</strong>: 可以使得列数据变小, 在查询时减少读取的 Block 数, 减少 I/O 次数. 垂直分区可以简化表的结构, 易于维护.</li> <li><strong>垂直拆分的缺点</strong>: <strong>主键会出现冗余</strong>, 需要管理冗余列, 可能引起 <strong>JOIN 操作</strong>, 可以通过在<strong>应用层进行 JOIN</strong> 来解决. 垂直分区会让事务变得更加复杂.</li></ul> <h5 id="_2-水平切分"><a href="#_2-水平切分" class="header-anchor">#</a> 2.水平切分</h5> <p>水平切分(<strong>Sharding</strong>)指保持数据<strong>表结构不变</strong>, 通过某种<strong>策略存储数据分片</strong>.</p> <p>水平切分后每一片数据分散到不同的<strong>数据表或库</strong>中, 达到分布式的目的. 水平拆分后所有库表的数据加起来就是全部数据. 水平拆分将数据均匀放更多的库里, 用<strong>多个库</strong>来扛更高的并发, 还有就是用多个库的存储容量来进行<strong>扩容</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210905104714465.png" alt="image-20210905104714465"></p> <p>当一个表的数据不断增多时, Sharding 是必然的选择, 它可以将数据分布到<strong>集群</strong>的不同节点上, 从而缓解<strong>单个数据库</strong>的压力. 数据量小的时候不用拆分, 因为拆分会带来<strong>逻辑, 部署, 运维的各种复杂度</strong>, 一般的数据表在优化得当的情况下支撑千万以下的数据量是没有太大问题的.</p> <p>需要注意: 分表仅仅是<strong>解决了单一表数据过大</strong>的问题, 但由于表的数据还是在<strong>同一台机器</strong>上, 这对于提升 MySQL 并发能力没有什么意义, 所以<strong>水平拆分通常也要分库</strong>.</p> <p>一个典型的分表逻辑, 根据主键而分成 64 张表.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>id <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">64</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以下是数据库分片的两种常见实现方案:</p> <ul><li><strong>客户端代理: ​</strong>​<strong><strong>分片逻辑在</strong></strong>​<strong>应用端</strong>, 封装在 jar 包中, 通过修改或者封装 JDBC 层来实现. 如 <strong>Sharding-JDBC</strong> , 阿里的 <strong>TDDL</strong> 是两种比较常用的实现.</li> <li><strong>中间件代理:</strong> 在应用和数据中间加了一个<strong>代理层</strong>, 分片逻辑统一维护在<strong>中间件服务</strong>中. 如 <strong>Mycat</strong> , 360 的 <strong>Atlas</strong>, 网易的 <strong>DDB</strong> 等都是这种方案的实现.</li></ul> <h5 id="_3-sharding策略"><a href="#_3-sharding策略" class="header-anchor">#</a> 3.Sharding策略</h5> <p>水平切分可以有不同的策略.</p> <ul><li><strong>哈希取模</strong>: <strong>hash(key) % N</strong>.</li> <li><strong>范围</strong>: 可以是 <strong>ID 范围</strong>也可以是<strong>时间范围</strong>.</li> <li><strong>映射表</strong>: 使用<strong>单独</strong>的一个数据库来存储映射关系.</li> <li><strong>根据字段特点分</strong>: 比如主键是<strong>身份证号</strong>, 就可以根据身份证号的特点来依据地域或者出生年月分. 但需要考虑数据的分布情况.</li></ul> <p>需要注意的是有些策略很容易产生<strong>热点问题</strong>, 导致大量的流量全部打到一个表上.</p> <h5 id="_4-sharding的问题"><a href="#_4-sharding的问题" class="header-anchor">#</a> 4.Sharding的问题</h5> <h6 id="_1-事务问题"><a href="#_1-事务问题" class="header-anchor">#</a> (1)事务问题</h6> <p>使用<strong>分布式事务</strong>来解决, 比如 <strong>XA 接口</strong>.</p> <h6 id="_2-联结"><a href="#_2-联结" class="header-anchor">#</a> (2)联结</h6> <p>可以将原来的连接分解成<strong>多个单表查询</strong>, 然后在<strong>用户程序</strong>中进行<strong>联结</strong>.</p> <h6 id="_3-id唯一性"><a href="#_3-id唯一性" class="header-anchor">#</a> (3)ID唯一性</h6> <ul><li>使用<strong>全局唯一 ID(GUID)</strong>.</li> <li>为每个<strong>分片指定一个 ID 范围.</strong></li> <li><strong>分布式 ID 生成器</strong>(如 <strong>Snowflake</strong> 算法).</li></ul> <h5 id="_5-分布式id"><a href="#_5-分布式id" class="header-anchor">#</a> 5.分布式ID</h5> <p>分成多个表之后, 如果每个表都是从 1 开始自增就不对, 需要一个<strong>全局唯一的 id</strong> 来支持. 生成全局 ID 有下面这几种方式:</p> <h6 id="_1-uuid"><a href="#_1-uuid" class="header-anchor">#</a> (1)UUID</h6> <p>UUID 是<strong>无序</strong>的, 会导致 B+ 树索引在写的时候有过多的随机写操作, 性能下降明显. 此外 UUID 太长了, 占用空间大. 因此 UUID <strong>不适合</strong>作为主键.</p> <h6 id="_2-数据库自增id"><a href="#_2-数据库自增id" class="header-anchor">#</a> (2)数据库自增ID</h6> <p>两个数据库分别<strong>设置不同步长</strong>, 生成不重复 ID 的策略. 虽然这样生成的 ID 有序, 但是需要独立部署数据库实例, 且难以进行水平扩展.</p> <h6 id="_3-redis生成id"><a href="#_3-redis生成id" class="header-anchor">#</a> (3)Redis生成ID</h6> <p>性能比较好, 灵活方便, 不依赖于数据库. 但是引入了新的组件造成系统更加复杂, 可用性降低, 编码更加复杂, 增加了系统成本.</p> <h6 id="_4-leaf"><a href="#_4-leaf" class="header-anchor">#</a> (4)Leaf</h6> <p>Leaf 是美团开源的分布式 ID 生成器, 能保证全局唯一性, 趋势递增, 单调递增, 信息安全, 里面也提到了几种分布式方案的对比, 但也需要依赖关系数据库, <strong>Zookeeper</strong> 等中间件.</p> <p>参考美团技术团队的一篇文章: <a href="https://tech.meituan.com/2017/04/21/mt-leaf.html" target="_blank" rel="noopener noreferrer">https://tech.meituan.com/2017/04/21/mt-leaf.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> .</p> <h6 id="_5-雪花算法"><a href="#_5-雪花算法" class="header-anchor">#</a> (5)雪花算法</h6> <p>Github 地址: <a href="https://github.com/twitter-archive/snowflake" target="_blank" rel="noopener noreferrer">https://github.com/twitter-archive/snowflake<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Snowflake 算法是 Twitter 开源的<strong>分布式 ID 生成算法</strong>, 它可支持一般每秒几万并发的场景.</p> <p>雪花算法生成一个 <strong>64 位的 long 型的 ID</strong>, 1 个 bit 是不用的, 用其中 41 bits 作为<strong>毫秒数</strong>, 用 10 bits 作为<strong>工作机器 id</strong>, 12 bits 作为<strong>序列号</strong>.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">0</span> <span class="token operator">|</span> <span class="token number">0001100</span> <span class="token number">10100010</span> <span class="token number">10111110</span> <span class="token number">10001001</span> <span class="token number">01011100</span> <span class="token number">00</span> <span class="token operator">|</span> <span class="token number">10001</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token number">1001</span> <span class="token operator">|</span> <span class="token number">0000</span> <span class="token number">00000000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>具体含义:</p> <ul><li><strong>1 bit</strong>: <strong>不用</strong>. 因为二进制里第一个 bit 为如果是 1, 那么都是负数, 但是生成的 id 都是正数, 所以第一个 bit 统一为 0.</li> <li><strong>41 bits</strong>: <strong>表示的是时间戳</strong>, 单位是<strong>毫秒</strong>. 41 bits 可以表示的数字多达 &quot;2^41 - 1&quot; 毫秒, 即 69 年.</li> <li><strong>10 bits</strong>: <strong>记录工作机器 id</strong>. 代表这个服务最多可以部署在 2^10 台机器上. 但 10 bits 里 5 个 bits 代表机房 id, 5 个 bits 代表机器 id. 意思就是最多代表 2^5(32) 个机房, 每个机房里可以部署 2^5(32) 个机器.</li> <li><strong>12 bits</strong>: <strong>这个是用来记录同一个毫秒内产生的不同 id</strong>. 12 bits 可以代表的最大正整数是 &quot;2^12 = 4096&quot;, 所以 12 bits 代表的数字可以区分<strong>同一个毫秒内</strong>的 4096 个不同的 id.</li></ul> <h5 id="_6-分库分表中间件"><a href="#_6-分库分表中间件" class="header-anchor">#</a> 6.分库分表中间件</h5> <p>常见的分库分表中间件有: Sharding-JDBC, Mycat, Cobar, TDDL, Atlas 等. 这些中间件可以在分库分表之后, <strong>根据指定的某个字段值</strong>如 userId, <strong>自动路由到对应的库与表上去</strong>.</p> <h6 id="_1-sharding-jdbc"><a href="#_1-sharding-jdbc" class="header-anchor">#</a> (1)Sharding-JDBC</h6> <p>属于 <strong>client 层</strong>方案, 是 <strong>ShardingSphere 的 client 层方案</strong>, 这种方案的<strong>优点在于不用部署, 运维成本低, 不需要代理层的二次转发请求, 性能很高</strong>. 但如果遇到升级时需要各个系统都重新升级版本再发布, 各个系统都需要<strong>耦合</strong> Sharding-JDBC 的依赖.</p> <h6 id="_2-mycat"><a href="#_2-mycat" class="header-anchor">#</a> (2)Mycat</h6> <p>属于 <strong>Proxy 层</strong>方案, 功能<strong>非常完善</strong>. 这种 <strong>Proxy 层</strong>方案的<strong>缺点在于需要部署</strong>, 自己运维一套中间件, 运维成本高. <strong>好处在于对于各个项目是透明的</strong>, 如果遇到升级之类的都是中间件的事.</p> <h6 id="_3-选型"><a href="#_3-选型" class="header-anchor">#</a> (3)选型</h6> <p>建议<strong>中小型公司选用 Sharding-JDBC</strong>, client 层方案轻便, 而且维护成本低, 不需要额外增派人手, 而且中小型公司系统复杂度会低一些, 项目也没那么多.</p> <p><strong>中大型公司可以选用 Mycat 这类 Proxy 层</strong>方案, 大公司可以有专门团队研究和维护 Mycat, 大量项目直接透明使用即可.</p> <h3 id="mysql服务器优化"><a href="#mysql服务器优化" class="header-anchor">#</a> MySQL服务器优化</h3> <h4 id="mysql参数配置"><a href="#mysql参数配置" class="header-anchor">#</a> MySQL参数配置</h4> <p>可以通过<strong>配置文件</strong>设置一些参数控制 MySQL 的行为. 配置项可以有多个作用域. 有些设置是服务器级的(全局作用域), 有些对每个连接是不同的(会话作用域), 剩下的一些是对象级的.</p> <p>如果在服务器运行时修改了变量的全局值, 这个值对当前会话和其他任何已经存在的会话都<strong>不起效果</strong>, 这是因为会话的变量值是在连接创建时从全局值初始化来的.</p> <p>InnoDB 在大多数情况下如果要运行得很好, 配置大小合适的**缓冲池(Buffer Pool)和日志文件(Log File)**是必须的, 默认值都太小了. 因此, 对 InnoDB 来说, 最重要的两个参数是:</p> <ul><li><strong>innodb_buffer_pool_size</strong></li> <li><strong>innodb_log_file_size</strong></li></ul> <p>下面是一些常见的配置参数:</p> <blockquote><p>innodb_buffer_pool_size=40G</p></blockquote> <p>InnoDB 存储引擎 buffer pool 缓存池大小, 一般为物理内存的 60%-70%.</p> <blockquote><p>innodb_log_file_size</p></blockquote> <p>MySQL 的 InnoDB 存储引擎使用一个指定大小的 Redo log 空间(一个环形的数据结构). Redo log 的空间通过innodb_log_file_size 和 innodb_log_files_in_group(默认 2)参数来调节. 将这俩参数相乘即可得到总的可用 Redo log 空间. 多数情况下通过 innodb_log_file_size 来调节即可.</p> <blockquote><p>max_connections=3000</p></blockquote> <p>连接的创建和销毁都需要系统资源, 比如内存, 文件句柄, 业务说的支持多少并发, 指的是每秒请求数, 也就是 QPS.</p> <p>一个连接最少占用内存是 256 K, 最大是 64 M, 如果一个连接的请求数据超过 64MB(比如排序), 就会申请临时空间, 放到硬盘上.</p> <p>如果 3000 个用户同时连上 MySQL, 最小需要内存 3000 * 256KB = 750M*, ​*最大需要内存 3000 * 64MB = 192G.</p> <p>如果 innodb_buffer_pool_size 是 40GB, 给操作系统分配 4G, 给连接使用的最大内存不到 20G, 如果连接过多, 使用的内存超过 20G, 将会产生磁盘 SWAP, 此时将会影响性能. <strong>连接数过高, 不一定带来吞吐量的提高, 而且可能占用更多的系统资源</strong>.</p> <blockquote><p>max_user_connections=2980</p></blockquote> <p>允许用户连接的最大数量, 剩余连接数用作 DBA 管理.</p> <blockquote><p>back_log=300</p></blockquote> <p>MySQL 能够暂存的连接数量. 如果 MySQL 的连接数达到 max_connections 时, 新的请求将会被存在堆栈中, 等待某一连接释放资源, 该堆栈数量即 back_log, 如果等待连接的数量超过 back_log, 将被拒绝.</p> <blockquote><p>wait_timeout=300</p></blockquote> <p>指应用通过 JDBC 连接 MySQL 进行操作完毕后, 空闲 300 秒后断开, 默认是 28800, 单位秒, 即 8 个小时.</p> <blockquote><p>interactive_timeout=300</p></blockquote> <p>指的是 MySQL client 连接 MySQL 进行操作完毕后, 空闲 300 秒后断开, 默认是 28800, 单位秒, 即 8 个小时.</p> <blockquote><p>innodb_thread_concurrency=64</p></blockquote> <p>此参数用来设置 InnoDB 线程的并发数, 默认值为 0 表示不被限制, <strong>若要设置则与服务器的 CPU 核心数相同或是 CPU 的核心数的 2 倍, 如果超过配置并发数, 则需要排队, 这个值不宜太大, 不然可能会导致线程之间锁争用严重</strong>, 影响性能.</p> <blockquote><p>innodb_lock_wait_timeout=10</p></blockquote> <p>行锁锁定时间, 默认 50s, 根据公司业务定, 没有标准值.</p> <blockquote><p>sort_buffer_size=4M</p></blockquote> <p>每个需要排序的线程分配该大小的一个缓冲区. 增加该值可以加速 ORDER BY 或 GROUP BY 操作.</p> <p>sort_buffer_size 是一个 connection 级的参数, 在每个 connection(session) 第一次需要使用这个 buffer 的时候, 一次性分配设置的内存.</p> <p>sort_buffer_size: 并不是越大越好, 由于是 connection 级的参数, 过大的设置 + 高并发可能会耗尽系统的内存资源. 例如: 500 个连接将会消耗 500 * sort_buffer_size(4M) = 2G.</p> <h4 id="内存配置"><a href="#内存配置" class="header-anchor">#</a> 内存配置</h4> <p>配置MySQL正确地使用内存量对高性能是至关重要的, 要根据需求来定制内存使用. 无法控制MySQL服务器运行, 解析查询, 以及其内部管理所消耗的内存, 但是为特定目的而使用多少内存则有很多参数可以控制.</p> <p>比较重要的内存配置需要的地方如下.</p> <h5 id="_1-innodb缓冲池"><a href="#_1-innodb缓冲池" class="header-anchor">#</a> 1.InnoDB缓冲池</h5> <p>如果大部分都是InnoDB表, InnoDB缓冲池(Buffer Pool)或许比其他任何东西更需要<strong>内存</strong>.</p> <p>InnoDB 缓冲池并不仅仅缓存索引: 它还会缓存行的数据, 自适应哈希索引, 插入缓冲(Insert Buffer), 锁, 以及其他内部数据结构. InnoDB还使用缓冲池来帮助延迟写入, 这样就能合并多个写入操作, 然后一起顺序地写回. 总之, InnoDB严重依赖缓冲池, 必须<strong>确认为它分配了足够的内存</strong>.</p> <h5 id="_2-线程缓存"><a href="#_2-线程缓存" class="header-anchor">#</a> 2.线程缓存</h5> <p>线程缓存保存那些当前没有与连接关联但是准备为后面新的连接服务的线程. 当一个新的连接创建时, 如果缓存中有线程存在, MySQL从缓存中删除一个线程, 并且把它分配给这个新的连接. 当连接关闭时, 如果线程缓存还有空间的话, MySQL又会把线程放回缓存. 如果没有空间的话, MySQL会销毁这个线程. 只要MySQL在缓存里还有空闲的线程, 它就可以迅速地响应连接请求, 因为这样就不用为每个连接创建新的线程.</p> <p>thread_cache_size变量指定了MySQL可以保持在缓存中的线程数.</p> <h4 id="io行为配置"><a href="#io行为配置" class="header-anchor">#</a> IO行为配置</h4> <h5 id="_1-innodb事务日志"><a href="#_1-innodb事务日志" class="header-anchor">#</a> 1.InnoDB事务日志</h5> <p>InnoDB使用日志来减少提交事务时的开销. 因为日志中已经记录了事务, 就无须在每个事务提交时把缓冲池的脏块刷新(flush)到磁盘中. 事务修改的数据和索引通常会映射到表空间的随机位置, 所以刷新这些变更到磁盘需要很多随机I/O. InnoDB假设使用的是常规磁盘(机械磁盘), 随机I/O比顺序I/O要昂贵得多, 因为一个I/O请求需要时间把磁头移到正确的位置, 然后等待磁盘上读出需要的部分, 再转到开始位置.</p> <p>InnoDB用日志把随机I/O变成顺序I/O. 一旦日志安全写到磁盘, 事务就持久化了, 即使变更还没写到数据文件. 如果一些糟糕的事情发生了(例如断电了), InnoDB可以重放日志并且恢复已经提交的事务.</p> <p>当然, InnoDB最后还是必须把变更写到数据文件, 因为日志有固定的大小. InnoDB的日志是环形方式写的: 当写到日志的尾部, 会重新跳转到开头继续写, 但不会覆盖还没应用到数据文件的日志记录, 因为这样做会清掉已提交事务的唯一持久化记录.</p> <p>InnoDB使用一个后台线程智能地刷新这些变更到数据文件. 这个线程可以批量组合写入, 使得数据写入更顺序, 以提高效率. 实际上, 事务日志把数据文件的随机I/O转换为几乎顺序的日志文件和数据文件I/O. 把刷新操作转移到后台使查询可以更快完成, 并且缓和查询高峰时I/O系统的压力.</p> <p>整体的日志文件大小受控于innodb_log_file_size和innodb_log_files_in_group两个参数, 这对写性能非常重要. 日志文件的总大小是每个文件的大小之和. 默认情况下, 只有两个5MB的文件, 总共10MB. 对高性能工作来说这太小了. 至少需要几百MB, 或者甚至上GB的日志文件.</p> <p>InnoDB使用多个文件作为一组循环日志. 通常不需要修改默认的日志数量, 只修改每个日志文件的大小即可. 要修改日志文件大小, 需要完全关闭MySQL, 将旧的日志文件移到其他地方保存, 重新配置参数, 然后重启. 一定要确保MySQL干净地关闭了, 或者还有日志文件可以保证需要应用到数据文件的事务记录, 否则数据库就无法恢复了! 当重启服务器的时候, 查看MySQL的错误日志. 在重启成功之后, 才可以删除旧的日志文件.</p> <p><strong>当InnoDB变更任何数据时, 会写一条变更记录到内存日志缓冲区</strong>. 在<strong>缓冲满的时候, 事务提交的时候, 或者每一秒钟</strong>, InnoDB都会刷写缓冲区的内容到磁盘日志文件——无论上述三个条件哪个先达到. 如果有大事务, 增加日志缓冲区(默认1MB)大小可以帮助减少I/O. 变量innodb_log_buffer_size可以控制日志缓冲区的大小.</p> <p>通常不需要把日志缓冲区设置得非常大. 推荐的范围是1MB～8MB, 一般来说足够了, 除非要写很多相当大的BLOB记录. 相对于InnoDB的普通数据, 日志条目是非常紧凑的. 它们不是基于页的, 所以不会浪费空间来一次存储整个页. InnoDB也使得日志条目尽可能地短.</p> <p>InnoDB怎样刷新日志缓冲? 当InnoDB把日志缓冲刷新到磁盘日志文件时, 先会使用一个Mutex锁住缓冲区, 刷新到所需要的位置, 然后移动剩下的条目到缓冲区的前面. 当Mutex释放时, 可能有超过一个事务已经准备好刷新其日志记录.</p> <p>日志缓冲必须被刷新到持久化存储, 以确保提交的事务完全被持久化了. 如果和持久相比更在乎性能, 可以修改innodb_flush_log_at_trx_commit变量来控制日志缓冲刷新的频繁程度. 可能的设置如下:</p> <ul><li><ol start="0"><li>把日志缓冲写到日志文件, 并且每秒钟刷新一次, 但是事务提交时不做任何事.</li></ol></li> <li><ol><li>将日志缓冲写到日志文件, 并且每次事务提交都刷新到持久化存储. 这是默认的(并且是最安全的)设置, 该设置能保证不会丢失任何已经提交的事务, 除非磁盘或者操作系统是“伪”刷新.</li></ol></li> <li><ol start="2"><li>每次提交时把日志缓冲写到日志文件, 但是并不刷新. InnoDB每秒钟做一次刷新. 0与2最重要的不同是(也是为什么2是更合适的设置), 如果MySQL进程“挂了”,  2不会丢失任何事务. 如果整个服务器“挂了”或者断电了, 则还是可能会丢失一些事务.</li></ol></li></ul> <p>了解清楚“把日志缓冲写到日志文件”和“把日志刷新到持久化存储”之间的不同是很重要的. 在大部分操作系统中, 把缓冲写到日志只是简单地把数据从InnoDB的内存缓冲转移到了操作系统的缓存, 也是在内存里, 并没有真的把数据写到了持久化存储.</p> <p>因此, 如果MySQL崩溃了或者电源断电了, 设置0和2通常会导致最多一秒的数据丢失, 因为数据可能只存在于操作系统的缓存. 我们说“通常”, 因为不论如何InnoDB会每秒尝试刷新日志文件到磁盘, 但是在一些场景下也可能丢失超过1秒的事务, 例如当刷新被推迟了. 与此相反, 把日志刷新到持久化存储意味着InnoDB请求操作系统把数据刷出缓存, 并且确认写到磁盘了. 这是一个阻塞I/O的调用, 直到数据被完全写回才会完成. 因为写数据到磁盘比较慢, 当innodb_flush_log_at_trx_commit被设置为1时, 可能明显地降低InnoDB每秒可以提交的事务数.</p> <p>设置innodb_flush_log_at_trx_commit为不为1的值可能导致丢失事务. <strong>高性能事务处理</strong>需要的最佳配置是把innodb_flush_log_at_trx_commit设置为1且把日志文件放到一个有电池保护的写缓存的RAID卷中. 这兼顾了安全和速度.</p> <h4 id="并发配置"><a href="#并发配置" class="header-anchor">#</a> 并发配置</h4> <h5 id="_1-innodb并发配置"><a href="#_1-innodb并发配置" class="header-anchor">#</a> 1.InnoDB并发配置</h5> <p>最基本的限制并发的方式是使用innodb_thread_concurrency变量, 它会限制一次性可以有多少线程进入内核, 0表示不限制.</p> <p>经验公式:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>并发值 = CPU数量 * 磁盘数量 * 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果已经进入内核的线程超过了允许的数量, 新的线程就无法再进入内核. InnoDB使用两段处理来尝试让线程尽可能高效地进入内核. 两段策略减少了因操作系统调度引起的上下文切换. 线程第一次休眠innodb_thread_sleep_delay微秒, 然后再重试. 如果它依然不能进入内核, 则放入一个等待线程队列, 让操作系统来处理.</p> <h3 id="硬件优化"><a href="#硬件优化" class="header-anchor">#</a> 硬件优化</h3> <p>许多不同的硬件都可以影响MySQL的性能, 需要依靠 CPU, 内存, 硬盘和网络等资源, 这些都可以进行优化.</p> <p>应该分析应用是 IO 密集型还是 CPU 密集型, 然后据此选择合适的 CPU.</p> <h3 id="应用层优化"><a href="#应用层优化" class="header-anchor">#</a> 应用层优化</h3> <p>‍</p> <p>‍</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <ul><li>MySQL大表优化方案[<a href="https://segmentfault.com/a/1190000006158186" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000006158186<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>]</li> <li>如何设置innodb_log_file_size[<a href="https://blog.51cto.com/kaifly/2114068" target="_blank" rel="noopener noreferrer">https://blog.51cto.com/kaifly/2114068<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>]</li></ul> <p>‍</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/main/docs/20.开发/2300.数据库/303.MySQL优化.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/4dbe1f/" class="prev">MySQL索引</a></span> <span class="next"><a href="/pages/4afd3a/">MySQL锁机制与事务并发控制</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f90282/"><div>
            基础
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/0f75ac/"><div>
            搜索二叉树BST
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/39721f/"><div>
            平衡二叉树AVL
            <!----></div></a> <span class="date">06-08</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1174520425@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/nanodaemony" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>达尔文的猹 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.5bc2c979.js" defer></script><script src="/assets/js/2.eccd4273.js" defer></script><script src="/assets/js/181.b4744ee7.js" defer></script>
  </body>
</html>
