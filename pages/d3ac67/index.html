<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis集群 | Pangolin</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="大道至简">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.76d9f797.css" as="style"><link rel="preload" href="/assets/js/app.5bc2c979.js" as="script"><link rel="preload" href="/assets/js/2.eccd4273.js" as="script"><link rel="preload" href="/assets/js/232.26555358.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8038d8.js"><link rel="prefetch" href="/assets/js/100.db890b43.js"><link rel="prefetch" href="/assets/js/101.9b9a913e.js"><link rel="prefetch" href="/assets/js/102.b98098b4.js"><link rel="prefetch" href="/assets/js/103.20eafae5.js"><link rel="prefetch" href="/assets/js/104.5f942f86.js"><link rel="prefetch" href="/assets/js/105.a443c173.js"><link rel="prefetch" href="/assets/js/106.6530e112.js"><link rel="prefetch" href="/assets/js/107.7b05a1d1.js"><link rel="prefetch" href="/assets/js/108.8c45adc4.js"><link rel="prefetch" href="/assets/js/109.ea29e43c.js"><link rel="prefetch" href="/assets/js/11.8d2b228f.js"><link rel="prefetch" href="/assets/js/110.0765054b.js"><link rel="prefetch" href="/assets/js/111.ae06b85d.js"><link rel="prefetch" href="/assets/js/112.b27bb80e.js"><link rel="prefetch" href="/assets/js/113.592e5b3f.js"><link rel="prefetch" href="/assets/js/114.677c3c60.js"><link rel="prefetch" href="/assets/js/115.fb35062d.js"><link rel="prefetch" href="/assets/js/116.19de2d57.js"><link rel="prefetch" href="/assets/js/117.ac783334.js"><link rel="prefetch" href="/assets/js/118.06b27dd3.js"><link rel="prefetch" href="/assets/js/119.cf6bb932.js"><link rel="prefetch" href="/assets/js/12.8764d408.js"><link rel="prefetch" href="/assets/js/120.ba8e09a5.js"><link rel="prefetch" href="/assets/js/121.bc501a72.js"><link rel="prefetch" href="/assets/js/122.c9a3dd47.js"><link rel="prefetch" href="/assets/js/123.b474c20b.js"><link rel="prefetch" href="/assets/js/124.f405a8c5.js"><link rel="prefetch" href="/assets/js/125.24083f67.js"><link rel="prefetch" href="/assets/js/126.3c5c6c33.js"><link rel="prefetch" href="/assets/js/127.b561056f.js"><link rel="prefetch" href="/assets/js/128.58891fb1.js"><link rel="prefetch" href="/assets/js/129.5073fbfd.js"><link rel="prefetch" href="/assets/js/13.1034e1a1.js"><link rel="prefetch" href="/assets/js/130.ca12ca1d.js"><link rel="prefetch" href="/assets/js/131.8e520e7f.js"><link rel="prefetch" href="/assets/js/132.0f186ee2.js"><link rel="prefetch" href="/assets/js/133.1d8479f7.js"><link rel="prefetch" href="/assets/js/134.9c30d69b.js"><link rel="prefetch" href="/assets/js/135.91463dab.js"><link rel="prefetch" href="/assets/js/136.5e57454a.js"><link rel="prefetch" href="/assets/js/137.1d4e51f0.js"><link rel="prefetch" href="/assets/js/138.6cd3ac7f.js"><link rel="prefetch" href="/assets/js/139.7bd789a6.js"><link rel="prefetch" href="/assets/js/14.ead46968.js"><link rel="prefetch" href="/assets/js/140.e1d92390.js"><link rel="prefetch" href="/assets/js/141.23e11057.js"><link rel="prefetch" href="/assets/js/142.c8cc0f38.js"><link rel="prefetch" href="/assets/js/143.fc738cb7.js"><link rel="prefetch" href="/assets/js/144.67c64203.js"><link rel="prefetch" href="/assets/js/145.cc73ed45.js"><link rel="prefetch" href="/assets/js/146.adaac4c0.js"><link rel="prefetch" href="/assets/js/147.0e83b5c1.js"><link rel="prefetch" href="/assets/js/148.1f253a46.js"><link rel="prefetch" href="/assets/js/149.ab428593.js"><link rel="prefetch" href="/assets/js/15.198f32e1.js"><link rel="prefetch" href="/assets/js/150.64cd514e.js"><link rel="prefetch" href="/assets/js/151.ca1ae55a.js"><link rel="prefetch" href="/assets/js/152.4119b23d.js"><link rel="prefetch" href="/assets/js/153.ed663263.js"><link rel="prefetch" href="/assets/js/154.71b836f6.js"><link rel="prefetch" href="/assets/js/155.c47e2e88.js"><link rel="prefetch" href="/assets/js/156.3e91e0f4.js"><link rel="prefetch" href="/assets/js/157.811b1421.js"><link rel="prefetch" href="/assets/js/158.71193c19.js"><link rel="prefetch" href="/assets/js/159.f09778fd.js"><link rel="prefetch" href="/assets/js/16.03096de2.js"><link rel="prefetch" href="/assets/js/160.15d99de4.js"><link rel="prefetch" href="/assets/js/161.813166a0.js"><link rel="prefetch" href="/assets/js/162.c52bbf77.js"><link rel="prefetch" href="/assets/js/163.ada6991a.js"><link rel="prefetch" href="/assets/js/164.d8ceba57.js"><link rel="prefetch" href="/assets/js/165.a645ef3a.js"><link rel="prefetch" href="/assets/js/166.995d24ad.js"><link rel="prefetch" href="/assets/js/167.d7278e80.js"><link rel="prefetch" href="/assets/js/168.e388905a.js"><link rel="prefetch" href="/assets/js/169.52edabbb.js"><link rel="prefetch" href="/assets/js/17.a49f9c19.js"><link rel="prefetch" href="/assets/js/170.0b62c5b4.js"><link rel="prefetch" href="/assets/js/171.017c8997.js"><link rel="prefetch" href="/assets/js/172.f0763c39.js"><link rel="prefetch" href="/assets/js/173.c961bf43.js"><link rel="prefetch" href="/assets/js/174.395224c0.js"><link rel="prefetch" href="/assets/js/175.52fbdc96.js"><link rel="prefetch" href="/assets/js/176.14e0a3b2.js"><link rel="prefetch" href="/assets/js/177.78f7d89f.js"><link rel="prefetch" href="/assets/js/178.c08bdd65.js"><link rel="prefetch" href="/assets/js/179.b634397c.js"><link rel="prefetch" href="/assets/js/18.9786a034.js"><link rel="prefetch" href="/assets/js/180.284b6c99.js"><link rel="prefetch" href="/assets/js/181.b4744ee7.js"><link rel="prefetch" href="/assets/js/182.8bfd08cd.js"><link rel="prefetch" href="/assets/js/183.59b0b92b.js"><link rel="prefetch" href="/assets/js/184.a5fae95c.js"><link rel="prefetch" href="/assets/js/185.dcf55c72.js"><link rel="prefetch" href="/assets/js/186.6b1cf319.js"><link rel="prefetch" href="/assets/js/187.312708d0.js"><link rel="prefetch" href="/assets/js/188.71de21d0.js"><link rel="prefetch" href="/assets/js/189.7d72c108.js"><link rel="prefetch" href="/assets/js/19.089d6618.js"><link rel="prefetch" href="/assets/js/190.85dce0bd.js"><link rel="prefetch" href="/assets/js/191.08f7136b.js"><link rel="prefetch" href="/assets/js/192.6a155217.js"><link rel="prefetch" href="/assets/js/193.64f71670.js"><link rel="prefetch" href="/assets/js/194.c4d60c72.js"><link rel="prefetch" href="/assets/js/195.748850e9.js"><link rel="prefetch" href="/assets/js/196.887ef31c.js"><link rel="prefetch" href="/assets/js/197.4473c177.js"><link rel="prefetch" href="/assets/js/198.ea53a990.js"><link rel="prefetch" href="/assets/js/199.886f6490.js"><link rel="prefetch" href="/assets/js/20.a52783e8.js"><link rel="prefetch" href="/assets/js/200.7619a798.js"><link rel="prefetch" href="/assets/js/201.d3f5de5f.js"><link rel="prefetch" href="/assets/js/202.ed4c18cc.js"><link rel="prefetch" href="/assets/js/203.7937068e.js"><link rel="prefetch" href="/assets/js/204.3dbdd61c.js"><link rel="prefetch" href="/assets/js/205.52bc6fdf.js"><link rel="prefetch" href="/assets/js/206.4393998f.js"><link rel="prefetch" href="/assets/js/207.ec8e121d.js"><link rel="prefetch" href="/assets/js/208.f54d4e42.js"><link rel="prefetch" href="/assets/js/209.1bc5d06d.js"><link rel="prefetch" href="/assets/js/21.2e3bed21.js"><link rel="prefetch" href="/assets/js/210.2a3dc088.js"><link rel="prefetch" href="/assets/js/211.7084c526.js"><link rel="prefetch" href="/assets/js/212.de742850.js"><link rel="prefetch" href="/assets/js/213.fc775028.js"><link rel="prefetch" href="/assets/js/214.e338168c.js"><link rel="prefetch" href="/assets/js/215.3e89c57e.js"><link rel="prefetch" href="/assets/js/216.ecfe7587.js"><link rel="prefetch" href="/assets/js/217.14dcd4a2.js"><link rel="prefetch" href="/assets/js/218.ee7d57f7.js"><link rel="prefetch" href="/assets/js/219.c263c1e8.js"><link rel="prefetch" href="/assets/js/22.3d09766f.js"><link rel="prefetch" href="/assets/js/220.33f2bfd2.js"><link rel="prefetch" href="/assets/js/221.cd55e739.js"><link rel="prefetch" href="/assets/js/222.63107647.js"><link rel="prefetch" href="/assets/js/223.768ef403.js"><link rel="prefetch" href="/assets/js/224.54357078.js"><link rel="prefetch" href="/assets/js/225.b8e46582.js"><link rel="prefetch" href="/assets/js/226.1d0dcae9.js"><link rel="prefetch" href="/assets/js/227.a351c0a1.js"><link rel="prefetch" href="/assets/js/228.f7b8c278.js"><link rel="prefetch" href="/assets/js/229.8e4aba4d.js"><link rel="prefetch" href="/assets/js/23.b87e3933.js"><link rel="prefetch" href="/assets/js/230.186bd7a5.js"><link rel="prefetch" href="/assets/js/231.dad483e1.js"><link rel="prefetch" href="/assets/js/233.658ba0e4.js"><link rel="prefetch" href="/assets/js/234.7994cee0.js"><link rel="prefetch" href="/assets/js/235.3934d057.js"><link rel="prefetch" href="/assets/js/236.59cb6eac.js"><link rel="prefetch" href="/assets/js/237.baa1c655.js"><link rel="prefetch" href="/assets/js/238.8ee9f8ae.js"><link rel="prefetch" href="/assets/js/239.b0fe3966.js"><link rel="prefetch" href="/assets/js/24.afe2a3c4.js"><link rel="prefetch" href="/assets/js/240.d06483fa.js"><link rel="prefetch" href="/assets/js/241.81a2223e.js"><link rel="prefetch" href="/assets/js/242.8f6eee74.js"><link rel="prefetch" href="/assets/js/243.874461fa.js"><link rel="prefetch" href="/assets/js/244.ec0bb622.js"><link rel="prefetch" href="/assets/js/245.2ecf61f8.js"><link rel="prefetch" href="/assets/js/246.e7f6e55c.js"><link rel="prefetch" href="/assets/js/247.f32a1a4b.js"><link rel="prefetch" href="/assets/js/248.4302c4d8.js"><link rel="prefetch" href="/assets/js/249.9b0a4d9f.js"><link rel="prefetch" href="/assets/js/25.a22777b8.js"><link rel="prefetch" href="/assets/js/250.1295326c.js"><link rel="prefetch" href="/assets/js/251.d1cdb160.js"><link rel="prefetch" href="/assets/js/252.4e9d56fe.js"><link rel="prefetch" href="/assets/js/253.5a23b42d.js"><link rel="prefetch" href="/assets/js/254.8777547c.js"><link rel="prefetch" href="/assets/js/255.b8825033.js"><link rel="prefetch" href="/assets/js/256.0ee3689d.js"><link rel="prefetch" href="/assets/js/257.4a684795.js"><link rel="prefetch" href="/assets/js/258.ca696e72.js"><link rel="prefetch" href="/assets/js/259.fdf867d0.js"><link rel="prefetch" href="/assets/js/26.c84357e5.js"><link rel="prefetch" href="/assets/js/260.d35d60d5.js"><link rel="prefetch" href="/assets/js/261.c162cef5.js"><link rel="prefetch" href="/assets/js/262.8cbc5289.js"><link rel="prefetch" href="/assets/js/263.c05bbe4c.js"><link rel="prefetch" href="/assets/js/264.2e7c8f69.js"><link rel="prefetch" href="/assets/js/265.372a0632.js"><link rel="prefetch" href="/assets/js/266.49c38b9d.js"><link rel="prefetch" href="/assets/js/267.f7406d35.js"><link rel="prefetch" href="/assets/js/268.c7846c3e.js"><link rel="prefetch" href="/assets/js/269.e30bdc7f.js"><link rel="prefetch" href="/assets/js/27.0b3da7b9.js"><link rel="prefetch" href="/assets/js/270.8a3786ce.js"><link rel="prefetch" href="/assets/js/271.4b771c95.js"><link rel="prefetch" href="/assets/js/272.c710d2d6.js"><link rel="prefetch" href="/assets/js/273.43fb2872.js"><link rel="prefetch" href="/assets/js/274.d8a9dff2.js"><link rel="prefetch" href="/assets/js/275.c2812b68.js"><link rel="prefetch" href="/assets/js/276.406503c4.js"><link rel="prefetch" href="/assets/js/277.10c29e54.js"><link rel="prefetch" href="/assets/js/278.5f4b657a.js"><link rel="prefetch" href="/assets/js/279.84b86ae8.js"><link rel="prefetch" href="/assets/js/28.1c1fd5a6.js"><link rel="prefetch" href="/assets/js/280.8a2ba3b2.js"><link rel="prefetch" href="/assets/js/281.4a7f2b91.js"><link rel="prefetch" href="/assets/js/282.7b2f2668.js"><link rel="prefetch" href="/assets/js/283.455f93df.js"><link rel="prefetch" href="/assets/js/284.1a448478.js"><link rel="prefetch" href="/assets/js/285.19eebc05.js"><link rel="prefetch" href="/assets/js/286.5423cfc6.js"><link rel="prefetch" href="/assets/js/287.afbe115e.js"><link rel="prefetch" href="/assets/js/288.d4f4f247.js"><link rel="prefetch" href="/assets/js/289.da477465.js"><link rel="prefetch" href="/assets/js/29.103209e9.js"><link rel="prefetch" href="/assets/js/290.abf99800.js"><link rel="prefetch" href="/assets/js/291.71fe3ae6.js"><link rel="prefetch" href="/assets/js/292.455169ca.js"><link rel="prefetch" href="/assets/js/293.d23ffed4.js"><link rel="prefetch" href="/assets/js/294.1a753204.js"><link rel="prefetch" href="/assets/js/295.badfa110.js"><link rel="prefetch" href="/assets/js/296.344206a1.js"><link rel="prefetch" href="/assets/js/297.29e4f914.js"><link rel="prefetch" href="/assets/js/298.f9db8940.js"><link rel="prefetch" href="/assets/js/299.2253c1e7.js"><link rel="prefetch" href="/assets/js/3.e5ca1c51.js"><link rel="prefetch" href="/assets/js/30.e76a827e.js"><link rel="prefetch" href="/assets/js/300.e5bfd607.js"><link rel="prefetch" href="/assets/js/301.cc3e786e.js"><link rel="prefetch" href="/assets/js/302.7fdc62b6.js"><link rel="prefetch" href="/assets/js/303.b1db491f.js"><link rel="prefetch" href="/assets/js/304.18917b0f.js"><link rel="prefetch" href="/assets/js/305.d352aeb5.js"><link rel="prefetch" href="/assets/js/306.8bc72324.js"><link rel="prefetch" href="/assets/js/307.854b4037.js"><link rel="prefetch" href="/assets/js/308.6a0e4a18.js"><link rel="prefetch" href="/assets/js/309.d184df6f.js"><link rel="prefetch" href="/assets/js/31.7e4b200d.js"><link rel="prefetch" href="/assets/js/310.8e0af1ab.js"><link rel="prefetch" href="/assets/js/311.00bae85e.js"><link rel="prefetch" href="/assets/js/312.bc92cba9.js"><link rel="prefetch" href="/assets/js/313.8f70a987.js"><link rel="prefetch" href="/assets/js/314.8f190f1f.js"><link rel="prefetch" href="/assets/js/315.4b8506c7.js"><link rel="prefetch" href="/assets/js/316.5911c1f9.js"><link rel="prefetch" href="/assets/js/317.58cca547.js"><link rel="prefetch" href="/assets/js/318.4f23c053.js"><link rel="prefetch" href="/assets/js/319.941f5d3e.js"><link rel="prefetch" href="/assets/js/32.9c188bac.js"><link rel="prefetch" href="/assets/js/320.a3f15adc.js"><link rel="prefetch" href="/assets/js/321.14c74686.js"><link rel="prefetch" href="/assets/js/322.5f7b1b87.js"><link rel="prefetch" href="/assets/js/323.ab05eccb.js"><link rel="prefetch" href="/assets/js/324.292806ba.js"><link rel="prefetch" href="/assets/js/325.b96314dd.js"><link rel="prefetch" href="/assets/js/326.3d8f6329.js"><link rel="prefetch" href="/assets/js/327.49cf9268.js"><link rel="prefetch" href="/assets/js/328.be56ec05.js"><link rel="prefetch" href="/assets/js/329.8c390111.js"><link rel="prefetch" href="/assets/js/33.2435d797.js"><link rel="prefetch" href="/assets/js/330.b961e5fd.js"><link rel="prefetch" href="/assets/js/331.24ce8c0b.js"><link rel="prefetch" href="/assets/js/332.115b7546.js"><link rel="prefetch" href="/assets/js/333.957e0728.js"><link rel="prefetch" href="/assets/js/334.68825ff7.js"><link rel="prefetch" href="/assets/js/335.b662f33d.js"><link rel="prefetch" href="/assets/js/336.d8818747.js"><link rel="prefetch" href="/assets/js/337.9d24e096.js"><link rel="prefetch" href="/assets/js/338.3b669645.js"><link rel="prefetch" href="/assets/js/339.51cc2773.js"><link rel="prefetch" href="/assets/js/34.d57f3bb9.js"><link rel="prefetch" href="/assets/js/340.28cfadfb.js"><link rel="prefetch" href="/assets/js/341.4e6b0bdd.js"><link rel="prefetch" href="/assets/js/342.310c1a3e.js"><link rel="prefetch" href="/assets/js/343.0e61677a.js"><link rel="prefetch" href="/assets/js/344.340a39bd.js"><link rel="prefetch" href="/assets/js/345.fff51053.js"><link rel="prefetch" href="/assets/js/346.93c709db.js"><link rel="prefetch" href="/assets/js/347.dc863ac9.js"><link rel="prefetch" href="/assets/js/348.13c191d7.js"><link rel="prefetch" href="/assets/js/349.8aea43f7.js"><link rel="prefetch" href="/assets/js/35.e20cb4ac.js"><link rel="prefetch" href="/assets/js/350.49b72b87.js"><link rel="prefetch" href="/assets/js/351.3e6e6379.js"><link rel="prefetch" href="/assets/js/352.e2524a53.js"><link rel="prefetch" href="/assets/js/353.b71b2a33.js"><link rel="prefetch" href="/assets/js/354.a4720902.js"><link rel="prefetch" href="/assets/js/355.5a8970e1.js"><link rel="prefetch" href="/assets/js/356.353f0a9c.js"><link rel="prefetch" href="/assets/js/357.648060ca.js"><link rel="prefetch" href="/assets/js/358.643b787c.js"><link rel="prefetch" href="/assets/js/359.b1bc0c81.js"><link rel="prefetch" href="/assets/js/36.6a79f8ad.js"><link rel="prefetch" href="/assets/js/360.748faf07.js"><link rel="prefetch" href="/assets/js/361.cddfbfab.js"><link rel="prefetch" href="/assets/js/362.46990756.js"><link rel="prefetch" href="/assets/js/363.f4846a88.js"><link rel="prefetch" href="/assets/js/364.e7fd6af2.js"><link rel="prefetch" href="/assets/js/365.41693194.js"><link rel="prefetch" href="/assets/js/366.60931b9e.js"><link rel="prefetch" href="/assets/js/367.c7a310db.js"><link rel="prefetch" href="/assets/js/368.cae4028a.js"><link rel="prefetch" href="/assets/js/369.e3bcd2c2.js"><link rel="prefetch" href="/assets/js/37.4ccc31d6.js"><link rel="prefetch" href="/assets/js/370.2ea3b181.js"><link rel="prefetch" href="/assets/js/371.978056e5.js"><link rel="prefetch" href="/assets/js/372.aa13db83.js"><link rel="prefetch" href="/assets/js/373.f3791afe.js"><link rel="prefetch" href="/assets/js/374.b108af2d.js"><link rel="prefetch" href="/assets/js/375.dc75d5b1.js"><link rel="prefetch" href="/assets/js/376.8a663da6.js"><link rel="prefetch" href="/assets/js/38.9816dff1.js"><link rel="prefetch" href="/assets/js/39.03d551c0.js"><link rel="prefetch" href="/assets/js/4.611d42c4.js"><link rel="prefetch" href="/assets/js/40.ce442bf2.js"><link rel="prefetch" href="/assets/js/41.d596832c.js"><link rel="prefetch" href="/assets/js/42.29309c56.js"><link rel="prefetch" href="/assets/js/43.d47b7a06.js"><link rel="prefetch" href="/assets/js/44.87716237.js"><link rel="prefetch" href="/assets/js/45.d5ef3d2b.js"><link rel="prefetch" href="/assets/js/46.21cef7ff.js"><link rel="prefetch" href="/assets/js/47.75c67941.js"><link rel="prefetch" href="/assets/js/48.b94040d3.js"><link rel="prefetch" href="/assets/js/49.507fb28d.js"><link rel="prefetch" href="/assets/js/5.e6d623f8.js"><link rel="prefetch" href="/assets/js/50.4013f17e.js"><link rel="prefetch" href="/assets/js/51.6e81cba9.js"><link rel="prefetch" href="/assets/js/52.07e4aadf.js"><link rel="prefetch" href="/assets/js/53.1d325b49.js"><link rel="prefetch" href="/assets/js/54.79ff5e8c.js"><link rel="prefetch" href="/assets/js/55.77160bdd.js"><link rel="prefetch" href="/assets/js/56.a3041056.js"><link rel="prefetch" href="/assets/js/57.b7c0602c.js"><link rel="prefetch" href="/assets/js/58.a4af9a23.js"><link rel="prefetch" href="/assets/js/59.61a80d59.js"><link rel="prefetch" href="/assets/js/6.dc644b59.js"><link rel="prefetch" href="/assets/js/60.4ae1e1f0.js"><link rel="prefetch" href="/assets/js/61.b733273a.js"><link rel="prefetch" href="/assets/js/62.63b8d77d.js"><link rel="prefetch" href="/assets/js/63.46a84bd8.js"><link rel="prefetch" href="/assets/js/64.ce8c5891.js"><link rel="prefetch" href="/assets/js/65.8abe6836.js"><link rel="prefetch" href="/assets/js/66.6f9a9cf9.js"><link rel="prefetch" href="/assets/js/67.6bc415b9.js"><link rel="prefetch" href="/assets/js/68.b100ab24.js"><link rel="prefetch" href="/assets/js/69.5d9ed0d7.js"><link rel="prefetch" href="/assets/js/7.7da3e776.js"><link rel="prefetch" href="/assets/js/70.f213eb63.js"><link rel="prefetch" href="/assets/js/71.9dbed333.js"><link rel="prefetch" href="/assets/js/72.1129fb4b.js"><link rel="prefetch" href="/assets/js/73.7459f6b0.js"><link rel="prefetch" href="/assets/js/74.2364da14.js"><link rel="prefetch" href="/assets/js/75.72e5d347.js"><link rel="prefetch" href="/assets/js/76.7f1bc93d.js"><link rel="prefetch" href="/assets/js/77.7f9bb46a.js"><link rel="prefetch" href="/assets/js/78.16497536.js"><link rel="prefetch" href="/assets/js/79.1598ba88.js"><link rel="prefetch" href="/assets/js/8.91ce867e.js"><link rel="prefetch" href="/assets/js/80.d7595902.js"><link rel="prefetch" href="/assets/js/81.c808c887.js"><link rel="prefetch" href="/assets/js/82.49dc6011.js"><link rel="prefetch" href="/assets/js/83.6e151bae.js"><link rel="prefetch" href="/assets/js/84.9d3d5086.js"><link rel="prefetch" href="/assets/js/85.2c4d111e.js"><link rel="prefetch" href="/assets/js/86.cff98baa.js"><link rel="prefetch" href="/assets/js/87.655584a0.js"><link rel="prefetch" href="/assets/js/88.109ad4f1.js"><link rel="prefetch" href="/assets/js/89.46f7ed5c.js"><link rel="prefetch" href="/assets/js/9.8a2e5f54.js"><link rel="prefetch" href="/assets/js/90.1a91e9ca.js"><link rel="prefetch" href="/assets/js/91.26a98055.js"><link rel="prefetch" href="/assets/js/92.6ed9cb6e.js"><link rel="prefetch" href="/assets/js/93.14253412.js"><link rel="prefetch" href="/assets/js/94.54415bcf.js"><link rel="prefetch" href="/assets/js/95.0e1c9d0a.js"><link rel="prefetch" href="/assets/js/96.8654188f.js"><link rel="prefetch" href="/assets/js/97.d338a1d8.js"><link rel="prefetch" href="/assets/js/98.efa1e5c5.js"><link rel="prefetch" href="/assets/js/99.83fa6575.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76d9f797.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/magic.png" alt="Pangolin" class="logo"> <span class="site-name can-hide">Pangolin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpeg"> <div class="blogger-info"><h3>达尔文的猹</h3> <span>大道至简 悟在天成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/15c535/" class="sidebar-link">系统设计基础</a></li><li><a href="/pages/a8bdf1/" class="sidebar-link">系统设计基础</a></li><li><a href="/pages/c3570e/" class="sidebar-link">负载均衡</a></li><li><a href="/pages/814c3d/" class="sidebar-link">系统安全性</a></li><li><a href="/pages/18c1a1/" class="sidebar-link">分布式系统</a></li><li><a href="/pages/25c529/" class="sidebar-link">分布式系统基础</a></li><li><a href="/pages/039f7a/" class="sidebar-link">分布式共识</a></li><li><a href="/pages/cc3d7b/" class="sidebar-link">分布式系统组件</a></li><li><a href="/pages/7bba7a/" class="sidebar-link">服务治理</a></li><li><a href="/pages/bbfc0b/" class="sidebar-link">服务发现与注册中心</a></li><li><a href="/pages/df4300/" class="sidebar-link">网关路由</a></li><li><a href="/pages/d85407/" class="sidebar-link">限流</a></li><li><a href="/pages/9d20c9/" class="sidebar-link">可观测性</a></li><li><a href="/pages/9f05c6/" class="sidebar-link">持续集成(CICD)</a></li><li><a href="/pages/b4f900/" class="sidebar-link">框架</a></li><li><a href="/pages/080637/" class="sidebar-link">Dubbo</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Zookeeper</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/62135f/" class="sidebar-link">Zookeeper基础</a></li><li><a href="/pages/e6c327/" class="sidebar-link">Zookeeper核心原理</a></li><li><a href="/pages/d30345/" class="sidebar-link">Zookeeper应用</a></li><li><a href="/pages/b0558a/" class="sidebar-link">Zookeeper</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>缓存</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9548fb/" class="sidebar-link">缓存基础</a></li><li><a href="/pages/7da0b7/" class="sidebar-link">本地缓存</a></li><li><a href="/pages/b959c9/" class="sidebar-link">Redis基础</a></li><li><a href="/pages/95703e/" class="sidebar-link">Redis持久化</a></li><li><a href="/pages/9d1990/" class="sidebar-link">Redis主从复制</a></li><li><a href="/pages/2c0281/" class="sidebar-link">Redis哨兵</a></li><li><a href="/pages/d3ac67/" aria-current="page" class="active sidebar-link">Redis集群</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/c512f3/" class="sidebar-link">Redis内存&amp;amp;阻塞&amp;amp;运维</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>消息队列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b9fe65/" class="sidebar-link">消息队列基础</a></li><li><a href="/pages/9f0416/" class="sidebar-link">RabbitMQ</a></li><li><a href="/pages/011d9f/" class="sidebar-link">Kafka</a></li><li><a href="/pages/1a6d40/" class="sidebar-link">RocketMQ</a></li><li><a href="/pages/434b0a/" class="sidebar-link">消息队列高手课</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Netty</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/393aa1/" class="sidebar-link">Java网络IO</a></li><li><a href="/pages/411690/" class="sidebar-link">Netty架构与工作模型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e4b2f1/" class="sidebar-link">设计模式</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/middleware/#中间件与系统" data-v-06225672>中间件与系统</a></li><li data-v-06225672><a href="/middleware/#缓存" data-v-06225672>缓存</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/nanodaemony" target="_blank" title="作者" class="beLink" data-v-06225672>NanoDaemony</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-06-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->Redis集群<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_34-redis集群"><a href="#_34-redis集群" class="header-anchor">#</a> 34.Redis集群</h1> <p>Redis Cluster 是 Redis 的<strong>分布式</strong>解决方案. 当遇到单机<strong>内存, 并发, 流量等瓶颈</strong>时可以采用 cluster 架构的解决方案.</p> <h4 id="数据分布理论"><a href="#数据分布理论" class="header-anchor">#</a> 数据分布理论</h4> <p>分布式数据库首先要解决把<strong>整个数据集</strong>按照分区规则<strong>映射到多个节点</strong>的问题, 即把数据集划分到多个节点上, 每个<strong>节点</strong>负责整体数据的一个<strong>子集</strong>. 数据分区是<strong>分布式存储的核心</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523215154473.png" alt=""></p> <p>需要重点关注的是<strong>数据分区方案</strong>. 常见的分区规则有<strong>哈希分区和顺序分区</strong>两种.</p> <ul><li><strong>哈希分区</strong>: 离散度好, 数据分布业务无关, 无法顺序访问. 代表产品: <strong>Redis Cluster</strong>, Dynamo, Cassandra.</li> <li><strong>顺序分区</strong>: 离散度易倾斜, 数据分布业务相关, 可顺序访问. 代表产品: <strong>HBase</strong>, Bigtable.</li></ul> <h5 id="_1-哈希数据分区方案"><a href="#_1-哈希数据分区方案" class="header-anchor">#</a> 1.哈希数据分区方案</h5> <p>常见的哈希分区规则有几种.</p> <h6 id="_1-节点取模分区"><a href="#_1-节点取模分区" class="header-anchor">#</a> (1)节点取模分区</h6> <p>使用特定的数据, 如 Redis 的<strong>键或用户 ID</strong>, 再根据节点数量 N 使用公式: <strong>hash(key) % N</strong> 计算出哈希值, 用来决定数据<strong>映射</strong>到哪一个节点上.</p> <p>这种方案存在一个问题: 当节点数量变化时, 如扩容或收缩节点, 数据节点映射关系都需要<strong>重新计算再哈希</strong>, 会导致数据的大量<strong>重新迁移</strong>. 所以扩容时通常采用<strong>翻倍扩容</strong>, 避免数据映射全部被打乱导致全量迁移的情况.</p> <h6 id="_2-一致性哈希分区🌟"><a href="#_2-一致性哈希分区🌟" class="header-anchor">#</a> (2)一致性哈希分区🌟</h6> <p><strong>一致性哈希分区</strong>(Distributed Hash Table)实现思路是为系统中<strong>每个节点分配一个 token</strong>, 范围一般在 0 ~ 232, 这些 token 构成一个<strong>哈希环</strong>. 数据读写执行节点查找操作时, 先根据 key 计算 hash 值, 然后<strong>顺时针找到第一个大于等于该哈希值</strong>的 token 节点并存储数据.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20200527211945450-3785508.png" alt="image-20200527211945450"></p> <p>与哈希取余分区相比, 一致性哈希分区将 <strong>增减节点的影响限制在相邻节点</strong>. 以上图为例, 如果在 node1 和 node2 之间增加 node5, 则只有 node2 中的一部分数据会迁移到 node5; 如果去掉 node2, 则原 node2 中的数据只会迁移到 node4 中, 只有 node4 会受影响.</p> <p>一致性哈希分区的主要问题在于, 当 <strong>节点数量较少</strong> 时, 增加或删减节点, 对<strong>单个节点</strong>的影响可能很大, <strong>造成数据的严重不平衡</strong>. 还是以上图为例, 如果去掉 node2, node4 中的数据由总数据的 1/4 左右变为 1/2 左右, 与其他节点相比负载过高.</p> <p>正因为一致性哈希分区的这些缺点, 一些分布式系统采用<strong>虚拟槽</strong>对一致性哈希进行改进.</p> <h6 id="_3-虚拟槽分区🌟"><a href="#_3-虚拟槽分区🌟" class="header-anchor">#</a> (3)虚拟槽分区🌟</h6> <p>这种方案在<strong>一致性哈希分区的基础上</strong>, 引入 <strong>虚拟节点</strong> 的概念. Redis 集群使用的便是该方案, 其中的<strong>虚拟节点</strong>称为<strong>槽(slot)</strong>. 槽是介于数据和实际节点之间的虚拟概念, 每个实际节点包含一定数量的槽, 每个槽包含哈希值在一定范围内的数据.</p> <p>虚拟槽分区巧妙地使用了<strong>哈希空间</strong>, 使用分散度良好的<strong>哈希函数</strong>把所有数据映射到一个<strong>固定范围</strong>的整数集合中, <strong>把整数定义为槽</strong>. 这个范围一般<strong>远远大于节点数</strong>, 比如 Redis Cluster 槽范围是 <strong>0 ~ 16383</strong>.</p> <p>在使用了槽的一致性哈希分区中, <strong>槽是数据管理和迁移的基本单位</strong>. <strong>槽解耦了数据和实际节点间的关系</strong>, 增加或删除节点对系统的影响很小. 假设系统中有 4 个实际节点, 假设为其分配 16 个槽(0 - 15), 那么槽 0 - 3 位于 node1; 4 - 7 位于 node2; 以此类推....如果此时删除 node2, 只需要<strong>将槽 4-7 重新分配</strong>即可, 例如槽 4-5 分配给 node1, 槽 6 分配给 node3, 槽 7 分配给 node4; 可以看出删除 node2 后, 数据在其他节点的分布<strong>仍然较为均衡</strong>.</p> <p>采用大范围槽的主要目的是为了方便数据<strong>拆分和集群扩展</strong>.</p> <h5 id="_2-redis数据分区🌟"><a href="#_2-redis数据分区🌟" class="header-anchor">#</a> 2.Redis数据分区🌟</h5> <p><strong>Redis Cluster</strong> 就是<strong>采用虚拟槽分区</strong>. 所有键根据哈希函数映射到 <strong>0 ~ 16383</strong> 整数槽内, 计算公式: <strong>slot = CRC16(key) &amp; 16383</strong>. 每一个节点负责维护一部分<strong>槽以及槽所映射的键值数据</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523220809355.png" alt=""></p> <p>一个集群中分槽的例子.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523220845778.png" alt=""></p> <p>当前集群有 <strong>5 个节点</strong>, 每个节点平均大约负责 <strong>3276</strong> 个槽. 由于采用<strong>高质量的哈希算法</strong>, 每个槽所映射的数据通常比较均匀, 将数据平均划分到 5 个节点进行<strong>数据分区</strong>.</p> <h4 id="集群的作用与功能限制"><a href="#集群的作用与功能限制" class="header-anchor">#</a> 集群的作用与功能限制</h4> <h5 id="_1-集群的作用"><a href="#_1-集群的作用" class="header-anchor">#</a> 1.集群的作用</h5> <p><strong>数据分区: ​</strong>数据分区(或称数据分片)是集群最核心的功能. 集群将数据分散到多个节点, 一方面突破了 Redis 单机内存大小的限制, <strong>存储容量大大增加</strong>; <strong>另一方面</strong>每个主节点都可以对外提供读服务和写服务, <strong>大大提高了集群的响应能力</strong>.</p> <p><strong>高可用: ​</strong>​<strong><strong>集群支持</strong></strong>​<strong>主从复制</strong>和主节点的<strong>自动故障转移</strong>(与哨兵类似), 当任一节点发生故障时, 集群仍然可以对外提供服务.</p> <h5 id="_2-集群的功能限制"><a href="#_2-集群的功能限制" class="header-anchor">#</a> 2.集群的功能限制</h5> <p>Redis 集群相对单机在功能上存在一些限制.</p> <ul><li><strong>key 批量操作支持有限</strong>. 如 mset, mget, 目前只支持具有<strong>相同 slot 值</strong>的 key 执行批量操作. 对于映射为不同 slot 值的 key 由于执行 mget, mget 等操作可能存在于多个节点上因此不被支持.</li> <li><strong>key 事务操作支持有限</strong>. 同理只支持多 key 在<strong>同一节点</strong>上的事务操作, 当多个 key 分布在不同的节点上时无法使用事务功能.</li> <li>key 作为数据分区的最小粒度, 因此<strong>不能将一个大</strong>的键值对象如 hash, list 等映射到不同的节点.</li> <li>不支持多数据库空间. 单机下的 Redis 可以支持 16 个数据库, 集群模式下<strong>只能使用一个</strong>数据库空间, 即 db0.</li> <li>复制结构<strong>只支持一层</strong>, 从节点只能复制主节点, 不支持嵌套树状复制结构.</li></ul> <h4 id="集群搭建"><a href="#集群搭建" class="header-anchor">#</a> 集群搭建</h4> <p>集群架构如下. 集群中的每一个 Redis 节点都<strong>互相两两相连</strong>, 客户端任意<strong>直连</strong>到集群中的<strong>任意一台</strong>, 就可以对其他 Redis 节点进行<strong>读写</strong>操作.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523222556276.png" alt=""></p> <p>搭建集群的三个步骤:</p> <ul><li>准备节点.</li> <li>节点握手.</li> <li>分配槽.</li></ul> <h5 id="_1-节点准备"><a href="#_1-节点准备" class="header-anchor">#</a> 1.节点准备</h5> <p>Redis 集群一般由多个节点组成, 节点数量<strong>至少</strong>为 <strong>6 个</strong>才能保证组成完整高可用的集群. 每个节点需要<strong>开启配置 cluster-enabled yes</strong>, 让 Redis 运行在集群模式下.</p> <p>建议为集群内所有节点<strong>统一目录</strong>, 一般划分三个目录: <strong>conf, data, log</strong>, 分别存放<strong>配置, 数据和日志</strong>相关文件. 把 6 个节点<strong>配置</strong>统一放在 conf 目录下, 集群相关配置如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 节点端口</span>
port <span class="token number">6379</span>
<span class="token comment"># 开启集群模式</span>
cluster-enabled <span class="token function">yes</span>
<span class="token comment"># 节点超时时间, 单位毫秒</span>
cluster-node-timeout <span class="token number">15000</span>
<span class="token comment"># 集群内部配置文件</span>
cluster-config-file <span class="token string">&quot;nodes-6379.conf&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>其他配置和<strong>单机模式一致</strong>即可, 这里配置文件命名规则 <strong>redis-{port}.conf</strong>, 准备好配置后<strong>启动所有节点</strong>.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ redis-server conf/redis-6379.conf
$ redis-server conf/redis-6380.conf
$ redis-server conf/redis-6381.conf
$ redis-server conf/redis-6382.conf
$ redis-server conf/redis-6383.conf
$ redis-server conf/redis-6384.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>检查<strong>节点日志</strong>是否正确, 日志内容如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cat</span> log/redis-6379.log
* No cluster configuration found, I'm cfb28ef1deee4e0fa78da86abe5d24566744411e
<span class="token comment"># Server started, Redis version 3.0.7</span>
* The server is now ready to accept connections on port <span class="token number">6379</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>6379 节点<strong>启动成功</strong>, 第一次启动时如果没有集群配置文件, 它会<strong>自动创建</strong>一份.</p> <p>集群模式的 Redis 除了原有的配置文件之外<strong>又加了一份集群配置文件</strong>. 当集群内节点信息发生变化, 如添加节点, 节点下线, 故障转移等. 节点会<strong>自动保存</strong>集群状态到配置文件中. 需要注意的是, Redis <strong>自动维护集群配置文件</strong>, 不要手动修改, 防止节点重启时产生集群信息错乱.</p> <p>节点 6379 首次启动后生成集群配置如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cat</span> data/nodes-6379.conf
cfb28ef1deee4e0fa78da86abe5d24566744411e <span class="token number">127.0</span>.0.1:6379 myself,master - <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> connected
vars currentEpoch <span class="token number">0</span> lastVoteEpoch <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>文件内容记录了集群<strong>初始状态</strong>, 这里最重要的是<strong>节点 ID</strong>, 它是一个 40 位 16 进制字符串, 用于<strong>唯一标识集群内一个节点</strong>, 之后很多集群操作都要借助于节点 ID 完成. 注意: 节点 ID <strong>不同于运行 ID</strong>. 节点 ID 在集群初始化时<strong>只创建一次</strong>, 节点重启时会加载集群配置文件进行<strong>重用</strong>, 而 Redis 的<strong>运行 ID 每次重启都会变化</strong>.</p> <p>在节点 6380 执行 <strong>cluster nodes</strong> 命令获取集群节点状态:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> cluster nodes
8e41673d59c9568aa9d29fb174ce733345b3e8f1 <span class="token number">127.0</span>.0.1:6380 myself,master - <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> connected
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>每个节点目前只能识别出<strong>自己</strong>的节点信息. 如果启动 6 个节点, 但每个节点彼此并不知道对方的存在, 需要通过<strong>节点握手</strong>让 6 个节点彼此<strong>建立联系</strong>从而组成一个集群.</p> <h5 id="_2-节点握手"><a href="#_2-节点握手" class="header-anchor">#</a> 2.节点握手</h5> <p>节点握手是指一批运行在集群模式下的节点通过 <strong>Gossip 协议</strong>彼此通信, 达到感知对方的过程. 节点握手是集群彼此通信的第一步, 由<strong>客户端</strong>发起命令: <strong>cluster meet {ip} {port}</strong>. 两个结点直接先用 <strong>meet</strong> 消息进行握手(成功后回复 pong 消息), 然后使用 <strong>ping/pong</strong> 消息维护<strong>正常通信</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523223000635.png" alt=""></p> <p>只需要在集群内<strong>任意节点</strong>上执行 cluster meet 命令<strong>加入新节点</strong>, 握手状态会通过<strong>消息</strong>在集群内<strong>传播</strong>, 这样其他节点会<strong>自动发现新节点并发起握手流程</strong>.</p> <p>最后执行 cluster nodes 命令确认 6 个节点都彼此感知并组成集群:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
4fa7eac4080f0b667ffeab9b87841da49b84a6e4 <span class="token number">127.0</span>.0.1:6384 master - <span class="token number">0</span> <span class="token number">1468073975551</span>
<span class="token number">5</span> connected
cfb28ef1deee4e0fa78da86abe5d24566744411e <span class="token number">127.0</span>.0.1:6379 myself,master - <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> connected
be9485a6a729fc98c5151374bc30277e89a461d8 <span class="token number">127.0</span>.0.1:6383 master - <span class="token number">0</span> <span class="token number">1468073978579</span>
<span class="token number">4</span> connected
40622f9e7adc8ebd77fca0de9edfe691cb8a74fb <span class="token number">127.0</span>.0.1:6382 master - <span class="token number">0</span> <span class="token number">1468073980598</span>
<span class="token number">3</span> connected
8e41673d59c9568aa9d29fb174ce733345b3e8f1 <span class="token number">127.0</span>.0.1:6380 master - <span class="token number">0</span> <span class="token number">1468073974541</span>
<span class="token number">1</span> connected
40b8d09d44294d2e23c7c768efc8fcd153446746 <span class="token number">127.0</span>.0.1:6381 master - <span class="token number">0</span> <span class="token number">1468073979589</span>
<span class="token number">2</span> connected
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>节点建立握手之后集群<strong>还不能正常工作</strong>, 这时集群处于<strong>下线状态</strong>, 所有数据读写都被禁止. 因为目前所有的<strong>槽</strong>没有分配到节点, 因此<strong>集群无法完成槽到节点的映射</strong>. 只有当 16384 个槽<strong>全部分配</strong>给节点后, 集群才进入<strong>在线状态</strong>.</p> <h5 id="_3-分配数据槽"><a href="#_3-分配数据槽" class="header-anchor">#</a> 3.分配数据槽</h5> <p>Redis 集群把所有的数据映射到 <strong>16384 个槽</strong>中. 每个 key 会映射为一个<strong>固定的槽</strong>, 只有当节点分配了槽, 才能响应与这些槽关联的键命令.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523224414128.png" alt=""></p> <p>Redis 集群中内置了 <strong>16384</strong> 个哈希槽. 当客户端连接到 Redis 集群后, 会同时得到一份关于这个<strong>集群的配置信息</strong>, 当客户端具体对某一个 <strong>key 值</strong>进行操作时, 会计算出它的一个 <strong>Hash 值</strong>, 然后把<strong>结果对 16384 求余数</strong>, 这样每个 key 都会<strong>对应一个编号在 0-16383 之间的哈希槽</strong>, Redis 会根据节点数量 <strong>大致均等</strong> 的将哈希槽映射到不同的节点.</p> <p>通过 <strong>cluster addslots</strong> 命令为节点分配槽. 这里利用 bash 特性批量设置槽, 命令如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ redis-cli <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> cluster addslots <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">..</span>.5461<span class="token punctuation">}</span>
$ redis-cli <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">6380</span> cluster addslots <span class="token punctuation">{</span><span class="token number">5462</span><span class="token punctuation">..</span>.10922<span class="token punctuation">}</span>
$ redis-cli <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">6381</span> cluster addslots <span class="token punctuation">{</span><span class="token number">10923</span><span class="token punctuation">..</span>.16383<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>把 16384 个 slot 平均分配给 6379, 6380, 6381 <strong>三个</strong>节点. 执行 cluster info 查看集群状态, 如下所示:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster info
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:5
cluster_my_epoch:0
cluster_stats_messages_sent:4874
cluster_stats_messages_received:4726
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>当前集群状态是 OK, 集群进入<strong>在线状态</strong>. 所有的槽都已经分配给节点, 执行 cluster nodes 命令可以看到<strong>节点和槽的分配关系</strong>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
4fa7eac4080f0b667ffeab9b87841da49b84a6e4 <span class="token number">127.0</span>.0.1:6384 master - <span class="token number">0</span> <span class="token number">1468076240123</span>
<span class="token number">5</span> connected
cfb28ef1deee4e0fa78da86abe5d24566744411e <span class="token number">127.0</span>.0.1:6379 myself,master - <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> connected
<span class="token number">0</span>-5461
be9485a6a729fc98c5151374bc30277e89a461d8 <span class="token number">127.0</span>.0.1:6383 master - <span class="token number">0</span> <span class="token number">1468076239622</span>
<span class="token number">4</span> connected
40622f9e7adc8ebd77fca0de9edfe691cb8a74fb <span class="token number">127.0</span>.0.1:6382 master - <span class="token number">0</span> <span class="token number">1468076240628</span>
<span class="token number">3</span> connected
8e41673d59c9568aa9d29fb174ce733345b3e8f1 <span class="token number">127.0</span>.0.1:6380 master - <span class="token number">0</span> <span class="token number">1468076237606</span>
<span class="token number">1</span> connected
<span class="token number">5462</span>-10922
40b8d09d44294d2e23c7c768efc8fcd153446746 <span class="token number">127.0</span>.0.1:6381 master - <span class="token number">0</span> <span class="token number">1468076238612</span>
<span class="token number">2</span> connected
<span class="token number">10923</span>-16383
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>目前还有三个节点<strong>没有使用</strong>, 作为一个完整的集群, 每个负责<strong>处理槽的节点应该具有从节点</strong>, 保证当它出现故障时可以<strong>自动进行故障转移</strong>. 集群模式下, Reids 节点角色分为<strong>主节点和从节点</strong>. 首次启动的节点和<strong>被分配槽的节点都是主节点</strong>, 从节点负责<strong>复制</strong>主节点槽信息和相关的数据.</p> <p>使用 <strong>cluster replicate {nodeId}</strong> 命令让一个节点成为<strong>从节点</strong>. 其中命令执行必须在对应的<strong>从节点上</strong>执行, nodeId 是要复制主节点的节点 ID, 命令如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>cluster replicate cfb28ef1deee4e0fa78da86abe5d24566744411e
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>cluster replicate 8e41673d59c9568aa9d29fb174ce733345b3e8f1
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>cluster replicate 40b8d09d44294d2e23c7c768efc8fcd153446746
OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Redis 集群模式下的主从复制使用了之前介绍的 Redis 复制流程, 依然<strong>支持全量和部分复制. ​</strong>​<strong><strong>复制完成后, 整个集群的</strong></strong>​<strong>结构</strong>如下图所示.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523224624184.png" alt=""></p> <p>上述即依照 Redis 协议<strong>手动建立</strong>一个集群. 它由 6 个节点构成, 3 个主节点负责处理槽和相关数据, 3 个从节点负责故障转移. 手动比较复杂, Redis 官方提供了 <strong>redis-trib.rb</strong> 工具方便快速搭建集群, 用这个工具需要安装 Ruby 环境.</p> <h5 id="_4-集群搭建完整demo"><a href="#_4-集群搭建完整demo" class="header-anchor">#</a> 4.集群搭建完整demo</h5> <p><strong>(1)第一步: 创建集群节点配置文件</strong></p> <p>创建一个名为 <strong>redis-cluster</strong> 的目录:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/Desktop/redis-cluster
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后创建<strong>六个</strong>配置文件, 分别命名为: <strong>redis_7000.conf/redis_7001.conf.....redis_7005.conf</strong>, 然后根据不同的端口号修改对应的端口值就好了:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 后台执行</span>
daemonize <span class="token function">yes</span>
<span class="token comment"># 端口号</span>
port <span class="token number">7000</span>
<span class="token comment"># 为每一个集群节点指定一个 pid_file</span>
pidfile ~/Desktop/redis-cluster/redis_7000.pid
<span class="token comment"># 启动集群模式</span>
cluster-enabled <span class="token function">yes</span>
<span class="token comment"># 每一个集群节点都有一个配置文件, 这个文件是不能手动编辑的. 确保每一个集群节点的配置文件不通</span>
cluster-config-file nodes-7000.conf
<span class="token comment"># 集群节点的超时时间, 单位: ms, 超时后集群会认为该节点失败</span>
cluster-node-timeout <span class="token number">5000</span>
<span class="token comment"># 最后将 appendonly 改成 yes(AOF 持久化)</span>
appendonly <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>记得把对应上述配置文件中<strong>根端口对应的配置都修改掉</strong>(port/ pidfile/ cluster-config-file).</p> <p><strong>(2)第二步: 分别启动6个Redis实例</strong></p> <p>根据 6 个配置文件启动 6 个 Redis 实例.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ redis-server ~/redis-cluster/redis_7000.conf
$ redis-server ~/redis-cluster/redis_7001.conf
$ redis-server ~/redis-cluster/redis_7002.conf
$ redis-server ~/redis-cluster/redis_7003.conf
$ redis-server ~/redis-cluster/redis_7004.conf
$ redis-server ~/redis-cluster/redis_7005.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>执行 <strong>ps -ef | grep redis</strong> 查看是否启动成功:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/7896890-452c3152054c36f1.png" alt=""></p> <p>可以看到 6 个 Redis 节点都以集群方式成功启动, <strong>但现在每个节点还处于独立的状态</strong>, 也就是说它们每一个都各自成了一个集群, 还没有互相联系起来, 需要手动地把它们之间建立起联系.</p> <p><strong>(3)第三步: 建立集群</strong></p> <p>执行下列命令:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ redis-cli <span class="token parameter variable">--cluster</span> create --cluster-replicas <span class="token number">1</span> <span class="token number">127.0</span>.0.1:7000 <span class="token number">127.0</span>.0.1:7001 <span class="token number">127.0</span>.0.1:7002 <span class="token number">127.0</span>.0.1:7003 <span class="token number">127.0</span>.0.1:7004 <span class="token number">127.0</span>.0.1:7005
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里 <strong>--replicas 1</strong> 的意思是: 希望为集群中的<strong>每个主节点创建一个从节点</strong>.</p> <p>观察输出:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/7896890-d5ab644e76e9cc87.png" alt=""></p> <p>看到 <strong>[OK]</strong> 就表示集群已经搭建成功了, 这里成功创建了<strong>三主三从</strong>的集群.</p> <p><strong>(4)第四步: 验证集群</strong></p> <p>先使用 <strong>redis-cli</strong> 任意连接一个节点:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">7000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><strong>-c 表示集群模式; -h 指定 ip 地址; -p 指定端口.</strong></li></ul> <p>然后随便 &quot;set&quot; 一些值观察控制台输入:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:700<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> SET name wmyskxz
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">5798</span><span class="token punctuation">]</span> located at <span class="token number">127.0</span>.0.1:7001
OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以看到 Redis 自动进行了 <strong>Redirected 操作</strong>跳转到了 7001 这个实例上.</p> <p>再使用 <strong>cluster info(查看集群信息) 和 cluster nodes</strong>(查看节点列表) 来分别看看(任意节点输入均可):</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:700<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> CLUSTER INFO
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:6
cluster_my_epoch:2
cluster_stats_messages_ping_sent:1365
cluster_stats_messages_pong_sent:1358
cluster_stats_messages_meet_sent:4
cluster_stats_messages_sent:2727
cluster_stats_messages_ping_received:1357
cluster_stats_messages_pong_received:1369
cluster_stats_messages_meet_received:1
cluster_stats_messages_received:2727

<span class="token number">127.0</span>.0.1:700<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> CLUSTER NODES
56a04742f36c6e84968cae871cd438935081e86f <span class="token number">127.0</span>.0.1:7003@17003 slave 4ec8c022e9d546c9b51deb9d85f6cf867bf73db6 <span class="token number">0</span> <span class="token number">1584428884000</span> <span class="token number">4</span> connected
4ec8c022e9d546c9b51deb9d85f6cf867bf73db6 <span class="token number">127.0</span>.0.1:7000@17000 master - <span class="token number">0</span> <span class="token number">1584428884000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
e2539c4398b8258d3f9ffa714bd778da107cb2cd <span class="token number">127.0</span>.0.1:7005@17005 slave a3406db9ae7144d17eb7df5bffe8b70bb5dd06b8 <span class="token number">0</span> <span class="token number">1584428885222</span> <span class="token number">6</span> connected
d31cd1f423ab1e1849cac01ae927e4b6950f55d9 <span class="token number">127.0</span>.0.1:7004@17004 slave 236cefaa9cdc295bc60a5bd1aed6a7152d4f384d <span class="token number">0</span> <span class="token number">1584428884209</span> <span class="token number">5</span> connected
236cefaa9cdc295bc60a5bd1aed6a7152d4f384d <span class="token number">127.0</span>.0.1:7001@17001 myself,master - <span class="token number">0</span> <span class="token number">1584428882000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
a3406db9ae7144d17eb7df5bffe8b70bb5dd06b8 <span class="token number">127.0</span>.0.1:7002@17002 master - <span class="token number">0</span> <span class="token number">1584428884000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="结点通信机制🌟"><a href="#结点通信机制🌟" class="header-anchor">#</a> 结点通信机制🌟</h4> <h5 id="_1-通信流程"><a href="#_1-通信流程" class="header-anchor">#</a> 1.通信流程</h5> <p>在分布式存储中需要提供维护<strong>节点元数据信息</strong>的机制, 所谓<strong>元数据</strong>是指: 节点负责哪些数据, 是否出现故障等状态信息. 常见的元数据维护方式分为: <strong>集中式和 P2P 方式</strong>. Redis 集群采用 P2P 的 <strong>Gossip(流言)协议</strong>, Gossip 协议工作<strong>原理</strong>就是<strong>节点彼此不断通信交换信息, 一段时间后所有的节点都会知道集群完整的信息, 这种方式类似流言传播</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523225023888.png" alt=""></p> <p>通信过程说明:</p> <ul><li>集群中的<strong>每个节点</strong>都会单独开辟一个 <strong>TCP</strong> 通道, 用于节点之间彼此通信, 通信端口号在基础端口上加 <strong>10000</strong>.</li> <li>每个节点在<strong>固定周期</strong>内通过特定规则选择几个节点发送 <strong>ping 消息</strong>.</li> <li>接收到 ping 消息的节点用 <strong>pong 消息</strong>作为响应.</li></ul> <p>集群中每个节点通过一定规则挑选要通信的节点, 每个节点可能知道全部节点, 也可能仅知道部分节点, 只要这些节点彼此可以正常通信, <strong>最终它们会达到一致的状态. ​</strong>​<strong><strong>当节点出故障, 新节点加入, 主从角色变化, 槽信息变更等事件发生时, 通过</strong></strong>​<strong>不断的 ping/pong 消息通信</strong>, 经过一段时间后所有的节点都会知道<strong>整个集群全部节点的最新状态</strong>, 从而达到<strong>集群状态同步</strong>的目的.</p> <h5 id="_2-gossip消息"><a href="#_2-gossip消息" class="header-anchor">#</a> 2.Gossip消息</h5> <p>Gossip 协议的主要职责就是<strong>信息交换</strong>. 信息交换的载体就是节点彼此发送的 Gossip 消息. 常用的 Gossip 消息类型可分为: <strong>ping 消息, pong 消息, meet 消息, fail 消息</strong>等.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523225127890.png" alt=""></p> <ul><li><strong>meet 消息</strong>: 用于通知<strong>新节点</strong>加入.</li> <li><strong>ping 消息</strong>: 用于检测节点<strong>是否在线和交换彼此状态</strong>信息. ping 消息发送<strong>封装</strong>了自身节点和部分其他节点的状态数据.</li> <li><strong>pong 消息</strong>: 当接收到 ping, meet 消息时, 作为响应<strong>消息回复</strong>给发送方确认消息正常通信.</li> <li><strong>fail 消息</strong>: 当节点判定集群内另一个节点下线时, 会向集群内广播一个 fail 消息.</li></ul> <p>所有的消息格式划分为: <strong>消息头和消息体</strong>. 消息头包含发送节点自身状态数据, 接收节点根据消息头就可以获取到发送节点的相关数据.</p> <p>集群内所有的消息都<strong>采用相同的消息头结构</strong> clusterMsg, 是一个<strong>结构体</strong>.</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">union</span> clusterMsgData <span class="token punctuation">{</span>
    <span class="token comment">/** ping,meet,pong消息体 */</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token comment">/** gossip消息结构数组 */</span>
        clusterMsgDataGossip gossip<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> ping<span class="token punctuation">;</span>
    
    <span class="token comment">/** FAIL消息体 */</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        clusterMsgDataFail about<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> fail<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>消息体</strong> clusterMsgData 定义发送消息的<strong>数据</strong>. 通过消息头判断消息类型和状态, 通过消息体传送数据.</p> <h4 id="集群伸缩🌟"><a href="#集群伸缩🌟" class="header-anchor">#</a> 集群伸缩🌟</h4> <p>集群伸缩的原理可以抽象为<strong>槽和对应数据在不同节点之间的灵活移动</strong>.</p> <h5 id="_1-集群扩容"><a href="#_1-集群扩容" class="header-anchor">#</a> 1.集群扩容</h5> <p><strong>集群扩容</strong>即需要把当前的节点的<strong>槽和数据分一些给新的节点</strong>(进行移动). 过程如下:</p> <ul><li>准备新节点.</li> <li>加入集群.</li> <li>迁移槽和数据.</li> <li>添加从节点.</li></ul> <p>新节点的配置建议和集群内的节点配置保持一致, 配置后启动新节点即可. 新节点采用 <strong>cluster meet 命令</strong>加入到集群中. 一旦与集群任意一个建立联系, 各个节点最终都会感知. 但是新加入的节点<strong>没有分配槽</strong>也是无法进行读写的.</p> <p>需要迁移槽和数据. 确定哪些槽需要迁移到新的节点, 保证迁移之后各个节点槽的数量<strong>均匀</strong>. 数据迁移是<strong>逐个槽</strong>进行的.</p> <p>迁移过程如下:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 对目标节点发送 cluster setslot {slot} importing {sourceNodeId} 命令, 让目标节点准备导入槽的数据. 
2. 对源节点发送 cluster setslot {slot} migrating {targetNodeId} 命令, 让源节点准备迁出槽的数据. 
3. 源节点循环执行 cluster getkeysinslot {slot} {count} 命令, 每次获取 count 个属于槽的键. 
4. 在源节点上执行 migrate {targetIp} {targetPort} key 0 {timeout} 命令把指定 key 迁移. 
5. 重复执行步骤 3-4 直到槽下所有的键数据迁移到目标节点. 
6. 向集群内所有主节点发送 cluster setslot {slot} node {targetNodeId} 命令, 通知槽分配给目标节点. 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>图示如下:</p> <p>​<img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523230141253.png" alt=""></p> <p>可以使用 redis-trib 工具的 <strong>reshard</strong> 命令简化数据迁移的工作量. 由于槽用于 <strong>hash 运算</strong>本身顺序没有意义, 所以<strong>无需强制要求节点负责槽的顺序性</strong>, 也就是一个结点上槽不一定是连续的. 数据迁移完之后, 集群又多了一个主节点, 此时应该再给这个结点<strong>配备一个从节点</strong>. 此时扩容完成.</p> <h5 id="_2-集群收缩"><a href="#_2-集群收缩" class="header-anchor">#</a> 2.集群收缩</h5> <p>集群收缩即将集群中的节点<strong>安全下线</strong>. 如果下线的结点分配有槽, 需要将槽和数据迁移到其他节点, 保证下线后数据完整性. 需要将这个下线节点的槽<strong>均匀分配到其他节点</strong>. 也可以使用 <strong>reshard</strong> 命令进行迁移, reshard 迁移的目标节点只能有一个, 所以下图需要执行 3 次命令.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220527223057254.png" alt=""></p> <p>如果下线的结点没有负责槽或本身是从节点, 则可以通过 <strong>cluster forget {downNodeId}</strong> 通知集群内其他节点<strong>忘记</strong>这个下线结点, 这样其他节点就不再与这个结点进行 Gossip 通信, 之后即可正常关闭.</p> <p>如果下线主节点但<strong>不下线从节点</strong>, 则需要把这个存留的从节点<strong>指向</strong>其他节点. 如果主从节点<strong>都下线</strong>, 建议先下线从节点再下线主节点, 防止不必要的<strong>全量复制</strong>.</p> <h4 id="请求路由🌟"><a href="#请求路由🌟" class="header-anchor">#</a> 请求路由🌟</h4> <p>与客户端通信时, Redis 集群为了追求性能最大化, <strong>没有采用代理</strong>的方式, 而是采用<strong>客户端直连节点</strong>的方式进行.</p> <h5 id="_1-请求重定向moved"><a href="#_1-请求重定向moved" class="header-anchor">#</a> 1.请求重定向MOVED</h5> <p>在集群模式下, <strong>Redis 接收任何键相关命令时首先计算键对应的槽, 再根据槽找出所对应的节点, 如果节点是自身(槽命中), 则处理键命令; 否则回复 MOVED 重定向错误, 告诉客户端请求正确的节点. 这个过程就是 MOVED 重定向.</strong></p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220527223213996.png" alt=""></p> <p>可以借助 <strong>cluster keyslot {key}</strong> 命令返回 key 对应的<strong>槽</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220527223250869.png" alt=""></p> <p><strong>返回的重定向信息包含了键所对应的槽和负责该槽的节点地址. ​</strong>​<strong><strong>根据这些信息客户端可以</strong></strong>​<strong>重新发起请求</strong>. 注意: 集群中的节点对于不属于它的键操作<strong>只回复重定向响应, 不会进行命令转发</strong>.</p> <p>Redis 槽计算是根据<strong>键</strong>的有效部分使用 <strong>CRC16 函数计算出散列值</strong>, 然后对 16384 <strong>取模</strong>, 可以得到<strong>映射的槽</strong>. 计算出键对应的槽之后, 需要查找槽对应的节点. 集群内通过<strong>消息交换</strong>每个节点都会知道<strong>所有节点的槽信息</strong>, 内部<strong>保存</strong>在 <strong>clusterState</strong> 结构中.</p> <p>根据 MOVED 重定向机制, 客户端可以随机连接集群内<strong>任一节点</strong>获取键的信息.</p> <h5 id="_2-ask重定向"><a href="#_2-ask重定向" class="header-anchor">#</a> 2.ASK重定向</h5> <p>如果当键<strong>正在迁移</strong>的时候集群收到对键的操作命令, 如果数据<strong>都在</strong>原来的节点, 直接执行并返回. 然而此时可能一部分键在旧的节点上, 而<strong>另一部分数据已经迁移到新的节点</strong>上, 这时候集群就会回复 <strong>ASK 重定向异常</strong>. 客户端解析这个异常信息并再次发起请求.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220527223441500.png" alt=""></p> <p>执行流程如下:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220527223519148.png" alt=""></p> <p>注意在集群下进行<strong>键迁移时</strong>如果使用 <strong>mget, mset 等批量操作</strong>时, slot 迁移数据期间由于键列表<strong>无法保证在同一结点</strong>, 可能导致<strong>大量错误</strong>. 虽然集群环境下优先使用 Pipeline 方式进行批量操作, 但是 Pipeline 依然无法解决上述问题. 所以迁移键的时候别进行批量操作!</p> <blockquote><p>ASK 重定向和 MOVED 重定向的区别?</p></blockquote> <p>两者都是对客户端的重定向控制, 但是有本质区别.</p> <p><strong>ASK 重定</strong>: 向说明集群正在<strong>进行 slot 数据迁移</strong>, 客户端无法知道什么时候迁移完成, 因此只能<strong>临时性的重定向</strong>, 客户端也<strong>不会更新 slots 缓存</strong>.</p> <p><strong>MOVED 重定向</strong>: 说明键对应的槽已经<strong>明确迁移到了</strong>新的节点, 类似于<strong>永久重定向</strong>, 客户端需要<strong>更新 slots 缓存</strong>.</p> <h4 id="故障转移🌟"><a href="#故障转移🌟" class="header-anchor">#</a> 故障转移🌟</h4> <p>Redis 集群自身实现了高可用, <strong>不需要 Sentinel</strong>, 但是机制类似于 Redis Sentinel.</p> <h5 id="_1-故障发现"><a href="#_1-故障发现" class="header-anchor">#</a> 1.故障发现</h5> <p>集群间通过 <strong>ping/pong</strong> 消息实现结点通信, 消息不但可以传播节点槽信息, 还能传播其他<strong>状态信息</strong>, 比如: 主从状态, 节点故障等. 故障发现也是基于消息传播机制实现的, 也是分为<strong>主观下线和客观下线</strong>. 节点的状态使用 <strong>clusterState</strong> 结构体的 <strong>flags 属性</strong>进行定义.</p> <h6 id="_1-主观下线"><a href="#_1-主观下线" class="header-anchor">#</a> (1)主观下线</h6> <p>集群中每个节点都会定期给其他节点发送 ping 消息, 接收节点回复 pong 进行响应. 如果响应超时, 则发送节点认为对方存在故障, 标记为<strong>主观下线状态</strong>(pfail 状态). 主观下线是<strong>一个节点</strong>对于另一个节点不可用的判断, 仅代表这一个节点的意见, 可能存在<strong>误判</strong>.</p> <h6 id="_2-客观下线"><a href="#_2-客观下线" class="header-anchor">#</a> (2)客观下线</h6> <p>当某个节点认为一个节点不可用时, 会得到主观下线的结论, 然后相应的节点状态会随消息在集群内传播. 客观下线则是需要<strong>多个</strong>节点<strong>达成共识</strong>, 都认为一个节点不可用. <strong>当半数以上持有槽的主节点都标记某个结点是主观下线时, 触发客观下线流程. ​</strong>​<strong><strong>注意只是</strong></strong>​<strong>主节点</strong>参与决策. 每个节点收到的其他节点发送的<strong>主观下线信息</strong>是具有<strong>有效期</strong>的, 如果时间过长, 主观下线信息会过期.</p> <p>集群中的节点<strong>每次</strong>收到其他节点的主观下线状态信息时, <strong>都会尝试触发客观下线</strong>. 首先会计算有效的主观下线报告数量, 如果数量大于槽节点的<strong>一半</strong>, 则更新为<strong>客观下线</strong>, 同时向集群广播下线节点的 fail 消息.</p> <p>广播下线节点的 fail 消息可以通知集群内所有的节点<strong>标记故障节点为客观下线状态</strong>并立即生效, 同时通知故障节点的<strong>从节点触发故障转移流程</strong>(如果故障的就是从节点就不需要了). 如果不可用的节点持有槽, 则需要进行<strong>故障转移</strong>.</p> <h5 id="_2-故障转移与恢复"><a href="#_2-故障转移与恢复" class="header-anchor">#</a> 2.故障转移与恢复</h5> <p>故障节点客观下线后, 如果是持有槽的<strong>主节点</strong>, <strong>则需要在它的从节点中选出一个替换它</strong>, 实现集群的高可用.</p> <p>过程如下:</p> <p><strong>(1) 资格检查. ​</strong>​<strong><strong>每个从节点</strong></strong>​<strong>都要</strong>检查最后与主节点直接的短线时间, 如果过长则不具有资格. 可能存在多个有资格成为主节点的从节点.</p> <p><strong>(2) 设置选举时间. ​</strong>​<strong><strong>每个从节点都会触发选举来选择</strong></strong>​<strong>自己作为主节点</strong>. 但是选谁? 当从节点符合故障转移资格后, <strong>更新</strong>触发故障选举的时间, 只有达到时间后才能触发选举. 每个<strong>从节点进行选举的时间是不一样</strong>的, 这个触发时间记录在 clusterState 结构体中. 这里采用<strong>延迟触发机制</strong>. <strong>复制偏移量越大的从节点的触发选举的时间越早, 因为它的数据完整性最高.</strong></p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220527223721040.png" alt=""></p> <p>所以从节点中<strong>复制偏移量最大</strong>的节点将<strong>提前触发选举</strong>, 它成为主节点的几率也<strong>更大</strong>.</p> <p><strong>(3) 发起选举</strong>. 当从节点定时任务监测到达故障选举时间到达之后, 发起选举流程, 即更新配置纪元和广播选举消息.</p> <p><strong>(4) 选举投票</strong>. 持有槽的主节点才会处理选举消息, 每个节点具有<strong>一票</strong>.</p> <p><strong>(5) 替换主节点</strong>. 选举成功的从节点触发替换主节点操作. 当前从节点取消复制变成主节点. 之后自己接管原来主节点负责的槽. 然后向集群<strong>广播</strong>自己成为主节点的状态信息.</p> <p>整个故障转移过程也会产生大量的日志, 可以模拟一下故障场景, 好好看看日志.</p> <h4 id="集群运维"><a href="#集群运维" class="header-anchor">#</a> 集群运维</h4> <h5 id="_1-带宽消耗问题"><a href="#_1-带宽消耗问题" class="header-anchor">#</a> 1.带宽消耗问题</h5> <p>集群的带宽消耗主要为: <strong>读写命令消耗 + Gossip 消息消耗</strong>. Gossip 消息<strong>别太频繁</strong>, 不然可能占用较多带宽.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220527223759299.png" alt=""></p> <p>官方建议集群最大规模不要超过 1000.</p> <h5 id="_2-集群倾斜问题"><a href="#_2-集群倾斜问题" class="header-anchor">#</a> 2.集群倾斜问题</h5> <h6 id="_1-数据倾斜"><a href="#_1-数据倾斜" class="header-anchor">#</a> (1)数据倾斜</h6> <p>主要有几种:</p> <ul><li>节点和槽分配严重不均匀. 可以使用 <strong>redis-trib.rb 工具的 rebalance</strong> 命令进行平衡.</li> <li>不同槽对应键数量差异过大. 主要是发现键多的槽</li> <li>集合对象包含大量元素. 使用 redis-cli --bigkeys 找出大集合对象, 然后可以考虑分解.</li> <li>内存相关配置不一致.</li></ul> <h6 id="_2-请求倾斜"><a href="#_2-请求倾斜" class="header-anchor">#</a> (2)请求倾斜</h6> <p>对特点的节点请求过多, 造成负载不均衡.</p> <ul><li>合理设计键, 让请求均匀.</li> <li>对热点的大集合对象进行拆分, 避免都请求到一个节点.</li> <li>对于一致性要求不高的场合可以使用本地缓存减少热键调用.</li></ul> <h5 id="_3-集群读写分离"><a href="#_3-集群读写分离" class="header-anchor">#</a> 3.集群读写分离</h5> <p>集群模式下的读写分离成本比较高, 可以直接<strong>拓展主节点</strong>的数量来提高集群性能, 一般<strong>不建议</strong>集群模式下做读写分离.</p> <p>‍</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <ul><li>《Redis开发与运维》</li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/main/docs/30.中间件与系统/3100.缓存/34.Redis集群.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/2c0281/" class="prev">Redis哨兵</a></span> <span class="next"><a href="/pages/c512f3/">Redis内存&amp;amp;阻塞&amp;amp;运维</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f90282/"><div>
            基础
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/0f75ac/"><div>
            搜索二叉树BST
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/39721f/"><div>
            平衡二叉树AVL
            <!----></div></a> <span class="date">06-08</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1174520425@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/nanodaemony" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>达尔文的猹 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.5bc2c979.js" defer></script><script src="/assets/js/2.eccd4273.js" defer></script><script src="/assets/js/232.26555358.js" defer></script>
  </body>
</html>
