<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>缓存基础 | Pangolin Note</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="大道至简">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.56073ad3.css" as="style"><link rel="preload" href="/assets/js/app.3f3e0e10.js" as="script"><link rel="preload" href="/assets/js/2.e9fcb30c.js" as="script"><link rel="preload" href="/assets/js/3.1998f389.js" as="script"><link rel="preload" href="/assets/js/153.965e3fb2.js" as="script"><link rel="prefetch" href="/assets/js/10.0b55747f.js"><link rel="prefetch" href="/assets/js/100.b8912a99.js"><link rel="prefetch" href="/assets/js/101.a6740c8a.js"><link rel="prefetch" href="/assets/js/102.e31e89b2.js"><link rel="prefetch" href="/assets/js/103.2c5dbdae.js"><link rel="prefetch" href="/assets/js/104.0e9c02f6.js"><link rel="prefetch" href="/assets/js/105.8288396c.js"><link rel="prefetch" href="/assets/js/106.62f43c11.js"><link rel="prefetch" href="/assets/js/107.70c90211.js"><link rel="prefetch" href="/assets/js/108.b488ce56.js"><link rel="prefetch" href="/assets/js/109.12942650.js"><link rel="prefetch" href="/assets/js/11.ac3fd1ca.js"><link rel="prefetch" href="/assets/js/110.1e57ecba.js"><link rel="prefetch" href="/assets/js/111.6e33b4ea.js"><link rel="prefetch" href="/assets/js/112.bd52831b.js"><link rel="prefetch" href="/assets/js/113.868c1ac9.js"><link rel="prefetch" href="/assets/js/114.090549d1.js"><link rel="prefetch" href="/assets/js/115.d97f6c2b.js"><link rel="prefetch" href="/assets/js/116.097c4b4e.js"><link rel="prefetch" href="/assets/js/117.4024cfe2.js"><link rel="prefetch" href="/assets/js/118.e3057cba.js"><link rel="prefetch" href="/assets/js/119.4ef1fa3b.js"><link rel="prefetch" href="/assets/js/12.863eaabe.js"><link rel="prefetch" href="/assets/js/120.78f9df50.js"><link rel="prefetch" href="/assets/js/121.8e16df87.js"><link rel="prefetch" href="/assets/js/122.f21c0107.js"><link rel="prefetch" href="/assets/js/123.ea1cb375.js"><link rel="prefetch" href="/assets/js/124.01c04c6e.js"><link rel="prefetch" href="/assets/js/125.d383e301.js"><link rel="prefetch" href="/assets/js/126.3162cb47.js"><link rel="prefetch" href="/assets/js/127.c6bebae6.js"><link rel="prefetch" href="/assets/js/128.d659db60.js"><link rel="prefetch" href="/assets/js/129.2afdcf48.js"><link rel="prefetch" href="/assets/js/13.4f59ce35.js"><link rel="prefetch" href="/assets/js/130.beb9ed9d.js"><link rel="prefetch" href="/assets/js/131.35b05f8a.js"><link rel="prefetch" href="/assets/js/132.d77f4f93.js"><link rel="prefetch" href="/assets/js/133.4ceda6e5.js"><link rel="prefetch" href="/assets/js/134.11390c5f.js"><link rel="prefetch" href="/assets/js/135.32f9e38f.js"><link rel="prefetch" href="/assets/js/136.6d8bb0f2.js"><link rel="prefetch" href="/assets/js/137.9c0ffeef.js"><link rel="prefetch" href="/assets/js/138.88d86e5f.js"><link rel="prefetch" href="/assets/js/139.8c2c3d6c.js"><link rel="prefetch" href="/assets/js/14.11c82d35.js"><link rel="prefetch" href="/assets/js/140.c5c375d3.js"><link rel="prefetch" href="/assets/js/141.d703f30b.js"><link rel="prefetch" href="/assets/js/142.6a005a44.js"><link rel="prefetch" href="/assets/js/143.9b2edf6f.js"><link rel="prefetch" href="/assets/js/144.3fd013c9.js"><link rel="prefetch" href="/assets/js/145.b05079c5.js"><link rel="prefetch" href="/assets/js/146.ed5360a6.js"><link rel="prefetch" href="/assets/js/147.7408d86f.js"><link rel="prefetch" href="/assets/js/148.f390b370.js"><link rel="prefetch" href="/assets/js/149.95017f0a.js"><link rel="prefetch" href="/assets/js/15.bd143bd5.js"><link rel="prefetch" href="/assets/js/150.f0ede764.js"><link rel="prefetch" href="/assets/js/151.b7093623.js"><link rel="prefetch" href="/assets/js/152.a82a6c83.js"><link rel="prefetch" href="/assets/js/154.9e49311e.js"><link rel="prefetch" href="/assets/js/155.cef33ba5.js"><link rel="prefetch" href="/assets/js/156.bcc397ae.js"><link rel="prefetch" href="/assets/js/157.90824739.js"><link rel="prefetch" href="/assets/js/158.efd429b9.js"><link rel="prefetch" href="/assets/js/159.122ff5b7.js"><link rel="prefetch" href="/assets/js/16.2449162b.js"><link rel="prefetch" href="/assets/js/160.0b806535.js"><link rel="prefetch" href="/assets/js/161.835052c6.js"><link rel="prefetch" href="/assets/js/162.ca34e2d2.js"><link rel="prefetch" href="/assets/js/163.08000d04.js"><link rel="prefetch" href="/assets/js/164.a1cc0109.js"><link rel="prefetch" href="/assets/js/165.65444686.js"><link rel="prefetch" href="/assets/js/166.7d73c84f.js"><link rel="prefetch" href="/assets/js/167.009d47a3.js"><link rel="prefetch" href="/assets/js/168.0afeae2a.js"><link rel="prefetch" href="/assets/js/169.7654cb31.js"><link rel="prefetch" href="/assets/js/17.eb7f9def.js"><link rel="prefetch" href="/assets/js/170.58569530.js"><link rel="prefetch" href="/assets/js/171.7db9ed40.js"><link rel="prefetch" href="/assets/js/172.3cb50ed4.js"><link rel="prefetch" href="/assets/js/173.0846425f.js"><link rel="prefetch" href="/assets/js/174.9e95f111.js"><link rel="prefetch" href="/assets/js/175.ef2098f2.js"><link rel="prefetch" href="/assets/js/176.c2635fe9.js"><link rel="prefetch" href="/assets/js/177.4fa38e8e.js"><link rel="prefetch" href="/assets/js/178.2be7037f.js"><link rel="prefetch" href="/assets/js/179.bf3bba28.js"><link rel="prefetch" href="/assets/js/18.0455f4d1.js"><link rel="prefetch" href="/assets/js/180.72c5f597.js"><link rel="prefetch" href="/assets/js/181.42287bcc.js"><link rel="prefetch" href="/assets/js/182.6cd4bf1a.js"><link rel="prefetch" href="/assets/js/183.05dbbfd9.js"><link rel="prefetch" href="/assets/js/184.03de7e00.js"><link rel="prefetch" href="/assets/js/185.42dd210e.js"><link rel="prefetch" href="/assets/js/186.28ee0f8a.js"><link rel="prefetch" href="/assets/js/187.bb58697b.js"><link rel="prefetch" href="/assets/js/188.1bc8be96.js"><link rel="prefetch" href="/assets/js/189.fac747e3.js"><link rel="prefetch" href="/assets/js/19.ae9e35d6.js"><link rel="prefetch" href="/assets/js/190.ea533ac7.js"><link rel="prefetch" href="/assets/js/191.6dc6eb13.js"><link rel="prefetch" href="/assets/js/192.184d249f.js"><link rel="prefetch" href="/assets/js/193.4a06bc12.js"><link rel="prefetch" href="/assets/js/194.8cce60a9.js"><link rel="prefetch" href="/assets/js/195.93231a13.js"><link rel="prefetch" href="/assets/js/196.4a596bde.js"><link rel="prefetch" href="/assets/js/197.96c113cf.js"><link rel="prefetch" href="/assets/js/198.73ba3f67.js"><link rel="prefetch" href="/assets/js/199.74bab595.js"><link rel="prefetch" href="/assets/js/20.b542d0e7.js"><link rel="prefetch" href="/assets/js/200.69a6928a.js"><link rel="prefetch" href="/assets/js/201.9ffa7c5a.js"><link rel="prefetch" href="/assets/js/202.41edb652.js"><link rel="prefetch" href="/assets/js/203.7fabcef3.js"><link rel="prefetch" href="/assets/js/204.b0ae2f62.js"><link rel="prefetch" href="/assets/js/205.add8738b.js"><link rel="prefetch" href="/assets/js/206.f3a712ec.js"><link rel="prefetch" href="/assets/js/207.cd7dd729.js"><link rel="prefetch" href="/assets/js/208.78b33afa.js"><link rel="prefetch" href="/assets/js/209.9d3329ff.js"><link rel="prefetch" href="/assets/js/21.5a050318.js"><link rel="prefetch" href="/assets/js/210.d285d5ac.js"><link rel="prefetch" href="/assets/js/211.8791bb3f.js"><link rel="prefetch" href="/assets/js/212.84ed81a8.js"><link rel="prefetch" href="/assets/js/213.7b990580.js"><link rel="prefetch" href="/assets/js/214.da31f20c.js"><link rel="prefetch" href="/assets/js/215.9eeed659.js"><link rel="prefetch" href="/assets/js/216.9539f0ec.js"><link rel="prefetch" href="/assets/js/217.11b575be.js"><link rel="prefetch" href="/assets/js/218.a67f12f1.js"><link rel="prefetch" href="/assets/js/219.bfbb817a.js"><link rel="prefetch" href="/assets/js/22.2bc6f7e3.js"><link rel="prefetch" href="/assets/js/220.8b01342f.js"><link rel="prefetch" href="/assets/js/221.b450decd.js"><link rel="prefetch" href="/assets/js/222.97468507.js"><link rel="prefetch" href="/assets/js/223.b6dafd73.js"><link rel="prefetch" href="/assets/js/224.c86c18c6.js"><link rel="prefetch" href="/assets/js/225.b0dcf86e.js"><link rel="prefetch" href="/assets/js/226.02cc2999.js"><link rel="prefetch" href="/assets/js/227.8474ef5a.js"><link rel="prefetch" href="/assets/js/228.0298e421.js"><link rel="prefetch" href="/assets/js/229.6aeaf595.js"><link rel="prefetch" href="/assets/js/23.9995fce4.js"><link rel="prefetch" href="/assets/js/230.a5785286.js"><link rel="prefetch" href="/assets/js/231.d791daa4.js"><link rel="prefetch" href="/assets/js/232.97aeeb00.js"><link rel="prefetch" href="/assets/js/233.46e51e28.js"><link rel="prefetch" href="/assets/js/234.2cffe82f.js"><link rel="prefetch" href="/assets/js/235.14965da6.js"><link rel="prefetch" href="/assets/js/236.00a5afc0.js"><link rel="prefetch" href="/assets/js/237.3b73d52f.js"><link rel="prefetch" href="/assets/js/238.6e1db765.js"><link rel="prefetch" href="/assets/js/239.75866c5e.js"><link rel="prefetch" href="/assets/js/24.9141eeb2.js"><link rel="prefetch" href="/assets/js/240.af9c2cc9.js"><link rel="prefetch" href="/assets/js/241.388acab2.js"><link rel="prefetch" href="/assets/js/242.c60f2b48.js"><link rel="prefetch" href="/assets/js/243.d8e81b13.js"><link rel="prefetch" href="/assets/js/244.58b0b21d.js"><link rel="prefetch" href="/assets/js/245.c3768497.js"><link rel="prefetch" href="/assets/js/246.ac8bbe7a.js"><link rel="prefetch" href="/assets/js/247.d095f70a.js"><link rel="prefetch" href="/assets/js/248.e9f210b5.js"><link rel="prefetch" href="/assets/js/249.a9fad023.js"><link rel="prefetch" href="/assets/js/25.98e8593e.js"><link rel="prefetch" href="/assets/js/250.ae7f0ebb.js"><link rel="prefetch" href="/assets/js/251.9a617d55.js"><link rel="prefetch" href="/assets/js/252.ce082446.js"><link rel="prefetch" href="/assets/js/253.4575302d.js"><link rel="prefetch" href="/assets/js/254.5899a61b.js"><link rel="prefetch" href="/assets/js/255.66c69f31.js"><link rel="prefetch" href="/assets/js/256.8fd6c706.js"><link rel="prefetch" href="/assets/js/257.31b77e5e.js"><link rel="prefetch" href="/assets/js/258.eba48891.js"><link rel="prefetch" href="/assets/js/259.edf74b59.js"><link rel="prefetch" href="/assets/js/26.e69924ea.js"><link rel="prefetch" href="/assets/js/260.cf2ed36d.js"><link rel="prefetch" href="/assets/js/261.9e7792d8.js"><link rel="prefetch" href="/assets/js/262.e7b9433e.js"><link rel="prefetch" href="/assets/js/263.1185b25c.js"><link rel="prefetch" href="/assets/js/264.5e0f89cb.js"><link rel="prefetch" href="/assets/js/265.a38d3b94.js"><link rel="prefetch" href="/assets/js/266.2ef170b3.js"><link rel="prefetch" href="/assets/js/267.a7d14651.js"><link rel="prefetch" href="/assets/js/268.05b18748.js"><link rel="prefetch" href="/assets/js/269.dad48d6f.js"><link rel="prefetch" href="/assets/js/27.13612515.js"><link rel="prefetch" href="/assets/js/270.4f5a6b8d.js"><link rel="prefetch" href="/assets/js/271.7ebf6682.js"><link rel="prefetch" href="/assets/js/272.7c2fbfd1.js"><link rel="prefetch" href="/assets/js/273.8ee20732.js"><link rel="prefetch" href="/assets/js/274.d525242a.js"><link rel="prefetch" href="/assets/js/275.a8a19acb.js"><link rel="prefetch" href="/assets/js/276.df3a4eb4.js"><link rel="prefetch" href="/assets/js/277.336debda.js"><link rel="prefetch" href="/assets/js/278.c470625f.js"><link rel="prefetch" href="/assets/js/279.a91e1a64.js"><link rel="prefetch" href="/assets/js/28.ab7ae1df.js"><link rel="prefetch" href="/assets/js/280.87e25c9a.js"><link rel="prefetch" href="/assets/js/281.87c1ba25.js"><link rel="prefetch" href="/assets/js/282.dcd4dce0.js"><link rel="prefetch" href="/assets/js/283.abac2e00.js"><link rel="prefetch" href="/assets/js/284.f6079659.js"><link rel="prefetch" href="/assets/js/285.f1b39879.js"><link rel="prefetch" href="/assets/js/286.f6a79242.js"><link rel="prefetch" href="/assets/js/287.06bebe07.js"><link rel="prefetch" href="/assets/js/288.89e325df.js"><link rel="prefetch" href="/assets/js/289.3aa1bedd.js"><link rel="prefetch" href="/assets/js/29.ebe50f76.js"><link rel="prefetch" href="/assets/js/290.ee059c92.js"><link rel="prefetch" href="/assets/js/291.fa9a921a.js"><link rel="prefetch" href="/assets/js/292.2a8811cd.js"><link rel="prefetch" href="/assets/js/293.eec09cdf.js"><link rel="prefetch" href="/assets/js/294.dfac20dc.js"><link rel="prefetch" href="/assets/js/295.825d2070.js"><link rel="prefetch" href="/assets/js/296.f645861e.js"><link rel="prefetch" href="/assets/js/297.424fdb17.js"><link rel="prefetch" href="/assets/js/298.ebf87cdc.js"><link rel="prefetch" href="/assets/js/299.b8f19cbb.js"><link rel="prefetch" href="/assets/js/30.75237511.js"><link rel="prefetch" href="/assets/js/300.10fb6d4f.js"><link rel="prefetch" href="/assets/js/301.ef77c612.js"><link rel="prefetch" href="/assets/js/302.1b839763.js"><link rel="prefetch" href="/assets/js/303.609f7d98.js"><link rel="prefetch" href="/assets/js/304.1d255f19.js"><link rel="prefetch" href="/assets/js/305.b0234f2c.js"><link rel="prefetch" href="/assets/js/306.48677f64.js"><link rel="prefetch" href="/assets/js/307.14390d4b.js"><link rel="prefetch" href="/assets/js/308.fa730b28.js"><link rel="prefetch" href="/assets/js/309.0496b9e0.js"><link rel="prefetch" href="/assets/js/31.cf3f471a.js"><link rel="prefetch" href="/assets/js/310.a31676dc.js"><link rel="prefetch" href="/assets/js/311.ed53adc5.js"><link rel="prefetch" href="/assets/js/312.1b0ff2f1.js"><link rel="prefetch" href="/assets/js/313.bf123f32.js"><link rel="prefetch" href="/assets/js/314.4e6ce06b.js"><link rel="prefetch" href="/assets/js/315.8eb18560.js"><link rel="prefetch" href="/assets/js/32.74fef842.js"><link rel="prefetch" href="/assets/js/33.bc2d190b.js"><link rel="prefetch" href="/assets/js/34.d23438fc.js"><link rel="prefetch" href="/assets/js/35.7675c4d0.js"><link rel="prefetch" href="/assets/js/36.96a4161b.js"><link rel="prefetch" href="/assets/js/37.d1824f2f.js"><link rel="prefetch" href="/assets/js/38.4effff9e.js"><link rel="prefetch" href="/assets/js/39.6509914b.js"><link rel="prefetch" href="/assets/js/4.4d01750f.js"><link rel="prefetch" href="/assets/js/40.1509d08b.js"><link rel="prefetch" href="/assets/js/41.f2c1124f.js"><link rel="prefetch" href="/assets/js/42.e541d077.js"><link rel="prefetch" href="/assets/js/43.369de999.js"><link rel="prefetch" href="/assets/js/44.43959db0.js"><link rel="prefetch" href="/assets/js/45.282fbd31.js"><link rel="prefetch" href="/assets/js/46.1b83cfe9.js"><link rel="prefetch" href="/assets/js/47.c3a88e41.js"><link rel="prefetch" href="/assets/js/48.bc7c0a1b.js"><link rel="prefetch" href="/assets/js/49.92a4e5ba.js"><link rel="prefetch" href="/assets/js/5.c3991e24.js"><link rel="prefetch" href="/assets/js/50.9c488c6c.js"><link rel="prefetch" href="/assets/js/51.546ea632.js"><link rel="prefetch" href="/assets/js/52.0d2ccee1.js"><link rel="prefetch" href="/assets/js/53.6f52b5b1.js"><link rel="prefetch" href="/assets/js/54.c838b295.js"><link rel="prefetch" href="/assets/js/55.13af99ee.js"><link rel="prefetch" href="/assets/js/56.6be6d1ed.js"><link rel="prefetch" href="/assets/js/57.67c98b39.js"><link rel="prefetch" href="/assets/js/58.107e82ec.js"><link rel="prefetch" href="/assets/js/59.b3e5edc7.js"><link rel="prefetch" href="/assets/js/6.36a535f9.js"><link rel="prefetch" href="/assets/js/60.3b0b4ba5.js"><link rel="prefetch" href="/assets/js/61.3df843df.js"><link rel="prefetch" href="/assets/js/62.1213823d.js"><link rel="prefetch" href="/assets/js/63.e8f3f926.js"><link rel="prefetch" href="/assets/js/64.e1219050.js"><link rel="prefetch" href="/assets/js/65.5bf5bb0b.js"><link rel="prefetch" href="/assets/js/66.a2502afb.js"><link rel="prefetch" href="/assets/js/67.690dd59b.js"><link rel="prefetch" href="/assets/js/68.de7b0915.js"><link rel="prefetch" href="/assets/js/69.ac61dd61.js"><link rel="prefetch" href="/assets/js/7.5d254238.js"><link rel="prefetch" href="/assets/js/70.3edd41b1.js"><link rel="prefetch" href="/assets/js/71.d23407e9.js"><link rel="prefetch" href="/assets/js/72.a5bd01bc.js"><link rel="prefetch" href="/assets/js/73.c9f4dd57.js"><link rel="prefetch" href="/assets/js/74.66323fc1.js"><link rel="prefetch" href="/assets/js/75.e1a72e00.js"><link rel="prefetch" href="/assets/js/76.801268b4.js"><link rel="prefetch" href="/assets/js/77.3a5fda67.js"><link rel="prefetch" href="/assets/js/78.54d84cd4.js"><link rel="prefetch" href="/assets/js/79.fa10f4e3.js"><link rel="prefetch" href="/assets/js/8.e060e47d.js"><link rel="prefetch" href="/assets/js/80.d5b24fea.js"><link rel="prefetch" href="/assets/js/81.0e9da714.js"><link rel="prefetch" href="/assets/js/82.e96ff6d7.js"><link rel="prefetch" href="/assets/js/83.771cced1.js"><link rel="prefetch" href="/assets/js/84.220b69e7.js"><link rel="prefetch" href="/assets/js/85.7dcc5659.js"><link rel="prefetch" href="/assets/js/86.44ba2100.js"><link rel="prefetch" href="/assets/js/87.281da75d.js"><link rel="prefetch" href="/assets/js/88.12d88449.js"><link rel="prefetch" href="/assets/js/89.f28c86d3.js"><link rel="prefetch" href="/assets/js/9.8f9fef32.js"><link rel="prefetch" href="/assets/js/90.715cabb2.js"><link rel="prefetch" href="/assets/js/91.6ced7c82.js"><link rel="prefetch" href="/assets/js/92.c05b33ca.js"><link rel="prefetch" href="/assets/js/93.6bf5fb66.js"><link rel="prefetch" href="/assets/js/94.3561200e.js"><link rel="prefetch" href="/assets/js/95.0f2cf716.js"><link rel="prefetch" href="/assets/js/96.ac8487ea.js"><link rel="prefetch" href="/assets/js/97.48042b5a.js"><link rel="prefetch" href="/assets/js/98.441bb7f8.js"><link rel="prefetch" href="/assets/js/99.4b214d92.js">
    <link rel="stylesheet" href="/assets/css/0.styles.56073ad3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/magic.png" alt="Pangolin Note" class="logo"> <span class="site-name can-hide">Pangolin Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">系统</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">🍀读书笔记</a></div><div class="nav-item"><a href="/work/" class="nav-link">工作</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">🌸达尔文的猹</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatarnew.png"> <div class="blogger-info"><h3>达尔文的猹</h3> <span>大道至简 悟在天成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">系统</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">🍀读书笔记</a></div><div class="nav-item"><a href="/work/" class="nav-link">工作</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">🌸达尔文的猹</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>分布式系统理论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/129626/" class="sidebar-link">分布式系统基础</a></li><li><a href="/pages/fb5d35/" class="sidebar-link">分布式共识算法</a></li><li><a href="/pages/12ac37/" class="sidebar-link">分布式系统组件</a></li><li><a href="/pages/d03ebf/" class="sidebar-link">分布式技术原理与算法解析(极客时间)🌸</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>系统接入层</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f1b6c4/" class="sidebar-link">Nginx基础</a></li><li><a href="/pages/d4123d/" class="sidebar-link">深入拆解Tomcat与Jetty(极客时间)🌸</a></li><li><a href="/pages/baee2f/" class="sidebar-link">Netty</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>服务治理-注册发现与RPC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/05077d/" class="sidebar-link">基础</a></li><li><a href="/pages/51b6aa/" class="sidebar-link">RPC实战与核心原理(极客时间)🌸</a></li><li><a href="/pages/0966ee/" class="sidebar-link">Zookeeper</a></li><li><a href="/pages/3b7e05/" class="sidebar-link">Nacos</a></li><li><a href="/pages/7f31f8/" class="sidebar-link">Dubbo</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>服务治理-流量控制</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/44bfa8/" class="sidebar-link">负载均衡</a></li><li><a href="/pages/4d5a6c/" class="sidebar-link">限流</a></li><li><a href="/pages/e0c561/" class="sidebar-link">熔断</a></li><li><a href="/pages/12ae40/" class="sidebar-link">网关路由</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>服务治理-系统监控与安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8c9210/" class="sidebar-link">系统安全性</a></li><li><a href="/pages/c9bf40/" class="sidebar-link">系统监控组件</a></li><li><a href="/pages/3f3cf7/" class="sidebar-link">运维监控系统实战(极客时间)🌸</a></li><li><a href="/pages/e20e02/" class="sidebar-link">OAuth2.0实战课(极客时间)🌟</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>中间件-消息队列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/96d94c/" class="sidebar-link">消息队列基础</a></li><li><a href="/pages/abf16c/" class="sidebar-link">RabbitMQ</a></li><li><a href="/pages/4fc3f1/" class="sidebar-link">Kafka</a></li><li><a href="/pages/013cfe/" class="sidebar-link">RocketMQ</a></li><li><a href="/pages/ed8d92/" class="sidebar-link">Disruptor</a></li><li><a href="/pages/249149/" class="sidebar-link">消息队列高手课(极客时间)🌟</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>中间件-缓存</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/946847/" aria-current="page" class="active sidebar-link">缓存基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/e46d56/" class="sidebar-link">本地缓存</a></li><li><a href="/pages/0abfb9/" class="sidebar-link">Redis基础</a></li><li><a href="/pages/09236a/" class="sidebar-link">Redis持久化</a></li><li><a href="/pages/867f9b/" class="sidebar-link">Redis主从复制</a></li><li><a href="/pages/50cae1/" class="sidebar-link">Redis哨兵</a></li><li><a href="/pages/43b45c/" class="sidebar-link">Redis集群</a></li><li><a href="/pages/a32379/" class="sidebar-link">Redis内存管理与运维</a></li><li><a href="/pages/386037/" class="sidebar-link">Redis核心技术与实战(极客时间)🌸</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>中间件-其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/23044d/" class="sidebar-link">定时任务-XXLJob</a></li><li><a href="/pages/459117/" class="sidebar-link">ES与检索</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>系统设计与优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/41a845/" class="sidebar-link">凤凰架构</a></li><li><a href="/pages/68cc0b/" class="sidebar-link">左耳听风(极客时间)🌟</a></li><li><a href="/pages/e3e99c/" class="sidebar-link">从0开始学微服务(极客时间)🌸</a></li><li><a href="/pages/1e5368/" class="sidebar-link">高并发系统设计40问(极客时间)🌸</a></li><li><a href="/pages/33599f/" class="sidebar-link">系统性能调优必知必会(极客时间)🌸</a></li><li><a href="/pages/c83472/" class="sidebar-link">后端技术面试38讲(极客时间)</a></li><li><a href="/pages/4404b6/" class="sidebar-link">架构实战案例解析(极客时间)🌸</a></li><li><a href="/pages/8f1c1d/" class="sidebar-link">如何设计一个秒杀系统(极客时间)</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>容器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>容器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/582acf/" class="sidebar-link">部署Minikube</a></li><li><a href="/pages/98e5e4/" class="sidebar-link">容器实战高手课(极客时间)🌸</a></li><li><a href="/pages/c6a42c/" class="sidebar-link">Kubernetes实战🌸</a></li><li><a href="/pages/f35c72/" class="sidebar-link">深入剖析Kubernetes(极客时间)🌸</a></li><li><a href="/pages/caa314/" class="sidebar-link">Istio</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>自动化运维</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/beb97f/" class="sidebar-link">持续集成(CICD)</a></li><li><a href="/pages/a0df2d/" class="sidebar-link">DevOps</a></li><li><a href="/pages/765815/" class="sidebar-link">SRE实战手册(极客时间)</a></li></ul></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/middleware/#系统" data-v-06970110>系统</a></li><li data-v-06970110><a href="/middleware/#系统" data-v-06970110>系统</a></li><li data-v-06970110><a href="/middleware/#中间件-缓存" data-v-06970110>中间件-缓存</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/nanodaemony" target="_blank" title="作者" class="beLink" data-v-06970110>NanoDaemony</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2025-02-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">本文目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">缓存基础<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_10-缓存基础"><a href="#_10-缓存基础" class="header-anchor">#</a> 10.缓存基础</h1> <h4 id="缓存基础"><a href="#缓存基础" class="header-anchor">#</a> 缓存基础</h4> <h5 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1.概述</h5> <blockquote><p>缓存能够提高性能的原因</p></blockquote> <ul><li>缓存数据通常位于<strong>内存等介质</strong>中, 数据<strong>读取</strong>特别快.</li> <li>缓存数据可以位于<strong>靠近用户的地理位置</strong>上.</li> <li>可以将计算结果进行缓存, 从而<strong>避免重复计算</strong>.</li></ul> <h5 id="_2-基本概念"><a href="#_2-基本概念" class="header-anchor">#</a> 2.基本概念</h5> <p><strong>缓存命中率</strong>: 当某个请求能够通过访问缓存而得到响应时, 称为<strong>缓存命中</strong>. 缓存命中率越高, 缓存利用率也就越高.</p> <p><strong>最大空间</strong>: 缓存通常位于内存中, 内存空间通常比磁盘空间小的多, 因此缓存的最大空间不可能非常大. 当缓存存放的数据量<strong>超过最大空间</strong>时, 就需要<strong>淘汰</strong>部分数据来存放新的数据.</p> <h4 id="缓存实现与缓存位置🌟"><a href="#缓存实现与缓存位置🌟" class="header-anchor">#</a> 缓存实现与缓存位置🌟</h4> <h5 id="_1-浏览器"><a href="#_1-浏览器" class="header-anchor">#</a> 1.浏览器</h5> <p>当 HTTP 响应<strong>允许</strong>进行缓存时, 浏览器会将 HTML, CSS, JavaScript, 图片等<strong>静态</strong>资源进行缓存.</p> <h5 id="_2-isp"><a href="#_2-isp" class="header-anchor">#</a> 2.ISP</h5> <p><strong>网络服务提供商</strong>(ISP) 是网络访问的<strong>第一跳</strong>, 通过将<strong>数据缓存在 ISP 中</strong>能够大大提高用户的<strong>访问速度</strong>.</p> <h5 id="_3-cdn"><a href="#_3-cdn" class="header-anchor">#</a> 3.CDN</h5> <p><strong>内容分发网络</strong>(Content distribution network, CDN) 是一种<strong>互连的网络系统</strong>, 它利用<strong>更靠近用户的服务器</strong>从而更快更可靠地将 HTML, CSS, JavaScript, 音乐, 图片, 视频等<strong>静态资源分发给用户</strong>.</p> <p>CDN 主要有以下优点:</p> <ul><li>更快地将数据分发给用户.</li> <li>通过部署多台服务器, 从而提高系统整体的带宽性能.</li> <li>多台服务器可以看成是一种<strong>冗余机制</strong>, 从而具有高可用性.</li></ul> <h5 id="_4-反向代理"><a href="#_4-反向代理" class="header-anchor">#</a> 4.反向代理</h5> <p>反向代理位于服务器之前, 请求与响应都需要经过反向代理. 通过将<strong>数据缓存在反向代理</strong>, 在用户请求反向代理时就可以直接使用缓存进行响应.</p> <h5 id="_5-本地缓存"><a href="#_5-本地缓存" class="header-anchor">#</a> 5.本地缓存</h5> <p>使用 <strong>Guava Cache</strong> 将数据缓存在<strong>服务器本地内存</strong>中, 服务器代码可以直接读取本地内存中的缓存, 速度非常快.</p> <p>缓存分为<strong>本地缓存和分布式缓存</strong>. Java <strong>自带的 ConcurrentHashMap 或 Guava</strong> 实现的是本地缓存, 最主要的特点是轻量以及快速, <strong>生命周期</strong>随着 JVM 的销毁而结束, 并且在多实例的情况下, <strong>每个实例都需要各自保存一份缓存</strong>, 多个机器<strong>缓存不具有一致性</strong>. 通常用于保存变化较少的数据.</p> <h5 id="_6-分布式缓存"><a href="#_6-分布式缓存" class="header-anchor">#</a> 6.分布式缓存</h5> <p>使用 Redis, Memcache 等<strong>分布式缓存</strong>将数据缓存在分布式缓存系统中. 相对于本地缓存来说, 分布式缓存需单独部署, 可以根据需求分配硬件资源. <strong>服务器集群都可以访问分布式缓存</strong>, 而本地缓存需要在服务器集群之间进行同步, 实现难度和性能开销上都更大.</p> <p>在多实例情况下, 各实例共用一份缓存数据, <strong>缓存数据具有一致性</strong>. 由于需要保证 Redis 服务的<strong>高可用</strong>, 整个程序架构上较为复杂.</p> <h5 id="_7-数据库缓存"><a href="#_7-数据库缓存" class="header-anchor">#</a> 7.数据库缓存</h5> <p>MySQL 等数据库具有自己的<strong>查询缓存机制</strong>来提高查询效率.</p> <h5 id="_8-java内部缓存"><a href="#_8-java内部缓存" class="header-anchor">#</a> 8.Java内部缓存</h5> <p>Java 为了优化空间, 提高字符串, 基本数据类型包装类的创建效率, 设计了字符串常量池及 Byte, Short, Character, Integer, Long, Boolean 这六种包装类<strong>缓冲池</strong>.</p> <h5 id="_9-cpu多级缓存"><a href="#_9-cpu多级缓存" class="header-anchor">#</a> 9.CPU多级缓存</h5> <p>CPU 为了解决运算速度与<strong>主存 IO 速度不匹配</strong>的问题, 引入了<strong>多级缓存</strong>结构, 同时使用 MESI 等缓存一致性协议来<strong>解决多核 CPU 缓存数据一致性的问题</strong>.</p> <h4 id="缓存淘汰-更新-策略🌟"><a href="#缓存淘汰-更新-策略🌟" class="header-anchor">#</a> 缓存淘汰(更新)策略🌟</h4> <p>缓存淘汰算法通常用于缓存使用量<strong>超过了预设最大值</strong>的时候, 实现对现有数据进行剔除.</p> <h6 id="_1-fifo-lru-lfu算法剔除"><a href="#_1-fifo-lru-lfu算法剔除" class="header-anchor">#</a> (1)FIFO/LRU/LFU算法剔除</h6> <p><strong>先进先出策略</strong> FIFO(First In First Out): 在实时性场景下, 需要经常访问最新的数据, 那么就可以使用 FIFO, 使得最先进入的数据被淘汰.</p> <p><strong>最近最久未使用策略</strong> LRU(Least Recently Used): 优先淘汰<strong>最久未使用</strong>的数据, 也就是上次<strong>被访问时间距离现在最久</strong>的数据. 该策略可以保证内存中的数据都是热点数据, 也就是经常被访问的数据, 从而保证缓存命中率.</p> <p><strong>最不经常使用策略</strong> LFU(Least Frequently Used): 优先淘汰一段时间内使用<strong>次数最少</strong>的数据.</p> <h6 id="_2-超时剔除"><a href="#_2-超时剔除" class="header-anchor">#</a> (2)超时剔除</h6> <p>通过给缓存数据<strong>设置超时时间</strong>, 让其在过期时间后<strong>自动删除</strong>, 如 Redis 提供的 <strong>expire</strong> 命令.</p> <h6 id="_3-主动更新"><a href="#_3-主动更新" class="header-anchor">#</a> (3)主动更新</h6> <p>对于<strong>高一致性要求</strong>场景下, 需要在真实数据更新后, <strong>立即</strong>更新缓存数据.</p> <h4 id="缓存问题🌟"><a href="#缓存问题🌟" class="header-anchor">#</a> 缓存问题🌟</h4> <p><strong>缓存</strong>也可能存在一些问题.</p> <h5 id="_1-缓存穿透"><a href="#_1-缓存穿透" class="header-anchor">#</a> 1.缓存穿透</h5> <h6 id="_1-概述-2"><a href="#_1-概述-2" class="header-anchor">#</a> (1)概述</h6> <p>缓存穿透指的是<strong>对某个缓存中一定不存在的数据进行请求, 该请求将会穿透缓存到达数据库</strong>. 举个例子: 某个黑客故意制造缓存中<strong>不存在的 key</strong> 发起<strong>大量请求</strong>, 导致大量请求落到数据库.</p> <p>正常缓存处理流程:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211218174357591.png" alt=""></p> <p>缓存穿透情况:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211218174250613.png" alt=""></p> <p>一般 MySQL 默认的最大连接数在 150 左右, 这个可以通过 <strong>show variables like '%max_connections%';</strong>  命令来查看. 最大连接数一个还只是一个指标, CPU, 内存, 磁盘, 网络等无力条件都是其运行指标, 这些指标都会限制其并发能力! 所以一般 3000 个并发请求就能打死大部分数据库了.</p> <h6 id="_2-解决方案"><a href="#_2-解决方案" class="header-anchor">#</a> (2)解决方案</h6> <p>首先可以在<strong>应用层</strong>记录一下<strong>缓存穿透的次数</strong>, 方便问题查找与预警.</p> <blockquote><p>参数校验</p></blockquote> <p><strong>最基本</strong>的就是首先<strong>做好参数校验</strong>, 一些不合法的参数请求直接<strong>抛出异常信息</strong>返回给客户端. 比如查询的<strong>数据库 id 不能小于</strong> 0, 传入的邮箱<strong>格式不对</strong>的时候直接返回错误消息给客户端等等.</p> <blockquote><p>缓存无效key</p></blockquote> <p>如果缓存和数据库<strong>都查不到</strong>某个 key 的数据就<strong>写一个</strong>这个键的<strong>空对象</strong>到 Redis 中去并<strong>设置过期时间</strong>, 具体命令如下:</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>SET key value EX 10086
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这种方式可以解决请求的 <strong>key 变化不频繁</strong>的情况, 但如果黑客恶意攻击, 每次构建不同的请求 key, 会导致 Redis 中缓存大量无效的 key. 很明显这种方案并不能从根本上解决此问题. 如果用这种方式来解决穿透问题的话, <strong>尽量将无效</strong>的 key 的过期时间设置<strong>短一点</strong>比如 1 分钟.</p> <p>整体流程大致如下:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getObjectInclNullById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从缓存中获取数据</span>
    <span class="token class-name">Object</span> cacheValue <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 缓存为空</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 从数据库中获取</span>
        <span class="token class-name">Object</span> storageValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 缓存空对象</span>
        cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> storageValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果存储数据为空, 需要设置一个较短的过期时间(300秒)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>storageValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 必须设置过期时间, 否则如果键变化较大可能造成Redis内存不够用</span>
            cache<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> storageValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cacheValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><blockquote><p>使用布隆过滤器</p></blockquote> <p>需要做的就是<strong>判断 key 是否合法</strong>. <strong>事先</strong>把所有<strong>可能存在的请求的值都存放在布隆过滤器</strong>中, 当用户请求过来, 先判断<strong>请求的值是否存在于布隆过滤器</strong>中. <strong>不存在</strong>则直接返回<strong>请求参数错误</strong>信息给客户端, 存在时才会走下面的流程. 布隆过滤器在缓存层<strong>之前</strong>. 如下图所示.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20211218174647325.png" alt=""></p> <p>这种方法适用于数据<strong>命中率不高, 数据相对固定</strong>, 实时性低(通常是<strong>数据集较大</strong>) 的场景.</p> <p>使用 BloomFilter 布隆过滤器的话, 需要<strong>提前将已存在的 KEY 始化存储</strong>到 BloomFilter 缓存中. 整个逻辑如下: 根据 KEY 查询 BloomFilter 缓存. 如果<strong>不存在对应的值, 直接返回</strong>; 如果存在就说明是大概率是系统预先存入的键, 这时候就可以去 Redis 中查询是否存在缓存. 如果存在缓存值, 直接返回; 如果不存在则继续到数据库去查数据. 找到的数据可以再次存储到 Redis 中, 并且可以<strong>更新 BloomFilter</strong> 缓存记录.</p> <p>BloomFilter 的实现参考: 实现布隆过滤器.</p> <h5 id="_2-缓存雪崩"><a href="#_2-缓存雪崩" class="header-anchor">#</a> 2.缓存雪崩</h5> <h6 id="_1-概述-3"><a href="#_1-概述-3" class="header-anchor">#</a> (1)概述</h6> <p>缓存雪崩<strong>指由于数据没有被加载到缓存中, 或缓存数据在同一时间大面积过期失效, 或缓存服务器宕机等, 导致大量请求同时打到数据库, 造成数据库压力过大</strong>. 在系统缓存命中率较高时, 缓存分担了很大一部分数据请求. 当发生缓存雪崩时, 数据库无法处理这么大的请求, 导致数据库崩溃. 就像<strong>雪崩</strong>一样.</p> <h6 id="_2-解决方案-2"><a href="#_2-解决方案-2" class="header-anchor">#</a> (2)解决方案</h6> <ul><li>为了防止缓存在同一时间大面积过期导致的缓存雪崩, 可以通过<strong>观察用户行为</strong>, 合理设置<strong>缓存过期时间</strong>. 热点数据设置永不过期, 一般数据错开过期时间, 比如设置<strong>随机过期值</strong>而不是全部一样.</li> <li>为了防止缓存服务器宕机出现的缓存雪崩, 可以使用<strong>分布式缓存</strong>, 保证<strong>缓冲层的高可用</strong>. 分布式缓存中每一个节点只缓存部分的数据, 当某个节点宕机时可以保证其它节点的缓存仍然可用, 实现<strong>高可用</strong>.</li> <li>可以进行<strong>缓存预热</strong>, <strong>提前放一些数据到缓存中</strong>, 避免在系统刚启动不久由于还未将大量数据进行缓存而导致缓存雪崩.</li> <li><strong>依赖隔离组件为后端限流并降级</strong>. 可以考虑进行<strong>服务降级</strong>, 并对重要的资源进行<strong>隔离</strong>.</li></ul> <p>另一种说法:</p> <ul><li><strong>事前</strong>: 尽量保证整个 Redis 集群的<strong>高可用性</strong>, 发现机器宕机尽快补上. 选择合适的<strong>内存淘汰策略</strong>.</li> <li><strong>事中</strong>: <strong>本地缓存</strong> + <strong>限流与降级</strong>, 避免 MySQL 崩掉.</li> <li><strong>事后</strong>: 利用 Redis <strong>持久化</strong>机制保存的数据<strong>尽快恢复缓存</strong>.</li></ul> <h5 id="_3-缓存一致性问题"><a href="#_3-缓存一致性问题" class="header-anchor">#</a> 3.缓存一致性问题</h5> <h6 id="_1-概述-4"><a href="#_1-概述-4" class="header-anchor">#</a> (1)概述</h6> <p><strong>由于数据更新, 可能导致缓存层和存储层的数据不一致</strong>. 缓存一致性要求数据<strong>更新的同时缓存数据也能够实时更新</strong>.</p> <p>更新 DB 和操作缓存两个动作之间, 明显<strong>缺乏原子性</strong>, 有可能更新 DB 完成, 但是操作缓存失败(淘汰或者更新), 反之亦然. 所以两者之间必然是存在断层的.</p> <h6 id="_2-解决方案-3"><a href="#_2-解决方案-3" class="header-anchor">#</a> (2)解决方案</h6> <p><strong>可以考虑先更新数据库, 再删除缓存</strong>. 如果采用先淘汰缓存, 后更新 DB 操作, 如果在 DB 更新完成之前, 来了一个新的读请求, 那么就会查询出数据库的旧数据, 缓存到 Redis, 导致 DB 更新完成之后, 两者数据不一致. 如果先更新 DB, 然后操作缓存失败, 客户端读取到的是旧的数据, 此时也是存在 DB 与缓存不一致. 但是实际业务上, 更多<strong>还是以 DB 数据为准</strong>, 这种读取到旧数据的业务影响可能比读取到为未更新到 DB 的数据影响要小. 使用缓存本身就能容忍有一定的脏数据出现.</p> <p>要保证缓存一致性需要付出很大的代价, <mark><strong>缓存数据最好是那些对一致性要求不高的数据, 允许缓存数据存在一些脏数据</strong></mark>.</p> <h5 id="_4-缓存无底洞"><a href="#_4-缓存无底洞" class="header-anchor">#</a> 4.缓存无底洞</h5> <h6 id="_1-概述-5"><a href="#_1-概述-5" class="header-anchor">#</a> (1)概述</h6> <p>缓存 &quot;无底洞&quot; 指的是为了满足业务要求<strong>添加了大量缓存节点</strong>, 但是<strong>性能不但没有好转反而下降</strong>了的现象.</p> <p><strong>产生原因</strong>: 缓存系统通常<strong>采用 hash 函数将 key 映射到对应的缓存节点</strong>, 随着缓存节点数目的增加, <strong>键值分布到更多的节点上</strong>, 导致客户端一次批量操作会涉及<strong>多次网络操作</strong>, 这意味着批量操作的<strong>耗时会随着节点数目的增加而不断增大</strong>. 此外, 网络连接数变多, 对节点的性能也有一定影响.</p> <h6 id="_2-解决方案-4"><a href="#_2-解决方案-4" class="header-anchor">#</a> (2)解决方案</h6> <ul><li>优化<strong>批量数据</strong>操作命令.</li> <li>减少网络通信<strong>次数</strong>.</li> <li>降低<strong>接入成本</strong>, 使用长连接, 连接池, <strong>NIO</strong> 等.</li></ul> <p><strong>分布式</strong>条件下, 以 Redis 的 <strong>mget</strong> 指令为例, 有<strong>四种批量操作的解决方案</strong>.</p> <ul><li>串行命令. 逐次执行 n 个 get 命令.</li> <li>串行 IO. 在客户端缓存&quot;<strong>键-槽-节点</strong>&quot;的对应关系, 在同一个节点的数据使用 Pipeline 请求完成.</li> <li>并行 IO. 使用多线程方式进行串行 IO.</li> <li>hash_tag 实现. Redis cluster 的 hash_tag 功能可以将多个 key 强制分配到一个节点上, 减少操作.</li></ul> <h4 id="数据分布方式"><a href="#数据分布方式" class="header-anchor">#</a> 数据分布方式</h4> <p>分布式数据库首先要解决把<strong>整个数据集</strong>按照分区规则<strong>映射到多个节点</strong>的问题, 即把数据集划分到多个节点上, 每个<strong>节点</strong>负责整体数据的一个<strong>子集</strong>. 数据分区是<strong>分布式存储的核心</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220523215154473.png" alt=""></p> <p>需要重点关注的是<strong>数据分区方案</strong>. 常见的分区规则有<strong>哈希分区和顺序分区</strong>两种.</p> <ul><li><strong>顺序分区</strong>: 离散度易倾斜, 数据分布业务相关, 可顺序访问. 代表产品: <strong>HBase</strong>, Bigtable.</li> <li><strong>哈希分区</strong>: 离散度好, 数据分布业务无关, 无法顺序访问. 代表产品: <strong>Redis Cluster</strong>, Dynamo, Cassandra.</li></ul> <h5 id="_1-顺序分布"><a href="#_1-顺序分布" class="header-anchor">#</a> 1.顺序分布</h5> <p>将数据划分为<strong>多个连续</strong>的部分, 按数据的 ID 或者时间分布到不同节点上. 例如 User 表的 ID 范围为 1 ~ 7000, 使用顺序分布可以将其划分成多个子表, 对应的主键范围为 1 ~ 1000, 1001 ~ 2000, ..., 6001 ~ 7000.</p> <p>顺序分布相比于哈希分布的主要优点如下:</p> <ul><li>能保持数据原有的<strong>顺序</strong>.</li> <li>能够准确控制每台服务器存储的数据量, 从而使得存储空间的利用率最大.</li></ul> <h5 id="_2-哈希分布"><a href="#_2-哈希分布" class="header-anchor">#</a> 2.哈希分布</h5> <p><strong>哈希分布</strong>就是将数据计算哈希值之后, 按照<strong>哈希值</strong>映射结果分配到不同的节点上. 例如有 N 个节点, 数据的主键为 key, 则将该数据分配的节点序号为: <strong>hash(key) % N</strong>.</p> <blockquote><p>普通哈希分布的问题</p></blockquote> <p>传统的哈希分布算法存在一个问题: 当节点数量变化时, 如<strong>扩容或收缩节点</strong>, 数据节点映射关系都需要<strong>重新计算再哈希</strong>, 会导致数据的大量<strong>重新迁移</strong>. 所以扩容时通常采用<strong>翻倍扩容</strong>, 避免数据映射全部被打乱导致全量迁移的情况.</p> <h5 id="_3-一致性哈希分布🌟"><a href="#_3-一致性哈希分布🌟" class="header-anchor">#</a> 3.一致性哈希分布🌟</h5> <p><strong>Distributed Hash Table</strong>(DHT) 是一种<strong>哈希分布方式</strong>, 可以解决传统哈希分布在服务器节点数量变化再哈希时<strong>大量数据迁移</strong>的问题.</p> <h6 id="_1-基本原理"><a href="#_1-基本原理" class="header-anchor">#</a> (1)基本原理</h6> <p><strong>一致性哈希分区</strong>(Distributed Hash Table)实现思路是为系统中<strong>每个节点分配一个 token</strong>, 范围一般在 <code>0 ~ 2^32</code>​, 这些 token 构成一个<strong>哈希环</strong>. 每个服务器<strong>节点都会被配置到哈希环</strong>上.</p> <p>数据读写执行节点查找操作时, 先根据 key 计算 hash 值, <strong>存放到哈希环中顺时针方向第一个大于等于该哈希值 token 的节点上</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20200527211945450.png" alt="image-20200527211945450"></p> <p>一致性哈希分区将<strong>增加或者删除节点时只会影响到哈希环中相邻的节点</strong>. 以上图为例, 如果在 node1 和 node2 之间增加 node5, 则只有 node2 中的一部分数据会迁移到 node5; 如果去掉 node2, 则原 node2 中的数据只会迁移到 node4 中, 只有 node4 会受影响.</p> <blockquote><p>一致性哈希分布的问题</p></blockquote> <p>上面描述的一致性哈希依然可能存在数据<strong>分布不均匀</strong>的问题, 不同节点存储的<strong>数据量</strong>有可能会存在<strong>很大的不同</strong>. 数据不均匀主要是因为<strong>节点在哈希环上分布的不均匀</strong>, 这种情况在<strong>节点数量很少</strong>的情况下尤其明显.</p> <p>当<strong>节点数量较少</strong>时, 增加或删减节点, 对<strong>单个节点</strong>的影响可能很大, <strong>造成数据的严重不平衡</strong>. 还是以上图为例, 如果去掉 node2, node4 中的数据由总数据的 1/4 左右变为 1/2 左右, 与其他节点相比负载过高.</p> <h6 id="_2-虚拟节点"><a href="#_2-虚拟节点" class="header-anchor">#</a> (2)虚拟节点</h6> <p>正因为一致性哈希分区可能存在数据分布不均的缺点, 可以采用<strong>虚拟槽</strong>对一致性哈希进行改进.</p> <p><strong>解决方式是在一致性哈希分区的基础上, 增加多个虚拟节点, 然后将虚拟节点映射到真实节点上</strong>. 虚拟节点的数量比真实节点来得<strong>多</strong>, 那么虚拟节点在哈希环上分布的均匀性就会比原来的真实节点好, 从而使得数据分布也更加均匀.</p> <p>Redis 集群使用的便是该方案, 其中的<strong>虚拟节点</strong>称为<strong>槽(slot)</strong> . 槽是介于数据和实际节点之间的虚拟概念, 每个实际节点包含一定数量的槽, 每个槽包含哈希值在一定范围内的数据. 参考: Redis数据分区.</p> <p>虚拟槽分区巧妙地使用了<strong>哈希空间</strong>, 使用分散度良好的<strong>哈希函数</strong>把所有数据映射到一个<strong>固定范围</strong>的整数集合中, <strong>把整数定义为槽</strong>. 这个范围一般<strong>远远大于节点数</strong>, 比如 Redis Cluster 槽范围是 <strong>0 ~ 16383</strong>.</p> <p>在使用了槽的一致性哈希分区中, <strong>槽是数据管理和迁移的基本单位</strong>. <strong>槽解耦了数据和实际节点间的关系</strong>, 增加或删除节点对系统的影响很小. 假设系统中有 4 个实际节点, 假设为其分配 16 个槽(0 - 15), 那么槽 0 - 3 位于 node1; 4 - 7 位于 node2; 以此类推....如果此时删除 node2, 只需要<strong>将槽 4-7 重新分配</strong>即可, 例如槽 4-5 分配给 node1, 槽 6 分配给 node3, 槽 7 分配给 node4; 可以看出删除 node2 后, 数据在其他节点的分布<strong>仍然较为均衡</strong>.</p> <h6 id="_3-应用实例"><a href="#_3-应用实例" class="header-anchor">#</a> (3)应用实例</h6> <p><strong>给图片加水印的例子</strong>. 假设需要给图片加水印, 水印的背景总共有 10 个, 需要根据 imageId 选择映射到哪个水印背景. 如果采用普通的 Hash 并对水印数量取模的方式来选择图片, 那么一但新增或者减少水印图片, 那么可能导致大部分的图片映射到的水印背景发生变化. 如果采用一致性 Hash 的实现, 那么增加水印背景的数量后, 大部分的图片还是会映射到原来的水印背景上, 这样看起来更加一致.</p> <h4 id="缓存与数据库的双写一致性"><a href="#缓存与数据库的双写一致性" class="header-anchor">#</a> 缓存与数据库的双写一致性</h4> <p>只要用<strong>缓存</strong>, 就可能会涉及到缓存与数据库双存储双写, 只要是双写, 就一定会有数据一致性的问题, <strong>如何解决一致性问题</strong>?</p> <p>最经典的<strong>缓存 + 数据库读写</strong>的模式, 就是 <strong>Cache Aside Pattern</strong>.</p> <ul><li><strong>读的时候, 先读缓存, 缓存没有的话, 就读数据库, 然后取出数据后放入缓存, 同时返回响应</strong>.</li> <li><strong>更新的时候, 先更新数据库, 然后再删除缓存.</strong></li></ul> <p><strong>为什么是删除缓存, 而不是更新缓存?</strong></p> <p>因为在复杂点的缓存场景中, 缓存不仅是数据库中直接取出来的值. 比如可能更新了某个表的一个字段, 然后其对应的缓存, 是需要查询另外两个表的数据并进行<strong>运算</strong>, 才能计算出缓存的最新值.</p> <p>举个例子, 对于更新缓存的方案, 一个缓存涉及的表的字段, 在 1 分钟内就修改了 100 次, 那么缓存更新 100 次; 但是这个缓存在 1 分钟内<strong>只被读取了 1 次</strong>, 有大量的冷数据. 而如果是删除缓存的话, 那么在 1 分钟内, 这个缓存不过就<strong>重新计算一次</strong>而已, 开销大幅度降低.</p> <p><strong>用到缓存才去算缓存</strong>. <strong>删除缓存而不是更新缓存, 就是一个 lazy 计算的思想</strong>, 不要每次都重新做复杂的计算, 不管它会不会用到, 而是让它到需要被使用的时候再重新计算.</p> <p>问题: <strong>先更新数据库, 再删除缓存</strong>. 如果<strong>删除缓存失败</strong>了, 那么会<strong>导致数据库中是新数据, 缓存中是旧数据</strong>, 数据就出现了<strong>不一致</strong>.</p> <p>解决思路: <strong>先删除缓存, 再更新数据库</strong>. 如果<strong>数据库更新失败了, 那么数据库中是旧数据</strong>, 缓存中是<strong>空的</strong>, 那么数据不会不一致. 因为读的时候缓存没有, 所以去读了数据库中的旧数据, 然后更新到缓存中.</p> <p>问题: 数据发生了变更, 先删除了缓存, 然后要去修改数据库, <strong>此时还没修改</strong>. 一个请求过来, 去读缓存, 发现缓存空了, 去查询数据库, <strong>查到了修改前的旧数据</strong>, 放到了<strong>缓存</strong>中. 随后数据变更的程序完成了数据库的修改. 此时数据库和缓存中的数据不一致了.</p> <p><strong>为什么上亿流量高并发场景下, 缓存会出现这个问题?</strong></p> <p>只有在对一个数据在并发的进行读写的时候, 才可能会出现这种问题. 其实如果说并发量很低的话, 特别是读并发很低, 日活就 1 W, 那么很少的情况下, 会出现刚才描述的那种不一致的场景. 但如果日活上亿, 每秒并发读可能成千上万, 每秒只要有数据更新的请求, 就<strong>可能会出现上述的数据库 + 缓存不一致的情况</strong>.</p> <p><strong>解决方案如下:</strong></p> <p>更新数据的时候, 根据<strong>数据的唯一标识</strong>, 将操作路由之后, 发送到一个 JVM 内部队列中. 读取数据的时候, 如果发现数据不在缓存中, 那么将重新执行 &quot;读取数据+更新缓存&quot; 的操作, 根据唯一标识路由之后, 也发送到同一个 JVM 内部队列中.</p> <p>一个队列对应一个工作线程, 每个工作线程<strong>串行</strong>拿到对应的操作, 然后一条一条的执行. 这样的话, 一个数据变更的操作, 先删除缓存, 然后再去更新数据库, 但是还没完成更新. 此时如果一个读请求过来, 没有读到缓存, 那么可以先将缓存更新的请求发送到队列中, 此时会在队列中积压, 然后同步等待缓存更新完成.</p> <p>这里有一个<strong>优化点</strong>, 一个队列中, 其实<strong>多个更新缓存请求串在一起是没意义的</strong>, 因此可以做过滤, 如果发现队列中已经有一个更新缓存的请求了, 那么就不用再放个更新请求操作进去了, 直接等待前面的更新操作请求完成即可.</p> <p>待那个队列对应的工作线程完成了上一个操作的数据库的修改之后, 才会去执行下一个操作, 也就是缓存更新的操作, 此时会从数据库中读取最新的值, 然后写入缓存中.</p> <p>如果请求还在等待时间范围内, 不断轮询发现可以取到值了, 那么就直接返回; 如果请求等待的时间超过一定时长, 那么这一次直接从数据库中读取当前的旧值.</p> <h4 id="lru实现"><a href="#lru实现" class="header-anchor">#</a> LRU实现</h4> <p>以下是基于 <strong>双向链表 + HashMap</strong> 的 LRU 算法实现, 对算法的解释如下:</p> <ul><li><strong>访问</strong>某个节点时, 将其从原来的位置<strong>删除</strong>, 并重新插入到<strong>链表头部</strong>. 这样就能保证链表<strong>尾部</strong>存储的就是<strong>最近最久未使用</strong>的节点, 当节点数量<strong>大于</strong>缓存最大空间时就<strong>淘汰</strong>链表尾部的节点.</li> <li>为了使<strong>删除</strong>操作时间复杂度为 <strong>O(1)</strong> , 就不能采用遍历的方式找到某个节点. <strong>HashMap</strong> 存储着 <strong>Key 到节点</strong>的映射, 通过 Key 就能以 O(1) 的时间得到节点, 然后再以 O(1) 的时间将其从<strong>双向队列</strong>中删除.</li> <li>采⽤这两种数据结构的组合, get 操作就可以在 <strong>O(1)</strong>  时间复杂度内完成了. 由于 put 操作要删除的节点⼀般是尾部节点, 所以可以⽤⼀个变量 tail 时刻记录尾部节点的位置, 这样 put 操作也可以在 O(1) 时间内完成了.</li></ul> <p>先来一个结点类.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LRUNode</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> key<span class="token punctuation">;</span>
    <span class="token class-name">Object</span> value<span class="token punctuation">;</span>
    <span class="token class-name">LRUNode</span> next<span class="token punctuation">;</span>
    <span class="token class-name">LRUNode</span> pre<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">LRUNode</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>注意: 不管是 put 方法还是 get 方法, <strong>都需要将访问的结点重新放到链表头部</strong>, 所以会抽出一个公共的方法.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LRUCache</span> <span class="token punctuation">{</span>

    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">LRUNode</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LRUNode</span> head<span class="token punctuation">;</span>
    <span class="token class-name">LRUNode</span> tail<span class="token punctuation">;</span>
    <span class="token comment">// 缓存最⼤容量大于1</span>
    <span class="token keyword">int</span> capacity<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">LRUCache</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> capacity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** 插入元素 */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 说明缓存中没有任何元素</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>head <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LRUNode</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tail <span class="token operator">=</span> head<span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 说明缓存中已经存在这个元素了</span>
        <span class="token class-name">LRUNode</span> node <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 更新值</span>
            node<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token comment">// 把这个结点从链表删除并且插⼊到头结点</span>
            <span class="token function">removeAndInsert</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 说明当前缓存不存在这个值</span>
            <span class="token class-name">LRUNode</span> newHead <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LRUNode</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 此处溢出则需要删除最近最近未使用的节点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>tail<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 删除尾结点</span>
                tail <span class="token operator">=</span> tail<span class="token punctuation">.</span>pre<span class="token punctuation">;</span>
                tail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> newHead<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 将新的结点插入链表头部</span>
            newHead<span class="token punctuation">.</span>next <span class="token operator">=</span> head<span class="token punctuation">;</span>
            head<span class="token punctuation">.</span>pre <span class="token operator">=</span> newHead<span class="token punctuation">;</span>
            head <span class="token operator">=</span> newHead<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** 从缓存中取值 */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LRUNode</span> node <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果有值则需要将这个结点放到链表头部</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 把这个节点删除并插⼊到头结点</span>
            <span class="token function">removeAndInsert</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> node<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">removeAndInsert</span><span class="token punctuation">(</span><span class="token class-name">LRUNode</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 特殊情况先判断, 例如该节点是头结点或是尾部节点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token generics"><span class="token punctuation">&lt;</span>mark<span class="token punctuation">&gt;</span></span> head<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">&lt;</span><span class="token operator">/</span>mark<span class="token operator">&gt;</span> tail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tail <span class="token operator">=</span> node<span class="token punctuation">.</span>pre<span class="token punctuation">;</span>
            tail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            node<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            node<span class="token punctuation">.</span>next<span class="token punctuation">.</span>pre <span class="token operator">=</span> node<span class="token punctuation">.</span>pre<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 插⼊到头结点</span>
        node<span class="token punctuation">.</span>next <span class="token operator">=</span> head<span class="token punctuation">;</span>
        node<span class="token punctuation">.</span>pre <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        head<span class="token punctuation">.</span>pre <span class="token operator">=</span> node<span class="token punctuation">;</span>
        head <span class="token operator">=</span> node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p><strong>LinkedHashMap</strong> 也可以用来实现<strong>固定大小</strong>的 LRU 缓存, 当 LRU 缓存已经满了的时候, 它会把最老的键值对移出缓存. LinkedHashMap 提供了一个称为 <strong>removeEldestEntry()</strong>  的方法, 该方法会被 put() 和 putAll() 调用来删除最老的键值对. 参考: LinkedHashMap缓存应用.</p> <p>‍</p> <p>‍</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <ul><li>大规模分布式存储系统</li> <li><a href="https://tech.meituan.com/cache_about.html" target="_blank" rel="noopener noreferrer">缓存那些事<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://my.oschina.net/jayhu/blog/732849" target="_blank" rel="noopener noreferrer">一致性哈希算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zh.wikipedia.org/wiki/%E5%85%A7%E5%AE%B9%E5%82%B3%E9%81%9E%E7%B6%B2%E8%B7%AF" target="_blank" rel="noopener noreferrer">内容分发网络<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/main/docs/30.系统/3000.系统/1200.中间件-缓存/10.缓存基础.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/249149/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">消息队列高手课(极客时间)🌟</div></a> <a href="/pages/e46d56/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">本地缓存</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/249149/" class="prev">消息队列高手课(极客时间)🌟</a></span> <span class="next"><a href="/pages/e46d56/">本地缓存</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:1174520425@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/nanodaemony" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2025
    <span>达尔文的猹 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3f3e0e10.js" defer></script><script src="/assets/js/2.e9fcb30c.js" defer></script><script src="/assets/js/3.1998f389.js" defer></script><script src="/assets/js/153.965e3fb2.js" defer></script>
  </body>
</html>
