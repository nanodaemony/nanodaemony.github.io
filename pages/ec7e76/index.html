<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL架构与日志 | Pangolin</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="大道至简">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.76d9f797.css" as="style"><link rel="preload" href="/assets/js/app.5bc2c979.js" as="script"><link rel="preload" href="/assets/js/2.eccd4273.js" as="script"><link rel="preload" href="/assets/js/179.b634397c.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8038d8.js"><link rel="prefetch" href="/assets/js/100.db890b43.js"><link rel="prefetch" href="/assets/js/101.9b9a913e.js"><link rel="prefetch" href="/assets/js/102.b98098b4.js"><link rel="prefetch" href="/assets/js/103.20eafae5.js"><link rel="prefetch" href="/assets/js/104.5f942f86.js"><link rel="prefetch" href="/assets/js/105.a443c173.js"><link rel="prefetch" href="/assets/js/106.6530e112.js"><link rel="prefetch" href="/assets/js/107.7b05a1d1.js"><link rel="prefetch" href="/assets/js/108.8c45adc4.js"><link rel="prefetch" href="/assets/js/109.ea29e43c.js"><link rel="prefetch" href="/assets/js/11.8d2b228f.js"><link rel="prefetch" href="/assets/js/110.0765054b.js"><link rel="prefetch" href="/assets/js/111.ae06b85d.js"><link rel="prefetch" href="/assets/js/112.b27bb80e.js"><link rel="prefetch" href="/assets/js/113.592e5b3f.js"><link rel="prefetch" href="/assets/js/114.677c3c60.js"><link rel="prefetch" href="/assets/js/115.fb35062d.js"><link rel="prefetch" href="/assets/js/116.19de2d57.js"><link rel="prefetch" href="/assets/js/117.ac783334.js"><link rel="prefetch" href="/assets/js/118.06b27dd3.js"><link rel="prefetch" href="/assets/js/119.cf6bb932.js"><link rel="prefetch" href="/assets/js/12.8764d408.js"><link rel="prefetch" href="/assets/js/120.ba8e09a5.js"><link rel="prefetch" href="/assets/js/121.bc501a72.js"><link rel="prefetch" href="/assets/js/122.c9a3dd47.js"><link rel="prefetch" href="/assets/js/123.b474c20b.js"><link rel="prefetch" href="/assets/js/124.f405a8c5.js"><link rel="prefetch" href="/assets/js/125.24083f67.js"><link rel="prefetch" href="/assets/js/126.3c5c6c33.js"><link rel="prefetch" href="/assets/js/127.b561056f.js"><link rel="prefetch" href="/assets/js/128.58891fb1.js"><link rel="prefetch" href="/assets/js/129.5073fbfd.js"><link rel="prefetch" href="/assets/js/13.1034e1a1.js"><link rel="prefetch" href="/assets/js/130.ca12ca1d.js"><link rel="prefetch" href="/assets/js/131.8e520e7f.js"><link rel="prefetch" href="/assets/js/132.0f186ee2.js"><link rel="prefetch" href="/assets/js/133.1d8479f7.js"><link rel="prefetch" href="/assets/js/134.9c30d69b.js"><link rel="prefetch" href="/assets/js/135.91463dab.js"><link rel="prefetch" href="/assets/js/136.5e57454a.js"><link rel="prefetch" href="/assets/js/137.1d4e51f0.js"><link rel="prefetch" href="/assets/js/138.6cd3ac7f.js"><link rel="prefetch" href="/assets/js/139.7bd789a6.js"><link rel="prefetch" href="/assets/js/14.ead46968.js"><link rel="prefetch" href="/assets/js/140.e1d92390.js"><link rel="prefetch" href="/assets/js/141.23e11057.js"><link rel="prefetch" href="/assets/js/142.c8cc0f38.js"><link rel="prefetch" href="/assets/js/143.fc738cb7.js"><link rel="prefetch" href="/assets/js/144.67c64203.js"><link rel="prefetch" href="/assets/js/145.cc73ed45.js"><link rel="prefetch" href="/assets/js/146.adaac4c0.js"><link rel="prefetch" href="/assets/js/147.0e83b5c1.js"><link rel="prefetch" href="/assets/js/148.1f253a46.js"><link rel="prefetch" href="/assets/js/149.ab428593.js"><link rel="prefetch" href="/assets/js/15.198f32e1.js"><link rel="prefetch" href="/assets/js/150.64cd514e.js"><link rel="prefetch" href="/assets/js/151.ca1ae55a.js"><link rel="prefetch" href="/assets/js/152.4119b23d.js"><link rel="prefetch" href="/assets/js/153.ed663263.js"><link rel="prefetch" href="/assets/js/154.71b836f6.js"><link rel="prefetch" href="/assets/js/155.c47e2e88.js"><link rel="prefetch" href="/assets/js/156.3e91e0f4.js"><link rel="prefetch" href="/assets/js/157.811b1421.js"><link rel="prefetch" href="/assets/js/158.71193c19.js"><link rel="prefetch" href="/assets/js/159.f09778fd.js"><link rel="prefetch" href="/assets/js/16.03096de2.js"><link rel="prefetch" href="/assets/js/160.15d99de4.js"><link rel="prefetch" href="/assets/js/161.813166a0.js"><link rel="prefetch" href="/assets/js/162.c52bbf77.js"><link rel="prefetch" href="/assets/js/163.ada6991a.js"><link rel="prefetch" href="/assets/js/164.d8ceba57.js"><link rel="prefetch" href="/assets/js/165.a645ef3a.js"><link rel="prefetch" href="/assets/js/166.995d24ad.js"><link rel="prefetch" href="/assets/js/167.d7278e80.js"><link rel="prefetch" href="/assets/js/168.e388905a.js"><link rel="prefetch" href="/assets/js/169.52edabbb.js"><link rel="prefetch" href="/assets/js/17.a49f9c19.js"><link rel="prefetch" href="/assets/js/170.0b62c5b4.js"><link rel="prefetch" href="/assets/js/171.017c8997.js"><link rel="prefetch" href="/assets/js/172.f0763c39.js"><link rel="prefetch" href="/assets/js/173.c961bf43.js"><link rel="prefetch" href="/assets/js/174.395224c0.js"><link rel="prefetch" href="/assets/js/175.52fbdc96.js"><link rel="prefetch" href="/assets/js/176.14e0a3b2.js"><link rel="prefetch" href="/assets/js/177.78f7d89f.js"><link rel="prefetch" href="/assets/js/178.c08bdd65.js"><link rel="prefetch" href="/assets/js/18.9786a034.js"><link rel="prefetch" href="/assets/js/180.284b6c99.js"><link rel="prefetch" href="/assets/js/181.b4744ee7.js"><link rel="prefetch" href="/assets/js/182.8bfd08cd.js"><link rel="prefetch" href="/assets/js/183.59b0b92b.js"><link rel="prefetch" href="/assets/js/184.a5fae95c.js"><link rel="prefetch" href="/assets/js/185.dcf55c72.js"><link rel="prefetch" href="/assets/js/186.6b1cf319.js"><link rel="prefetch" href="/assets/js/187.312708d0.js"><link rel="prefetch" href="/assets/js/188.71de21d0.js"><link rel="prefetch" href="/assets/js/189.7d72c108.js"><link rel="prefetch" href="/assets/js/19.089d6618.js"><link rel="prefetch" href="/assets/js/190.85dce0bd.js"><link rel="prefetch" href="/assets/js/191.08f7136b.js"><link rel="prefetch" href="/assets/js/192.6a155217.js"><link rel="prefetch" href="/assets/js/193.64f71670.js"><link rel="prefetch" href="/assets/js/194.c4d60c72.js"><link rel="prefetch" href="/assets/js/195.748850e9.js"><link rel="prefetch" href="/assets/js/196.887ef31c.js"><link rel="prefetch" href="/assets/js/197.4473c177.js"><link rel="prefetch" href="/assets/js/198.ea53a990.js"><link rel="prefetch" href="/assets/js/199.886f6490.js"><link rel="prefetch" href="/assets/js/20.a52783e8.js"><link rel="prefetch" href="/assets/js/200.7619a798.js"><link rel="prefetch" href="/assets/js/201.d3f5de5f.js"><link rel="prefetch" href="/assets/js/202.ed4c18cc.js"><link rel="prefetch" href="/assets/js/203.7937068e.js"><link rel="prefetch" href="/assets/js/204.3dbdd61c.js"><link rel="prefetch" href="/assets/js/205.52bc6fdf.js"><link rel="prefetch" href="/assets/js/206.4393998f.js"><link rel="prefetch" href="/assets/js/207.ec8e121d.js"><link rel="prefetch" href="/assets/js/208.f54d4e42.js"><link rel="prefetch" href="/assets/js/209.1bc5d06d.js"><link rel="prefetch" href="/assets/js/21.2e3bed21.js"><link rel="prefetch" href="/assets/js/210.2a3dc088.js"><link rel="prefetch" href="/assets/js/211.7084c526.js"><link rel="prefetch" href="/assets/js/212.de742850.js"><link rel="prefetch" href="/assets/js/213.fc775028.js"><link rel="prefetch" href="/assets/js/214.e338168c.js"><link rel="prefetch" href="/assets/js/215.3e89c57e.js"><link rel="prefetch" href="/assets/js/216.ecfe7587.js"><link rel="prefetch" href="/assets/js/217.14dcd4a2.js"><link rel="prefetch" href="/assets/js/218.ee7d57f7.js"><link rel="prefetch" href="/assets/js/219.c263c1e8.js"><link rel="prefetch" href="/assets/js/22.3d09766f.js"><link rel="prefetch" href="/assets/js/220.33f2bfd2.js"><link rel="prefetch" href="/assets/js/221.cd55e739.js"><link rel="prefetch" href="/assets/js/222.63107647.js"><link rel="prefetch" href="/assets/js/223.768ef403.js"><link rel="prefetch" href="/assets/js/224.54357078.js"><link rel="prefetch" href="/assets/js/225.b8e46582.js"><link rel="prefetch" href="/assets/js/226.1d0dcae9.js"><link rel="prefetch" href="/assets/js/227.a351c0a1.js"><link rel="prefetch" href="/assets/js/228.f7b8c278.js"><link rel="prefetch" href="/assets/js/229.8e4aba4d.js"><link rel="prefetch" href="/assets/js/23.b87e3933.js"><link rel="prefetch" href="/assets/js/230.186bd7a5.js"><link rel="prefetch" href="/assets/js/231.dad483e1.js"><link rel="prefetch" href="/assets/js/232.26555358.js"><link rel="prefetch" href="/assets/js/233.658ba0e4.js"><link rel="prefetch" href="/assets/js/234.7994cee0.js"><link rel="prefetch" href="/assets/js/235.3934d057.js"><link rel="prefetch" href="/assets/js/236.59cb6eac.js"><link rel="prefetch" href="/assets/js/237.baa1c655.js"><link rel="prefetch" href="/assets/js/238.8ee9f8ae.js"><link rel="prefetch" href="/assets/js/239.b0fe3966.js"><link rel="prefetch" href="/assets/js/24.afe2a3c4.js"><link rel="prefetch" href="/assets/js/240.d06483fa.js"><link rel="prefetch" href="/assets/js/241.81a2223e.js"><link rel="prefetch" href="/assets/js/242.8f6eee74.js"><link rel="prefetch" href="/assets/js/243.874461fa.js"><link rel="prefetch" href="/assets/js/244.ec0bb622.js"><link rel="prefetch" href="/assets/js/245.2ecf61f8.js"><link rel="prefetch" href="/assets/js/246.e7f6e55c.js"><link rel="prefetch" href="/assets/js/247.f32a1a4b.js"><link rel="prefetch" href="/assets/js/248.4302c4d8.js"><link rel="prefetch" href="/assets/js/249.9b0a4d9f.js"><link rel="prefetch" href="/assets/js/25.a22777b8.js"><link rel="prefetch" href="/assets/js/250.1295326c.js"><link rel="prefetch" href="/assets/js/251.d1cdb160.js"><link rel="prefetch" href="/assets/js/252.4e9d56fe.js"><link rel="prefetch" href="/assets/js/253.5a23b42d.js"><link rel="prefetch" href="/assets/js/254.8777547c.js"><link rel="prefetch" href="/assets/js/255.b8825033.js"><link rel="prefetch" href="/assets/js/256.0ee3689d.js"><link rel="prefetch" href="/assets/js/257.4a684795.js"><link rel="prefetch" href="/assets/js/258.ca696e72.js"><link rel="prefetch" href="/assets/js/259.fdf867d0.js"><link rel="prefetch" href="/assets/js/26.c84357e5.js"><link rel="prefetch" href="/assets/js/260.d35d60d5.js"><link rel="prefetch" href="/assets/js/261.c162cef5.js"><link rel="prefetch" href="/assets/js/262.8cbc5289.js"><link rel="prefetch" href="/assets/js/263.c05bbe4c.js"><link rel="prefetch" href="/assets/js/264.2e7c8f69.js"><link rel="prefetch" href="/assets/js/265.372a0632.js"><link rel="prefetch" href="/assets/js/266.49c38b9d.js"><link rel="prefetch" href="/assets/js/267.f7406d35.js"><link rel="prefetch" href="/assets/js/268.c7846c3e.js"><link rel="prefetch" href="/assets/js/269.e30bdc7f.js"><link rel="prefetch" href="/assets/js/27.0b3da7b9.js"><link rel="prefetch" href="/assets/js/270.8a3786ce.js"><link rel="prefetch" href="/assets/js/271.4b771c95.js"><link rel="prefetch" href="/assets/js/272.c710d2d6.js"><link rel="prefetch" href="/assets/js/273.43fb2872.js"><link rel="prefetch" href="/assets/js/274.d8a9dff2.js"><link rel="prefetch" href="/assets/js/275.c2812b68.js"><link rel="prefetch" href="/assets/js/276.406503c4.js"><link rel="prefetch" href="/assets/js/277.10c29e54.js"><link rel="prefetch" href="/assets/js/278.5f4b657a.js"><link rel="prefetch" href="/assets/js/279.84b86ae8.js"><link rel="prefetch" href="/assets/js/28.1c1fd5a6.js"><link rel="prefetch" href="/assets/js/280.8a2ba3b2.js"><link rel="prefetch" href="/assets/js/281.4a7f2b91.js"><link rel="prefetch" href="/assets/js/282.7b2f2668.js"><link rel="prefetch" href="/assets/js/283.455f93df.js"><link rel="prefetch" href="/assets/js/284.1a448478.js"><link rel="prefetch" href="/assets/js/285.19eebc05.js"><link rel="prefetch" href="/assets/js/286.5423cfc6.js"><link rel="prefetch" href="/assets/js/287.afbe115e.js"><link rel="prefetch" href="/assets/js/288.d4f4f247.js"><link rel="prefetch" href="/assets/js/289.da477465.js"><link rel="prefetch" href="/assets/js/29.103209e9.js"><link rel="prefetch" href="/assets/js/290.abf99800.js"><link rel="prefetch" href="/assets/js/291.71fe3ae6.js"><link rel="prefetch" href="/assets/js/292.455169ca.js"><link rel="prefetch" href="/assets/js/293.d23ffed4.js"><link rel="prefetch" href="/assets/js/294.1a753204.js"><link rel="prefetch" href="/assets/js/295.badfa110.js"><link rel="prefetch" href="/assets/js/296.344206a1.js"><link rel="prefetch" href="/assets/js/297.29e4f914.js"><link rel="prefetch" href="/assets/js/298.f9db8940.js"><link rel="prefetch" href="/assets/js/299.2253c1e7.js"><link rel="prefetch" href="/assets/js/3.e5ca1c51.js"><link rel="prefetch" href="/assets/js/30.e76a827e.js"><link rel="prefetch" href="/assets/js/300.e5bfd607.js"><link rel="prefetch" href="/assets/js/301.cc3e786e.js"><link rel="prefetch" href="/assets/js/302.7fdc62b6.js"><link rel="prefetch" href="/assets/js/303.b1db491f.js"><link rel="prefetch" href="/assets/js/304.18917b0f.js"><link rel="prefetch" href="/assets/js/305.d352aeb5.js"><link rel="prefetch" href="/assets/js/306.8bc72324.js"><link rel="prefetch" href="/assets/js/307.854b4037.js"><link rel="prefetch" href="/assets/js/308.6a0e4a18.js"><link rel="prefetch" href="/assets/js/309.d184df6f.js"><link rel="prefetch" href="/assets/js/31.7e4b200d.js"><link rel="prefetch" href="/assets/js/310.8e0af1ab.js"><link rel="prefetch" href="/assets/js/311.00bae85e.js"><link rel="prefetch" href="/assets/js/312.bc92cba9.js"><link rel="prefetch" href="/assets/js/313.8f70a987.js"><link rel="prefetch" href="/assets/js/314.8f190f1f.js"><link rel="prefetch" href="/assets/js/315.4b8506c7.js"><link rel="prefetch" href="/assets/js/316.5911c1f9.js"><link rel="prefetch" href="/assets/js/317.58cca547.js"><link rel="prefetch" href="/assets/js/318.4f23c053.js"><link rel="prefetch" href="/assets/js/319.941f5d3e.js"><link rel="prefetch" href="/assets/js/32.9c188bac.js"><link rel="prefetch" href="/assets/js/320.a3f15adc.js"><link rel="prefetch" href="/assets/js/321.14c74686.js"><link rel="prefetch" href="/assets/js/322.5f7b1b87.js"><link rel="prefetch" href="/assets/js/323.ab05eccb.js"><link rel="prefetch" href="/assets/js/324.292806ba.js"><link rel="prefetch" href="/assets/js/325.b96314dd.js"><link rel="prefetch" href="/assets/js/326.3d8f6329.js"><link rel="prefetch" href="/assets/js/327.49cf9268.js"><link rel="prefetch" href="/assets/js/328.be56ec05.js"><link rel="prefetch" href="/assets/js/329.8c390111.js"><link rel="prefetch" href="/assets/js/33.2435d797.js"><link rel="prefetch" href="/assets/js/330.b961e5fd.js"><link rel="prefetch" href="/assets/js/331.24ce8c0b.js"><link rel="prefetch" href="/assets/js/332.115b7546.js"><link rel="prefetch" href="/assets/js/333.957e0728.js"><link rel="prefetch" href="/assets/js/334.68825ff7.js"><link rel="prefetch" href="/assets/js/335.b662f33d.js"><link rel="prefetch" href="/assets/js/336.d8818747.js"><link rel="prefetch" href="/assets/js/337.9d24e096.js"><link rel="prefetch" href="/assets/js/338.3b669645.js"><link rel="prefetch" href="/assets/js/339.51cc2773.js"><link rel="prefetch" href="/assets/js/34.d57f3bb9.js"><link rel="prefetch" href="/assets/js/340.28cfadfb.js"><link rel="prefetch" href="/assets/js/341.4e6b0bdd.js"><link rel="prefetch" href="/assets/js/342.310c1a3e.js"><link rel="prefetch" href="/assets/js/343.0e61677a.js"><link rel="prefetch" href="/assets/js/344.340a39bd.js"><link rel="prefetch" href="/assets/js/345.fff51053.js"><link rel="prefetch" href="/assets/js/346.93c709db.js"><link rel="prefetch" href="/assets/js/347.dc863ac9.js"><link rel="prefetch" href="/assets/js/348.13c191d7.js"><link rel="prefetch" href="/assets/js/349.8aea43f7.js"><link rel="prefetch" href="/assets/js/35.e20cb4ac.js"><link rel="prefetch" href="/assets/js/350.49b72b87.js"><link rel="prefetch" href="/assets/js/351.3e6e6379.js"><link rel="prefetch" href="/assets/js/352.e2524a53.js"><link rel="prefetch" href="/assets/js/353.b71b2a33.js"><link rel="prefetch" href="/assets/js/354.a4720902.js"><link rel="prefetch" href="/assets/js/355.5a8970e1.js"><link rel="prefetch" href="/assets/js/356.353f0a9c.js"><link rel="prefetch" href="/assets/js/357.648060ca.js"><link rel="prefetch" href="/assets/js/358.643b787c.js"><link rel="prefetch" href="/assets/js/359.b1bc0c81.js"><link rel="prefetch" href="/assets/js/36.6a79f8ad.js"><link rel="prefetch" href="/assets/js/360.748faf07.js"><link rel="prefetch" href="/assets/js/361.cddfbfab.js"><link rel="prefetch" href="/assets/js/362.46990756.js"><link rel="prefetch" href="/assets/js/363.f4846a88.js"><link rel="prefetch" href="/assets/js/364.e7fd6af2.js"><link rel="prefetch" href="/assets/js/365.41693194.js"><link rel="prefetch" href="/assets/js/366.60931b9e.js"><link rel="prefetch" href="/assets/js/367.c7a310db.js"><link rel="prefetch" href="/assets/js/368.cae4028a.js"><link rel="prefetch" href="/assets/js/369.e3bcd2c2.js"><link rel="prefetch" href="/assets/js/37.4ccc31d6.js"><link rel="prefetch" href="/assets/js/370.2ea3b181.js"><link rel="prefetch" href="/assets/js/371.978056e5.js"><link rel="prefetch" href="/assets/js/372.aa13db83.js"><link rel="prefetch" href="/assets/js/373.f3791afe.js"><link rel="prefetch" href="/assets/js/374.b108af2d.js"><link rel="prefetch" href="/assets/js/375.dc75d5b1.js"><link rel="prefetch" href="/assets/js/376.8a663da6.js"><link rel="prefetch" href="/assets/js/38.9816dff1.js"><link rel="prefetch" href="/assets/js/39.03d551c0.js"><link rel="prefetch" href="/assets/js/4.611d42c4.js"><link rel="prefetch" href="/assets/js/40.ce442bf2.js"><link rel="prefetch" href="/assets/js/41.d596832c.js"><link rel="prefetch" href="/assets/js/42.29309c56.js"><link rel="prefetch" href="/assets/js/43.d47b7a06.js"><link rel="prefetch" href="/assets/js/44.87716237.js"><link rel="prefetch" href="/assets/js/45.d5ef3d2b.js"><link rel="prefetch" href="/assets/js/46.21cef7ff.js"><link rel="prefetch" href="/assets/js/47.75c67941.js"><link rel="prefetch" href="/assets/js/48.b94040d3.js"><link rel="prefetch" href="/assets/js/49.507fb28d.js"><link rel="prefetch" href="/assets/js/5.e6d623f8.js"><link rel="prefetch" href="/assets/js/50.4013f17e.js"><link rel="prefetch" href="/assets/js/51.6e81cba9.js"><link rel="prefetch" href="/assets/js/52.07e4aadf.js"><link rel="prefetch" href="/assets/js/53.1d325b49.js"><link rel="prefetch" href="/assets/js/54.79ff5e8c.js"><link rel="prefetch" href="/assets/js/55.77160bdd.js"><link rel="prefetch" href="/assets/js/56.a3041056.js"><link rel="prefetch" href="/assets/js/57.b7c0602c.js"><link rel="prefetch" href="/assets/js/58.a4af9a23.js"><link rel="prefetch" href="/assets/js/59.61a80d59.js"><link rel="prefetch" href="/assets/js/6.dc644b59.js"><link rel="prefetch" href="/assets/js/60.4ae1e1f0.js"><link rel="prefetch" href="/assets/js/61.b733273a.js"><link rel="prefetch" href="/assets/js/62.63b8d77d.js"><link rel="prefetch" href="/assets/js/63.46a84bd8.js"><link rel="prefetch" href="/assets/js/64.ce8c5891.js"><link rel="prefetch" href="/assets/js/65.8abe6836.js"><link rel="prefetch" href="/assets/js/66.6f9a9cf9.js"><link rel="prefetch" href="/assets/js/67.6bc415b9.js"><link rel="prefetch" href="/assets/js/68.b100ab24.js"><link rel="prefetch" href="/assets/js/69.5d9ed0d7.js"><link rel="prefetch" href="/assets/js/7.7da3e776.js"><link rel="prefetch" href="/assets/js/70.f213eb63.js"><link rel="prefetch" href="/assets/js/71.9dbed333.js"><link rel="prefetch" href="/assets/js/72.1129fb4b.js"><link rel="prefetch" href="/assets/js/73.7459f6b0.js"><link rel="prefetch" href="/assets/js/74.2364da14.js"><link rel="prefetch" href="/assets/js/75.72e5d347.js"><link rel="prefetch" href="/assets/js/76.7f1bc93d.js"><link rel="prefetch" href="/assets/js/77.7f9bb46a.js"><link rel="prefetch" href="/assets/js/78.16497536.js"><link rel="prefetch" href="/assets/js/79.1598ba88.js"><link rel="prefetch" href="/assets/js/8.91ce867e.js"><link rel="prefetch" href="/assets/js/80.d7595902.js"><link rel="prefetch" href="/assets/js/81.c808c887.js"><link rel="prefetch" href="/assets/js/82.49dc6011.js"><link rel="prefetch" href="/assets/js/83.6e151bae.js"><link rel="prefetch" href="/assets/js/84.9d3d5086.js"><link rel="prefetch" href="/assets/js/85.2c4d111e.js"><link rel="prefetch" href="/assets/js/86.cff98baa.js"><link rel="prefetch" href="/assets/js/87.655584a0.js"><link rel="prefetch" href="/assets/js/88.109ad4f1.js"><link rel="prefetch" href="/assets/js/89.46f7ed5c.js"><link rel="prefetch" href="/assets/js/9.8a2e5f54.js"><link rel="prefetch" href="/assets/js/90.1a91e9ca.js"><link rel="prefetch" href="/assets/js/91.26a98055.js"><link rel="prefetch" href="/assets/js/92.6ed9cb6e.js"><link rel="prefetch" href="/assets/js/93.14253412.js"><link rel="prefetch" href="/assets/js/94.54415bcf.js"><link rel="prefetch" href="/assets/js/95.0e1c9d0a.js"><link rel="prefetch" href="/assets/js/96.8654188f.js"><link rel="prefetch" href="/assets/js/97.d338a1d8.js"><link rel="prefetch" href="/assets/js/98.efa1e5c5.js"><link rel="prefetch" href="/assets/js/99.83fa6575.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76d9f797.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/magic.png" alt="Pangolin" class="logo"> <span class="site-name can-hide">Pangolin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpeg"> <div class="blogger-info"><h3>达尔文的猹</h3> <span>大道至简 悟在天成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ORM框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/4553db/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/d426ff/" class="sidebar-link">Spring集成MyBatis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/45687a/" class="sidebar-link">基础</a></li><li><a href="/pages/669da3/" class="sidebar-link">Java基础</a></li><li><a href="/pages/06424b/" class="sidebar-link">类与继承</a></li><li><a href="/pages/a29a57/" class="sidebar-link">抽象类与接口</a></li><li><a href="/pages/575ca7/" class="sidebar-link">内部类</a></li><li><a href="/pages/1d42f5/" class="sidebar-link">枚举类</a></li><li><a href="/pages/68df7d/" class="sidebar-link">常用类</a></li><li><a href="/pages/208d9a/" class="sidebar-link">关键字</a></li><li><a href="/pages/19431a/" class="sidebar-link">注解</a></li><li><a href="/pages/98c0c9/" class="sidebar-link">异常</a></li><li><a href="/pages/a08fb2/" class="sidebar-link">泛型</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>集合类</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e52b1c/" class="sidebar-link">集合类</a></li><li><a href="/pages/20a058/" class="sidebar-link">集合容器类概述</a></li><li><a href="/pages/71ab62/" class="sidebar-link">ArrayList与LinkedList</a></li><li><a href="/pages/dd747b/" class="sidebar-link">ArrayDeque</a></li><li><a href="/pages/f0ecf7/" class="sidebar-link">PriorityQueue</a></li><li><a href="/pages/a577c4/" class="sidebar-link">HashMap与HashSet</a></li><li><a href="/pages/b65f71/" class="sidebar-link">LinkedHashMap</a></li><li><a href="/pages/02deb8/" class="sidebar-link">TreeMap与TreeSet</a></li><li><a href="/pages/8b70b6/" class="sidebar-link">WeakHashMap</a></li><li><a href="/pages/098b2b/" class="sidebar-link">CopyOnWriteArrayList</a></li><li><a href="/pages/380128/" class="sidebar-link">ConcurrentHashMap</a></li><li><a href="/pages/b23642/" class="sidebar-link">BlockingQueue</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/5d5b55/" class="sidebar-link">并发</a></li><li><a href="/pages/ef591d/" class="sidebar-link">多线程基础</a></li><li><a href="/pages/870f46/" class="sidebar-link">JMM与Volatile</a></li><li><a href="/pages/70bfda/" class="sidebar-link">JUC与AQS</a></li><li><a href="/pages/60c2c3/" class="sidebar-link">锁与互斥同步</a></li><li><a href="/pages/6e4dfa/" class="sidebar-link">显式锁与ReetrantLock</a></li><li><a href="/pages/a0d56d/" class="sidebar-link">线程安全总结</a></li><li><a href="/pages/b92a49/" class="sidebar-link">JUC组件与线程协作</a></li><li><a href="/pages/103bb5/" class="sidebar-link">Atomic原子变量与Unsafe类与CAS</a></li><li><a href="/pages/065f55/" class="sidebar-link">线程池与定时任务</a></li><li><a href="/pages/dd3660/" class="sidebar-link">ThreadLocal</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>IO</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/7db050/" class="sidebar-link">IO</a></li><li><a href="/pages/ccb0a7/" class="sidebar-link">文件操作</a></li><li><a href="/pages/45bc73/" class="sidebar-link">IO流操作</a></li><li><a href="/pages/404e82/" class="sidebar-link">网络IO操作</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Java高级特性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/396bd1/" class="sidebar-link">Java高级特性</a></li><li><a href="/pages/eaa98b/" class="sidebar-link">Lambda表达式</a></li><li><a href="/pages/40af88/" class="sidebar-link">流Stream</a></li><li><a href="/pages/402b10/" class="sidebar-link">反射</a></li><li><a href="/pages/a5ebcd/" class="sidebar-link">代理</a></li><li><a href="/pages/b48bfe/" class="sidebar-link">Java性能问题定位分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/20204f/" class="sidebar-link">其他</a></li><li><a href="/pages/e4cde0/" class="sidebar-link">杂记</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>规范&amp;amp;风格</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ee7259/" class="sidebar-link">规范&amp;amp;风格</a></li><li><a href="/pages/139e3f/" class="sidebar-link">代码整洁之道</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ed8d11/" class="sidebar-link">Web基础</a></li><li><a href="/pages/a228d7/" class="sidebar-link">Spring(Boot)基础</a></li><li><a href="/pages/ecd8b6/" class="sidebar-link">Spring Boot应用整合</a></li><li><a href="/pages/76dc08/" class="sidebar-link">Spring MVC</a></li><li><a href="/pages/b9aa73/" class="sidebar-link">Spring AOP</a></li><li><a href="/pages/dc74be/" class="sidebar-link">Spring事务</a></li><li><a href="/pages/b43c8c/" class="sidebar-link">Spring IOC源码分析-概览</a></li><li><a href="/pages/d9b4a5/" class="sidebar-link">Spring IOC源码分析-getBean()</a></li><li><a href="/pages/59dd3e/" class="sidebar-link">Spring IOC源码分析-createBean()</a></li><li><a href="/pages/691b21/" class="sidebar-link">Spring AOP源码分析</a></li><li><a href="/pages/d31e18/" class="sidebar-link">Spring事务源码分析</a></li><li><a href="/pages/f16cdb/" class="sidebar-link">Spring Boot源码分析</a></li><li><a href="/pages/b13a90/" class="sidebar-link">Spring MVC源码分析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/943c23/" class="sidebar-link">JVM内存区域与对象解析</a></li><li><a href="/pages/05acae/" class="sidebar-link">内存分配与垃圾收集</a></li><li><a href="/pages/d09a16/" class="sidebar-link">JVM监控与故障处理工具</a></li><li><a href="/pages/06e4ad/" class="sidebar-link">类文件结构与类加载机制</a></li><li><a href="/pages/3d00d5/" class="sidebar-link">虚拟机方法调用与指令执行引擎</a></li><li><a href="/pages/eba070/" class="sidebar-link">程序编译与代码优化</a></li><li><a href="/pages/83896f/" class="sidebar-link">虚拟机调优及参数总结</a></li><li><a href="/pages/8a0034/" class="sidebar-link">GraalVM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f6cd57/" class="sidebar-link">数据库系统原理</a></li><li><a href="/pages/410bf5/" class="sidebar-link">MySQL必知必会</a></li><li><a href="/pages/495264/" class="sidebar-link">MySQL开发与优化</a></li><li><a href="/pages/ec7e76/" aria-current="page" class="active sidebar-link">MySQL架构与日志</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/4dbe1f/" class="sidebar-link">MySQL索引</a></li><li><a href="/pages/cbc7ab/" class="sidebar-link">MySQL优化</a></li><li><a href="/pages/4afd3a/" class="sidebar-link">MySQL锁机制与事务并发控制</a></li><li><a href="/pages/412461/" class="sidebar-link">MySQL高级特性</a></li><li><a href="/pages/41888c/" class="sidebar-link">MySQL设计规范</a></li><li><a href="/pages/087de5/" class="sidebar-link">MySQL架构篇</a></li><li><a href="/pages/b0952c/" class="sidebar-link">MySQL复制</a></li><li><a href="/pages/ee884d/" class="sidebar-link">MySQL高可用</a></li><li><a href="/pages/6d4f47/" class="sidebar-link">MySQL运维篇</a></li><li><a href="/pages/b8bad7/" class="sidebar-link">MySQL常用工具</a></li><li><a href="/pages/8bd691/" class="sidebar-link">MySQL日志</a></li><li><a href="/pages/5db7ef/" class="sidebar-link">MySQL备份与恢复</a></li><li><a href="/pages/3e3d3a/" class="sidebar-link">MySQL权限与安全</a></li><li><a href="/pages/5f2a5c/" class="sidebar-link">MySQL监控</a></li><li><a href="/pages/bf28eb/" class="sidebar-link">数据库LeetCode题目</a></li><li><a href="/pages/d4f878/" class="sidebar-link">数据库面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2bed26/" class="sidebar-link">Arthas</a></li><li><a href="/pages/84ff17/" class="sidebar-link">CICD</a></li><li><a href="/pages/a7e6ff/" class="sidebar-link">Maven</a></li><li><a href="/pages/2a3f45/" class="sidebar-link">Typora主题</a></li><li><a href="/pages/f28f56/" class="sidebar-link">VuePress</a></li><li><a href="/pages/9d673a/" class="sidebar-link">思源笔记</a></li><li><a href="/pages/538b8a/" class="sidebar-link">环境搭建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ORM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c83270/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/29ba44/" class="sidebar-link">Spring集成MyBatis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e55b6f/" class="sidebar-link">测试基础</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/develop/#开发" data-v-06225672>开发</a></li><li data-v-06225672><a href="/develop/#数据库" data-v-06225672>数据库</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/nanodaemony" target="_blank" title="作者" class="beLink" data-v-06225672>NanoDaemony</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-06-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->MySQL架构与日志<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_301-mysql架构与日志"><a href="#_301-mysql架构与日志" class="header-anchor">#</a> 301.MySQL架构与日志</h1> <h4 id="mysql架构"><a href="#mysql架构" class="header-anchor">#</a> MySQL架构</h4> <p>下图是 MySQL 的简要架构图. 整体主要分为 <strong>Server 层和存储引擎层</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210904145152067.png" alt=""></p> <h5 id="_1-server层"><a href="#_1-server层" class="header-anchor">#</a> 1.Server层</h5> <p><strong>Server 层</strong>主要包括连接器, 查询缓存, 分析器, 优化器, 执行器等, 所有<strong>跨存储引擎</strong>的功能都在这一层实现, 比如存储过程, 触发器, 视图, 内置函数等, 还有一个通用的日志模块 binlog 日志模块.</p> <p>总结一下: <strong>连接器用于身份权限校验; 分析器分析 SQL 语句要做什么; 优化器分析采用何种方案去执行语句; 执行器去执行语句</strong>.</p> <h6 id="_1-连接器"><a href="#_1-连接器" class="header-anchor">#</a> (1)连接器</h6> <p><strong>连接器用于身份认证和权限校验</strong>.</p> <p>客户端要向 MySQL 发起通信都必须先跟 Server 端建立通信连接, 而建立连接的工作就是连接器完成的.</p> <p>连接器负责跟客户端建立连接, 获取权限, 维持和管理连接. 连接后如果用户名密码<strong>认证</strong>通过, 连接器会到权限表里面查出账户拥有的<strong>权限</strong>. 后面这个连接里面的权限判断逻辑都将依赖于此时读到的权限. 这意味着一个用户成功建立连接后, 即使用管理员账号对这个用户的权限做了修改, 也不会影响已经存在连接的权限. 修改完成后, 只有再新建连接才会使用新的权限设置.</p> <p>每个客户端连接都会在服务器进程中拥有一个<strong>线程</strong>, 这个连接的查询只会在这个<strong>单独的线程</strong>中执行, 该线程只能轮流在某个 CPU 中运行.</p> <p>客户端如果太长时间没动静, 连接器会自动断开连接. 这由参数 <strong>wait_timeout</strong> 控制, 默认为 8 小时. 建立连接的过程通常比较复杂, 所以建议尽量减少建立连接的动作, 尽量使用长连接.</p> <h6 id="_2-查询缓存"><a href="#_2-查询缓存" class="header-anchor">#</a> (2)查询缓存</h6> <p>执行查询语句的时候, 会先查询缓存.</p> <p>之前执行过的语句及其结果可能会以 <strong>key-value</strong> 的形式被直接缓存在内存中. key 是查询的<strong>语句</strong>, value 是查询的结果. 如果当前查询能够直接在这个缓存中找到 key, 那么这个 value 就会被直接返回给客户端.</p> <p>但<strong>查询缓存的失效非常频繁</strong>, 只要有对一个表的更新, 这个表上<strong>所有的查询缓存</strong>都会被清空.</p> <p>MySQL 8.0 版本已经<strong>删除</strong>了查询缓存模块.</p> <h6 id="_3-分析器"><a href="#_3-分析器" class="header-anchor">#</a> (3)分析器</h6> <p><strong>分析器会分析 SQL 语句的语法并判断其要做什么</strong>.</p> <p>分析器会对 SQL 进行 &quot;<strong>词法分析</strong>&quot; 和 &quot;<strong>语法分析</strong>&quot;. 词法分析就是识别出 SQL 字符串的含义; 针对词法分析的结果, 词法分析器会根据语法规则判断输入的 SQL 语句语法是否合法. 如果输入的语句不对, 就会抛出 &quot;You have an error in your SQL syntax...&quot; 错误.</p> <p>MySQL 会解析查询, 并创建内部数据结构(解析树), 然后对其进行各种优化, 包括重写查询, 决定表的读取顺序, 以及选择合适的索引等. SQL 语句经过分析器分析之后, 会生成一颗语法树, 如下图所示.</p> <p>​<img src="assets/image-20230315221642-cahwx26.png" alt="image"></p> <h6 id="​​​-4-优化器"><a href="#​​​-4-优化器" class="header-anchor">#</a> ​​​(4)优化器</h6> <p><strong>优化器根据实际情况去判断并选择最优的方案去执行语句</strong>.</p> <p>这里最优只是<strong>优化器觉得最优</strong>的方案, 实际执行时不一定是最优的. 优化器可以在表里面有多个索引的时候, 决定使用哪个索引; 或者在一个语句有多表关联(JOIN) 的时候, 决定各个表的连接顺序. 比如:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t1 <span class="token keyword">JOIN</span> t2 <span class="token keyword">USING</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">AND</span> t2<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>可以先从表 t1 里面取出 c = 10 的记录的 ID 值, 再根据 ID 值关联表 t2, 再判断 t2 里面 d 的值是否等于 20.</li> <li>可以先从表 t2 里面取出 d = 20 的记录的 ID 值, 再根据 ID 值关联表 t1, 再判断 t1 里面 c 的值是否等于 10.</li></ul> <p>这两种执行方法的逻辑结果是一样的, 但是执行的效率会有不同, 而优化器的作用就是决定选择使用哪种方案.</p> <p>用户可以通过特殊的关键字提示(hint)优化器, 影响它的决策过程. 也可以请求优化器解释(explain)优化过程的各个因素, 使用户可以知道服务器是如何进行优化决策的, 并提供一个参考基准, 便于用户重构查询和 schema, 修改相关配置, 使应用尽可能高效运行.</p> <h6 id="_5-执行器"><a href="#_5-执行器" class="header-anchor">#</a> (5)执行器</h6> <p><strong>执行器执行语句并从存储引擎返回数据</strong>.</p> <p>前面通过分析器知道 SQL 要做什么, 通过优化器知道了该怎么做, 于是就进入了执行器阶段, 开始执行语句.</p> <p>开始执行的时候, 要先判断一下用户对数据表有没有执行查询权限, 如果有权限则打开表继续执行. 打开表的时候, 执行器就会根据表的引擎定义, 去使用这个引擎提供的接口.</p> <p>比如查询:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> T <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里 ID 字段没有索引, 执行器的执行流程如下:</p> <ol><li>调用 InnoDB 引擎接口取这个表的第一行, 判断 ID 值是不是 10, 如果不是则跳过, 如果是则将这行存在结果集中;</li> <li>调用引擎接口取 &quot;下一行&quot;, 重复相同的判断逻辑, 直到取到这个表的最后一行.</li> <li>执行器将上述遍历过程中所有满足条件的行组成的记录集作为<strong>结果集</strong>返回给客户端.</li></ol> <p>数据库的慢查询日志中可以看到一个 <strong>rows_examined</strong> 的字段, 表示这个语句<strong>执行</strong>过程中<strong>扫描了多少行</strong>. 这个值就是在执行器每次调用引擎获取数据行的时候累加的. 有些场景下, 执行器调用一次, 在引擎内部则扫描了多行, 因此<strong>引擎扫描行数跟 rows_examined 并不是完全相同的</strong>.</p> <h5 id="_2-存储引擎层"><a href="#_2-存储引擎层" class="header-anchor">#</a> 2.存储引擎层</h5> <p><strong>存储引擎层</strong>主要负责<strong>数据的存储和读取</strong>, 采用可以替换的插件式架构, 支持 InnoDB, MyISAM, Memory 等多种存储引擎. <strong>InnoDB</strong> 是默认的存储引擎.</p> <h4 id="mysql存储引擎"><a href="#mysql存储引擎" class="header-anchor">#</a> MySQL存储引擎</h4> <h5 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1.概述</h5> <p><strong>存储引擎就是数据库用于数据存储, 更新, 查询等操作的不同实现方式</strong>. MySQL 采用不同方式将数据存储在文件或内存中, 这些技术使用不同的<strong>存储机制, 索引技巧, 锁定水平</strong>以提供不同的功能和能力.</p> <p>查看 MySQL 提供的所有存储引擎.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> ENGINES<span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%storage_engine%'</span><span class="token punctuation">;</span> <span class="token comment"># 查看默认引擎</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>结果如下图所示:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210904140759531.png" alt="image-20210904140759531"></p> <p>MySQL5.5 之前默认存储引擎是 <strong>MyISAM</strong>, MySQL5.5 之后默认存储引擎是 <strong>InnoDB</strong>, 在 5.7 版本中<strong>只有 InnoDB 是事务</strong>型存储引擎.</p> <p>不同存储引擎有不同的功能特点及<strong>适用场景</strong>, 不同需求可以选择不同的存储引擎.</p> <h5 id="_2-myisam"><a href="#_2-myisam" class="header-anchor">#</a> 2.MyISAM</h5> <p>MyISAM 是 MySQL5.5 版本之前的默认存储引擎, <strong>不支持事务</strong>.</p> <p>MyISAM 存储引擎下的表由 <strong>.myd(数据)和 .myi(索引文件)组成, .frm 文件存储表结构</strong>.</p> <p><strong>不支持行级锁, 只能对整张表加锁</strong>, 读取时会对需要读到的<strong>所有表加共享锁</strong>, 写入时则对表加<strong>排它锁</strong>. 但在表有读取操作的同时, 也可以往表中插入新的记录, 这被称为<strong>并发插入</strong>(CONCURRENT INSERT).</p> <p>如果指定了 <strong>DELAY_KEY_WRITE</strong> 选项, 在每次<strong>修改</strong>执行完成时, <strong>不会立即</strong>将修改的索引数据写入磁盘, 而是会写到内存中的<strong>键缓冲区</strong>, 只有在清理键缓冲区或者关闭表的时候才会将对应的索引块写入磁盘. 这种方式可以极大的提升写入性能, 但是在数据库或者主机崩溃时会<strong>造成索引损坏</strong>, 需要执行<strong>修复操作</strong>. 可以手工或者自动执行检查和修复操作, 但是和事务恢复以及崩溃恢复不同, 可能导致一些<strong>数据丢失</strong>, 而且修复操作是非常慢的.</p> <p><strong>应用场景</strong>: 如果设计简单, 数据以<strong>紧密格式</strong>存储. 对于<strong>只读数据</strong>, 或者<strong>表比较小</strong>, 可以<strong>容忍修复操作</strong>, 则依然可以使用它.</p> <h5 id="_3-innodb"><a href="#_3-innodb" class="header-anchor">#</a> 3.InnoDB</h5> <p>InnoDB 是 MySQL5.5 及之后版本的<strong>默认存储引擎</strong>, 是<strong>事务型</strong>存储引擎.</p> <p><strong>事务</strong>: InnoDB 采用 MVCC 来支持高并发, 并且实现了四个标准的隔离级别. 其默认级别是<strong>可重复读</strong>, 并且通过<strong>间隙锁</strong>(next-key locking)策略防止幻读的出现. 间隙锁使得 InnoDB 不仅仅锁定查询涉及的行, 还会对索引中的间隙进行锁定, 以防止幻影行的插入.</p> <p><strong>索引</strong>: 主索引是<strong>聚簇索引</strong>, 在索引中保存了数据, 从而避免直接读取磁盘, 因此对查询性能有很大的提升.</p> <p>它内部做了很多优化, 包括从磁盘读取数据时采用的可预测性读, 能够加快读操作并且自动创建的自适应哈希索引, 能够加速插入操作的插入缓冲区等.</p> <p><strong>应用场景</strong>: 可靠性要求较高或要求事务. 只有在需要它<strong>不支持</strong>的特性时, 才考虑使用其它存储引擎. <strong>能用就用</strong>.</p> <blockquote><p>MyISAM与InnoDB对比</p></blockquote> <ul><li><strong>事务</strong>: InnoDB 支持<strong>事务</strong>, 可以使用 <strong>Commit 和 Rollback</strong> 语句; MyISAM 不支持事务.</li> <li><strong>锁的粒度</strong>: MyISAM 只支持表锁, InnoDB 支持<strong>表锁与行锁</strong>. InnoDB 在应对高并发事务上使用 MVCC 比单纯的加锁更高效.</li> <li><strong>外键</strong>: InnoDB 支持<strong>外键</strong>; MyISAM 不支持外键而.</li> <li><strong>备份</strong>: InnoDB 支持<strong>在线热备份</strong>.</li> <li><strong>崩溃恢复</strong>: MyISAM <strong>崩溃</strong>后发生损坏的概率比 InnoDB 高很多, 且恢复的速度也更慢; InnoDB 崩溃之后恢复更加容易.</li> <li><strong>其它特性</strong>: MyISAM 支持压缩表和空间数据索引.</li></ul> <p>《MySQL 高性能》: 不要轻易相信 &quot;MyISAM 比 InnoDB 快&quot; 之类的经验之谈, 这个结论往往不是绝对的. 在很多已知场景中, InnoDB 的速度都能让 MyISAM 望尘莫及, 尤其是用到了聚簇索引, 或者需要访问的数据都可以放入内存的应用. 所以<strong>一般情况下选择 InnoDB 都是没有问题</strong>的. 如果并不在乎可扩展能力和并发能力, 也不需要事务支持以及崩溃后的安全恢复问题, 也可以选择 MyISAM.</p> <blockquote><p>如何选择存储引擎?</p></blockquote> <p><strong>根据具体的应用场景选择: ​</strong>​<strong><strong>综合考虑是否需要事务, 是否可以热备份, 崩溃恢复, 存储引擎的特有特性等. 注意不要混合使用存储引擎. 一般</strong></strong>​<strong>使用 InnoDB</strong> 就行了.</p> <h5 id="_4-其他存储引擎"><a href="#_4-其他存储引擎" class="header-anchor">#</a> 4.其他存储引擎</h5> <h6 id="_1-csv"><a href="#_1-csv" class="header-anchor">#</a> (1)CSV</h6> <p><strong>特性</strong>: 以 <strong>CSV 格式</strong>进行数据存储, 所有列都不能为 NULL, 不支持索引, 可以对<strong>数据文件直接编辑</strong>(其他引擎是二进制存储, 不可编辑).</p> <p><strong>对应文件系统存储特点</strong>: 数据以文本方式存储在文件中, <strong>.csv</strong> 文件存储表内容, <strong>.csm</strong> 文件存储表的元数据, 如表状态和数据量, <strong>.frm</strong> 存储表的结构.</p> <p><strong>引用场景</strong>: 作为数据交换的<strong>中间表</strong>.</p> <h6 id="_2-archive"><a href="#_2-archive" class="header-anchor">#</a> (2)Archive</h6> <p><strong>特性</strong>: 对表数据进行压缩, 磁盘 I/O 更少, 数据存储在 ARZ 为后缀的文件中(表文件为 <strong>a.arz, a.frm</strong>), 只支持 INSERT 和 SELECT 操作(不可以 DELETE 和 UPDATE), 只允许在自增 ID 列上加索引.</p> <p><strong>应用场景</strong>: 日志和数据采集类应用.</p> <h6 id="_3-memory"><a href="#_3-memory" class="header-anchor">#</a> (3)Memory</h6> <p><strong>特性</strong>: 数据保存在内存中, 所以数据库重启后会导致数据丢失. 支持 HASH 索引(等值查找应选择 HASH)和 BTree 索引(范围查找应选择), 所有字段都为固定长度, Memory 存储使用表级锁.</p> <p><strong>应用场景</strong>: 用于查找或是映射表, 例如用于保存数据分析中产生的中间表, 用于缓存周期性聚合数据的结果表等. Memory 数据易丢失, 所以要求数据可再生.</p> <h4 id="sql语句执行流程"><a href="#sql语句执行流程" class="header-anchor">#</a> SQL语句执行流程</h4> <p>SQL 语句一般可以分为<strong>查询</strong>与<strong>更新</strong>(增加, 更新, 删除)两类. 整体流程如下:</p> <ul><li>客户端发送一条查询给服务器.</li> <li>服务器先检查查询缓存, 如果命中了缓存, 则立刻返回存储在缓存中的结果. 否则进入下一阶段.</li> <li>服务器端进行 SQL 解析, 预处理, 再由<strong>优化器</strong>生成对应的执行计划.</li> <li>MySQL 根据优化器生成的执行计划, 调用存储引擎的 API 来执行查询.</li> <li>将结果返回给客户端.</li></ul> <h5 id="_1-客户端与服务端通信协议"><a href="#_1-客户端与服务端通信协议" class="header-anchor">#</a> 1.客户端与服务端通信协议</h5> <p>MySQL 客户端和服务器之间的通信协议是&quot;半双工&quot;的, 这意味着在任何一个时刻, 要么是由服务器向客户端发送数据, 要么是由客户端向服务器发送数据, 这两个动作不能同时发生. 所以无法也无须将一个消息切成小块独立来发送. 这种协议让 MySQL 通信简单快速, 但是也从很多地方限制了 MySQL. 一个明显的限制是, 这意味着没法进行流量控制. 一旦一端开始发生消息, 另一端要接收完整个消息才能响应它. 客户端用一个单独的数据包将查询传给服务器. 这也是为什么当查询的语句很长的时候, 参数 max_allowed_packet 就特别重要了. 一旦客户端发送了请求, 它能做的事情就只是等待结果了. 一般服务器响应给用户的数据通常很多, 由多个数据包组成. 当服务器开始响应客户端请求时, 客户端必须完整地接收整个返回结果, 而不能简单地只取前面几条结果, 然后让服务器停止发送数据.</p> <h5 id="_2-查询语句流程"><a href="#_2-查询语句流程" class="header-anchor">#</a> 2.查询语句流程</h5> <p>先分析下查询语句, 语句如下:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tb_student A <span class="token keyword">WHERE</span> A<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token string">'18'</span> <span class="token operator">AND</span> A<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Jack'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参考 MySQL 架构分析下这个语句的执行流程如下.</p> <h6 id="_1-查询权限"><a href="#_1-查询权限" class="header-anchor">#</a> (1) 查询权限</h6> <p>先检查该语句是<strong>否有权限</strong>, 如果没有则直接返回错误信息.</p> <h6 id="_2-查询缓存-2"><a href="#_2-查询缓存-2" class="header-anchor">#</a> (2) 查询缓存</h6> <p>如果有权限则计算这条 SQL 语句的 Hash 并以之为 key 在内存中查询是否缓存有结果, 当查询命中该缓存, MySQL会立刻返回结果, 跳过了解析, 优化和执行阶段, 如果没有, 执行下一步.</p> <p>注意: MySQL8.0 之后已经<strong>去掉</strong>了查询缓存机制.</p> <p>为什么删除查询缓存?</p> <ul><li>查询缓存系统会跟踪查询中涉及的每个表, 如果这些表发生变化, 那么和这个表相关的所有的缓存数据<strong>都将失效</strong>.</li> <li>缓存碎片, 内存不足都会造成缓存失效. 如果表中任何数据或是结构发生改变, 包括INSERT, UPDATE, DELETE, TRUNCATE, ALTER TABLE, DROP TABLE或DROP DATABASE等, 那么使用这个表的所有缓存查询将不再有效, 查询缓存中值相关条目被清空. 缓存失效会带来额外的开销.</li> <li>缓存全部在内存中, 容易造成内存资源紧张. 且 SQL 语句有任何不同, 都会因为 Hash 不同而认为是不同的查询, 从而进行缓存.</li></ul> <p>对于频繁更新的表, 查询缓存并不好.</p> <h6 id="_3-词法分析与语法检查"><a href="#_3-词法分析与语法检查" class="header-anchor">#</a> (3) 词法分析与语法检查</h6> <p>MySQL 通过关键字将 SQL 语句进行解析, 并生成一棵对应的 &quot;解析树&quot;. MySQL 解析器将使用 MySQL 语法规则验证和解析查询. 例如, 它将验证是否使用错误的关键字, 或者使用关键字的顺序是否正确等, 再或者它还会验证引号是否能前后正确匹配.</p> <p>通过分析器进行词法分析并分析是否有语法错误, 提取 SQL 语句的<strong>关键元素</strong>, 并生成一棵对应的 &quot;解析树&quot;. 比如提取上面这个语句是查询 SELECT, 提取需要查询的表名为 tb_student, 需要查询所有的列, 查询条件是这个表的 id = '1'.</p> <p>MySQL 解析器将使用 MySQL 语法规则验证和解析查询. 例如, 它将验证是否使用错误的关键字, 或者使用关键字的顺序是否正确等, 再或者它还会验证引号是否能前后正确匹配.</p> <p>预处理器则根据一些MySQL规则进一步检查解析树是否合法, 例如, 这里将检查数据表和数据列是否存在, 还会解析名字和别名, 看看它们是否有歧义.</p> <h6 id="_4-优化器确定执行方案"><a href="#_4-优化器确定执行方案" class="header-anchor">#</a> (4) 优化器确定执行方案</h6> <p><strong>生成执行计划</strong></p> <p>现在语法树被认为是合法的了, 并且由优化器将其转化成<strong>执行计划</strong>.</p> <p>和很多其他关系数据库不同, MySQL 并不会生成查询字节码来执行查询. MySQL生成查询的一棵指令树, 然后通过存储引擎执行完成这棵指令树并返回结果. 最终的执行计划包含了重构查询的全部信息.</p> <p><strong>基于成本的执行计划选择策略</strong></p> <p>一条查询可以有很<strong>多种</strong>执行计划, 最后都返回相同的结果. 优化器的作用就是找到这其中最好的执行计划.</p> <p>MySQL 使用<strong>基于成本的优化器</strong>, 它将尝试预测一个查询使用某种执行计划时的成本, 并选择其中成本最小的一个.</p> <p>最初, 成本的最小单位是随机读取一个4K数据页的成本, 后来成本计算公式变得更加复杂, 并且引入了一些“因子”来估算某些操作的代价, 如通过各种<strong>统计信息</strong>来计算: 每个表或者索引的页面个数, 索引的基数(索引中不同值的数量), 索引和数据行的长度, 索引分布情况. 这些统计信息是通过存储引擎获取的.</p> <p>上述 SQL 语句可以有两种执行方案: (1) 先查询学生表中姓名为 &quot;Jack&quot; 的学生, 然后判断是否年龄是 18. (2) 先找出学生中年龄 18 岁的学生, 然后再查询姓名为 &quot;Jack&quot; 的学生. 优化器会根据<strong>自己的优化算法</strong>进行选择执行效率最好的一个方案(优化器的决定有时候不一定最好). 确定执行计划后就准备开始执行.</p> <p><strong>优化策略</strong></p> <p>MySQL 的查询优化器是一个非常复杂的部件, 它使用了很多优化策略来生成一个最优的执行计划. 优化策略可以简单地分为两种, 一种是静态优化, 一种是动态优化. 静态优化可以直接对解析树进行分析, 并完成优化. 例如, 优化器可以通过一些简单的代数变换将WHERE条件转换成另一种等价形式. 静态优化不依赖于特别的数值, 如 WHERE 条件中带入的一些常数等. 静态优化在第一次完成后就一直有效, 即使使用不同的参数重复执行查询也不会发生变化. 可以认为这是一种“编译时优化”. 相反, 动态优化则和查询的上下文有关, 也可能和很多其他因素有关, 例如 WHERE 条件中的取值, 索引中条目对应的数据行数等. 这需要在每次查询的时候都重新评估, 可以认为这是“运行时优化”. 在执行语句和存储过程的时候, 动态优化和静态优化的区别非常重要. MySQL 对查询的静态优化只需要做一次, 但对查询的动态优化则在每次执行时都需要重新评估. 有时候甚至在查询的执行过程中也会重新优化.</p> <p>下面是一些 MySQL 能够处理的优化类型:</p> <ul><li>重新定义关联表的顺序.</li> <li>将外连接转化成内连接.</li> <li>使用等价变换规则. 比如比较符号的变换.</li> <li>覆盖索引扫描.</li> <li>提前终止查询.</li></ul> <p><strong>数据与索引的统计信息</strong></p> <p>MySQL 通过统计信息来计算执行计划的成本进而选择合适的执行计划. 统计信息由存储引擎实现, 不同的存储引擎可能会存储不同的统计信息(也可以按照不同的格式存储统计信息).</p> <p>因为服务器层没有任何统计信息, 所以 MySQL 查询优化器在生成查询的执行计划时, 需要向存储引擎获取相应的统计信息. 存储引擎则提供给优化器对应的统计信息, 包括: 每个表或者索引有多少个页面, 每个表的每个索引的基数是多少, 数据行和索引长度, 索引的分布信息等. 优化器根据这些信息来选择一个最优的执行计划.</p> <p><strong>优化器选择错误的原因</strong></p> <p>有很多种原因会导致MySQL优化器选择错误的执行计划, 如下所示:</p> <ul><li><strong>统计信息不准确</strong>. MySQL 依赖存储引擎提供的统计信息来评估成本, 但是有的存储引擎提供的信息是准确的, 有的偏差可能非常大. 例如, InnoDB因为其 MVCC 的架构, 并不能维护一个数据表的行数的精确统计信息.</li> <li>执行计划中的成本估算不等同于实际执行的成本. 所以即使统计信息精准, 优化器给出的执行计划也可能不是最优的. 例如有时候某个执行计划虽然需要读取更多的页面, 但是它的成本却更小. 因为如果这些页面都是顺序读或者这些页面都已经在内存中的话, 那么它的访问成本将很小. MySQL 层面并不知道哪些页面在内存中, 哪些在磁盘上, 所以查询实际执行过程中到底需要多少次物理I/O是无法得知的.</li> <li>MySQL 的最优可能和你想的最优不一样. 你可能希望执行时间尽可能的短, 但 MySQL 只是基于其成本模型选择最优的执行计划, 而有些时候这并不是最快的执行方式. 所以根据执行成本来选择执行计划并不是完美的模型.</li> <li>MySQL 从不考虑其他并发执行的查询, 这可能会影响到当前查询的速度.</li> <li>MySQL 也并不是任何时候都是基于成本的优化. 有时也会基于一些固定的规则, 例如, 如果存在全文搜索的 MATCH() 子句, 则在存在全文索引的时候就使用全文索引. 即使有时候使用别的索引和 WHERE 条件可以远比这种方式要快, MySQL 也仍然会使用对应的全文索引.</li> <li>MySQL 不会考虑不受其控制的操作的成本, 例如执行存储过程或者用户自定义函数的成本.</li></ul> <p><strong>查询优化器的提示(hint)</strong></p> <p>如果对优化器选择的执行计划不满意, 可以使用优化器提供的几个提示(hint)来控制最终的执行计划. 常见的提示如下.</p> <ul><li><strong>USE INDEX, IGNORE INDEX和FORCE INDEX</strong>. 这几个提示会告诉优化器使用或者不使用哪些索引来查询记录(例如, 在决定关联顺序的时候使用哪个索引). 在MySQL 5.0和更早的版本, 这些提示并不会影响到优化器选择哪个索引进行排序和分组, 在MyQL 5.1和之后的版本可以通过新增选项FOR ORDER BY和FOR GROUP BY来指定是否对排序和分组有效. FORCE INDEX和USE INDEX基本相同, 除了一点: FORCE INDEX会告诉优化器全表扫描的成本会远远高于索引扫描, 哪怕实际上该索引用处不大. 当发现优化器选择了错误的索引, 或者因为某些原因(比如在不使用ORDER BY的时候希望结果有序)要使用另一个索引时, 可以使用该提示.</li> <li><strong>FOR UPDATE和LOCK IN SHARE MODE</strong>. 这也不是真正的优化器提示. 这两个提示主要控制SELECT语句的锁机制, 但只对实现了行级锁的存储引擎有效. 使用该提示会对符合查询条件的数据行加锁. 这两个提示经常被滥用, 很容易造成服务器的锁争用问题. 应<strong>避免使用</strong>这个.</li></ul> <h6 id="_5-执行查询并返回结果"><a href="#_5-执行查询并返回结果" class="header-anchor">#</a> (5) 执行查询并返回结果</h6> <p>在解析和优化阶段, MySQL将生成查询对应的执行计划, MySQL的查询执行引擎则根据这个执行计划来完成整个查询. 这里执行计划是一个数据结构, 而不是和很多其他的关系型数据库那样会生成对应的字节码.</p> <p>MySQL只是简单地根据执行计划给出的指令<strong>逐步执行</strong>. 在根据执行计划逐步执行的过程中, 有大量的操作需要通过调用存储引擎实现的接口来完成, 这些接口称为 &quot;handler API&quot; 接口.</p> <p>最后将查询结果返回给客户端.</p> <h5 id="_3-更新语句流程"><a href="#_3-更新语句流程" class="header-anchor">#</a> 3.更新语句流程</h5> <p>接下来看看更新语句如何执行, SQL 语句如下:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> tb_student A <span class="token keyword">SET</span> A<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token string">'19'</span> <span class="token keyword">WHERE</span> A<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Jack'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这条语句与之前查询的流程类似, 只不过执行<strong>更新需要进行日志记录</strong>. 这就引入了日志模块, MySQL 自带的<strong>日志模块</strong>是 <strong>binlog(归档日志)</strong>, 所有的存储引擎都可以使用, <strong>常用的 InnoDB 引擎</strong>还自带了一个日志模块 <strong>redo log(重做日志)</strong>.</p> <p>这里以 InnoDB 模式下来分析这个语句的执行流程, 流程如下:</p> <ul><li>先<strong>查询</strong>到 Jack 这条数据, 如果<strong>有缓存</strong>也会用缓存值.</li> <li>然后拿到查询语句, 把 age 改为 19, 然后调用引擎 API 接口, 写入这一行数据, InnoDB 引擎把<strong>数据保存在内存中</strong>, 同时<strong>记录 redo log</strong>, 此时 redo log <strong>进入 prepare 状态</strong>, 然后告诉执行器, 执行完成了随时可以<strong>提交</strong>.</li> <li>执行器<strong>收到通知后记录 binlog</strong>, 然后调用引擎接口, <strong>提交 redo log 并且状态改为提交状态</strong>, 更新完成.</li></ul> <blockquote><p>为什么要用两个日志模块, 用一个日志模块不行吗?</p></blockquote> <p>这是因为最开始 MySQL 默认存储引擎是 MyISAM, 但 <strong>redo log 是 InnoDB 引擎独有的</strong>, 这就导致会<strong>没有 crash-safe 的能力</strong>(即使数据库发生<strong>异常重启</strong>, 之前提交的记录都不会丢失), <strong>binlog 日志只能用来归档</strong>.</p> <p>并不是说只用一个日志模块不可以, <strong>只是 InnoDB 引擎就是通过 redo log 来支持事务</strong>. 那么用两个日志模块, 但是不要这么复杂行不行, 为什么 redo log 要引入 prepare 预提交状态? 这里用<strong>反证法</strong>来说明下为什么要这么做.</p> <ul><li><strong>先写 redo log 直接提交, 然后写 binlog</strong>. 假设写完 redo log 后机器挂了, binlog 日志没有被写入, 那么机器重启后, 这台机器会通过 redo log 恢复数据, 但是这个时候 binlog 并没有记录该数据, 后续进行机器备份的时候, 就会丢失这一条数据, 同时主从同步也会<strong>丢失</strong>这一条数据.</li> <li><strong>先写 binlog, 然后写 redo log</strong>. 假设写完了 binlog, 机器异常重启了, 由于没有 redo log, 本机是无法恢复这一条记录的, 但是 binlog 又有记录, 那么和上面同样的道理, 就会<strong>产生数据不一致</strong>的情况.</li></ul> <p>如果<strong>采用 redo log 两阶段提交</strong>的方式就不一样了, <strong>写完 binglog 后, 然后再提交 redo log</strong> 就会防止出现上述的问题, 从而保证了数据一致性.</p> <p>那么问题来了, 有没有一个极端的情况呢? 假设 redo log 处于预提交状态, binglog 也已经写完了, 这个时候发生了异常重启会怎么样呢?  这个就要依赖于 MySQL 的<strong>处理机制</strong>了, MySQL 的处理过程如下:</p> <ul><li><strong>判断 redo log 是否完整, 如果判断是完整的就立即提交.</strong></li> <li><strong>如果 redo log 只是预提交但不是 commit 状态, 这个时候就会去判断 binlog 是否完整, 如果完整就提交 redo log, 不完整就回滚事务</strong>.</li></ul> <p>这样就解决了<strong>数据一致性</strong>问题.</p> <h5 id="_4-数据更新模型"><a href="#_4-数据更新模型" class="header-anchor">#</a> 4.数据更新模型</h5> <p>数据更新的主要流程:</p> <p>![https://www.processon.com/diagraming/6416cf40ff015f63025f88c3](https://nano-note.oss-cn-beijing.aliyuncs.com/images/图灵-MySQL执行过程与InnoDB底层原理 (1).png)</p> <p>整体流程如下:</p> <p>1.当需要更新的数据不在 Buffer Pool 缓存池的时候, 会从磁盘中把整页数据都加载到缓存池内存中.</p> <p>2.将旧的数据值(name=Lucy)写入到 undo 回滚日志中, 便于后续回滚. 如果事务提交失败要回滚数据, 可以用 undo 日志里的数据恢复 buffer pool 里面的缓存数据.</p> <p>3.执行器更新内存数据, 即 name=Jack.</p> <p>4.更新信息写入到 redo log buffer 缓冲区中.</p> <p>5.redo 日志顺序写入磁盘, 准备提交事务(prepare阶段).</p> <p>6.准备提交事务, 将 binlog 日志写入磁盘.</p> <p>7.写入 commit 标记到 redo 日志文件里, <strong>此时事务提交完成</strong>. 该标记为了保证事务提交后 redo 与 binlog 数据一致. 到这里可以告知客户端事务已经提交完成. 这里 redo 日志文件记录了哪些位置的什么数据做了哪些修改, 由于 redo 日志具有<strong>顺序写</strong>的特点, 所以写入是很快的, 因此修改记录到 redo 日志中即可认为事务已经完成. 这比每次都直接去修改磁盘上的 ibd 文件要快. 因此后面有个线程去专门将修改写入到随机的 ibd 文件中.</p> <p>8.在系统空闲的时候将修改随机写入磁盘进行持久化, 以 page 为单位写入. 完成后实现磁盘中的数据更新. 如果事务提交成功, buffer pool 里的数据还没来得及写入磁盘的时候系统宕机了, 可以用 redo 日志的数据<strong>恢复磁盘 ibd 文件里面的数据</strong>. 也就是 buffer pool 里面的数据还没持久化到磁盘文件中, 但是 redo log 中记录了哪些数据做了哪些修改, 因此当系统恢复的时候, 可以先根据 redo log 对数据进行磁盘中的数据重做, 让其与 redo log 中的数据状态保持一致, 也就是实现数据的持久化. 这个过程其实就是 &quot;重做&quot;, 或者 &quot;重放&quot;, 也就是 redo 的含义.</p> <blockquote><p>WAL(Write-Ahead Loggin)机制</p></blockquote> <p>redo 日志文件顺序写: redo log 是一个或几个预先分配好磁盘空间的文件, 写入永远都是在文件末尾追加.</p> <p>ibd 数据文件随机读写: 不同的数据表有不一样的 ibd 文件, 比如执行 10 条SQL, 修改不同的表, 需要修改不同的 ibd 文件, 不能实现顺序写文件的效果.</p> <p>先写 redo log后刷新数据表文件的机制叫 WAL 机制(Write-Ahead Loggin), 效率更高.</p> <blockquote><p>binlog用处分析</p></blockquote> <p><strong>注意</strong>: binlog 是属于 <strong>Server 层</strong>的, 所有存储引擎都有. binlog 主要用来恢复数据库磁盘里的数据. 比如某次修改已经将数据的真实修改写入到了磁盘文件中, 但是有人误操作删除了磁盘文件的数据, 这时候就可以用 binlog 恢复原始的数据.</p> <blockquote><p>为什么会有 redo log 和 binlog 两份日志?</p></blockquote> <p>因为最开始 MySQL 里并没有 InnoDB 引擎. MySQL 自带的引擎是 MyISAM, 但是 MyISAM 没有 crash-safe 的能力, binlog 日志只能用于<strong>归档</strong>. 而 InnoDB 是另一个公司以插件形式引入 MySQL 的, 既然只依靠 binlog 是没有 crash-safe 能力的, 所以InnoDB 使用另外一套日志系统, 也就是 redo log 来实现 crash-safe 能力.</p> <p>有了 redo log, InnoDB 就可以保证即使数据库发生异常重启, 之前提交的记录都不会丢失, 这个能力称为 crash-safe.</p> <blockquote><p>为什么MySQL不能直接更新磁盘上的数据而设置这么一套复杂的机制来执行SQL?</p></blockquote> <p>因为如果来一个请求就直接对磁盘文件进行随机读写, 然后更新磁盘文件里的数据性能可能相当差. 磁盘随机读写的性能是非常差的, 所以直接更新磁盘文件是不能让数据库抗住很高并发的. MySQL 这套机制看起来复杂, 但它可以保证每个更新请求都是更新内存 Buffer Pool, 然后顺序写日志文件, 同时还能保证各种异常情况下的数据一致性. 更新内存的性能是极高的, 然后顺序写磁盘上的日志文件的性能也是非常高的, 要远高于随机读写磁盘文件. 正是通过这套机制, 才能让 MySQL 数据库在较高配置的机器上每秒可以抗下几干甚至上万的读写请求.</p> <h4 id="redo-log重做日志"><a href="#redo-log重做日志" class="header-anchor">#</a> redo log重做日志</h4> <h5 id="redo-log重做日志关键参数"><a href="#redo-log重做日志关键参数" class="header-anchor">#</a> redo log重做日志关键参数</h5> <ul><li><p>innodb_log_buffer_size: 设置 redo log buffer 大小, 默认 16M, 最大值是 4096M, 最小值为 1M.</p></li> <li><p>innodb_log_group_home_dir: 设置 <strong>redo log 文件存储位置</strong>, 默认值为&quot;./&quot;, 即 InnoDB 数据文件存储位置, 其中的 ib_logfile0 和 ib_logfile1 即为 redo log 文件.</p></li> <li><p>innodb_log_files_in_group: 设置 redo log 文件的个数, 命名方式如: ib_logfile0, iblogfile1... iblogfileN. 默认 2 个, 最大 100 个.</p></li> <li><p>innodb_log_file_size: 设置单个 redo log 文件大小, 默认值为 48 M. 最大值为 512G, 注意最大值指的是<strong>整个 redo log 系列文件之和</strong>, 即 (innodb_log_files_in_group * innodb_log_file_size) 不能大于最大值 512G.</p></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%innodb_log_buffer_size%'</span><span class="token punctuation">;</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%innodb_log_group_home_dir%'</span><span class="token punctuation">;</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%innodb_log_files_in_group%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="redo-log写入磁盘过程分析"><a href="#redo-log写入磁盘过程分析" class="header-anchor">#</a> redo log写入磁盘过程分析</h5> <p>在有多个 redo log 日志文件的情况下, redo log 会对某个文件从头开始写, 写完一个文件继续写另一个文件, 写到最后一个文件末尾就又回到第一个文件开头循环写, 如下面这个图所示.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/20230319185252.png" alt=""></p> <p>write pos 是当前记录的位置, 一边写一边后移, 写到第 3 号文件末尾后就回到 0 号文件开头.</p> <p>checkpoint 是当前要<strong>擦除</strong>的位置, 也是往后推移并且循环的, 擦除记录前要把记录更新到数据文件里.</p> <p>write pos 和 checkpoint 之间的部分就是空着的<strong>可写部分</strong>, 可以用来记录新的操作. 如果 write pos 追上 checkpoint, 表示 redo log 写满了, 这时候不能再执行新的更新, 得停下来先擦掉一些记录, 也就是把一部分数据持久化到 ibd 磁盘文件中, 把 checkpoint 推进一下.</p> <p><strong>innodb_flush_log_at_trx_commit</strong>: 这个参数控制 redo log 的<strong>写入策略</strong>, 也就是上面流程图中更新信息写入到 redo log buffer 缓冲区中之后, 将 redo log buffer 缓冲区中的修改写入到 redo log 的过程(步骤 5).</p> <p>它有三种可能取值:</p> <ul><li>设置为 0: 表示每次事务提交时都只是把 redo log <strong>留在 redo log buffer 中</strong>, 数据库宕机可能会<strong>丢失数据. ​</strong>对于上图就是没有步骤 5 了.</li> <li>设置为 1(默认值): 表示<strong>每次事务提交时都将 redo log 直接持久化到磁盘, 数据最安全, 不会因为数据库宕机丢失数据</strong>, 但是效率稍微差一点, 线上系统推荐这个设置.</li> <li>设置为 2: 表示每次事务提交时都只是把 redo log 写到操作系统的缓存 page cache 里而不会写到文件中, 这种情况如果<strong>数据库宕机(数据库进程挂掉)是不会丢失数据的(因为数据是缓存在操作系统的 page cache 内存里面的). ​</strong>但是操作系统如果宕机了, page cache 缓存里的数据还没来得及写入磁盘文件的话就会丢失数据.</li></ul> <p>就上面的几个值, 0 和 2 都是不会写入文件的, 而是暂存到内存缓冲区中(0 是 redo log buffer, 2 是操作系统的 page cache), 因此存在宕机丢失数据的风险.</p> <p>redo log 写入策略如下图所示, 几种策略对应了不同的 redo log 记录方式.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/202303191907182.png" alt=""></p> <p>InnoDB 有一个<strong>后台线程, 每隔 1 秒</strong>就会把 redo log buffer 中的日志, 调用操作系统函数 write 写到文件系统的 page cache, 然后调用操作系统函数 fsync 持久化到磁盘文件.</p> <p>这里 redo log buffer 是 MySQL 进程管理的内存区域, page cache 是操作系统管理的内存区域, redo log buffer 中的数据修改信息会被写入操作系统的缓存 page cache 中. page cache 是操作系统内存的一部分, 主要用于解决内存与磁盘速度差异较大的交互问题, 与 在 CPU 与内存之间设置高速缓存是一个道理.</p> <p>YFD 配置的 innodb_flush_log_at_trx_commit<strong>​ ​</strong>参数值为 1.</p> <h4 id="binlog二进制归档日志"><a href="#binlog二进制归档日志" class="header-anchor">#</a> binlog二进制归档日志</h4> <p>binlog 二进制日志是<strong>逻辑日志</strong>, 记录保存了<strong>所有执行过的修改操作语句, 不保存查询操作</strong>. 如果 MySQL 服务意外停止, 可通过 binlog 日志文件排查用户操作或表结构操作, 从而来恢复数据库数据.</p> <p>启动 binlog 记录功能, 会影响服务器性能, 主要用处是**==恢复数据与主从复制==**.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查看binlog相关参数</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%log_bin%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>YFD 测试环境的执行结果如下所示:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/202303191911123.png" alt=""></p> <p>几个参数的含义:</p> <ul><li>log_bin: binlog 日志是否打开状态</li> <li>log_bin_basename: 是 binlog 日志的基本文件名, 后面会追加标识来表示每一个文件, binlog 日志文件会滚动增加.</li> <li>log_bin_index: 指定的是 binlog 文件的索引文件, 这个文件管理了所有的 binlog 文件的目录.</li> <li>sql_log_bin: SQL 语句是否写入 binlog 文件, ON 代表需要写入, OFF 代表不需要写入. 如果想在主库上执行一些操作, 但不复制到 slave 库上, 可以通过修改参数 sql_log_bin 来实现. 比如模拟主从同步复制异常.</li></ul> <p>MySQL5.7 版本中, binlog 默认是关闭的, 8.0 版本默认是打开的. 上图中 log_bin 的值是 ON 就代表 binlog 是开启状态.</p> <p>binlog 日志文件可能会存在多个, 比如:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span>
mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000002</span>
mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token keyword">index</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里 mysql-bin.index 文件是 binlog 文件的索引文件, 这个文件管理了所有的 binlog 文件的目录.</p> <h5 id="binlog的日志格式"><a href="#binlog的日志格式" class="header-anchor">#</a> binlog的日志格式</h5> <p>用参数 binlog_format 可以设置 binlog 日志的记录格式, MySQL 支持三种格式类型:</p> <ul><li><strong>STATEMENT</strong>: 基于 SQL 语句的复制, 每一条会修改数据的 SQL 都会记录到 master 机器的 bin-log 中, 这种方式日志量小, 节约 IO 开销, 提高性能, 但是对于一些执行过程中才能确定结果的函数, 比如 UUID(), SYSDATE() 等函数如果随 SQL 同步到 slave 机器去执行, 则结果跟 master 机器执行的不一样.</li> <li><strong>ROW</strong>: 基于行的复制, 日志中会记录成每一行数据被修改的形式, 然后在 slave 端再对相同的数据进行修改记录下每一行数据修改的细节, 可以解决函数, 存储过程等在 slave 机器的复制问题, 但这种方式日志量较大, 性能不如 Statement. 举个例子, 假设 update 语句更新 100 行数据, Statement 方式就记录这条 update 语句, Row 方式会记录被修改的 100 行数据.</li> <li><strong>MIXED</strong>: 混合模式复制, 实际就是前两种模式的结合, 在 Mixed 模式下, MySQL 会根据执行的每一条具体的 SQL 语句来区分对待记录的日志形式, 也就是在 Statement 和 Row 之间选择一种, 如果 SQl 里有函数或一些在执行时才知道结果的情况, 会选择 Row, 其它情况选择 Statement, 推荐使用这一种.</li></ul> <h5 id="binlog写入磁盘机制"><a href="#binlog写入磁盘机制" class="header-anchor">#</a> binlog写入磁盘机制</h5> <p>binlog 写入磁盘机制主要通过 <strong>sync_binlog</strong> 参数控制, 默认值是 0.</p> <ul><li>设置为 0. 表示每次提交事务都只 write 到 page cache, 由系统自行判断什么时候执行 fsync 写入磁盘. 虽然性能得到提升, 但是机器宕机, page cache 里面的 binlog 会丢失. 这与前面 redo log 类似.</li> <li>设置为 1. 表示每次提交事务都会执行 fsync 写入磁盘, 这种方式最安全.</li> <li>设置为 N(N&gt;1). 表示每次提交事务都 write 到 page cache, 但累积 N 个事务后才 fsync 写入磁盘, 这种如果机器宕机会丢失 N 个事务的 binlog.</li></ul> <p>发生以下任何事件时, <strong>binlog 日志文件会重新生成</strong>:</p> <ul><li>服务器启动或重新启动.</li> <li>服务器刷新日志, 执行命令 flush logs.</li> <li>日志文件大小达到 max_binlog_size 值, 默认值为 1GB.</li></ul> <h5 id="删除binlog日志文件"><a href="#删除binlog日志文件" class="header-anchor">#</a> 删除binlog日志文件</h5> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 删除当前的binlog文件</span>
reset master<span class="token punctuation">;</span>
<span class="token comment">-- 删除指定日志文件之前的所有日志文件, 下面这个是删除6之前的所有日志文件, 当前这个文件不删除</span>
<span class="token keyword">purge</span> master logs <span class="token keyword">to</span> <span class="token string">'mysql-binlog.000006'</span><span class="token punctuation">;</span>
<span class="token comment">-- 删除指定日期前的日志索引中binlog日志文件</span>
<span class="token keyword">purge</span> master logs before <span class="token string">'2023-01-21 14:00:00'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="查看binlog日志文件"><a href="#查看binlog日志文件" class="header-anchor">#</a> 查看binlog日志文件</h5> <p>可以用 MySQL 自带的命令工具 mysqlbinlog 查看 binlog 日志内容.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查看bin-log二进制文件(命令行方式, 不用登录mysql)</span>
mysqlbinlog <span class="token comment">--no-defaults -v --base64-output=decode-rows D:/dev/mysql-5.7.25-winx64/data/mysql-binlog.000007 </span>

<span class="token comment">-- 查看bin-log二进制文件(带查询条件)</span>
mysqlbinlog <span class="token comment">--no-defaults -v --base64-output=decode-rows D:/dev/mysql-5.7.25-winx64/data/mysql-binlog.000007 start-datetime=&quot;2023-01-21 00:00:00&quot; stop-datetime=&quot;2023-02-01 00:00:00&quot; start-position=&quot;5000&quot; stop-position=&quot;20000&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>执行 mysqlbinlog 命令.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysqlbinlog <span class="token comment">--no-defaults -v --base64-output=decode-rows D:/dev/mysql-5.7.25-winx64/data/mysql-binlog.000007</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查出来的 binlog 日志文件内容如下:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/</span><span class="token punctuation">;</span>
<span class="token comment">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/</span><span class="token punctuation">;</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 4</span>
<span class="token comment">#230127 21:13:51 server id 1  end_log_pos 123 CRC32 0x084f390f  Start: binlog v 4, server v 5.7.25-log created 230127 21:13:51 at startup</span>
<span class="token comment"># Warning: this binlog is either in use or was not closed properly.</span>
<span class="token keyword">ROLLBACK</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 123</span>
<span class="token comment">#230127 21:13:51 server id 1  end_log_pos 154 CRC32 0x672ba207  Previous-GTIDs</span>
<span class="token comment"># [empty]</span>
<span class="token comment"># at 154</span>
<span class="token comment">#230127 21:22:48 server id 1  end_log_pos 219 CRC32 0x8349d010  Anonymous_GTID  last_committed=0        sequence_number=1       rbr_only=yes</span>
<span class="token comment">/*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*/</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@SESSION.GTID_NEXT</span><span class="token operator">=</span> <span class="token string">'ANONYMOUS'</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 219</span>
<span class="token comment">#230127 21:22:48 server id 1  end_log_pos 291 CRC32 0xbf49de02  Query   thread_id=3     exec_time=0     error_code=0</span>
<span class="token keyword">SET</span> <span class="token keyword">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1674825768</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.pseudo_thread_id</span><span class="token operator">=</span><span class="token number">3</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.foreign_key_checks</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> @<span class="token variable">@session.sql_auto_is_null</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> @<span class="token variable">@session.unique_checks</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> @<span class="token variable">@session.autocommit</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.sql_mode</span><span class="token operator">=</span><span class="token number">1342177280</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.auto_increment_increment</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> @<span class="token variable">@session.auto_increment_offset</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment">/*!\C utf8 */</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.character_set_client</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">,</span>@<span class="token variable">@session.collation_connection</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">,</span>@<span class="token variable">@session.collation_server</span><span class="token operator">=</span><span class="token number">33</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.lc_time_names</span><span class="token operator">=</span><span class="token number">0</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.collation_database</span><span class="token operator">=</span><span class="token keyword">DEFAULT</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
<span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 291</span>
<span class="token comment">#230127 21:22:48 server id 1  end_log_pos 345 CRC32 0xc4ab653e  Table_map: `test`.`account` mapped to number 99</span>
<span class="token comment"># at 345</span>
<span class="token comment">#230127 21:22:48 server id 1  end_log_pos 413 CRC32 0x54a124bd  Update_rows: table id 99 flags: STMT_END_F</span>
<span class="token comment">### UPDATE `test`.`account`</span>
<span class="token comment">### WHERE</span>
<span class="token comment">###   @1=1</span>
<span class="token comment">###   @2='lilei'</span>
<span class="token comment">###   @3=1000</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=1</span>
<span class="token comment">###   @2='lilei'</span>
<span class="token comment">###   @3=2000</span>
<span class="token comment"># at 413</span>
<span class="token comment">#230127 21:22:48 server id 1  end_log_pos 444 CRC32 0x23355595  Xid = 10</span>
<span class="token keyword">COMMIT</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 444</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>能看到里面有具体执行的修改 SQL 语句以及执行时的相关情况.</p> <h5 id="binlog日志文件恢复数据"><a href="#binlog日志文件恢复数据" class="header-anchor">#</a> binlog日志文件恢复数据</h5> <p>用 binlog 日志文件恢复数据其实就是<strong>回放执行</strong>之前记录在 binlog 文件里的 SQL, 举一个数据恢复的例子:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 先执行刷新日志的命令生成一个新的binlog文件mysql-binlog.000008, 后面修改操作日志都会记录在最新的这个文件里</span>
flush logs<span class="token punctuation">;</span>
<span class="token comment">-- 执行两条插入语句</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>account<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>balance<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'zhu'</span><span class="token punctuation">,</span> <span class="token string">'666'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>account<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>balance<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'zhu1'</span><span class="token punctuation">,</span> <span class="token string">'888'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 假设现在误操作执行了一条删除语句把刚新增的两条数据删掉了</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> account <span class="token keyword">where</span> id <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>现在需要恢复被删除的两条数据, 先查看 binlog 日志文件.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysqlbinlog <span class="token comment">--no-defaults -v --base64-output=decode-rows D:/dev/mysql-5.7.25-winx64/data/mysql-binlog.000008</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>文件内容如下:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> @<span class="token variable">@SESSION.GTID_NEXT</span><span class="token operator">=</span> <span class="token string">'ANONYMOUS'</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 219</span>
<span class="token comment">#230127 23:32:24 server id 1  end_log_pos 291 CRC32 0x4528234f  Query   thread_id=5     exec_time=0     error_code=0</span>
<span class="token keyword">SET</span> <span class="token keyword">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1674833544</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.pseudo_thread_id</span><span class="token operator">=</span><span class="token number">5</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.foreign_key_checks</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> @<span class="token variable">@session.sql_auto_is_null</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> @<span class="token variable">@session.unique_checks</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> @<span class="token variable">@session.autocommit</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.sql_mode</span><span class="token operator">=</span><span class="token number">1342177280</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.auto_increment_increment</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> @<span class="token variable">@session.auto_increment_offset</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment">/*!\C utf8 */</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.character_set_client</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">,</span>@<span class="token variable">@session.collation_connection</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">,</span>@<span class="token variable">@session.collation_server</span><span class="token operator">=</span><span class="token number">33</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.lc_time_names</span><span class="token operator">=</span><span class="token number">0</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.collation_database</span><span class="token operator">=</span><span class="token keyword">DEFAULT</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
<span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 291</span>
<span class="token comment">#230127 23:32:24 server id 1  end_log_pos 345 CRC32 0x7482741d  Table_map: `test`.`account` mapped to number 99</span>
<span class="token comment"># at 345</span>
<span class="token comment">#230127 23:32:24 server id 1  end_log_pos 396 CRC32 0x5e443cf0  Write_rows: table id 99 flags: STMT_END_F</span>
<span class="token comment">### INSERT INTO `test`.`account`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=4</span>
<span class="token comment">###   @2='zhu'</span>
<span class="token comment">###   @3=666</span>
<span class="token comment"># at 396</span>
<span class="token comment">#230127 23:32:24 server id 1  end_log_pos 427 CRC32 0x8a0d8a3c  Xid = 56</span>
<span class="token keyword">COMMIT</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 427</span>
<span class="token comment">#230127 23:32:40 server id 1  end_log_pos 492 CRC32 0x5261a37e  Anonymous_GTID  last_committed=1        sequence_number=2       rbr_only=yes</span>
<span class="token comment">/*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*/</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@SESSION.GTID_NEXT</span><span class="token operator">=</span> <span class="token string">'ANONYMOUS'</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 492</span>
<span class="token comment">#230127 23:32:40 server id 1  end_log_pos 564 CRC32 0x01086643  Query   thread_id=5     exec_time=0     error_code=0</span>
<span class="token keyword">SET</span> <span class="token keyword">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1674833560</span><span class="token comment">/*!*/</span>
<span class="token keyword">BEGIN</span>
<span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 564</span>
<span class="token comment">#230127 23:32:40 server id 1  end_log_pos 618 CRC32 0xc26b6719  Table_map: `test`.`account` mapped to number 99</span>
<span class="token comment"># at 618</span>
<span class="token comment">#230127 23:32:40 server id 1  end_log_pos 670 CRC32 0x8e272176  Write_rows: table id 99 flags: STMT_END_F</span>
<span class="token comment">### INSERT INTO `test`.`account`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=5</span>
<span class="token comment">###   @2='zhu1'</span>
<span class="token comment">###   @3=888</span>
<span class="token comment"># at 670</span>
<span class="token comment">#230127 23:32:40 server id 1  end_log_pos 701 CRC32 0xb5e63d00  Xid = 58</span>
<span class="token keyword">COMMIT</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 701</span>
<span class="token comment">#230127 23:34:23 server id 1  end_log_pos 766 CRC32 0xa0844501  Anonymous_GTID  last_committed=2        sequence_number=3       rbr_only=yes</span>
<span class="token comment">/*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*/</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@SESSION.GTID_NEXT</span><span class="token operator">=</span> <span class="token string">'ANONYMOUS'</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 766</span>
<span class="token comment">#230127 23:34:23 server id 1  end_log_pos 838 CRC32 0x687bdf88  Query   thread_id=7     exec_time=0     error_code=0</span>
<span class="token keyword">SET</span> <span class="token keyword">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1674833663</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
<span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment"># at 838</span>
<span class="token comment">#230127 23:34:23 server id 1  end_log_pos 892 CRC32 0x4f7b7d6a  Table_map: `test`.`account` mapped to number 99</span>
<span class="token comment"># at 892</span>
<span class="token comment">#230127 23:34:23 server id 1  end_log_pos 960 CRC32 0xc47ac777  Delete_rows: table id 99 flags: STMT_END_F</span>
<span class="token comment">### DELETE FROM `test`.`account`</span>
<span class="token comment">### WHERE</span>
<span class="token comment">###   @1=4</span>
<span class="token comment">###   @2='zhu'</span>
<span class="token comment">###   @3=666</span>
<span class="token comment">### DELETE FROM `test`.`account`</span>
<span class="token comment">### WHERE</span>
<span class="token comment">###   @1=5</span>
<span class="token comment">###   @2='zhu1'</span>
<span class="token comment">###   @3=888</span>
<span class="token comment"># at 960</span>
<span class="token comment">#230127 23:34:23 server id 1  end_log_pos 991 CRC32 0x386699fe  Xid = 65</span>
<span class="token keyword">COMMIT</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@SESSION.GTID_NEXT</span><span class="token operator">=</span> <span class="token string">'AUTOMATIC'</span> <span class="token comment">/* added by mysqlbinlog */</span> <span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<span class="token comment"># End of log file</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><p>找到两条插入数据的 SQL, 每条 SQL 的上下都有 BEGIN 和 COMMIT, 找到第一条 SQL BEGIN 前面的文件位置标识 at <strong>219</strong>(这是文件的位置标识), 再找到第二条 SQL COMMIT 后面的文件位置标识 at <strong>701</strong>.</p> <p>可以根据文件位置标识来恢复数据, 执行如下 SQL:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysqlbinlog  <span class="token comment">--no-defaults --start-position=219 --stop-position=701 --database=test D:/dev/mysql-5.7.25-winx64/data/mysql-binlog.000009 | mysql -uroot -p123456 -v test</span>

<span class="token comment">-- 补充一个根据时间来恢复数据的命令, 找到第一条SQL BEGIN前面的时间戳标记 SET TIMESTAMP=1674833544, 再找到第二条SQL COMMIT后面的时间戳标记 SET TIMESTAMP=1674833663, 转成datetime格式</span>
mysqlbinlog  <span class="token comment">--no-defaults --start-datetime=&quot;2023-1-27 23:32:24&quot; --stop-datetime=&quot;2023-1-27 23:34:23&quot; --database=test D:/dev/mysql-5.7.25-winx64/data/mysql-binlog.000009 | mysql -uroot -p123456 -v test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样被删除数据就被恢复了!</p> <p>注意: 如果要恢复大量数据, 比如程序员经常说的删库跑路的话题, 假设把数据库所有数据都删除了要怎么恢复了, 如果数据库之前没有备份, 所有的 binlog 日志都在的话, 就从 binlog 第一个文件开始逐个恢复每个 binlog 文件里的数据, 这种一般不太可能, 因为 binlog 日志比较大, 早期的 binlog 文件会定期删除的, 所以一般不可能用 binlog 文件恢复整个数据库的.</p> <p>一般推荐的是定期做一次全量数据库备份, 那么恢复数据库可以用最近的一次全量备份再加上备份时间点之后的 binlog 来恢复数据.</p> <p>备份数据库一般可以用 mysqldump 命令工具.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 备份整个数据库</span>
mysqldump <span class="token operator">-</span>u root 数据库名<span class="token operator">&gt;</span>备份文件名<span class="token punctuation">;</span>   
<span class="token comment">-- 备份整个表</span>
mysqldump <span class="token operator">-</span>u root 数据库名 表名字<span class="token operator">&gt;</span>备份文件名<span class="token punctuation">;</span>  
<span class="token comment">-- 恢复整个数据库, test为数据库名称, 需要自己先建一个数据库test</span>
mysql <span class="token operator">-</span>u root test <span class="token operator">&lt;</span> 备份文件名 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="undo-log回滚日志"><a href="#undo-log回滚日志" class="header-anchor">#</a> undo log回滚日志</h4> <p>InnoDB 对 <strong>undo log 文件</strong>的管理采用段的方式, 也就是<strong>回滚段</strong>(rollback segment). 每个回滚段记录了 1024 个 undo log segment, <strong>每个事务只会使用一个 undo log segment</strong>.</p> <p>在 MySQL5.5 的时候, 只有一个回滚段, 那么最大同时支持的事务数量为 1024 个. 在 MySQL 5.6 开始, InnoDB 支持最大 128 个回滚段, 故其支持同时在线的事务限制提高到了 128 * 1024.</p> <ul><li>innodb_undo_directory: 设置 undo log 文件所在的路径. 该参数的默认值为 &quot;./&quot;, 即 InnoDB 数据文件存储位置, 目录下 ibdata1 文件就是 undo log 存储的位置.</li> <li>innodb_undo_logs: 设置 undo log 文件内部回滚段的个数, 默认值为 128.</li> <li>innodb_undo_tablespaces: 设置 undo log 文件的数量, 这样回滚段可以较为平均地分布在多个文件中. 设置该参数后, 会在路径 innodb_undo_directory 看到以 undo 为前缀的文件.</li></ul> <h5 id="undo-log日志什么时候删除"><a href="#undo-log日志什么时候删除" class="header-anchor">#</a> undo log日志什么时候删除</h5> <p><strong>新增类型的, 在事务提交之后就可以清除掉了</strong>.</p> <p>修改类型的, 事务提交之后不能立即清除掉, 这些日志会用于 MVCC, 只有当没有事务用到该版本信息时才可以清除.</p> <p>‍</p> <p>‍</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <ul><li><a href="https://segmentfault.com/a/1190000012650596" target="_blank" rel="noopener noreferrer">MySQL-InnoDB-MVCC多版本并发控制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://xiaorui.cc/2016/12/08/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%BB%BA%E8%AE%AEinnodb%E4%BD%BF%E7%94%A8%E4%BA%BF%E7%BA%A7%E5%A4%A7%E8%A1%A8/" target="_blank" rel="noopener noreferrer">为什么不建议innodb使用亿级大表 | 峰云就她了<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>‍</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/main/docs/20.开发/2300.数据库/301.MySQL架构与日志.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/495264/" class="prev">MySQL开发与优化</a></span> <span class="next"><a href="/pages/4dbe1f/">MySQL索引</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f90282/"><div>
            基础
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/0f75ac/"><div>
            搜索二叉树BST
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/39721f/"><div>
            平衡二叉树AVL
            <!----></div></a> <span class="date">06-08</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1174520425@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/nanodaemony" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>达尔文的猹 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.5bc2c979.js" defer></script><script src="/assets/js/2.eccd4273.js" defer></script><script src="/assets/js/179.b634397c.js" defer></script>
  </body>
</html>
