<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx基础 | Pangolin Note</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="大道至简">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.56073ad3.css" as="style"><link rel="preload" href="/assets/js/app.3f3e0e10.js" as="script"><link rel="preload" href="/assets/js/2.e9fcb30c.js" as="script"><link rel="preload" href="/assets/js/3.1998f389.js" as="script"><link rel="preload" href="/assets/js/164.a1cc0109.js" as="script"><link rel="prefetch" href="/assets/js/10.0b55747f.js"><link rel="prefetch" href="/assets/js/100.b8912a99.js"><link rel="prefetch" href="/assets/js/101.a6740c8a.js"><link rel="prefetch" href="/assets/js/102.e31e89b2.js"><link rel="prefetch" href="/assets/js/103.2c5dbdae.js"><link rel="prefetch" href="/assets/js/104.0e9c02f6.js"><link rel="prefetch" href="/assets/js/105.8288396c.js"><link rel="prefetch" href="/assets/js/106.62f43c11.js"><link rel="prefetch" href="/assets/js/107.70c90211.js"><link rel="prefetch" href="/assets/js/108.b488ce56.js"><link rel="prefetch" href="/assets/js/109.12942650.js"><link rel="prefetch" href="/assets/js/11.ac3fd1ca.js"><link rel="prefetch" href="/assets/js/110.1e57ecba.js"><link rel="prefetch" href="/assets/js/111.6e33b4ea.js"><link rel="prefetch" href="/assets/js/112.bd52831b.js"><link rel="prefetch" href="/assets/js/113.868c1ac9.js"><link rel="prefetch" href="/assets/js/114.090549d1.js"><link rel="prefetch" href="/assets/js/115.d97f6c2b.js"><link rel="prefetch" href="/assets/js/116.097c4b4e.js"><link rel="prefetch" href="/assets/js/117.4024cfe2.js"><link rel="prefetch" href="/assets/js/118.e3057cba.js"><link rel="prefetch" href="/assets/js/119.4ef1fa3b.js"><link rel="prefetch" href="/assets/js/12.863eaabe.js"><link rel="prefetch" href="/assets/js/120.78f9df50.js"><link rel="prefetch" href="/assets/js/121.8e16df87.js"><link rel="prefetch" href="/assets/js/122.f21c0107.js"><link rel="prefetch" href="/assets/js/123.ea1cb375.js"><link rel="prefetch" href="/assets/js/124.01c04c6e.js"><link rel="prefetch" href="/assets/js/125.d383e301.js"><link rel="prefetch" href="/assets/js/126.3162cb47.js"><link rel="prefetch" href="/assets/js/127.c6bebae6.js"><link rel="prefetch" href="/assets/js/128.d659db60.js"><link rel="prefetch" href="/assets/js/129.2afdcf48.js"><link rel="prefetch" href="/assets/js/13.4f59ce35.js"><link rel="prefetch" href="/assets/js/130.beb9ed9d.js"><link rel="prefetch" href="/assets/js/131.35b05f8a.js"><link rel="prefetch" href="/assets/js/132.d77f4f93.js"><link rel="prefetch" href="/assets/js/133.4ceda6e5.js"><link rel="prefetch" href="/assets/js/134.11390c5f.js"><link rel="prefetch" href="/assets/js/135.32f9e38f.js"><link rel="prefetch" href="/assets/js/136.6d8bb0f2.js"><link rel="prefetch" href="/assets/js/137.9c0ffeef.js"><link rel="prefetch" href="/assets/js/138.88d86e5f.js"><link rel="prefetch" href="/assets/js/139.8c2c3d6c.js"><link rel="prefetch" href="/assets/js/14.11c82d35.js"><link rel="prefetch" href="/assets/js/140.c5c375d3.js"><link rel="prefetch" href="/assets/js/141.d703f30b.js"><link rel="prefetch" href="/assets/js/142.6a005a44.js"><link rel="prefetch" href="/assets/js/143.9b2edf6f.js"><link rel="prefetch" href="/assets/js/144.3fd013c9.js"><link rel="prefetch" href="/assets/js/145.b05079c5.js"><link rel="prefetch" href="/assets/js/146.ed5360a6.js"><link rel="prefetch" href="/assets/js/147.7408d86f.js"><link rel="prefetch" href="/assets/js/148.f390b370.js"><link rel="prefetch" href="/assets/js/149.95017f0a.js"><link rel="prefetch" href="/assets/js/15.bd143bd5.js"><link rel="prefetch" href="/assets/js/150.f0ede764.js"><link rel="prefetch" href="/assets/js/151.b7093623.js"><link rel="prefetch" href="/assets/js/152.a82a6c83.js"><link rel="prefetch" href="/assets/js/153.965e3fb2.js"><link rel="prefetch" href="/assets/js/154.9e49311e.js"><link rel="prefetch" href="/assets/js/155.cef33ba5.js"><link rel="prefetch" href="/assets/js/156.bcc397ae.js"><link rel="prefetch" href="/assets/js/157.90824739.js"><link rel="prefetch" href="/assets/js/158.efd429b9.js"><link rel="prefetch" href="/assets/js/159.122ff5b7.js"><link rel="prefetch" href="/assets/js/16.2449162b.js"><link rel="prefetch" href="/assets/js/160.0b806535.js"><link rel="prefetch" href="/assets/js/161.835052c6.js"><link rel="prefetch" href="/assets/js/162.ca34e2d2.js"><link rel="prefetch" href="/assets/js/163.08000d04.js"><link rel="prefetch" href="/assets/js/165.65444686.js"><link rel="prefetch" href="/assets/js/166.7d73c84f.js"><link rel="prefetch" href="/assets/js/167.009d47a3.js"><link rel="prefetch" href="/assets/js/168.0afeae2a.js"><link rel="prefetch" href="/assets/js/169.7654cb31.js"><link rel="prefetch" href="/assets/js/17.eb7f9def.js"><link rel="prefetch" href="/assets/js/170.58569530.js"><link rel="prefetch" href="/assets/js/171.7db9ed40.js"><link rel="prefetch" href="/assets/js/172.3cb50ed4.js"><link rel="prefetch" href="/assets/js/173.0846425f.js"><link rel="prefetch" href="/assets/js/174.9e95f111.js"><link rel="prefetch" href="/assets/js/175.ef2098f2.js"><link rel="prefetch" href="/assets/js/176.c2635fe9.js"><link rel="prefetch" href="/assets/js/177.4fa38e8e.js"><link rel="prefetch" href="/assets/js/178.2be7037f.js"><link rel="prefetch" href="/assets/js/179.bf3bba28.js"><link rel="prefetch" href="/assets/js/18.0455f4d1.js"><link rel="prefetch" href="/assets/js/180.72c5f597.js"><link rel="prefetch" href="/assets/js/181.42287bcc.js"><link rel="prefetch" href="/assets/js/182.6cd4bf1a.js"><link rel="prefetch" href="/assets/js/183.05dbbfd9.js"><link rel="prefetch" href="/assets/js/184.03de7e00.js"><link rel="prefetch" href="/assets/js/185.42dd210e.js"><link rel="prefetch" href="/assets/js/186.28ee0f8a.js"><link rel="prefetch" href="/assets/js/187.bb58697b.js"><link rel="prefetch" href="/assets/js/188.1bc8be96.js"><link rel="prefetch" href="/assets/js/189.fac747e3.js"><link rel="prefetch" href="/assets/js/19.ae9e35d6.js"><link rel="prefetch" href="/assets/js/190.ea533ac7.js"><link rel="prefetch" href="/assets/js/191.6dc6eb13.js"><link rel="prefetch" href="/assets/js/192.184d249f.js"><link rel="prefetch" href="/assets/js/193.4a06bc12.js"><link rel="prefetch" href="/assets/js/194.8cce60a9.js"><link rel="prefetch" href="/assets/js/195.93231a13.js"><link rel="prefetch" href="/assets/js/196.4a596bde.js"><link rel="prefetch" href="/assets/js/197.96c113cf.js"><link rel="prefetch" href="/assets/js/198.73ba3f67.js"><link rel="prefetch" href="/assets/js/199.74bab595.js"><link rel="prefetch" href="/assets/js/20.b542d0e7.js"><link rel="prefetch" href="/assets/js/200.69a6928a.js"><link rel="prefetch" href="/assets/js/201.9ffa7c5a.js"><link rel="prefetch" href="/assets/js/202.41edb652.js"><link rel="prefetch" href="/assets/js/203.7fabcef3.js"><link rel="prefetch" href="/assets/js/204.b0ae2f62.js"><link rel="prefetch" href="/assets/js/205.add8738b.js"><link rel="prefetch" href="/assets/js/206.f3a712ec.js"><link rel="prefetch" href="/assets/js/207.cd7dd729.js"><link rel="prefetch" href="/assets/js/208.78b33afa.js"><link rel="prefetch" href="/assets/js/209.9d3329ff.js"><link rel="prefetch" href="/assets/js/21.5a050318.js"><link rel="prefetch" href="/assets/js/210.d285d5ac.js"><link rel="prefetch" href="/assets/js/211.8791bb3f.js"><link rel="prefetch" href="/assets/js/212.84ed81a8.js"><link rel="prefetch" href="/assets/js/213.7b990580.js"><link rel="prefetch" href="/assets/js/214.da31f20c.js"><link rel="prefetch" href="/assets/js/215.9eeed659.js"><link rel="prefetch" href="/assets/js/216.9539f0ec.js"><link rel="prefetch" href="/assets/js/217.11b575be.js"><link rel="prefetch" href="/assets/js/218.a67f12f1.js"><link rel="prefetch" href="/assets/js/219.bfbb817a.js"><link rel="prefetch" href="/assets/js/22.2bc6f7e3.js"><link rel="prefetch" href="/assets/js/220.8b01342f.js"><link rel="prefetch" href="/assets/js/221.b450decd.js"><link rel="prefetch" href="/assets/js/222.97468507.js"><link rel="prefetch" href="/assets/js/223.b6dafd73.js"><link rel="prefetch" href="/assets/js/224.c86c18c6.js"><link rel="prefetch" href="/assets/js/225.b0dcf86e.js"><link rel="prefetch" href="/assets/js/226.02cc2999.js"><link rel="prefetch" href="/assets/js/227.8474ef5a.js"><link rel="prefetch" href="/assets/js/228.0298e421.js"><link rel="prefetch" href="/assets/js/229.6aeaf595.js"><link rel="prefetch" href="/assets/js/23.9995fce4.js"><link rel="prefetch" href="/assets/js/230.a5785286.js"><link rel="prefetch" href="/assets/js/231.d791daa4.js"><link rel="prefetch" href="/assets/js/232.97aeeb00.js"><link rel="prefetch" href="/assets/js/233.46e51e28.js"><link rel="prefetch" href="/assets/js/234.2cffe82f.js"><link rel="prefetch" href="/assets/js/235.14965da6.js"><link rel="prefetch" href="/assets/js/236.00a5afc0.js"><link rel="prefetch" href="/assets/js/237.3b73d52f.js"><link rel="prefetch" href="/assets/js/238.6e1db765.js"><link rel="prefetch" href="/assets/js/239.75866c5e.js"><link rel="prefetch" href="/assets/js/24.9141eeb2.js"><link rel="prefetch" href="/assets/js/240.af9c2cc9.js"><link rel="prefetch" href="/assets/js/241.388acab2.js"><link rel="prefetch" href="/assets/js/242.c60f2b48.js"><link rel="prefetch" href="/assets/js/243.d8e81b13.js"><link rel="prefetch" href="/assets/js/244.58b0b21d.js"><link rel="prefetch" href="/assets/js/245.c3768497.js"><link rel="prefetch" href="/assets/js/246.ac8bbe7a.js"><link rel="prefetch" href="/assets/js/247.d095f70a.js"><link rel="prefetch" href="/assets/js/248.e9f210b5.js"><link rel="prefetch" href="/assets/js/249.a9fad023.js"><link rel="prefetch" href="/assets/js/25.98e8593e.js"><link rel="prefetch" href="/assets/js/250.ae7f0ebb.js"><link rel="prefetch" href="/assets/js/251.9a617d55.js"><link rel="prefetch" href="/assets/js/252.ce082446.js"><link rel="prefetch" href="/assets/js/253.4575302d.js"><link rel="prefetch" href="/assets/js/254.5899a61b.js"><link rel="prefetch" href="/assets/js/255.66c69f31.js"><link rel="prefetch" href="/assets/js/256.8fd6c706.js"><link rel="prefetch" href="/assets/js/257.31b77e5e.js"><link rel="prefetch" href="/assets/js/258.eba48891.js"><link rel="prefetch" href="/assets/js/259.edf74b59.js"><link rel="prefetch" href="/assets/js/26.e69924ea.js"><link rel="prefetch" href="/assets/js/260.cf2ed36d.js"><link rel="prefetch" href="/assets/js/261.9e7792d8.js"><link rel="prefetch" href="/assets/js/262.e7b9433e.js"><link rel="prefetch" href="/assets/js/263.1185b25c.js"><link rel="prefetch" href="/assets/js/264.5e0f89cb.js"><link rel="prefetch" href="/assets/js/265.a38d3b94.js"><link rel="prefetch" href="/assets/js/266.2ef170b3.js"><link rel="prefetch" href="/assets/js/267.a7d14651.js"><link rel="prefetch" href="/assets/js/268.05b18748.js"><link rel="prefetch" href="/assets/js/269.dad48d6f.js"><link rel="prefetch" href="/assets/js/27.13612515.js"><link rel="prefetch" href="/assets/js/270.4f5a6b8d.js"><link rel="prefetch" href="/assets/js/271.7ebf6682.js"><link rel="prefetch" href="/assets/js/272.7c2fbfd1.js"><link rel="prefetch" href="/assets/js/273.8ee20732.js"><link rel="prefetch" href="/assets/js/274.d525242a.js"><link rel="prefetch" href="/assets/js/275.a8a19acb.js"><link rel="prefetch" href="/assets/js/276.df3a4eb4.js"><link rel="prefetch" href="/assets/js/277.336debda.js"><link rel="prefetch" href="/assets/js/278.c470625f.js"><link rel="prefetch" href="/assets/js/279.a91e1a64.js"><link rel="prefetch" href="/assets/js/28.ab7ae1df.js"><link rel="prefetch" href="/assets/js/280.87e25c9a.js"><link rel="prefetch" href="/assets/js/281.87c1ba25.js"><link rel="prefetch" href="/assets/js/282.dcd4dce0.js"><link rel="prefetch" href="/assets/js/283.abac2e00.js"><link rel="prefetch" href="/assets/js/284.f6079659.js"><link rel="prefetch" href="/assets/js/285.f1b39879.js"><link rel="prefetch" href="/assets/js/286.f6a79242.js"><link rel="prefetch" href="/assets/js/287.06bebe07.js"><link rel="prefetch" href="/assets/js/288.89e325df.js"><link rel="prefetch" href="/assets/js/289.3aa1bedd.js"><link rel="prefetch" href="/assets/js/29.ebe50f76.js"><link rel="prefetch" href="/assets/js/290.ee059c92.js"><link rel="prefetch" href="/assets/js/291.fa9a921a.js"><link rel="prefetch" href="/assets/js/292.2a8811cd.js"><link rel="prefetch" href="/assets/js/293.eec09cdf.js"><link rel="prefetch" href="/assets/js/294.dfac20dc.js"><link rel="prefetch" href="/assets/js/295.825d2070.js"><link rel="prefetch" href="/assets/js/296.f645861e.js"><link rel="prefetch" href="/assets/js/297.424fdb17.js"><link rel="prefetch" href="/assets/js/298.ebf87cdc.js"><link rel="prefetch" href="/assets/js/299.b8f19cbb.js"><link rel="prefetch" href="/assets/js/30.75237511.js"><link rel="prefetch" href="/assets/js/300.10fb6d4f.js"><link rel="prefetch" href="/assets/js/301.ef77c612.js"><link rel="prefetch" href="/assets/js/302.1b839763.js"><link rel="prefetch" href="/assets/js/303.609f7d98.js"><link rel="prefetch" href="/assets/js/304.1d255f19.js"><link rel="prefetch" href="/assets/js/305.b0234f2c.js"><link rel="prefetch" href="/assets/js/306.48677f64.js"><link rel="prefetch" href="/assets/js/307.14390d4b.js"><link rel="prefetch" href="/assets/js/308.fa730b28.js"><link rel="prefetch" href="/assets/js/309.0496b9e0.js"><link rel="prefetch" href="/assets/js/31.cf3f471a.js"><link rel="prefetch" href="/assets/js/310.a31676dc.js"><link rel="prefetch" href="/assets/js/311.ed53adc5.js"><link rel="prefetch" href="/assets/js/312.1b0ff2f1.js"><link rel="prefetch" href="/assets/js/313.bf123f32.js"><link rel="prefetch" href="/assets/js/314.4e6ce06b.js"><link rel="prefetch" href="/assets/js/315.8eb18560.js"><link rel="prefetch" href="/assets/js/32.74fef842.js"><link rel="prefetch" href="/assets/js/33.bc2d190b.js"><link rel="prefetch" href="/assets/js/34.d23438fc.js"><link rel="prefetch" href="/assets/js/35.7675c4d0.js"><link rel="prefetch" href="/assets/js/36.96a4161b.js"><link rel="prefetch" href="/assets/js/37.d1824f2f.js"><link rel="prefetch" href="/assets/js/38.4effff9e.js"><link rel="prefetch" href="/assets/js/39.6509914b.js"><link rel="prefetch" href="/assets/js/4.4d01750f.js"><link rel="prefetch" href="/assets/js/40.1509d08b.js"><link rel="prefetch" href="/assets/js/41.f2c1124f.js"><link rel="prefetch" href="/assets/js/42.e541d077.js"><link rel="prefetch" href="/assets/js/43.369de999.js"><link rel="prefetch" href="/assets/js/44.43959db0.js"><link rel="prefetch" href="/assets/js/45.282fbd31.js"><link rel="prefetch" href="/assets/js/46.1b83cfe9.js"><link rel="prefetch" href="/assets/js/47.c3a88e41.js"><link rel="prefetch" href="/assets/js/48.bc7c0a1b.js"><link rel="prefetch" href="/assets/js/49.92a4e5ba.js"><link rel="prefetch" href="/assets/js/5.c3991e24.js"><link rel="prefetch" href="/assets/js/50.9c488c6c.js"><link rel="prefetch" href="/assets/js/51.546ea632.js"><link rel="prefetch" href="/assets/js/52.0d2ccee1.js"><link rel="prefetch" href="/assets/js/53.6f52b5b1.js"><link rel="prefetch" href="/assets/js/54.c838b295.js"><link rel="prefetch" href="/assets/js/55.13af99ee.js"><link rel="prefetch" href="/assets/js/56.6be6d1ed.js"><link rel="prefetch" href="/assets/js/57.67c98b39.js"><link rel="prefetch" href="/assets/js/58.107e82ec.js"><link rel="prefetch" href="/assets/js/59.b3e5edc7.js"><link rel="prefetch" href="/assets/js/6.36a535f9.js"><link rel="prefetch" href="/assets/js/60.3b0b4ba5.js"><link rel="prefetch" href="/assets/js/61.3df843df.js"><link rel="prefetch" href="/assets/js/62.1213823d.js"><link rel="prefetch" href="/assets/js/63.e8f3f926.js"><link rel="prefetch" href="/assets/js/64.e1219050.js"><link rel="prefetch" href="/assets/js/65.5bf5bb0b.js"><link rel="prefetch" href="/assets/js/66.a2502afb.js"><link rel="prefetch" href="/assets/js/67.690dd59b.js"><link rel="prefetch" href="/assets/js/68.de7b0915.js"><link rel="prefetch" href="/assets/js/69.ac61dd61.js"><link rel="prefetch" href="/assets/js/7.5d254238.js"><link rel="prefetch" href="/assets/js/70.3edd41b1.js"><link rel="prefetch" href="/assets/js/71.d23407e9.js"><link rel="prefetch" href="/assets/js/72.a5bd01bc.js"><link rel="prefetch" href="/assets/js/73.c9f4dd57.js"><link rel="prefetch" href="/assets/js/74.66323fc1.js"><link rel="prefetch" href="/assets/js/75.e1a72e00.js"><link rel="prefetch" href="/assets/js/76.801268b4.js"><link rel="prefetch" href="/assets/js/77.3a5fda67.js"><link rel="prefetch" href="/assets/js/78.54d84cd4.js"><link rel="prefetch" href="/assets/js/79.fa10f4e3.js"><link rel="prefetch" href="/assets/js/8.e060e47d.js"><link rel="prefetch" href="/assets/js/80.d5b24fea.js"><link rel="prefetch" href="/assets/js/81.0e9da714.js"><link rel="prefetch" href="/assets/js/82.e96ff6d7.js"><link rel="prefetch" href="/assets/js/83.771cced1.js"><link rel="prefetch" href="/assets/js/84.220b69e7.js"><link rel="prefetch" href="/assets/js/85.7dcc5659.js"><link rel="prefetch" href="/assets/js/86.44ba2100.js"><link rel="prefetch" href="/assets/js/87.281da75d.js"><link rel="prefetch" href="/assets/js/88.12d88449.js"><link rel="prefetch" href="/assets/js/89.f28c86d3.js"><link rel="prefetch" href="/assets/js/9.8f9fef32.js"><link rel="prefetch" href="/assets/js/90.715cabb2.js"><link rel="prefetch" href="/assets/js/91.6ced7c82.js"><link rel="prefetch" href="/assets/js/92.c05b33ca.js"><link rel="prefetch" href="/assets/js/93.6bf5fb66.js"><link rel="prefetch" href="/assets/js/94.3561200e.js"><link rel="prefetch" href="/assets/js/95.0f2cf716.js"><link rel="prefetch" href="/assets/js/96.ac8487ea.js"><link rel="prefetch" href="/assets/js/97.48042b5a.js"><link rel="prefetch" href="/assets/js/98.441bb7f8.js"><link rel="prefetch" href="/assets/js/99.4b214d92.js">
    <link rel="stylesheet" href="/assets/css/0.styles.56073ad3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/magic.png" alt="Pangolin Note" class="logo"> <span class="site-name can-hide">Pangolin Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">系统</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">🍀读书笔记</a></div><div class="nav-item"><a href="/work/" class="nav-link">工作</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">🌸达尔文的猹</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatarnew.png"> <div class="blogger-info"><h3>达尔文的猹</h3> <span>大道至简 悟在天成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">系统</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">🍀读书笔记</a></div><div class="nav-item"><a href="/work/" class="nav-link">工作</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">🌸达尔文的猹</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>分布式系统理论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/129626/" class="sidebar-link">分布式系统基础</a></li><li><a href="/pages/fb5d35/" class="sidebar-link">分布式共识算法</a></li><li><a href="/pages/12ac37/" class="sidebar-link">分布式系统组件</a></li><li><a href="/pages/d03ebf/" class="sidebar-link">分布式技术原理与算法解析(极客时间)🌸</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>系统接入层</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f1b6c4/" aria-current="page" class="active sidebar-link">Nginx基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/d4123d/" class="sidebar-link">深入拆解Tomcat与Jetty(极客时间)🌸</a></li><li><a href="/pages/baee2f/" class="sidebar-link">Netty</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>服务治理-注册发现与RPC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/05077d/" class="sidebar-link">基础</a></li><li><a href="/pages/51b6aa/" class="sidebar-link">RPC实战与核心原理(极客时间)🌸</a></li><li><a href="/pages/0966ee/" class="sidebar-link">Zookeeper</a></li><li><a href="/pages/3b7e05/" class="sidebar-link">Nacos</a></li><li><a href="/pages/7f31f8/" class="sidebar-link">Dubbo</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>服务治理-流量控制</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/44bfa8/" class="sidebar-link">负载均衡</a></li><li><a href="/pages/4d5a6c/" class="sidebar-link">限流</a></li><li><a href="/pages/e0c561/" class="sidebar-link">熔断</a></li><li><a href="/pages/12ae40/" class="sidebar-link">网关路由</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>服务治理-系统监控与安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8c9210/" class="sidebar-link">系统安全性</a></li><li><a href="/pages/c9bf40/" class="sidebar-link">系统监控组件</a></li><li><a href="/pages/3f3cf7/" class="sidebar-link">运维监控系统实战(极客时间)🌸</a></li><li><a href="/pages/e20e02/" class="sidebar-link">OAuth2.0实战课(极客时间)🌟</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>中间件-消息队列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/96d94c/" class="sidebar-link">消息队列基础</a></li><li><a href="/pages/abf16c/" class="sidebar-link">RabbitMQ</a></li><li><a href="/pages/4fc3f1/" class="sidebar-link">Kafka</a></li><li><a href="/pages/013cfe/" class="sidebar-link">RocketMQ</a></li><li><a href="/pages/ed8d92/" class="sidebar-link">Disruptor</a></li><li><a href="/pages/249149/" class="sidebar-link">消息队列高手课(极客时间)🌟</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>中间件-缓存</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/946847/" class="sidebar-link">缓存基础</a></li><li><a href="/pages/e46d56/" class="sidebar-link">本地缓存</a></li><li><a href="/pages/0abfb9/" class="sidebar-link">Redis基础</a></li><li><a href="/pages/09236a/" class="sidebar-link">Redis持久化</a></li><li><a href="/pages/867f9b/" class="sidebar-link">Redis主从复制</a></li><li><a href="/pages/50cae1/" class="sidebar-link">Redis哨兵</a></li><li><a href="/pages/43b45c/" class="sidebar-link">Redis集群</a></li><li><a href="/pages/a32379/" class="sidebar-link">Redis内存管理与运维</a></li><li><a href="/pages/386037/" class="sidebar-link">Redis核心技术与实战(极客时间)🌸</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>中间件-其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/23044d/" class="sidebar-link">定时任务-XXLJob</a></li><li><a href="/pages/459117/" class="sidebar-link">ES与检索</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>系统设计与优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/41a845/" class="sidebar-link">凤凰架构</a></li><li><a href="/pages/68cc0b/" class="sidebar-link">左耳听风(极客时间)🌟</a></li><li><a href="/pages/e3e99c/" class="sidebar-link">从0开始学微服务(极客时间)🌸</a></li><li><a href="/pages/1e5368/" class="sidebar-link">高并发系统设计40问(极客时间)🌸</a></li><li><a href="/pages/33599f/" class="sidebar-link">系统性能调优必知必会(极客时间)🌸</a></li><li><a href="/pages/c83472/" class="sidebar-link">后端技术面试38讲(极客时间)</a></li><li><a href="/pages/4404b6/" class="sidebar-link">架构实战案例解析(极客时间)🌸</a></li><li><a href="/pages/8f1c1d/" class="sidebar-link">如何设计一个秒杀系统(极客时间)</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>容器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>容器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/582acf/" class="sidebar-link">部署Minikube</a></li><li><a href="/pages/98e5e4/" class="sidebar-link">容器实战高手课(极客时间)🌸</a></li><li><a href="/pages/c6a42c/" class="sidebar-link">Kubernetes实战🌸</a></li><li><a href="/pages/f35c72/" class="sidebar-link">深入剖析Kubernetes(极客时间)🌸</a></li><li><a href="/pages/caa314/" class="sidebar-link">Istio</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>自动化运维</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/beb97f/" class="sidebar-link">持续集成(CICD)</a></li><li><a href="/pages/a0df2d/" class="sidebar-link">DevOps</a></li><li><a href="/pages/765815/" class="sidebar-link">SRE实战手册(极客时间)</a></li></ul></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/middleware/#系统" data-v-06970110>系统</a></li><li data-v-06970110><a href="/middleware/#系统" data-v-06970110>系统</a></li><li data-v-06970110><a href="/middleware/#系统接入层" data-v-06970110>系统接入层</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/nanodaemony" target="_blank" title="作者" class="beLink" data-v-06970110>NanoDaemony</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2025-02-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">本文目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Nginx基础<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_100-nginx基础"><a href="#_100-nginx基础" class="header-anchor">#</a> 100.Nginx基础</h1> <p><a href="https://nginx.org/en/" target="_blank" rel="noopener noreferrer">Nginx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一款面向性能设计的 HTTP 服务器, 能反向代理 HTTP, HTTPS 和邮件相关(SMTP, POP3, IMAP)的协议链接. 并且提供了负载均衡以及 HTTP 缓存. 它的设计充分使用<strong>异步事件模型, 削减上下文调度</strong>的开销, 提高服务器并发能力. 采用了<strong>模块化设计</strong>, 提供了丰富模块的第三方模块.</p> <p>所以关于 Nginx, 有这些标签:  <strong>「异步」「事件」「模块化」「高性能」「高并发」「反向代理」「负载均衡」.</strong></p> <p>Linux系统: <code>Centos 7 x64</code>​</p> <p>Nginx版本: <code>1.11.5</code>​</p> <h4 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h4> <h5 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h5> <blockquote><p>prce(重定向支持)和openssl(https支持, 如果不需要https可以不安装. )</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> pcre-devel 
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc <span class="token function">make</span> gcc-c++ <span class="token function">wget</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> openssl openssl-devel 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>CentOS 6.5 我安装的时候是选择的 &quot;基本服务器&quot;, 默认这两个包都没安装全, 所以这两个都运行安装即可.</p> <h5 id="下载"><a href="#下载" class="header-anchor">#</a> 下载</h5> <p><a href="http://nginx.org/download/" target="_blank" rel="noopener noreferrer">nginx的所有版本在这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> http://nginx.org/download/nginx-1.13.3.tar.gz
<span class="token function">wget</span> http://nginx.org/download/nginx-1.13.7.tar.gz

<span class="token comment"># 如果没有安装wget</span>
<span class="token comment"># 下载已编译版本</span>
$ yum <span class="token function">install</span> <span class="token function">wget</span>

<span class="token comment"># 解压压缩包</span>
<span class="token function">tar</span> zxf nginx-1.13.3.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="编译安装"><a href="#编译安装" class="header-anchor">#</a> 编译安装</h5> <p>然后进入目录编译安装, configure 参数说明参考下面对应的部分.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> nginx-1.11.5
./configure

<span class="token punctuation">..</span><span class="token punctuation">..</span>
Configuration summary
  + using system PCRE library
  + OpenSSL library is not used
  + using system zlib library

  nginx path prefix: <span class="token string">&quot;/usr/local/nginx&quot;</span>
  nginx binary file: <span class="token string">&quot;/usr/local/nginx/sbin/nginx&quot;</span>
  nginx modules path: <span class="token string">&quot;/usr/local/nginx/modules&quot;</span>
  nginx configuration prefix: <span class="token string">&quot;/usr/local/nginx/conf&quot;</span>
  nginx configuration file: <span class="token string">&quot;/usr/local/nginx/conf/nginx.conf&quot;</span>
  nginx pid file: <span class="token string">&quot;/usr/local/nginx/logs/nginx.pid&quot;</span>
  nginx error log file: <span class="token string">&quot;/usr/local/nginx/logs/error.log&quot;</span>
  nginx http access log file: <span class="token string">&quot;/usr/local/nginx/logs/access.log&quot;</span>
  nginx http client request body temporary files: <span class="token string">&quot;client_body_temp&quot;</span>
  nginx http proxy temporary files: <span class="token string">&quot;proxy_temp&quot;</span>
  nginx http fastcgi temporary files: <span class="token string">&quot;fastcgi_temp&quot;</span>
  nginx http uwsgi temporary files: <span class="token string">&quot;uwsgi_temp&quot;</span>
  nginx http scgi temporary files: <span class="token string">&quot;scgi_temp&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>安装报错误的话比如: &quot;C compiler cc is not found&quot;, 这个就是缺少编译环境, 安装一下就可以了 **yum -y install gcc make gcc-c++ openssl-devel. **</p> <p>如果没有 error 信息, 就可以执行下边的安装了:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="nginx测试"><a href="#nginx测试" class="header-anchor">#</a> nginx测试</h5> <p>运行下面命令会出现两个结果, 一般情况 nginx 会安装在 <code>/usr/local/nginx</code>​ 目录中.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/nginx/sbin/
./nginx <span class="token parameter variable">-t</span>

<span class="token comment"># nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span>
<span class="token comment"># nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="设置全局nginx命令"><a href="#设置全局nginx命令" class="header-anchor">#</a> 设置全局nginx命令</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> ~/.bash_profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将下面内容添加到 <code>~/.bash_profile</code> 文件中</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/bin:/usr/local/nginx/sbin/
<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>运行命令 <strong>​<code>source ~/.bash_profile</code>​</strong>​ 让配置立即生效. 这样就可以全局运行 <code>nginx</code>​ 命令了.</p> <h5 id="mac安装"><a href="#mac安装" class="header-anchor">#</a> Mac安装</h5> <p>Mac OSX 安装特别简单, 首先需要安装 <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">Brew<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 通过 <code>brew</code>​ 快速安装 <code>nginx</code>​.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>brew <span class="token function">install</span> nginx
<span class="token comment"># Updating Homebrew...</span>
<span class="token comment"># &lt;mark&gt;&gt; Auto-updated Homebrew!</span>
<span class="token comment"># Updated 2 taps (homebrew/core, homebrew/cask).</span>
<span class="token comment"># &lt;/mark&gt;&gt; Updated Formulae</span>
<span class="token comment"># &lt;mark&gt;&gt; Installing dependencies for nginx: openssl, pcre</span>
<span class="token comment"># &lt;/mark&gt;&gt; Installing nginx dependency: openssl</span>
<span class="token comment"># &lt;mark&gt;&gt; Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ######################################################################## 100.0%</span>
<span class="token comment"># &lt;/mark&gt;&gt; Pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ==&gt; Caveats</span>
<span class="token comment"># A CA file has been bootstrapped using certificates from the SystemRoots</span>
<span class="token comment"># keychain. To add additional certificates (e.g. the certificates added in</span>
<span class="token comment"># the System keychain), place .pem files in</span>
<span class="token comment">#   /usr/local/etc/openssl/certs</span>
<span class="token comment"># </span>
<span class="token comment"># and run</span>
<span class="token comment">#   /usr/local/opt/openssl/bin/c_rehash</span>
<span class="token comment"># </span>
<span class="token comment"># This formula is keg-only, which means it was not symlinked into /usr/local,</span>
<span class="token comment"># because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.</span>
<span class="token comment"># </span>
<span class="token comment"># If you need to have this software first in your PATH run:</span>
<span class="token comment">#   echo 'export PATH=&quot;/usr/local/opt/openssl/bin:$PATH&quot;' &gt;&gt; ~/.zshrc</span>
<span class="token comment"># </span>
<span class="token comment"># For compilers to find this software you may need to set:</span>
<span class="token comment">#     LDFLAGS:  -L/usr/local/opt/openssl/lib</span>
<span class="token comment">#     CPPFLAGS: -I/usr/local/opt/openssl/include</span>
<span class="token comment"># For pkg-config to find this software you may need to set:</span>
<span class="token comment">#     PKG_CONFIG_PATH: /usr/local/opt/openssl/lib/pkgconfig</span>
<span class="token comment"># </span>
<span class="token comment"># &lt;mark&gt;&gt; Summary</span>
<span class="token comment"># 🍺  /usr/local/Cellar/openssl/1.0.2o_1: 1,791 files, 12.3MB</span>
<span class="token comment"># &lt;/mark&gt;&gt; Installing nginx dependency: pcre</span>
<span class="token comment"># &lt;mark&gt;&gt; Downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ######################################################################## 100.0%</span>
<span class="token comment"># &lt;/mark&gt;&gt; Pouring pcre-8.42.high_sierra.bottle.tar.gz</span>
<span class="token comment"># 🍺  /usr/local/Cellar/pcre/8.42: 204 files, 5.3MB</span>
<span class="token comment"># &lt;mark&gt;&gt; Installing nginx</span>
<span class="token comment"># &lt;/mark&gt;&gt; Downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ######################################################################## 100.0%</span>
<span class="token comment"># &lt;mark&gt;&gt; Pouring nginx-1.13.12.high_sierra.bottle.tar.gz</span>
<span class="token comment"># &lt;/mark&gt;&gt; Caveats</span>
<span class="token comment"># Docroot is: /usr/local/var/www</span>
<span class="token comment"># </span>
<span class="token comment"># The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</span>
<span class="token comment"># nginx can run without sudo.</span>
<span class="token comment"># </span>
<span class="token comment"># nginx will load all files in /usr/local/etc/nginx/servers/.</span>
<span class="token comment"># </span>
<span class="token comment"># To have launchd start nginx now and restart at login:</span>
<span class="token comment">#   brew services start nginx</span>
<span class="token comment"># Or, if you don't wacd /usr/local/Cellar/nginx/1.13.12/n just run:</span>
<span class="token comment"># cd /usr/local/Cellar/nginx/1.13.12/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><blockquote><p>启动服务</p></blockquote> <p>注意默认端口不是 <code>8080</code> 查看确认端口是否被占用.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>brew services start nginx
<span class="token comment"># http://localhost:8080/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="运维"><a href="#运维" class="header-anchor">#</a> 运维</h4> <h5 id="开机自启动"><a href="#开机自启动" class="header-anchor">#</a> 开机自启动</h5> <p>**开机自启动方法一: **</p> <p>编辑 <strong>vi /lib/systemd/system/nginx.service</strong> 文件, 没有创建一个 <strong>touch nginx.service</strong> 然后将如下内容根据具体情况进行修改后, 添加到 nginx.service 文件中:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>nginx
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target remote-fs.target nss-lookup.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>

<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/var/run/nginx.pid
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-t</span> <span class="token parameter variable">-c</span> /usr/local/nginx/conf/nginx.conf
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-c</span> /usr/local/nginx/conf/nginx.conf
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-s</span> HUP <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-s</span> QUIT <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>​<code>[Unit]</code>​: 服务的说明</li> <li>​<code>Description</code>​: 描述服务</li> <li>​<code>After</code>​: 描述服务类别</li> <li>​<code>[Service]</code>​: 服务运行参数的设置</li> <li>​<code>Type=forking</code>​: 是后台运行的形式</li> <li>​<code>ExecStart</code>​: 为服务的具体运行命令</li> <li>​<code>ExecReload</code>​: 为重启命令</li> <li>​<code>ExecStop</code>​: 为停止命令</li> <li>​<code>PrivateTmp=True</code>​: 表示给服务分配独立的临时空间</li></ul> <p>注意: <code>[Service]</code>​ 的启动, 重启, 停止命令全部要求使用绝对路径.</p> <p>​<code>[Install]</code>​ 运行级别下服务安装的相关设置, 可设置为多用户, 即系统运行级别为 <code>3</code>​.</p> <p>保存退出.</p> <p>设置<strong>开机启动, 使配置生效</strong>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 启动nginx服务</span>
systemctl start nginx.service
<span class="token comment"># 停止开机自启动</span>
systemctl disable nginx.service
<span class="token comment"># 查看服务当前状态</span>
systemctl status nginx.service
<span class="token comment"># 查看所有已启动的服务</span>
systemctl list-units <span class="token parameter variable">--type</span><span class="token operator">=</span>service
<span class="token comment"># 重新启动服务</span>
systemctl restart nginx.service
<span class="token comment"># 设置开机自启动</span>
systemctl <span class="token builtin class-name">enable</span> nginx.service
<span class="token comment"># 输出下面内容表示成功了</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl is-enabled servicename.service <span class="token comment"># 查询服务是否开机启动</span>
systemctl <span class="token builtin class-name">enable</span> *.service  <span class="token comment"># 开机运行服务</span>
systemctl disable *.service <span class="token comment"># 取消开机运行</span>
systemctl start *.service   <span class="token comment"># 启动服务</span>
systemctl stop *.service    <span class="token comment"># 停止服务</span>
systemctl restart *.service <span class="token comment"># 重启服务</span>
systemctl reload *.service  <span class="token comment"># 重新加载服务配置文件</span>
systemctl status *.service  <span class="token comment"># 查询服务运行状态</span>
systemctl <span class="token parameter variable">--failed</span> <span class="token comment"># 显示启动失败的服务</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注: * 代表某个服务的名字, 如 http 的服务名为 httpd.</p> <p>**开机自启动方法二: **</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> /etc/rc.local

<span class="token comment"># 在 rc.local 文件中, 添加下面这条命令</span>
/usr/local/nginx/sbin/nginx start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果开机后发现自启动脚本没有执行, 要去确认一下 rc.local 这个文件的访问权限是否是可执行的, 因为 rc.local 默认是不可执行的. 修改 rc.local 访问权限, 增加可执行权限:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># /etc/rc.local是/etc/rc.d/rc.local的软连接, </span>
<span class="token function">chmod</span> +x /etc/rc.d/rc.local
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>官方脚本 <a href="https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/" target="_blank" rel="noopener noreferrer">ed Hat NGINX Init Script<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h5 id="服务管理"><a href="#服务管理" class="header-anchor">#</a> 服务管理</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 启动</span>
/usr/local/nginx/sbin/nginx
<span class="token comment"># 重启</span>
/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> reload
<span class="token comment"># 关闭进程</span>
/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> stop
<span class="token comment"># 平滑关闭nginx</span>
/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> quit
<span class="token comment"># 查看nginx的安装状态, </span>
/usr/local/nginx/sbin/nginx <span class="token parameter variable">-V</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>关闭防火墙, 或者添加防火墙规则就可以测试了.</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">service</span> iptables stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者编辑配置文件:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> /etc/sysconfig/iptables
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加这样一条<strong>开放 80 端口的规则</strong>后保存:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> NEW <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重启服务即可:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">service</span> iptables restart
<span class="token comment"># 命令进行查看目前nat</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-L</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="重启服务防火墙报错解决"><a href="#重启服务防火墙报错解决" class="header-anchor">#</a> 重启服务防火墙报错解决</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">service</span> iptables restart
<span class="token comment"># Redirecting to /bin/systemctl restart  iptables.service</span>
<span class="token comment"># Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在 CentOS 7 或 RHEL 7 或 Fedora 中防火墙由 <strong>firewalld</strong> 来管理, 当然可以还原传统的管理方式. 或则使用新的命令进行管理.</p> <p>假如采用传统请执行一下命令:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 传统命令</span>
systemctl stop firewalld
systemctl mask firewalld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 安装命令</span>
yum <span class="token function">install</span> iptables-services

systemctl <span class="token builtin class-name">enable</span> iptables 
<span class="token function">service</span> iptables restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="nginx卸载"><a href="#nginx卸载" class="header-anchor">#</a> nginx卸载</h5> <p>如果通过 yum 安装, 使用下面命令安装.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>yum remove nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>编译安装, 删除 <code>/usr/local/nginx</code>​ 目录即可.</p> <p>如果配置了自启动脚本, 也需要删除.</p> <h5 id="安装第三方模块"><a href="#安装第三方模块" class="header-anchor">#</a> 安装第三方模块</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>./configure --prefix=/你的安装目录  --add-module=/第三方模块目录
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h4> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>--prefix=<code>&lt;path&gt;</code>​</td> <td>Nginx 安装路径. 如果没有指定, 默认为 <code>/usr/local/nginx</code>​.</td></tr> <tr><td>--sbin-path=<code>&lt;path&gt;</code>​</td> <td>Nginx 可执行文件安装路径. 只能安装时指定, 如果没有指定, 默认为 <code>&lt;prefix&gt;</code>​/sbin/nginx.</td></tr> <tr><td>--conf-path=<code>&lt;path&gt;</code>​</td> <td>在没有给定 -c 选项下默认的 <strong>nginx.conf</strong> 的路径. 如果没有指定, 默认为 <code>&lt;prefix&gt;</code>​/conf/nginx.conf.</td></tr> <tr><td>--pid-path=<code>&lt;path&gt;</code>​</td> <td>在 nginx.conf 中没有指定 pid 指令的情况下, 默认的 nginx.pid 的路径. 如果没有指定, 默认为 <code>&lt;prefix&gt;</code>​/logs/nginx.pid.</td></tr> <tr><td>--lock-path=<code>&lt;path&gt;</code>​</td> <td>nginx.lock 文件的路径.</td></tr> <tr><td>--error-log-path=<code>&lt;path&gt;</code>​</td> <td>在 nginx.conf 中没有指定 error_log 指令的情况下, 默认的错误日志的路径. 如果没有指定, 默认为 <code>&lt;prefix&gt;</code>​/- logs/error.log.</td></tr> <tr><td>--http-log-path=<code>&lt;path&gt;</code>​</td> <td>在 nginx.conf 中没有指定 access_log 指令的情况下, 默认的访问日志的路径. 如果没有指定, 默认为 <code>&lt;prefix&gt;</code>​/- logs/access.log.</td></tr> <tr><td>--user=<code>&lt;user&gt;</code>​</td> <td>在 nginx.conf 中没有指定 user 指令的情况下, 默认的 nginx 使用的用户. 如果没有指定, 默认为 nobody.</td></tr> <tr><td>--group=<code>&lt;group&gt;</code>​</td> <td>在 nginx.conf 中没有指定 user 指令的情况下, 默认的 nginx 使用的组. 如果没有指定, 默认为 nobody.</td></tr> <tr><td>--builddir=DIR</td> <td>指定编译的目录</td></tr> <tr><td>--with-rtsig_module</td> <td>启用 rtsig 模块</td></tr> <tr><td>--with-select_module --without-select_module</td> <td>允许或不允许开启 SELECT 模式, 如果 configure 没有找到更合适的模式, 比如: kqueue(sun os), epoll (linux kenel 2.6+), rtsig(- 实时信号)或者 /dev/poll(一种类似 select 的模式, 底层实现与 SELECT 基本相同, 都是采用轮训方法) SELECT 模式将是默认安装模式</td></tr> <tr><td>--with-poll_module --without-poll_module</td> <td>Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or /dev/poll is not discovered by configure.</td></tr> <tr><td>--with-http_ssl_module</td> <td>Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. <strong>开启 HTTP SSL 模块, 使 NGINX 可以支持 HTTPS 请求</strong>. 这个模块需要已经安装了 <strong>OPENSSL</strong>, 在 DEBIAN 上是libssl</td></tr> <tr><td>--with-http_realip_module</td> <td>启用 ngx_http_realip_module</td></tr> <tr><td>--with-http_addition_module</td> <td>启用 ngx_http_addition_module</td></tr> <tr><td>--with-http_sub_module</td> <td>启用 ngx_http_sub_module</td></tr> <tr><td>--with-http_dav_module</td> <td>启用 ngx_http_dav_module</td></tr> <tr><td>--with-http_flv_module</td> <td>启用 ngx_http_flv_module</td></tr> <tr><td>--with-http_stub_status_module</td> <td>启用 &quot;server status&quot; 页</td></tr> <tr><td>--without-http_charset_module</td> <td>禁用 ngx_http_charset_module</td></tr> <tr><td>--without-http_gzip_module</td> <td>禁用 ngx_http_gzip_module. 如果启用, 需要 zlib.</td></tr> <tr><td>--without-http_ssi_module</td> <td>禁用 ngx_http_ssi_module</td></tr> <tr><td>--without-http_userid_module</td> <td>禁用 ngx_http_userid_module</td></tr> <tr><td>--without-http_access_module</td> <td>禁用 ngx_http_access_module</td></tr> <tr><td>--without-http_auth_basic_module</td> <td>禁用 ngx_http_auth_basic_module</td></tr> <tr><td>--without-http_autoindex_module</td> <td>禁用 ngx_http_autoindex_module</td></tr> <tr><td>--without-http_geo_module</td> <td>禁用 ngx_http_geo_module</td></tr> <tr><td>--without-http_map_module</td> <td>禁用 ngx_http_map_module</td></tr> <tr><td>--without-http_referer_module</td> <td>禁用 ngx_http_referer_module</td></tr> <tr><td>--without-http_rewrite_module</td> <td>禁用 ngx_http_rewrite_module. 如果启用需要 PCRE.</td></tr> <tr><td>--without-http_proxy_module</td> <td>禁用 ngx_http_proxy_module</td></tr> <tr><td>--without-http_fastcgi_module</td> <td>禁用 ngx_http_fastcgi_module</td></tr> <tr><td>--without-http_memcached_module</td> <td>禁用 ngx_http_memcached_module</td></tr> <tr><td>--without-http_limit_zone_module</td> <td>禁用 ngx_http_limit_zone_module</td></tr> <tr><td>--without-http_empty_gif_module</td> <td>禁用 ngx_http_empty_gif_module</td></tr> <tr><td>--without-http_browser_module</td> <td>禁用 ngx_http_browser_module</td></tr> <tr><td>--without-http_upstream_ip_hash_module</td> <td>禁用 ngx_http_upstream_ip_hash_module</td></tr> <tr><td>--with-http_perl_module</td> <td>启用 ngx_http_perl_module</td></tr> <tr><td>--with-perl_modules_path=PATH</td> <td>指定 perl 模块的路径</td></tr> <tr><td>--with-perl=PATH</td> <td>指定 perl 执行文件的路径</td></tr> <tr><td>--http-log-path=PATH</td> <td>Set path to the http access log</td></tr> <tr><td>--http-client-body-temp-path=PATH</td> <td>Set path to the http client request body temporary files</td></tr> <tr><td>--http-proxy-temp-path=PATH</td> <td>Set path to the http proxy temporary files</td></tr> <tr><td>--http-fastcgi-temp-path=PATH</td> <td>Set path to the http fastcgi temporary files</td></tr> <tr><td>--without-http</td> <td>禁用 HTTP server</td></tr> <tr><td>--with-mail</td> <td>启用 IMAP4/POP3/SMTP 代理模块</td></tr> <tr><td>--with-mail_ssl_module</td> <td>启用 ngx_mail_ssl_module</td></tr> <tr><td>--with-cc=PATH</td> <td>指定 C 编译器的路径</td></tr> <tr><td>--with-cpp=PATH</td> <td>指定 C 预处理器的路径</td></tr> <tr><td>--with-cc-opt=OPTIONS</td> <td>Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate --with-cc-opt=&quot;-I /usr/local/include&quot;. If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: --with-cc-opt=&quot;-D FD_SETSIZE=2048&quot;.</td></tr> <tr><td>--with-ld-opt=OPTIONS</td> <td>Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate --with-ld-opt=&quot;-L /usr/local/lib&quot;.</td></tr> <tr><td>--with-cpu-opt=CPU</td> <td>为特定的 CPU 编译, 有效的值包括: pentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64</td></tr> <tr><td>--without-pcre</td> <td>禁止 PCRE 库的使用. 同时也会禁止 HTTP rewrite 模块. 在 &quot;location&quot; 配置指令中的正则表达式也需要 PCRE.</td></tr> <tr><td>--with-pcre=DIR</td> <td>指定 PCRE 库的源代码的路径.</td></tr> <tr><td>--with-pcre-opt=OPTIONS</td> <td>Set additional options for PCRE building.</td></tr> <tr><td>--with-md5=DIR</td> <td>Set path to md5 library sources.</td></tr> <tr><td>--with-md5-opt=OPTIONS</td> <td>Set additional options for md5 building.</td></tr> <tr><td>--with-md5-asm</td> <td>Use md5 assembler sources.</td></tr> <tr><td>--with-sha1=DIR</td> <td>Set path to sha1 library sources.</td></tr> <tr><td>--with-sha1-opt=OPTIONS</td> <td>Set additional options for sha1 building.</td></tr> <tr><td>--with-sha1-asm</td> <td>Use sha1 assembler sources.</td></tr> <tr><td>--with-zlib=DIR</td> <td>Set path to zlib library sources.</td></tr> <tr><td>--with-zlib-opt=OPTIONS</td> <td>Set additional options for zlib building.</td></tr> <tr><td>--with-zlib-asm=CPU</td> <td>Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro</td></tr> <tr><td>--with-openssl=DIR</td> <td>Set path to OpenSSL library sources</td></tr> <tr><td>--with-openssl-opt=OPTIONS</td> <td>Set additional options for OpenSSL building</td></tr> <tr><td>--with-debug</td> <td>启用调试日志</td></tr> <tr><td>--add-module=PATH</td> <td>Add in a third-party module found in directory PATH</td></tr></tbody></table> <h4 id="nginx配置"><a href="#nginx配置" class="header-anchor">#</a> Nginx配置</h4> <p>在 Centos 默认配置文件在  <strong>/usr/local/nginx-1.5.1/conf/nginx.conf.</strong>  要在这里配置一些文件. <strong>nginx.conf 是主配置文件</strong>, 由若干个部分组成, 每个大括号 <code>{}</code>​ 表示一个部分. 每一行指令都由分号结束 <code>;</code>​, 标志着一行的结束.</p> <h5 id="常用正则"><a href="#常用正则" class="header-anchor">#</a> 常用正则</h5> <table><thead><tr><th style="text-align:center;">正则</th> <th>说明</th> <th style="text-align:center;">正则</th> <th>说明</th></tr></thead> <tbody><tr><td style="text-align:center;">​<code>.</code>​</td> <td>匹配除换行符以外的任意字符</td> <td style="text-align:center;">​<code>$</code>​</td> <td>匹配字符串的结束</td></tr> <tr><td style="text-align:center;">​<code>?</code>​</td> <td>重复 0 次或 1 次</td> <td style="text-align:center;">​<code>{n}</code>​</td> <td>重复 n 次</td></tr> <tr><td style="text-align:center;">​<code>+</code>​</td> <td>重复 1 次或更多次</td> <td style="text-align:center;">​<code>{n,}</code>​</td> <td>重复 n 次或更多次</td></tr> <tr><td style="text-align:center;">​<code>*</code>​</td> <td>重复 0 次或更多次</td> <td style="text-align:center;">​<code>[c]</code>​</td> <td>匹配单个字符 c</td></tr> <tr><td style="text-align:center;">​<code>\d</code>​</td> <td>匹配数字</td> <td style="text-align:center;">​<code>[a-z]</code>​</td> <td>匹配 a-z 小写字母的任意一个</td></tr> <tr><td style="text-align:center;">​<code>^</code>​</td> <td>匹配字符串的开始</td> <td style="text-align:center;">-</td> <td>-</td></tr></tbody></table> <h5 id="全局变量"><a href="#全局变量" class="header-anchor">#</a> 全局变量</h5> <table><thead><tr><th>变量</th> <th>说明</th></tr></thead> <tbody><tr><td>​<code>$args</code>​</td> <td>这个变量等于请求行中的参数, 同 <code>$query_string</code>​</td></tr> <tr><td>​ <strong>​<code>$content_length</code>​</strong>​</td> <td>请求头中的 Content-length 字段.</td></tr> <tr><td>​<code>$content_type</code>​</td> <td>请求头中的 Content-Type 字段.</td></tr> <tr><td>​<code>$document_root</code>​</td> <td>当前请求在 root 指令中指定的值.</td></tr> <tr><td>​<code>$host</code>​</td> <td>请求主机头字段, 否则为服务器名称.</td></tr> <tr><td>​<code>$http_user_agent</code>​</td> <td>客户端 agent 信息</td></tr> <tr><td>​<code>$http_cookie</code>​</td> <td>客户端 cookie 信息</td></tr> <tr><td>​<code>$limit_rate</code>​</td> <td>这个变量可以限制连接速率.</td></tr> <tr><td>​<code>$request_method</code>​</td> <td>客户端请求的动作, 通常为 GET 或 POST.</td></tr> <tr><td>​<code>$remote_addr</code>​</td> <td>客户端的 IP 地址.</td></tr> <tr><td>​<code>$document_uri</code>​</td> <td>与 $uri 相同.</td></tr> <tr><td>​<code>$remote_port</code>​</td> <td>客户端的端口.</td></tr> <tr><td>​<code>$remote_user</code>​</td> <td>已经经过 Auth Basic Module 验证的用户名.</td></tr> <tr><td>​<code>$request_filename</code>​</td> <td>当前请求的文件路径, 由 root 或 alias 指令与 URI 请求生成.</td></tr> <tr><td>​<code>$scheme</code>​</td> <td>HTTP 方法(如 http, https).</td></tr> <tr><td>​<code>$server_protocol</code>​</td> <td>请求使用的协议, 通常是 HTTP/1.0 或 HTTP/1.1.</td></tr> <tr><td>​<code>$server_addr</code>​</td> <td>服务器地址, 在完成一次系统调用后可以确定这个值.</td></tr> <tr><td>​<code>$server_name</code>​</td> <td>服务器名称.</td></tr> <tr><td>​<code>$server_port</code>​</td> <td>请求到达服务器的端口号.</td></tr> <tr><td>​<code>$request_uri</code>​</td> <td>包含请求参数的原始 URI, 不包含主机名, 如: <code>/foo/bar.php?arg=baz</code>​.</td></tr> <tr><td>​<code>$uri</code>​</td> <td>不带请求参数的当前 URI, $uri 不包含主机名, 如 <code>/foo/bar.html</code>​.</td></tr></tbody></table> <p>例如请求: <code>http://localhost:3000/test1/test2/test.php</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$host: localhost
$server_port: 3000
$request_uri: /test1/test2/test.php
$document_uri: /test1/test2/test.php
$document_root: /var/www/html
$request_filename: /var/www/html/test1/test2/test.php
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="符号参考"><a href="#符号参考" class="header-anchor">#</a> 符号参考</h5> <table><thead><tr><th style="text-align:center;">符号</th> <th style="text-align:center;">说明</th> <th style="text-align:center;">符号</th> <th style="text-align:center;">说明</th> <th style="text-align:center;">符号</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">k,K</td> <td style="text-align:center;">千字节</td> <td style="text-align:center;">m,M</td> <td style="text-align:center;">兆字节</td> <td style="text-align:center;">ms</td> <td style="text-align:center;">毫秒</td></tr> <tr><td style="text-align:center;">s</td> <td style="text-align:center;">秒</td> <td style="text-align:center;">m</td> <td style="text-align:center;">分钟</td> <td style="text-align:center;">h</td> <td style="text-align:center;">小时</td></tr> <tr><td style="text-align:center;">d</td> <td style="text-align:center;">日</td> <td style="text-align:center;">w</td> <td style="text-align:center;">周</td> <td style="text-align:center;">M</td> <td style="text-align:center;">一个月, 30天</td></tr></tbody></table> <p>例如, &quot;8k&quot;, &quot;1m&quot; 代表<strong>字节数计量</strong>.
例如, &quot;1h 30m&quot;, &quot;1y 6M&quot;. 代表 &quot;1 小时 30 分&quot;, &quot;1 年零 6 个月&quot;.</p> <h5 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h5> <p><strong>nginx 的配置系统由一个主配置文件和其他一些辅助的配置文件构成. 这些配置文件均是纯文本文件, 全部位于 nginx 安装目录下的 conf 目录下</strong>.</p> <p>指令由 nginx 的各个模块提供, 不同的模块会提供不同的指令来实现配置. 指令除了 Key-Value 的形式, 还有作用域指令.</p> <p>nginx.conf 中的配置信息, 根据其逻辑上的意义, 对它们进行了<strong>分类</strong>, 也就是分成了<strong>多个作用域</strong>, 或者称之为配置指令上下文. 不同的作用域含有一个或者多个配置项.</p> <p>下面的这些上下文指令是用的比较多:</p> <table><thead><tr><th style="text-align:center;">Directive</th> <th>Description</th> <th>Contains Directive</th></tr></thead> <tbody><tr><td style="text-align:center;">main</td> <td>nginx 在<strong>运行时与具体业务功能(比如 http 服务或者 email 服务代理)无关</strong>的一些参数, 比如工作进程数, 运行的身份等.</td> <td>user, worker_processes, error_log, events, http, mail</td></tr> <tr><td style="text-align:center;">http</td> <td>与<mark><strong>提供 http 服务相关的一些配置参数</strong></mark>. 例如: 是否使用 keepalive, 是否使用 gzip 进行压缩等.</td> <td>server</td></tr> <tr><td style="text-align:center;">server</td> <td><mark><strong>http 服务上支持若干虚拟主机. 每个虚拟主机一个对应的 server 配置项, 配置项里面包含该虚拟主机相关的配置</strong></mark>. 在提供 mail 服务的代理时, 也可以建立若干 server. 每个 server 通过监听的地址来区分.</td> <td>listen, server_name, access_log, location, protocol, proxy, smtp_auth, xclient</td></tr> <tr><td style="text-align:center;">location</td> <td><mark>**http 服务中, 某些特定的 URL 对应的一系列配置项. **</mark></td> <td>index, root</td></tr> <tr><td style="text-align:center;">mail</td> <td>实现 email 相关的 SMTP/IMAP/POP3 代理时, 共享的一些配置项(因为可能实现多个代理, 工作在多个监听地址上).</td> <td>server, http, imap_capabilities</td></tr> <tr><td style="text-align:center;">include</td> <td>以便增强配置文件的可读性, <strong>使得部分配置文件可以重新使用</strong>.</td> <td>-</td></tr> <tr><td style="text-align:center;">valid_referers</td> <td>用来校验 Http 请求头 Referer 是否有效.</td> <td>-</td></tr> <tr><td style="text-align:center;">try_files</td> <td>用在 server 部分, 不过最常见的还是用在 location 部分, 它会按照给定的参数顺序进行尝试, 第一个被匹配到的将会被使用.</td> <td>-</td></tr> <tr><td style="text-align:center;">if</td> <td>当在 location 块中使用 if 指令, 在某些情况下它并不按照预期运行, 一般来说<strong>避免使用 if 指令</strong>.</td> <td>-</td></tr></tbody></table> <p>例如在 <strong>nginx.conf</strong> 里面引用两个配置 <code>vhost/example.com.conf</code>​ 和 <code>vhost/gitlab.com.conf</code>​ 它们都被放在一个自己新建的目录 vhost 下面. nginx.conf 配置如下:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">1</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token comment">#log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '</span>
    <span class="token comment">#                  '$status $body_bytes_sent &quot;$http_referer&quot; '</span>
    <span class="token comment">#                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';</span>

    <span class="token comment">#access_log  logs/access.log  main;</span>

    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token comment"># 监听80端口</span>
        <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">include</span>  vhost/example.com.conf</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span>  vhost/gitlab.com.conf</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>简单的配置: example.com.conf</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 侦听的80端口</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  baidu.com app.baidu.com</span><span class="token punctuation">;</span> <span class="token comment"># 这里指定域名</span>
    <span class="token directive"><span class="token keyword">index</span>        index.html index.htm</span><span class="token punctuation">;</span>    <span class="token comment"># 这里指定默认入口页面</span>
    <span class="token directive"><span class="token keyword">root</span> /home/www/app.baidu.com</span><span class="token punctuation">;</span>         <span class="token comment"># 这里指定目录</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="内置预定义变量"><a href="#内置预定义变量" class="header-anchor">#</a> 内置预定义变量</h5> <p>Nginx 提供了许多预定义的变量, 也可以通过使用 set 来设置变量. 可以在 if 中使用预定义变量, 也可以<strong>将它们传递给代理服务器</strong>. 以下是一些常见的预定义变量, <a href="http://nginx.org/en/docs/varindex.html" target="_blank" rel="noopener noreferrer">更多详见<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <table><thead><tr><th>变量名称</th> <th>值</th></tr></thead> <tbody><tr><td>$args_name</td> <td>在请求中的 name 参数</td></tr> <tr><td>$args</td> <td>所有请求参数</td></tr> <tr><td>$query_string</td> <td>$args 的别名</td></tr> <tr><td>$content_length</td> <td>请求头 Content-Length 的值</td></tr> <tr><td>$content_type</td> <td>请求头 Content-Type 的值</td></tr> <tr><td>$host</td> <td>如果当前有 Host, 则为请求头 Host 的值; 如果没有这个头, 那么该值等于匹配该请求的 server_name 的值</td></tr> <tr><td>$remote_addr</td> <td>客户端的 IP 地址</td></tr> <tr><td>$request</td> <td>完整的请求, 从客户端收到, 包括 Http 请求方法, URI, Http 协议, 头, 请求体</td></tr> <tr><td>$request_uri</td> <td>完整请求的 URI, 从客户端来的请求, 包括参数</td></tr> <tr><td>$scheme</td> <td>当前请求的协议</td></tr> <tr><td>$uri</td> <td>当前请求的标准化 URI</td></tr></tbody></table> <h5 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h5> <p>反向代理是一个 Web 服务器, 它<mark><strong>接受客户端的连接请求, 然后将请求转发给上游服务器, 并将从服务器得到的结果返回给连接的客户端</strong></mark>. 下面简单的反向代理的例子:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>  
  <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>                                                        
  <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>                                              
  <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">1024M</span></span><span class="token punctuation">;</span>  <span class="token comment"># 允许客户端请求的最大单文件字节数</span>

  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span>                         http://localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host              <span class="token variable">$host</span>:<span class="token variable">$server_port</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For   <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span> <span class="token comment"># HTTP的请求端真实的IP</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>      <span class="token comment"># 为了正确地识别实际用户发出的协议是 http 还是 https</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>复杂的配置: gitlab.com.conf.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 侦听的80端口</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  git.example.cn</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span>   http://localhost:3000</span><span class="token punctuation">;</span>
        <span class="token comment"># 以下是一些反向代理的配置可删除</span>
        <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">client_max_body_size</span>       <span class="token number">10m</span></span><span class="token punctuation">;</span> <span class="token comment"># 允许客户端请求的最大单文件字节数</span>
        <span class="token directive"><span class="token keyword">client_body_buffer_size</span>    <span class="token number">128k</span></span><span class="token punctuation">;</span> <span class="token comment"># 缓冲区代理缓冲用户端请求的最大字节数</span>
        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span>      <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment"># nginx跟后端服务器连接超时时间(代理连接超时)</span>
        <span class="token directive"><span class="token keyword">proxy_send_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment"># 后端服务器数据回传时间(代理发送超时)</span>
        <span class="token directive"><span class="token keyword">proxy_read_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment"># 连接成功后, 后端服务器响应时间(代理接收超时)</span>
        <span class="token directive"><span class="token keyword">proxy_buffer_size</span>          <span class="token number">4k</span></span><span class="token punctuation">;</span> <span class="token comment"># 设置代理服务器(nginx)保存用户头信息的缓冲区大小</span>
        <span class="token directive"><span class="token keyword">proxy_buffers</span>              <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span> <span class="token comment"># proxy_buffers缓冲区, 网页平均在32k以下的话, 这样设置</span>
        <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span>    <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment"># 高负荷下缓冲大小(proxy_buffers*2)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>代理到上游服务器的配置中, 最重要的是 proxy_pass 指令</strong>. 以下是代理模块中的一些常用指令:</p> <table><thead><tr><th>指令</th> <th>说明</th></tr></thead> <tbody><tr><td><mark><strong>proxy_connect_timeout</strong></mark></td> <td><strong>Nginx 从接受请求至连接到上游服务器的最长等待时间</strong></td></tr> <tr><td><mark><strong>proxy_send_timeout</strong></mark></td> <td><strong>后端服务器数据回传时间(代理发送超时)</strong></td></tr> <tr><td><mark><strong>proxy_read_timeout</strong></mark></td> <td><strong>连接成功后, 后端服务器响应时间(代理接收超时)</strong></td></tr> <tr><td>proxy_cookie_domain</td> <td>替代从上游服务器来的 Set-Cookie 头的 domain 属性</td></tr> <tr><td>proxy_cookie_path</td> <td>替代从上游服务器来的 Set-Cookie 头的 path 属性</td></tr> <tr><td>proxy_buffer_size</td> <td>设置代理服务器(nginx)保存用户头信息的缓冲区大小</td></tr> <tr><td>proxy_buffers</td> <td>proxy_buffers 缓冲区, 网页平均在多少 k 以下</td></tr> <tr><td>proxy_set_header</td> <td>重写发送到上游服务器头的内容, 也可以通过将某个头部的值设置为空字符串, 而不发送某个头部的方法实现</td></tr> <tr><td>proxy_ignore_headers</td> <td>这个指令禁止处理来自代理服务器的应答.</td></tr> <tr><td>proxy_intercept_errors</td> <td>使 nginx 阻止 HTTP 应答代码为 400 或者更高的应答.</td></tr></tbody></table> <h5 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h5> <p><mark><strong>upstream 指令启用一个新的配置区段, 在该区段定义一组上游服务器</strong></mark>. 这些服务器可能被设置不同的权重, 也可能出于对服务器进行维护, 标记为 down.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> gitlab</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
    <span class="token comment"># upstream的负载均衡, weight是权重, 可以根据机器配置定义权重. </span>
    <span class="token comment"># weigth参数表示权值, 权值越高被分配到的几率越大. </span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.122.11:8081</span> <span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:82 weight=3</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:83 weight=3 down</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:84 weight=3</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">max_fails=3</span>  fail_timeout=20s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:85 weight=4</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 侦听的80端口</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  git.example.cn</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span>   http://gitlab</span><span class="token punctuation">;</span>    <span class="token comment"># 在这里设置一个代理, 和upstream的名字一样</span>
        <span class="token comment"># 以下是一些反向代理的配置可删除</span>
        <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token comment"># 后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">client_max_body_size</span>       <span class="token number">10m</span></span><span class="token punctuation">;</span>  <span class="token comment">#允许客户端请求的最大单文件字节数</span>
        <span class="token directive"><span class="token keyword">client_body_buffer_size</span>    <span class="token number">128k</span></span><span class="token punctuation">;</span> <span class="token comment">#缓冲区代理缓冲用户端请求的最大字节数</span>
        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span>      <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#nginx跟后端服务器连接超时时间(代理连接超时)</span>
        <span class="token directive"><span class="token keyword">proxy_send_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#后端服务器数据回传时间(代理发送超时)</span>
        <span class="token directive"><span class="token keyword">proxy_read_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#连接成功后, 后端服务器响应时间(代理接收超时)</span>
        <span class="token directive"><span class="token keyword">proxy_buffer_size</span>          <span class="token number">4k</span></span><span class="token punctuation">;</span> <span class="token comment">#设置代理服务器(nginx)保存用户头信息的缓冲区大小</span>
        <span class="token directive"><span class="token keyword">proxy_buffers</span>              <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span><span class="token comment"># 缓冲区, 网页平均在32k以下的话, 这样设置</span>
        <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span>    <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment">#高负荷下缓冲大小(proxy_buffers*2)</span>
        <span class="token directive"><span class="token keyword">proxy_temp_file_write_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment">#设定缓存文件夹大小, 大于这个值, 将从upstream服务器传</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>每个请求按时间顺序逐一分配到不同的后端服务器, 如果后端服务器 down 掉, 能自动剔除.</p> <p>**负载均衡: **</p> <p>upstream 模块能够使用 3 种负载均衡算法: <strong>轮询, IP哈希, 最少连接数</strong>.</p> <ul><li>**轮询(RR): ** 默认情况下使用轮询算法, 不需要配置指令来激活它, 它是基于在队列中谁是下一个的原理确保访问均匀地分布到每个上游服务器;</li> <li>**IP哈希: **  通过 ip_hash 指令来激活, Nginx 通过 IPv4 地址的前 3 个字节或者整个 IPv6 地址作为哈希键来实现, 同一个 IP 地址总是能被映射到同一个上游服务器;</li> <li><strong>最少连接数: **  通过 least_conn 指令来激活, 该算法</strong>通过选择一个活跃数最少的上游服务器进行连接**. 如果上游服务器处理能力不同, 可以通过给 server 配置 weight 权重来说明, 该算法将考虑到不同服务器的加权最少连接数.</li></ul> <h6 id="轮询-rr"><a href="#轮询-rr" class="header-anchor">#</a> 轮询(RR)</h6> <p><strong>简单配置</strong>, 这里配置了 2 台服务器, 当然实际上是一台, 只是端口不一样而已, 而 8081 的服务器是不存在的, 也就是说访问不到, 但是访问 <code>http://localhost</code>​ 的时候, 也不会有问题, 会默认跳转到 <code>http://localhost:8080</code>​ 具体是因为 Nginx 会自动判断服务器的状态, 如果服务器处于不能访问(服务器挂了), 就不会跳转到这台服务器, 所以也避免了一台服务器挂了影响使用的情况, 由于 <strong>Nginx 默认是 RR 策略</strong>, 所以不需要其他更多的设置.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">81</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">1024M</span></span><span class="token punctuation">;</span>
 
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://test</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span>:<span class="token variable">$server_port</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>负载均衡的核心代码为:</strong></p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h6 id="权重"><a href="#权重" class="header-anchor">#</a> 权重</h6> <p>指定轮询几率, <strong>weight 和访问比率成正比, 用于后端服务器性能不均</strong>的情况. 例如:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080 weight=9</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081 weight=1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>那么 10 次一般只会有 1 次会访问到 8081, 而有 9 次会访问到 8080.</p> <h6 id="ip-hash"><a href="#ip-hash" class="header-anchor">#</a> ip_hash</h6> <p>上面的 2 种方式都有一个问题, 那就是下一个请求来的时候请求可能分发到另外一个服务器, 当程序不是无状态的时候(采用了 session 保存数据), 这时候就有一个很大的很问题了, 比如把登录信息保存到了 session 中, 那么跳转到另外一台服务器的时候就需要重新登录了, 所以很多时候需要一个客户只访问一个服务器, 那么就需要用 iphash 了, <strong>iphash 的每个请求按访问 ip 的 hash 结果分配, 这样每个访客固定访问一个后端服务器, 可以解决 session 的问题</strong>.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h6 id="fair"><a href="#fair" class="header-anchor">#</a> fair</h6> <p>这是个第三方模块, <strong>按后端服务器的响应时间来分配请求, 响应时间短的优先分配</strong>.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">fair</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h6 id="url-hash"><a href="#url-hash" class="header-anchor">#</a> url_hash</h6> <p>这是个第三方模块, <strong>按访问 url 的 hash 结果来分配请求</strong>, 使每个 url 定向到同一个后端服务器, 后端服务器为缓存时比较有效. 在 upstream 中加入 hash 语句, server 语句中不能写入 weight 等其他的参数, hash_method 是使用的 hash 算法</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">hash_method</span> crc32</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>以上 5 种负载均衡各自适用不同情况下使用, 所以可以根据实际情况选择使用哪种策略模式, 不过 fair 和 url_hash 需要安装第三方模块才能使用.</p> <p>**server 指令可选参数: **</p> <ol><li><mark><strong>weight</strong></mark>: 设置一个服务器的<strong>访问权重</strong>, 数值越高, 收到的请求也越多;</li> <li><mark><strong>fail_timeout</strong></mark>: 在这个指定的时间内服务器必须提供响应, 如果在这个时间内没有收到响应, 那么服务器将会被标记为 down 状态;</li> <li><mark><strong>max_fails</strong></mark>: 设置在 fail_timeout 时间之内尝试对一个服务器连接的最大次数, 如果超过这个次数, 那么服务器将会被标记为 down;</li> <li><mark><strong>down</strong></mark>: 标记一个服务器不再接受任何请求;</li> <li><mark><strong>backup</strong></mark>: 一旦其他服务器宕机, 那么有该标记的机器将会接收请求.</li></ol> <p>**keepalive 指令: **</p> <p>**Nginx 服务器将会为每一个 worker 进行保持同上游服务器的连接. **</p> <h6 id="屏蔽ip"><a href="#屏蔽ip" class="header-anchor">#</a> 屏蔽ip</h6> <p>在 nginx 的配置文件 <code>nginx.conf</code>​ 中加入如下配置, 可以放到 http, server, location, limit_except语句块, 需要注意相对路径, 本例当中 <code>nginx.conf</code>​, <code>blocksip.conf</code>​ 在同一个目录中.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">include</span> blockip.conf</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在 blockip.conf 里面输入内容, 如:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">deny</span> 165.91.122.67</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">deny</span> IP</span><span class="token punctuation">;</span>   <span class="token comment"># 屏蔽单个ip访问</span>
<span class="token directive"><span class="token keyword">allow</span> IP</span><span class="token punctuation">;</span>  <span class="token comment"># 允许单个ip访问</span>
<span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>  <span class="token comment"># 屏蔽所有ip访问</span>
<span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span> <span class="token comment"># 允许所有ip访问</span>
<span class="token directive"><span class="token keyword">deny</span> 123.0.0.0/8   <span class="token comment"># 屏蔽整个段即从123.0.0.1到123.255.255.254访问的命令</span>
deny 124.45.0.0/16 <span class="token comment"># 屏蔽IP段即从123.45.0.1到123.45.255.254访问的命令</span>
deny 123.45.6.0/24 <span class="token comment"># 屏蔽IP段即从123.45.6.1到123.45.6.254访问的命令</span>

<span class="token comment"># 如果想实现这样的应用, 除了几个IP外, 其他全部拒绝</span>
allow 1.1.1.1</span><span class="token punctuation">;</span> 
<span class="token directive"><span class="token keyword">allow</span> 1.1.1.2</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="重定向"><a href="#重定向" class="header-anchor">#</a> 重定向</h4> <ul><li>​<code>permanent</code>​ 永久性重定向. 请求日志中的状态码为 301.</li> <li>​<code>redirect</code>​ 临时重定向. 请求日志中的状态码为 302.</li></ul> <blockquote><p>重定向整个网站</p></blockquote> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> old-site.com
    return <span class="token number">301</span> <span class="token variable">$scheme</span>://new-site.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>重定向单页</p></blockquote> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> = /oldpage.html</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> http://example.org/newpage.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>重定向整个子路径</p></blockquote> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /old-site</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/old-site/(.*) http://example.org/new-site/<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="性能"><a href="#性能" class="header-anchor">#</a> 性能</h4> <h5 id="内容缓存"><a href="#内容缓存" class="header-anchor">#</a> 内容缓存</h5> <p>允许浏览器基本上永久地缓存静态内容.  Nginx 将为您<strong>设置 Expires 和 Cache-Control 头</strong>信息.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /static</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /data</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> max</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果<strong>要求浏览器永远不会缓存响应(例如用于跟踪请求), 请使用 -1</strong>.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> = /empty.gif</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">empty_gif</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> -1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="gzip压缩"><a href="#gzip压缩" class="header-anchor">#</a> Gzip压缩</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">gzip</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">256</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_types</span>
    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml
    text/javascript application/javascript application/x-javascript
    text/x-json application/json application/x-web-app-manifest+json
    text/css text/plain text/x-component
    font/opentype application/x-font-ttf application/vnd.ms-fontobject
    image/x-icon</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_disable</span>  <span class="token string">&quot;msie6&quot;</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="打开文件缓存"><a href="#打开文件缓存" class="header-anchor">#</a> 打开文件缓存</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">open_file_cache</span> max=1000 inactive=20s</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_valid</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_min_uses</span> <span class="token number">2</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="ssl缓存"><a href="#ssl缓存" class="header-anchor">#</a> SSL缓存</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">ssl_session_cache</span> shared:SSL:10m</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">10m</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="上游keepalive"><a href="#上游keepalive" class="header-anchor">#</a> 上游Keepalive</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    ...
    <span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="监控"><a href="#监控" class="header-anchor">#</a> 监控</h5> <p>使用 <code>ngxtop</code>​ 实时解析 nginx 访问日志, 并且将处理结果输出到终端, 功能类似于系统命 令top. 所有示例都读取 nginx 配置文件的访问日志位置和格式. 如果要指定访问日志文件和/或日志格式, 请使用 -f 和 -a 选项.</p> <p>注意: 在 nginx 配置中 <code>/usr/local/nginx/conf/nginx.conf</code>​ 日志文件必须是<strong>绝对路径</strong>.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 安装 ngxtop</span>
pip <span class="token function">install</span> ngxtop
<span class="token comment"># 实时状态</span>
ngxtop
<span class="token comment"># 状态为404的前10个请求的路径: </span>
ngxtop <span class="token function">top</span> request_path <span class="token parameter variable">--filter</span> <span class="token string">'status == 404'</span>

<span class="token comment"># 发送总字节数最多的前10个请求</span>
ngxtop --order-by <span class="token string">'avg(bytes_sent) * count'</span>

<span class="token comment"># 排名前十位的IP, 例如, 谁攻击你最多</span>
ngxtop --group-by remote_addr

<span class="token comment"># 打印具有4xx或5xx状态的请求, 以及status和http referer</span>
ngxtop <span class="token parameter variable">-i</span> <span class="token string">'status &gt;= 400'</span> print request status http_referer

<span class="token comment"># 由200个请求路径响应发送的平均正文字节以'foo'开始: </span>
ngxtop avg bytes_sent <span class="token parameter variable">--filter</span> <span class="token string">'status == 200 and request_path.startswith(&quot;foo&quot;)'</span>

<span class="token comment"># 使用“common”日志格式从远程机器分析apache访问日志</span>
<span class="token function">ssh</span> remote <span class="token function">tail</span> <span class="token parameter variable">-f</span> /var/log/apache2/access.log <span class="token operator">|</span> ngxtop <span class="token parameter variable">-f</span> common
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="常见使用场景"><a href="#常见使用场景" class="header-anchor">#</a> 常见使用场景</h4> <h5 id="跨域问题"><a href="#跨域问题" class="header-anchor">#</a> 跨域问题</h5> <p>在工作中, 有时候会遇到一些接口不支持跨域, 这时候可以<strong>简单的添加 add_headers 来支持 cors 跨域</strong>. 配置如下:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> api.xxx.com</span><span class="token punctuation">;</span>
    
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET,POST,HEAD'</span></span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host  <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>上面更改头信息, 还有一种, 使用 <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html" target="_blank" rel="noopener noreferrer">rewrite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指令<strong>重定向 URI 来解决跨域问题</strong>.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> api.xxx.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span> 
    <span class="token directive"><span class="token keyword">root</span>  html</span><span class="token punctuation">;</span>                   <span class="token comment">#去请求../html文件夹里的文件</span>
    <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>  <span class="token comment">#首页响应地址</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 用于拦截请求, 匹配任何以 /api/开头的地址, </span>
  <span class="token comment"># 匹配符合以后, 停止往下搜索正则. </span>
  <span class="token directive"><span class="token keyword">location</span> ^~/api/</span><span class="token punctuation">{</span> 
    <span class="token comment"># 代表重写拦截进来的请求, 并且只能对域名后边的除去传递的参数外的字符串起作用, </span>
    <span class="token comment"># 例如www.a.com/proxy/api/msg?meth=1&amp;par=2重写, 只对/proxy/api/msg重写. </span>
    <span class="token comment"># rewrite后面的参数是一个简单的正则 ^/api/(.*)$, </span>
    <span class="token comment"># $1代表正则中的第一个(), $2代表第二个()的值, 以此类推. </span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/api/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
    
    <span class="token comment"># 把请求代理到其他主机 </span>
    <span class="token comment"># 其中 http://www.b.com/ 写法和 http://www.b.com写法的区别如下</span>
    <span class="token comment"># 如果你的请求地址是他 http://server/html/test.jsp</span>
    <span class="token comment"># 配置一:  http://www.b.com/ 后面有“/” </span>
    <span class="token comment">#         将反向代理成 http://www.b.com/html/test.jsp 访问</span>
    <span class="token comment"># 配置一:  http://www.b.com 后面没有有“/” </span>
    <span class="token comment">#         将反向代理成 http://www.b.com/test.jsp 访问</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://test</span><span class="token punctuation">;</span>

    <span class="token comment"># 如果 proxy_pass  URL 是 http://a.xx.com/platform/ 这种情况</span>
    <span class="token comment"># proxy_cookie_path应该设置成 /platform/ / (注意两个斜杠之间有空格). </span>
    <span class="token directive"><span class="token keyword">proxy_cookie_path</span> /platfrom/ /</span><span class="token punctuation">;</span>

    <span class="token comment"># http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header</span>
    <span class="token comment"># 设置 Cookie 头通过</span>
    <span class="token directive"><span class="token keyword">proxy_pass_header</span> Set-Cookie</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h5 id="跳转到带www的域上面"><a href="#跳转到带www的域上面" class="header-anchor">#</a> 跳转到带www的域上面</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 配置正常的带www的域名</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.wangchujiang.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">root</span> /home/www/wabg/download</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html =404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 这个要放到下面, </span>
    <span class="token comment"># 将不带www的 wangchujiang.com 永久性重定向到  https://www.wangchujiang.com</span>
    <span class="token directive"><span class="token keyword">server_name</span> wangchujiang.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^(.*) https://www.wangchujiang.com<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="代理转发"><a href="#代理转发" class="header-anchor">#</a> 代理转发</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> server-api</span><span class="token punctuation">{</span>
    <span class="token comment"># api 代理服务地址</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3110</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">upstream</span> server-resource</span><span class="token punctuation">{</span>
    <span class="token comment"># 静态资源 代理服务地址</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3120</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">3111</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>      <span class="token comment"># 这里指定域名</span>
    <span class="token directive"><span class="token keyword">root</span> /home/www/server-statics</span><span class="token punctuation">;</span>
    <span class="token comment"># 匹配 api 路由的反向代理到API服务</span>
    <span class="token directive"><span class="token keyword">location</span> ^~/api/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-api</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 假设这里验证码也在API服务中</span>
    <span class="token directive"><span class="token keyword">location</span> ^~/captcha</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-api</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 假设你的图片资源全部在另外一个服务上面</span>
    <span class="token directive"><span class="token keyword">location</span> ^~/img/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-resource</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 路由在前端, 后端没有真实路由, 在路由不存在的 404状态的页面返回 /index.html</span>
    <span class="token comment"># 这个方式使用场景, 你在写React或者Vue项目的时候, 没有真实路由</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html =404</span><span class="token punctuation">;</span>
        <span class="token comment">#                               ^ 空格很重要</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h5 id="监控状态信息"><a href="#监控状态信息" class="header-anchor">#</a> 监控状态信息</h5> <p>通过 <code>nginx -V</code> 来查看是否有 <code>with-http_stub_status_module</code> 该模块.</p> <blockquote><p><code>nginx -V</code> 这里 <code>V</code> 是大写的, 如果是小写的 <code>v</code> 即 <code>nginx -v</code>, 则不会出现有哪些模块, 只会出现 <code>nginx</code> 的版本</p></blockquote> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /nginx_status</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">stub_status</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>通过 <code>http://127.0.0.1/nginx_status</code>​ 访问出现下面结果.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Active connections: <span class="token number">3</span>
server accepts handled requests
 <span class="token number">7</span> <span class="token number">7</span> <span class="token number">5</span> 
Reading: <span class="token number">0</span> Writing: <span class="token number">1</span> Waiting: <span class="token number">2</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>主动连接(第 1 行)</p></blockquote> <p>当前与 http 建立的连接数, 包括等待的客户端连接: 3</p> <blockquote><p>服务器接受处理的请求(第 2~3 行)</p></blockquote> <p>接受的客户端连接总数目: 7</p> <p>处理的客户端连接总数目: 7</p> <p>客户端总的请求数目: 5</p> <blockquote><p>读取其它信(第 4 行)</p></blockquote> <p>当前, nginx 读请求连接</p> <p>当前, nginx 写响应返回给客户端</p> <p>目前有多少空闲客户端请求连接</p> <h5 id="代理转发连接替换"><a href="#代理转发连接替换" class="header-anchor">#</a> 代理转发连接替换</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ^~/api/upload</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /wfs/v1/upload break</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://wfs-api</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="ssl配置"><a href="#ssl配置" class="header-anchor">#</a> ssl配置</h5> <p>超文本传输安全协议(缩写: HTTPS)是超文本传输协议和 SSL/TLS 的组合, 用以提供加密通讯及对网络服务器身份的鉴定. HTTPS 连接经常被用于万维网上的交易支付和企业信息系统中敏感信息的传输. HTTPS 目前已经是所有注重隐私和安全的网站的首选, 随着技术的不断发展, HTTPS 网站已不再是大型网站的专利, 所有普通的个人站长和博客均可以自己动手搭建一个安全的加密的网站.</p> <p><strong>创建 SSL 证书</strong>, 如果你购买的证书, 就可以直接下载.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/nginx/ssl
<span class="token comment"># 创建了有效期100年, 加密强度为RSA2048的SSL密钥key和X509证书文件. </span>
<span class="token function">sudo</span> openssl req <span class="token parameter variable">-x509</span> <span class="token parameter variable">-nodes</span> <span class="token parameter variable">-days</span> <span class="token number">36500</span> <span class="token parameter variable">-newkey</span> rsa:2048 <span class="token parameter variable">-keyout</span> /etc/nginx/ssl/nginx.key <span class="token parameter variable">-out</span> /etc/nginx/ssl/nginx.crt
<span class="token comment"># 上面命令, 会有下面需要填写内容</span>
Country Name <span class="token punctuation">(</span><span class="token number">2</span> letter code<span class="token punctuation">)</span> <span class="token punctuation">[</span>AU<span class="token punctuation">]</span>:US
State or Province Name <span class="token punctuation">(</span>full name<span class="token punctuation">)</span> <span class="token punctuation">[</span>Some-State<span class="token punctuation">]</span>:New York
Locality Name <span class="token punctuation">(</span>eg, city<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:New York City
Organization Name <span class="token punctuation">(</span>eg, company<span class="token punctuation">)</span> <span class="token punctuation">[</span>Internet Widgits Pty Ltd<span class="token punctuation">]</span>:Bouncy Castles, Inc.
Organizational Unit Name <span class="token punctuation">(</span>eg, section<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:Ministry of Water Slides
Common Name <span class="token punctuation">(</span>e.g. server FQDN or YOUR name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:your_domain.com
Email Address <span class="token punctuation">[</span><span class="token punctuation">]</span>:admin@your_domain.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>创建自签证书:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>首先, 创建证书和私钥的目录
<span class="token comment"># mkdir -p /etc/nginx/cert</span>
<span class="token comment"># cd /etc/nginx/cert</span>
创建服务器私钥, 命令会让你输入一个口令: 
<span class="token comment"># openssl genrsa -des3 -out nginx.key 2048</span>
创建签名请求的证书<span class="token punctuation">(</span>CSR<span class="token punctuation">)</span>: 
<span class="token comment"># openssl req -new -key nginx.key -out nginx.csr</span>
在加载SSL支持的Nginx并使用上述私钥时除去必须的口令: 
<span class="token comment"># cp nginx.key nginx.key.org</span>
<span class="token comment"># openssl rsa -in nginx.key.org -out nginx.key</span>
最后标记证书使用上述私钥和CSR: 
<span class="token comment"># openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>查看目前 nginx 编译选项</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sbin/nginx -V
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出下面内容:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>nginx version: nginx/1.7.8
built by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)
TLS SNI support enabled
configure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果依赖的模块不存在, 可以进入安装目录, 输入下面命令重新编译安装.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行完成之后还需要 <code>make</code>​ (不用 make install)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 备份nginx的二进制文件</span>
<span class="token function">cp</span> <span class="token parameter variable">-rf</span> /usr/local/nginx/sbin/nginx　 /usr/local/nginx/sbin/nginx.bak
<span class="token comment"># 覆盖nginx的二进制文件</span>
<span class="token function">cp</span> <span class="token parameter variable">-rf</span> objs/nginx   /usr/local/nginx/sbin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>HTTPS server:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>    <span class="token comment"># 监听443端口</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/ssl/nginx.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/ssl/nginx.key</span><span class="token punctuation">;</span>
    <span class="token comment"># 禁止在header中出现服务器版本, 防止黑客利用版本漏洞攻击</span>
    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 设置ssl/tls会话缓存的类型和大小. 如果设置了这个参数一般是shared, buildin可能会参数内存碎片, 默认是none, 和off差不多, 停用缓存. 如shared:SSL:10m表示我所有的nginx工作进程共享ssl会话缓存, 官网介绍说1M可以存放约4000个sessions.  </span>
    <span class="token directive"><span class="token keyword">ssl_session_cache</span>    shared:SSL:1m</span><span class="token punctuation">;</span> 

    <span class="token comment"># 客户端可以重用会话缓存中ssl参数的过期时间, 内网系统默认5分钟太短了, 可以设成30m即30分钟甚至4h. </span>
    <span class="token directive"><span class="token keyword">ssl_session_timeout</span>  <span class="token number">5m</span></span><span class="token punctuation">;</span> 

    <span class="token comment"># 选择加密套件, 不同的浏览器所支持的套件(和顺序)可能会不同. </span>
    <span class="token comment"># 这里指定的是OpenSSL库能够识别的写法, 你可以通过 openssl -v cipher 'RC4:HIGH:!aNULL:!MD5'(后面是你所指定的套件加密算法) 来看所支持算法. </span>
    <span class="token directive"><span class="token keyword">ssl_ciphers</span>  HIGH:!aNULL:!MD5</span><span class="token punctuation">;</span>

    <span class="token comment"># 设置协商加密算法时, 优先使用我们服务端的加密套件, 而不是客户端浏览器的加密套件. </span>
    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h5 id="强制将http重定向到https"><a href="#强制将http重定向到https" class="header-anchor">#</a> 强制将http重定向到https</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  example.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^ https://<span class="token variable">$http_host</span><span class="token variable">$request_uri?</span> permanent</span><span class="token punctuation">;</span>    <span class="token comment"># 强制将http重定向到https</span>
    <span class="token comment"># 在错误页面和“服务器”响应头字段中启用或禁用发射nginx版本.  防止黑客利用版本漏洞攻击</span>
    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="两个虚拟主机"><a href="#两个虚拟主机" class="header-anchor">#</a> 两个虚拟主机</h5> <p>纯静态 -html 支持</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span>     www.domain1.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">access_log</span>      logs/domain1.access.log main</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">root</span>  /var/www/domain1.com/htdocs</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span>     www.domain2.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">access_log</span>      logs/domain2.access.log main</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">root</span>  /var/www/domain2.com/htdocs</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h5 id="虚拟主机标准配置"><a href="#虚拟主机标准配置" class="header-anchor">#</a> 虚拟主机标准配置</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span> default</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>     _ *</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span>      logs/default.access.log main</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
       <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
       <span class="token directive"><span class="token keyword">root</span>  /var/www/default/htdocs</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="爬虫过滤"><a href="#爬虫过滤" class="header-anchor">#</a> 爬虫过滤</h5> <p>根据 <code>User-Agent</code>​ 过滤请求, 通过一个简单的正则表达式, 就可以<strong>过滤不符合要求的爬虫请求</strong>(初级爬虫).</p> <blockquote><p><code>~*</code> 表示不区分大小写的正则匹配</p></blockquote> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* <span class="token string">&quot;python|curl|java|wget|httpclient|okhttp&quot;</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">503</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 正常处理</span>
    <span class="token comment"># ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="防盗链"><a href="#防盗链" class="header-anchor">#</a> 防盗链</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|png|swf|flv)$</span> <span class="token punctuation">{</span>
   <span class="token directive"><span class="token keyword">root</span> html
   valid_referers none blocked *.nginxcn.com</span><span class="token punctuation">;</span>
   <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
     rewrite ^/ www.nginx.cn
     <span class="token comment">#return 404;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="虚拟目录配置"><a href="#虚拟目录配置" class="header-anchor">#</a> 虚拟目录配置</h5> <p>alias 指定的目录是准确的, root 是指定目录的上级目录, 并且该上级目录要含有 location 指定名称的同名目录.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /img/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">alias</span> /var/www/image/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># 访问/img/目录里面的文件时, ningx会自动去/var/www/image/目录找文件</span>
<span class="token directive"><span class="token keyword">location</span> /img/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /var/www/image</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># 访问/img/目录下的文件时, nginx会去/var/www/image/img/目录下找文件. ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="防盗图配置"><a href="#防盗图配置" class="header-anchor">#</a> 防盗图配置</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf)</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">valid_referers</span> none blocked *.jslite.io</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/  http://wangchujiang.com/piratesp.png</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="屏蔽-git等文件"><a href="#屏蔽-git等文件" class="header-anchor">#</a> 屏蔽.git等文件</h5> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ (.git|.gitattributes|.gitignore|.svn)</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="域名路径加不加需要都能正常访问"><a href="#域名路径加不加需要都能正常访问" class="header-anchor">#</a> 域名路径加不加需要都能正常访问</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>http://wangchujiang.com/api/index.php?a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token assign-left variable">name</span><span class="token operator">=</span>wcj
                                  ^ 有后缀

http://wangchujiang.com/api/index?a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token assign-left variable">name</span><span class="token operator">=</span>wcj
                                 ^ 没有后缀
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>nginx rewrite 规则如下:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)/$ /index.php?/<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">if</span> (!-d <span class="token variable">$request_filename</span>)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$rule_1</span> 1<span class="token variable">$rule_1</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">if</span> (!-f <span class="token variable">$request_filename</span>)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$rule_1</span> 2<span class="token variable">$rule_1</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$rule_1</span> = <span class="token string">&quot;21&quot;</span>)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/ /index.php last</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="cockpit"><a href="#cockpit" class="header-anchor">#</a> cockpit</h5> <p>https://github.com/cockpit-project/cockpit</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> cockpit.xxxxxxx.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> cockpit.xxxxxxx.com</span><span class="token punctuation">;</span>
 
    <span class="token comment">#ssl on;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/cert/cockpit.xxxxxxx.com.pem</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/cert/cockpit.xxxxxxx.com.key</span><span class="token punctuation">;</span>
 
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://websocket</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>这时输入域名, 能看到登录页面, 但登录后, 显示不出内容, 页面全白. 这里要对 <code>cockpit.conf</code> 进行设置修改.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/cockpit/cockpit.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参照如下配置修改, 注意域名替换为 <code>your_domain_host</code>:</p> <div class="language-toml line-numbers-mode"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">WebService</span><span class="token punctuation">]</span>
<span class="token key property">Origins</span> <span class="token punctuation">=</span> https://cockpit<span class="token punctuation">.</span>xxxxxxx<span class="token punctuation">.</span>com https://<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span>:<span class="token number">9090</span>
<span class="token key property">ProtocolHeader</span> <span class="token punctuation">=</span> X-Forwarded-Proto
<span class="token key property">AllowUnencrypted</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>‍</p> <p>‍</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <ul><li><a href="https://my.oschina.net/u/3341316/blog/877206" target="_blank" rel="noopener noreferrer">负载均衡原理的解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://blog.githuber.cn/posts/73" target="_blank" rel="noopener noreferrer">Nginx泛域名解析, 实现多个二级域名 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/" target="_blank" rel="noopener noreferrer">深入 NGINX: 我们如何设计性能和扩展<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/" target="_blank" rel="noopener noreferrer">Inside NGINX: How We Designed for Performance &amp; Scale<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://tengine.taobao.org/book/index.html" target="_blank" rel="noopener noreferrer">Nginx开发从入门到精通<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://os.51cto.com/art/201703/535326.htm#topx" target="_blank" rel="noopener noreferrer">Nginx的优化与防盗链<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000009769143" target="_blank" rel="noopener noreferrer">实战开发一个Nginx扩展 (Nginx Module)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://my.oschina.net/xshuai/blog/917097" target="_blank" rel="noopener noreferrer">Nginx+Keepalived(双机热备)搭建高可用负载均衡环境(HA)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.huxd.org/articles/2017/07/24/1500890692329.html" target="_blank" rel="noopener noreferrer">Nginx 平滑升级<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&amp;mid=2247483708&amp;idx=1&amp;sn=90b0b1dccd9c337922a0588245277666&amp;chksm=97f38cf7a08405e1928e0b46d923d630e529e7db8ac7ca2a91310a075986f8bcb2cee5b4953d#rd" target="_blank" rel="noopener noreferrer">Nginx最新模块—ngx_http_mirror_module分析可以做版本发布前的预先验证, 进行流量放大后的压测等等<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>‍</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/main/docs/30.系统/3000.系统/150.系统接入层/100.Nginx基础.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/d03ebf/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">分布式技术原理与算法解析(极客时间)🌸</div></a> <a href="/pages/d4123d/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">深入拆解Tomcat与Jetty(极客时间)🌸</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/d03ebf/" class="prev">分布式技术原理与算法解析(极客时间)🌸</a></span> <span class="next"><a href="/pages/d4123d/">深入拆解Tomcat与Jetty(极客时间)🌸</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:1174520425@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/nanodaemony" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2025
    <span>达尔文的猹 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3f3e0e10.js" defer></script><script src="/assets/js/2.e9fcb30c.js" defer></script><script src="/assets/js/3.1998f389.js" defer></script><script src="/assets/js/164.a1cc0109.js" defer></script>
  </body>
</html>
