<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络层 | Pangolin Note</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="大道至简">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.56073ad3.css" as="style"><link rel="preload" href="/assets/js/app.3f3e0e10.js" as="script"><link rel="preload" href="/assets/js/2.e9fcb30c.js" as="script"><link rel="preload" href="/assets/js/3.1998f389.js" as="script"><link rel="preload" href="/assets/js/37.d1824f2f.js" as="script"><link rel="prefetch" href="/assets/js/10.0b55747f.js"><link rel="prefetch" href="/assets/js/100.b8912a99.js"><link rel="prefetch" href="/assets/js/101.a6740c8a.js"><link rel="prefetch" href="/assets/js/102.e31e89b2.js"><link rel="prefetch" href="/assets/js/103.2c5dbdae.js"><link rel="prefetch" href="/assets/js/104.0e9c02f6.js"><link rel="prefetch" href="/assets/js/105.8288396c.js"><link rel="prefetch" href="/assets/js/106.62f43c11.js"><link rel="prefetch" href="/assets/js/107.70c90211.js"><link rel="prefetch" href="/assets/js/108.b488ce56.js"><link rel="prefetch" href="/assets/js/109.12942650.js"><link rel="prefetch" href="/assets/js/11.ac3fd1ca.js"><link rel="prefetch" href="/assets/js/110.1e57ecba.js"><link rel="prefetch" href="/assets/js/111.6e33b4ea.js"><link rel="prefetch" href="/assets/js/112.bd52831b.js"><link rel="prefetch" href="/assets/js/113.868c1ac9.js"><link rel="prefetch" href="/assets/js/114.090549d1.js"><link rel="prefetch" href="/assets/js/115.d97f6c2b.js"><link rel="prefetch" href="/assets/js/116.097c4b4e.js"><link rel="prefetch" href="/assets/js/117.4024cfe2.js"><link rel="prefetch" href="/assets/js/118.e3057cba.js"><link rel="prefetch" href="/assets/js/119.4ef1fa3b.js"><link rel="prefetch" href="/assets/js/12.863eaabe.js"><link rel="prefetch" href="/assets/js/120.78f9df50.js"><link rel="prefetch" href="/assets/js/121.8e16df87.js"><link rel="prefetch" href="/assets/js/122.f21c0107.js"><link rel="prefetch" href="/assets/js/123.ea1cb375.js"><link rel="prefetch" href="/assets/js/124.01c04c6e.js"><link rel="prefetch" href="/assets/js/125.d383e301.js"><link rel="prefetch" href="/assets/js/126.3162cb47.js"><link rel="prefetch" href="/assets/js/127.c6bebae6.js"><link rel="prefetch" href="/assets/js/128.d659db60.js"><link rel="prefetch" href="/assets/js/129.2afdcf48.js"><link rel="prefetch" href="/assets/js/13.4f59ce35.js"><link rel="prefetch" href="/assets/js/130.beb9ed9d.js"><link rel="prefetch" href="/assets/js/131.35b05f8a.js"><link rel="prefetch" href="/assets/js/132.d77f4f93.js"><link rel="prefetch" href="/assets/js/133.4ceda6e5.js"><link rel="prefetch" href="/assets/js/134.11390c5f.js"><link rel="prefetch" href="/assets/js/135.32f9e38f.js"><link rel="prefetch" href="/assets/js/136.6d8bb0f2.js"><link rel="prefetch" href="/assets/js/137.9c0ffeef.js"><link rel="prefetch" href="/assets/js/138.88d86e5f.js"><link rel="prefetch" href="/assets/js/139.8c2c3d6c.js"><link rel="prefetch" href="/assets/js/14.11c82d35.js"><link rel="prefetch" href="/assets/js/140.c5c375d3.js"><link rel="prefetch" href="/assets/js/141.d703f30b.js"><link rel="prefetch" href="/assets/js/142.6a005a44.js"><link rel="prefetch" href="/assets/js/143.9b2edf6f.js"><link rel="prefetch" href="/assets/js/144.3fd013c9.js"><link rel="prefetch" href="/assets/js/145.b05079c5.js"><link rel="prefetch" href="/assets/js/146.ed5360a6.js"><link rel="prefetch" href="/assets/js/147.7408d86f.js"><link rel="prefetch" href="/assets/js/148.f390b370.js"><link rel="prefetch" href="/assets/js/149.95017f0a.js"><link rel="prefetch" href="/assets/js/15.bd143bd5.js"><link rel="prefetch" href="/assets/js/150.f0ede764.js"><link rel="prefetch" href="/assets/js/151.b7093623.js"><link rel="prefetch" href="/assets/js/152.a82a6c83.js"><link rel="prefetch" href="/assets/js/153.965e3fb2.js"><link rel="prefetch" href="/assets/js/154.9e49311e.js"><link rel="prefetch" href="/assets/js/155.cef33ba5.js"><link rel="prefetch" href="/assets/js/156.bcc397ae.js"><link rel="prefetch" href="/assets/js/157.90824739.js"><link rel="prefetch" href="/assets/js/158.efd429b9.js"><link rel="prefetch" href="/assets/js/159.122ff5b7.js"><link rel="prefetch" href="/assets/js/16.2449162b.js"><link rel="prefetch" href="/assets/js/160.0b806535.js"><link rel="prefetch" href="/assets/js/161.835052c6.js"><link rel="prefetch" href="/assets/js/162.ca34e2d2.js"><link rel="prefetch" href="/assets/js/163.08000d04.js"><link rel="prefetch" href="/assets/js/164.a1cc0109.js"><link rel="prefetch" href="/assets/js/165.65444686.js"><link rel="prefetch" href="/assets/js/166.7d73c84f.js"><link rel="prefetch" href="/assets/js/167.009d47a3.js"><link rel="prefetch" href="/assets/js/168.0afeae2a.js"><link rel="prefetch" href="/assets/js/169.7654cb31.js"><link rel="prefetch" href="/assets/js/17.eb7f9def.js"><link rel="prefetch" href="/assets/js/170.58569530.js"><link rel="prefetch" href="/assets/js/171.7db9ed40.js"><link rel="prefetch" href="/assets/js/172.3cb50ed4.js"><link rel="prefetch" href="/assets/js/173.0846425f.js"><link rel="prefetch" href="/assets/js/174.9e95f111.js"><link rel="prefetch" href="/assets/js/175.ef2098f2.js"><link rel="prefetch" href="/assets/js/176.c2635fe9.js"><link rel="prefetch" href="/assets/js/177.4fa38e8e.js"><link rel="prefetch" href="/assets/js/178.2be7037f.js"><link rel="prefetch" href="/assets/js/179.bf3bba28.js"><link rel="prefetch" href="/assets/js/18.0455f4d1.js"><link rel="prefetch" href="/assets/js/180.72c5f597.js"><link rel="prefetch" href="/assets/js/181.42287bcc.js"><link rel="prefetch" href="/assets/js/182.6cd4bf1a.js"><link rel="prefetch" href="/assets/js/183.05dbbfd9.js"><link rel="prefetch" href="/assets/js/184.03de7e00.js"><link rel="prefetch" href="/assets/js/185.42dd210e.js"><link rel="prefetch" href="/assets/js/186.28ee0f8a.js"><link rel="prefetch" href="/assets/js/187.bb58697b.js"><link rel="prefetch" href="/assets/js/188.1bc8be96.js"><link rel="prefetch" href="/assets/js/189.fac747e3.js"><link rel="prefetch" href="/assets/js/19.ae9e35d6.js"><link rel="prefetch" href="/assets/js/190.ea533ac7.js"><link rel="prefetch" href="/assets/js/191.6dc6eb13.js"><link rel="prefetch" href="/assets/js/192.184d249f.js"><link rel="prefetch" href="/assets/js/193.4a06bc12.js"><link rel="prefetch" href="/assets/js/194.8cce60a9.js"><link rel="prefetch" href="/assets/js/195.93231a13.js"><link rel="prefetch" href="/assets/js/196.4a596bde.js"><link rel="prefetch" href="/assets/js/197.96c113cf.js"><link rel="prefetch" href="/assets/js/198.73ba3f67.js"><link rel="prefetch" href="/assets/js/199.74bab595.js"><link rel="prefetch" href="/assets/js/20.b542d0e7.js"><link rel="prefetch" href="/assets/js/200.69a6928a.js"><link rel="prefetch" href="/assets/js/201.9ffa7c5a.js"><link rel="prefetch" href="/assets/js/202.41edb652.js"><link rel="prefetch" href="/assets/js/203.7fabcef3.js"><link rel="prefetch" href="/assets/js/204.b0ae2f62.js"><link rel="prefetch" href="/assets/js/205.add8738b.js"><link rel="prefetch" href="/assets/js/206.f3a712ec.js"><link rel="prefetch" href="/assets/js/207.cd7dd729.js"><link rel="prefetch" href="/assets/js/208.78b33afa.js"><link rel="prefetch" href="/assets/js/209.9d3329ff.js"><link rel="prefetch" href="/assets/js/21.5a050318.js"><link rel="prefetch" href="/assets/js/210.d285d5ac.js"><link rel="prefetch" href="/assets/js/211.8791bb3f.js"><link rel="prefetch" href="/assets/js/212.84ed81a8.js"><link rel="prefetch" href="/assets/js/213.7b990580.js"><link rel="prefetch" href="/assets/js/214.da31f20c.js"><link rel="prefetch" href="/assets/js/215.9eeed659.js"><link rel="prefetch" href="/assets/js/216.9539f0ec.js"><link rel="prefetch" href="/assets/js/217.11b575be.js"><link rel="prefetch" href="/assets/js/218.a67f12f1.js"><link rel="prefetch" href="/assets/js/219.bfbb817a.js"><link rel="prefetch" href="/assets/js/22.2bc6f7e3.js"><link rel="prefetch" href="/assets/js/220.8b01342f.js"><link rel="prefetch" href="/assets/js/221.b450decd.js"><link rel="prefetch" href="/assets/js/222.97468507.js"><link rel="prefetch" href="/assets/js/223.b6dafd73.js"><link rel="prefetch" href="/assets/js/224.c86c18c6.js"><link rel="prefetch" href="/assets/js/225.b0dcf86e.js"><link rel="prefetch" href="/assets/js/226.02cc2999.js"><link rel="prefetch" href="/assets/js/227.8474ef5a.js"><link rel="prefetch" href="/assets/js/228.0298e421.js"><link rel="prefetch" href="/assets/js/229.6aeaf595.js"><link rel="prefetch" href="/assets/js/23.9995fce4.js"><link rel="prefetch" href="/assets/js/230.a5785286.js"><link rel="prefetch" href="/assets/js/231.d791daa4.js"><link rel="prefetch" href="/assets/js/232.97aeeb00.js"><link rel="prefetch" href="/assets/js/233.46e51e28.js"><link rel="prefetch" href="/assets/js/234.2cffe82f.js"><link rel="prefetch" href="/assets/js/235.14965da6.js"><link rel="prefetch" href="/assets/js/236.00a5afc0.js"><link rel="prefetch" href="/assets/js/237.3b73d52f.js"><link rel="prefetch" href="/assets/js/238.6e1db765.js"><link rel="prefetch" href="/assets/js/239.75866c5e.js"><link rel="prefetch" href="/assets/js/24.9141eeb2.js"><link rel="prefetch" href="/assets/js/240.af9c2cc9.js"><link rel="prefetch" href="/assets/js/241.388acab2.js"><link rel="prefetch" href="/assets/js/242.c60f2b48.js"><link rel="prefetch" href="/assets/js/243.d8e81b13.js"><link rel="prefetch" href="/assets/js/244.58b0b21d.js"><link rel="prefetch" href="/assets/js/245.c3768497.js"><link rel="prefetch" href="/assets/js/246.ac8bbe7a.js"><link rel="prefetch" href="/assets/js/247.d095f70a.js"><link rel="prefetch" href="/assets/js/248.e9f210b5.js"><link rel="prefetch" href="/assets/js/249.a9fad023.js"><link rel="prefetch" href="/assets/js/25.98e8593e.js"><link rel="prefetch" href="/assets/js/250.ae7f0ebb.js"><link rel="prefetch" href="/assets/js/251.9a617d55.js"><link rel="prefetch" href="/assets/js/252.ce082446.js"><link rel="prefetch" href="/assets/js/253.4575302d.js"><link rel="prefetch" href="/assets/js/254.5899a61b.js"><link rel="prefetch" href="/assets/js/255.66c69f31.js"><link rel="prefetch" href="/assets/js/256.8fd6c706.js"><link rel="prefetch" href="/assets/js/257.31b77e5e.js"><link rel="prefetch" href="/assets/js/258.eba48891.js"><link rel="prefetch" href="/assets/js/259.edf74b59.js"><link rel="prefetch" href="/assets/js/26.e69924ea.js"><link rel="prefetch" href="/assets/js/260.cf2ed36d.js"><link rel="prefetch" href="/assets/js/261.9e7792d8.js"><link rel="prefetch" href="/assets/js/262.e7b9433e.js"><link rel="prefetch" href="/assets/js/263.1185b25c.js"><link rel="prefetch" href="/assets/js/264.5e0f89cb.js"><link rel="prefetch" href="/assets/js/265.a38d3b94.js"><link rel="prefetch" href="/assets/js/266.2ef170b3.js"><link rel="prefetch" href="/assets/js/267.a7d14651.js"><link rel="prefetch" href="/assets/js/268.05b18748.js"><link rel="prefetch" href="/assets/js/269.dad48d6f.js"><link rel="prefetch" href="/assets/js/27.13612515.js"><link rel="prefetch" href="/assets/js/270.4f5a6b8d.js"><link rel="prefetch" href="/assets/js/271.7ebf6682.js"><link rel="prefetch" href="/assets/js/272.7c2fbfd1.js"><link rel="prefetch" href="/assets/js/273.8ee20732.js"><link rel="prefetch" href="/assets/js/274.d525242a.js"><link rel="prefetch" href="/assets/js/275.a8a19acb.js"><link rel="prefetch" href="/assets/js/276.df3a4eb4.js"><link rel="prefetch" href="/assets/js/277.336debda.js"><link rel="prefetch" href="/assets/js/278.c470625f.js"><link rel="prefetch" href="/assets/js/279.a91e1a64.js"><link rel="prefetch" href="/assets/js/28.ab7ae1df.js"><link rel="prefetch" href="/assets/js/280.87e25c9a.js"><link rel="prefetch" href="/assets/js/281.87c1ba25.js"><link rel="prefetch" href="/assets/js/282.dcd4dce0.js"><link rel="prefetch" href="/assets/js/283.abac2e00.js"><link rel="prefetch" href="/assets/js/284.f6079659.js"><link rel="prefetch" href="/assets/js/285.f1b39879.js"><link rel="prefetch" href="/assets/js/286.f6a79242.js"><link rel="prefetch" href="/assets/js/287.06bebe07.js"><link rel="prefetch" href="/assets/js/288.89e325df.js"><link rel="prefetch" href="/assets/js/289.3aa1bedd.js"><link rel="prefetch" href="/assets/js/29.ebe50f76.js"><link rel="prefetch" href="/assets/js/290.ee059c92.js"><link rel="prefetch" href="/assets/js/291.fa9a921a.js"><link rel="prefetch" href="/assets/js/292.2a8811cd.js"><link rel="prefetch" href="/assets/js/293.eec09cdf.js"><link rel="prefetch" href="/assets/js/294.dfac20dc.js"><link rel="prefetch" href="/assets/js/295.825d2070.js"><link rel="prefetch" href="/assets/js/296.f645861e.js"><link rel="prefetch" href="/assets/js/297.424fdb17.js"><link rel="prefetch" href="/assets/js/298.ebf87cdc.js"><link rel="prefetch" href="/assets/js/299.b8f19cbb.js"><link rel="prefetch" href="/assets/js/30.75237511.js"><link rel="prefetch" href="/assets/js/300.10fb6d4f.js"><link rel="prefetch" href="/assets/js/301.ef77c612.js"><link rel="prefetch" href="/assets/js/302.1b839763.js"><link rel="prefetch" href="/assets/js/303.609f7d98.js"><link rel="prefetch" href="/assets/js/304.1d255f19.js"><link rel="prefetch" href="/assets/js/305.b0234f2c.js"><link rel="prefetch" href="/assets/js/306.48677f64.js"><link rel="prefetch" href="/assets/js/307.14390d4b.js"><link rel="prefetch" href="/assets/js/308.fa730b28.js"><link rel="prefetch" href="/assets/js/309.0496b9e0.js"><link rel="prefetch" href="/assets/js/31.cf3f471a.js"><link rel="prefetch" href="/assets/js/310.a31676dc.js"><link rel="prefetch" href="/assets/js/311.ed53adc5.js"><link rel="prefetch" href="/assets/js/312.1b0ff2f1.js"><link rel="prefetch" href="/assets/js/313.bf123f32.js"><link rel="prefetch" href="/assets/js/314.4e6ce06b.js"><link rel="prefetch" href="/assets/js/315.8eb18560.js"><link rel="prefetch" href="/assets/js/32.74fef842.js"><link rel="prefetch" href="/assets/js/33.bc2d190b.js"><link rel="prefetch" href="/assets/js/34.d23438fc.js"><link rel="prefetch" href="/assets/js/35.7675c4d0.js"><link rel="prefetch" href="/assets/js/36.96a4161b.js"><link rel="prefetch" href="/assets/js/38.4effff9e.js"><link rel="prefetch" href="/assets/js/39.6509914b.js"><link rel="prefetch" href="/assets/js/4.4d01750f.js"><link rel="prefetch" href="/assets/js/40.1509d08b.js"><link rel="prefetch" href="/assets/js/41.f2c1124f.js"><link rel="prefetch" href="/assets/js/42.e541d077.js"><link rel="prefetch" href="/assets/js/43.369de999.js"><link rel="prefetch" href="/assets/js/44.43959db0.js"><link rel="prefetch" href="/assets/js/45.282fbd31.js"><link rel="prefetch" href="/assets/js/46.1b83cfe9.js"><link rel="prefetch" href="/assets/js/47.c3a88e41.js"><link rel="prefetch" href="/assets/js/48.bc7c0a1b.js"><link rel="prefetch" href="/assets/js/49.92a4e5ba.js"><link rel="prefetch" href="/assets/js/5.c3991e24.js"><link rel="prefetch" href="/assets/js/50.9c488c6c.js"><link rel="prefetch" href="/assets/js/51.546ea632.js"><link rel="prefetch" href="/assets/js/52.0d2ccee1.js"><link rel="prefetch" href="/assets/js/53.6f52b5b1.js"><link rel="prefetch" href="/assets/js/54.c838b295.js"><link rel="prefetch" href="/assets/js/55.13af99ee.js"><link rel="prefetch" href="/assets/js/56.6be6d1ed.js"><link rel="prefetch" href="/assets/js/57.67c98b39.js"><link rel="prefetch" href="/assets/js/58.107e82ec.js"><link rel="prefetch" href="/assets/js/59.b3e5edc7.js"><link rel="prefetch" href="/assets/js/6.36a535f9.js"><link rel="prefetch" href="/assets/js/60.3b0b4ba5.js"><link rel="prefetch" href="/assets/js/61.3df843df.js"><link rel="prefetch" href="/assets/js/62.1213823d.js"><link rel="prefetch" href="/assets/js/63.e8f3f926.js"><link rel="prefetch" href="/assets/js/64.e1219050.js"><link rel="prefetch" href="/assets/js/65.5bf5bb0b.js"><link rel="prefetch" href="/assets/js/66.a2502afb.js"><link rel="prefetch" href="/assets/js/67.690dd59b.js"><link rel="prefetch" href="/assets/js/68.de7b0915.js"><link rel="prefetch" href="/assets/js/69.ac61dd61.js"><link rel="prefetch" href="/assets/js/7.5d254238.js"><link rel="prefetch" href="/assets/js/70.3edd41b1.js"><link rel="prefetch" href="/assets/js/71.d23407e9.js"><link rel="prefetch" href="/assets/js/72.a5bd01bc.js"><link rel="prefetch" href="/assets/js/73.c9f4dd57.js"><link rel="prefetch" href="/assets/js/74.66323fc1.js"><link rel="prefetch" href="/assets/js/75.e1a72e00.js"><link rel="prefetch" href="/assets/js/76.801268b4.js"><link rel="prefetch" href="/assets/js/77.3a5fda67.js"><link rel="prefetch" href="/assets/js/78.54d84cd4.js"><link rel="prefetch" href="/assets/js/79.fa10f4e3.js"><link rel="prefetch" href="/assets/js/8.e060e47d.js"><link rel="prefetch" href="/assets/js/80.d5b24fea.js"><link rel="prefetch" href="/assets/js/81.0e9da714.js"><link rel="prefetch" href="/assets/js/82.e96ff6d7.js"><link rel="prefetch" href="/assets/js/83.771cced1.js"><link rel="prefetch" href="/assets/js/84.220b69e7.js"><link rel="prefetch" href="/assets/js/85.7dcc5659.js"><link rel="prefetch" href="/assets/js/86.44ba2100.js"><link rel="prefetch" href="/assets/js/87.281da75d.js"><link rel="prefetch" href="/assets/js/88.12d88449.js"><link rel="prefetch" href="/assets/js/89.f28c86d3.js"><link rel="prefetch" href="/assets/js/9.8f9fef32.js"><link rel="prefetch" href="/assets/js/90.715cabb2.js"><link rel="prefetch" href="/assets/js/91.6ced7c82.js"><link rel="prefetch" href="/assets/js/92.c05b33ca.js"><link rel="prefetch" href="/assets/js/93.6bf5fb66.js"><link rel="prefetch" href="/assets/js/94.3561200e.js"><link rel="prefetch" href="/assets/js/95.0f2cf716.js"><link rel="prefetch" href="/assets/js/96.ac8487ea.js"><link rel="prefetch" href="/assets/js/97.48042b5a.js"><link rel="prefetch" href="/assets/js/98.441bb7f8.js"><link rel="prefetch" href="/assets/js/99.4b214d92.js">
    <link rel="stylesheet" href="/assets/css/0.styles.56073ad3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/magic.png" alt="Pangolin Note" class="logo"> <span class="site-name can-hide">Pangolin Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">系统</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">🍀读书笔记</a></div><div class="nav-item"><a href="/work/" class="nav-link">工作</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">🌸达尔文的猹</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatarnew.png"> <div class="blogger-info"><h3>达尔文的猹</h3> <span>大道至简 悟在天成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">系统</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">🍀读书笔记</a></div><div class="nav-item"><a href="/work/" class="nav-link">工作</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">🌸达尔文的猹</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>计算机基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b49252/" class="sidebar-link">深入浅出计算机组成原理(极客)</a></li><li><a href="/pages/c470a4/" class="sidebar-link">CSAPP🌟</a></li><li><a href="/pages/8b1d1a/" class="sidebar-link">密码学🐳</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>操作系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9f0749/" class="sidebar-link">操作系统基础</a></li><li><a href="/pages/455709/" class="sidebar-link">进程管理</a></li><li><a href="/pages/0e463b/" class="sidebar-link">内存管理</a></li><li><a href="/pages/2617e7/" class="sidebar-link">外设管理🌼</a></li><li><a href="/pages/c00f84/" class="sidebar-link">IO模型🌼</a></li><li><a href="/pages/d913bf/" class="sidebar-link">Linux基础🌼</a></li><li><a href="/pages/4af92e/" class="sidebar-link">Linux文件系统与文件🌼</a></li><li><a href="/pages/713f76/" class="sidebar-link">Linux系统管理</a></li><li><a href="/pages/0694b2/" class="sidebar-link">Shell编程基础</a></li><li><a href="/pages/3205c5/" class="sidebar-link">Shell常见命令</a></li><li><a href="/pages/2dbdb3/" class="sidebar-link">Linux性能优化实战(极客时间)🌸</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/0fc243/" class="sidebar-link">网络基础</a></li><li><a href="/pages/ca91df/" class="sidebar-link">数据链路层</a></li><li><a href="/pages/b1e177/" aria-current="page" class="active sidebar-link">网络层</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/0a1ee7/" class="sidebar-link">传输层</a></li><li><a href="/pages/25ec79/" class="sidebar-link">应用层</a></li><li><a href="/pages/08f912/" class="sidebar-link">HTTP基础</a></li><li><a href="/pages/f22543/" class="sidebar-link">HTTP应用与新特性</a></li><li><a href="/pages/2b073d/" class="sidebar-link">HTTPS</a></li><li><a href="/pages/4d1267/" class="sidebar-link">网络安全</a></li><li><a href="/pages/723841/" class="sidebar-link">网络综合问题</a></li></ul></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/basic/#基础" data-v-06970110>基础</a></li><li data-v-06970110><a href="/basic/#基础" data-v-06970110>基础</a></li><li data-v-06970110><a href="/basic/#网络" data-v-06970110>网络</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/nanodaemony" target="_blank" title="作者" class="beLink" data-v-06970110>NanoDaemony</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2025-02-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">本文目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">网络层<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_3-网络层"><a href="#_3-网络层" class="header-anchor">#</a> 3.网络层</h1> <h4 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h4> <h5 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1.概述</h5> <p>网络层是整个互联网的核心, 因此应当让网络层尽可能<strong>简单</strong>.</p> <p><strong>TCP/IP</strong> 体系中的<strong>网络层</strong>向上只提供<strong>简单灵活的</strong>, <strong>无连接</strong>的, <strong>尽最大努力交付</strong>的<strong>数据报服务</strong>. 网络层不提供服务质量的承诺, 不保证分组交付的时限, 所传送的分组<strong>可能出错</strong>, 丢失, 重复, 和失序.</p> <p>网络层使用 IP 协议, 可以把<strong>异构</strong>的物理网络连接起来, 使得在网络层看起来好像是一个<strong>统一的网络</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220421232532591.png" alt="" title="网络层结构"></p> <h5 id="_2-互联网络"><a href="#_2-互联网络" class="header-anchor">#</a> 2.互联网络</h5> <p><strong>虚拟互连网络</strong>指互连起来的各种物理网络, 通过 <strong>IP 协议</strong>使这些性能各异的网络从用户看起来就是<strong>一个统一的网络</strong>. 当互连网上的主机进行通信时, 就好像在一个网络上通信, 而看不见互连的各具体<strong>网络异构</strong>的细节.</p> <p>需要使用一些<strong>中间设备</strong>来使<strong>异构的网络互相连接</strong>起来, <strong>4 种中间设备</strong>:</p> <ul><li><strong>物理层</strong>中继系统: <strong>转发器</strong>. 只能简单地接受数据帧, 然后把数据发往更远的网络结点, 只能用于同种网络的物理层上.</li> <li><strong>数据链路层</strong>中继系统: <strong>以太网交换机</strong>. 交换机能同时连通多对端口, 使每一对相互通信的主机都能无冲突地传输数据.</li> <li><strong>网络层</strong>中继系统: <strong>路由器</strong>. 不同网络之间发送 IP 数据报需要通过路由器进行间接交付; 同一网络内部发送 IP 数据报可以进行直接交付, 不需要经过路由器. 路由器只涉及到<strong>物理层, 数据链路层和网络层</strong>等三层.</li> <li><strong>网络层以上</strong>的中继系统: <strong>网关</strong>.</li></ul> <p><strong>网络互连</strong>都是用<strong>路由器</strong>进行<strong>网络互连</strong>和<strong>路由选择</strong>.</p> <h4 id="网际协议ip🌟"><a href="#网际协议ip🌟" class="header-anchor">#</a> 网际协议IP🌟</h4> <p>网际层 IP 协议及其配套协议如下图所示.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220421232927108.png" alt="" title="IP协议及其配套协议"></p> <p>与 <strong>IP 协议</strong>配套使用的还有三个协议:</p> <ul><li><strong>地址解析协议 ARP</strong>(Address Resolution Protocol)</li> <li><strong>网际控制报文协议 ICMP</strong>(Internet Control Message Protocol)</li> <li><strong>网际组管理协议 IGMP</strong>(Internet Group Management Protocol)</li></ul> <h5 id="_1-ip地址"><a href="#_1-ip地址" class="header-anchor">#</a> 1.IP地址</h5> <p>IP 地址的编址方式经历了三个阶段:</p> <ul><li>基础分类</li> <li>子网划分</li> <li>无分类</li></ul> <h6 id="_1-基础分类"><a href="#_1-基础分类" class="header-anchor">#</a> (1)基础分类</h6> <p>将 IP 地址划分为若干个<strong>固定类</strong>. 每一类地址都由<strong>两个</strong>固定长度的字段组成, 其中一个字段是<strong>网络号 net-id</strong>, 它标志主机(或路由器)所连接到的<strong>网络</strong>. 而另一个字段则是<strong>主机号 host-id</strong>, 它标志该<strong>主机</strong>(或路由器), 主机号在网络号所指明的网络范围内必须是<strong>唯一</strong>的.</p> <p>这种<strong>二级 IP 地址</strong>结构如下, 共 4 字节 32 位:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423142530848.png" alt="" title="二级IP地址结构"></p> <p>可以记为:</p> <blockquote><p>IP地址 ::= {&lt;网络号&gt;, &lt;主机号&gt;}</p></blockquote> <p><strong>IP 地址的指派范围</strong>:</p> <p>​<img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423143548063.png" alt="" title="IP地址指派范围">​</p> <p>IP 地址是一种<strong>分等级</strong>的地址结构, 互联网<strong>平等对待每一个 IP 地址</strong>.</p> <p>各类 IP 地址的网络号字段和主机号字段如下:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423142754262.png" alt="" title="IP分类"></p> <p><strong>A 类, B 类, C 类</strong>地址<strong>网络号(net-id)<strong>​<strong><strong>字段分别是 1 个, 2 个, 3 个</strong></strong>​</strong>字节长</strong>. 由于 IP 共 4 个字节, 所以 A 类, B 类, C 类地址<strong>主机</strong>号(host-id) <strong>, 分别是 3 个, 2 个, 1 个字节长. <strong>​<strong><strong>而在</strong></strong>​</strong>网络号字段</strong>的最前面有 <strong>1-3 位</strong>固定的<strong>类别号</strong>, 分别为 <mark><strong>0, 10, 110</strong></mark>.</p> <p><strong>D 类</strong>地址(前 4 位是 1110)用于<strong>多播</strong>(一对多通信). E 类地址(前 4 位是 1111)保留以后用.</p> <p>一般不使用的<strong>特殊</strong> IP 地址:</p> <table><thead><tr><th style="text-align:center;">网络号</th> <th style="text-align:center;">主机号</th> <th style="text-align:center;">源地址使用</th> <th style="text-align:center;">目的地址使用</th> <th style="text-align:center;">含义</th></tr></thead> <tbody><tr><td style="text-align:center;">0</td> <td style="text-align:center;">0</td> <td style="text-align:center;">可以</td> <td style="text-align:center;">不可以</td> <td style="text-align:center;">在本网络上的本主机</td></tr> <tr><td style="text-align:center;">0</td> <td style="text-align:center;">host-id</td> <td style="text-align:center;">可以</td> <td style="text-align:center;">不可以</td> <td style="text-align:center;">在本网络上的某台主机host-id</td></tr> <tr><td style="text-align:center;">全1</td> <td style="text-align:center;">全1</td> <td style="text-align:center;">不可以</td> <td style="text-align:center;">可以</td> <td style="text-align:center;">只在本网络上进行广播(各路由器均不转发)</td></tr> <tr><td style="text-align:center;">net-id</td> <td style="text-align:center;">全1</td> <td style="text-align:center;">不可以</td> <td style="text-align:center;">可以</td> <td style="text-align:center;">对net-id上的所有主机进行广播</td></tr> <tr><td style="text-align:center;">127</td> <td style="text-align:center;">非全0或全1</td> <td style="text-align:center;">可以</td> <td style="text-align:center;">可以</td> <td style="text-align:center;">用于本地软件环回测试</td></tr></tbody></table> <p>Tips: 主机号<strong>全 0</strong>, 代表这个网络的<strong>网络地址</strong>, <strong>主机号全 1 代表广播地址</strong>.</p> <p>IP 地址实际上是标志一个<strong>主机</strong>(或路由器)和一条<strong>链路</strong>的<strong>接口</strong>. 所以<strong>一个路由器</strong>至少应当有<strong>两个不同的 IP 地址</strong>, 在不同的网络中都有一个 IP 地址. 同一个<strong>局域网</strong>上的主机或路由器的 IP 地址中的<strong>网络号必须是一样</strong>的. 用转发器或网桥连接起来的若干个局域网<strong>仍为一个网络</strong>, 它们的<strong>网络号相同</strong>. 不同<strong>网络号</strong>的<strong>局域网</strong>必须使用<strong>路由器</strong>进行互连.</p> <h6 id="_2-子网划分"><a href="#_2-子网划分" class="header-anchor">#</a> (2)子网划分</h6> <p>因为传统的<strong>二级 IP 地</strong>址具有如下缺点: (1)不够灵活; (2)空间<strong>利用率有时很低</strong>; (3)给<strong>每一个物理网络分配一个网络号</strong>会使<strong>路由表变得太大</strong>因而使网络性能变坏. 因此需要划分子网.</p> <p><strong>划分子网的思路与原理</strong>: <strong>从主机号借用若干个位作为子网号 subnet-id</strong>, 主机号也就相应<strong>减少</strong>了若干位. 凡是从其他网络发送给本单位某个主机的 IP 数据报, 仍然是根据 IP 数据报中的<strong>目的网络号</strong>先找到连接在本单位网络上的<strong>路由器</strong>; 然后此路由器在收到 IP 数据报后, 再按目的<strong>网络号</strong>和<strong>子网号</strong>找到<strong>目的子网</strong>; <strong>最后</strong>将 IP 数据报直接交付给目的主机.</p> <p>划分子网后 IP 地址就变成了<strong>三级结构</strong>. 划分子网只是把 IP 地址的<strong>主机号</strong>部分进行再划分, 而<strong>不改变 IP 地址原来的网络号</strong>. 减少了 IP 地址的浪费且使网络的组织更加灵活, 更便于维护和管理. 划分子网增加了灵活性, 但是<strong>减少了</strong>能够连接在网络中的<strong>主机总数</strong>.</p> <p>通过在<strong>主机号</strong>字段中拿一部分作为<strong>子网号</strong>, 把两级 IP 地址划分为<strong>三级 IP</strong> 地址.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423144438787.png" alt="" title="三级IP地址格式"></p> <p>三级 IP 地址可以表示为:</p> <blockquote><p>IP地址 ::= {&lt;网络号&gt;, &lt;子网号&gt;, &lt;主机号&gt;}</p></blockquote> <p>划分子网纯属<strong>一个单位内部</strong>的事情, 这个 单位对外仍然表现为<strong>没有</strong>划分子网的网络, 因为网络号没有变化.</p> <p>划分子网的<strong>例子</strong>: 将一个 B 类 IP 划分成 <strong>3 个</strong>子网, 划分成三个子网后对外仍是一个网络, 外部网络看不到子网的存在.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423144716619.png" alt="" title="单位子网划分示例"></p> <blockquote><p>子网掩码</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>问题: 假定有一个数据报目的地址是 145.13.3.10 且已经到达了路由器 R1, 那么这个路由器如何把它转发到子网 145.13.3.0 呢?  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>IP 数据报的首部并没有给出源或目的主机所在的网络是否划分了子网以及子网的信息, 因此需要使用<strong>子网掩码(subnet mask)<strong>​<strong><strong>来</strong></strong>​</strong>找出</strong> IP 地址中的<strong>子网部分</strong>.</p> <p><strong>路由器在和相邻路由器交换路由信息时, 必须把自己所在网络(或子网)的</strong>​<mark><strong>子网掩码</strong></mark>​<strong>告诉相邻路由器</strong>. 路由器的<strong>路由表中</strong>的每一个项目, 除了要给出<strong>目的网络地址</strong>外, 还必须同时给出该<strong>网络的子网掩码, 没有划分就是默认子网的掩码</strong>. 若一个<strong>路由器</strong>连接在<strong>两个子网</strong>上就拥有<strong>两个网络地址和两个子网掩码</strong>.</p> <p><strong>规则</strong>: 子网掩码的长度还是为 <strong>32 位</strong>. <strong>某位 ＝ 1: IP 地址中的对应位为网络号和子网号</strong>, <strong>某位 ＝ 0: IP 地址中的对应位为主机号</strong>. 子网掩码最好使用连续的 1(避免出错).</p> <p>现在可以通过该子网的<strong>子网掩码</strong>(255.255.255.0)来<strong>找到子网</strong> 145.13.3.0, <strong>子网是根据子网掩码来划分的</strong>. 该路由器子网的子网掩码划分如下图:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423150350873.png" alt="" title="示例子网划分"></p> <p>重要的结论:  <strong>(IP 地址) &amp; (子网掩码) = 网络地址</strong>.</p> <p>注: 同样的 IP 地址和不同的子网掩码也可以得出相同的<strong>网络</strong>地址.</p> <p>A, B, C 类 IP 的<strong>默认</strong>子网掩码如下:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423150128254.png" alt="" title="ABC类IP地址的默认子网掩码"></p> <p>一个 <strong>B 类地址</strong>的默认子网掩码为 <strong>255.255.0.0</strong>, 如果 B 类地址的<strong>子网占两个比特</strong>, 那么子网掩码为 11111111 11111111 11000000 00000000, 也就是 255.255.192.0.</p> <p>子网的划分分为<strong>固定长度和变长子网</strong>, 使用固定长度子网时, 所划分的所有子网的子网掩码都是相同的. 划分子网增加了灵活性, 但却<strong>减少</strong>了能够连接在网络上的<strong>主机总数</strong>.</p> <h6 id="_3-无分类编址cidr"><a href="#_3-无分类编址cidr" class="header-anchor">#</a> (3)无分类编址CIDR</h6> <p>在一个划分子网的网络中可同时使用<strong>几个不同的子网掩码</strong>, 使用<strong>变长子网掩码</strong> <strong>VLSM</strong>(Variable Length Subnet Mask) 可进一步提高 IP 地址资源的利用率. 在 VLSM 的基础上又进一步研究出<strong>无分类编址</strong>方法, 即<strong>无分类域间路由选择 CIDR</strong>.</p> <p><strong>无分类编址 CIDR</strong> 消除了传统 A 类, B 类和 C 类地址以及划分子网的概念, 使用<mark><strong>网络前缀和主机号</strong></mark>来对 IP 地址进行编码, 网络前缀的长度可以根据需要变化.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423150625433.png" alt="" title="无分类编制CIDR"></p> <p>可以表示为:</p> <blockquote><p>IP 地址 ::= {&lt; 网络前缀号 &gt;, &lt; 主机号 &gt;}</p></blockquote> <p>CIDR 的记法上采用在 <strong>IP 地址</strong>后面加上<strong>网络前缀长度</strong>的方法, 例如 128.14.35.7/<strong>20</strong> 表示<strong>前 20 位为网络前缀</strong>(这个数值<strong>对应于三级编址中</strong>​<mark><strong>子网掩码中 1 的个数</strong></mark>). CIDR 的地址掩码可以继续称为子网掩码, 子网掩码<strong>首 1 长度为网络前缀的长度</strong>.</p> <p><strong>CDIR 地址块</strong>: CIDR 把<strong>网络前缀都相同</strong>的连续的 <strong>IP 地址</strong>组成 &quot;CIDR 地址块&quot;. <strong>只要知道 CIDR 地址块中的任何一个地址, 就可以知道该地址块的最小地址, 最大地址, 地址数. <strong>​<strong><strong>如: 128.14.32.0/20 表示的地址块共有 212 个地址(因为斜线后面的 20 是网络前缀的位数, 所以这个地址的</strong></strong>​</strong>主机号是 12 位</strong>), 最小地址 128.14.32.0 最大地址 128.14.47.255.</p> <p>一个 CIDR 地址块中有很多地址, 一个 CIDR 表示的网络就可以表示原来的<strong>很多个网络</strong>, 并且在路由表中只需要<strong>一个路由</strong>就可以代替原来的多个路由, <strong>减少了路由表项</strong>的数量. 把这种通过使用<strong>网络前缀</strong>来减少路由表项的方式称为<strong>路由聚合</strong>(可理解为把多个网络聚合在了一起), 也称为<strong>构成超网</strong>. <strong>路由聚合有利于减少路由器之间的路由选择信息的交换</strong>, 从而提高了整个互联网的性能.</p> <p>在路由表中的项目由 &quot;网络前缀&quot; 和 &quot;下一跳地址&quot; 组成, 在查找时可能会得到不止一个匹配结果. 之所以会有多个结果, 是因为地址块又划分了地址块, 如 ISP 给大学地址块, 大学给院系划分地址块, 应当采用<strong>最长前缀</strong>匹配来确定应该匹配哪一个. 因为<strong>网络前缀越长, 其地址块就越小, 因而路由就越具体</strong>.</p> <p>划分举例: 这个 ISP 共有 64 个 <strong>C 类</strong>网络. 如果不采用 CIDR 技术, 则在与该 ISP 的路由器交换路由信息的每一个<strong>路由器的路由表</strong>中, 就需要有 64 个项目. 但采用<strong>地址聚合</strong>后, 只需用路由聚合后的 <strong>1 个项目</strong> 206.0.64.0/18 就能找到该 ISP.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423152551768.png" alt="" title="ISP划分示例"></p> <h5 id="_2-ip地址与硬件地址的联系"><a href="#_2-ip地址与硬件地址的联系" class="header-anchor">#</a> 2.IP地址与硬件地址的联系</h5> <p>从分层角度看, <strong>硬件/物理地址(MAC 地址)<strong>​<strong><strong>是</strong></strong>​</strong>数据链路层</strong>和<strong>物理层</strong>使用的地址. <strong>IP 地址</strong>是<strong>网络层和以上各</strong>层使用的地址, 是一种<strong>逻辑地址</strong>, 称 IP 地址为逻辑地址是因为它是用<strong>软件实现</strong>的. IP 数据报一旦交给了<strong>数据链路层</strong>就被封装成了 <strong>MAC 帧</strong>, <strong>硬件地址</strong>放在 <strong>MAC 帧</strong>的首部.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423153547138.png" alt="" title="IP地址与硬件地址的区别"></p> <p><strong>路由器只根据目的主机的 IP 地址的网络号进行路由选择. 在具体的物理网络的链路层只能看见 MAC 帧而看不见 IP 数据报. 在 IP 层抽象的互联网上只能看到 IP 数据报. IP 地址放在 IP 数据报的首部, 而硬件地址放在 MAC 帧的首部. 在网络层和网络层以上使用的是 IP 地址, 而数据链路层及以下使用的是硬件地址. 整个 IP 数据报成为 MAC 帧中的数据部分, 因而在数据链路层看不见数据报的 IP 地址</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423155409051.png" alt="" title="从协议栈的层次看数据的流动"></p> <p><strong>IP 数据报</strong>的首部的源地址和目的地址是<strong>不变</strong>的, 而 <strong>MAC 帧</strong>首部中的 MAC 源地址和目的地址却是在<strong>不断变换</strong>的(通过不同的网络). IP 层<strong>抽象</strong>的互联网<strong>屏蔽</strong>了下层很复杂的细节, 在抽象的网络层上讨论问题, 就能够使用统一的, 抽象的 IP 地址研究主机和主机或主机和路由器之间的通信.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423160450343.png" alt="" title="从虚拟的IP层上看IP数据报的流动"></p> <h5 id="_3-地址解析协议arp"><a href="#_3-地址解析协议arp" class="header-anchor">#</a> 3.地址解析协议ARP</h5> <h6 id="_1-概述-2"><a href="#_1-概述-2" class="header-anchor">#</a> (1)概述</h6> <p>不管在网络层上使用的是什么协议, 在实际网络的链路上传送数据帧时, 最终还是必须使用<strong>硬件地址</strong>. 知道了 MAC 地址和 IP 地址的区别及工作层次后, 不禁又产生了疑问: 主机或路由器怎么知道应当在 <strong>MAC 帧</strong>的首部填入什么样的<strong>硬件地址</strong>? 路由器中的<strong>路由表</strong>又是怎么得出的?</p> <p>先来看第一个问题, 第一个问题的答案就是使用<strong>地址解析协议APR: 从网络层使用的 IP 地址解析出在数据链路层使用的 MAC 硬件地址</strong>, 然后将 <strong>MAC 地址放到 MAC 帧的首部</strong>.</p> <p>它是怎么解析的? 每一个主机都设有一个 <strong>ARP 高速缓存</strong>(ARP cache), 里面有所在的局域网上的各主机和路由器的 <strong>IP 地址</strong>到<strong>硬件地址(MAC地址)</strong> 的<strong>映射表</strong>. 由于高速缓存存放最近获得的 IP 地址到 MAC 地址的绑定, 这可以<strong>减少 ARP 广播的数量</strong>.</p> <p>APR <strong>要点</strong>: <mark><strong>ARP 解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题</strong></mark>. <strong>如果所要找的主机和源主机不在同一个局域网上, 那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址, 然后把分组发送给这个路由器, 让这个路由器把分组转发给下一个网络. 剩下的工作就由下一个网络来做</strong>.</p> <p><strong>网络层</strong>实现<strong>主机之间的通信</strong>, 而链路层实现具体每段链路之间的通信. 因此在通信过程中, <strong>IP 数据报的源地址和目的地址始终不变</strong>, 而 <strong>MAC 地址</strong>随着链路的<strong>改变而改变</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423161607052.png" alt="" title="ARP协议流程"></p> <blockquote><p>既然在网络链路上传送的帧最终是按照硬件地址找到目的主机的, 那么为什么还要使用抽象的 IP 地址?</p></blockquote> <p>这是因为 IP 地址的分配是根据网络的<strong>拓扑结构</strong>, 而不是根据谁制造了网络设置. 全世界存在<strong>各式各样的网络</strong>, 它们使用<strong>不同的硬件地址</strong>. 要使这些<strong>异构网络</strong>能够互相通信就必须进行<strong>非常复杂的硬件地址转换</strong>工作, 因此几乎是不可能的事. 所以还是要通过 IP 地址来使这个问题简单化, 在虚拟的 IP 网络上用 IP 地址进行通信给广大的计算机用户带来了很大的方便.</p> <h6 id="_2-arp工作流程"><a href="#_2-arp工作流程" class="header-anchor">#</a> (2)ARP工作流程</h6> <p><mark><strong>ARP 实现由 IP 地址得到 MAC 地址的转换</strong></mark>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423161737065.png" alt="" title="ARP与其他协议的关系"></p> <p>如果主机 A 知道该网络中主机 B 的 <strong>IP 地址</strong>, 但是 ARP 高速缓存中<strong>没有</strong>该 IP 地址到 MAC 地址的<strong>映射</strong>, 此时主机 A 通过<strong>广播的方式发送 ARP 请求分组</strong>, 主机 B 收到该请求后会发送 ARP 响应分组给主机 A <strong>告知其 MAC 地址</strong>, 随后主机 A 向其 ARP 高速<strong>缓存中写入</strong>主机 B 的 IP 地址到 MAC 地址的<strong>映射</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423162115616.png" alt="" title="ARP工作流程"></p> <h5 id="_4-ip数据报格式"><a href="#_4-ip数据报格式" class="header-anchor">#</a> 4.IP数据报格式</h5> <p>一个 <strong>IP 数据报</strong>由<strong>首部和数据</strong>两部分组成. <strong>首部</strong>的<strong>前一部分是固定</strong>长度, 共 <strong>20</strong> 字节, 是<strong>所有 IP 数据报必须具有</strong>的. 在首部的固定部分的后面是一些可选字段, 其长度是可变的.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423162447479.png" alt="" title="IP数据报格式"></p> <ul><li><strong>版本</strong>: 有 4(IPv4) 和 6(IPv6) 两种取值.</li> <li><strong>首部长度</strong>: 占 <strong>4 位</strong>, 因此最大值为 15. 值为 1 表示的是 1 个 32 位字的长度, 也就是 4 字节. 因为固定部分长度为 20 字节, 因此该值最小为 5. 如果可选字段的长度不是 4 字节的整数倍, 就用尾部的<strong>填充</strong>部分来填充.</li> <li><strong>区分服务</strong>: 用来获得更好的服务, 一般情况下不使用.</li> <li><strong>总长度</strong>: 包括首部长度和数据部分长度. 最长 <strong>65536</strong> 字节, 但总长度也不能超过<strong>数据链路层</strong>的<strong>最大传输单元 MTU</strong> 的长度, 超过需要对数据报进行<strong>分片</strong>处理.</li> <li><strong>生存时间(TTL)</strong> : 用于防止无法交付的数据报在网络中不断兜圈子. 以路由器<strong>跳数</strong>为单位, 每经过一个路由器就会<strong>减 1</strong>. 当 <strong>TTL 为 0</strong> 时就<strong>丢弃</strong>数据报. TTL 为 1 则只能在<strong>本局域网</strong>中传播.</li> <li><strong>协议</strong>: 指出携带的数据应该上交给<strong>什么协议</strong>进行处理, 例如 ICMP, TCP, UDP , IP, IPv6, OSPF 等.</li> <li><strong>首部检验和</strong>: 由于数据报每经过一个<strong>路由器</strong>, 都要重新<strong>计算检验和</strong>, 因此检验和不包含数据部分可以减少计算的工作量.</li> <li><strong>标识</strong>: 在数据报长度过长从而<strong>发生分片</strong>的情况下, 相同数据报的不同分片具有<strong>相同的标识符</strong>.</li> <li><strong>片偏移</strong>: 和标识符一起, 用于<strong>发生分片</strong>的情况. 片偏移的<strong>单位</strong>为 8 字节. 各分出的数据片需要复制原来的头部信息但是改一下片偏移信息, 由此判断不同分片属于同一个数据报.</li> <li><strong>源地址</strong>: 4 字节.</li> <li><strong>目的地址</strong>: 4 字节.</li> <li><strong>可选字段</strong>: 长度可变, 从 1 个字节到 40 个字节不等, 取决于所选择的项目, 用来支持排错, 测量以及安全等措施, 内容很丰富. 填充部分, 用 0 填充使可选字段的长度是 4 字节的整数倍.</li></ul> <h5 id="_5-ip层转发分组流程"><a href="#_5-ip层转发分组流程" class="header-anchor">#</a> 5.IP层转发分组流程</h5> <p>在 IP 层转发分组是通过查找<strong>路由表</strong>来实现的, 那么为什么通过<strong>查找路由表</strong>就可以知道该<strong>怎么转发分组</strong>呢? 路由表里又存储的是什么呢?</p> <p>假设: 有四个 A 类网络通过<strong>三个路由器</strong>连接在一起. 每一个网络上都可能有成千上万个<strong>主机</strong>. 若按目的主机号来制作路由表, 那么每一个路由表就有 4 万个项目, 如果每一行对应于一台主机就有 4 万行, 这样路由表就会过于<strong>庞大</strong>. 但若按主机所在的<strong>网络地址</strong>来制作路由表, 如果每一行对应于一个<strong>网络</strong>那么路由表就<strong>只包含 4 行</strong>, 这样就可使路由表大大<strong>简化</strong>.</p> <p>在路由表中, 对每一条路由最重要的就是 <strong>: 目的网络地址, 下一跳地址</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423163056020.png" alt="" title="路由表示例"></p> <p>根据目的<strong>网络地址</strong>就能确定<strong>下一跳路由器</strong>, 这样做的结果是: <strong>IP 数据报最终一定可以找到目的主机所在目的网络上的路由器(可能要通过多次的间接交付)</strong> . 只有到达<strong>最后一个路由器</strong>时, 才试图向目的主机进行<strong>直接交付</strong>.</p> <ul><li><strong>特定主机路由</strong>: 虽然所有分组转发都是基于<strong>目的主机</strong>所在的<strong>网络</strong>, 但多数情况下都允许为特定的目的主机<strong>指明一个路由</strong>. 采用特定主机路由可使网络管理人员能更方便地控制和测试网络, 同时也可在需要考虑某种安全问题时采用这种特定主机路由.</li> <li><strong>默认路由</strong>: 路由器还可采用<strong>默认路由</strong>以减少路由表所占用的空间和搜索路由表所用的时间. 这种转发方式在一个网络只有<strong>很少的对外连接</strong>时是很有用的.</li></ul> <blockquote><p>路由器分组转发算法</p></blockquote> <p>路由器分组转发算法流程如下:</p> <ul><li>(1) 从数据报的<strong>首部</strong>提取<strong>目的主机</strong>的 <strong>IP 地址 D</strong>, 得出目的<strong>网络地址为 N</strong>.</li> <li>(2) 若网络 N 与此<strong>路由器直接相连</strong>, 则把数据报<strong>直接交付</strong>目的主机 D; 否则是<strong>间接交付</strong>, 执行 (3).</li> <li>(3) 若路由表中有目的地址为 D 的<strong>特定主机路由</strong>, 则把数据报传送给<strong>路由表中所指明的下一跳路由器</strong>; 否则执行 (4).</li> <li>(4) 若路由表中有到达网络 N 的路由, 则把数据报传送给路由表指明的<strong>下一跳</strong>路由器; 否则, 执行 (5).</li> <li>(5) 若路由表中有一个<strong>默认路由</strong>, 则把数据报传送给路由表中所指明的<strong>默认路由器</strong>; 否则, 执行 (6).</li> <li>(6) 报告转发分组<strong>出错</strong>.</li></ul> <p>当<strong>路由器</strong>收到待转发的<strong>数据报</strong>, 不是将下一跳路由器的 <strong>IP 地址</strong>填入 IP 数据报, 而是送交下层的<strong>网络接口软件</strong>. 网络接口软件使用 <strong>ARP</strong> 负责将<strong>下一跳路由器的 IP 地址</strong>转换成<strong>硬件地址</strong>, 并将此硬件地址放在链路层的 <strong>MAC 帧的首部</strong>, 然后根据这个<strong>硬件地址找到下一跳路由器</strong>.</p> <blockquote><p>使用子网时分组的转发</p></blockquote> <p>前面的流程是在<strong>不划分子网</strong>时的分组转发, 在划分子网后该怎么转发分组? 可以知道这两者的区别<strong>仅仅</strong>在于能不能<strong>直接得到目的地址的网络地址</strong>. 划分子网后, <strong>网络地址</strong>不仅取决于 IP 地址, 还要取决于<strong>子网掩码</strong>. 所以转发<strong>分组算法</strong>如下:</p> <ul><li>(1) 从收到的分组的首部提取<strong>目的 IP 地址 D</strong>.</li> <li>(2) 先用各网络的<strong>子网掩码和 D 逐位相 &quot;与&quot;</strong> , 看是否和相应的网络地址匹配. 如果匹配则将分组<strong>直接交付</strong>; 否则就是间接交付, 然后执行 (3).</li> <li>(3) 若路由表中有目的地址为 D 的特定主机路由, 则将分组传送给指明的下一跳路由器; 否则执行 (4).</li> <li>(4) 对路由表中的每一行, 将<strong>子网掩码和 D 逐位相 &quot;与&quot;</strong> . 若结果与该行的目的网络地址匹配, 则将分组传送给该行指明的下一跳路由器; 否则执行 (5).</li> <li>(5) 若路由表中有一个<strong>默认路由</strong>, 则将分组传送给路由表中所指明的默认路由器; 否则执行 (6).</li> <li>(6) 报告转发分组出错.</li></ul> <h4 id="网际控制报文协议icmp🌟"><a href="#网际控制报文协议icmp🌟" class="header-anchor">#</a> 网际控制报文协议ICMP🌟</h4> <p><strong>ICMP 是检测传输网络是否通畅, 主机是否可达, 路由是否可用等网络运行状态的协议. <strong>​<strong><strong>它不传输用户数据, 但对于</strong></strong>​</strong>评估网络健康状态</strong>非常重要.</p> <p>它<strong>封装</strong>在 IP 数据报中, 但是<strong>不属于</strong>高层协议.</p> <h5 id="_1-icmp的种类"><a href="#_1-icmp的种类" class="header-anchor">#</a> 1.ICMP的种类</h5> <p>ICMP 报文的种类有<strong>两种</strong>, 即 <mark><strong>ICMP 差错报告报文</strong></mark>​<mark>和 </mark>​<mark><strong>ICMP 询问报文</strong></mark>. 报文类型如下.</p> <p>ICMP <strong>差错报告</strong>报文共有 4 种: <strong>终点不可达</strong>, <strong>时间超过</strong>, <strong>参数问题</strong>, <strong>改变路由(重定向 Redirect)</strong> .</p> <p>ICMP <strong>询问报文</strong>有 2 种: 回送请求和回答报文, 时间戳和回答报文.</p> <table><thead><tr><th style="text-align:center;">ICMP 报文类型</th> <th style="text-align:center;">类型的值</th> <th style="text-align:center;">ICMP 报文含义</th></tr></thead> <tbody><tr><td style="text-align:center;">差错报告报文</td> <td style="text-align:center;">3</td> <td style="text-align:center;"><strong>终点不可达</strong></td></tr> <tr><td style="text-align:center;">差错报告报文</td> <td style="text-align:center;">11</td> <td style="text-align:center;"><strong>时间超过</strong></td></tr> <tr><td style="text-align:center;">差错报告报文</td> <td style="text-align:center;">12</td> <td style="text-align:center;"><strong>参数问题</strong></td></tr> <tr><td style="text-align:center;">差错报告报文</td> <td style="text-align:center;">5</td> <td style="text-align:center;"><strong>改变路由(重定向)</strong></td></tr> <tr><td style="text-align:center;">询问报文</td> <td style="text-align:center;"><strong>8 或 0</strong></td> <td style="text-align:center;"><strong>回送(Echo)请求或应答(ping)</strong></td></tr> <tr><td style="text-align:center;">询问报文</td> <td style="text-align:center;">13 或 14</td> <td style="text-align:center;">时间戳请求或应答</td></tr></tbody></table> <h5 id="_2-icmp协议应用"><a href="#_2-icmp协议应用" class="header-anchor">#</a> 2.ICMP协议应用</h5> <h6 id="_1-ping"><a href="#_1-ping" class="header-anchor">#</a> (1)Ping</h6> <p>Ping 是 <strong>ICMP</strong> 的一个重要应用, 主要用来测试两台主机之间的<strong>连通性</strong>.</p> <p>Ping 的原理是通过向目的主机发送 <strong>ICMP Echo 请求报文</strong>, 目的主机收到后会发送 <strong>Echo 回答报文</strong>. Ping 会根据时间和成功响应的次数估算出数据包往返时间以及丢包率.</p> <h6 id="_2-traceroute"><a href="#_2-traceroute" class="header-anchor">#</a> (2)Traceroute</h6> <p><strong>Traceroute</strong> 用来跟踪一个<strong>分组从源点到终点的路径</strong>. Traceroute 发送的 IP 数据报<strong>封装</strong>的是无法交付的 <strong>UDP 用户数据报</strong>, 并由目的主机发送终点不可达差错报告报文.</p> <h4 id="路由选择协议"><a href="#路由选择协议" class="header-anchor">#</a> 路由选择协议</h4> <h5 id="_1-概述-3"><a href="#_1-概述-3" class="header-anchor">#</a> 1.概述</h5> <p>互联网规模巨大, 各个单位一般不希望暴露自己内部网络的布局, 所以可以把互联网划分为多个小的<strong>自治系统 AS</strong>(Autonomous System), 一<strong>个 AS 对其他 AS 表现出的是一个单一的和一致的路由选择策略</strong>.</p> <p>互联网采用<strong>分层次</strong>的<strong>路由选择协议</strong>, <strong>路由协议</strong>就是讨论<strong>路由表</strong>是怎么得到的.</p> <p><strong>两大类路由选择协议</strong>:</p> <ul><li><strong>内部网关协议 IGP</strong>(Interior Gateway Protocol): 具体协议有 <strong>RIP 协议, OSPF 协议</strong>等.</li> <li><strong>外部网关协议 EGP</strong>(Extern Gateway Protocol): 具体协议有 <strong>BGP</strong>.</li></ul> <p>一个<strong>自治系统内部</strong>可以使用<strong>不同的内部网关协议</strong>, 如 <strong>RIP 协议, OSPF 协议</strong>. 两个<strong>自治系统之间</strong>使用<strong>外部网关协议</strong>进行路由选择, 如 <strong>BGP 协议</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423164554930.png" alt="" title="路由选择协议"></p> <h5 id="_2-内部网关协议之rip"><a href="#_2-内部网关协议之rip" class="header-anchor">#</a> 2.内部网关协议之RIP</h5> <p>RIP 是一种<strong>分布式的, 基于距离向量</strong>的路由选择协议. RIP 协议要求网络中的<strong>每一个路由器</strong>都要维护从<strong>它自己到其他每一个</strong>目的网络的<strong>距离记录</strong>. RIP 认为一个好的路由就是它通过的<strong>路由器的数目少</strong>, 即 &quot;距离短&quot;. <strong>RIP 允许一条路径最多只能包含 15 个路由器</strong>. &quot;距离&quot; 的最大值为 16 时即相当于<strong>不可达</strong>. RIP 选择一个具有<strong>最少路由器的路由</strong>(即<strong>最短路由</strong>), 哪怕还存在另一条<strong>高速</strong>(低时延)但路由器较多的路由. 可见 <strong>RIP 只适用于小型互联网</strong>. <strong>RIP 不能在两个网络之间同时使用多条路由</strong>.</p> <p><strong>RIP 的三个特点</strong>:</p> <ul><li>仅和<strong>相邻路由器</strong>交换信息.</li> <li>交换的信息是当前本路由器所知道的<strong>全部信息</strong>, 即自己的路由表.</li> <li>按<strong>固定的时间间隔</strong>交换路由信息, 例如每隔 30 秒. 当网络拓扑发生变化时, 路由器也及时向<strong>相邻路由器</strong>通告拓扑变化后的路由信息.</li></ul> <p><strong>路由表的建立(通过距离向量算法)</strong> : 路由器在刚开始工作时, 它的路由表是空的, <strong>只知道到直接连接的网络的距离</strong>(此距离定义为 1). 以后<strong>每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息. 经过若干次更新后, 所有的路由器最终都会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器的地址</strong>.</p> <p><strong>距离向量算法</strong>的基础就是 <strong>Bellman-Ford</strong> 算法, 要点: 设 X 是结点 A 到 B 的最短路径上的一个结点.  若把路径 A -&gt; B 拆成两段路径 A -&gt; X 和 X -&gt; B, 则每一段路径 A -&gt; X 和 X -&gt; B 也都分别是结点 A 到 X 和结点 X 到 B 的最短路径.</p> <p>RIP 协议使用运输层的用户数据报 <strong>UDP</strong> 进行传送.</p> <p><strong>RIP 协议特性</strong>: <strong>好消息传播得快, 坏消息传播得慢</strong>. RIP 存在的一个问题: 当网络出现<strong>故障</strong>时, 要经过比较长的时间(如数分钟)才能将此信息传送到所有的路由器(坏消息传的慢). 仅适用于规模小的网络. 其最大的优点是实现简单, 开销较小.</p> <h5 id="_3-内部网关协议之ospf"><a href="#_3-内部网关协议之ospf" class="header-anchor">#</a> 3.内部网关协议之OSPF</h5> <p><strong>开放最短路径优先 OSPF</strong>(Open Shortest Path First) 是为克服 RIP 的缺点而开发的. <strong>适用于规模较大的网络</strong>. <strong>OSPF</strong> 最主要的特征就是使用<strong>分布式的链路状态控制协议</strong>, 而不是像 RIP 那样的<strong>距离向量协议</strong>.</p> <p>OSPF 简单说就是<strong>两个相邻的路由器</strong>通过发<strong>报文的形式成为邻居关系</strong>, 邻居再<strong>相互发送链路状态</strong>信息形成邻接关系, 之后各自根据<strong>最短路径算法</strong>算出路由, 放在 <strong>OSPF 路由表</strong>, OSPF 路由与其他路由比较后优的加入<strong>全局路由表</strong>.</p> <p>与 RIP 不同的是:</p> <ul><li>向本自治系统中<strong>所有路由器</strong>发送信息, 使用的是<strong>洪泛法</strong>.</li> <li>发送的信息就是与本路由器<strong>相邻</strong>的所有路由器的链路状态, 但这只是路由器所知道的<strong>部分信息</strong>.</li> <li>只有当<strong>链路状态发生变化</strong>时, 路由器才向所有路由器使用洪泛法发送此消息.</li></ul> <p><strong>链路状态数据库</strong>: 由于各路由器之间<strong>频繁地</strong>交换链路状态信息, 因此<strong>所有的路由器</strong>最终都能建立一个<strong>链路状态数据库</strong>. 这个数据库实际上就是<strong>全网的拓扑结构图</strong>, 它在<strong>全网范围内是一致</strong>的, 这称为链路状态数据库的同步. OSPF 的链路状态数据库能<strong>较快地进行更新</strong>, 使各个路由器能及时更新其路由表. OSPF 的<strong>更新过程收敛得快</strong>是其重要的<strong>优点</strong>.</p> <p>为了使 OSPF 能够用于<strong>规模很大</strong>的网络, OSPF 将一个<strong>自治系统再划分为若干个更小的范围</strong>, 叫做<strong>区域</strong>. 区域也不能太大, 一个区域内的路由器最好不超过 200 个. 如下图. 路由器就可以分为主干路由器和区域边界路由等.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423165252505.png" alt="" title="OSPF协议"></p> <p>OSPF <strong>不用 UDP</strong> 而是<strong>直接使用 IP 数据报</strong>传送, 可以减少路由信息的通信量. OSPF 分组被当成 IP 数据报的数据部分.</p> <h5 id="_4-外部网关协议之bgp"><a href="#_4-外部网关协议之bgp" class="header-anchor">#</a> 4.外部网关协议之BGP</h5> <p>AS <strong>之间</strong>的路由选择<strong>很困难</strong>, 主要是由于:</p> <ul><li>互联网规模很大;</li> <li>各个 AS 内部使用<strong>不同</strong>的路由选择协议, 无法准确定义路径的度量;</li> <li>AS 之间的路由选择必须考虑有关的策略, 比如有些 AS 不愿意让其它 AS 经过.</li></ul> <p><strong>BGP</strong>(Border Gateway Protocol, 边界网关协议), 是<strong>不同自治系统的路由器之间</strong>交换路由信息的协议, 采用了<strong>路径向量路由选择协议</strong>. BGP 只能尽量寻找一条<strong>比较好</strong>的路由, 而<strong>不是最佳</strong>路由.</p> <p><strong>每个 AS</strong> 都必须配置 <strong>BGP 发言人</strong>, 通过在两个相邻 BGP 发言人之间<strong>建立 TCP 连接</strong>来交换路由信息.</p> <p><strong>BGP 发言人</strong>: 每一个自治系统的管理员要选择至少一个<strong>路由器</strong>作为该自治系统的 &quot;<strong>BGP 发言人</strong>&quot;. 一般说来, 两个 BGP 发言人都是通过一个<strong>共享网络</strong>连接在一起的, 而 BGP 发言人往往就是 <strong>BGP 边界路由器</strong>. 每个 BGP 发言人除了运行 BGP 协议外, 还必须运行该自治系统所使用的<strong>内部网关协议</strong>, 如 OSPF 或 RIP 协议.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423165504592.png" alt="" title="BGP协议"></p> <h5 id="_5-路由器"><a href="#_5-路由器" class="header-anchor">#</a> 5.路由器</h5> <p>路由器从功能上可以划分为: <strong>路由选择和分组转发</strong>, 转发分组只涉及<strong>网络层</strong>. 它按照收到的分组要去的目的地(即目的网络), 把该<strong>分组从某个合适的输出端口转发给下一跳路由器</strong>.</p> <p>路由器是一种<strong>网络层</strong>设备, 所以路由器只有下面<strong>三层协议</strong>, 因为路由器位于网络核心, 不需要为进程或应用程序提供服务, 因此也就不需要传输层和应用层.</p> <p><strong>转发和路由选择</strong>的区别: &quot;转发&quot;(Forwarding) 是路由器根据转发表将用户的 IP 数据报<strong>从合适的端口转发</strong>出去. &quot;路由选择&quot;(routing) 则是按照<strong>分布式算法</strong>, 根据从各相邻路由器得到的关于网络拓扑的变化情况, 动态地改变所选择的路由. <strong>路由表是根据路由选择算法得出的</strong>, 而<strong>转发表是从路由表得出的</strong>.</p> <p>若接收到的分组是路由器之间<strong>交换路由信息</strong>的分组(如 RIP 或 OSPF 分组), 则把这种分组交给路由器中路由选择部分的路由选择处理机进行处理. 若接收到的分组是<strong>数据分组</strong>, 则按照分组首部中的目的地址查找转发表, 根据结果分组就经过交换机构到达合适的输出端口.</p> <h5 id="_6-交换机和路由器的区别"><a href="#_6-交换机和路由器的区别" class="header-anchor">#</a> 6.交换机和路由器的区别</h5> <ul><li><strong>交换机</strong>是做<strong>端口扩展的</strong>, 用于<strong>扩大局域网</strong>(通常都是以太网)的接入点, 能让局域网可以接入更多主机. 而<strong>路由器</strong>是用来做<strong>网间连接</strong>, 用于连接不同的局域网.</li> <li><strong>交换机</strong>工作在<strong>中继层</strong>, 交换机<strong>根据 MAC 地址寻址</strong>. 路由器工作在<strong>网络层</strong>, 根据 <strong>IP 地址寻址</strong>, 路由器可以处理 TCP/IP 协议, 而交换机不可以.</li> <li>路由器可以提供<strong>防火墙</strong>的服务, 交换机不能提供该功能. 路由器仅仅转发特定地址的数据包, 不传送不支持路由协议的数据包传送和未知目标网络数据包的传送, 可以防止广播风暴.</li></ul> <h4 id="ipv6🌟"><a href="#ipv6🌟" class="header-anchor">#</a> IPv6🌟</h4> <h5 id="_1-ipv6格式"><a href="#_1-ipv6格式" class="header-anchor">#</a> 1.IPv6格式</h5> <p>IPv6 仍支持<strong>无连接</strong>的传送, 但将协议数据单元 <strong>PDU</strong> 称为<strong>分组</strong>. IPv6 数据报由两大部分组成: <strong>基本首部</strong>(base header) <strong>有效载荷</strong>(payload). 有效载荷允许有零个或多个扩展首部(extension header), 再后面是数据部分.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423170044615.png" alt="" title="IPv6数据报格式"></p> <p>IPv6 的<strong>基本首部</strong>长度<strong>固定为 40 字节</strong>. IPv6 首部的字段数减少到只有 8 个.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423170403686.png" alt="" title="IPv6首部格式"></p> <p>字段含义如下:</p> <ul><li><strong>版本</strong>(Version): 4 位. 协议版本, 对 IPv6 该字段总是 6.</li> <li><strong>通信量类</strong>(Traffic Class): 8 位. 用于区分不同的 IPv6 数据报的类别或优先级.</li> <li><strong>流标号</strong>(Flow Label): 20 位.  <strong>&quot;流&quot;</strong>  是互联网络上从特定源点到特定终点的一系列数据报, &quot;流&quot; 所经过的路径上的路由器都保证指明的服务质量. 所有属于同一个<strong>流的数据报都具有同样的流标号</strong>.</li> <li><strong>有效载荷长度</strong>(Payload Length): 16 位. 指明 IPv6 数据报除基本首部以外的字节数(所有扩展首部都算在有效载荷之内), 其最大值是 64 KB.</li> <li><strong>下一个首部</strong>(Next Header): 8 位. 它相当于 IPv4 的协议字段或可选字段.</li> <li><strong>跳数限制</strong>(Hop Limit): 8 位. 源站在数据报发出时即设定跳数限制. 路由器在转发数据报时将跳数限制字段中的值减 1. 当跳数限制的值为零时, 就要将此数据报丢弃.</li> <li><strong>源地址</strong>: 128 位. 是数据报的发送站的 IP 地址.</li> <li><strong>目的地址</strong>: 128 位. 是数据报的接收站的 IP 地址.</li></ul> <h5 id="_2-ipv6地址"><a href="#_2-ipv6地址" class="header-anchor">#</a> 2.IPv6地址</h5> <h6 id="_1-概述-4"><a href="#_1-概述-4" class="header-anchor">#</a> (1)概述</h6> <p>一个 IPv6 数据报的<strong>目的地址</strong>可以是以下三种基本类型地址之一:</p> <ul><li><strong>单播</strong>(unicast): 传统的点对点通信.</li> <li><strong>多播</strong>(multicast): 多播是一对多点的通信, 数据报发送到一组计算机中的每一个. IPv6 将广播看作多播的一个特例.</li> <li><strong>任播</strong>(anycast): IPv6 增加的一种类型. 任播的终点是一组计算机, 但数据报只交付给其中的一个, 通常是距离最近的一个.</li></ul> <p>IPv6 把网络中的<strong>主机和路由器</strong>均称为<strong>结点</strong>. IPv6 给结点的每一个接口指派一个 IP 地址, 其中的任何一个地址都可以当作到达该结点的目的地址.</p> <h6 id="_2-冒号十六进制记法"><a href="#_2-冒号十六进制记法" class="header-anchor">#</a> (2)冒号十六进制记法</h6> <p>为使地址简洁, IPv6 使用<strong>冒号十六进制记法</strong>(Colon Hexadecimal Notation, Colon Hex), 把每个 <strong>16 位</strong>的值用<strong>十六进制</strong>表示, 各值之间用<strong>冒号</strong>分隔. 冒号十六进制记法可以允许<strong>零压缩</strong>, 即一连串连续地零可以用<strong>一对冒号</strong>取代, 如 FF05:0:0:0:0:0:0:B3, 可以写成: FF05::B3. 一个地址中只能<strong>使用一次</strong>零压缩.</p> <h6 id="_3-ipv6特殊地址"><a href="#_3-ipv6特殊地址" class="header-anchor">#</a> (3)IPV6特殊地址</h6> <ul><li><strong>全球单播地址</strong>: 使用最多的一类. 可以分为三级, 用 n 比特作为全球路由选择前缀, 用 m 比特作为子网前缀. 剩下的 128 - m - n 位比特作为接口标识符.</li> <li><strong>未指明地址</strong>: 16 字节的<strong>全 0 地址</strong>, 可缩写为两个冒号  <strong>&quot;::&quot;</strong> , 该地址<strong>不能用作目的</strong>地址, 而只能为某个主机当作源地址使用, 条件是这个主机还没有配置到一个标准的 IP 地址.</li> <li><strong>环回地址</strong>: IPv6 的环回地址是 0:0:0:0:0:0:0:1(即  <strong>::1</strong>), 作用与 IPv4 的环回地址一样.</li> <li><strong>基于 IPv4 的地址</strong>: 保留前缀为 0000 0000 的一小部分地址与 IPv4 兼容, 因为比较长的时期内 IPv4 和 IPv6 将会同时存在, 而有的结点不支持 IPv6, 因此数据报在这两类结点之间转发时, 就必须进行地址转换.</li> <li><strong>本地链路单播地址</strong>: 有些网络使用 TCP/IP 协议, 但并没有连接到因特网上. 连接在这样的网络上的主机都可以使用这种本地地址进行通信, 但不能和互联网上的其它主机通信.</li></ul> <h5 id="_3-ipv6的过渡"><a href="#_3-ipv6的过渡" class="header-anchor">#</a> 3.IPv6的过渡</h5> <p>IPv4 向 IPv6 过渡只能采用<strong>逐步演进</strong>的办法, 同时还必须使新安装的 IPv6 系统能够向后兼容: 即 IPv6 系统必须能够接收和转发 IPv4 分组, 并且能够为 IPv4 分组选择路由. 两种向 IPv6 过渡的策略:</p> <ul><li><strong>使用双协议栈</strong>: 使一部分主机(或路由器)装有<strong>两个协议栈</strong>, <strong>一个 IPv4 和一个 IPv6</strong>.</li> <li><strong>使用隧道技术</strong>: 在 IPv6 数据报要<strong>进入 IPv4 网络</strong>时, 把 IPv6 数据报<strong>封装</strong>成为 IPv4 数据报, 整个 IPv6 数据报变成了 IPv4 数据报的<strong>数据部分</strong>. 当 IPv4 数据报离开 IPv4 网络中的<strong>隧道</strong>时, 再把数据部分即原来的 IPv6 数据报交给主机的 IPv6 协议栈.</li></ul> <h4 id="虚拟专用网vpn🌟"><a href="#虚拟专用网vpn🌟" class="header-anchor">#</a> 虚拟专用网VPN🌟</h4> <p>由于 IP 地址的<strong>紧缺</strong>, 一个机构能申请到的 IP 地址数往往远<strong>小于</strong>本机构所拥有的主机数, 并且一个机构并不需要把所有的主机接入到外部的互联网中, 机构内的计算机可以使用仅在<strong>本机构有效的 IP 地址</strong>(专用地址).</p> <p>有三个专用地址块:</p> <ul><li>**10.0.0.0 ~<strong>​ ** 10.255.255.255</strong></li> <li>**172.16.0.0 ~<strong>​ ** 172.31.255.255</strong></li> <li>**192.168.0.0 ~<strong>​ ** 192.168.255.255</strong></li></ul> <p>这些地址仅在<strong>本机构内</strong>使用, 也叫本地地址或<strong>可重用地址</strong>. <strong>路由器对目的地址是专用地址的数据报一律不进行转发</strong>.</p> <p>VPN 使用公网作为本机构各<strong>专用网</strong>之间的通信载体. 专用指机构内的<strong>主机只与本机构内的其它主机通信</strong>.</p> <p>通过公网传送的数据需要进行<strong>加密</strong>. 下图使用 <strong>IP 隧道技术</strong>实现 VPN, 场所 A 和 B 的通信经过互联网, 如果场所 A 的主机 X 要和另一个场所 B 的主机 Y 通信, IP 数据报的源地址是 <strong>10.1.0.1</strong>, 目的地址是 <strong>10.2.0.3</strong>. 数据报先发送到与互联网相连的路由器 <strong>R1</strong>, R1 对内部数据进行<strong>加密</strong>, 然后重新加上数据报的首部, <strong>源地址</strong>是路由器 R1 的<strong>公网地址 125.1.2.3</strong>, <strong>目的地址</strong>是路由器 R2 的<strong>公网地址 194.4.5.6</strong>. 路由器 R2 收到数据报后将数据部分进行<strong>解密</strong>, 恢复原来的数据报, 此时<strong>目的地址为 10.2.0.3</strong>, 就交付给 Y.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423171155129.png" alt="" title="IP隧道技术"></p> <h4 id="网络地址转换nat🌟"><a href="#网络地址转换nat🌟" class="header-anchor">#</a> 网络地址转换NAT🌟</h4> <blockquote><p>问题: 在专用网上使用专用地址的主机如何与互联网上的主机通信(并不需要加密)?</p></blockquote> <p><strong>解决</strong>: (1) 再申请一些公网 IP 地址, 但这不容易做到. (2) 采用<strong>网络地址转换(NAT)</strong> . 这是目前使用得最多的方法, 需要在专用网连接到互联网的<strong>路由器</strong>上安装 <strong>NAT 软件</strong>.</p> <p><strong>专用网</strong>内部的主机使用<strong>本地 IP 地址</strong>又想和互联网上的主机通信时, 可以使用 <mark><strong>NAT 来将本地 IP 转换为公网 IP</strong></mark>.</p> <p><strong>网络地址转换过程</strong>: 内部主机 A 用本地地址 IPA 和互联网上主机 B 通信所发送的<strong>数据报</strong>必须经过 <strong>NAT 路由器</strong>. NAT 路由器将数据报的<strong>源地址 IPA 转换成全球地址 IPG</strong>, 并把<strong>转换结果</strong>记录到 <strong>NAT 地址转换表</strong>中, 目的地址 IPB 保持<strong>不变</strong>, 然后发送到互联网. NAT 路由器收到主机 B 发回的数据报时, 知道数据报中的源地址是 IPB 而目的地址是 IPG. 根据 NAT 转换表, NAT 路由器再将<strong>目的地址 IPG 转换为 IPA</strong>, 转发给最终的内部主机 A.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220423171333170.png" alt="" title="NAT路由器工作原理"></p> <p>‍</p> <p>‍</p> <p>‍</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <ul><li>《计算机网络 第七版 谢希仁》</li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/main/docs/10.基础/1000.基础/300.网络/3.网络层.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/ca91df/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">数据链路层</div></a> <a href="/pages/0a1ee7/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">传输层</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/ca91df/" class="prev">数据链路层</a></span> <span class="next"><a href="/pages/0a1ee7/">传输层</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:1174520425@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/nanodaemony" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2025
    <span>达尔文的猹 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3f3e0e10.js" defer></script><script src="/assets/js/2.e9fcb30c.js" defer></script><script src="/assets/js/3.1998f389.js" defer></script><script src="/assets/js/37.d1824f2f.js" defer></script>
  </body>
</html>
