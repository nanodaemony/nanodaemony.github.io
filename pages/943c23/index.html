<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM内存区域与对象解析 | Pangolin</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="大道至简">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.76d9f797.css" as="style"><link rel="preload" href="/assets/js/app.5bc2c979.js" as="script"><link rel="preload" href="/assets/js/2.eccd4273.js" as="script"><link rel="preload" href="/assets/js/165.a645ef3a.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8038d8.js"><link rel="prefetch" href="/assets/js/100.db890b43.js"><link rel="prefetch" href="/assets/js/101.9b9a913e.js"><link rel="prefetch" href="/assets/js/102.b98098b4.js"><link rel="prefetch" href="/assets/js/103.20eafae5.js"><link rel="prefetch" href="/assets/js/104.5f942f86.js"><link rel="prefetch" href="/assets/js/105.a443c173.js"><link rel="prefetch" href="/assets/js/106.6530e112.js"><link rel="prefetch" href="/assets/js/107.7b05a1d1.js"><link rel="prefetch" href="/assets/js/108.8c45adc4.js"><link rel="prefetch" href="/assets/js/109.ea29e43c.js"><link rel="prefetch" href="/assets/js/11.8d2b228f.js"><link rel="prefetch" href="/assets/js/110.0765054b.js"><link rel="prefetch" href="/assets/js/111.ae06b85d.js"><link rel="prefetch" href="/assets/js/112.b27bb80e.js"><link rel="prefetch" href="/assets/js/113.592e5b3f.js"><link rel="prefetch" href="/assets/js/114.677c3c60.js"><link rel="prefetch" href="/assets/js/115.fb35062d.js"><link rel="prefetch" href="/assets/js/116.19de2d57.js"><link rel="prefetch" href="/assets/js/117.ac783334.js"><link rel="prefetch" href="/assets/js/118.06b27dd3.js"><link rel="prefetch" href="/assets/js/119.cf6bb932.js"><link rel="prefetch" href="/assets/js/12.8764d408.js"><link rel="prefetch" href="/assets/js/120.ba8e09a5.js"><link rel="prefetch" href="/assets/js/121.bc501a72.js"><link rel="prefetch" href="/assets/js/122.c9a3dd47.js"><link rel="prefetch" href="/assets/js/123.b474c20b.js"><link rel="prefetch" href="/assets/js/124.f405a8c5.js"><link rel="prefetch" href="/assets/js/125.24083f67.js"><link rel="prefetch" href="/assets/js/126.3c5c6c33.js"><link rel="prefetch" href="/assets/js/127.b561056f.js"><link rel="prefetch" href="/assets/js/128.58891fb1.js"><link rel="prefetch" href="/assets/js/129.5073fbfd.js"><link rel="prefetch" href="/assets/js/13.1034e1a1.js"><link rel="prefetch" href="/assets/js/130.ca12ca1d.js"><link rel="prefetch" href="/assets/js/131.8e520e7f.js"><link rel="prefetch" href="/assets/js/132.0f186ee2.js"><link rel="prefetch" href="/assets/js/133.1d8479f7.js"><link rel="prefetch" href="/assets/js/134.9c30d69b.js"><link rel="prefetch" href="/assets/js/135.91463dab.js"><link rel="prefetch" href="/assets/js/136.5e57454a.js"><link rel="prefetch" href="/assets/js/137.1d4e51f0.js"><link rel="prefetch" href="/assets/js/138.6cd3ac7f.js"><link rel="prefetch" href="/assets/js/139.7bd789a6.js"><link rel="prefetch" href="/assets/js/14.ead46968.js"><link rel="prefetch" href="/assets/js/140.e1d92390.js"><link rel="prefetch" href="/assets/js/141.23e11057.js"><link rel="prefetch" href="/assets/js/142.c8cc0f38.js"><link rel="prefetch" href="/assets/js/143.fc738cb7.js"><link rel="prefetch" href="/assets/js/144.67c64203.js"><link rel="prefetch" href="/assets/js/145.cc73ed45.js"><link rel="prefetch" href="/assets/js/146.adaac4c0.js"><link rel="prefetch" href="/assets/js/147.0e83b5c1.js"><link rel="prefetch" href="/assets/js/148.1f253a46.js"><link rel="prefetch" href="/assets/js/149.ab428593.js"><link rel="prefetch" href="/assets/js/15.198f32e1.js"><link rel="prefetch" href="/assets/js/150.64cd514e.js"><link rel="prefetch" href="/assets/js/151.ca1ae55a.js"><link rel="prefetch" href="/assets/js/152.4119b23d.js"><link rel="prefetch" href="/assets/js/153.ed663263.js"><link rel="prefetch" href="/assets/js/154.71b836f6.js"><link rel="prefetch" href="/assets/js/155.c47e2e88.js"><link rel="prefetch" href="/assets/js/156.3e91e0f4.js"><link rel="prefetch" href="/assets/js/157.811b1421.js"><link rel="prefetch" href="/assets/js/158.71193c19.js"><link rel="prefetch" href="/assets/js/159.f09778fd.js"><link rel="prefetch" href="/assets/js/16.03096de2.js"><link rel="prefetch" href="/assets/js/160.15d99de4.js"><link rel="prefetch" href="/assets/js/161.813166a0.js"><link rel="prefetch" href="/assets/js/162.c52bbf77.js"><link rel="prefetch" href="/assets/js/163.ada6991a.js"><link rel="prefetch" href="/assets/js/164.d8ceba57.js"><link rel="prefetch" href="/assets/js/166.995d24ad.js"><link rel="prefetch" href="/assets/js/167.d7278e80.js"><link rel="prefetch" href="/assets/js/168.e388905a.js"><link rel="prefetch" href="/assets/js/169.52edabbb.js"><link rel="prefetch" href="/assets/js/17.a49f9c19.js"><link rel="prefetch" href="/assets/js/170.0b62c5b4.js"><link rel="prefetch" href="/assets/js/171.017c8997.js"><link rel="prefetch" href="/assets/js/172.f0763c39.js"><link rel="prefetch" href="/assets/js/173.c961bf43.js"><link rel="prefetch" href="/assets/js/174.395224c0.js"><link rel="prefetch" href="/assets/js/175.52fbdc96.js"><link rel="prefetch" href="/assets/js/176.14e0a3b2.js"><link rel="prefetch" href="/assets/js/177.78f7d89f.js"><link rel="prefetch" href="/assets/js/178.c08bdd65.js"><link rel="prefetch" href="/assets/js/179.b634397c.js"><link rel="prefetch" href="/assets/js/18.9786a034.js"><link rel="prefetch" href="/assets/js/180.284b6c99.js"><link rel="prefetch" href="/assets/js/181.b4744ee7.js"><link rel="prefetch" href="/assets/js/182.8bfd08cd.js"><link rel="prefetch" href="/assets/js/183.59b0b92b.js"><link rel="prefetch" href="/assets/js/184.a5fae95c.js"><link rel="prefetch" href="/assets/js/185.dcf55c72.js"><link rel="prefetch" href="/assets/js/186.6b1cf319.js"><link rel="prefetch" href="/assets/js/187.312708d0.js"><link rel="prefetch" href="/assets/js/188.71de21d0.js"><link rel="prefetch" href="/assets/js/189.7d72c108.js"><link rel="prefetch" href="/assets/js/19.089d6618.js"><link rel="prefetch" href="/assets/js/190.85dce0bd.js"><link rel="prefetch" href="/assets/js/191.08f7136b.js"><link rel="prefetch" href="/assets/js/192.6a155217.js"><link rel="prefetch" href="/assets/js/193.64f71670.js"><link rel="prefetch" href="/assets/js/194.c4d60c72.js"><link rel="prefetch" href="/assets/js/195.748850e9.js"><link rel="prefetch" href="/assets/js/196.887ef31c.js"><link rel="prefetch" href="/assets/js/197.4473c177.js"><link rel="prefetch" href="/assets/js/198.ea53a990.js"><link rel="prefetch" href="/assets/js/199.886f6490.js"><link rel="prefetch" href="/assets/js/20.a52783e8.js"><link rel="prefetch" href="/assets/js/200.7619a798.js"><link rel="prefetch" href="/assets/js/201.d3f5de5f.js"><link rel="prefetch" href="/assets/js/202.ed4c18cc.js"><link rel="prefetch" href="/assets/js/203.7937068e.js"><link rel="prefetch" href="/assets/js/204.3dbdd61c.js"><link rel="prefetch" href="/assets/js/205.52bc6fdf.js"><link rel="prefetch" href="/assets/js/206.4393998f.js"><link rel="prefetch" href="/assets/js/207.ec8e121d.js"><link rel="prefetch" href="/assets/js/208.f54d4e42.js"><link rel="prefetch" href="/assets/js/209.1bc5d06d.js"><link rel="prefetch" href="/assets/js/21.2e3bed21.js"><link rel="prefetch" href="/assets/js/210.2a3dc088.js"><link rel="prefetch" href="/assets/js/211.7084c526.js"><link rel="prefetch" href="/assets/js/212.de742850.js"><link rel="prefetch" href="/assets/js/213.fc775028.js"><link rel="prefetch" href="/assets/js/214.e338168c.js"><link rel="prefetch" href="/assets/js/215.3e89c57e.js"><link rel="prefetch" href="/assets/js/216.ecfe7587.js"><link rel="prefetch" href="/assets/js/217.14dcd4a2.js"><link rel="prefetch" href="/assets/js/218.ee7d57f7.js"><link rel="prefetch" href="/assets/js/219.c263c1e8.js"><link rel="prefetch" href="/assets/js/22.3d09766f.js"><link rel="prefetch" href="/assets/js/220.33f2bfd2.js"><link rel="prefetch" href="/assets/js/221.cd55e739.js"><link rel="prefetch" href="/assets/js/222.63107647.js"><link rel="prefetch" href="/assets/js/223.768ef403.js"><link rel="prefetch" href="/assets/js/224.54357078.js"><link rel="prefetch" href="/assets/js/225.b8e46582.js"><link rel="prefetch" href="/assets/js/226.1d0dcae9.js"><link rel="prefetch" href="/assets/js/227.a351c0a1.js"><link rel="prefetch" href="/assets/js/228.f7b8c278.js"><link rel="prefetch" href="/assets/js/229.8e4aba4d.js"><link rel="prefetch" href="/assets/js/23.b87e3933.js"><link rel="prefetch" href="/assets/js/230.186bd7a5.js"><link rel="prefetch" href="/assets/js/231.dad483e1.js"><link rel="prefetch" href="/assets/js/232.26555358.js"><link rel="prefetch" href="/assets/js/233.658ba0e4.js"><link rel="prefetch" href="/assets/js/234.7994cee0.js"><link rel="prefetch" href="/assets/js/235.3934d057.js"><link rel="prefetch" href="/assets/js/236.59cb6eac.js"><link rel="prefetch" href="/assets/js/237.baa1c655.js"><link rel="prefetch" href="/assets/js/238.8ee9f8ae.js"><link rel="prefetch" href="/assets/js/239.b0fe3966.js"><link rel="prefetch" href="/assets/js/24.afe2a3c4.js"><link rel="prefetch" href="/assets/js/240.d06483fa.js"><link rel="prefetch" href="/assets/js/241.81a2223e.js"><link rel="prefetch" href="/assets/js/242.8f6eee74.js"><link rel="prefetch" href="/assets/js/243.874461fa.js"><link rel="prefetch" href="/assets/js/244.ec0bb622.js"><link rel="prefetch" href="/assets/js/245.2ecf61f8.js"><link rel="prefetch" href="/assets/js/246.e7f6e55c.js"><link rel="prefetch" href="/assets/js/247.f32a1a4b.js"><link rel="prefetch" href="/assets/js/248.4302c4d8.js"><link rel="prefetch" href="/assets/js/249.9b0a4d9f.js"><link rel="prefetch" href="/assets/js/25.a22777b8.js"><link rel="prefetch" href="/assets/js/250.1295326c.js"><link rel="prefetch" href="/assets/js/251.d1cdb160.js"><link rel="prefetch" href="/assets/js/252.4e9d56fe.js"><link rel="prefetch" href="/assets/js/253.5a23b42d.js"><link rel="prefetch" href="/assets/js/254.8777547c.js"><link rel="prefetch" href="/assets/js/255.b8825033.js"><link rel="prefetch" href="/assets/js/256.0ee3689d.js"><link rel="prefetch" href="/assets/js/257.4a684795.js"><link rel="prefetch" href="/assets/js/258.ca696e72.js"><link rel="prefetch" href="/assets/js/259.fdf867d0.js"><link rel="prefetch" href="/assets/js/26.c84357e5.js"><link rel="prefetch" href="/assets/js/260.d35d60d5.js"><link rel="prefetch" href="/assets/js/261.c162cef5.js"><link rel="prefetch" href="/assets/js/262.8cbc5289.js"><link rel="prefetch" href="/assets/js/263.c05bbe4c.js"><link rel="prefetch" href="/assets/js/264.2e7c8f69.js"><link rel="prefetch" href="/assets/js/265.372a0632.js"><link rel="prefetch" href="/assets/js/266.49c38b9d.js"><link rel="prefetch" href="/assets/js/267.f7406d35.js"><link rel="prefetch" href="/assets/js/268.c7846c3e.js"><link rel="prefetch" href="/assets/js/269.e30bdc7f.js"><link rel="prefetch" href="/assets/js/27.0b3da7b9.js"><link rel="prefetch" href="/assets/js/270.8a3786ce.js"><link rel="prefetch" href="/assets/js/271.4b771c95.js"><link rel="prefetch" href="/assets/js/272.c710d2d6.js"><link rel="prefetch" href="/assets/js/273.43fb2872.js"><link rel="prefetch" href="/assets/js/274.d8a9dff2.js"><link rel="prefetch" href="/assets/js/275.c2812b68.js"><link rel="prefetch" href="/assets/js/276.406503c4.js"><link rel="prefetch" href="/assets/js/277.10c29e54.js"><link rel="prefetch" href="/assets/js/278.5f4b657a.js"><link rel="prefetch" href="/assets/js/279.84b86ae8.js"><link rel="prefetch" href="/assets/js/28.1c1fd5a6.js"><link rel="prefetch" href="/assets/js/280.8a2ba3b2.js"><link rel="prefetch" href="/assets/js/281.4a7f2b91.js"><link rel="prefetch" href="/assets/js/282.7b2f2668.js"><link rel="prefetch" href="/assets/js/283.455f93df.js"><link rel="prefetch" href="/assets/js/284.1a448478.js"><link rel="prefetch" href="/assets/js/285.19eebc05.js"><link rel="prefetch" href="/assets/js/286.5423cfc6.js"><link rel="prefetch" href="/assets/js/287.afbe115e.js"><link rel="prefetch" href="/assets/js/288.d4f4f247.js"><link rel="prefetch" href="/assets/js/289.da477465.js"><link rel="prefetch" href="/assets/js/29.103209e9.js"><link rel="prefetch" href="/assets/js/290.abf99800.js"><link rel="prefetch" href="/assets/js/291.71fe3ae6.js"><link rel="prefetch" href="/assets/js/292.455169ca.js"><link rel="prefetch" href="/assets/js/293.d23ffed4.js"><link rel="prefetch" href="/assets/js/294.1a753204.js"><link rel="prefetch" href="/assets/js/295.badfa110.js"><link rel="prefetch" href="/assets/js/296.344206a1.js"><link rel="prefetch" href="/assets/js/297.29e4f914.js"><link rel="prefetch" href="/assets/js/298.f9db8940.js"><link rel="prefetch" href="/assets/js/299.2253c1e7.js"><link rel="prefetch" href="/assets/js/3.e5ca1c51.js"><link rel="prefetch" href="/assets/js/30.e76a827e.js"><link rel="prefetch" href="/assets/js/300.e5bfd607.js"><link rel="prefetch" href="/assets/js/301.cc3e786e.js"><link rel="prefetch" href="/assets/js/302.7fdc62b6.js"><link rel="prefetch" href="/assets/js/303.b1db491f.js"><link rel="prefetch" href="/assets/js/304.18917b0f.js"><link rel="prefetch" href="/assets/js/305.d352aeb5.js"><link rel="prefetch" href="/assets/js/306.8bc72324.js"><link rel="prefetch" href="/assets/js/307.854b4037.js"><link rel="prefetch" href="/assets/js/308.6a0e4a18.js"><link rel="prefetch" href="/assets/js/309.d184df6f.js"><link rel="prefetch" href="/assets/js/31.7e4b200d.js"><link rel="prefetch" href="/assets/js/310.8e0af1ab.js"><link rel="prefetch" href="/assets/js/311.00bae85e.js"><link rel="prefetch" href="/assets/js/312.bc92cba9.js"><link rel="prefetch" href="/assets/js/313.8f70a987.js"><link rel="prefetch" href="/assets/js/314.8f190f1f.js"><link rel="prefetch" href="/assets/js/315.4b8506c7.js"><link rel="prefetch" href="/assets/js/316.5911c1f9.js"><link rel="prefetch" href="/assets/js/317.58cca547.js"><link rel="prefetch" href="/assets/js/318.4f23c053.js"><link rel="prefetch" href="/assets/js/319.941f5d3e.js"><link rel="prefetch" href="/assets/js/32.9c188bac.js"><link rel="prefetch" href="/assets/js/320.a3f15adc.js"><link rel="prefetch" href="/assets/js/321.14c74686.js"><link rel="prefetch" href="/assets/js/322.5f7b1b87.js"><link rel="prefetch" href="/assets/js/323.ab05eccb.js"><link rel="prefetch" href="/assets/js/324.292806ba.js"><link rel="prefetch" href="/assets/js/325.b96314dd.js"><link rel="prefetch" href="/assets/js/326.3d8f6329.js"><link rel="prefetch" href="/assets/js/327.49cf9268.js"><link rel="prefetch" href="/assets/js/328.be56ec05.js"><link rel="prefetch" href="/assets/js/329.8c390111.js"><link rel="prefetch" href="/assets/js/33.2435d797.js"><link rel="prefetch" href="/assets/js/330.b961e5fd.js"><link rel="prefetch" href="/assets/js/331.24ce8c0b.js"><link rel="prefetch" href="/assets/js/332.115b7546.js"><link rel="prefetch" href="/assets/js/333.957e0728.js"><link rel="prefetch" href="/assets/js/334.68825ff7.js"><link rel="prefetch" href="/assets/js/335.b662f33d.js"><link rel="prefetch" href="/assets/js/336.d8818747.js"><link rel="prefetch" href="/assets/js/337.9d24e096.js"><link rel="prefetch" href="/assets/js/338.3b669645.js"><link rel="prefetch" href="/assets/js/339.51cc2773.js"><link rel="prefetch" href="/assets/js/34.d57f3bb9.js"><link rel="prefetch" href="/assets/js/340.28cfadfb.js"><link rel="prefetch" href="/assets/js/341.4e6b0bdd.js"><link rel="prefetch" href="/assets/js/342.310c1a3e.js"><link rel="prefetch" href="/assets/js/343.0e61677a.js"><link rel="prefetch" href="/assets/js/344.340a39bd.js"><link rel="prefetch" href="/assets/js/345.fff51053.js"><link rel="prefetch" href="/assets/js/346.93c709db.js"><link rel="prefetch" href="/assets/js/347.dc863ac9.js"><link rel="prefetch" href="/assets/js/348.13c191d7.js"><link rel="prefetch" href="/assets/js/349.8aea43f7.js"><link rel="prefetch" href="/assets/js/35.e20cb4ac.js"><link rel="prefetch" href="/assets/js/350.49b72b87.js"><link rel="prefetch" href="/assets/js/351.3e6e6379.js"><link rel="prefetch" href="/assets/js/352.e2524a53.js"><link rel="prefetch" href="/assets/js/353.b71b2a33.js"><link rel="prefetch" href="/assets/js/354.a4720902.js"><link rel="prefetch" href="/assets/js/355.5a8970e1.js"><link rel="prefetch" href="/assets/js/356.353f0a9c.js"><link rel="prefetch" href="/assets/js/357.648060ca.js"><link rel="prefetch" href="/assets/js/358.643b787c.js"><link rel="prefetch" href="/assets/js/359.b1bc0c81.js"><link rel="prefetch" href="/assets/js/36.6a79f8ad.js"><link rel="prefetch" href="/assets/js/360.748faf07.js"><link rel="prefetch" href="/assets/js/361.cddfbfab.js"><link rel="prefetch" href="/assets/js/362.46990756.js"><link rel="prefetch" href="/assets/js/363.f4846a88.js"><link rel="prefetch" href="/assets/js/364.e7fd6af2.js"><link rel="prefetch" href="/assets/js/365.41693194.js"><link rel="prefetch" href="/assets/js/366.60931b9e.js"><link rel="prefetch" href="/assets/js/367.c7a310db.js"><link rel="prefetch" href="/assets/js/368.cae4028a.js"><link rel="prefetch" href="/assets/js/369.e3bcd2c2.js"><link rel="prefetch" href="/assets/js/37.4ccc31d6.js"><link rel="prefetch" href="/assets/js/370.2ea3b181.js"><link rel="prefetch" href="/assets/js/371.978056e5.js"><link rel="prefetch" href="/assets/js/372.aa13db83.js"><link rel="prefetch" href="/assets/js/373.f3791afe.js"><link rel="prefetch" href="/assets/js/374.b108af2d.js"><link rel="prefetch" href="/assets/js/375.dc75d5b1.js"><link rel="prefetch" href="/assets/js/376.8a663da6.js"><link rel="prefetch" href="/assets/js/38.9816dff1.js"><link rel="prefetch" href="/assets/js/39.03d551c0.js"><link rel="prefetch" href="/assets/js/4.611d42c4.js"><link rel="prefetch" href="/assets/js/40.ce442bf2.js"><link rel="prefetch" href="/assets/js/41.d596832c.js"><link rel="prefetch" href="/assets/js/42.29309c56.js"><link rel="prefetch" href="/assets/js/43.d47b7a06.js"><link rel="prefetch" href="/assets/js/44.87716237.js"><link rel="prefetch" href="/assets/js/45.d5ef3d2b.js"><link rel="prefetch" href="/assets/js/46.21cef7ff.js"><link rel="prefetch" href="/assets/js/47.75c67941.js"><link rel="prefetch" href="/assets/js/48.b94040d3.js"><link rel="prefetch" href="/assets/js/49.507fb28d.js"><link rel="prefetch" href="/assets/js/5.e6d623f8.js"><link rel="prefetch" href="/assets/js/50.4013f17e.js"><link rel="prefetch" href="/assets/js/51.6e81cba9.js"><link rel="prefetch" href="/assets/js/52.07e4aadf.js"><link rel="prefetch" href="/assets/js/53.1d325b49.js"><link rel="prefetch" href="/assets/js/54.79ff5e8c.js"><link rel="prefetch" href="/assets/js/55.77160bdd.js"><link rel="prefetch" href="/assets/js/56.a3041056.js"><link rel="prefetch" href="/assets/js/57.b7c0602c.js"><link rel="prefetch" href="/assets/js/58.a4af9a23.js"><link rel="prefetch" href="/assets/js/59.61a80d59.js"><link rel="prefetch" href="/assets/js/6.dc644b59.js"><link rel="prefetch" href="/assets/js/60.4ae1e1f0.js"><link rel="prefetch" href="/assets/js/61.b733273a.js"><link rel="prefetch" href="/assets/js/62.63b8d77d.js"><link rel="prefetch" href="/assets/js/63.46a84bd8.js"><link rel="prefetch" href="/assets/js/64.ce8c5891.js"><link rel="prefetch" href="/assets/js/65.8abe6836.js"><link rel="prefetch" href="/assets/js/66.6f9a9cf9.js"><link rel="prefetch" href="/assets/js/67.6bc415b9.js"><link rel="prefetch" href="/assets/js/68.b100ab24.js"><link rel="prefetch" href="/assets/js/69.5d9ed0d7.js"><link rel="prefetch" href="/assets/js/7.7da3e776.js"><link rel="prefetch" href="/assets/js/70.f213eb63.js"><link rel="prefetch" href="/assets/js/71.9dbed333.js"><link rel="prefetch" href="/assets/js/72.1129fb4b.js"><link rel="prefetch" href="/assets/js/73.7459f6b0.js"><link rel="prefetch" href="/assets/js/74.2364da14.js"><link rel="prefetch" href="/assets/js/75.72e5d347.js"><link rel="prefetch" href="/assets/js/76.7f1bc93d.js"><link rel="prefetch" href="/assets/js/77.7f9bb46a.js"><link rel="prefetch" href="/assets/js/78.16497536.js"><link rel="prefetch" href="/assets/js/79.1598ba88.js"><link rel="prefetch" href="/assets/js/8.91ce867e.js"><link rel="prefetch" href="/assets/js/80.d7595902.js"><link rel="prefetch" href="/assets/js/81.c808c887.js"><link rel="prefetch" href="/assets/js/82.49dc6011.js"><link rel="prefetch" href="/assets/js/83.6e151bae.js"><link rel="prefetch" href="/assets/js/84.9d3d5086.js"><link rel="prefetch" href="/assets/js/85.2c4d111e.js"><link rel="prefetch" href="/assets/js/86.cff98baa.js"><link rel="prefetch" href="/assets/js/87.655584a0.js"><link rel="prefetch" href="/assets/js/88.109ad4f1.js"><link rel="prefetch" href="/assets/js/89.46f7ed5c.js"><link rel="prefetch" href="/assets/js/9.8a2e5f54.js"><link rel="prefetch" href="/assets/js/90.1a91e9ca.js"><link rel="prefetch" href="/assets/js/91.26a98055.js"><link rel="prefetch" href="/assets/js/92.6ed9cb6e.js"><link rel="prefetch" href="/assets/js/93.14253412.js"><link rel="prefetch" href="/assets/js/94.54415bcf.js"><link rel="prefetch" href="/assets/js/95.0e1c9d0a.js"><link rel="prefetch" href="/assets/js/96.8654188f.js"><link rel="prefetch" href="/assets/js/97.d338a1d8.js"><link rel="prefetch" href="/assets/js/98.efa1e5c5.js"><link rel="prefetch" href="/assets/js/99.83fa6575.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76d9f797.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/magic.png" alt="Pangolin" class="logo"> <span class="site-name can-hide">Pangolin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpeg"> <div class="blogger-info"><h3>达尔文的猹</h3> <span>大道至简 悟在天成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ORM框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/4553db/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/d426ff/" class="sidebar-link">Spring集成MyBatis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/45687a/" class="sidebar-link">基础</a></li><li><a href="/pages/669da3/" class="sidebar-link">Java基础</a></li><li><a href="/pages/06424b/" class="sidebar-link">类与继承</a></li><li><a href="/pages/a29a57/" class="sidebar-link">抽象类与接口</a></li><li><a href="/pages/575ca7/" class="sidebar-link">内部类</a></li><li><a href="/pages/1d42f5/" class="sidebar-link">枚举类</a></li><li><a href="/pages/68df7d/" class="sidebar-link">常用类</a></li><li><a href="/pages/208d9a/" class="sidebar-link">关键字</a></li><li><a href="/pages/19431a/" class="sidebar-link">注解</a></li><li><a href="/pages/98c0c9/" class="sidebar-link">异常</a></li><li><a href="/pages/a08fb2/" class="sidebar-link">泛型</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>集合类</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e52b1c/" class="sidebar-link">集合类</a></li><li><a href="/pages/20a058/" class="sidebar-link">集合容器类概述</a></li><li><a href="/pages/71ab62/" class="sidebar-link">ArrayList与LinkedList</a></li><li><a href="/pages/dd747b/" class="sidebar-link">ArrayDeque</a></li><li><a href="/pages/f0ecf7/" class="sidebar-link">PriorityQueue</a></li><li><a href="/pages/a577c4/" class="sidebar-link">HashMap与HashSet</a></li><li><a href="/pages/b65f71/" class="sidebar-link">LinkedHashMap</a></li><li><a href="/pages/02deb8/" class="sidebar-link">TreeMap与TreeSet</a></li><li><a href="/pages/8b70b6/" class="sidebar-link">WeakHashMap</a></li><li><a href="/pages/098b2b/" class="sidebar-link">CopyOnWriteArrayList</a></li><li><a href="/pages/380128/" class="sidebar-link">ConcurrentHashMap</a></li><li><a href="/pages/b23642/" class="sidebar-link">BlockingQueue</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/5d5b55/" class="sidebar-link">并发</a></li><li><a href="/pages/ef591d/" class="sidebar-link">多线程基础</a></li><li><a href="/pages/870f46/" class="sidebar-link">JMM与Volatile</a></li><li><a href="/pages/70bfda/" class="sidebar-link">JUC与AQS</a></li><li><a href="/pages/60c2c3/" class="sidebar-link">锁与互斥同步</a></li><li><a href="/pages/6e4dfa/" class="sidebar-link">显式锁与ReetrantLock</a></li><li><a href="/pages/a0d56d/" class="sidebar-link">线程安全总结</a></li><li><a href="/pages/b92a49/" class="sidebar-link">JUC组件与线程协作</a></li><li><a href="/pages/103bb5/" class="sidebar-link">Atomic原子变量与Unsafe类与CAS</a></li><li><a href="/pages/065f55/" class="sidebar-link">线程池与定时任务</a></li><li><a href="/pages/dd3660/" class="sidebar-link">ThreadLocal</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>IO</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/7db050/" class="sidebar-link">IO</a></li><li><a href="/pages/ccb0a7/" class="sidebar-link">文件操作</a></li><li><a href="/pages/45bc73/" class="sidebar-link">IO流操作</a></li><li><a href="/pages/404e82/" class="sidebar-link">网络IO操作</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Java高级特性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/396bd1/" class="sidebar-link">Java高级特性</a></li><li><a href="/pages/eaa98b/" class="sidebar-link">Lambda表达式</a></li><li><a href="/pages/40af88/" class="sidebar-link">流Stream</a></li><li><a href="/pages/402b10/" class="sidebar-link">反射</a></li><li><a href="/pages/a5ebcd/" class="sidebar-link">代理</a></li><li><a href="/pages/b48bfe/" class="sidebar-link">Java性能问题定位分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/20204f/" class="sidebar-link">其他</a></li><li><a href="/pages/e4cde0/" class="sidebar-link">杂记</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>规范&amp;amp;风格</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ee7259/" class="sidebar-link">规范&amp;amp;风格</a></li><li><a href="/pages/139e3f/" class="sidebar-link">代码整洁之道</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ed8d11/" class="sidebar-link">Web基础</a></li><li><a href="/pages/a228d7/" class="sidebar-link">Spring(Boot)基础</a></li><li><a href="/pages/ecd8b6/" class="sidebar-link">Spring Boot应用整合</a></li><li><a href="/pages/76dc08/" class="sidebar-link">Spring MVC</a></li><li><a href="/pages/b9aa73/" class="sidebar-link">Spring AOP</a></li><li><a href="/pages/dc74be/" class="sidebar-link">Spring事务</a></li><li><a href="/pages/b43c8c/" class="sidebar-link">Spring IOC源码分析-概览</a></li><li><a href="/pages/d9b4a5/" class="sidebar-link">Spring IOC源码分析-getBean()</a></li><li><a href="/pages/59dd3e/" class="sidebar-link">Spring IOC源码分析-createBean()</a></li><li><a href="/pages/691b21/" class="sidebar-link">Spring AOP源码分析</a></li><li><a href="/pages/d31e18/" class="sidebar-link">Spring事务源码分析</a></li><li><a href="/pages/f16cdb/" class="sidebar-link">Spring Boot源码分析</a></li><li><a href="/pages/b13a90/" class="sidebar-link">Spring MVC源码分析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/943c23/" aria-current="page" class="active sidebar-link">JVM内存区域与对象解析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/05acae/" class="sidebar-link">内存分配与垃圾收集</a></li><li><a href="/pages/d09a16/" class="sidebar-link">JVM监控与故障处理工具</a></li><li><a href="/pages/06e4ad/" class="sidebar-link">类文件结构与类加载机制</a></li><li><a href="/pages/3d00d5/" class="sidebar-link">虚拟机方法调用与指令执行引擎</a></li><li><a href="/pages/eba070/" class="sidebar-link">程序编译与代码优化</a></li><li><a href="/pages/83896f/" class="sidebar-link">虚拟机调优及参数总结</a></li><li><a href="/pages/8a0034/" class="sidebar-link">GraalVM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f6cd57/" class="sidebar-link">数据库系统原理</a></li><li><a href="/pages/410bf5/" class="sidebar-link">MySQL必知必会</a></li><li><a href="/pages/495264/" class="sidebar-link">MySQL开发与优化</a></li><li><a href="/pages/ec7e76/" class="sidebar-link">MySQL架构与日志</a></li><li><a href="/pages/4dbe1f/" class="sidebar-link">MySQL索引</a></li><li><a href="/pages/cbc7ab/" class="sidebar-link">MySQL优化</a></li><li><a href="/pages/4afd3a/" class="sidebar-link">MySQL锁机制与事务并发控制</a></li><li><a href="/pages/412461/" class="sidebar-link">MySQL高级特性</a></li><li><a href="/pages/41888c/" class="sidebar-link">MySQL设计规范</a></li><li><a href="/pages/087de5/" class="sidebar-link">MySQL架构篇</a></li><li><a href="/pages/b0952c/" class="sidebar-link">MySQL复制</a></li><li><a href="/pages/ee884d/" class="sidebar-link">MySQL高可用</a></li><li><a href="/pages/6d4f47/" class="sidebar-link">MySQL运维篇</a></li><li><a href="/pages/b8bad7/" class="sidebar-link">MySQL常用工具</a></li><li><a href="/pages/8bd691/" class="sidebar-link">MySQL日志</a></li><li><a href="/pages/5db7ef/" class="sidebar-link">MySQL备份与恢复</a></li><li><a href="/pages/3e3d3a/" class="sidebar-link">MySQL权限与安全</a></li><li><a href="/pages/5f2a5c/" class="sidebar-link">MySQL监控</a></li><li><a href="/pages/bf28eb/" class="sidebar-link">数据库LeetCode题目</a></li><li><a href="/pages/d4f878/" class="sidebar-link">数据库面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2bed26/" class="sidebar-link">Arthas</a></li><li><a href="/pages/84ff17/" class="sidebar-link">CICD</a></li><li><a href="/pages/a7e6ff/" class="sidebar-link">Maven</a></li><li><a href="/pages/2a3f45/" class="sidebar-link">Typora主题</a></li><li><a href="/pages/f28f56/" class="sidebar-link">VuePress</a></li><li><a href="/pages/9d673a/" class="sidebar-link">思源笔记</a></li><li><a href="/pages/538b8a/" class="sidebar-link">环境搭建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ORM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c83270/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/29ba44/" class="sidebar-link">Spring集成MyBatis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e55b6f/" class="sidebar-link">测试基础</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/develop/#开发" data-v-06225672>开发</a></li><li data-v-06225672><a href="/develop/#JVM" data-v-06225672>JVM</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/nanodaemony" target="_blank" title="作者" class="beLink" data-v-06225672>NanoDaemony</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-06-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->JVM内存区域与对象解析<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_1-jvm内存区域与对象解析"><a href="#_1-jvm内存区域与对象解析" class="header-anchor">#</a> 1.JVM内存区域与对象解析</h1> <h4 id="jvm概览"><a href="#jvm概览" class="header-anchor">#</a> JVM概览</h4> <p>先看看虚拟机整体架构及所包含的内容. 如下面的体系结构图所示(Java8 之前), JVM 分为三个主要的<strong>子系统</strong>:</p> <ol><li><strong>类加载器子系统</strong>.</li> <li><strong>运行时数据区.</strong></li> <li><strong>字节码执行引擎</strong>.</li></ol> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220514160240249.png" alt=""></p> <h5 id="_1-类加载器子系统"><a href="#_1-类加载器子系统" class="header-anchor">#</a> 1.类加载器子系统</h5> <p>Java 的动态类加载功能是由类加载器子系统处理的. 它负责加载, 链接, 并且在<strong>运行时</strong>首次引用类的时候初始化类, 而不是在编译期间.</p> <p><strong>(1) 加载</strong></p> <p>这个组件负责加载类. BootStrap 类加载器, Extension 类加载器和 Application 类加载器是实现类加载的三大<strong>类加载器</strong>.</p> <ol><li><strong>BootStrap 类加载器</strong>: 负责从 classpath 加载类, 如果没有类存在, 将只加载 <strong>rt.jar</strong>. 这个加载器的优先级最高.</li> <li><strong>Extension 类加载器</strong>: 负责加载<strong>扩展文件夹(jre\lib)</strong> 中的类.</li> <li><strong>Application 类加载器</strong>: 负责加载<strong>应用级 classpath ​</strong>和环境变量指向的路径下的类.</li></ol> <p>上述<strong>类加载器</strong>在加载类文件时遵循<strong>双亲委派算法</strong>.</p> <p><strong>(2) 链接</strong></p> <ol><li><strong>校验</strong>: 字节码验证器将校验生成的字节码是否正确, 如果校验失败则将获得<strong>校验错误信息</strong>.</li> <li><strong>准备</strong>: 对于所有的<strong>静态变量</strong>, 内存将被申请并分配<strong>默认值</strong>.</li> <li><strong>解析</strong>: 所有<strong>标记的内存引用</strong>从<strong>方法区域</strong>被替换成的<strong>原始引用</strong>.</li></ol> <p><strong>(3) 初始化</strong></p> <p>这是类加载的最后阶段, 所有的静态变量都将被分配原值, <strong>静态代码块将被执行</strong>.</p> <h5 id="_2-运行时数据区"><a href="#_2-运行时数据区" class="header-anchor">#</a> 2.运行时数据区</h5> <p>运行时数据区被划分为五个主要部分:</p> <ul><li><strong>方法区</strong>: 所有<strong>类级数据</strong>都存储在这里, 包括<strong>静态变量</strong>. 所有线程共享方法区.</li> <li><strong>堆区</strong>: <strong>对象</strong>及其对应的<strong>实例变量</strong>和<strong>数组</strong>等存储在此, 所有线程共享堆区. 由于<strong>方法区</strong>和<strong>堆区</strong>内存是多线程共享, 因此存储的数据是非线程安全的.</li> <li><strong>栈区</strong>: <strong>每个线程</strong>都会创建一个单独的<strong>运行时栈</strong>. 在每一次<strong>方法调用</strong>, 都会在栈内存中创建一个<strong>栈帧(Stack Frame)</strong>. 所有<strong>局部变量</strong>将在栈内存中创建. 栈区是线程安全的, 因为它是线程私有资源. 栈帧中包含多个实体: (1)<strong>局部变量数组</strong>: 与方法中有多少局部变量有关, 相应的值将存储在此处. (2)<strong>操作数栈</strong>: 如果任何的中间操作需要被执行, <strong>操作数栈</strong>将作为运行时工作区来执行操作. (3)<strong>帧数据</strong>: 与方法相对应的所有符号存储在此. 在异常情况下, catch 块的信息被保留在帧数据中.</li> <li><strong>程序计数器</strong>: 每一个线程都有独立的 <strong>PC 寄存器</strong>, 一旦执行指令, PC 寄存器将被下一条指令<strong>更新</strong>, 保存当前<strong>执行指令</strong>的地址.</li> <li><strong>本地方法栈</strong>: 本地方法栈保存本地方法信息, 每一个线程都会创建一个单独的本地方栈.</li></ul> <h5 id="_3-字节码执行引擎"><a href="#_3-字节码执行引擎" class="header-anchor">#</a> 3.字节码执行引擎</h5> <p><strong>(1) 执行引擎</strong></p> <p>分配到运行时数据区的<strong>字节码</strong>将被<strong>执行引擎执行</strong>. 执行引擎读取字节码并逐一执行.</p> <ul><li><strong>解释器</strong>: 解释器能更加快速地解释字节码, 但是执行缓慢. 解释器的缺点是当多次调用一个方法时, 每次都要重新解释.</li> <li><strong>JIT 编译器(即时编译器)</strong>: JIT 编译器弥补了解释器的不足. 执行引擎使用解释器来转换字节码, 当它发现重复的代码时, 它将使用 JIT 编译器来编译整个字节码并转换为本地代码. 本地代码将直接被重复的方法所调用, 从而提高系统性能.</li> <li><strong>中间代码生成器</strong>: 生成中间代码.</li> <li><strong>代码优化器</strong>: 负责优化上述生成的中间代码.</li> <li><strong>目标代码生成器</strong>: 负责生成机器码或者本地代码.</li> <li><strong>分析器</strong>: 一个特殊的组件, 负责查找<strong>热点代码, ​</strong>比如一个方法是否被调用多次.</li> <li><strong>垃圾回收器</strong>: 回收并删除未引用的对象. 可以通过调用 <strong>System.gc()</strong> 来触发垃圾回收, 但不能保证它执行. JVM 的垃圾回收是回收被创建的对象.</li></ul> <p><strong>(2) Java本地接口(JNI)</strong></p> <p><strong>JNI</strong>与<strong>本地方法库</strong>交互, 并为执行引擎提供<strong>本地方法库</strong>.</p> <p><strong>(3) 本地方法库(Native Method Libraries)</strong></p> <p>它是执行引擎所需的本地库集合.</p> <h4 id="运行时数据区域"><a href="#运行时数据区域" class="header-anchor">#</a> 运行时数据区域</h4> <p><strong>运行时数据区</strong>: 经过编译生成的字节码文件(class文件), 由 Classloader(类加载子系统)加载后交给执行引擎执行, 在执行引擎执行的过程中产生的数据会存储在一块内存区域. 这块内存区域就是<strong>运行时数据区域</strong>.</p> <p><strong>程序计数器, Java 虚拟机栈和本地方法栈</strong>是线程<strong>私有</strong>的, 每个线程都有分配这些内存, 其余的是线程共享部分. 线程私有即随着线程的创建而创建, 随着线程的死亡而死亡.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220514163218416.png" alt=""></p> <p>美团的图:</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/132ba6ba720f2bfc6c69b1ce490f7c87693987.jpg" alt="img"></p> <h5 id="_1-程序计数器"><a href="#_1-程序计数器" class="header-anchor">#</a> 1.程序计数器</h5> <p>线程<strong>私有</strong>. 程序计数器用于记录正在执行的虚拟机<strong>字节码指令的地址</strong>(如果执行的是本地方法则为空). 可以看成是当前线程执行字节码的<strong>行号指示器</strong>, 每执行一句代码都会改变程序计数器.</p> <p><strong>每个线程</strong>都需要有一个<strong>独立的程序计数器</strong>, 各个线程之间计数器<strong>互不影响</strong>, 独立存储, 使线程切换后能够恢复到正确的执行位置.</p> <p>此内存区域是唯一一个<strong>没有</strong>规定 <strong>OutOfMemoryError</strong> 的区域. 程序计数器私有主要是为了<strong>线程切换后能恢复到正确的执行位置</strong>.</p> <h5 id="_2-虚拟机栈"><a href="#_2-虚拟机栈" class="header-anchor">#</a> 2.虚拟机栈</h5> <h6 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> (1)概述</h6> <p>线程<strong>私有</strong>.</p> <p><strong>栈内存</strong>说的就是<strong>虚拟机栈</strong>, 这里的栈也就是基于平时的普通 <strong>LIFO</strong> 栈实现的, 里面存放的就是一个个的<strong>栈帧</strong>. <strong>==每个方法==<strong>在执行的同时会</strong>创建一个栈帧</strong>用于存储局部变量表, 操作数栈, 常量池引用, 返回地址(方法出口)等信息. 从<strong>方法调用</strong>直至执行完成的过程, 就对应着一个<strong>栈帧</strong>在 Java 虚拟机栈中<strong>入栈和出栈</strong>的过程.</p> <p>程序中的<strong>局部变量</strong>就是存放在<strong>栈帧</strong>上的. <strong>局部变量表主要存放了编译器可知的各种数据类型</strong>(boolean, byte, char, short, int, float, long, double), <strong>对象引用</strong>(reference 类型, 它不同于对象本身, 可能是一个指向对象起始地址的引用指针, 也可能是指向一个代表对象的句柄或其他与此对象相关的位置).</p> <p>程序中每执行一个<strong>方法</strong>都会分配一个<strong>栈帧</strong>来保存方法内的<strong>各种数据</strong>. 栈及栈帧结构如下.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220514163834398.png" alt=""></p> <p>进行数值计算的时候, 会把<strong>变量值加载到操作数栈</strong>进行操作. 比如求 a + b 的值, 就会把 a 和 b 都加载到操作数栈并进行计算.</p> <h6 id="_2-参数配置"><a href="#_2-参数配置" class="header-anchor">#</a> (2)参数配置</h6> <p>可以通过 <strong>-Xss</strong> 这个虚拟机参数来指定<strong>每个线程</strong>的 Java 虚拟机<strong>栈内存</strong>大小. 记忆: <strong>ss = stack size</strong>.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">java</span> <span class="token parameter variable">-Xss512M</span> TestJava
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>-Xss 设置越小, 栈深值越小, 说明一个线程栈里能分配的<strong>栈帧就越少</strong>, 但是对 JVM 整体来说能开启的<strong>线程数</strong>会更多.</p> <p>虚拟机栈该区域可能抛出以下两种异常:</p> <ul><li>当<strong>线程请求的栈深度超过最大值</strong>, 会抛出 <strong>StackOverflowError</strong> 异常;</li> <li><strong>栈</strong>可以进行<strong>动态扩展</strong>, 但如果无法申请到<strong>足够内存</strong>, 会抛出 <strong>OutOfMemoryError</strong> 异常.</li></ul> <blockquote><p>扩展: 方法如何调用?</p></blockquote> <p>虚拟机栈可以类比数据结构中<strong>栈</strong>, 虚拟机栈中保存的主要内容是<strong>栈帧</strong>, 每一次函数调用都会有一个对应的<strong>栈帧被压入虚拟机栈</strong>, 每一个函数调用结束后, 都会有一个栈帧被弹出. Java 方法有两种返回方式:</p> <ol><li>return 语句.</li> <li>抛出异常.</li></ol> <p>不管哪种返回方式都会<strong>导致栈帧被弹出</strong>.</p> <h5 id="_3-本地方法栈"><a href="#_3-本地方法栈" class="header-anchor">#</a> 3.本地方法栈</h5> <p>本地方法栈与 Java 虚拟机栈类似, 它们之间的区别只不过是虚拟机栈为虚拟机执行 Java 方法服务, 而本地方法栈则为虚拟机使用 <strong>Native 方法</strong>服务. 也是线程<strong>私有</strong>的.</p> <p>本地方法一般是用其它语言(C, C++ 或汇编语言等)编写的, 并且被编译为基于本机硬件和操作系统的程序, 对待这些方法需要特别处理. 本地方法被执行的时候, 在本地方法栈也会创建一个<strong>栈帧</strong>, 用于存放该本地方法的局部变量表, 操作数栈, 动态链接, 出口信息. 方法执行完毕后相应的栈帧也会出栈并释放内存空间, 也可能会出现 <strong>StackOverFlowError 和 OutOfMemoryError</strong> 两种异常.</p> <p><img src="assets/image-20230325134658-5l0q7fx.png" alt="image"></p> <p>总结: 为了<strong>保证线程中的局部变量不被别的线程访问到</strong>, 虚拟机栈和本地方法栈<strong>都是线程私有</strong>的.</p> <h5 id="_4-堆"><a href="#_4-堆" class="header-anchor">#</a> 4.堆</h5> <h6 id="_1-概述-2"><a href="#_1-概述-2" class="header-anchor">#</a> (1)概述</h6> <p>线程<strong>共享</strong>. 所有<strong>对象实例</strong>及数组都在这里分配<strong>内存</strong>, 是<strong>垃圾收集的主要区域</strong>(&quot;<strong>GC 堆</strong>&quot;). 现代的垃圾收集器基本都是采用<strong>分代收集算法</strong>, 其主要的思想是针对<strong>不同类型的对象</strong>采取不同的垃圾回收算法. 可以大致将堆分成<strong>新生代</strong>(Young Generation) 与<strong>老年代</strong>(Old Generation) 两块.</p> <h6 id="_2-outofmemoryerror异常"><a href="#_2-outofmemoryerror异常" class="header-anchor">#</a> (2)OutOfMemoryError异常</h6> <p>堆不需要连续内存, 并且可以<strong>动态增加</strong>其内存, 增加失败会抛出 <strong>OutOfMemoryError</strong> 异常. 并且出现这种错误之后的表现形式还会有几种:</p> <ul><li><strong>OutOfMemoryError: GC Overhead Limit Exceeded</strong>: 当 JVM 花太多时间执行垃圾回收并且只能回收很少的堆空间时, 就会发生此错误.</li> <li><strong>java.lang.OutOfMemoryError: Java heap space</strong>: 假如在创建新的对象时, 堆内存中的空间不足以存放新创建的对象, 就会引发 java.lang.OutOfMemoryError: Java heap space 错误. 这和本机物理内存无关, 和配置的内存大小有关.</li></ul> <h6 id="_3-参数配置"><a href="#_3-参数配置" class="header-anchor">#</a> (3)参数配置</h6> <p>可以通过 <strong>-Xms 和 -Xmx</strong> 这两个虚拟机参数来指定一个程序的<strong>堆内存</strong>大小, 第一个参数设置<strong>初始值</strong>, 第二个参数设置<strong>最大值</strong>.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">java</span> <span class="token parameter variable">-Xms1M</span> <span class="token parameter variable">-Xmx2M</span> HackTheJava
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h6 id="_4-实例对象在内存中存储在哪"><a href="#_4-实例对象在内存中存储在哪" class="header-anchor">#</a> (4)实例对象在内存中存储在哪?</h6> <p><strong>如果实例对象存储在堆区时</strong>: 实例对象内存存在<strong>堆区</strong>, 实例的<strong>引用</strong>存在<strong>栈上</strong>, 实例的<strong>元数据 Class 存在方法区或者元空间</strong>.</p> <p><strong>实例对象</strong>也<strong>不一定存在堆区</strong>的. 如果实例对象<strong>没有线程逃逸行为</strong>, 那么是<strong>有可能</strong>在线程的<strong>栈上创建实例</strong>的, 也就是存在栈上.</p> <h5 id="_5-方法区"><a href="#_5-方法区" class="header-anchor">#</a> 5.方法区</h5> <h6 id="_1-概述-3"><a href="#_1-概述-3" class="header-anchor">#</a> (1)概述</h6> <p>线程<strong>共享区域</strong>. 用于存放已被加载的<strong>类信息, 常量, 静态变量, 即时编译器编译后的代码</strong>等数据. <strong>方法区是一个 JVM 规范, 永久代与元空间都是其一种实现方式</strong>. 在 Java8 之后, 原来<strong>永久代</strong>的数据被分到了==<strong>堆和元空间</strong>==中.</p> <p><strong>与堆的联系</strong>: <strong>静态变量</strong>的定义(类的元信息) 在<strong>方法区</strong>(永久代或者元空间中), 但是其<strong>实际引用</strong>的对象是在<strong>堆</strong>中.</p> <p><strong>异常</strong>: 和堆一样不需要连续的内存, 并且可以动态扩展, 动态扩展失败一样会抛出 <strong>OutOfMemoryError</strong> 异常.</p> <p><strong>垃圾回收</strong>: 对这块区域进行垃圾回收的主要目标是对<strong>常量池的回收和对类的卸载</strong>, 但是一般比较难实现, 回收效果与效率很低.</p> <h6 id="_2-元空间"><a href="#_2-元空间" class="header-anchor">#</a> (2)元空间</h6> <p>为了更容易管理方法区, Java8 移除了永久代, 并把<strong>方法区移至元空间</strong>, 它位于<strong>直接内存</strong>中.</p> <blockquote><p>方法区与永久代和元空间的关系</p></blockquote> <p>《Java 虚拟机规范》只是规定了有<strong>方法区</strong>这么个概念和它的作用, 并没有规定如何去实现它. 所以不同的 JVM 上方法区的实现就可能是不同的. <strong>方法区和永久代的关系很像 Java 中接口和类的关系, 类实现了接口. 方法区就是定义的标准定义的接口, 而永久代就是 HotSpot 虚拟机对虚拟机规范中方法区的一种实现方式, 元空间则是另一种实现方式. ​</strong>也就是说, <strong>永久代和元空间是 HotSpot 的概念</strong>, <strong>方法区是 Java 虚拟机规范</strong>中的定义, 方法区是一种规范, 而永久代与元空间是实现, 其他的虚拟机实现并没有永久代这一说法.</p> <blockquote><p>为什么要将永久代(PermGen)替换为元空间(MetaSpace)?</p></blockquote> <p>整个永久代有一个 JVM 本身<strong>设置固定大小上限</strong>, 无法进行调整, 而<strong>元空间使用的是直接内存</strong>, 受本机可用内存的限制, 虽然元空间仍旧可能溢出, 但是比原来出现的几率会更小. 元空间里面存放的是<strong>类的元数据</strong>, 这样加载多少类的元数据就不由 MaxPermSize 控制了, 而由系统的实际可用空间来控制, 这样能加载的类就更多了.</p> <h6 id="_3-参数配置-2"><a href="#_3-参数配置-2" class="header-anchor">#</a> (3)参数配置</h6> <p>Java7 及之前, 设置永久代的参数:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">PermSize</span>  	<span class="token comment">// 设置永久代最小空间大小</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxPermSize</span> <span class="token comment">//设置永久代最大空间大小</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Java8 元空间使用的是<strong>直接内存</strong>, 设置参数为:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MetaspaceSize</span> <span class="token operator">=</span> <span class="token class-name">N</span> 		<span class="token comment">// 设置Metaspace初始大小</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxMetaspaceSize</span> <span class="token operator">=</span> <span class="token class-name">N</span> 	<span class="token comment">// 设置Metaspace最大大小</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_6-运行时常量池"><a href="#_6-运行时常量池" class="header-anchor">#</a> 6.运行时常量池</h5> <h6 id="_1-概述-4"><a href="#_1-概述-4" class="header-anchor">#</a> (1)概述</h6> <p>运行时常量池包含内容:</p> <ul><li><strong>字面量</strong>: 文本字符串, 声明为 final 的常量值, 基本数据类型值等.</li> <li><strong>符号引用</strong>: 类和结构的全限定名, 字段名称与描述符, 方法名称与描述符.</li></ul> <p>Java7 之前运行时常量池是<strong>方法区</strong>的一部分, 这时候方法区存在与堆中, 所以此时运行时常量池也在堆中. <strong>Class 文件</strong>中的<strong>常量池</strong>(<strong>编译器</strong>时生成的字面量和符号引用) 会在<strong>类加载</strong>后被放入这个区域. 除了在编译期生成的常量, 还允许<strong>动态生成</strong>, 即<strong>运行期间</strong>将新的常量放入池中, 例如 String 类的 intern() 方法.</p> <p><strong>Java8 之后的 JVM 已经将运行时常量池从方法区中移了出来, 在 Java 堆中开辟了一块区域存放运行时常量池.</strong></p> <p>Class 常量池可以理解为是 <strong>Class 文件中的资源仓库</strong>. Class 文件中除了包含类的版本, 字段, 方法, 接口等描述信息外, 还有一项信息就是<strong>常量池(constant pool table)</strong>, 用于存放编译期生成的各种<strong>字面量(Literal) 和符号引用(Symbolic References)</strong>.</p> <p><strong>常量池</strong>中主要存放两大类常量: <strong>字面量和符号引用</strong>.</p> <p><strong>(1) 字面量</strong>: <strong>指由字母, 数字等构成的字符串或者数值常量</strong>.</p> <p>字面量指等号<strong>右边直接赋的值</strong>, 如: int a = 1 这里的 a 为左值, 1 为右值. 在这个例子中 1 就是字面量.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token string">&quot;abcdefg&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>(2) 符号引用</strong>: 符号引用是<strong>编译原理</strong>中的概念, 是相对于<strong>直接引用</strong>来说的. 主要包括了以下三类常量:</p> <ul><li>类和接口的<strong>全限定名</strong>.</li> <li>字段的<strong>名称和描述符</strong>.</li> <li>方法的<strong>名称和描述符</strong>.</li></ul> <p>上面的 a, b 就是字段名称, 就是一种<strong>符号引用</strong>, 还有 Math 类常量池里的 Lcom/nano/jvm/Math; 是类的<strong>全限定名</strong>, main 和 compute 是方法<strong>名称</strong>, () 是一种 UTF8 格式的描述符, 这些都是符号引用.</p> <p>这些常量池现在是<strong>静态信息</strong>, 可以看成是<strong>静态常量池</strong>, 只有到<strong>运行时被加载到内存</strong>后, 这些符号才有对应的<strong>内存地址</strong>信息, 这些常量池一旦被装入内存就变成<strong>运行时常量池</strong>, 对应的<strong>符号引用</strong>在程序<strong>加载或运行</strong>时会被<strong>转变为被加载到内存区域的代码的直接引用</strong>, 也就是<strong>动态链接</strong>.</p> <p>例如, compute() 这个<strong>符号引用</strong>在运行时就会被转变为 compute() 方法具体<strong>代码在方法区内存中的地址</strong>, 主要通过对象头里的<strong>类型指针去转换直接引用</strong>.</p> <h5 id="_7-直接内存"><a href="#_7-直接内存" class="header-anchor">#</a> 7.直接内存</h5> <p><strong>直接内存并不是虚拟机运行时数据区的一部分, 也不是虚拟机规范中定义的内存区域, 但是这部分内存也被频繁地使用. 而且也可能导致 OutOfMemoryError 错误出现.</strong></p> <p><strong>元空间</strong>就是在直接内存中.</p> <p>大量 NIO 操作会用到<strong>直接内存</strong>. 在 JDK 1.4 中新引入了 <strong>NIO 类</strong>, 它可以使用 Native 函数库直接分配<strong>堆外内存</strong>, 然后通过 Java 堆里的 <strong>DirectByteBuffer</strong> 对象作为这块内存的引用进行操作. 这样能在一些场景中显著提高性能, 因为<strong>避免</strong>了在堆内存和堆外内存来回<strong>拷贝</strong>数据.</p> <p>直接内存的分配<strong>不会受到 Java 堆</strong>大小的限制, 但是受到本机总内存限制.</p> <h5 id="_8-综合实例"><a href="#_8-综合实例" class="header-anchor">#</a> 8.综合实例</h5> <p>看一个 Math 类:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>nano<span class="token punctuation">.</span>jvm</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Math</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Math</span> math <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>编译后生成的 Math.class 的文件用记事本打开如下.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>cafe babe <span class="token number">0000</span> <span class="token number">0033</span> <span class="token number">001f</span> <span class="token number">0</span>a00 <span class="token number">0500</span> <span class="token number">1</span>b07
<span class="token number">001</span>c <span class="token number">0</span>a00 <span class="token number">0200</span> <span class="token number">1</span>b0a <span class="token number">0002</span> <span class="token number">001d</span> <span class="token number">0700</span> <span class="token number">1e01</span>
<span class="token number">0006</span> <span class="token number">3</span>c69 <span class="token number">6e69</span> <span class="token number">743</span>e <span class="token number">0100</span> <span class="token number">0328</span> <span class="token number">2956</span> <span class="token number">0100</span>
<span class="token number">0443</span> <span class="token number">6f</span><span class="token number">64</span> <span class="token number">6501</span> <span class="token number">000f</span> <span class="token number">4</span>c69 <span class="token number">6e65</span> <span class="token number">4e75</span> <span class="token number">6d</span><span class="token number">62</span>
<span class="token number">6572</span> <span class="token number">5461</span> <span class="token number">626</span>c <span class="token number">6501</span> <span class="token number">0012</span> <span class="token number">4</span>c6f <span class="token number">6361</span> <span class="token number">6</span>c56
<span class="token number">6172</span> <span class="token number">6961</span> <span class="token number">626</span>c <span class="token number">6554</span> <span class="token number">6162</span> <span class="token number">6</span>c65 <span class="token number">0100</span> <span class="token number">0474</span>
<span class="token number">6869</span> <span class="token number">7301</span> <span class="token number">000f</span> <span class="token number">4</span>c63 <span class="token number">6f</span><span class="token number">6d</span> <span class="token number">2f</span><span class="token number">6</span>e <span class="token number">616</span>e <span class="token number">6f</span><span class="token number">2f</span>
<span class="token number">4d</span><span class="token number">61</span> <span class="token number">7468</span> <span class="token number">3</span>b01 <span class="token number">0007</span> <span class="token number">636f</span> <span class="token number">6d</span><span class="token number">70</span> <span class="token number">7574</span> <span class="token number">6501</span>
<span class="token number">0003</span> <span class="token number">2829</span> <span class="token number">4901</span> <span class="token number">0001</span> <span class="token number">6101</span> <span class="token number">0001</span> <span class="token number">4901</span> <span class="token number">0001</span>
<span class="token number">6201</span> <span class="token number">0001</span> <span class="token number">6301</span> <span class="token number">0004</span> <span class="token number">6d</span><span class="token number">61</span> <span class="token number">696</span>e <span class="token number">0100</span> <span class="token number">1628</span>
<span class="token number">5</span>b4c <span class="token number">6</span>a61 <span class="token number">7661</span> <span class="token number">2f</span><span class="token number">6</span>c <span class="token number">616</span>e <span class="token number">672f</span> <span class="token number">5374</span> <span class="token number">7269</span>
<span class="token number">6e67</span> <span class="token number">3</span>b29 <span class="token number">5601</span> <span class="token number">0004</span> <span class="token number">6172</span> <span class="token number">6773</span> <span class="token number">0100</span> <span class="token number">135</span>b
<span class="token number">4</span>c6a <span class="token number">6176</span> <span class="token number">612f</span> <span class="token number">6</span>c61 <span class="token number">6e67</span> <span class="token number">2f</span><span class="token number">53</span> <span class="token number">7472</span> <span class="token number">696</span>e
<span class="token number">673</span>b <span class="token number">0100</span> <span class="token number">046d</span> <span class="token number">6174</span> <span class="token number">6801</span> <span class="token number">0003</span> <span class="token number">7265</span> <span class="token number">7301</span>
<span class="token number">000</span>a <span class="token number">536f</span> <span class="token number">7572</span> <span class="token number">6365</span> <span class="token number">4669</span> <span class="token number">6</span>c65 <span class="token number">0100</span> <span class="token number">094d</span>
<span class="token number">6174</span> <span class="token number">682</span>e <span class="token number">6</span>a61 <span class="token number">7661</span> <span class="token number">0</span>c00 <span class="token number">0600</span> <span class="token number">0701</span> <span class="token number">000d</span>
<span class="token number">636f</span> <span class="token number">6d</span><span class="token number">2f</span> <span class="token number">6e61</span> <span class="token number">6e6f</span> <span class="token number">2f</span><span class="token number">4d</span> <span class="token number">6174</span> <span class="token number">680</span>c <span class="token number">000d</span>
<span class="token number">000</span>e <span class="token number">0100</span> <span class="token number">106</span>a <span class="token number">6176</span> <span class="token number">612f</span> <span class="token number">6</span>c61 <span class="token number">6e67</span> <span class="token number">2f</span><span class="token number">4f</span>
<span class="token number">626</span>a <span class="token number">6563</span> <span class="token number">7400</span> <span class="token number">2100</span> <span class="token number">0200</span> <span class="token number">0500</span> <span class="token number">0000</span> <span class="token number">0000</span>
<span class="token number">0300</span> <span class="token number">0100</span> <span class="token number">0600</span> <span class="token number">0700</span> <span class="token number">0100</span> <span class="token number">0800</span> <span class="token number">0000</span> <span class="token number">3300</span>
<span class="token number">0100</span> <span class="token number">0100</span> <span class="token number">0000</span> <span class="token number">052</span>a b700 <span class="token number">01</span>b1 <span class="token number">0000</span> <span class="token number">0002</span>
<span class="token number">0009</span> <span class="token number">0000</span> <span class="token number">000</span>a <span class="token number">0002</span> <span class="token number">0000</span> <span class="token number">0009</span> <span class="token number">0004</span> <span class="token number">000</span>a
<span class="token number">000</span>a <span class="token number">0000</span> <span class="token number">000</span>c <span class="token number">0001</span> <span class="token number">0000</span> <span class="token number">0005</span> <span class="token number">000</span>b <span class="token number">000</span>c
<span class="token number">0000</span> <span class="token number">0001</span> <span class="token number">000d</span> <span class="token number">000</span>e <span class="token number">0001</span> <span class="token number">0008</span> <span class="token number">0000</span> <span class="token number">0061</span>
<span class="token number">0002</span> <span class="token number">0004</span> <span class="token number">0000</span> <span class="token number">000d</span> <span class="token number">043</span>c <span class="token number">053d</span> <span class="token number">1</span>b1c <span class="token number">6010</span>
<span class="token number">0</span>a68 <span class="token number">3e1d</span> ac00 <span class="token number">0000</span> <span class="token number">0200</span> <span class="token number">0900</span> <span class="token number">0000</span> <span class="token number">1200</span>
<span class="token number">0400</span> <span class="token number">0000</span> <span class="token number">0d</span><span class="token number">00</span> <span class="token number">0200</span> <span class="token number">0e00</span> <span class="token number">0400</span> <span class="token number">0f</span><span class="token number">00</span> <span class="token number">0b00</span>
<span class="token number">1000</span> <span class="token number">0</span>a00 <span class="token number">0000</span> <span class="token number">2</span>a00 <span class="token number">0400</span> <span class="token number">0000</span> <span class="token number">0d</span><span class="token number">00</span> <span class="token number">0b00</span>
<span class="token number">0</span>c00 <span class="token number">0000</span> <span class="token number">0200</span> <span class="token number">0b00</span> <span class="token number">0f</span><span class="token number">00</span> <span class="token number">1000</span> <span class="token number">0100</span> <span class="token number">0400</span>
<span class="token number">0900</span> <span class="token number">1100</span> <span class="token number">1000</span> <span class="token number">0200</span> <span class="token number">0b00</span> <span class="token number">0200</span> <span class="token number">1200</span> <span class="token number">1000</span>
<span class="token number">0300</span> <span class="token number">0900</span> <span class="token number">1300</span> <span class="token number">1400</span> <span class="token number">0100</span> <span class="token number">0800</span> <span class="token number">0000</span> <span class="token number">5400</span>
<span class="token number">0200</span> <span class="token number">0300</span> <span class="token number">0000</span> <span class="token number">0</span>ebb <span class="token number">0002</span> <span class="token number">59</span>b7 <span class="token number">0003</span> <span class="token number">4</span>c2b
b600 <span class="token number">043d</span> b100 <span class="token number">0000</span> <span class="token number">0200</span> <span class="token number">0900</span> <span class="token number">0000</span> <span class="token number">0e00</span>
<span class="token number">0300</span> <span class="token number">0000</span> <span class="token number">1400</span> <span class="token number">0800</span> <span class="token number">1500</span> <span class="token number">0d</span><span class="token number">00</span> <span class="token number">1600</span> <span class="token number">0</span>a00
<span class="token number">0000</span> <span class="token number">2000</span> <span class="token number">0300</span> <span class="token number">0000</span> <span class="token number">0e00</span> <span class="token number">1500</span> <span class="token number">1600</span> <span class="token number">0000</span>
<span class="token number">0800</span> <span class="token number">0600</span> <span class="token number">1700</span> <span class="token number">0</span>c00 <span class="token number">0100</span> <span class="token number">0d</span><span class="token number">00</span> <span class="token number">0100</span> <span class="token number">1800</span>
<span class="token number">1000</span> <span class="token number">0200</span> <span class="token number">0100</span> <span class="token number">1900</span> <span class="token number">0000</span> <span class="token number">0200</span> <span class="token number">1</span>a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>一般不会去人工解析这种 16 进制的<strong>字节码文件</strong>, 可以通过 <strong>javap 命令反编译 class 文件生成更可读的 JVM 字节码指令文件</strong>:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>javap <span class="token operator">-</span>v <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token keyword">class</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用 <strong>javap -c</strong> 对 Math.class 类进行<strong>反编译</strong>得到如下<strong>字节码指令</strong>.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>$ javap <span class="token operator">-</span>c <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token keyword">class</span>
<span class="token class-name">Compiled</span> from <span class="token string">&quot;Math.java&quot;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>nano<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span></span>Math</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>nano<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span></span>Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
       <span class="token number">0</span><span class="token operator">:</span> aload_0
       <span class="token number">1</span><span class="token operator">:</span> invokespecial #<span class="token number">1</span>                  <span class="token comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
       <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">return</span>
  <span class="token comment">// 计算方法</span>
  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
       <span class="token number">0</span><span class="token operator">:</span> iconst_1
       <span class="token number">1</span><span class="token operator">:</span> istore_1
       <span class="token number">2</span><span class="token operator">:</span> iconst_2
       <span class="token number">3</span><span class="token operator">:</span> istore_2
       <span class="token number">4</span><span class="token operator">:</span> iload_1
       <span class="token number">5</span><span class="token operator">:</span> iload_2
       <span class="token number">6</span><span class="token operator">:</span> iadd
       <span class="token number">7</span><span class="token operator">:</span> bipush        <span class="token number">10</span>
       <span class="token number">9</span><span class="token operator">:</span> imul
      <span class="token number">10</span><span class="token operator">:</span> istore_3
      <span class="token number">11</span><span class="token operator">:</span> iload_3
      <span class="token number">12</span><span class="token operator">:</span> ireturn

  <span class="token comment">// main方法    </span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
       <span class="token number">0</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">2</span>                  <span class="token comment">// class com/nano/jvm/Math</span>
       <span class="token number">3</span><span class="token operator">:</span> dup
       <span class="token number">4</span><span class="token operator">:</span> invokespecial #<span class="token number">3</span>                  <span class="token comment">// Method &quot;&lt;init&gt;&quot;:()V</span>
       <span class="token number">7</span><span class="token operator">:</span> astore_1
       <span class="token number">8</span><span class="token operator">:</span> aload_1
       <span class="token number">9</span><span class="token operator">:</span> invokevirtual #<span class="token number">4</span>                  <span class="token comment">// Method compute:()I</span>
      <span class="token number">12</span><span class="token operator">:</span> pop
      <span class="token number">13</span><span class="token operator">:</span> <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>可以看到两个方法都被反编译出来. Code 下面各个字节码指令之前的号码就可以看成是<strong>行号</strong>, <strong>程序计数器</strong>就是记录执行时的这些行号. 上面的计算过程可以通过下面的<strong>架构</strong>表示. 这里的信息量很多, 仔细看图.</p> <p><img src="assets/image-20230325134224-4lojnst.png" alt="image"></p> <p>可以看到这个 main 线程中<strong>分配了两个栈帧(每个方法都会分配一个栈帧)</strong>, 一个是 <strong>main() 方法的栈帧</strong>, 一个是 <strong>compute() 方法的栈帧</strong>, <strong>局部变量 a b c 都在局部变量表中, 计算 a + b 的时候需要把它们加载到操作数栈进行加法操作</strong>, 具体可以看字节码的指令就是这个过程.</p> <p>在 main() 方法对应的栈帧中, <strong>math 变量</strong>是一个<strong>普通对象</strong>, 它指向<strong>堆中</strong>的实例.</p> <p>再使用 <strong>javap -v</strong> 参数<strong>反编译</strong> Math.class, 可以看到反编译出<strong>更多的信息</strong>.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ javap <span class="token parameter variable">-v</span> Math.class

Classfile /Users/nano/NanoNoteCode/jvm/target/classes/com/nano/Math.class
  Last modified <span class="token number">2023</span>-3-23<span class="token punctuation">;</span> size <span class="token number">589</span> bytes
  MD5 checksum 20a52ab32d258c5fb970c324580aee76
  Compiled from <span class="token string">&quot;Math.java&quot;</span>
public class com.nano.Math
  minor version: <span class="token number">0</span>
  major version: <span class="token number">51</span>
  flags: ACC_PUBLIC, ACC_SUPER
<span class="token comment"># 常量池信息</span>
Constant pool:
   <span class="token comment">#1 = Methodref          #5.#27         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
   <span class="token comment">#2 = Class              #28            // com/nano/Math</span>
   <span class="token comment">#3 = Methodref          #2.#27         // com/nano/Math.&quot;&lt;init&gt;&quot;:()V</span>
   <span class="token comment">#4 = Methodref          #2.#29         // com/nano/Math.compute:()I</span>
   <span class="token comment">#5 = Class              #30            // java/lang/Object</span>
   <span class="token comment">#6 = Utf8               &lt;init&gt;</span>
   <span class="token comment">#7 = Utf8               ()V</span>
   <span class="token comment">#8 = Utf8               Code</span>
   <span class="token comment">#9 = Utf8               LineNumberTable</span>
  <span class="token comment">#10 = Utf8               LocalVariableTable</span>
  <span class="token comment">#11 = Utf8               this</span>
  <span class="token comment">#12 = Utf8               Lcom/nano/Math;</span>
  <span class="token comment">#13 = Utf8               compute</span>
  <span class="token comment">#14 = Utf8               ()I</span>
  <span class="token comment">#15 = Utf8               a</span>
  <span class="token comment">#16 = Utf8               I</span>
  <span class="token comment">#17 = Utf8               b</span>
  <span class="token comment">#18 = Utf8               c</span>
  <span class="token comment">#19 = Utf8               main</span>
  <span class="token comment">#20 = Utf8               ([Ljava/lang/String;)V</span>
  <span class="token comment">#21 = Utf8               args</span>
  <span class="token comment">#22 = Utf8               [Ljava/lang/String;</span>
  <span class="token comment">#23 = Utf8               math</span>
  <span class="token comment">#24 = Utf8               res</span>
  <span class="token comment">#25 = Utf8               SourceFile</span>
  <span class="token comment">#26 = Utf8               Math.java</span>
  <span class="token comment">#27 = NameAndType        #6:#7          // &quot;&lt;init&gt;&quot;:()V</span>
  <span class="token comment">#28 = Utf8               com/nano/Math</span>
  <span class="token comment">#29 = NameAndType        #13:#14        // compute:()I</span>
  <span class="token comment">#30 = Utf8               java/lang/Object</span>
<span class="token punctuation">{</span>
  public com.nano.Math<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor: <span class="token punctuation">(</span><span class="token punctuation">)</span>V
    flags: ACC_PUBLIC
    Code:
      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span>: aload_0
         <span class="token number">1</span>: invokespecial <span class="token comment">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
         <span class="token number">4</span>: <span class="token builtin class-name">return</span>
      LineNumberTable:
        line <span class="token number">9</span>: <span class="token number">0</span>
        line <span class="token number">10</span>: <span class="token number">4</span>
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            <span class="token number">0</span>       <span class="token number">5</span>     <span class="token number">0</span>  this   Lcom/nano/Math<span class="token punctuation">;</span>

  public int compute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor: <span class="token punctuation">(</span><span class="token punctuation">)</span>I
    flags: ACC_PUBLIC
    Code:
      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span>: iconst_1
         <span class="token number">1</span>: istore_1
         <span class="token number">2</span>: iconst_2
         <span class="token number">3</span>: istore_2
         <span class="token number">4</span>: iload_1
         <span class="token number">5</span>: iload_2
         <span class="token number">6</span>: iadd
         <span class="token number">7</span>: bipush        <span class="token number">10</span>
         <span class="token number">9</span>: imul
        <span class="token number">10</span>: istore_3
        <span class="token number">11</span>: iload_3
        <span class="token number">12</span>: ireturn
      LineNumberTable:
        line <span class="token number">13</span>: <span class="token number">0</span>
        line <span class="token number">14</span>: <span class="token number">2</span>
        line <span class="token number">15</span>: <span class="token number">4</span>
        line <span class="token number">16</span>: <span class="token number">11</span>
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            <span class="token number">0</span>      <span class="token number">13</span>     <span class="token number">0</span>  this   Lcom/nano/Math<span class="token punctuation">;</span>
            <span class="token number">2</span>      <span class="token number">11</span>     <span class="token number">1</span>     a   I
            <span class="token number">4</span>       <span class="token number">9</span>     <span class="token number">2</span>     b   I
           <span class="token number">11</span>       <span class="token number">2</span>     <span class="token number">3</span>     c   I

  public static void main<span class="token punctuation">(</span>java.lang.String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor: <span class="token punctuation">(</span><span class="token punctuation">[</span>Ljava/lang/String<span class="token punctuation">;</span><span class="token punctuation">)</span>V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span>: new           <span class="token comment">#2                  // class com/nano/Math</span>
         <span class="token number">3</span>: dup
         <span class="token number">4</span>: invokespecial <span class="token comment">#3                  // Method &quot;&lt;init&gt;&quot;:()V</span>
         <span class="token number">7</span>: astore_1
         <span class="token number">8</span>: aload_1
         <span class="token number">9</span>: invokevirtual <span class="token comment">#4                  // Method compute:()I</span>
        <span class="token number">12</span>: istore_2
        <span class="token number">13</span>: <span class="token builtin class-name">return</span>
      LineNumberTable:
        line <span class="token number">20</span>: <span class="token number">0</span>
        line <span class="token number">21</span>: <span class="token number">8</span>
        line <span class="token number">22</span>: <span class="token number">13</span>
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            <span class="token number">0</span>      <span class="token number">14</span>     <span class="token number">0</span>  args   <span class="token punctuation">[</span>Ljava/lang/String<span class="token punctuation">;</span>
            <span class="token number">8</span>       <span class="token number">6</span>     <span class="token number">1</span>  math   Lcom/nano/Math<span class="token punctuation">;</span>
           <span class="token number">13</span>       <span class="token number">1</span>     <span class="token number">2</span>   res   I
<span class="token punctuation">}</span>
SourceFile: <span class="token string">&quot;Math.java&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br></div></div><p>个人理解: 一个程序的执行也就是<strong>执行的 JVM 的字节码指令</strong>, 这些指令是被<strong>存放到方法区</strong>中的, 它们都有<strong>各自的入口地址</strong>. 当一个栈上的<strong>方法需要执行</strong>时, 就需要将方法中的符号(<strong>符号引用</strong>) 对应到<strong>方法区中的入口地址(直接引用)</strong>, 这样字节码执行引擎<strong>才能获取到字节码并执行方法</strong>. 符号引用转换为直接应用的过程就是解析中的<strong>链接</strong>, 这里就有<strong>静态链接和动态链接</strong>.</p> <p><strong>常量池</strong>里面就有很多东西, 其中就有一系列的<strong>符号</strong>, 代表着<strong>类名称, 方法名称</strong>等. 对象头里面的指针找到方法区中对应方法所对应的<strong>字节码</strong>的<strong>入口地址</strong>, 并放到栈帧的<strong>动态链接</strong>部分中. 这也就是符号引用转换为 JVM 指令码地址的<strong>直接引用</strong>. 其实解析阶段的静态链接和动态链接做的事情其实都差不多, 其实也就是将方法符号引用转换为对应的<strong>字节码</strong>的<strong>入口地址</strong>(也就是<strong>直接引用</strong>) 的过程, 只是静态方法等在<strong>类加载</strong>的时候就完成了, 所以是静态链接, 而普通方法是在<strong>运行的时候完成</strong>, 所以是动态链接. 如果是运行时再去寻找<strong>符号引用</strong>所对应的 <strong>JVM 字节码的入口地址</strong>, 那就比较灵活了, 就可以得到<strong>不同</strong>的入口地址, 进而实现<strong>多态</strong>.</p> <p>栈溢出 <strong>StackOverflowError</strong> demo. 设置 -Xss128k. 这里 128K 指的是<strong>一个线程</strong>的最大栈空间, 而不是全部线程.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// JVM设置  -Xss128k(默认1M)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StackOverflowTest</span> <span class="token punctuation">{</span>
    <span class="token comment">// 记录栈深度</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> depth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        depth<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>depth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>运行结果, 栈溢出:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>StackOverflowError</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>nano<span class="token punctuation">.</span>oom<span class="token punctuation">.</span></span>StackOverflowTest</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">StackOverflowTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>nano<span class="token punctuation">.</span>oom<span class="token punctuation">.</span></span>StackOverflowTest</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">StackOverflowTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>nano<span class="token punctuation">.</span>oom<span class="token punctuation">.</span></span>StackOverflowTest</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">StackOverflowTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>nano<span class="token punctuation">.</span>oom<span class="token punctuation">.</span></span>StackOverflowTest</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">StackOverflowTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>nano<span class="token punctuation">.</span>oom<span class="token punctuation">.</span></span>StackOverflowTest</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">StackOverflowTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">18508</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里一直递归调用一个方法, 直到<strong>栈溢出</strong>, 打印出当前线程可以调用的最大深度, 这里在默认 1M 的情况下为 18508.</p> <h4 id="对象创建过程"><a href="#对象创建过程" class="header-anchor">#</a> 对象创建过程</h4> <p>在语言层面上, 创建对象(含克隆, 反序列化等) 通常仅仅是一个 <strong>new</strong> 关键字而己, 而在虚拟机中, 对象(指普通 Java 对象, <strong>非数组和 Class 对象</strong>等) 的创建是一个非常复杂的过程.</p> <blockquote><p>new一个对象发生了什么?</p></blockquote> <p><img src="assets/image-20230325144646-ymyx4vi.png" alt="https://www.processon.com/diagraming/641e9844b13bd654f0293ee0" title="对象创建过程"></p> <p><strong>只要使用 new 方法, 便需要创建新的对象.</strong></p> <h5 id="_1-类加载检查"><a href="#_1-类加载检查" class="header-anchor">#</a> 1.类加载检查</h5> <p>首先检查这个类<strong>是否已被</strong>加载, 解析和初始化过. 如果没有, 则必须<strong>先执行</strong>相应的<strong>类加载过程</strong>.</p> <p>虚拟机遇到一条 new 指令时, 首先将去检查这个指令的参数是否能在常量池中定位到一个类的符号引用, 并且检查这个符号引用代表的类是否已被加载, 解析和初始化过. 如果没有, 那必须先执行相应的类加载过程.</p> <p>new 指令对应到语言层面上讲是, new 关键词, 对象克隆, 对象序列化等.</p> <h5 id="_2-内存分配"><a href="#_2-内存分配" class="header-anchor">#</a> 2.内存分配</h5> <p>在<strong>类加载检查</strong>通过后, 接下来虚拟机将为新生对象<strong>分配内存</strong>. 对象所需的内存大小在<strong>类加载完成后便可确定</strong>, 为对象分配空间的任务就是把一块确定大小的内存从<strong>堆</strong>中划分出来.</p> <p>这个步骤有两个问题:</p> <p>1.如何划分内存.</p> <p>2.在并发情况下, 可能出现正在给对象 A 分配内存, 指针还没来得及修改, 对象 B 又同时使用了原来的指针来分配内存的情况.</p> <h6 id="_1-内存分配方式"><a href="#_1-内存分配方式" class="header-anchor">#</a> (1)内存分配方式</h6> <p><strong>内存分配方式</strong>有 <strong>&quot;指针碰撞&quot;</strong> 和 <strong>&quot;空闲列表&quot;</strong> 两种, <strong>选择那种分配方式根据堆是否规整决定, 而堆是否规整又由所采用的垃圾收集器是否带有压缩整理功能决定</strong>.</p> <ul><li>如果堆中<strong>内存是绝对规整</strong>的, 所有用过的内存都放在一边, 空闲的内存放在另一边, 中间放着一个指针作为分界点的指示器, 那所分配内存就仅仅是把那个指针向空闲空间那边挪动一段与对象大小相等的距离. 这种分配方式称为&quot;指针碰撞&quot;.</li> <li>如果堆中<strong>内存并不是规整</strong>的, 已使用的内存和空闲的<strong>内存相互交错</strong>, 虚拟机就必须维护一个列表, 记录哪些内存块是可用的, 在分配的时候从列表中找到一块足够大的空间划分给对象实例, 并更新列表上的记录. 这种分配方式称为 <strong>&quot;空闲列表&quot;</strong>.</li></ul> <p>不同垃圾收集器的对内存的管理方式不同而会采用不同的内存分配方式. 在使用 Serial, ParNew 等带 Compact(紧凑) 过程的收集器时, 系统采用的分配算法是<strong>指针碰撞</strong>, 而使用 CMS 这种基于 Mark-Sweep 算法的收集器时, 通常采用<strong>空闲列表</strong>.</p> <h6 id="_2-内存分配并发问题"><a href="#_2-内存分配并发问题" class="header-anchor">#</a> (2)内存分配并发问题</h6> <p>创建对象的时候有一个很重要的问题就是<strong>线程安全</strong>. 开发过程中创建对象是很频繁的事情, 作为虚拟机来说, 必须要保证线程是安全的, 通常来讲, <strong>虚拟机采用两种方式来保证线程安全</strong>:</p> <ul><li><strong>CAS + 失败重试: ​</strong>CAS 是乐观锁的一种实现方式. 即每次不加锁而是假设没有冲突而去完成某项操作, 如果因为冲突失败就重试, 直到成功为止. <strong>虚拟机采用 CAS 配上失败重试的方式保证更新操作的原子性.</strong></li> <li><strong>本地线程分配缓冲(Thread Local Allocation Buffer,TLAB): ​</strong>为每个线程预先在 <strong>Eden 区</strong>分配一块内存, JVM 在给线程中的对象分配内存时, <strong>首先在 TLAB 分配</strong>, 当对象大于 TLAB 中的剩余内存或 TLAB 的内存已用尽时, 再采用上述的 CAS 进行内存分配. 通过参数 -XX:+/-UseTLAB 来设定虚拟机是否使用 TLAB(JVM 会默认开启 -XX:+UseTLAB), -XX:TLABSize 指定 TLAB 大小.</li></ul> <h5 id="_3-初始化零值"><a href="#_3-初始化零值" class="header-anchor">#</a> 3.初始化零值</h5> <p>初始化零值给属性设置<strong>默认值</strong>. 内存分配完成后, 虚拟机需要将分配到的<strong>内存空间都初始化为零值</strong>(不包括对象头), 这一步操作保证了对象的<strong>实例字段</strong>在代码中可以<strong>不赋初始值</strong>就直接使用, 程序能访问到这些字段的数据类型所对应的零值. 默认零值就是各种数据类型的默认值, 比如 int 默认值为 0.</p> <h5 id="_4-设置对象头"><a href="#_4-设置对象头" class="header-anchor">#</a> 4.设置对象头</h5> <p>初始化零值完成之后, <strong>虚拟机要对对象进行必要的设置</strong>. 比如对这个对象是那个类的实例, 如何才能找到类的元数据信息, 对象的哈希码, 对象的 GC 分代年龄等在对象头中的信息进行设置. 这些信息存放在对象的<strong>对象头 Object Header</strong> 之中. 此外, 虚拟机也根据对象当前运行<strong>状态</strong>的不同, 如是否启用<strong>偏向锁</strong>等进行对象头的设置. 具体参考下面的<strong>对象头内容</strong>部分.</p> <h5 id="_5-执行init方法"><a href="#_5-执行init方法" class="header-anchor">#</a> 5.执行init方法</h5> <p>从虚拟机的视角来看此时一个<strong>新的对象</strong>已经产生了, 但从 Java <strong>程序</strong>的角度来看, 对象创建才刚开始, 方法还没有执行, <strong>所有的字段都还是默认的初始零值</strong>. 之后便执行 <strong>&lt;init&gt; 方法</strong> 把对象<strong>按照实际代码进行赋值</strong>, 这样一个真正可用的对象才算完全产生出来.</p> <h4 id="对象的内存布局"><a href="#对象的内存布局" class="header-anchor">#</a> 对象的内存布局</h4> <h5 id="_1-对象内存布局"><a href="#_1-对象内存布局" class="header-anchor">#</a> 1.对象内存布局</h5> <p>内存中 Java 是如何保存对象的? 在 HotSpot 虚拟机中, 对象在内存中存储布局分为 <strong>3 块区域</strong>: <strong>对象头(Header), 实例数据(Instance Data), 对齐填充(Padding)</strong>, 下面详细讲解各部分内容.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220601230845563.png" alt=""></p> <h6 id="_1-对象头"><a href="#_1-对象头" class="header-anchor">#</a> (1)对象头</h6> <p>HotSpot 虚拟机的对象头(非数组对象)包括两部分信息, 如下图所示:</p> <ul><li><strong>第一部分</strong>用于存储对象自身的<strong>运行时数据</strong>, 如哈希码(HashCode), GC 分代年龄, 锁状态标志, 线程持有的锁, 偏向线程 ID, 偏向时间戳, 对象分代年龄, 这部分信息称为 <strong>&quot;Mark Word&quot;</strong>. Mark Word 被设计成一个非固定的数据结构以便在极小的空间内存储尽量多的信息, 它会根据自己的状态<strong>复用</strong>自己的存储空间.</li> <li><strong>第二部分</strong>是<strong>类型指针</strong>, 即对象指向它的<strong>类元数据</strong>的指针, 虚拟机通过这个指针来确定这个对象是<strong>哪个类</strong>的实例.</li> <li>如果对象是一个<strong>数组</strong>, 那在对象头中还必须有<strong>一块</strong>用于记录<strong>数组长度</strong>的数据. 因为虚拟机可以通过普通对象的元数据信息确定对象的大小, 但是从数组的元数据中无法确定数组的大小.</li></ul> <p><strong>Mark Word</strong> 在<strong>不同的锁状态</strong>下存储的内容不同, 在 32 位 JVM 中是这样的:</p> <p>​<img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/1568943231089-2797133.png" alt="">​</p> <p>64 位 JVM 是这样的.</p> <p><img src="assets/image-20230325150955-119s4vt.png" alt="image"></p> <p>对象头在 Hotspot 的 C++ 源码 markOop.hpp 文件里的注释如下:</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// Bit-format of an object header (most significant first, big endian layout below):</span>
<span class="token comment">//</span>
<span class="token comment">//  32 bits:</span>
<span class="token comment">//  --------</span>
<span class="token comment">//             hash:25 ------------&gt;| age:4    biased_lock:1 lock:2 (normal object)</span>
<span class="token comment">//             JavaThread*:23 epoch:2 age:4    biased_lock:1 lock:2 (biased object)</span>
<span class="token comment">//             size:32 ------------------------------------------&gt;| (CMS free block)</span>
<span class="token comment">//             PromotedObject*:29 ----------&gt;| promo_bits:3 -----&gt;| (CMS promoted object)</span>
<span class="token comment">//</span>
<span class="token comment">//  64 bits:</span>
<span class="token comment">//  --------</span>
<span class="token comment">//  unused:25 hash:31 --&gt;| unused:1   age:4    biased_lock:1 lock:2 (normal object)</span>
<span class="token comment">//  JavaThread*:54 epoch:2 unused:1   age:4    biased_lock:1 lock:2 (biased object)</span>
<span class="token comment">//  PromotedObject*:61 ---------------------&gt;| promo_bits:3 -----&gt;| (CMS promoted object)</span>
<span class="token comment">//  size:64 -----------------------------------------------------&gt;| (CMS free block)</span>
<span class="token comment">//</span>
<span class="token comment">//  unused:25 hash:31 --&gt;| cms_free:1 age:4    biased_lock:1 lock:2 (COOPs &amp;&amp; normal object)</span>
<span class="token comment">//  JavaThread*:54 epoch:2 cms_free:1 age:4    biased_lock:1 lock:2 (COOPs &amp;&amp; biased object)</span>
<span class="token comment">//  narrowOop:32 unused:24 cms_free:1 unused:4 promo_bits:3 -----&gt;| (COOPs &amp;&amp; CMS promoted object)</span>
<span class="token comment">//  unused:21 size:35 --&gt;| cms_free:1 unused:7 ------------------&gt;| (COOPs &amp;&amp; CMS free block)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h6 id="_2-实例数据"><a href="#_2-实例数据" class="header-anchor">#</a> (2)实例数据</h6> <p>实例数据部分是对象<strong>真正</strong>存储的<strong>有效信息</strong>, 也是在代码中所定义的各类型的字段内容.</p> <h6 id="_3-对齐填充"><a href="#_3-对齐填充" class="header-anchor">#</a> (3)对齐填充</h6> <p>对齐填充不是必然存在的, 它仅起到<strong>占位符</strong>的作用. 由于 HotSpot 的自动内存管理系统要求对象起始地址必须是 <strong>8 字节</strong>的整数倍, 所以对象的大小必须是 8 字节的整数倍, 当对象实例数据部分所占长度不够没有对齐时, 就需要通过对齐填充来补全.</p> <p>对于大部分处理器, 对象以 8 字节整数倍来对齐填充都是最高效的存取方式.</p> <h5 id="_2-估算对象大小"><a href="#_2-估算对象大小" class="header-anchor">#</a> 2.估算对象大小</h5> <blockquote><p>如何估算对象大小?</p></blockquote> <p>32 位系统下, 当使用 <strong>new Object()</strong> 时, JVM 将会分配 <strong>8</strong>(Mark Word + 类型指针) 字节的空间, 128 个 Object 对象将占用 1KB 的空间.</p> <p>如果是 <strong>new Integer()</strong>, 那么对象里还有一个 <strong>int 值</strong>, 其占用 <strong>4 字节</strong>, 这个对象也就是 8 + 4 = 12 字节, 对齐后, 该对象就是 16 字节.</p> <p>以上只是一些简单的对象, 那么常规对象的内部属性是怎么排布的?</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">byte</span> b<span class="token punctuation">;</span>
    <span class="token class-name">String</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>其中对象头部占用 &quot;Mark Word&quot;(4) + &quot;类型指针&quot;(4) = 8 字节; byte 8 位, 占用 1 字节; int 32 位, 占用 4 字节; String 只有引用, 占用 4 字节. 那么对象 A 一共占用了 8+1+4+4 = 17 字节, 按照 8 字节对齐原则, 对象大小也就是 24 字节.</p> <p>这个计算看起来是没有问题的, 对象的大小也确实是 24 字节, 只是实际<strong>对齐</strong>的位置并不对: 在 HotSpot 中, 对象排布时, 间隙是在 4 字节基础上的(在 32 位和 64 位压缩模式下). 上述例子中, int 后面的 byte, 空隙只剩下 3 字节, 接下来的 String 对象引用需要 4 字节来存放, 因此 byte 和对象引用之间就会有 3 字节对齐, 对象引用排布后, 最后会有 4 字节对齐, 因此结果上依然是 7 字节对齐.</p> <p>对象大小也可以用 jol-core 包查看, 依赖.</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.openjdk.jol<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jol-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="对象访问定位"><a href="#对象访问定位" class="header-anchor">#</a> 对象访问定位</h4> <p>为了表示对象的属性, 方法等信息, 不得不需要<strong>结构描述</strong>. 每一个类在被 JVM 加载的时候, JVM 会给这个类创建一个 <strong>instanceKlass</strong> 类型数据, 保存在<strong>方法区</strong>, 用来在 JVM 层表示该类. Hotspot VM 使用<strong>对象头部的一个元数据指针指向 Class 区域</strong>的方式来找到对象的 Class 描述, 以及内部的方法, 属性入口. 如下图所示:</p> <p><img src="assets/image-20230325151334-9riqp7w.png" alt="image"></p> <p>Java 程序通过<strong>栈</strong>上的 <strong>reference 数据</strong>来操作堆上的<strong>具体对象</strong>, 由于 <strong>reference</strong> 类型在虚拟机规范中只规定了一个指向对象引用. 而没有规定这个引用应该通过何种方式去定位, 访问堆中的对象的具体位置, 它取决于虚拟机实现. 目前主要有两种实现方式 <strong>(1) 使用句柄</strong>和 <strong>(2) 直接指针</strong>.</p> <h6 id="_1-使用句柄"><a href="#_1-使用句柄" class="header-anchor">#</a> (1)使用句柄</h6> <p><strong>使用句柄(类似间接指针): ​</strong>​<strong><strong>在</strong></strong>​<strong>堆</strong>中划分出一块<strong>内存</strong>来作为<strong>句柄池</strong>, reference 中存储的就是<strong>对象的句柄地址</strong>, 句柄中包含对象实例数据与类型各自具体地址信息. 如下图所示.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220517225207613.png" alt=""></p> <h6 id="_2-直接指针"><a href="#_2-直接指针" class="header-anchor">#</a> (2)直接指针</h6> <p><strong>直接指针访问: ​</strong>​<strong><strong>Java 堆中的对象布要考虑如何放置访问类型数据相关的信息, 而 ​</strong></strong>​<strong><strong><strong>reference<strong><strong><strong>​</strong></strong>​ 中存储的</strong></strong>​</strong>直接就是对象地址</strong>. 如下图所示. <strong>Hotspot 虚拟机采用此种方式</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20220517225228895.png" alt=""></p> <p><strong>两者的比较:</strong></p> <ul><li><strong>使用句柄</strong>的好处是 reference 中存储的是<strong>稳定的句柄地址</strong>, 在对象被移动时只会改变句柄中的实例数据指针, 而 reference 本身不需要修改.</li> <li><strong>直接指针访问</strong>的最大好处就是速度更快, 节省一次指针定位时间开销.</li></ul> <h4 id="字符串常量池"><a href="#字符串常量池" class="header-anchor">#</a> 字符串常量池</h4> <blockquote><p>字符串常量池的设计思想</p></blockquote> <p>字符串的<strong>分配</strong>和其他的对象分配一样, 可能耗费高昂的时间与空间代价, 作为最基础的数据类型, 大量频繁的创建字符串, 极大程度地影响程序的性能. JVM 为了提高性能和减少内存开销, 在实例化<strong>字符串常量</strong>的时候进行了一些<strong>优化</strong>:</p> <ul><li>为字符串字面量开辟一个<strong>字符串常量池</strong>, 类似于<strong>缓存区</strong>.</li> <li>创建<strong>字符串常量</strong>时, 首先<strong>查询字符串常量池是否存在该字符串</strong>.</li> <li>存在该<strong>字符串</strong>, 返回<strong>引用实例</strong>, 如果不存在, <strong>实例化该字符串并放入池</strong>中.</li></ul> <blockquote><p>三种字符串操作</p></blockquote> <ul><li><strong>直接赋值字符串</strong></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// s指向常量池中的引用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这种方式创建的字符串对象, <strong>只会在常量池</strong>中. 因为有 &quot;Lucy&quot; 这个字面量, 创建对象 s 的时候, JVM 会先去<strong>常量池</strong>中通过 equals(key) 方法, 判断是否有相同的对象. 如果有, 则直接返回该对象在常量池中的引用; 如果没有, 则会在常量池中创建一个新对象, 再返回引用.</p> <ul><li><strong>new String();</strong></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// s1指向内存中的对象引用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这种方式会<strong>保证字符串常量池和堆中都有这个对象</strong>, 没有<strong>就创建</strong>, 最后<strong>返回内存中的对象引用</strong>. 步骤大致如下: 因为有 &quot;Lucy&quot; 这个字面量, 所以会先检查字符串常量池中是否存在字符串 &quot;Lucy&quot;. 如果不存在, 先在字符串常量池里创建一个字符串对象; 再去内存中创建一个字符串对象 &quot;Lucy&quot;; 存在的话, 就直接去内存中创建一个字符串对象 &quot;Lucy&quot;; 最后, 将<strong>内存中的引用返回</strong>.</p> <ul><li><strong>intern() 方法</strong></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token class-name">String</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>String 中的 intern 方法是一个 <strong>native</strong> 的方法, 当调用 intern 方法时, 如果池中已经包含一个等于此 String 对象的字符串(用 equals(oject) 方法确定), 则返回<strong>池中</strong>的字符串. <strong>否则将 intern 返回的引用指向当前字符串 s1</strong>.</p> <blockquote><p>字符串常量池位置</p></blockquote> <ul><li>Jdk1.6 及之前: 有永久代, 运行时常量池在<strong>永久代</strong>, 运行时常量池包含字符串常量池.</li> <li>Jdk1.7: 虽然有永久代但已经逐步 &quot;去永久代&quot;, 字符串常量池从永久代里的运行时常量池分离到<strong>堆里</strong>.</li> <li>Jdk1.8及之后: 无永久代, <strong>方法区在元空间</strong>, <strong>字符串常量池里依然在堆里</strong>.</li></ul> <p>用一个程序证明下字符串常量池在哪里:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/** VM Args:  -Xms10M -Xmx10M */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RuntimeConstantPoolOOM</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">1000000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i <span class="token operator">+</span> j <span class="token operator">/</span> <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>运行结果:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>jdk7及以上<span class="token operator">:</span> <span class="token class-name">Exception</span> in thread <span class="token string">&quot;main&quot;</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>OutOfMemoryError</span><span class="token operator">:</span> <span class="token class-name">Java</span> heap space
jdk6<span class="token operator">:</span> <span class="token class-name">Exception</span> in thread <span class="token string">&quot;main&quot;</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>OutOfMemoryError</span><span class="token operator">:</span> <span class="token class-name">PermGen</span> space
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>字符串常量池设计原理</p></blockquote> <p>字符串常量池底层是 Hotspot 的 C++ 实现的, 底层是一个 <strong>HashTable</strong>,  保存的<strong>本质上是字符串对象的引用</strong>.</p> <p>看一道比较常见的面试题, 下面的代码创建了多少个 String 对象?</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;he&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;llo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 在JDK1.6下输出是 false, 创建 6个对象</span>
<span class="token comment">// 在JDK1.7及以上的版本输出是true, 创建了5个对象</span>
<span class="token comment">// 这里没有考虑GC, 但这些对象确实存在或存在过</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>为什么输出会有这些变化呢? 主要还是<strong>字符串池从永久代中脱离, 移入堆区的原因</strong>,  intern() 方法也相应发生了变化:</p> <p>(1) 在 JDK 1.6 中, 调用 <strong>intern</strong>() 首先会在字符串池中寻找 equal() 相等的字符串, 假如字符串存在就返回该字符串在字符串池中的引用; 假如字符串不存在, 虚拟机会重新在<strong>永久代上创建一个实例</strong>, 将 StringTable 的一个表项指向这个新创建的实例.</p> <p>(2) 在 JDK 1.7(及以上版本) 中, 由于<strong>字符串池不在永久代</strong>了, intern() 做了一些修改, 更方便地利用<strong>堆中</strong>的对象. 字符串存在时和 JDK 1.6一样, 但是字符串<strong>不存在时不再需要重新创建实例, 可以直接指向堆上的实例</strong>.</p> <p>因此 JDK 1.6 字符串池溢出会抛出 OutOfMemoryError: PermGen space , 而在 JDK 1.7 及以上版本抛出 OutOfMemoryError: Java heap space .</p> <blockquote><p>String常量池问题的几个例子</p></blockquote> <p>示例 1:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> s0 <span class="token operator">=</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;Lu&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;cy&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s0 <span class="token operator">==</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s0 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析: 因为例子中的 s0 和 s1中的 &quot;Lucy&quot; 都是<strong>字符串常量</strong>, 它们在<strong>编译期就被确定</strong>了, 所以 s0==s1 为 true; 而 &quot;Lu&quot; 和 &quot;cy&quot; 也都是字符串常量, 当一个字符串由多个字符串常量连接而成时, 它自己肯定也是字符串常量, 所以 s2 也同样在编译期就被<strong>优化</strong>为一个字符串常量 &quot;Lucy&quot;, 所以 s2 也是常量池中 &quot;Lucy&quot; 的一个引用. 所以 s0==s1==s2.</p> <p>示例 2:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> s0 <span class="token operator">=</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;Lu&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;cy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s0 <span class="token operator">==</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>　　<span class="token comment">// false</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s0 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>　 <span class="token comment">// false</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>　　<span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>分析: 用 new String() 创建的字符串<strong>不是常量</strong>, <strong>不能在编译期就确定</strong>, 所以 new String() 创建的字符串<strong>不放入常量池</strong>中, 它们<strong>有自己的地址空间</strong>. s0 还是常量池中 &quot;Lucy&quot; 的引用, s1 因为无法在编译期确定, 所以是<strong>运行时创建的新对象 &quot;Lucy&quot; 的引用, s2 因为有后半部分 new String(&quot;cy&quot;) 所以</strong>也无法在编译期确定, 所以也是一个<strong>新创建</strong>对象 &quot;Lucy&quot; 的引用.</p> <p>示例 3:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;a1&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result = true </span>

<span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;atrue&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result = true </span>

<span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;a3.4&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> <span class="token number">3.4</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result = true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>分析: JVM 对于<strong>字符串常量</strong>的 &quot;+ &quot;号连接, 将在<strong>程序编译期</strong>时就将常量字符串的 &quot;+&quot; 连接<strong>优化为连接后的值</strong>, 比如 &quot;a&quot; + 1 来说, 经编译器优化后在 class 中就已经是 &quot;a1&quot;. 在<strong>编译期其字符串常量的值就确定下</strong>来, 故上面程序最终的结果都为 true.</p> <p>示例 4:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> bb <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> bb<span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result = false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析: JVM 对于<strong>字符串引用</strong>, 由于在字符串的 &quot;+&quot; 连接中, 有<strong>字符串引用存在</strong>, 而引用的值在<strong>程序编译期是无法确定</strong>的, 即 &quot;a&quot; + bb <strong>无法被编译器优化</strong>, 只有在程序运行期来动态分配并将连接后的新地址赋给 b. 所以上面程序的结果也就为false.</p> <p>示例 5:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> bb <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> bb<span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result = true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析: 和示例 4 中唯一不同的是 bb 字符串加了 <strong>final 修饰</strong>, 对于 final 修饰的变量, 它在<strong>编译时被解析为常量值</strong>的一个本地拷贝存储到自己的常量池中或嵌入到它的字节码流中. 所以此时的 &quot;a&quot; + bb 和 &quot;a&quot; + &quot;b&quot; 效果是<strong>一样</strong>的. 故上面程序的结果为 true.</p> <p>示例 6:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> bb <span class="token operator">=</span> <span class="token function">getBB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> bb<span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result = false</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getBB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>分析: JVM 对于<strong>字符串引用 bb</strong>, 它的值在编译期<strong>无法确定</strong>, 只有在程序运行期调用方法后, 将方法的返回值和 &quot;a&quot; 来动态连接并分配地址为 b, 故上面 程序的结果为 false.</p> <p><strong>关于 String 是不可变的</strong>, 通过上面例子可以得出得知:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span>  s  <span class="token operator">=</span>  <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;b&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 就等价于String s = &quot;abc&quot;;</span>
<span class="token class-name">String</span>  a  <span class="token operator">=</span>  <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span>  b  <span class="token operator">=</span>  <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span>  c  <span class="token operator">=</span>  <span class="token string">&quot;c&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span>  s1  <span class="token operator">=</span>   a  <span class="token operator">+</span>  b  <span class="token operator">+</span>  c<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>s1 就不一样了, 可以通过观察其 <strong>JVM 指令码</strong>发现 s1 的 &quot;+&quot; 操作会变成如下操作:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">StringBuilder</span> temp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
temp<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>最后再看一个例子</strong>:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 字符串常量池: &quot;计算机&quot;和&quot;技术&quot;  堆内存: str1引用的对象&quot;计算机技术&quot;  </span>
<span class="token comment">// 堆内存中还有个StringBuilder的对象, 但是会被gc回收, StringBuilder的toString方法会new String(), 这个String才是真正返回的对象引用</span>
<span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;计算机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;技术&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//没有出现&quot;计算机技术&quot;字面量, 所以不会在常量池里生成&quot;计算机技术&quot;对象</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str2 <span class="token operator">==</span> str2<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
<span class="token comment">// 计算机技术在池中没有, 但是在heap中存在, 则intern时, 会直接返回该heap中的引用</span>

<span class="token comment">// 字符串常量池: &quot;ja&quot;和&quot;va&quot; 堆内存: str1引用的对象&quot;java&quot;  </span>
<span class="token comment">// 堆内存中还有个StringBuilder的对象, 但是会被gc回收, StringBuilder的toString方法会new String(), 这个String才是真正返回的对象引用</span>
<span class="token comment">// 没有出现&quot;java&quot;字面量, 所以不会在常量池里生成&quot;java&quot;对象</span>
<span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;ja&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;va&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1 <span class="token operator">==</span> str1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>
<span class="token comment">// java是关键字, 在JVM初始化的相关类里肯定早就放进字符串常量池了</span>

<span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// false</span>
<span class="token comment">// &quot;test&quot;作为字面量, 放入了池中, 而new时s1指向的是heap中新生成的string对象, s1.intern()指向的是&quot;test&quot;字面量之前在池中生成的字符串对象</span>

<span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2 <span class="token operator">==</span> s2<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>‍</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <ul><li>《深入理解 Java 虚拟机: JVM 高级特性与最佳实践(第二版》</li> <li>《实战 java 虚拟机》</li> <li><a href="https://docs.oracle.com/javase/specs/index.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/specs/index.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.pointsoftware.ch/en/under-the-hood-runtime-data-areas-javas-memory-model/" target="_blank" rel="noopener noreferrer">http://www.pointsoftware.ch/en/under-the-hood-runtime-data-areas-javas-memory-model/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://dzone.com/articles/jvm-permgen-%E2%80%93-where-art-thou" target="_blank" rel="noopener noreferrer">https://dzone.com/articles/jvm-permgen-%E2%80%93-where-art-thou<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://stackoverflow.com/questions/9095748/method-area-and-permgen" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/9095748/method-area-and-permgen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>深入解析String#intern<a href="https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html" target="_blank" rel="noopener noreferrer">https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/wangbiao007/article/details/78545189" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/wangbiao007/article/details/78545189<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/main/docs/20.开发/2200.JVM/1.JVM内存区域与对象解析.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b13a90/" class="prev">Spring MVC源码分析</a></span> <span class="next"><a href="/pages/05acae/">内存分配与垃圾收集</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f90282/"><div>
            基础
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/0f75ac/"><div>
            搜索二叉树BST
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/39721f/"><div>
            平衡二叉树AVL
            <!----></div></a> <span class="date">06-08</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1174520425@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/nanodaemony" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>达尔文的猹 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.5bc2c979.js" defer></script><script src="/assets/js/2.eccd4273.js" defer></script><script src="/assets/js/165.a645ef3a.js" defer></script>
  </body>
</html>
