<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL锁机制与事务并发控制 | Pangolin</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="大道至简">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.76d9f797.css" as="style"><link rel="preload" href="/assets/js/app.5bc2c979.js" as="script"><link rel="preload" href="/assets/js/2.eccd4273.js" as="script"><link rel="preload" href="/assets/js/182.8bfd08cd.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8038d8.js"><link rel="prefetch" href="/assets/js/100.db890b43.js"><link rel="prefetch" href="/assets/js/101.9b9a913e.js"><link rel="prefetch" href="/assets/js/102.b98098b4.js"><link rel="prefetch" href="/assets/js/103.20eafae5.js"><link rel="prefetch" href="/assets/js/104.5f942f86.js"><link rel="prefetch" href="/assets/js/105.a443c173.js"><link rel="prefetch" href="/assets/js/106.6530e112.js"><link rel="prefetch" href="/assets/js/107.7b05a1d1.js"><link rel="prefetch" href="/assets/js/108.8c45adc4.js"><link rel="prefetch" href="/assets/js/109.ea29e43c.js"><link rel="prefetch" href="/assets/js/11.8d2b228f.js"><link rel="prefetch" href="/assets/js/110.0765054b.js"><link rel="prefetch" href="/assets/js/111.ae06b85d.js"><link rel="prefetch" href="/assets/js/112.b27bb80e.js"><link rel="prefetch" href="/assets/js/113.592e5b3f.js"><link rel="prefetch" href="/assets/js/114.677c3c60.js"><link rel="prefetch" href="/assets/js/115.fb35062d.js"><link rel="prefetch" href="/assets/js/116.19de2d57.js"><link rel="prefetch" href="/assets/js/117.ac783334.js"><link rel="prefetch" href="/assets/js/118.06b27dd3.js"><link rel="prefetch" href="/assets/js/119.cf6bb932.js"><link rel="prefetch" href="/assets/js/12.8764d408.js"><link rel="prefetch" href="/assets/js/120.ba8e09a5.js"><link rel="prefetch" href="/assets/js/121.bc501a72.js"><link rel="prefetch" href="/assets/js/122.c9a3dd47.js"><link rel="prefetch" href="/assets/js/123.b474c20b.js"><link rel="prefetch" href="/assets/js/124.f405a8c5.js"><link rel="prefetch" href="/assets/js/125.24083f67.js"><link rel="prefetch" href="/assets/js/126.3c5c6c33.js"><link rel="prefetch" href="/assets/js/127.b561056f.js"><link rel="prefetch" href="/assets/js/128.58891fb1.js"><link rel="prefetch" href="/assets/js/129.5073fbfd.js"><link rel="prefetch" href="/assets/js/13.1034e1a1.js"><link rel="prefetch" href="/assets/js/130.ca12ca1d.js"><link rel="prefetch" href="/assets/js/131.8e520e7f.js"><link rel="prefetch" href="/assets/js/132.0f186ee2.js"><link rel="prefetch" href="/assets/js/133.1d8479f7.js"><link rel="prefetch" href="/assets/js/134.9c30d69b.js"><link rel="prefetch" href="/assets/js/135.91463dab.js"><link rel="prefetch" href="/assets/js/136.5e57454a.js"><link rel="prefetch" href="/assets/js/137.1d4e51f0.js"><link rel="prefetch" href="/assets/js/138.6cd3ac7f.js"><link rel="prefetch" href="/assets/js/139.7bd789a6.js"><link rel="prefetch" href="/assets/js/14.ead46968.js"><link rel="prefetch" href="/assets/js/140.e1d92390.js"><link rel="prefetch" href="/assets/js/141.23e11057.js"><link rel="prefetch" href="/assets/js/142.c8cc0f38.js"><link rel="prefetch" href="/assets/js/143.fc738cb7.js"><link rel="prefetch" href="/assets/js/144.67c64203.js"><link rel="prefetch" href="/assets/js/145.cc73ed45.js"><link rel="prefetch" href="/assets/js/146.adaac4c0.js"><link rel="prefetch" href="/assets/js/147.0e83b5c1.js"><link rel="prefetch" href="/assets/js/148.1f253a46.js"><link rel="prefetch" href="/assets/js/149.ab428593.js"><link rel="prefetch" href="/assets/js/15.198f32e1.js"><link rel="prefetch" href="/assets/js/150.64cd514e.js"><link rel="prefetch" href="/assets/js/151.ca1ae55a.js"><link rel="prefetch" href="/assets/js/152.4119b23d.js"><link rel="prefetch" href="/assets/js/153.ed663263.js"><link rel="prefetch" href="/assets/js/154.71b836f6.js"><link rel="prefetch" href="/assets/js/155.c47e2e88.js"><link rel="prefetch" href="/assets/js/156.3e91e0f4.js"><link rel="prefetch" href="/assets/js/157.811b1421.js"><link rel="prefetch" href="/assets/js/158.71193c19.js"><link rel="prefetch" href="/assets/js/159.f09778fd.js"><link rel="prefetch" href="/assets/js/16.03096de2.js"><link rel="prefetch" href="/assets/js/160.15d99de4.js"><link rel="prefetch" href="/assets/js/161.813166a0.js"><link rel="prefetch" href="/assets/js/162.c52bbf77.js"><link rel="prefetch" href="/assets/js/163.ada6991a.js"><link rel="prefetch" href="/assets/js/164.d8ceba57.js"><link rel="prefetch" href="/assets/js/165.a645ef3a.js"><link rel="prefetch" href="/assets/js/166.995d24ad.js"><link rel="prefetch" href="/assets/js/167.d7278e80.js"><link rel="prefetch" href="/assets/js/168.e388905a.js"><link rel="prefetch" href="/assets/js/169.52edabbb.js"><link rel="prefetch" href="/assets/js/17.a49f9c19.js"><link rel="prefetch" href="/assets/js/170.0b62c5b4.js"><link rel="prefetch" href="/assets/js/171.017c8997.js"><link rel="prefetch" href="/assets/js/172.f0763c39.js"><link rel="prefetch" href="/assets/js/173.c961bf43.js"><link rel="prefetch" href="/assets/js/174.395224c0.js"><link rel="prefetch" href="/assets/js/175.52fbdc96.js"><link rel="prefetch" href="/assets/js/176.14e0a3b2.js"><link rel="prefetch" href="/assets/js/177.78f7d89f.js"><link rel="prefetch" href="/assets/js/178.c08bdd65.js"><link rel="prefetch" href="/assets/js/179.b634397c.js"><link rel="prefetch" href="/assets/js/18.9786a034.js"><link rel="prefetch" href="/assets/js/180.284b6c99.js"><link rel="prefetch" href="/assets/js/181.b4744ee7.js"><link rel="prefetch" href="/assets/js/183.59b0b92b.js"><link rel="prefetch" href="/assets/js/184.a5fae95c.js"><link rel="prefetch" href="/assets/js/185.dcf55c72.js"><link rel="prefetch" href="/assets/js/186.6b1cf319.js"><link rel="prefetch" href="/assets/js/187.312708d0.js"><link rel="prefetch" href="/assets/js/188.71de21d0.js"><link rel="prefetch" href="/assets/js/189.7d72c108.js"><link rel="prefetch" href="/assets/js/19.089d6618.js"><link rel="prefetch" href="/assets/js/190.85dce0bd.js"><link rel="prefetch" href="/assets/js/191.08f7136b.js"><link rel="prefetch" href="/assets/js/192.6a155217.js"><link rel="prefetch" href="/assets/js/193.64f71670.js"><link rel="prefetch" href="/assets/js/194.c4d60c72.js"><link rel="prefetch" href="/assets/js/195.748850e9.js"><link rel="prefetch" href="/assets/js/196.887ef31c.js"><link rel="prefetch" href="/assets/js/197.4473c177.js"><link rel="prefetch" href="/assets/js/198.ea53a990.js"><link rel="prefetch" href="/assets/js/199.886f6490.js"><link rel="prefetch" href="/assets/js/20.a52783e8.js"><link rel="prefetch" href="/assets/js/200.7619a798.js"><link rel="prefetch" href="/assets/js/201.d3f5de5f.js"><link rel="prefetch" href="/assets/js/202.ed4c18cc.js"><link rel="prefetch" href="/assets/js/203.7937068e.js"><link rel="prefetch" href="/assets/js/204.3dbdd61c.js"><link rel="prefetch" href="/assets/js/205.52bc6fdf.js"><link rel="prefetch" href="/assets/js/206.4393998f.js"><link rel="prefetch" href="/assets/js/207.ec8e121d.js"><link rel="prefetch" href="/assets/js/208.f54d4e42.js"><link rel="prefetch" href="/assets/js/209.1bc5d06d.js"><link rel="prefetch" href="/assets/js/21.2e3bed21.js"><link rel="prefetch" href="/assets/js/210.2a3dc088.js"><link rel="prefetch" href="/assets/js/211.7084c526.js"><link rel="prefetch" href="/assets/js/212.de742850.js"><link rel="prefetch" href="/assets/js/213.fc775028.js"><link rel="prefetch" href="/assets/js/214.e338168c.js"><link rel="prefetch" href="/assets/js/215.3e89c57e.js"><link rel="prefetch" href="/assets/js/216.ecfe7587.js"><link rel="prefetch" href="/assets/js/217.14dcd4a2.js"><link rel="prefetch" href="/assets/js/218.ee7d57f7.js"><link rel="prefetch" href="/assets/js/219.c263c1e8.js"><link rel="prefetch" href="/assets/js/22.3d09766f.js"><link rel="prefetch" href="/assets/js/220.33f2bfd2.js"><link rel="prefetch" href="/assets/js/221.cd55e739.js"><link rel="prefetch" href="/assets/js/222.63107647.js"><link rel="prefetch" href="/assets/js/223.768ef403.js"><link rel="prefetch" href="/assets/js/224.54357078.js"><link rel="prefetch" href="/assets/js/225.b8e46582.js"><link rel="prefetch" href="/assets/js/226.1d0dcae9.js"><link rel="prefetch" href="/assets/js/227.a351c0a1.js"><link rel="prefetch" href="/assets/js/228.f7b8c278.js"><link rel="prefetch" href="/assets/js/229.8e4aba4d.js"><link rel="prefetch" href="/assets/js/23.b87e3933.js"><link rel="prefetch" href="/assets/js/230.186bd7a5.js"><link rel="prefetch" href="/assets/js/231.dad483e1.js"><link rel="prefetch" href="/assets/js/232.26555358.js"><link rel="prefetch" href="/assets/js/233.658ba0e4.js"><link rel="prefetch" href="/assets/js/234.7994cee0.js"><link rel="prefetch" href="/assets/js/235.3934d057.js"><link rel="prefetch" href="/assets/js/236.59cb6eac.js"><link rel="prefetch" href="/assets/js/237.baa1c655.js"><link rel="prefetch" href="/assets/js/238.8ee9f8ae.js"><link rel="prefetch" href="/assets/js/239.b0fe3966.js"><link rel="prefetch" href="/assets/js/24.afe2a3c4.js"><link rel="prefetch" href="/assets/js/240.d06483fa.js"><link rel="prefetch" href="/assets/js/241.81a2223e.js"><link rel="prefetch" href="/assets/js/242.8f6eee74.js"><link rel="prefetch" href="/assets/js/243.874461fa.js"><link rel="prefetch" href="/assets/js/244.ec0bb622.js"><link rel="prefetch" href="/assets/js/245.2ecf61f8.js"><link rel="prefetch" href="/assets/js/246.e7f6e55c.js"><link rel="prefetch" href="/assets/js/247.f32a1a4b.js"><link rel="prefetch" href="/assets/js/248.4302c4d8.js"><link rel="prefetch" href="/assets/js/249.9b0a4d9f.js"><link rel="prefetch" href="/assets/js/25.a22777b8.js"><link rel="prefetch" href="/assets/js/250.1295326c.js"><link rel="prefetch" href="/assets/js/251.d1cdb160.js"><link rel="prefetch" href="/assets/js/252.4e9d56fe.js"><link rel="prefetch" href="/assets/js/253.5a23b42d.js"><link rel="prefetch" href="/assets/js/254.8777547c.js"><link rel="prefetch" href="/assets/js/255.b8825033.js"><link rel="prefetch" href="/assets/js/256.0ee3689d.js"><link rel="prefetch" href="/assets/js/257.4a684795.js"><link rel="prefetch" href="/assets/js/258.ca696e72.js"><link rel="prefetch" href="/assets/js/259.fdf867d0.js"><link rel="prefetch" href="/assets/js/26.c84357e5.js"><link rel="prefetch" href="/assets/js/260.d35d60d5.js"><link rel="prefetch" href="/assets/js/261.c162cef5.js"><link rel="prefetch" href="/assets/js/262.8cbc5289.js"><link rel="prefetch" href="/assets/js/263.c05bbe4c.js"><link rel="prefetch" href="/assets/js/264.2e7c8f69.js"><link rel="prefetch" href="/assets/js/265.372a0632.js"><link rel="prefetch" href="/assets/js/266.49c38b9d.js"><link rel="prefetch" href="/assets/js/267.f7406d35.js"><link rel="prefetch" href="/assets/js/268.c7846c3e.js"><link rel="prefetch" href="/assets/js/269.e30bdc7f.js"><link rel="prefetch" href="/assets/js/27.0b3da7b9.js"><link rel="prefetch" href="/assets/js/270.8a3786ce.js"><link rel="prefetch" href="/assets/js/271.4b771c95.js"><link rel="prefetch" href="/assets/js/272.c710d2d6.js"><link rel="prefetch" href="/assets/js/273.43fb2872.js"><link rel="prefetch" href="/assets/js/274.d8a9dff2.js"><link rel="prefetch" href="/assets/js/275.c2812b68.js"><link rel="prefetch" href="/assets/js/276.406503c4.js"><link rel="prefetch" href="/assets/js/277.10c29e54.js"><link rel="prefetch" href="/assets/js/278.5f4b657a.js"><link rel="prefetch" href="/assets/js/279.84b86ae8.js"><link rel="prefetch" href="/assets/js/28.1c1fd5a6.js"><link rel="prefetch" href="/assets/js/280.8a2ba3b2.js"><link rel="prefetch" href="/assets/js/281.4a7f2b91.js"><link rel="prefetch" href="/assets/js/282.7b2f2668.js"><link rel="prefetch" href="/assets/js/283.455f93df.js"><link rel="prefetch" href="/assets/js/284.1a448478.js"><link rel="prefetch" href="/assets/js/285.19eebc05.js"><link rel="prefetch" href="/assets/js/286.5423cfc6.js"><link rel="prefetch" href="/assets/js/287.afbe115e.js"><link rel="prefetch" href="/assets/js/288.d4f4f247.js"><link rel="prefetch" href="/assets/js/289.da477465.js"><link rel="prefetch" href="/assets/js/29.103209e9.js"><link rel="prefetch" href="/assets/js/290.abf99800.js"><link rel="prefetch" href="/assets/js/291.71fe3ae6.js"><link rel="prefetch" href="/assets/js/292.455169ca.js"><link rel="prefetch" href="/assets/js/293.d23ffed4.js"><link rel="prefetch" href="/assets/js/294.1a753204.js"><link rel="prefetch" href="/assets/js/295.badfa110.js"><link rel="prefetch" href="/assets/js/296.344206a1.js"><link rel="prefetch" href="/assets/js/297.29e4f914.js"><link rel="prefetch" href="/assets/js/298.f9db8940.js"><link rel="prefetch" href="/assets/js/299.2253c1e7.js"><link rel="prefetch" href="/assets/js/3.e5ca1c51.js"><link rel="prefetch" href="/assets/js/30.e76a827e.js"><link rel="prefetch" href="/assets/js/300.e5bfd607.js"><link rel="prefetch" href="/assets/js/301.cc3e786e.js"><link rel="prefetch" href="/assets/js/302.7fdc62b6.js"><link rel="prefetch" href="/assets/js/303.b1db491f.js"><link rel="prefetch" href="/assets/js/304.18917b0f.js"><link rel="prefetch" href="/assets/js/305.d352aeb5.js"><link rel="prefetch" href="/assets/js/306.8bc72324.js"><link rel="prefetch" href="/assets/js/307.854b4037.js"><link rel="prefetch" href="/assets/js/308.6a0e4a18.js"><link rel="prefetch" href="/assets/js/309.d184df6f.js"><link rel="prefetch" href="/assets/js/31.7e4b200d.js"><link rel="prefetch" href="/assets/js/310.8e0af1ab.js"><link rel="prefetch" href="/assets/js/311.00bae85e.js"><link rel="prefetch" href="/assets/js/312.bc92cba9.js"><link rel="prefetch" href="/assets/js/313.8f70a987.js"><link rel="prefetch" href="/assets/js/314.8f190f1f.js"><link rel="prefetch" href="/assets/js/315.4b8506c7.js"><link rel="prefetch" href="/assets/js/316.5911c1f9.js"><link rel="prefetch" href="/assets/js/317.58cca547.js"><link rel="prefetch" href="/assets/js/318.4f23c053.js"><link rel="prefetch" href="/assets/js/319.941f5d3e.js"><link rel="prefetch" href="/assets/js/32.9c188bac.js"><link rel="prefetch" href="/assets/js/320.a3f15adc.js"><link rel="prefetch" href="/assets/js/321.14c74686.js"><link rel="prefetch" href="/assets/js/322.5f7b1b87.js"><link rel="prefetch" href="/assets/js/323.ab05eccb.js"><link rel="prefetch" href="/assets/js/324.292806ba.js"><link rel="prefetch" href="/assets/js/325.b96314dd.js"><link rel="prefetch" href="/assets/js/326.3d8f6329.js"><link rel="prefetch" href="/assets/js/327.49cf9268.js"><link rel="prefetch" href="/assets/js/328.be56ec05.js"><link rel="prefetch" href="/assets/js/329.8c390111.js"><link rel="prefetch" href="/assets/js/33.2435d797.js"><link rel="prefetch" href="/assets/js/330.b961e5fd.js"><link rel="prefetch" href="/assets/js/331.24ce8c0b.js"><link rel="prefetch" href="/assets/js/332.115b7546.js"><link rel="prefetch" href="/assets/js/333.957e0728.js"><link rel="prefetch" href="/assets/js/334.68825ff7.js"><link rel="prefetch" href="/assets/js/335.b662f33d.js"><link rel="prefetch" href="/assets/js/336.d8818747.js"><link rel="prefetch" href="/assets/js/337.9d24e096.js"><link rel="prefetch" href="/assets/js/338.3b669645.js"><link rel="prefetch" href="/assets/js/339.51cc2773.js"><link rel="prefetch" href="/assets/js/34.d57f3bb9.js"><link rel="prefetch" href="/assets/js/340.28cfadfb.js"><link rel="prefetch" href="/assets/js/341.4e6b0bdd.js"><link rel="prefetch" href="/assets/js/342.310c1a3e.js"><link rel="prefetch" href="/assets/js/343.0e61677a.js"><link rel="prefetch" href="/assets/js/344.340a39bd.js"><link rel="prefetch" href="/assets/js/345.fff51053.js"><link rel="prefetch" href="/assets/js/346.93c709db.js"><link rel="prefetch" href="/assets/js/347.dc863ac9.js"><link rel="prefetch" href="/assets/js/348.13c191d7.js"><link rel="prefetch" href="/assets/js/349.8aea43f7.js"><link rel="prefetch" href="/assets/js/35.e20cb4ac.js"><link rel="prefetch" href="/assets/js/350.49b72b87.js"><link rel="prefetch" href="/assets/js/351.3e6e6379.js"><link rel="prefetch" href="/assets/js/352.e2524a53.js"><link rel="prefetch" href="/assets/js/353.b71b2a33.js"><link rel="prefetch" href="/assets/js/354.a4720902.js"><link rel="prefetch" href="/assets/js/355.5a8970e1.js"><link rel="prefetch" href="/assets/js/356.353f0a9c.js"><link rel="prefetch" href="/assets/js/357.648060ca.js"><link rel="prefetch" href="/assets/js/358.643b787c.js"><link rel="prefetch" href="/assets/js/359.b1bc0c81.js"><link rel="prefetch" href="/assets/js/36.6a79f8ad.js"><link rel="prefetch" href="/assets/js/360.748faf07.js"><link rel="prefetch" href="/assets/js/361.cddfbfab.js"><link rel="prefetch" href="/assets/js/362.46990756.js"><link rel="prefetch" href="/assets/js/363.f4846a88.js"><link rel="prefetch" href="/assets/js/364.e7fd6af2.js"><link rel="prefetch" href="/assets/js/365.41693194.js"><link rel="prefetch" href="/assets/js/366.60931b9e.js"><link rel="prefetch" href="/assets/js/367.c7a310db.js"><link rel="prefetch" href="/assets/js/368.cae4028a.js"><link rel="prefetch" href="/assets/js/369.e3bcd2c2.js"><link rel="prefetch" href="/assets/js/37.4ccc31d6.js"><link rel="prefetch" href="/assets/js/370.2ea3b181.js"><link rel="prefetch" href="/assets/js/371.978056e5.js"><link rel="prefetch" href="/assets/js/372.aa13db83.js"><link rel="prefetch" href="/assets/js/373.f3791afe.js"><link rel="prefetch" href="/assets/js/374.b108af2d.js"><link rel="prefetch" href="/assets/js/375.dc75d5b1.js"><link rel="prefetch" href="/assets/js/376.8a663da6.js"><link rel="prefetch" href="/assets/js/38.9816dff1.js"><link rel="prefetch" href="/assets/js/39.03d551c0.js"><link rel="prefetch" href="/assets/js/4.611d42c4.js"><link rel="prefetch" href="/assets/js/40.ce442bf2.js"><link rel="prefetch" href="/assets/js/41.d596832c.js"><link rel="prefetch" href="/assets/js/42.29309c56.js"><link rel="prefetch" href="/assets/js/43.d47b7a06.js"><link rel="prefetch" href="/assets/js/44.87716237.js"><link rel="prefetch" href="/assets/js/45.d5ef3d2b.js"><link rel="prefetch" href="/assets/js/46.21cef7ff.js"><link rel="prefetch" href="/assets/js/47.75c67941.js"><link rel="prefetch" href="/assets/js/48.b94040d3.js"><link rel="prefetch" href="/assets/js/49.507fb28d.js"><link rel="prefetch" href="/assets/js/5.e6d623f8.js"><link rel="prefetch" href="/assets/js/50.4013f17e.js"><link rel="prefetch" href="/assets/js/51.6e81cba9.js"><link rel="prefetch" href="/assets/js/52.07e4aadf.js"><link rel="prefetch" href="/assets/js/53.1d325b49.js"><link rel="prefetch" href="/assets/js/54.79ff5e8c.js"><link rel="prefetch" href="/assets/js/55.77160bdd.js"><link rel="prefetch" href="/assets/js/56.a3041056.js"><link rel="prefetch" href="/assets/js/57.b7c0602c.js"><link rel="prefetch" href="/assets/js/58.a4af9a23.js"><link rel="prefetch" href="/assets/js/59.61a80d59.js"><link rel="prefetch" href="/assets/js/6.dc644b59.js"><link rel="prefetch" href="/assets/js/60.4ae1e1f0.js"><link rel="prefetch" href="/assets/js/61.b733273a.js"><link rel="prefetch" href="/assets/js/62.63b8d77d.js"><link rel="prefetch" href="/assets/js/63.46a84bd8.js"><link rel="prefetch" href="/assets/js/64.ce8c5891.js"><link rel="prefetch" href="/assets/js/65.8abe6836.js"><link rel="prefetch" href="/assets/js/66.6f9a9cf9.js"><link rel="prefetch" href="/assets/js/67.6bc415b9.js"><link rel="prefetch" href="/assets/js/68.b100ab24.js"><link rel="prefetch" href="/assets/js/69.5d9ed0d7.js"><link rel="prefetch" href="/assets/js/7.7da3e776.js"><link rel="prefetch" href="/assets/js/70.f213eb63.js"><link rel="prefetch" href="/assets/js/71.9dbed333.js"><link rel="prefetch" href="/assets/js/72.1129fb4b.js"><link rel="prefetch" href="/assets/js/73.7459f6b0.js"><link rel="prefetch" href="/assets/js/74.2364da14.js"><link rel="prefetch" href="/assets/js/75.72e5d347.js"><link rel="prefetch" href="/assets/js/76.7f1bc93d.js"><link rel="prefetch" href="/assets/js/77.7f9bb46a.js"><link rel="prefetch" href="/assets/js/78.16497536.js"><link rel="prefetch" href="/assets/js/79.1598ba88.js"><link rel="prefetch" href="/assets/js/8.91ce867e.js"><link rel="prefetch" href="/assets/js/80.d7595902.js"><link rel="prefetch" href="/assets/js/81.c808c887.js"><link rel="prefetch" href="/assets/js/82.49dc6011.js"><link rel="prefetch" href="/assets/js/83.6e151bae.js"><link rel="prefetch" href="/assets/js/84.9d3d5086.js"><link rel="prefetch" href="/assets/js/85.2c4d111e.js"><link rel="prefetch" href="/assets/js/86.cff98baa.js"><link rel="prefetch" href="/assets/js/87.655584a0.js"><link rel="prefetch" href="/assets/js/88.109ad4f1.js"><link rel="prefetch" href="/assets/js/89.46f7ed5c.js"><link rel="prefetch" href="/assets/js/9.8a2e5f54.js"><link rel="prefetch" href="/assets/js/90.1a91e9ca.js"><link rel="prefetch" href="/assets/js/91.26a98055.js"><link rel="prefetch" href="/assets/js/92.6ed9cb6e.js"><link rel="prefetch" href="/assets/js/93.14253412.js"><link rel="prefetch" href="/assets/js/94.54415bcf.js"><link rel="prefetch" href="/assets/js/95.0e1c9d0a.js"><link rel="prefetch" href="/assets/js/96.8654188f.js"><link rel="prefetch" href="/assets/js/97.d338a1d8.js"><link rel="prefetch" href="/assets/js/98.efa1e5c5.js"><link rel="prefetch" href="/assets/js/99.83fa6575.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76d9f797.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/magic.png" alt="Pangolin" class="logo"> <span class="site-name can-hide">Pangolin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpeg"> <div class="blogger-info"><h3>达尔文的猹</h3> <span>大道至简 悟在天成</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/basic/" class="nav-link">基础</a></div><div class="nav-item"><a href="/develop/" class="nav-link">开发</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/books/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/pangolin/" class="nav-link">个人</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/operating_system/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><a href="/basic/" class="link-title">基础</a> <span class="title" style="display:none;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ORM框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/4553db/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/d426ff/" class="sidebar-link">Spring集成MyBatis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/45687a/" class="sidebar-link">基础</a></li><li><a href="/pages/669da3/" class="sidebar-link">Java基础</a></li><li><a href="/pages/06424b/" class="sidebar-link">类与继承</a></li><li><a href="/pages/a29a57/" class="sidebar-link">抽象类与接口</a></li><li><a href="/pages/575ca7/" class="sidebar-link">内部类</a></li><li><a href="/pages/1d42f5/" class="sidebar-link">枚举类</a></li><li><a href="/pages/68df7d/" class="sidebar-link">常用类</a></li><li><a href="/pages/208d9a/" class="sidebar-link">关键字</a></li><li><a href="/pages/19431a/" class="sidebar-link">注解</a></li><li><a href="/pages/98c0c9/" class="sidebar-link">异常</a></li><li><a href="/pages/a08fb2/" class="sidebar-link">泛型</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>集合类</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e52b1c/" class="sidebar-link">集合类</a></li><li><a href="/pages/20a058/" class="sidebar-link">集合容器类概述</a></li><li><a href="/pages/71ab62/" class="sidebar-link">ArrayList与LinkedList</a></li><li><a href="/pages/dd747b/" class="sidebar-link">ArrayDeque</a></li><li><a href="/pages/f0ecf7/" class="sidebar-link">PriorityQueue</a></li><li><a href="/pages/a577c4/" class="sidebar-link">HashMap与HashSet</a></li><li><a href="/pages/b65f71/" class="sidebar-link">LinkedHashMap</a></li><li><a href="/pages/02deb8/" class="sidebar-link">TreeMap与TreeSet</a></li><li><a href="/pages/8b70b6/" class="sidebar-link">WeakHashMap</a></li><li><a href="/pages/098b2b/" class="sidebar-link">CopyOnWriteArrayList</a></li><li><a href="/pages/380128/" class="sidebar-link">ConcurrentHashMap</a></li><li><a href="/pages/b23642/" class="sidebar-link">BlockingQueue</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/5d5b55/" class="sidebar-link">并发</a></li><li><a href="/pages/ef591d/" class="sidebar-link">多线程基础</a></li><li><a href="/pages/870f46/" class="sidebar-link">JMM与Volatile</a></li><li><a href="/pages/70bfda/" class="sidebar-link">JUC与AQS</a></li><li><a href="/pages/60c2c3/" class="sidebar-link">锁与互斥同步</a></li><li><a href="/pages/6e4dfa/" class="sidebar-link">显式锁与ReetrantLock</a></li><li><a href="/pages/a0d56d/" class="sidebar-link">线程安全总结</a></li><li><a href="/pages/b92a49/" class="sidebar-link">JUC组件与线程协作</a></li><li><a href="/pages/103bb5/" class="sidebar-link">Atomic原子变量与Unsafe类与CAS</a></li><li><a href="/pages/065f55/" class="sidebar-link">线程池与定时任务</a></li><li><a href="/pages/dd3660/" class="sidebar-link">ThreadLocal</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>IO</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/7db050/" class="sidebar-link">IO</a></li><li><a href="/pages/ccb0a7/" class="sidebar-link">文件操作</a></li><li><a href="/pages/45bc73/" class="sidebar-link">IO流操作</a></li><li><a href="/pages/404e82/" class="sidebar-link">网络IO操作</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Java高级特性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/396bd1/" class="sidebar-link">Java高级特性</a></li><li><a href="/pages/eaa98b/" class="sidebar-link">Lambda表达式</a></li><li><a href="/pages/40af88/" class="sidebar-link">流Stream</a></li><li><a href="/pages/402b10/" class="sidebar-link">反射</a></li><li><a href="/pages/a5ebcd/" class="sidebar-link">代理</a></li><li><a href="/pages/b48bfe/" class="sidebar-link">Java性能问题定位分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/20204f/" class="sidebar-link">其他</a></li><li><a href="/pages/e4cde0/" class="sidebar-link">杂记</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>规范&amp;amp;风格</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ee7259/" class="sidebar-link">规范&amp;amp;风格</a></li><li><a href="/pages/139e3f/" class="sidebar-link">代码整洁之道</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ed8d11/" class="sidebar-link">Web基础</a></li><li><a href="/pages/a228d7/" class="sidebar-link">Spring(Boot)基础</a></li><li><a href="/pages/ecd8b6/" class="sidebar-link">Spring Boot应用整合</a></li><li><a href="/pages/76dc08/" class="sidebar-link">Spring MVC</a></li><li><a href="/pages/b9aa73/" class="sidebar-link">Spring AOP</a></li><li><a href="/pages/dc74be/" class="sidebar-link">Spring事务</a></li><li><a href="/pages/b43c8c/" class="sidebar-link">Spring IOC源码分析-概览</a></li><li><a href="/pages/d9b4a5/" class="sidebar-link">Spring IOC源码分析-getBean()</a></li><li><a href="/pages/59dd3e/" class="sidebar-link">Spring IOC源码分析-createBean()</a></li><li><a href="/pages/691b21/" class="sidebar-link">Spring AOP源码分析</a></li><li><a href="/pages/d31e18/" class="sidebar-link">Spring事务源码分析</a></li><li><a href="/pages/f16cdb/" class="sidebar-link">Spring Boot源码分析</a></li><li><a href="/pages/b13a90/" class="sidebar-link">Spring MVC源码分析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/943c23/" class="sidebar-link">JVM内存区域与对象解析</a></li><li><a href="/pages/05acae/" class="sidebar-link">内存分配与垃圾收集</a></li><li><a href="/pages/d09a16/" class="sidebar-link">JVM监控与故障处理工具</a></li><li><a href="/pages/06e4ad/" class="sidebar-link">类文件结构与类加载机制</a></li><li><a href="/pages/3d00d5/" class="sidebar-link">虚拟机方法调用与指令执行引擎</a></li><li><a href="/pages/eba070/" class="sidebar-link">程序编译与代码优化</a></li><li><a href="/pages/83896f/" class="sidebar-link">虚拟机调优及参数总结</a></li><li><a href="/pages/8a0034/" class="sidebar-link">GraalVM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f6cd57/" class="sidebar-link">数据库系统原理</a></li><li><a href="/pages/410bf5/" class="sidebar-link">MySQL必知必会</a></li><li><a href="/pages/495264/" class="sidebar-link">MySQL开发与优化</a></li><li><a href="/pages/ec7e76/" class="sidebar-link">MySQL架构与日志</a></li><li><a href="/pages/4dbe1f/" class="sidebar-link">MySQL索引</a></li><li><a href="/pages/cbc7ab/" class="sidebar-link">MySQL优化</a></li><li><a href="/pages/4afd3a/" aria-current="page" class="active sidebar-link">MySQL锁机制与事务并发控制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/412461/" class="sidebar-link">MySQL高级特性</a></li><li><a href="/pages/41888c/" class="sidebar-link">MySQL设计规范</a></li><li><a href="/pages/087de5/" class="sidebar-link">MySQL架构篇</a></li><li><a href="/pages/b0952c/" class="sidebar-link">MySQL复制</a></li><li><a href="/pages/ee884d/" class="sidebar-link">MySQL高可用</a></li><li><a href="/pages/6d4f47/" class="sidebar-link">MySQL运维篇</a></li><li><a href="/pages/b8bad7/" class="sidebar-link">MySQL常用工具</a></li><li><a href="/pages/8bd691/" class="sidebar-link">MySQL日志</a></li><li><a href="/pages/5db7ef/" class="sidebar-link">MySQL备份与恢复</a></li><li><a href="/pages/3e3d3a/" class="sidebar-link">MySQL权限与安全</a></li><li><a href="/pages/5f2a5c/" class="sidebar-link">MySQL监控</a></li><li><a href="/pages/bf28eb/" class="sidebar-link">数据库LeetCode题目</a></li><li><a href="/pages/d4f878/" class="sidebar-link">数据库面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2bed26/" class="sidebar-link">Arthas</a></li><li><a href="/pages/84ff17/" class="sidebar-link">CICD</a></li><li><a href="/pages/a7e6ff/" class="sidebar-link">Maven</a></li><li><a href="/pages/2a3f45/" class="sidebar-link">Typora主题</a></li><li><a href="/pages/f28f56/" class="sidebar-link">VuePress</a></li><li><a href="/pages/9d673a/" class="sidebar-link">思源笔记</a></li><li><a href="/pages/538b8a/" class="sidebar-link">环境搭建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ORM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c83270/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/29ba44/" class="sidebar-link">Spring集成MyBatis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e55b6f/" class="sidebar-link">测试基础</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/develop/#开发" data-v-06225672>开发</a></li><li data-v-06225672><a href="/develop/#数据库" data-v-06225672>数据库</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/nanodaemony" target="_blank" title="作者" class="beLink" data-v-06225672>NanoDaemony</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-06-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->MySQL锁机制与事务并发控制<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_304-mysql锁机制与事务并发控制"><a href="#_304-mysql锁机制与事务并发控制" class="header-anchor">#</a> 304.MySQL锁机制与事务并发控制</h1> <h4 id="mysql锁机制"><a href="#mysql锁机制" class="header-anchor">#</a> MySQL锁机制</h4> <p>无论何时, 只要有多个查询需要在<strong>同一时刻修改数据</strong>, 都会产生并发控制的问题. 为了解决多事务并发问题, 数据库设计了事务隔离机制, 锁机制, MVCC 多版本并发控制隔离机制, 日志机制, 用一整套机制来解决多事务并发问题.</p> <p>锁是计算机协调多个进程或线程并发访问某一资源的机制. 在数据库中, 除 CPU, I/O 等传统计算资源的争用以外, 数据也是一种供需要用户<strong>共享的资源</strong>. 如何保证数据并发访问的一致性, 有效性是所有数据库必须解决的一个问题, 锁冲突也是影响数据库并发访问性能的一个重要因素.</p> <h5 id="_1-锁的分类"><a href="#_1-锁的分类" class="header-anchor">#</a> 1.锁的分类</h5> <ul><li>从对数据库操作的类型分: <strong>读锁</strong>和<strong>写锁</strong>(都属于悲观锁), 以及意向锁.</li> <li>从对数据操作的粒度分: <strong>表锁, 行锁</strong>.</li></ul> <ul><li>从性能上分为乐观锁(用版本对比或 CAS 机制)和悲观锁, 乐观锁适合读操作较多的场景, 悲观锁适合写操作较多的场景, 如果在写操作较多的场景使用乐观锁会导致比对次数过多, 影响性能.</li></ul> <h6 id="_1-读写锁-共享-排他锁"><a href="#_1-读写锁-共享-排他锁" class="header-anchor">#</a> (1)读写锁(共享/排他锁)</h6> <ul><li><strong>写锁/排他锁</strong>(Exclusive), 简写为 X 锁.</li> <li><strong>读锁/共享锁</strong>(Shared), 简写为 S 锁.</li></ul> <p>有以下两个规定:</p> <ul><li>一个事务对数据对象 A 加了写锁, 就可以对 A 进行<strong>读取和更新</strong>. 加锁期间其它事务不能对 A 加任何锁.</li> <li>一个事务对数据对象 A 加了读锁, 可以对 A 进行读取操作, 但是不能进行更新操作. 加锁期间其它事务能对 A 加读锁, 但是不能加写锁.</li></ul> <p>只有这样, 才能确保在给定的时间里, <strong>只有一个用户能执行写入, 并防止其他用户读取</strong>正在写入的同一资源.</p> <p>锁的兼容关系如下:</p> <table><thead><tr><th style="text-align:center;">-</th> <th style="text-align:center;">X写锁</th> <th style="text-align:center;">S读锁</th></tr></thead> <tbody><tr><td style="text-align:center;"><strong>X写锁</strong></td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td></tr> <tr><td style="text-align:center;"><strong>S读锁</strong></td> <td style="text-align:center;">×</td> <td style="text-align:center;"><strong>√</strong></td></tr></tbody></table> <p>总结一下: <strong>只能共享读锁, 含写锁的都是排他的</strong>. 读锁会阻塞写, 但是不会阻塞读, 而写锁则会把读和写都阻塞.</p> <p><strong>读锁</strong>针对同一份数据, 多个读操作可以同时进行而不会互相影响, 比如:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> T <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">lock</span> <span class="token operator">in</span> <span class="token keyword">share</span> <span class="token keyword">mode</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当前写操作没有完成前, 写锁会阻断其他写锁和读锁, 数据修改操作都会加写锁; <strong>查询也可以通过 FOR UPDATE 加写锁</strong>, 比如:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> T <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">for</span> <span class="token keyword">update</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h6 id="_2-意向锁"><a href="#_2-意向锁" class="header-anchor">#</a> (2)意向锁</h6> <p><strong>问题: ​</strong>​<strong><strong>在存在</strong></strong>​<strong>行锁和表锁</strong>的情况下, 事务 T 想要对<strong>表 A</strong> 加写锁(X), 就需要先检测是否有其它事务对表 A 或者表 A 中的<strong>任意一行</strong>加了锁, 那么就需要对表 A 的<strong>每一行都检测一次</strong>, 这是非常耗时的.</p> <p>意向锁又称 I 锁, 针对表锁, 主要是为了提高加表锁的效率, 是 MySQL 自己加的. 当有事务给表的数据行加了读锁或写锁时, 同时会给表设置一个标识, 代表已经有行锁了, 其他事务要想对表加表锁时, 就不必逐行判断有没有行锁可能跟表锁冲突了, 直接读这个标识就可以确定自己该不该加表锁. <strong>这个标识就是意向锁</strong>.</p> <p>使用<strong>意向锁</strong>(Intention Locks)可以更容易地支持<strong>多粒度</strong>封锁. 意向锁在原来的 <strong>X/S 锁</strong>之上引入了 <strong>IX/IS, IX/IS 都是表锁</strong>, 用来表示一个事务<strong>想要</strong>在表中的某个数据行上<strong>加写锁(X)或 读锁(S)</strong>.</p> <p>有以下两个分类:</p> <ul><li>意向共享锁(IS锁): 一个事务在获得某个数据行对象的<strong>读锁(S)之前</strong>, 必须先获得表的 <strong>IS 锁或者更强的锁</strong>.</li> <li>意向排他锁(IX锁): 一个事务在获得某个数据行对象的**写锁(X)**之前, 必须先获得表的 <strong>IX 锁</strong>.</li></ul> <p>通过引入<strong>意向锁</strong>, 事务 T 想要对表 A 加 <strong>X 锁</strong>, 只需要先检测<strong>是否有其它事务</strong>对表 A 加了 <strong>X/IX/S/IS 锁</strong>, 如果<strong>加了</strong>就表示有其它事务<strong>正在使用</strong>这个表或者表中某一行的锁, 因此事务 T 加 X 锁<strong>失败</strong>. 从而避免了每一行都去检查是否加锁.</p> <p>意向锁的兼容关系如下:</p> <table><thead><tr><th style="text-align:center;">-</th> <th style="text-align:center;">X</th> <th style="text-align:center;">IX</th> <th style="text-align:center;">S</th> <th style="text-align:center;">IS</th></tr></thead> <tbody><tr><td style="text-align:center;"><strong>X</strong></td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td></tr> <tr><td style="text-align:center;"><strong>IX</strong></td> <td style="text-align:center;">×</td> <td style="text-align:center;">√</td> <td style="text-align:center;">×</td> <td style="text-align:center;">√</td></tr> <tr><td style="text-align:center;"><strong>S</strong></td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td></tr> <tr><td style="text-align:center;"><strong>IS</strong></td> <td style="text-align:center;">×</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td></tr></tbody></table> <p>解释如下:</p> <ul><li><strong>任意 IS/IX 锁</strong>之间都是<strong>兼容</strong>的, 因为它们只是表示<strong>想要</strong>对表加锁, 而<strong>不是真正加锁</strong>.</li> <li>S 锁只与 S 锁和 IS 锁兼容, 也就是说事务 T 想要对数据行加 S 锁, 其它事务可以获得对表或者表中的行的 S 锁.</li></ul> <h5 id="_2-加锁粒度"><a href="#_2-加锁粒度" class="header-anchor">#</a> 2.加锁粒度</h5> <p>MySQL 中提供了两种封锁粒度: <strong>行级锁以及表级锁</strong>. <strong>MyISAM 仅支持表级锁. InnoDB 支持行级锁和表级锁, 默认行级锁.</strong></p> <p>任何时候, 在给定的资源上, 锁定的数据量越少, 则系统的并发程度越高, 只要相互之间不发生冲突即可. 所谓的锁策略, 就是在锁的开销和数据的安全性之间寻求平衡, 这种平衡当然也会影响到性能.</p> <p>MySQL 每种存储引擎都可以实现自己的锁策略和锁粒度.</p> <h6 id="_1-表锁"><a href="#_1-表锁" class="header-anchor">#</a> (1)表锁</h6> <p><strong>表级锁: ​</strong>​<strong><strong>MySQL中锁定</strong></strong>​<strong>粒度最大</strong>的一种锁, 对当前操作的<strong>整张表加锁</strong>, 实现简单, 资源消耗也比较少, 加锁快, <strong>不会出现死锁</strong>. 其锁定粒度最大, 触发锁冲突的概率最高, 并发度最低, 一般用在整表数据迁移的场景. MyISAM 和 InnoDB 引擎都支持表级锁.</p> <p>一个用户在对表进行写操作(插入, 删除, 更新等) 前, 需要先获得写锁, 这会阻塞其他用户对该表的所有读写操作. 只有没有写锁时, 其他读取的用户才能获得读锁, 读锁之间是不相互阻塞的.</p> <p>来个表. 注意<strong>引擎为 MyISAM</strong>.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>mylock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> MyISAM <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token comment">-- 插入数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span><span class="token identifier"><span class="token punctuation">`</span>test<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>mylock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span><span class="token identifier"><span class="token punctuation">`</span>test<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>mylock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>相关操作:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 手动增加表锁</span>
<span class="token keyword">LOCK</span> <span class="token keyword">TABLE</span> 表名称 <span class="token keyword">READ</span><span class="token punctuation">(</span><span class="token keyword">WRITE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 表名称<span class="token number">2</span> <span class="token keyword">READ</span><span class="token punctuation">(</span><span class="token keyword">WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">-- 查看表上加过的锁,如果inuse字段为1, 说明这个表已经加锁了</span>
<span class="token keyword">SHOW</span> <span class="token keyword">OPEN</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span> 
<span class="token comment">-- 删除表锁</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>加读锁</strong>: 当前 session 和其他 session 都可以<strong>读</strong>该表, <strong>当前</strong> session 中<strong>插入或更新</strong>锁定的表都会报错, <strong>其他</strong> session 插入或更新则会<strong>等待</strong>. 对 MyISAM 表的读操作(加读锁), 不会阻寒其他进程对同一表的读请求, 但会阻赛对同一表的写请求. 只有当读锁释放后, 才会执行其它进程的写操作.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">LOCK</span> <span class="token keyword">TABLE</span> myLock <span class="token keyword">READ</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>加写锁</strong>: 当前 session 对该表的增删改查都没有问题, <strong>其他</strong> session 对该表的<strong>所有操作被阻塞</strong>等待. 对 MyISAM 表的写操作(加写锁), 会阻塞其他进程对同一表的读和写操作, 只有当写锁释放后, 才会执行其它进程的读写操作. 数据迁移的时候, 可以加一个表锁.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">LOCK</span> <span class="token keyword">TABLE</span> myLock <span class="token keyword">WRITE</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>MyISAM 在执行查询语句(SELECT)前, 会自动给涉及的所有表加读锁, 在执行增删改操作前, 会自动给涉及的表加写锁.</strong></p> <p>总结: <strong>==读锁会阻塞写, 但是不会阻塞读. 而写锁则会把读和写都阻塞==</strong>.</p> <h6 id="_2-行锁"><a href="#_2-行锁" class="header-anchor">#</a> (2)行锁</h6> <p><strong>行级锁: ​</strong>​<strong><strong>MySQL中锁定</strong></strong>​<strong>粒度最小</strong>的一种锁, 每次操作<strong>锁住一行数据</strong>. 行锁能大大减少数据库操作的冲突. 其加锁粒度最小, 并发度高, 但加锁的开销也最大, <strong>加锁慢</strong>, <strong>可能会出现死锁</strong>.</p> <p>InnoDB 实现了行锁, 行级锁只在存储引擎层实现, 而 MySQL 服务器层没有实现. 服务器层完全不了解存储引擎中的锁实现.</p> <p>InnoDB 的行锁实际上是<strong>针对索引加的锁</strong>(在索引对应的索引项上做标记), 不是针对整个行记录加的锁. 并且该索引不能失效, 否则会从行锁升级为表锁.</p> <p>后面的很多讨论都是跟行锁有关.</p> <h6 id="_3-加锁粒度选择"><a href="#_3-加锁粒度选择" class="header-anchor">#</a> (3)加锁粒度选择</h6> <p>应该尽量<strong>只锁定需要修改</strong>的那部分数据, 而不是所有的资源. 锁定的数据量越少, 发生锁争用的可能就越小, 系统的并发程度就越高. 但是加锁需要消耗资源, 锁的各种操作(包括获取锁, 释放锁, 以及检查锁状态)都会增加系统开销. 因此封锁粒度越小, 系统开销就越大. 所以在选择封锁粒度时, 需要在<strong>锁开销和并发程度</strong>之间做一个<strong>权衡</strong>.</p> <p>MyISAM 在执行查询语句 SELECT 前, 会自动给涉及的所有<strong>表加读锁</strong>, 在执行 UPDATE, INSERT, DELETE 操作会自动给涉及的<strong>表加写锁</strong>.</p> <p>InnoDB 在执行查询语句 SELECT 时(非串行隔离级别), 不会加锁. 但是 UPDATE, INSERT, DELETE 操作会加<strong>行锁</strong>.</p> <p>InnoDB 存储引擎由于实现了行级锁定, 虽然在锁定机制的实现方面所带来的性能损耗可能比表级锁定会要更高一下, 但是在整体并发处理能力方面要远远优于 MYISAM 的表级锁定的. 当系统并发量高的时候, InnoDB 的整体性能和 MYISAM 相比就会有比较明显的优势了.</p> <h5 id="_3-封锁协议"><a href="#_3-封锁协议" class="header-anchor">#</a> 3.封锁协议</h5> <h6 id="_1-三级封锁协议"><a href="#_1-三级封锁协议" class="header-anchor">#</a> (1)三级封锁协议</h6> <blockquote><p><strong>一级封锁协议</strong></p></blockquote> <p>事务 T 要<strong>修改数据</strong> A 时必须加 <strong>X 锁</strong>, 直到 T <strong>结束才释放锁</strong>.</p> <p>这可以解决<strong>丢失修改</strong>问题, 因为不能同时有两个事务对同一个数据进行修改, 那么事务的修改就不会被覆盖.</p> <table><thead><tr><th style="text-align:center;">T1</th> <th style="text-align:center;">T2</th></tr></thead> <tbody><tr><td style="text-align:center;">lock-x(A) (写锁)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">read A = 20</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">lock-x(A) (请求写锁)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">wait <strong>(等待写锁)</strong></td></tr> <tr><td style="text-align:center;">write A = 19</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">commit</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">unlock-x(A) (释放写锁)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">obtain <strong>(获取到写锁)</strong></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">read A =19</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">write A = 21</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">commit</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">unlock-x(A) <strong>(释放写锁)</strong></td></tr></tbody></table> <blockquote><p><strong>二级封锁协议</strong></p></blockquote> <p>在一级封锁的基础上, 要求<strong>读取数据</strong> A 时必须<strong>加 S 锁</strong>, 读取完<strong>马上释放 S 锁</strong>.</p> <p>可以<strong>解决读脏数据</strong>问题, 因为如果一个事务在对数据 A 进行<strong>修改</strong>, 根据 1 级封锁协议, 会加 <strong>X 锁</strong>, 那么就<strong>不能再加 S 锁</strong>了, 也就是<strong>不会读入</strong>数据.</p> <table><thead><tr><th style="text-align:center;">T1</th> <th style="text-align:center;">T2</th></tr></thead> <tbody><tr><td style="text-align:center;">lock-x(A)(写锁)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">read A=20</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">write A=19</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">lock-s(A)(请求读锁)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">wait(发现加了X锁, 等待)</td></tr> <tr><td style="text-align:center;">rollback(回滚)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">A=20</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">unlock-x(A)(释放写锁)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">obtain(得到锁)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">read A = 20(读)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">unlock-s(A)(读完<strong>立即释放</strong>S锁)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">commit</td></tr></tbody></table> <p><strong>解决不了不可重复读问题</strong>. 如果 T2 事务需要读取 A 两次, 第一次读了 A, 读完就释放了 S 锁, 然后 T2 事务继续做其他的, 此时数据 A 没有锁是可以加写锁的, 如果此时 T1 事务修改了数据 A, 那么之后 T2 读到的数据就变了, 也就是产生不可重复读问题.</p> <blockquote><p><strong>三级封锁协议</strong></p></blockquote> <p>在二级封锁的基础上, 要求<strong>读取数据 A</strong> 时必须<strong>加 S 锁</strong>, 直到<strong>事务结束</strong>了<strong>才能释放 S 锁</strong> (注意前面是读完<strong>立即</strong>释放).</p> <p>可以解决<strong>不可重复读</strong>的问题, 因为<strong>读 A</strong> 时, 其它事务<strong>不能对 A 加 X 锁</strong>, 从而<strong>避免了在读的期间数据发生改变</strong>.</p> <table><thead><tr><th style="text-align:center;">T1</th> <th style="text-align:center;">T2</th></tr></thead> <tbody><tr><td style="text-align:center;">lock-s(A)(加读锁)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">read A=20(读数据, 读完不释放)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">lock-x(A)(请求写锁)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">wait(发现有S锁, 等待)</td></tr> <tr><td style="text-align:center;">read A=20(再次读数据, 读完不释放)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">COMMIT(提交事务)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">unlock-s(A)(事务提交之后再释放S锁)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">obtain(读锁事务结束, 才获得X锁)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">read A=20</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">write A=19</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">COMMIT(提交事务)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">unlock-X(A)(释放写锁)</td></tr></tbody></table> <h6 id="_2-两段锁协议"><a href="#_2-两段锁协议" class="header-anchor">#</a> (2)两段锁协议</h6> <p><strong>加锁和解锁</strong>分为<strong>两个阶段</strong>进行.</p> <p>事务遵循两段锁协议是<strong>保证可串行化调度</strong>的充分条件. 可串行化调度是指, 通过<strong>并发控制</strong>, 使得<strong>并发执行</strong>的事务结果与<strong>某个串行</strong>执行的事务结果<strong>相同</strong>. 例如以下操作满足两段锁协议, 它是<strong>可串行化调度</strong>.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>lock-x(A)...lock-s(B)...lock-s(C)...unlock(A)...unlock(C)...unlock(B)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但不是必要条件, 例如以下操作不满足两段锁协议, 但是它还是可串行化调度.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">lock</span><span class="token operator">-</span>x<span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">unlock</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">lock</span><span class="token operator">-</span>s<span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">unlock</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">lock</span><span class="token operator">-</span>s<span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">unlock</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_4-隐式与显式锁定"><a href="#_4-隐式与显式锁定" class="header-anchor">#</a> 4.隐式与显式锁定</h5> <p>MySQL 的 <strong>InnoDB 存储</strong>引擎采用<strong>两段锁协议</strong>, 会根据<strong>隔离级别</strong>在需要的时候<strong>自动加锁</strong>, 并且所有锁都是在<strong>同一时刻</strong>被释放, 这被称为<strong>隐式锁定</strong>.</p> <p>InnoDB 也可以使用特定的语句进行<strong>显示锁定</strong>:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_5-锁的实现"><a href="#_5-锁的实现" class="header-anchor">#</a> 5.锁的实现</h5> <p>MySQL 默认<strong>隔离级别是可重复读</strong>, 解决不了幻读问题. 单独有 <strong>MVCC</strong> <strong>不能解决幻读</strong>问题, Next-Key Locks 就是为了解决这个问题而存在的, 它是 InnoDB 存储引擎的一种<strong>锁实现</strong>. 在<strong>可重复读</strong>隔离级别下(可以解决脏读和不可重复读), 使用 <strong>==MVCC + Next-Key Locks==<strong>​</strong>​ 可以解决幻读问题</strong>.</p> <h6 id="_1-行锁record-locks"><a href="#_1-行锁record-locks" class="header-anchor">#</a> (1)行锁Record Locks</h6> <p><strong>对单个行记录加锁</strong>. 如果表没有设置索引, InnoDB 会自动在<strong>主键</strong>上创建隐藏的<strong>聚簇索引</strong>, 因此 Record Locks 依然<strong>可以使用</strong>.</p> <h6 id="_2-间隙锁gap-locks"><a href="#_2-间隙锁gap-locks" class="header-anchor">#</a> (2)间隙锁Gap Locks</h6> <p>间隙锁在<strong>可重复读</strong>隔离级别下才会生效.</p> <p>间隙锁, <strong>锁定一个范围</strong>, 也就是锁定<strong>索引</strong>之间的<strong>间隙</strong>, 但是<strong>不包含索引本身</strong>. 例如当一个事务执行以下语句, 其它事务就不能在 t.c 中插入 15.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> c <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> c <span class="token operator">BETWEEN</span> <span class="token number">10</span> <span class="token operator">and</span> <span class="token number">20</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>只要在间隙范围内锁了一条不存在的记录会锁住整个间隙范围, 不锁边界记录, 这样就能防止其它 Session 在这个间隙范围内插入数据, 就解决了可重复读隔离级别的幻读问题.</p> <h6 id="_3-next-key-locks"><a href="#_3-next-key-locks" class="header-anchor">#</a> (3)Next-Key Locks</h6> <p>它是 <strong>Record Locks 和 Gap Locks 的结合</strong>, 不仅锁定一个记录上的<strong>索引</strong>(包含记录本身), 也锁定索引之间的<strong>间隙</strong>. 例如一个索引包含以下值: 10, 11, 13, and 20, 那么就需要锁定以下<strong>区间</strong>:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token punctuation">(</span><span class="token operator">-</span>∞<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">+</span>∞<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>锁定间隙有什么用</strong>? ? 因为幻读就是 A 事务<strong>第一次读了一个范围的数据</strong>之后(此时 A 没有结束), 另一个 B 事务在这个范围插入或者删除数据行所致, <strong>锁定间隙</strong>可以防止其他事务在之中改变数据行数, 就<strong>解决了幻读问题</strong>.</p> <p><strong>间隙锁在某些情况下可以解决幻读问题</strong>. 要避免<strong>幻读</strong>可以用<strong>间隙锁</strong>在当前 Session 下面执行.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> name <span class="token operator">=</span> <span class="token string">'Lucy'</span> <span class="token keyword">WHERE</span> id <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">AND</span> id <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其他 Session <strong>没法在这个范围所包含的间隙(10 - 20 之间就是间隙)里插入或修改任何数据</strong>. 上面的语句就<strong>默认</strong>在 10 到 20 之间加了<strong>间隙锁</strong>. 需要注意写 SQL 的时候注意检索范围, <strong>避免间隙锁锁太多行</strong>.</p> <h5 id="_6-锁等待分析"><a href="#_6-锁等待分析" class="header-anchor">#</a> 6.锁等待分析</h5> <p>通过检查 <strong>InnoDB_row_lock</strong> 状态变量来分析系统上的<strong>行锁的争夺</strong>情况.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'innodb_row_lock%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>各个状态量的说明如下:</p> <ul><li>Innodb_row_lock_current_waits: 当前正在等待锁定的数量.</li> <li>Innodb_row_lock_time: 从系统启动到现在锁定总时间长度.</li> <li>Innodb_row_lock_time_avg: 每次等待所花平均时间.</li> <li>Innodb_row_lock_time_max: 从系统启动到现在等待最长的一次所花时间.</li> <li>Innodb_row_lock_waits: 系统启动后到现在总共等待的次数.</li></ul> <p>对于这 5 个状态变量, 比较重要的主要是:</p> <ul><li><strong>Innodb_row_lock_time_avg</strong>: 等待平均时长</li> <li><strong>Innodb_row_lock_waits:</strong> 等待总次数</li> <li><strong>Innodb_row_lock_time:</strong> 等待总时长</li></ul> <p>尤其是当<strong>等待次数很高</strong>, 而且每次等待时长也不小的时候, 就需要分析系统中为什么会有如此多的等待, 然后根据分析结果着手制定优化计划.</p> <h5 id="_7-死锁"><a href="#_7-死锁" class="header-anchor">#</a> 7.死锁</h5> <p>下面的语句产生死锁.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 设置隔离级别为可重复读</span>
<span class="token keyword">SET</span> tx_isolation <span class="token operator">=</span> <span class="token string">'repeatable-read'</span><span class="token punctuation">;</span>
Session_1执行: <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
Session_2执行: <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
Session_1执行: <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
Session_2执行: <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>查看近期死锁日志信息:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">engine</span> <span class="token keyword">innodb</span> <span class="token keyword">STATUS</span>\G<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>大多数情况 MySQL 可以<strong>自动检测死锁</strong>并回滚产生死锁的那个事务. 但是有些情况没法自动检测死锁, 这种情况可以通过日志分析找到对应事务线程 id, 可以通过 kill 杀掉.</p> <p>InnoDB 目前处理死锁的方法是, 将持有最少行级排他锁的事务进行回滚, 这是相对比较简单的死锁回滚算法.</p> <h5 id="_8-索引与锁的关系"><a href="#_8-索引与锁的关系" class="header-anchor">#</a> 8.索引与锁的关系</h5> <p><strong>无索引行锁会升级为表锁</strong>: 锁主要是加在<strong>索引</strong>上, 如果对<strong>非索引字段</strong>更新, 行锁可能会变表锁. 比如 session1 执行:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> <span class="token number">800</span> <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'lilei'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>session2 对该表<strong>任一行</strong>操作都会<strong>阻塞</strong>住. InnoDB 的<strong>行锁是针对索引加的锁</strong>, <strong>不是针对记录</strong>加的锁. 并且该索引不能失效, 否则都会<strong>从行锁升级为表锁</strong>. 锁定<strong>某一行</strong>还可以用 <strong>==LOCK IN SHARE MODE (共享锁) 和 FOR UPDATE (排它锁)==</strong>.</p> <p>例如:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_innodb_lock <span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样其他 session 只能<strong>读</strong>这行数据, 修改则会被阻塞, 直到锁定该行的 session 提交.</p> <h5 id="_9-锁优化实践"><a href="#_9-锁优化实践" class="header-anchor">#</a> 9.锁优化实践</h5> <ul><li>尽可能让所有<strong>数据检索都通过索引来完成</strong>, 避免<strong>无索引行锁升级为表锁</strong>. 同时合理设计索引, 尽量<strong>缩小锁的范围</strong>.</li> <li>尽可能<strong>减少</strong>检索条件范围, <strong>避免间隙锁</strong>.</li> <li>尽量控制事务大小, 减少锁定资源量和时间长度, 涉及事务加锁的 SQL 尽量放在事务最后执行. 尽可能低级别事务隔离.</li></ul> <h4 id="事务基础"><a href="#事务基础" class="header-anchor">#</a> 事务基础</h4> <h5 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1.概述</h5> <p><strong>事务</strong>是指<strong>满足 ACID</strong> 的一组操作, 可以通过 COMMIT <strong>提交</strong>一个事务, 也可以通过 ROLLBACK 进行<strong>回滚</strong>. 事务保证一组 SQL 语句<strong>要么全部执行</strong>, 要么全部不执行, 用以维护数据库的<strong>完整性</strong>和数据最终的一致性.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210904215720695.png" alt=""></p> <p><strong>基本术语</strong>:</p> <ul><li><strong>事务</strong>(TRANSACTION): 指一组满足 ACID 条件的 SQL 语句.</li> <li><strong>回滚</strong>(ROLLBACK): 指撤销指定 SQL 语句的过程.</li> <li><strong>提交</strong>(COMMIT): 指将未存储的 SQL 语句结果写入数据库表.</li> <li><strong>保留点</strong>(SAVEPOINT): 指事务处理中设置的<strong>临时占位符</strong>, 可以对它发布回退.</li></ul> <h5 id="_2-事务四大特征"><a href="#_2-事务四大特征" class="header-anchor">#</a> 2.事务四大特征</h5> <p>事务具有以下 4 个属性, 通常简称为事务的 ACID 属性, 即<strong>原子性(Atomicity), 一致性(Consistency), 隔离性(Isolation), 持久性(Durability)</strong>.</p> <h6 id="_1-原子性atomicity"><a href="#_1-原子性atomicity" class="header-anchor">#</a> (1)原子性Atomicity</h6> <p>原子性指一个事务中的<strong>所有操作</strong>必须被视为一个不可分割的<strong>最小执行单元</strong>, 要么<strong>全部完成</strong>, 要么全部不完成, 不会结束在中间某个环节.</p> <p>事务在执行过程中发生错误, 会被<strong>回滚</strong>到事务开始前的状态, 就像这个事务从来没有执行过一样.</p> <p>原子性由 undo log 日志来实现.</p> <p>比如: A 在银行取钱, 密码输入完成还没确定取钱, A 可以决定不取了, 此时回滚到没取的状态.</p> <h6 id="_2-一致性consistency"><a href="#_2-一致性consistency" class="header-anchor">#</a> (2)一致性Consistency</h6> <p>一致性指数据库总是<strong>从一个一致性的状态转换到另外一个一致性的状态</strong>. 在一致性状态下, 所有<strong>事务对一份数据的读取结果都是相同</strong>的. 在事务开始之前和事务结束以后, 数据库的完整性没有被破坏.</p> <p><strong>一致性是使用事务的最终目的, 由其它 3 个特性以及业务代码正确逻辑来实现</strong>.</p> <p>比如: A 向 B 转账, 不可能 A 扣了钱, B 却没有收到.</p> <h6 id="_3-隔离性isolation"><a href="#_3-隔离性isolation" class="header-anchor">#</a> (3)隔离性Isolation</h6> <p>隔离性指一个事务所做的<strong>修改</strong>在<strong>最终提交</strong>以前, 对其它事务是<strong>不可见</strong>的. 在不同的业务处理过程中, 事务隔离性保证了各业务正在读, 写的数据相互独立, 不会彼此影响.</p> <p>数据库允许多个并发事务同时对其数据进行读写和修改, 隔离性可以<strong>防止多个事务并发</strong>执行时由于<strong>交叉执行</strong>而导致数据的<strong>不一致</strong>. <strong>事务隔离</strong>分为不同<strong>隔离级别</strong>, 包括读未提交, 读已提交, 可重复读和串行化.</p> <p>隔离性由 MySQL 的各种锁以及 MVCC 机制来实现.</p> <p>比如: A 正在从一张银行卡里面取钱, A 取钱过程中 B 不能向这张银行卡打钱.</p> <h6 id="_4-持久性durability"><a href="#_4-持久性durability" class="header-anchor">#</a> (4)持久性Durability</h6> <p>持久性指一旦事务成功提交之后, 它对于数据的<strong>修改是永久性</strong>的, 即使出现系统故障也不会丢失.</p> <p>持久性由 redo log 日志来实现.</p> <p>比如: A 在银行存了钱, 某天断电银行系统宕机, 恢复后钱依然这么多.</p> <h6 id="_5-总结"><a href="#_5-总结" class="header-anchor">#</a> (5)总结</h6> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210904220209568.png" alt="image-20210904220209568"></p> <p>事务的 ACID 特性概念简单, 但不是很好理解, 主要是因为这几个特性<strong>不是一种平级关系</strong>:</p> <ul><li>只有<strong>满足一致性</strong>, 事务的执行结果才是<strong>正确</strong>的.</li> <li>在<strong>无并发</strong>的情况下, 事务<strong>串行</strong>执行, 隔离性一定能够满足. 此时只要能满足<strong>原子性</strong>, 就一定能满足<strong>一致性</strong>.</li> <li>在<strong>并发</strong>的情况下, 多个事务<strong>并行</strong>执行, 事务不仅要满足<strong>原子性, 还需要满足隔离性</strong>, 才能满足<strong>一致性</strong>.</li> <li>事务满足<strong>持久性</strong>是为了能应对数据库崩溃的情况.</li></ul> <h5 id="_3-事务使用"><a href="#_3-事务使用" class="header-anchor">#</a> 3.事务使用</h5> <h6 id="_1-隐式事务autocommit"><a href="#_1-隐式事务autocommit" class="header-anchor">#</a> (1)隐式事务AUTOCOMMIT</h6> <p>隐式事务也就是没有明显的开启和结束事务的标志, MySQL <strong>默认采用自动提交模式</strong>. 如果不显式使用 <strong>START TRANSACTION</strong> 语句来开始一个事务, 那么每个查询<strong>都会被当做一个事务自动提交</strong>.</p> <p>当显式使用 START TRANSACTION 语句时, 会关闭隐式提交; 当执行 COMMIT 或 ROLLBACK 语句后, 事务会<strong>自动关闭</strong>, 重新恢复隐式提交. 设置 AUTOCOMMIT 为 0 可以<strong>取消自动提交</strong>; AUTOCOMMIT 标记是针对<strong>每个连接</strong>而不是针对服务器的.</p> <p>如果<strong>没有设置保留点</strong>, ROLLBACK 会回退到 <strong>START TRANSACTION</strong> 语句处; 如果设置了<strong>保留点</strong>, 并且在 ROLLBACK 中<strong>指定</strong>该保留点, 则会回退到该保留点.</p> <h6 id="_2-事务相关操作"><a href="#_2-事务相关操作" class="header-anchor">#</a> (2)事务相关操作</h6> <p>下面是事务相关的操作语句.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> AUTOCOMMIT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment"># 关闭隐式事务</span>
<span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>	<span class="token comment"># 开启显示事务</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>				<span class="token comment"># 提交事务</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>			<span class="token comment"># 回滚事务</span>

<span class="token keyword">SAVEPOINT</span> 断点	   <span class="token comment"># SAVEPOINT</span>
<span class="token keyword">COMMIT</span> <span class="token keyword">TO</span> 断点	   <span class="token comment"># 提交到SAVEPOINT</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> 断点 	   <span class="token comment"># 回滚到SAVEPOINT</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用显式事务:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 关闭自动提交</span>
<span class="token keyword">SET</span> AUTOCOMMIT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>	<span class="token comment"># 开启事务</span>
<span class="token comment"># 编写一组事务的语句(多条语句)</span>
<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> <span class="token number">1000</span> <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'Tom'</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> <span class="token number">3000</span> <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'Jack'</span><span class="token punctuation">;</span>

<span class="token comment"># 回滚</span>
<span class="token comment"># ROLLBACK;</span>
<span class="token comment"># 提交事务</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>SAVEPOINT</strong> 使用示例:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> AUTOCOMMIT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token keyword">SAVEPOINT</span> a<span class="token punctuation">;</span>	<span class="token comment"># 设置保存点</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> a<span class="token punctuation">;</span>	<span class="token comment"># 回滚到保存点</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>不能回滚 SELECT</strong> 语句, 回退 SELECT 语句也没意义; 也<strong>不能回滚 CREATE 和 DROP 语句</strong>.</p> <h6 id="_3-隐式锁定与显式锁定"><a href="#_3-隐式锁定与显式锁定" class="header-anchor">#</a> (3)隐式锁定与显式锁定</h6> <p>InnoDB 采用的是两阶段锁定协议(two-phase locking protocol). 在事务执行过程中, 随时都可以执行锁定, 锁只有在执行 COMMIT 或者 ROLLBACK 的时候才会释放, 并且所有的锁是在同一时刻被释放.</p> <p>前面描述的锁定都是隐式锁定, InnoDB 会根据隔离级别在需要的时候自动加锁. 另外, InnoDB 也支持通过特定的语句进行显式锁定, 这些语句不属于 SQL 规范:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>MySQL 也支持 LOCK TABLES 和 UNLOCK TABLES 语句, 这是在服务器层实现的, 和存储引擎无关. 它们有自己的用途, 但并不能替代事务处理. 如果应用需要用到事务, 还是应该选择事务型存储引擎.</p> <h4 id="并发一致性问题"><a href="#并发一致性问题" class="header-anchor">#</a> 并发一致性问题</h4> <p>在<strong>无并发</strong>情况下, 事务串行执行, 事务的<strong>一致性</strong>容易保证. 但在<strong>并发环境</strong>下, 事务之间<strong>交替执行</strong>, 可能出现<strong>多个事务操作同一个数据来完成各自的业务</strong>, 事务的<strong>隔离性</strong>很难保证, 因此会出现很多<strong>并发一致性</strong>问题. 它主要强调在<strong>并发操作状态</strong>下可能出现的<strong>一致性</strong>问题.</p> <h5 id="_1-丢失修改"><a href="#_1-丢失修改" class="header-anchor">#</a> 1.丢失修改</h5> <p>丢失修改指一个事务的修改<strong>覆盖</strong>了另一个事务的<strong>修改</strong>.</p> <p>T1 和 T2 两个事务<strong>都对一个数据进行修改</strong>, <strong>T1 先修改</strong>, <strong>T2 随后</strong>修改, T2 的修改<strong>覆盖了</strong> T1 的修改, 这样第一个事务的修改就丢失了.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210904221653569-0380215.png" alt=""></p> <h5 id="_2-脏读"><a href="#_2-脏读" class="header-anchor">#</a> 2.脏读</h5> <p>事务 A 读取到了事务 B <strong>已经修改但尚未提交</strong>的数据.</p> <p>T1 <strong>修改</strong>一个数据, T2 随后<strong>读取</strong>这个数据. 如果 T1 之后<strong>撤销了这次修改</strong> (T1 事务读取了 T2 事务<strong>尚未提交</strong>的数据), 那么 T2 读取的数据是<strong>脏数据</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210904221906658.png" alt=""></p> <p>实例: 如下面的<strong>取款转账</strong>操作, 按照正确逻辑, 最后的账户余额应该为 <strong>4000</strong> 元, 但是<strong>脏读</strong>之后只有 3000 元了.</p> <table><thead><tr><th style="text-align:center;">时间线</th> <th style="text-align:center;">转账事务</th> <th style="text-align:center;">取款事务</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;"></td> <td style="text-align:center;">开始事务</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">开始事务</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;"></td> <td style="text-align:center;">查询账户<strong>余额为 2000 元</strong></td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:center;"></td> <td style="text-align:center;"><strong>取款 1000 元</strong>, 余额被更改为 1000 元</td></tr> <tr><td style="text-align:center;">5</td> <td style="text-align:center;">查询账户余额为 <strong>1000</strong> 元(产生<strong>脏读</strong>)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">6</td> <td style="text-align:center;"></td> <td style="text-align:center;">取款操作发生未知错误, 事务<strong>回滚</strong>, 余额变更为<strong>2000</strong> 元</td></tr> <tr><td style="text-align:center;">7</td> <td style="text-align:center;">存入 2000 元, 余额被更改为 <strong>3000</strong> 元(脏读的1000 + 2000)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">8</td> <td style="text-align:center;"><strong>提交事务(脏数据)</strong></td> <td style="text-align:center;"></td></tr></tbody></table> <h5 id="_3-不可重复读"><a href="#_3-不可重复读" class="header-anchor">#</a> 3.不可重复读</h5> <p>事务 A 内部的相同查询语句在不同时刻读出的结果不一致, 即<strong>前后多次</strong>读取<strong>数据的内容不一致</strong>.</p> <p>T2 <strong>读取</strong>一个数据, T1 对该数据做了<strong>修改</strong>. 如果 T2 <strong>再次读取这个数据</strong>, 此时读取的结果和第一次读取的<strong>结果不同</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210904234519168.png" alt=""></p> <p>实例: 假设事务 A 在执行<strong>读取</strong>操作, 由整个事务 <strong>A 操作较多</strong>, 且需要<strong>前后</strong>读取同一条数据, 假设两次读取需要经历很长的时间. 如果这时候 B 事务对这个数据进行修改, 就造成了两次读到数据不一致. 按照正确逻辑, 事务 A 前后两次读取到的数据应该一致.</p> <table><thead><tr><th style="text-align:center;">时间线</th> <th style="text-align:center;">事务A(操作多, 持续时间长)</th> <th style="text-align:center;">事务B</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;"><strong>开始事务</strong></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">第一次查询, 小明的年龄为 <strong>20</strong> 岁</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;"></td> <td style="text-align:center;"><strong>开始事务</strong></td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:center;">其他耗时操作</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">5</td> <td style="text-align:center;"></td> <td style="text-align:center;">更改小明的年龄为 30 岁</td></tr> <tr><td style="text-align:center;">6</td> <td style="text-align:center;"></td> <td style="text-align:center;"><strong>提交事务</strong></td></tr> <tr><td style="text-align:center;">7</td> <td style="text-align:center;">第二次查询, 小明的年龄为 30 岁(<strong>不可重复读</strong>)</td> <td style="text-align:center;"></td></tr></tbody></table> <h5 id="_4-幻读"><a href="#_4-幻读" class="header-anchor">#</a> 4.幻读</h5> <p>事务 A 读取到了事务 B 提交的新增数据.</p> <p>T1 读取<strong>某个范围</strong>的数据, T2 在这个<strong>范围内插入新的数</strong>据, T1 再次<strong>读取这个范围</strong>(比如年龄小于 50 的范围)的数据, 此时读取的结果和第一次读取的<strong>结果不同</strong>.</p> <p><img src="https://nano-note.oss-cn-beijing.aliyuncs.com/images/image-20210904235539335.png" alt=""></p> <p>实例: 事务 A 在执行读取操作, 且需要在前后间隔较长时间内进行两次统计数据的<strong>总量</strong>, 前一次查询数据总量后, 此时事务 B 执行了<strong>新增</strong>(或删除)数据的操作并提交后, 这个时候事务 A 读取的数据<strong>总量</strong>和之前<strong>统计的不一样</strong>, 就像产生了幻觉一样, 平白无故的<strong>多了几条数据</strong>, 发生幻读.</p> <table><thead><tr><th style="text-align:center;">时间线</th> <th style="text-align:center;">事务A</th> <th style="text-align:center;">事务B</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;"><strong>开始事务</strong></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">第一次查询, 数据<strong>总量为 100 条</strong></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;"></td> <td style="text-align:center;"><strong>开始事务</strong></td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:center;">其他操作</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">5</td> <td style="text-align:center;"></td> <td style="text-align:center;">新增(删除) <strong>50</strong> 条数据</td></tr> <tr><td style="text-align:center;">6</td> <td style="text-align:center;"></td> <td style="text-align:center;">提交事务</td></tr> <tr><td style="text-align:center;">7</td> <td style="text-align:center;">第二次查询, 数据<strong>总量</strong>为 150 条(<strong>幻读</strong>)</td> <td style="text-align:center;"></td></tr></tbody></table> <blockquote><p><strong>不可重复读和幻读的区别</strong></p></blockquote> <ul><li><strong>不可重复读的重点是修改同一条数据</strong>, 比如多次读取一条记录发现其中的数据值被修改.</li> <li><strong>幻读的重点是新增或者删除范围内的数据</strong>, 比如多次读取某个范围的记录发现<strong>范围内</strong>的记录数量改变了.</li></ul> <p>不可重复读的重点是修改比如<strong>多次读取一条</strong>记录发现其中<strong>某些列的值被修改</strong>, 幻读的重点在于新增或者删除<strong>范围记录</strong>.</p> <h5 id="_5-总结-2"><a href="#_5-总结-2" class="header-anchor">#</a> 5.总结</h5> <p>产生<strong>并发一致性</strong>问题主要原因是<strong>破坏了事务的隔离性</strong>, 解决方法是通过<strong>并发控制</strong>来保证<strong>隔离性</strong>.</p> <p>下面先介绍<strong>锁机制</strong>的相关内容(<strong>封锁粒度, 类型, 协议</strong>等), 再引入事务<strong>隔离级别</strong>.</p> <h4 id="事务隔离级别"><a href="#事务隔离级别" class="header-anchor">#</a> 事务隔离级别</h4> <h5 id="_1-概述-2"><a href="#_1-概述-2" class="header-anchor">#</a> 1.概述</h5> <p>隔离性其实比想象的要复杂. 在 SQL 标准中定义了四种隔离级别, 每一种级别都规定了一个事务中所做的修改, 哪些在事务内和事务间是可见的, 哪些是不可见的. 较低级别的隔离通常可以执行更高的并发, 系统的开销也更低.</p> <p><strong>并发控制</strong>可以通过<strong>封锁</strong>来实现, 但是<strong>加锁机制</strong>操作需要<strong>用户自己控制</strong>, 相当复杂. 因此数据库<strong>提供了事务的隔离级别</strong>, 让用户以一种更轻松的方式<strong>处理并发一致性问题</strong>.</p> <p>事务隔离级别就是为了解决上面<strong>并发一致性</strong>的几种问题(丢失修改, 脏读, 不可重复读, 幻读等)而诞生的. 事务隔离<strong>级别越高</strong>, 在并发下会产生的问题就<strong>越少</strong>, 但同时付出的性能消耗也将越大, 因此很多时候必须在<strong>并发性和性能之间做一个权衡</strong>. 所以设立了<strong>几种事物隔离级别</strong>, 以便让<strong>不同的项目可以根据自己项目的并发情况</strong>选择合适的事务隔离级别, 对于在事务隔离级别之外会产生的并发问题, 在代码中做补偿.</p> <p>设置隔离级别:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">SESSION</span><span class="token operator">|</span><span class="token keyword">GLOBAL</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> 隔离级别名<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看隔离级别:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> @<span class="token variable">@tx_isolation</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>每个<strong>会话都有自己的事务隔离级别</strong>, 不同的<strong>连接</strong>可以设置不同的隔离级别.</p> <h5 id="_2-分类"><a href="#_2-分类" class="header-anchor">#</a> 2.分类</h5> <h6 id="_1-读未提交-read-uncommitted"><a href="#_1-读未提交-read-uncommitted" class="header-anchor">#</a> (1)读未提交(READ UNCOMMITTED)</h6> <p>事务中的<strong>修改</strong>, 即使<strong>没有提交</strong>, 对其它事务也是<strong>可见</strong>的. 问题多多.</p> <h6 id="_2-读已提交-read-committed"><a href="#_2-读已提交-read-committed" class="header-anchor">#</a> (2)读已提交(READ COMMITTED)</h6> <p>一个事务只能<strong>读取已经提交的</strong>事务所做的修改. 换句话说, 一个事务所做的<strong>修改</strong>在提交之前对<strong>其它事务是不可见</strong>的. 解决了<strong>脏读</strong>的问题.</p> <h6 id="_3-可重复读-repeatable-read"><a href="#_3-可重复读-repeatable-read" class="header-anchor">#</a> (3)可重复读(REPEATABLE READ)</h6> <p>保证在同一个事务中<strong>多次读取同样数据的</strong>结果是一样的, 是<strong>默认的隔离级别</strong>. 可重复读解决了脏读与不可重复读问题, 但是<strong>理论</strong>上依然不能解决幻读问题.</p> <p>但是与 SQL 标准不同的是 InnoDB 存储引擎在可重复读事务隔离级别下使用的是 <strong>MVCC</strong> 实现, 并配合 <strong>Next-Key Lock 锁算法</strong>, 因此可以<strong>避免幻读</strong>的产生, 这与其他数据库系统如 SQL Server 是不同的. 所以说 InnoDB 存储引擎的默认支持的可重复读隔离级别已经<strong>可以完全保证事务的隔离性要求</strong>, 即达到了 SQL 标准的串行化隔离级别.</p> <p>可重复读隔离级别在事务开启的时候, 第一次查询是查的数据库里<strong>已提交</strong>的最新数据, 这时候全数据库会有一个<strong>快照</strong>(当然数据库并不是真正的生成了一个快照, 这个就是 MVCC 机制), 在这个事务之后执行的查询操作都是查快照里的数据, 别的事务不管怎么修改数据对当前这个事务的查询都没有影响, 但是当前事务如果修改了某条数据, 那当前事务之后查这条修改的数据就是被修改之后的值, 但是查其它数据依然是从快照里查, 不受影响.</p> <p>因为隔离级别越低, 事务请求的锁越少, 所以许多数据库系统的隔离级别都是 <strong>READ-COMMITTED(读已提交)</strong> , 但是 InnoDB 默认使用可重复读并不会有任何性能损失.</p> <h6 id="_4-可串行化-serializable"><a href="#_4-可串行化-serializable" class="header-anchor">#</a> (4)可串行化(SERIALIZABLE)</h6> <p>强制事务<strong>串行执行</strong>, 解决一切问题, 但是性能消耗严重. 需要<strong>加锁</strong>实现. 这种隔离级别并发性极低, 开发中很少会用.</p> <h5 id="_3-总结"><a href="#_3-总结" class="header-anchor">#</a> 3.总结</h5> <p>数据库的事务隔离越严格, 并发副作用越小, 但付出的代价也就越大, 因为事务隔离实质上就是使事务在一定程度上 &quot;串行化&quot; 进行,这显然与 &quot;并发&quot; 是矛盾的.</p> <p>同时, 不同的应用对读一致性和事务隔离程度的要求也是不同的, 比如许多应用对 &quot;不可重复读&quot; 和 &quot;幻读&quot; 并不敏感,可能更关心数据并发访问的能力, 这就需要根据实际的需求选择隔离级别.</p> <p>各个隔离级别可以解决的并发一致性问题表, 可以根据项目的需求进行选择.</p> <table><thead><tr><th style="text-align:center;">隔离级别</th> <th style="text-align:center;">脏读</th> <th style="text-align:center;">不可重复读</th> <th style="text-align:center;">幻读</th></tr></thead> <tbody><tr><td style="text-align:center;">Read uncommitted(读未提交)</td> <td style="text-align:center;">😱</td> <td style="text-align:center;">😱</td> <td style="text-align:center;">😱</td></tr> <tr><td style="text-align:center;">Read committed(<strong>读已提交</strong>)</td> <td style="text-align:center;">😄</td> <td style="text-align:center;">😱</td> <td style="text-align:center;">😱</td></tr> <tr><td style="text-align:center;">Repeatable read(<strong>可重复读</strong>)</td> <td style="text-align:center;">😄</td> <td style="text-align:center;">😄</td> <td style="text-align:center;">😱</td></tr> <tr><td style="text-align:center;">Serializable(<strong>串行化</strong>)</td> <td style="text-align:center;">😄</td> <td style="text-align:center;">😄</td> <td style="text-align:center;">😄</td></tr></tbody></table> <h4 id="事务日志"><a href="#事务日志" class="header-anchor">#</a> 事务日志</h4> <p>事务日志可以帮助提高事务的效率. 使用事务日志, 存储引擎在修改表的数据时只需要修改其内存拷贝, 再把该修改行为记录到持久在硬盘上的事务日志中, 而不用每次都将修改的数据本身持久到磁盘. 事务日志采用的是追加的方式, 因此写日志的操作是磁盘上一小块区域内的顺序 I/O, 而不像随机 I/O 需要在磁盘的多个地方移动磁头, 所以采用事务日志的方式相对来说要快得多. 事务日志持久以后, 内存中被修改的数据在后台可以慢慢地刷回到磁盘. 目前大多数存储引擎都是这样实现的, 这称之为预写式日志(Write-Ahead Logging), 修改数据需要写两次磁盘.</p> <p>如果数据的修改已经记录到事务日志并持久化, 但数据本身还没有写回磁盘, 此时系统崩溃, 存储引擎在重启时能够自动恢复这部分修改的数据. 具体的恢复方式则视存储引擎而定.</p> <h4 id="多版本并发控制mvcc"><a href="#多版本并发控制mvcc" class="header-anchor">#</a> 多版本并发控制MVCC</h4> <h5 id="_1-概述-3"><a href="#_1-概述-3" class="header-anchor">#</a> 1.概述</h5> <p>前面分析了不同的<strong>隔离级别</strong>, 这些隔离级别在 MySQL 中具体<strong>如何实现</strong>?</p> <p><strong>多版本并发控制</strong>(Multi-Version Concurrency Control, <strong>MVCC</strong>) 是 MySQL 的 <strong>InnoDB</strong> 存储引擎<strong>实现隔离级别</strong>的一种<strong>具体方式</strong>, 用于实现<strong>提交读</strong>和<strong>可重复读</strong>这两种隔离级别. 而<strong>未提交读</strong>隔离级别总是读取<strong>最新的数据行</strong>, <strong>无需</strong>使用 MVCC. <strong>可串行化</strong>隔离级别需要对所有读取的行都<strong>加锁</strong>, 单纯使用 MVCC <strong>无法实现</strong>.</p> <p>可以认为 MVCC 是<strong>行级锁</strong>的一个变种, 但是它在很多情况下避免了加锁操作, 因此开销更低. 虽然实现机制有所不同, 但大都实现了非阻塞的读操作, 写操作也只锁定必要的行.</p> <p>在 MVCC 下, 每个<strong>读</strong>操作会看到一个<strong>一致性</strong>的快照(SNAPSHOT), 并且可以实现<strong>非阻塞的读</strong>. MVCC 允许数据具有<strong>多个版本</strong>, 这个版本可以是时间戳或者是全局递增的事务 ID. MVCC 的实现是通过保存<strong>数据</strong>在某个时间点的<strong>快照</strong>来实现的. 这意味着一个<strong>事务</strong>无论运行<strong>多长时间</strong>, 在<strong>同一个事务</strong>里能够看到<strong>数据一致的视图</strong>. 不同<strong>事务开始的时间不同</strong>, 意味着在<strong>同一个时刻不同事务</strong>看到的相同表里的数据可能是<strong>不同</strong>的.</p> <p><strong>==MVCC 中的快照点只是解决了并发读的问题, 对于增删改都会使用到数据库中最新的数据==<strong>​==. ​==​</strong>==并发读的是快照==</strong>.</p> <p>MVCC 只在<strong>可重复读和读已提交</strong>两个隔离级别下工作. 其他两个隔离级别都和 MVCC 不兼容, 因为&quot;读未提交&quot;总是读取最新的数据行, 而不是符合当前事务版本的数据行. 而&quot;串行化&quot;则会对所有读取的行都加锁.</p> <h5 id="_2-版本号"><a href="#_2-版本号" class="header-anchor">#</a> 2.版本号</h5> <ul><li><strong>系统版本号</strong>: 是一个<strong>递增</strong>的数字, 每开始一个<strong>新的事务</strong>, 系统版本号就会<strong>自动递增</strong>.</li> <li><strong>事务版本号</strong>: 事务开始时对应的<strong>系统版本号</strong>.</li></ul> <p>BEGIN/START TRANSACTION 命令<strong>并不是一个事务</strong>的起点, 在执行到它们之后的第一个操作 InnoDB 表的语句时事务才真正启动, 才会向 MySQL 申请事务 id, MySQL 内部是<strong>严格按照事务的启动顺序来分配事务 id 的</strong>.</p> <p>保存这两个额外系统版本号, 使大多数读操作都可以不用加锁. 这样设计使得读数据操作很简单, 性能很好, 并且也能保证只会读取到符合标准的行.</p> <h5 id="_3-隐藏的列"><a href="#_3-隐藏的列" class="header-anchor">#</a> 3.隐藏的列</h5> <p>MVCC 在<strong>每行</strong>记录后面都保存着两个<strong>隐藏的列</strong>, 用来存储<strong>两个版本号</strong>:</p> <ul><li><strong>创建版本号</strong>: 指示<strong>创建</strong>一个数据行的快照时的<strong>系统版本号</strong>.</li> <li><strong>删除版本号</strong>: 表示数据行的过期(删除)系统版本号.</li></ul> <p>其实这两个版本号可以理解成一个<strong>事务</strong>的版本号.</p> <h5 id="_4-undo日志"><a href="#_4-undo日志" class="header-anchor">#</a> 4.Undo日志</h5> <p>MVCC 使用到的<strong>快照</strong>存储在 <strong>Undo 日志</strong>中, 该日志通过<strong>回滚指针</strong>把一个<strong>数据行(Record) 的所有快照</strong>连接起来, 这样数据就可以有<strong>多个版本</strong>. 在每个事务修改完后, MySQL 会保留修改前的数据 undo 回滚日志, 并且用两个隐藏字段 trx_id 和 roll_pointer 把这些 undo 日志串联起来形成一个历史记录版本链.</p> <h5 id="_5-可重复读的实现过程"><a href="#_5-可重复读的实现过程" class="header-anchor">#</a> 5.可重复读的实现过程</h5> <p>下面是在<strong>可重复读</strong>的隔离级别下, MVCC 的工作流程.</p> <p>当开始一个事务时, <strong>该事务的版本号肯定大于当前所有数据行快照的创建版本号</strong>, 理解这一点很关键. 数据行快照的创建版本号是创建数据行快照时的系统版本号, 系统版本号随着创建事务而递增, 因此新创建一个事务时, <strong>当前这个事务的系统版本号肯定比所有数据行快照的创建版本号都大</strong>.</p> <h6 id="_1-select"><a href="#_1-select" class="header-anchor">#</a> (1)SELECT</h6> <p><strong>多个事务</strong>必须读取到<strong>同一个数据行</strong>的快照, 并且这个快照是<strong>距离现在最近</strong>的一个<strong>有效快照</strong>. 但是也有例外, 如果有一个事务<strong>正在修改</strong>该数据行, 那么它可以读取事务本身所做的修改, 而<strong>不用</strong>和其它事务的读取结果一致.</p> <p>把没有对一个数据行做修改的<strong>事务称为 T</strong>, T 所要<strong>读取</strong>的数据行快照的<strong>创建版本号</strong>必须<strong>小于 T 的版本号</strong>, 因为如果大于或者等于 T 的版本号, 那么表示该数据行快照是其它事务的<strong>最新修改</strong>, 因此<strong>不能</strong>去读取它. 除此之外, T 所要读取的数据行快照的<strong>删除版本号</strong>必须<strong>大于 T 的版本号</strong>, 因为如果小于等于 T 的版本号, 那么表示该数据行快照是<strong>已经被删除</strong>的, 不应该去读取它.</p> <ul><li>InnoDB 只查找版本早于当前事务版本的数据行(也就是, 行的系统版本号小于或等于事务的系统版本号), 这样可以确保事务读取的行, 要么是在事务开始前已经存在的, 要么是事务自身插入或者修改过的.</li> <li>行的删除版本要么未定义, 要么大于当前事务版本号. 这可以确保事务读取到的行, 在事务开始之前未被删除.</li></ul> <h6 id="_2-insert"><a href="#_2-insert" class="header-anchor">#</a> (2)INSERT</h6> <p>将当前<strong>系统版本号</strong>作为数据行快照的<strong>创建版本号</strong>.</p> <h6 id="_3-delete"><a href="#_3-delete" class="header-anchor">#</a> (3)DELETE</h6> <p>将当前<strong>系统版本号</strong>作为数据行快照的<strong>删除版本号</strong>.</p> <p>对于<strong>删除</strong>操作, MySQL 底层会记录好被删除的数据行的<strong>删除事务 id</strong>, 对于<strong>更新</strong>操作 MySQL 底层会<strong>新增一行相同数据(使用 undoLog 实现)<strong>​<strong><strong>并记录好对应的</strong></strong>​</strong>创建事务 id</strong>.</p> <ul><li><strong>创建事务 id &lt;= max (当前事务 id(12), 快照点已提交最大事务 id)</strong></li> <li><strong>删除事务 id &gt; max (当前事务 id(12), 快照点已提交最大事务 id)</strong></li></ul> <h6 id="_4-update"><a href="#_4-update" class="header-anchor">#</a> (4)UPDATE</h6> <p>将当前<strong>系统版本号</strong>作为更新前的数据行快照的<strong>删除版本号</strong>, 并将当前<strong>系统版本号</strong>作为更新后的数据行快照的<strong>创建版本号</strong>. 可以理解为<strong>先执行 DELETE 后执行 INSERT</strong>.</p> <h5 id="_6-快照读与当前读"><a href="#_6-快照读与当前读" class="header-anchor">#</a> 6.快照读与当前读</h5> <h6 id="_1-快照读"><a href="#_1-快照读" class="header-anchor">#</a> (1)快照读</h6> <p>使用 <strong>MVCC</strong> 读取的是<strong>快照中</strong>的数据, 这样可以<strong>减少加锁</strong>所带来的开销.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">TABLE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h6 id="_2-当前读"><a href="#_2-当前读" class="header-anchor">#</a> (2)当前读</h6> <p><strong>读取</strong>的是<strong>最新</strong>的数据, 需要<strong>加锁</strong>. 以下第一个语句需要加 <strong>S 锁</strong>, 其它都需要加 <strong>X 锁</strong>.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">TABLE</span> <span class="token keyword">WHERE</span> ? <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">TABLE</span> <span class="token keyword">WHERE</span> ? <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="事务优化"><a href="#事务优化" class="header-anchor">#</a> 事务优化</h4> <h5 id="_1-大事务的影响"><a href="#_1-大事务的影响" class="header-anchor">#</a> 1.大事务的影响</h5> <ul><li>并发情况下, 数据库连接池容易被撑爆</li> <li>锁定太多的数据, 造成大量的阻塞和锁超时</li> <li>执行时间长, 容易造成主从延迟</li> <li>回滚所需要的时间比较长</li> <li>undo log 膨胀</li> <li>容易导致死锁</li></ul> <h5 id="_2-事务优化"><a href="#_2-事务优化" class="header-anchor">#</a> 2.事务优化</h5> <ul><li>将查询等数据准备操作放到事务外</li> <li>事务中避免远程调用, 远程调用要设置超时, 防止事务等待时间太久</li> <li>事务中避免一次性处理太多数据, 可以拆分成多个事务分次处理</li> <li>更新等涉及加锁的操作尽可能放在事务靠后的位置</li> <li>能异步处理的尽量异步处理</li> <li>应用侧(业务代码)保证数据一致性, 非事务执行</li></ul> <p>‍</p> <p>‍</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <ul><li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-storage-engine.html" target="_blank" rel="noopener noreferrer">The InnoDB Storage Engine<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.slideshare.net/ErnestoHernandezRodriguez/transaction-isolation-levels" target="_blank" rel="noopener noreferrer">Transaction isolation levels<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://scanftree.com/dbms/2-phase-locking-protocol" target="_blank" rel="noopener noreferrer">Concurrency Control<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.slideshare.net/brshristov/the-nightmare-of-locking-blocking-and-isolation-levels-46391666" target="_blank" rel="noopener noreferrer">The Nightmare of Locking, Blocking and Isolation Levels!<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://aksakalli.github.io/2012/03/12/database-normalization-and-normal-forms-with-an-example.html" target="_blank" rel="noopener noreferrer">Database Normalization and Normal Forms with an Example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.jcole.us/2014/04/16/the-basics-of-the-innodb-undo-logging-and-history-system/" target="_blank" rel="noopener noreferrer">The basics of the InnoDB undo logging and history system<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.brightbox.com/blog/2013/10/31/on-mysql-locks/" target="_blank" rel="noopener noreferrer">MySQL locking for the busy web developer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://draveness.me/mysql-innodb" target="_blank" rel="noopener noreferrer">浅入浅出 MySQL 和 InnoDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/main/docs/20.开发/2300.数据库/304.MySQL锁机制与事务并发控制.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/cbc7ab/" class="prev">MySQL优化</a></span> <span class="next"><a href="/pages/412461/">MySQL高级特性</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f90282/"><div>
            基础
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/0f75ac/"><div>
            搜索二叉树BST
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/39721f/"><div>
            平衡二叉树AVL
            <!----></div></a> <span class="date">06-08</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1174520425@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/nanodaemony" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>达尔文的猹 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.5bc2c979.js" defer></script><script src="/assets/js/2.eccd4273.js" defer></script><script src="/assets/js/182.8bfd08cd.js" defer></script>
  </body>
</html>
